<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html" class="current">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6097161">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6097216">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6097270">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6097321">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="6097395">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="6097481">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6097522">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="6097554">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="6097635">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="6097686">//</span><br>
<span class="lineno"></span><span class="comment" id="6097689">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="6097774">//</span><br>
<span class="lineno"></span><span class="comment" id="6097777">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="6097851">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="6097929">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="6098004">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="6098080">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6098147">//</span><br>
<span class="lineno">20</span><span class="comment" id="6098150">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6098222">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="6098255">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6098301">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6098333">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="6098387">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6098400">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6098415">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6098424">//</span><br>
<span class="lineno"></span><span class="comment" id="6098427">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="6098441">//</span><br>
<span class="lineno"></span><span class="comment" id="6098444">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6098469">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="6098506">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6098583">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="6098648">//</span><br>
<span class="lineno"></span><span class="comment" id="6098651">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6098698">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="6098761">//</span><br>
<span class="lineno"></span><span class="comment" id="6098764">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="6098812">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6098855">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6098893">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6098929">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6098942">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="6098951">//</span><br>
<span class="lineno"></span><span class="comment" id="6098954">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="6099016">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="6099097">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="6099146">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="6099193">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="6099266">//</span><br>
<span class="lineno"></span><span class="comment" id="6099269">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6099340">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="6099357">//</span><br>
<span class="lineno">55</span><span class="comment" id="6099360">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6099404">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="6099431">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="6099457">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6099495">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="6099520">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6099533">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6099542">//</span><br>
<span class="lineno"></span><span class="comment" id="6099545">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6099623">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="6099704">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="6099730">//</span><br>
<span class="lineno"></span><span class="comment" id="6099733">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6099787">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="6099866">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6099914">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="6099950">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6099981">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="6100012">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6100060">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="6100077">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="6100091">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6100100">//</span><br>
<span class="lineno"></span><span class="comment" id="6100103">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="6100115">//</span><br>
<span class="lineno">80</span><span class="comment" id="6100118">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="6100192">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6100277">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="6100356">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6100430">//</span><br>
<span class="lineno">85</span><span class="comment" id="6100433">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6100462">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6100498">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="6100530">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6100539">//</span><br>
<span class="lineno">90</span><span class="comment" id="6100542">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6100577">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6100618">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6100656">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="6100682">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="6100711">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="6100737">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6100746">//</span><br>
<span class="lineno"></span><span class="comment" id="6100749">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="6100825">//</span><br>
<span class="lineno">100</span><span class="comment" id="6100828">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6100917">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="6100944">//</span><br>
<span class="lineno"></span><span class="comment" id="6100947">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6100977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="6101008">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6101039">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6101072">//</span><br>
<span class="lineno"></span><span class="comment" id="6101075">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6101159">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="6101232">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="6101254">//</span><br>
<span class="lineno"></span><span class="comment" id="6101257">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6101294">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6101332">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="6101370">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6101410">//</span><br>
<span class="lineno"></span><span class="comment" id="6101413">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="6101491">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="6101569">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="6101621">//</span><br>
<span class="lineno"></span><span class="comment" id="6101624">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="6101632">//</span><br>
<span class="lineno"></span><span class="comment" id="6101635">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="6101713">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="6101794">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="6101867">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="6101906">//</span><br>
<span class="lineno"></span><span class="comment" id="6101909">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="6101940">//</span><br>
<span class="lineno">130</span><span class="comment" id="6101943">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="6102021">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="6102096">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="6102169">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6102206">//</span><br>
<span class="lineno">135</span><span class="comment" id="6102209">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="6102255">//</span><br>
<span class="lineno"></span><span class="comment" id="6102258">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6102310">//</span><br>
<span class="lineno"></span><span class="comment" id="6102313">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="6102399">package</span>&nbsp;<span class="ident" id="6102407">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6102416">import</span>&nbsp;<span class="op" id="6102423">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102426">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102435">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102443">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102450">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102456">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102467">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102484">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102495">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102506">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6102514">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6102521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6102524">var</span>&nbsp;<span class="op" id="6102528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6102531">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6102610">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6102687">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6102765">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6102842">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102872">short</span>&nbsp;<span class="op" id="6102878">=</span>&nbsp;<span class="ident" id="6102880">flag</span><span class="op" id="6102884">.</span><span class="ident" id="6102885">Bool</span><span class="op" id="6102889">(</span><span class="string" id="6102890">&#34;test.short&#34;</span><span class="op" id="6102902">,</span>&nbsp;<span class="builtintype" id="6102904">false</span><span class="op" id="6102909">,</span>&nbsp;<span class="string" id="6102911">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="6102948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6102952">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103031">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103110">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103197">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103231">outputDir</span>&nbsp;<span class="op" id="6103241">=</span>&nbsp;<span class="ident" id="6103243">flag</span><span class="op" id="6103247">.</span><span class="ident" id="6103248">String</span><span class="op" id="6103254">(</span><span class="string" id="6103255">&#34;test.outputdir&#34;</span><span class="op" id="6103271">,</span>&nbsp;<span class="string" id="6103273">&#34;&#34;</span><span class="op" id="6103275">,</span>&nbsp;<span class="string" id="6103277">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="6103315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103319">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103379">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6103396">=</span>&nbsp;<span class="ident" id="6103398">flag</span><span class="op" id="6103402">.</span><span class="ident" id="6103403">Bool</span><span class="op" id="6103407">(</span><span class="string" id="6103408">&#34;test.v&#34;</span><span class="op" id="6103416">,</span>&nbsp;<span class="builtintype" id="6103418">false</span><span class="op" id="6103423">,</span>&nbsp;<span class="string" id="6103425">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="6103459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103462">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6103479">=</span>&nbsp;<span class="ident" id="6103481">flag</span><span class="op" id="6103485">.</span><span class="ident" id="6103486">String</span><span class="op" id="6103492">(</span><span class="string" id="6103493">&#34;test.coverprofile&#34;</span><span class="op" id="6103512">,</span>&nbsp;<span class="string" id="6103514">&#34;&#34;</span><span class="op" id="6103516">,</span>&nbsp;<span class="string" id="6103518">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6103578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103581">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6103598">=</span>&nbsp;<span class="ident" id="6103600">flag</span><span class="op" id="6103604">.</span><span class="ident" id="6103605">String</span><span class="op" id="6103611">(</span><span class="string" id="6103612">&#34;test.run&#34;</span><span class="op" id="6103622">,</span>&nbsp;<span class="string" id="6103624">&#34;&#34;</span><span class="op" id="6103626">,</span>&nbsp;<span class="string" id="6103628">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="6103684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103687">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6103704">=</span>&nbsp;<span class="ident" id="6103706">flag</span><span class="op" id="6103710">.</span><span class="ident" id="6103711">String</span><span class="op" id="6103717">(</span><span class="string" id="6103718">&#34;test.memprofile&#34;</span><span class="op" id="6103735">,</span>&nbsp;<span class="string" id="6103737">&#34;&#34;</span><span class="op" id="6103739">,</span>&nbsp;<span class="string" id="6103741">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6103799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103802">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6103819">=</span>&nbsp;<span class="ident" id="6103821">flag</span><span class="op" id="6103825">.</span><span class="ident" id="6103826">Int</span><span class="op" id="6103829">(</span><span class="string" id="6103830">&#34;test.memprofilerate&#34;</span><span class="op" id="6103851">,</span>&nbsp;<span class="num" id="6103853">0</span><span class="op" id="6103854">,</span>&nbsp;<span class="string" id="6103856">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="6103893">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103896">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6103913">=</span>&nbsp;<span class="ident" id="6103915">flag</span><span class="op" id="6103919">.</span><span class="ident" id="6103920">String</span><span class="op" id="6103926">(</span><span class="string" id="6103927">&#34;test.cpuprofile&#34;</span><span class="op" id="6103944">,</span>&nbsp;<span class="string" id="6103946">&#34;&#34;</span><span class="op" id="6103948">,</span>&nbsp;<span class="string" id="6103950">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="6104006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104009">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104026">=</span>&nbsp;<span class="ident" id="6104028">flag</span><span class="op" id="6104032">.</span><span class="ident" id="6104033">String</span><span class="op" id="6104039">(</span><span class="string" id="6104040">&#34;test.blockprofile&#34;</span><span class="op" id="6104059">,</span>&nbsp;<span class="string" id="6104061">&#34;&#34;</span><span class="op" id="6104063">,</span>&nbsp;<span class="string" id="6104065">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6104135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104138">blockProfileRate</span>&nbsp;<span class="op" id="6104155">=</span>&nbsp;<span class="ident" id="6104157">flag</span><span class="op" id="6104161">.</span><span class="ident" id="6104162">Int</span><span class="op" id="6104165">(</span><span class="string" id="6104166">&#34;test.blockprofilerate&#34;</span><span class="op" id="6104189">,</span>&nbsp;<span class="num" id="6104191">1</span><span class="op" id="6104192">,</span>&nbsp;<span class="string" id="6104194">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="6104240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104243">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104260">=</span>&nbsp;<span class="ident" id="6104262">flag</span><span class="op" id="6104266">.</span><span class="ident" id="6104267">Duration</span><span class="op" id="6104275">(</span><span class="string" id="6104276">&#34;test.timeout&#34;</span><span class="op" id="6104290">,</span>&nbsp;<span class="num" id="6104292">0</span><span class="op" id="6104293">,</span>&nbsp;<span class="string" id="6104295">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="6104352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104355">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104372">=</span>&nbsp;<span class="ident" id="6104374">flag</span><span class="op" id="6104378">.</span><span class="ident" id="6104379">String</span><span class="op" id="6104385">(</span><span class="string" id="6104386">&#34;test.cpu&#34;</span><span class="op" id="6104396">,</span>&nbsp;<span class="string" id="6104398">&#34;&#34;</span><span class="op" id="6104400">,</span>&nbsp;<span class="string" id="6104402">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="6104463">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104466">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104483">=</span>&nbsp;<span class="ident" id="6104485">flag</span><span class="op" id="6104489">.</span><span class="ident" id="6104490">Int</span><span class="op" id="6104493">(</span><span class="string" id="6104494">&#34;test.parallel&#34;</span><span class="op" id="6104509">,</span>&nbsp;<span class="ident" id="6104511">runtime</span><span class="op" id="6104518">.</span><span class="ident" id="6104519">GOMAXPROCS</span><span class="op" id="6104529">(</span><span class="num" id="6104530">0</span><span class="op" id="6104531">)</span><span class="op" id="6104532">,</span>&nbsp;<span class="string" id="6104534">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="6104560">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104564">haveExamples</span>&nbsp;<span class="builtintype" id="6104577">bool</span>&nbsp;<span class="comment" id="6104582">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104607">cpuList</span>&nbsp;<span class="op" id="6104615">[</span><span class="op" id="6104616">]</span><span class="builtintype" id="6104617">int</span><br>
<span class="lineno">185</span><span class="op" id="6104621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6104624">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6104680">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="6104723">type</span>&nbsp;<span class="ident" id="6104728">common</span>&nbsp;<span class="keyword" id="6104735">struct</span>&nbsp;<span class="op" id="6104742">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104745">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104754">sync</span><span class="op" id="6104758">.</span><span class="ident" id="6104759">RWMutex</span>&nbsp;<span class="comment" id="6104767">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104796">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6104805">[</span><span class="op" id="6104806">]</span><span class="builtintype" id="6104807">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6104818">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104861">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6104870">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6104883">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104917">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="6104926">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6104939">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104979">finished</span>&nbsp;<span class="builtintype" id="6104988">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104995">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105004">time</span><span class="op" id="6105008">.</span><span class="ident" id="6105009">Time</span>&nbsp;<span class="comment" id="6105014">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105049">duration</span>&nbsp;<span class="ident" id="6105058">time</span><span class="op" id="6105062">.</span><span class="ident" id="6105063">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105073">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105082">interface</span><span class="op" id="6105091">{</span><span class="op" id="6105092">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6105099">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105143">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105152">chan</span>&nbsp;<span class="keyword" id="6105157">interface</span><span class="op" id="6105166">{</span><span class="op" id="6105167">}</span>&nbsp;<span class="comment" id="6105169">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="6105197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6105200">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6105254">func</span>&nbsp;<span class="ident" id="6105259">Short</span><span class="op" id="6105264">(</span><span class="op" id="6105265">)</span>&nbsp;<span class="builtintype" id="6105267">bool</span>&nbsp;<span class="op" id="6105272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105275">return</span>&nbsp;<span class="op" id="6105282">*</span><span class="ident" id="6105283">short</span><br>
<span class="lineno">205</span><span class="op" id="6105289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6105292">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6105344">func</span>&nbsp;<span class="ident" id="6105349">Verbose</span><span class="op" id="6105356">(</span><span class="op" id="6105357">)</span>&nbsp;<span class="builtintype" id="6105359">bool</span>&nbsp;<span class="op" id="6105364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105367">return</span>&nbsp;<span class="op" id="6105374">*</span><span class="ident" id="6105375">chatty</span><br>
<span class="lineno">210</span><span class="op" id="6105382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6105385">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="6105457">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="6105537">func</span>&nbsp;<span class="ident" id="6105542">decorate</span><span class="op" id="6105550">(</span><span class="ident" id="6105551">s</span>&nbsp;<span class="builtintype" id="6105553">string</span><span class="op" id="6105559">)</span>&nbsp;<span class="builtintype" id="6105561">string</span>&nbsp;<span class="op" id="6105568">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105571">_</span><span class="op" id="6105572">,</span>&nbsp;<span class="ident" id="6105574">file</span><span class="op" id="6105578">,</span>&nbsp;<span class="ident" id="6105580">line</span><span class="op" id="6105584">,</span>&nbsp;<span class="ident" id="6105586">ok</span>&nbsp;<span class="op" id="6105589">:=</span>&nbsp;<span class="ident" id="6105592">runtime</span><span class="op" id="6105599">.</span><span class="ident" id="6105600">Caller</span><span class="op" id="6105606">(</span><span class="num" id="6105607">3</span><span class="op" id="6105608">)</span>&nbsp;<span class="comment" id="6105610">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105648">if</span>&nbsp;<span class="ident" id="6105651">ok</span>&nbsp;<span class="op" id="6105654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6105658">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105711">if</span>&nbsp;<span class="ident" id="6105714">index</span>&nbsp;<span class="op" id="6105720">:=</span>&nbsp;<span class="ident" id="6105723">strings</span><span class="op" id="6105730">.</span><span class="ident" id="6105731">LastIndex</span><span class="op" id="6105740">(</span><span class="ident" id="6105741">file</span><span class="op" id="6105745">,</span>&nbsp;<span class="string" id="6105747">&#34;/&#34;</span><span class="op" id="6105750">)</span><span class="op" id="6105751">;</span>&nbsp;<span class="ident" id="6105753">index</span>&nbsp;<span class="op" id="6105759">&gt;=</span>&nbsp;<span class="num" id="6105762">0</span>&nbsp;<span class="op" id="6105764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105769">file</span>&nbsp;<span class="op" id="6105774">=</span>&nbsp;<span class="ident" id="6105776">file</span><span class="op" id="6105780">[</span><span class="ident" id="6105781">index</span><span class="op" id="6105786">+</span><span class="num" id="6105787">1</span><span class="op" id="6105788">:</span><span class="op" id="6105789">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105793">}</span>&nbsp;<span class="keyword" id="6105795">else</span>&nbsp;<span class="keyword" id="6105800">if</span>&nbsp;<span class="ident" id="6105803">index</span>&nbsp;<span class="op" id="6105809">=</span>&nbsp;<span class="ident" id="6105811">strings</span><span class="op" id="6105818">.</span><span class="ident" id="6105819">LastIndex</span><span class="op" id="6105828">(</span><span class="ident" id="6105829">file</span><span class="op" id="6105833">,</span>&nbsp;<span class="string" id="6105835">&#34;\\&#34;</span><span class="op" id="6105839">)</span><span class="op" id="6105840">;</span>&nbsp;<span class="ident" id="6105842">index</span>&nbsp;<span class="op" id="6105848">&gt;=</span>&nbsp;<span class="num" id="6105851">0</span>&nbsp;<span class="op" id="6105853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105858">file</span>&nbsp;<span class="op" id="6105863">=</span>&nbsp;<span class="ident" id="6105865">file</span><span class="op" id="6105869">[</span><span class="ident" id="6105870">index</span><span class="op" id="6105875">+</span><span class="num" id="6105876">1</span><span class="op" id="6105877">:</span><span class="op" id="6105878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105885">}</span>&nbsp;<span class="keyword" id="6105887">else</span>&nbsp;<span class="op" id="6105892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105896">file</span>&nbsp;<span class="op" id="6105901">=</span>&nbsp;<span class="string" id="6105903">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105911">line</span>&nbsp;<span class="op" id="6105916">=</span>&nbsp;<span class="num" id="6105918">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105924">buf</span>&nbsp;<span class="op" id="6105928">:=</span>&nbsp;<span class="builtinfunc" id="6105931">new</span><span class="op" id="6105934">(</span><span class="ident" id="6105935">bytes</span><span class="op" id="6105940">.</span><span class="ident" id="6105941">Buffer</span><span class="op" id="6105947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6105950">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105995">buf</span><span class="op" id="6105998">.</span><span class="ident" id="6105999">WriteByte</span><span class="op" id="6106008">(</span><span class="string" id="6106009">&#39;\t&#39;</span><span class="op" id="6106013">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106016">fmt</span><span class="op" id="6106019">.</span><span class="ident" id="6106020">Fprintf</span><span class="op" id="6106027">(</span><span class="ident" id="6106028">buf</span><span class="op" id="6106031">,</span>&nbsp;<span class="string" id="6106033">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="6106042">,</span>&nbsp;<span class="ident" id="6106044">file</span><span class="op" id="6106048">,</span>&nbsp;<span class="ident" id="6106050">line</span><span class="op" id="6106054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106057">lines</span>&nbsp;<span class="op" id="6106063">:=</span>&nbsp;<span class="ident" id="6106066">strings</span><span class="op" id="6106073">.</span><span class="ident" id="6106074">Split</span><span class="op" id="6106079">(</span><span class="ident" id="6106080">s</span><span class="op" id="6106081">,</span>&nbsp;<span class="string" id="6106083">&#34;\n&#34;</span><span class="op" id="6106087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106090">if</span>&nbsp;<span class="ident" id="6106093">l</span>&nbsp;<span class="op" id="6106095">:=</span>&nbsp;<span class="builtinfunc" id="6106098">len</span><span class="op" id="6106101">(</span><span class="ident" id="6106102">lines</span><span class="op" id="6106107">)</span><span class="op" id="6106108">;</span>&nbsp;<span class="ident" id="6106110">l</span>&nbsp;<span class="op" id="6106112">&gt;</span>&nbsp;<span class="num" id="6106114">1</span>&nbsp;<span class="op" id="6106116">&amp;&amp;</span>&nbsp;<span class="ident" id="6106119">lines</span><span class="op" id="6106124">[</span><span class="ident" id="6106125">l</span><span class="op" id="6106126">-</span><span class="num" id="6106127">1</span><span class="op" id="6106128">]</span>&nbsp;<span class="op" id="6106130">==</span>&nbsp;<span class="string" id="6106133">&#34;&#34;</span>&nbsp;<span class="op" id="6106136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106140">lines</span>&nbsp;<span class="op" id="6106146">=</span>&nbsp;<span class="ident" id="6106148">lines</span><span class="op" id="6106153">[</span><span class="op" id="6106154">:</span><span class="ident" id="6106155">l</span><span class="op" id="6106156">-</span><span class="num" id="6106157">1</span><span class="op" id="6106158">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106161">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106164">for</span>&nbsp;<span class="ident" id="6106168">i</span><span class="op" id="6106169">,</span>&nbsp;<span class="ident" id="6106171">line</span>&nbsp;<span class="op" id="6106176">:=</span>&nbsp;<span class="keyword" id="6106179">range</span>&nbsp;<span class="ident" id="6106185">lines</span>&nbsp;<span class="op" id="6106191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106195">if</span>&nbsp;<span class="ident" id="6106198">i</span>&nbsp;<span class="op" id="6106200">&gt;</span>&nbsp;<span class="num" id="6106202">0</span>&nbsp;<span class="op" id="6106204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6106209">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106270">buf</span><span class="op" id="6106273">.</span><span class="ident" id="6106274">WriteString</span><span class="op" id="6106285">(</span><span class="string" id="6106286">&#34;\n\t\t&#34;</span><span class="op" id="6106294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106298">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106302">buf</span><span class="op" id="6106305">.</span><span class="ident" id="6106306">WriteString</span><span class="op" id="6106317">(</span><span class="ident" id="6106318">line</span><span class="op" id="6106322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106328">buf</span><span class="op" id="6106331">.</span><span class="ident" id="6106332">WriteByte</span><span class="op" id="6106341">(</span><span class="string" id="6106342">&#39;\n&#39;</span><span class="op" id="6106346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106349">return</span>&nbsp;<span class="ident" id="6106356">buf</span><span class="op" id="6106359">.</span><span class="ident" id="6106360">String</span><span class="op" id="6106366">(</span><span class="op" id="6106367">)</span><br>
<span class="lineno"></span><span class="op" id="6106369">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6106372">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6106441">func</span>&nbsp;<span class="ident" id="6106446">fmtDuration</span><span class="op" id="6106457">(</span><span class="ident" id="6106458">d</span>&nbsp;<span class="ident" id="6106460">time</span><span class="op" id="6106464">.</span><span class="ident" id="6106465">Duration</span><span class="op" id="6106473">)</span>&nbsp;<span class="builtintype" id="6106475">string</span>&nbsp;<span class="op" id="6106482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106485">return</span>&nbsp;<span class="ident" id="6106492">fmt</span><span class="op" id="6106495">.</span><span class="ident" id="6106496">Sprintf</span><span class="op" id="6106503">(</span><span class="string" id="6106504">&#34;%.2fs&#34;</span><span class="op" id="6106511">,</span>&nbsp;<span class="ident" id="6106513">d</span><span class="op" id="6106514">.</span><span class="ident" id="6106515">Seconds</span><span class="op" id="6106522">(</span><span class="op" id="6106523">)</span><span class="op" id="6106524">)</span><br>
<span class="lineno"></span><span class="op" id="6106526">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="6106529">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="6106571">type</span>&nbsp;<span class="ident" id="6106576">TB</span>&nbsp;<span class="keyword" id="6106579">interface</span>&nbsp;<span class="op" id="6106589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106592">Error</span><span class="op" id="6106597">(</span><span class="ident" id="6106598">args</span>&nbsp;<span class="op" id="6106603">...</span><span class="keyword" id="6106606">interface</span><span class="op" id="6106615">{</span><span class="op" id="6106616">}</span><span class="op" id="6106617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106620">Errorf</span><span class="op" id="6106626">(</span><span class="ident" id="6106627">format</span>&nbsp;<span class="builtintype" id="6106634">string</span><span class="op" id="6106640">,</span>&nbsp;<span class="ident" id="6106642">args</span>&nbsp;<span class="op" id="6106647">...</span><span class="keyword" id="6106650">interface</span><span class="op" id="6106659">{</span><span class="op" id="6106660">}</span><span class="op" id="6106661">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106664">Fail</span><span class="op" id="6106668">(</span><span class="op" id="6106669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106672">FailNow</span><span class="op" id="6106679">(</span><span class="op" id="6106680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106683">Failed</span><span class="op" id="6106689">(</span><span class="op" id="6106690">)</span>&nbsp;<span class="builtintype" id="6106692">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106698">Fatal</span><span class="op" id="6106703">(</span><span class="ident" id="6106704">args</span>&nbsp;<span class="op" id="6106709">...</span><span class="keyword" id="6106712">interface</span><span class="op" id="6106721">{</span><span class="op" id="6106722">}</span><span class="op" id="6106723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106726">Fatalf</span><span class="op" id="6106732">(</span><span class="ident" id="6106733">format</span>&nbsp;<span class="builtintype" id="6106740">string</span><span class="op" id="6106746">,</span>&nbsp;<span class="ident" id="6106748">args</span>&nbsp;<span class="op" id="6106753">...</span><span class="keyword" id="6106756">interface</span><span class="op" id="6106765">{</span><span class="op" id="6106766">}</span><span class="op" id="6106767">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106770">Log</span><span class="op" id="6106773">(</span><span class="ident" id="6106774">args</span>&nbsp;<span class="op" id="6106779">...</span><span class="keyword" id="6106782">interface</span><span class="op" id="6106791">{</span><span class="op" id="6106792">}</span><span class="op" id="6106793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106796">Logf</span><span class="op" id="6106800">(</span><span class="ident" id="6106801">format</span>&nbsp;<span class="builtintype" id="6106808">string</span><span class="op" id="6106814">,</span>&nbsp;<span class="ident" id="6106816">args</span>&nbsp;<span class="op" id="6106821">...</span><span class="keyword" id="6106824">interface</span><span class="op" id="6106833">{</span><span class="op" id="6106834">}</span><span class="op" id="6106835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106838">Skip</span><span class="op" id="6106842">(</span><span class="ident" id="6106843">args</span>&nbsp;<span class="op" id="6106848">...</span><span class="keyword" id="6106851">interface</span><span class="op" id="6106860">{</span><span class="op" id="6106861">}</span><span class="op" id="6106862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106865">SkipNow</span><span class="op" id="6106872">(</span><span class="op" id="6106873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106876">Skipf</span><span class="op" id="6106881">(</span><span class="ident" id="6106882">format</span>&nbsp;<span class="builtintype" id="6106889">string</span><span class="op" id="6106895">,</span>&nbsp;<span class="ident" id="6106897">args</span>&nbsp;<span class="op" id="6106902">...</span><span class="keyword" id="6106905">interface</span><span class="op" id="6106914">{</span><span class="op" id="6106915">}</span><span class="op" id="6106916">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106919">Skipped</span><span class="op" id="6106926">(</span><span class="op" id="6106927">)</span>&nbsp;<span class="builtintype" id="6106929">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6106936">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6106991">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6107044">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107076">private</span><span class="op" id="6107083">(</span><span class="op" id="6107084">)</span><br>
<span class="lineno"></span><span class="op" id="6107086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6107089">var</span>&nbsp;<span class="ident" id="6107093">_</span>&nbsp;<span class="ident" id="6107095">TB</span>&nbsp;<span class="op" id="6107098">=</span>&nbsp;<span class="op" id="6107100">(</span><span class="op" id="6107101">*</span><span class="ident" id="6107102">T</span><span class="op" id="6107103">)</span><span class="op" id="6107104">(</span><span class="ident" id="6107105">nil</span><span class="op" id="6107108">)</span><br>
<span class="lineno"></span><span class="keyword" id="6107110">var</span>&nbsp;<span class="ident" id="6107114">_</span>&nbsp;<span class="ident" id="6107116">TB</span>&nbsp;<span class="op" id="6107119">=</span>&nbsp;<span class="op" id="6107121">(</span><span class="op" id="6107122">*</span><span class="ident" id="6107123">B</span><span class="op" id="6107124">)</span><span class="op" id="6107125">(</span><span class="ident" id="6107126">nil</span><span class="op" id="6107129">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6107132">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="6107226">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="6107307">type</span>&nbsp;<span class="ident" id="6107312">T</span>&nbsp;<span class="keyword" id="6107314">struct</span>&nbsp;<span class="op" id="6107321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107324">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107332">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6107346">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6107356">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107374">startParallel</span>&nbsp;<span class="keyword" id="6107388">chan</span>&nbsp;<span class="builtintype" id="6107393">bool</span>&nbsp;<span class="comment" id="6107398">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="6107435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6107438">func</span>&nbsp;<span class="op" id="6107443">(</span><span class="ident" id="6107444">c</span>&nbsp;<span class="op" id="6107446">*</span><span class="ident" id="6107447">common</span><span class="op" id="6107453">)</span>&nbsp;<span class="ident" id="6107455">private</span><span class="op" id="6107462">(</span><span class="op" id="6107463">)</span>&nbsp;<span class="op" id="6107465">{</span><span class="op" id="6107466">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6107469">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="6107538">func</span>&nbsp;<span class="op" id="6107543">(</span><span class="ident" id="6107544">c</span>&nbsp;<span class="op" id="6107546">*</span><span class="ident" id="6107547">common</span><span class="op" id="6107553">)</span>&nbsp;<span class="ident" id="6107555">Fail</span><span class="op" id="6107559">(</span><span class="op" id="6107560">)</span>&nbsp;<span class="op" id="6107562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107565">c</span><span class="op" id="6107566">.</span><span class="ident" id="6107567">mu</span><span class="op" id="6107569">.</span><span class="ident" id="6107570">Lock</span><span class="op" id="6107574">(</span><span class="op" id="6107575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107578">defer</span>&nbsp;<span class="ident" id="6107584">c</span><span class="op" id="6107585">.</span><span class="ident" id="6107586">mu</span><span class="op" id="6107588">.</span><span class="ident" id="6107589">Unlock</span><span class="op" id="6107595">(</span><span class="op" id="6107596">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107599">c</span><span class="op" id="6107600">.</span><span class="ident" id="6107601">failed</span>&nbsp;<span class="op" id="6107608">=</span>&nbsp;<span class="builtintype" id="6107610">true</span><br>
<span class="lineno"></span><span class="op" id="6107615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6107618">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6107669">func</span>&nbsp;<span class="op" id="6107674">(</span><span class="ident" id="6107675">c</span>&nbsp;<span class="op" id="6107677">*</span><span class="ident" id="6107678">common</span><span class="op" id="6107684">)</span>&nbsp;<span class="ident" id="6107686">Failed</span><span class="op" id="6107692">(</span><span class="op" id="6107693">)</span>&nbsp;<span class="builtintype" id="6107695">bool</span>&nbsp;<span class="op" id="6107700">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107703">c</span><span class="op" id="6107704">.</span><span class="ident" id="6107705">mu</span><span class="op" id="6107707">.</span><span class="ident" id="6107708">RLock</span><span class="op" id="6107713">(</span><span class="op" id="6107714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107717">defer</span>&nbsp;<span class="ident" id="6107723">c</span><span class="op" id="6107724">.</span><span class="ident" id="6107725">mu</span><span class="op" id="6107727">.</span><span class="ident" id="6107728">RUnlock</span><span class="op" id="6107735">(</span><span class="op" id="6107736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107739">return</span>&nbsp;<span class="ident" id="6107746">c</span><span class="op" id="6107747">.</span><span class="ident" id="6107748">failed</span><br>
<span class="lineno"></span><span class="op" id="6107755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6107758">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6107830">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="6107888">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6107945">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6108002">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="6108060">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6108087">func</span>&nbsp;<span class="op" id="6108092">(</span><span class="ident" id="6108093">c</span>&nbsp;<span class="op" id="6108095">*</span><span class="ident" id="6108096">common</span><span class="op" id="6108102">)</span>&nbsp;<span class="ident" id="6108104">FailNow</span><span class="op" id="6108111">(</span><span class="op" id="6108112">)</span>&nbsp;<span class="op" id="6108114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108117">c</span><span class="op" id="6108118">.</span><span class="ident" id="6108119">Fail</span><span class="op" id="6108123">(</span><span class="op" id="6108124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108128">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108186">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108241">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108302">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108365">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108369">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108411">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108415">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108436">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108459">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108480">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108484">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108546">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108608">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108670">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108739">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108808">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108880">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108944">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6109008">c</span><span class="op" id="6109009">.</span><span class="ident" id="6109010">finished</span>&nbsp;<span class="op" id="6109019">=</span>&nbsp;<span class="builtintype" id="6109021">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6109027">runtime</span><span class="op" id="6109034">.</span><span class="ident" id="6109035">Goexit</span><span class="op" id="6109041">(</span><span class="op" id="6109042">)</span><br>
<span class="lineno">330</span><span class="op" id="6109044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6109047">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6109113">func</span>&nbsp;<span class="op" id="6109118">(</span><span class="ident" id="6109119">c</span>&nbsp;<span class="op" id="6109121">*</span><span class="ident" id="6109122">common</span><span class="op" id="6109128">)</span>&nbsp;<span class="ident" id="6109130">log</span><span class="op" id="6109133">(</span><span class="ident" id="6109134">s</span>&nbsp;<span class="builtintype" id="6109136">string</span><span class="op" id="6109142">)</span>&nbsp;<span class="op" id="6109144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6109147">c</span><span class="op" id="6109148">.</span><span class="ident" id="6109149">mu</span><span class="op" id="6109151">.</span><span class="ident" id="6109152">Lock</span><span class="op" id="6109156">(</span><span class="op" id="6109157">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6109160">defer</span>&nbsp;<span class="ident" id="6109166">c</span><span class="op" id="6109167">.</span><span class="ident" id="6109168">mu</span><span class="op" id="6109170">.</span><span class="ident" id="6109171">Unlock</span><span class="op" id="6109177">(</span><span class="op" id="6109178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6109181">c</span><span class="op" id="6109182">.</span><span class="ident" id="6109183">output</span>&nbsp;<span class="op" id="6109190">=</span>&nbsp;<span class="builtinfunc" id="6109192">append</span><span class="op" id="6109198">(</span><span class="ident" id="6109199">c</span><span class="op" id="6109200">.</span><span class="ident" id="6109201">output</span><span class="op" id="6109207">,</span>&nbsp;<span class="ident" id="6109209">decorate</span><span class="op" id="6109217">(</span><span class="ident" id="6109218">s</span><span class="op" id="6109219">)</span><span class="op" id="6109220">...</span><span class="op" id="6109223">)</span><br>
<span class="lineno"></span><span class="op" id="6109225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6109228">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="6109305">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6109380">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6109426">func</span>&nbsp;<span class="op" id="6109431">(</span><span class="ident" id="6109432">c</span>&nbsp;<span class="op" id="6109434">*</span><span class="ident" id="6109435">common</span><span class="op" id="6109441">)</span>&nbsp;<span class="ident" id="6109443">Log</span><span class="op" id="6109446">(</span><span class="ident" id="6109447">args</span>&nbsp;<span class="op" id="6109452">...</span><span class="keyword" id="6109455">interface</span><span class="op" id="6109464">{</span><span class="op" id="6109465">}</span><span class="op" id="6109466">)</span>&nbsp;<span class="op" id="6109468">{</span>&nbsp;<span class="ident" id="6109470">c</span><span class="op" id="6109471">.</span><span class="ident" id="6109472">log</span><span class="op" id="6109475">(</span><span class="ident" id="6109476">fmt</span><span class="op" id="6109479">.</span><span class="ident" id="6109480">Sprintln</span><span class="op" id="6109488">(</span><span class="ident" id="6109489">args</span><span class="op" id="6109493">...</span><span class="op" id="6109496">)</span><span class="op" id="6109497">)</span>&nbsp;<span class="op" id="6109499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6109502">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="6109578">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6109653">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6109699">func</span>&nbsp;<span class="op" id="6109704">(</span><span class="ident" id="6109705">c</span>&nbsp;<span class="op" id="6109707">*</span><span class="ident" id="6109708">common</span><span class="op" id="6109714">)</span>&nbsp;<span class="ident" id="6109716">Logf</span><span class="op" id="6109720">(</span><span class="ident" id="6109721">format</span>&nbsp;<span class="builtintype" id="6109728">string</span><span class="op" id="6109734">,</span>&nbsp;<span class="ident" id="6109736">args</span>&nbsp;<span class="op" id="6109741">...</span><span class="keyword" id="6109744">interface</span><span class="op" id="6109753">{</span><span class="op" id="6109754">}</span><span class="op" id="6109755">)</span>&nbsp;<span class="op" id="6109757">{</span>&nbsp;<span class="ident" id="6109759">c</span><span class="op" id="6109760">.</span><span class="ident" id="6109761">log</span><span class="op" id="6109764">(</span><span class="ident" id="6109765">fmt</span><span class="op" id="6109768">.</span><span class="ident" id="6109769">Sprintf</span><span class="op" id="6109776">(</span><span class="ident" id="6109777">format</span><span class="op" id="6109783">,</span>&nbsp;<span class="ident" id="6109785">args</span><span class="op" id="6109789">...</span><span class="op" id="6109792">)</span><span class="op" id="6109793">)</span>&nbsp;<span class="op" id="6109795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6109798">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="6109846">func</span>&nbsp;<span class="op" id="6109851">(</span><span class="ident" id="6109852">c</span>&nbsp;<span class="op" id="6109854">*</span><span class="ident" id="6109855">common</span><span class="op" id="6109861">)</span>&nbsp;<span class="ident" id="6109863">Error</span><span class="op" id="6109868">(</span><span class="ident" id="6109869">args</span>&nbsp;<span class="op" id="6109874">...</span><span class="keyword" id="6109877">interface</span><span class="op" id="6109886">{</span><span class="op" id="6109887">}</span><span class="op" id="6109888">)</span>&nbsp;<span class="op" id="6109890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6109893">c</span><span class="op" id="6109894">.</span><span class="ident" id="6109895">log</span><span class="op" id="6109898">(</span><span class="ident" id="6109899">fmt</span><span class="op" id="6109902">.</span><span class="ident" id="6109903">Sprintln</span><span class="op" id="6109911">(</span><span class="ident" id="6109912">args</span><span class="op" id="6109916">...</span><span class="op" id="6109919">)</span><span class="op" id="6109920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6109923">c</span><span class="op" id="6109924">.</span><span class="ident" id="6109925">Fail</span><span class="op" id="6109929">(</span><span class="op" id="6109930">)</span><br>
<span class="lineno"></span><span class="op" id="6109932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6109935">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="6109985">func</span>&nbsp;<span class="op" id="6109990">(</span><span class="ident" id="6109991">c</span>&nbsp;<span class="op" id="6109993">*</span><span class="ident" id="6109994">common</span><span class="op" id="6110000">)</span>&nbsp;<span class="ident" id="6110002">Errorf</span><span class="op" id="6110008">(</span><span class="ident" id="6110009">format</span>&nbsp;<span class="builtintype" id="6110016">string</span><span class="op" id="6110022">,</span>&nbsp;<span class="ident" id="6110024">args</span>&nbsp;<span class="op" id="6110029">...</span><span class="keyword" id="6110032">interface</span><span class="op" id="6110041">{</span><span class="op" id="6110042">}</span><span class="op" id="6110043">)</span>&nbsp;<span class="op" id="6110045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110048">c</span><span class="op" id="6110049">.</span><span class="ident" id="6110050">log</span><span class="op" id="6110053">(</span><span class="ident" id="6110054">fmt</span><span class="op" id="6110057">.</span><span class="ident" id="6110058">Sprintf</span><span class="op" id="6110065">(</span><span class="ident" id="6110066">format</span><span class="op" id="6110072">,</span>&nbsp;<span class="ident" id="6110074">args</span><span class="op" id="6110078">...</span><span class="op" id="6110081">)</span><span class="op" id="6110082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110085">c</span><span class="op" id="6110086">.</span><span class="ident" id="6110087">Fail</span><span class="op" id="6110091">(</span><span class="op" id="6110092">)</span><br>
<span class="lineno"></span><span class="op" id="6110094">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="6110097">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6110148">func</span>&nbsp;<span class="op" id="6110153">(</span><span class="ident" id="6110154">c</span>&nbsp;<span class="op" id="6110156">*</span><span class="ident" id="6110157">common</span><span class="op" id="6110163">)</span>&nbsp;<span class="ident" id="6110165">Fatal</span><span class="op" id="6110170">(</span><span class="ident" id="6110171">args</span>&nbsp;<span class="op" id="6110176">...</span><span class="keyword" id="6110179">interface</span><span class="op" id="6110188">{</span><span class="op" id="6110189">}</span><span class="op" id="6110190">)</span>&nbsp;<span class="op" id="6110192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110195">c</span><span class="op" id="6110196">.</span><span class="ident" id="6110197">log</span><span class="op" id="6110200">(</span><span class="ident" id="6110201">fmt</span><span class="op" id="6110204">.</span><span class="ident" id="6110205">Sprintln</span><span class="op" id="6110213">(</span><span class="ident" id="6110214">args</span><span class="op" id="6110218">...</span><span class="op" id="6110221">)</span><span class="op" id="6110222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110225">c</span><span class="op" id="6110226">.</span><span class="ident" id="6110227">FailNow</span><span class="op" id="6110234">(</span><span class="op" id="6110235">)</span><br>
<span class="lineno">365</span><span class="op" id="6110237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6110240">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6110293">func</span>&nbsp;<span class="op" id="6110298">(</span><span class="ident" id="6110299">c</span>&nbsp;<span class="op" id="6110301">*</span><span class="ident" id="6110302">common</span><span class="op" id="6110308">)</span>&nbsp;<span class="ident" id="6110310">Fatalf</span><span class="op" id="6110316">(</span><span class="ident" id="6110317">format</span>&nbsp;<span class="builtintype" id="6110324">string</span><span class="op" id="6110330">,</span>&nbsp;<span class="ident" id="6110332">args</span>&nbsp;<span class="op" id="6110337">...</span><span class="keyword" id="6110340">interface</span><span class="op" id="6110349">{</span><span class="op" id="6110350">}</span><span class="op" id="6110351">)</span>&nbsp;<span class="op" id="6110353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110356">c</span><span class="op" id="6110357">.</span><span class="ident" id="6110358">log</span><span class="op" id="6110361">(</span><span class="ident" id="6110362">fmt</span><span class="op" id="6110365">.</span><span class="ident" id="6110366">Sprintf</span><span class="op" id="6110373">(</span><span class="ident" id="6110374">format</span><span class="op" id="6110380">,</span>&nbsp;<span class="ident" id="6110382">args</span><span class="op" id="6110386">...</span><span class="op" id="6110389">)</span><span class="op" id="6110390">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110393">c</span><span class="op" id="6110394">.</span><span class="ident" id="6110395">FailNow</span><span class="op" id="6110402">(</span><span class="op" id="6110403">)</span><br>
<span class="lineno"></span><span class="op" id="6110405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6110408">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6110458">func</span>&nbsp;<span class="op" id="6110463">(</span><span class="ident" id="6110464">c</span>&nbsp;<span class="op" id="6110466">*</span><span class="ident" id="6110467">common</span><span class="op" id="6110473">)</span>&nbsp;<span class="ident" id="6110475">Skip</span><span class="op" id="6110479">(</span><span class="ident" id="6110480">args</span>&nbsp;<span class="op" id="6110485">...</span><span class="keyword" id="6110488">interface</span><span class="op" id="6110497">{</span><span class="op" id="6110498">}</span><span class="op" id="6110499">)</span>&nbsp;<span class="op" id="6110501">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110504">c</span><span class="op" id="6110505">.</span><span class="ident" id="6110506">log</span><span class="op" id="6110509">(</span><span class="ident" id="6110510">fmt</span><span class="op" id="6110513">.</span><span class="ident" id="6110514">Sprintln</span><span class="op" id="6110522">(</span><span class="ident" id="6110523">args</span><span class="op" id="6110527">...</span><span class="op" id="6110530">)</span><span class="op" id="6110531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110534">c</span><span class="op" id="6110535">.</span><span class="ident" id="6110536">SkipNow</span><span class="op" id="6110543">(</span><span class="op" id="6110544">)</span><br>
<span class="lineno"></span><span class="op" id="6110546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6110549">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="6110601">func</span>&nbsp;<span class="op" id="6110606">(</span><span class="ident" id="6110607">c</span>&nbsp;<span class="op" id="6110609">*</span><span class="ident" id="6110610">common</span><span class="op" id="6110616">)</span>&nbsp;<span class="ident" id="6110618">Skipf</span><span class="op" id="6110623">(</span><span class="ident" id="6110624">format</span>&nbsp;<span class="builtintype" id="6110631">string</span><span class="op" id="6110637">,</span>&nbsp;<span class="ident" id="6110639">args</span>&nbsp;<span class="op" id="6110644">...</span><span class="keyword" id="6110647">interface</span><span class="op" id="6110656">{</span><span class="op" id="6110657">}</span><span class="op" id="6110658">)</span>&nbsp;<span class="op" id="6110660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110663">c</span><span class="op" id="6110664">.</span><span class="ident" id="6110665">log</span><span class="op" id="6110668">(</span><span class="ident" id="6110669">fmt</span><span class="op" id="6110672">.</span><span class="ident" id="6110673">Sprintf</span><span class="op" id="6110680">(</span><span class="ident" id="6110681">format</span><span class="op" id="6110687">,</span>&nbsp;<span class="ident" id="6110689">args</span><span class="op" id="6110693">...</span><span class="op" id="6110696">)</span><span class="op" id="6110697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6110700">c</span><span class="op" id="6110701">.</span><span class="ident" id="6110702">SkipNow</span><span class="op" id="6110709">(</span><span class="op" id="6110710">)</span><br>
<span class="lineno"></span><span class="op" id="6110712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="6110715">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6110789">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="6110865">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6110937">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="6111012">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="6111039">func</span>&nbsp;<span class="op" id="6111044">(</span><span class="ident" id="6111045">c</span>&nbsp;<span class="op" id="6111047">*</span><span class="ident" id="6111048">common</span><span class="op" id="6111054">)</span>&nbsp;<span class="ident" id="6111056">SkipNow</span><span class="op" id="6111063">(</span><span class="op" id="6111064">)</span>&nbsp;<span class="op" id="6111066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111069">c</span><span class="op" id="6111070">.</span><span class="ident" id="6111071">skip</span><span class="op" id="6111075">(</span><span class="op" id="6111076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111079">c</span><span class="op" id="6111080">.</span><span class="ident" id="6111081">finished</span>&nbsp;<span class="op" id="6111090">=</span>&nbsp;<span class="builtintype" id="6111092">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111098">runtime</span><span class="op" id="6111105">.</span><span class="ident" id="6111106">Goexit</span><span class="op" id="6111112">(</span><span class="op" id="6111113">)</span><br>
<span class="lineno"></span><span class="op" id="6111115">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6111118">func</span>&nbsp;<span class="op" id="6111123">(</span><span class="ident" id="6111124">c</span>&nbsp;<span class="op" id="6111126">*</span><span class="ident" id="6111127">common</span><span class="op" id="6111133">)</span>&nbsp;<span class="ident" id="6111135">skip</span><span class="op" id="6111139">(</span><span class="op" id="6111140">)</span>&nbsp;<span class="op" id="6111142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111145">c</span><span class="op" id="6111146">.</span><span class="ident" id="6111147">mu</span><span class="op" id="6111149">.</span><span class="ident" id="6111150">Lock</span><span class="op" id="6111154">(</span><span class="op" id="6111155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6111158">defer</span>&nbsp;<span class="ident" id="6111164">c</span><span class="op" id="6111165">.</span><span class="ident" id="6111166">mu</span><span class="op" id="6111168">.</span><span class="ident" id="6111169">Unlock</span><span class="op" id="6111175">(</span><span class="op" id="6111176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111179">c</span><span class="op" id="6111180">.</span><span class="ident" id="6111181">skipped</span>&nbsp;<span class="op" id="6111189">=</span>&nbsp;<span class="builtintype" id="6111191">true</span><br>
<span class="lineno">400</span><span class="op" id="6111196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6111199">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="6111248">func</span>&nbsp;<span class="op" id="6111253">(</span><span class="ident" id="6111254">c</span>&nbsp;<span class="op" id="6111256">*</span><span class="ident" id="6111257">common</span><span class="op" id="6111263">)</span>&nbsp;<span class="ident" id="6111265">Skipped</span><span class="op" id="6111272">(</span><span class="op" id="6111273">)</span>&nbsp;<span class="builtintype" id="6111275">bool</span>&nbsp;<span class="op" id="6111280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111283">c</span><span class="op" id="6111284">.</span><span class="ident" id="6111285">mu</span><span class="op" id="6111287">.</span><span class="ident" id="6111288">RLock</span><span class="op" id="6111293">(</span><span class="op" id="6111294">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6111297">defer</span>&nbsp;<span class="ident" id="6111303">c</span><span class="op" id="6111304">.</span><span class="ident" id="6111305">mu</span><span class="op" id="6111307">.</span><span class="ident" id="6111308">RUnlock</span><span class="op" id="6111315">(</span><span class="op" id="6111316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6111319">return</span>&nbsp;<span class="ident" id="6111326">c</span><span class="op" id="6111327">.</span><span class="ident" id="6111328">skipped</span><br>
<span class="lineno"></span><span class="op" id="6111336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6111339">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="6111420">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6111445">func</span>&nbsp;<span class="op" id="6111450">(</span><span class="ident" id="6111451">t</span>&nbsp;<span class="op" id="6111453">*</span><span class="ident" id="6111454">T</span><span class="op" id="6111455">)</span>&nbsp;<span class="ident" id="6111457">Parallel</span><span class="op" id="6111465">(</span><span class="op" id="6111466">)</span>&nbsp;<span class="op" id="6111468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111471">t</span><span class="op" id="6111472">.</span><span class="ident" id="6111473">signal</span>&nbsp;<span class="op" id="6111480">&lt;-</span>&nbsp;<span class="op" id="6111483">(</span><span class="op" id="6111484">*</span><span class="ident" id="6111485">T</span><span class="op" id="6111486">)</span><span class="op" id="6111487">(</span><span class="ident" id="6111488">nil</span><span class="op" id="6111491">)</span>&nbsp;<span class="comment" id="6111493">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6111523">&lt;-</span><span class="ident" id="6111525">t</span><span class="op" id="6111526">.</span><span class="ident" id="6111527">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6111545">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6111581">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6111656">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111731">t</span><span class="op" id="6111732">.</span><span class="ident" id="6111733">start</span>&nbsp;<span class="op" id="6111739">=</span>&nbsp;<span class="ident" id="6111741">time</span><span class="op" id="6111745">.</span><span class="ident" id="6111746">Now</span><span class="op" id="6111749">(</span><span class="op" id="6111750">)</span><br>
<span class="lineno"></span><span class="op" id="6111752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6111755">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="6111844">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6111873">type</span>&nbsp;<span class="ident" id="6111878">InternalTest</span>&nbsp;<span class="keyword" id="6111891">struct</span>&nbsp;<span class="op" id="6111898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111901">Name</span>&nbsp;<span class="builtintype" id="6111906">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6111914">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6111919">func</span><span class="op" id="6111923">(</span><span class="op" id="6111924">*</span><span class="ident" id="6111925">T</span><span class="op" id="6111926">)</span><br>
<span class="lineno"></span><span class="op" id="6111928">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="6111931">func</span>&nbsp;<span class="ident" id="6111936">tRunner</span><span class="op" id="6111943">(</span><span class="ident" id="6111944">t</span>&nbsp;<span class="op" id="6111946">*</span><span class="ident" id="6111947">T</span><span class="op" id="6111948">,</span>&nbsp;<span class="ident" id="6111950">test</span>&nbsp;<span class="op" id="6111955">*</span><span class="ident" id="6111956">InternalTest</span><span class="op" id="6111968">)</span>&nbsp;<span class="op" id="6111970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6111973">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6112031">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6112089">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6112148">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6112191">defer</span>&nbsp;<span class="keyword" id="6112197">func</span><span class="op" id="6112201">(</span><span class="op" id="6112202">)</span>&nbsp;<span class="op" id="6112204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112208">t</span><span class="op" id="6112209">.</span><span class="ident" id="6112210">duration</span>&nbsp;<span class="op" id="6112219">=</span>&nbsp;<span class="ident" id="6112221">time</span><span class="op" id="6112225">.</span><span class="ident" id="6112226">Now</span><span class="op" id="6112229">(</span><span class="op" id="6112230">)</span><span class="op" id="6112231">.</span><span class="ident" id="6112232">Sub</span><span class="op" id="6112235">(</span><span class="ident" id="6112236">t</span><span class="op" id="6112237">.</span><span class="ident" id="6112238">start</span><span class="op" id="6112243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6112247">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112310">err</span>&nbsp;<span class="op" id="6112314">:=</span>&nbsp;<span class="builtinfunc" id="6112317">recover</span><span class="op" id="6112324">(</span><span class="op" id="6112325">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6112329">if</span>&nbsp;<span class="op" id="6112332">!</span><span class="ident" id="6112333">t</span><span class="op" id="6112334">.</span><span class="ident" id="6112335">finished</span>&nbsp;<span class="op" id="6112344">&amp;&amp;</span>&nbsp;<span class="ident" id="6112347">err</span>&nbsp;<span class="op" id="6112351">==</span>&nbsp;<span class="ident" id="6112354">nil</span>&nbsp;<span class="op" id="6112358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112363">err</span>&nbsp;<span class="op" id="6112367">=</span>&nbsp;<span class="ident" id="6112369">fmt</span><span class="op" id="6112372">.</span><span class="ident" id="6112373">Errorf</span><span class="op" id="6112379">(</span><span class="string" id="6112380">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="6112424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6112428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6112432">if</span>&nbsp;<span class="ident" id="6112435">err</span>&nbsp;<span class="op" id="6112439">!=</span>&nbsp;<span class="ident" id="6112442">nil</span>&nbsp;<span class="op" id="6112446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112451">t</span><span class="op" id="6112452">.</span><span class="ident" id="6112453">Fail</span><span class="op" id="6112457">(</span><span class="op" id="6112458">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112463">t</span><span class="op" id="6112464">.</span><span class="ident" id="6112465">report</span><span class="op" id="6112471">(</span><span class="op" id="6112472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6112477">panic</span><span class="op" id="6112482">(</span><span class="ident" id="6112483">err</span><span class="op" id="6112486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6112490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112494">t</span><span class="op" id="6112495">.</span><span class="ident" id="6112496">signal</span>&nbsp;<span class="op" id="6112503">&lt;-</span>&nbsp;<span class="ident" id="6112506">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6112509">}</span><span class="op" id="6112510">(</span><span class="op" id="6112511">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112515">t</span><span class="op" id="6112516">.</span><span class="ident" id="6112517">start</span>&nbsp;<span class="op" id="6112523">=</span>&nbsp;<span class="ident" id="6112525">time</span><span class="op" id="6112529">.</span><span class="ident" id="6112530">Now</span><span class="op" id="6112533">(</span><span class="op" id="6112534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112537">test</span><span class="op" id="6112541">.</span><span class="ident" id="6112542">F</span><span class="op" id="6112543">(</span><span class="ident" id="6112544">t</span><span class="op" id="6112545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112548">t</span><span class="op" id="6112549">.</span><span class="ident" id="6112550">finished</span>&nbsp;<span class="op" id="6112559">=</span>&nbsp;<span class="builtintype" id="6112561">true</span><br>
<span class="lineno"></span><span class="op" id="6112566">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="6112569">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6112662">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6112691">func</span>&nbsp;<span class="ident" id="6112696">Main</span><span class="op" id="6112700">(</span><span class="ident" id="6112701">matchString</span>&nbsp;<span class="keyword" id="6112713">func</span><span class="op" id="6112717">(</span><span class="ident" id="6112718">pat</span><span class="op" id="6112721">,</span>&nbsp;<span class="ident" id="6112723">str</span>&nbsp;<span class="builtintype" id="6112727">string</span><span class="op" id="6112733">)</span>&nbsp;<span class="op" id="6112735">(</span><span class="builtintype" id="6112736">bool</span><span class="op" id="6112740">,</span>&nbsp;<span class="builtintype" id="6112742">error</span><span class="op" id="6112747">)</span><span class="op" id="6112748">,</span>&nbsp;<span class="ident" id="6112750">tests</span>&nbsp;<span class="op" id="6112756">[</span><span class="op" id="6112757">]</span><span class="ident" id="6112758">InternalTest</span><span class="op" id="6112770">,</span>&nbsp;<span class="ident" id="6112772">benchmarks</span>&nbsp;<span class="op" id="6112783">[</span><span class="op" id="6112784">]</span><span class="ident" id="6112785">InternalBenchmark</span><span class="op" id="6112802">,</span>&nbsp;<span class="ident" id="6112804">examples</span>&nbsp;<span class="op" id="6112813">[</span><span class="op" id="6112814">]</span><span class="ident" id="6112815">InternalExample</span><span class="op" id="6112830">)</span>&nbsp;<span class="op" id="6112832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112835">os</span><span class="op" id="6112837">.</span><span class="ident" id="6112838">Exit</span><span class="op" id="6112842">(</span><span class="ident" id="6112843">MainStart</span><span class="op" id="6112852">(</span><span class="ident" id="6112853">matchString</span><span class="op" id="6112864">,</span>&nbsp;<span class="ident" id="6112866">tests</span><span class="op" id="6112871">,</span>&nbsp;<span class="ident" id="6112873">benchmarks</span><span class="op" id="6112883">,</span>&nbsp;<span class="ident" id="6112885">examples</span><span class="op" id="6112893">)</span><span class="op" id="6112894">.</span><span class="ident" id="6112895">Run</span><span class="op" id="6112898">(</span><span class="op" id="6112899">)</span><span class="op" id="6112900">)</span><br>
<span class="lineno">455</span><span class="op" id="6112902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6112905">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6112975">type</span>&nbsp;<span class="ident" id="6112980">M</span>&nbsp;<span class="keyword" id="6112982">struct</span>&nbsp;<span class="op" id="6112989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6112992">matchString</span>&nbsp;<span class="keyword" id="6113004">func</span><span class="op" id="6113008">(</span><span class="ident" id="6113009">pat</span><span class="op" id="6113012">,</span>&nbsp;<span class="ident" id="6113014">str</span>&nbsp;<span class="builtintype" id="6113018">string</span><span class="op" id="6113024">)</span>&nbsp;<span class="op" id="6113026">(</span><span class="builtintype" id="6113027">bool</span><span class="op" id="6113031">,</span>&nbsp;<span class="builtintype" id="6113033">error</span><span class="op" id="6113038">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113041">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113053">[</span><span class="op" id="6113054">]</span><span class="ident" id="6113055">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113069">benchmarks</span>&nbsp;&nbsp;<span class="op" id="6113081">[</span><span class="op" id="6113082">]</span><span class="ident" id="6113083">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113102">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113114">[</span><span class="op" id="6113115">]</span><span class="ident" id="6113116">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="6113132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="6113135">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6113198">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="6113294">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="6113346">func</span>&nbsp;<span class="ident" id="6113351">MainStart</span><span class="op" id="6113360">(</span><span class="ident" id="6113361">matchString</span>&nbsp;<span class="keyword" id="6113373">func</span><span class="op" id="6113377">(</span><span class="ident" id="6113378">pat</span><span class="op" id="6113381">,</span>&nbsp;<span class="ident" id="6113383">str</span>&nbsp;<span class="builtintype" id="6113387">string</span><span class="op" id="6113393">)</span>&nbsp;<span class="op" id="6113395">(</span><span class="builtintype" id="6113396">bool</span><span class="op" id="6113400">,</span>&nbsp;<span class="builtintype" id="6113402">error</span><span class="op" id="6113407">)</span><span class="op" id="6113408">,</span>&nbsp;<span class="ident" id="6113410">tests</span>&nbsp;<span class="op" id="6113416">[</span><span class="op" id="6113417">]</span><span class="ident" id="6113418">InternalTest</span><span class="op" id="6113430">,</span>&nbsp;<span class="ident" id="6113432">benchmarks</span>&nbsp;<span class="op" id="6113443">[</span><span class="op" id="6113444">]</span><span class="ident" id="6113445">InternalBenchmark</span><span class="op" id="6113462">,</span>&nbsp;<span class="ident" id="6113464">examples</span>&nbsp;<span class="op" id="6113473">[</span><span class="op" id="6113474">]</span><span class="ident" id="6113475">InternalExample</span><span class="op" id="6113490">)</span>&nbsp;<span class="op" id="6113492">*</span><span class="ident" id="6113493">M</span>&nbsp;<span class="op" id="6113495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6113498">return</span>&nbsp;<span class="op" id="6113505">&amp;</span><span class="ident" id="6113506">M</span><span class="op" id="6113507">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113511">matchString</span><span class="op" id="6113522">:</span>&nbsp;<span class="ident" id="6113524">matchString</span><span class="op" id="6113535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113539">tests</span><span class="op" id="6113544">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113552">tests</span><span class="op" id="6113557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113561">benchmarks</span><span class="op" id="6113571">:</span>&nbsp;&nbsp;<span class="ident" id="6113574">benchmarks</span><span class="op" id="6113584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113588">examples</span><span class="op" id="6113596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113601">examples</span><span class="op" id="6113609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6113612">}</span><br>
<span class="lineno">475</span><span class="op" id="6113614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6113617">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="6113684">func</span>&nbsp;<span class="op" id="6113689">(</span><span class="ident" id="6113690">m</span>&nbsp;<span class="op" id="6113692">*</span><span class="ident" id="6113693">M</span><span class="op" id="6113694">)</span>&nbsp;<span class="ident" id="6113696">Run</span><span class="op" id="6113699">(</span><span class="op" id="6113700">)</span>&nbsp;<span class="builtintype" id="6113702">int</span>&nbsp;<span class="op" id="6113706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113709">flag</span><span class="op" id="6113713">.</span><span class="ident" id="6113714">Parse</span><span class="op" id="6113719">(</span><span class="op" id="6113720">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113723">parseCpuList</span><span class="op" id="6113735">(</span><span class="op" id="6113736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113740">before</span><span class="op" id="6113746">(</span><span class="op" id="6113747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113750">startAlarm</span><span class="op" id="6113760">(</span><span class="op" id="6113761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113764">haveExamples</span>&nbsp;<span class="op" id="6113777">=</span>&nbsp;<span class="builtinfunc" id="6113779">len</span><span class="op" id="6113782">(</span><span class="ident" id="6113783">m</span><span class="op" id="6113784">.</span><span class="ident" id="6113785">examples</span><span class="op" id="6113793">)</span>&nbsp;<span class="op" id="6113795">&gt;</span>&nbsp;<span class="num" id="6113797">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113800">testOk</span>&nbsp;<span class="op" id="6113807">:=</span>&nbsp;<span class="ident" id="6113810">RunTests</span><span class="op" id="6113818">(</span><span class="ident" id="6113819">m</span><span class="op" id="6113820">.</span><span class="ident" id="6113821">matchString</span><span class="op" id="6113832">,</span>&nbsp;<span class="ident" id="6113834">m</span><span class="op" id="6113835">.</span><span class="ident" id="6113836">tests</span><span class="op" id="6113841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113844">exampleOk</span>&nbsp;<span class="op" id="6113854">:=</span>&nbsp;<span class="ident" id="6113857">RunExamples</span><span class="op" id="6113868">(</span><span class="ident" id="6113869">m</span><span class="op" id="6113870">.</span><span class="ident" id="6113871">matchString</span><span class="op" id="6113882">,</span>&nbsp;<span class="ident" id="6113884">m</span><span class="op" id="6113885">.</span><span class="ident" id="6113886">examples</span><span class="op" id="6113894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113897">stopAlarm</span><span class="op" id="6113906">(</span><span class="op" id="6113907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6113910">if</span>&nbsp;<span class="op" id="6113913">!</span><span class="ident" id="6113914">testOk</span>&nbsp;<span class="op" id="6113921">||</span>&nbsp;<span class="op" id="6113924">!</span><span class="ident" id="6113925">exampleOk</span>&nbsp;<span class="op" id="6113935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113939">fmt</span><span class="op" id="6113942">.</span><span class="ident" id="6113943">Println</span><span class="op" id="6113950">(</span><span class="string" id="6113951">&#34;FAIL&#34;</span><span class="op" id="6113957">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113961">after</span><span class="op" id="6113966">(</span><span class="op" id="6113967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6113971">return</span>&nbsp;<span class="num" id="6113978">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6113981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6113984">fmt</span><span class="op" id="6113987">.</span><span class="ident" id="6113988">Println</span><span class="op" id="6113995">(</span><span class="string" id="6113996">&#34;PASS&#34;</span><span class="op" id="6114002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114005">RunBenchmarks</span><span class="op" id="6114018">(</span><span class="ident" id="6114019">m</span><span class="op" id="6114020">.</span><span class="ident" id="6114021">matchString</span><span class="op" id="6114032">,</span>&nbsp;<span class="ident" id="6114034">m</span><span class="op" id="6114035">.</span><span class="ident" id="6114036">benchmarks</span><span class="op" id="6114046">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114049">after</span><span class="op" id="6114054">(</span><span class="op" id="6114055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6114058">return</span>&nbsp;<span class="num" id="6114065">0</span><br>
<span class="lineno"></span><span class="op" id="6114067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6114070">func</span>&nbsp;<span class="op" id="6114075">(</span><span class="ident" id="6114076">t</span>&nbsp;<span class="op" id="6114078">*</span><span class="ident" id="6114079">T</span><span class="op" id="6114080">)</span>&nbsp;<span class="ident" id="6114082">report</span><span class="op" id="6114088">(</span><span class="op" id="6114089">)</span>&nbsp;<span class="op" id="6114091">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114094">dstr</span>&nbsp;<span class="op" id="6114099">:=</span>&nbsp;<span class="ident" id="6114102">fmtDuration</span><span class="op" id="6114113">(</span><span class="ident" id="6114114">t</span><span class="op" id="6114115">.</span><span class="ident" id="6114116">duration</span><span class="op" id="6114124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114127">format</span>&nbsp;<span class="op" id="6114134">:=</span>&nbsp;<span class="string" id="6114137">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6114160">if</span>&nbsp;<span class="ident" id="6114163">t</span><span class="op" id="6114164">.</span><span class="ident" id="6114165">Failed</span><span class="op" id="6114171">(</span><span class="op" id="6114172">)</span>&nbsp;<span class="op" id="6114174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114178">fmt</span><span class="op" id="6114181">.</span><span class="ident" id="6114182">Printf</span><span class="op" id="6114188">(</span><span class="ident" id="6114189">format</span><span class="op" id="6114195">,</span>&nbsp;<span class="string" id="6114197">&#34;FAIL&#34;</span><span class="op" id="6114203">,</span>&nbsp;<span class="ident" id="6114205">t</span><span class="op" id="6114206">.</span><span class="ident" id="6114207">name</span><span class="op" id="6114211">,</span>&nbsp;<span class="ident" id="6114213">dstr</span><span class="op" id="6114217">,</span>&nbsp;<span class="ident" id="6114219">t</span><span class="op" id="6114220">.</span><span class="ident" id="6114221">output</span><span class="op" id="6114227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6114230">}</span>&nbsp;<span class="keyword" id="6114232">else</span>&nbsp;<span class="keyword" id="6114237">if</span>&nbsp;<span class="op" id="6114240">*</span><span class="ident" id="6114241">chatty</span>&nbsp;<span class="op" id="6114248">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6114252">if</span>&nbsp;<span class="ident" id="6114255">t</span><span class="op" id="6114256">.</span><span class="ident" id="6114257">Skipped</span><span class="op" id="6114264">(</span><span class="op" id="6114265">)</span>&nbsp;<span class="op" id="6114267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114272">fmt</span><span class="op" id="6114275">.</span><span class="ident" id="6114276">Printf</span><span class="op" id="6114282">(</span><span class="ident" id="6114283">format</span><span class="op" id="6114289">,</span>&nbsp;<span class="string" id="6114291">&#34;SKIP&#34;</span><span class="op" id="6114297">,</span>&nbsp;<span class="ident" id="6114299">t</span><span class="op" id="6114300">.</span><span class="ident" id="6114301">name</span><span class="op" id="6114305">,</span>&nbsp;<span class="ident" id="6114307">dstr</span><span class="op" id="6114311">,</span>&nbsp;<span class="ident" id="6114313">t</span><span class="op" id="6114314">.</span><span class="ident" id="6114315">output</span><span class="op" id="6114321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6114325">}</span>&nbsp;<span class="keyword" id="6114327">else</span>&nbsp;<span class="op" id="6114332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114337">fmt</span><span class="op" id="6114340">.</span><span class="ident" id="6114341">Printf</span><span class="op" id="6114347">(</span><span class="ident" id="6114348">format</span><span class="op" id="6114354">,</span>&nbsp;<span class="string" id="6114356">&#34;PASS&#34;</span><span class="op" id="6114362">,</span>&nbsp;<span class="ident" id="6114364">t</span><span class="op" id="6114365">.</span><span class="ident" id="6114366">name</span><span class="op" id="6114370">,</span>&nbsp;<span class="ident" id="6114372">dstr</span><span class="op" id="6114376">,</span>&nbsp;<span class="ident" id="6114378">t</span><span class="op" id="6114379">.</span><span class="ident" id="6114380">output</span><span class="op" id="6114386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6114390">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6114393">}</span><br>
<span class="lineno"></span><span class="op" id="6114395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6114398">func</span>&nbsp;<span class="ident" id="6114403">RunTests</span><span class="op" id="6114411">(</span><span class="ident" id="6114412">matchString</span>&nbsp;<span class="keyword" id="6114424">func</span><span class="op" id="6114428">(</span><span class="ident" id="6114429">pat</span><span class="op" id="6114432">,</span>&nbsp;<span class="ident" id="6114434">str</span>&nbsp;<span class="builtintype" id="6114438">string</span><span class="op" id="6114444">)</span>&nbsp;<span class="op" id="6114446">(</span><span class="builtintype" id="6114447">bool</span><span class="op" id="6114451">,</span>&nbsp;<span class="builtintype" id="6114453">error</span><span class="op" id="6114458">)</span><span class="op" id="6114459">,</span>&nbsp;<span class="ident" id="6114461">tests</span>&nbsp;<span class="op" id="6114467">[</span><span class="op" id="6114468">]</span><span class="ident" id="6114469">InternalTest</span><span class="op" id="6114481">)</span>&nbsp;<span class="op" id="6114483">(</span><span class="ident" id="6114484">ok</span>&nbsp;<span class="builtintype" id="6114487">bool</span><span class="op" id="6114491">)</span>&nbsp;<span class="op" id="6114493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114496">ok</span>&nbsp;<span class="op" id="6114499">=</span>&nbsp;<span class="builtintype" id="6114501">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6114507">if</span>&nbsp;<span class="builtinfunc" id="6114510">len</span><span class="op" id="6114513">(</span><span class="ident" id="6114514">tests</span><span class="op" id="6114519">)</span>&nbsp;<span class="op" id="6114521">==</span>&nbsp;<span class="num" id="6114524">0</span>&nbsp;<span class="op" id="6114526">&amp;&amp;</span>&nbsp;<span class="op" id="6114529">!</span><span class="ident" id="6114530">haveExamples</span>&nbsp;<span class="op" id="6114543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114547">fmt</span><span class="op" id="6114550">.</span><span class="ident" id="6114551">Fprintln</span><span class="op" id="6114559">(</span><span class="ident" id="6114560">os</span><span class="op" id="6114562">.</span><span class="ident" id="6114563">Stderr</span><span class="op" id="6114569">,</span>&nbsp;<span class="string" id="6114571">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="6114606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6114610">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6114618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6114621">for</span>&nbsp;<span class="ident" id="6114625">_</span><span class="op" id="6114626">,</span>&nbsp;<span class="ident" id="6114628">procs</span>&nbsp;<span class="op" id="6114634">:=</span>&nbsp;<span class="keyword" id="6114637">range</span>&nbsp;<span class="ident" id="6114643">cpuList</span>&nbsp;<span class="op" id="6114651">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6114655">runtime</span><span class="op" id="6114662">.</span><span class="ident" id="6114663">GOMAXPROCS</span><span class="op" id="6114673">(</span><span class="ident" id="6114674">procs</span><span class="op" id="6114679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6114683">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6114742">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6114825">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6114898">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6114986">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115017">var</span>&nbsp;<span class="ident" id="6115021">collector</span>&nbsp;<span class="op" id="6115031">=</span>&nbsp;<span class="builtinfunc" id="6115033">make</span><span class="op" id="6115037">(</span><span class="keyword" id="6115038">chan</span>&nbsp;<span class="keyword" id="6115043">interface</span><span class="op" id="6115052">{</span><span class="op" id="6115053">}</span><span class="op" id="6115054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115059">numParallel</span>&nbsp;<span class="op" id="6115071">:=</span>&nbsp;<span class="num" id="6115074">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115078">startParallel</span>&nbsp;<span class="op" id="6115092">:=</span>&nbsp;<span class="builtinfunc" id="6115095">make</span><span class="op" id="6115099">(</span><span class="keyword" id="6115100">chan</span>&nbsp;<span class="builtintype" id="6115105">bool</span><span class="op" id="6115109">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115114">for</span>&nbsp;<span class="ident" id="6115118">i</span>&nbsp;<span class="op" id="6115120">:=</span>&nbsp;<span class="num" id="6115123">0</span><span class="op" id="6115124">;</span>&nbsp;<span class="ident" id="6115126">i</span>&nbsp;<span class="op" id="6115128">&lt;</span>&nbsp;<span class="builtinfunc" id="6115130">len</span><span class="op" id="6115133">(</span><span class="ident" id="6115134">tests</span><span class="op" id="6115139">)</span><span class="op" id="6115140">;</span>&nbsp;<span class="ident" id="6115142">i</span><span class="op" id="6115143">++</span>&nbsp;<span class="op" id="6115146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115151">matched</span><span class="op" id="6115158">,</span>&nbsp;<span class="ident" id="6115160">err</span>&nbsp;<span class="op" id="6115164">:=</span>&nbsp;<span class="ident" id="6115167">matchString</span><span class="op" id="6115178">(</span><span class="op" id="6115179">*</span><span class="ident" id="6115180">match</span><span class="op" id="6115185">,</span>&nbsp;<span class="ident" id="6115187">tests</span><span class="op" id="6115192">[</span><span class="ident" id="6115193">i</span><span class="op" id="6115194">]</span><span class="op" id="6115195">.</span><span class="ident" id="6115196">Name</span><span class="op" id="6115200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115205">if</span>&nbsp;<span class="ident" id="6115208">err</span>&nbsp;<span class="op" id="6115212">!=</span>&nbsp;<span class="ident" id="6115215">nil</span>&nbsp;<span class="op" id="6115219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115225">fmt</span><span class="op" id="6115228">.</span><span class="ident" id="6115229">Fprintf</span><span class="op" id="6115236">(</span><span class="ident" id="6115237">os</span><span class="op" id="6115239">.</span><span class="ident" id="6115240">Stderr</span><span class="op" id="6115246">,</span>&nbsp;<span class="string" id="6115248">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="6115293">,</span>&nbsp;<span class="ident" id="6115295">err</span><span class="op" id="6115298">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115304">os</span><span class="op" id="6115306">.</span><span class="ident" id="6115307">Exit</span><span class="op" id="6115311">(</span><span class="num" id="6115312">1</span><span class="op" id="6115313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115323">if</span>&nbsp;<span class="op" id="6115326">!</span><span class="ident" id="6115327">matched</span>&nbsp;<span class="op" id="6115335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115341">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115353">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115358">testName</span>&nbsp;<span class="op" id="6115367">:=</span>&nbsp;<span class="ident" id="6115370">tests</span><span class="op" id="6115375">[</span><span class="ident" id="6115376">i</span><span class="op" id="6115377">]</span><span class="op" id="6115378">.</span><span class="ident" id="6115379">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115387">if</span>&nbsp;<span class="ident" id="6115390">procs</span>&nbsp;<span class="op" id="6115396">!=</span>&nbsp;<span class="num" id="6115399">1</span>&nbsp;<span class="op" id="6115401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115407">testName</span>&nbsp;<span class="op" id="6115416">=</span>&nbsp;<span class="ident" id="6115418">fmt</span><span class="op" id="6115421">.</span><span class="ident" id="6115422">Sprintf</span><span class="op" id="6115429">(</span><span class="string" id="6115430">&#34;%s-%d&#34;</span><span class="op" id="6115437">,</span>&nbsp;<span class="ident" id="6115439">tests</span><span class="op" id="6115444">[</span><span class="ident" id="6115445">i</span><span class="op" id="6115446">]</span><span class="op" id="6115447">.</span><span class="ident" id="6115448">Name</span><span class="op" id="6115452">,</span>&nbsp;<span class="ident" id="6115454">procs</span><span class="op" id="6115459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115469">t</span>&nbsp;<span class="op" id="6115471">:=</span>&nbsp;<span class="op" id="6115474">&amp;</span><span class="ident" id="6115475">T</span><span class="op" id="6115476">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115482">common</span><span class="op" id="6115488">:</span>&nbsp;<span class="ident" id="6115490">common</span><span class="op" id="6115496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115503">signal</span><span class="op" id="6115509">:</span>&nbsp;<span class="builtinfunc" id="6115511">make</span><span class="op" id="6115515">(</span><span class="keyword" id="6115516">chan</span>&nbsp;<span class="keyword" id="6115521">interface</span><span class="op" id="6115530">{</span><span class="op" id="6115531">}</span><span class="op" id="6115532">)</span><span class="op" id="6115533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115539">}</span><span class="op" id="6115540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115546">name</span><span class="op" id="6115550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115561">testName</span><span class="op" id="6115569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115575">startParallel</span><span class="op" id="6115588">:</span>&nbsp;<span class="ident" id="6115590">startParallel</span><span class="op" id="6115603">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115613">t</span><span class="op" id="6115614">.</span><span class="ident" id="6115615">self</span>&nbsp;<span class="op" id="6115620">=</span>&nbsp;<span class="ident" id="6115622">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115627">if</span>&nbsp;<span class="op" id="6115630">*</span><span class="ident" id="6115631">chatty</span>&nbsp;<span class="op" id="6115638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115644">fmt</span><span class="op" id="6115647">.</span><span class="ident" id="6115648">Printf</span><span class="op" id="6115654">(</span><span class="string" id="6115655">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="6115669">,</span>&nbsp;<span class="ident" id="6115671">t</span><span class="op" id="6115672">.</span><span class="ident" id="6115673">name</span><span class="op" id="6115677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115682">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115687">go</span>&nbsp;<span class="ident" id="6115690">tRunner</span><span class="op" id="6115697">(</span><span class="ident" id="6115698">t</span><span class="op" id="6115699">,</span>&nbsp;<span class="op" id="6115701">&amp;</span><span class="ident" id="6115702">tests</span><span class="op" id="6115707">[</span><span class="ident" id="6115708">i</span><span class="op" id="6115709">]</span><span class="op" id="6115710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115715">out</span>&nbsp;<span class="op" id="6115719">:=</span>&nbsp;<span class="op" id="6115722">(</span><span class="op" id="6115723">&lt;-</span><span class="ident" id="6115725">t</span><span class="op" id="6115726">.</span><span class="ident" id="6115727">signal</span><span class="op" id="6115733">)</span><span class="op" id="6115734">.</span><span class="op" id="6115735">(</span><span class="op" id="6115736">*</span><span class="ident" id="6115737">T</span><span class="op" id="6115738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115743">if</span>&nbsp;<span class="ident" id="6115746">out</span>&nbsp;<span class="op" id="6115750">==</span>&nbsp;<span class="ident" id="6115753">nil</span>&nbsp;<span class="op" id="6115757">{</span>&nbsp;<span class="comment" id="6115759">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115780">go</span>&nbsp;<span class="keyword" id="6115783">func</span><span class="op" id="6115787">(</span><span class="op" id="6115788">)</span>&nbsp;<span class="op" id="6115790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115797">collector</span>&nbsp;<span class="op" id="6115807">&lt;-</span>&nbsp;<span class="op" id="6115810">&lt;-</span><span class="ident" id="6115812">t</span><span class="op" id="6115813">.</span><span class="ident" id="6115814">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115825">}</span><span class="op" id="6115826">(</span><span class="op" id="6115827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115833">numParallel</span><span class="op" id="6115844">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115851">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115868">t</span><span class="op" id="6115869">.</span><span class="ident" id="6115870">report</span><span class="op" id="6115876">(</span><span class="op" id="6115877">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115882">ok</span>&nbsp;<span class="op" id="6115885">=</span>&nbsp;<span class="ident" id="6115887">ok</span>&nbsp;<span class="op" id="6115890">&amp;&amp;</span>&nbsp;<span class="op" id="6115893">!</span><span class="ident" id="6115894">out</span><span class="op" id="6115897">.</span><span class="ident" id="6115898">Failed</span><span class="op" id="6115904">(</span><span class="op" id="6115905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6115909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6115914">running</span>&nbsp;<span class="op" id="6115922">:=</span>&nbsp;<span class="num" id="6115925">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115929">for</span>&nbsp;<span class="ident" id="6115933">numParallel</span><span class="op" id="6115944">+</span><span class="ident" id="6115945">running</span>&nbsp;<span class="op" id="6115953">&gt;</span>&nbsp;<span class="num" id="6115955">0</span>&nbsp;<span class="op" id="6115957">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6115962">if</span>&nbsp;<span class="ident" id="6115965">running</span>&nbsp;<span class="op" id="6115973">&lt;</span>&nbsp;<span class="op" id="6115975">*</span><span class="ident" id="6115976">parallel</span>&nbsp;<span class="op" id="6115985">&amp;&amp;</span>&nbsp;<span class="ident" id="6115988">numParallel</span>&nbsp;<span class="op" id="6116000">&gt;</span>&nbsp;<span class="num" id="6116002">0</span>&nbsp;<span class="op" id="6116004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116010">startParallel</span>&nbsp;<span class="op" id="6116024">&lt;-</span>&nbsp;<span class="builtintype" id="6116027">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116036">running</span><span class="op" id="6116043">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116050">numParallel</span><span class="op" id="6116061">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116068">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116085">t</span>&nbsp;<span class="op" id="6116087">:=</span>&nbsp;<span class="op" id="6116090">(</span><span class="op" id="6116091">&lt;-</span><span class="ident" id="6116093">collector</span><span class="op" id="6116102">)</span><span class="op" id="6116103">.</span><span class="op" id="6116104">(</span><span class="op" id="6116105">*</span><span class="ident" id="6116106">T</span><span class="op" id="6116107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116112">t</span><span class="op" id="6116113">.</span><span class="ident" id="6116114">report</span><span class="op" id="6116120">(</span><span class="op" id="6116121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116126">ok</span>&nbsp;<span class="op" id="6116129">=</span>&nbsp;<span class="ident" id="6116131">ok</span>&nbsp;<span class="op" id="6116134">&amp;&amp;</span>&nbsp;<span class="op" id="6116137">!</span><span class="ident" id="6116138">t</span><span class="op" id="6116139">.</span><span class="ident" id="6116140">Failed</span><span class="op" id="6116146">(</span><span class="op" id="6116147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116152">running</span><span class="op" id="6116159">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116170">return</span><br>
<span class="lineno"></span><span class="op" id="6116177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="6116180">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6116215">func</span>&nbsp;<span class="ident" id="6116220">before</span><span class="op" id="6116226">(</span><span class="op" id="6116227">)</span>&nbsp;<span class="op" id="6116229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116232">if</span>&nbsp;<span class="op" id="6116235">*</span><span class="ident" id="6116236">memProfileRate</span>&nbsp;<span class="op" id="6116251">&gt;</span>&nbsp;<span class="num" id="6116253">0</span>&nbsp;<span class="op" id="6116255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116259">runtime</span><span class="op" id="6116266">.</span><span class="ident" id="6116267">MemProfileRate</span>&nbsp;<span class="op" id="6116282">=</span>&nbsp;<span class="op" id="6116284">*</span><span class="ident" id="6116285">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116301">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116304">if</span>&nbsp;<span class="op" id="6116307">*</span><span class="ident" id="6116308">cpuProfile</span>&nbsp;<span class="op" id="6116319">!=</span>&nbsp;<span class="string" id="6116322">&#34;&#34;</span>&nbsp;<span class="op" id="6116325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116329">f</span><span class="op" id="6116330">,</span>&nbsp;<span class="ident" id="6116332">err</span>&nbsp;<span class="op" id="6116336">:=</span>&nbsp;<span class="ident" id="6116339">os</span><span class="op" id="6116341">.</span><span class="ident" id="6116342">Create</span><span class="op" id="6116348">(</span><span class="ident" id="6116349">toOutputDir</span><span class="op" id="6116360">(</span><span class="op" id="6116361">*</span><span class="ident" id="6116362">cpuProfile</span><span class="op" id="6116372">)</span><span class="op" id="6116373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116377">if</span>&nbsp;<span class="ident" id="6116380">err</span>&nbsp;<span class="op" id="6116384">!=</span>&nbsp;<span class="ident" id="6116387">nil</span>&nbsp;<span class="op" id="6116391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116396">fmt</span><span class="op" id="6116399">.</span><span class="ident" id="6116400">Fprintf</span><span class="op" id="6116407">(</span><span class="ident" id="6116408">os</span><span class="op" id="6116410">.</span><span class="ident" id="6116411">Stderr</span><span class="op" id="6116417">,</span>&nbsp;<span class="string" id="6116419">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="6116432">,</span>&nbsp;<span class="ident" id="6116434">err</span><span class="op" id="6116437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116442">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116455">if</span>&nbsp;<span class="ident" id="6116458">err</span>&nbsp;<span class="op" id="6116462">:=</span>&nbsp;<span class="ident" id="6116465">pprof</span><span class="op" id="6116470">.</span><span class="ident" id="6116471">StartCPUProfile</span><span class="op" id="6116486">(</span><span class="ident" id="6116487">f</span><span class="op" id="6116488">)</span><span class="op" id="6116489">;</span>&nbsp;<span class="ident" id="6116491">err</span>&nbsp;<span class="op" id="6116495">!=</span>&nbsp;<span class="ident" id="6116498">nil</span>&nbsp;<span class="op" id="6116502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116507">fmt</span><span class="op" id="6116510">.</span><span class="ident" id="6116511">Fprintf</span><span class="op" id="6116518">(</span><span class="ident" id="6116519">os</span><span class="op" id="6116521">.</span><span class="ident" id="6116522">Stderr</span><span class="op" id="6116528">,</span>&nbsp;<span class="string" id="6116530">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="6116568">,</span>&nbsp;<span class="ident" id="6116570">err</span><span class="op" id="6116573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116578">f</span><span class="op" id="6116579">.</span><span class="ident" id="6116580">Close</span><span class="op" id="6116585">(</span><span class="op" id="6116586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116591">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6116604">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116673">if</span>&nbsp;<span class="op" id="6116676">*</span><span class="ident" id="6116677">blockProfile</span>&nbsp;<span class="op" id="6116690">!=</span>&nbsp;<span class="string" id="6116693">&#34;&#34;</span>&nbsp;<span class="op" id="6116696">&amp;&amp;</span>&nbsp;<span class="op" id="6116699">*</span><span class="ident" id="6116700">blockProfileRate</span>&nbsp;<span class="op" id="6116717">&gt;=</span>&nbsp;<span class="num" id="6116720">0</span>&nbsp;<span class="op" id="6116722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116726">runtime</span><span class="op" id="6116733">.</span><span class="ident" id="6116734">SetBlockProfileRate</span><span class="op" id="6116753">(</span><span class="op" id="6116754">*</span><span class="ident" id="6116755">blockProfileRate</span><span class="op" id="6116771">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6116777">if</span>&nbsp;<span class="op" id="6116780">*</span><span class="ident" id="6116781">coverProfile</span>&nbsp;<span class="op" id="6116794">!=</span>&nbsp;<span class="string" id="6116797">&#34;&#34;</span>&nbsp;<span class="op" id="6116800">&amp;&amp;</span>&nbsp;<span class="ident" id="6116803">cover</span><span class="op" id="6116808">.</span><span class="ident" id="6116809">Mode</span>&nbsp;<span class="op" id="6116814">==</span>&nbsp;<span class="string" id="6116817">&#34;&#34;</span>&nbsp;<span class="op" id="6116820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116824">fmt</span><span class="op" id="6116827">.</span><span class="ident" id="6116828">Fprintf</span><span class="op" id="6116835">(</span><span class="ident" id="6116836">os</span><span class="op" id="6116838">.</span><span class="ident" id="6116839">Stderr</span><span class="op" id="6116845">,</span>&nbsp;<span class="string" id="6116847">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="6116945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6116949">os</span><span class="op" id="6116951">.</span><span class="ident" id="6116952">Exit</span><span class="op" id="6116956">(</span><span class="num" id="6116957">2</span><span class="op" id="6116958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6116961">}</span><br>
<span class="lineno">610</span><span class="op" id="6116963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6116966">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6116999">func</span>&nbsp;<span class="ident" id="6117004">after</span><span class="op" id="6117009">(</span><span class="op" id="6117010">)</span>&nbsp;<span class="op" id="6117012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117015">if</span>&nbsp;<span class="op" id="6117018">*</span><span class="ident" id="6117019">cpuProfile</span>&nbsp;<span class="op" id="6117030">!=</span>&nbsp;<span class="string" id="6117033">&#34;&#34;</span>&nbsp;<span class="op" id="6117036">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117040">pprof</span><span class="op" id="6117045">.</span><span class="ident" id="6117046">StopCPUProfile</span><span class="op" id="6117060">(</span><span class="op" id="6117061">)</span>&nbsp;<span class="comment" id="6117063">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117094">if</span>&nbsp;<span class="op" id="6117097">*</span><span class="ident" id="6117098">memProfile</span>&nbsp;<span class="op" id="6117109">!=</span>&nbsp;<span class="string" id="6117112">&#34;&#34;</span>&nbsp;<span class="op" id="6117115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117119">f</span><span class="op" id="6117120">,</span>&nbsp;<span class="ident" id="6117122">err</span>&nbsp;<span class="op" id="6117126">:=</span>&nbsp;<span class="ident" id="6117129">os</span><span class="op" id="6117131">.</span><span class="ident" id="6117132">Create</span><span class="op" id="6117138">(</span><span class="ident" id="6117139">toOutputDir</span><span class="op" id="6117150">(</span><span class="op" id="6117151">*</span><span class="ident" id="6117152">memProfile</span><span class="op" id="6117162">)</span><span class="op" id="6117163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117167">if</span>&nbsp;<span class="ident" id="6117170">err</span>&nbsp;<span class="op" id="6117174">!=</span>&nbsp;<span class="ident" id="6117177">nil</span>&nbsp;<span class="op" id="6117181">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117186">fmt</span><span class="op" id="6117189">.</span><span class="ident" id="6117190">Fprintf</span><span class="op" id="6117197">(</span><span class="ident" id="6117198">os</span><span class="op" id="6117200">.</span><span class="ident" id="6117201">Stderr</span><span class="op" id="6117207">,</span>&nbsp;<span class="string" id="6117209">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6117224">,</span>&nbsp;<span class="ident" id="6117226">err</span><span class="op" id="6117229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117234">os</span><span class="op" id="6117236">.</span><span class="ident" id="6117237">Exit</span><span class="op" id="6117241">(</span><span class="num" id="6117242">2</span><span class="op" id="6117243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117251">runtime</span><span class="op" id="6117258">.</span><span class="ident" id="6117259">GC</span><span class="op" id="6117261">(</span><span class="op" id="6117262">)</span>&nbsp;<span class="comment" id="6117264">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117296">if</span>&nbsp;<span class="ident" id="6117299">err</span>&nbsp;<span class="op" id="6117303">=</span>&nbsp;<span class="ident" id="6117305">pprof</span><span class="op" id="6117310">.</span><span class="ident" id="6117311">WriteHeapProfile</span><span class="op" id="6117327">(</span><span class="ident" id="6117328">f</span><span class="op" id="6117329">)</span><span class="op" id="6117330">;</span>&nbsp;<span class="ident" id="6117332">err</span>&nbsp;<span class="op" id="6117336">!=</span>&nbsp;<span class="ident" id="6117339">nil</span>&nbsp;<span class="op" id="6117343">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117348">fmt</span><span class="op" id="6117351">.</span><span class="ident" id="6117352">Fprintf</span><span class="op" id="6117359">(</span><span class="ident" id="6117360">os</span><span class="op" id="6117362">.</span><span class="ident" id="6117363">Stderr</span><span class="op" id="6117369">,</span>&nbsp;<span class="string" id="6117371">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6117402">,</span>&nbsp;<span class="op" id="6117404">*</span><span class="ident" id="6117405">memProfile</span><span class="op" id="6117415">,</span>&nbsp;<span class="ident" id="6117417">err</span><span class="op" id="6117420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117425">os</span><span class="op" id="6117427">.</span><span class="ident" id="6117428">Exit</span><span class="op" id="6117432">(</span><span class="num" id="6117433">2</span><span class="op" id="6117434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117442">f</span><span class="op" id="6117443">.</span><span class="ident" id="6117444">Close</span><span class="op" id="6117449">(</span><span class="op" id="6117450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117453">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117456">if</span>&nbsp;<span class="op" id="6117459">*</span><span class="ident" id="6117460">blockProfile</span>&nbsp;<span class="op" id="6117473">!=</span>&nbsp;<span class="string" id="6117476">&#34;&#34;</span>&nbsp;<span class="op" id="6117479">&amp;&amp;</span>&nbsp;<span class="op" id="6117482">*</span><span class="ident" id="6117483">blockProfileRate</span>&nbsp;<span class="op" id="6117500">&gt;=</span>&nbsp;<span class="num" id="6117503">0</span>&nbsp;<span class="op" id="6117505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117509">f</span><span class="op" id="6117510">,</span>&nbsp;<span class="ident" id="6117512">err</span>&nbsp;<span class="op" id="6117516">:=</span>&nbsp;<span class="ident" id="6117519">os</span><span class="op" id="6117521">.</span><span class="ident" id="6117522">Create</span><span class="op" id="6117528">(</span><span class="ident" id="6117529">toOutputDir</span><span class="op" id="6117540">(</span><span class="op" id="6117541">*</span><span class="ident" id="6117542">blockProfile</span><span class="op" id="6117554">)</span><span class="op" id="6117555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117559">if</span>&nbsp;<span class="ident" id="6117562">err</span>&nbsp;<span class="op" id="6117566">!=</span>&nbsp;<span class="ident" id="6117569">nil</span>&nbsp;<span class="op" id="6117573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117578">fmt</span><span class="op" id="6117581">.</span><span class="ident" id="6117582">Fprintf</span><span class="op" id="6117589">(</span><span class="ident" id="6117590">os</span><span class="op" id="6117592">.</span><span class="ident" id="6117593">Stderr</span><span class="op" id="6117599">,</span>&nbsp;<span class="string" id="6117601">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6117616">,</span>&nbsp;<span class="ident" id="6117618">err</span><span class="op" id="6117621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117626">os</span><span class="op" id="6117628">.</span><span class="ident" id="6117629">Exit</span><span class="op" id="6117633">(</span><span class="num" id="6117634">2</span><span class="op" id="6117635">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117643">if</span>&nbsp;<span class="ident" id="6117646">err</span>&nbsp;<span class="op" id="6117650">=</span>&nbsp;<span class="ident" id="6117652">pprof</span><span class="op" id="6117657">.</span><span class="ident" id="6117658">Lookup</span><span class="op" id="6117664">(</span><span class="string" id="6117665">&#34;block&#34;</span><span class="op" id="6117672">)</span><span class="op" id="6117673">.</span><span class="ident" id="6117674">WriteTo</span><span class="op" id="6117681">(</span><span class="ident" id="6117682">f</span><span class="op" id="6117683">,</span>&nbsp;<span class="num" id="6117685">0</span><span class="op" id="6117686">)</span><span class="op" id="6117687">;</span>&nbsp;<span class="ident" id="6117689">err</span>&nbsp;<span class="op" id="6117693">!=</span>&nbsp;<span class="ident" id="6117696">nil</span>&nbsp;<span class="op" id="6117700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117705">fmt</span><span class="op" id="6117708">.</span><span class="ident" id="6117709">Fprintf</span><span class="op" id="6117716">(</span><span class="ident" id="6117717">os</span><span class="op" id="6117719">.</span><span class="ident" id="6117720">Stderr</span><span class="op" id="6117726">,</span>&nbsp;<span class="string" id="6117728">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6117759">,</span>&nbsp;<span class="op" id="6117761">*</span><span class="ident" id="6117762">blockProfile</span><span class="op" id="6117774">,</span>&nbsp;<span class="ident" id="6117776">err</span><span class="op" id="6117779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117784">os</span><span class="op" id="6117786">.</span><span class="ident" id="6117787">Exit</span><span class="op" id="6117791">(</span><span class="num" id="6117792">2</span><span class="op" id="6117793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117797">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117801">f</span><span class="op" id="6117802">.</span><span class="ident" id="6117803">Close</span><span class="op" id="6117808">(</span><span class="op" id="6117809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6117815">if</span>&nbsp;<span class="ident" id="6117818">cover</span><span class="op" id="6117823">.</span><span class="ident" id="6117824">Mode</span>&nbsp;<span class="op" id="6117829">!=</span>&nbsp;<span class="string" id="6117832">&#34;&#34;</span>&nbsp;<span class="op" id="6117835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6117839">coverReport</span><span class="op" id="6117850">(</span><span class="op" id="6117851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6117854">}</span><br>
<span class="lineno">645</span><span class="op" id="6117856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6117859">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="6117934">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="6117994">func</span>&nbsp;<span class="ident" id="6117999">toOutputDir</span><span class="op" id="6118010">(</span><span class="ident" id="6118011">path</span>&nbsp;<span class="builtintype" id="6118016">string</span><span class="op" id="6118022">)</span>&nbsp;<span class="builtintype" id="6118024">string</span>&nbsp;<span class="op" id="6118031">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118034">if</span>&nbsp;<span class="op" id="6118037">*</span><span class="ident" id="6118038">outputDir</span>&nbsp;<span class="op" id="6118048">==</span>&nbsp;<span class="string" id="6118051">&#34;&#34;</span>&nbsp;<span class="op" id="6118054">||</span>&nbsp;<span class="ident" id="6118057">path</span>&nbsp;<span class="op" id="6118062">==</span>&nbsp;<span class="string" id="6118065">&#34;&#34;</span>&nbsp;<span class="op" id="6118068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118072">return</span>&nbsp;<span class="ident" id="6118079">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6118085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118088">if</span>&nbsp;<span class="ident" id="6118091">runtime</span><span class="op" id="6118098">.</span><span class="ident" id="6118099">GOOS</span>&nbsp;<span class="op" id="6118104">==</span>&nbsp;<span class="string" id="6118107">&#34;windows&#34;</span>&nbsp;<span class="op" id="6118117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118121">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118187">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118240">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118303">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118372">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118431">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118500">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118538">if</span>&nbsp;<span class="builtinfunc" id="6118541">len</span><span class="op" id="6118544">(</span><span class="ident" id="6118545">path</span><span class="op" id="6118549">)</span>&nbsp;<span class="op" id="6118551">&gt;=</span>&nbsp;<span class="num" id="6118554">2</span>&nbsp;<span class="op" id="6118556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6118561">letter</span><span class="op" id="6118567">,</span>&nbsp;<span class="ident" id="6118569">colon</span>&nbsp;<span class="op" id="6118575">:=</span>&nbsp;<span class="ident" id="6118578">path</span><span class="op" id="6118582">[</span><span class="num" id="6118583">0</span><span class="op" id="6118584">]</span><span class="op" id="6118585">,</span>&nbsp;<span class="ident" id="6118587">path</span><span class="op" id="6118591">[</span><span class="num" id="6118592">1</span><span class="op" id="6118593">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118598">if</span>&nbsp;<span class="op" id="6118601">(</span><span class="string" id="6118602">&#39;a&#39;</span>&nbsp;<span class="op" id="6118606">&lt;=</span>&nbsp;<span class="ident" id="6118609">letter</span>&nbsp;<span class="op" id="6118616">&amp;&amp;</span>&nbsp;<span class="ident" id="6118619">letter</span>&nbsp;<span class="op" id="6118626">&lt;=</span>&nbsp;<span class="string" id="6118629">&#39;z&#39;</span>&nbsp;<span class="op" id="6118633">||</span>&nbsp;<span class="string" id="6118636">&#39;A&#39;</span>&nbsp;<span class="op" id="6118640">&lt;=</span>&nbsp;<span class="ident" id="6118643">letter</span>&nbsp;<span class="op" id="6118650">&amp;&amp;</span>&nbsp;<span class="ident" id="6118653">letter</span>&nbsp;<span class="op" id="6118660">&lt;=</span>&nbsp;<span class="string" id="6118663">&#39;Z&#39;</span><span class="op" id="6118666">)</span>&nbsp;<span class="op" id="6118668">&amp;&amp;</span>&nbsp;<span class="ident" id="6118671">colon</span>&nbsp;<span class="op" id="6118677">==</span>&nbsp;<span class="string" id="6118680">&#39;:&#39;</span>&nbsp;<span class="op" id="6118684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6118690">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118764">return</span>&nbsp;<span class="ident" id="6118771">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6118779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6118783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6118786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118789">if</span>&nbsp;<span class="ident" id="6118792">os</span><span class="op" id="6118794">.</span><span class="ident" id="6118795">IsPathSeparator</span><span class="op" id="6118810">(</span><span class="ident" id="6118811">path</span><span class="op" id="6118815">[</span><span class="num" id="6118816">0</span><span class="op" id="6118817">]</span><span class="op" id="6118818">)</span>&nbsp;<span class="op" id="6118820">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118824">return</span>&nbsp;<span class="ident" id="6118831">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6118837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118840">return</span>&nbsp;<span class="ident" id="6118847">fmt</span><span class="op" id="6118850">.</span><span class="ident" id="6118851">Sprintf</span><span class="op" id="6118858">(</span><span class="string" id="6118859">&#34;%s%c%s&#34;</span><span class="op" id="6118867">,</span>&nbsp;<span class="op" id="6118869">*</span><span class="ident" id="6118870">outputDir</span><span class="op" id="6118879">,</span>&nbsp;<span class="ident" id="6118881">os</span><span class="op" id="6118883">.</span><span class="ident" id="6118884">PathSeparator</span><span class="op" id="6118897">,</span>&nbsp;<span class="ident" id="6118899">path</span><span class="op" id="6118903">)</span><br>
<span class="lineno"></span><span class="op" id="6118905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6118908">var</span>&nbsp;<span class="ident" id="6118912">timer</span>&nbsp;<span class="op" id="6118918">*</span><span class="ident" id="6118919">time</span><span class="op" id="6118923">.</span><span class="ident" id="6118924">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6118931">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6118975">func</span>&nbsp;<span class="ident" id="6118980">startAlarm</span><span class="op" id="6118990">(</span><span class="op" id="6118991">)</span>&nbsp;<span class="op" id="6118993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6118996">if</span>&nbsp;<span class="op" id="6118999">*</span><span class="ident" id="6119000">timeout</span>&nbsp;<span class="op" id="6119008">&gt;</span>&nbsp;<span class="num" id="6119010">0</span>&nbsp;<span class="op" id="6119012">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119016">timer</span>&nbsp;<span class="op" id="6119022">=</span>&nbsp;<span class="ident" id="6119024">time</span><span class="op" id="6119028">.</span><span class="ident" id="6119029">AfterFunc</span><span class="op" id="6119038">(</span><span class="op" id="6119039">*</span><span class="ident" id="6119040">timeout</span><span class="op" id="6119047">,</span>&nbsp;<span class="keyword" id="6119049">func</span><span class="op" id="6119053">(</span><span class="op" id="6119054">)</span>&nbsp;<span class="op" id="6119056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6119061">panic</span><span class="op" id="6119066">(</span><span class="ident" id="6119067">fmt</span><span class="op" id="6119070">.</span><span class="ident" id="6119071">Sprintf</span><span class="op" id="6119078">(</span><span class="string" id="6119079">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="6119104">,</span>&nbsp;<span class="op" id="6119106">*</span><span class="ident" id="6119107">timeout</span><span class="op" id="6119114">)</span><span class="op" id="6119115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6119119">}</span><span class="op" id="6119120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6119123">}</span><br>
<span class="lineno"></span><span class="op" id="6119125">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="6119128">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="6119162">func</span>&nbsp;<span class="ident" id="6119167">stopAlarm</span><span class="op" id="6119176">(</span><span class="op" id="6119177">)</span>&nbsp;<span class="op" id="6119179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6119182">if</span>&nbsp;<span class="op" id="6119185">*</span><span class="ident" id="6119186">timeout</span>&nbsp;<span class="op" id="6119194">&gt;</span>&nbsp;<span class="num" id="6119196">0</span>&nbsp;<span class="op" id="6119198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119202">timer</span><span class="op" id="6119207">.</span><span class="ident" id="6119208">Stop</span><span class="op" id="6119212">(</span><span class="op" id="6119213">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6119216">}</span><br>
<span class="lineno"></span><span class="op" id="6119218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6119221">func</span>&nbsp;<span class="ident" id="6119226">parseCpuList</span><span class="op" id="6119238">(</span><span class="op" id="6119239">)</span>&nbsp;<span class="op" id="6119241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6119244">for</span>&nbsp;<span class="ident" id="6119248">_</span><span class="op" id="6119249">,</span>&nbsp;<span class="ident" id="6119251">val</span>&nbsp;<span class="op" id="6119255">:=</span>&nbsp;<span class="keyword" id="6119258">range</span>&nbsp;<span class="ident" id="6119264">strings</span><span class="op" id="6119271">.</span><span class="ident" id="6119272">Split</span><span class="op" id="6119277">(</span><span class="op" id="6119278">*</span><span class="ident" id="6119279">cpuListStr</span><span class="op" id="6119289">,</span>&nbsp;<span class="string" id="6119291">&#34;,&#34;</span><span class="op" id="6119294">)</span>&nbsp;<span class="op" id="6119296">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119300">val</span>&nbsp;<span class="op" id="6119304">=</span>&nbsp;<span class="ident" id="6119306">strings</span><span class="op" id="6119313">.</span><span class="ident" id="6119314">TrimSpace</span><span class="op" id="6119323">(</span><span class="ident" id="6119324">val</span><span class="op" id="6119327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6119331">if</span>&nbsp;<span class="ident" id="6119334">val</span>&nbsp;<span class="op" id="6119338">==</span>&nbsp;<span class="string" id="6119341">&#34;&#34;</span>&nbsp;<span class="op" id="6119344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6119349">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6119360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119364">cpu</span><span class="op" id="6119367">,</span>&nbsp;<span class="ident" id="6119369">err</span>&nbsp;<span class="op" id="6119373">:=</span>&nbsp;<span class="ident" id="6119376">strconv</span><span class="op" id="6119383">.</span><span class="ident" id="6119384">Atoi</span><span class="op" id="6119388">(</span><span class="ident" id="6119389">val</span><span class="op" id="6119392">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6119396">if</span>&nbsp;<span class="ident" id="6119399">err</span>&nbsp;<span class="op" id="6119403">!=</span>&nbsp;<span class="ident" id="6119406">nil</span>&nbsp;<span class="op" id="6119410">||</span>&nbsp;<span class="ident" id="6119413">cpu</span>&nbsp;<span class="op" id="6119417">&lt;=</span>&nbsp;<span class="num" id="6119420">0</span>&nbsp;<span class="op" id="6119422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119427">fmt</span><span class="op" id="6119430">.</span><span class="ident" id="6119431">Fprintf</span><span class="op" id="6119438">(</span><span class="ident" id="6119439">os</span><span class="op" id="6119441">.</span><span class="ident" id="6119442">Stderr</span><span class="op" id="6119448">,</span>&nbsp;<span class="string" id="6119450">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="6119493">,</span>&nbsp;<span class="ident" id="6119495">val</span><span class="op" id="6119498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119503">os</span><span class="op" id="6119505">.</span><span class="ident" id="6119506">Exit</span><span class="op" id="6119510">(</span><span class="num" id="6119511">1</span><span class="op" id="6119512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6119516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119520">cpuList</span>&nbsp;<span class="op" id="6119528">=</span>&nbsp;<span class="builtinfunc" id="6119530">append</span><span class="op" id="6119536">(</span><span class="ident" id="6119537">cpuList</span><span class="op" id="6119544">,</span>&nbsp;<span class="ident" id="6119546">cpu</span><span class="op" id="6119549">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6119552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6119555">if</span>&nbsp;<span class="ident" id="6119558">cpuList</span>&nbsp;<span class="op" id="6119566">==</span>&nbsp;<span class="ident" id="6119569">nil</span>&nbsp;<span class="op" id="6119573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119577">cpuList</span>&nbsp;<span class="op" id="6119585">=</span>&nbsp;<span class="builtinfunc" id="6119587">append</span><span class="op" id="6119593">(</span><span class="ident" id="6119594">cpuList</span><span class="op" id="6119601">,</span>&nbsp;<span class="ident" id="6119603">runtime</span><span class="op" id="6119610">.</span><span class="ident" id="6119611">GOMAXPROCS</span><span class="op" id="6119621">(</span><span class="op" id="6119622">-</span><span class="num" id="6119623">1</span><span class="op" id="6119624">)</span><span class="op" id="6119625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6119628">}</span><br>
<span class="lineno"></span><span class="op" id="6119630">}</span>
</div>
</body>
</html>
