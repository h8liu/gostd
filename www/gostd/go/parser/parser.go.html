<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5724486">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5724541">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5724595">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5724646">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5724718">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5724792">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5724867">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5724925">//</span><br>
<span class="lineno">10</span><span class="keyword" id="5724928">package</span>&nbsp;<span class="ident" id="5724936">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5724944">import</span>&nbsp;<span class="op" id="5724951">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5724954">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5724961">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5724971">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5724985">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5724997">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5725008">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5725019">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5725029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5725032">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5725091">type</span>&nbsp;<span class="ident" id="5725096">parser</span>&nbsp;<span class="keyword" id="5725103">struct</span>&nbsp;<span class="op" id="5725110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725113">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5725121">*</span><span class="ident" id="5725122">token</span><span class="op" id="5725127">.</span><span class="ident" id="5725128">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725134">errors</span>&nbsp;&nbsp;<span class="ident" id="5725142">scanner</span><span class="op" id="5725149">.</span><span class="ident" id="5725150">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725161">scanner</span>&nbsp;<span class="ident" id="5725169">scanner</span><span class="op" id="5725176">.</span><span class="ident" id="5725177">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725187">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725209">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5725216">Mode</span>&nbsp;<span class="comment" id="5725221">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725238">trace</span>&nbsp;&nbsp;<span class="builtintype" id="5725245">bool</span>&nbsp;<span class="comment" id="5725250">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725277">indent</span>&nbsp;<span class="builtintype" id="5725284">int</span>&nbsp;&nbsp;<span class="comment" id="5725289">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725330">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725343">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5725355">[</span><span class="op" id="5725356">]</span><span class="op" id="5725357">*</span><span class="ident" id="5725358">ast</span><span class="op" id="5725361">.</span><span class="ident" id="5725362">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725376">leadComment</span>&nbsp;<span class="op" id="5725388">*</span><span class="ident" id="5725389">ast</span><span class="op" id="5725392">.</span><span class="ident" id="5725393">CommentGroup</span>&nbsp;<span class="comment" id="5725406">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725428">lineComment</span>&nbsp;<span class="op" id="5725440">*</span><span class="ident" id="5725441">ast</span><span class="op" id="5725444">.</span><span class="ident" id="5725445">CommentGroup</span>&nbsp;<span class="comment" id="5725458">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725481">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725496">pos</span>&nbsp;<span class="ident" id="5725500">token</span><span class="op" id="5725505">.</span><span class="ident" id="5725506">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5725512">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725531">tok</span>&nbsp;<span class="ident" id="5725535">token</span><span class="op" id="5725540">.</span><span class="ident" id="5725541">Token</span>&nbsp;<span class="comment" id="5725547">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725572">lit</span>&nbsp;<span class="builtintype" id="5725576">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5725588">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725607">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725626">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725686">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725746">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725812">syncPos</span>&nbsp;<span class="ident" id="5725820">token</span><span class="op" id="5725825">.</span><span class="ident" id="5725826">Pos</span>&nbsp;<span class="comment" id="5725830">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725864">syncCnt</span>&nbsp;<span class="builtintype" id="5725872">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5725882">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725931">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725964">exprLev</span>&nbsp;<span class="builtintype" id="5725972">int</span>&nbsp;&nbsp;<span class="comment" id="5725977">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726025">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5726033">bool</span>&nbsp;<span class="comment" id="5726038">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5726090">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726121">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5726132">*</span><span class="ident" id="5726133">ast</span><span class="op" id="5726136">.</span><span class="ident" id="5726137">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726150">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726176">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5726187">*</span><span class="ident" id="5726188">ast</span><span class="op" id="5726191">.</span><span class="ident" id="5726192">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726205">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726241">unresolved</span>&nbsp;<span class="op" id="5726252">[</span><span class="op" id="5726253">]</span><span class="op" id="5726254">*</span><span class="ident" id="5726255">ast</span><span class="op" id="5726258">.</span><span class="ident" id="5726259">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726270">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726297">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5726308">[</span><span class="op" id="5726309">]</span><span class="op" id="5726310">*</span><span class="ident" id="5726311">ast</span><span class="op" id="5726314">.</span><span class="ident" id="5726315">ImportSpec</span>&nbsp;<span class="comment" id="5726326">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5726347">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5726364">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726406">labelScope</span>&nbsp;&nbsp;<span class="op" id="5726418">*</span><span class="ident" id="5726419">ast</span><span class="op" id="5726422">.</span><span class="ident" id="5726423">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726433">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726470">targetStack</span>&nbsp;<span class="op" id="5726482">[</span><span class="op" id="5726483">]</span><span class="op" id="5726484">[</span><span class="op" id="5726485">]</span><span class="op" id="5726486">*</span><span class="ident" id="5726487">ast</span><span class="op" id="5726490">.</span><span class="ident" id="5726491">Ident</span>&nbsp;<span class="comment" id="5726497">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="5726527">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5726530">func</span>&nbsp;<span class="op" id="5726535">(</span><span class="ident" id="5726536">p</span>&nbsp;<span class="op" id="5726538">*</span><span class="ident" id="5726539">parser</span><span class="op" id="5726545">)</span>&nbsp;<span class="ident" id="5726547">init</span><span class="op" id="5726551">(</span><span class="ident" id="5726552">fset</span>&nbsp;<span class="op" id="5726557">*</span><span class="ident" id="5726558">token</span><span class="op" id="5726563">.</span><span class="ident" id="5726564">FileSet</span><span class="op" id="5726571">,</span>&nbsp;<span class="ident" id="5726573">filename</span>&nbsp;<span class="builtintype" id="5726582">string</span><span class="op" id="5726588">,</span>&nbsp;<span class="ident" id="5726590">src</span>&nbsp;<span class="op" id="5726594">[</span><span class="op" id="5726595">]</span><span class="builtintype" id="5726596">byte</span><span class="op" id="5726600">,</span>&nbsp;<span class="ident" id="5726602">mode</span>&nbsp;<span class="ident" id="5726607">Mode</span><span class="op" id="5726611">)</span>&nbsp;<span class="op" id="5726613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726616">p</span><span class="op" id="5726617">.</span><span class="ident" id="5726618">file</span>&nbsp;<span class="op" id="5726623">=</span>&nbsp;<span class="ident" id="5726625">fset</span><span class="op" id="5726629">.</span><span class="ident" id="5726630">AddFile</span><span class="op" id="5726637">(</span><span class="ident" id="5726638">filename</span><span class="op" id="5726646">,</span>&nbsp;<span class="op" id="5726648">-</span><span class="num" id="5726649">1</span><span class="op" id="5726650">,</span>&nbsp;<span class="builtinfunc" id="5726652">len</span><span class="op" id="5726655">(</span><span class="ident" id="5726656">src</span><span class="op" id="5726659">)</span><span class="op" id="5726660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726663">var</span>&nbsp;<span class="ident" id="5726667">m</span>&nbsp;<span class="ident" id="5726669">scanner</span><span class="op" id="5726676">.</span><span class="ident" id="5726677">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726683">if</span>&nbsp;<span class="ident" id="5726686">mode</span><span class="op" id="5726690">&amp;</span><span class="ident" id="5726691">ParseComments</span>&nbsp;<span class="op" id="5726705">!=</span>&nbsp;<span class="num" id="5726708">0</span>&nbsp;<span class="op" id="5726710">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726714">m</span>&nbsp;<span class="op" id="5726716">=</span>&nbsp;<span class="ident" id="5726718">scanner</span><span class="op" id="5726725">.</span><span class="ident" id="5726726">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5726740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726743">eh</span>&nbsp;<span class="op" id="5726746">:=</span>&nbsp;<span class="keyword" id="5726749">func</span><span class="op" id="5726753">(</span><span class="ident" id="5726754">pos</span>&nbsp;<span class="ident" id="5726758">token</span><span class="op" id="5726763">.</span><span class="ident" id="5726764">Position</span><span class="op" id="5726772">,</span>&nbsp;<span class="ident" id="5726774">msg</span>&nbsp;<span class="builtintype" id="5726778">string</span><span class="op" id="5726784">)</span>&nbsp;<span class="op" id="5726786">{</span>&nbsp;<span class="ident" id="5726788">p</span><span class="op" id="5726789">.</span><span class="ident" id="5726790">errors</span><span class="op" id="5726796">.</span><span class="ident" id="5726797">Add</span><span class="op" id="5726800">(</span><span class="ident" id="5726801">pos</span><span class="op" id="5726804">,</span>&nbsp;<span class="ident" id="5726806">msg</span><span class="op" id="5726809">)</span>&nbsp;<span class="op" id="5726811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726814">p</span><span class="op" id="5726815">.</span><span class="ident" id="5726816">scanner</span><span class="op" id="5726823">.</span><span class="ident" id="5726824">Init</span><span class="op" id="5726828">(</span><span class="ident" id="5726829">p</span><span class="op" id="5726830">.</span><span class="ident" id="5726831">file</span><span class="op" id="5726835">,</span>&nbsp;<span class="ident" id="5726837">src</span><span class="op" id="5726840">,</span>&nbsp;<span class="ident" id="5726842">eh</span><span class="op" id="5726844">,</span>&nbsp;<span class="ident" id="5726846">m</span><span class="op" id="5726847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726851">p</span><span class="op" id="5726852">.</span><span class="ident" id="5726853">mode</span>&nbsp;<span class="op" id="5726858">=</span>&nbsp;<span class="ident" id="5726860">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726866">p</span><span class="op" id="5726867">.</span><span class="ident" id="5726868">trace</span>&nbsp;<span class="op" id="5726874">=</span>&nbsp;<span class="ident" id="5726876">mode</span><span class="op" id="5726880">&amp;</span><span class="ident" id="5726881">Trace</span>&nbsp;<span class="op" id="5726887">!=</span>&nbsp;<span class="num" id="5726890">0</span>&nbsp;<span class="comment" id="5726892">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726942">p</span><span class="op" id="5726943">.</span><span class="ident" id="5726944">next</span><span class="op" id="5726948">(</span><span class="op" id="5726949">)</span><br>
<span class="lineno"></span><span class="op" id="5726951">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5726954">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5727034">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727054">func</span>&nbsp;<span class="op" id="5727059">(</span><span class="ident" id="5727060">p</span>&nbsp;<span class="op" id="5727062">*</span><span class="ident" id="5727063">parser</span><span class="op" id="5727069">)</span>&nbsp;<span class="ident" id="5727071">openScope</span><span class="op" id="5727080">(</span><span class="op" id="5727081">)</span>&nbsp;<span class="op" id="5727083">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727086">p</span><span class="op" id="5727087">.</span><span class="ident" id="5727088">topScope</span>&nbsp;<span class="op" id="5727097">=</span>&nbsp;<span class="ident" id="5727099">ast</span><span class="op" id="5727102">.</span><span class="ident" id="5727103">NewScope</span><span class="op" id="5727111">(</span><span class="ident" id="5727112">p</span><span class="op" id="5727113">.</span><span class="ident" id="5727114">topScope</span><span class="op" id="5727122">)</span><br>
<span class="lineno"></span><span class="op" id="5727124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727127">func</span>&nbsp;<span class="op" id="5727132">(</span><span class="ident" id="5727133">p</span>&nbsp;<span class="op" id="5727135">*</span><span class="ident" id="5727136">parser</span><span class="op" id="5727142">)</span>&nbsp;<span class="ident" id="5727144">closeScope</span><span class="op" id="5727154">(</span><span class="op" id="5727155">)</span>&nbsp;<span class="op" id="5727157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727160">p</span><span class="op" id="5727161">.</span><span class="ident" id="5727162">topScope</span>&nbsp;<span class="op" id="5727171">=</span>&nbsp;<span class="ident" id="5727173">p</span><span class="op" id="5727174">.</span><span class="ident" id="5727175">topScope</span><span class="op" id="5727183">.</span><span class="ident" id="5727184">Outer</span><br>
<span class="lineno">90</span><span class="op" id="5727190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727193">func</span>&nbsp;<span class="op" id="5727198">(</span><span class="ident" id="5727199">p</span>&nbsp;<span class="op" id="5727201">*</span><span class="ident" id="5727202">parser</span><span class="op" id="5727208">)</span>&nbsp;<span class="ident" id="5727210">openLabelScope</span><span class="op" id="5727224">(</span><span class="op" id="5727225">)</span>&nbsp;<span class="op" id="5727227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727230">p</span><span class="op" id="5727231">.</span><span class="ident" id="5727232">labelScope</span>&nbsp;<span class="op" id="5727243">=</span>&nbsp;<span class="ident" id="5727245">ast</span><span class="op" id="5727248">.</span><span class="ident" id="5727249">NewScope</span><span class="op" id="5727257">(</span><span class="ident" id="5727258">p</span><span class="op" id="5727259">.</span><span class="ident" id="5727260">labelScope</span><span class="op" id="5727270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727273">p</span><span class="op" id="5727274">.</span><span class="ident" id="5727275">targetStack</span>&nbsp;<span class="op" id="5727287">=</span>&nbsp;<span class="builtinfunc" id="5727289">append</span><span class="op" id="5727295">(</span><span class="ident" id="5727296">p</span><span class="op" id="5727297">.</span><span class="ident" id="5727298">targetStack</span><span class="op" id="5727309">,</span>&nbsp;<span class="ident" id="5727311">nil</span><span class="op" id="5727314">)</span><br>
<span class="lineno">95</span><span class="op" id="5727316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727319">func</span>&nbsp;<span class="op" id="5727324">(</span><span class="ident" id="5727325">p</span>&nbsp;<span class="op" id="5727327">*</span><span class="ident" id="5727328">parser</span><span class="op" id="5727334">)</span>&nbsp;<span class="ident" id="5727336">closeLabelScope</span><span class="op" id="5727351">(</span><span class="op" id="5727352">)</span>&nbsp;<span class="op" id="5727354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5727357">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727376">n</span>&nbsp;<span class="op" id="5727378">:=</span>&nbsp;<span class="builtinfunc" id="5727381">len</span><span class="op" id="5727384">(</span><span class="ident" id="5727385">p</span><span class="op" id="5727386">.</span><span class="ident" id="5727387">targetStack</span><span class="op" id="5727398">)</span>&nbsp;<span class="op" id="5727400">-</span>&nbsp;<span class="num" id="5727402">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727405">scope</span>&nbsp;<span class="op" id="5727411">:=</span>&nbsp;<span class="ident" id="5727414">p</span><span class="op" id="5727415">.</span><span class="ident" id="5727416">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727428">for</span>&nbsp;<span class="ident" id="5727432">_</span><span class="op" id="5727433">,</span>&nbsp;<span class="ident" id="5727435">ident</span>&nbsp;<span class="op" id="5727441">:=</span>&nbsp;<span class="keyword" id="5727444">range</span>&nbsp;<span class="ident" id="5727450">p</span><span class="op" id="5727451">.</span><span class="ident" id="5727452">targetStack</span><span class="op" id="5727463">[</span><span class="ident" id="5727464">n</span><span class="op" id="5727465">]</span>&nbsp;<span class="op" id="5727467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727471">ident</span><span class="op" id="5727476">.</span><span class="ident" id="5727477">Obj</span>&nbsp;<span class="op" id="5727481">=</span>&nbsp;<span class="ident" id="5727483">scope</span><span class="op" id="5727488">.</span><span class="ident" id="5727489">Lookup</span><span class="op" id="5727495">(</span><span class="ident" id="5727496">ident</span><span class="op" id="5727501">.</span><span class="ident" id="5727502">Name</span><span class="op" id="5727506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727510">if</span>&nbsp;<span class="ident" id="5727513">ident</span><span class="op" id="5727518">.</span><span class="ident" id="5727519">Obj</span>&nbsp;<span class="op" id="5727523">==</span>&nbsp;<span class="ident" id="5727526">nil</span>&nbsp;<span class="op" id="5727530">&amp;&amp;</span>&nbsp;<span class="ident" id="5727533">p</span><span class="op" id="5727534">.</span><span class="ident" id="5727535">mode</span><span class="op" id="5727539">&amp;</span><span class="ident" id="5727540">DeclarationErrors</span>&nbsp;<span class="op" id="5727558">!=</span>&nbsp;<span class="num" id="5727561">0</span>&nbsp;<span class="op" id="5727563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727568">p</span><span class="op" id="5727569">.</span><span class="builtintype" id="5727570">error</span><span class="op" id="5727575">(</span><span class="ident" id="5727576">ident</span><span class="op" id="5727581">.</span><span class="ident" id="5727582">Pos</span><span class="op" id="5727585">(</span><span class="op" id="5727586">)</span><span class="op" id="5727587">,</span>&nbsp;<span class="ident" id="5727589">fmt</span><span class="op" id="5727592">.</span><span class="ident" id="5727593">Sprintf</span><span class="op" id="5727600">(</span><span class="string" id="5727601">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="5727621">,</span>&nbsp;<span class="ident" id="5727623">ident</span><span class="op" id="5727628">.</span><span class="ident" id="5727629">Name</span><span class="op" id="5727633">)</span><span class="op" id="5727634">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5727638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5727641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5727644">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727664">p</span><span class="op" id="5727665">.</span><span class="ident" id="5727666">targetStack</span>&nbsp;<span class="op" id="5727678">=</span>&nbsp;<span class="ident" id="5727680">p</span><span class="op" id="5727681">.</span><span class="ident" id="5727682">targetStack</span><span class="op" id="5727693">[</span><span class="num" id="5727694">0</span><span class="op" id="5727695">:</span><span class="ident" id="5727696">n</span><span class="op" id="5727697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727700">p</span><span class="op" id="5727701">.</span><span class="ident" id="5727702">labelScope</span>&nbsp;<span class="op" id="5727713">=</span>&nbsp;<span class="ident" id="5727715">p</span><span class="op" id="5727716">.</span><span class="ident" id="5727717">labelScope</span><span class="op" id="5727727">.</span><span class="ident" id="5727728">Outer</span><br>
<span class="lineno">110</span><span class="op" id="5727734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727737">func</span>&nbsp;<span class="op" id="5727742">(</span><span class="ident" id="5727743">p</span>&nbsp;<span class="op" id="5727745">*</span><span class="ident" id="5727746">parser</span><span class="op" id="5727752">)</span>&nbsp;<span class="ident" id="5727754">declare</span><span class="op" id="5727761">(</span><span class="ident" id="5727762">decl</span><span class="op" id="5727766">,</span>&nbsp;<span class="ident" id="5727768">data</span>&nbsp;<span class="keyword" id="5727773">interface</span><span class="op" id="5727782">{</span><span class="op" id="5727783">}</span><span class="op" id="5727784">,</span>&nbsp;<span class="ident" id="5727786">scope</span>&nbsp;<span class="op" id="5727792">*</span><span class="ident" id="5727793">ast</span><span class="op" id="5727796">.</span><span class="ident" id="5727797">Scope</span><span class="op" id="5727802">,</span>&nbsp;<span class="ident" id="5727804">kind</span>&nbsp;<span class="ident" id="5727809">ast</span><span class="op" id="5727812">.</span><span class="ident" id="5727813">ObjKind</span><span class="op" id="5727820">,</span>&nbsp;<span class="ident" id="5727822">idents</span>&nbsp;<span class="op" id="5727829">...</span><span class="op" id="5727832">*</span><span class="ident" id="5727833">ast</span><span class="op" id="5727836">.</span><span class="ident" id="5727837">Ident</span><span class="op" id="5727842">)</span>&nbsp;<span class="op" id="5727844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727847">for</span>&nbsp;<span class="ident" id="5727851">_</span><span class="op" id="5727852">,</span>&nbsp;<span class="ident" id="5727854">ident</span>&nbsp;<span class="op" id="5727860">:=</span>&nbsp;<span class="keyword" id="5727863">range</span>&nbsp;<span class="ident" id="5727869">idents</span>&nbsp;<span class="op" id="5727876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727880">assert</span><span class="op" id="5727886">(</span><span class="ident" id="5727887">ident</span><span class="op" id="5727892">.</span><span class="ident" id="5727893">Obj</span>&nbsp;<span class="op" id="5727897">==</span>&nbsp;<span class="ident" id="5727900">nil</span><span class="op" id="5727903">,</span>&nbsp;<span class="string" id="5727905">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5727946">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727950">obj</span>&nbsp;<span class="op" id="5727954">:=</span>&nbsp;<span class="ident" id="5727957">ast</span><span class="op" id="5727960">.</span><span class="ident" id="5727961">NewObj</span><span class="op" id="5727967">(</span><span class="ident" id="5727968">kind</span><span class="op" id="5727972">,</span>&nbsp;<span class="ident" id="5727974">ident</span><span class="op" id="5727979">.</span><span class="ident" id="5727980">Name</span><span class="op" id="5727984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5727988">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5728050">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728112">obj</span><span class="op" id="5728115">.</span><span class="ident" id="5728116">Decl</span>&nbsp;<span class="op" id="5728121">=</span>&nbsp;<span class="ident" id="5728123">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728130">obj</span><span class="op" id="5728133">.</span><span class="ident" id="5728134">Data</span>&nbsp;<span class="op" id="5728139">=</span>&nbsp;<span class="ident" id="5728141">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728148">ident</span><span class="op" id="5728153">.</span><span class="ident" id="5728154">Obj</span>&nbsp;<span class="op" id="5728158">=</span>&nbsp;<span class="ident" id="5728160">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5728166">if</span>&nbsp;<span class="ident" id="5728169">ident</span><span class="op" id="5728174">.</span><span class="ident" id="5728175">Name</span>&nbsp;<span class="op" id="5728180">!=</span>&nbsp;<span class="string" id="5728183">&#34;_&#34;</span>&nbsp;<span class="op" id="5728187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5728192">if</span>&nbsp;<span class="ident" id="5728195">alt</span>&nbsp;<span class="op" id="5728199">:=</span>&nbsp;<span class="ident" id="5728202">scope</span><span class="op" id="5728207">.</span><span class="ident" id="5728208">Insert</span><span class="op" id="5728214">(</span><span class="ident" id="5728215">obj</span><span class="op" id="5728218">)</span><span class="op" id="5728219">;</span>&nbsp;<span class="ident" id="5728221">alt</span>&nbsp;<span class="op" id="5728225">!=</span>&nbsp;<span class="ident" id="5728228">nil</span>&nbsp;<span class="op" id="5728232">&amp;&amp;</span>&nbsp;<span class="ident" id="5728235">p</span><span class="op" id="5728236">.</span><span class="ident" id="5728237">mode</span><span class="op" id="5728241">&amp;</span><span class="ident" id="5728242">DeclarationErrors</span>&nbsp;<span class="op" id="5728260">!=</span>&nbsp;<span class="num" id="5728263">0</span>&nbsp;<span class="op" id="5728265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728271">prevDecl</span>&nbsp;<span class="op" id="5728280">:=</span>&nbsp;<span class="string" id="5728283">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5728290">if</span>&nbsp;<span class="ident" id="5728293">pos</span>&nbsp;<span class="op" id="5728297">:=</span>&nbsp;<span class="ident" id="5728300">alt</span><span class="op" id="5728303">.</span><span class="ident" id="5728304">Pos</span><span class="op" id="5728307">(</span><span class="op" id="5728308">)</span><span class="op" id="5728309">;</span>&nbsp;<span class="ident" id="5728311">pos</span><span class="op" id="5728314">.</span><span class="ident" id="5728315">IsValid</span><span class="op" id="5728322">(</span><span class="op" id="5728323">)</span>&nbsp;<span class="op" id="5728325">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728332">prevDecl</span>&nbsp;<span class="op" id="5728341">=</span>&nbsp;<span class="ident" id="5728343">fmt</span><span class="op" id="5728346">.</span><span class="ident" id="5728347">Sprintf</span><span class="op" id="5728354">(</span><span class="string" id="5728355">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="5728387">,</span>&nbsp;<span class="ident" id="5728389">p</span><span class="op" id="5728390">.</span><span class="ident" id="5728391">file</span><span class="op" id="5728395">.</span><span class="ident" id="5728396">Position</span><span class="op" id="5728404">(</span><span class="ident" id="5728405">pos</span><span class="op" id="5728408">)</span><span class="op" id="5728409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5728415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728421">p</span><span class="op" id="5728422">.</span><span class="builtintype" id="5728423">error</span><span class="op" id="5728428">(</span><span class="ident" id="5728429">ident</span><span class="op" id="5728434">.</span><span class="ident" id="5728435">Pos</span><span class="op" id="5728438">(</span><span class="op" id="5728439">)</span><span class="op" id="5728440">,</span>&nbsp;<span class="ident" id="5728442">fmt</span><span class="op" id="5728445">.</span><span class="ident" id="5728446">Sprintf</span><span class="op" id="5728453">(</span><span class="string" id="5728454">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="5728485">,</span>&nbsp;<span class="ident" id="5728487">ident</span><span class="op" id="5728492">.</span><span class="ident" id="5728493">Name</span><span class="op" id="5728497">,</span>&nbsp;<span class="ident" id="5728499">prevDecl</span><span class="op" id="5728507">)</span><span class="op" id="5728508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5728513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5728517">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5728520">}</span><br>
<span class="lineno"></span><span class="op" id="5728522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5728525">func</span>&nbsp;<span class="op" id="5728530">(</span><span class="ident" id="5728531">p</span>&nbsp;<span class="op" id="5728533">*</span><span class="ident" id="5728534">parser</span><span class="op" id="5728540">)</span>&nbsp;<span class="ident" id="5728542">shortVarDecl</span><span class="op" id="5728554">(</span><span class="ident" id="5728555">decl</span>&nbsp;<span class="op" id="5728560">*</span><span class="ident" id="5728561">ast</span><span class="op" id="5728564">.</span><span class="ident" id="5728565">AssignStmt</span><span class="op" id="5728575">,</span>&nbsp;<span class="ident" id="5728577">list</span>&nbsp;<span class="op" id="5728582">[</span><span class="op" id="5728583">]</span><span class="ident" id="5728584">ast</span><span class="op" id="5728587">.</span><span class="ident" id="5728588">Expr</span><span class="op" id="5728592">)</span>&nbsp;<span class="op" id="5728594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5728597">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5728663">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5728729">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728800">n</span>&nbsp;<span class="op" id="5728802">:=</span>&nbsp;<span class="num" id="5728805">0</span>&nbsp;<span class="comment" id="5728807">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5728835">for</span>&nbsp;<span class="ident" id="5728839">_</span><span class="op" id="5728840">,</span>&nbsp;<span class="ident" id="5728842">x</span>&nbsp;<span class="op" id="5728844">:=</span>&nbsp;<span class="keyword" id="5728847">range</span>&nbsp;<span class="ident" id="5728853">list</span>&nbsp;<span class="op" id="5728858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5728862">if</span>&nbsp;<span class="ident" id="5728865">ident</span><span class="op" id="5728870">,</span>&nbsp;<span class="ident" id="5728872">isIdent</span>&nbsp;<span class="op" id="5728880">:=</span>&nbsp;<span class="ident" id="5728883">x</span><span class="op" id="5728884">.</span><span class="op" id="5728885">(</span><span class="op" id="5728886">*</span><span class="ident" id="5728887">ast</span><span class="op" id="5728890">.</span><span class="ident" id="5728891">Ident</span><span class="op" id="5728896">)</span><span class="op" id="5728897">;</span>&nbsp;<span class="ident" id="5728899">isIdent</span>&nbsp;<span class="op" id="5728907">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728912">assert</span><span class="op" id="5728918">(</span><span class="ident" id="5728919">ident</span><span class="op" id="5728924">.</span><span class="ident" id="5728925">Obj</span>&nbsp;<span class="op" id="5728929">==</span>&nbsp;<span class="ident" id="5728932">nil</span><span class="op" id="5728935">,</span>&nbsp;<span class="string" id="5728937">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5728978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5728983">obj</span>&nbsp;<span class="op" id="5728987">:=</span>&nbsp;<span class="ident" id="5728990">ast</span><span class="op" id="5728993">.</span><span class="ident" id="5728994">NewObj</span><span class="op" id="5729000">(</span><span class="ident" id="5729001">ast</span><span class="op" id="5729004">.</span><span class="ident" id="5729005">Var</span><span class="op" id="5729008">,</span>&nbsp;<span class="ident" id="5729010">ident</span><span class="op" id="5729015">.</span><span class="ident" id="5729016">Name</span><span class="op" id="5729020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5729025">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5729081">obj</span><span class="op" id="5729084">.</span><span class="ident" id="5729085">Decl</span>&nbsp;<span class="op" id="5729090">=</span>&nbsp;<span class="ident" id="5729092">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5729100">ident</span><span class="op" id="5729105">.</span><span class="ident" id="5729106">Obj</span>&nbsp;<span class="op" id="5729110">=</span>&nbsp;<span class="ident" id="5729112">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5729119">if</span>&nbsp;<span class="ident" id="5729122">ident</span><span class="op" id="5729127">.</span><span class="ident" id="5729128">Name</span>&nbsp;<span class="op" id="5729133">!=</span>&nbsp;<span class="string" id="5729136">&#34;_&#34;</span>&nbsp;<span class="op" id="5729140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5729146">if</span>&nbsp;<span class="ident" id="5729149">alt</span>&nbsp;<span class="op" id="5729153">:=</span>&nbsp;<span class="ident" id="5729156">p</span><span class="op" id="5729157">.</span><span class="ident" id="5729158">topScope</span><span class="op" id="5729166">.</span><span class="ident" id="5729167">Insert</span><span class="op" id="5729173">(</span><span class="ident" id="5729174">obj</span><span class="op" id="5729177">)</span><span class="op" id="5729178">;</span>&nbsp;<span class="ident" id="5729180">alt</span>&nbsp;<span class="op" id="5729184">!=</span>&nbsp;<span class="ident" id="5729187">nil</span>&nbsp;<span class="op" id="5729191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5729198">ident</span><span class="op" id="5729203">.</span><span class="ident" id="5729204">Obj</span>&nbsp;<span class="op" id="5729208">=</span>&nbsp;<span class="ident" id="5729210">alt</span>&nbsp;<span class="comment" id="5729214">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5729235">}</span>&nbsp;<span class="keyword" id="5729237">else</span>&nbsp;<span class="op" id="5729242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5729249">n</span><span class="op" id="5729250">++</span>&nbsp;<span class="comment" id="5729253">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5729276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5729281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5729285">}</span>&nbsp;<span class="keyword" id="5729287">else</span>&nbsp;<span class="op" id="5729292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5729297">p</span><span class="op" id="5729298">.</span><span class="ident" id="5729299">errorExpected</span><span class="op" id="5729312">(</span><span class="ident" id="5729313">x</span><span class="op" id="5729314">.</span><span class="ident" id="5729315">Pos</span><span class="op" id="5729318">(</span><span class="op" id="5729319">)</span><span class="op" id="5729320">,</span>&nbsp;<span class="string" id="5729322">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5729353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5729357">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5729360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5729363">if</span>&nbsp;<span class="ident" id="5729366">n</span>&nbsp;<span class="op" id="5729368">==</span>&nbsp;<span class="num" id="5729371">0</span>&nbsp;<span class="op" id="5729373">&amp;&amp;</span>&nbsp;<span class="ident" id="5729376">p</span><span class="op" id="5729377">.</span><span class="ident" id="5729378">mode</span><span class="op" id="5729382">&amp;</span><span class="ident" id="5729383">DeclarationErrors</span>&nbsp;<span class="op" id="5729401">!=</span>&nbsp;<span class="num" id="5729404">0</span>&nbsp;<span class="op" id="5729406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5729410">p</span><span class="op" id="5729411">.</span><span class="builtintype" id="5729412">error</span><span class="op" id="5729417">(</span><span class="ident" id="5729418">list</span><span class="op" id="5729422">[</span><span class="num" id="5729423">0</span><span class="op" id="5729424">]</span><span class="op" id="5729425">.</span><span class="ident" id="5729426">Pos</span><span class="op" id="5729429">(</span><span class="op" id="5729430">)</span><span class="op" id="5729431">,</span>&nbsp;<span class="string" id="5729433">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5729470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5729473">}</span><br>
<span class="lineno"></span><span class="op" id="5729475">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="5729478">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5729558">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="5729640">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="5729665">var</span>&nbsp;<span class="ident" id="5729669">unresolved</span>&nbsp;<span class="op" id="5729680">=</span>&nbsp;<span class="builtinfunc" id="5729682">new</span><span class="op" id="5729685">(</span><span class="ident" id="5729686">ast</span><span class="op" id="5729689">.</span><span class="ident" id="5729690">Object</span><span class="op" id="5729696">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5729699">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5729772">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5729845">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="5729919">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="5729935">//</span><br>
<span class="lineno"></span><span class="keyword" id="5729938">func</span>&nbsp;<span class="op" id="5729943">(</span><span class="ident" id="5729944">p</span>&nbsp;<span class="op" id="5729946">*</span><span class="ident" id="5729947">parser</span><span class="op" id="5729953">)</span>&nbsp;<span class="ident" id="5729955">tryResolve</span><span class="op" id="5729965">(</span><span class="ident" id="5729966">x</span>&nbsp;<span class="ident" id="5729968">ast</span><span class="op" id="5729971">.</span><span class="ident" id="5729972">Expr</span><span class="op" id="5729976">,</span>&nbsp;<span class="ident" id="5729978">collectUnresolved</span>&nbsp;<span class="builtintype" id="5729996">bool</span><span class="op" id="5730000">)</span>&nbsp;<span class="op" id="5730002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5730005">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5730073">ident</span><span class="op" id="5730078">,</span>&nbsp;<span class="ident" id="5730080">_</span>&nbsp;<span class="op" id="5730082">:=</span>&nbsp;<span class="ident" id="5730085">x</span><span class="op" id="5730086">.</span><span class="op" id="5730087">(</span><span class="op" id="5730088">*</span><span class="ident" id="5730089">ast</span><span class="op" id="5730092">.</span><span class="ident" id="5730093">Ident</span><span class="op" id="5730098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730101">if</span>&nbsp;<span class="ident" id="5730104">ident</span>&nbsp;<span class="op" id="5730110">==</span>&nbsp;<span class="ident" id="5730113">nil</span>&nbsp;<span class="op" id="5730117">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730121">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5730129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5730132">assert</span><span class="op" id="5730138">(</span><span class="ident" id="5730139">ident</span><span class="op" id="5730144">.</span><span class="ident" id="5730145">Obj</span>&nbsp;<span class="op" id="5730149">==</span>&nbsp;<span class="ident" id="5730152">nil</span><span class="op" id="5730155">,</span>&nbsp;<span class="string" id="5730157">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5730198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730201">if</span>&nbsp;<span class="ident" id="5730204">ident</span><span class="op" id="5730209">.</span><span class="ident" id="5730210">Name</span>&nbsp;<span class="op" id="5730215">==</span>&nbsp;<span class="string" id="5730218">&#34;_&#34;</span>&nbsp;<span class="op" id="5730222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730226">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5730234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5730237">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730271">for</span>&nbsp;<span class="ident" id="5730275">s</span>&nbsp;<span class="op" id="5730277">:=</span>&nbsp;<span class="ident" id="5730280">p</span><span class="op" id="5730281">.</span><span class="ident" id="5730282">topScope</span><span class="op" id="5730290">;</span>&nbsp;<span class="ident" id="5730292">s</span>&nbsp;<span class="op" id="5730294">!=</span>&nbsp;<span class="ident" id="5730297">nil</span><span class="op" id="5730300">;</span>&nbsp;<span class="ident" id="5730302">s</span>&nbsp;<span class="op" id="5730304">=</span>&nbsp;<span class="ident" id="5730306">s</span><span class="op" id="5730307">.</span><span class="ident" id="5730308">Outer</span>&nbsp;<span class="op" id="5730314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730318">if</span>&nbsp;<span class="ident" id="5730321">obj</span>&nbsp;<span class="op" id="5730325">:=</span>&nbsp;<span class="ident" id="5730328">s</span><span class="op" id="5730329">.</span><span class="ident" id="5730330">Lookup</span><span class="op" id="5730336">(</span><span class="ident" id="5730337">ident</span><span class="op" id="5730342">.</span><span class="ident" id="5730343">Name</span><span class="op" id="5730347">)</span><span class="op" id="5730348">;</span>&nbsp;<span class="ident" id="5730350">obj</span>&nbsp;<span class="op" id="5730354">!=</span>&nbsp;<span class="ident" id="5730357">nil</span>&nbsp;<span class="op" id="5730361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5730366">ident</span><span class="op" id="5730371">.</span><span class="ident" id="5730372">Obj</span>&nbsp;<span class="op" id="5730376">=</span>&nbsp;<span class="ident" id="5730378">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730385">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5730394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5730397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5730400">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5730461">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5730519">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5730580">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730624">if</span>&nbsp;<span class="ident" id="5730627">collectUnresolved</span>&nbsp;<span class="op" id="5730645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5730649">ident</span><span class="op" id="5730654">.</span><span class="ident" id="5730655">Obj</span>&nbsp;<span class="op" id="5730659">=</span>&nbsp;<span class="ident" id="5730661">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5730674">p</span><span class="op" id="5730675">.</span><span class="ident" id="5730676">unresolved</span>&nbsp;<span class="op" id="5730687">=</span>&nbsp;<span class="builtinfunc" id="5730689">append</span><span class="op" id="5730695">(</span><span class="ident" id="5730696">p</span><span class="op" id="5730697">.</span><span class="ident" id="5730698">unresolved</span><span class="op" id="5730708">,</span>&nbsp;<span class="ident" id="5730710">ident</span><span class="op" id="5730715">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5730718">}</span><br>
<span class="lineno"></span><span class="op" id="5730720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5730723">func</span>&nbsp;<span class="op" id="5730728">(</span><span class="ident" id="5730729">p</span>&nbsp;<span class="op" id="5730731">*</span><span class="ident" id="5730732">parser</span><span class="op" id="5730738">)</span>&nbsp;<span class="ident" id="5730740">resolve</span><span class="op" id="5730747">(</span><span class="ident" id="5730748">x</span>&nbsp;<span class="ident" id="5730750">ast</span><span class="op" id="5730753">.</span><span class="ident" id="5730754">Expr</span><span class="op" id="5730758">)</span>&nbsp;<span class="op" id="5730760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5730763">p</span><span class="op" id="5730764">.</span><span class="ident" id="5730765">tryResolve</span><span class="op" id="5730775">(</span><span class="ident" id="5730776">x</span><span class="op" id="5730777">,</span>&nbsp;<span class="builtintype" id="5730779">true</span><span class="op" id="5730783">)</span><br>
<span class="lineno">200</span><span class="op" id="5730785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5730788">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5730868">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5730888">func</span>&nbsp;<span class="op" id="5730893">(</span><span class="ident" id="5730894">p</span>&nbsp;<span class="op" id="5730896">*</span><span class="ident" id="5730897">parser</span><span class="op" id="5730903">)</span>&nbsp;<span class="ident" id="5730905">printTrace</span><span class="op" id="5730915">(</span><span class="ident" id="5730916">a</span>&nbsp;<span class="op" id="5730918">...</span><span class="keyword" id="5730921">interface</span><span class="op" id="5730930">{</span><span class="op" id="5730931">}</span><span class="op" id="5730932">)</span>&nbsp;<span class="op" id="5730934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5730937">const</span>&nbsp;<span class="ident" id="5730943">dots</span>&nbsp;<span class="op" id="5730948">=</span>&nbsp;<span class="string" id="5730950">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731018">const</span>&nbsp;<span class="ident" id="5731024">n</span>&nbsp;<span class="op" id="5731026">=</span>&nbsp;<span class="builtinfunc" id="5731028">len</span><span class="op" id="5731031">(</span><span class="ident" id="5731032">dots</span><span class="op" id="5731036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731039">pos</span>&nbsp;<span class="op" id="5731043">:=</span>&nbsp;<span class="ident" id="5731046">p</span><span class="op" id="5731047">.</span><span class="ident" id="5731048">file</span><span class="op" id="5731052">.</span><span class="ident" id="5731053">Position</span><span class="op" id="5731061">(</span><span class="ident" id="5731062">p</span><span class="op" id="5731063">.</span><span class="ident" id="5731064">pos</span><span class="op" id="5731067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731070">fmt</span><span class="op" id="5731073">.</span><span class="ident" id="5731074">Printf</span><span class="op" id="5731080">(</span><span class="string" id="5731081">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="5731092">,</span>&nbsp;<span class="ident" id="5731094">pos</span><span class="op" id="5731097">.</span><span class="ident" id="5731098">Line</span><span class="op" id="5731102">,</span>&nbsp;<span class="ident" id="5731104">pos</span><span class="op" id="5731107">.</span><span class="ident" id="5731108">Column</span><span class="op" id="5731114">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731117">i</span>&nbsp;<span class="op" id="5731119">:=</span>&nbsp;<span class="num" id="5731122">2</span>&nbsp;<span class="op" id="5731124">*</span>&nbsp;<span class="ident" id="5731126">p</span><span class="op" id="5731127">.</span><span class="ident" id="5731128">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731136">for</span>&nbsp;<span class="ident" id="5731140">i</span>&nbsp;<span class="op" id="5731142">&gt;</span>&nbsp;<span class="ident" id="5731144">n</span>&nbsp;<span class="op" id="5731146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731150">fmt</span><span class="op" id="5731153">.</span><span class="ident" id="5731154">Print</span><span class="op" id="5731159">(</span><span class="ident" id="5731160">dots</span><span class="op" id="5731164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731168">i</span>&nbsp;<span class="op" id="5731170">-=</span>&nbsp;<span class="ident" id="5731173">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5731176">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5731179">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731190">fmt</span><span class="op" id="5731193">.</span><span class="ident" id="5731194">Print</span><span class="op" id="5731199">(</span><span class="ident" id="5731200">dots</span><span class="op" id="5731204">[</span><span class="num" id="5731205">0</span><span class="op" id="5731206">:</span><span class="ident" id="5731207">i</span><span class="op" id="5731208">]</span><span class="op" id="5731209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731212">fmt</span><span class="op" id="5731215">.</span><span class="ident" id="5731216">Println</span><span class="op" id="5731223">(</span><span class="ident" id="5731224">a</span><span class="op" id="5731225">...</span><span class="op" id="5731228">)</span><br>
<span class="lineno"></span><span class="op" id="5731230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="5731233">func</span>&nbsp;<span class="ident" id="5731238">trace</span><span class="op" id="5731243">(</span><span class="ident" id="5731244">p</span>&nbsp;<span class="op" id="5731246">*</span><span class="ident" id="5731247">parser</span><span class="op" id="5731253">,</span>&nbsp;<span class="ident" id="5731255">msg</span>&nbsp;<span class="builtintype" id="5731259">string</span><span class="op" id="5731265">)</span>&nbsp;<span class="op" id="5731267">*</span><span class="ident" id="5731268">parser</span>&nbsp;<span class="op" id="5731275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731278">p</span><span class="op" id="5731279">.</span><span class="ident" id="5731280">printTrace</span><span class="op" id="5731290">(</span><span class="ident" id="5731291">msg</span><span class="op" id="5731294">,</span>&nbsp;<span class="string" id="5731296">&#34;(&#34;</span><span class="op" id="5731299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731302">p</span><span class="op" id="5731303">.</span><span class="ident" id="5731304">indent</span><span class="op" id="5731310">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731314">return</span>&nbsp;<span class="ident" id="5731321">p</span><br>
<span class="lineno"></span><span class="op" id="5731323">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5731326">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="5731370">func</span>&nbsp;<span class="ident" id="5731375">un</span><span class="op" id="5731377">(</span><span class="ident" id="5731378">p</span>&nbsp;<span class="op" id="5731380">*</span><span class="ident" id="5731381">parser</span><span class="op" id="5731387">)</span>&nbsp;<span class="op" id="5731389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731392">p</span><span class="op" id="5731393">.</span><span class="ident" id="5731394">indent</span><span class="op" id="5731400">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731404">p</span><span class="op" id="5731405">.</span><span class="ident" id="5731406">printTrace</span><span class="op" id="5731416">(</span><span class="string" id="5731417">&#34;)&#34;</span><span class="op" id="5731420">)</span><br>
<span class="lineno">230</span><span class="op" id="5731422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5731425">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="5731455">func</span>&nbsp;<span class="op" id="5731460">(</span><span class="ident" id="5731461">p</span>&nbsp;<span class="op" id="5731463">*</span><span class="ident" id="5731464">parser</span><span class="op" id="5731470">)</span>&nbsp;<span class="ident" id="5731472">next0</span><span class="op" id="5731477">(</span><span class="op" id="5731478">)</span>&nbsp;<span class="op" id="5731480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5731483">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5731545">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5731605">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5731664">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731711">if</span>&nbsp;<span class="ident" id="5731714">p</span><span class="op" id="5731715">.</span><span class="ident" id="5731716">trace</span>&nbsp;<span class="op" id="5731722">&amp;&amp;</span>&nbsp;<span class="ident" id="5731725">p</span><span class="op" id="5731726">.</span><span class="ident" id="5731727">pos</span><span class="op" id="5731730">.</span><span class="ident" id="5731731">IsValid</span><span class="op" id="5731738">(</span><span class="op" id="5731739">)</span>&nbsp;<span class="op" id="5731741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731745">s</span>&nbsp;<span class="op" id="5731747">:=</span>&nbsp;<span class="ident" id="5731750">p</span><span class="op" id="5731751">.</span><span class="ident" id="5731752">tok</span><span class="op" id="5731755">.</span><span class="ident" id="5731756">String</span><span class="op" id="5731762">(</span><span class="op" id="5731763">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731767">switch</span>&nbsp;<span class="op" id="5731774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731778">case</span>&nbsp;<span class="ident" id="5731783">p</span><span class="op" id="5731784">.</span><span class="ident" id="5731785">tok</span><span class="op" id="5731788">.</span><span class="ident" id="5731789">IsLiteral</span><span class="op" id="5731798">(</span><span class="op" id="5731799">)</span><span class="op" id="5731800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731805">p</span><span class="op" id="5731806">.</span><span class="ident" id="5731807">printTrace</span><span class="op" id="5731817">(</span><span class="ident" id="5731818">s</span><span class="op" id="5731819">,</span>&nbsp;<span class="ident" id="5731821">p</span><span class="op" id="5731822">.</span><span class="ident" id="5731823">lit</span><span class="op" id="5731826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731830">case</span>&nbsp;<span class="ident" id="5731835">p</span><span class="op" id="5731836">.</span><span class="ident" id="5731837">tok</span><span class="op" id="5731840">.</span><span class="ident" id="5731841">IsOperator</span><span class="op" id="5731851">(</span><span class="op" id="5731852">)</span><span class="op" id="5731853">,</span>&nbsp;<span class="ident" id="5731855">p</span><span class="op" id="5731856">.</span><span class="ident" id="5731857">tok</span><span class="op" id="5731860">.</span><span class="ident" id="5731861">IsKeyword</span><span class="op" id="5731870">(</span><span class="op" id="5731871">)</span><span class="op" id="5731872">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731877">p</span><span class="op" id="5731878">.</span><span class="ident" id="5731879">printTrace</span><span class="op" id="5731889">(</span><span class="string" id="5731890">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="5731895">+</span>&nbsp;<span class="ident" id="5731897">s</span>&nbsp;<span class="op" id="5731899">+</span>&nbsp;<span class="string" id="5731901">&#34;\&#34;&#34;</span><span class="op" id="5731905">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5731909">default</span><span class="op" id="5731916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731921">p</span><span class="op" id="5731922">.</span><span class="ident" id="5731923">printTrace</span><span class="op" id="5731933">(</span><span class="ident" id="5731934">s</span><span class="op" id="5731935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5731939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5731942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5731946">p</span><span class="op" id="5731947">.</span><span class="ident" id="5731948">pos</span><span class="op" id="5731951">,</span>&nbsp;<span class="ident" id="5731953">p</span><span class="op" id="5731954">.</span><span class="ident" id="5731955">tok</span><span class="op" id="5731958">,</span>&nbsp;<span class="ident" id="5731960">p</span><span class="op" id="5731961">.</span><span class="ident" id="5731962">lit</span>&nbsp;<span class="op" id="5731966">=</span>&nbsp;<span class="ident" id="5731968">p</span><span class="op" id="5731969">.</span><span class="ident" id="5731970">scanner</span><span class="op" id="5731977">.</span><span class="ident" id="5731978">Scan</span><span class="op" id="5731982">(</span><span class="op" id="5731983">)</span><br>
<span class="lineno"></span><span class="op" id="5731985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5731988">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="5732054">func</span>&nbsp;<span class="op" id="5732059">(</span><span class="ident" id="5732060">p</span>&nbsp;<span class="op" id="5732062">*</span><span class="ident" id="5732063">parser</span><span class="op" id="5732069">)</span>&nbsp;<span class="ident" id="5732071">consumeComment</span><span class="op" id="5732085">(</span><span class="op" id="5732086">)</span>&nbsp;<span class="op" id="5732088">(</span><span class="ident" id="5732089">comment</span>&nbsp;<span class="op" id="5732097">*</span><span class="ident" id="5732098">ast</span><span class="op" id="5732101">.</span><span class="ident" id="5732102">Comment</span><span class="op" id="5732109">,</span>&nbsp;<span class="ident" id="5732111">endline</span>&nbsp;<span class="builtintype" id="5732119">int</span><span class="op" id="5732122">)</span>&nbsp;<span class="op" id="5732124">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5732127">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5732200">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732268">endline</span>&nbsp;<span class="op" id="5732276">=</span>&nbsp;<span class="ident" id="5732278">p</span><span class="op" id="5732279">.</span><span class="ident" id="5732280">file</span><span class="op" id="5732284">.</span><span class="ident" id="5732285">Line</span><span class="op" id="5732289">(</span><span class="ident" id="5732290">p</span><span class="op" id="5732291">.</span><span class="ident" id="5732292">pos</span><span class="op" id="5732295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5732298">if</span>&nbsp;<span class="ident" id="5732301">p</span><span class="op" id="5732302">.</span><span class="ident" id="5732303">lit</span><span class="op" id="5732306">[</span><span class="num" id="5732307">1</span><span class="op" id="5732308">]</span>&nbsp;<span class="op" id="5732310">==</span>&nbsp;<span class="string" id="5732313">&#39;*&#39;</span>&nbsp;<span class="op" id="5732317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5732321">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5732387">for</span>&nbsp;<span class="ident" id="5732391">i</span>&nbsp;<span class="op" id="5732393">:=</span>&nbsp;<span class="num" id="5732396">0</span><span class="op" id="5732397">;</span>&nbsp;<span class="ident" id="5732399">i</span>&nbsp;<span class="op" id="5732401">&lt;</span>&nbsp;<span class="builtinfunc" id="5732403">len</span><span class="op" id="5732406">(</span><span class="ident" id="5732407">p</span><span class="op" id="5732408">.</span><span class="ident" id="5732409">lit</span><span class="op" id="5732412">)</span><span class="op" id="5732413">;</span>&nbsp;<span class="ident" id="5732415">i</span><span class="op" id="5732416">++</span>&nbsp;<span class="op" id="5732419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5732424">if</span>&nbsp;<span class="ident" id="5732427">p</span><span class="op" id="5732428">.</span><span class="ident" id="5732429">lit</span><span class="op" id="5732432">[</span><span class="ident" id="5732433">i</span><span class="op" id="5732434">]</span>&nbsp;<span class="op" id="5732436">==</span>&nbsp;<span class="string" id="5732439">&#39;\n&#39;</span>&nbsp;<span class="op" id="5732444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732450">endline</span><span class="op" id="5732457">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5732463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5732467">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5732470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732474">comment</span>&nbsp;<span class="op" id="5732482">=</span>&nbsp;<span class="op" id="5732484">&amp;</span><span class="ident" id="5732485">ast</span><span class="op" id="5732488">.</span><span class="ident" id="5732489">Comment</span><span class="op" id="5732496">{</span><span class="ident" id="5732497">Slash</span><span class="op" id="5732502">:</span>&nbsp;<span class="ident" id="5732504">p</span><span class="op" id="5732505">.</span><span class="ident" id="5732506">pos</span><span class="op" id="5732509">,</span>&nbsp;<span class="ident" id="5732511">Text</span><span class="op" id="5732515">:</span>&nbsp;<span class="ident" id="5732517">p</span><span class="op" id="5732518">.</span><span class="ident" id="5732519">lit</span><span class="op" id="5732522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732525">p</span><span class="op" id="5732526">.</span><span class="ident" id="5732527">next0</span><span class="op" id="5732532">(</span><span class="op" id="5732533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5732537">return</span><br>
<span class="lineno"></span><span class="op" id="5732544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5732547">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5732611">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="5732675">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5732739">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5732781">//</span><br>
<span class="lineno"></span><span class="keyword" id="5732784">func</span>&nbsp;<span class="op" id="5732789">(</span><span class="ident" id="5732790">p</span>&nbsp;<span class="op" id="5732792">*</span><span class="ident" id="5732793">parser</span><span class="op" id="5732799">)</span>&nbsp;<span class="ident" id="5732801">consumeCommentGroup</span><span class="op" id="5732820">(</span><span class="ident" id="5732821">n</span>&nbsp;<span class="builtintype" id="5732823">int</span><span class="op" id="5732826">)</span>&nbsp;<span class="op" id="5732828">(</span><span class="ident" id="5732829">comments</span>&nbsp;<span class="op" id="5732838">*</span><span class="ident" id="5732839">ast</span><span class="op" id="5732842">.</span><span class="ident" id="5732843">CommentGroup</span><span class="op" id="5732855">,</span>&nbsp;<span class="ident" id="5732857">endline</span>&nbsp;<span class="builtintype" id="5732865">int</span><span class="op" id="5732868">)</span>&nbsp;<span class="op" id="5732870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5732873">var</span>&nbsp;<span class="ident" id="5732877">list</span>&nbsp;<span class="op" id="5732882">[</span><span class="op" id="5732883">]</span><span class="op" id="5732884">*</span><span class="ident" id="5732885">ast</span><span class="op" id="5732888">.</span><span class="ident" id="5732889">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732898">endline</span>&nbsp;<span class="op" id="5732906">=</span>&nbsp;<span class="ident" id="5732908">p</span><span class="op" id="5732909">.</span><span class="ident" id="5732910">file</span><span class="op" id="5732914">.</span><span class="ident" id="5732915">Line</span><span class="op" id="5732919">(</span><span class="ident" id="5732920">p</span><span class="op" id="5732921">.</span><span class="ident" id="5732922">pos</span><span class="op" id="5732925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5732928">for</span>&nbsp;<span class="ident" id="5732932">p</span><span class="op" id="5732933">.</span><span class="ident" id="5732934">tok</span>&nbsp;<span class="op" id="5732938">==</span>&nbsp;<span class="ident" id="5732941">token</span><span class="op" id="5732946">.</span><span class="ident" id="5732947">COMMENT</span>&nbsp;<span class="op" id="5732955">&amp;&amp;</span>&nbsp;<span class="ident" id="5732958">p</span><span class="op" id="5732959">.</span><span class="ident" id="5732960">file</span><span class="op" id="5732964">.</span><span class="ident" id="5732965">Line</span><span class="op" id="5732969">(</span><span class="ident" id="5732970">p</span><span class="op" id="5732971">.</span><span class="ident" id="5732972">pos</span><span class="op" id="5732975">)</span>&nbsp;<span class="op" id="5732977">&lt;=</span>&nbsp;<span class="ident" id="5732980">endline</span><span class="op" id="5732987">+</span><span class="ident" id="5732988">n</span>&nbsp;<span class="op" id="5732990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5732994">var</span>&nbsp;<span class="ident" id="5732998">comment</span>&nbsp;<span class="op" id="5733006">*</span><span class="ident" id="5733007">ast</span><span class="op" id="5733010">.</span><span class="ident" id="5733011">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733021">comment</span><span class="op" id="5733028">,</span>&nbsp;<span class="ident" id="5733030">endline</span>&nbsp;<span class="op" id="5733038">=</span>&nbsp;<span class="ident" id="5733040">p</span><span class="op" id="5733041">.</span><span class="ident" id="5733042">consumeComment</span><span class="op" id="5733056">(</span><span class="op" id="5733057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733061">list</span>&nbsp;<span class="op" id="5733066">=</span>&nbsp;<span class="builtinfunc" id="5733068">append</span><span class="op" id="5733074">(</span><span class="ident" id="5733075">list</span><span class="op" id="5733079">,</span>&nbsp;<span class="ident" id="5733081">comment</span><span class="op" id="5733088">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5733091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5733095">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733138">comments</span>&nbsp;<span class="op" id="5733147">=</span>&nbsp;<span class="op" id="5733149">&amp;</span><span class="ident" id="5733150">ast</span><span class="op" id="5733153">.</span><span class="ident" id="5733154">CommentGroup</span><span class="op" id="5733166">{</span><span class="ident" id="5733167">List</span><span class="op" id="5733171">:</span>&nbsp;<span class="ident" id="5733173">list</span><span class="op" id="5733177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733180">p</span><span class="op" id="5733181">.</span><span class="ident" id="5733182">comments</span>&nbsp;<span class="op" id="5733191">=</span>&nbsp;<span class="builtinfunc" id="5733193">append</span><span class="op" id="5733199">(</span><span class="ident" id="5733200">p</span><span class="op" id="5733201">.</span><span class="ident" id="5733202">comments</span><span class="op" id="5733210">,</span>&nbsp;<span class="ident" id="5733212">comments</span><span class="op" id="5733220">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733224">return</span><br>
<span class="lineno"></span><span class="op" id="5733231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5733234">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="5733300">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5733366">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5733388">//</span><br>
<span class="lineno"></span><span class="comment" id="5733391">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5733454">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="5733525">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5733583">//</span><br>
<span class="lineno"></span><span class="comment" id="5733586">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="5733650">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5733721">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="5733739">//</span><br>
<span class="lineno"></span><span class="comment" id="5733742">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5733808">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5733830">//</span><br>
<span class="lineno"></span><span class="keyword" id="5733833">func</span>&nbsp;<span class="op" id="5733838">(</span><span class="ident" id="5733839">p</span>&nbsp;<span class="op" id="5733841">*</span><span class="ident" id="5733842">parser</span><span class="op" id="5733848">)</span>&nbsp;<span class="ident" id="5733850">next</span><span class="op" id="5733854">(</span><span class="op" id="5733855">)</span>&nbsp;<span class="op" id="5733857">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733860">p</span><span class="op" id="5733861">.</span><span class="ident" id="5733862">leadComment</span>&nbsp;<span class="op" id="5733874">=</span>&nbsp;<span class="ident" id="5733876">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733881">p</span><span class="op" id="5733882">.</span><span class="ident" id="5733883">lineComment</span>&nbsp;<span class="op" id="5733895">=</span>&nbsp;<span class="ident" id="5733897">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733902">prev</span>&nbsp;<span class="op" id="5733907">:=</span>&nbsp;<span class="ident" id="5733910">p</span><span class="op" id="5733911">.</span><span class="ident" id="5733912">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733917">p</span><span class="op" id="5733918">.</span><span class="ident" id="5733919">next0</span><span class="op" id="5733924">(</span><span class="op" id="5733925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733929">if</span>&nbsp;<span class="ident" id="5733932">p</span><span class="op" id="5733933">.</span><span class="ident" id="5733934">tok</span>&nbsp;<span class="op" id="5733938">==</span>&nbsp;<span class="ident" id="5733941">token</span><span class="op" id="5733946">.</span><span class="ident" id="5733947">COMMENT</span>&nbsp;<span class="op" id="5733955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733959">var</span>&nbsp;<span class="ident" id="5733963">comment</span>&nbsp;<span class="op" id="5733971">*</span><span class="ident" id="5733972">ast</span><span class="op" id="5733975">.</span><span class="ident" id="5733976">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733991">var</span>&nbsp;<span class="ident" id="5733995">endline</span>&nbsp;<span class="builtintype" id="5734003">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734010">if</span>&nbsp;<span class="ident" id="5734013">p</span><span class="op" id="5734014">.</span><span class="ident" id="5734015">file</span><span class="op" id="5734019">.</span><span class="ident" id="5734020">Line</span><span class="op" id="5734024">(</span><span class="ident" id="5734025">p</span><span class="op" id="5734026">.</span><span class="ident" id="5734027">pos</span><span class="op" id="5734030">)</span>&nbsp;<span class="op" id="5734032">==</span>&nbsp;<span class="ident" id="5734035">p</span><span class="op" id="5734036">.</span><span class="ident" id="5734037">file</span><span class="op" id="5734041">.</span><span class="ident" id="5734042">Line</span><span class="op" id="5734046">(</span><span class="ident" id="5734047">prev</span><span class="op" id="5734051">)</span>&nbsp;<span class="op" id="5734053">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734058">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734118">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734176">comment</span><span class="op" id="5734183">,</span>&nbsp;<span class="ident" id="5734185">endline</span>&nbsp;<span class="op" id="5734193">=</span>&nbsp;<span class="ident" id="5734195">p</span><span class="op" id="5734196">.</span><span class="ident" id="5734197">consumeCommentGroup</span><span class="op" id="5734216">(</span><span class="num" id="5734217">0</span><span class="op" id="5734218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734223">if</span>&nbsp;<span class="ident" id="5734226">p</span><span class="op" id="5734227">.</span><span class="ident" id="5734228">file</span><span class="op" id="5734232">.</span><span class="ident" id="5734233">Line</span><span class="op" id="5734237">(</span><span class="ident" id="5734238">p</span><span class="op" id="5734239">.</span><span class="ident" id="5734240">pos</span><span class="op" id="5734243">)</span>&nbsp;<span class="op" id="5734245">!=</span>&nbsp;<span class="ident" id="5734248">endline</span>&nbsp;<span class="op" id="5734256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734262">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734313">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734362">p</span><span class="op" id="5734363">.</span><span class="ident" id="5734364">lineComment</span>&nbsp;<span class="op" id="5734376">=</span>&nbsp;<span class="ident" id="5734378">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734398">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734438">endline</span>&nbsp;<span class="op" id="5734446">=</span>&nbsp;<span class="op" id="5734448">-</span><span class="num" id="5734449">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734453">for</span>&nbsp;<span class="ident" id="5734457">p</span><span class="op" id="5734458">.</span><span class="ident" id="5734459">tok</span>&nbsp;<span class="op" id="5734463">==</span>&nbsp;<span class="ident" id="5734466">token</span><span class="op" id="5734471">.</span><span class="ident" id="5734472">COMMENT</span>&nbsp;<span class="op" id="5734480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734485">comment</span><span class="op" id="5734492">,</span>&nbsp;<span class="ident" id="5734494">endline</span>&nbsp;<span class="op" id="5734502">=</span>&nbsp;<span class="ident" id="5734504">p</span><span class="op" id="5734505">.</span><span class="ident" id="5734506">consumeCommentGroup</span><span class="op" id="5734525">(</span><span class="num" id="5734526">1</span><span class="op" id="5734527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734531">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734536">if</span>&nbsp;<span class="ident" id="5734539">endline</span><span class="op" id="5734546">+</span><span class="num" id="5734547">1</span>&nbsp;<span class="op" id="5734549">==</span>&nbsp;<span class="ident" id="5734552">p</span><span class="op" id="5734553">.</span><span class="ident" id="5734554">file</span><span class="op" id="5734558">.</span><span class="ident" id="5734559">Line</span><span class="op" id="5734563">(</span><span class="ident" id="5734564">p</span><span class="op" id="5734565">.</span><span class="ident" id="5734566">pos</span><span class="op" id="5734569">)</span>&nbsp;<span class="op" id="5734571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734576">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734644">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734712">p</span><span class="op" id="5734713">.</span><span class="ident" id="5734714">leadComment</span>&nbsp;<span class="op" id="5734726">=</span>&nbsp;<span class="ident" id="5734728">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734741">}</span><br>
<span class="lineno"></span><span class="op" id="5734743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5734746">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="5734806">type</span>&nbsp;<span class="ident" id="5734811">bailout</span>&nbsp;<span class="keyword" id="5734819">struct</span><span class="op" id="5734825">{</span><span class="op" id="5734826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5734829">func</span>&nbsp;<span class="op" id="5734834">(</span><span class="ident" id="5734835">p</span>&nbsp;<span class="op" id="5734837">*</span><span class="ident" id="5734838">parser</span><span class="op" id="5734844">)</span>&nbsp;<span class="builtintype" id="5734846">error</span><span class="op" id="5734851">(</span><span class="ident" id="5734852">pos</span>&nbsp;<span class="ident" id="5734856">token</span><span class="op" id="5734861">.</span><span class="ident" id="5734862">Pos</span><span class="op" id="5734865">,</span>&nbsp;<span class="ident" id="5734867">msg</span>&nbsp;<span class="builtintype" id="5734871">string</span><span class="op" id="5734877">)</span>&nbsp;<span class="op" id="5734879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734882">epos</span>&nbsp;<span class="op" id="5734887">:=</span>&nbsp;<span class="ident" id="5734890">p</span><span class="op" id="5734891">.</span><span class="ident" id="5734892">file</span><span class="op" id="5734896">.</span><span class="ident" id="5734897">Position</span><span class="op" id="5734905">(</span><span class="ident" id="5734906">pos</span><span class="op" id="5734909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734913">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734983">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5735054">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735069">if</span>&nbsp;<span class="ident" id="5735072">p</span><span class="op" id="5735073">.</span><span class="ident" id="5735074">mode</span><span class="op" id="5735078">&amp;</span><span class="ident" id="5735079">AllErrors</span>&nbsp;<span class="op" id="5735089">==</span>&nbsp;<span class="num" id="5735092">0</span>&nbsp;<span class="op" id="5735094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735098">n</span>&nbsp;<span class="op" id="5735100">:=</span>&nbsp;<span class="builtinfunc" id="5735103">len</span><span class="op" id="5735106">(</span><span class="ident" id="5735107">p</span><span class="op" id="5735108">.</span><span class="ident" id="5735109">errors</span><span class="op" id="5735115">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735119">if</span>&nbsp;<span class="ident" id="5735122">n</span>&nbsp;<span class="op" id="5735124">&gt;</span>&nbsp;<span class="num" id="5735126">0</span>&nbsp;<span class="op" id="5735128">&amp;&amp;</span>&nbsp;<span class="ident" id="5735131">p</span><span class="op" id="5735132">.</span><span class="ident" id="5735133">errors</span><span class="op" id="5735139">[</span><span class="ident" id="5735140">n</span><span class="op" id="5735141">-</span><span class="num" id="5735142">1</span><span class="op" id="5735143">]</span><span class="op" id="5735144">.</span><span class="ident" id="5735145">Pos</span><span class="op" id="5735148">.</span><span class="ident" id="5735149">Line</span>&nbsp;<span class="op" id="5735154">==</span>&nbsp;<span class="ident" id="5735157">epos</span><span class="op" id="5735161">.</span><span class="ident" id="5735162">Line</span>&nbsp;<span class="op" id="5735167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735172">return</span>&nbsp;<span class="comment" id="5735179">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735222">if</span>&nbsp;<span class="ident" id="5735225">n</span>&nbsp;<span class="op" id="5735227">&gt;</span>&nbsp;<span class="num" id="5735229">10</span>&nbsp;<span class="op" id="5735232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5735237">panic</span><span class="op" id="5735242">(</span><span class="ident" id="5735243">bailout</span><span class="op" id="5735250">{</span><span class="op" id="5735251">}</span><span class="op" id="5735252">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735263">p</span><span class="op" id="5735264">.</span><span class="ident" id="5735265">errors</span><span class="op" id="5735271">.</span><span class="ident" id="5735272">Add</span><span class="op" id="5735275">(</span><span class="ident" id="5735276">epos</span><span class="op" id="5735280">,</span>&nbsp;<span class="ident" id="5735282">msg</span><span class="op" id="5735285">)</span><br>
<span class="lineno"></span><span class="op" id="5735287">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="5735290">func</span>&nbsp;<span class="op" id="5735295">(</span><span class="ident" id="5735296">p</span>&nbsp;<span class="op" id="5735298">*</span><span class="ident" id="5735299">parser</span><span class="op" id="5735305">)</span>&nbsp;<span class="ident" id="5735307">errorExpected</span><span class="op" id="5735320">(</span><span class="ident" id="5735321">pos</span>&nbsp;<span class="ident" id="5735325">token</span><span class="op" id="5735330">.</span><span class="ident" id="5735331">Pos</span><span class="op" id="5735334">,</span>&nbsp;<span class="ident" id="5735336">msg</span>&nbsp;<span class="builtintype" id="5735340">string</span><span class="op" id="5735346">)</span>&nbsp;<span class="op" id="5735348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735351">msg</span>&nbsp;<span class="op" id="5735355">=</span>&nbsp;<span class="string" id="5735357">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="5735369">+</span>&nbsp;<span class="ident" id="5735371">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735376">if</span>&nbsp;<span class="ident" id="5735379">pos</span>&nbsp;<span class="op" id="5735383">==</span>&nbsp;<span class="ident" id="5735386">p</span><span class="op" id="5735387">.</span><span class="ident" id="5735388">pos</span>&nbsp;<span class="op" id="5735392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5735396">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5735445">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735487">if</span>&nbsp;<span class="ident" id="5735490">p</span><span class="op" id="5735491">.</span><span class="ident" id="5735492">tok</span>&nbsp;<span class="op" id="5735496">==</span>&nbsp;<span class="ident" id="5735499">token</span><span class="op" id="5735504">.</span><span class="ident" id="5735505">SEMICOLON</span>&nbsp;<span class="op" id="5735515">&amp;&amp;</span>&nbsp;<span class="ident" id="5735518">p</span><span class="op" id="5735519">.</span><span class="ident" id="5735520">lit</span>&nbsp;<span class="op" id="5735524">==</span>&nbsp;<span class="string" id="5735527">&#34;\n&#34;</span>&nbsp;<span class="op" id="5735532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735537">msg</span>&nbsp;<span class="op" id="5735541">+=</span>&nbsp;<span class="string" id="5735544">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735564">}</span>&nbsp;<span class="keyword" id="5735566">else</span>&nbsp;<span class="op" id="5735571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735576">msg</span>&nbsp;<span class="op" id="5735580">+=</span>&nbsp;<span class="string" id="5735583">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="5735595">+</span>&nbsp;<span class="ident" id="5735597">p</span><span class="op" id="5735598">.</span><span class="ident" id="5735599">tok</span><span class="op" id="5735602">.</span><span class="ident" id="5735603">String</span><span class="op" id="5735609">(</span><span class="op" id="5735610">)</span>&nbsp;<span class="op" id="5735612">+</span>&nbsp;<span class="string" id="5735614">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735621">if</span>&nbsp;<span class="ident" id="5735624">p</span><span class="op" id="5735625">.</span><span class="ident" id="5735626">tok</span><span class="op" id="5735629">.</span><span class="ident" id="5735630">IsLiteral</span><span class="op" id="5735639">(</span><span class="op" id="5735640">)</span>&nbsp;<span class="op" id="5735642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735648">msg</span>&nbsp;<span class="op" id="5735652">+=</span>&nbsp;<span class="string" id="5735655">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5735659">+</span>&nbsp;<span class="ident" id="5735661">p</span><span class="op" id="5735662">.</span><span class="ident" id="5735663">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735677">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735680">p</span><span class="op" id="5735681">.</span><span class="builtintype" id="5735682">error</span><span class="op" id="5735687">(</span><span class="ident" id="5735688">pos</span><span class="op" id="5735691">,</span>&nbsp;<span class="ident" id="5735693">msg</span><span class="op" id="5735696">)</span><br>
<span class="lineno"></span><span class="op" id="5735698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5735701">func</span>&nbsp;<span class="op" id="5735706">(</span><span class="ident" id="5735707">p</span>&nbsp;<span class="op" id="5735709">*</span><span class="ident" id="5735710">parser</span><span class="op" id="5735716">)</span>&nbsp;<span class="ident" id="5735718">expect</span><span class="op" id="5735724">(</span><span class="ident" id="5735725">tok</span>&nbsp;<span class="ident" id="5735729">token</span><span class="op" id="5735734">.</span><span class="ident" id="5735735">Token</span><span class="op" id="5735740">)</span>&nbsp;<span class="ident" id="5735742">token</span><span class="op" id="5735747">.</span><span class="ident" id="5735748">Pos</span>&nbsp;<span class="op" id="5735752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735755">pos</span>&nbsp;<span class="op" id="5735759">:=</span>&nbsp;<span class="ident" id="5735762">p</span><span class="op" id="5735763">.</span><span class="ident" id="5735764">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735769">if</span>&nbsp;<span class="ident" id="5735772">p</span><span class="op" id="5735773">.</span><span class="ident" id="5735774">tok</span>&nbsp;<span class="op" id="5735778">!=</span>&nbsp;<span class="ident" id="5735781">tok</span>&nbsp;<span class="op" id="5735785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735789">p</span><span class="op" id="5735790">.</span><span class="ident" id="5735791">errorExpected</span><span class="op" id="5735804">(</span><span class="ident" id="5735805">pos</span><span class="op" id="5735808">,</span>&nbsp;<span class="string" id="5735810">&#34;&#39;&#34;</span><span class="op" id="5735813">+</span><span class="ident" id="5735814">tok</span><span class="op" id="5735817">.</span><span class="ident" id="5735818">String</span><span class="op" id="5735824">(</span><span class="op" id="5735825">)</span><span class="op" id="5735826">+</span><span class="string" id="5735827">&#34;&#39;&#34;</span><span class="op" id="5735830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735836">p</span><span class="op" id="5735837">.</span><span class="ident" id="5735838">next</span><span class="op" id="5735842">(</span><span class="op" id="5735843">)</span>&nbsp;<span class="comment" id="5735845">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735863">return</span>&nbsp;<span class="ident" id="5735870">pos</span><br>
<span class="lineno">390</span><span class="op" id="5735874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5735877">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="5735945">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="5736005">//</span><br>
<span class="lineno">395</span><span class="keyword" id="5736008">func</span>&nbsp;<span class="op" id="5736013">(</span><span class="ident" id="5736014">p</span>&nbsp;<span class="op" id="5736016">*</span><span class="ident" id="5736017">parser</span><span class="op" id="5736023">)</span>&nbsp;<span class="ident" id="5736025">expectClosing</span><span class="op" id="5736038">(</span><span class="ident" id="5736039">tok</span>&nbsp;<span class="ident" id="5736043">token</span><span class="op" id="5736048">.</span><span class="ident" id="5736049">Token</span><span class="op" id="5736054">,</span>&nbsp;<span class="ident" id="5736056">context</span>&nbsp;<span class="builtintype" id="5736064">string</span><span class="op" id="5736070">)</span>&nbsp;<span class="ident" id="5736072">token</span><span class="op" id="5736077">.</span><span class="ident" id="5736078">Pos</span>&nbsp;<span class="op" id="5736082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736085">if</span>&nbsp;<span class="ident" id="5736088">p</span><span class="op" id="5736089">.</span><span class="ident" id="5736090">tok</span>&nbsp;<span class="op" id="5736094">!=</span>&nbsp;<span class="ident" id="5736097">tok</span>&nbsp;<span class="op" id="5736101">&amp;&amp;</span>&nbsp;<span class="ident" id="5736104">p</span><span class="op" id="5736105">.</span><span class="ident" id="5736106">tok</span>&nbsp;<span class="op" id="5736110">==</span>&nbsp;<span class="ident" id="5736113">token</span><span class="op" id="5736118">.</span><span class="ident" id="5736119">SEMICOLON</span>&nbsp;<span class="op" id="5736129">&amp;&amp;</span>&nbsp;<span class="ident" id="5736132">p</span><span class="op" id="5736133">.</span><span class="ident" id="5736134">lit</span>&nbsp;<span class="op" id="5736138">==</span>&nbsp;<span class="string" id="5736141">&#34;\n&#34;</span>&nbsp;<span class="op" id="5736146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736150">p</span><span class="op" id="5736151">.</span><span class="builtintype" id="5736152">error</span><span class="op" id="5736157">(</span><span class="ident" id="5736158">p</span><span class="op" id="5736159">.</span><span class="ident" id="5736160">pos</span><span class="op" id="5736163">,</span>&nbsp;<span class="string" id="5736165">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5736197">+</span><span class="ident" id="5736198">context</span><span class="op" id="5736205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736209">p</span><span class="op" id="5736210">.</span><span class="ident" id="5736211">next</span><span class="op" id="5736215">(</span><span class="op" id="5736216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736219">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736222">return</span>&nbsp;<span class="ident" id="5736229">p</span><span class="op" id="5736230">.</span><span class="ident" id="5736231">expect</span><span class="op" id="5736237">(</span><span class="ident" id="5736238">tok</span><span class="op" id="5736241">)</span><br>
<span class="lineno"></span><span class="op" id="5736243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5736246">func</span>&nbsp;<span class="op" id="5736251">(</span><span class="ident" id="5736252">p</span>&nbsp;<span class="op" id="5736254">*</span><span class="ident" id="5736255">parser</span><span class="op" id="5736261">)</span>&nbsp;<span class="ident" id="5736263">expectSemi</span><span class="op" id="5736273">(</span><span class="op" id="5736274">)</span>&nbsp;<span class="op" id="5736276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5736279">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736333">if</span>&nbsp;<span class="ident" id="5736336">p</span><span class="op" id="5736337">.</span><span class="ident" id="5736338">tok</span>&nbsp;<span class="op" id="5736342">!=</span>&nbsp;<span class="ident" id="5736345">token</span><span class="op" id="5736350">.</span><span class="ident" id="5736351">RPAREN</span>&nbsp;<span class="op" id="5736358">&amp;&amp;</span>&nbsp;<span class="ident" id="5736361">p</span><span class="op" id="5736362">.</span><span class="ident" id="5736363">tok</span>&nbsp;<span class="op" id="5736367">!=</span>&nbsp;<span class="ident" id="5736370">token</span><span class="op" id="5736375">.</span><span class="ident" id="5736376">RBRACE</span>&nbsp;<span class="op" id="5736383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736387">if</span>&nbsp;<span class="ident" id="5736390">p</span><span class="op" id="5736391">.</span><span class="ident" id="5736392">tok</span>&nbsp;<span class="op" id="5736396">==</span>&nbsp;<span class="ident" id="5736399">token</span><span class="op" id="5736404">.</span><span class="ident" id="5736405">SEMICOLON</span>&nbsp;<span class="op" id="5736415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736420">p</span><span class="op" id="5736421">.</span><span class="ident" id="5736422">next</span><span class="op" id="5736426">(</span><span class="op" id="5736427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736431">}</span>&nbsp;<span class="keyword" id="5736433">else</span>&nbsp;<span class="op" id="5736438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736443">p</span><span class="op" id="5736444">.</span><span class="ident" id="5736445">errorExpected</span><span class="op" id="5736458">(</span><span class="ident" id="5736459">p</span><span class="op" id="5736460">.</span><span class="ident" id="5736461">pos</span><span class="op" id="5736464">,</span>&nbsp;<span class="string" id="5736466">&#34;&#39;;&#39;&#34;</span><span class="op" id="5736471">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736476">syncStmt</span><span class="op" id="5736484">(</span><span class="ident" id="5736485">p</span><span class="op" id="5736486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736493">}</span><br>
<span class="lineno"></span><span class="op" id="5736495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="5736498">func</span>&nbsp;<span class="op" id="5736503">(</span><span class="ident" id="5736504">p</span>&nbsp;<span class="op" id="5736506">*</span><span class="ident" id="5736507">parser</span><span class="op" id="5736513">)</span>&nbsp;<span class="ident" id="5736515">atComma</span><span class="op" id="5736522">(</span><span class="ident" id="5736523">context</span>&nbsp;<span class="builtintype" id="5736531">string</span><span class="op" id="5736537">)</span>&nbsp;<span class="builtintype" id="5736539">bool</span>&nbsp;<span class="op" id="5736544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736547">if</span>&nbsp;<span class="ident" id="5736550">p</span><span class="op" id="5736551">.</span><span class="ident" id="5736552">tok</span>&nbsp;<span class="op" id="5736556">==</span>&nbsp;<span class="ident" id="5736559">token</span><span class="op" id="5736564">.</span><span class="ident" id="5736565">COMMA</span>&nbsp;<span class="op" id="5736571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736575">return</span>&nbsp;<span class="builtintype" id="5736582">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736591">if</span>&nbsp;<span class="ident" id="5736594">p</span><span class="op" id="5736595">.</span><span class="ident" id="5736596">tok</span>&nbsp;<span class="op" id="5736600">==</span>&nbsp;<span class="ident" id="5736603">token</span><span class="op" id="5736608">.</span><span class="ident" id="5736609">SEMICOLON</span>&nbsp;<span class="op" id="5736619">&amp;&amp;</span>&nbsp;<span class="ident" id="5736622">p</span><span class="op" id="5736623">.</span><span class="ident" id="5736624">lit</span>&nbsp;<span class="op" id="5736628">==</span>&nbsp;<span class="string" id="5736631">&#34;\n&#34;</span>&nbsp;<span class="op" id="5736636">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736640">p</span><span class="op" id="5736641">.</span><span class="builtintype" id="5736642">error</span><span class="op" id="5736647">(</span><span class="ident" id="5736648">p</span><span class="op" id="5736649">.</span><span class="ident" id="5736650">pos</span><span class="op" id="5736653">,</span>&nbsp;<span class="string" id="5736655">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5736687">+</span><span class="ident" id="5736688">context</span><span class="op" id="5736695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736699">return</span>&nbsp;<span class="builtintype" id="5736706">true</span>&nbsp;<span class="comment" id="5736711">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736751">return</span>&nbsp;<span class="builtintype" id="5736758">false</span><br>
<span class="lineno">425</span><span class="op" id="5736764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5736767">func</span>&nbsp;<span class="ident" id="5736772">assert</span><span class="op" id="5736778">(</span><span class="ident" id="5736779">cond</span>&nbsp;<span class="builtintype" id="5736784">bool</span><span class="op" id="5736788">,</span>&nbsp;<span class="ident" id="5736790">msg</span>&nbsp;<span class="builtintype" id="5736794">string</span><span class="op" id="5736800">)</span>&nbsp;<span class="op" id="5736802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736805">if</span>&nbsp;<span class="op" id="5736808">!</span><span class="ident" id="5736809">cond</span>&nbsp;<span class="op" id="5736814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5736818">panic</span><span class="op" id="5736823">(</span><span class="string" id="5736824">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="5736853">+</span>&nbsp;<span class="ident" id="5736855">msg</span><span class="op" id="5736858">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736861">}</span><br>
<span class="lineno"></span><span class="op" id="5736863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5736866">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5736910">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="5736954">//</span><br>
<span class="lineno"></span><span class="keyword" id="5736957">func</span>&nbsp;<span class="ident" id="5736962">syncStmt</span><span class="op" id="5736970">(</span><span class="ident" id="5736971">p</span>&nbsp;<span class="op" id="5736973">*</span><span class="ident" id="5736974">parser</span><span class="op" id="5736980">)</span>&nbsp;<span class="op" id="5736982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736985">for</span>&nbsp;<span class="op" id="5736989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736993">switch</span>&nbsp;<span class="ident" id="5737000">p</span><span class="op" id="5737001">.</span><span class="ident" id="5737002">tok</span>&nbsp;<span class="op" id="5737006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737010">case</span>&nbsp;<span class="ident" id="5737015">token</span><span class="op" id="5737020">.</span><span class="ident" id="5737021">BREAK</span><span class="op" id="5737026">,</span>&nbsp;<span class="ident" id="5737028">token</span><span class="op" id="5737033">.</span><span class="ident" id="5737034">CONST</span><span class="op" id="5737039">,</span>&nbsp;<span class="ident" id="5737041">token</span><span class="op" id="5737046">.</span><span class="ident" id="5737047">CONTINUE</span><span class="op" id="5737055">,</span>&nbsp;<span class="ident" id="5737057">token</span><span class="op" id="5737062">.</span><span class="ident" id="5737063">DEFER</span><span class="op" id="5737068">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737073">token</span><span class="op" id="5737078">.</span><span class="ident" id="5737079">FALLTHROUGH</span><span class="op" id="5737090">,</span>&nbsp;<span class="ident" id="5737092">token</span><span class="op" id="5737097">.</span><span class="ident" id="5737098">FOR</span><span class="op" id="5737101">,</span>&nbsp;<span class="ident" id="5737103">token</span><span class="op" id="5737108">.</span><span class="ident" id="5737109">GO</span><span class="op" id="5737111">,</span>&nbsp;<span class="ident" id="5737113">token</span><span class="op" id="5737118">.</span><span class="ident" id="5737119">GOTO</span><span class="op" id="5737123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737128">token</span><span class="op" id="5737133">.</span><span class="ident" id="5737134">IF</span><span class="op" id="5737136">,</span>&nbsp;<span class="ident" id="5737138">token</span><span class="op" id="5737143">.</span><span class="ident" id="5737144">RETURN</span><span class="op" id="5737150">,</span>&nbsp;<span class="ident" id="5737152">token</span><span class="op" id="5737157">.</span><span class="ident" id="5737158">SELECT</span><span class="op" id="5737164">,</span>&nbsp;<span class="ident" id="5737166">token</span><span class="op" id="5737171">.</span><span class="ident" id="5737172">SWITCH</span><span class="op" id="5737178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737183">token</span><span class="op" id="5737188">.</span><span class="ident" id="5737189">TYPE</span><span class="op" id="5737193">,</span>&nbsp;<span class="ident" id="5737195">token</span><span class="op" id="5737200">.</span><span class="ident" id="5737201">VAR</span><span class="op" id="5737204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737209">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737267">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737325">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737381">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737437">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737493">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737547">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737582">if</span>&nbsp;<span class="ident" id="5737585">p</span><span class="op" id="5737586">.</span><span class="ident" id="5737587">pos</span>&nbsp;<span class="op" id="5737591">==</span>&nbsp;<span class="ident" id="5737594">p</span><span class="op" id="5737595">.</span><span class="ident" id="5737596">syncPos</span>&nbsp;<span class="op" id="5737604">&amp;&amp;</span>&nbsp;<span class="ident" id="5737607">p</span><span class="op" id="5737608">.</span><span class="ident" id="5737609">syncCnt</span>&nbsp;<span class="op" id="5737617">&lt;</span>&nbsp;<span class="num" id="5737619">10</span>&nbsp;<span class="op" id="5737622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737628">p</span><span class="op" id="5737629">.</span><span class="ident" id="5737630">syncCnt</span><span class="op" id="5737637">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737644">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5737654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737659">if</span>&nbsp;<span class="ident" id="5737662">p</span><span class="op" id="5737663">.</span><span class="ident" id="5737664">pos</span>&nbsp;<span class="op" id="5737668">&gt;</span>&nbsp;<span class="ident" id="5737670">p</span><span class="op" id="5737671">.</span><span class="ident" id="5737672">syncPos</span>&nbsp;<span class="op" id="5737680">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737686">p</span><span class="op" id="5737687">.</span><span class="ident" id="5737688">syncPos</span>&nbsp;<span class="op" id="5737696">=</span>&nbsp;<span class="ident" id="5737698">p</span><span class="op" id="5737699">.</span><span class="ident" id="5737700">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737708">p</span><span class="op" id="5737709">.</span><span class="ident" id="5737710">syncCnt</span>&nbsp;<span class="op" id="5737718">=</span>&nbsp;<span class="num" id="5737720">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737726">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5737736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737741">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737795">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737852">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737906">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737961">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737996">case</span>&nbsp;<span class="ident" id="5738001">token</span><span class="op" id="5738006">.</span><span class="ident" id="5738007">EOF</span><span class="op" id="5738010">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738015">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738028">p</span><span class="op" id="5738029">.</span><span class="ident" id="5738030">next</span><span class="op" id="5738034">(</span><span class="op" id="5738035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738038">}</span><br>
<span class="lineno"></span><span class="op" id="5738040">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5738043">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="5738089">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5738133">//</span><br>
<span class="lineno"></span><span class="keyword" id="5738136">func</span>&nbsp;<span class="ident" id="5738141">syncDecl</span><span class="op" id="5738149">(</span><span class="ident" id="5738150">p</span>&nbsp;<span class="op" id="5738152">*</span><span class="ident" id="5738153">parser</span><span class="op" id="5738159">)</span>&nbsp;<span class="op" id="5738161">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738164">for</span>&nbsp;<span class="op" id="5738168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738172">switch</span>&nbsp;<span class="ident" id="5738179">p</span><span class="op" id="5738180">.</span><span class="ident" id="5738181">tok</span>&nbsp;<span class="op" id="5738185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738189">case</span>&nbsp;<span class="ident" id="5738194">token</span><span class="op" id="5738199">.</span><span class="ident" id="5738200">CONST</span><span class="op" id="5738205">,</span>&nbsp;<span class="ident" id="5738207">token</span><span class="op" id="5738212">.</span><span class="ident" id="5738213">TYPE</span><span class="op" id="5738217">,</span>&nbsp;<span class="ident" id="5738219">token</span><span class="op" id="5738224">.</span><span class="ident" id="5738225">VAR</span><span class="op" id="5738228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5738233">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738264">if</span>&nbsp;<span class="ident" id="5738267">p</span><span class="op" id="5738268">.</span><span class="ident" id="5738269">pos</span>&nbsp;<span class="op" id="5738273">==</span>&nbsp;<span class="ident" id="5738276">p</span><span class="op" id="5738277">.</span><span class="ident" id="5738278">syncPos</span>&nbsp;<span class="op" id="5738286">&amp;&amp;</span>&nbsp;<span class="ident" id="5738289">p</span><span class="op" id="5738290">.</span><span class="ident" id="5738291">syncCnt</span>&nbsp;<span class="op" id="5738299">&lt;</span>&nbsp;<span class="num" id="5738301">10</span>&nbsp;<span class="op" id="5738304">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738310">p</span><span class="op" id="5738311">.</span><span class="ident" id="5738312">syncCnt</span><span class="op" id="5738319">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738326">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738341">if</span>&nbsp;<span class="ident" id="5738344">p</span><span class="op" id="5738345">.</span><span class="ident" id="5738346">pos</span>&nbsp;<span class="op" id="5738350">&gt;</span>&nbsp;<span class="ident" id="5738352">p</span><span class="op" id="5738353">.</span><span class="ident" id="5738354">syncPos</span>&nbsp;<span class="op" id="5738362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738368">p</span><span class="op" id="5738369">.</span><span class="ident" id="5738370">syncPos</span>&nbsp;<span class="op" id="5738378">=</span>&nbsp;<span class="ident" id="5738380">p</span><span class="op" id="5738381">.</span><span class="ident" id="5738382">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738390">p</span><span class="op" id="5738391">.</span><span class="ident" id="5738392">syncCnt</span>&nbsp;<span class="op" id="5738400">=</span>&nbsp;<span class="num" id="5738402">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738408">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738422">case</span>&nbsp;<span class="ident" id="5738427">token</span><span class="op" id="5738432">.</span><span class="ident" id="5738433">EOF</span><span class="op" id="5738436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738441">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738454">p</span><span class="op" id="5738455">.</span><span class="ident" id="5738456">next</span><span class="op" id="5738460">(</span><span class="op" id="5738461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738464">}</span><br>
<span class="lineno"></span><span class="op" id="5738466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5738469">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5738539">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="5738611">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5738648">//</span><br>
<span class="lineno"></span><span class="comment" id="5738651">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="5738726">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5738800">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5738879">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5738954">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="5738967">//</span><br>
<span class="lineno">505</span><span class="keyword" id="5738970">func</span>&nbsp;<span class="op" id="5738975">(</span><span class="ident" id="5738976">p</span>&nbsp;<span class="op" id="5738978">*</span><span class="ident" id="5738979">parser</span><span class="op" id="5738985">)</span>&nbsp;<span class="ident" id="5738987">safePos</span><span class="op" id="5738994">(</span><span class="ident" id="5738995">pos</span>&nbsp;<span class="ident" id="5738999">token</span><span class="op" id="5739004">.</span><span class="ident" id="5739005">Pos</span><span class="op" id="5739008">)</span>&nbsp;<span class="op" id="5739010">(</span><span class="ident" id="5739011">res</span>&nbsp;<span class="ident" id="5739015">token</span><span class="op" id="5739020">.</span><span class="ident" id="5739021">Pos</span><span class="op" id="5739024">)</span>&nbsp;<span class="op" id="5739026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739029">defer</span>&nbsp;<span class="keyword" id="5739035">func</span><span class="op" id="5739039">(</span><span class="op" id="5739040">)</span>&nbsp;<span class="op" id="5739042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739046">if</span>&nbsp;<span class="builtinfunc" id="5739049">recover</span><span class="op" id="5739056">(</span><span class="op" id="5739057">)</span>&nbsp;<span class="op" id="5739059">!=</span>&nbsp;<span class="ident" id="5739062">nil</span>&nbsp;<span class="op" id="5739066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739071">res</span>&nbsp;<span class="op" id="5739075">=</span>&nbsp;<span class="ident" id="5739077">token</span><span class="op" id="5739082">.</span><span class="ident" id="5739083">Pos</span><span class="op" id="5739086">(</span><span class="ident" id="5739087">p</span><span class="op" id="5739088">.</span><span class="ident" id="5739089">file</span><span class="op" id="5739093">.</span><span class="ident" id="5739094">Base</span><span class="op" id="5739098">(</span><span class="op" id="5739099">)</span>&nbsp;<span class="op" id="5739101">+</span>&nbsp;<span class="ident" id="5739103">p</span><span class="op" id="5739104">.</span><span class="ident" id="5739105">file</span><span class="op" id="5739109">.</span><span class="ident" id="5739110">Size</span><span class="op" id="5739114">(</span><span class="op" id="5739115">)</span><span class="op" id="5739116">)</span>&nbsp;<span class="comment" id="5739118">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739136">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739139">}</span><span class="op" id="5739140">(</span><span class="op" id="5739141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739144">_</span>&nbsp;<span class="op" id="5739146">=</span>&nbsp;<span class="ident" id="5739148">p</span><span class="op" id="5739149">.</span><span class="ident" id="5739150">file</span><span class="op" id="5739154">.</span><span class="ident" id="5739155">Offset</span><span class="op" id="5739161">(</span><span class="ident" id="5739162">pos</span><span class="op" id="5739165">)</span>&nbsp;<span class="comment" id="5739167">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739215">return</span>&nbsp;<span class="ident" id="5739222">pos</span><br>
<span class="lineno"></span><span class="op" id="5739226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="5739229">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5739309">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5739325">func</span>&nbsp;<span class="op" id="5739330">(</span><span class="ident" id="5739331">p</span>&nbsp;<span class="op" id="5739333">*</span><span class="ident" id="5739334">parser</span><span class="op" id="5739340">)</span>&nbsp;<span class="ident" id="5739342">parseIdent</span><span class="op" id="5739352">(</span><span class="op" id="5739353">)</span>&nbsp;<span class="op" id="5739355">*</span><span class="ident" id="5739356">ast</span><span class="op" id="5739359">.</span><span class="ident" id="5739360">Ident</span>&nbsp;<span class="op" id="5739366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739369">pos</span>&nbsp;<span class="op" id="5739373">:=</span>&nbsp;<span class="ident" id="5739376">p</span><span class="op" id="5739377">.</span><span class="ident" id="5739378">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739383">name</span>&nbsp;<span class="op" id="5739388">:=</span>&nbsp;<span class="string" id="5739391">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739396">if</span>&nbsp;<span class="ident" id="5739399">p</span><span class="op" id="5739400">.</span><span class="ident" id="5739401">tok</span>&nbsp;<span class="op" id="5739405">==</span>&nbsp;<span class="ident" id="5739408">token</span><span class="op" id="5739413">.</span><span class="ident" id="5739414">IDENT</span>&nbsp;<span class="op" id="5739420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739424">name</span>&nbsp;<span class="op" id="5739429">=</span>&nbsp;<span class="ident" id="5739431">p</span><span class="op" id="5739432">.</span><span class="ident" id="5739433">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739439">p</span><span class="op" id="5739440">.</span><span class="ident" id="5739441">next</span><span class="op" id="5739445">(</span><span class="op" id="5739446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739449">}</span>&nbsp;<span class="keyword" id="5739451">else</span>&nbsp;<span class="op" id="5739456">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739460">p</span><span class="op" id="5739461">.</span><span class="ident" id="5739462">expect</span><span class="op" id="5739468">(</span><span class="ident" id="5739469">token</span><span class="op" id="5739474">.</span><span class="ident" id="5739475">IDENT</span><span class="op" id="5739480">)</span>&nbsp;<span class="comment" id="5739482">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739517">return</span>&nbsp;<span class="op" id="5739524">&amp;</span><span class="ident" id="5739525">ast</span><span class="op" id="5739528">.</span><span class="ident" id="5739529">Ident</span><span class="op" id="5739534">{</span><span class="ident" id="5739535">NamePos</span><span class="op" id="5739542">:</span>&nbsp;<span class="ident" id="5739544">pos</span><span class="op" id="5739547">,</span>&nbsp;<span class="ident" id="5739549">Name</span><span class="op" id="5739553">:</span>&nbsp;<span class="ident" id="5739555">name</span><span class="op" id="5739559">}</span><br>
<span class="lineno"></span><span class="op" id="5739561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="5739564">func</span>&nbsp;<span class="op" id="5739569">(</span><span class="ident" id="5739570">p</span>&nbsp;<span class="op" id="5739572">*</span><span class="ident" id="5739573">parser</span><span class="op" id="5739579">)</span>&nbsp;<span class="ident" id="5739581">parseIdentList</span><span class="op" id="5739595">(</span><span class="op" id="5739596">)</span>&nbsp;<span class="op" id="5739598">(</span><span class="ident" id="5739599">list</span>&nbsp;<span class="op" id="5739604">[</span><span class="op" id="5739605">]</span><span class="op" id="5739606">*</span><span class="ident" id="5739607">ast</span><span class="op" id="5739610">.</span><span class="ident" id="5739611">Ident</span><span class="op" id="5739616">)</span>&nbsp;<span class="op" id="5739618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739621">if</span>&nbsp;<span class="ident" id="5739624">p</span><span class="op" id="5739625">.</span><span class="ident" id="5739626">trace</span>&nbsp;<span class="op" id="5739632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739636">defer</span>&nbsp;<span class="ident" id="5739642">un</span><span class="op" id="5739644">(</span><span class="ident" id="5739645">trace</span><span class="op" id="5739650">(</span><span class="ident" id="5739651">p</span><span class="op" id="5739652">,</span>&nbsp;<span class="string" id="5739654">&#34;IdentList&#34;</span><span class="op" id="5739665">)</span><span class="op" id="5739666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739673">list</span>&nbsp;<span class="op" id="5739678">=</span>&nbsp;<span class="builtinfunc" id="5739680">append</span><span class="op" id="5739686">(</span><span class="ident" id="5739687">list</span><span class="op" id="5739691">,</span>&nbsp;<span class="ident" id="5739693">p</span><span class="op" id="5739694">.</span><span class="ident" id="5739695">parseIdent</span><span class="op" id="5739705">(</span><span class="op" id="5739706">)</span><span class="op" id="5739707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739710">for</span>&nbsp;<span class="ident" id="5739714">p</span><span class="op" id="5739715">.</span><span class="ident" id="5739716">tok</span>&nbsp;<span class="op" id="5739720">==</span>&nbsp;<span class="ident" id="5739723">token</span><span class="op" id="5739728">.</span><span class="ident" id="5739729">COMMA</span>&nbsp;<span class="op" id="5739735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739739">p</span><span class="op" id="5739740">.</span><span class="ident" id="5739741">next</span><span class="op" id="5739745">(</span><span class="op" id="5739746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739750">list</span>&nbsp;<span class="op" id="5739755">=</span>&nbsp;<span class="builtinfunc" id="5739757">append</span><span class="op" id="5739763">(</span><span class="ident" id="5739764">list</span><span class="op" id="5739768">,</span>&nbsp;<span class="ident" id="5739770">p</span><span class="op" id="5739771">.</span><span class="ident" id="5739772">parseIdent</span><span class="op" id="5739782">(</span><span class="op" id="5739783">)</span><span class="op" id="5739784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739787">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739791">return</span><br>
<span class="lineno"></span><span class="op" id="5739798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5739801">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="5739881">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5739904">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5739983">func</span>&nbsp;<span class="op" id="5739988">(</span><span class="ident" id="5739989">p</span>&nbsp;<span class="op" id="5739991">*</span><span class="ident" id="5739992">parser</span><span class="op" id="5739998">)</span>&nbsp;<span class="ident" id="5740000">parseExprList</span><span class="op" id="5740013">(</span><span class="ident" id="5740014">lhs</span>&nbsp;<span class="builtintype" id="5740018">bool</span><span class="op" id="5740022">)</span>&nbsp;<span class="op" id="5740024">(</span><span class="ident" id="5740025">list</span>&nbsp;<span class="op" id="5740030">[</span><span class="op" id="5740031">]</span><span class="ident" id="5740032">ast</span><span class="op" id="5740035">.</span><span class="ident" id="5740036">Expr</span><span class="op" id="5740040">)</span>&nbsp;<span class="op" id="5740042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5740045">if</span>&nbsp;<span class="ident" id="5740048">p</span><span class="op" id="5740049">.</span><span class="ident" id="5740050">trace</span>&nbsp;<span class="op" id="5740056">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5740060">defer</span>&nbsp;<span class="ident" id="5740066">un</span><span class="op" id="5740068">(</span><span class="ident" id="5740069">trace</span><span class="op" id="5740074">(</span><span class="ident" id="5740075">p</span><span class="op" id="5740076">,</span>&nbsp;<span class="string" id="5740078">&#34;ExpressionList&#34;</span><span class="op" id="5740094">)</span><span class="op" id="5740095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5740098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5740102">list</span>&nbsp;<span class="op" id="5740107">=</span>&nbsp;<span class="builtinfunc" id="5740109">append</span><span class="op" id="5740115">(</span><span class="ident" id="5740116">list</span><span class="op" id="5740120">,</span>&nbsp;<span class="ident" id="5740122">p</span><span class="op" id="5740123">.</span><span class="ident" id="5740124">checkExpr</span><span class="op" id="5740133">(</span><span class="ident" id="5740134">p</span><span class="op" id="5740135">.</span><span class="ident" id="5740136">parseExpr</span><span class="op" id="5740145">(</span><span class="ident" id="5740146">lhs</span><span class="op" id="5740149">)</span><span class="op" id="5740150">)</span><span class="op" id="5740151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5740154">for</span>&nbsp;<span class="ident" id="5740158">p</span><span class="op" id="5740159">.</span><span class="ident" id="5740160">tok</span>&nbsp;<span class="op" id="5740164">==</span>&nbsp;<span class="ident" id="5740167">token</span><span class="op" id="5740172">.</span><span class="ident" id="5740173">COMMA</span>&nbsp;<span class="op" id="5740179">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5740183">p</span><span class="op" id="5740184">.</span><span class="ident" id="5740185">next</span><span class="op" id="5740189">(</span><span class="op" id="5740190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5740194">list</span>&nbsp;<span class="op" id="5740199">=</span>&nbsp;<span class="builtinfunc" id="5740201">append</span><span class="op" id="5740207">(</span><span class="ident" id="5740208">list</span><span class="op" id="5740212">,</span>&nbsp;<span class="ident" id="5740214">p</span><span class="op" id="5740215">.</span><span class="ident" id="5740216">checkExpr</span><span class="op" id="5740225">(</span><span class="ident" id="5740226">p</span><span class="op" id="5740227">.</span><span class="ident" id="5740228">parseExpr</span><span class="op" id="5740237">(</span><span class="ident" id="5740238">lhs</span><span class="op" id="5740241">)</span><span class="op" id="5740242">)</span><span class="op" id="5740243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5740246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5740250">return</span><br>
<span class="lineno">560</span><span class="op" id="5740257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5740260">func</span>&nbsp;<span class="op" id="5740265">(</span><span class="ident" id="5740266">p</span>&nbsp;<span class="op" id="5740268">*</span><span class="ident" id="5740269">parser</span><span class="op" id="5740275">)</span>&nbsp;<span class="ident" id="5740277">parseLhsList</span><span class="op" id="5740289">(</span><span class="op" id="5740290">)</span>&nbsp;<span class="op" id="5740292">[</span><span class="op" id="5740293">]</span><span class="ident" id="5740294">ast</span><span class="op" id="5740297">.</span><span class="ident" id="5740298">Expr</span>&nbsp;<span class="op" id="5740303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5740306">old</span>&nbsp;<span class="op" id="5740310">:=</span>&nbsp;<span class="ident" id="5740313">p</span><span class="op" id="5740314">.</span><span class="ident" id="5740315">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5740322">p</span><span class="op" id="5740323">.</span><span class="ident" id="5740324">inRhs</span>&nbsp;<span class="op" id="5740330">=</span>&nbsp;<span class="builtintype" id="5740332">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5740339">list</span>&nbsp;<span class="op" id="5740344">:=</span>&nbsp;<span class="ident" id="5740347">p</span><span class="op" id="5740348">.</span><span class="ident" id="5740349">parseExprList</span><span class="op" id="5740362">(</span><span class="builtintype" id="5740363">true</span><span class="op" id="5740367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5740370">switch</span>&nbsp;<span class="ident" id="5740377">p</span><span class="op" id="5740378">.</span><span class="ident" id="5740379">tok</span>&nbsp;<span class="op" id="5740383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5740386">case</span>&nbsp;<span class="ident" id="5740391">token</span><span class="op" id="5740396">.</span><span class="ident" id="5740397">DEFINE</span><span class="op" id="5740403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740407">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740448">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740490">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740550">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5740575">case</span>&nbsp;<span class="ident" id="5740580">token</span><span class="op" id="5740585">.</span><span class="ident" id="5740586">COLON</span><span class="op" id="5740591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740595">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740665">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740737">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740766">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740823">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740894">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5740963">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741008">default</span><span class="op" id="5741015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5741019">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741063">for</span>&nbsp;<span class="ident" id="5741067">_</span><span class="op" id="5741068">,</span>&nbsp;<span class="ident" id="5741070">x</span>&nbsp;<span class="op" id="5741072">:=</span>&nbsp;<span class="keyword" id="5741075">range</span>&nbsp;<span class="ident" id="5741081">list</span>&nbsp;<span class="op" id="5741086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741091">p</span><span class="op" id="5741092">.</span><span class="ident" id="5741093">resolve</span><span class="op" id="5741100">(</span><span class="ident" id="5741101">x</span><span class="op" id="5741102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5741106">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5741109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741112">p</span><span class="op" id="5741113">.</span><span class="ident" id="5741114">inRhs</span>&nbsp;<span class="op" id="5741120">=</span>&nbsp;<span class="ident" id="5741122">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741127">return</span>&nbsp;<span class="ident" id="5741134">list</span><br>
<span class="lineno"></span><span class="op" id="5741139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="5741142">func</span>&nbsp;<span class="op" id="5741147">(</span><span class="ident" id="5741148">p</span>&nbsp;<span class="op" id="5741150">*</span><span class="ident" id="5741151">parser</span><span class="op" id="5741157">)</span>&nbsp;<span class="ident" id="5741159">parseRhsList</span><span class="op" id="5741171">(</span><span class="op" id="5741172">)</span>&nbsp;<span class="op" id="5741174">[</span><span class="op" id="5741175">]</span><span class="ident" id="5741176">ast</span><span class="op" id="5741179">.</span><span class="ident" id="5741180">Expr</span>&nbsp;<span class="op" id="5741185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741188">old</span>&nbsp;<span class="op" id="5741192">:=</span>&nbsp;<span class="ident" id="5741195">p</span><span class="op" id="5741196">.</span><span class="ident" id="5741197">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741204">p</span><span class="op" id="5741205">.</span><span class="ident" id="5741206">inRhs</span>&nbsp;<span class="op" id="5741212">=</span>&nbsp;<span class="builtintype" id="5741214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741220">list</span>&nbsp;<span class="op" id="5741225">:=</span>&nbsp;<span class="ident" id="5741228">p</span><span class="op" id="5741229">.</span><span class="ident" id="5741230">parseExprList</span><span class="op" id="5741243">(</span><span class="builtintype" id="5741244">false</span><span class="op" id="5741249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741252">p</span><span class="op" id="5741253">.</span><span class="ident" id="5741254">inRhs</span>&nbsp;<span class="op" id="5741260">=</span>&nbsp;<span class="ident" id="5741262">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741267">return</span>&nbsp;<span class="ident" id="5741274">list</span><br>
<span class="lineno"></span><span class="op" id="5741279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5741282">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5741362">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="5741372">func</span>&nbsp;<span class="op" id="5741377">(</span><span class="ident" id="5741378">p</span>&nbsp;<span class="op" id="5741380">*</span><span class="ident" id="5741381">parser</span><span class="op" id="5741387">)</span>&nbsp;<span class="ident" id="5741389">parseType</span><span class="op" id="5741398">(</span><span class="op" id="5741399">)</span>&nbsp;<span class="ident" id="5741401">ast</span><span class="op" id="5741404">.</span><span class="ident" id="5741405">Expr</span>&nbsp;<span class="op" id="5741410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741413">if</span>&nbsp;<span class="ident" id="5741416">p</span><span class="op" id="5741417">.</span><span class="ident" id="5741418">trace</span>&nbsp;<span class="op" id="5741424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741428">defer</span>&nbsp;<span class="ident" id="5741434">un</span><span class="op" id="5741436">(</span><span class="ident" id="5741437">trace</span><span class="op" id="5741442">(</span><span class="ident" id="5741443">p</span><span class="op" id="5741444">,</span>&nbsp;<span class="string" id="5741446">&#34;Type&#34;</span><span class="op" id="5741452">)</span><span class="op" id="5741453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5741456">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741460">typ</span>&nbsp;<span class="op" id="5741464">:=</span>&nbsp;<span class="ident" id="5741467">p</span><span class="op" id="5741468">.</span><span class="ident" id="5741469">tryType</span><span class="op" id="5741476">(</span><span class="op" id="5741477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741481">if</span>&nbsp;<span class="ident" id="5741484">typ</span>&nbsp;<span class="op" id="5741488">==</span>&nbsp;<span class="ident" id="5741491">nil</span>&nbsp;<span class="op" id="5741495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741499">pos</span>&nbsp;<span class="op" id="5741503">:=</span>&nbsp;<span class="ident" id="5741506">p</span><span class="op" id="5741507">.</span><span class="ident" id="5741508">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741514">p</span><span class="op" id="5741515">.</span><span class="ident" id="5741516">errorExpected</span><span class="op" id="5741529">(</span><span class="ident" id="5741530">pos</span><span class="op" id="5741533">,</span>&nbsp;<span class="string" id="5741535">&#34;type&#34;</span><span class="op" id="5741541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741545">p</span><span class="op" id="5741546">.</span><span class="ident" id="5741547">next</span><span class="op" id="5741551">(</span><span class="op" id="5741552">)</span>&nbsp;<span class="comment" id="5741554">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741573">return</span>&nbsp;<span class="op" id="5741580">&amp;</span><span class="ident" id="5741581">ast</span><span class="op" id="5741584">.</span><span class="ident" id="5741585">BadExpr</span><span class="op" id="5741592">{</span><span class="ident" id="5741593">From</span><span class="op" id="5741597">:</span>&nbsp;<span class="ident" id="5741599">pos</span><span class="op" id="5741602">,</span>&nbsp;<span class="ident" id="5741604">To</span><span class="op" id="5741606">:</span>&nbsp;<span class="ident" id="5741608">p</span><span class="op" id="5741609">.</span><span class="ident" id="5741610">pos</span><span class="op" id="5741613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5741616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741620">return</span>&nbsp;<span class="ident" id="5741627">typ</span><br>
<span class="lineno"></span><span class="op" id="5741631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5741634">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5741689">func</span>&nbsp;<span class="op" id="5741694">(</span><span class="ident" id="5741695">p</span>&nbsp;<span class="op" id="5741697">*</span><span class="ident" id="5741698">parser</span><span class="op" id="5741704">)</span>&nbsp;<span class="ident" id="5741706">parseTypeName</span><span class="op" id="5741719">(</span><span class="op" id="5741720">)</span>&nbsp;<span class="ident" id="5741722">ast</span><span class="op" id="5741725">.</span><span class="ident" id="5741726">Expr</span>&nbsp;<span class="op" id="5741731">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741734">if</span>&nbsp;<span class="ident" id="5741737">p</span><span class="op" id="5741738">.</span><span class="ident" id="5741739">trace</span>&nbsp;<span class="op" id="5741745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741749">defer</span>&nbsp;<span class="ident" id="5741755">un</span><span class="op" id="5741757">(</span><span class="ident" id="5741758">trace</span><span class="op" id="5741763">(</span><span class="ident" id="5741764">p</span><span class="op" id="5741765">,</span>&nbsp;<span class="string" id="5741767">&#34;TypeName&#34;</span><span class="op" id="5741777">)</span><span class="op" id="5741778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5741781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741785">ident</span>&nbsp;<span class="op" id="5741791">:=</span>&nbsp;<span class="ident" id="5741794">p</span><span class="op" id="5741795">.</span><span class="ident" id="5741796">parseIdent</span><span class="op" id="5741806">(</span><span class="op" id="5741807">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5741810">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741877">if</span>&nbsp;<span class="ident" id="5741880">p</span><span class="op" id="5741881">.</span><span class="ident" id="5741882">tok</span>&nbsp;<span class="op" id="5741886">==</span>&nbsp;<span class="ident" id="5741889">token</span><span class="op" id="5741894">.</span><span class="ident" id="5741895">PERIOD</span>&nbsp;<span class="op" id="5741902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5741906">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741935">p</span><span class="op" id="5741936">.</span><span class="ident" id="5741937">next</span><span class="op" id="5741941">(</span><span class="op" id="5741942">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741946">p</span><span class="op" id="5741947">.</span><span class="ident" id="5741948">resolve</span><span class="op" id="5741955">(</span><span class="ident" id="5741956">ident</span><span class="op" id="5741961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5741965">sel</span>&nbsp;<span class="op" id="5741969">:=</span>&nbsp;<span class="ident" id="5741972">p</span><span class="op" id="5741973">.</span><span class="ident" id="5741974">parseIdent</span><span class="op" id="5741984">(</span><span class="op" id="5741985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5741989">return</span>&nbsp;<span class="op" id="5741996">&amp;</span><span class="ident" id="5741997">ast</span><span class="op" id="5742000">.</span><span class="ident" id="5742001">SelectorExpr</span><span class="op" id="5742013">{</span><span class="ident" id="5742014">X</span><span class="op" id="5742015">:</span>&nbsp;<span class="ident" id="5742017">ident</span><span class="op" id="5742022">,</span>&nbsp;<span class="ident" id="5742024">Sel</span><span class="op" id="5742027">:</span>&nbsp;<span class="ident" id="5742029">sel</span><span class="op" id="5742032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5742035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742039">return</span>&nbsp;<span class="ident" id="5742046">ident</span><br>
<span class="lineno"></span><span class="op" id="5742052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5742055">func</span>&nbsp;<span class="op" id="5742060">(</span><span class="ident" id="5742061">p</span>&nbsp;<span class="op" id="5742063">*</span><span class="ident" id="5742064">parser</span><span class="op" id="5742070">)</span>&nbsp;<span class="ident" id="5742072">parseArrayType</span><span class="op" id="5742086">(</span><span class="op" id="5742087">)</span>&nbsp;<span class="ident" id="5742089">ast</span><span class="op" id="5742092">.</span><span class="ident" id="5742093">Expr</span>&nbsp;<span class="op" id="5742098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742101">if</span>&nbsp;<span class="ident" id="5742104">p</span><span class="op" id="5742105">.</span><span class="ident" id="5742106">trace</span>&nbsp;<span class="op" id="5742112">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742116">defer</span>&nbsp;<span class="ident" id="5742122">un</span><span class="op" id="5742124">(</span><span class="ident" id="5742125">trace</span><span class="op" id="5742130">(</span><span class="ident" id="5742131">p</span><span class="op" id="5742132">,</span>&nbsp;<span class="string" id="5742134">&#34;ArrayType&#34;</span><span class="op" id="5742145">)</span><span class="op" id="5742146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5742149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742153">lbrack</span>&nbsp;<span class="op" id="5742160">:=</span>&nbsp;<span class="ident" id="5742163">p</span><span class="op" id="5742164">.</span><span class="ident" id="5742165">expect</span><span class="op" id="5742171">(</span><span class="ident" id="5742172">token</span><span class="op" id="5742177">.</span><span class="ident" id="5742178">LBRACK</span><span class="op" id="5742184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742187">p</span><span class="op" id="5742188">.</span><span class="ident" id="5742189">exprLev</span><span class="op" id="5742196">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742200">var</span>&nbsp;<span class="builtinfunc" id="5742204">len</span>&nbsp;<span class="ident" id="5742208">ast</span><span class="op" id="5742211">.</span><span class="ident" id="5742212">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5742218">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742277">if</span>&nbsp;<span class="ident" id="5742280">p</span><span class="op" id="5742281">.</span><span class="ident" id="5742282">tok</span>&nbsp;<span class="op" id="5742286">==</span>&nbsp;<span class="ident" id="5742289">token</span><span class="op" id="5742294">.</span><span class="ident" id="5742295">ELLIPSIS</span>&nbsp;<span class="op" id="5742304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5742308">len</span>&nbsp;<span class="op" id="5742312">=</span>&nbsp;<span class="op" id="5742314">&amp;</span><span class="ident" id="5742315">ast</span><span class="op" id="5742318">.</span><span class="ident" id="5742319">Ellipsis</span><span class="op" id="5742327">{</span><span class="ident" id="5742328">Ellipsis</span><span class="op" id="5742336">:</span>&nbsp;<span class="ident" id="5742338">p</span><span class="op" id="5742339">.</span><span class="ident" id="5742340">pos</span><span class="op" id="5742343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742347">p</span><span class="op" id="5742348">.</span><span class="ident" id="5742349">next</span><span class="op" id="5742353">(</span><span class="op" id="5742354">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5742357">}</span>&nbsp;<span class="keyword" id="5742359">else</span>&nbsp;<span class="keyword" id="5742364">if</span>&nbsp;<span class="ident" id="5742367">p</span><span class="op" id="5742368">.</span><span class="ident" id="5742369">tok</span>&nbsp;<span class="op" id="5742373">!=</span>&nbsp;<span class="ident" id="5742376">token</span><span class="op" id="5742381">.</span><span class="ident" id="5742382">RBRACK</span>&nbsp;<span class="op" id="5742389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5742393">len</span>&nbsp;<span class="op" id="5742397">=</span>&nbsp;<span class="ident" id="5742399">p</span><span class="op" id="5742400">.</span><span class="ident" id="5742401">parseRhs</span><span class="op" id="5742409">(</span><span class="op" id="5742410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5742413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742416">p</span><span class="op" id="5742417">.</span><span class="ident" id="5742418">exprLev</span><span class="op" id="5742425">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742429">p</span><span class="op" id="5742430">.</span><span class="ident" id="5742431">expect</span><span class="op" id="5742437">(</span><span class="ident" id="5742438">token</span><span class="op" id="5742443">.</span><span class="ident" id="5742444">RBRACK</span><span class="op" id="5742450">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742453">elt</span>&nbsp;<span class="op" id="5742457">:=</span>&nbsp;<span class="ident" id="5742460">p</span><span class="op" id="5742461">.</span><span class="ident" id="5742462">parseType</span><span class="op" id="5742471">(</span><span class="op" id="5742472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742476">return</span>&nbsp;<span class="op" id="5742483">&amp;</span><span class="ident" id="5742484">ast</span><span class="op" id="5742487">.</span><span class="ident" id="5742488">ArrayType</span><span class="op" id="5742497">{</span><span class="ident" id="5742498">Lbrack</span><span class="op" id="5742504">:</span>&nbsp;<span class="ident" id="5742506">lbrack</span><span class="op" id="5742512">,</span>&nbsp;<span class="ident" id="5742514">Len</span><span class="op" id="5742517">:</span>&nbsp;<span class="builtinfunc" id="5742519">len</span><span class="op" id="5742522">,</span>&nbsp;<span class="ident" id="5742524">Elt</span><span class="op" id="5742527">:</span>&nbsp;<span class="ident" id="5742529">elt</span><span class="op" id="5742532">}</span><br>
<span class="lineno"></span><span class="op" id="5742534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="5742537">func</span>&nbsp;<span class="op" id="5742542">(</span><span class="ident" id="5742543">p</span>&nbsp;<span class="op" id="5742545">*</span><span class="ident" id="5742546">parser</span><span class="op" id="5742552">)</span>&nbsp;<span class="ident" id="5742554">makeIdentList</span><span class="op" id="5742567">(</span><span class="ident" id="5742568">list</span>&nbsp;<span class="op" id="5742573">[</span><span class="op" id="5742574">]</span><span class="ident" id="5742575">ast</span><span class="op" id="5742578">.</span><span class="ident" id="5742579">Expr</span><span class="op" id="5742583">)</span>&nbsp;<span class="op" id="5742585">[</span><span class="op" id="5742586">]</span><span class="op" id="5742587">*</span><span class="ident" id="5742588">ast</span><span class="op" id="5742591">.</span><span class="ident" id="5742592">Ident</span>&nbsp;<span class="op" id="5742598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742601">idents</span>&nbsp;<span class="op" id="5742608">:=</span>&nbsp;<span class="builtinfunc" id="5742611">make</span><span class="op" id="5742615">(</span><span class="op" id="5742616">[</span><span class="op" id="5742617">]</span><span class="op" id="5742618">*</span><span class="ident" id="5742619">ast</span><span class="op" id="5742622">.</span><span class="ident" id="5742623">Ident</span><span class="op" id="5742628">,</span>&nbsp;<span class="builtinfunc" id="5742630">len</span><span class="op" id="5742633">(</span><span class="ident" id="5742634">list</span><span class="op" id="5742638">)</span><span class="op" id="5742639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742642">for</span>&nbsp;<span class="ident" id="5742646">i</span><span class="op" id="5742647">,</span>&nbsp;<span class="ident" id="5742649">x</span>&nbsp;<span class="op" id="5742651">:=</span>&nbsp;<span class="keyword" id="5742654">range</span>&nbsp;<span class="ident" id="5742660">list</span>&nbsp;<span class="op" id="5742665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742669">ident</span><span class="op" id="5742674">,</span>&nbsp;<span class="ident" id="5742676">isIdent</span>&nbsp;<span class="op" id="5742684">:=</span>&nbsp;<span class="ident" id="5742687">x</span><span class="op" id="5742688">.</span><span class="op" id="5742689">(</span><span class="op" id="5742690">*</span><span class="ident" id="5742691">ast</span><span class="op" id="5742694">.</span><span class="ident" id="5742695">Ident</span><span class="op" id="5742700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742704">if</span>&nbsp;<span class="op" id="5742707">!</span><span class="ident" id="5742708">isIdent</span>&nbsp;<span class="op" id="5742716">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742721">if</span>&nbsp;<span class="ident" id="5742724">_</span><span class="op" id="5742725">,</span>&nbsp;<span class="ident" id="5742727">isBad</span>&nbsp;<span class="op" id="5742733">:=</span>&nbsp;<span class="ident" id="5742736">x</span><span class="op" id="5742737">.</span><span class="op" id="5742738">(</span><span class="op" id="5742739">*</span><span class="ident" id="5742740">ast</span><span class="op" id="5742743">.</span><span class="ident" id="5742744">BadExpr</span><span class="op" id="5742751">)</span><span class="op" id="5742752">;</span>&nbsp;<span class="op" id="5742754">!</span><span class="ident" id="5742755">isBad</span>&nbsp;<span class="op" id="5742761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5742767">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742810">p</span><span class="op" id="5742811">.</span><span class="ident" id="5742812">errorExpected</span><span class="op" id="5742825">(</span><span class="ident" id="5742826">x</span><span class="op" id="5742827">.</span><span class="ident" id="5742828">Pos</span><span class="op" id="5742831">(</span><span class="op" id="5742832">)</span><span class="op" id="5742833">,</span>&nbsp;<span class="string" id="5742835">&#34;identifier&#34;</span><span class="op" id="5742847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5742852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742857">ident</span>&nbsp;<span class="op" id="5742863">=</span>&nbsp;<span class="op" id="5742865">&amp;</span><span class="ident" id="5742866">ast</span><span class="op" id="5742869">.</span><span class="ident" id="5742870">Ident</span><span class="op" id="5742875">{</span><span class="ident" id="5742876">NamePos</span><span class="op" id="5742883">:</span>&nbsp;<span class="ident" id="5742885">x</span><span class="op" id="5742886">.</span><span class="ident" id="5742887">Pos</span><span class="op" id="5742890">(</span><span class="op" id="5742891">)</span><span class="op" id="5742892">,</span>&nbsp;<span class="ident" id="5742894">Name</span><span class="op" id="5742898">:</span>&nbsp;<span class="string" id="5742900">&#34;_&#34;</span><span class="op" id="5742903">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5742907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5742911">idents</span><span class="op" id="5742917">[</span><span class="ident" id="5742918">i</span><span class="op" id="5742919">]</span>&nbsp;<span class="op" id="5742921">=</span>&nbsp;<span class="ident" id="5742923">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5742930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5742933">return</span>&nbsp;<span class="ident" id="5742940">idents</span><br>
<span class="lineno"></span><span class="op" id="5742947">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="5742950">func</span>&nbsp;<span class="op" id="5742955">(</span><span class="ident" id="5742956">p</span>&nbsp;<span class="op" id="5742958">*</span><span class="ident" id="5742959">parser</span><span class="op" id="5742965">)</span>&nbsp;<span class="ident" id="5742967">parseFieldDecl</span><span class="op" id="5742981">(</span><span class="ident" id="5742982">scope</span>&nbsp;<span class="op" id="5742988">*</span><span class="ident" id="5742989">ast</span><span class="op" id="5742992">.</span><span class="ident" id="5742993">Scope</span><span class="op" id="5742998">)</span>&nbsp;<span class="op" id="5743000">*</span><span class="ident" id="5743001">ast</span><span class="op" id="5743004">.</span><span class="ident" id="5743005">Field</span>&nbsp;<span class="op" id="5743011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743014">if</span>&nbsp;<span class="ident" id="5743017">p</span><span class="op" id="5743018">.</span><span class="ident" id="5743019">trace</span>&nbsp;<span class="op" id="5743025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743029">defer</span>&nbsp;<span class="ident" id="5743035">un</span><span class="op" id="5743037">(</span><span class="ident" id="5743038">trace</span><span class="op" id="5743043">(</span><span class="ident" id="5743044">p</span><span class="op" id="5743045">,</span>&nbsp;<span class="string" id="5743047">&#34;FieldDecl&#34;</span><span class="op" id="5743058">)</span><span class="op" id="5743059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743062">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743066">doc</span>&nbsp;<span class="op" id="5743070">:=</span>&nbsp;<span class="ident" id="5743073">p</span><span class="op" id="5743074">.</span><span class="ident" id="5743075">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743089">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743103">list</span><span class="op" id="5743107">,</span>&nbsp;<span class="ident" id="5743109">typ</span>&nbsp;<span class="op" id="5743113">:=</span>&nbsp;<span class="ident" id="5743116">p</span><span class="op" id="5743117">.</span><span class="ident" id="5743118">parseVarList</span><span class="op" id="5743130">(</span><span class="builtintype" id="5743131">false</span><span class="op" id="5743136">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743140">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743148">var</span>&nbsp;<span class="ident" id="5743152">tag</span>&nbsp;<span class="op" id="5743156">*</span><span class="ident" id="5743157">ast</span><span class="op" id="5743160">.</span><span class="ident" id="5743161">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743171">if</span>&nbsp;<span class="ident" id="5743174">p</span><span class="op" id="5743175">.</span><span class="ident" id="5743176">tok</span>&nbsp;<span class="op" id="5743180">==</span>&nbsp;<span class="ident" id="5743183">token</span><span class="op" id="5743188">.</span><span class="ident" id="5743189">STRING</span>&nbsp;<span class="op" id="5743196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743200">tag</span>&nbsp;<span class="op" id="5743204">=</span>&nbsp;<span class="op" id="5743206">&amp;</span><span class="ident" id="5743207">ast</span><span class="op" id="5743210">.</span><span class="ident" id="5743211">BasicLit</span><span class="op" id="5743219">{</span><span class="ident" id="5743220">ValuePos</span><span class="op" id="5743228">:</span>&nbsp;<span class="ident" id="5743230">p</span><span class="op" id="5743231">.</span><span class="ident" id="5743232">pos</span><span class="op" id="5743235">,</span>&nbsp;<span class="ident" id="5743237">Kind</span><span class="op" id="5743241">:</span>&nbsp;<span class="ident" id="5743243">p</span><span class="op" id="5743244">.</span><span class="ident" id="5743245">tok</span><span class="op" id="5743248">,</span>&nbsp;<span class="ident" id="5743250">Value</span><span class="op" id="5743255">:</span>&nbsp;<span class="ident" id="5743257">p</span><span class="op" id="5743258">.</span><span class="ident" id="5743259">lit</span><span class="op" id="5743262">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743266">p</span><span class="op" id="5743267">.</span><span class="ident" id="5743268">next</span><span class="op" id="5743272">(</span><span class="op" id="5743273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743280">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743297">var</span>&nbsp;<span class="ident" id="5743301">idents</span>&nbsp;<span class="op" id="5743308">[</span><span class="op" id="5743309">]</span><span class="op" id="5743310">*</span><span class="ident" id="5743311">ast</span><span class="op" id="5743314">.</span><span class="ident" id="5743315">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743322">if</span>&nbsp;<span class="ident" id="5743325">typ</span>&nbsp;<span class="op" id="5743329">!=</span>&nbsp;<span class="ident" id="5743332">nil</span>&nbsp;<span class="op" id="5743336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743340">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743365">idents</span>&nbsp;<span class="op" id="5743372">=</span>&nbsp;<span class="ident" id="5743374">p</span><span class="op" id="5743375">.</span><span class="ident" id="5743376">makeIdentList</span><span class="op" id="5743389">(</span><span class="ident" id="5743390">list</span><span class="op" id="5743394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743397">}</span>&nbsp;<span class="keyword" id="5743399">else</span>&nbsp;<span class="op" id="5743404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743408">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743445">typ</span>&nbsp;<span class="op" id="5743449">=</span>&nbsp;<span class="ident" id="5743451">list</span><span class="op" id="5743455">[</span><span class="num" id="5743456">0</span><span class="op" id="5743457">]</span>&nbsp;<span class="comment" id="5743459">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743500">if</span>&nbsp;<span class="ident" id="5743503">n</span>&nbsp;<span class="op" id="5743505">:=</span>&nbsp;<span class="builtinfunc" id="5743508">len</span><span class="op" id="5743511">(</span><span class="ident" id="5743512">list</span><span class="op" id="5743516">)</span><span class="op" id="5743517">;</span>&nbsp;<span class="ident" id="5743519">n</span>&nbsp;<span class="op" id="5743521">&gt;</span>&nbsp;<span class="num" id="5743523">1</span>&nbsp;<span class="op" id="5743525">||</span>&nbsp;<span class="op" id="5743528">!</span><span class="ident" id="5743529">isTypeName</span><span class="op" id="5743539">(</span><span class="ident" id="5743540">deref</span><span class="op" id="5743545">(</span><span class="ident" id="5743546">typ</span><span class="op" id="5743549">)</span><span class="op" id="5743550">)</span>&nbsp;<span class="op" id="5743552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743557">pos</span>&nbsp;<span class="op" id="5743561">:=</span>&nbsp;<span class="ident" id="5743564">typ</span><span class="op" id="5743567">.</span><span class="ident" id="5743568">Pos</span><span class="op" id="5743571">(</span><span class="op" id="5743572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743577">p</span><span class="op" id="5743578">.</span><span class="ident" id="5743579">errorExpected</span><span class="op" id="5743592">(</span><span class="ident" id="5743593">pos</span><span class="op" id="5743596">,</span>&nbsp;<span class="string" id="5743598">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="5743615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743620">typ</span>&nbsp;<span class="op" id="5743624">=</span>&nbsp;<span class="op" id="5743626">&amp;</span><span class="ident" id="5743627">ast</span><span class="op" id="5743630">.</span><span class="ident" id="5743631">BadExpr</span><span class="op" id="5743638">{</span><span class="ident" id="5743639">From</span><span class="op" id="5743643">:</span>&nbsp;<span class="ident" id="5743645">pos</span><span class="op" id="5743648">,</span>&nbsp;<span class="ident" id="5743650">To</span><span class="op" id="5743652">:</span>&nbsp;<span class="ident" id="5743654">p</span><span class="op" id="5743655">.</span><span class="ident" id="5743656">safePos</span><span class="op" id="5743663">(</span><span class="ident" id="5743664">list</span><span class="op" id="5743668">[</span><span class="ident" id="5743669">n</span><span class="op" id="5743670">-</span><span class="num" id="5743671">1</span><span class="op" id="5743672">]</span><span class="op" id="5743673">.</span><span class="ident" id="5743674">End</span><span class="op" id="5743677">(</span><span class="op" id="5743678">)</span><span class="op" id="5743679">)</span><span class="op" id="5743680">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743691">p</span><span class="op" id="5743692">.</span><span class="ident" id="5743693">expectSemi</span><span class="op" id="5743703">(</span><span class="op" id="5743704">)</span>&nbsp;<span class="comment" id="5743706">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743747">field</span>&nbsp;<span class="op" id="5743753">:=</span>&nbsp;<span class="op" id="5743756">&amp;</span><span class="ident" id="5743757">ast</span><span class="op" id="5743760">.</span><span class="ident" id="5743761">Field</span><span class="op" id="5743766">{</span><span class="ident" id="5743767">Doc</span><span class="op" id="5743770">:</span>&nbsp;<span class="ident" id="5743772">doc</span><span class="op" id="5743775">,</span>&nbsp;<span class="ident" id="5743777">Names</span><span class="op" id="5743782">:</span>&nbsp;<span class="ident" id="5743784">idents</span><span class="op" id="5743790">,</span>&nbsp;<span class="ident" id="5743792">Type</span><span class="op" id="5743796">:</span>&nbsp;<span class="ident" id="5743798">typ</span><span class="op" id="5743801">,</span>&nbsp;<span class="ident" id="5743803">Tag</span><span class="op" id="5743806">:</span>&nbsp;<span class="ident" id="5743808">tag</span><span class="op" id="5743811">,</span>&nbsp;<span class="ident" id="5743813">Comment</span><span class="op" id="5743820">:</span>&nbsp;<span class="ident" id="5743822">p</span><span class="op" id="5743823">.</span><span class="ident" id="5743824">lineComment</span><span class="op" id="5743835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743838">p</span><span class="op" id="5743839">.</span><span class="ident" id="5743840">declare</span><span class="op" id="5743847">(</span><span class="ident" id="5743848">field</span><span class="op" id="5743853">,</span>&nbsp;<span class="ident" id="5743855">nil</span><span class="op" id="5743858">,</span>&nbsp;<span class="ident" id="5743860">scope</span><span class="op" id="5743865">,</span>&nbsp;<span class="ident" id="5743867">ast</span><span class="op" id="5743870">.</span><span class="ident" id="5743871">Var</span><span class="op" id="5743874">,</span>&nbsp;<span class="ident" id="5743876">idents</span><span class="op" id="5743882">...</span><span class="op" id="5743885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743888">p</span><span class="op" id="5743889">.</span><span class="ident" id="5743890">resolve</span><span class="op" id="5743897">(</span><span class="ident" id="5743898">typ</span><span class="op" id="5743901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743905">return</span>&nbsp;<span class="ident" id="5743912">field</span><br>
<span class="lineno">715</span><span class="op" id="5743918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5743921">func</span>&nbsp;<span class="op" id="5743926">(</span><span class="ident" id="5743927">p</span>&nbsp;<span class="op" id="5743929">*</span><span class="ident" id="5743930">parser</span><span class="op" id="5743936">)</span>&nbsp;<span class="ident" id="5743938">parseStructType</span><span class="op" id="5743953">(</span><span class="op" id="5743954">)</span>&nbsp;<span class="op" id="5743956">*</span><span class="ident" id="5743957">ast</span><span class="op" id="5743960">.</span><span class="ident" id="5743961">StructType</span>&nbsp;<span class="op" id="5743972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743975">if</span>&nbsp;<span class="ident" id="5743978">p</span><span class="op" id="5743979">.</span><span class="ident" id="5743980">trace</span>&nbsp;<span class="op" id="5743986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743990">defer</span>&nbsp;<span class="ident" id="5743996">un</span><span class="op" id="5743998">(</span><span class="ident" id="5743999">trace</span><span class="op" id="5744004">(</span><span class="ident" id="5744005">p</span><span class="op" id="5744006">,</span>&nbsp;<span class="string" id="5744008">&#34;StructType&#34;</span><span class="op" id="5744020">)</span><span class="op" id="5744021">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744028">pos</span>&nbsp;<span class="op" id="5744032">:=</span>&nbsp;<span class="ident" id="5744035">p</span><span class="op" id="5744036">.</span><span class="ident" id="5744037">expect</span><span class="op" id="5744043">(</span><span class="ident" id="5744044">token</span><span class="op" id="5744049">.</span><span class="ident" id="5744050">STRUCT</span><span class="op" id="5744056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744059">lbrace</span>&nbsp;<span class="op" id="5744066">:=</span>&nbsp;<span class="ident" id="5744069">p</span><span class="op" id="5744070">.</span><span class="ident" id="5744071">expect</span><span class="op" id="5744077">(</span><span class="ident" id="5744078">token</span><span class="op" id="5744083">.</span><span class="ident" id="5744084">LBRACE</span><span class="op" id="5744090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744093">scope</span>&nbsp;<span class="op" id="5744099">:=</span>&nbsp;<span class="ident" id="5744102">ast</span><span class="op" id="5744105">.</span><span class="ident" id="5744106">NewScope</span><span class="op" id="5744114">(</span><span class="ident" id="5744115">nil</span><span class="op" id="5744118">)</span>&nbsp;<span class="comment" id="5744120">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744137">var</span>&nbsp;<span class="ident" id="5744141">list</span>&nbsp;<span class="op" id="5744146">[</span><span class="op" id="5744147">]</span><span class="op" id="5744148">*</span><span class="ident" id="5744149">ast</span><span class="op" id="5744152">.</span><span class="ident" id="5744153">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744160">for</span>&nbsp;<span class="ident" id="5744164">p</span><span class="op" id="5744165">.</span><span class="ident" id="5744166">tok</span>&nbsp;<span class="op" id="5744170">==</span>&nbsp;<span class="ident" id="5744173">token</span><span class="op" id="5744178">.</span><span class="ident" id="5744179">IDENT</span>&nbsp;<span class="op" id="5744185">||</span>&nbsp;<span class="ident" id="5744188">p</span><span class="op" id="5744189">.</span><span class="ident" id="5744190">tok</span>&nbsp;<span class="op" id="5744194">==</span>&nbsp;<span class="ident" id="5744197">token</span><span class="op" id="5744202">.</span><span class="ident" id="5744203">MUL</span>&nbsp;<span class="op" id="5744207">||</span>&nbsp;<span class="ident" id="5744210">p</span><span class="op" id="5744211">.</span><span class="ident" id="5744212">tok</span>&nbsp;<span class="op" id="5744216">==</span>&nbsp;<span class="ident" id="5744219">token</span><span class="op" id="5744224">.</span><span class="ident" id="5744225">LPAREN</span>&nbsp;<span class="op" id="5744232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5744236">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5744299">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5744362">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744421">list</span>&nbsp;<span class="op" id="5744426">=</span>&nbsp;<span class="builtinfunc" id="5744428">append</span><span class="op" id="5744434">(</span><span class="ident" id="5744435">list</span><span class="op" id="5744439">,</span>&nbsp;<span class="ident" id="5744441">p</span><span class="op" id="5744442">.</span><span class="ident" id="5744443">parseFieldDecl</span><span class="op" id="5744457">(</span><span class="ident" id="5744458">scope</span><span class="op" id="5744463">)</span><span class="op" id="5744464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744470">rbrace</span>&nbsp;<span class="op" id="5744477">:=</span>&nbsp;<span class="ident" id="5744480">p</span><span class="op" id="5744481">.</span><span class="ident" id="5744482">expect</span><span class="op" id="5744488">(</span><span class="ident" id="5744489">token</span><span class="op" id="5744494">.</span><span class="ident" id="5744495">RBRACE</span><span class="op" id="5744501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744505">return</span>&nbsp;<span class="op" id="5744512">&amp;</span><span class="ident" id="5744513">ast</span><span class="op" id="5744516">.</span><span class="ident" id="5744517">StructType</span><span class="op" id="5744527">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744531">Struct</span><span class="op" id="5744537">:</span>&nbsp;<span class="ident" id="5744539">pos</span><span class="op" id="5744542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744546">Fields</span><span class="op" id="5744552">:</span>&nbsp;<span class="op" id="5744554">&amp;</span><span class="ident" id="5744555">ast</span><span class="op" id="5744558">.</span><span class="ident" id="5744559">FieldList</span><span class="op" id="5744568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744573">Opening</span><span class="op" id="5744580">:</span>&nbsp;<span class="ident" id="5744582">lbrace</span><span class="op" id="5744588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744593">List</span><span class="op" id="5744597">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744602">list</span><span class="op" id="5744606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744611">Closing</span><span class="op" id="5744618">:</span>&nbsp;<span class="ident" id="5744620">rbrace</span><span class="op" id="5744626">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744630">}</span><span class="op" id="5744631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744634">}</span><br>
<span class="lineno"></span><span class="op" id="5744636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5744639">func</span>&nbsp;<span class="op" id="5744644">(</span><span class="ident" id="5744645">p</span>&nbsp;<span class="op" id="5744647">*</span><span class="ident" id="5744648">parser</span><span class="op" id="5744654">)</span>&nbsp;<span class="ident" id="5744656">parsePointerType</span><span class="op" id="5744672">(</span><span class="op" id="5744673">)</span>&nbsp;<span class="op" id="5744675">*</span><span class="ident" id="5744676">ast</span><span class="op" id="5744679">.</span><span class="ident" id="5744680">StarExpr</span>&nbsp;<span class="op" id="5744689">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744692">if</span>&nbsp;<span class="ident" id="5744695">p</span><span class="op" id="5744696">.</span><span class="ident" id="5744697">trace</span>&nbsp;<span class="op" id="5744703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744707">defer</span>&nbsp;<span class="ident" id="5744713">un</span><span class="op" id="5744715">(</span><span class="ident" id="5744716">trace</span><span class="op" id="5744721">(</span><span class="ident" id="5744722">p</span><span class="op" id="5744723">,</span>&nbsp;<span class="string" id="5744725">&#34;PointerType&#34;</span><span class="op" id="5744738">)</span><span class="op" id="5744739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744746">star</span>&nbsp;<span class="op" id="5744751">:=</span>&nbsp;<span class="ident" id="5744754">p</span><span class="op" id="5744755">.</span><span class="ident" id="5744756">expect</span><span class="op" id="5744762">(</span><span class="ident" id="5744763">token</span><span class="op" id="5744768">.</span><span class="ident" id="5744769">MUL</span><span class="op" id="5744772">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744775">base</span>&nbsp;<span class="op" id="5744780">:=</span>&nbsp;<span class="ident" id="5744783">p</span><span class="op" id="5744784">.</span><span class="ident" id="5744785">parseType</span><span class="op" id="5744794">(</span><span class="op" id="5744795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744799">return</span>&nbsp;<span class="op" id="5744806">&amp;</span><span class="ident" id="5744807">ast</span><span class="op" id="5744810">.</span><span class="ident" id="5744811">StarExpr</span><span class="op" id="5744819">{</span><span class="ident" id="5744820">Star</span><span class="op" id="5744824">:</span>&nbsp;<span class="ident" id="5744826">star</span><span class="op" id="5744830">,</span>&nbsp;<span class="ident" id="5744832">X</span><span class="op" id="5744833">:</span>&nbsp;<span class="ident" id="5744835">base</span><span class="op" id="5744839">}</span><br>
<span class="lineno"></span><span class="op" id="5744841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5744844">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5744899">func</span>&nbsp;<span class="op" id="5744904">(</span><span class="ident" id="5744905">p</span>&nbsp;<span class="op" id="5744907">*</span><span class="ident" id="5744908">parser</span><span class="op" id="5744914">)</span>&nbsp;<span class="ident" id="5744916">tryVarType</span><span class="op" id="5744926">(</span><span class="ident" id="5744927">isParam</span>&nbsp;<span class="builtintype" id="5744935">bool</span><span class="op" id="5744939">)</span>&nbsp;<span class="ident" id="5744941">ast</span><span class="op" id="5744944">.</span><span class="ident" id="5744945">Expr</span>&nbsp;<span class="op" id="5744950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744953">if</span>&nbsp;<span class="ident" id="5744956">isParam</span>&nbsp;<span class="op" id="5744964">&amp;&amp;</span>&nbsp;<span class="ident" id="5744967">p</span><span class="op" id="5744968">.</span><span class="ident" id="5744969">tok</span>&nbsp;<span class="op" id="5744973">==</span>&nbsp;<span class="ident" id="5744976">token</span><span class="op" id="5744981">.</span><span class="ident" id="5744982">ELLIPSIS</span>&nbsp;<span class="op" id="5744991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744995">pos</span>&nbsp;<span class="op" id="5744999">:=</span>&nbsp;<span class="ident" id="5745002">p</span><span class="op" id="5745003">.</span><span class="ident" id="5745004">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745010">p</span><span class="op" id="5745011">.</span><span class="ident" id="5745012">next</span><span class="op" id="5745016">(</span><span class="op" id="5745017">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745021">typ</span>&nbsp;<span class="op" id="5745025">:=</span>&nbsp;<span class="ident" id="5745028">p</span><span class="op" id="5745029">.</span><span class="ident" id="5745030">tryIdentOrType</span><span class="op" id="5745044">(</span><span class="op" id="5745045">)</span>&nbsp;<span class="comment" id="5745047">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745111">if</span>&nbsp;<span class="ident" id="5745114">typ</span>&nbsp;<span class="op" id="5745118">!=</span>&nbsp;<span class="ident" id="5745121">nil</span>&nbsp;<span class="op" id="5745125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745130">p</span><span class="op" id="5745131">.</span><span class="ident" id="5745132">resolve</span><span class="op" id="5745139">(</span><span class="ident" id="5745140">typ</span><span class="op" id="5745143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745147">}</span>&nbsp;<span class="keyword" id="5745149">else</span>&nbsp;<span class="op" id="5745154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745159">p</span><span class="op" id="5745160">.</span><span class="builtintype" id="5745161">error</span><span class="op" id="5745166">(</span><span class="ident" id="5745167">pos</span><span class="op" id="5745170">,</span>&nbsp;<span class="string" id="5745172">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="5745205">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745210">typ</span>&nbsp;<span class="op" id="5745214">=</span>&nbsp;<span class="op" id="5745216">&amp;</span><span class="ident" id="5745217">ast</span><span class="op" id="5745220">.</span><span class="ident" id="5745221">BadExpr</span><span class="op" id="5745228">{</span><span class="ident" id="5745229">From</span><span class="op" id="5745233">:</span>&nbsp;<span class="ident" id="5745235">pos</span><span class="op" id="5745238">,</span>&nbsp;<span class="ident" id="5745240">To</span><span class="op" id="5745242">:</span>&nbsp;<span class="ident" id="5745244">p</span><span class="op" id="5745245">.</span><span class="ident" id="5745246">pos</span><span class="op" id="5745249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745257">return</span>&nbsp;<span class="op" id="5745264">&amp;</span><span class="ident" id="5745265">ast</span><span class="op" id="5745268">.</span><span class="ident" id="5745269">Ellipsis</span><span class="op" id="5745277">{</span><span class="ident" id="5745278">Ellipsis</span><span class="op" id="5745286">:</span>&nbsp;<span class="ident" id="5745288">pos</span><span class="op" id="5745291">,</span>&nbsp;<span class="ident" id="5745293">Elt</span><span class="op" id="5745296">:</span>&nbsp;<span class="ident" id="5745298">typ</span><span class="op" id="5745301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745307">return</span>&nbsp;<span class="ident" id="5745314">p</span><span class="op" id="5745315">.</span><span class="ident" id="5745316">tryIdentOrType</span><span class="op" id="5745330">(</span><span class="op" id="5745331">)</span><br>
<span class="lineno">770</span><span class="op" id="5745333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5745336">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5745391">func</span>&nbsp;<span class="op" id="5745396">(</span><span class="ident" id="5745397">p</span>&nbsp;<span class="op" id="5745399">*</span><span class="ident" id="5745400">parser</span><span class="op" id="5745406">)</span>&nbsp;<span class="ident" id="5745408">parseVarType</span><span class="op" id="5745420">(</span><span class="ident" id="5745421">isParam</span>&nbsp;<span class="builtintype" id="5745429">bool</span><span class="op" id="5745433">)</span>&nbsp;<span class="ident" id="5745435">ast</span><span class="op" id="5745438">.</span><span class="ident" id="5745439">Expr</span>&nbsp;<span class="op" id="5745444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745447">typ</span>&nbsp;<span class="op" id="5745451">:=</span>&nbsp;<span class="ident" id="5745454">p</span><span class="op" id="5745455">.</span><span class="ident" id="5745456">tryVarType</span><span class="op" id="5745466">(</span><span class="ident" id="5745467">isParam</span><span class="op" id="5745474">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745477">if</span>&nbsp;<span class="ident" id="5745480">typ</span>&nbsp;<span class="op" id="5745484">==</span>&nbsp;<span class="ident" id="5745487">nil</span>&nbsp;<span class="op" id="5745491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745495">pos</span>&nbsp;<span class="op" id="5745499">:=</span>&nbsp;<span class="ident" id="5745502">p</span><span class="op" id="5745503">.</span><span class="ident" id="5745504">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745510">p</span><span class="op" id="5745511">.</span><span class="ident" id="5745512">errorExpected</span><span class="op" id="5745525">(</span><span class="ident" id="5745526">pos</span><span class="op" id="5745529">,</span>&nbsp;<span class="string" id="5745531">&#34;type&#34;</span><span class="op" id="5745537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745541">p</span><span class="op" id="5745542">.</span><span class="ident" id="5745543">next</span><span class="op" id="5745547">(</span><span class="op" id="5745548">)</span>&nbsp;<span class="comment" id="5745550">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745569">typ</span>&nbsp;<span class="op" id="5745573">=</span>&nbsp;<span class="op" id="5745575">&amp;</span><span class="ident" id="5745576">ast</span><span class="op" id="5745579">.</span><span class="ident" id="5745580">BadExpr</span><span class="op" id="5745587">{</span><span class="ident" id="5745588">From</span><span class="op" id="5745592">:</span>&nbsp;<span class="ident" id="5745594">pos</span><span class="op" id="5745597">,</span>&nbsp;<span class="ident" id="5745599">To</span><span class="op" id="5745601">:</span>&nbsp;<span class="ident" id="5745603">p</span><span class="op" id="5745604">.</span><span class="ident" id="5745605">pos</span><span class="op" id="5745608">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745614">return</span>&nbsp;<span class="ident" id="5745621">typ</span><br>
<span class="lineno"></span><span class="op" id="5745625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5745628">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="5745693">func</span>&nbsp;<span class="op" id="5745698">(</span><span class="ident" id="5745699">p</span>&nbsp;<span class="op" id="5745701">*</span><span class="ident" id="5745702">parser</span><span class="op" id="5745708">)</span>&nbsp;<span class="ident" id="5745710">parseVarList</span><span class="op" id="5745722">(</span><span class="ident" id="5745723">isParam</span>&nbsp;<span class="builtintype" id="5745731">bool</span><span class="op" id="5745735">)</span>&nbsp;<span class="op" id="5745737">(</span><span class="ident" id="5745738">list</span>&nbsp;<span class="op" id="5745743">[</span><span class="op" id="5745744">]</span><span class="ident" id="5745745">ast</span><span class="op" id="5745748">.</span><span class="ident" id="5745749">Expr</span><span class="op" id="5745753">,</span>&nbsp;<span class="ident" id="5745755">typ</span>&nbsp;<span class="ident" id="5745759">ast</span><span class="op" id="5745762">.</span><span class="ident" id="5745763">Expr</span><span class="op" id="5745767">)</span>&nbsp;<span class="op" id="5745769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745772">if</span>&nbsp;<span class="ident" id="5745775">p</span><span class="op" id="5745776">.</span><span class="ident" id="5745777">trace</span>&nbsp;<span class="op" id="5745783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745787">defer</span>&nbsp;<span class="ident" id="5745793">un</span><span class="op" id="5745795">(</span><span class="ident" id="5745796">trace</span><span class="op" id="5745801">(</span><span class="ident" id="5745802">p</span><span class="op" id="5745803">,</span>&nbsp;<span class="string" id="5745805">&#34;VarList&#34;</span><span class="op" id="5745814">)</span><span class="op" id="5745815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5745822">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5745880">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5745884">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5745947">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5746010">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746073">for</span>&nbsp;<span class="ident" id="5746077">typ</span>&nbsp;<span class="op" id="5746081">:=</span>&nbsp;<span class="ident" id="5746084">p</span><span class="op" id="5746085">.</span><span class="ident" id="5746086">parseVarType</span><span class="op" id="5746098">(</span><span class="ident" id="5746099">isParam</span><span class="op" id="5746106">)</span><span class="op" id="5746107">;</span>&nbsp;<span class="ident" id="5746109">typ</span>&nbsp;<span class="op" id="5746113">!=</span>&nbsp;<span class="ident" id="5746116">nil</span><span class="op" id="5746119">;</span>&nbsp;<span class="op" id="5746121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746125">list</span>&nbsp;<span class="op" id="5746130">=</span>&nbsp;<span class="builtinfunc" id="5746132">append</span><span class="op" id="5746138">(</span><span class="ident" id="5746139">list</span><span class="op" id="5746143">,</span>&nbsp;<span class="ident" id="5746145">typ</span><span class="op" id="5746148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746152">if</span>&nbsp;<span class="ident" id="5746155">p</span><span class="op" id="5746156">.</span><span class="ident" id="5746157">tok</span>&nbsp;<span class="op" id="5746161">!=</span>&nbsp;<span class="ident" id="5746164">token</span><span class="op" id="5746169">.</span><span class="ident" id="5746170">COMMA</span>&nbsp;<span class="op" id="5746176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746181">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746189">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746193">p</span><span class="op" id="5746194">.</span><span class="ident" id="5746195">next</span><span class="op" id="5746199">(</span><span class="op" id="5746200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746204">typ</span>&nbsp;<span class="op" id="5746208">=</span>&nbsp;<span class="ident" id="5746210">p</span><span class="op" id="5746211">.</span><span class="ident" id="5746212">tryVarType</span><span class="op" id="5746222">(</span><span class="ident" id="5746223">isParam</span><span class="op" id="5746230">)</span>&nbsp;<span class="comment" id="5746232">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5746273">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746340">typ</span>&nbsp;<span class="op" id="5746344">=</span>&nbsp;<span class="ident" id="5746346">p</span><span class="op" id="5746347">.</span><span class="ident" id="5746348">tryVarType</span><span class="op" id="5746358">(</span><span class="ident" id="5746359">isParam</span><span class="op" id="5746366">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746370">return</span><br>
<span class="lineno"></span><span class="op" id="5746377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5746380">func</span>&nbsp;<span class="op" id="5746385">(</span><span class="ident" id="5746386">p</span>&nbsp;<span class="op" id="5746388">*</span><span class="ident" id="5746389">parser</span><span class="op" id="5746395">)</span>&nbsp;<span class="ident" id="5746397">parseParameterList</span><span class="op" id="5746415">(</span><span class="ident" id="5746416">scope</span>&nbsp;<span class="op" id="5746422">*</span><span class="ident" id="5746423">ast</span><span class="op" id="5746426">.</span><span class="ident" id="5746427">Scope</span><span class="op" id="5746432">,</span>&nbsp;<span class="ident" id="5746434">ellipsisOk</span>&nbsp;<span class="builtintype" id="5746445">bool</span><span class="op" id="5746449">)</span>&nbsp;<span class="op" id="5746451">(</span><span class="ident" id="5746452">params</span>&nbsp;<span class="op" id="5746459">[</span><span class="op" id="5746460">]</span><span class="op" id="5746461">*</span><span class="ident" id="5746462">ast</span><span class="op" id="5746465">.</span><span class="ident" id="5746466">Field</span><span class="op" id="5746471">)</span>&nbsp;<span class="op" id="5746473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746476">if</span>&nbsp;<span class="ident" id="5746479">p</span><span class="op" id="5746480">.</span><span class="ident" id="5746481">trace</span>&nbsp;<span class="op" id="5746487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746491">defer</span>&nbsp;<span class="ident" id="5746497">un</span><span class="op" id="5746499">(</span><span class="ident" id="5746500">trace</span><span class="op" id="5746505">(</span><span class="ident" id="5746506">p</span><span class="op" id="5746507">,</span>&nbsp;<span class="string" id="5746509">&#34;ParameterList&#34;</span><span class="op" id="5746524">)</span><span class="op" id="5746525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5746532">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746550">list</span><span class="op" id="5746554">,</span>&nbsp;<span class="ident" id="5746556">typ</span>&nbsp;<span class="op" id="5746560">:=</span>&nbsp;<span class="ident" id="5746563">p</span><span class="op" id="5746564">.</span><span class="ident" id="5746565">parseVarList</span><span class="op" id="5746577">(</span><span class="ident" id="5746578">ellipsisOk</span><span class="op" id="5746588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5746592">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746609">if</span>&nbsp;<span class="ident" id="5746612">typ</span>&nbsp;<span class="op" id="5746616">!=</span>&nbsp;<span class="ident" id="5746619">nil</span>&nbsp;<span class="op" id="5746623">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5746627">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746652">idents</span>&nbsp;<span class="op" id="5746659">:=</span>&nbsp;<span class="ident" id="5746662">p</span><span class="op" id="5746663">.</span><span class="ident" id="5746664">makeIdentList</span><span class="op" id="5746677">(</span><span class="ident" id="5746678">list</span><span class="op" id="5746682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746686">field</span>&nbsp;<span class="op" id="5746692">:=</span>&nbsp;<span class="op" id="5746695">&amp;</span><span class="ident" id="5746696">ast</span><span class="op" id="5746699">.</span><span class="ident" id="5746700">Field</span><span class="op" id="5746705">{</span><span class="ident" id="5746706">Names</span><span class="op" id="5746711">:</span>&nbsp;<span class="ident" id="5746713">idents</span><span class="op" id="5746719">,</span>&nbsp;<span class="ident" id="5746721">Type</span><span class="op" id="5746725">:</span>&nbsp;<span class="ident" id="5746727">typ</span><span class="op" id="5746730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746734">params</span>&nbsp;<span class="op" id="5746741">=</span>&nbsp;<span class="builtinfunc" id="5746743">append</span><span class="op" id="5746749">(</span><span class="ident" id="5746750">params</span><span class="op" id="5746756">,</span>&nbsp;<span class="ident" id="5746758">field</span><span class="op" id="5746763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5746767">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5746828">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746884">p</span><span class="op" id="5746885">.</span><span class="ident" id="5746886">declare</span><span class="op" id="5746893">(</span><span class="ident" id="5746894">field</span><span class="op" id="5746899">,</span>&nbsp;<span class="ident" id="5746901">nil</span><span class="op" id="5746904">,</span>&nbsp;<span class="ident" id="5746906">scope</span><span class="op" id="5746911">,</span>&nbsp;<span class="ident" id="5746913">ast</span><span class="op" id="5746916">.</span><span class="ident" id="5746917">Var</span><span class="op" id="5746920">,</span>&nbsp;<span class="ident" id="5746922">idents</span><span class="op" id="5746928">...</span><span class="op" id="5746931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746935">p</span><span class="op" id="5746936">.</span><span class="ident" id="5746937">resolve</span><span class="op" id="5746944">(</span><span class="ident" id="5746945">typ</span><span class="op" id="5746948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746952">if</span>&nbsp;<span class="op" id="5746955">!</span><span class="ident" id="5746956">p</span><span class="op" id="5746957">.</span><span class="ident" id="5746958">atComma</span><span class="op" id="5746965">(</span><span class="string" id="5746966">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5746982">)</span>&nbsp;<span class="op" id="5746984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746989">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747002">p</span><span class="op" id="5747003">.</span><span class="ident" id="5747004">next</span><span class="op" id="5747008">(</span><span class="op" id="5747009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747013">for</span>&nbsp;<span class="ident" id="5747017">p</span><span class="op" id="5747018">.</span><span class="ident" id="5747019">tok</span>&nbsp;<span class="op" id="5747023">!=</span>&nbsp;<span class="ident" id="5747026">token</span><span class="op" id="5747031">.</span><span class="ident" id="5747032">RPAREN</span>&nbsp;<span class="op" id="5747039">&amp;&amp;</span>&nbsp;<span class="ident" id="5747042">p</span><span class="op" id="5747043">.</span><span class="ident" id="5747044">tok</span>&nbsp;<span class="op" id="5747048">!=</span>&nbsp;<span class="ident" id="5747051">token</span><span class="op" id="5747056">.</span><span class="ident" id="5747057">EOF</span>&nbsp;<span class="op" id="5747061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747066">idents</span>&nbsp;<span class="op" id="5747073">:=</span>&nbsp;<span class="ident" id="5747076">p</span><span class="op" id="5747077">.</span><span class="ident" id="5747078">parseIdentList</span><span class="op" id="5747092">(</span><span class="op" id="5747093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747098">typ</span>&nbsp;<span class="op" id="5747102">:=</span>&nbsp;<span class="ident" id="5747105">p</span><span class="op" id="5747106">.</span><span class="ident" id="5747107">parseVarType</span><span class="op" id="5747119">(</span><span class="ident" id="5747120">ellipsisOk</span><span class="op" id="5747130">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747135">field</span>&nbsp;<span class="op" id="5747141">:=</span>&nbsp;<span class="op" id="5747144">&amp;</span><span class="ident" id="5747145">ast</span><span class="op" id="5747148">.</span><span class="ident" id="5747149">Field</span><span class="op" id="5747154">{</span><span class="ident" id="5747155">Names</span><span class="op" id="5747160">:</span>&nbsp;<span class="ident" id="5747162">idents</span><span class="op" id="5747168">,</span>&nbsp;<span class="ident" id="5747170">Type</span><span class="op" id="5747174">:</span>&nbsp;<span class="ident" id="5747176">typ</span><span class="op" id="5747179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747184">params</span>&nbsp;<span class="op" id="5747191">=</span>&nbsp;<span class="builtinfunc" id="5747193">append</span><span class="op" id="5747199">(</span><span class="ident" id="5747200">params</span><span class="op" id="5747206">,</span>&nbsp;<span class="ident" id="5747208">field</span><span class="op" id="5747213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747218">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747280">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747337">p</span><span class="op" id="5747338">.</span><span class="ident" id="5747339">declare</span><span class="op" id="5747346">(</span><span class="ident" id="5747347">field</span><span class="op" id="5747352">,</span>&nbsp;<span class="ident" id="5747354">nil</span><span class="op" id="5747357">,</span>&nbsp;<span class="ident" id="5747359">scope</span><span class="op" id="5747364">,</span>&nbsp;<span class="ident" id="5747366">ast</span><span class="op" id="5747369">.</span><span class="ident" id="5747370">Var</span><span class="op" id="5747373">,</span>&nbsp;<span class="ident" id="5747375">idents</span><span class="op" id="5747381">...</span><span class="op" id="5747384">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747389">p</span><span class="op" id="5747390">.</span><span class="ident" id="5747391">resolve</span><span class="op" id="5747398">(</span><span class="ident" id="5747399">typ</span><span class="op" id="5747402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747407">if</span>&nbsp;<span class="op" id="5747410">!</span><span class="ident" id="5747411">p</span><span class="op" id="5747412">.</span><span class="ident" id="5747413">atComma</span><span class="op" id="5747420">(</span><span class="string" id="5747421">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5747437">)</span>&nbsp;<span class="op" id="5747439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747445">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747459">p</span><span class="op" id="5747460">.</span><span class="ident" id="5747461">next</span><span class="op" id="5747465">(</span><span class="op" id="5747466">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747486">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747531">params</span>&nbsp;<span class="op" id="5747538">=</span>&nbsp;<span class="builtinfunc" id="5747540">make</span><span class="op" id="5747544">(</span><span class="op" id="5747545">[</span><span class="op" id="5747546">]</span><span class="op" id="5747547">*</span><span class="ident" id="5747548">ast</span><span class="op" id="5747551">.</span><span class="ident" id="5747552">Field</span><span class="op" id="5747557">,</span>&nbsp;<span class="builtinfunc" id="5747559">len</span><span class="op" id="5747562">(</span><span class="ident" id="5747563">list</span><span class="op" id="5747567">)</span><span class="op" id="5747568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747571">for</span>&nbsp;<span class="ident" id="5747575">i</span><span class="op" id="5747576">,</span>&nbsp;<span class="ident" id="5747578">typ</span>&nbsp;<span class="op" id="5747582">:=</span>&nbsp;<span class="keyword" id="5747585">range</span>&nbsp;<span class="ident" id="5747591">list</span>&nbsp;<span class="op" id="5747596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747600">p</span><span class="op" id="5747601">.</span><span class="ident" id="5747602">resolve</span><span class="op" id="5747609">(</span><span class="ident" id="5747610">typ</span><span class="op" id="5747613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747617">params</span><span class="op" id="5747623">[</span><span class="ident" id="5747624">i</span><span class="op" id="5747625">]</span>&nbsp;<span class="op" id="5747627">=</span>&nbsp;<span class="op" id="5747629">&amp;</span><span class="ident" id="5747630">ast</span><span class="op" id="5747633">.</span><span class="ident" id="5747634">Field</span><span class="op" id="5747639">{</span><span class="ident" id="5747640">Type</span><span class="op" id="5747644">:</span>&nbsp;<span class="ident" id="5747646">typ</span><span class="op" id="5747649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747652">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747655">return</span><br>
<span class="lineno"></span><span class="op" id="5747662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5747665">func</span>&nbsp;<span class="op" id="5747670">(</span><span class="ident" id="5747671">p</span>&nbsp;<span class="op" id="5747673">*</span><span class="ident" id="5747674">parser</span><span class="op" id="5747680">)</span>&nbsp;<span class="ident" id="5747682">parseParameters</span><span class="op" id="5747697">(</span><span class="ident" id="5747698">scope</span>&nbsp;<span class="op" id="5747704">*</span><span class="ident" id="5747705">ast</span><span class="op" id="5747708">.</span><span class="ident" id="5747709">Scope</span><span class="op" id="5747714">,</span>&nbsp;<span class="ident" id="5747716">ellipsisOk</span>&nbsp;<span class="builtintype" id="5747727">bool</span><span class="op" id="5747731">)</span>&nbsp;<span class="op" id="5747733">*</span><span class="ident" id="5747734">ast</span><span class="op" id="5747737">.</span><span class="ident" id="5747738">FieldList</span>&nbsp;<span class="op" id="5747748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747751">if</span>&nbsp;<span class="ident" id="5747754">p</span><span class="op" id="5747755">.</span><span class="ident" id="5747756">trace</span>&nbsp;<span class="op" id="5747762">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747766">defer</span>&nbsp;<span class="ident" id="5747772">un</span><span class="op" id="5747774">(</span><span class="ident" id="5747775">trace</span><span class="op" id="5747780">(</span><span class="ident" id="5747781">p</span><span class="op" id="5747782">,</span>&nbsp;<span class="string" id="5747784">&#34;Parameters&#34;</span><span class="op" id="5747796">)</span><span class="op" id="5747797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747804">var</span>&nbsp;<span class="ident" id="5747808">params</span>&nbsp;<span class="op" id="5747815">[</span><span class="op" id="5747816">]</span><span class="op" id="5747817">*</span><span class="ident" id="5747818">ast</span><span class="op" id="5747821">.</span><span class="ident" id="5747822">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747829">lparen</span>&nbsp;<span class="op" id="5747836">:=</span>&nbsp;<span class="ident" id="5747839">p</span><span class="op" id="5747840">.</span><span class="ident" id="5747841">expect</span><span class="op" id="5747847">(</span><span class="ident" id="5747848">token</span><span class="op" id="5747853">.</span><span class="ident" id="5747854">LPAREN</span><span class="op" id="5747860">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747863">if</span>&nbsp;<span class="ident" id="5747866">p</span><span class="op" id="5747867">.</span><span class="ident" id="5747868">tok</span>&nbsp;<span class="op" id="5747872">!=</span>&nbsp;<span class="ident" id="5747875">token</span><span class="op" id="5747880">.</span><span class="ident" id="5747881">RPAREN</span>&nbsp;<span class="op" id="5747888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747892">params</span>&nbsp;<span class="op" id="5747899">=</span>&nbsp;<span class="ident" id="5747901">p</span><span class="op" id="5747902">.</span><span class="ident" id="5747903">parseParameterList</span><span class="op" id="5747921">(</span><span class="ident" id="5747922">scope</span><span class="op" id="5747927">,</span>&nbsp;<span class="ident" id="5747929">ellipsisOk</span><span class="op" id="5747939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747945">rparen</span>&nbsp;<span class="op" id="5747952">:=</span>&nbsp;<span class="ident" id="5747955">p</span><span class="op" id="5747956">.</span><span class="ident" id="5747957">expect</span><span class="op" id="5747963">(</span><span class="ident" id="5747964">token</span><span class="op" id="5747969">.</span><span class="ident" id="5747970">RPAREN</span><span class="op" id="5747976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747980">return</span>&nbsp;<span class="op" id="5747987">&amp;</span><span class="ident" id="5747988">ast</span><span class="op" id="5747991">.</span><span class="ident" id="5747992">FieldList</span><span class="op" id="5748001">{</span><span class="ident" id="5748002">Opening</span><span class="op" id="5748009">:</span>&nbsp;<span class="ident" id="5748011">lparen</span><span class="op" id="5748017">,</span>&nbsp;<span class="ident" id="5748019">List</span><span class="op" id="5748023">:</span>&nbsp;<span class="ident" id="5748025">params</span><span class="op" id="5748031">,</span>&nbsp;<span class="ident" id="5748033">Closing</span><span class="op" id="5748040">:</span>&nbsp;<span class="ident" id="5748042">rparen</span><span class="op" id="5748048">}</span><br>
<span class="lineno"></span><span class="op" id="5748050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748053">func</span>&nbsp;<span class="op" id="5748058">(</span><span class="ident" id="5748059">p</span>&nbsp;<span class="op" id="5748061">*</span><span class="ident" id="5748062">parser</span><span class="op" id="5748068">)</span>&nbsp;<span class="ident" id="5748070">parseResult</span><span class="op" id="5748081">(</span><span class="ident" id="5748082">scope</span>&nbsp;<span class="op" id="5748088">*</span><span class="ident" id="5748089">ast</span><span class="op" id="5748092">.</span><span class="ident" id="5748093">Scope</span><span class="op" id="5748098">)</span>&nbsp;<span class="op" id="5748100">*</span><span class="ident" id="5748101">ast</span><span class="op" id="5748104">.</span><span class="ident" id="5748105">FieldList</span>&nbsp;<span class="op" id="5748115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748118">if</span>&nbsp;<span class="ident" id="5748121">p</span><span class="op" id="5748122">.</span><span class="ident" id="5748123">trace</span>&nbsp;<span class="op" id="5748129">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748133">defer</span>&nbsp;<span class="ident" id="5748139">un</span><span class="op" id="5748141">(</span><span class="ident" id="5748142">trace</span><span class="op" id="5748147">(</span><span class="ident" id="5748148">p</span><span class="op" id="5748149">,</span>&nbsp;<span class="string" id="5748151">&#34;Result&#34;</span><span class="op" id="5748159">)</span><span class="op" id="5748160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748167">if</span>&nbsp;<span class="ident" id="5748170">p</span><span class="op" id="5748171">.</span><span class="ident" id="5748172">tok</span>&nbsp;<span class="op" id="5748176">==</span>&nbsp;<span class="ident" id="5748179">token</span><span class="op" id="5748184">.</span><span class="ident" id="5748185">LPAREN</span>&nbsp;<span class="op" id="5748192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748196">return</span>&nbsp;<span class="ident" id="5748203">p</span><span class="op" id="5748204">.</span><span class="ident" id="5748205">parseParameters</span><span class="op" id="5748220">(</span><span class="ident" id="5748221">scope</span><span class="op" id="5748226">,</span>&nbsp;<span class="builtintype" id="5748228">false</span><span class="op" id="5748233">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748240">typ</span>&nbsp;<span class="op" id="5748244">:=</span>&nbsp;<span class="ident" id="5748247">p</span><span class="op" id="5748248">.</span><span class="ident" id="5748249">tryType</span><span class="op" id="5748256">(</span><span class="op" id="5748257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748260">if</span>&nbsp;<span class="ident" id="5748263">typ</span>&nbsp;<span class="op" id="5748267">!=</span>&nbsp;<span class="ident" id="5748270">nil</span>&nbsp;<span class="op" id="5748274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748278">list</span>&nbsp;<span class="op" id="5748283">:=</span>&nbsp;<span class="builtinfunc" id="5748286">make</span><span class="op" id="5748290">(</span><span class="op" id="5748291">[</span><span class="op" id="5748292">]</span><span class="op" id="5748293">*</span><span class="ident" id="5748294">ast</span><span class="op" id="5748297">.</span><span class="ident" id="5748298">Field</span><span class="op" id="5748303">,</span>&nbsp;<span class="num" id="5748305">1</span><span class="op" id="5748306">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748310">list</span><span class="op" id="5748314">[</span><span class="num" id="5748315">0</span><span class="op" id="5748316">]</span>&nbsp;<span class="op" id="5748318">=</span>&nbsp;<span class="op" id="5748320">&amp;</span><span class="ident" id="5748321">ast</span><span class="op" id="5748324">.</span><span class="ident" id="5748325">Field</span><span class="op" id="5748330">{</span><span class="ident" id="5748331">Type</span><span class="op" id="5748335">:</span>&nbsp;<span class="ident" id="5748337">typ</span><span class="op" id="5748340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748344">return</span>&nbsp;<span class="op" id="5748351">&amp;</span><span class="ident" id="5748352">ast</span><span class="op" id="5748355">.</span><span class="ident" id="5748356">FieldList</span><span class="op" id="5748365">{</span><span class="ident" id="5748366">List</span><span class="op" id="5748370">:</span>&nbsp;<span class="ident" id="5748372">list</span><span class="op" id="5748376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748383">return</span>&nbsp;<span class="ident" id="5748390">nil</span><br>
<span class="lineno">890</span><span class="op" id="5748394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748397">func</span>&nbsp;<span class="op" id="5748402">(</span><span class="ident" id="5748403">p</span>&nbsp;<span class="op" id="5748405">*</span><span class="ident" id="5748406">parser</span><span class="op" id="5748412">)</span>&nbsp;<span class="ident" id="5748414">parseSignature</span><span class="op" id="5748428">(</span><span class="ident" id="5748429">scope</span>&nbsp;<span class="op" id="5748435">*</span><span class="ident" id="5748436">ast</span><span class="op" id="5748439">.</span><span class="ident" id="5748440">Scope</span><span class="op" id="5748445">)</span>&nbsp;<span class="op" id="5748447">(</span><span class="ident" id="5748448">params</span><span class="op" id="5748454">,</span>&nbsp;<span class="ident" id="5748456">results</span>&nbsp;<span class="op" id="5748464">*</span><span class="ident" id="5748465">ast</span><span class="op" id="5748468">.</span><span class="ident" id="5748469">FieldList</span><span class="op" id="5748478">)</span>&nbsp;<span class="op" id="5748480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748483">if</span>&nbsp;<span class="ident" id="5748486">p</span><span class="op" id="5748487">.</span><span class="ident" id="5748488">trace</span>&nbsp;<span class="op" id="5748494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748498">defer</span>&nbsp;<span class="ident" id="5748504">un</span><span class="op" id="5748506">(</span><span class="ident" id="5748507">trace</span><span class="op" id="5748512">(</span><span class="ident" id="5748513">p</span><span class="op" id="5748514">,</span>&nbsp;<span class="string" id="5748516">&#34;Signature&#34;</span><span class="op" id="5748527">)</span><span class="op" id="5748528">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748535">params</span>&nbsp;<span class="op" id="5748542">=</span>&nbsp;<span class="ident" id="5748544">p</span><span class="op" id="5748545">.</span><span class="ident" id="5748546">parseParameters</span><span class="op" id="5748561">(</span><span class="ident" id="5748562">scope</span><span class="op" id="5748567">,</span>&nbsp;<span class="builtintype" id="5748569">true</span><span class="op" id="5748573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748576">results</span>&nbsp;<span class="op" id="5748584">=</span>&nbsp;<span class="ident" id="5748586">p</span><span class="op" id="5748587">.</span><span class="ident" id="5748588">parseResult</span><span class="op" id="5748599">(</span><span class="ident" id="5748600">scope</span><span class="op" id="5748605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748609">return</span><br>
<span class="lineno"></span><span class="op" id="5748616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748619">func</span>&nbsp;<span class="op" id="5748624">(</span><span class="ident" id="5748625">p</span>&nbsp;<span class="op" id="5748627">*</span><span class="ident" id="5748628">parser</span><span class="op" id="5748634">)</span>&nbsp;<span class="ident" id="5748636">parseFuncType</span><span class="op" id="5748649">(</span><span class="op" id="5748650">)</span>&nbsp;<span class="op" id="5748652">(</span><span class="op" id="5748653">*</span><span class="ident" id="5748654">ast</span><span class="op" id="5748657">.</span><span class="ident" id="5748658">FuncType</span><span class="op" id="5748666">,</span>&nbsp;<span class="op" id="5748668">*</span><span class="ident" id="5748669">ast</span><span class="op" id="5748672">.</span><span class="ident" id="5748673">Scope</span><span class="op" id="5748678">)</span>&nbsp;<span class="op" id="5748680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748683">if</span>&nbsp;<span class="ident" id="5748686">p</span><span class="op" id="5748687">.</span><span class="ident" id="5748688">trace</span>&nbsp;<span class="op" id="5748694">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748698">defer</span>&nbsp;<span class="ident" id="5748704">un</span><span class="op" id="5748706">(</span><span class="ident" id="5748707">trace</span><span class="op" id="5748712">(</span><span class="ident" id="5748713">p</span><span class="op" id="5748714">,</span>&nbsp;<span class="string" id="5748716">&#34;FuncType&#34;</span><span class="op" id="5748726">)</span><span class="op" id="5748727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748734">pos</span>&nbsp;<span class="op" id="5748738">:=</span>&nbsp;<span class="ident" id="5748741">p</span><span class="op" id="5748742">.</span><span class="ident" id="5748743">expect</span><span class="op" id="5748749">(</span><span class="ident" id="5748750">token</span><span class="op" id="5748755">.</span><span class="ident" id="5748756">FUNC</span><span class="op" id="5748760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748763">scope</span>&nbsp;<span class="op" id="5748769">:=</span>&nbsp;<span class="ident" id="5748772">ast</span><span class="op" id="5748775">.</span><span class="ident" id="5748776">NewScope</span><span class="op" id="5748784">(</span><span class="ident" id="5748785">p</span><span class="op" id="5748786">.</span><span class="ident" id="5748787">topScope</span><span class="op" id="5748795">)</span>&nbsp;<span class="comment" id="5748797">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748816">params</span><span class="op" id="5748822">,</span>&nbsp;<span class="ident" id="5748824">results</span>&nbsp;<span class="op" id="5748832">:=</span>&nbsp;<span class="ident" id="5748835">p</span><span class="op" id="5748836">.</span><span class="ident" id="5748837">parseSignature</span><span class="op" id="5748851">(</span><span class="ident" id="5748852">scope</span><span class="op" id="5748857">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748861">return</span>&nbsp;<span class="op" id="5748868">&amp;</span><span class="ident" id="5748869">ast</span><span class="op" id="5748872">.</span><span class="ident" id="5748873">FuncType</span><span class="op" id="5748881">{</span><span class="ident" id="5748882">Func</span><span class="op" id="5748886">:</span>&nbsp;<span class="ident" id="5748888">pos</span><span class="op" id="5748891">,</span>&nbsp;<span class="ident" id="5748893">Params</span><span class="op" id="5748899">:</span>&nbsp;<span class="ident" id="5748901">params</span><span class="op" id="5748907">,</span>&nbsp;<span class="ident" id="5748909">Results</span><span class="op" id="5748916">:</span>&nbsp;<span class="ident" id="5748918">results</span><span class="op" id="5748925">}</span><span class="op" id="5748926">,</span>&nbsp;<span class="ident" id="5748928">scope</span><br>
<span class="lineno"></span><span class="op" id="5748934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="5748937">func</span>&nbsp;<span class="op" id="5748942">(</span><span class="ident" id="5748943">p</span>&nbsp;<span class="op" id="5748945">*</span><span class="ident" id="5748946">parser</span><span class="op" id="5748952">)</span>&nbsp;<span class="ident" id="5748954">parseMethodSpec</span><span class="op" id="5748969">(</span><span class="ident" id="5748970">scope</span>&nbsp;<span class="op" id="5748976">*</span><span class="ident" id="5748977">ast</span><span class="op" id="5748980">.</span><span class="ident" id="5748981">Scope</span><span class="op" id="5748986">)</span>&nbsp;<span class="op" id="5748988">*</span><span class="ident" id="5748989">ast</span><span class="op" id="5748992">.</span><span class="ident" id="5748993">Field</span>&nbsp;<span class="op" id="5748999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749002">if</span>&nbsp;<span class="ident" id="5749005">p</span><span class="op" id="5749006">.</span><span class="ident" id="5749007">trace</span>&nbsp;<span class="op" id="5749013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749017">defer</span>&nbsp;<span class="ident" id="5749023">un</span><span class="op" id="5749025">(</span><span class="ident" id="5749026">trace</span><span class="op" id="5749031">(</span><span class="ident" id="5749032">p</span><span class="op" id="5749033">,</span>&nbsp;<span class="string" id="5749035">&#34;MethodSpec&#34;</span><span class="op" id="5749047">)</span><span class="op" id="5749048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749055">doc</span>&nbsp;<span class="op" id="5749059">:=</span>&nbsp;<span class="ident" id="5749062">p</span><span class="op" id="5749063">.</span><span class="ident" id="5749064">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749077">var</span>&nbsp;<span class="ident" id="5749081">idents</span>&nbsp;<span class="op" id="5749088">[</span><span class="op" id="5749089">]</span><span class="op" id="5749090">*</span><span class="ident" id="5749091">ast</span><span class="op" id="5749094">.</span><span class="ident" id="5749095">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749102">var</span>&nbsp;<span class="ident" id="5749106">typ</span>&nbsp;<span class="ident" id="5749110">ast</span><span class="op" id="5749113">.</span><span class="ident" id="5749114">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749120">x</span>&nbsp;<span class="op" id="5749122">:=</span>&nbsp;<span class="ident" id="5749125">p</span><span class="op" id="5749126">.</span><span class="ident" id="5749127">parseTypeName</span><span class="op" id="5749140">(</span><span class="op" id="5749141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749144">if</span>&nbsp;<span class="ident" id="5749147">ident</span><span class="op" id="5749152">,</span>&nbsp;<span class="ident" id="5749154">isIdent</span>&nbsp;<span class="op" id="5749162">:=</span>&nbsp;<span class="ident" id="5749165">x</span><span class="op" id="5749166">.</span><span class="op" id="5749167">(</span><span class="op" id="5749168">*</span><span class="ident" id="5749169">ast</span><span class="op" id="5749172">.</span><span class="ident" id="5749173">Ident</span><span class="op" id="5749178">)</span><span class="op" id="5749179">;</span>&nbsp;<span class="ident" id="5749181">isIdent</span>&nbsp;<span class="op" id="5749189">&amp;&amp;</span>&nbsp;<span class="ident" id="5749192">p</span><span class="op" id="5749193">.</span><span class="ident" id="5749194">tok</span>&nbsp;<span class="op" id="5749198">==</span>&nbsp;<span class="ident" id="5749201">token</span><span class="op" id="5749206">.</span><span class="ident" id="5749207">LPAREN</span>&nbsp;<span class="op" id="5749214">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749218">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749230">idents</span>&nbsp;<span class="op" id="5749237">=</span>&nbsp;<span class="op" id="5749239">[</span><span class="op" id="5749240">]</span><span class="op" id="5749241">*</span><span class="ident" id="5749242">ast</span><span class="op" id="5749245">.</span><span class="ident" id="5749246">Ident</span><span class="op" id="5749251">{</span><span class="ident" id="5749252">ident</span><span class="op" id="5749257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749261">scope</span>&nbsp;<span class="op" id="5749267">:=</span>&nbsp;<span class="ident" id="5749270">ast</span><span class="op" id="5749273">.</span><span class="ident" id="5749274">NewScope</span><span class="op" id="5749282">(</span><span class="ident" id="5749283">nil</span><span class="op" id="5749286">)</span>&nbsp;<span class="comment" id="5749288">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749306">params</span><span class="op" id="5749312">,</span>&nbsp;<span class="ident" id="5749314">results</span>&nbsp;<span class="op" id="5749322">:=</span>&nbsp;<span class="ident" id="5749325">p</span><span class="op" id="5749326">.</span><span class="ident" id="5749327">parseSignature</span><span class="op" id="5749341">(</span><span class="ident" id="5749342">scope</span><span class="op" id="5749347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749351">typ</span>&nbsp;<span class="op" id="5749355">=</span>&nbsp;<span class="op" id="5749357">&amp;</span><span class="ident" id="5749358">ast</span><span class="op" id="5749361">.</span><span class="ident" id="5749362">FuncType</span><span class="op" id="5749370">{</span><span class="ident" id="5749371">Func</span><span class="op" id="5749375">:</span>&nbsp;<span class="ident" id="5749377">token</span><span class="op" id="5749382">.</span><span class="ident" id="5749383">NoPos</span><span class="op" id="5749388">,</span>&nbsp;<span class="ident" id="5749390">Params</span><span class="op" id="5749396">:</span>&nbsp;<span class="ident" id="5749398">params</span><span class="op" id="5749404">,</span>&nbsp;<span class="ident" id="5749406">Results</span><span class="op" id="5749413">:</span>&nbsp;<span class="ident" id="5749415">results</span><span class="op" id="5749422">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749425">}</span>&nbsp;<span class="keyword" id="5749427">else</span>&nbsp;<span class="op" id="5749432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749436">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749460">typ</span>&nbsp;<span class="op" id="5749464">=</span>&nbsp;<span class="ident" id="5749466">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749470">p</span><span class="op" id="5749471">.</span><span class="ident" id="5749472">resolve</span><span class="op" id="5749479">(</span><span class="ident" id="5749480">typ</span><span class="op" id="5749483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749486">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749489">p</span><span class="op" id="5749490">.</span><span class="ident" id="5749491">expectSemi</span><span class="op" id="5749501">(</span><span class="op" id="5749502">)</span>&nbsp;<span class="comment" id="5749504">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749545">spec</span>&nbsp;<span class="op" id="5749550">:=</span>&nbsp;<span class="op" id="5749553">&amp;</span><span class="ident" id="5749554">ast</span><span class="op" id="5749557">.</span><span class="ident" id="5749558">Field</span><span class="op" id="5749563">{</span><span class="ident" id="5749564">Doc</span><span class="op" id="5749567">:</span>&nbsp;<span class="ident" id="5749569">doc</span><span class="op" id="5749572">,</span>&nbsp;<span class="ident" id="5749574">Names</span><span class="op" id="5749579">:</span>&nbsp;<span class="ident" id="5749581">idents</span><span class="op" id="5749587">,</span>&nbsp;<span class="ident" id="5749589">Type</span><span class="op" id="5749593">:</span>&nbsp;<span class="ident" id="5749595">typ</span><span class="op" id="5749598">,</span>&nbsp;<span class="ident" id="5749600">Comment</span><span class="op" id="5749607">:</span>&nbsp;<span class="ident" id="5749609">p</span><span class="op" id="5749610">.</span><span class="ident" id="5749611">lineComment</span><span class="op" id="5749622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749625">p</span><span class="op" id="5749626">.</span><span class="ident" id="5749627">declare</span><span class="op" id="5749634">(</span><span class="ident" id="5749635">spec</span><span class="op" id="5749639">,</span>&nbsp;<span class="ident" id="5749641">nil</span><span class="op" id="5749644">,</span>&nbsp;<span class="ident" id="5749646">scope</span><span class="op" id="5749651">,</span>&nbsp;<span class="ident" id="5749653">ast</span><span class="op" id="5749656">.</span><span class="ident" id="5749657">Fun</span><span class="op" id="5749660">,</span>&nbsp;<span class="ident" id="5749662">idents</span><span class="op" id="5749668">...</span><span class="op" id="5749671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749675">return</span>&nbsp;<span class="ident" id="5749682">spec</span><br>
<span class="lineno"></span><span class="op" id="5749687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5749690">func</span>&nbsp;<span class="op" id="5749695">(</span><span class="ident" id="5749696">p</span>&nbsp;<span class="op" id="5749698">*</span><span class="ident" id="5749699">parser</span><span class="op" id="5749705">)</span>&nbsp;<span class="ident" id="5749707">parseInterfaceType</span><span class="op" id="5749725">(</span><span class="op" id="5749726">)</span>&nbsp;<span class="op" id="5749728">*</span><span class="ident" id="5749729">ast</span><span class="op" id="5749732">.</span><span class="ident" id="5749733">InterfaceType</span>&nbsp;<span class="op" id="5749747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749750">if</span>&nbsp;<span class="ident" id="5749753">p</span><span class="op" id="5749754">.</span><span class="ident" id="5749755">trace</span>&nbsp;<span class="op" id="5749761">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749765">defer</span>&nbsp;<span class="ident" id="5749771">un</span><span class="op" id="5749773">(</span><span class="ident" id="5749774">trace</span><span class="op" id="5749779">(</span><span class="ident" id="5749780">p</span><span class="op" id="5749781">,</span>&nbsp;<span class="string" id="5749783">&#34;InterfaceType&#34;</span><span class="op" id="5749798">)</span><span class="op" id="5749799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749806">pos</span>&nbsp;<span class="op" id="5749810">:=</span>&nbsp;<span class="ident" id="5749813">p</span><span class="op" id="5749814">.</span><span class="ident" id="5749815">expect</span><span class="op" id="5749821">(</span><span class="ident" id="5749822">token</span><span class="op" id="5749827">.</span><span class="ident" id="5749828">INTERFACE</span><span class="op" id="5749837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749840">lbrace</span>&nbsp;<span class="op" id="5749847">:=</span>&nbsp;<span class="ident" id="5749850">p</span><span class="op" id="5749851">.</span><span class="ident" id="5749852">expect</span><span class="op" id="5749858">(</span><span class="ident" id="5749859">token</span><span class="op" id="5749864">.</span><span class="ident" id="5749865">LBRACE</span><span class="op" id="5749871">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749874">scope</span>&nbsp;<span class="op" id="5749880">:=</span>&nbsp;<span class="ident" id="5749883">ast</span><span class="op" id="5749886">.</span><span class="ident" id="5749887">NewScope</span><span class="op" id="5749895">(</span><span class="ident" id="5749896">nil</span><span class="op" id="5749899">)</span>&nbsp;<span class="comment" id="5749901">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749921">var</span>&nbsp;<span class="ident" id="5749925">list</span>&nbsp;<span class="op" id="5749930">[</span><span class="op" id="5749931">]</span><span class="op" id="5749932">*</span><span class="ident" id="5749933">ast</span><span class="op" id="5749936">.</span><span class="ident" id="5749937">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749944">for</span>&nbsp;<span class="ident" id="5749948">p</span><span class="op" id="5749949">.</span><span class="ident" id="5749950">tok</span>&nbsp;<span class="op" id="5749954">==</span>&nbsp;<span class="ident" id="5749957">token</span><span class="op" id="5749962">.</span><span class="ident" id="5749963">IDENT</span>&nbsp;<span class="op" id="5749969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749973">list</span>&nbsp;<span class="op" id="5749978">=</span>&nbsp;<span class="builtinfunc" id="5749980">append</span><span class="op" id="5749986">(</span><span class="ident" id="5749987">list</span><span class="op" id="5749991">,</span>&nbsp;<span class="ident" id="5749993">p</span><span class="op" id="5749994">.</span><span class="ident" id="5749995">parseMethodSpec</span><span class="op" id="5750010">(</span><span class="ident" id="5750011">scope</span><span class="op" id="5750016">)</span><span class="op" id="5750017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750020">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750023">rbrace</span>&nbsp;<span class="op" id="5750030">:=</span>&nbsp;<span class="ident" id="5750033">p</span><span class="op" id="5750034">.</span><span class="ident" id="5750035">expect</span><span class="op" id="5750041">(</span><span class="ident" id="5750042">token</span><span class="op" id="5750047">.</span><span class="ident" id="5750048">RBRACE</span><span class="op" id="5750054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750058">return</span>&nbsp;<span class="op" id="5750065">&amp;</span><span class="ident" id="5750066">ast</span><span class="op" id="5750069">.</span><span class="ident" id="5750070">InterfaceType</span><span class="op" id="5750083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750087">Interface</span><span class="op" id="5750096">:</span>&nbsp;<span class="ident" id="5750098">pos</span><span class="op" id="5750101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750105">Methods</span><span class="op" id="5750112">:</span>&nbsp;<span class="op" id="5750114">&amp;</span><span class="ident" id="5750115">ast</span><span class="op" id="5750118">.</span><span class="ident" id="5750119">FieldList</span><span class="op" id="5750128">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750133">Opening</span><span class="op" id="5750140">:</span>&nbsp;<span class="ident" id="5750142">lbrace</span><span class="op" id="5750148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750153">List</span><span class="op" id="5750157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750162">list</span><span class="op" id="5750166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750171">Closing</span><span class="op" id="5750178">:</span>&nbsp;<span class="ident" id="5750180">rbrace</span><span class="op" id="5750186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750190">}</span><span class="op" id="5750191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750194">}</span><br>
<span class="lineno">965</span><span class="op" id="5750196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5750199">func</span>&nbsp;<span class="op" id="5750204">(</span><span class="ident" id="5750205">p</span>&nbsp;<span class="op" id="5750207">*</span><span class="ident" id="5750208">parser</span><span class="op" id="5750214">)</span>&nbsp;<span class="ident" id="5750216">parseMapType</span><span class="op" id="5750228">(</span><span class="op" id="5750229">)</span>&nbsp;<span class="op" id="5750231">*</span><span class="ident" id="5750232">ast</span><span class="op" id="5750235">.</span><span class="ident" id="5750236">MapType</span>&nbsp;<span class="op" id="5750244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750247">if</span>&nbsp;<span class="ident" id="5750250">p</span><span class="op" id="5750251">.</span><span class="ident" id="5750252">trace</span>&nbsp;<span class="op" id="5750258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750262">defer</span>&nbsp;<span class="ident" id="5750268">un</span><span class="op" id="5750270">(</span><span class="ident" id="5750271">trace</span><span class="op" id="5750276">(</span><span class="ident" id="5750277">p</span><span class="op" id="5750278">,</span>&nbsp;<span class="string" id="5750280">&#34;MapType&#34;</span><span class="op" id="5750289">)</span><span class="op" id="5750290">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750297">pos</span>&nbsp;<span class="op" id="5750301">:=</span>&nbsp;<span class="ident" id="5750304">p</span><span class="op" id="5750305">.</span><span class="ident" id="5750306">expect</span><span class="op" id="5750312">(</span><span class="ident" id="5750313">token</span><span class="op" id="5750318">.</span><span class="ident" id="5750319">MAP</span><span class="op" id="5750322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750325">p</span><span class="op" id="5750326">.</span><span class="ident" id="5750327">expect</span><span class="op" id="5750333">(</span><span class="ident" id="5750334">token</span><span class="op" id="5750339">.</span><span class="ident" id="5750340">LBRACK</span><span class="op" id="5750346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750349">key</span>&nbsp;<span class="op" id="5750353">:=</span>&nbsp;<span class="ident" id="5750356">p</span><span class="op" id="5750357">.</span><span class="ident" id="5750358">parseType</span><span class="op" id="5750367">(</span><span class="op" id="5750368">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750371">p</span><span class="op" id="5750372">.</span><span class="ident" id="5750373">expect</span><span class="op" id="5750379">(</span><span class="ident" id="5750380">token</span><span class="op" id="5750385">.</span><span class="ident" id="5750386">RBRACK</span><span class="op" id="5750392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750395">value</span>&nbsp;<span class="op" id="5750401">:=</span>&nbsp;<span class="ident" id="5750404">p</span><span class="op" id="5750405">.</span><span class="ident" id="5750406">parseType</span><span class="op" id="5750415">(</span><span class="op" id="5750416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750420">return</span>&nbsp;<span class="op" id="5750427">&amp;</span><span class="ident" id="5750428">ast</span><span class="op" id="5750431">.</span><span class="ident" id="5750432">MapType</span><span class="op" id="5750439">{</span><span class="ident" id="5750440">Map</span><span class="op" id="5750443">:</span>&nbsp;<span class="ident" id="5750445">pos</span><span class="op" id="5750448">,</span>&nbsp;<span class="ident" id="5750450">Key</span><span class="op" id="5750453">:</span>&nbsp;<span class="ident" id="5750455">key</span><span class="op" id="5750458">,</span>&nbsp;<span class="ident" id="5750460">Value</span><span class="op" id="5750465">:</span>&nbsp;<span class="ident" id="5750467">value</span><span class="op" id="5750472">}</span><br>
<span class="lineno"></span><span class="op" id="5750474">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="5750477">func</span>&nbsp;<span class="op" id="5750482">(</span><span class="ident" id="5750483">p</span>&nbsp;<span class="op" id="5750485">*</span><span class="ident" id="5750486">parser</span><span class="op" id="5750492">)</span>&nbsp;<span class="ident" id="5750494">parseChanType</span><span class="op" id="5750507">(</span><span class="op" id="5750508">)</span>&nbsp;<span class="op" id="5750510">*</span><span class="ident" id="5750511">ast</span><span class="op" id="5750514">.</span><span class="ident" id="5750515">ChanType</span>&nbsp;<span class="op" id="5750524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750527">if</span>&nbsp;<span class="ident" id="5750530">p</span><span class="op" id="5750531">.</span><span class="ident" id="5750532">trace</span>&nbsp;<span class="op" id="5750538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750542">defer</span>&nbsp;<span class="ident" id="5750548">un</span><span class="op" id="5750550">(</span><span class="ident" id="5750551">trace</span><span class="op" id="5750556">(</span><span class="ident" id="5750557">p</span><span class="op" id="5750558">,</span>&nbsp;<span class="string" id="5750560">&#34;ChanType&#34;</span><span class="op" id="5750570">)</span><span class="op" id="5750571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750574">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750578">pos</span>&nbsp;<span class="op" id="5750582">:=</span>&nbsp;<span class="ident" id="5750585">p</span><span class="op" id="5750586">.</span><span class="ident" id="5750587">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750592">dir</span>&nbsp;<span class="op" id="5750596">:=</span>&nbsp;<span class="ident" id="5750599">ast</span><span class="op" id="5750602">.</span><span class="ident" id="5750603">SEND</span>&nbsp;<span class="op" id="5750608">|</span>&nbsp;<span class="ident" id="5750610">ast</span><span class="op" id="5750613">.</span><span class="ident" id="5750614">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750620">var</span>&nbsp;<span class="ident" id="5750624">arrow</span>&nbsp;<span class="ident" id="5750630">token</span><span class="op" id="5750635">.</span><span class="ident" id="5750636">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750641">if</span>&nbsp;<span class="ident" id="5750644">p</span><span class="op" id="5750645">.</span><span class="ident" id="5750646">tok</span>&nbsp;<span class="op" id="5750650">==</span>&nbsp;<span class="ident" id="5750653">token</span><span class="op" id="5750658">.</span><span class="ident" id="5750659">CHAN</span>&nbsp;<span class="op" id="5750664">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750668">p</span><span class="op" id="5750669">.</span><span class="ident" id="5750670">next</span><span class="op" id="5750674">(</span><span class="op" id="5750675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750679">if</span>&nbsp;<span class="ident" id="5750682">p</span><span class="op" id="5750683">.</span><span class="ident" id="5750684">tok</span>&nbsp;<span class="op" id="5750688">==</span>&nbsp;<span class="ident" id="5750691">token</span><span class="op" id="5750696">.</span><span class="ident" id="5750697">ARROW</span>&nbsp;<span class="op" id="5750703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750708">arrow</span>&nbsp;<span class="op" id="5750714">=</span>&nbsp;<span class="ident" id="5750716">p</span><span class="op" id="5750717">.</span><span class="ident" id="5750718">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750725">p</span><span class="op" id="5750726">.</span><span class="ident" id="5750727">next</span><span class="op" id="5750731">(</span><span class="op" id="5750732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750737">dir</span>&nbsp;<span class="op" id="5750741">=</span>&nbsp;<span class="ident" id="5750743">ast</span><span class="op" id="5750746">.</span><span class="ident" id="5750747">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750757">}</span>&nbsp;<span class="keyword" id="5750759">else</span>&nbsp;<span class="op" id="5750764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750768">arrow</span>&nbsp;<span class="op" id="5750774">=</span>&nbsp;<span class="ident" id="5750776">p</span><span class="op" id="5750777">.</span><span class="ident" id="5750778">expect</span><span class="op" id="5750784">(</span><span class="ident" id="5750785">token</span><span class="op" id="5750790">.</span><span class="ident" id="5750791">ARROW</span><span class="op" id="5750796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750800">p</span><span class="op" id="5750801">.</span><span class="ident" id="5750802">expect</span><span class="op" id="5750808">(</span><span class="ident" id="5750809">token</span><span class="op" id="5750814">.</span><span class="ident" id="5750815">CHAN</span><span class="op" id="5750819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750823">dir</span>&nbsp;<span class="op" id="5750827">=</span>&nbsp;<span class="ident" id="5750829">ast</span><span class="op" id="5750832">.</span><span class="ident" id="5750833">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750842">value</span>&nbsp;<span class="op" id="5750848">:=</span>&nbsp;<span class="ident" id="5750851">p</span><span class="op" id="5750852">.</span><span class="ident" id="5750853">parseType</span><span class="op" id="5750862">(</span><span class="op" id="5750863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750867">return</span>&nbsp;<span class="op" id="5750874">&amp;</span><span class="ident" id="5750875">ast</span><span class="op" id="5750878">.</span><span class="ident" id="5750879">ChanType</span><span class="op" id="5750887">{</span><span class="ident" id="5750888">Begin</span><span class="op" id="5750893">:</span>&nbsp;<span class="ident" id="5750895">pos</span><span class="op" id="5750898">,</span>&nbsp;<span class="ident" id="5750900">Arrow</span><span class="op" id="5750905">:</span>&nbsp;<span class="ident" id="5750907">arrow</span><span class="op" id="5750912">,</span>&nbsp;<span class="ident" id="5750914">Dir</span><span class="op" id="5750917">:</span>&nbsp;<span class="ident" id="5750919">dir</span><span class="op" id="5750922">,</span>&nbsp;<span class="ident" id="5750924">Value</span><span class="op" id="5750929">:</span>&nbsp;<span class="ident" id="5750931">value</span><span class="op" id="5750936">}</span><br>
<span class="lineno"></span><span class="op" id="5750938">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="5750941">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5750996">func</span>&nbsp;<span class="op" id="5751001">(</span><span class="ident" id="5751002">p</span>&nbsp;<span class="op" id="5751004">*</span><span class="ident" id="5751005">parser</span><span class="op" id="5751011">)</span>&nbsp;<span class="ident" id="5751013">tryIdentOrType</span><span class="op" id="5751027">(</span><span class="op" id="5751028">)</span>&nbsp;<span class="ident" id="5751030">ast</span><span class="op" id="5751033">.</span><span class="ident" id="5751034">Expr</span>&nbsp;<span class="op" id="5751039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751042">switch</span>&nbsp;<span class="ident" id="5751049">p</span><span class="op" id="5751050">.</span><span class="ident" id="5751051">tok</span>&nbsp;<span class="op" id="5751055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751058">case</span>&nbsp;<span class="ident" id="5751063">token</span><span class="op" id="5751068">.</span><span class="ident" id="5751069">IDENT</span><span class="op" id="5751074">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751078">return</span>&nbsp;<span class="ident" id="5751085">p</span><span class="op" id="5751086">.</span><span class="ident" id="5751087">parseTypeName</span><span class="op" id="5751100">(</span><span class="op" id="5751101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751104">case</span>&nbsp;<span class="ident" id="5751109">token</span><span class="op" id="5751114">.</span><span class="ident" id="5751115">LBRACK</span><span class="op" id="5751121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751125">return</span>&nbsp;<span class="ident" id="5751132">p</span><span class="op" id="5751133">.</span><span class="ident" id="5751134">parseArrayType</span><span class="op" id="5751148">(</span><span class="op" id="5751149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751152">case</span>&nbsp;<span class="ident" id="5751157">token</span><span class="op" id="5751162">.</span><span class="ident" id="5751163">STRUCT</span><span class="op" id="5751169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751173">return</span>&nbsp;<span class="ident" id="5751180">p</span><span class="op" id="5751181">.</span><span class="ident" id="5751182">parseStructType</span><span class="op" id="5751197">(</span><span class="op" id="5751198">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751201">case</span>&nbsp;<span class="ident" id="5751206">token</span><span class="op" id="5751211">.</span><span class="ident" id="5751212">MUL</span><span class="op" id="5751215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751219">return</span>&nbsp;<span class="ident" id="5751226">p</span><span class="op" id="5751227">.</span><span class="ident" id="5751228">parsePointerType</span><span class="op" id="5751244">(</span><span class="op" id="5751245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751248">case</span>&nbsp;<span class="ident" id="5751253">token</span><span class="op" id="5751258">.</span><span class="ident" id="5751259">FUNC</span><span class="op" id="5751263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751267">typ</span><span class="op" id="5751270">,</span>&nbsp;<span class="ident" id="5751272">_</span>&nbsp;<span class="op" id="5751274">:=</span>&nbsp;<span class="ident" id="5751277">p</span><span class="op" id="5751278">.</span><span class="ident" id="5751279">parseFuncType</span><span class="op" id="5751292">(</span><span class="op" id="5751293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751297">return</span>&nbsp;<span class="ident" id="5751304">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751309">case</span>&nbsp;<span class="ident" id="5751314">token</span><span class="op" id="5751319">.</span><span class="ident" id="5751320">INTERFACE</span><span class="op" id="5751329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751333">return</span>&nbsp;<span class="ident" id="5751340">p</span><span class="op" id="5751341">.</span><span class="ident" id="5751342">parseInterfaceType</span><span class="op" id="5751360">(</span><span class="op" id="5751361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751364">case</span>&nbsp;<span class="ident" id="5751369">token</span><span class="op" id="5751374">.</span><span class="ident" id="5751375">MAP</span><span class="op" id="5751378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751382">return</span>&nbsp;<span class="ident" id="5751389">p</span><span class="op" id="5751390">.</span><span class="ident" id="5751391">parseMapType</span><span class="op" id="5751403">(</span><span class="op" id="5751404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751407">case</span>&nbsp;<span class="ident" id="5751412">token</span><span class="op" id="5751417">.</span><span class="ident" id="5751418">CHAN</span><span class="op" id="5751422">,</span>&nbsp;<span class="ident" id="5751424">token</span><span class="op" id="5751429">.</span><span class="ident" id="5751430">ARROW</span><span class="op" id="5751435">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751439">return</span>&nbsp;<span class="ident" id="5751446">p</span><span class="op" id="5751447">.</span><span class="ident" id="5751448">parseChanType</span><span class="op" id="5751461">(</span><span class="op" id="5751462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751465">case</span>&nbsp;<span class="ident" id="5751470">token</span><span class="op" id="5751475">.</span><span class="ident" id="5751476">LPAREN</span><span class="op" id="5751482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751486">lparen</span>&nbsp;<span class="op" id="5751493">:=</span>&nbsp;<span class="ident" id="5751496">p</span><span class="op" id="5751497">.</span><span class="ident" id="5751498">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751504">p</span><span class="op" id="5751505">.</span><span class="ident" id="5751506">next</span><span class="op" id="5751510">(</span><span class="op" id="5751511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751515">typ</span>&nbsp;<span class="op" id="5751519">:=</span>&nbsp;<span class="ident" id="5751522">p</span><span class="op" id="5751523">.</span><span class="ident" id="5751524">parseType</span><span class="op" id="5751533">(</span><span class="op" id="5751534">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751538">rparen</span>&nbsp;<span class="op" id="5751545">:=</span>&nbsp;<span class="ident" id="5751548">p</span><span class="op" id="5751549">.</span><span class="ident" id="5751550">expect</span><span class="op" id="5751556">(</span><span class="ident" id="5751557">token</span><span class="op" id="5751562">.</span><span class="ident" id="5751563">RPAREN</span><span class="op" id="5751569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751573">return</span>&nbsp;<span class="op" id="5751580">&amp;</span><span class="ident" id="5751581">ast</span><span class="op" id="5751584">.</span><span class="ident" id="5751585">ParenExpr</span><span class="op" id="5751594">{</span><span class="ident" id="5751595">Lparen</span><span class="op" id="5751601">:</span>&nbsp;<span class="ident" id="5751603">lparen</span><span class="op" id="5751609">,</span>&nbsp;<span class="ident" id="5751611">X</span><span class="op" id="5751612">:</span>&nbsp;<span class="ident" id="5751614">typ</span><span class="op" id="5751617">,</span>&nbsp;<span class="ident" id="5751619">Rparen</span><span class="op" id="5751625">:</span>&nbsp;<span class="ident" id="5751627">rparen</span><span class="op" id="5751633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751640">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751658">return</span>&nbsp;<span class="ident" id="5751665">nil</span><br>
<span class="lineno"></span><span class="op" id="5751669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751672">func</span>&nbsp;<span class="op" id="5751677">(</span><span class="ident" id="5751678">p</span>&nbsp;<span class="op" id="5751680">*</span><span class="ident" id="5751681">parser</span><span class="op" id="5751687">)</span>&nbsp;<span class="ident" id="5751689">tryType</span><span class="op" id="5751696">(</span><span class="op" id="5751697">)</span>&nbsp;<span class="ident" id="5751699">ast</span><span class="op" id="5751702">.</span><span class="ident" id="5751703">Expr</span>&nbsp;<span class="op" id="5751708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751711">typ</span>&nbsp;<span class="op" id="5751715">:=</span>&nbsp;<span class="ident" id="5751718">p</span><span class="op" id="5751719">.</span><span class="ident" id="5751720">tryIdentOrType</span><span class="op" id="5751734">(</span><span class="op" id="5751735">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751738">if</span>&nbsp;<span class="ident" id="5751741">typ</span>&nbsp;<span class="op" id="5751745">!=</span>&nbsp;<span class="ident" id="5751748">nil</span>&nbsp;<span class="op" id="5751752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751756">p</span><span class="op" id="5751757">.</span><span class="ident" id="5751758">resolve</span><span class="op" id="5751765">(</span><span class="ident" id="5751766">typ</span><span class="op" id="5751769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751775">return</span>&nbsp;<span class="ident" id="5751782">typ</span><br>
<span class="lineno"></span><span class="op" id="5751786">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="5751789">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5751869">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751880">func</span>&nbsp;<span class="op" id="5751885">(</span><span class="ident" id="5751886">p</span>&nbsp;<span class="op" id="5751888">*</span><span class="ident" id="5751889">parser</span><span class="op" id="5751895">)</span>&nbsp;<span class="ident" id="5751897">parseStmtList</span><span class="op" id="5751910">(</span><span class="op" id="5751911">)</span>&nbsp;<span class="op" id="5751913">(</span><span class="ident" id="5751914">list</span>&nbsp;<span class="op" id="5751919">[</span><span class="op" id="5751920">]</span><span class="ident" id="5751921">ast</span><span class="op" id="5751924">.</span><span class="ident" id="5751925">Stmt</span><span class="op" id="5751929">)</span>&nbsp;<span class="op" id="5751931">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751934">if</span>&nbsp;<span class="ident" id="5751937">p</span><span class="op" id="5751938">.</span><span class="ident" id="5751939">trace</span>&nbsp;<span class="op" id="5751945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751949">defer</span>&nbsp;<span class="ident" id="5751955">un</span><span class="op" id="5751957">(</span><span class="ident" id="5751958">trace</span><span class="op" id="5751963">(</span><span class="ident" id="5751964">p</span><span class="op" id="5751965">,</span>&nbsp;<span class="string" id="5751967">&#34;StatementList&#34;</span><span class="op" id="5751982">)</span><span class="op" id="5751983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751990">for</span>&nbsp;<span class="ident" id="5751994">p</span><span class="op" id="5751995">.</span><span class="ident" id="5751996">tok</span>&nbsp;<span class="op" id="5752000">!=</span>&nbsp;<span class="ident" id="5752003">token</span><span class="op" id="5752008">.</span><span class="ident" id="5752009">CASE</span>&nbsp;<span class="op" id="5752014">&amp;&amp;</span>&nbsp;<span class="ident" id="5752017">p</span><span class="op" id="5752018">.</span><span class="ident" id="5752019">tok</span>&nbsp;<span class="op" id="5752023">!=</span>&nbsp;<span class="ident" id="5752026">token</span><span class="op" id="5752031">.</span><span class="ident" id="5752032">DEFAULT</span>&nbsp;<span class="op" id="5752040">&amp;&amp;</span>&nbsp;<span class="ident" id="5752043">p</span><span class="op" id="5752044">.</span><span class="ident" id="5752045">tok</span>&nbsp;<span class="op" id="5752049">!=</span>&nbsp;<span class="ident" id="5752052">token</span><span class="op" id="5752057">.</span><span class="ident" id="5752058">RBRACE</span>&nbsp;<span class="op" id="5752065">&amp;&amp;</span>&nbsp;<span class="ident" id="5752068">p</span><span class="op" id="5752069">.</span><span class="ident" id="5752070">tok</span>&nbsp;<span class="op" id="5752074">!=</span>&nbsp;<span class="ident" id="5752077">token</span><span class="op" id="5752082">.</span><span class="ident" id="5752083">EOF</span>&nbsp;<span class="op" id="5752087">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752091">list</span>&nbsp;<span class="op" id="5752096">=</span>&nbsp;<span class="builtinfunc" id="5752098">append</span><span class="op" id="5752104">(</span><span class="ident" id="5752105">list</span><span class="op" id="5752109">,</span>&nbsp;<span class="ident" id="5752111">p</span><span class="op" id="5752112">.</span><span class="ident" id="5752113">parseStmt</span><span class="op" id="5752122">(</span><span class="op" id="5752123">)</span><span class="op" id="5752124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752131">return</span><br>
<span class="lineno"></span><span class="op" id="5752138">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="5752141">func</span>&nbsp;<span class="op" id="5752146">(</span><span class="ident" id="5752147">p</span>&nbsp;<span class="op" id="5752149">*</span><span class="ident" id="5752150">parser</span><span class="op" id="5752156">)</span>&nbsp;<span class="ident" id="5752158">parseBody</span><span class="op" id="5752167">(</span><span class="ident" id="5752168">scope</span>&nbsp;<span class="op" id="5752174">*</span><span class="ident" id="5752175">ast</span><span class="op" id="5752178">.</span><span class="ident" id="5752179">Scope</span><span class="op" id="5752184">)</span>&nbsp;<span class="op" id="5752186">*</span><span class="ident" id="5752187">ast</span><span class="op" id="5752190">.</span><span class="ident" id="5752191">BlockStmt</span>&nbsp;<span class="op" id="5752201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752204">if</span>&nbsp;<span class="ident" id="5752207">p</span><span class="op" id="5752208">.</span><span class="ident" id="5752209">trace</span>&nbsp;<span class="op" id="5752215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752219">defer</span>&nbsp;<span class="ident" id="5752225">un</span><span class="op" id="5752227">(</span><span class="ident" id="5752228">trace</span><span class="op" id="5752233">(</span><span class="ident" id="5752234">p</span><span class="op" id="5752235">,</span>&nbsp;<span class="string" id="5752237">&#34;Body&#34;</span><span class="op" id="5752243">)</span><span class="op" id="5752244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752247">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752251">lbrace</span>&nbsp;<span class="op" id="5752258">:=</span>&nbsp;<span class="ident" id="5752261">p</span><span class="op" id="5752262">.</span><span class="ident" id="5752263">expect</span><span class="op" id="5752269">(</span><span class="ident" id="5752270">token</span><span class="op" id="5752275">.</span><span class="ident" id="5752276">LBRACE</span><span class="op" id="5752282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752285">p</span><span class="op" id="5752286">.</span><span class="ident" id="5752287">topScope</span>&nbsp;<span class="op" id="5752296">=</span>&nbsp;<span class="ident" id="5752298">scope</span>&nbsp;<span class="comment" id="5752304">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752328">p</span><span class="op" id="5752329">.</span><span class="ident" id="5752330">openLabelScope</span><span class="op" id="5752344">(</span><span class="op" id="5752345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752348">list</span>&nbsp;<span class="op" id="5752353">:=</span>&nbsp;<span class="ident" id="5752356">p</span><span class="op" id="5752357">.</span><span class="ident" id="5752358">parseStmtList</span><span class="op" id="5752371">(</span><span class="op" id="5752372">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752375">p</span><span class="op" id="5752376">.</span><span class="ident" id="5752377">closeLabelScope</span><span class="op" id="5752392">(</span><span class="op" id="5752393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752396">p</span><span class="op" id="5752397">.</span><span class="ident" id="5752398">closeScope</span><span class="op" id="5752408">(</span><span class="op" id="5752409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752412">rbrace</span>&nbsp;<span class="op" id="5752419">:=</span>&nbsp;<span class="ident" id="5752422">p</span><span class="op" id="5752423">.</span><span class="ident" id="5752424">expect</span><span class="op" id="5752430">(</span><span class="ident" id="5752431">token</span><span class="op" id="5752436">.</span><span class="ident" id="5752437">RBRACE</span><span class="op" id="5752443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752447">return</span>&nbsp;<span class="op" id="5752454">&amp;</span><span class="ident" id="5752455">ast</span><span class="op" id="5752458">.</span><span class="ident" id="5752459">BlockStmt</span><span class="op" id="5752468">{</span><span class="ident" id="5752469">Lbrace</span><span class="op" id="5752475">:</span>&nbsp;<span class="ident" id="5752477">lbrace</span><span class="op" id="5752483">,</span>&nbsp;<span class="ident" id="5752485">List</span><span class="op" id="5752489">:</span>&nbsp;<span class="ident" id="5752491">list</span><span class="op" id="5752495">,</span>&nbsp;<span class="ident" id="5752497">Rbrace</span><span class="op" id="5752503">:</span>&nbsp;<span class="ident" id="5752505">rbrace</span><span class="op" id="5752511">}</span><br>
<span class="lineno">1075</span><span class="op" id="5752513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5752516">func</span>&nbsp;<span class="op" id="5752521">(</span><span class="ident" id="5752522">p</span>&nbsp;<span class="op" id="5752524">*</span><span class="ident" id="5752525">parser</span><span class="op" id="5752531">)</span>&nbsp;<span class="ident" id="5752533">parseBlockStmt</span><span class="op" id="5752547">(</span><span class="op" id="5752548">)</span>&nbsp;<span class="op" id="5752550">*</span><span class="ident" id="5752551">ast</span><span class="op" id="5752554">.</span><span class="ident" id="5752555">BlockStmt</span>&nbsp;<span class="op" id="5752565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752568">if</span>&nbsp;<span class="ident" id="5752571">p</span><span class="op" id="5752572">.</span><span class="ident" id="5752573">trace</span>&nbsp;<span class="op" id="5752579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752583">defer</span>&nbsp;<span class="ident" id="5752589">un</span><span class="op" id="5752591">(</span><span class="ident" id="5752592">trace</span><span class="op" id="5752597">(</span><span class="ident" id="5752598">p</span><span class="op" id="5752599">,</span>&nbsp;<span class="string" id="5752601">&#34;BlockStmt&#34;</span><span class="op" id="5752612">)</span><span class="op" id="5752613">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752620">lbrace</span>&nbsp;<span class="op" id="5752627">:=</span>&nbsp;<span class="ident" id="5752630">p</span><span class="op" id="5752631">.</span><span class="ident" id="5752632">expect</span><span class="op" id="5752638">(</span><span class="ident" id="5752639">token</span><span class="op" id="5752644">.</span><span class="ident" id="5752645">LBRACE</span><span class="op" id="5752651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752654">p</span><span class="op" id="5752655">.</span><span class="ident" id="5752656">openScope</span><span class="op" id="5752665">(</span><span class="op" id="5752666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752669">list</span>&nbsp;<span class="op" id="5752674">:=</span>&nbsp;<span class="ident" id="5752677">p</span><span class="op" id="5752678">.</span><span class="ident" id="5752679">parseStmtList</span><span class="op" id="5752692">(</span><span class="op" id="5752693">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752696">p</span><span class="op" id="5752697">.</span><span class="ident" id="5752698">closeScope</span><span class="op" id="5752708">(</span><span class="op" id="5752709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752712">rbrace</span>&nbsp;<span class="op" id="5752719">:=</span>&nbsp;<span class="ident" id="5752722">p</span><span class="op" id="5752723">.</span><span class="ident" id="5752724">expect</span><span class="op" id="5752730">(</span><span class="ident" id="5752731">token</span><span class="op" id="5752736">.</span><span class="ident" id="5752737">RBRACE</span><span class="op" id="5752743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752747">return</span>&nbsp;<span class="op" id="5752754">&amp;</span><span class="ident" id="5752755">ast</span><span class="op" id="5752758">.</span><span class="ident" id="5752759">BlockStmt</span><span class="op" id="5752768">{</span><span class="ident" id="5752769">Lbrace</span><span class="op" id="5752775">:</span>&nbsp;<span class="ident" id="5752777">lbrace</span><span class="op" id="5752783">,</span>&nbsp;<span class="ident" id="5752785">List</span><span class="op" id="5752789">:</span>&nbsp;<span class="ident" id="5752791">list</span><span class="op" id="5752795">,</span>&nbsp;<span class="ident" id="5752797">Rbrace</span><span class="op" id="5752803">:</span>&nbsp;<span class="ident" id="5752805">rbrace</span><span class="op" id="5752811">}</span><br>
<span class="lineno"></span><span class="op" id="5752813">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="5752816">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5752896">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5752912">func</span>&nbsp;<span class="op" id="5752917">(</span><span class="ident" id="5752918">p</span>&nbsp;<span class="op" id="5752920">*</span><span class="ident" id="5752921">parser</span><span class="op" id="5752927">)</span>&nbsp;<span class="ident" id="5752929">parseFuncTypeOrLit</span><span class="op" id="5752947">(</span><span class="op" id="5752948">)</span>&nbsp;<span class="ident" id="5752950">ast</span><span class="op" id="5752953">.</span><span class="ident" id="5752954">Expr</span>&nbsp;<span class="op" id="5752959">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752962">if</span>&nbsp;<span class="ident" id="5752965">p</span><span class="op" id="5752966">.</span><span class="ident" id="5752967">trace</span>&nbsp;<span class="op" id="5752973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752977">defer</span>&nbsp;<span class="ident" id="5752983">un</span><span class="op" id="5752985">(</span><span class="ident" id="5752986">trace</span><span class="op" id="5752991">(</span><span class="ident" id="5752992">p</span><span class="op" id="5752993">,</span>&nbsp;<span class="string" id="5752995">&#34;FuncTypeOrLit&#34;</span><span class="op" id="5753010">)</span><span class="op" id="5753011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753018">typ</span><span class="op" id="5753021">,</span>&nbsp;<span class="ident" id="5753023">scope</span>&nbsp;<span class="op" id="5753029">:=</span>&nbsp;<span class="ident" id="5753032">p</span><span class="op" id="5753033">.</span><span class="ident" id="5753034">parseFuncType</span><span class="op" id="5753047">(</span><span class="op" id="5753048">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753051">if</span>&nbsp;<span class="ident" id="5753054">p</span><span class="op" id="5753055">.</span><span class="ident" id="5753056">tok</span>&nbsp;<span class="op" id="5753060">!=</span>&nbsp;<span class="ident" id="5753063">token</span><span class="op" id="5753068">.</span><span class="ident" id="5753069">LBRACE</span>&nbsp;<span class="op" id="5753076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753080">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753104">return</span>&nbsp;<span class="ident" id="5753111">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753120">p</span><span class="op" id="5753121">.</span><span class="ident" id="5753122">exprLev</span><span class="op" id="5753129">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753133">body</span>&nbsp;<span class="op" id="5753138">:=</span>&nbsp;<span class="ident" id="5753141">p</span><span class="op" id="5753142">.</span><span class="ident" id="5753143">parseBody</span><span class="op" id="5753152">(</span><span class="ident" id="5753153">scope</span><span class="op" id="5753158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753161">p</span><span class="op" id="5753162">.</span><span class="ident" id="5753163">exprLev</span><span class="op" id="5753170">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753175">return</span>&nbsp;<span class="op" id="5753182">&amp;</span><span class="ident" id="5753183">ast</span><span class="op" id="5753186">.</span><span class="ident" id="5753187">FuncLit</span><span class="op" id="5753194">{</span><span class="ident" id="5753195">Type</span><span class="op" id="5753199">:</span>&nbsp;<span class="ident" id="5753201">typ</span><span class="op" id="5753204">,</span>&nbsp;<span class="ident" id="5753206">Body</span><span class="op" id="5753210">:</span>&nbsp;<span class="ident" id="5753212">body</span><span class="op" id="5753216">}</span><br>
<span class="lineno">1110</span><span class="op" id="5753218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5753221">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="5753289">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="5753350">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="5753420">//</span><br>
<span class="lineno"></span><span class="keyword" id="5753423">func</span>&nbsp;<span class="op" id="5753428">(</span><span class="ident" id="5753429">p</span>&nbsp;<span class="op" id="5753431">*</span><span class="ident" id="5753432">parser</span><span class="op" id="5753438">)</span>&nbsp;<span class="ident" id="5753440">parseOperand</span><span class="op" id="5753452">(</span><span class="ident" id="5753453">lhs</span>&nbsp;<span class="builtintype" id="5753457">bool</span><span class="op" id="5753461">)</span>&nbsp;<span class="ident" id="5753463">ast</span><span class="op" id="5753466">.</span><span class="ident" id="5753467">Expr</span>&nbsp;<span class="op" id="5753472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753475">if</span>&nbsp;<span class="ident" id="5753478">p</span><span class="op" id="5753479">.</span><span class="ident" id="5753480">trace</span>&nbsp;<span class="op" id="5753486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753490">defer</span>&nbsp;<span class="ident" id="5753496">un</span><span class="op" id="5753498">(</span><span class="ident" id="5753499">trace</span><span class="op" id="5753504">(</span><span class="ident" id="5753505">p</span><span class="op" id="5753506">,</span>&nbsp;<span class="string" id="5753508">&#34;Operand&#34;</span><span class="op" id="5753517">)</span><span class="op" id="5753518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753521">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753525">switch</span>&nbsp;<span class="ident" id="5753532">p</span><span class="op" id="5753533">.</span><span class="ident" id="5753534">tok</span>&nbsp;<span class="op" id="5753538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753541">case</span>&nbsp;<span class="ident" id="5753546">token</span><span class="op" id="5753551">.</span><span class="ident" id="5753552">IDENT</span><span class="op" id="5753557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753561">x</span>&nbsp;<span class="op" id="5753563">:=</span>&nbsp;<span class="ident" id="5753566">p</span><span class="op" id="5753567">.</span><span class="ident" id="5753568">parseIdent</span><span class="op" id="5753578">(</span><span class="op" id="5753579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753583">if</span>&nbsp;<span class="op" id="5753586">!</span><span class="ident" id="5753587">lhs</span>&nbsp;<span class="op" id="5753591">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753596">p</span><span class="op" id="5753597">.</span><span class="ident" id="5753598">resolve</span><span class="op" id="5753605">(</span><span class="ident" id="5753606">x</span><span class="op" id="5753607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753615">return</span>&nbsp;<span class="ident" id="5753622">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753626">case</span>&nbsp;<span class="ident" id="5753631">token</span><span class="op" id="5753636">.</span><span class="ident" id="5753637">INT</span><span class="op" id="5753640">,</span>&nbsp;<span class="ident" id="5753642">token</span><span class="op" id="5753647">.</span><span class="ident" id="5753648">FLOAT</span><span class="op" id="5753653">,</span>&nbsp;<span class="ident" id="5753655">token</span><span class="op" id="5753660">.</span><span class="ident" id="5753661">IMAG</span><span class="op" id="5753665">,</span>&nbsp;<span class="ident" id="5753667">token</span><span class="op" id="5753672">.</span><span class="ident" id="5753673">CHAR</span><span class="op" id="5753677">,</span>&nbsp;<span class="ident" id="5753679">token</span><span class="op" id="5753684">.</span><span class="ident" id="5753685">STRING</span><span class="op" id="5753691">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753695">x</span>&nbsp;<span class="op" id="5753697">:=</span>&nbsp;<span class="op" id="5753700">&amp;</span><span class="ident" id="5753701">ast</span><span class="op" id="5753704">.</span><span class="ident" id="5753705">BasicLit</span><span class="op" id="5753713">{</span><span class="ident" id="5753714">ValuePos</span><span class="op" id="5753722">:</span>&nbsp;<span class="ident" id="5753724">p</span><span class="op" id="5753725">.</span><span class="ident" id="5753726">pos</span><span class="op" id="5753729">,</span>&nbsp;<span class="ident" id="5753731">Kind</span><span class="op" id="5753735">:</span>&nbsp;<span class="ident" id="5753737">p</span><span class="op" id="5753738">.</span><span class="ident" id="5753739">tok</span><span class="op" id="5753742">,</span>&nbsp;<span class="ident" id="5753744">Value</span><span class="op" id="5753749">:</span>&nbsp;<span class="ident" id="5753751">p</span><span class="op" id="5753752">.</span><span class="ident" id="5753753">lit</span><span class="op" id="5753756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753760">p</span><span class="op" id="5753761">.</span><span class="ident" id="5753762">next</span><span class="op" id="5753766">(</span><span class="op" id="5753767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753771">return</span>&nbsp;<span class="ident" id="5753778">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753782">case</span>&nbsp;<span class="ident" id="5753787">token</span><span class="op" id="5753792">.</span><span class="ident" id="5753793">LPAREN</span><span class="op" id="5753799">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753803">lparen</span>&nbsp;<span class="op" id="5753810">:=</span>&nbsp;<span class="ident" id="5753813">p</span><span class="op" id="5753814">.</span><span class="ident" id="5753815">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753821">p</span><span class="op" id="5753822">.</span><span class="ident" id="5753823">next</span><span class="op" id="5753827">(</span><span class="op" id="5753828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753832">p</span><span class="op" id="5753833">.</span><span class="ident" id="5753834">exprLev</span><span class="op" id="5753841">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753846">x</span>&nbsp;<span class="op" id="5753848">:=</span>&nbsp;<span class="ident" id="5753851">p</span><span class="op" id="5753852">.</span><span class="ident" id="5753853">parseRhsOrType</span><span class="op" id="5753867">(</span><span class="op" id="5753868">)</span>&nbsp;<span class="comment" id="5753870">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753915">p</span><span class="op" id="5753916">.</span><span class="ident" id="5753917">exprLev</span><span class="op" id="5753924">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753929">rparen</span>&nbsp;<span class="op" id="5753936">:=</span>&nbsp;<span class="ident" id="5753939">p</span><span class="op" id="5753940">.</span><span class="ident" id="5753941">expect</span><span class="op" id="5753947">(</span><span class="ident" id="5753948">token</span><span class="op" id="5753953">.</span><span class="ident" id="5753954">RPAREN</span><span class="op" id="5753960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753964">return</span>&nbsp;<span class="op" id="5753971">&amp;</span><span class="ident" id="5753972">ast</span><span class="op" id="5753975">.</span><span class="ident" id="5753976">ParenExpr</span><span class="op" id="5753985">{</span><span class="ident" id="5753986">Lparen</span><span class="op" id="5753992">:</span>&nbsp;<span class="ident" id="5753994">lparen</span><span class="op" id="5754000">,</span>&nbsp;<span class="ident" id="5754002">X</span><span class="op" id="5754003">:</span>&nbsp;<span class="ident" id="5754005">x</span><span class="op" id="5754006">,</span>&nbsp;<span class="ident" id="5754008">Rparen</span><span class="op" id="5754014">:</span>&nbsp;<span class="ident" id="5754016">rparen</span><span class="op" id="5754022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754026">case</span>&nbsp;<span class="ident" id="5754031">token</span><span class="op" id="5754036">.</span><span class="ident" id="5754037">FUNC</span><span class="op" id="5754041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754045">return</span>&nbsp;<span class="ident" id="5754052">p</span><span class="op" id="5754053">.</span><span class="ident" id="5754054">parseFuncTypeOrLit</span><span class="op" id="5754072">(</span><span class="op" id="5754073">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754080">if</span>&nbsp;<span class="ident" id="5754083">typ</span>&nbsp;<span class="op" id="5754087">:=</span>&nbsp;<span class="ident" id="5754090">p</span><span class="op" id="5754091">.</span><span class="ident" id="5754092">tryIdentOrType</span><span class="op" id="5754106">(</span><span class="op" id="5754107">)</span><span class="op" id="5754108">;</span>&nbsp;<span class="ident" id="5754110">typ</span>&nbsp;<span class="op" id="5754114">!=</span>&nbsp;<span class="ident" id="5754117">nil</span>&nbsp;<span class="op" id="5754121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754125">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754180">_</span><span class="op" id="5754181">,</span>&nbsp;<span class="ident" id="5754183">isIdent</span>&nbsp;<span class="op" id="5754191">:=</span>&nbsp;<span class="ident" id="5754194">typ</span><span class="op" id="5754197">.</span><span class="op" id="5754198">(</span><span class="op" id="5754199">*</span><span class="ident" id="5754200">ast</span><span class="op" id="5754203">.</span><span class="ident" id="5754204">Ident</span><span class="op" id="5754209">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754213">assert</span><span class="op" id="5754219">(</span><span class="op" id="5754220">!</span><span class="ident" id="5754221">isIdent</span><span class="op" id="5754228">,</span>&nbsp;<span class="string" id="5754230">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="5754257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754261">return</span>&nbsp;<span class="ident" id="5754268">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754277">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754298">pos</span>&nbsp;<span class="op" id="5754302">:=</span>&nbsp;<span class="ident" id="5754305">p</span><span class="op" id="5754306">.</span><span class="ident" id="5754307">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754312">p</span><span class="op" id="5754313">.</span><span class="ident" id="5754314">errorExpected</span><span class="op" id="5754327">(</span><span class="ident" id="5754328">pos</span><span class="op" id="5754331">,</span>&nbsp;<span class="string" id="5754333">&#34;operand&#34;</span><span class="op" id="5754342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754345">syncStmt</span><span class="op" id="5754353">(</span><span class="ident" id="5754354">p</span><span class="op" id="5754355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754358">return</span>&nbsp;<span class="op" id="5754365">&amp;</span><span class="ident" id="5754366">ast</span><span class="op" id="5754369">.</span><span class="ident" id="5754370">BadExpr</span><span class="op" id="5754377">{</span><span class="ident" id="5754378">From</span><span class="op" id="5754382">:</span>&nbsp;<span class="ident" id="5754384">pos</span><span class="op" id="5754387">,</span>&nbsp;<span class="ident" id="5754389">To</span><span class="op" id="5754391">:</span>&nbsp;<span class="ident" id="5754393">p</span><span class="op" id="5754394">.</span><span class="ident" id="5754395">pos</span><span class="op" id="5754398">}</span><br>
<span class="lineno"></span><span class="op" id="5754400">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="5754403">func</span>&nbsp;<span class="op" id="5754408">(</span><span class="ident" id="5754409">p</span>&nbsp;<span class="op" id="5754411">*</span><span class="ident" id="5754412">parser</span><span class="op" id="5754418">)</span>&nbsp;<span class="ident" id="5754420">parseSelector</span><span class="op" id="5754433">(</span><span class="ident" id="5754434">x</span>&nbsp;<span class="ident" id="5754436">ast</span><span class="op" id="5754439">.</span><span class="ident" id="5754440">Expr</span><span class="op" id="5754444">)</span>&nbsp;<span class="ident" id="5754446">ast</span><span class="op" id="5754449">.</span><span class="ident" id="5754450">Expr</span>&nbsp;<span class="op" id="5754455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754458">if</span>&nbsp;<span class="ident" id="5754461">p</span><span class="op" id="5754462">.</span><span class="ident" id="5754463">trace</span>&nbsp;<span class="op" id="5754469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754473">defer</span>&nbsp;<span class="ident" id="5754479">un</span><span class="op" id="5754481">(</span><span class="ident" id="5754482">trace</span><span class="op" id="5754487">(</span><span class="ident" id="5754488">p</span><span class="op" id="5754489">,</span>&nbsp;<span class="string" id="5754491">&#34;Selector&#34;</span><span class="op" id="5754501">)</span><span class="op" id="5754502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754505">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754509">sel</span>&nbsp;<span class="op" id="5754513">:=</span>&nbsp;<span class="ident" id="5754516">p</span><span class="op" id="5754517">.</span><span class="ident" id="5754518">parseIdent</span><span class="op" id="5754528">(</span><span class="op" id="5754529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754533">return</span>&nbsp;<span class="op" id="5754540">&amp;</span><span class="ident" id="5754541">ast</span><span class="op" id="5754544">.</span><span class="ident" id="5754545">SelectorExpr</span><span class="op" id="5754557">{</span><span class="ident" id="5754558">X</span><span class="op" id="5754559">:</span>&nbsp;<span class="ident" id="5754561">x</span><span class="op" id="5754562">,</span>&nbsp;<span class="ident" id="5754564">Sel</span><span class="op" id="5754567">:</span>&nbsp;<span class="ident" id="5754569">sel</span><span class="op" id="5754572">}</span><br>
<span class="lineno"></span><span class="op" id="5754574">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="5754577">func</span>&nbsp;<span class="op" id="5754582">(</span><span class="ident" id="5754583">p</span>&nbsp;<span class="op" id="5754585">*</span><span class="ident" id="5754586">parser</span><span class="op" id="5754592">)</span>&nbsp;<span class="ident" id="5754594">parseTypeAssertion</span><span class="op" id="5754612">(</span><span class="ident" id="5754613">x</span>&nbsp;<span class="ident" id="5754615">ast</span><span class="op" id="5754618">.</span><span class="ident" id="5754619">Expr</span><span class="op" id="5754623">)</span>&nbsp;<span class="ident" id="5754625">ast</span><span class="op" id="5754628">.</span><span class="ident" id="5754629">Expr</span>&nbsp;<span class="op" id="5754634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754637">if</span>&nbsp;<span class="ident" id="5754640">p</span><span class="op" id="5754641">.</span><span class="ident" id="5754642">trace</span>&nbsp;<span class="op" id="5754648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754652">defer</span>&nbsp;<span class="ident" id="5754658">un</span><span class="op" id="5754660">(</span><span class="ident" id="5754661">trace</span><span class="op" id="5754666">(</span><span class="ident" id="5754667">p</span><span class="op" id="5754668">,</span>&nbsp;<span class="string" id="5754670">&#34;TypeAssertion&#34;</span><span class="op" id="5754685">)</span><span class="op" id="5754686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754689">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754693">lparen</span>&nbsp;<span class="op" id="5754700">:=</span>&nbsp;<span class="ident" id="5754703">p</span><span class="op" id="5754704">.</span><span class="ident" id="5754705">expect</span><span class="op" id="5754711">(</span><span class="ident" id="5754712">token</span><span class="op" id="5754717">.</span><span class="ident" id="5754718">LPAREN</span><span class="op" id="5754724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754727">var</span>&nbsp;<span class="ident" id="5754731">typ</span>&nbsp;<span class="ident" id="5754735">ast</span><span class="op" id="5754738">.</span><span class="ident" id="5754739">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754745">if</span>&nbsp;<span class="ident" id="5754748">p</span><span class="op" id="5754749">.</span><span class="ident" id="5754750">tok</span>&nbsp;<span class="op" id="5754754">==</span>&nbsp;<span class="ident" id="5754757">token</span><span class="op" id="5754762">.</span><span class="ident" id="5754763">TYPE</span>&nbsp;<span class="op" id="5754768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754772">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754801">p</span><span class="op" id="5754802">.</span><span class="ident" id="5754803">next</span><span class="op" id="5754807">(</span><span class="op" id="5754808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754811">}</span>&nbsp;<span class="keyword" id="5754813">else</span>&nbsp;<span class="op" id="5754818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754822">typ</span>&nbsp;<span class="op" id="5754826">=</span>&nbsp;<span class="ident" id="5754828">p</span><span class="op" id="5754829">.</span><span class="ident" id="5754830">parseType</span><span class="op" id="5754839">(</span><span class="op" id="5754840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754846">rparen</span>&nbsp;<span class="op" id="5754853">:=</span>&nbsp;<span class="ident" id="5754856">p</span><span class="op" id="5754857">.</span><span class="ident" id="5754858">expect</span><span class="op" id="5754864">(</span><span class="ident" id="5754865">token</span><span class="op" id="5754870">.</span><span class="ident" id="5754871">RPAREN</span><span class="op" id="5754877">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754881">return</span>&nbsp;<span class="op" id="5754888">&amp;</span><span class="ident" id="5754889">ast</span><span class="op" id="5754892">.</span><span class="ident" id="5754893">TypeAssertExpr</span><span class="op" id="5754907">{</span><span class="ident" id="5754908">X</span><span class="op" id="5754909">:</span>&nbsp;<span class="ident" id="5754911">x</span><span class="op" id="5754912">,</span>&nbsp;<span class="ident" id="5754914">Type</span><span class="op" id="5754918">:</span>&nbsp;<span class="ident" id="5754920">typ</span><span class="op" id="5754923">,</span>&nbsp;<span class="ident" id="5754925">Lparen</span><span class="op" id="5754931">:</span>&nbsp;<span class="ident" id="5754933">lparen</span><span class="op" id="5754939">,</span>&nbsp;<span class="ident" id="5754941">Rparen</span><span class="op" id="5754947">:</span>&nbsp;<span class="ident" id="5754949">rparen</span><span class="op" id="5754955">}</span><br>
<span class="lineno"></span><span class="op" id="5754957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5754960">func</span>&nbsp;<span class="op" id="5754965">(</span><span class="ident" id="5754966">p</span>&nbsp;<span class="op" id="5754968">*</span><span class="ident" id="5754969">parser</span><span class="op" id="5754975">)</span>&nbsp;<span class="ident" id="5754977">parseIndexOrSlice</span><span class="op" id="5754994">(</span><span class="ident" id="5754995">x</span>&nbsp;<span class="ident" id="5754997">ast</span><span class="op" id="5755000">.</span><span class="ident" id="5755001">Expr</span><span class="op" id="5755005">)</span>&nbsp;<span class="ident" id="5755007">ast</span><span class="op" id="5755010">.</span><span class="ident" id="5755011">Expr</span>&nbsp;<span class="op" id="5755016">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755019">if</span>&nbsp;<span class="ident" id="5755022">p</span><span class="op" id="5755023">.</span><span class="ident" id="5755024">trace</span>&nbsp;<span class="op" id="5755030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755034">defer</span>&nbsp;<span class="ident" id="5755040">un</span><span class="op" id="5755042">(</span><span class="ident" id="5755043">trace</span><span class="op" id="5755048">(</span><span class="ident" id="5755049">p</span><span class="op" id="5755050">,</span>&nbsp;<span class="string" id="5755052">&#34;IndexOrSlice&#34;</span><span class="op" id="5755066">)</span><span class="op" id="5755067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755074">const</span>&nbsp;<span class="ident" id="5755080">N</span>&nbsp;<span class="op" id="5755082">=</span>&nbsp;<span class="num" id="5755084">3</span>&nbsp;<span class="comment" id="5755086">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755134">lbrack</span>&nbsp;<span class="op" id="5755141">:=</span>&nbsp;<span class="ident" id="5755144">p</span><span class="op" id="5755145">.</span><span class="ident" id="5755146">expect</span><span class="op" id="5755152">(</span><span class="ident" id="5755153">token</span><span class="op" id="5755158">.</span><span class="ident" id="5755159">LBRACK</span><span class="op" id="5755165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755168">p</span><span class="op" id="5755169">.</span><span class="ident" id="5755170">exprLev</span><span class="op" id="5755177">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755181">var</span>&nbsp;<span class="ident" id="5755185">index</span>&nbsp;<span class="op" id="5755191">[</span><span class="ident" id="5755192">N</span><span class="op" id="5755193">]</span><span class="ident" id="5755194">ast</span><span class="op" id="5755197">.</span><span class="ident" id="5755198">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755204">var</span>&nbsp;<span class="ident" id="5755208">colons</span>&nbsp;<span class="op" id="5755215">[</span><span class="ident" id="5755216">N</span>&nbsp;<span class="op" id="5755218">-</span>&nbsp;<span class="num" id="5755220">1</span><span class="op" id="5755221">]</span><span class="ident" id="5755222">token</span><span class="op" id="5755227">.</span><span class="ident" id="5755228">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755233">if</span>&nbsp;<span class="ident" id="5755236">p</span><span class="op" id="5755237">.</span><span class="ident" id="5755238">tok</span>&nbsp;<span class="op" id="5755242">!=</span>&nbsp;<span class="ident" id="5755245">token</span><span class="op" id="5755250">.</span><span class="ident" id="5755251">COLON</span>&nbsp;<span class="op" id="5755257">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755261">index</span><span class="op" id="5755266">[</span><span class="num" id="5755267">0</span><span class="op" id="5755268">]</span>&nbsp;<span class="op" id="5755270">=</span>&nbsp;<span class="ident" id="5755272">p</span><span class="op" id="5755273">.</span><span class="ident" id="5755274">parseRhs</span><span class="op" id="5755282">(</span><span class="op" id="5755283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755289">ncolons</span>&nbsp;<span class="op" id="5755297">:=</span>&nbsp;<span class="num" id="5755300">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755303">for</span>&nbsp;<span class="ident" id="5755307">p</span><span class="op" id="5755308">.</span><span class="ident" id="5755309">tok</span>&nbsp;<span class="op" id="5755313">==</span>&nbsp;<span class="ident" id="5755316">token</span><span class="op" id="5755321">.</span><span class="ident" id="5755322">COLON</span>&nbsp;<span class="op" id="5755328">&amp;&amp;</span>&nbsp;<span class="ident" id="5755331">ncolons</span>&nbsp;<span class="op" id="5755339">&lt;</span>&nbsp;<span class="builtinfunc" id="5755341">len</span><span class="op" id="5755344">(</span><span class="ident" id="5755345">colons</span><span class="op" id="5755351">)</span>&nbsp;<span class="op" id="5755353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755357">colons</span><span class="op" id="5755363">[</span><span class="ident" id="5755364">ncolons</span><span class="op" id="5755371">]</span>&nbsp;<span class="op" id="5755373">=</span>&nbsp;<span class="ident" id="5755375">p</span><span class="op" id="5755376">.</span><span class="ident" id="5755377">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755383">ncolons</span><span class="op" id="5755390">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755395">p</span><span class="op" id="5755396">.</span><span class="ident" id="5755397">next</span><span class="op" id="5755401">(</span><span class="op" id="5755402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755406">if</span>&nbsp;<span class="ident" id="5755409">p</span><span class="op" id="5755410">.</span><span class="ident" id="5755411">tok</span>&nbsp;<span class="op" id="5755415">!=</span>&nbsp;<span class="ident" id="5755418">token</span><span class="op" id="5755423">.</span><span class="ident" id="5755424">COLON</span>&nbsp;<span class="op" id="5755430">&amp;&amp;</span>&nbsp;<span class="ident" id="5755433">p</span><span class="op" id="5755434">.</span><span class="ident" id="5755435">tok</span>&nbsp;<span class="op" id="5755439">!=</span>&nbsp;<span class="ident" id="5755442">token</span><span class="op" id="5755447">.</span><span class="ident" id="5755448">RBRACK</span>&nbsp;<span class="op" id="5755455">&amp;&amp;</span>&nbsp;<span class="ident" id="5755458">p</span><span class="op" id="5755459">.</span><span class="ident" id="5755460">tok</span>&nbsp;<span class="op" id="5755464">!=</span>&nbsp;<span class="ident" id="5755467">token</span><span class="op" id="5755472">.</span><span class="ident" id="5755473">EOF</span>&nbsp;<span class="op" id="5755477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755482">index</span><span class="op" id="5755487">[</span><span class="ident" id="5755488">ncolons</span><span class="op" id="5755495">]</span>&nbsp;<span class="op" id="5755497">=</span>&nbsp;<span class="ident" id="5755499">p</span><span class="op" id="5755500">.</span><span class="ident" id="5755501">parseRhs</span><span class="op" id="5755509">(</span><span class="op" id="5755510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755514">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755520">p</span><span class="op" id="5755521">.</span><span class="ident" id="5755522">exprLev</span><span class="op" id="5755529">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755533">rbrack</span>&nbsp;<span class="op" id="5755540">:=</span>&nbsp;<span class="ident" id="5755543">p</span><span class="op" id="5755544">.</span><span class="ident" id="5755545">expect</span><span class="op" id="5755551">(</span><span class="ident" id="5755552">token</span><span class="op" id="5755557">.</span><span class="ident" id="5755558">RBRACK</span><span class="op" id="5755564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755568">if</span>&nbsp;<span class="ident" id="5755571">ncolons</span>&nbsp;<span class="op" id="5755579">&gt;</span>&nbsp;<span class="num" id="5755581">0</span>&nbsp;<span class="op" id="5755583">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755587">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755609">slice3</span>&nbsp;<span class="op" id="5755616">:=</span>&nbsp;<span class="builtintype" id="5755619">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755627">if</span>&nbsp;<span class="ident" id="5755630">ncolons</span>&nbsp;<span class="op" id="5755638">==</span>&nbsp;<span class="num" id="5755641">2</span>&nbsp;<span class="op" id="5755643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755648">slice3</span>&nbsp;<span class="op" id="5755655">=</span>&nbsp;<span class="builtintype" id="5755657">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755665">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755745">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755826">if</span>&nbsp;<span class="ident" id="5755829">index</span><span class="op" id="5755834">[</span><span class="num" id="5755835">1</span><span class="op" id="5755836">]</span>&nbsp;<span class="op" id="5755838">==</span>&nbsp;<span class="ident" id="5755841">nil</span>&nbsp;<span class="op" id="5755845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755851">p</span><span class="op" id="5755852">.</span><span class="builtintype" id="5755853">error</span><span class="op" id="5755858">(</span><span class="ident" id="5755859">colons</span><span class="op" id="5755865">[</span><span class="num" id="5755866">0</span><span class="op" id="5755867">]</span><span class="op" id="5755868">,</span>&nbsp;<span class="string" id="5755870">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5755907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755913">index</span><span class="op" id="5755918">[</span><span class="num" id="5755919">1</span><span class="op" id="5755920">]</span>&nbsp;<span class="op" id="5755922">=</span>&nbsp;<span class="op" id="5755924">&amp;</span><span class="ident" id="5755925">ast</span><span class="op" id="5755928">.</span><span class="ident" id="5755929">BadExpr</span><span class="op" id="5755936">{</span><span class="ident" id="5755937">From</span><span class="op" id="5755941">:</span>&nbsp;<span class="ident" id="5755943">colons</span><span class="op" id="5755949">[</span><span class="num" id="5755950">0</span><span class="op" id="5755951">]</span>&nbsp;<span class="op" id="5755953">+</span>&nbsp;<span class="num" id="5755955">1</span><span class="op" id="5755956">,</span>&nbsp;<span class="ident" id="5755958">To</span><span class="op" id="5755960">:</span>&nbsp;<span class="ident" id="5755962">colons</span><span class="op" id="5755968">[</span><span class="num" id="5755969">1</span><span class="op" id="5755970">]</span><span class="op" id="5755971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755976">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755981">if</span>&nbsp;<span class="ident" id="5755984">index</span><span class="op" id="5755989">[</span><span class="num" id="5755990">2</span><span class="op" id="5755991">]</span>&nbsp;<span class="op" id="5755993">==</span>&nbsp;<span class="ident" id="5755996">nil</span>&nbsp;<span class="op" id="5756000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756006">p</span><span class="op" id="5756007">.</span><span class="builtintype" id="5756008">error</span><span class="op" id="5756013">(</span><span class="ident" id="5756014">colons</span><span class="op" id="5756020">[</span><span class="num" id="5756021">1</span><span class="op" id="5756022">]</span><span class="op" id="5756023">,</span>&nbsp;<span class="string" id="5756025">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5756062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756068">index</span><span class="op" id="5756073">[</span><span class="num" id="5756074">2</span><span class="op" id="5756075">]</span>&nbsp;<span class="op" id="5756077">=</span>&nbsp;<span class="op" id="5756079">&amp;</span><span class="ident" id="5756080">ast</span><span class="op" id="5756083">.</span><span class="ident" id="5756084">BadExpr</span><span class="op" id="5756091">{</span><span class="ident" id="5756092">From</span><span class="op" id="5756096">:</span>&nbsp;<span class="ident" id="5756098">colons</span><span class="op" id="5756104">[</span><span class="num" id="5756105">1</span><span class="op" id="5756106">]</span>&nbsp;<span class="op" id="5756108">+</span>&nbsp;<span class="num" id="5756110">1</span><span class="op" id="5756111">,</span>&nbsp;<span class="ident" id="5756113">To</span><span class="op" id="5756115">:</span>&nbsp;<span class="ident" id="5756117">rbrack</span><span class="op" id="5756123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756132">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756136">return</span>&nbsp;<span class="op" id="5756143">&amp;</span><span class="ident" id="5756144">ast</span><span class="op" id="5756147">.</span><span class="ident" id="5756148">SliceExpr</span><span class="op" id="5756157">{</span><span class="ident" id="5756158">X</span><span class="op" id="5756159">:</span>&nbsp;<span class="ident" id="5756161">x</span><span class="op" id="5756162">,</span>&nbsp;<span class="ident" id="5756164">Lbrack</span><span class="op" id="5756170">:</span>&nbsp;<span class="ident" id="5756172">lbrack</span><span class="op" id="5756178">,</span>&nbsp;<span class="ident" id="5756180">Low</span><span class="op" id="5756183">:</span>&nbsp;<span class="ident" id="5756185">index</span><span class="op" id="5756190">[</span><span class="num" id="5756191">0</span><span class="op" id="5756192">]</span><span class="op" id="5756193">,</span>&nbsp;<span class="ident" id="5756195">High</span><span class="op" id="5756199">:</span>&nbsp;<span class="ident" id="5756201">index</span><span class="op" id="5756206">[</span><span class="num" id="5756207">1</span><span class="op" id="5756208">]</span><span class="op" id="5756209">,</span>&nbsp;<span class="ident" id="5756211">Max</span><span class="op" id="5756214">:</span>&nbsp;<span class="ident" id="5756216">index</span><span class="op" id="5756221">[</span><span class="num" id="5756222">2</span><span class="op" id="5756223">]</span><span class="op" id="5756224">,</span>&nbsp;<span class="ident" id="5756226">Slice3</span><span class="op" id="5756232">:</span>&nbsp;<span class="ident" id="5756234">slice3</span><span class="op" id="5756240">,</span>&nbsp;<span class="ident" id="5756242">Rbrack</span><span class="op" id="5756248">:</span>&nbsp;<span class="ident" id="5756250">rbrack</span><span class="op" id="5756256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756263">return</span>&nbsp;<span class="op" id="5756270">&amp;</span><span class="ident" id="5756271">ast</span><span class="op" id="5756274">.</span><span class="ident" id="5756275">IndexExpr</span><span class="op" id="5756284">{</span><span class="ident" id="5756285">X</span><span class="op" id="5756286">:</span>&nbsp;<span class="ident" id="5756288">x</span><span class="op" id="5756289">,</span>&nbsp;<span class="ident" id="5756291">Lbrack</span><span class="op" id="5756297">:</span>&nbsp;<span class="ident" id="5756299">lbrack</span><span class="op" id="5756305">,</span>&nbsp;<span class="ident" id="5756307">Index</span><span class="op" id="5756312">:</span>&nbsp;<span class="ident" id="5756314">index</span><span class="op" id="5756319">[</span><span class="num" id="5756320">0</span><span class="op" id="5756321">]</span><span class="op" id="5756322">,</span>&nbsp;<span class="ident" id="5756324">Rbrack</span><span class="op" id="5756330">:</span>&nbsp;<span class="ident" id="5756332">rbrack</span><span class="op" id="5756338">}</span><br>
<span class="lineno"></span><span class="op" id="5756340">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="5756343">func</span>&nbsp;<span class="op" id="5756348">(</span><span class="ident" id="5756349">p</span>&nbsp;<span class="op" id="5756351">*</span><span class="ident" id="5756352">parser</span><span class="op" id="5756358">)</span>&nbsp;<span class="ident" id="5756360">parseCallOrConversion</span><span class="op" id="5756381">(</span><span class="ident" id="5756382">fun</span>&nbsp;<span class="ident" id="5756386">ast</span><span class="op" id="5756389">.</span><span class="ident" id="5756390">Expr</span><span class="op" id="5756394">)</span>&nbsp;<span class="op" id="5756396">*</span><span class="ident" id="5756397">ast</span><span class="op" id="5756400">.</span><span class="ident" id="5756401">CallExpr</span>&nbsp;<span class="op" id="5756410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756413">if</span>&nbsp;<span class="ident" id="5756416">p</span><span class="op" id="5756417">.</span><span class="ident" id="5756418">trace</span>&nbsp;<span class="op" id="5756424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756428">defer</span>&nbsp;<span class="ident" id="5756434">un</span><span class="op" id="5756436">(</span><span class="ident" id="5756437">trace</span><span class="op" id="5756442">(</span><span class="ident" id="5756443">p</span><span class="op" id="5756444">,</span>&nbsp;<span class="string" id="5756446">&#34;CallOrConversion&#34;</span><span class="op" id="5756464">)</span><span class="op" id="5756465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756468">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756472">lparen</span>&nbsp;<span class="op" id="5756479">:=</span>&nbsp;<span class="ident" id="5756482">p</span><span class="op" id="5756483">.</span><span class="ident" id="5756484">expect</span><span class="op" id="5756490">(</span><span class="ident" id="5756491">token</span><span class="op" id="5756496">.</span><span class="ident" id="5756497">LPAREN</span><span class="op" id="5756503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756506">p</span><span class="op" id="5756507">.</span><span class="ident" id="5756508">exprLev</span><span class="op" id="5756515">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756519">var</span>&nbsp;<span class="ident" id="5756523">list</span>&nbsp;<span class="op" id="5756528">[</span><span class="op" id="5756529">]</span><span class="ident" id="5756530">ast</span><span class="op" id="5756533">.</span><span class="ident" id="5756534">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756540">var</span>&nbsp;<span class="ident" id="5756544">ellipsis</span>&nbsp;<span class="ident" id="5756553">token</span><span class="op" id="5756558">.</span><span class="ident" id="5756559">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756564">for</span>&nbsp;<span class="ident" id="5756568">p</span><span class="op" id="5756569">.</span><span class="ident" id="5756570">tok</span>&nbsp;<span class="op" id="5756574">!=</span>&nbsp;<span class="ident" id="5756577">token</span><span class="op" id="5756582">.</span><span class="ident" id="5756583">RPAREN</span>&nbsp;<span class="op" id="5756590">&amp;&amp;</span>&nbsp;<span class="ident" id="5756593">p</span><span class="op" id="5756594">.</span><span class="ident" id="5756595">tok</span>&nbsp;<span class="op" id="5756599">!=</span>&nbsp;<span class="ident" id="5756602">token</span><span class="op" id="5756607">.</span><span class="ident" id="5756608">EOF</span>&nbsp;<span class="op" id="5756612">&amp;&amp;</span>&nbsp;<span class="op" id="5756615">!</span><span class="ident" id="5756616">ellipsis</span><span class="op" id="5756624">.</span><span class="ident" id="5756625">IsValid</span><span class="op" id="5756632">(</span><span class="op" id="5756633">)</span>&nbsp;<span class="op" id="5756635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756639">list</span>&nbsp;<span class="op" id="5756644">=</span>&nbsp;<span class="builtinfunc" id="5756646">append</span><span class="op" id="5756652">(</span><span class="ident" id="5756653">list</span><span class="op" id="5756657">,</span>&nbsp;<span class="ident" id="5756659">p</span><span class="op" id="5756660">.</span><span class="ident" id="5756661">parseRhsOrType</span><span class="op" id="5756675">(</span><span class="op" id="5756676">)</span><span class="op" id="5756677">)</span>&nbsp;<span class="comment" id="5756679">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756733">if</span>&nbsp;<span class="ident" id="5756736">p</span><span class="op" id="5756737">.</span><span class="ident" id="5756738">tok</span>&nbsp;<span class="op" id="5756742">==</span>&nbsp;<span class="ident" id="5756745">token</span><span class="op" id="5756750">.</span><span class="ident" id="5756751">ELLIPSIS</span>&nbsp;<span class="op" id="5756760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756765">ellipsis</span>&nbsp;<span class="op" id="5756774">=</span>&nbsp;<span class="ident" id="5756776">p</span><span class="op" id="5756777">.</span><span class="ident" id="5756778">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756785">p</span><span class="op" id="5756786">.</span><span class="ident" id="5756787">next</span><span class="op" id="5756791">(</span><span class="op" id="5756792">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756800">if</span>&nbsp;<span class="op" id="5756803">!</span><span class="ident" id="5756804">p</span><span class="op" id="5756805">.</span><span class="ident" id="5756806">atComma</span><span class="op" id="5756813">(</span><span class="string" id="5756814">&#34;argument&nbsp;list&#34;</span><span class="op" id="5756829">)</span>&nbsp;<span class="op" id="5756831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756836">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756848">p</span><span class="op" id="5756849">.</span><span class="ident" id="5756850">next</span><span class="op" id="5756854">(</span><span class="op" id="5756855">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756861">p</span><span class="op" id="5756862">.</span><span class="ident" id="5756863">exprLev</span><span class="op" id="5756870">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756874">rparen</span>&nbsp;<span class="op" id="5756881">:=</span>&nbsp;<span class="ident" id="5756884">p</span><span class="op" id="5756885">.</span><span class="ident" id="5756886">expectClosing</span><span class="op" id="5756899">(</span><span class="ident" id="5756900">token</span><span class="op" id="5756905">.</span><span class="ident" id="5756906">RPAREN</span><span class="op" id="5756912">,</span>&nbsp;<span class="string" id="5756914">&#34;argument&nbsp;list&#34;</span><span class="op" id="5756929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756933">return</span>&nbsp;<span class="op" id="5756940">&amp;</span><span class="ident" id="5756941">ast</span><span class="op" id="5756944">.</span><span class="ident" id="5756945">CallExpr</span><span class="op" id="5756953">{</span><span class="ident" id="5756954">Fun</span><span class="op" id="5756957">:</span>&nbsp;<span class="ident" id="5756959">fun</span><span class="op" id="5756962">,</span>&nbsp;<span class="ident" id="5756964">Lparen</span><span class="op" id="5756970">:</span>&nbsp;<span class="ident" id="5756972">lparen</span><span class="op" id="5756978">,</span>&nbsp;<span class="ident" id="5756980">Args</span><span class="op" id="5756984">:</span>&nbsp;<span class="ident" id="5756986">list</span><span class="op" id="5756990">,</span>&nbsp;<span class="ident" id="5756992">Ellipsis</span><span class="op" id="5757000">:</span>&nbsp;<span class="ident" id="5757002">ellipsis</span><span class="op" id="5757010">,</span>&nbsp;<span class="ident" id="5757012">Rparen</span><span class="op" id="5757018">:</span>&nbsp;<span class="ident" id="5757020">rparen</span><span class="op" id="5757026">}</span><br>
<span class="lineno">1260</span><span class="op" id="5757028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5757031">func</span>&nbsp;<span class="op" id="5757036">(</span><span class="ident" id="5757037">p</span>&nbsp;<span class="op" id="5757039">*</span><span class="ident" id="5757040">parser</span><span class="op" id="5757046">)</span>&nbsp;<span class="ident" id="5757048">parseElement</span><span class="op" id="5757060">(</span><span class="ident" id="5757061">keyOk</span>&nbsp;<span class="builtintype" id="5757067">bool</span><span class="op" id="5757071">)</span>&nbsp;<span class="ident" id="5757073">ast</span><span class="op" id="5757076">.</span><span class="ident" id="5757077">Expr</span>&nbsp;<span class="op" id="5757082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757085">if</span>&nbsp;<span class="ident" id="5757088">p</span><span class="op" id="5757089">.</span><span class="ident" id="5757090">trace</span>&nbsp;<span class="op" id="5757096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757100">defer</span>&nbsp;<span class="ident" id="5757106">un</span><span class="op" id="5757108">(</span><span class="ident" id="5757109">trace</span><span class="op" id="5757114">(</span><span class="ident" id="5757115">p</span><span class="op" id="5757116">,</span>&nbsp;<span class="string" id="5757118">&#34;Element&#34;</span><span class="op" id="5757127">)</span><span class="op" id="5757128">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757135">if</span>&nbsp;<span class="ident" id="5757138">p</span><span class="op" id="5757139">.</span><span class="ident" id="5757140">tok</span>&nbsp;<span class="op" id="5757144">==</span>&nbsp;<span class="ident" id="5757147">token</span><span class="op" id="5757152">.</span><span class="ident" id="5757153">LBRACE</span>&nbsp;<span class="op" id="5757160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757164">return</span>&nbsp;<span class="ident" id="5757171">p</span><span class="op" id="5757172">.</span><span class="ident" id="5757173">parseLiteralValue</span><span class="op" id="5757190">(</span><span class="ident" id="5757191">nil</span><span class="op" id="5757194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757197">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757201">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757275">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757347">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757417">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757431">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757435">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757505">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757574">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757645">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757713">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757780">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757784">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757850">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757923">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757996">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758069">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758098">x</span>&nbsp;<span class="op" id="5758100">:=</span>&nbsp;<span class="ident" id="5758103">p</span><span class="op" id="5758104">.</span><span class="ident" id="5758105">checkExpr</span><span class="op" id="5758114">(</span><span class="ident" id="5758115">p</span><span class="op" id="5758116">.</span><span class="ident" id="5758117">parseExpr</span><span class="op" id="5758126">(</span><span class="ident" id="5758127">keyOk</span><span class="op" id="5758132">)</span><span class="op" id="5758133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758136">if</span>&nbsp;<span class="ident" id="5758139">keyOk</span>&nbsp;<span class="op" id="5758145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758149">if</span>&nbsp;<span class="ident" id="5758152">p</span><span class="op" id="5758153">.</span><span class="ident" id="5758154">tok</span>&nbsp;<span class="op" id="5758158">==</span>&nbsp;<span class="ident" id="5758161">token</span><span class="op" id="5758166">.</span><span class="ident" id="5758167">COLON</span>&nbsp;<span class="op" id="5758173">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758178">colon</span>&nbsp;<span class="op" id="5758184">:=</span>&nbsp;<span class="ident" id="5758187">p</span><span class="op" id="5758188">.</span><span class="ident" id="5758189">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758196">p</span><span class="op" id="5758197">.</span><span class="ident" id="5758198">next</span><span class="op" id="5758202">(</span><span class="op" id="5758203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758208">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758258">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758309">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758358">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758382">p</span><span class="op" id="5758383">.</span><span class="ident" id="5758384">tryResolve</span><span class="op" id="5758394">(</span><span class="ident" id="5758395">x</span><span class="op" id="5758396">,</span>&nbsp;<span class="builtintype" id="5758398">false</span><span class="op" id="5758403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758408">return</span>&nbsp;<span class="op" id="5758415">&amp;</span><span class="ident" id="5758416">ast</span><span class="op" id="5758419">.</span><span class="ident" id="5758420">KeyValueExpr</span><span class="op" id="5758432">{</span><span class="ident" id="5758433">Key</span><span class="op" id="5758436">:</span>&nbsp;<span class="ident" id="5758438">x</span><span class="op" id="5758439">,</span>&nbsp;<span class="ident" id="5758441">Colon</span><span class="op" id="5758446">:</span>&nbsp;<span class="ident" id="5758448">colon</span><span class="op" id="5758453">,</span>&nbsp;<span class="ident" id="5758455">Value</span><span class="op" id="5758460">:</span>&nbsp;<span class="ident" id="5758462">p</span><span class="op" id="5758463">.</span><span class="ident" id="5758464">parseElement</span><span class="op" id="5758476">(</span><span class="builtintype" id="5758477">false</span><span class="op" id="5758482">)</span><span class="op" id="5758483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758491">p</span><span class="op" id="5758492">.</span><span class="ident" id="5758493">resolve</span><span class="op" id="5758500">(</span><span class="ident" id="5758501">x</span><span class="op" id="5758502">)</span>&nbsp;<span class="comment" id="5758504">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758522">return</span>&nbsp;<span class="ident" id="5758529">x</span><br>
<span class="lineno"></span><span class="op" id="5758531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="5758534">func</span>&nbsp;<span class="op" id="5758539">(</span><span class="ident" id="5758540">p</span>&nbsp;<span class="op" id="5758542">*</span><span class="ident" id="5758543">parser</span><span class="op" id="5758549">)</span>&nbsp;<span class="ident" id="5758551">parseElementList</span><span class="op" id="5758567">(</span><span class="op" id="5758568">)</span>&nbsp;<span class="op" id="5758570">(</span><span class="ident" id="5758571">list</span>&nbsp;<span class="op" id="5758576">[</span><span class="op" id="5758577">]</span><span class="ident" id="5758578">ast</span><span class="op" id="5758581">.</span><span class="ident" id="5758582">Expr</span><span class="op" id="5758586">)</span>&nbsp;<span class="op" id="5758588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758591">if</span>&nbsp;<span class="ident" id="5758594">p</span><span class="op" id="5758595">.</span><span class="ident" id="5758596">trace</span>&nbsp;<span class="op" id="5758602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758606">defer</span>&nbsp;<span class="ident" id="5758612">un</span><span class="op" id="5758614">(</span><span class="ident" id="5758615">trace</span><span class="op" id="5758620">(</span><span class="ident" id="5758621">p</span><span class="op" id="5758622">,</span>&nbsp;<span class="string" id="5758624">&#34;ElementList&#34;</span><span class="op" id="5758637">)</span><span class="op" id="5758638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758645">for</span>&nbsp;<span class="ident" id="5758649">p</span><span class="op" id="5758650">.</span><span class="ident" id="5758651">tok</span>&nbsp;<span class="op" id="5758655">!=</span>&nbsp;<span class="ident" id="5758658">token</span><span class="op" id="5758663">.</span><span class="ident" id="5758664">RBRACE</span>&nbsp;<span class="op" id="5758671">&amp;&amp;</span>&nbsp;<span class="ident" id="5758674">p</span><span class="op" id="5758675">.</span><span class="ident" id="5758676">tok</span>&nbsp;<span class="op" id="5758680">!=</span>&nbsp;<span class="ident" id="5758683">token</span><span class="op" id="5758688">.</span><span class="ident" id="5758689">EOF</span>&nbsp;<span class="op" id="5758693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758697">list</span>&nbsp;<span class="op" id="5758702">=</span>&nbsp;<span class="builtinfunc" id="5758704">append</span><span class="op" id="5758710">(</span><span class="ident" id="5758711">list</span><span class="op" id="5758715">,</span>&nbsp;<span class="ident" id="5758717">p</span><span class="op" id="5758718">.</span><span class="ident" id="5758719">parseElement</span><span class="op" id="5758731">(</span><span class="builtintype" id="5758732">true</span><span class="op" id="5758736">)</span><span class="op" id="5758737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758741">if</span>&nbsp;<span class="op" id="5758744">!</span><span class="ident" id="5758745">p</span><span class="op" id="5758746">.</span><span class="ident" id="5758747">atComma</span><span class="op" id="5758754">(</span><span class="string" id="5758755">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5758774">)</span>&nbsp;<span class="op" id="5758776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758781">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758789">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758793">p</span><span class="op" id="5758794">.</span><span class="ident" id="5758795">next</span><span class="op" id="5758799">(</span><span class="op" id="5758800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758807">return</span><br>
<span class="lineno"></span><span class="op" id="5758814">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="5758817">func</span>&nbsp;<span class="op" id="5758822">(</span><span class="ident" id="5758823">p</span>&nbsp;<span class="op" id="5758825">*</span><span class="ident" id="5758826">parser</span><span class="op" id="5758832">)</span>&nbsp;<span class="ident" id="5758834">parseLiteralValue</span><span class="op" id="5758851">(</span><span class="ident" id="5758852">typ</span>&nbsp;<span class="ident" id="5758856">ast</span><span class="op" id="5758859">.</span><span class="ident" id="5758860">Expr</span><span class="op" id="5758864">)</span>&nbsp;<span class="ident" id="5758866">ast</span><span class="op" id="5758869">.</span><span class="ident" id="5758870">Expr</span>&nbsp;<span class="op" id="5758875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758878">if</span>&nbsp;<span class="ident" id="5758881">p</span><span class="op" id="5758882">.</span><span class="ident" id="5758883">trace</span>&nbsp;<span class="op" id="5758889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758893">defer</span>&nbsp;<span class="ident" id="5758899">un</span><span class="op" id="5758901">(</span><span class="ident" id="5758902">trace</span><span class="op" id="5758907">(</span><span class="ident" id="5758908">p</span><span class="op" id="5758909">,</span>&nbsp;<span class="string" id="5758911">&#34;LiteralValue&#34;</span><span class="op" id="5758925">)</span><span class="op" id="5758926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758929">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758933">lbrace</span>&nbsp;<span class="op" id="5758940">:=</span>&nbsp;<span class="ident" id="5758943">p</span><span class="op" id="5758944">.</span><span class="ident" id="5758945">expect</span><span class="op" id="5758951">(</span><span class="ident" id="5758952">token</span><span class="op" id="5758957">.</span><span class="ident" id="5758958">LBRACE</span><span class="op" id="5758964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758967">var</span>&nbsp;<span class="ident" id="5758971">elts</span>&nbsp;<span class="op" id="5758976">[</span><span class="op" id="5758977">]</span><span class="ident" id="5758978">ast</span><span class="op" id="5758981">.</span><span class="ident" id="5758982">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758988">p</span><span class="op" id="5758989">.</span><span class="ident" id="5758990">exprLev</span><span class="op" id="5758997">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759001">if</span>&nbsp;<span class="ident" id="5759004">p</span><span class="op" id="5759005">.</span><span class="ident" id="5759006">tok</span>&nbsp;<span class="op" id="5759010">!=</span>&nbsp;<span class="ident" id="5759013">token</span><span class="op" id="5759018">.</span><span class="ident" id="5759019">RBRACE</span>&nbsp;<span class="op" id="5759026">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759030">elts</span>&nbsp;<span class="op" id="5759035">=</span>&nbsp;<span class="ident" id="5759037">p</span><span class="op" id="5759038">.</span><span class="ident" id="5759039">parseElementList</span><span class="op" id="5759055">(</span><span class="op" id="5759056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759062">p</span><span class="op" id="5759063">.</span><span class="ident" id="5759064">exprLev</span><span class="op" id="5759071">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759075">rbrace</span>&nbsp;<span class="op" id="5759082">:=</span>&nbsp;<span class="ident" id="5759085">p</span><span class="op" id="5759086">.</span><span class="ident" id="5759087">expectClosing</span><span class="op" id="5759100">(</span><span class="ident" id="5759101">token</span><span class="op" id="5759106">.</span><span class="ident" id="5759107">RBRACE</span><span class="op" id="5759113">,</span>&nbsp;<span class="string" id="5759115">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5759134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759137">return</span>&nbsp;<span class="op" id="5759144">&amp;</span><span class="ident" id="5759145">ast</span><span class="op" id="5759148">.</span><span class="ident" id="5759149">CompositeLit</span><span class="op" id="5759161">{</span><span class="ident" id="5759162">Type</span><span class="op" id="5759166">:</span>&nbsp;<span class="ident" id="5759168">typ</span><span class="op" id="5759171">,</span>&nbsp;<span class="ident" id="5759173">Lbrace</span><span class="op" id="5759179">:</span>&nbsp;<span class="ident" id="5759181">lbrace</span><span class="op" id="5759187">,</span>&nbsp;<span class="ident" id="5759189">Elts</span><span class="op" id="5759193">:</span>&nbsp;<span class="ident" id="5759195">elts</span><span class="op" id="5759199">,</span>&nbsp;<span class="ident" id="5759201">Rbrace</span><span class="op" id="5759207">:</span>&nbsp;<span class="ident" id="5759209">rbrace</span><span class="op" id="5759215">}</span><br>
<span class="lineno">1335</span><span class="op" id="5759217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759220">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="5759282">func</span>&nbsp;<span class="op" id="5759287">(</span><span class="ident" id="5759288">p</span>&nbsp;<span class="op" id="5759290">*</span><span class="ident" id="5759291">parser</span><span class="op" id="5759297">)</span>&nbsp;<span class="ident" id="5759299">checkExpr</span><span class="op" id="5759308">(</span><span class="ident" id="5759309">x</span>&nbsp;<span class="ident" id="5759311">ast</span><span class="op" id="5759314">.</span><span class="ident" id="5759315">Expr</span><span class="op" id="5759319">)</span>&nbsp;<span class="ident" id="5759321">ast</span><span class="op" id="5759324">.</span><span class="ident" id="5759325">Expr</span>&nbsp;<span class="op" id="5759330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759333">switch</span>&nbsp;<span class="ident" id="5759340">unparen</span><span class="op" id="5759347">(</span><span class="ident" id="5759348">x</span><span class="op" id="5759349">)</span><span class="op" id="5759350">.</span><span class="op" id="5759351">(</span><span class="keyword" id="5759352">type</span><span class="op" id="5759356">)</span>&nbsp;<span class="op" id="5759358">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759361">case</span>&nbsp;<span class="op" id="5759366">*</span><span class="ident" id="5759367">ast</span><span class="op" id="5759370">.</span><span class="ident" id="5759371">BadExpr</span><span class="op" id="5759378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759381">case</span>&nbsp;<span class="op" id="5759386">*</span><span class="ident" id="5759387">ast</span><span class="op" id="5759390">.</span><span class="ident" id="5759391">Ident</span><span class="op" id="5759396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759399">case</span>&nbsp;<span class="op" id="5759404">*</span><span class="ident" id="5759405">ast</span><span class="op" id="5759408">.</span><span class="ident" id="5759409">BasicLit</span><span class="op" id="5759417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759420">case</span>&nbsp;<span class="op" id="5759425">*</span><span class="ident" id="5759426">ast</span><span class="op" id="5759429">.</span><span class="ident" id="5759430">FuncLit</span><span class="op" id="5759437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759440">case</span>&nbsp;<span class="op" id="5759445">*</span><span class="ident" id="5759446">ast</span><span class="op" id="5759449">.</span><span class="ident" id="5759450">CompositeLit</span><span class="op" id="5759462">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759465">case</span>&nbsp;<span class="op" id="5759470">*</span><span class="ident" id="5759471">ast</span><span class="op" id="5759474">.</span><span class="ident" id="5759475">ParenExpr</span><span class="op" id="5759484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5759488">panic</span><span class="op" id="5759493">(</span><span class="string" id="5759494">&#34;unreachable&#34;</span><span class="op" id="5759507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759510">case</span>&nbsp;<span class="op" id="5759515">*</span><span class="ident" id="5759516">ast</span><span class="op" id="5759519">.</span><span class="ident" id="5759520">SelectorExpr</span><span class="op" id="5759532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759535">case</span>&nbsp;<span class="op" id="5759540">*</span><span class="ident" id="5759541">ast</span><span class="op" id="5759544">.</span><span class="ident" id="5759545">IndexExpr</span><span class="op" id="5759554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759557">case</span>&nbsp;<span class="op" id="5759562">*</span><span class="ident" id="5759563">ast</span><span class="op" id="5759566">.</span><span class="ident" id="5759567">SliceExpr</span><span class="op" id="5759576">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759579">case</span>&nbsp;<span class="op" id="5759584">*</span><span class="ident" id="5759585">ast</span><span class="op" id="5759588">.</span><span class="ident" id="5759589">TypeAssertExpr</span><span class="op" id="5759603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759607">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759666">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759731">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759796">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759861">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759874">case</span>&nbsp;<span class="op" id="5759879">*</span><span class="ident" id="5759880">ast</span><span class="op" id="5759883">.</span><span class="ident" id="5759884">CallExpr</span><span class="op" id="5759892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759895">case</span>&nbsp;<span class="op" id="5759900">*</span><span class="ident" id="5759901">ast</span><span class="op" id="5759904">.</span><span class="ident" id="5759905">StarExpr</span><span class="op" id="5759913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759916">case</span>&nbsp;<span class="op" id="5759921">*</span><span class="ident" id="5759922">ast</span><span class="op" id="5759925">.</span><span class="ident" id="5759926">UnaryExpr</span><span class="op" id="5759935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759938">case</span>&nbsp;<span class="op" id="5759943">*</span><span class="ident" id="5759944">ast</span><span class="op" id="5759947">.</span><span class="ident" id="5759948">BinaryExpr</span><span class="op" id="5759958">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759961">default</span><span class="op" id="5759968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759972">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760020">p</span><span class="op" id="5760021">.</span><span class="ident" id="5760022">errorExpected</span><span class="op" id="5760035">(</span><span class="ident" id="5760036">x</span><span class="op" id="5760037">.</span><span class="ident" id="5760038">Pos</span><span class="op" id="5760041">(</span><span class="op" id="5760042">)</span><span class="op" id="5760043">,</span>&nbsp;<span class="string" id="5760045">&#34;expression&#34;</span><span class="op" id="5760057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760061">x</span>&nbsp;<span class="op" id="5760063">=</span>&nbsp;<span class="op" id="5760065">&amp;</span><span class="ident" id="5760066">ast</span><span class="op" id="5760069">.</span><span class="ident" id="5760070">BadExpr</span><span class="op" id="5760077">{</span><span class="ident" id="5760078">From</span><span class="op" id="5760082">:</span>&nbsp;<span class="ident" id="5760084">x</span><span class="op" id="5760085">.</span><span class="ident" id="5760086">Pos</span><span class="op" id="5760089">(</span><span class="op" id="5760090">)</span><span class="op" id="5760091">,</span>&nbsp;<span class="ident" id="5760093">To</span><span class="op" id="5760095">:</span>&nbsp;<span class="ident" id="5760097">p</span><span class="op" id="5760098">.</span><span class="ident" id="5760099">safePos</span><span class="op" id="5760106">(</span><span class="ident" id="5760107">x</span><span class="op" id="5760108">.</span><span class="ident" id="5760109">End</span><span class="op" id="5760112">(</span><span class="op" id="5760113">)</span><span class="op" id="5760114">)</span><span class="op" id="5760115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760118">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760121">return</span>&nbsp;<span class="ident" id="5760128">x</span><br>
<span class="lineno"></span><span class="op" id="5760130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760133">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="5760193">func</span>&nbsp;<span class="ident" id="5760198">isTypeName</span><span class="op" id="5760208">(</span><span class="ident" id="5760209">x</span>&nbsp;<span class="ident" id="5760211">ast</span><span class="op" id="5760214">.</span><span class="ident" id="5760215">Expr</span><span class="op" id="5760219">)</span>&nbsp;<span class="builtintype" id="5760221">bool</span>&nbsp;<span class="op" id="5760226">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760229">switch</span>&nbsp;<span class="ident" id="5760236">t</span>&nbsp;<span class="op" id="5760238">:=</span>&nbsp;<span class="ident" id="5760241">x</span><span class="op" id="5760242">.</span><span class="op" id="5760243">(</span><span class="keyword" id="5760244">type</span><span class="op" id="5760248">)</span>&nbsp;<span class="op" id="5760250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760253">case</span>&nbsp;<span class="op" id="5760258">*</span><span class="ident" id="5760259">ast</span><span class="op" id="5760262">.</span><span class="ident" id="5760263">BadExpr</span><span class="op" id="5760270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760273">case</span>&nbsp;<span class="op" id="5760278">*</span><span class="ident" id="5760279">ast</span><span class="op" id="5760282">.</span><span class="ident" id="5760283">Ident</span><span class="op" id="5760288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760291">case</span>&nbsp;<span class="op" id="5760296">*</span><span class="ident" id="5760297">ast</span><span class="op" id="5760300">.</span><span class="ident" id="5760301">SelectorExpr</span><span class="op" id="5760313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760317">_</span><span class="op" id="5760318">,</span>&nbsp;<span class="ident" id="5760320">isIdent</span>&nbsp;<span class="op" id="5760328">:=</span>&nbsp;<span class="ident" id="5760331">t</span><span class="op" id="5760332">.</span><span class="ident" id="5760333">X</span><span class="op" id="5760334">.</span><span class="op" id="5760335">(</span><span class="op" id="5760336">*</span><span class="ident" id="5760337">ast</span><span class="op" id="5760340">.</span><span class="ident" id="5760341">Ident</span><span class="op" id="5760346">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760350">return</span>&nbsp;<span class="ident" id="5760357">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760366">default</span><span class="op" id="5760373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760377">return</span>&nbsp;<span class="builtintype" id="5760384">false</span>&nbsp;<span class="comment" id="5760390">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760432">return</span>&nbsp;<span class="builtintype" id="5760439">true</span><br>
<span class="lineno">1380</span><span class="op" id="5760444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760447">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5760518">func</span>&nbsp;<span class="ident" id="5760523">isLiteralType</span><span class="op" id="5760536">(</span><span class="ident" id="5760537">x</span>&nbsp;<span class="ident" id="5760539">ast</span><span class="op" id="5760542">.</span><span class="ident" id="5760543">Expr</span><span class="op" id="5760547">)</span>&nbsp;<span class="builtintype" id="5760549">bool</span>&nbsp;<span class="op" id="5760554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760557">switch</span>&nbsp;<span class="ident" id="5760564">t</span>&nbsp;<span class="op" id="5760566">:=</span>&nbsp;<span class="ident" id="5760569">x</span><span class="op" id="5760570">.</span><span class="op" id="5760571">(</span><span class="keyword" id="5760572">type</span><span class="op" id="5760576">)</span>&nbsp;<span class="op" id="5760578">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760581">case</span>&nbsp;<span class="op" id="5760586">*</span><span class="ident" id="5760587">ast</span><span class="op" id="5760590">.</span><span class="ident" id="5760591">BadExpr</span><span class="op" id="5760598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760601">case</span>&nbsp;<span class="op" id="5760606">*</span><span class="ident" id="5760607">ast</span><span class="op" id="5760610">.</span><span class="ident" id="5760611">Ident</span><span class="op" id="5760616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760619">case</span>&nbsp;<span class="op" id="5760624">*</span><span class="ident" id="5760625">ast</span><span class="op" id="5760628">.</span><span class="ident" id="5760629">SelectorExpr</span><span class="op" id="5760641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760645">_</span><span class="op" id="5760646">,</span>&nbsp;<span class="ident" id="5760648">isIdent</span>&nbsp;<span class="op" id="5760656">:=</span>&nbsp;<span class="ident" id="5760659">t</span><span class="op" id="5760660">.</span><span class="ident" id="5760661">X</span><span class="op" id="5760662">.</span><span class="op" id="5760663">(</span><span class="op" id="5760664">*</span><span class="ident" id="5760665">ast</span><span class="op" id="5760668">.</span><span class="ident" id="5760669">Ident</span><span class="op" id="5760674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760678">return</span>&nbsp;<span class="ident" id="5760685">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760694">case</span>&nbsp;<span class="op" id="5760699">*</span><span class="ident" id="5760700">ast</span><span class="op" id="5760703">.</span><span class="ident" id="5760704">ArrayType</span><span class="op" id="5760713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760716">case</span>&nbsp;<span class="op" id="5760721">*</span><span class="ident" id="5760722">ast</span><span class="op" id="5760725">.</span><span class="ident" id="5760726">StructType</span><span class="op" id="5760736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760739">case</span>&nbsp;<span class="op" id="5760744">*</span><span class="ident" id="5760745">ast</span><span class="op" id="5760748">.</span><span class="ident" id="5760749">MapType</span><span class="op" id="5760756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760759">default</span><span class="op" id="5760766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760770">return</span>&nbsp;<span class="builtintype" id="5760777">false</span>&nbsp;<span class="comment" id="5760783">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760844">return</span>&nbsp;<span class="builtintype" id="5760851">true</span><br>
<span class="lineno"></span><span class="op" id="5760856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760859">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="5760927">func</span>&nbsp;<span class="ident" id="5760932">deref</span><span class="op" id="5760937">(</span><span class="ident" id="5760938">x</span>&nbsp;<span class="ident" id="5760940">ast</span><span class="op" id="5760943">.</span><span class="ident" id="5760944">Expr</span><span class="op" id="5760948">)</span>&nbsp;<span class="ident" id="5760950">ast</span><span class="op" id="5760953">.</span><span class="ident" id="5760954">Expr</span>&nbsp;<span class="op" id="5760959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760962">if</span>&nbsp;<span class="ident" id="5760965">p</span><span class="op" id="5760966">,</span>&nbsp;<span class="ident" id="5760968">isPtr</span>&nbsp;<span class="op" id="5760974">:=</span>&nbsp;<span class="ident" id="5760977">x</span><span class="op" id="5760978">.</span><span class="op" id="5760979">(</span><span class="op" id="5760980">*</span><span class="ident" id="5760981">ast</span><span class="op" id="5760984">.</span><span class="ident" id="5760985">StarExpr</span><span class="op" id="5760993">)</span><span class="op" id="5760994">;</span>&nbsp;<span class="ident" id="5760996">isPtr</span>&nbsp;<span class="op" id="5761002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761006">x</span>&nbsp;<span class="op" id="5761008">=</span>&nbsp;<span class="ident" id="5761010">p</span><span class="op" id="5761011">.</span><span class="ident" id="5761012">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761018">return</span>&nbsp;<span class="ident" id="5761025">x</span><br>
<span class="lineno">1405</span><span class="op" id="5761027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5761030">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5761110">func</span>&nbsp;<span class="ident" id="5761115">unparen</span><span class="op" id="5761122">(</span><span class="ident" id="5761123">x</span>&nbsp;<span class="ident" id="5761125">ast</span><span class="op" id="5761128">.</span><span class="ident" id="5761129">Expr</span><span class="op" id="5761133">)</span>&nbsp;<span class="ident" id="5761135">ast</span><span class="op" id="5761138">.</span><span class="ident" id="5761139">Expr</span>&nbsp;<span class="op" id="5761144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761147">if</span>&nbsp;<span class="ident" id="5761150">p</span><span class="op" id="5761151">,</span>&nbsp;<span class="ident" id="5761153">isParen</span>&nbsp;<span class="op" id="5761161">:=</span>&nbsp;<span class="ident" id="5761164">x</span><span class="op" id="5761165">.</span><span class="op" id="5761166">(</span><span class="op" id="5761167">*</span><span class="ident" id="5761168">ast</span><span class="op" id="5761171">.</span><span class="ident" id="5761172">ParenExpr</span><span class="op" id="5761181">)</span><span class="op" id="5761182">;</span>&nbsp;<span class="ident" id="5761184">isParen</span>&nbsp;<span class="op" id="5761192">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761196">x</span>&nbsp;<span class="op" id="5761198">=</span>&nbsp;<span class="ident" id="5761200">unparen</span><span class="op" id="5761207">(</span><span class="ident" id="5761208">p</span><span class="op" id="5761209">.</span><span class="ident" id="5761210">X</span><span class="op" id="5761211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761217">return</span>&nbsp;<span class="ident" id="5761224">x</span><br>
<span class="lineno"></span><span class="op" id="5761226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="5761229">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5761289">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="5761329">//</span><br>
<span class="lineno"></span><span class="keyword" id="5761332">func</span>&nbsp;<span class="op" id="5761337">(</span><span class="ident" id="5761338">p</span>&nbsp;<span class="op" id="5761340">*</span><span class="ident" id="5761341">parser</span><span class="op" id="5761347">)</span>&nbsp;<span class="ident" id="5761349">checkExprOrType</span><span class="op" id="5761364">(</span><span class="ident" id="5761365">x</span>&nbsp;<span class="ident" id="5761367">ast</span><span class="op" id="5761370">.</span><span class="ident" id="5761371">Expr</span><span class="op" id="5761375">)</span>&nbsp;<span class="ident" id="5761377">ast</span><span class="op" id="5761380">.</span><span class="ident" id="5761381">Expr</span>&nbsp;<span class="op" id="5761386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761389">switch</span>&nbsp;<span class="ident" id="5761396">t</span>&nbsp;<span class="op" id="5761398">:=</span>&nbsp;<span class="ident" id="5761401">unparen</span><span class="op" id="5761408">(</span><span class="ident" id="5761409">x</span><span class="op" id="5761410">)</span><span class="op" id="5761411">.</span><span class="op" id="5761412">(</span><span class="keyword" id="5761413">type</span><span class="op" id="5761417">)</span>&nbsp;<span class="op" id="5761419">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761422">case</span>&nbsp;<span class="op" id="5761427">*</span><span class="ident" id="5761428">ast</span><span class="op" id="5761431">.</span><span class="ident" id="5761432">ParenExpr</span><span class="op" id="5761441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5761445">panic</span><span class="op" id="5761450">(</span><span class="string" id="5761451">&#34;unreachable&#34;</span><span class="op" id="5761464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761467">case</span>&nbsp;<span class="op" id="5761472">*</span><span class="ident" id="5761473">ast</span><span class="op" id="5761476">.</span><span class="ident" id="5761477">UnaryExpr</span><span class="op" id="5761486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761489">case</span>&nbsp;<span class="op" id="5761494">*</span><span class="ident" id="5761495">ast</span><span class="op" id="5761498">.</span><span class="ident" id="5761499">ArrayType</span><span class="op" id="5761508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761512">if</span>&nbsp;<span class="builtinfunc" id="5761515">len</span><span class="op" id="5761518">,</span>&nbsp;<span class="ident" id="5761520">isEllipsis</span>&nbsp;<span class="op" id="5761531">:=</span>&nbsp;<span class="ident" id="5761534">t</span><span class="op" id="5761535">.</span><span class="ident" id="5761536">Len</span><span class="op" id="5761539">.</span><span class="op" id="5761540">(</span><span class="op" id="5761541">*</span><span class="ident" id="5761542">ast</span><span class="op" id="5761545">.</span><span class="ident" id="5761546">Ellipsis</span><span class="op" id="5761554">)</span><span class="op" id="5761555">;</span>&nbsp;<span class="ident" id="5761557">isEllipsis</span>&nbsp;<span class="op" id="5761568">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761573">p</span><span class="op" id="5761574">.</span><span class="builtintype" id="5761575">error</span><span class="op" id="5761580">(</span><span class="builtinfunc" id="5761581">len</span><span class="op" id="5761584">.</span><span class="ident" id="5761585">Pos</span><span class="op" id="5761588">(</span><span class="op" id="5761589">)</span><span class="op" id="5761590">,</span>&nbsp;<span class="string" id="5761592">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="5761628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761633">x</span>&nbsp;<span class="op" id="5761635">=</span>&nbsp;<span class="op" id="5761637">&amp;</span><span class="ident" id="5761638">ast</span><span class="op" id="5761641">.</span><span class="ident" id="5761642">BadExpr</span><span class="op" id="5761649">{</span><span class="ident" id="5761650">From</span><span class="op" id="5761654">:</span>&nbsp;<span class="ident" id="5761656">x</span><span class="op" id="5761657">.</span><span class="ident" id="5761658">Pos</span><span class="op" id="5761661">(</span><span class="op" id="5761662">)</span><span class="op" id="5761663">,</span>&nbsp;<span class="ident" id="5761665">To</span><span class="op" id="5761667">:</span>&nbsp;<span class="ident" id="5761669">p</span><span class="op" id="5761670">.</span><span class="ident" id="5761671">safePos</span><span class="op" id="5761678">(</span><span class="ident" id="5761679">x</span><span class="op" id="5761680">.</span><span class="ident" id="5761681">End</span><span class="op" id="5761684">(</span><span class="op" id="5761685">)</span><span class="op" id="5761686">)</span><span class="op" id="5761687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761698">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761743">return</span>&nbsp;<span class="ident" id="5761750">x</span><br>
<span class="lineno"></span><span class="op" id="5761752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5761755">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="5761825">func</span>&nbsp;<span class="op" id="5761830">(</span><span class="ident" id="5761831">p</span>&nbsp;<span class="op" id="5761833">*</span><span class="ident" id="5761834">parser</span><span class="op" id="5761840">)</span>&nbsp;<span class="ident" id="5761842">parsePrimaryExpr</span><span class="op" id="5761858">(</span><span class="ident" id="5761859">lhs</span>&nbsp;<span class="builtintype" id="5761863">bool</span><span class="op" id="5761867">)</span>&nbsp;<span class="ident" id="5761869">ast</span><span class="op" id="5761872">.</span><span class="ident" id="5761873">Expr</span>&nbsp;<span class="op" id="5761878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761881">if</span>&nbsp;<span class="ident" id="5761884">p</span><span class="op" id="5761885">.</span><span class="ident" id="5761886">trace</span>&nbsp;<span class="op" id="5761892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761896">defer</span>&nbsp;<span class="ident" id="5761902">un</span><span class="op" id="5761904">(</span><span class="ident" id="5761905">trace</span><span class="op" id="5761910">(</span><span class="ident" id="5761911">p</span><span class="op" id="5761912">,</span>&nbsp;<span class="string" id="5761914">&#34;PrimaryExpr&#34;</span><span class="op" id="5761927">)</span><span class="op" id="5761928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761935">x</span>&nbsp;<span class="op" id="5761937">:=</span>&nbsp;<span class="ident" id="5761940">p</span><span class="op" id="5761941">.</span><span class="ident" id="5761942">parseOperand</span><span class="op" id="5761954">(</span><span class="ident" id="5761955">lhs</span><span class="op" id="5761958">)</span><br>
<span class="lineno"></span><span class="ident" id="5761960">L</span><span class="op" id="5761961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761964">for</span>&nbsp;<span class="op" id="5761968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761972">switch</span>&nbsp;<span class="ident" id="5761979">p</span><span class="op" id="5761980">.</span><span class="ident" id="5761981">tok</span>&nbsp;<span class="op" id="5761985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761989">case</span>&nbsp;<span class="ident" id="5761994">token</span><span class="op" id="5761999">.</span><span class="ident" id="5762000">PERIOD</span><span class="op" id="5762006">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762011">p</span><span class="op" id="5762012">.</span><span class="ident" id="5762013">next</span><span class="op" id="5762017">(</span><span class="op" id="5762018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762023">if</span>&nbsp;<span class="ident" id="5762026">lhs</span>&nbsp;<span class="op" id="5762030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762036">p</span><span class="op" id="5762037">.</span><span class="ident" id="5762038">resolve</span><span class="op" id="5762045">(</span><span class="ident" id="5762046">x</span><span class="op" id="5762047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762057">switch</span>&nbsp;<span class="ident" id="5762064">p</span><span class="op" id="5762065">.</span><span class="ident" id="5762066">tok</span>&nbsp;<span class="op" id="5762070">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762075">case</span>&nbsp;<span class="ident" id="5762080">token</span><span class="op" id="5762085">.</span><span class="ident" id="5762086">IDENT</span><span class="op" id="5762091">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762097">x</span>&nbsp;<span class="op" id="5762099">=</span>&nbsp;<span class="ident" id="5762101">p</span><span class="op" id="5762102">.</span><span class="ident" id="5762103">parseSelector</span><span class="op" id="5762116">(</span><span class="ident" id="5762117">p</span><span class="op" id="5762118">.</span><span class="ident" id="5762119">checkExprOrType</span><span class="op" id="5762134">(</span><span class="ident" id="5762135">x</span><span class="op" id="5762136">)</span><span class="op" id="5762137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762142">case</span>&nbsp;<span class="ident" id="5762147">token</span><span class="op" id="5762152">.</span><span class="ident" id="5762153">LPAREN</span><span class="op" id="5762159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762165">x</span>&nbsp;<span class="op" id="5762167">=</span>&nbsp;<span class="ident" id="5762169">p</span><span class="op" id="5762170">.</span><span class="ident" id="5762171">parseTypeAssertion</span><span class="op" id="5762189">(</span><span class="ident" id="5762190">p</span><span class="op" id="5762191">.</span><span class="ident" id="5762192">checkExpr</span><span class="op" id="5762201">(</span><span class="ident" id="5762202">x</span><span class="op" id="5762203">)</span><span class="op" id="5762204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762209">default</span><span class="op" id="5762216">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762222">pos</span>&nbsp;<span class="op" id="5762226">:=</span>&nbsp;<span class="ident" id="5762229">p</span><span class="op" id="5762230">.</span><span class="ident" id="5762231">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762239">p</span><span class="op" id="5762240">.</span><span class="ident" id="5762241">errorExpected</span><span class="op" id="5762254">(</span><span class="ident" id="5762255">pos</span><span class="op" id="5762258">,</span>&nbsp;<span class="string" id="5762260">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="5762288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762294">p</span><span class="op" id="5762295">.</span><span class="ident" id="5762296">next</span><span class="op" id="5762300">(</span><span class="op" id="5762301">)</span>&nbsp;<span class="comment" id="5762303">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762324">x</span>&nbsp;<span class="op" id="5762326">=</span>&nbsp;<span class="op" id="5762328">&amp;</span><span class="ident" id="5762329">ast</span><span class="op" id="5762332">.</span><span class="ident" id="5762333">BadExpr</span><span class="op" id="5762340">{</span><span class="ident" id="5762341">From</span><span class="op" id="5762345">:</span>&nbsp;<span class="ident" id="5762347">pos</span><span class="op" id="5762350">,</span>&nbsp;<span class="ident" id="5762352">To</span><span class="op" id="5762354">:</span>&nbsp;<span class="ident" id="5762356">p</span><span class="op" id="5762357">.</span><span class="ident" id="5762358">pos</span><span class="op" id="5762361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762366">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762370">case</span>&nbsp;<span class="ident" id="5762375">token</span><span class="op" id="5762380">.</span><span class="ident" id="5762381">LBRACK</span><span class="op" id="5762387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762392">if</span>&nbsp;<span class="ident" id="5762395">lhs</span>&nbsp;<span class="op" id="5762399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762405">p</span><span class="op" id="5762406">.</span><span class="ident" id="5762407">resolve</span><span class="op" id="5762414">(</span><span class="ident" id="5762415">x</span><span class="op" id="5762416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762426">x</span>&nbsp;<span class="op" id="5762428">=</span>&nbsp;<span class="ident" id="5762430">p</span><span class="op" id="5762431">.</span><span class="ident" id="5762432">parseIndexOrSlice</span><span class="op" id="5762449">(</span><span class="ident" id="5762450">p</span><span class="op" id="5762451">.</span><span class="ident" id="5762452">checkExpr</span><span class="op" id="5762461">(</span><span class="ident" id="5762462">x</span><span class="op" id="5762463">)</span><span class="op" id="5762464">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762468">case</span>&nbsp;<span class="ident" id="5762473">token</span><span class="op" id="5762478">.</span><span class="ident" id="5762479">LPAREN</span><span class="op" id="5762485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762490">if</span>&nbsp;<span class="ident" id="5762493">lhs</span>&nbsp;<span class="op" id="5762497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762503">p</span><span class="op" id="5762504">.</span><span class="ident" id="5762505">resolve</span><span class="op" id="5762512">(</span><span class="ident" id="5762513">x</span><span class="op" id="5762514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762524">x</span>&nbsp;<span class="op" id="5762526">=</span>&nbsp;<span class="ident" id="5762528">p</span><span class="op" id="5762529">.</span><span class="ident" id="5762530">parseCallOrConversion</span><span class="op" id="5762551">(</span><span class="ident" id="5762552">p</span><span class="op" id="5762553">.</span><span class="ident" id="5762554">checkExprOrType</span><span class="op" id="5762569">(</span><span class="ident" id="5762570">x</span><span class="op" id="5762571">)</span><span class="op" id="5762572">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762576">case</span>&nbsp;<span class="ident" id="5762581">token</span><span class="op" id="5762586">.</span><span class="ident" id="5762587">LBRACE</span><span class="op" id="5762593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762598">if</span>&nbsp;<span class="ident" id="5762601">isLiteralType</span><span class="op" id="5762614">(</span><span class="ident" id="5762615">x</span><span class="op" id="5762616">)</span>&nbsp;<span class="op" id="5762618">&amp;&amp;</span>&nbsp;<span class="op" id="5762621">(</span><span class="ident" id="5762622">p</span><span class="op" id="5762623">.</span><span class="ident" id="5762624">exprLev</span>&nbsp;<span class="op" id="5762632">&gt;=</span>&nbsp;<span class="num" id="5762635">0</span>&nbsp;<span class="op" id="5762637">||</span>&nbsp;<span class="op" id="5762640">!</span><span class="ident" id="5762641">isTypeName</span><span class="op" id="5762651">(</span><span class="ident" id="5762652">x</span><span class="op" id="5762653">)</span><span class="op" id="5762654">)</span>&nbsp;<span class="op" id="5762656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762662">if</span>&nbsp;<span class="ident" id="5762665">lhs</span>&nbsp;<span class="op" id="5762669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762676">p</span><span class="op" id="5762677">.</span><span class="ident" id="5762678">resolve</span><span class="op" id="5762685">(</span><span class="ident" id="5762686">x</span><span class="op" id="5762687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762693">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762699">x</span>&nbsp;<span class="op" id="5762701">=</span>&nbsp;<span class="ident" id="5762703">p</span><span class="op" id="5762704">.</span><span class="ident" id="5762705">parseLiteralValue</span><span class="op" id="5762722">(</span><span class="ident" id="5762723">x</span><span class="op" id="5762724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762729">}</span>&nbsp;<span class="keyword" id="5762731">else</span>&nbsp;<span class="op" id="5762736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762742">break</span>&nbsp;<span class="ident" id="5762748">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762757">default</span><span class="op" id="5762764">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762769">break</span>&nbsp;<span class="ident" id="5762775">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762783">lhs</span>&nbsp;<span class="op" id="5762787">=</span>&nbsp;<span class="builtintype" id="5762789">false</span>&nbsp;<span class="comment" id="5762795">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762835">return</span>&nbsp;<span class="ident" id="5762842">x</span><br>
<span class="lineno"></span><span class="op" id="5762844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5762847">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5762917">func</span>&nbsp;<span class="op" id="5762922">(</span><span class="ident" id="5762923">p</span>&nbsp;<span class="op" id="5762925">*</span><span class="ident" id="5762926">parser</span><span class="op" id="5762932">)</span>&nbsp;<span class="ident" id="5762934">parseUnaryExpr</span><span class="op" id="5762948">(</span><span class="ident" id="5762949">lhs</span>&nbsp;<span class="builtintype" id="5762953">bool</span><span class="op" id="5762957">)</span>&nbsp;<span class="ident" id="5762959">ast</span><span class="op" id="5762962">.</span><span class="ident" id="5762963">Expr</span>&nbsp;<span class="op" id="5762968">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762971">if</span>&nbsp;<span class="ident" id="5762974">p</span><span class="op" id="5762975">.</span><span class="ident" id="5762976">trace</span>&nbsp;<span class="op" id="5762982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762986">defer</span>&nbsp;<span class="ident" id="5762992">un</span><span class="op" id="5762994">(</span><span class="ident" id="5762995">trace</span><span class="op" id="5763000">(</span><span class="ident" id="5763001">p</span><span class="op" id="5763002">,</span>&nbsp;<span class="string" id="5763004">&#34;UnaryExpr&#34;</span><span class="op" id="5763015">)</span><span class="op" id="5763016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763023">switch</span>&nbsp;<span class="ident" id="5763030">p</span><span class="op" id="5763031">.</span><span class="ident" id="5763032">tok</span>&nbsp;<span class="op" id="5763036">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763039">case</span>&nbsp;<span class="ident" id="5763044">token</span><span class="op" id="5763049">.</span><span class="ident" id="5763050">ADD</span><span class="op" id="5763053">,</span>&nbsp;<span class="ident" id="5763055">token</span><span class="op" id="5763060">.</span><span class="ident" id="5763061">SUB</span><span class="op" id="5763064">,</span>&nbsp;<span class="ident" id="5763066">token</span><span class="op" id="5763071">.</span><span class="ident" id="5763072">NOT</span><span class="op" id="5763075">,</span>&nbsp;<span class="ident" id="5763077">token</span><span class="op" id="5763082">.</span><span class="ident" id="5763083">XOR</span><span class="op" id="5763086">,</span>&nbsp;<span class="ident" id="5763088">token</span><span class="op" id="5763093">.</span><span class="ident" id="5763094">AND</span><span class="op" id="5763097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763101">pos</span><span class="op" id="5763104">,</span>&nbsp;<span class="ident" id="5763106">op</span>&nbsp;<span class="op" id="5763109">:=</span>&nbsp;<span class="ident" id="5763112">p</span><span class="op" id="5763113">.</span><span class="ident" id="5763114">pos</span><span class="op" id="5763117">,</span>&nbsp;<span class="ident" id="5763119">p</span><span class="op" id="5763120">.</span><span class="ident" id="5763121">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763127">p</span><span class="op" id="5763128">.</span><span class="ident" id="5763129">next</span><span class="op" id="5763133">(</span><span class="op" id="5763134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763138">x</span>&nbsp;<span class="op" id="5763140">:=</span>&nbsp;<span class="ident" id="5763143">p</span><span class="op" id="5763144">.</span><span class="ident" id="5763145">parseUnaryExpr</span><span class="op" id="5763159">(</span><span class="builtintype" id="5763160">false</span><span class="op" id="5763165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763169">return</span>&nbsp;<span class="op" id="5763176">&amp;</span><span class="ident" id="5763177">ast</span><span class="op" id="5763180">.</span><span class="ident" id="5763181">UnaryExpr</span><span class="op" id="5763190">{</span><span class="ident" id="5763191">OpPos</span><span class="op" id="5763196">:</span>&nbsp;<span class="ident" id="5763198">pos</span><span class="op" id="5763201">,</span>&nbsp;<span class="ident" id="5763203">Op</span><span class="op" id="5763205">:</span>&nbsp;<span class="ident" id="5763207">op</span><span class="op" id="5763209">,</span>&nbsp;<span class="ident" id="5763211">X</span><span class="op" id="5763212">:</span>&nbsp;<span class="ident" id="5763214">p</span><span class="op" id="5763215">.</span><span class="ident" id="5763216">checkExpr</span><span class="op" id="5763225">(</span><span class="ident" id="5763226">x</span><span class="op" id="5763227">)</span><span class="op" id="5763228">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763232">case</span>&nbsp;<span class="ident" id="5763237">token</span><span class="op" id="5763242">.</span><span class="ident" id="5763243">ARROW</span><span class="op" id="5763248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763252">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763292">arrow</span>&nbsp;<span class="op" id="5763298">:=</span>&nbsp;<span class="ident" id="5763301">p</span><span class="op" id="5763302">.</span><span class="ident" id="5763303">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763309">p</span><span class="op" id="5763310">.</span><span class="ident" id="5763311">next</span><span class="op" id="5763315">(</span><span class="op" id="5763316">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763321">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763384">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763445">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763508">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763528">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763533">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763582">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763642">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763647">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763708">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763746">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763751">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763794">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763842">x</span>&nbsp;<span class="op" id="5763844">:=</span>&nbsp;<span class="ident" id="5763847">p</span><span class="op" id="5763848">.</span><span class="ident" id="5763849">parseUnaryExpr</span><span class="op" id="5763863">(</span><span class="builtintype" id="5763864">false</span><span class="op" id="5763869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763874">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763908">if</span>&nbsp;<span class="ident" id="5763911">typ</span><span class="op" id="5763914">,</span>&nbsp;<span class="ident" id="5763916">ok</span>&nbsp;<span class="op" id="5763919">:=</span>&nbsp;<span class="ident" id="5763922">x</span><span class="op" id="5763923">.</span><span class="op" id="5763924">(</span><span class="op" id="5763925">*</span><span class="ident" id="5763926">ast</span><span class="op" id="5763929">.</span><span class="ident" id="5763930">ChanType</span><span class="op" id="5763938">)</span><span class="op" id="5763939">;</span>&nbsp;<span class="ident" id="5763941">ok</span>&nbsp;<span class="op" id="5763944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763949">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763965">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764005">dir</span>&nbsp;<span class="op" id="5764009">:=</span>&nbsp;<span class="ident" id="5764012">ast</span><span class="op" id="5764015">.</span><span class="ident" id="5764016">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764024">for</span>&nbsp;<span class="ident" id="5764028">ok</span>&nbsp;<span class="op" id="5764031">&amp;&amp;</span>&nbsp;<span class="ident" id="5764034">dir</span>&nbsp;<span class="op" id="5764038">==</span>&nbsp;<span class="ident" id="5764041">ast</span><span class="op" id="5764044">.</span><span class="ident" id="5764045">SEND</span>&nbsp;<span class="op" id="5764050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764056">if</span>&nbsp;<span class="ident" id="5764059">typ</span><span class="op" id="5764062">.</span><span class="ident" id="5764063">Dir</span>&nbsp;<span class="op" id="5764067">==</span>&nbsp;<span class="ident" id="5764070">ast</span><span class="op" id="5764073">.</span><span class="ident" id="5764074">RECV</span>&nbsp;<span class="op" id="5764079">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764086">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764128">p</span><span class="op" id="5764129">.</span><span class="ident" id="5764130">errorExpected</span><span class="op" id="5764143">(</span><span class="ident" id="5764144">typ</span><span class="op" id="5764147">.</span><span class="ident" id="5764148">Arrow</span><span class="op" id="5764153">,</span>&nbsp;<span class="string" id="5764155">&#34;&#39;chan&#39;&#34;</span><span class="op" id="5764163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764175">arrow</span><span class="op" id="5764180">,</span>&nbsp;<span class="ident" id="5764182">typ</span><span class="op" id="5764185">.</span><span class="ident" id="5764186">Begin</span><span class="op" id="5764191">,</span>&nbsp;<span class="ident" id="5764193">typ</span><span class="op" id="5764196">.</span><span class="ident" id="5764197">Arrow</span>&nbsp;<span class="op" id="5764203">=</span>&nbsp;<span class="ident" id="5764205">typ</span><span class="op" id="5764208">.</span><span class="ident" id="5764209">Arrow</span><span class="op" id="5764214">,</span>&nbsp;<span class="ident" id="5764216">arrow</span><span class="op" id="5764221">,</span>&nbsp;<span class="ident" id="5764223">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764233">dir</span><span class="op" id="5764236">,</span>&nbsp;<span class="ident" id="5764238">typ</span><span class="op" id="5764241">.</span><span class="ident" id="5764242">Dir</span>&nbsp;<span class="op" id="5764246">=</span>&nbsp;<span class="ident" id="5764248">typ</span><span class="op" id="5764251">.</span><span class="ident" id="5764252">Dir</span><span class="op" id="5764255">,</span>&nbsp;<span class="ident" id="5764257">ast</span><span class="op" id="5764260">.</span><span class="ident" id="5764261">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764270">typ</span><span class="op" id="5764273">,</span>&nbsp;<span class="ident" id="5764275">ok</span>&nbsp;<span class="op" id="5764278">=</span>&nbsp;<span class="ident" id="5764280">typ</span><span class="op" id="5764283">.</span><span class="ident" id="5764284">Value</span><span class="op" id="5764289">.</span><span class="op" id="5764290">(</span><span class="op" id="5764291">*</span><span class="ident" id="5764292">ast</span><span class="op" id="5764295">.</span><span class="ident" id="5764296">ChanType</span><span class="op" id="5764304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764314">if</span>&nbsp;<span class="ident" id="5764317">dir</span>&nbsp;<span class="op" id="5764321">==</span>&nbsp;<span class="ident" id="5764324">ast</span><span class="op" id="5764327">.</span><span class="ident" id="5764328">SEND</span>&nbsp;<span class="op" id="5764333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764339">p</span><span class="op" id="5764340">.</span><span class="ident" id="5764341">errorExpected</span><span class="op" id="5764354">(</span><span class="ident" id="5764355">arrow</span><span class="op" id="5764360">,</span>&nbsp;<span class="string" id="5764362">&#34;channel&nbsp;type&#34;</span><span class="op" id="5764376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764381">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764387">return</span>&nbsp;<span class="ident" id="5764394">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764403">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764417">return</span>&nbsp;<span class="op" id="5764424">&amp;</span><span class="ident" id="5764425">ast</span><span class="op" id="5764428">.</span><span class="ident" id="5764429">UnaryExpr</span><span class="op" id="5764438">{</span><span class="ident" id="5764439">OpPos</span><span class="op" id="5764444">:</span>&nbsp;<span class="ident" id="5764446">arrow</span><span class="op" id="5764451">,</span>&nbsp;<span class="ident" id="5764453">Op</span><span class="op" id="5764455">:</span>&nbsp;<span class="ident" id="5764457">token</span><span class="op" id="5764462">.</span><span class="ident" id="5764463">ARROW</span><span class="op" id="5764468">,</span>&nbsp;<span class="ident" id="5764470">X</span><span class="op" id="5764471">:</span>&nbsp;<span class="ident" id="5764473">p</span><span class="op" id="5764474">.</span><span class="ident" id="5764475">checkExpr</span><span class="op" id="5764484">(</span><span class="ident" id="5764485">x</span><span class="op" id="5764486">)</span><span class="op" id="5764487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764491">case</span>&nbsp;<span class="ident" id="5764496">token</span><span class="op" id="5764501">.</span><span class="ident" id="5764502">MUL</span><span class="op" id="5764505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764509">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764551">pos</span>&nbsp;<span class="op" id="5764555">:=</span>&nbsp;<span class="ident" id="5764558">p</span><span class="op" id="5764559">.</span><span class="ident" id="5764560">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764566">p</span><span class="op" id="5764567">.</span><span class="ident" id="5764568">next</span><span class="op" id="5764572">(</span><span class="op" id="5764573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764577">x</span>&nbsp;<span class="op" id="5764579">:=</span>&nbsp;<span class="ident" id="5764582">p</span><span class="op" id="5764583">.</span><span class="ident" id="5764584">parseUnaryExpr</span><span class="op" id="5764598">(</span><span class="builtintype" id="5764599">false</span><span class="op" id="5764604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764608">return</span>&nbsp;<span class="op" id="5764615">&amp;</span><span class="ident" id="5764616">ast</span><span class="op" id="5764619">.</span><span class="ident" id="5764620">StarExpr</span><span class="op" id="5764628">{</span><span class="ident" id="5764629">Star</span><span class="op" id="5764633">:</span>&nbsp;<span class="ident" id="5764635">pos</span><span class="op" id="5764638">,</span>&nbsp;<span class="ident" id="5764640">X</span><span class="op" id="5764641">:</span>&nbsp;<span class="ident" id="5764643">p</span><span class="op" id="5764644">.</span><span class="ident" id="5764645">checkExprOrType</span><span class="op" id="5764660">(</span><span class="ident" id="5764661">x</span><span class="op" id="5764662">)</span><span class="op" id="5764663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764670">return</span>&nbsp;<span class="ident" id="5764677">p</span><span class="op" id="5764678">.</span><span class="ident" id="5764679">parsePrimaryExpr</span><span class="op" id="5764695">(</span><span class="ident" id="5764696">lhs</span><span class="op" id="5764699">)</span><br>
<span class="lineno"></span><span class="op" id="5764701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5764704">func</span>&nbsp;<span class="op" id="5764709">(</span><span class="ident" id="5764710">p</span>&nbsp;<span class="op" id="5764712">*</span><span class="ident" id="5764713">parser</span><span class="op" id="5764719">)</span>&nbsp;<span class="ident" id="5764721">tokPrec</span><span class="op" id="5764728">(</span><span class="op" id="5764729">)</span>&nbsp;<span class="op" id="5764731">(</span><span class="ident" id="5764732">token</span><span class="op" id="5764737">.</span><span class="ident" id="5764738">Token</span><span class="op" id="5764743">,</span>&nbsp;<span class="builtintype" id="5764745">int</span><span class="op" id="5764748">)</span>&nbsp;<span class="op" id="5764750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764753">tok</span>&nbsp;<span class="op" id="5764757">:=</span>&nbsp;<span class="ident" id="5764760">p</span><span class="op" id="5764761">.</span><span class="ident" id="5764762">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764767">if</span>&nbsp;<span class="ident" id="5764770">p</span><span class="op" id="5764771">.</span><span class="ident" id="5764772">inRhs</span>&nbsp;<span class="op" id="5764778">&amp;&amp;</span>&nbsp;<span class="ident" id="5764781">tok</span>&nbsp;<span class="op" id="5764785">==</span>&nbsp;<span class="ident" id="5764788">token</span><span class="op" id="5764793">.</span><span class="ident" id="5764794">ASSIGN</span>&nbsp;<span class="op" id="5764801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764805">tok</span>&nbsp;<span class="op" id="5764809">=</span>&nbsp;<span class="ident" id="5764811">token</span><span class="op" id="5764816">.</span><span class="ident" id="5764817">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764825">return</span>&nbsp;<span class="ident" id="5764832">tok</span><span class="op" id="5764835">,</span>&nbsp;<span class="ident" id="5764837">tok</span><span class="op" id="5764840">.</span><span class="ident" id="5764841">Precedence</span><span class="op" id="5764851">(</span><span class="op" id="5764852">)</span><br>
<span class="lineno"></span><span class="op" id="5764854">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="5764857">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5764927">func</span>&nbsp;<span class="op" id="5764932">(</span><span class="ident" id="5764933">p</span>&nbsp;<span class="op" id="5764935">*</span><span class="ident" id="5764936">parser</span><span class="op" id="5764942">)</span>&nbsp;<span class="ident" id="5764944">parseBinaryExpr</span><span class="op" id="5764959">(</span><span class="ident" id="5764960">lhs</span>&nbsp;<span class="builtintype" id="5764964">bool</span><span class="op" id="5764968">,</span>&nbsp;<span class="ident" id="5764970">prec1</span>&nbsp;<span class="builtintype" id="5764976">int</span><span class="op" id="5764979">)</span>&nbsp;<span class="ident" id="5764981">ast</span><span class="op" id="5764984">.</span><span class="ident" id="5764985">Expr</span>&nbsp;<span class="op" id="5764990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764993">if</span>&nbsp;<span class="ident" id="5764996">p</span><span class="op" id="5764997">.</span><span class="ident" id="5764998">trace</span>&nbsp;<span class="op" id="5765004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765008">defer</span>&nbsp;<span class="ident" id="5765014">un</span><span class="op" id="5765016">(</span><span class="ident" id="5765017">trace</span><span class="op" id="5765022">(</span><span class="ident" id="5765023">p</span><span class="op" id="5765024">,</span>&nbsp;<span class="string" id="5765026">&#34;BinaryExpr&#34;</span><span class="op" id="5765038">)</span><span class="op" id="5765039">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765046">x</span>&nbsp;<span class="op" id="5765048">:=</span>&nbsp;<span class="ident" id="5765051">p</span><span class="op" id="5765052">.</span><span class="ident" id="5765053">parseUnaryExpr</span><span class="op" id="5765067">(</span><span class="ident" id="5765068">lhs</span><span class="op" id="5765071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765074">for</span>&nbsp;<span class="ident" id="5765078">_</span><span class="op" id="5765079">,</span>&nbsp;<span class="ident" id="5765081">prec</span>&nbsp;<span class="op" id="5765086">:=</span>&nbsp;<span class="ident" id="5765089">p</span><span class="op" id="5765090">.</span><span class="ident" id="5765091">tokPrec</span><span class="op" id="5765098">(</span><span class="op" id="5765099">)</span><span class="op" id="5765100">;</span>&nbsp;<span class="ident" id="5765102">prec</span>&nbsp;<span class="op" id="5765107">&gt;=</span>&nbsp;<span class="ident" id="5765110">prec1</span><span class="op" id="5765115">;</span>&nbsp;<span class="ident" id="5765117">prec</span><span class="op" id="5765121">--</span>&nbsp;<span class="op" id="5765124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765128">for</span>&nbsp;<span class="op" id="5765132">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765137">op</span><span class="op" id="5765139">,</span>&nbsp;<span class="ident" id="5765141">oprec</span>&nbsp;<span class="op" id="5765147">:=</span>&nbsp;<span class="ident" id="5765150">p</span><span class="op" id="5765151">.</span><span class="ident" id="5765152">tokPrec</span><span class="op" id="5765159">(</span><span class="op" id="5765160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765165">if</span>&nbsp;<span class="ident" id="5765168">oprec</span>&nbsp;<span class="op" id="5765174">!=</span>&nbsp;<span class="ident" id="5765177">prec</span>&nbsp;<span class="op" id="5765182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765188">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765202">pos</span>&nbsp;<span class="op" id="5765206">:=</span>&nbsp;<span class="ident" id="5765209">p</span><span class="op" id="5765210">.</span><span class="ident" id="5765211">expect</span><span class="op" id="5765217">(</span><span class="ident" id="5765218">op</span><span class="op" id="5765220">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765225">if</span>&nbsp;<span class="ident" id="5765228">lhs</span>&nbsp;<span class="op" id="5765232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765238">p</span><span class="op" id="5765239">.</span><span class="ident" id="5765240">resolve</span><span class="op" id="5765247">(</span><span class="ident" id="5765248">x</span><span class="op" id="5765249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765255">lhs</span>&nbsp;<span class="op" id="5765259">=</span>&nbsp;<span class="builtintype" id="5765261">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765275">y</span>&nbsp;<span class="op" id="5765277">:=</span>&nbsp;<span class="ident" id="5765280">p</span><span class="op" id="5765281">.</span><span class="ident" id="5765282">parseBinaryExpr</span><span class="op" id="5765297">(</span><span class="builtintype" id="5765298">false</span><span class="op" id="5765303">,</span>&nbsp;<span class="ident" id="5765305">prec</span><span class="op" id="5765309">+</span><span class="num" id="5765310">1</span><span class="op" id="5765311">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765316">x</span>&nbsp;<span class="op" id="5765318">=</span>&nbsp;<span class="op" id="5765320">&amp;</span><span class="ident" id="5765321">ast</span><span class="op" id="5765324">.</span><span class="ident" id="5765325">BinaryExpr</span><span class="op" id="5765335">{</span><span class="ident" id="5765336">X</span><span class="op" id="5765337">:</span>&nbsp;<span class="ident" id="5765339">p</span><span class="op" id="5765340">.</span><span class="ident" id="5765341">checkExpr</span><span class="op" id="5765350">(</span><span class="ident" id="5765351">x</span><span class="op" id="5765352">)</span><span class="op" id="5765353">,</span>&nbsp;<span class="ident" id="5765355">OpPos</span><span class="op" id="5765360">:</span>&nbsp;<span class="ident" id="5765362">pos</span><span class="op" id="5765365">,</span>&nbsp;<span class="ident" id="5765367">Op</span><span class="op" id="5765369">:</span>&nbsp;<span class="ident" id="5765371">op</span><span class="op" id="5765373">,</span>&nbsp;<span class="ident" id="5765375">Y</span><span class="op" id="5765376">:</span>&nbsp;<span class="ident" id="5765378">p</span><span class="op" id="5765379">.</span><span class="ident" id="5765380">checkExpr</span><span class="op" id="5765389">(</span><span class="ident" id="5765390">y</span><span class="op" id="5765391">)</span><span class="op" id="5765392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765403">return</span>&nbsp;<span class="ident" id="5765410">x</span><br>
<span class="lineno">1590</span><span class="op" id="5765412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5765415">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="5765485">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5765557">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="5765628">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5765640">func</span>&nbsp;<span class="op" id="5765645">(</span><span class="ident" id="5765646">p</span>&nbsp;<span class="op" id="5765648">*</span><span class="ident" id="5765649">parser</span><span class="op" id="5765655">)</span>&nbsp;<span class="ident" id="5765657">parseExpr</span><span class="op" id="5765666">(</span><span class="ident" id="5765667">lhs</span>&nbsp;<span class="builtintype" id="5765671">bool</span><span class="op" id="5765675">)</span>&nbsp;<span class="ident" id="5765677">ast</span><span class="op" id="5765680">.</span><span class="ident" id="5765681">Expr</span>&nbsp;<span class="op" id="5765686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765689">if</span>&nbsp;<span class="ident" id="5765692">p</span><span class="op" id="5765693">.</span><span class="ident" id="5765694">trace</span>&nbsp;<span class="op" id="5765700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765704">defer</span>&nbsp;<span class="ident" id="5765710">un</span><span class="op" id="5765712">(</span><span class="ident" id="5765713">trace</span><span class="op" id="5765718">(</span><span class="ident" id="5765719">p</span><span class="op" id="5765720">,</span>&nbsp;<span class="string" id="5765722">&#34;Expression&#34;</span><span class="op" id="5765734">)</span><span class="op" id="5765735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765738">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765742">return</span>&nbsp;<span class="ident" id="5765749">p</span><span class="op" id="5765750">.</span><span class="ident" id="5765751">parseBinaryExpr</span><span class="op" id="5765766">(</span><span class="ident" id="5765767">lhs</span><span class="op" id="5765770">,</span>&nbsp;<span class="ident" id="5765772">token</span><span class="op" id="5765777">.</span><span class="ident" id="5765778">LowestPrec</span><span class="op" id="5765788">+</span><span class="num" id="5765789">1</span><span class="op" id="5765790">)</span><br>
<span class="lineno"></span><span class="op" id="5765792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5765795">func</span>&nbsp;<span class="op" id="5765800">(</span><span class="ident" id="5765801">p</span>&nbsp;<span class="op" id="5765803">*</span><span class="ident" id="5765804">parser</span><span class="op" id="5765810">)</span>&nbsp;<span class="ident" id="5765812">parseRhs</span><span class="op" id="5765820">(</span><span class="op" id="5765821">)</span>&nbsp;<span class="ident" id="5765823">ast</span><span class="op" id="5765826">.</span><span class="ident" id="5765827">Expr</span>&nbsp;<span class="op" id="5765832">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765835">old</span>&nbsp;<span class="op" id="5765839">:=</span>&nbsp;<span class="ident" id="5765842">p</span><span class="op" id="5765843">.</span><span class="ident" id="5765844">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765851">p</span><span class="op" id="5765852">.</span><span class="ident" id="5765853">inRhs</span>&nbsp;<span class="op" id="5765859">=</span>&nbsp;<span class="builtintype" id="5765861">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765867">x</span>&nbsp;<span class="op" id="5765869">:=</span>&nbsp;<span class="ident" id="5765872">p</span><span class="op" id="5765873">.</span><span class="ident" id="5765874">checkExpr</span><span class="op" id="5765883">(</span><span class="ident" id="5765884">p</span><span class="op" id="5765885">.</span><span class="ident" id="5765886">parseExpr</span><span class="op" id="5765895">(</span><span class="builtintype" id="5765896">false</span><span class="op" id="5765901">)</span><span class="op" id="5765902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765905">p</span><span class="op" id="5765906">.</span><span class="ident" id="5765907">inRhs</span>&nbsp;<span class="op" id="5765913">=</span>&nbsp;<span class="ident" id="5765915">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765920">return</span>&nbsp;<span class="ident" id="5765927">x</span><br>
<span class="lineno">1610</span><span class="op" id="5765929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5765932">func</span>&nbsp;<span class="op" id="5765937">(</span><span class="ident" id="5765938">p</span>&nbsp;<span class="op" id="5765940">*</span><span class="ident" id="5765941">parser</span><span class="op" id="5765947">)</span>&nbsp;<span class="ident" id="5765949">parseRhsOrType</span><span class="op" id="5765963">(</span><span class="op" id="5765964">)</span>&nbsp;<span class="ident" id="5765966">ast</span><span class="op" id="5765969">.</span><span class="ident" id="5765970">Expr</span>&nbsp;<span class="op" id="5765975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765978">old</span>&nbsp;<span class="op" id="5765982">:=</span>&nbsp;<span class="ident" id="5765985">p</span><span class="op" id="5765986">.</span><span class="ident" id="5765987">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765994">p</span><span class="op" id="5765995">.</span><span class="ident" id="5765996">inRhs</span>&nbsp;<span class="op" id="5766002">=</span>&nbsp;<span class="builtintype" id="5766004">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766010">x</span>&nbsp;<span class="op" id="5766012">:=</span>&nbsp;<span class="ident" id="5766015">p</span><span class="op" id="5766016">.</span><span class="ident" id="5766017">checkExprOrType</span><span class="op" id="5766032">(</span><span class="ident" id="5766033">p</span><span class="op" id="5766034">.</span><span class="ident" id="5766035">parseExpr</span><span class="op" id="5766044">(</span><span class="builtintype" id="5766045">false</span><span class="op" id="5766050">)</span><span class="op" id="5766051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766054">p</span><span class="op" id="5766055">.</span><span class="ident" id="5766056">inRhs</span>&nbsp;<span class="op" id="5766062">=</span>&nbsp;<span class="ident" id="5766064">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766069">return</span>&nbsp;<span class="ident" id="5766076">x</span><br>
<span class="lineno"></span><span class="op" id="5766078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="5766081">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5766161">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5766176">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5766214">const</span>&nbsp;<span class="op" id="5766220">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766223">basic</span>&nbsp;<span class="op" id="5766229">=</span>&nbsp;<span class="ident" id="5766231">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766237">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766246">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="5766254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="5766257">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="5766331">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5766405">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5766479">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="5766550">func</span>&nbsp;<span class="op" id="5766555">(</span><span class="ident" id="5766556">p</span>&nbsp;<span class="op" id="5766558">*</span><span class="ident" id="5766559">parser</span><span class="op" id="5766565">)</span>&nbsp;<span class="ident" id="5766567">parseSimpleStmt</span><span class="op" id="5766582">(</span><span class="ident" id="5766583">mode</span>&nbsp;<span class="builtintype" id="5766588">int</span><span class="op" id="5766591">)</span>&nbsp;<span class="op" id="5766593">(</span><span class="ident" id="5766594">ast</span><span class="op" id="5766597">.</span><span class="ident" id="5766598">Stmt</span><span class="op" id="5766602">,</span>&nbsp;<span class="builtintype" id="5766604">bool</span><span class="op" id="5766608">)</span>&nbsp;<span class="op" id="5766610">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766613">if</span>&nbsp;<span class="ident" id="5766616">p</span><span class="op" id="5766617">.</span><span class="ident" id="5766618">trace</span>&nbsp;<span class="op" id="5766624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766628">defer</span>&nbsp;<span class="ident" id="5766634">un</span><span class="op" id="5766636">(</span><span class="ident" id="5766637">trace</span><span class="op" id="5766642">(</span><span class="ident" id="5766643">p</span><span class="op" id="5766644">,</span>&nbsp;<span class="string" id="5766646">&#34;SimpleStmt&#34;</span><span class="op" id="5766658">)</span><span class="op" id="5766659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766666">x</span>&nbsp;<span class="op" id="5766668">:=</span>&nbsp;<span class="ident" id="5766671">p</span><span class="op" id="5766672">.</span><span class="ident" id="5766673">parseLhsList</span><span class="op" id="5766685">(</span><span class="op" id="5766686">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766690">switch</span>&nbsp;<span class="ident" id="5766697">p</span><span class="op" id="5766698">.</span><span class="ident" id="5766699">tok</span>&nbsp;<span class="op" id="5766703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766706">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766713">token</span><span class="op" id="5766718">.</span><span class="ident" id="5766719">DEFINE</span><span class="op" id="5766725">,</span>&nbsp;<span class="ident" id="5766727">token</span><span class="op" id="5766732">.</span><span class="ident" id="5766733">ASSIGN</span><span class="op" id="5766739">,</span>&nbsp;<span class="ident" id="5766741">token</span><span class="op" id="5766746">.</span><span class="ident" id="5766747">ADD_ASSIGN</span><span class="op" id="5766757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766761">token</span><span class="op" id="5766766">.</span><span class="ident" id="5766767">SUB_ASSIGN</span><span class="op" id="5766777">,</span>&nbsp;<span class="ident" id="5766779">token</span><span class="op" id="5766784">.</span><span class="ident" id="5766785">MUL_ASSIGN</span><span class="op" id="5766795">,</span>&nbsp;<span class="ident" id="5766797">token</span><span class="op" id="5766802">.</span><span class="ident" id="5766803">QUO_ASSIGN</span><span class="op" id="5766813">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766817">token</span><span class="op" id="5766822">.</span><span class="ident" id="5766823">REM_ASSIGN</span><span class="op" id="5766833">,</span>&nbsp;<span class="ident" id="5766835">token</span><span class="op" id="5766840">.</span><span class="ident" id="5766841">AND_ASSIGN</span><span class="op" id="5766851">,</span>&nbsp;<span class="ident" id="5766853">token</span><span class="op" id="5766858">.</span><span class="ident" id="5766859">OR_ASSIGN</span><span class="op" id="5766868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766872">token</span><span class="op" id="5766877">.</span><span class="ident" id="5766878">XOR_ASSIGN</span><span class="op" id="5766888">,</span>&nbsp;<span class="ident" id="5766890">token</span><span class="op" id="5766895">.</span><span class="ident" id="5766896">SHL_ASSIGN</span><span class="op" id="5766906">,</span>&nbsp;<span class="ident" id="5766908">token</span><span class="op" id="5766913">.</span><span class="ident" id="5766914">SHR_ASSIGN</span><span class="op" id="5766924">,</span>&nbsp;<span class="ident" id="5766926">token</span><span class="op" id="5766931">.</span><span class="ident" id="5766932">AND_NOT_ASSIGN</span><span class="op" id="5766946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766950">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767009">pos</span><span class="op" id="5767012">,</span>&nbsp;<span class="ident" id="5767014">tok</span>&nbsp;<span class="op" id="5767018">:=</span>&nbsp;<span class="ident" id="5767021">p</span><span class="op" id="5767022">.</span><span class="ident" id="5767023">pos</span><span class="op" id="5767026">,</span>&nbsp;<span class="ident" id="5767028">p</span><span class="op" id="5767029">.</span><span class="ident" id="5767030">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767036">p</span><span class="op" id="5767037">.</span><span class="ident" id="5767038">next</span><span class="op" id="5767042">(</span><span class="op" id="5767043">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767047">var</span>&nbsp;<span class="ident" id="5767051">y</span>&nbsp;<span class="op" id="5767053">[</span><span class="op" id="5767054">]</span><span class="ident" id="5767055">ast</span><span class="op" id="5767058">.</span><span class="ident" id="5767059">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767066">isRange</span>&nbsp;<span class="op" id="5767074">:=</span>&nbsp;<span class="builtintype" id="5767077">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767085">if</span>&nbsp;<span class="ident" id="5767088">mode</span>&nbsp;<span class="op" id="5767093">==</span>&nbsp;<span class="ident" id="5767096">rangeOk</span>&nbsp;<span class="op" id="5767104">&amp;&amp;</span>&nbsp;<span class="ident" id="5767107">p</span><span class="op" id="5767108">.</span><span class="ident" id="5767109">tok</span>&nbsp;<span class="op" id="5767113">==</span>&nbsp;<span class="ident" id="5767116">token</span><span class="op" id="5767121">.</span><span class="ident" id="5767122">RANGE</span>&nbsp;<span class="op" id="5767128">&amp;&amp;</span>&nbsp;<span class="op" id="5767131">(</span><span class="ident" id="5767132">tok</span>&nbsp;<span class="op" id="5767136">==</span>&nbsp;<span class="ident" id="5767139">token</span><span class="op" id="5767144">.</span><span class="ident" id="5767145">DEFINE</span>&nbsp;<span class="op" id="5767152">||</span>&nbsp;<span class="ident" id="5767155">tok</span>&nbsp;<span class="op" id="5767159">==</span>&nbsp;<span class="ident" id="5767162">token</span><span class="op" id="5767167">.</span><span class="ident" id="5767168">ASSIGN</span><span class="op" id="5767174">)</span>&nbsp;<span class="op" id="5767176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767181">pos</span>&nbsp;<span class="op" id="5767185">:=</span>&nbsp;<span class="ident" id="5767188">p</span><span class="op" id="5767189">.</span><span class="ident" id="5767190">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767197">p</span><span class="op" id="5767198">.</span><span class="ident" id="5767199">next</span><span class="op" id="5767203">(</span><span class="op" id="5767204">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767209">y</span>&nbsp;<span class="op" id="5767211">=</span>&nbsp;<span class="op" id="5767213">[</span><span class="op" id="5767214">]</span><span class="ident" id="5767215">ast</span><span class="op" id="5767218">.</span><span class="ident" id="5767219">Expr</span><span class="op" id="5767223">{</span><span class="op" id="5767224">&amp;</span><span class="ident" id="5767225">ast</span><span class="op" id="5767228">.</span><span class="ident" id="5767229">UnaryExpr</span><span class="op" id="5767238">{</span><span class="ident" id="5767239">OpPos</span><span class="op" id="5767244">:</span>&nbsp;<span class="ident" id="5767246">pos</span><span class="op" id="5767249">,</span>&nbsp;<span class="ident" id="5767251">Op</span><span class="op" id="5767253">:</span>&nbsp;<span class="ident" id="5767255">token</span><span class="op" id="5767260">.</span><span class="ident" id="5767261">RANGE</span><span class="op" id="5767266">,</span>&nbsp;<span class="ident" id="5767268">X</span><span class="op" id="5767269">:</span>&nbsp;<span class="ident" id="5767271">p</span><span class="op" id="5767272">.</span><span class="ident" id="5767273">parseRhs</span><span class="op" id="5767281">(</span><span class="op" id="5767282">)</span><span class="op" id="5767283">}</span><span class="op" id="5767284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767289">isRange</span>&nbsp;<span class="op" id="5767297">=</span>&nbsp;<span class="builtintype" id="5767299">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767306">}</span>&nbsp;<span class="keyword" id="5767308">else</span>&nbsp;<span class="op" id="5767313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767318">y</span>&nbsp;<span class="op" id="5767320">=</span>&nbsp;<span class="ident" id="5767322">p</span><span class="op" id="5767323">.</span><span class="ident" id="5767324">parseRhsList</span><span class="op" id="5767336">(</span><span class="op" id="5767337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767341">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767345">as</span>&nbsp;<span class="op" id="5767348">:=</span>&nbsp;<span class="op" id="5767351">&amp;</span><span class="ident" id="5767352">ast</span><span class="op" id="5767355">.</span><span class="ident" id="5767356">AssignStmt</span><span class="op" id="5767366">{</span><span class="ident" id="5767367">Lhs</span><span class="op" id="5767370">:</span>&nbsp;<span class="ident" id="5767372">x</span><span class="op" id="5767373">,</span>&nbsp;<span class="ident" id="5767375">TokPos</span><span class="op" id="5767381">:</span>&nbsp;<span class="ident" id="5767383">pos</span><span class="op" id="5767386">,</span>&nbsp;<span class="ident" id="5767388">Tok</span><span class="op" id="5767391">:</span>&nbsp;<span class="ident" id="5767393">tok</span><span class="op" id="5767396">,</span>&nbsp;<span class="ident" id="5767398">Rhs</span><span class="op" id="5767401">:</span>&nbsp;<span class="ident" id="5767403">y</span><span class="op" id="5767404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767408">if</span>&nbsp;<span class="ident" id="5767411">tok</span>&nbsp;<span class="op" id="5767415">==</span>&nbsp;<span class="ident" id="5767418">token</span><span class="op" id="5767423">.</span><span class="ident" id="5767424">DEFINE</span>&nbsp;<span class="op" id="5767431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767436">p</span><span class="op" id="5767437">.</span><span class="ident" id="5767438">shortVarDecl</span><span class="op" id="5767450">(</span><span class="ident" id="5767451">as</span><span class="op" id="5767453">,</span>&nbsp;<span class="ident" id="5767455">x</span><span class="op" id="5767456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767464">return</span>&nbsp;<span class="ident" id="5767471">as</span><span class="op" id="5767473">,</span>&nbsp;<span class="ident" id="5767475">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767488">if</span>&nbsp;<span class="builtinfunc" id="5767491">len</span><span class="op" id="5767494">(</span><span class="ident" id="5767495">x</span><span class="op" id="5767496">)</span>&nbsp;<span class="op" id="5767498">&gt;</span>&nbsp;<span class="num" id="5767500">1</span>&nbsp;<span class="op" id="5767502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767506">p</span><span class="op" id="5767507">.</span><span class="ident" id="5767508">errorExpected</span><span class="op" id="5767521">(</span><span class="ident" id="5767522">x</span><span class="op" id="5767523">[</span><span class="num" id="5767524">0</span><span class="op" id="5767525">]</span><span class="op" id="5767526">.</span><span class="ident" id="5767527">Pos</span><span class="op" id="5767530">(</span><span class="op" id="5767531">)</span><span class="op" id="5767532">,</span>&nbsp;<span class="string" id="5767534">&#34;1&nbsp;expression&#34;</span><span class="op" id="5767548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767552">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767591">switch</span>&nbsp;<span class="ident" id="5767598">p</span><span class="op" id="5767599">.</span><span class="ident" id="5767600">tok</span>&nbsp;<span class="op" id="5767604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767607">case</span>&nbsp;<span class="ident" id="5767612">token</span><span class="op" id="5767617">.</span><span class="ident" id="5767618">COLON</span><span class="op" id="5767623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767627">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767650">colon</span>&nbsp;<span class="op" id="5767656">:=</span>&nbsp;<span class="ident" id="5767659">p</span><span class="op" id="5767660">.</span><span class="ident" id="5767661">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767667">p</span><span class="op" id="5767668">.</span><span class="ident" id="5767669">next</span><span class="op" id="5767673">(</span><span class="op" id="5767674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767678">if</span>&nbsp;<span class="ident" id="5767681">label</span><span class="op" id="5767686">,</span>&nbsp;<span class="ident" id="5767688">isIdent</span>&nbsp;<span class="op" id="5767696">:=</span>&nbsp;<span class="ident" id="5767699">x</span><span class="op" id="5767700">[</span><span class="num" id="5767701">0</span><span class="op" id="5767702">]</span><span class="op" id="5767703">.</span><span class="op" id="5767704">(</span><span class="op" id="5767705">*</span><span class="ident" id="5767706">ast</span><span class="op" id="5767709">.</span><span class="ident" id="5767710">Ident</span><span class="op" id="5767715">)</span><span class="op" id="5767716">;</span>&nbsp;<span class="ident" id="5767718">mode</span>&nbsp;<span class="op" id="5767723">==</span>&nbsp;<span class="ident" id="5767726">labelOk</span>&nbsp;<span class="op" id="5767734">&amp;&amp;</span>&nbsp;<span class="ident" id="5767737">isIdent</span>&nbsp;<span class="op" id="5767745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767750">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767814">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767880">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767896">stmt</span>&nbsp;<span class="op" id="5767901">:=</span>&nbsp;<span class="op" id="5767904">&amp;</span><span class="ident" id="5767905">ast</span><span class="op" id="5767908">.</span><span class="ident" id="5767909">LabeledStmt</span><span class="op" id="5767920">{</span><span class="ident" id="5767921">Label</span><span class="op" id="5767926">:</span>&nbsp;<span class="ident" id="5767928">label</span><span class="op" id="5767933">,</span>&nbsp;<span class="ident" id="5767935">Colon</span><span class="op" id="5767940">:</span>&nbsp;<span class="ident" id="5767942">colon</span><span class="op" id="5767947">,</span>&nbsp;<span class="ident" id="5767949">Stmt</span><span class="op" id="5767953">:</span>&nbsp;<span class="ident" id="5767955">p</span><span class="op" id="5767956">.</span><span class="ident" id="5767957">parseStmt</span><span class="op" id="5767966">(</span><span class="op" id="5767967">)</span><span class="op" id="5767968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767973">p</span><span class="op" id="5767974">.</span><span class="ident" id="5767975">declare</span><span class="op" id="5767982">(</span><span class="ident" id="5767983">stmt</span><span class="op" id="5767987">,</span>&nbsp;<span class="ident" id="5767989">nil</span><span class="op" id="5767992">,</span>&nbsp;<span class="ident" id="5767994">p</span><span class="op" id="5767995">.</span><span class="ident" id="5767996">labelScope</span><span class="op" id="5768006">,</span>&nbsp;<span class="ident" id="5768008">ast</span><span class="op" id="5768011">.</span><span class="ident" id="5768012">Lbl</span><span class="op" id="5768015">,</span>&nbsp;<span class="ident" id="5768017">label</span><span class="op" id="5768022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768027">return</span>&nbsp;<span class="ident" id="5768034">stmt</span><span class="op" id="5768038">,</span>&nbsp;<span class="builtintype" id="5768040">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768048">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768052">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768125">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768199">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768272">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768345">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768419">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768454">p</span><span class="op" id="5768455">.</span><span class="builtintype" id="5768456">error</span><span class="op" id="5768461">(</span><span class="ident" id="5768462">colon</span><span class="op" id="5768467">,</span>&nbsp;<span class="string" id="5768469">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="5768496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768500">return</span>&nbsp;<span class="op" id="5768507">&amp;</span><span class="ident" id="5768508">ast</span><span class="op" id="5768511">.</span><span class="ident" id="5768512">BadStmt</span><span class="op" id="5768519">{</span><span class="ident" id="5768520">From</span><span class="op" id="5768524">:</span>&nbsp;<span class="ident" id="5768526">x</span><span class="op" id="5768527">[</span><span class="num" id="5768528">0</span><span class="op" id="5768529">]</span><span class="op" id="5768530">.</span><span class="ident" id="5768531">Pos</span><span class="op" id="5768534">(</span><span class="op" id="5768535">)</span><span class="op" id="5768536">,</span>&nbsp;<span class="ident" id="5768538">To</span><span class="op" id="5768540">:</span>&nbsp;<span class="ident" id="5768542">colon</span>&nbsp;<span class="op" id="5768548">+</span>&nbsp;<span class="num" id="5768550">1</span><span class="op" id="5768551">}</span><span class="op" id="5768552">,</span>&nbsp;<span class="builtintype" id="5768554">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768562">case</span>&nbsp;<span class="ident" id="5768567">token</span><span class="op" id="5768572">.</span><span class="ident" id="5768573">ARROW</span><span class="op" id="5768578">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768582">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768602">arrow</span>&nbsp;<span class="op" id="5768608">:=</span>&nbsp;<span class="ident" id="5768611">p</span><span class="op" id="5768612">.</span><span class="ident" id="5768613">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768619">p</span><span class="op" id="5768620">.</span><span class="ident" id="5768621">next</span><span class="op" id="5768625">(</span><span class="op" id="5768626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768630">y</span>&nbsp;<span class="op" id="5768632">:=</span>&nbsp;<span class="ident" id="5768635">p</span><span class="op" id="5768636">.</span><span class="ident" id="5768637">parseRhs</span><span class="op" id="5768645">(</span><span class="op" id="5768646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768650">return</span>&nbsp;<span class="op" id="5768657">&amp;</span><span class="ident" id="5768658">ast</span><span class="op" id="5768661">.</span><span class="ident" id="5768662">SendStmt</span><span class="op" id="5768670">{</span><span class="ident" id="5768671">Chan</span><span class="op" id="5768675">:</span>&nbsp;<span class="ident" id="5768677">x</span><span class="op" id="5768678">[</span><span class="num" id="5768679">0</span><span class="op" id="5768680">]</span><span class="op" id="5768681">,</span>&nbsp;<span class="ident" id="5768683">Arrow</span><span class="op" id="5768688">:</span>&nbsp;<span class="ident" id="5768690">arrow</span><span class="op" id="5768695">,</span>&nbsp;<span class="ident" id="5768697">Value</span><span class="op" id="5768702">:</span>&nbsp;<span class="ident" id="5768704">y</span><span class="op" id="5768705">}</span><span class="op" id="5768706">,</span>&nbsp;<span class="builtintype" id="5768708">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768716">case</span>&nbsp;<span class="ident" id="5768721">token</span><span class="op" id="5768726">.</span><span class="ident" id="5768727">INC</span><span class="op" id="5768730">,</span>&nbsp;<span class="ident" id="5768732">token</span><span class="op" id="5768737">.</span><span class="ident" id="5768738">DEC</span><span class="op" id="5768741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768745">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768773">s</span>&nbsp;<span class="op" id="5768775">:=</span>&nbsp;<span class="op" id="5768778">&amp;</span><span class="ident" id="5768779">ast</span><span class="op" id="5768782">.</span><span class="ident" id="5768783">IncDecStmt</span><span class="op" id="5768793">{</span><span class="ident" id="5768794">X</span><span class="op" id="5768795">:</span>&nbsp;<span class="ident" id="5768797">x</span><span class="op" id="5768798">[</span><span class="num" id="5768799">0</span><span class="op" id="5768800">]</span><span class="op" id="5768801">,</span>&nbsp;<span class="ident" id="5768803">TokPos</span><span class="op" id="5768809">:</span>&nbsp;<span class="ident" id="5768811">p</span><span class="op" id="5768812">.</span><span class="ident" id="5768813">pos</span><span class="op" id="5768816">,</span>&nbsp;<span class="ident" id="5768818">Tok</span><span class="op" id="5768821">:</span>&nbsp;<span class="ident" id="5768823">p</span><span class="op" id="5768824">.</span><span class="ident" id="5768825">tok</span><span class="op" id="5768828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768832">p</span><span class="op" id="5768833">.</span><span class="ident" id="5768834">next</span><span class="op" id="5768838">(</span><span class="op" id="5768839">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768843">return</span>&nbsp;<span class="ident" id="5768850">s</span><span class="op" id="5768851">,</span>&nbsp;<span class="builtintype" id="5768853">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768864">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768879">return</span>&nbsp;<span class="op" id="5768886">&amp;</span><span class="ident" id="5768887">ast</span><span class="op" id="5768890">.</span><span class="ident" id="5768891">ExprStmt</span><span class="op" id="5768899">{</span><span class="ident" id="5768900">X</span><span class="op" id="5768901">:</span>&nbsp;<span class="ident" id="5768903">x</span><span class="op" id="5768904">[</span><span class="num" id="5768905">0</span><span class="op" id="5768906">]</span><span class="op" id="5768907">}</span><span class="op" id="5768908">,</span>&nbsp;<span class="builtintype" id="5768910">false</span><br>
<span class="lineno">1710</span><span class="op" id="5768916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5768919">func</span>&nbsp;<span class="op" id="5768924">(</span><span class="ident" id="5768925">p</span>&nbsp;<span class="op" id="5768927">*</span><span class="ident" id="5768928">parser</span><span class="op" id="5768934">)</span>&nbsp;<span class="ident" id="5768936">parseCallExpr</span><span class="op" id="5768949">(</span><span class="ident" id="5768950">callType</span>&nbsp;<span class="builtintype" id="5768959">string</span><span class="op" id="5768965">)</span>&nbsp;<span class="op" id="5768967">*</span><span class="ident" id="5768968">ast</span><span class="op" id="5768971">.</span><span class="ident" id="5768972">CallExpr</span>&nbsp;<span class="op" id="5768981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768984">x</span>&nbsp;<span class="op" id="5768986">:=</span>&nbsp;<span class="ident" id="5768989">p</span><span class="op" id="5768990">.</span><span class="ident" id="5768991">parseRhsOrType</span><span class="op" id="5769005">(</span><span class="op" id="5769006">)</span>&nbsp;<span class="comment" id="5769008">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769050">if</span>&nbsp;<span class="ident" id="5769053">call</span><span class="op" id="5769057">,</span>&nbsp;<span class="ident" id="5769059">isCall</span>&nbsp;<span class="op" id="5769066">:=</span>&nbsp;<span class="ident" id="5769069">x</span><span class="op" id="5769070">.</span><span class="op" id="5769071">(</span><span class="op" id="5769072">*</span><span class="ident" id="5769073">ast</span><span class="op" id="5769076">.</span><span class="ident" id="5769077">CallExpr</span><span class="op" id="5769085">)</span><span class="op" id="5769086">;</span>&nbsp;<span class="ident" id="5769088">isCall</span>&nbsp;<span class="op" id="5769095">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769099">return</span>&nbsp;<span class="ident" id="5769106">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769115">if</span>&nbsp;<span class="ident" id="5769118">_</span><span class="op" id="5769119">,</span>&nbsp;<span class="ident" id="5769121">isBad</span>&nbsp;<span class="op" id="5769127">:=</span>&nbsp;<span class="ident" id="5769130">x</span><span class="op" id="5769131">.</span><span class="op" id="5769132">(</span><span class="op" id="5769133">*</span><span class="ident" id="5769134">ast</span><span class="op" id="5769137">.</span><span class="ident" id="5769138">BadExpr</span><span class="op" id="5769145">)</span><span class="op" id="5769146">;</span>&nbsp;<span class="op" id="5769148">!</span><span class="ident" id="5769149">isBad</span>&nbsp;<span class="op" id="5769155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5769159">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769200">p</span><span class="op" id="5769201">.</span><span class="builtintype" id="5769202">error</span><span class="op" id="5769207">(</span><span class="ident" id="5769208">p</span><span class="op" id="5769209">.</span><span class="ident" id="5769210">safePos</span><span class="op" id="5769217">(</span><span class="ident" id="5769218">x</span><span class="op" id="5769219">.</span><span class="ident" id="5769220">End</span><span class="op" id="5769223">(</span><span class="op" id="5769224">)</span><span class="op" id="5769225">)</span><span class="op" id="5769226">,</span>&nbsp;<span class="ident" id="5769228">fmt</span><span class="op" id="5769231">.</span><span class="ident" id="5769232">Sprintf</span><span class="op" id="5769239">(</span><span class="string" id="5769240">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="5769282">,</span>&nbsp;<span class="ident" id="5769284">callType</span><span class="op" id="5769292">)</span><span class="op" id="5769293">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769299">return</span>&nbsp;<span class="ident" id="5769306">nil</span><br>
<span class="lineno"></span><span class="op" id="5769310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5769313">func</span>&nbsp;<span class="op" id="5769318">(</span><span class="ident" id="5769319">p</span>&nbsp;<span class="op" id="5769321">*</span><span class="ident" id="5769322">parser</span><span class="op" id="5769328">)</span>&nbsp;<span class="ident" id="5769330">parseGoStmt</span><span class="op" id="5769341">(</span><span class="op" id="5769342">)</span>&nbsp;<span class="ident" id="5769344">ast</span><span class="op" id="5769347">.</span><span class="ident" id="5769348">Stmt</span>&nbsp;<span class="op" id="5769353">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769356">if</span>&nbsp;<span class="ident" id="5769359">p</span><span class="op" id="5769360">.</span><span class="ident" id="5769361">trace</span>&nbsp;<span class="op" id="5769367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769371">defer</span>&nbsp;<span class="ident" id="5769377">un</span><span class="op" id="5769379">(</span><span class="ident" id="5769380">trace</span><span class="op" id="5769385">(</span><span class="ident" id="5769386">p</span><span class="op" id="5769387">,</span>&nbsp;<span class="string" id="5769389">&#34;GoStmt&#34;</span><span class="op" id="5769397">)</span><span class="op" id="5769398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769405">pos</span>&nbsp;<span class="op" id="5769409">:=</span>&nbsp;<span class="ident" id="5769412">p</span><span class="op" id="5769413">.</span><span class="ident" id="5769414">expect</span><span class="op" id="5769420">(</span><span class="ident" id="5769421">token</span><span class="op" id="5769426">.</span><span class="ident" id="5769427">GO</span><span class="op" id="5769429">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769432">call</span>&nbsp;<span class="op" id="5769437">:=</span>&nbsp;<span class="ident" id="5769440">p</span><span class="op" id="5769441">.</span><span class="ident" id="5769442">parseCallExpr</span><span class="op" id="5769455">(</span><span class="string" id="5769456">&#34;go&#34;</span><span class="op" id="5769460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769463">p</span><span class="op" id="5769464">.</span><span class="ident" id="5769465">expectSemi</span><span class="op" id="5769475">(</span><span class="op" id="5769476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769479">if</span>&nbsp;<span class="ident" id="5769482">call</span>&nbsp;<span class="op" id="5769487">==</span>&nbsp;<span class="ident" id="5769490">nil</span>&nbsp;<span class="op" id="5769494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769498">return</span>&nbsp;<span class="op" id="5769505">&amp;</span><span class="ident" id="5769506">ast</span><span class="op" id="5769509">.</span><span class="ident" id="5769510">BadStmt</span><span class="op" id="5769517">{</span><span class="ident" id="5769518">From</span><span class="op" id="5769522">:</span>&nbsp;<span class="ident" id="5769524">pos</span><span class="op" id="5769527">,</span>&nbsp;<span class="ident" id="5769529">To</span><span class="op" id="5769531">:</span>&nbsp;<span class="ident" id="5769533">pos</span>&nbsp;<span class="op" id="5769537">+</span>&nbsp;<span class="num" id="5769539">2</span><span class="op" id="5769540">}</span>&nbsp;<span class="comment" id="5769542">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769556">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769560">return</span>&nbsp;<span class="op" id="5769567">&amp;</span><span class="ident" id="5769568">ast</span><span class="op" id="5769571">.</span><span class="ident" id="5769572">GoStmt</span><span class="op" id="5769578">{</span><span class="ident" id="5769579">Go</span><span class="op" id="5769581">:</span>&nbsp;<span class="ident" id="5769583">pos</span><span class="op" id="5769586">,</span>&nbsp;<span class="ident" id="5769588">Call</span><span class="op" id="5769592">:</span>&nbsp;<span class="ident" id="5769594">call</span><span class="op" id="5769598">}</span><br>
<span class="lineno"></span><span class="op" id="5769600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5769603">func</span>&nbsp;<span class="op" id="5769608">(</span><span class="ident" id="5769609">p</span>&nbsp;<span class="op" id="5769611">*</span><span class="ident" id="5769612">parser</span><span class="op" id="5769618">)</span>&nbsp;<span class="ident" id="5769620">parseDeferStmt</span><span class="op" id="5769634">(</span><span class="op" id="5769635">)</span>&nbsp;<span class="ident" id="5769637">ast</span><span class="op" id="5769640">.</span><span class="ident" id="5769641">Stmt</span>&nbsp;<span class="op" id="5769646">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769649">if</span>&nbsp;<span class="ident" id="5769652">p</span><span class="op" id="5769653">.</span><span class="ident" id="5769654">trace</span>&nbsp;<span class="op" id="5769660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769664">defer</span>&nbsp;<span class="ident" id="5769670">un</span><span class="op" id="5769672">(</span><span class="ident" id="5769673">trace</span><span class="op" id="5769678">(</span><span class="ident" id="5769679">p</span><span class="op" id="5769680">,</span>&nbsp;<span class="string" id="5769682">&#34;DeferStmt&#34;</span><span class="op" id="5769693">)</span><span class="op" id="5769694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769701">pos</span>&nbsp;<span class="op" id="5769705">:=</span>&nbsp;<span class="ident" id="5769708">p</span><span class="op" id="5769709">.</span><span class="ident" id="5769710">expect</span><span class="op" id="5769716">(</span><span class="ident" id="5769717">token</span><span class="op" id="5769722">.</span><span class="ident" id="5769723">DEFER</span><span class="op" id="5769728">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769731">call</span>&nbsp;<span class="op" id="5769736">:=</span>&nbsp;<span class="ident" id="5769739">p</span><span class="op" id="5769740">.</span><span class="ident" id="5769741">parseCallExpr</span><span class="op" id="5769754">(</span><span class="string" id="5769755">&#34;defer&#34;</span><span class="op" id="5769762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769765">p</span><span class="op" id="5769766">.</span><span class="ident" id="5769767">expectSemi</span><span class="op" id="5769777">(</span><span class="op" id="5769778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769781">if</span>&nbsp;<span class="ident" id="5769784">call</span>&nbsp;<span class="op" id="5769789">==</span>&nbsp;<span class="ident" id="5769792">nil</span>&nbsp;<span class="op" id="5769796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769800">return</span>&nbsp;<span class="op" id="5769807">&amp;</span><span class="ident" id="5769808">ast</span><span class="op" id="5769811">.</span><span class="ident" id="5769812">BadStmt</span><span class="op" id="5769819">{</span><span class="ident" id="5769820">From</span><span class="op" id="5769824">:</span>&nbsp;<span class="ident" id="5769826">pos</span><span class="op" id="5769829">,</span>&nbsp;<span class="ident" id="5769831">To</span><span class="op" id="5769833">:</span>&nbsp;<span class="ident" id="5769835">pos</span>&nbsp;<span class="op" id="5769839">+</span>&nbsp;<span class="num" id="5769841">5</span><span class="op" id="5769842">}</span>&nbsp;<span class="comment" id="5769844">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769861">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769865">return</span>&nbsp;<span class="op" id="5769872">&amp;</span><span class="ident" id="5769873">ast</span><span class="op" id="5769876">.</span><span class="ident" id="5769877">DeferStmt</span><span class="op" id="5769886">{</span><span class="ident" id="5769887">Defer</span><span class="op" id="5769892">:</span>&nbsp;<span class="ident" id="5769894">pos</span><span class="op" id="5769897">,</span>&nbsp;<span class="ident" id="5769899">Call</span><span class="op" id="5769903">:</span>&nbsp;<span class="ident" id="5769905">call</span><span class="op" id="5769909">}</span><br>
<span class="lineno"></span><span class="op" id="5769911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5769914">func</span>&nbsp;<span class="op" id="5769919">(</span><span class="ident" id="5769920">p</span>&nbsp;<span class="op" id="5769922">*</span><span class="ident" id="5769923">parser</span><span class="op" id="5769929">)</span>&nbsp;<span class="ident" id="5769931">parseReturnStmt</span><span class="op" id="5769946">(</span><span class="op" id="5769947">)</span>&nbsp;<span class="op" id="5769949">*</span><span class="ident" id="5769950">ast</span><span class="op" id="5769953">.</span><span class="ident" id="5769954">ReturnStmt</span>&nbsp;<span class="op" id="5769965">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769968">if</span>&nbsp;<span class="ident" id="5769971">p</span><span class="op" id="5769972">.</span><span class="ident" id="5769973">trace</span>&nbsp;<span class="op" id="5769979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769983">defer</span>&nbsp;<span class="ident" id="5769989">un</span><span class="op" id="5769991">(</span><span class="ident" id="5769992">trace</span><span class="op" id="5769997">(</span><span class="ident" id="5769998">p</span><span class="op" id="5769999">,</span>&nbsp;<span class="string" id="5770001">&#34;ReturnStmt&#34;</span><span class="op" id="5770013">)</span><span class="op" id="5770014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770021">pos</span>&nbsp;<span class="op" id="5770025">:=</span>&nbsp;<span class="ident" id="5770028">p</span><span class="op" id="5770029">.</span><span class="ident" id="5770030">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770035">p</span><span class="op" id="5770036">.</span><span class="ident" id="5770037">expect</span><span class="op" id="5770043">(</span><span class="ident" id="5770044">token</span><span class="op" id="5770049">.</span><span class="ident" id="5770050">RETURN</span><span class="op" id="5770056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770059">var</span>&nbsp;<span class="ident" id="5770063">x</span>&nbsp;<span class="op" id="5770065">[</span><span class="op" id="5770066">]</span><span class="ident" id="5770067">ast</span><span class="op" id="5770070">.</span><span class="ident" id="5770071">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770077">if</span>&nbsp;<span class="ident" id="5770080">p</span><span class="op" id="5770081">.</span><span class="ident" id="5770082">tok</span>&nbsp;<span class="op" id="5770086">!=</span>&nbsp;<span class="ident" id="5770089">token</span><span class="op" id="5770094">.</span><span class="ident" id="5770095">SEMICOLON</span>&nbsp;<span class="op" id="5770105">&amp;&amp;</span>&nbsp;<span class="ident" id="5770108">p</span><span class="op" id="5770109">.</span><span class="ident" id="5770110">tok</span>&nbsp;<span class="op" id="5770114">!=</span>&nbsp;<span class="ident" id="5770117">token</span><span class="op" id="5770122">.</span><span class="ident" id="5770123">RBRACE</span>&nbsp;<span class="op" id="5770130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770134">x</span>&nbsp;<span class="op" id="5770136">=</span>&nbsp;<span class="ident" id="5770138">p</span><span class="op" id="5770139">.</span><span class="ident" id="5770140">parseRhsList</span><span class="op" id="5770152">(</span><span class="op" id="5770153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770156">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770159">p</span><span class="op" id="5770160">.</span><span class="ident" id="5770161">expectSemi</span><span class="op" id="5770171">(</span><span class="op" id="5770172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770176">return</span>&nbsp;<span class="op" id="5770183">&amp;</span><span class="ident" id="5770184">ast</span><span class="op" id="5770187">.</span><span class="ident" id="5770188">ReturnStmt</span><span class="op" id="5770198">{</span><span class="ident" id="5770199">Return</span><span class="op" id="5770205">:</span>&nbsp;<span class="ident" id="5770207">pos</span><span class="op" id="5770210">,</span>&nbsp;<span class="ident" id="5770212">Results</span><span class="op" id="5770219">:</span>&nbsp;<span class="ident" id="5770221">x</span><span class="op" id="5770222">}</span><br>
<span class="lineno"></span><span class="op" id="5770224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="5770227">func</span>&nbsp;<span class="op" id="5770232">(</span><span class="ident" id="5770233">p</span>&nbsp;<span class="op" id="5770235">*</span><span class="ident" id="5770236">parser</span><span class="op" id="5770242">)</span>&nbsp;<span class="ident" id="5770244">parseBranchStmt</span><span class="op" id="5770259">(</span><span class="ident" id="5770260">tok</span>&nbsp;<span class="ident" id="5770264">token</span><span class="op" id="5770269">.</span><span class="ident" id="5770270">Token</span><span class="op" id="5770275">)</span>&nbsp;<span class="op" id="5770277">*</span><span class="ident" id="5770278">ast</span><span class="op" id="5770281">.</span><span class="ident" id="5770282">BranchStmt</span>&nbsp;<span class="op" id="5770293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770296">if</span>&nbsp;<span class="ident" id="5770299">p</span><span class="op" id="5770300">.</span><span class="ident" id="5770301">trace</span>&nbsp;<span class="op" id="5770307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770311">defer</span>&nbsp;<span class="ident" id="5770317">un</span><span class="op" id="5770319">(</span><span class="ident" id="5770320">trace</span><span class="op" id="5770325">(</span><span class="ident" id="5770326">p</span><span class="op" id="5770327">,</span>&nbsp;<span class="string" id="5770329">&#34;BranchStmt&#34;</span><span class="op" id="5770341">)</span><span class="op" id="5770342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770349">pos</span>&nbsp;<span class="op" id="5770353">:=</span>&nbsp;<span class="ident" id="5770356">p</span><span class="op" id="5770357">.</span><span class="ident" id="5770358">expect</span><span class="op" id="5770364">(</span><span class="ident" id="5770365">tok</span><span class="op" id="5770368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770371">var</span>&nbsp;<span class="ident" id="5770375">label</span>&nbsp;<span class="op" id="5770381">*</span><span class="ident" id="5770382">ast</span><span class="op" id="5770385">.</span><span class="ident" id="5770386">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770393">if</span>&nbsp;<span class="ident" id="5770396">tok</span>&nbsp;<span class="op" id="5770400">!=</span>&nbsp;<span class="ident" id="5770403">token</span><span class="op" id="5770408">.</span><span class="ident" id="5770409">FALLTHROUGH</span>&nbsp;<span class="op" id="5770421">&amp;&amp;</span>&nbsp;<span class="ident" id="5770424">p</span><span class="op" id="5770425">.</span><span class="ident" id="5770426">tok</span>&nbsp;<span class="op" id="5770430">==</span>&nbsp;<span class="ident" id="5770433">token</span><span class="op" id="5770438">.</span><span class="ident" id="5770439">IDENT</span>&nbsp;<span class="op" id="5770445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770449">label</span>&nbsp;<span class="op" id="5770455">=</span>&nbsp;<span class="ident" id="5770457">p</span><span class="op" id="5770458">.</span><span class="ident" id="5770459">parseIdent</span><span class="op" id="5770469">(</span><span class="op" id="5770470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770474">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770513">n</span>&nbsp;<span class="op" id="5770515">:=</span>&nbsp;<span class="builtinfunc" id="5770518">len</span><span class="op" id="5770521">(</span><span class="ident" id="5770522">p</span><span class="op" id="5770523">.</span><span class="ident" id="5770524">targetStack</span><span class="op" id="5770535">)</span>&nbsp;<span class="op" id="5770537">-</span>&nbsp;<span class="num" id="5770539">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770543">p</span><span class="op" id="5770544">.</span><span class="ident" id="5770545">targetStack</span><span class="op" id="5770556">[</span><span class="ident" id="5770557">n</span><span class="op" id="5770558">]</span>&nbsp;<span class="op" id="5770560">=</span>&nbsp;<span class="builtinfunc" id="5770562">append</span><span class="op" id="5770568">(</span><span class="ident" id="5770569">p</span><span class="op" id="5770570">.</span><span class="ident" id="5770571">targetStack</span><span class="op" id="5770582">[</span><span class="ident" id="5770583">n</span><span class="op" id="5770584">]</span><span class="op" id="5770585">,</span>&nbsp;<span class="ident" id="5770587">label</span><span class="op" id="5770592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770598">p</span><span class="op" id="5770599">.</span><span class="ident" id="5770600">expectSemi</span><span class="op" id="5770610">(</span><span class="op" id="5770611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770615">return</span>&nbsp;<span class="op" id="5770622">&amp;</span><span class="ident" id="5770623">ast</span><span class="op" id="5770626">.</span><span class="ident" id="5770627">BranchStmt</span><span class="op" id="5770637">{</span><span class="ident" id="5770638">TokPos</span><span class="op" id="5770644">:</span>&nbsp;<span class="ident" id="5770646">pos</span><span class="op" id="5770649">,</span>&nbsp;<span class="ident" id="5770651">Tok</span><span class="op" id="5770654">:</span>&nbsp;<span class="ident" id="5770656">tok</span><span class="op" id="5770659">,</span>&nbsp;<span class="ident" id="5770661">Label</span><span class="op" id="5770666">:</span>&nbsp;<span class="ident" id="5770668">label</span><span class="op" id="5770673">}</span><br>
<span class="lineno"></span><span class="op" id="5770675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5770678">func</span>&nbsp;<span class="op" id="5770683">(</span><span class="ident" id="5770684">p</span>&nbsp;<span class="op" id="5770686">*</span><span class="ident" id="5770687">parser</span><span class="op" id="5770693">)</span>&nbsp;<span class="ident" id="5770695">makeExpr</span><span class="op" id="5770703">(</span><span class="ident" id="5770704">s</span>&nbsp;<span class="ident" id="5770706">ast</span><span class="op" id="5770709">.</span><span class="ident" id="5770710">Stmt</span><span class="op" id="5770714">,</span>&nbsp;<span class="ident" id="5770716">kind</span>&nbsp;<span class="builtintype" id="5770721">string</span><span class="op" id="5770727">)</span>&nbsp;<span class="ident" id="5770729">ast</span><span class="op" id="5770732">.</span><span class="ident" id="5770733">Expr</span>&nbsp;<span class="op" id="5770738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770741">if</span>&nbsp;<span class="ident" id="5770744">s</span>&nbsp;<span class="op" id="5770746">==</span>&nbsp;<span class="ident" id="5770749">nil</span>&nbsp;<span class="op" id="5770753">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770757">return</span>&nbsp;<span class="ident" id="5770764">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770772">if</span>&nbsp;<span class="ident" id="5770775">es</span><span class="op" id="5770777">,</span>&nbsp;<span class="ident" id="5770779">isExpr</span>&nbsp;<span class="op" id="5770786">:=</span>&nbsp;<span class="ident" id="5770789">s</span><span class="op" id="5770790">.</span><span class="op" id="5770791">(</span><span class="op" id="5770792">*</span><span class="ident" id="5770793">ast</span><span class="op" id="5770796">.</span><span class="ident" id="5770797">ExprStmt</span><span class="op" id="5770805">)</span><span class="op" id="5770806">;</span>&nbsp;<span class="ident" id="5770808">isExpr</span>&nbsp;<span class="op" id="5770815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770819">return</span>&nbsp;<span class="ident" id="5770826">p</span><span class="op" id="5770827">.</span><span class="ident" id="5770828">checkExpr</span><span class="op" id="5770837">(</span><span class="ident" id="5770838">es</span><span class="op" id="5770840">.</span><span class="ident" id="5770841">X</span><span class="op" id="5770842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770845">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770848">p</span><span class="op" id="5770849">.</span><span class="builtintype" id="5770850">error</span><span class="op" id="5770855">(</span><span class="ident" id="5770856">s</span><span class="op" id="5770857">.</span><span class="ident" id="5770858">Pos</span><span class="op" id="5770861">(</span><span class="op" id="5770862">)</span><span class="op" id="5770863">,</span>&nbsp;<span class="ident" id="5770865">fmt</span><span class="op" id="5770868">.</span><span class="ident" id="5770869">Sprintf</span><span class="op" id="5770876">(</span><span class="string" id="5770877">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="5770962">,</span>&nbsp;<span class="ident" id="5770964">kind</span><span class="op" id="5770968">)</span><span class="op" id="5770969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770972">return</span>&nbsp;<span class="op" id="5770979">&amp;</span><span class="ident" id="5770980">ast</span><span class="op" id="5770983">.</span><span class="ident" id="5770984">BadExpr</span><span class="op" id="5770991">{</span><span class="ident" id="5770992">From</span><span class="op" id="5770996">:</span>&nbsp;<span class="ident" id="5770998">s</span><span class="op" id="5770999">.</span><span class="ident" id="5771000">Pos</span><span class="op" id="5771003">(</span><span class="op" id="5771004">)</span><span class="op" id="5771005">,</span>&nbsp;<span class="ident" id="5771007">To</span><span class="op" id="5771009">:</span>&nbsp;<span class="ident" id="5771011">p</span><span class="op" id="5771012">.</span><span class="ident" id="5771013">safePos</span><span class="op" id="5771020">(</span><span class="ident" id="5771021">s</span><span class="op" id="5771022">.</span><span class="ident" id="5771023">End</span><span class="op" id="5771026">(</span><span class="op" id="5771027">)</span><span class="op" id="5771028">)</span><span class="op" id="5771029">}</span><br>
<span class="lineno"></span><span class="op" id="5771031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5771034">func</span>&nbsp;<span class="op" id="5771039">(</span><span class="ident" id="5771040">p</span>&nbsp;<span class="op" id="5771042">*</span><span class="ident" id="5771043">parser</span><span class="op" id="5771049">)</span>&nbsp;<span class="ident" id="5771051">parseIfStmt</span><span class="op" id="5771062">(</span><span class="op" id="5771063">)</span>&nbsp;<span class="op" id="5771065">*</span><span class="ident" id="5771066">ast</span><span class="op" id="5771069">.</span><span class="ident" id="5771070">IfStmt</span>&nbsp;<span class="op" id="5771077">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771080">if</span>&nbsp;<span class="ident" id="5771083">p</span><span class="op" id="5771084">.</span><span class="ident" id="5771085">trace</span>&nbsp;<span class="op" id="5771091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771095">defer</span>&nbsp;<span class="ident" id="5771101">un</span><span class="op" id="5771103">(</span><span class="ident" id="5771104">trace</span><span class="op" id="5771109">(</span><span class="ident" id="5771110">p</span><span class="op" id="5771111">,</span>&nbsp;<span class="string" id="5771113">&#34;IfStmt&#34;</span><span class="op" id="5771121">)</span><span class="op" id="5771122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771129">pos</span>&nbsp;<span class="op" id="5771133">:=</span>&nbsp;<span class="ident" id="5771136">p</span><span class="op" id="5771137">.</span><span class="ident" id="5771138">expect</span><span class="op" id="5771144">(</span><span class="ident" id="5771145">token</span><span class="op" id="5771150">.</span><span class="ident" id="5771151">IF</span><span class="op" id="5771153">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771156">p</span><span class="op" id="5771157">.</span><span class="ident" id="5771158">openScope</span><span class="op" id="5771167">(</span><span class="op" id="5771168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771171">defer</span>&nbsp;<span class="ident" id="5771177">p</span><span class="op" id="5771178">.</span><span class="ident" id="5771179">closeScope</span><span class="op" id="5771189">(</span><span class="op" id="5771190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771194">var</span>&nbsp;<span class="ident" id="5771198">s</span>&nbsp;<span class="ident" id="5771200">ast</span><span class="op" id="5771203">.</span><span class="ident" id="5771204">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771210">var</span>&nbsp;<span class="ident" id="5771214">x</span>&nbsp;<span class="ident" id="5771216">ast</span><span class="op" id="5771219">.</span><span class="ident" id="5771220">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771230">prevLev</span>&nbsp;<span class="op" id="5771238">:=</span>&nbsp;<span class="ident" id="5771241">p</span><span class="op" id="5771242">.</span><span class="ident" id="5771243">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771253">p</span><span class="op" id="5771254">.</span><span class="ident" id="5771255">exprLev</span>&nbsp;<span class="op" id="5771263">=</span>&nbsp;<span class="op" id="5771265">-</span><span class="num" id="5771266">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771270">if</span>&nbsp;<span class="ident" id="5771273">p</span><span class="op" id="5771274">.</span><span class="ident" id="5771275">tok</span>&nbsp;<span class="op" id="5771279">==</span>&nbsp;<span class="ident" id="5771282">token</span><span class="op" id="5771287">.</span><span class="ident" id="5771288">SEMICOLON</span>&nbsp;<span class="op" id="5771298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771303">p</span><span class="op" id="5771304">.</span><span class="ident" id="5771305">next</span><span class="op" id="5771309">(</span><span class="op" id="5771310">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771315">x</span>&nbsp;<span class="op" id="5771317">=</span>&nbsp;<span class="ident" id="5771319">p</span><span class="op" id="5771320">.</span><span class="ident" id="5771321">parseRhs</span><span class="op" id="5771329">(</span><span class="op" id="5771330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771334">}</span>&nbsp;<span class="keyword" id="5771336">else</span>&nbsp;<span class="op" id="5771341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771346">s</span><span class="op" id="5771347">,</span>&nbsp;<span class="ident" id="5771349">_</span>&nbsp;<span class="op" id="5771351">=</span>&nbsp;<span class="ident" id="5771353">p</span><span class="op" id="5771354">.</span><span class="ident" id="5771355">parseSimpleStmt</span><span class="op" id="5771370">(</span><span class="ident" id="5771371">basic</span><span class="op" id="5771376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771381">if</span>&nbsp;<span class="ident" id="5771384">p</span><span class="op" id="5771385">.</span><span class="ident" id="5771386">tok</span>&nbsp;<span class="op" id="5771390">==</span>&nbsp;<span class="ident" id="5771393">token</span><span class="op" id="5771398">.</span><span class="ident" id="5771399">SEMICOLON</span>&nbsp;<span class="op" id="5771409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771415">p</span><span class="op" id="5771416">.</span><span class="ident" id="5771417">next</span><span class="op" id="5771421">(</span><span class="op" id="5771422">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771428">x</span>&nbsp;<span class="op" id="5771430">=</span>&nbsp;<span class="ident" id="5771432">p</span><span class="op" id="5771433">.</span><span class="ident" id="5771434">parseRhs</span><span class="op" id="5771442">(</span><span class="op" id="5771443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771448">}</span>&nbsp;<span class="keyword" id="5771450">else</span>&nbsp;<span class="op" id="5771455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771461">x</span>&nbsp;<span class="op" id="5771463">=</span>&nbsp;<span class="ident" id="5771465">p</span><span class="op" id="5771466">.</span><span class="ident" id="5771467">makeExpr</span><span class="op" id="5771475">(</span><span class="ident" id="5771476">s</span><span class="op" id="5771477">,</span>&nbsp;<span class="string" id="5771479">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="5771499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771505">s</span>&nbsp;<span class="op" id="5771507">=</span>&nbsp;<span class="ident" id="5771509">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771516">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771524">p</span><span class="op" id="5771525">.</span><span class="ident" id="5771526">exprLev</span>&nbsp;<span class="op" id="5771534">=</span>&nbsp;<span class="ident" id="5771536">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771549">body</span>&nbsp;<span class="op" id="5771554">:=</span>&nbsp;<span class="ident" id="5771557">p</span><span class="op" id="5771558">.</span><span class="ident" id="5771559">parseBlockStmt</span><span class="op" id="5771573">(</span><span class="op" id="5771574">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771577">var</span>&nbsp;<span class="ident" id="5771581">else_</span>&nbsp;<span class="ident" id="5771587">ast</span><span class="op" id="5771590">.</span><span class="ident" id="5771591">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771597">if</span>&nbsp;<span class="ident" id="5771600">p</span><span class="op" id="5771601">.</span><span class="ident" id="5771602">tok</span>&nbsp;<span class="op" id="5771606">==</span>&nbsp;<span class="ident" id="5771609">token</span><span class="op" id="5771614">.</span><span class="ident" id="5771615">ELSE</span>&nbsp;<span class="op" id="5771620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771624">p</span><span class="op" id="5771625">.</span><span class="ident" id="5771626">next</span><span class="op" id="5771630">(</span><span class="op" id="5771631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771635">else_</span>&nbsp;<span class="op" id="5771641">=</span>&nbsp;<span class="ident" id="5771643">p</span><span class="op" id="5771644">.</span><span class="ident" id="5771645">parseStmt</span><span class="op" id="5771654">(</span><span class="op" id="5771655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771658">}</span>&nbsp;<span class="keyword" id="5771660">else</span>&nbsp;<span class="op" id="5771665">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771669">p</span><span class="op" id="5771670">.</span><span class="ident" id="5771671">expectSemi</span><span class="op" id="5771681">(</span><span class="op" id="5771682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771689">return</span>&nbsp;<span class="op" id="5771696">&amp;</span><span class="ident" id="5771697">ast</span><span class="op" id="5771700">.</span><span class="ident" id="5771701">IfStmt</span><span class="op" id="5771707">{</span><span class="ident" id="5771708">If</span><span class="op" id="5771710">:</span>&nbsp;<span class="ident" id="5771712">pos</span><span class="op" id="5771715">,</span>&nbsp;<span class="ident" id="5771717">Init</span><span class="op" id="5771721">:</span>&nbsp;<span class="ident" id="5771723">s</span><span class="op" id="5771724">,</span>&nbsp;<span class="ident" id="5771726">Cond</span><span class="op" id="5771730">:</span>&nbsp;<span class="ident" id="5771732">x</span><span class="op" id="5771733">,</span>&nbsp;<span class="ident" id="5771735">Body</span><span class="op" id="5771739">:</span>&nbsp;<span class="ident" id="5771741">body</span><span class="op" id="5771745">,</span>&nbsp;<span class="ident" id="5771747">Else</span><span class="op" id="5771751">:</span>&nbsp;<span class="ident" id="5771753">else_</span><span class="op" id="5771758">}</span><br>
<span class="lineno"></span><span class="op" id="5771760">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="5771763">func</span>&nbsp;<span class="op" id="5771768">(</span><span class="ident" id="5771769">p</span>&nbsp;<span class="op" id="5771771">*</span><span class="ident" id="5771772">parser</span><span class="op" id="5771778">)</span>&nbsp;<span class="ident" id="5771780">parseTypeList</span><span class="op" id="5771793">(</span><span class="op" id="5771794">)</span>&nbsp;<span class="op" id="5771796">(</span><span class="ident" id="5771797">list</span>&nbsp;<span class="op" id="5771802">[</span><span class="op" id="5771803">]</span><span class="ident" id="5771804">ast</span><span class="op" id="5771807">.</span><span class="ident" id="5771808">Expr</span><span class="op" id="5771812">)</span>&nbsp;<span class="op" id="5771814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771817">if</span>&nbsp;<span class="ident" id="5771820">p</span><span class="op" id="5771821">.</span><span class="ident" id="5771822">trace</span>&nbsp;<span class="op" id="5771828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771832">defer</span>&nbsp;<span class="ident" id="5771838">un</span><span class="op" id="5771840">(</span><span class="ident" id="5771841">trace</span><span class="op" id="5771846">(</span><span class="ident" id="5771847">p</span><span class="op" id="5771848">,</span>&nbsp;<span class="string" id="5771850">&#34;TypeList&#34;</span><span class="op" id="5771860">)</span><span class="op" id="5771861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771864">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771868">list</span>&nbsp;<span class="op" id="5771873">=</span>&nbsp;<span class="builtinfunc" id="5771875">append</span><span class="op" id="5771881">(</span><span class="ident" id="5771882">list</span><span class="op" id="5771886">,</span>&nbsp;<span class="ident" id="5771888">p</span><span class="op" id="5771889">.</span><span class="ident" id="5771890">parseType</span><span class="op" id="5771899">(</span><span class="op" id="5771900">)</span><span class="op" id="5771901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771904">for</span>&nbsp;<span class="ident" id="5771908">p</span><span class="op" id="5771909">.</span><span class="ident" id="5771910">tok</span>&nbsp;<span class="op" id="5771914">==</span>&nbsp;<span class="ident" id="5771917">token</span><span class="op" id="5771922">.</span><span class="ident" id="5771923">COMMA</span>&nbsp;<span class="op" id="5771929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771933">p</span><span class="op" id="5771934">.</span><span class="ident" id="5771935">next</span><span class="op" id="5771939">(</span><span class="op" id="5771940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771944">list</span>&nbsp;<span class="op" id="5771949">=</span>&nbsp;<span class="builtinfunc" id="5771951">append</span><span class="op" id="5771957">(</span><span class="ident" id="5771958">list</span><span class="op" id="5771962">,</span>&nbsp;<span class="ident" id="5771964">p</span><span class="op" id="5771965">.</span><span class="ident" id="5771966">parseType</span><span class="op" id="5771975">(</span><span class="op" id="5771976">)</span><span class="op" id="5771977">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771984">return</span><br>
<span class="lineno"></span><span class="op" id="5771991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="5771994">func</span>&nbsp;<span class="op" id="5771999">(</span><span class="ident" id="5772000">p</span>&nbsp;<span class="op" id="5772002">*</span><span class="ident" id="5772003">parser</span><span class="op" id="5772009">)</span>&nbsp;<span class="ident" id="5772011">parseCaseClause</span><span class="op" id="5772026">(</span><span class="ident" id="5772027">typeSwitch</span>&nbsp;<span class="builtintype" id="5772038">bool</span><span class="op" id="5772042">)</span>&nbsp;<span class="op" id="5772044">*</span><span class="ident" id="5772045">ast</span><span class="op" id="5772048">.</span><span class="ident" id="5772049">CaseClause</span>&nbsp;<span class="op" id="5772060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772063">if</span>&nbsp;<span class="ident" id="5772066">p</span><span class="op" id="5772067">.</span><span class="ident" id="5772068">trace</span>&nbsp;<span class="op" id="5772074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772078">defer</span>&nbsp;<span class="ident" id="5772084">un</span><span class="op" id="5772086">(</span><span class="ident" id="5772087">trace</span><span class="op" id="5772092">(</span><span class="ident" id="5772093">p</span><span class="op" id="5772094">,</span>&nbsp;<span class="string" id="5772096">&#34;CaseClause&#34;</span><span class="op" id="5772108">)</span><span class="op" id="5772109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772116">pos</span>&nbsp;<span class="op" id="5772120">:=</span>&nbsp;<span class="ident" id="5772123">p</span><span class="op" id="5772124">.</span><span class="ident" id="5772125">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772130">var</span>&nbsp;<span class="ident" id="5772134">list</span>&nbsp;<span class="op" id="5772139">[</span><span class="op" id="5772140">]</span><span class="ident" id="5772141">ast</span><span class="op" id="5772144">.</span><span class="ident" id="5772145">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772151">if</span>&nbsp;<span class="ident" id="5772154">p</span><span class="op" id="5772155">.</span><span class="ident" id="5772156">tok</span>&nbsp;<span class="op" id="5772160">==</span>&nbsp;<span class="ident" id="5772163">token</span><span class="op" id="5772168">.</span><span class="ident" id="5772169">CASE</span>&nbsp;<span class="op" id="5772174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772178">p</span><span class="op" id="5772179">.</span><span class="ident" id="5772180">next</span><span class="op" id="5772184">(</span><span class="op" id="5772185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772189">if</span>&nbsp;<span class="ident" id="5772192">typeSwitch</span>&nbsp;<span class="op" id="5772203">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772208">list</span>&nbsp;<span class="op" id="5772213">=</span>&nbsp;<span class="ident" id="5772215">p</span><span class="op" id="5772216">.</span><span class="ident" id="5772217">parseTypeList</span><span class="op" id="5772230">(</span><span class="op" id="5772231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772235">}</span>&nbsp;<span class="keyword" id="5772237">else</span>&nbsp;<span class="op" id="5772242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772247">list</span>&nbsp;<span class="op" id="5772252">=</span>&nbsp;<span class="ident" id="5772254">p</span><span class="op" id="5772255">.</span><span class="ident" id="5772256">parseRhsList</span><span class="op" id="5772268">(</span><span class="op" id="5772269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772276">}</span>&nbsp;<span class="keyword" id="5772278">else</span>&nbsp;<span class="op" id="5772283">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772287">p</span><span class="op" id="5772288">.</span><span class="ident" id="5772289">expect</span><span class="op" id="5772295">(</span><span class="ident" id="5772296">token</span><span class="op" id="5772301">.</span><span class="ident" id="5772302">DEFAULT</span><span class="op" id="5772309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772316">colon</span>&nbsp;<span class="op" id="5772322">:=</span>&nbsp;<span class="ident" id="5772325">p</span><span class="op" id="5772326">.</span><span class="ident" id="5772327">expect</span><span class="op" id="5772333">(</span><span class="ident" id="5772334">token</span><span class="op" id="5772339">.</span><span class="ident" id="5772340">COLON</span><span class="op" id="5772345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772348">p</span><span class="op" id="5772349">.</span><span class="ident" id="5772350">openScope</span><span class="op" id="5772359">(</span><span class="op" id="5772360">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772363">body</span>&nbsp;<span class="op" id="5772368">:=</span>&nbsp;<span class="ident" id="5772371">p</span><span class="op" id="5772372">.</span><span class="ident" id="5772373">parseStmtList</span><span class="op" id="5772386">(</span><span class="op" id="5772387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772390">p</span><span class="op" id="5772391">.</span><span class="ident" id="5772392">closeScope</span><span class="op" id="5772402">(</span><span class="op" id="5772403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772407">return</span>&nbsp;<span class="op" id="5772414">&amp;</span><span class="ident" id="5772415">ast</span><span class="op" id="5772418">.</span><span class="ident" id="5772419">CaseClause</span><span class="op" id="5772429">{</span><span class="ident" id="5772430">Case</span><span class="op" id="5772434">:</span>&nbsp;<span class="ident" id="5772436">pos</span><span class="op" id="5772439">,</span>&nbsp;<span class="ident" id="5772441">List</span><span class="op" id="5772445">:</span>&nbsp;<span class="ident" id="5772447">list</span><span class="op" id="5772451">,</span>&nbsp;<span class="ident" id="5772453">Colon</span><span class="op" id="5772458">:</span>&nbsp;<span class="ident" id="5772460">colon</span><span class="op" id="5772465">,</span>&nbsp;<span class="ident" id="5772467">Body</span><span class="op" id="5772471">:</span>&nbsp;<span class="ident" id="5772473">body</span><span class="op" id="5772477">}</span><br>
<span class="lineno"></span><span class="op" id="5772479">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="5772482">func</span>&nbsp;<span class="ident" id="5772487">isTypeSwitchAssert</span><span class="op" id="5772505">(</span><span class="ident" id="5772506">x</span>&nbsp;<span class="ident" id="5772508">ast</span><span class="op" id="5772511">.</span><span class="ident" id="5772512">Expr</span><span class="op" id="5772516">)</span>&nbsp;<span class="builtintype" id="5772518">bool</span>&nbsp;<span class="op" id="5772523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772526">a</span><span class="op" id="5772527">,</span>&nbsp;<span class="ident" id="5772529">ok</span>&nbsp;<span class="op" id="5772532">:=</span>&nbsp;<span class="ident" id="5772535">x</span><span class="op" id="5772536">.</span><span class="op" id="5772537">(</span><span class="op" id="5772538">*</span><span class="ident" id="5772539">ast</span><span class="op" id="5772542">.</span><span class="ident" id="5772543">TypeAssertExpr</span><span class="op" id="5772557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772560">return</span>&nbsp;<span class="ident" id="5772567">ok</span>&nbsp;<span class="op" id="5772570">&amp;&amp;</span>&nbsp;<span class="ident" id="5772573">a</span><span class="op" id="5772574">.</span><span class="ident" id="5772575">Type</span>&nbsp;<span class="op" id="5772580">==</span>&nbsp;<span class="ident" id="5772583">nil</span><br>
<span class="lineno"></span><span class="op" id="5772587">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="5772590">func</span>&nbsp;<span class="ident" id="5772595">isTypeSwitchGuard</span><span class="op" id="5772612">(</span><span class="ident" id="5772613">s</span>&nbsp;<span class="ident" id="5772615">ast</span><span class="op" id="5772618">.</span><span class="ident" id="5772619">Stmt</span><span class="op" id="5772623">)</span>&nbsp;<span class="builtintype" id="5772625">bool</span>&nbsp;<span class="op" id="5772630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772633">switch</span>&nbsp;<span class="ident" id="5772640">t</span>&nbsp;<span class="op" id="5772642">:=</span>&nbsp;<span class="ident" id="5772645">s</span><span class="op" id="5772646">.</span><span class="op" id="5772647">(</span><span class="keyword" id="5772648">type</span><span class="op" id="5772652">)</span>&nbsp;<span class="op" id="5772654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772657">case</span>&nbsp;<span class="op" id="5772662">*</span><span class="ident" id="5772663">ast</span><span class="op" id="5772666">.</span><span class="ident" id="5772667">ExprStmt</span><span class="op" id="5772675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772679">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772692">return</span>&nbsp;<span class="ident" id="5772699">isTypeSwitchAssert</span><span class="op" id="5772717">(</span><span class="ident" id="5772718">t</span><span class="op" id="5772719">.</span><span class="ident" id="5772720">X</span><span class="op" id="5772721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772724">case</span>&nbsp;<span class="op" id="5772729">*</span><span class="ident" id="5772730">ast</span><span class="op" id="5772733">.</span><span class="ident" id="5772734">AssignStmt</span><span class="op" id="5772744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772748">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772766">return</span>&nbsp;<span class="builtinfunc" id="5772773">len</span><span class="op" id="5772776">(</span><span class="ident" id="5772777">t</span><span class="op" id="5772778">.</span><span class="ident" id="5772779">Lhs</span><span class="op" id="5772782">)</span>&nbsp;<span class="op" id="5772784">==</span>&nbsp;<span class="num" id="5772787">1</span>&nbsp;<span class="op" id="5772789">&amp;&amp;</span>&nbsp;<span class="ident" id="5772792">t</span><span class="op" id="5772793">.</span><span class="ident" id="5772794">Tok</span>&nbsp;<span class="op" id="5772798">==</span>&nbsp;<span class="ident" id="5772801">token</span><span class="op" id="5772806">.</span><span class="ident" id="5772807">DEFINE</span>&nbsp;<span class="op" id="5772814">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5772817">len</span><span class="op" id="5772820">(</span><span class="ident" id="5772821">t</span><span class="op" id="5772822">.</span><span class="ident" id="5772823">Rhs</span><span class="op" id="5772826">)</span>&nbsp;<span class="op" id="5772828">==</span>&nbsp;<span class="num" id="5772831">1</span>&nbsp;<span class="op" id="5772833">&amp;&amp;</span>&nbsp;<span class="ident" id="5772836">isTypeSwitchAssert</span><span class="op" id="5772854">(</span><span class="ident" id="5772855">t</span><span class="op" id="5772856">.</span><span class="ident" id="5772857">Rhs</span><span class="op" id="5772860">[</span><span class="num" id="5772861">0</span><span class="op" id="5772862">]</span><span class="op" id="5772863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772866">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772869">return</span>&nbsp;<span class="builtintype" id="5772876">false</span><br>
<span class="lineno"></span><span class="op" id="5772882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5772885">func</span>&nbsp;<span class="op" id="5772890">(</span><span class="ident" id="5772891">p</span>&nbsp;<span class="op" id="5772893">*</span><span class="ident" id="5772894">parser</span><span class="op" id="5772900">)</span>&nbsp;<span class="ident" id="5772902">parseSwitchStmt</span><span class="op" id="5772917">(</span><span class="op" id="5772918">)</span>&nbsp;<span class="ident" id="5772920">ast</span><span class="op" id="5772923">.</span><span class="ident" id="5772924">Stmt</span>&nbsp;<span class="op" id="5772929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772932">if</span>&nbsp;<span class="ident" id="5772935">p</span><span class="op" id="5772936">.</span><span class="ident" id="5772937">trace</span>&nbsp;<span class="op" id="5772943">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772947">defer</span>&nbsp;<span class="ident" id="5772953">un</span><span class="op" id="5772955">(</span><span class="ident" id="5772956">trace</span><span class="op" id="5772961">(</span><span class="ident" id="5772962">p</span><span class="op" id="5772963">,</span>&nbsp;<span class="string" id="5772965">&#34;SwitchStmt&#34;</span><span class="op" id="5772977">)</span><span class="op" id="5772978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772985">pos</span>&nbsp;<span class="op" id="5772989">:=</span>&nbsp;<span class="ident" id="5772992">p</span><span class="op" id="5772993">.</span><span class="ident" id="5772994">expect</span><span class="op" id="5773000">(</span><span class="ident" id="5773001">token</span><span class="op" id="5773006">.</span><span class="ident" id="5773007">SWITCH</span><span class="op" id="5773013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773016">p</span><span class="op" id="5773017">.</span><span class="ident" id="5773018">openScope</span><span class="op" id="5773027">(</span><span class="op" id="5773028">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773031">defer</span>&nbsp;<span class="ident" id="5773037">p</span><span class="op" id="5773038">.</span><span class="ident" id="5773039">closeScope</span><span class="op" id="5773049">(</span><span class="op" id="5773050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773054">var</span>&nbsp;<span class="ident" id="5773058">s1</span><span class="op" id="5773060">,</span>&nbsp;<span class="ident" id="5773062">s2</span>&nbsp;<span class="ident" id="5773065">ast</span><span class="op" id="5773068">.</span><span class="ident" id="5773069">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773075">if</span>&nbsp;<span class="ident" id="5773078">p</span><span class="op" id="5773079">.</span><span class="ident" id="5773080">tok</span>&nbsp;<span class="op" id="5773084">!=</span>&nbsp;<span class="ident" id="5773087">token</span><span class="op" id="5773092">.</span><span class="ident" id="5773093">LBRACE</span>&nbsp;<span class="op" id="5773100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773104">prevLev</span>&nbsp;<span class="op" id="5773112">:=</span>&nbsp;<span class="ident" id="5773115">p</span><span class="op" id="5773116">.</span><span class="ident" id="5773117">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773127">p</span><span class="op" id="5773128">.</span><span class="ident" id="5773129">exprLev</span>&nbsp;<span class="op" id="5773137">=</span>&nbsp;<span class="op" id="5773139">-</span><span class="num" id="5773140">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773144">if</span>&nbsp;<span class="ident" id="5773147">p</span><span class="op" id="5773148">.</span><span class="ident" id="5773149">tok</span>&nbsp;<span class="op" id="5773153">!=</span>&nbsp;<span class="ident" id="5773156">token</span><span class="op" id="5773161">.</span><span class="ident" id="5773162">SEMICOLON</span>&nbsp;<span class="op" id="5773172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773177">s2</span><span class="op" id="5773179">,</span>&nbsp;<span class="ident" id="5773181">_</span>&nbsp;<span class="op" id="5773183">=</span>&nbsp;<span class="ident" id="5773185">p</span><span class="op" id="5773186">.</span><span class="ident" id="5773187">parseSimpleStmt</span><span class="op" id="5773202">(</span><span class="ident" id="5773203">basic</span><span class="op" id="5773208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773216">if</span>&nbsp;<span class="ident" id="5773219">p</span><span class="op" id="5773220">.</span><span class="ident" id="5773221">tok</span>&nbsp;<span class="op" id="5773225">==</span>&nbsp;<span class="ident" id="5773228">token</span><span class="op" id="5773233">.</span><span class="ident" id="5773234">SEMICOLON</span>&nbsp;<span class="op" id="5773244">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773249">p</span><span class="op" id="5773250">.</span><span class="ident" id="5773251">next</span><span class="op" id="5773255">(</span><span class="op" id="5773256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773261">s1</span>&nbsp;<span class="op" id="5773264">=</span>&nbsp;<span class="ident" id="5773266">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773272">s2</span>&nbsp;<span class="op" id="5773275">=</span>&nbsp;<span class="ident" id="5773277">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773284">if</span>&nbsp;<span class="ident" id="5773287">p</span><span class="op" id="5773288">.</span><span class="ident" id="5773289">tok</span>&nbsp;<span class="op" id="5773293">!=</span>&nbsp;<span class="ident" id="5773296">token</span><span class="op" id="5773301">.</span><span class="ident" id="5773302">LBRACE</span>&nbsp;<span class="op" id="5773309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773315">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773375">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773434">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773494">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773501">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773542">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773549">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773603">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773663">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773718">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773725">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773790">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773854">p</span><span class="op" id="5773855">.</span><span class="ident" id="5773856">openScope</span><span class="op" id="5773865">(</span><span class="op" id="5773866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773872">defer</span>&nbsp;<span class="ident" id="5773878">p</span><span class="op" id="5773879">.</span><span class="ident" id="5773880">closeScope</span><span class="op" id="5773890">(</span><span class="op" id="5773891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773897">s2</span><span class="op" id="5773899">,</span>&nbsp;<span class="ident" id="5773901">_</span>&nbsp;<span class="op" id="5773903">=</span>&nbsp;<span class="ident" id="5773905">p</span><span class="op" id="5773906">.</span><span class="ident" id="5773907">parseSimpleStmt</span><span class="op" id="5773922">(</span><span class="ident" id="5773923">basic</span><span class="op" id="5773928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773933">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773941">p</span><span class="op" id="5773942">.</span><span class="ident" id="5773943">exprLev</span>&nbsp;<span class="op" id="5773951">=</span>&nbsp;<span class="ident" id="5773953">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773966">typeSwitch</span>&nbsp;<span class="op" id="5773977">:=</span>&nbsp;<span class="ident" id="5773980">isTypeSwitchGuard</span><span class="op" id="5773997">(</span><span class="ident" id="5773998">s2</span><span class="op" id="5774000">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774003">lbrace</span>&nbsp;<span class="op" id="5774010">:=</span>&nbsp;<span class="ident" id="5774013">p</span><span class="op" id="5774014">.</span><span class="ident" id="5774015">expect</span><span class="op" id="5774021">(</span><span class="ident" id="5774022">token</span><span class="op" id="5774027">.</span><span class="ident" id="5774028">LBRACE</span><span class="op" id="5774034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774037">var</span>&nbsp;<span class="ident" id="5774041">list</span>&nbsp;<span class="op" id="5774046">[</span><span class="op" id="5774047">]</span><span class="ident" id="5774048">ast</span><span class="op" id="5774051">.</span><span class="ident" id="5774052">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774058">for</span>&nbsp;<span class="ident" id="5774062">p</span><span class="op" id="5774063">.</span><span class="ident" id="5774064">tok</span>&nbsp;<span class="op" id="5774068">==</span>&nbsp;<span class="ident" id="5774071">token</span><span class="op" id="5774076">.</span><span class="ident" id="5774077">CASE</span>&nbsp;<span class="op" id="5774082">||</span>&nbsp;<span class="ident" id="5774085">p</span><span class="op" id="5774086">.</span><span class="ident" id="5774087">tok</span>&nbsp;<span class="op" id="5774091">==</span>&nbsp;<span class="ident" id="5774094">token</span><span class="op" id="5774099">.</span><span class="ident" id="5774100">DEFAULT</span>&nbsp;<span class="op" id="5774108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774112">list</span>&nbsp;<span class="op" id="5774117">=</span>&nbsp;<span class="builtinfunc" id="5774119">append</span><span class="op" id="5774125">(</span><span class="ident" id="5774126">list</span><span class="op" id="5774130">,</span>&nbsp;<span class="ident" id="5774132">p</span><span class="op" id="5774133">.</span><span class="ident" id="5774134">parseCaseClause</span><span class="op" id="5774149">(</span><span class="ident" id="5774150">typeSwitch</span><span class="op" id="5774160">)</span><span class="op" id="5774161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774164">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774167">rbrace</span>&nbsp;<span class="op" id="5774174">:=</span>&nbsp;<span class="ident" id="5774177">p</span><span class="op" id="5774178">.</span><span class="ident" id="5774179">expect</span><span class="op" id="5774185">(</span><span class="ident" id="5774186">token</span><span class="op" id="5774191">.</span><span class="ident" id="5774192">RBRACE</span><span class="op" id="5774198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774201">p</span><span class="op" id="5774202">.</span><span class="ident" id="5774203">expectSemi</span><span class="op" id="5774213">(</span><span class="op" id="5774214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774217">body</span>&nbsp;<span class="op" id="5774222">:=</span>&nbsp;<span class="op" id="5774225">&amp;</span><span class="ident" id="5774226">ast</span><span class="op" id="5774229">.</span><span class="ident" id="5774230">BlockStmt</span><span class="op" id="5774239">{</span><span class="ident" id="5774240">Lbrace</span><span class="op" id="5774246">:</span>&nbsp;<span class="ident" id="5774248">lbrace</span><span class="op" id="5774254">,</span>&nbsp;<span class="ident" id="5774256">List</span><span class="op" id="5774260">:</span>&nbsp;<span class="ident" id="5774262">list</span><span class="op" id="5774266">,</span>&nbsp;<span class="ident" id="5774268">Rbrace</span><span class="op" id="5774274">:</span>&nbsp;<span class="ident" id="5774276">rbrace</span><span class="op" id="5774282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774286">if</span>&nbsp;<span class="ident" id="5774289">typeSwitch</span>&nbsp;<span class="op" id="5774300">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774304">return</span>&nbsp;<span class="op" id="5774311">&amp;</span><span class="ident" id="5774312">ast</span><span class="op" id="5774315">.</span><span class="ident" id="5774316">TypeSwitchStmt</span><span class="op" id="5774330">{</span><span class="ident" id="5774331">Switch</span><span class="op" id="5774337">:</span>&nbsp;<span class="ident" id="5774339">pos</span><span class="op" id="5774342">,</span>&nbsp;<span class="ident" id="5774344">Init</span><span class="op" id="5774348">:</span>&nbsp;<span class="ident" id="5774350">s1</span><span class="op" id="5774352">,</span>&nbsp;<span class="ident" id="5774354">Assign</span><span class="op" id="5774360">:</span>&nbsp;<span class="ident" id="5774362">s2</span><span class="op" id="5774364">,</span>&nbsp;<span class="ident" id="5774366">Body</span><span class="op" id="5774370">:</span>&nbsp;<span class="ident" id="5774372">body</span><span class="op" id="5774376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774383">return</span>&nbsp;<span class="op" id="5774390">&amp;</span><span class="ident" id="5774391">ast</span><span class="op" id="5774394">.</span><span class="ident" id="5774395">SwitchStmt</span><span class="op" id="5774405">{</span><span class="ident" id="5774406">Switch</span><span class="op" id="5774412">:</span>&nbsp;<span class="ident" id="5774414">pos</span><span class="op" id="5774417">,</span>&nbsp;<span class="ident" id="5774419">Init</span><span class="op" id="5774423">:</span>&nbsp;<span class="ident" id="5774425">s1</span><span class="op" id="5774427">,</span>&nbsp;<span class="ident" id="5774429">Tag</span><span class="op" id="5774432">:</span>&nbsp;<span class="ident" id="5774434">p</span><span class="op" id="5774435">.</span><span class="ident" id="5774436">makeExpr</span><span class="op" id="5774444">(</span><span class="ident" id="5774445">s2</span><span class="op" id="5774447">,</span>&nbsp;<span class="string" id="5774449">&#34;switch&nbsp;expression&#34;</span><span class="op" id="5774468">)</span><span class="op" id="5774469">,</span>&nbsp;<span class="ident" id="5774471">Body</span><span class="op" id="5774475">:</span>&nbsp;<span class="ident" id="5774477">body</span><span class="op" id="5774481">}</span><br>
<span class="lineno"></span><span class="op" id="5774483">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="5774486">func</span>&nbsp;<span class="op" id="5774491">(</span><span class="ident" id="5774492">p</span>&nbsp;<span class="op" id="5774494">*</span><span class="ident" id="5774495">parser</span><span class="op" id="5774501">)</span>&nbsp;<span class="ident" id="5774503">parseCommClause</span><span class="op" id="5774518">(</span><span class="op" id="5774519">)</span>&nbsp;<span class="op" id="5774521">*</span><span class="ident" id="5774522">ast</span><span class="op" id="5774525">.</span><span class="ident" id="5774526">CommClause</span>&nbsp;<span class="op" id="5774537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774540">if</span>&nbsp;<span class="ident" id="5774543">p</span><span class="op" id="5774544">.</span><span class="ident" id="5774545">trace</span>&nbsp;<span class="op" id="5774551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774555">defer</span>&nbsp;<span class="ident" id="5774561">un</span><span class="op" id="5774563">(</span><span class="ident" id="5774564">trace</span><span class="op" id="5774569">(</span><span class="ident" id="5774570">p</span><span class="op" id="5774571">,</span>&nbsp;<span class="string" id="5774573">&#34;CommClause&#34;</span><span class="op" id="5774585">)</span><span class="op" id="5774586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774589">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774593">p</span><span class="op" id="5774594">.</span><span class="ident" id="5774595">openScope</span><span class="op" id="5774604">(</span><span class="op" id="5774605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774608">pos</span>&nbsp;<span class="op" id="5774612">:=</span>&nbsp;<span class="ident" id="5774615">p</span><span class="op" id="5774616">.</span><span class="ident" id="5774617">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774622">var</span>&nbsp;<span class="ident" id="5774626">comm</span>&nbsp;<span class="ident" id="5774631">ast</span><span class="op" id="5774634">.</span><span class="ident" id="5774635">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774641">if</span>&nbsp;<span class="ident" id="5774644">p</span><span class="op" id="5774645">.</span><span class="ident" id="5774646">tok</span>&nbsp;<span class="op" id="5774650">==</span>&nbsp;<span class="ident" id="5774653">token</span><span class="op" id="5774658">.</span><span class="ident" id="5774659">CASE</span>&nbsp;<span class="op" id="5774664">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774668">p</span><span class="op" id="5774669">.</span><span class="ident" id="5774670">next</span><span class="op" id="5774674">(</span><span class="op" id="5774675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774679">lhs</span>&nbsp;<span class="op" id="5774683">:=</span>&nbsp;<span class="ident" id="5774686">p</span><span class="op" id="5774687">.</span><span class="ident" id="5774688">parseLhsList</span><span class="op" id="5774700">(</span><span class="op" id="5774701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774705">if</span>&nbsp;<span class="ident" id="5774708">p</span><span class="op" id="5774709">.</span><span class="ident" id="5774710">tok</span>&nbsp;<span class="op" id="5774714">==</span>&nbsp;<span class="ident" id="5774717">token</span><span class="op" id="5774722">.</span><span class="ident" id="5774723">ARROW</span>&nbsp;<span class="op" id="5774729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774734">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774749">if</span>&nbsp;<span class="builtinfunc" id="5774752">len</span><span class="op" id="5774755">(</span><span class="ident" id="5774756">lhs</span><span class="op" id="5774759">)</span>&nbsp;<span class="op" id="5774761">&gt;</span>&nbsp;<span class="num" id="5774763">1</span>&nbsp;<span class="op" id="5774765">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774771">p</span><span class="op" id="5774772">.</span><span class="ident" id="5774773">errorExpected</span><span class="op" id="5774786">(</span><span class="ident" id="5774787">lhs</span><span class="op" id="5774790">[</span><span class="num" id="5774791">0</span><span class="op" id="5774792">]</span><span class="op" id="5774793">.</span><span class="ident" id="5774794">Pos</span><span class="op" id="5774797">(</span><span class="op" id="5774798">)</span><span class="op" id="5774799">,</span>&nbsp;<span class="string" id="5774801">&#34;1&nbsp;expression&#34;</span><span class="op" id="5774815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774821">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774863">arrow</span>&nbsp;<span class="op" id="5774869">:=</span>&nbsp;<span class="ident" id="5774872">p</span><span class="op" id="5774873">.</span><span class="ident" id="5774874">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774881">p</span><span class="op" id="5774882">.</span><span class="ident" id="5774883">next</span><span class="op" id="5774887">(</span><span class="op" id="5774888">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774893">rhs</span>&nbsp;<span class="op" id="5774897">:=</span>&nbsp;<span class="ident" id="5774900">p</span><span class="op" id="5774901">.</span><span class="ident" id="5774902">parseRhs</span><span class="op" id="5774910">(</span><span class="op" id="5774911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774916">comm</span>&nbsp;<span class="op" id="5774921">=</span>&nbsp;<span class="op" id="5774923">&amp;</span><span class="ident" id="5774924">ast</span><span class="op" id="5774927">.</span><span class="ident" id="5774928">SendStmt</span><span class="op" id="5774936">{</span><span class="ident" id="5774937">Chan</span><span class="op" id="5774941">:</span>&nbsp;<span class="ident" id="5774943">lhs</span><span class="op" id="5774946">[</span><span class="num" id="5774947">0</span><span class="op" id="5774948">]</span><span class="op" id="5774949">,</span>&nbsp;<span class="ident" id="5774951">Arrow</span><span class="op" id="5774956">:</span>&nbsp;<span class="ident" id="5774958">arrow</span><span class="op" id="5774963">,</span>&nbsp;<span class="ident" id="5774965">Value</span><span class="op" id="5774970">:</span>&nbsp;<span class="ident" id="5774972">rhs</span><span class="op" id="5774975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774979">}</span>&nbsp;<span class="keyword" id="5774981">else</span>&nbsp;<span class="op" id="5774986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774991">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775006">if</span>&nbsp;<span class="ident" id="5775009">tok</span>&nbsp;<span class="op" id="5775013">:=</span>&nbsp;<span class="ident" id="5775016">p</span><span class="op" id="5775017">.</span><span class="ident" id="5775018">tok</span><span class="op" id="5775021">;</span>&nbsp;<span class="ident" id="5775023">tok</span>&nbsp;<span class="op" id="5775027">==</span>&nbsp;<span class="ident" id="5775030">token</span><span class="op" id="5775035">.</span><span class="ident" id="5775036">ASSIGN</span>&nbsp;<span class="op" id="5775043">||</span>&nbsp;<span class="ident" id="5775046">tok</span>&nbsp;<span class="op" id="5775050">==</span>&nbsp;<span class="ident" id="5775053">token</span><span class="op" id="5775058">.</span><span class="ident" id="5775059">DEFINE</span>&nbsp;<span class="op" id="5775066">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775072">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775104">if</span>&nbsp;<span class="builtinfunc" id="5775107">len</span><span class="op" id="5775110">(</span><span class="ident" id="5775111">lhs</span><span class="op" id="5775114">)</span>&nbsp;<span class="op" id="5775116">&gt;</span>&nbsp;<span class="num" id="5775118">2</span>&nbsp;<span class="op" id="5775120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775127">p</span><span class="op" id="5775128">.</span><span class="ident" id="5775129">errorExpected</span><span class="op" id="5775142">(</span><span class="ident" id="5775143">lhs</span><span class="op" id="5775146">[</span><span class="num" id="5775147">0</span><span class="op" id="5775148">]</span><span class="op" id="5775149">.</span><span class="ident" id="5775150">Pos</span><span class="op" id="5775153">(</span><span class="op" id="5775154">)</span><span class="op" id="5775155">,</span>&nbsp;<span class="string" id="5775157">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5775177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775184">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775228">lhs</span>&nbsp;<span class="op" id="5775232">=</span>&nbsp;<span class="ident" id="5775234">lhs</span><span class="op" id="5775237">[</span><span class="num" id="5775238">0</span><span class="op" id="5775239">:</span><span class="num" id="5775240">2</span><span class="op" id="5775241">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775253">pos</span>&nbsp;<span class="op" id="5775257">:=</span>&nbsp;<span class="ident" id="5775260">p</span><span class="op" id="5775261">.</span><span class="ident" id="5775262">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775270">p</span><span class="op" id="5775271">.</span><span class="ident" id="5775272">next</span><span class="op" id="5775276">(</span><span class="op" id="5775277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775283">rhs</span>&nbsp;<span class="op" id="5775287">:=</span>&nbsp;<span class="ident" id="5775290">p</span><span class="op" id="5775291">.</span><span class="ident" id="5775292">parseRhs</span><span class="op" id="5775300">(</span><span class="op" id="5775301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775307">as</span>&nbsp;<span class="op" id="5775310">:=</span>&nbsp;<span class="op" id="5775313">&amp;</span><span class="ident" id="5775314">ast</span><span class="op" id="5775317">.</span><span class="ident" id="5775318">AssignStmt</span><span class="op" id="5775328">{</span><span class="ident" id="5775329">Lhs</span><span class="op" id="5775332">:</span>&nbsp;<span class="ident" id="5775334">lhs</span><span class="op" id="5775337">,</span>&nbsp;<span class="ident" id="5775339">TokPos</span><span class="op" id="5775345">:</span>&nbsp;<span class="ident" id="5775347">pos</span><span class="op" id="5775350">,</span>&nbsp;<span class="ident" id="5775352">Tok</span><span class="op" id="5775355">:</span>&nbsp;<span class="ident" id="5775357">tok</span><span class="op" id="5775360">,</span>&nbsp;<span class="ident" id="5775362">Rhs</span><span class="op" id="5775365">:</span>&nbsp;<span class="op" id="5775367">[</span><span class="op" id="5775368">]</span><span class="ident" id="5775369">ast</span><span class="op" id="5775372">.</span><span class="ident" id="5775373">Expr</span><span class="op" id="5775377">{</span><span class="ident" id="5775378">rhs</span><span class="op" id="5775381">}</span><span class="op" id="5775382">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775388">if</span>&nbsp;<span class="ident" id="5775391">tok</span>&nbsp;<span class="op" id="5775395">==</span>&nbsp;<span class="ident" id="5775398">token</span><span class="op" id="5775403">.</span><span class="ident" id="5775404">DEFINE</span>&nbsp;<span class="op" id="5775411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775418">p</span><span class="op" id="5775419">.</span><span class="ident" id="5775420">shortVarDecl</span><span class="op" id="5775432">(</span><span class="ident" id="5775433">as</span><span class="op" id="5775435">,</span>&nbsp;<span class="ident" id="5775437">lhs</span><span class="op" id="5775440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775452">comm</span>&nbsp;<span class="op" id="5775457">=</span>&nbsp;<span class="ident" id="5775459">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775465">}</span>&nbsp;<span class="keyword" id="5775467">else</span>&nbsp;<span class="op" id="5775472">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775478">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775522">if</span>&nbsp;<span class="builtinfunc" id="5775525">len</span><span class="op" id="5775528">(</span><span class="ident" id="5775529">lhs</span><span class="op" id="5775532">)</span>&nbsp;<span class="op" id="5775534">&gt;</span>&nbsp;<span class="num" id="5775536">1</span>&nbsp;<span class="op" id="5775538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775545">p</span><span class="op" id="5775546">.</span><span class="ident" id="5775547">errorExpected</span><span class="op" id="5775560">(</span><span class="ident" id="5775561">lhs</span><span class="op" id="5775564">[</span><span class="num" id="5775565">0</span><span class="op" id="5775566">]</span><span class="op" id="5775567">.</span><span class="ident" id="5775568">Pos</span><span class="op" id="5775571">(</span><span class="op" id="5775572">)</span><span class="op" id="5775573">,</span>&nbsp;<span class="string" id="5775575">&#34;1&nbsp;expression&#34;</span><span class="op" id="5775589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775596">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775634">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775640">comm</span>&nbsp;<span class="op" id="5775645">=</span>&nbsp;<span class="op" id="5775647">&amp;</span><span class="ident" id="5775648">ast</span><span class="op" id="5775651">.</span><span class="ident" id="5775652">ExprStmt</span><span class="op" id="5775660">{</span><span class="ident" id="5775661">X</span><span class="op" id="5775662">:</span>&nbsp;<span class="ident" id="5775664">lhs</span><span class="op" id="5775667">[</span><span class="num" id="5775668">0</span><span class="op" id="5775669">]</span><span class="op" id="5775670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775682">}</span>&nbsp;<span class="keyword" id="5775684">else</span>&nbsp;<span class="op" id="5775689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775693">p</span><span class="op" id="5775694">.</span><span class="ident" id="5775695">expect</span><span class="op" id="5775701">(</span><span class="ident" id="5775702">token</span><span class="op" id="5775707">.</span><span class="ident" id="5775708">DEFAULT</span><span class="op" id="5775715">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775722">colon</span>&nbsp;<span class="op" id="5775728">:=</span>&nbsp;<span class="ident" id="5775731">p</span><span class="op" id="5775732">.</span><span class="ident" id="5775733">expect</span><span class="op" id="5775739">(</span><span class="ident" id="5775740">token</span><span class="op" id="5775745">.</span><span class="ident" id="5775746">COLON</span><span class="op" id="5775751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775754">body</span>&nbsp;<span class="op" id="5775759">:=</span>&nbsp;<span class="ident" id="5775762">p</span><span class="op" id="5775763">.</span><span class="ident" id="5775764">parseStmtList</span><span class="op" id="5775777">(</span><span class="op" id="5775778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775781">p</span><span class="op" id="5775782">.</span><span class="ident" id="5775783">closeScope</span><span class="op" id="5775793">(</span><span class="op" id="5775794">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775798">return</span>&nbsp;<span class="op" id="5775805">&amp;</span><span class="ident" id="5775806">ast</span><span class="op" id="5775809">.</span><span class="ident" id="5775810">CommClause</span><span class="op" id="5775820">{</span><span class="ident" id="5775821">Case</span><span class="op" id="5775825">:</span>&nbsp;<span class="ident" id="5775827">pos</span><span class="op" id="5775830">,</span>&nbsp;<span class="ident" id="5775832">Comm</span><span class="op" id="5775836">:</span>&nbsp;<span class="ident" id="5775838">comm</span><span class="op" id="5775842">,</span>&nbsp;<span class="ident" id="5775844">Colon</span><span class="op" id="5775849">:</span>&nbsp;<span class="ident" id="5775851">colon</span><span class="op" id="5775856">,</span>&nbsp;<span class="ident" id="5775858">Body</span><span class="op" id="5775862">:</span>&nbsp;<span class="ident" id="5775864">body</span><span class="op" id="5775868">}</span><br>
<span class="lineno"></span><span class="op" id="5775870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5775873">func</span>&nbsp;<span class="op" id="5775878">(</span><span class="ident" id="5775879">p</span>&nbsp;<span class="op" id="5775881">*</span><span class="ident" id="5775882">parser</span><span class="op" id="5775888">)</span>&nbsp;<span class="ident" id="5775890">parseSelectStmt</span><span class="op" id="5775905">(</span><span class="op" id="5775906">)</span>&nbsp;<span class="op" id="5775908">*</span><span class="ident" id="5775909">ast</span><span class="op" id="5775912">.</span><span class="ident" id="5775913">SelectStmt</span>&nbsp;<span class="op" id="5775924">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775927">if</span>&nbsp;<span class="ident" id="5775930">p</span><span class="op" id="5775931">.</span><span class="ident" id="5775932">trace</span>&nbsp;<span class="op" id="5775938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775942">defer</span>&nbsp;<span class="ident" id="5775948">un</span><span class="op" id="5775950">(</span><span class="ident" id="5775951">trace</span><span class="op" id="5775956">(</span><span class="ident" id="5775957">p</span><span class="op" id="5775958">,</span>&nbsp;<span class="string" id="5775960">&#34;SelectStmt&#34;</span><span class="op" id="5775972">)</span><span class="op" id="5775973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775980">pos</span>&nbsp;<span class="op" id="5775984">:=</span>&nbsp;<span class="ident" id="5775987">p</span><span class="op" id="5775988">.</span><span class="ident" id="5775989">expect</span><span class="op" id="5775995">(</span><span class="ident" id="5775996">token</span><span class="op" id="5776001">.</span><span class="ident" id="5776002">SELECT</span><span class="op" id="5776008">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776011">lbrace</span>&nbsp;<span class="op" id="5776018">:=</span>&nbsp;<span class="ident" id="5776021">p</span><span class="op" id="5776022">.</span><span class="ident" id="5776023">expect</span><span class="op" id="5776029">(</span><span class="ident" id="5776030">token</span><span class="op" id="5776035">.</span><span class="ident" id="5776036">LBRACE</span><span class="op" id="5776042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776045">var</span>&nbsp;<span class="ident" id="5776049">list</span>&nbsp;<span class="op" id="5776054">[</span><span class="op" id="5776055">]</span><span class="ident" id="5776056">ast</span><span class="op" id="5776059">.</span><span class="ident" id="5776060">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776066">for</span>&nbsp;<span class="ident" id="5776070">p</span><span class="op" id="5776071">.</span><span class="ident" id="5776072">tok</span>&nbsp;<span class="op" id="5776076">==</span>&nbsp;<span class="ident" id="5776079">token</span><span class="op" id="5776084">.</span><span class="ident" id="5776085">CASE</span>&nbsp;<span class="op" id="5776090">||</span>&nbsp;<span class="ident" id="5776093">p</span><span class="op" id="5776094">.</span><span class="ident" id="5776095">tok</span>&nbsp;<span class="op" id="5776099">==</span>&nbsp;<span class="ident" id="5776102">token</span><span class="op" id="5776107">.</span><span class="ident" id="5776108">DEFAULT</span>&nbsp;<span class="op" id="5776116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776120">list</span>&nbsp;<span class="op" id="5776125">=</span>&nbsp;<span class="builtinfunc" id="5776127">append</span><span class="op" id="5776133">(</span><span class="ident" id="5776134">list</span><span class="op" id="5776138">,</span>&nbsp;<span class="ident" id="5776140">p</span><span class="op" id="5776141">.</span><span class="ident" id="5776142">parseCommClause</span><span class="op" id="5776157">(</span><span class="op" id="5776158">)</span><span class="op" id="5776159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776162">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776165">rbrace</span>&nbsp;<span class="op" id="5776172">:=</span>&nbsp;<span class="ident" id="5776175">p</span><span class="op" id="5776176">.</span><span class="ident" id="5776177">expect</span><span class="op" id="5776183">(</span><span class="ident" id="5776184">token</span><span class="op" id="5776189">.</span><span class="ident" id="5776190">RBRACE</span><span class="op" id="5776196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776199">p</span><span class="op" id="5776200">.</span><span class="ident" id="5776201">expectSemi</span><span class="op" id="5776211">(</span><span class="op" id="5776212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776215">body</span>&nbsp;<span class="op" id="5776220">:=</span>&nbsp;<span class="op" id="5776223">&amp;</span><span class="ident" id="5776224">ast</span><span class="op" id="5776227">.</span><span class="ident" id="5776228">BlockStmt</span><span class="op" id="5776237">{</span><span class="ident" id="5776238">Lbrace</span><span class="op" id="5776244">:</span>&nbsp;<span class="ident" id="5776246">lbrace</span><span class="op" id="5776252">,</span>&nbsp;<span class="ident" id="5776254">List</span><span class="op" id="5776258">:</span>&nbsp;<span class="ident" id="5776260">list</span><span class="op" id="5776264">,</span>&nbsp;<span class="ident" id="5776266">Rbrace</span><span class="op" id="5776272">:</span>&nbsp;<span class="ident" id="5776274">rbrace</span><span class="op" id="5776280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776284">return</span>&nbsp;<span class="op" id="5776291">&amp;</span><span class="ident" id="5776292">ast</span><span class="op" id="5776295">.</span><span class="ident" id="5776296">SelectStmt</span><span class="op" id="5776306">{</span><span class="ident" id="5776307">Select</span><span class="op" id="5776313">:</span>&nbsp;<span class="ident" id="5776315">pos</span><span class="op" id="5776318">,</span>&nbsp;<span class="ident" id="5776320">Body</span><span class="op" id="5776324">:</span>&nbsp;<span class="ident" id="5776326">body</span><span class="op" id="5776330">}</span><br>
<span class="lineno">2030</span><span class="op" id="5776332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5776335">func</span>&nbsp;<span class="op" id="5776340">(</span><span class="ident" id="5776341">p</span>&nbsp;<span class="op" id="5776343">*</span><span class="ident" id="5776344">parser</span><span class="op" id="5776350">)</span>&nbsp;<span class="ident" id="5776352">parseForStmt</span><span class="op" id="5776364">(</span><span class="op" id="5776365">)</span>&nbsp;<span class="ident" id="5776367">ast</span><span class="op" id="5776370">.</span><span class="ident" id="5776371">Stmt</span>&nbsp;<span class="op" id="5776376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776379">if</span>&nbsp;<span class="ident" id="5776382">p</span><span class="op" id="5776383">.</span><span class="ident" id="5776384">trace</span>&nbsp;<span class="op" id="5776390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776394">defer</span>&nbsp;<span class="ident" id="5776400">un</span><span class="op" id="5776402">(</span><span class="ident" id="5776403">trace</span><span class="op" id="5776408">(</span><span class="ident" id="5776409">p</span><span class="op" id="5776410">,</span>&nbsp;<span class="string" id="5776412">&#34;ForStmt&#34;</span><span class="op" id="5776421">)</span><span class="op" id="5776422">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776429">pos</span>&nbsp;<span class="op" id="5776433">:=</span>&nbsp;<span class="ident" id="5776436">p</span><span class="op" id="5776437">.</span><span class="ident" id="5776438">expect</span><span class="op" id="5776444">(</span><span class="ident" id="5776445">token</span><span class="op" id="5776450">.</span><span class="ident" id="5776451">FOR</span><span class="op" id="5776454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776457">p</span><span class="op" id="5776458">.</span><span class="ident" id="5776459">openScope</span><span class="op" id="5776468">(</span><span class="op" id="5776469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776472">defer</span>&nbsp;<span class="ident" id="5776478">p</span><span class="op" id="5776479">.</span><span class="ident" id="5776480">closeScope</span><span class="op" id="5776490">(</span><span class="op" id="5776491">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776495">var</span>&nbsp;<span class="ident" id="5776499">s1</span><span class="op" id="5776501">,</span>&nbsp;<span class="ident" id="5776503">s2</span><span class="op" id="5776505">,</span>&nbsp;<span class="ident" id="5776507">s3</span>&nbsp;<span class="ident" id="5776510">ast</span><span class="op" id="5776513">.</span><span class="ident" id="5776514">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776520">var</span>&nbsp;<span class="ident" id="5776524">isRange</span>&nbsp;<span class="builtintype" id="5776532">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776538">if</span>&nbsp;<span class="ident" id="5776541">p</span><span class="op" id="5776542">.</span><span class="ident" id="5776543">tok</span>&nbsp;<span class="op" id="5776547">!=</span>&nbsp;<span class="ident" id="5776550">token</span><span class="op" id="5776555">.</span><span class="ident" id="5776556">LBRACE</span>&nbsp;<span class="op" id="5776563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776567">prevLev</span>&nbsp;<span class="op" id="5776575">:=</span>&nbsp;<span class="ident" id="5776578">p</span><span class="op" id="5776579">.</span><span class="ident" id="5776580">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776590">p</span><span class="op" id="5776591">.</span><span class="ident" id="5776592">exprLev</span>&nbsp;<span class="op" id="5776600">=</span>&nbsp;<span class="op" id="5776602">-</span><span class="num" id="5776603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776607">if</span>&nbsp;<span class="ident" id="5776610">p</span><span class="op" id="5776611">.</span><span class="ident" id="5776612">tok</span>&nbsp;<span class="op" id="5776616">!=</span>&nbsp;<span class="ident" id="5776619">token</span><span class="op" id="5776624">.</span><span class="ident" id="5776625">SEMICOLON</span>&nbsp;<span class="op" id="5776635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776640">if</span>&nbsp;<span class="ident" id="5776643">p</span><span class="op" id="5776644">.</span><span class="ident" id="5776645">tok</span>&nbsp;<span class="op" id="5776649">==</span>&nbsp;<span class="ident" id="5776652">token</span><span class="op" id="5776657">.</span><span class="ident" id="5776658">RANGE</span>&nbsp;<span class="op" id="5776664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776670">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776715">pos</span>&nbsp;<span class="op" id="5776719">:=</span>&nbsp;<span class="ident" id="5776722">p</span><span class="op" id="5776723">.</span><span class="ident" id="5776724">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776732">p</span><span class="op" id="5776733">.</span><span class="ident" id="5776734">next</span><span class="op" id="5776738">(</span><span class="op" id="5776739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776745">y</span>&nbsp;<span class="op" id="5776747">:=</span>&nbsp;<span class="op" id="5776750">[</span><span class="op" id="5776751">]</span><span class="ident" id="5776752">ast</span><span class="op" id="5776755">.</span><span class="ident" id="5776756">Expr</span><span class="op" id="5776760">{</span><span class="op" id="5776761">&amp;</span><span class="ident" id="5776762">ast</span><span class="op" id="5776765">.</span><span class="ident" id="5776766">UnaryExpr</span><span class="op" id="5776775">{</span><span class="ident" id="5776776">OpPos</span><span class="op" id="5776781">:</span>&nbsp;<span class="ident" id="5776783">pos</span><span class="op" id="5776786">,</span>&nbsp;<span class="ident" id="5776788">Op</span><span class="op" id="5776790">:</span>&nbsp;<span class="ident" id="5776792">token</span><span class="op" id="5776797">.</span><span class="ident" id="5776798">RANGE</span><span class="op" id="5776803">,</span>&nbsp;<span class="ident" id="5776805">X</span><span class="op" id="5776806">:</span>&nbsp;<span class="ident" id="5776808">p</span><span class="op" id="5776809">.</span><span class="ident" id="5776810">parseRhs</span><span class="op" id="5776818">(</span><span class="op" id="5776819">)</span><span class="op" id="5776820">}</span><span class="op" id="5776821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776827">s2</span>&nbsp;<span class="op" id="5776830">=</span>&nbsp;<span class="op" id="5776832">&amp;</span><span class="ident" id="5776833">ast</span><span class="op" id="5776836">.</span><span class="ident" id="5776837">AssignStmt</span><span class="op" id="5776847">{</span><span class="ident" id="5776848">Rhs</span><span class="op" id="5776851">:</span>&nbsp;<span class="ident" id="5776853">y</span><span class="op" id="5776854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776860">isRange</span>&nbsp;<span class="op" id="5776868">=</span>&nbsp;<span class="builtintype" id="5776870">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776878">}</span>&nbsp;<span class="keyword" id="5776880">else</span>&nbsp;<span class="op" id="5776885">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776891">s2</span><span class="op" id="5776893">,</span>&nbsp;<span class="ident" id="5776895">isRange</span>&nbsp;<span class="op" id="5776903">=</span>&nbsp;<span class="ident" id="5776905">p</span><span class="op" id="5776906">.</span><span class="ident" id="5776907">parseSimpleStmt</span><span class="op" id="5776922">(</span><span class="ident" id="5776923">rangeOk</span><span class="op" id="5776930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776943">if</span>&nbsp;<span class="op" id="5776946">!</span><span class="ident" id="5776947">isRange</span>&nbsp;<span class="op" id="5776955">&amp;&amp;</span>&nbsp;<span class="ident" id="5776958">p</span><span class="op" id="5776959">.</span><span class="ident" id="5776960">tok</span>&nbsp;<span class="op" id="5776964">==</span>&nbsp;<span class="ident" id="5776967">token</span><span class="op" id="5776972">.</span><span class="ident" id="5776973">SEMICOLON</span>&nbsp;<span class="op" id="5776983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776988">p</span><span class="op" id="5776989">.</span><span class="ident" id="5776990">next</span><span class="op" id="5776994">(</span><span class="op" id="5776995">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777000">s1</span>&nbsp;<span class="op" id="5777003">=</span>&nbsp;<span class="ident" id="5777005">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777011">s2</span>&nbsp;<span class="op" id="5777014">=</span>&nbsp;<span class="ident" id="5777016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777023">if</span>&nbsp;<span class="ident" id="5777026">p</span><span class="op" id="5777027">.</span><span class="ident" id="5777028">tok</span>&nbsp;<span class="op" id="5777032">!=</span>&nbsp;<span class="ident" id="5777035">token</span><span class="op" id="5777040">.</span><span class="ident" id="5777041">SEMICOLON</span>&nbsp;<span class="op" id="5777051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777057">s2</span><span class="op" id="5777059">,</span>&nbsp;<span class="ident" id="5777061">_</span>&nbsp;<span class="op" id="5777063">=</span>&nbsp;<span class="ident" id="5777065">p</span><span class="op" id="5777066">.</span><span class="ident" id="5777067">parseSimpleStmt</span><span class="op" id="5777082">(</span><span class="ident" id="5777083">basic</span><span class="op" id="5777088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777093">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777098">p</span><span class="op" id="5777099">.</span><span class="ident" id="5777100">expectSemi</span><span class="op" id="5777110">(</span><span class="op" id="5777111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777116">if</span>&nbsp;<span class="ident" id="5777119">p</span><span class="op" id="5777120">.</span><span class="ident" id="5777121">tok</span>&nbsp;<span class="op" id="5777125">!=</span>&nbsp;<span class="ident" id="5777128">token</span><span class="op" id="5777133">.</span><span class="ident" id="5777134">LBRACE</span>&nbsp;<span class="op" id="5777141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777147">s3</span><span class="op" id="5777149">,</span>&nbsp;<span class="ident" id="5777151">_</span>&nbsp;<span class="op" id="5777153">=</span>&nbsp;<span class="ident" id="5777155">p</span><span class="op" id="5777156">.</span><span class="ident" id="5777157">parseSimpleStmt</span><span class="op" id="5777172">(</span><span class="ident" id="5777173">basic</span><span class="op" id="5777178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777187">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777191">p</span><span class="op" id="5777192">.</span><span class="ident" id="5777193">exprLev</span>&nbsp;<span class="op" id="5777201">=</span>&nbsp;<span class="ident" id="5777203">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777216">body</span>&nbsp;<span class="op" id="5777221">:=</span>&nbsp;<span class="ident" id="5777224">p</span><span class="op" id="5777225">.</span><span class="ident" id="5777226">parseBlockStmt</span><span class="op" id="5777240">(</span><span class="op" id="5777241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777244">p</span><span class="op" id="5777245">.</span><span class="ident" id="5777246">expectSemi</span><span class="op" id="5777256">(</span><span class="op" id="5777257">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777261">if</span>&nbsp;<span class="ident" id="5777264">isRange</span>&nbsp;<span class="op" id="5777272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777276">as</span>&nbsp;<span class="op" id="5777279">:=</span>&nbsp;<span class="ident" id="5777282">s2</span><span class="op" id="5777284">.</span><span class="op" id="5777285">(</span><span class="op" id="5777286">*</span><span class="ident" id="5777287">ast</span><span class="op" id="5777290">.</span><span class="ident" id="5777291">AssignStmt</span><span class="op" id="5777301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777305">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777320">var</span>&nbsp;<span class="ident" id="5777324">key</span><span class="op" id="5777327">,</span>&nbsp;<span class="ident" id="5777329">value</span>&nbsp;<span class="ident" id="5777335">ast</span><span class="op" id="5777338">.</span><span class="ident" id="5777339">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777346">switch</span>&nbsp;<span class="builtinfunc" id="5777353">len</span><span class="op" id="5777356">(</span><span class="ident" id="5777357">as</span><span class="op" id="5777359">.</span><span class="ident" id="5777360">Lhs</span><span class="op" id="5777363">)</span>&nbsp;<span class="op" id="5777365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777369">case</span>&nbsp;<span class="num" id="5777374">0</span><span class="op" id="5777375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777380">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777399">case</span>&nbsp;<span class="num" id="5777404">1</span><span class="op" id="5777405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777410">key</span>&nbsp;<span class="op" id="5777414">=</span>&nbsp;<span class="ident" id="5777416">as</span><span class="op" id="5777418">.</span><span class="ident" id="5777419">Lhs</span><span class="op" id="5777422">[</span><span class="num" id="5777423">0</span><span class="op" id="5777424">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777428">case</span>&nbsp;<span class="num" id="5777433">2</span><span class="op" id="5777434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777439">key</span><span class="op" id="5777442">,</span>&nbsp;<span class="ident" id="5777444">value</span>&nbsp;<span class="op" id="5777450">=</span>&nbsp;<span class="ident" id="5777452">as</span><span class="op" id="5777454">.</span><span class="ident" id="5777455">Lhs</span><span class="op" id="5777458">[</span><span class="num" id="5777459">0</span><span class="op" id="5777460">]</span><span class="op" id="5777461">,</span>&nbsp;<span class="ident" id="5777463">as</span><span class="op" id="5777465">.</span><span class="ident" id="5777466">Lhs</span><span class="op" id="5777469">[</span><span class="num" id="5777470">1</span><span class="op" id="5777471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777475">default</span><span class="op" id="5777482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777487">p</span><span class="op" id="5777488">.</span><span class="ident" id="5777489">errorExpected</span><span class="op" id="5777502">(</span><span class="ident" id="5777503">as</span><span class="op" id="5777505">.</span><span class="ident" id="5777506">Lhs</span><span class="op" id="5777509">[</span><span class="builtinfunc" id="5777510">len</span><span class="op" id="5777513">(</span><span class="ident" id="5777514">as</span><span class="op" id="5777516">.</span><span class="ident" id="5777517">Lhs</span><span class="op" id="5777520">)</span><span class="op" id="5777521">-</span><span class="num" id="5777522">1</span><span class="op" id="5777523">]</span><span class="op" id="5777524">.</span><span class="ident" id="5777525">Pos</span><span class="op" id="5777528">(</span><span class="op" id="5777529">)</span><span class="op" id="5777530">,</span>&nbsp;<span class="string" id="5777532">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5777555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777560">return</span>&nbsp;<span class="op" id="5777567">&amp;</span><span class="ident" id="5777568">ast</span><span class="op" id="5777571">.</span><span class="ident" id="5777572">BadStmt</span><span class="op" id="5777579">{</span><span class="ident" id="5777580">From</span><span class="op" id="5777584">:</span>&nbsp;<span class="ident" id="5777586">pos</span><span class="op" id="5777589">,</span>&nbsp;<span class="ident" id="5777591">To</span><span class="op" id="5777593">:</span>&nbsp;<span class="ident" id="5777595">p</span><span class="op" id="5777596">.</span><span class="ident" id="5777597">safePos</span><span class="op" id="5777604">(</span><span class="ident" id="5777605">body</span><span class="op" id="5777609">.</span><span class="ident" id="5777610">End</span><span class="op" id="5777613">(</span><span class="op" id="5777614">)</span><span class="op" id="5777615">)</span><span class="op" id="5777616">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777624">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777677">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777733">x</span>&nbsp;<span class="op" id="5777735">:=</span>&nbsp;<span class="ident" id="5777738">as</span><span class="op" id="5777740">.</span><span class="ident" id="5777741">Rhs</span><span class="op" id="5777744">[</span><span class="num" id="5777745">0</span><span class="op" id="5777746">]</span><span class="op" id="5777747">.</span><span class="op" id="5777748">(</span><span class="op" id="5777749">*</span><span class="ident" id="5777750">ast</span><span class="op" id="5777753">.</span><span class="ident" id="5777754">UnaryExpr</span><span class="op" id="5777763">)</span><span class="op" id="5777764">.</span><span class="ident" id="5777765">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777769">return</span>&nbsp;<span class="op" id="5777776">&amp;</span><span class="ident" id="5777777">ast</span><span class="op" id="5777780">.</span><span class="ident" id="5777781">RangeStmt</span><span class="op" id="5777790">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777795">For</span><span class="op" id="5777798">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5777803">pos</span><span class="op" id="5777806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777811">Key</span><span class="op" id="5777814">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5777819">key</span><span class="op" id="5777822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777827">Value</span><span class="op" id="5777832">:</span>&nbsp;&nbsp;<span class="ident" id="5777835">value</span><span class="op" id="5777840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777845">TokPos</span><span class="op" id="5777851">:</span>&nbsp;<span class="ident" id="5777853">as</span><span class="op" id="5777855">.</span><span class="ident" id="5777856">TokPos</span><span class="op" id="5777862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777867">Tok</span><span class="op" id="5777870">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5777875">as</span><span class="op" id="5777877">.</span><span class="ident" id="5777878">Tok</span><span class="op" id="5777881">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777886">X</span><span class="op" id="5777887">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5777894">x</span><span class="op" id="5777895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777900">Body</span><span class="op" id="5777904">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5777908">body</span><span class="op" id="5777912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777923">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777949">return</span>&nbsp;<span class="op" id="5777956">&amp;</span><span class="ident" id="5777957">ast</span><span class="op" id="5777960">.</span><span class="ident" id="5777961">ForStmt</span><span class="op" id="5777968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777972">For</span><span class="op" id="5777975">:</span>&nbsp;&nbsp;<span class="ident" id="5777978">pos</span><span class="op" id="5777981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777985">Init</span><span class="op" id="5777989">:</span>&nbsp;<span class="ident" id="5777991">s1</span><span class="op" id="5777993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777997">Cond</span><span class="op" id="5778001">:</span>&nbsp;<span class="ident" id="5778003">p</span><span class="op" id="5778004">.</span><span class="ident" id="5778005">makeExpr</span><span class="op" id="5778013">(</span><span class="ident" id="5778014">s2</span><span class="op" id="5778016">,</span>&nbsp;<span class="string" id="5778018">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="5778047">)</span><span class="op" id="5778048">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778052">Post</span><span class="op" id="5778056">:</span>&nbsp;<span class="ident" id="5778058">s3</span><span class="op" id="5778060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778064">Body</span><span class="op" id="5778068">:</span>&nbsp;<span class="ident" id="5778070">body</span><span class="op" id="5778074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778077">}</span><br>
<span class="lineno"></span><span class="op" id="5778079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="5778082">func</span>&nbsp;<span class="op" id="5778087">(</span><span class="ident" id="5778088">p</span>&nbsp;<span class="op" id="5778090">*</span><span class="ident" id="5778091">parser</span><span class="op" id="5778097">)</span>&nbsp;<span class="ident" id="5778099">parseStmt</span><span class="op" id="5778108">(</span><span class="op" id="5778109">)</span>&nbsp;<span class="op" id="5778111">(</span><span class="ident" id="5778112">s</span>&nbsp;<span class="ident" id="5778114">ast</span><span class="op" id="5778117">.</span><span class="ident" id="5778118">Stmt</span><span class="op" id="5778122">)</span>&nbsp;<span class="op" id="5778124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778127">if</span>&nbsp;<span class="ident" id="5778130">p</span><span class="op" id="5778131">.</span><span class="ident" id="5778132">trace</span>&nbsp;<span class="op" id="5778138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778142">defer</span>&nbsp;<span class="ident" id="5778148">un</span><span class="op" id="5778150">(</span><span class="ident" id="5778151">trace</span><span class="op" id="5778156">(</span><span class="ident" id="5778157">p</span><span class="op" id="5778158">,</span>&nbsp;<span class="string" id="5778160">&#34;Statement&#34;</span><span class="op" id="5778171">)</span><span class="op" id="5778172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778179">switch</span>&nbsp;<span class="ident" id="5778186">p</span><span class="op" id="5778187">.</span><span class="ident" id="5778188">tok</span>&nbsp;<span class="op" id="5778192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778195">case</span>&nbsp;<span class="ident" id="5778200">token</span><span class="op" id="5778205">.</span><span class="ident" id="5778206">CONST</span><span class="op" id="5778211">,</span>&nbsp;<span class="ident" id="5778213">token</span><span class="op" id="5778218">.</span><span class="ident" id="5778219">TYPE</span><span class="op" id="5778223">,</span>&nbsp;<span class="ident" id="5778225">token</span><span class="op" id="5778230">.</span><span class="ident" id="5778231">VAR</span><span class="op" id="5778234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778238">s</span>&nbsp;<span class="op" id="5778240">=</span>&nbsp;<span class="op" id="5778242">&amp;</span><span class="ident" id="5778243">ast</span><span class="op" id="5778246">.</span><span class="ident" id="5778247">DeclStmt</span><span class="op" id="5778255">{</span><span class="ident" id="5778256">Decl</span><span class="op" id="5778260">:</span>&nbsp;<span class="ident" id="5778262">p</span><span class="op" id="5778263">.</span><span class="ident" id="5778264">parseDecl</span><span class="op" id="5778273">(</span><span class="ident" id="5778274">syncStmt</span><span class="op" id="5778282">)</span><span class="op" id="5778283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778286">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778293">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778334">token</span><span class="op" id="5778339">.</span><span class="ident" id="5778340">IDENT</span><span class="op" id="5778345">,</span>&nbsp;<span class="ident" id="5778347">token</span><span class="op" id="5778352">.</span><span class="ident" id="5778353">INT</span><span class="op" id="5778356">,</span>&nbsp;<span class="ident" id="5778358">token</span><span class="op" id="5778363">.</span><span class="ident" id="5778364">FLOAT</span><span class="op" id="5778369">,</span>&nbsp;<span class="ident" id="5778371">token</span><span class="op" id="5778376">.</span><span class="ident" id="5778377">IMAG</span><span class="op" id="5778381">,</span>&nbsp;<span class="ident" id="5778383">token</span><span class="op" id="5778388">.</span><span class="ident" id="5778389">CHAR</span><span class="op" id="5778393">,</span>&nbsp;<span class="ident" id="5778395">token</span><span class="op" id="5778400">.</span><span class="ident" id="5778401">STRING</span><span class="op" id="5778407">,</span>&nbsp;<span class="ident" id="5778409">token</span><span class="op" id="5778414">.</span><span class="ident" id="5778415">FUNC</span><span class="op" id="5778419">,</span>&nbsp;<span class="ident" id="5778421">token</span><span class="op" id="5778426">.</span><span class="ident" id="5778427">LPAREN</span><span class="op" id="5778433">,</span>&nbsp;<span class="comment" id="5778435">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778449">token</span><span class="op" id="5778454">.</span><span class="ident" id="5778455">LBRACK</span><span class="op" id="5778461">,</span>&nbsp;<span class="ident" id="5778463">token</span><span class="op" id="5778468">.</span><span class="ident" id="5778469">STRUCT</span><span class="op" id="5778475">,</span>&nbsp;<span class="comment" id="5778477">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778498">token</span><span class="op" id="5778503">.</span><span class="ident" id="5778504">ADD</span><span class="op" id="5778507">,</span>&nbsp;<span class="ident" id="5778509">token</span><span class="op" id="5778514">.</span><span class="ident" id="5778515">SUB</span><span class="op" id="5778518">,</span>&nbsp;<span class="ident" id="5778520">token</span><span class="op" id="5778525">.</span><span class="ident" id="5778526">MUL</span><span class="op" id="5778529">,</span>&nbsp;<span class="ident" id="5778531">token</span><span class="op" id="5778536">.</span><span class="ident" id="5778537">AND</span><span class="op" id="5778540">,</span>&nbsp;<span class="ident" id="5778542">token</span><span class="op" id="5778547">.</span><span class="ident" id="5778548">XOR</span><span class="op" id="5778551">,</span>&nbsp;<span class="ident" id="5778553">token</span><span class="op" id="5778558">.</span><span class="ident" id="5778559">ARROW</span><span class="op" id="5778564">,</span>&nbsp;<span class="ident" id="5778566">token</span><span class="op" id="5778571">.</span><span class="ident" id="5778572">NOT</span><span class="op" id="5778575">:</span>&nbsp;<span class="comment" id="5778577">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778598">s</span><span class="op" id="5778599">,</span>&nbsp;<span class="ident" id="5778601">_</span>&nbsp;<span class="op" id="5778603">=</span>&nbsp;<span class="ident" id="5778605">p</span><span class="op" id="5778606">.</span><span class="ident" id="5778607">parseSimpleStmt</span><span class="op" id="5778622">(</span><span class="ident" id="5778623">labelOk</span><span class="op" id="5778630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778634">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778698">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778762">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778772">if</span>&nbsp;<span class="ident" id="5778775">_</span><span class="op" id="5778776">,</span>&nbsp;<span class="ident" id="5778778">isLabeledStmt</span>&nbsp;<span class="op" id="5778792">:=</span>&nbsp;<span class="ident" id="5778795">s</span><span class="op" id="5778796">.</span><span class="op" id="5778797">(</span><span class="op" id="5778798">*</span><span class="ident" id="5778799">ast</span><span class="op" id="5778802">.</span><span class="ident" id="5778803">LabeledStmt</span><span class="op" id="5778814">)</span><span class="op" id="5778815">;</span>&nbsp;<span class="op" id="5778817">!</span><span class="ident" id="5778818">isLabeledStmt</span>&nbsp;<span class="op" id="5778832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778837">p</span><span class="op" id="5778838">.</span><span class="ident" id="5778839">expectSemi</span><span class="op" id="5778849">(</span><span class="op" id="5778850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778854">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778857">case</span>&nbsp;<span class="ident" id="5778862">token</span><span class="op" id="5778867">.</span><span class="ident" id="5778868">GO</span><span class="op" id="5778870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778874">s</span>&nbsp;<span class="op" id="5778876">=</span>&nbsp;<span class="ident" id="5778878">p</span><span class="op" id="5778879">.</span><span class="ident" id="5778880">parseGoStmt</span><span class="op" id="5778891">(</span><span class="op" id="5778892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778895">case</span>&nbsp;<span class="ident" id="5778900">token</span><span class="op" id="5778905">.</span><span class="ident" id="5778906">DEFER</span><span class="op" id="5778911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778915">s</span>&nbsp;<span class="op" id="5778917">=</span>&nbsp;<span class="ident" id="5778919">p</span><span class="op" id="5778920">.</span><span class="ident" id="5778921">parseDeferStmt</span><span class="op" id="5778935">(</span><span class="op" id="5778936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778939">case</span>&nbsp;<span class="ident" id="5778944">token</span><span class="op" id="5778949">.</span><span class="ident" id="5778950">RETURN</span><span class="op" id="5778956">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778960">s</span>&nbsp;<span class="op" id="5778962">=</span>&nbsp;<span class="ident" id="5778964">p</span><span class="op" id="5778965">.</span><span class="ident" id="5778966">parseReturnStmt</span><span class="op" id="5778981">(</span><span class="op" id="5778982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778985">case</span>&nbsp;<span class="ident" id="5778990">token</span><span class="op" id="5778995">.</span><span class="ident" id="5778996">BREAK</span><span class="op" id="5779001">,</span>&nbsp;<span class="ident" id="5779003">token</span><span class="op" id="5779008">.</span><span class="ident" id="5779009">CONTINUE</span><span class="op" id="5779017">,</span>&nbsp;<span class="ident" id="5779019">token</span><span class="op" id="5779024">.</span><span class="ident" id="5779025">GOTO</span><span class="op" id="5779029">,</span>&nbsp;<span class="ident" id="5779031">token</span><span class="op" id="5779036">.</span><span class="ident" id="5779037">FALLTHROUGH</span><span class="op" id="5779048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779052">s</span>&nbsp;<span class="op" id="5779054">=</span>&nbsp;<span class="ident" id="5779056">p</span><span class="op" id="5779057">.</span><span class="ident" id="5779058">parseBranchStmt</span><span class="op" id="5779073">(</span><span class="ident" id="5779074">p</span><span class="op" id="5779075">.</span><span class="ident" id="5779076">tok</span><span class="op" id="5779079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779082">case</span>&nbsp;<span class="ident" id="5779087">token</span><span class="op" id="5779092">.</span><span class="ident" id="5779093">LBRACE</span><span class="op" id="5779099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779103">s</span>&nbsp;<span class="op" id="5779105">=</span>&nbsp;<span class="ident" id="5779107">p</span><span class="op" id="5779108">.</span><span class="ident" id="5779109">parseBlockStmt</span><span class="op" id="5779123">(</span><span class="op" id="5779124">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779128">p</span><span class="op" id="5779129">.</span><span class="ident" id="5779130">expectSemi</span><span class="op" id="5779140">(</span><span class="op" id="5779141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779144">case</span>&nbsp;<span class="ident" id="5779149">token</span><span class="op" id="5779154">.</span><span class="ident" id="5779155">IF</span><span class="op" id="5779157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779161">s</span>&nbsp;<span class="op" id="5779163">=</span>&nbsp;<span class="ident" id="5779165">p</span><span class="op" id="5779166">.</span><span class="ident" id="5779167">parseIfStmt</span><span class="op" id="5779178">(</span><span class="op" id="5779179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779182">case</span>&nbsp;<span class="ident" id="5779187">token</span><span class="op" id="5779192">.</span><span class="ident" id="5779193">SWITCH</span><span class="op" id="5779199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779203">s</span>&nbsp;<span class="op" id="5779205">=</span>&nbsp;<span class="ident" id="5779207">p</span><span class="op" id="5779208">.</span><span class="ident" id="5779209">parseSwitchStmt</span><span class="op" id="5779224">(</span><span class="op" id="5779225">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779228">case</span>&nbsp;<span class="ident" id="5779233">token</span><span class="op" id="5779238">.</span><span class="ident" id="5779239">SELECT</span><span class="op" id="5779245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779249">s</span>&nbsp;<span class="op" id="5779251">=</span>&nbsp;<span class="ident" id="5779253">p</span><span class="op" id="5779254">.</span><span class="ident" id="5779255">parseSelectStmt</span><span class="op" id="5779270">(</span><span class="op" id="5779271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779274">case</span>&nbsp;<span class="ident" id="5779279">token</span><span class="op" id="5779284">.</span><span class="ident" id="5779285">FOR</span><span class="op" id="5779288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779292">s</span>&nbsp;<span class="op" id="5779294">=</span>&nbsp;<span class="ident" id="5779296">p</span><span class="op" id="5779297">.</span><span class="ident" id="5779298">parseForStmt</span><span class="op" id="5779310">(</span><span class="op" id="5779311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779314">case</span>&nbsp;<span class="ident" id="5779319">token</span><span class="op" id="5779324">.</span><span class="ident" id="5779325">SEMICOLON</span><span class="op" id="5779334">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779338">s</span>&nbsp;<span class="op" id="5779340">=</span>&nbsp;<span class="op" id="5779342">&amp;</span><span class="ident" id="5779343">ast</span><span class="op" id="5779346">.</span><span class="ident" id="5779347">EmptyStmt</span><span class="op" id="5779356">{</span><span class="ident" id="5779357">Semicolon</span><span class="op" id="5779366">:</span>&nbsp;<span class="ident" id="5779368">p</span><span class="op" id="5779369">.</span><span class="ident" id="5779370">pos</span><span class="op" id="5779373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779377">p</span><span class="op" id="5779378">.</span><span class="ident" id="5779379">next</span><span class="op" id="5779383">(</span><span class="op" id="5779384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779387">case</span>&nbsp;<span class="ident" id="5779392">token</span><span class="op" id="5779397">.</span><span class="ident" id="5779398">RBRACE</span><span class="op" id="5779404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779408">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779461">s</span>&nbsp;<span class="op" id="5779463">=</span>&nbsp;<span class="op" id="5779465">&amp;</span><span class="ident" id="5779466">ast</span><span class="op" id="5779469">.</span><span class="ident" id="5779470">EmptyStmt</span><span class="op" id="5779479">{</span><span class="ident" id="5779480">Semicolon</span><span class="op" id="5779489">:</span>&nbsp;<span class="ident" id="5779491">p</span><span class="op" id="5779492">.</span><span class="ident" id="5779493">pos</span><span class="op" id="5779496">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779499">default</span><span class="op" id="5779506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779510">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779534">pos</span>&nbsp;<span class="op" id="5779538">:=</span>&nbsp;<span class="ident" id="5779541">p</span><span class="op" id="5779542">.</span><span class="ident" id="5779543">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779549">p</span><span class="op" id="5779550">.</span><span class="ident" id="5779551">errorExpected</span><span class="op" id="5779564">(</span><span class="ident" id="5779565">pos</span><span class="op" id="5779568">,</span>&nbsp;<span class="string" id="5779570">&#34;statement&#34;</span><span class="op" id="5779581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779585">syncStmt</span><span class="op" id="5779593">(</span><span class="ident" id="5779594">p</span><span class="op" id="5779595">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779599">s</span>&nbsp;<span class="op" id="5779601">=</span>&nbsp;<span class="op" id="5779603">&amp;</span><span class="ident" id="5779604">ast</span><span class="op" id="5779607">.</span><span class="ident" id="5779608">BadStmt</span><span class="op" id="5779615">{</span><span class="ident" id="5779616">From</span><span class="op" id="5779620">:</span>&nbsp;<span class="ident" id="5779622">pos</span><span class="op" id="5779625">,</span>&nbsp;<span class="ident" id="5779627">To</span><span class="op" id="5779629">:</span>&nbsp;<span class="ident" id="5779631">p</span><span class="op" id="5779632">.</span><span class="ident" id="5779633">pos</span><span class="op" id="5779636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779643">return</span><br>
<span class="lineno"></span><span class="op" id="5779650">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="5779653">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5779733">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5779750">type</span>&nbsp;<span class="ident" id="5779755">parseSpecFunction</span>&nbsp;<span class="keyword" id="5779773">func</span><span class="op" id="5779777">(</span><span class="ident" id="5779778">doc</span>&nbsp;<span class="op" id="5779782">*</span><span class="ident" id="5779783">ast</span><span class="op" id="5779786">.</span><span class="ident" id="5779787">CommentGroup</span><span class="op" id="5779799">,</span>&nbsp;<span class="ident" id="5779801">keyword</span>&nbsp;<span class="ident" id="5779809">token</span><span class="op" id="5779814">.</span><span class="ident" id="5779815">Token</span><span class="op" id="5779820">,</span>&nbsp;<span class="ident" id="5779822">iota</span>&nbsp;<span class="builtintype" id="5779827">int</span><span class="op" id="5779830">)</span>&nbsp;<span class="ident" id="5779832">ast</span><span class="op" id="5779835">.</span><span class="ident" id="5779836">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="5779842">func</span>&nbsp;<span class="ident" id="5779847">isValidImport</span><span class="op" id="5779860">(</span><span class="ident" id="5779861">lit</span>&nbsp;<span class="builtintype" id="5779865">string</span><span class="op" id="5779871">)</span>&nbsp;<span class="builtintype" id="5779873">bool</span>&nbsp;<span class="op" id="5779878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779881">const</span>&nbsp;<span class="ident" id="5779887">illegalChars</span>&nbsp;<span class="op" id="5779900">=</span>&nbsp;<span class="string" id="5779902">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="5779929">+</span>&nbsp;<span class="string" id="5779931">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779942">s</span><span class="op" id="5779943">,</span>&nbsp;<span class="ident" id="5779945">_</span>&nbsp;<span class="op" id="5779947">:=</span>&nbsp;<span class="ident" id="5779950">strconv</span><span class="op" id="5779957">.</span><span class="ident" id="5779958">Unquote</span><span class="op" id="5779965">(</span><span class="ident" id="5779966">lit</span><span class="op" id="5779969">)</span>&nbsp;<span class="comment" id="5779971">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780017">for</span>&nbsp;<span class="ident" id="5780021">_</span><span class="op" id="5780022">,</span>&nbsp;<span class="ident" id="5780024">r</span>&nbsp;<span class="op" id="5780026">:=</span>&nbsp;<span class="keyword" id="5780029">range</span>&nbsp;<span class="ident" id="5780035">s</span>&nbsp;<span class="op" id="5780037">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780041">if</span>&nbsp;<span class="op" id="5780044">!</span><span class="ident" id="5780045">unicode</span><span class="op" id="5780052">.</span><span class="ident" id="5780053">IsGraphic</span><span class="op" id="5780062">(</span><span class="ident" id="5780063">r</span><span class="op" id="5780064">)</span>&nbsp;<span class="op" id="5780066">||</span>&nbsp;<span class="ident" id="5780069">unicode</span><span class="op" id="5780076">.</span><span class="ident" id="5780077">IsSpace</span><span class="op" id="5780084">(</span><span class="ident" id="5780085">r</span><span class="op" id="5780086">)</span>&nbsp;<span class="op" id="5780088">||</span>&nbsp;<span class="ident" id="5780091">strings</span><span class="op" id="5780098">.</span><span class="ident" id="5780099">ContainsRune</span><span class="op" id="5780111">(</span><span class="ident" id="5780112">illegalChars</span><span class="op" id="5780124">,</span>&nbsp;<span class="ident" id="5780126">r</span><span class="op" id="5780127">)</span>&nbsp;<span class="op" id="5780129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780134">return</span>&nbsp;<span class="builtintype" id="5780141">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780155">return</span>&nbsp;<span class="ident" id="5780162">s</span>&nbsp;<span class="op" id="5780164">!=</span>&nbsp;<span class="string" id="5780167">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="5780170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5780173">func</span>&nbsp;<span class="op" id="5780178">(</span><span class="ident" id="5780179">p</span>&nbsp;<span class="op" id="5780181">*</span><span class="ident" id="5780182">parser</span><span class="op" id="5780188">)</span>&nbsp;<span class="ident" id="5780190">parseImportSpec</span><span class="op" id="5780205">(</span><span class="ident" id="5780206">doc</span>&nbsp;<span class="op" id="5780210">*</span><span class="ident" id="5780211">ast</span><span class="op" id="5780214">.</span><span class="ident" id="5780215">CommentGroup</span><span class="op" id="5780227">,</span>&nbsp;<span class="ident" id="5780229">_</span>&nbsp;<span class="ident" id="5780231">token</span><span class="op" id="5780236">.</span><span class="ident" id="5780237">Token</span><span class="op" id="5780242">,</span>&nbsp;<span class="ident" id="5780244">_</span>&nbsp;<span class="builtintype" id="5780246">int</span><span class="op" id="5780249">)</span>&nbsp;<span class="ident" id="5780251">ast</span><span class="op" id="5780254">.</span><span class="ident" id="5780255">Spec</span>&nbsp;<span class="op" id="5780260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780263">if</span>&nbsp;<span class="ident" id="5780266">p</span><span class="op" id="5780267">.</span><span class="ident" id="5780268">trace</span>&nbsp;<span class="op" id="5780274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780278">defer</span>&nbsp;<span class="ident" id="5780284">un</span><span class="op" id="5780286">(</span><span class="ident" id="5780287">trace</span><span class="op" id="5780292">(</span><span class="ident" id="5780293">p</span><span class="op" id="5780294">,</span>&nbsp;<span class="string" id="5780296">&#34;ImportSpec&#34;</span><span class="op" id="5780308">)</span><span class="op" id="5780309">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780316">var</span>&nbsp;<span class="ident" id="5780320">ident</span>&nbsp;<span class="op" id="5780326">*</span><span class="ident" id="5780327">ast</span><span class="op" id="5780330">.</span><span class="ident" id="5780331">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780338">switch</span>&nbsp;<span class="ident" id="5780345">p</span><span class="op" id="5780346">.</span><span class="ident" id="5780347">tok</span>&nbsp;<span class="op" id="5780351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780354">case</span>&nbsp;<span class="ident" id="5780359">token</span><span class="op" id="5780364">.</span><span class="ident" id="5780365">PERIOD</span><span class="op" id="5780371">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780375">ident</span>&nbsp;<span class="op" id="5780381">=</span>&nbsp;<span class="op" id="5780383">&amp;</span><span class="ident" id="5780384">ast</span><span class="op" id="5780387">.</span><span class="ident" id="5780388">Ident</span><span class="op" id="5780393">{</span><span class="ident" id="5780394">NamePos</span><span class="op" id="5780401">:</span>&nbsp;<span class="ident" id="5780403">p</span><span class="op" id="5780404">.</span><span class="ident" id="5780405">pos</span><span class="op" id="5780408">,</span>&nbsp;<span class="ident" id="5780410">Name</span><span class="op" id="5780414">:</span>&nbsp;<span class="string" id="5780416">&#34;.&#34;</span><span class="op" id="5780419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780423">p</span><span class="op" id="5780424">.</span><span class="ident" id="5780425">next</span><span class="op" id="5780429">(</span><span class="op" id="5780430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780433">case</span>&nbsp;<span class="ident" id="5780438">token</span><span class="op" id="5780443">.</span><span class="ident" id="5780444">IDENT</span><span class="op" id="5780449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780453">ident</span>&nbsp;<span class="op" id="5780459">=</span>&nbsp;<span class="ident" id="5780461">p</span><span class="op" id="5780462">.</span><span class="ident" id="5780463">parseIdent</span><span class="op" id="5780473">(</span><span class="op" id="5780474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780477">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780481">pos</span>&nbsp;<span class="op" id="5780485">:=</span>&nbsp;<span class="ident" id="5780488">p</span><span class="op" id="5780489">.</span><span class="ident" id="5780490">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780495">var</span>&nbsp;<span class="ident" id="5780499">path</span>&nbsp;<span class="builtintype" id="5780504">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780512">if</span>&nbsp;<span class="ident" id="5780515">p</span><span class="op" id="5780516">.</span><span class="ident" id="5780517">tok</span>&nbsp;<span class="op" id="5780521">==</span>&nbsp;<span class="ident" id="5780524">token</span><span class="op" id="5780529">.</span><span class="ident" id="5780530">STRING</span>&nbsp;<span class="op" id="5780537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780541">path</span>&nbsp;<span class="op" id="5780546">=</span>&nbsp;<span class="ident" id="5780548">p</span><span class="op" id="5780549">.</span><span class="ident" id="5780550">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780556">if</span>&nbsp;<span class="op" id="5780559">!</span><span class="ident" id="5780560">isValidImport</span><span class="op" id="5780573">(</span><span class="ident" id="5780574">path</span><span class="op" id="5780578">)</span>&nbsp;<span class="op" id="5780580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780585">p</span><span class="op" id="5780586">.</span><span class="builtintype" id="5780587">error</span><span class="op" id="5780592">(</span><span class="ident" id="5780593">pos</span><span class="op" id="5780596">,</span>&nbsp;<span class="string" id="5780598">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="5780621">+</span><span class="ident" id="5780622">path</span><span class="op" id="5780626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780634">p</span><span class="op" id="5780635">.</span><span class="ident" id="5780636">next</span><span class="op" id="5780640">(</span><span class="op" id="5780641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780644">}</span>&nbsp;<span class="keyword" id="5780646">else</span>&nbsp;<span class="op" id="5780651">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780655">p</span><span class="op" id="5780656">.</span><span class="ident" id="5780657">expect</span><span class="op" id="5780663">(</span><span class="ident" id="5780664">token</span><span class="op" id="5780669">.</span><span class="ident" id="5780670">STRING</span><span class="op" id="5780676">)</span>&nbsp;<span class="comment" id="5780678">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780713">p</span><span class="op" id="5780714">.</span><span class="ident" id="5780715">expectSemi</span><span class="op" id="5780725">(</span><span class="op" id="5780726">)</span>&nbsp;<span class="comment" id="5780728">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780769">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780789">spec</span>&nbsp;<span class="op" id="5780794">:=</span>&nbsp;<span class="op" id="5780797">&amp;</span><span class="ident" id="5780798">ast</span><span class="op" id="5780801">.</span><span class="ident" id="5780802">ImportSpec</span><span class="op" id="5780812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780816">Doc</span><span class="op" id="5780819">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780825">doc</span><span class="op" id="5780828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780832">Name</span><span class="op" id="5780836">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780841">ident</span><span class="op" id="5780846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780850">Path</span><span class="op" id="5780854">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5780859">&amp;</span><span class="ident" id="5780860">ast</span><span class="op" id="5780863">.</span><span class="ident" id="5780864">BasicLit</span><span class="op" id="5780872">{</span><span class="ident" id="5780873">ValuePos</span><span class="op" id="5780881">:</span>&nbsp;<span class="ident" id="5780883">pos</span><span class="op" id="5780886">,</span>&nbsp;<span class="ident" id="5780888">Kind</span><span class="op" id="5780892">:</span>&nbsp;<span class="ident" id="5780894">token</span><span class="op" id="5780899">.</span><span class="ident" id="5780900">STRING</span><span class="op" id="5780906">,</span>&nbsp;<span class="ident" id="5780908">Value</span><span class="op" id="5780913">:</span>&nbsp;<span class="ident" id="5780915">path</span><span class="op" id="5780919">}</span><span class="op" id="5780920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780924">Comment</span><span class="op" id="5780931">:</span>&nbsp;<span class="ident" id="5780933">p</span><span class="op" id="5780934">.</span><span class="ident" id="5780935">lineComment</span><span class="op" id="5780946">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780952">p</span><span class="op" id="5780953">.</span><span class="ident" id="5780954">imports</span>&nbsp;<span class="op" id="5780962">=</span>&nbsp;<span class="builtinfunc" id="5780964">append</span><span class="op" id="5780970">(</span><span class="ident" id="5780971">p</span><span class="op" id="5780972">.</span><span class="ident" id="5780973">imports</span><span class="op" id="5780980">,</span>&nbsp;<span class="ident" id="5780982">spec</span><span class="op" id="5780986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780990">return</span>&nbsp;<span class="ident" id="5780997">spec</span><br>
<span class="lineno"></span><span class="op" id="5781002">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="5781005">func</span>&nbsp;<span class="op" id="5781010">(</span><span class="ident" id="5781011">p</span>&nbsp;<span class="op" id="5781013">*</span><span class="ident" id="5781014">parser</span><span class="op" id="5781020">)</span>&nbsp;<span class="ident" id="5781022">parseValueSpec</span><span class="op" id="5781036">(</span><span class="ident" id="5781037">doc</span>&nbsp;<span class="op" id="5781041">*</span><span class="ident" id="5781042">ast</span><span class="op" id="5781045">.</span><span class="ident" id="5781046">CommentGroup</span><span class="op" id="5781058">,</span>&nbsp;<span class="ident" id="5781060">keyword</span>&nbsp;<span class="ident" id="5781068">token</span><span class="op" id="5781073">.</span><span class="ident" id="5781074">Token</span><span class="op" id="5781079">,</span>&nbsp;<span class="ident" id="5781081">iota</span>&nbsp;<span class="builtintype" id="5781086">int</span><span class="op" id="5781089">)</span>&nbsp;<span class="ident" id="5781091">ast</span><span class="op" id="5781094">.</span><span class="ident" id="5781095">Spec</span>&nbsp;<span class="op" id="5781100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781103">if</span>&nbsp;<span class="ident" id="5781106">p</span><span class="op" id="5781107">.</span><span class="ident" id="5781108">trace</span>&nbsp;<span class="op" id="5781114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781118">defer</span>&nbsp;<span class="ident" id="5781124">un</span><span class="op" id="5781126">(</span><span class="ident" id="5781127">trace</span><span class="op" id="5781132">(</span><span class="ident" id="5781133">p</span><span class="op" id="5781134">,</span>&nbsp;<span class="ident" id="5781136">keyword</span><span class="op" id="5781143">.</span><span class="ident" id="5781144">String</span><span class="op" id="5781150">(</span><span class="op" id="5781151">)</span><span class="op" id="5781152">+</span><span class="string" id="5781153">&#34;Spec&#34;</span><span class="op" id="5781159">)</span><span class="op" id="5781160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781163">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781167">idents</span>&nbsp;<span class="op" id="5781174">:=</span>&nbsp;<span class="ident" id="5781177">p</span><span class="op" id="5781178">.</span><span class="ident" id="5781179">parseIdentList</span><span class="op" id="5781193">(</span><span class="op" id="5781194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781197">typ</span>&nbsp;<span class="op" id="5781201">:=</span>&nbsp;<span class="ident" id="5781204">p</span><span class="op" id="5781205">.</span><span class="ident" id="5781206">tryType</span><span class="op" id="5781213">(</span><span class="op" id="5781214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781217">var</span>&nbsp;<span class="ident" id="5781221">values</span>&nbsp;<span class="op" id="5781228">[</span><span class="op" id="5781229">]</span><span class="ident" id="5781230">ast</span><span class="op" id="5781233">.</span><span class="ident" id="5781234">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781240">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781308">if</span>&nbsp;<span class="ident" id="5781311">p</span><span class="op" id="5781312">.</span><span class="ident" id="5781313">tok</span>&nbsp;<span class="op" id="5781317">==</span>&nbsp;<span class="ident" id="5781320">token</span><span class="op" id="5781325">.</span><span class="ident" id="5781326">ASSIGN</span>&nbsp;<span class="op" id="5781333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781337">p</span><span class="op" id="5781338">.</span><span class="ident" id="5781339">next</span><span class="op" id="5781343">(</span><span class="op" id="5781344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781348">values</span>&nbsp;<span class="op" id="5781355">=</span>&nbsp;<span class="ident" id="5781357">p</span><span class="op" id="5781358">.</span><span class="ident" id="5781359">parseRhsList</span><span class="op" id="5781371">(</span><span class="op" id="5781372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781378">p</span><span class="op" id="5781379">.</span><span class="ident" id="5781380">expectSemi</span><span class="op" id="5781390">(</span><span class="op" id="5781391">)</span>&nbsp;<span class="comment" id="5781393">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781434">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781510">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781583">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781630">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781703">spec</span>&nbsp;<span class="op" id="5781708">:=</span>&nbsp;<span class="op" id="5781711">&amp;</span><span class="ident" id="5781712">ast</span><span class="op" id="5781715">.</span><span class="ident" id="5781716">ValueSpec</span><span class="op" id="5781725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781729">Doc</span><span class="op" id="5781732">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781738">doc</span><span class="op" id="5781741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781745">Names</span><span class="op" id="5781750">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5781754">idents</span><span class="op" id="5781760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781764">Type</span><span class="op" id="5781768">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781773">typ</span><span class="op" id="5781776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781780">Values</span><span class="op" id="5781786">:</span>&nbsp;&nbsp;<span class="ident" id="5781789">values</span><span class="op" id="5781795">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781799">Comment</span><span class="op" id="5781806">:</span>&nbsp;<span class="ident" id="5781808">p</span><span class="op" id="5781809">.</span><span class="ident" id="5781810">lineComment</span><span class="op" id="5781821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781827">kind</span>&nbsp;<span class="op" id="5781832">:=</span>&nbsp;<span class="ident" id="5781835">ast</span><span class="op" id="5781838">.</span><span class="ident" id="5781839">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781844">if</span>&nbsp;<span class="ident" id="5781847">keyword</span>&nbsp;<span class="op" id="5781855">==</span>&nbsp;<span class="ident" id="5781858">token</span><span class="op" id="5781863">.</span><span class="ident" id="5781864">VAR</span>&nbsp;<span class="op" id="5781868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781872">kind</span>&nbsp;<span class="op" id="5781877">=</span>&nbsp;<span class="ident" id="5781879">ast</span><span class="op" id="5781882">.</span><span class="ident" id="5781883">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781891">p</span><span class="op" id="5781892">.</span><span class="ident" id="5781893">declare</span><span class="op" id="5781900">(</span><span class="ident" id="5781901">spec</span><span class="op" id="5781905">,</span>&nbsp;<span class="ident" id="5781907">iota</span><span class="op" id="5781911">,</span>&nbsp;<span class="ident" id="5781913">p</span><span class="op" id="5781914">.</span><span class="ident" id="5781915">topScope</span><span class="op" id="5781923">,</span>&nbsp;<span class="ident" id="5781925">kind</span><span class="op" id="5781929">,</span>&nbsp;<span class="ident" id="5781931">idents</span><span class="op" id="5781937">...</span><span class="op" id="5781940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781944">return</span>&nbsp;<span class="ident" id="5781951">spec</span><br>
<span class="lineno"></span><span class="op" id="5781956">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="5781959">func</span>&nbsp;<span class="op" id="5781964">(</span><span class="ident" id="5781965">p</span>&nbsp;<span class="op" id="5781967">*</span><span class="ident" id="5781968">parser</span><span class="op" id="5781974">)</span>&nbsp;<span class="ident" id="5781976">parseTypeSpec</span><span class="op" id="5781989">(</span><span class="ident" id="5781990">doc</span>&nbsp;<span class="op" id="5781994">*</span><span class="ident" id="5781995">ast</span><span class="op" id="5781998">.</span><span class="ident" id="5781999">CommentGroup</span><span class="op" id="5782011">,</span>&nbsp;<span class="ident" id="5782013">_</span>&nbsp;<span class="ident" id="5782015">token</span><span class="op" id="5782020">.</span><span class="ident" id="5782021">Token</span><span class="op" id="5782026">,</span>&nbsp;<span class="ident" id="5782028">_</span>&nbsp;<span class="builtintype" id="5782030">int</span><span class="op" id="5782033">)</span>&nbsp;<span class="ident" id="5782035">ast</span><span class="op" id="5782038">.</span><span class="ident" id="5782039">Spec</span>&nbsp;<span class="op" id="5782044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782047">if</span>&nbsp;<span class="ident" id="5782050">p</span><span class="op" id="5782051">.</span><span class="ident" id="5782052">trace</span>&nbsp;<span class="op" id="5782058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782062">defer</span>&nbsp;<span class="ident" id="5782068">un</span><span class="op" id="5782070">(</span><span class="ident" id="5782071">trace</span><span class="op" id="5782076">(</span><span class="ident" id="5782077">p</span><span class="op" id="5782078">,</span>&nbsp;<span class="string" id="5782080">&#34;TypeSpec&#34;</span><span class="op" id="5782090">)</span><span class="op" id="5782091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782094">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782098">ident</span>&nbsp;<span class="op" id="5782104">:=</span>&nbsp;<span class="ident" id="5782107">p</span><span class="op" id="5782108">.</span><span class="ident" id="5782109">parseIdent</span><span class="op" id="5782119">(</span><span class="op" id="5782120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782124">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782202">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782277">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782299">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782372">spec</span>&nbsp;<span class="op" id="5782377">:=</span>&nbsp;<span class="op" id="5782380">&amp;</span><span class="ident" id="5782381">ast</span><span class="op" id="5782384">.</span><span class="ident" id="5782385">TypeSpec</span><span class="op" id="5782393">{</span><span class="ident" id="5782394">Doc</span><span class="op" id="5782397">:</span>&nbsp;<span class="ident" id="5782399">doc</span><span class="op" id="5782402">,</span>&nbsp;<span class="ident" id="5782404">Name</span><span class="op" id="5782408">:</span>&nbsp;<span class="ident" id="5782410">ident</span><span class="op" id="5782415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782418">p</span><span class="op" id="5782419">.</span><span class="ident" id="5782420">declare</span><span class="op" id="5782427">(</span><span class="ident" id="5782428">spec</span><span class="op" id="5782432">,</span>&nbsp;<span class="ident" id="5782434">nil</span><span class="op" id="5782437">,</span>&nbsp;<span class="ident" id="5782439">p</span><span class="op" id="5782440">.</span><span class="ident" id="5782441">topScope</span><span class="op" id="5782449">,</span>&nbsp;<span class="ident" id="5782451">ast</span><span class="op" id="5782454">.</span><span class="ident" id="5782455">Typ</span><span class="op" id="5782458">,</span>&nbsp;<span class="ident" id="5782460">ident</span><span class="op" id="5782465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782469">spec</span><span class="op" id="5782473">.</span><span class="ident" id="5782474">Type</span>&nbsp;<span class="op" id="5782479">=</span>&nbsp;<span class="ident" id="5782481">p</span><span class="op" id="5782482">.</span><span class="ident" id="5782483">parseType</span><span class="op" id="5782492">(</span><span class="op" id="5782493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782496">p</span><span class="op" id="5782497">.</span><span class="ident" id="5782498">expectSemi</span><span class="op" id="5782508">(</span><span class="op" id="5782509">)</span>&nbsp;<span class="comment" id="5782511">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782551">spec</span><span class="op" id="5782555">.</span><span class="ident" id="5782556">Comment</span>&nbsp;<span class="op" id="5782564">=</span>&nbsp;<span class="ident" id="5782566">p</span><span class="op" id="5782567">.</span><span class="ident" id="5782568">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782582">return</span>&nbsp;<span class="ident" id="5782589">spec</span><br>
<span class="lineno">2280</span><span class="op" id="5782594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5782597">func</span>&nbsp;<span class="op" id="5782602">(</span><span class="ident" id="5782603">p</span>&nbsp;<span class="op" id="5782605">*</span><span class="ident" id="5782606">parser</span><span class="op" id="5782612">)</span>&nbsp;<span class="ident" id="5782614">parseGenDecl</span><span class="op" id="5782626">(</span><span class="ident" id="5782627">keyword</span>&nbsp;<span class="ident" id="5782635">token</span><span class="op" id="5782640">.</span><span class="ident" id="5782641">Token</span><span class="op" id="5782646">,</span>&nbsp;<span class="ident" id="5782648">f</span>&nbsp;<span class="ident" id="5782650">parseSpecFunction</span><span class="op" id="5782667">)</span>&nbsp;<span class="op" id="5782669">*</span><span class="ident" id="5782670">ast</span><span class="op" id="5782673">.</span><span class="ident" id="5782674">GenDecl</span>&nbsp;<span class="op" id="5782682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782685">if</span>&nbsp;<span class="ident" id="5782688">p</span><span class="op" id="5782689">.</span><span class="ident" id="5782690">trace</span>&nbsp;<span class="op" id="5782696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782700">defer</span>&nbsp;<span class="ident" id="5782706">un</span><span class="op" id="5782708">(</span><span class="ident" id="5782709">trace</span><span class="op" id="5782714">(</span><span class="ident" id="5782715">p</span><span class="op" id="5782716">,</span>&nbsp;<span class="string" id="5782718">&#34;GenDecl(&#34;</span><span class="op" id="5782728">+</span><span class="ident" id="5782729">keyword</span><span class="op" id="5782736">.</span><span class="ident" id="5782737">String</span><span class="op" id="5782743">(</span><span class="op" id="5782744">)</span><span class="op" id="5782745">+</span><span class="string" id="5782746">&#34;)&#34;</span><span class="op" id="5782749">)</span><span class="op" id="5782750">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782757">doc</span>&nbsp;<span class="op" id="5782761">:=</span>&nbsp;<span class="ident" id="5782764">p</span><span class="op" id="5782765">.</span><span class="ident" id="5782766">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782779">pos</span>&nbsp;<span class="op" id="5782783">:=</span>&nbsp;<span class="ident" id="5782786">p</span><span class="op" id="5782787">.</span><span class="ident" id="5782788">expect</span><span class="op" id="5782794">(</span><span class="ident" id="5782795">keyword</span><span class="op" id="5782802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782805">var</span>&nbsp;<span class="ident" id="5782809">lparen</span><span class="op" id="5782815">,</span>&nbsp;<span class="ident" id="5782817">rparen</span>&nbsp;<span class="ident" id="5782824">token</span><span class="op" id="5782829">.</span><span class="ident" id="5782830">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782835">var</span>&nbsp;<span class="ident" id="5782839">list</span>&nbsp;<span class="op" id="5782844">[</span><span class="op" id="5782845">]</span><span class="ident" id="5782846">ast</span><span class="op" id="5782849">.</span><span class="ident" id="5782850">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782856">if</span>&nbsp;<span class="ident" id="5782859">p</span><span class="op" id="5782860">.</span><span class="ident" id="5782861">tok</span>&nbsp;<span class="op" id="5782865">==</span>&nbsp;<span class="ident" id="5782868">token</span><span class="op" id="5782873">.</span><span class="ident" id="5782874">LPAREN</span>&nbsp;<span class="op" id="5782881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782885">lparen</span>&nbsp;<span class="op" id="5782892">=</span>&nbsp;<span class="ident" id="5782894">p</span><span class="op" id="5782895">.</span><span class="ident" id="5782896">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782902">p</span><span class="op" id="5782903">.</span><span class="ident" id="5782904">next</span><span class="op" id="5782908">(</span><span class="op" id="5782909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782913">for</span>&nbsp;<span class="ident" id="5782917">iota</span>&nbsp;<span class="op" id="5782922">:=</span>&nbsp;<span class="num" id="5782925">0</span><span class="op" id="5782926">;</span>&nbsp;<span class="ident" id="5782928">p</span><span class="op" id="5782929">.</span><span class="ident" id="5782930">tok</span>&nbsp;<span class="op" id="5782934">!=</span>&nbsp;<span class="ident" id="5782937">token</span><span class="op" id="5782942">.</span><span class="ident" id="5782943">RPAREN</span>&nbsp;<span class="op" id="5782950">&amp;&amp;</span>&nbsp;<span class="ident" id="5782953">p</span><span class="op" id="5782954">.</span><span class="ident" id="5782955">tok</span>&nbsp;<span class="op" id="5782959">!=</span>&nbsp;<span class="ident" id="5782962">token</span><span class="op" id="5782967">.</span><span class="ident" id="5782968">EOF</span><span class="op" id="5782971">;</span>&nbsp;<span class="ident" id="5782973">iota</span><span class="op" id="5782977">++</span>&nbsp;<span class="op" id="5782980">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782985">list</span>&nbsp;<span class="op" id="5782990">=</span>&nbsp;<span class="builtinfunc" id="5782992">append</span><span class="op" id="5782998">(</span><span class="ident" id="5782999">list</span><span class="op" id="5783003">,</span>&nbsp;<span class="ident" id="5783005">f</span><span class="op" id="5783006">(</span><span class="ident" id="5783007">p</span><span class="op" id="5783008">.</span><span class="ident" id="5783009">leadComment</span><span class="op" id="5783020">,</span>&nbsp;<span class="ident" id="5783022">keyword</span><span class="op" id="5783029">,</span>&nbsp;<span class="ident" id="5783031">iota</span><span class="op" id="5783035">)</span><span class="op" id="5783036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783044">rparen</span>&nbsp;<span class="op" id="5783051">=</span>&nbsp;<span class="ident" id="5783053">p</span><span class="op" id="5783054">.</span><span class="ident" id="5783055">expect</span><span class="op" id="5783061">(</span><span class="ident" id="5783062">token</span><span class="op" id="5783067">.</span><span class="ident" id="5783068">RPAREN</span><span class="op" id="5783074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783078">p</span><span class="op" id="5783079">.</span><span class="ident" id="5783080">expectSemi</span><span class="op" id="5783090">(</span><span class="op" id="5783091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783094">}</span>&nbsp;<span class="keyword" id="5783096">else</span>&nbsp;<span class="op" id="5783101">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783105">list</span>&nbsp;<span class="op" id="5783110">=</span>&nbsp;<span class="builtinfunc" id="5783112">append</span><span class="op" id="5783118">(</span><span class="ident" id="5783119">list</span><span class="op" id="5783123">,</span>&nbsp;<span class="ident" id="5783125">f</span><span class="op" id="5783126">(</span><span class="ident" id="5783127">nil</span><span class="op" id="5783130">,</span>&nbsp;<span class="ident" id="5783132">keyword</span><span class="op" id="5783139">,</span>&nbsp;<span class="num" id="5783141">0</span><span class="op" id="5783142">)</span><span class="op" id="5783143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783150">return</span>&nbsp;<span class="op" id="5783157">&amp;</span><span class="ident" id="5783158">ast</span><span class="op" id="5783161">.</span><span class="ident" id="5783162">GenDecl</span><span class="op" id="5783169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783173">Doc</span><span class="op" id="5783176">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5783181">doc</span><span class="op" id="5783184">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783188">TokPos</span><span class="op" id="5783194">:</span>&nbsp;<span class="ident" id="5783196">pos</span><span class="op" id="5783199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783203">Tok</span><span class="op" id="5783206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5783211">keyword</span><span class="op" id="5783218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783222">Lparen</span><span class="op" id="5783228">:</span>&nbsp;<span class="ident" id="5783230">lparen</span><span class="op" id="5783236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783240">Specs</span><span class="op" id="5783245">:</span>&nbsp;&nbsp;<span class="ident" id="5783248">list</span><span class="op" id="5783252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783256">Rparen</span><span class="op" id="5783262">:</span>&nbsp;<span class="ident" id="5783264">rparen</span><span class="op" id="5783270">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783273">}</span><br>
<span class="lineno"></span><span class="op" id="5783275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5783278">func</span>&nbsp;<span class="op" id="5783283">(</span><span class="ident" id="5783284">p</span>&nbsp;<span class="op" id="5783286">*</span><span class="ident" id="5783287">parser</span><span class="op" id="5783293">)</span>&nbsp;<span class="ident" id="5783295">parseFuncDecl</span><span class="op" id="5783308">(</span><span class="op" id="5783309">)</span>&nbsp;<span class="op" id="5783311">*</span><span class="ident" id="5783312">ast</span><span class="op" id="5783315">.</span><span class="ident" id="5783316">FuncDecl</span>&nbsp;<span class="op" id="5783325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783328">if</span>&nbsp;<span class="ident" id="5783331">p</span><span class="op" id="5783332">.</span><span class="ident" id="5783333">trace</span>&nbsp;<span class="op" id="5783339">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783343">defer</span>&nbsp;<span class="ident" id="5783349">un</span><span class="op" id="5783351">(</span><span class="ident" id="5783352">trace</span><span class="op" id="5783357">(</span><span class="ident" id="5783358">p</span><span class="op" id="5783359">,</span>&nbsp;<span class="string" id="5783361">&#34;FunctionDecl&#34;</span><span class="op" id="5783375">)</span><span class="op" id="5783376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783383">doc</span>&nbsp;<span class="op" id="5783387">:=</span>&nbsp;<span class="ident" id="5783390">p</span><span class="op" id="5783391">.</span><span class="ident" id="5783392">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783405">pos</span>&nbsp;<span class="op" id="5783409">:=</span>&nbsp;<span class="ident" id="5783412">p</span><span class="op" id="5783413">.</span><span class="ident" id="5783414">expect</span><span class="op" id="5783420">(</span><span class="ident" id="5783421">token</span><span class="op" id="5783426">.</span><span class="ident" id="5783427">FUNC</span><span class="op" id="5783431">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783434">scope</span>&nbsp;<span class="op" id="5783440">:=</span>&nbsp;<span class="ident" id="5783443">ast</span><span class="op" id="5783446">.</span><span class="ident" id="5783447">NewScope</span><span class="op" id="5783455">(</span><span class="ident" id="5783456">p</span><span class="op" id="5783457">.</span><span class="ident" id="5783458">topScope</span><span class="op" id="5783466">)</span>&nbsp;<span class="comment" id="5783468">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783488">var</span>&nbsp;<span class="ident" id="5783492">recv</span>&nbsp;<span class="op" id="5783497">*</span><span class="ident" id="5783498">ast</span><span class="op" id="5783501">.</span><span class="ident" id="5783502">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783513">if</span>&nbsp;<span class="ident" id="5783516">p</span><span class="op" id="5783517">.</span><span class="ident" id="5783518">tok</span>&nbsp;<span class="op" id="5783522">==</span>&nbsp;<span class="ident" id="5783525">token</span><span class="op" id="5783530">.</span><span class="ident" id="5783531">LPAREN</span>&nbsp;<span class="op" id="5783538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783542">recv</span>&nbsp;<span class="op" id="5783547">=</span>&nbsp;<span class="ident" id="5783549">p</span><span class="op" id="5783550">.</span><span class="ident" id="5783551">parseParameters</span><span class="op" id="5783566">(</span><span class="ident" id="5783567">scope</span><span class="op" id="5783572">,</span>&nbsp;<span class="builtintype" id="5783574">false</span><span class="op" id="5783579">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783586">ident</span>&nbsp;<span class="op" id="5783592">:=</span>&nbsp;<span class="ident" id="5783595">p</span><span class="op" id="5783596">.</span><span class="ident" id="5783597">parseIdent</span><span class="op" id="5783607">(</span><span class="op" id="5783608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783612">params</span><span class="op" id="5783618">,</span>&nbsp;<span class="ident" id="5783620">results</span>&nbsp;<span class="op" id="5783628">:=</span>&nbsp;<span class="ident" id="5783631">p</span><span class="op" id="5783632">.</span><span class="ident" id="5783633">parseSignature</span><span class="op" id="5783647">(</span><span class="ident" id="5783648">scope</span><span class="op" id="5783653">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783657">var</span>&nbsp;<span class="ident" id="5783661">body</span>&nbsp;<span class="op" id="5783666">*</span><span class="ident" id="5783667">ast</span><span class="op" id="5783670">.</span><span class="ident" id="5783671">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783682">if</span>&nbsp;<span class="ident" id="5783685">p</span><span class="op" id="5783686">.</span><span class="ident" id="5783687">tok</span>&nbsp;<span class="op" id="5783691">==</span>&nbsp;<span class="ident" id="5783694">token</span><span class="op" id="5783699">.</span><span class="ident" id="5783700">LBRACE</span>&nbsp;<span class="op" id="5783707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783711">body</span>&nbsp;<span class="op" id="5783716">=</span>&nbsp;<span class="ident" id="5783718">p</span><span class="op" id="5783719">.</span><span class="ident" id="5783720">parseBody</span><span class="op" id="5783729">(</span><span class="ident" id="5783730">scope</span><span class="op" id="5783735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783738">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783741">p</span><span class="op" id="5783742">.</span><span class="ident" id="5783743">expectSemi</span><span class="op" id="5783753">(</span><span class="op" id="5783754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783758">decl</span>&nbsp;<span class="op" id="5783763">:=</span>&nbsp;<span class="op" id="5783766">&amp;</span><span class="ident" id="5783767">ast</span><span class="op" id="5783770">.</span><span class="ident" id="5783771">FuncDecl</span><span class="op" id="5783779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783783">Doc</span><span class="op" id="5783786">:</span>&nbsp;&nbsp;<span class="ident" id="5783789">doc</span><span class="op" id="5783792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783796">Recv</span><span class="op" id="5783800">:</span>&nbsp;<span class="ident" id="5783802">recv</span><span class="op" id="5783806">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783810">Name</span><span class="op" id="5783814">:</span>&nbsp;<span class="ident" id="5783816">ident</span><span class="op" id="5783821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783825">Type</span><span class="op" id="5783829">:</span>&nbsp;<span class="op" id="5783831">&amp;</span><span class="ident" id="5783832">ast</span><span class="op" id="5783835">.</span><span class="ident" id="5783836">FuncType</span><span class="op" id="5783844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783849">Func</span><span class="op" id="5783853">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5783858">pos</span><span class="op" id="5783861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783866">Params</span><span class="op" id="5783872">:</span>&nbsp;&nbsp;<span class="ident" id="5783875">params</span><span class="op" id="5783881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783886">Results</span><span class="op" id="5783893">:</span>&nbsp;<span class="ident" id="5783895">results</span><span class="op" id="5783902">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783906">}</span><span class="op" id="5783907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783911">Body</span><span class="op" id="5783915">:</span>&nbsp;<span class="ident" id="5783917">body</span><span class="op" id="5783921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783927">if</span>&nbsp;<span class="ident" id="5783930">recv</span>&nbsp;<span class="op" id="5783935">==</span>&nbsp;<span class="ident" id="5783938">nil</span>&nbsp;<span class="op" id="5783942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783946">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784014">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784080">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784130">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784135">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784193">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784248">if</span>&nbsp;<span class="ident" id="5784251">ident</span><span class="op" id="5784256">.</span><span class="ident" id="5784257">Name</span>&nbsp;<span class="op" id="5784262">!=</span>&nbsp;<span class="string" id="5784265">&#34;init&#34;</span>&nbsp;<span class="op" id="5784272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784277">p</span><span class="op" id="5784278">.</span><span class="ident" id="5784279">declare</span><span class="op" id="5784286">(</span><span class="ident" id="5784287">decl</span><span class="op" id="5784291">,</span>&nbsp;<span class="ident" id="5784293">nil</span><span class="op" id="5784296">,</span>&nbsp;<span class="ident" id="5784298">p</span><span class="op" id="5784299">.</span><span class="ident" id="5784300">pkgScope</span><span class="op" id="5784308">,</span>&nbsp;<span class="ident" id="5784310">ast</span><span class="op" id="5784313">.</span><span class="ident" id="5784314">Fun</span><span class="op" id="5784317">,</span>&nbsp;<span class="ident" id="5784319">ident</span><span class="op" id="5784324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784335">return</span>&nbsp;<span class="ident" id="5784342">decl</span><br>
<span class="lineno"></span><span class="op" id="5784347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5784350">func</span>&nbsp;<span class="op" id="5784355">(</span><span class="ident" id="5784356">p</span>&nbsp;<span class="op" id="5784358">*</span><span class="ident" id="5784359">parser</span><span class="op" id="5784365">)</span>&nbsp;<span class="ident" id="5784367">parseDecl</span><span class="op" id="5784376">(</span><span class="ident" id="5784377">sync</span>&nbsp;<span class="keyword" id="5784382">func</span><span class="op" id="5784386">(</span><span class="op" id="5784387">*</span><span class="ident" id="5784388">parser</span><span class="op" id="5784394">)</span><span class="op" id="5784395">)</span>&nbsp;<span class="ident" id="5784397">ast</span><span class="op" id="5784400">.</span><span class="ident" id="5784401">Decl</span>&nbsp;<span class="op" id="5784406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784409">if</span>&nbsp;<span class="ident" id="5784412">p</span><span class="op" id="5784413">.</span><span class="ident" id="5784414">trace</span>&nbsp;<span class="op" id="5784420">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784424">defer</span>&nbsp;<span class="ident" id="5784430">un</span><span class="op" id="5784432">(</span><span class="ident" id="5784433">trace</span><span class="op" id="5784438">(</span><span class="ident" id="5784439">p</span><span class="op" id="5784440">,</span>&nbsp;<span class="string" id="5784442">&#34;Declaration&#34;</span><span class="op" id="5784455">)</span><span class="op" id="5784456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784463">var</span>&nbsp;<span class="ident" id="5784467">f</span>&nbsp;<span class="ident" id="5784469">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784488">switch</span>&nbsp;<span class="ident" id="5784495">p</span><span class="op" id="5784496">.</span><span class="ident" id="5784497">tok</span>&nbsp;<span class="op" id="5784501">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784504">case</span>&nbsp;<span class="ident" id="5784509">token</span><span class="op" id="5784514">.</span><span class="ident" id="5784515">CONST</span><span class="op" id="5784520">,</span>&nbsp;<span class="ident" id="5784522">token</span><span class="op" id="5784527">.</span><span class="ident" id="5784528">VAR</span><span class="op" id="5784531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784535">f</span>&nbsp;<span class="op" id="5784537">=</span>&nbsp;<span class="ident" id="5784539">p</span><span class="op" id="5784540">.</span><span class="ident" id="5784541">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784558">case</span>&nbsp;<span class="ident" id="5784563">token</span><span class="op" id="5784568">.</span><span class="ident" id="5784569">TYPE</span><span class="op" id="5784573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784577">f</span>&nbsp;<span class="op" id="5784579">=</span>&nbsp;<span class="ident" id="5784581">p</span><span class="op" id="5784582">.</span><span class="ident" id="5784583">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784599">case</span>&nbsp;<span class="ident" id="5784604">token</span><span class="op" id="5784609">.</span><span class="ident" id="5784610">FUNC</span><span class="op" id="5784614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784618">return</span>&nbsp;<span class="ident" id="5784625">p</span><span class="op" id="5784626">.</span><span class="ident" id="5784627">parseFuncDecl</span><span class="op" id="5784640">(</span><span class="op" id="5784641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784645">default</span><span class="op" id="5784652">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784656">pos</span>&nbsp;<span class="op" id="5784660">:=</span>&nbsp;<span class="ident" id="5784663">p</span><span class="op" id="5784664">.</span><span class="ident" id="5784665">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784671">p</span><span class="op" id="5784672">.</span><span class="ident" id="5784673">errorExpected</span><span class="op" id="5784686">(</span><span class="ident" id="5784687">pos</span><span class="op" id="5784690">,</span>&nbsp;<span class="string" id="5784692">&#34;declaration&#34;</span><span class="op" id="5784705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784709">sync</span><span class="op" id="5784713">(</span><span class="ident" id="5784714">p</span><span class="op" id="5784715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784719">return</span>&nbsp;<span class="op" id="5784726">&amp;</span><span class="ident" id="5784727">ast</span><span class="op" id="5784730">.</span><span class="ident" id="5784731">BadDecl</span><span class="op" id="5784738">{</span><span class="ident" id="5784739">From</span><span class="op" id="5784743">:</span>&nbsp;<span class="ident" id="5784745">pos</span><span class="op" id="5784748">,</span>&nbsp;<span class="ident" id="5784750">To</span><span class="op" id="5784752">:</span>&nbsp;<span class="ident" id="5784754">p</span><span class="op" id="5784755">.</span><span class="ident" id="5784756">pos</span><span class="op" id="5784759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784762">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784766">return</span>&nbsp;<span class="ident" id="5784773">p</span><span class="op" id="5784774">.</span><span class="ident" id="5784775">parseGenDecl</span><span class="op" id="5784787">(</span><span class="ident" id="5784788">p</span><span class="op" id="5784789">.</span><span class="ident" id="5784790">tok</span><span class="op" id="5784793">,</span>&nbsp;<span class="ident" id="5784795">f</span><span class="op" id="5784796">)</span><br>
<span class="lineno"></span><span class="op" id="5784798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5784801">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="5784881">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5784898">func</span>&nbsp;<span class="op" id="5784903">(</span><span class="ident" id="5784904">p</span>&nbsp;<span class="op" id="5784906">*</span><span class="ident" id="5784907">parser</span><span class="op" id="5784913">)</span>&nbsp;<span class="ident" id="5784915">parseFile</span><span class="op" id="5784924">(</span><span class="op" id="5784925">)</span>&nbsp;<span class="op" id="5784927">*</span><span class="ident" id="5784928">ast</span><span class="op" id="5784931">.</span><span class="ident" id="5784932">File</span>&nbsp;<span class="op" id="5784937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784940">if</span>&nbsp;<span class="ident" id="5784943">p</span><span class="op" id="5784944">.</span><span class="ident" id="5784945">trace</span>&nbsp;<span class="op" id="5784951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784955">defer</span>&nbsp;<span class="ident" id="5784961">un</span><span class="op" id="5784963">(</span><span class="ident" id="5784964">trace</span><span class="op" id="5784969">(</span><span class="ident" id="5784970">p</span><span class="op" id="5784971">,</span>&nbsp;<span class="string" id="5784973">&#34;File&#34;</span><span class="op" id="5784979">)</span><span class="op" id="5784980">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784987">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785064">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785104">if</span>&nbsp;<span class="ident" id="5785107">p</span><span class="op" id="5785108">.</span><span class="ident" id="5785109">errors</span><span class="op" id="5785115">.</span><span class="ident" id="5785116">Len</span><span class="op" id="5785119">(</span><span class="op" id="5785120">)</span>&nbsp;<span class="op" id="5785122">!=</span>&nbsp;<span class="num" id="5785125">0</span>&nbsp;<span class="op" id="5785127">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785131">return</span>&nbsp;<span class="ident" id="5785138">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785147">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785166">doc</span>&nbsp;<span class="op" id="5785170">:=</span>&nbsp;<span class="ident" id="5785173">p</span><span class="op" id="5785174">.</span><span class="ident" id="5785175">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785188">pos</span>&nbsp;<span class="op" id="5785192">:=</span>&nbsp;<span class="ident" id="5785195">p</span><span class="op" id="5785196">.</span><span class="ident" id="5785197">expect</span><span class="op" id="5785203">(</span><span class="ident" id="5785204">token</span><span class="op" id="5785209">.</span><span class="ident" id="5785210">PACKAGE</span><span class="op" id="5785217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785220">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785274">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785325">ident</span>&nbsp;<span class="op" id="5785331">:=</span>&nbsp;<span class="ident" id="5785334">p</span><span class="op" id="5785335">.</span><span class="ident" id="5785336">parseIdent</span><span class="op" id="5785346">(</span><span class="op" id="5785347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785350">if</span>&nbsp;<span class="ident" id="5785353">ident</span><span class="op" id="5785358">.</span><span class="ident" id="5785359">Name</span>&nbsp;<span class="op" id="5785364">==</span>&nbsp;<span class="string" id="5785367">&#34;_&#34;</span>&nbsp;<span class="op" id="5785371">&amp;&amp;</span>&nbsp;<span class="ident" id="5785374">p</span><span class="op" id="5785375">.</span><span class="ident" id="5785376">mode</span><span class="op" id="5785380">&amp;</span><span class="ident" id="5785381">DeclarationErrors</span>&nbsp;<span class="op" id="5785399">!=</span>&nbsp;<span class="num" id="5785402">0</span>&nbsp;<span class="op" id="5785404">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785408">p</span><span class="op" id="5785409">.</span><span class="builtintype" id="5785410">error</span><span class="op" id="5785415">(</span><span class="ident" id="5785416">p</span><span class="op" id="5785417">.</span><span class="ident" id="5785418">pos</span><span class="op" id="5785421">,</span>&nbsp;<span class="string" id="5785423">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="5785447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785453">p</span><span class="op" id="5785454">.</span><span class="ident" id="5785455">expectSemi</span><span class="op" id="5785465">(</span><span class="op" id="5785466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785470">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785549">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785589">if</span>&nbsp;<span class="ident" id="5785592">p</span><span class="op" id="5785593">.</span><span class="ident" id="5785594">errors</span><span class="op" id="5785600">.</span><span class="ident" id="5785601">Len</span><span class="op" id="5785604">(</span><span class="op" id="5785605">)</span>&nbsp;<span class="op" id="5785607">!=</span>&nbsp;<span class="num" id="5785610">0</span>&nbsp;<span class="op" id="5785612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785616">return</span>&nbsp;<span class="ident" id="5785623">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785632">p</span><span class="op" id="5785633">.</span><span class="ident" id="5785634">openScope</span><span class="op" id="5785643">(</span><span class="op" id="5785644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785647">p</span><span class="op" id="5785648">.</span><span class="ident" id="5785649">pkgScope</span>&nbsp;<span class="op" id="5785658">=</span>&nbsp;<span class="ident" id="5785660">p</span><span class="op" id="5785661">.</span><span class="ident" id="5785662">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785672">var</span>&nbsp;<span class="ident" id="5785676">decls</span>&nbsp;<span class="op" id="5785682">[</span><span class="op" id="5785683">]</span><span class="ident" id="5785684">ast</span><span class="op" id="5785687">.</span><span class="ident" id="5785688">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785694">if</span>&nbsp;<span class="ident" id="5785697">p</span><span class="op" id="5785698">.</span><span class="ident" id="5785699">mode</span><span class="op" id="5785703">&amp;</span><span class="ident" id="5785704">PackageClauseOnly</span>&nbsp;<span class="op" id="5785722">==</span>&nbsp;<span class="num" id="5785725">0</span>&nbsp;<span class="op" id="5785727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785731">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785749">for</span>&nbsp;<span class="ident" id="5785753">p</span><span class="op" id="5785754">.</span><span class="ident" id="5785755">tok</span>&nbsp;<span class="op" id="5785759">==</span>&nbsp;<span class="ident" id="5785762">token</span><span class="op" id="5785767">.</span><span class="ident" id="5785768">IMPORT</span>&nbsp;<span class="op" id="5785775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785780">decls</span>&nbsp;<span class="op" id="5785786">=</span>&nbsp;<span class="builtinfunc" id="5785788">append</span><span class="op" id="5785794">(</span><span class="ident" id="5785795">decls</span><span class="op" id="5785800">,</span>&nbsp;<span class="ident" id="5785802">p</span><span class="op" id="5785803">.</span><span class="ident" id="5785804">parseGenDecl</span><span class="op" id="5785816">(</span><span class="ident" id="5785817">token</span><span class="op" id="5785822">.</span><span class="ident" id="5785823">IMPORT</span><span class="op" id="5785829">,</span>&nbsp;<span class="ident" id="5785831">p</span><span class="op" id="5785832">.</span><span class="ident" id="5785833">parseImportSpec</span><span class="op" id="5785848">)</span><span class="op" id="5785849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785858">if</span>&nbsp;<span class="ident" id="5785861">p</span><span class="op" id="5785862">.</span><span class="ident" id="5785863">mode</span><span class="op" id="5785867">&amp;</span><span class="ident" id="5785868">ImportsOnly</span>&nbsp;<span class="op" id="5785880">==</span>&nbsp;<span class="num" id="5785883">0</span>&nbsp;<span class="op" id="5785885">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785890">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785917">for</span>&nbsp;<span class="ident" id="5785921">p</span><span class="op" id="5785922">.</span><span class="ident" id="5785923">tok</span>&nbsp;<span class="op" id="5785927">!=</span>&nbsp;<span class="ident" id="5785930">token</span><span class="op" id="5785935">.</span><span class="ident" id="5785936">EOF</span>&nbsp;<span class="op" id="5785940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785946">decls</span>&nbsp;<span class="op" id="5785952">=</span>&nbsp;<span class="builtinfunc" id="5785954">append</span><span class="op" id="5785960">(</span><span class="ident" id="5785961">decls</span><span class="op" id="5785966">,</span>&nbsp;<span class="ident" id="5785968">p</span><span class="op" id="5785969">.</span><span class="ident" id="5785970">parseDecl</span><span class="op" id="5785979">(</span><span class="ident" id="5785980">syncDecl</span><span class="op" id="5785988">)</span><span class="op" id="5785989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785998">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786004">p</span><span class="op" id="5786005">.</span><span class="ident" id="5786006">closeScope</span><span class="op" id="5786016">(</span><span class="op" id="5786017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786020">assert</span><span class="op" id="5786026">(</span><span class="ident" id="5786027">p</span><span class="op" id="5786028">.</span><span class="ident" id="5786029">topScope</span>&nbsp;<span class="op" id="5786038">==</span>&nbsp;<span class="ident" id="5786041">nil</span><span class="op" id="5786044">,</span>&nbsp;<span class="string" id="5786046">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="5786065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786068">assert</span><span class="op" id="5786074">(</span><span class="ident" id="5786075">p</span><span class="op" id="5786076">.</span><span class="ident" id="5786077">labelScope</span>&nbsp;<span class="op" id="5786088">==</span>&nbsp;<span class="ident" id="5786091">nil</span><span class="op" id="5786094">,</span>&nbsp;<span class="string" id="5786096">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="5786121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786125">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786177">i</span>&nbsp;<span class="op" id="5786179">:=</span>&nbsp;<span class="num" id="5786182">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786185">for</span>&nbsp;<span class="ident" id="5786189">_</span><span class="op" id="5786190">,</span>&nbsp;<span class="ident" id="5786192">ident</span>&nbsp;<span class="op" id="5786198">:=</span>&nbsp;<span class="keyword" id="5786201">range</span>&nbsp;<span class="ident" id="5786207">p</span><span class="op" id="5786208">.</span><span class="ident" id="5786209">unresolved</span>&nbsp;<span class="op" id="5786220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786224">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786258">assert</span><span class="op" id="5786264">(</span><span class="ident" id="5786265">ident</span><span class="op" id="5786270">.</span><span class="ident" id="5786271">Obj</span>&nbsp;<span class="op" id="5786275">==</span>&nbsp;<span class="ident" id="5786278">unresolved</span><span class="op" id="5786288">,</span>&nbsp;<span class="string" id="5786290">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="5786315">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786319">ident</span><span class="op" id="5786324">.</span><span class="ident" id="5786325">Obj</span>&nbsp;<span class="op" id="5786329">=</span>&nbsp;<span class="ident" id="5786331">p</span><span class="op" id="5786332">.</span><span class="ident" id="5786333">pkgScope</span><span class="op" id="5786341">.</span><span class="ident" id="5786342">Lookup</span><span class="op" id="5786348">(</span><span class="ident" id="5786349">ident</span><span class="op" id="5786354">.</span><span class="ident" id="5786355">Name</span><span class="op" id="5786359">)</span>&nbsp;<span class="comment" id="5786361">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786399">if</span>&nbsp;<span class="ident" id="5786402">ident</span><span class="op" id="5786407">.</span><span class="ident" id="5786408">Obj</span>&nbsp;<span class="op" id="5786412">==</span>&nbsp;<span class="ident" id="5786415">nil</span>&nbsp;<span class="op" id="5786419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786424">p</span><span class="op" id="5786425">.</span><span class="ident" id="5786426">unresolved</span><span class="op" id="5786436">[</span><span class="ident" id="5786437">i</span><span class="op" id="5786438">]</span>&nbsp;<span class="op" id="5786440">=</span>&nbsp;<span class="ident" id="5786442">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786451">i</span><span class="op" id="5786452">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786457">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786464">return</span>&nbsp;<span class="op" id="5786471">&amp;</span><span class="ident" id="5786472">ast</span><span class="op" id="5786475">.</span><span class="ident" id="5786476">File</span><span class="op" id="5786480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786484">Doc</span><span class="op" id="5786487">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786496">doc</span><span class="op" id="5786499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786503">Package</span><span class="op" id="5786510">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786515">pos</span><span class="op" id="5786518">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786522">Name</span><span class="op" id="5786526">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786534">ident</span><span class="op" id="5786539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786543">Decls</span><span class="op" id="5786548">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786555">decls</span><span class="op" id="5786560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786564">Scope</span><span class="op" id="5786569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786576">p</span><span class="op" id="5786577">.</span><span class="ident" id="5786578">pkgScope</span><span class="op" id="5786586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786590">Imports</span><span class="op" id="5786597">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786602">p</span><span class="op" id="5786603">.</span><span class="ident" id="5786604">imports</span><span class="op" id="5786611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786615">Unresolved</span><span class="op" id="5786625">:</span>&nbsp;<span class="ident" id="5786627">p</span><span class="op" id="5786628">.</span><span class="ident" id="5786629">unresolved</span><span class="op" id="5786639">[</span><span class="num" id="5786640">0</span><span class="op" id="5786641">:</span><span class="ident" id="5786642">i</span><span class="op" id="5786643">]</span><span class="op" id="5786644">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786648">Comments</span><span class="op" id="5786656">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5786660">p</span><span class="op" id="5786661">.</span><span class="ident" id="5786662">comments</span><span class="op" id="5786670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786673">}</span><br>
<span class="lineno"></span><span class="op" id="5786675">}</span>
</div>
</body>
</html>
