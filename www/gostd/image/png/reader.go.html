<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6299081">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6299136">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6299190">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6299241">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6299300">//</span><br>
<span class="lineno"></span><span class="comment" id="6299303">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="6299361">package</span>&nbsp;<span class="ident" id="6299369">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6299374">import</span>&nbsp;<span class="op" id="6299381">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299384">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299401">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299420">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299427">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299435">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299449">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299458">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6299473">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6299478">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6299481">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6299517">const</span>&nbsp;<span class="op" id="6299523">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299526">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299543">=</span>&nbsp;<span class="num" id="6299545">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299548">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299565">=</span>&nbsp;<span class="num" id="6299567">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299570">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299587">=</span>&nbsp;<span class="num" id="6299589">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299592">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="6299609">=</span>&nbsp;<span class="num" id="6299611">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299614">ctTrueColorAlpha</span>&nbsp;<span class="op" id="6299631">=</span>&nbsp;<span class="num" id="6299633">6</span><br>
<span class="lineno"></span><span class="op" id="6299635">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6299638">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6299692">const</span>&nbsp;<span class="op" id="6299698">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299701">cbInvalid</span>&nbsp;<span class="op" id="6299711">=</span>&nbsp;<span class="ident" id="6299713">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299719">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299725">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299731">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299737">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299743">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299750">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299757">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299763">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299769">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299775">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299781">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299789">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299796">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299804">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299812">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="6299820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6299823">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6299860">const</span>&nbsp;<span class="op" id="6299866">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299869">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299879">=</span>&nbsp;<span class="num" id="6299881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299884">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299894">=</span>&nbsp;<span class="num" id="6299896">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299899">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299909">=</span>&nbsp;<span class="num" id="6299911">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299914">ftAverage</span>&nbsp;<span class="op" id="6299924">=</span>&nbsp;<span class="num" id="6299926">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299929">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6299939">=</span>&nbsp;<span class="num" id="6299941">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299944">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6299954">=</span>&nbsp;<span class="num" id="6299956">5</span><br>
<span class="lineno"></span><span class="op" id="6299958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6299961">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="6299980">const</span>&nbsp;<span class="op" id="6299986">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299989">itNone</span>&nbsp;&nbsp;<span class="op" id="6299997">=</span>&nbsp;<span class="num" id="6299999">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300002">itAdam7</span>&nbsp;<span class="op" id="6300010">=</span>&nbsp;<span class="num" id="6300012">1</span><br>
<span class="lineno"></span><span class="op" id="6300014">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6300017">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="6300098">type</span>&nbsp;<span class="ident" id="6300103">interlaceScan</span>&nbsp;<span class="keyword" id="6300117">struct</span>&nbsp;<span class="op" id="6300124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300127">xFactor</span><span class="op" id="6300134">,</span>&nbsp;<span class="ident" id="6300136">yFactor</span><span class="op" id="6300143">,</span>&nbsp;<span class="ident" id="6300145">xOffset</span><span class="op" id="6300152">,</span>&nbsp;<span class="ident" id="6300154">yOffset</span>&nbsp;<span class="builtintype" id="6300162">int</span><br>
<span class="lineno"></span><span class="op" id="6300166">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="6300169">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="6300244">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="6300288">var</span>&nbsp;<span class="ident" id="6300292">interlacing</span>&nbsp;<span class="op" id="6300304">=</span>&nbsp;<span class="op" id="6300306">[</span><span class="op" id="6300307">]</span><span class="ident" id="6300308">interlaceScan</span><span class="op" id="6300321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300324">{</span><span class="num" id="6300325">8</span><span class="op" id="6300326">,</span>&nbsp;<span class="num" id="6300328">8</span><span class="op" id="6300329">,</span>&nbsp;<span class="num" id="6300331">0</span><span class="op" id="6300332">,</span>&nbsp;<span class="num" id="6300334">0</span><span class="op" id="6300335">}</span><span class="op" id="6300336">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300339">{</span><span class="num" id="6300340">8</span><span class="op" id="6300341">,</span>&nbsp;<span class="num" id="6300343">8</span><span class="op" id="6300344">,</span>&nbsp;<span class="num" id="6300346">4</span><span class="op" id="6300347">,</span>&nbsp;<span class="num" id="6300349">0</span><span class="op" id="6300350">}</span><span class="op" id="6300351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300354">{</span><span class="num" id="6300355">4</span><span class="op" id="6300356">,</span>&nbsp;<span class="num" id="6300358">8</span><span class="op" id="6300359">,</span>&nbsp;<span class="num" id="6300361">0</span><span class="op" id="6300362">,</span>&nbsp;<span class="num" id="6300364">4</span><span class="op" id="6300365">}</span><span class="op" id="6300366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300369">{</span><span class="num" id="6300370">4</span><span class="op" id="6300371">,</span>&nbsp;<span class="num" id="6300373">4</span><span class="op" id="6300374">,</span>&nbsp;<span class="num" id="6300376">2</span><span class="op" id="6300377">,</span>&nbsp;<span class="num" id="6300379">0</span><span class="op" id="6300380">}</span><span class="op" id="6300381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300384">{</span><span class="num" id="6300385">2</span><span class="op" id="6300386">,</span>&nbsp;<span class="num" id="6300388">4</span><span class="op" id="6300389">,</span>&nbsp;<span class="num" id="6300391">0</span><span class="op" id="6300392">,</span>&nbsp;<span class="num" id="6300394">2</span><span class="op" id="6300395">}</span><span class="op" id="6300396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300399">{</span><span class="num" id="6300400">2</span><span class="op" id="6300401">,</span>&nbsp;<span class="num" id="6300403">2</span><span class="op" id="6300404">,</span>&nbsp;<span class="num" id="6300406">1</span><span class="op" id="6300407">,</span>&nbsp;<span class="num" id="6300409">0</span><span class="op" id="6300410">}</span><span class="op" id="6300411">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300414">{</span><span class="num" id="6300415">1</span><span class="op" id="6300416">,</span>&nbsp;<span class="num" id="6300418">2</span><span class="op" id="6300419">,</span>&nbsp;<span class="num" id="6300421">0</span><span class="op" id="6300422">,</span>&nbsp;<span class="num" id="6300424">1</span><span class="op" id="6300425">}</span><span class="op" id="6300426">,</span><br>
<span class="lineno"></span><span class="op" id="6300428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300431">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="6300450">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="6300528">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6300604">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="6300679">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="6300697">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="6300741">const</span>&nbsp;<span class="op" id="6300747">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300750">dsStart</span>&nbsp;<span class="op" id="6300758">=</span>&nbsp;<span class="ident" id="6300760">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300766">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300778">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300790">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300802">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="6300813">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300816">const</span>&nbsp;<span class="ident" id="6300822">pngHeader</span>&nbsp;<span class="op" id="6300832">=</span>&nbsp;<span class="string" id="6300834">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300855">type</span>&nbsp;<span class="ident" id="6300860">decoder</span>&nbsp;<span class="keyword" id="6300868">struct</span>&nbsp;<span class="op" id="6300875">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300878">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300892">io</span><span class="op" id="6300894">.</span><span class="ident" id="6300895">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300903">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300917">image</span><span class="op" id="6300922">.</span><span class="ident" id="6300923">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300930">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300944">hash</span><span class="op" id="6300948">.</span><span class="ident" id="6300949">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300957">width</span><span class="op" id="6300962">,</span>&nbsp;<span class="ident" id="6300964">height</span>&nbsp;<span class="builtintype" id="6300971">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300976">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6300990">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300995">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301009">color</span><span class="op" id="6301014">.</span><span class="ident" id="6301015">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301024">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6301038">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301043">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6301057">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301062">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6301076">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301084">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301098">[</span><span class="num" id="6301099">3</span>&nbsp;<span class="op" id="6301101">*</span>&nbsp;<span class="num" id="6301103">256</span><span class="op" id="6301106">]</span><span class="builtintype" id="6301107">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301113">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6301127">int</span><br>
<span class="lineno"></span><span class="op" id="6301131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301134">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="6301194">type</span>&nbsp;<span class="ident" id="6301199">FormatError</span>&nbsp;<span class="builtintype" id="6301211">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6301219">func</span>&nbsp;<span class="op" id="6301224">(</span><span class="ident" id="6301225">e</span>&nbsp;<span class="ident" id="6301227">FormatError</span><span class="op" id="6301238">)</span>&nbsp;<span class="ident" id="6301240">Error</span><span class="op" id="6301245">(</span><span class="op" id="6301246">)</span>&nbsp;<span class="builtintype" id="6301248">string</span>&nbsp;<span class="op" id="6301255">{</span>&nbsp;<span class="keyword" id="6301257">return</span>&nbsp;<span class="string" id="6301264">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="6301288">+</span>&nbsp;<span class="builtintype" id="6301290">string</span><span class="op" id="6301296">(</span><span class="ident" id="6301297">e</span><span class="op" id="6301298">)</span>&nbsp;<span class="op" id="6301300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6301303">var</span>&nbsp;<span class="ident" id="6301307">chunkOrderError</span>&nbsp;<span class="op" id="6301323">=</span>&nbsp;<span class="ident" id="6301325">FormatError</span><span class="op" id="6301336">(</span><span class="string" id="6301337">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="6301357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="6301360">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="6301450">type</span>&nbsp;<span class="ident" id="6301455">UnsupportedError</span>&nbsp;<span class="builtintype" id="6301472">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6301480">func</span>&nbsp;<span class="op" id="6301485">(</span><span class="ident" id="6301486">e</span>&nbsp;<span class="ident" id="6301488">UnsupportedError</span><span class="op" id="6301504">)</span>&nbsp;<span class="ident" id="6301506">Error</span><span class="op" id="6301511">(</span><span class="op" id="6301512">)</span>&nbsp;<span class="builtintype" id="6301514">string</span>&nbsp;<span class="op" id="6301521">{</span>&nbsp;<span class="keyword" id="6301523">return</span>&nbsp;<span class="string" id="6301530">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="6301559">+</span>&nbsp;<span class="builtintype" id="6301561">string</span><span class="op" id="6301567">(</span><span class="ident" id="6301568">e</span><span class="op" id="6301569">)</span>&nbsp;<span class="op" id="6301571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6301574">func</span>&nbsp;<span class="ident" id="6301579">min</span><span class="op" id="6301582">(</span><span class="ident" id="6301583">a</span><span class="op" id="6301584">,</span>&nbsp;<span class="ident" id="6301586">b</span>&nbsp;<span class="builtintype" id="6301588">int</span><span class="op" id="6301591">)</span>&nbsp;<span class="builtintype" id="6301593">int</span>&nbsp;<span class="op" id="6301597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301600">if</span>&nbsp;<span class="ident" id="6301603">a</span>&nbsp;<span class="op" id="6301605">&lt;</span>&nbsp;<span class="ident" id="6301607">b</span>&nbsp;<span class="op" id="6301609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301613">return</span>&nbsp;<span class="ident" id="6301620">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301626">return</span>&nbsp;<span class="ident" id="6301633">b</span><br>
<span class="lineno">130</span><span class="op" id="6301635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6301638">func</span>&nbsp;<span class="op" id="6301643">(</span><span class="ident" id="6301644">d</span>&nbsp;<span class="op" id="6301646">*</span><span class="ident" id="6301647">decoder</span><span class="op" id="6301654">)</span>&nbsp;<span class="ident" id="6301656">parseIHDR</span><span class="op" id="6301665">(</span><span class="ident" id="6301666">length</span>&nbsp;<span class="builtintype" id="6301673">uint32</span><span class="op" id="6301679">)</span>&nbsp;<span class="builtintype" id="6301681">error</span>&nbsp;<span class="op" id="6301687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301690">if</span>&nbsp;<span class="ident" id="6301693">length</span>&nbsp;<span class="op" id="6301700">!=</span>&nbsp;<span class="num" id="6301703">13</span>&nbsp;<span class="op" id="6301706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301710">return</span>&nbsp;<span class="ident" id="6301717">FormatError</span><span class="op" id="6301728">(</span><span class="string" id="6301729">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="6301746">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301752">if</span>&nbsp;<span class="ident" id="6301755">_</span><span class="op" id="6301756">,</span>&nbsp;<span class="ident" id="6301758">err</span>&nbsp;<span class="op" id="6301762">:=</span>&nbsp;<span class="ident" id="6301765">io</span><span class="op" id="6301767">.</span><span class="ident" id="6301768">ReadFull</span><span class="op" id="6301776">(</span><span class="ident" id="6301777">d</span><span class="op" id="6301778">.</span><span class="ident" id="6301779">r</span><span class="op" id="6301780">,</span>&nbsp;<span class="ident" id="6301782">d</span><span class="op" id="6301783">.</span><span class="ident" id="6301784">tmp</span><span class="op" id="6301787">[</span><span class="op" id="6301788">:</span><span class="num" id="6301789">13</span><span class="op" id="6301791">]</span><span class="op" id="6301792">)</span><span class="op" id="6301793">;</span>&nbsp;<span class="ident" id="6301795">err</span>&nbsp;<span class="op" id="6301799">!=</span>&nbsp;<span class="ident" id="6301802">nil</span>&nbsp;<span class="op" id="6301806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301810">return</span>&nbsp;<span class="ident" id="6301817">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301825">d</span><span class="op" id="6301826">.</span><span class="ident" id="6301827">crc</span><span class="op" id="6301830">.</span><span class="ident" id="6301831">Write</span><span class="op" id="6301836">(</span><span class="ident" id="6301837">d</span><span class="op" id="6301838">.</span><span class="ident" id="6301839">tmp</span><span class="op" id="6301842">[</span><span class="op" id="6301843">:</span><span class="num" id="6301844">13</span><span class="op" id="6301846">]</span><span class="op" id="6301847">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301850">if</span>&nbsp;<span class="ident" id="6301853">d</span><span class="op" id="6301854">.</span><span class="ident" id="6301855">tmp</span><span class="op" id="6301858">[</span><span class="num" id="6301859">10</span><span class="op" id="6301861">]</span>&nbsp;<span class="op" id="6301863">!=</span>&nbsp;<span class="num" id="6301866">0</span>&nbsp;<span class="op" id="6301868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301872">return</span>&nbsp;<span class="ident" id="6301879">UnsupportedError</span><span class="op" id="6301895">(</span><span class="string" id="6301896">&#34;compression&nbsp;method&#34;</span><span class="op" id="6301916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301922">if</span>&nbsp;<span class="ident" id="6301925">d</span><span class="op" id="6301926">.</span><span class="ident" id="6301927">tmp</span><span class="op" id="6301930">[</span><span class="num" id="6301931">11</span><span class="op" id="6301933">]</span>&nbsp;<span class="op" id="6301935">!=</span>&nbsp;<span class="num" id="6301938">0</span>&nbsp;<span class="op" id="6301940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301944">return</span>&nbsp;<span class="ident" id="6301951">UnsupportedError</span><span class="op" id="6301967">(</span><span class="string" id="6301968">&#34;filter&nbsp;method&#34;</span><span class="op" id="6301983">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301989">if</span>&nbsp;<span class="ident" id="6301992">d</span><span class="op" id="6301993">.</span><span class="ident" id="6301994">tmp</span><span class="op" id="6301997">[</span><span class="num" id="6301998">12</span><span class="op" id="6302000">]</span>&nbsp;<span class="op" id="6302002">!=</span>&nbsp;<span class="ident" id="6302005">itNone</span>&nbsp;<span class="op" id="6302012">&amp;&amp;</span>&nbsp;<span class="ident" id="6302015">d</span><span class="op" id="6302016">.</span><span class="ident" id="6302017">tmp</span><span class="op" id="6302020">[</span><span class="num" id="6302021">12</span><span class="op" id="6302023">]</span>&nbsp;<span class="op" id="6302025">!=</span>&nbsp;<span class="ident" id="6302028">itAdam7</span>&nbsp;<span class="op" id="6302036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302040">return</span>&nbsp;<span class="ident" id="6302047">FormatError</span><span class="op" id="6302058">(</span><span class="string" id="6302059">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="6302085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302091">d</span><span class="op" id="6302092">.</span><span class="ident" id="6302093">interlace</span>&nbsp;<span class="op" id="6302103">=</span>&nbsp;<span class="builtintype" id="6302105">int</span><span class="op" id="6302108">(</span><span class="ident" id="6302109">d</span><span class="op" id="6302110">.</span><span class="ident" id="6302111">tmp</span><span class="op" id="6302114">[</span><span class="num" id="6302115">12</span><span class="op" id="6302117">]</span><span class="op" id="6302118">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302121">w</span>&nbsp;<span class="op" id="6302123">:=</span>&nbsp;<span class="builtintype" id="6302126">int32</span><span class="op" id="6302131">(</span><span class="ident" id="6302132">binary</span><span class="op" id="6302138">.</span><span class="ident" id="6302139">BigEndian</span><span class="op" id="6302148">.</span><span class="ident" id="6302149">Uint32</span><span class="op" id="6302155">(</span><span class="ident" id="6302156">d</span><span class="op" id="6302157">.</span><span class="ident" id="6302158">tmp</span><span class="op" id="6302161">[</span><span class="num" id="6302162">0</span><span class="op" id="6302163">:</span><span class="num" id="6302164">4</span><span class="op" id="6302165">]</span><span class="op" id="6302166">)</span><span class="op" id="6302167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302170">h</span>&nbsp;<span class="op" id="6302172">:=</span>&nbsp;<span class="builtintype" id="6302175">int32</span><span class="op" id="6302180">(</span><span class="ident" id="6302181">binary</span><span class="op" id="6302187">.</span><span class="ident" id="6302188">BigEndian</span><span class="op" id="6302197">.</span><span class="ident" id="6302198">Uint32</span><span class="op" id="6302204">(</span><span class="ident" id="6302205">d</span><span class="op" id="6302206">.</span><span class="ident" id="6302207">tmp</span><span class="op" id="6302210">[</span><span class="num" id="6302211">4</span><span class="op" id="6302212">:</span><span class="num" id="6302213">8</span><span class="op" id="6302214">]</span><span class="op" id="6302215">)</span><span class="op" id="6302216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302219">if</span>&nbsp;<span class="ident" id="6302222">w</span>&nbsp;<span class="op" id="6302224">&lt;</span>&nbsp;<span class="num" id="6302226">0</span>&nbsp;<span class="op" id="6302228">||</span>&nbsp;<span class="ident" id="6302231">h</span>&nbsp;<span class="op" id="6302233">&lt;</span>&nbsp;<span class="num" id="6302235">0</span>&nbsp;<span class="op" id="6302237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302241">return</span>&nbsp;<span class="ident" id="6302248">FormatError</span><span class="op" id="6302259">(</span><span class="string" id="6302260">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="6302280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302283">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302286">nPixels</span>&nbsp;<span class="op" id="6302294">:=</span>&nbsp;<span class="ident" id="6302297">int64</span><span class="op" id="6302302">(</span><span class="ident" id="6302303">w</span><span class="op" id="6302304">)</span>&nbsp;<span class="op" id="6302306">*</span>&nbsp;<span class="ident" id="6302308">int64</span><span class="op" id="6302313">(</span><span class="ident" id="6302314">h</span><span class="op" id="6302315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302318">if</span>&nbsp;<span class="ident" id="6302321">nPixels</span>&nbsp;<span class="op" id="6302329">!=</span>&nbsp;<span class="ident" id="6302332">int64</span><span class="op" id="6302337">(</span><span class="builtintype" id="6302338">int</span><span class="op" id="6302341">(</span><span class="ident" id="6302342">nPixels</span><span class="op" id="6302349">)</span><span class="op" id="6302350">)</span>&nbsp;<span class="op" id="6302352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302356">return</span>&nbsp;<span class="ident" id="6302363">UnsupportedError</span><span class="op" id="6302379">(</span><span class="string" id="6302380">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="6302400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302406">d</span><span class="op" id="6302407">.</span><span class="ident" id="6302408">cb</span>&nbsp;<span class="op" id="6302411">=</span>&nbsp;<span class="ident" id="6302413">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302424">d</span><span class="op" id="6302425">.</span><span class="ident" id="6302426">depth</span>&nbsp;<span class="op" id="6302432">=</span>&nbsp;<span class="builtintype" id="6302434">int</span><span class="op" id="6302437">(</span><span class="ident" id="6302438">d</span><span class="op" id="6302439">.</span><span class="ident" id="6302440">tmp</span><span class="op" id="6302443">[</span><span class="num" id="6302444">8</span><span class="op" id="6302445">]</span><span class="op" id="6302446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302449">switch</span>&nbsp;<span class="ident" id="6302456">d</span><span class="op" id="6302457">.</span><span class="ident" id="6302458">depth</span>&nbsp;<span class="op" id="6302464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302467">case</span>&nbsp;<span class="num" id="6302472">1</span><span class="op" id="6302473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302477">switch</span>&nbsp;<span class="ident" id="6302484">d</span><span class="op" id="6302485">.</span><span class="ident" id="6302486">tmp</span><span class="op" id="6302489">[</span><span class="num" id="6302490">9</span><span class="op" id="6302491">]</span>&nbsp;<span class="op" id="6302493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302497">case</span>&nbsp;<span class="ident" id="6302502">ctGrayscale</span><span class="op" id="6302513">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302518">d</span><span class="op" id="6302519">.</span><span class="ident" id="6302520">cb</span>&nbsp;<span class="op" id="6302523">=</span>&nbsp;<span class="ident" id="6302525">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302532">case</span>&nbsp;<span class="ident" id="6302537">ctPaletted</span><span class="op" id="6302547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302552">d</span><span class="op" id="6302553">.</span><span class="ident" id="6302554">cb</span>&nbsp;<span class="op" id="6302557">=</span>&nbsp;<span class="ident" id="6302559">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302569">case</span>&nbsp;<span class="num" id="6302574">2</span><span class="op" id="6302575">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302579">switch</span>&nbsp;<span class="ident" id="6302586">d</span><span class="op" id="6302587">.</span><span class="ident" id="6302588">tmp</span><span class="op" id="6302591">[</span><span class="num" id="6302592">9</span><span class="op" id="6302593">]</span>&nbsp;<span class="op" id="6302595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302599">case</span>&nbsp;<span class="ident" id="6302604">ctGrayscale</span><span class="op" id="6302615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302620">d</span><span class="op" id="6302621">.</span><span class="ident" id="6302622">cb</span>&nbsp;<span class="op" id="6302625">=</span>&nbsp;<span class="ident" id="6302627">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302634">case</span>&nbsp;<span class="ident" id="6302639">ctPaletted</span><span class="op" id="6302649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302654">d</span><span class="op" id="6302655">.</span><span class="ident" id="6302656">cb</span>&nbsp;<span class="op" id="6302659">=</span>&nbsp;<span class="ident" id="6302661">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302671">case</span>&nbsp;<span class="num" id="6302676">4</span><span class="op" id="6302677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302681">switch</span>&nbsp;<span class="ident" id="6302688">d</span><span class="op" id="6302689">.</span><span class="ident" id="6302690">tmp</span><span class="op" id="6302693">[</span><span class="num" id="6302694">9</span><span class="op" id="6302695">]</span>&nbsp;<span class="op" id="6302697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302701">case</span>&nbsp;<span class="ident" id="6302706">ctGrayscale</span><span class="op" id="6302717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302722">d</span><span class="op" id="6302723">.</span><span class="ident" id="6302724">cb</span>&nbsp;<span class="op" id="6302727">=</span>&nbsp;<span class="ident" id="6302729">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302736">case</span>&nbsp;<span class="ident" id="6302741">ctPaletted</span><span class="op" id="6302751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302756">d</span><span class="op" id="6302757">.</span><span class="ident" id="6302758">cb</span>&nbsp;<span class="op" id="6302761">=</span>&nbsp;<span class="ident" id="6302763">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302773">case</span>&nbsp;<span class="num" id="6302778">8</span><span class="op" id="6302779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302783">switch</span>&nbsp;<span class="ident" id="6302790">d</span><span class="op" id="6302791">.</span><span class="ident" id="6302792">tmp</span><span class="op" id="6302795">[</span><span class="num" id="6302796">9</span><span class="op" id="6302797">]</span>&nbsp;<span class="op" id="6302799">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302803">case</span>&nbsp;<span class="ident" id="6302808">ctGrayscale</span><span class="op" id="6302819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302824">d</span><span class="op" id="6302825">.</span><span class="ident" id="6302826">cb</span>&nbsp;<span class="op" id="6302829">=</span>&nbsp;<span class="ident" id="6302831">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302838">case</span>&nbsp;<span class="ident" id="6302843">ctTrueColor</span><span class="op" id="6302854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302859">d</span><span class="op" id="6302860">.</span><span class="ident" id="6302861">cb</span>&nbsp;<span class="op" id="6302864">=</span>&nbsp;<span class="ident" id="6302866">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302874">case</span>&nbsp;<span class="ident" id="6302879">ctPaletted</span><span class="op" id="6302889">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302894">d</span><span class="op" id="6302895">.</span><span class="ident" id="6302896">cb</span>&nbsp;<span class="op" id="6302899">=</span>&nbsp;<span class="ident" id="6302901">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302908">case</span>&nbsp;<span class="ident" id="6302913">ctGrayscaleAlpha</span><span class="op" id="6302929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302934">d</span><span class="op" id="6302935">.</span><span class="ident" id="6302936">cb</span>&nbsp;<span class="op" id="6302939">=</span>&nbsp;<span class="ident" id="6302941">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302949">case</span>&nbsp;<span class="ident" id="6302954">ctTrueColorAlpha</span><span class="op" id="6302970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302975">d</span><span class="op" id="6302976">.</span><span class="ident" id="6302977">cb</span>&nbsp;<span class="op" id="6302980">=</span>&nbsp;<span class="ident" id="6302982">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302994">case</span>&nbsp;<span class="num" id="6302999">16</span><span class="op" id="6303001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303005">switch</span>&nbsp;<span class="ident" id="6303012">d</span><span class="op" id="6303013">.</span><span class="ident" id="6303014">tmp</span><span class="op" id="6303017">[</span><span class="num" id="6303018">9</span><span class="op" id="6303019">]</span>&nbsp;<span class="op" id="6303021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303025">case</span>&nbsp;<span class="ident" id="6303030">ctGrayscale</span><span class="op" id="6303041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303046">d</span><span class="op" id="6303047">.</span><span class="ident" id="6303048">cb</span>&nbsp;<span class="op" id="6303051">=</span>&nbsp;<span class="ident" id="6303053">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303061">case</span>&nbsp;<span class="ident" id="6303066">ctTrueColor</span><span class="op" id="6303077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303082">d</span><span class="op" id="6303083">.</span><span class="ident" id="6303084">cb</span>&nbsp;<span class="op" id="6303087">=</span>&nbsp;<span class="ident" id="6303089">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303098">case</span>&nbsp;<span class="ident" id="6303103">ctGrayscaleAlpha</span><span class="op" id="6303119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303124">d</span><span class="op" id="6303125">.</span><span class="ident" id="6303126">cb</span>&nbsp;<span class="op" id="6303129">=</span>&nbsp;<span class="ident" id="6303131">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303140">case</span>&nbsp;<span class="ident" id="6303145">ctTrueColorAlpha</span><span class="op" id="6303161">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303166">d</span><span class="op" id="6303167">.</span><span class="ident" id="6303168">cb</span>&nbsp;<span class="op" id="6303171">=</span>&nbsp;<span class="ident" id="6303173">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303189">if</span>&nbsp;<span class="ident" id="6303192">d</span><span class="op" id="6303193">.</span><span class="ident" id="6303194">cb</span>&nbsp;<span class="op" id="6303197">==</span>&nbsp;<span class="ident" id="6303200">cbInvalid</span>&nbsp;<span class="op" id="6303210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303214">return</span>&nbsp;<span class="ident" id="6303221">UnsupportedError</span><span class="op" id="6303237">(</span><span class="ident" id="6303238">fmt</span><span class="op" id="6303241">.</span><span class="ident" id="6303242">Sprintf</span><span class="op" id="6303249">(</span><span class="string" id="6303250">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="6303279">,</span>&nbsp;<span class="ident" id="6303281">d</span><span class="op" id="6303282">.</span><span class="ident" id="6303283">tmp</span><span class="op" id="6303286">[</span><span class="num" id="6303287">8</span><span class="op" id="6303288">]</span><span class="op" id="6303289">,</span>&nbsp;<span class="ident" id="6303291">d</span><span class="op" id="6303292">.</span><span class="ident" id="6303293">tmp</span><span class="op" id="6303296">[</span><span class="num" id="6303297">9</span><span class="op" id="6303298">]</span><span class="op" id="6303299">)</span><span class="op" id="6303300">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303306">d</span><span class="op" id="6303307">.</span><span class="ident" id="6303308">width</span><span class="op" id="6303313">,</span>&nbsp;<span class="ident" id="6303315">d</span><span class="op" id="6303316">.</span><span class="ident" id="6303317">height</span>&nbsp;<span class="op" id="6303324">=</span>&nbsp;<span class="builtintype" id="6303326">int</span><span class="op" id="6303329">(</span><span class="ident" id="6303330">w</span><span class="op" id="6303331">)</span><span class="op" id="6303332">,</span>&nbsp;<span class="builtintype" id="6303334">int</span><span class="op" id="6303337">(</span><span class="ident" id="6303338">h</span><span class="op" id="6303339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303342">return</span>&nbsp;<span class="ident" id="6303349">d</span><span class="op" id="6303350">.</span><span class="ident" id="6303351">verifyChecksum</span><span class="op" id="6303365">(</span><span class="op" id="6303366">)</span><br>
<span class="lineno"></span><span class="op" id="6303368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6303371">func</span>&nbsp;<span class="op" id="6303376">(</span><span class="ident" id="6303377">d</span>&nbsp;<span class="op" id="6303379">*</span><span class="ident" id="6303380">decoder</span><span class="op" id="6303387">)</span>&nbsp;<span class="ident" id="6303389">parsePLTE</span><span class="op" id="6303398">(</span><span class="ident" id="6303399">length</span>&nbsp;<span class="builtintype" id="6303406">uint32</span><span class="op" id="6303412">)</span>&nbsp;<span class="builtintype" id="6303414">error</span>&nbsp;<span class="op" id="6303420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303423">np</span>&nbsp;<span class="op" id="6303426">:=</span>&nbsp;<span class="builtintype" id="6303429">int</span><span class="op" id="6303432">(</span><span class="ident" id="6303433">length</span>&nbsp;<span class="op" id="6303440">/</span>&nbsp;<span class="num" id="6303442">3</span><span class="op" id="6303443">)</span>&nbsp;<span class="comment" id="6303445">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303480">if</span>&nbsp;<span class="ident" id="6303483">length</span><span class="op" id="6303489">%</span><span class="num" id="6303490">3</span>&nbsp;<span class="op" id="6303492">!=</span>&nbsp;<span class="num" id="6303495">0</span>&nbsp;<span class="op" id="6303497">||</span>&nbsp;<span class="ident" id="6303500">np</span>&nbsp;<span class="op" id="6303503">&lt;=</span>&nbsp;<span class="num" id="6303506">0</span>&nbsp;<span class="op" id="6303508">||</span>&nbsp;<span class="ident" id="6303511">np</span>&nbsp;<span class="op" id="6303514">&gt;</span>&nbsp;<span class="num" id="6303516">256</span>&nbsp;<span class="op" id="6303520">||</span>&nbsp;<span class="ident" id="6303523">np</span>&nbsp;<span class="op" id="6303526">&gt;</span>&nbsp;<span class="num" id="6303528">1</span><span class="op" id="6303529">&lt;&lt;</span><span class="builtintype" id="6303531">uint</span><span class="op" id="6303535">(</span><span class="ident" id="6303536">d</span><span class="op" id="6303537">.</span><span class="ident" id="6303538">depth</span><span class="op" id="6303543">)</span>&nbsp;<span class="op" id="6303545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303549">return</span>&nbsp;<span class="ident" id="6303556">FormatError</span><span class="op" id="6303567">(</span><span class="string" id="6303568">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="6303585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303588">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303591">n</span><span class="op" id="6303592">,</span>&nbsp;<span class="ident" id="6303594">err</span>&nbsp;<span class="op" id="6303598">:=</span>&nbsp;<span class="ident" id="6303601">io</span><span class="op" id="6303603">.</span><span class="ident" id="6303604">ReadFull</span><span class="op" id="6303612">(</span><span class="ident" id="6303613">d</span><span class="op" id="6303614">.</span><span class="ident" id="6303615">r</span><span class="op" id="6303616">,</span>&nbsp;<span class="ident" id="6303618">d</span><span class="op" id="6303619">.</span><span class="ident" id="6303620">tmp</span><span class="op" id="6303623">[</span><span class="op" id="6303624">:</span><span class="num" id="6303625">3</span><span class="op" id="6303626">*</span><span class="ident" id="6303627">np</span><span class="op" id="6303629">]</span><span class="op" id="6303630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303633">if</span>&nbsp;<span class="ident" id="6303636">err</span>&nbsp;<span class="op" id="6303640">!=</span>&nbsp;<span class="ident" id="6303643">nil</span>&nbsp;<span class="op" id="6303647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303651">return</span>&nbsp;<span class="ident" id="6303658">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303666">d</span><span class="op" id="6303667">.</span><span class="ident" id="6303668">crc</span><span class="op" id="6303671">.</span><span class="ident" id="6303672">Write</span><span class="op" id="6303677">(</span><span class="ident" id="6303678">d</span><span class="op" id="6303679">.</span><span class="ident" id="6303680">tmp</span><span class="op" id="6303683">[</span><span class="op" id="6303684">:</span><span class="ident" id="6303685">n</span><span class="op" id="6303686">]</span><span class="op" id="6303687">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303690">switch</span>&nbsp;<span class="ident" id="6303697">d</span><span class="op" id="6303698">.</span><span class="ident" id="6303699">cb</span>&nbsp;<span class="op" id="6303702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303705">case</span>&nbsp;<span class="ident" id="6303710">cbP1</span><span class="op" id="6303714">,</span>&nbsp;<span class="ident" id="6303716">cbP2</span><span class="op" id="6303720">,</span>&nbsp;<span class="ident" id="6303722">cbP4</span><span class="op" id="6303726">,</span>&nbsp;<span class="ident" id="6303728">cbP8</span><span class="op" id="6303732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303736">d</span><span class="op" id="6303737">.</span><span class="ident" id="6303738">palette</span>&nbsp;<span class="op" id="6303746">=</span>&nbsp;<span class="builtinfunc" id="6303748">make</span><span class="op" id="6303752">(</span><span class="ident" id="6303753">color</span><span class="op" id="6303758">.</span><span class="ident" id="6303759">Palette</span><span class="op" id="6303766">,</span>&nbsp;<span class="num" id="6303768">256</span><span class="op" id="6303771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303775">for</span>&nbsp;<span class="ident" id="6303779">i</span>&nbsp;<span class="op" id="6303781">:=</span>&nbsp;<span class="num" id="6303784">0</span><span class="op" id="6303785">;</span>&nbsp;<span class="ident" id="6303787">i</span>&nbsp;<span class="op" id="6303789">&lt;</span>&nbsp;<span class="ident" id="6303791">np</span><span class="op" id="6303793">;</span>&nbsp;<span class="ident" id="6303795">i</span><span class="op" id="6303796">++</span>&nbsp;<span class="op" id="6303799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303804">d</span><span class="op" id="6303805">.</span><span class="ident" id="6303806">palette</span><span class="op" id="6303813">[</span><span class="ident" id="6303814">i</span><span class="op" id="6303815">]</span>&nbsp;<span class="op" id="6303817">=</span>&nbsp;<span class="ident" id="6303819">color</span><span class="op" id="6303824">.</span><span class="ident" id="6303825">RGBA</span><span class="op" id="6303829">{</span><span class="ident" id="6303830">d</span><span class="op" id="6303831">.</span><span class="ident" id="6303832">tmp</span><span class="op" id="6303835">[</span><span class="num" id="6303836">3</span><span class="op" id="6303837">*</span><span class="ident" id="6303838">i</span><span class="op" id="6303839">+</span><span class="num" id="6303840">0</span><span class="op" id="6303841">]</span><span class="op" id="6303842">,</span>&nbsp;<span class="ident" id="6303844">d</span><span class="op" id="6303845">.</span><span class="ident" id="6303846">tmp</span><span class="op" id="6303849">[</span><span class="num" id="6303850">3</span><span class="op" id="6303851">*</span><span class="ident" id="6303852">i</span><span class="op" id="6303853">+</span><span class="num" id="6303854">1</span><span class="op" id="6303855">]</span><span class="op" id="6303856">,</span>&nbsp;<span class="ident" id="6303858">d</span><span class="op" id="6303859">.</span><span class="ident" id="6303860">tmp</span><span class="op" id="6303863">[</span><span class="num" id="6303864">3</span><span class="op" id="6303865">*</span><span class="ident" id="6303866">i</span><span class="op" id="6303867">+</span><span class="num" id="6303868">2</span><span class="op" id="6303869">]</span><span class="op" id="6303870">,</span>&nbsp;<span class="num" id="6303872">0xff</span><span class="op" id="6303876">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303884">for</span>&nbsp;<span class="ident" id="6303888">i</span>&nbsp;<span class="op" id="6303890">:=</span>&nbsp;<span class="ident" id="6303893">np</span><span class="op" id="6303895">;</span>&nbsp;<span class="ident" id="6303897">i</span>&nbsp;<span class="op" id="6303899">&lt;</span>&nbsp;<span class="num" id="6303901">256</span><span class="op" id="6303904">;</span>&nbsp;<span class="ident" id="6303906">i</span><span class="op" id="6303907">++</span>&nbsp;<span class="op" id="6303910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6303915">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6303991">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6304069">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6304143">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6304214">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304256">d</span><span class="op" id="6304257">.</span><span class="ident" id="6304258">palette</span><span class="op" id="6304265">[</span><span class="ident" id="6304266">i</span><span class="op" id="6304267">]</span>&nbsp;<span class="op" id="6304269">=</span>&nbsp;<span class="ident" id="6304271">color</span><span class="op" id="6304276">.</span><span class="ident" id="6304277">RGBA</span><span class="op" id="6304281">{</span><span class="num" id="6304282">0x00</span><span class="op" id="6304286">,</span>&nbsp;<span class="num" id="6304288">0x00</span><span class="op" id="6304292">,</span>&nbsp;<span class="num" id="6304294">0x00</span><span class="op" id="6304298">,</span>&nbsp;<span class="num" id="6304300">0xff</span><span class="op" id="6304304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6304308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304312">d</span><span class="op" id="6304313">.</span><span class="ident" id="6304314">palette</span>&nbsp;<span class="op" id="6304322">=</span>&nbsp;<span class="ident" id="6304324">d</span><span class="op" id="6304325">.</span><span class="ident" id="6304326">palette</span><span class="op" id="6304333">[</span><span class="op" id="6304334">:</span><span class="ident" id="6304335">np</span><span class="op" id="6304337">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304340">case</span>&nbsp;<span class="ident" id="6304345">cbTC8</span><span class="op" id="6304350">,</span>&nbsp;<span class="ident" id="6304352">cbTCA8</span><span class="op" id="6304358">,</span>&nbsp;<span class="ident" id="6304360">cbTC16</span><span class="op" id="6304366">,</span>&nbsp;<span class="ident" id="6304368">cbTCA16</span><span class="op" id="6304375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6304379">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6304459">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304544">default</span><span class="op" id="6304551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304555">return</span>&nbsp;<span class="ident" id="6304562">FormatError</span><span class="op" id="6304573">(</span><span class="string" id="6304574">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="6304601">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6304604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304607">return</span>&nbsp;<span class="ident" id="6304614">d</span><span class="op" id="6304615">.</span><span class="ident" id="6304616">verifyChecksum</span><span class="op" id="6304630">(</span><span class="op" id="6304631">)</span><br>
<span class="lineno"></span><span class="op" id="6304633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6304636">func</span>&nbsp;<span class="op" id="6304641">(</span><span class="ident" id="6304642">d</span>&nbsp;<span class="op" id="6304644">*</span><span class="ident" id="6304645">decoder</span><span class="op" id="6304652">)</span>&nbsp;<span class="ident" id="6304654">parsetRNS</span><span class="op" id="6304663">(</span><span class="ident" id="6304664">length</span>&nbsp;<span class="builtintype" id="6304671">uint32</span><span class="op" id="6304677">)</span>&nbsp;<span class="builtintype" id="6304679">error</span>&nbsp;<span class="op" id="6304685">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304688">if</span>&nbsp;<span class="ident" id="6304691">length</span>&nbsp;<span class="op" id="6304698">&gt;</span>&nbsp;<span class="num" id="6304700">256</span>&nbsp;<span class="op" id="6304704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304708">return</span>&nbsp;<span class="ident" id="6304715">FormatError</span><span class="op" id="6304726">(</span><span class="string" id="6304727">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="6304744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6304747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304750">n</span><span class="op" id="6304751">,</span>&nbsp;<span class="ident" id="6304753">err</span>&nbsp;<span class="op" id="6304757">:=</span>&nbsp;<span class="ident" id="6304760">io</span><span class="op" id="6304762">.</span><span class="ident" id="6304763">ReadFull</span><span class="op" id="6304771">(</span><span class="ident" id="6304772">d</span><span class="op" id="6304773">.</span><span class="ident" id="6304774">r</span><span class="op" id="6304775">,</span>&nbsp;<span class="ident" id="6304777">d</span><span class="op" id="6304778">.</span><span class="ident" id="6304779">tmp</span><span class="op" id="6304782">[</span><span class="op" id="6304783">:</span><span class="ident" id="6304784">length</span><span class="op" id="6304790">]</span><span class="op" id="6304791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304794">if</span>&nbsp;<span class="ident" id="6304797">err</span>&nbsp;<span class="op" id="6304801">!=</span>&nbsp;<span class="ident" id="6304804">nil</span>&nbsp;<span class="op" id="6304808">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304812">return</span>&nbsp;<span class="ident" id="6304819">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6304824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304827">d</span><span class="op" id="6304828">.</span><span class="ident" id="6304829">crc</span><span class="op" id="6304832">.</span><span class="ident" id="6304833">Write</span><span class="op" id="6304838">(</span><span class="ident" id="6304839">d</span><span class="op" id="6304840">.</span><span class="ident" id="6304841">tmp</span><span class="op" id="6304844">[</span><span class="op" id="6304845">:</span><span class="ident" id="6304846">n</span><span class="op" id="6304847">]</span><span class="op" id="6304848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304851">switch</span>&nbsp;<span class="ident" id="6304858">d</span><span class="op" id="6304859">.</span><span class="ident" id="6304860">cb</span>&nbsp;<span class="op" id="6304863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304866">case</span>&nbsp;<span class="ident" id="6304871">cbG8</span><span class="op" id="6304875">,</span>&nbsp;<span class="ident" id="6304877">cbG16</span><span class="op" id="6304882">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304886">return</span>&nbsp;<span class="ident" id="6304893">UnsupportedError</span><span class="op" id="6304909">(</span><span class="string" id="6304910">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="6304934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304937">case</span>&nbsp;<span class="ident" id="6304942">cbTC8</span><span class="op" id="6304947">,</span>&nbsp;<span class="ident" id="6304949">cbTC16</span><span class="op" id="6304955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304959">return</span>&nbsp;<span class="ident" id="6304966">UnsupportedError</span><span class="op" id="6304982">(</span><span class="string" id="6304983">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="6305007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305010">case</span>&nbsp;<span class="ident" id="6305015">cbP1</span><span class="op" id="6305019">,</span>&nbsp;<span class="ident" id="6305021">cbP2</span><span class="op" id="6305025">,</span>&nbsp;<span class="ident" id="6305027">cbP4</span><span class="op" id="6305031">,</span>&nbsp;<span class="ident" id="6305033">cbP8</span><span class="op" id="6305037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305041">if</span>&nbsp;<span class="builtinfunc" id="6305044">len</span><span class="op" id="6305047">(</span><span class="ident" id="6305048">d</span><span class="op" id="6305049">.</span><span class="ident" id="6305050">palette</span><span class="op" id="6305057">)</span>&nbsp;<span class="op" id="6305059">&lt;</span>&nbsp;<span class="ident" id="6305061">n</span>&nbsp;<span class="op" id="6305063">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305068">d</span><span class="op" id="6305069">.</span><span class="ident" id="6305070">palette</span>&nbsp;<span class="op" id="6305078">=</span>&nbsp;<span class="ident" id="6305080">d</span><span class="op" id="6305081">.</span><span class="ident" id="6305082">palette</span><span class="op" id="6305089">[</span><span class="op" id="6305090">:</span><span class="ident" id="6305091">n</span><span class="op" id="6305092">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305100">for</span>&nbsp;<span class="ident" id="6305104">i</span>&nbsp;<span class="op" id="6305106">:=</span>&nbsp;<span class="num" id="6305109">0</span><span class="op" id="6305110">;</span>&nbsp;<span class="ident" id="6305112">i</span>&nbsp;<span class="op" id="6305114">&lt;</span>&nbsp;<span class="ident" id="6305116">n</span><span class="op" id="6305117">;</span>&nbsp;<span class="ident" id="6305119">i</span><span class="op" id="6305120">++</span>&nbsp;<span class="op" id="6305123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305128">rgba</span>&nbsp;<span class="op" id="6305133">:=</span>&nbsp;<span class="ident" id="6305136">d</span><span class="op" id="6305137">.</span><span class="ident" id="6305138">palette</span><span class="op" id="6305145">[</span><span class="ident" id="6305146">i</span><span class="op" id="6305147">]</span><span class="op" id="6305148">.</span><span class="op" id="6305149">(</span><span class="ident" id="6305150">color</span><span class="op" id="6305155">.</span><span class="ident" id="6305156">RGBA</span><span class="op" id="6305160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305165">d</span><span class="op" id="6305166">.</span><span class="ident" id="6305167">palette</span><span class="op" id="6305174">[</span><span class="ident" id="6305175">i</span><span class="op" id="6305176">]</span>&nbsp;<span class="op" id="6305178">=</span>&nbsp;<span class="ident" id="6305180">color</span><span class="op" id="6305185">.</span><span class="ident" id="6305186">NRGBA</span><span class="op" id="6305191">{</span><span class="ident" id="6305192">rgba</span><span class="op" id="6305196">.</span><span class="ident" id="6305197">R</span><span class="op" id="6305198">,</span>&nbsp;<span class="ident" id="6305200">rgba</span><span class="op" id="6305204">.</span><span class="ident" id="6305205">G</span><span class="op" id="6305206">,</span>&nbsp;<span class="ident" id="6305208">rgba</span><span class="op" id="6305212">.</span><span class="ident" id="6305213">B</span><span class="op" id="6305214">,</span>&nbsp;<span class="ident" id="6305216">d</span><span class="op" id="6305217">.</span><span class="ident" id="6305218">tmp</span><span class="op" id="6305221">[</span><span class="ident" id="6305222">i</span><span class="op" id="6305223">]</span><span class="op" id="6305224">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305231">case</span>&nbsp;<span class="ident" id="6305236">cbGA8</span><span class="op" id="6305241">,</span>&nbsp;<span class="ident" id="6305243">cbGA16</span><span class="op" id="6305249">,</span>&nbsp;<span class="ident" id="6305251">cbTCA8</span><span class="op" id="6305257">,</span>&nbsp;<span class="ident" id="6305259">cbTCA16</span><span class="op" id="6305266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305270">return</span>&nbsp;<span class="ident" id="6305277">FormatError</span><span class="op" id="6305288">(</span><span class="string" id="6305289">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="6305316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305322">return</span>&nbsp;<span class="ident" id="6305329">d</span><span class="op" id="6305330">.</span><span class="ident" id="6305331">verifyChecksum</span><span class="op" id="6305345">(</span><span class="op" id="6305346">)</span><br>
<span class="lineno">275</span><span class="op" id="6305348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6305351">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6305428">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="6305501">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="6305562">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="6305642">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6305722">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="6305799">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="6305854">func</span>&nbsp;<span class="op" id="6305859">(</span><span class="ident" id="6305860">d</span>&nbsp;<span class="op" id="6305862">*</span><span class="ident" id="6305863">decoder</span><span class="op" id="6305870">)</span>&nbsp;<span class="ident" id="6305872">Read</span><span class="op" id="6305876">(</span><span class="ident" id="6305877">p</span>&nbsp;<span class="op" id="6305879">[</span><span class="op" id="6305880">]</span><span class="builtintype" id="6305881">byte</span><span class="op" id="6305885">)</span>&nbsp;<span class="op" id="6305887">(</span><span class="builtintype" id="6305888">int</span><span class="op" id="6305891">,</span>&nbsp;<span class="builtintype" id="6305893">error</span><span class="op" id="6305898">)</span>&nbsp;<span class="op" id="6305900">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305903">if</span>&nbsp;<span class="builtinfunc" id="6305906">len</span><span class="op" id="6305909">(</span><span class="ident" id="6305910">p</span><span class="op" id="6305911">)</span>&nbsp;<span class="op" id="6305913">==</span>&nbsp;<span class="num" id="6305916">0</span>&nbsp;<span class="op" id="6305918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305922">return</span>&nbsp;<span class="num" id="6305929">0</span><span class="op" id="6305930">,</span>&nbsp;<span class="ident" id="6305932">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305940">for</span>&nbsp;<span class="ident" id="6305944">d</span><span class="op" id="6305945">.</span><span class="ident" id="6305946">idatLength</span>&nbsp;<span class="op" id="6305957">==</span>&nbsp;<span class="num" id="6305960">0</span>&nbsp;<span class="op" id="6305962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6305966">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306039">if</span>&nbsp;<span class="ident" id="6306042">err</span>&nbsp;<span class="op" id="6306046">:=</span>&nbsp;<span class="ident" id="6306049">d</span><span class="op" id="6306050">.</span><span class="ident" id="6306051">verifyChecksum</span><span class="op" id="6306065">(</span><span class="op" id="6306066">)</span><span class="op" id="6306067">;</span>&nbsp;<span class="ident" id="6306069">err</span>&nbsp;<span class="op" id="6306073">!=</span>&nbsp;<span class="ident" id="6306076">nil</span>&nbsp;<span class="op" id="6306080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306085">return</span>&nbsp;<span class="num" id="6306092">0</span><span class="op" id="6306093">,</span>&nbsp;<span class="ident" id="6306095">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6306105">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6306175">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306201">if</span>&nbsp;<span class="ident" id="6306204">_</span><span class="op" id="6306205">,</span>&nbsp;<span class="ident" id="6306207">err</span>&nbsp;<span class="op" id="6306211">:=</span>&nbsp;<span class="ident" id="6306214">io</span><span class="op" id="6306216">.</span><span class="ident" id="6306217">ReadFull</span><span class="op" id="6306225">(</span><span class="ident" id="6306226">d</span><span class="op" id="6306227">.</span><span class="ident" id="6306228">r</span><span class="op" id="6306229">,</span>&nbsp;<span class="ident" id="6306231">d</span><span class="op" id="6306232">.</span><span class="ident" id="6306233">tmp</span><span class="op" id="6306236">[</span><span class="op" id="6306237">:</span><span class="num" id="6306238">8</span><span class="op" id="6306239">]</span><span class="op" id="6306240">)</span><span class="op" id="6306241">;</span>&nbsp;<span class="ident" id="6306243">err</span>&nbsp;<span class="op" id="6306247">!=</span>&nbsp;<span class="ident" id="6306250">nil</span>&nbsp;<span class="op" id="6306254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306259">return</span>&nbsp;<span class="num" id="6306266">0</span><span class="op" id="6306267">,</span>&nbsp;<span class="ident" id="6306269">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306279">d</span><span class="op" id="6306280">.</span><span class="ident" id="6306281">idatLength</span>&nbsp;<span class="op" id="6306292">=</span>&nbsp;<span class="ident" id="6306294">binary</span><span class="op" id="6306300">.</span><span class="ident" id="6306301">BigEndian</span><span class="op" id="6306310">.</span><span class="ident" id="6306311">Uint32</span><span class="op" id="6306317">(</span><span class="ident" id="6306318">d</span><span class="op" id="6306319">.</span><span class="ident" id="6306320">tmp</span><span class="op" id="6306323">[</span><span class="op" id="6306324">:</span><span class="num" id="6306325">4</span><span class="op" id="6306326">]</span><span class="op" id="6306327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306331">if</span>&nbsp;<span class="builtintype" id="6306334">string</span><span class="op" id="6306340">(</span><span class="ident" id="6306341">d</span><span class="op" id="6306342">.</span><span class="ident" id="6306343">tmp</span><span class="op" id="6306346">[</span><span class="num" id="6306347">4</span><span class="op" id="6306348">:</span><span class="num" id="6306349">8</span><span class="op" id="6306350">]</span><span class="op" id="6306351">)</span>&nbsp;<span class="op" id="6306353">!=</span>&nbsp;<span class="string" id="6306356">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="6306363">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306368">return</span>&nbsp;<span class="num" id="6306375">0</span><span class="op" id="6306376">,</span>&nbsp;<span class="ident" id="6306378">FormatError</span><span class="op" id="6306389">(</span><span class="string" id="6306390">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="6306413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306421">d</span><span class="op" id="6306422">.</span><span class="ident" id="6306423">crc</span><span class="op" id="6306426">.</span><span class="ident" id="6306427">Reset</span><span class="op" id="6306432">(</span><span class="op" id="6306433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306437">d</span><span class="op" id="6306438">.</span><span class="ident" id="6306439">crc</span><span class="op" id="6306442">.</span><span class="ident" id="6306443">Write</span><span class="op" id="6306448">(</span><span class="ident" id="6306449">d</span><span class="op" id="6306450">.</span><span class="ident" id="6306451">tmp</span><span class="op" id="6306454">[</span><span class="num" id="6306455">4</span><span class="op" id="6306456">:</span><span class="num" id="6306457">8</span><span class="op" id="6306458">]</span><span class="op" id="6306459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306462">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306465">if</span>&nbsp;<span class="builtintype" id="6306468">int</span><span class="op" id="6306471">(</span><span class="ident" id="6306472">d</span><span class="op" id="6306473">.</span><span class="ident" id="6306474">idatLength</span><span class="op" id="6306484">)</span>&nbsp;<span class="op" id="6306486">&lt;</span>&nbsp;<span class="num" id="6306488">0</span>&nbsp;<span class="op" id="6306490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306494">return</span>&nbsp;<span class="num" id="6306501">0</span><span class="op" id="6306502">,</span>&nbsp;<span class="ident" id="6306504">UnsupportedError</span><span class="op" id="6306520">(</span><span class="string" id="6306521">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="6306549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306555">n</span><span class="op" id="6306556">,</span>&nbsp;<span class="ident" id="6306558">err</span>&nbsp;<span class="op" id="6306562">:=</span>&nbsp;<span class="ident" id="6306565">d</span><span class="op" id="6306566">.</span><span class="ident" id="6306567">r</span><span class="op" id="6306568">.</span><span class="ident" id="6306569">Read</span><span class="op" id="6306573">(</span><span class="ident" id="6306574">p</span><span class="op" id="6306575">[</span><span class="op" id="6306576">:</span><span class="ident" id="6306577">min</span><span class="op" id="6306580">(</span><span class="builtinfunc" id="6306581">len</span><span class="op" id="6306584">(</span><span class="ident" id="6306585">p</span><span class="op" id="6306586">)</span><span class="op" id="6306587">,</span>&nbsp;<span class="builtintype" id="6306589">int</span><span class="op" id="6306592">(</span><span class="ident" id="6306593">d</span><span class="op" id="6306594">.</span><span class="ident" id="6306595">idatLength</span><span class="op" id="6306605">)</span><span class="op" id="6306606">)</span><span class="op" id="6306607">]</span><span class="op" id="6306608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306611">d</span><span class="op" id="6306612">.</span><span class="ident" id="6306613">crc</span><span class="op" id="6306616">.</span><span class="ident" id="6306617">Write</span><span class="op" id="6306622">(</span><span class="ident" id="6306623">p</span><span class="op" id="6306624">[</span><span class="op" id="6306625">:</span><span class="ident" id="6306626">n</span><span class="op" id="6306627">]</span><span class="op" id="6306628">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306631">d</span><span class="op" id="6306632">.</span><span class="ident" id="6306633">idatLength</span>&nbsp;<span class="op" id="6306644">-=</span>&nbsp;<span class="builtintype" id="6306647">uint32</span><span class="op" id="6306653">(</span><span class="ident" id="6306654">n</span><span class="op" id="6306655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306658">return</span>&nbsp;<span class="ident" id="6306665">n</span><span class="op" id="6306666">,</span>&nbsp;<span class="ident" id="6306668">err</span><br>
<span class="lineno"></span><span class="op" id="6306672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6306675">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="6306722">func</span>&nbsp;<span class="op" id="6306727">(</span><span class="ident" id="6306728">d</span>&nbsp;<span class="op" id="6306730">*</span><span class="ident" id="6306731">decoder</span><span class="op" id="6306738">)</span>&nbsp;<span class="ident" id="6306740">decode</span><span class="op" id="6306746">(</span><span class="op" id="6306747">)</span>&nbsp;<span class="op" id="6306749">(</span><span class="ident" id="6306750">image</span><span class="op" id="6306755">.</span><span class="ident" id="6306756">Image</span><span class="op" id="6306761">,</span>&nbsp;<span class="builtintype" id="6306763">error</span><span class="op" id="6306768">)</span>&nbsp;<span class="op" id="6306770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306773">r</span><span class="op" id="6306774">,</span>&nbsp;<span class="ident" id="6306776">err</span>&nbsp;<span class="op" id="6306780">:=</span>&nbsp;<span class="ident" id="6306783">zlib</span><span class="op" id="6306787">.</span><span class="ident" id="6306788">NewReader</span><span class="op" id="6306797">(</span><span class="ident" id="6306798">d</span><span class="op" id="6306799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306802">if</span>&nbsp;<span class="ident" id="6306805">err</span>&nbsp;<span class="op" id="6306809">!=</span>&nbsp;<span class="ident" id="6306812">nil</span>&nbsp;<span class="op" id="6306816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306820">return</span>&nbsp;<span class="ident" id="6306827">nil</span><span class="op" id="6306830">,</span>&nbsp;<span class="ident" id="6306832">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306837">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306840">defer</span>&nbsp;<span class="ident" id="6306846">r</span><span class="op" id="6306847">.</span><span class="ident" id="6306848">Close</span><span class="op" id="6306853">(</span><span class="op" id="6306854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306857">var</span>&nbsp;<span class="ident" id="6306861">img</span>&nbsp;<span class="ident" id="6306865">image</span><span class="op" id="6306870">.</span><span class="ident" id="6306871">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306878">if</span>&nbsp;<span class="ident" id="6306881">d</span><span class="op" id="6306882">.</span><span class="ident" id="6306883">interlace</span>&nbsp;<span class="op" id="6306893">==</span>&nbsp;<span class="ident" id="6306896">itNone</span>&nbsp;<span class="op" id="6306903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306907">img</span><span class="op" id="6306910">,</span>&nbsp;<span class="ident" id="6306912">err</span>&nbsp;<span class="op" id="6306916">=</span>&nbsp;<span class="ident" id="6306918">d</span><span class="op" id="6306919">.</span><span class="ident" id="6306920">readImagePass</span><span class="op" id="6306933">(</span><span class="ident" id="6306934">r</span><span class="op" id="6306935">,</span>&nbsp;<span class="num" id="6306937">0</span><span class="op" id="6306938">,</span>&nbsp;<span class="builtintype" id="6306940">false</span><span class="op" id="6306945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306948">}</span>&nbsp;<span class="keyword" id="6306950">else</span>&nbsp;<span class="keyword" id="6306955">if</span>&nbsp;<span class="ident" id="6306958">d</span><span class="op" id="6306959">.</span><span class="ident" id="6306960">interlace</span>&nbsp;<span class="op" id="6306970">==</span>&nbsp;<span class="ident" id="6306973">itAdam7</span>&nbsp;<span class="op" id="6306981">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6306985">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307031">img</span><span class="op" id="6307034">,</span>&nbsp;<span class="ident" id="6307036">err</span>&nbsp;<span class="op" id="6307040">=</span>&nbsp;<span class="ident" id="6307042">d</span><span class="op" id="6307043">.</span><span class="ident" id="6307044">readImagePass</span><span class="op" id="6307057">(</span><span class="ident" id="6307058">nil</span><span class="op" id="6307061">,</span>&nbsp;<span class="num" id="6307063">0</span><span class="op" id="6307064">,</span>&nbsp;<span class="builtintype" id="6307066">true</span><span class="op" id="6307070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307074">for</span>&nbsp;<span class="ident" id="6307078">pass</span>&nbsp;<span class="op" id="6307083">:=</span>&nbsp;<span class="num" id="6307086">0</span><span class="op" id="6307087">;</span>&nbsp;<span class="ident" id="6307089">pass</span>&nbsp;<span class="op" id="6307094">&lt;</span>&nbsp;<span class="num" id="6307096">7</span><span class="op" id="6307097">;</span>&nbsp;<span class="ident" id="6307099">pass</span><span class="op" id="6307103">++</span>&nbsp;<span class="op" id="6307106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307111">imagePass</span><span class="op" id="6307120">,</span>&nbsp;<span class="ident" id="6307122">err</span>&nbsp;<span class="op" id="6307126">:=</span>&nbsp;<span class="ident" id="6307129">d</span><span class="op" id="6307130">.</span><span class="ident" id="6307131">readImagePass</span><span class="op" id="6307144">(</span><span class="ident" id="6307145">r</span><span class="op" id="6307146">,</span>&nbsp;<span class="ident" id="6307148">pass</span><span class="op" id="6307152">,</span>&nbsp;<span class="builtintype" id="6307154">false</span><span class="op" id="6307159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307164">if</span>&nbsp;<span class="ident" id="6307167">err</span>&nbsp;<span class="op" id="6307171">!=</span>&nbsp;<span class="ident" id="6307174">nil</span>&nbsp;<span class="op" id="6307178">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307184">return</span>&nbsp;<span class="ident" id="6307191">nil</span><span class="op" id="6307194">,</span>&nbsp;<span class="ident" id="6307196">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307208">d</span><span class="op" id="6307209">.</span><span class="ident" id="6307210">mergePassInto</span><span class="op" id="6307223">(</span><span class="ident" id="6307224">img</span><span class="op" id="6307227">,</span>&nbsp;<span class="ident" id="6307229">imagePass</span><span class="op" id="6307238">,</span>&nbsp;<span class="ident" id="6307240">pass</span><span class="op" id="6307244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307251">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6307255">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307303">n</span>&nbsp;<span class="op" id="6307305">:=</span>&nbsp;<span class="num" id="6307308">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307311">for</span>&nbsp;<span class="ident" id="6307315">i</span>&nbsp;<span class="op" id="6307317">:=</span>&nbsp;<span class="num" id="6307320">0</span><span class="op" id="6307321">;</span>&nbsp;<span class="ident" id="6307323">n</span>&nbsp;<span class="op" id="6307325">==</span>&nbsp;<span class="num" id="6307328">0</span>&nbsp;<span class="op" id="6307330">&amp;&amp;</span>&nbsp;<span class="ident" id="6307333">err</span>&nbsp;<span class="op" id="6307337">==</span>&nbsp;<span class="ident" id="6307340">nil</span><span class="op" id="6307343">;</span>&nbsp;<span class="ident" id="6307345">i</span><span class="op" id="6307346">++</span>&nbsp;<span class="op" id="6307349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307353">if</span>&nbsp;<span class="ident" id="6307356">i</span>&nbsp;<span class="op" id="6307358">==</span>&nbsp;<span class="num" id="6307361">100</span>&nbsp;<span class="op" id="6307365">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307370">return</span>&nbsp;<span class="ident" id="6307377">nil</span><span class="op" id="6307380">,</span>&nbsp;<span class="ident" id="6307382">io</span><span class="op" id="6307384">.</span><span class="ident" id="6307385">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307405">n</span><span class="op" id="6307406">,</span>&nbsp;<span class="ident" id="6307408">err</span>&nbsp;<span class="op" id="6307412">=</span>&nbsp;<span class="ident" id="6307414">r</span><span class="op" id="6307415">.</span><span class="ident" id="6307416">Read</span><span class="op" id="6307420">(</span><span class="ident" id="6307421">d</span><span class="op" id="6307422">.</span><span class="ident" id="6307423">tmp</span><span class="op" id="6307426">[</span><span class="op" id="6307427">:</span><span class="num" id="6307428">1</span><span class="op" id="6307429">]</span><span class="op" id="6307430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307436">if</span>&nbsp;<span class="ident" id="6307439">err</span>&nbsp;<span class="op" id="6307443">!=</span>&nbsp;<span class="ident" id="6307446">nil</span>&nbsp;<span class="op" id="6307450">&amp;&amp;</span>&nbsp;<span class="ident" id="6307453">err</span>&nbsp;<span class="op" id="6307457">!=</span>&nbsp;<span class="ident" id="6307460">io</span><span class="op" id="6307462">.</span><span class="ident" id="6307463">EOF</span>&nbsp;<span class="op" id="6307467">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307471">return</span>&nbsp;<span class="ident" id="6307478">nil</span><span class="op" id="6307481">,</span>&nbsp;<span class="ident" id="6307483">FormatError</span><span class="op" id="6307494">(</span><span class="ident" id="6307495">err</span><span class="op" id="6307498">.</span><span class="ident" id="6307499">Error</span><span class="op" id="6307504">(</span><span class="op" id="6307505">)</span><span class="op" id="6307506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307512">if</span>&nbsp;<span class="ident" id="6307515">n</span>&nbsp;<span class="op" id="6307517">!=</span>&nbsp;<span class="num" id="6307520">0</span>&nbsp;<span class="op" id="6307522">||</span>&nbsp;<span class="ident" id="6307525">d</span><span class="op" id="6307526">.</span><span class="ident" id="6307527">idatLength</span>&nbsp;<span class="op" id="6307538">!=</span>&nbsp;<span class="num" id="6307541">0</span>&nbsp;<span class="op" id="6307543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307547">return</span>&nbsp;<span class="ident" id="6307554">nil</span><span class="op" id="6307557">,</span>&nbsp;<span class="ident" id="6307559">FormatError</span><span class="op" id="6307570">(</span><span class="string" id="6307571">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="6307592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307595">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307599">return</span>&nbsp;<span class="ident" id="6307606">img</span><span class="op" id="6307609">,</span>&nbsp;<span class="ident" id="6307611">nil</span><br>
<span class="lineno"></span><span class="op" id="6307615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6307618">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="6307698">func</span>&nbsp;<span class="op" id="6307703">(</span><span class="ident" id="6307704">d</span>&nbsp;<span class="op" id="6307706">*</span><span class="ident" id="6307707">decoder</span><span class="op" id="6307714">)</span>&nbsp;<span class="ident" id="6307716">readImagePass</span><span class="op" id="6307729">(</span><span class="ident" id="6307730">r</span>&nbsp;<span class="ident" id="6307732">io</span><span class="op" id="6307734">.</span><span class="ident" id="6307735">Reader</span><span class="op" id="6307741">,</span>&nbsp;<span class="ident" id="6307743">pass</span>&nbsp;<span class="builtintype" id="6307748">int</span><span class="op" id="6307751">,</span>&nbsp;<span class="ident" id="6307753">allocateOnly</span>&nbsp;<span class="builtintype" id="6307766">bool</span><span class="op" id="6307770">)</span>&nbsp;<span class="op" id="6307772">(</span><span class="ident" id="6307773">image</span><span class="op" id="6307778">.</span><span class="ident" id="6307779">Image</span><span class="op" id="6307784">,</span>&nbsp;<span class="builtintype" id="6307786">error</span><span class="op" id="6307791">)</span>&nbsp;<span class="op" id="6307793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307796">var</span>&nbsp;<span class="ident" id="6307800">bitsPerPixel</span>&nbsp;<span class="builtintype" id="6307813">int</span>&nbsp;<span class="op" id="6307817">=</span>&nbsp;<span class="num" id="6307819">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307822">pixOffset</span>&nbsp;<span class="op" id="6307832">:=</span>&nbsp;<span class="num" id="6307835">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307838">var</span>&nbsp;<span class="op" id="6307842">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307846">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307855">*</span><span class="ident" id="6307856">image</span><span class="op" id="6307861">.</span><span class="ident" id="6307862">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307869">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307878">*</span><span class="ident" id="6307879">image</span><span class="op" id="6307884">.</span><span class="ident" id="6307885">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307892">paletted</span>&nbsp;<span class="op" id="6307901">*</span><span class="ident" id="6307902">image</span><span class="op" id="6307907">.</span><span class="ident" id="6307908">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307919">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307928">*</span><span class="ident" id="6307929">image</span><span class="op" id="6307934">.</span><span class="ident" id="6307935">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307943">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6307952">*</span><span class="ident" id="6307953">image</span><span class="op" id="6307958">.</span><span class="ident" id="6307959">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307968">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6307977">*</span><span class="ident" id="6307978">image</span><span class="op" id="6307983">.</span><span class="ident" id="6307984">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307993">nrgba64</span>&nbsp;&nbsp;<span class="op" id="6308002">*</span><span class="ident" id="6308003">image</span><span class="op" id="6308008">.</span><span class="ident" id="6308009">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308019">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308028">image</span><span class="op" id="6308033">.</span><span class="ident" id="6308034">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308044">width</span><span class="op" id="6308049">,</span>&nbsp;<span class="ident" id="6308051">height</span>&nbsp;<span class="op" id="6308058">:=</span>&nbsp;<span class="ident" id="6308061">d</span><span class="op" id="6308062">.</span><span class="ident" id="6308063">width</span><span class="op" id="6308068">,</span>&nbsp;<span class="ident" id="6308070">d</span><span class="op" id="6308071">.</span><span class="ident" id="6308072">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308080">if</span>&nbsp;<span class="ident" id="6308083">d</span><span class="op" id="6308084">.</span><span class="ident" id="6308085">interlace</span>&nbsp;<span class="op" id="6308095">==</span>&nbsp;<span class="ident" id="6308098">itAdam7</span>&nbsp;<span class="op" id="6308106">&amp;&amp;</span>&nbsp;<span class="op" id="6308109">!</span><span class="ident" id="6308110">allocateOnly</span>&nbsp;<span class="op" id="6308123">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308127">p</span>&nbsp;<span class="op" id="6308129">:=</span>&nbsp;<span class="ident" id="6308132">interlacing</span><span class="op" id="6308143">[</span><span class="ident" id="6308144">pass</span><span class="op" id="6308148">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6308152">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308230">width</span>&nbsp;<span class="op" id="6308236">=</span>&nbsp;<span class="op" id="6308238">(</span><span class="ident" id="6308239">width</span>&nbsp;<span class="op" id="6308245">-</span>&nbsp;<span class="ident" id="6308247">p</span><span class="op" id="6308248">.</span><span class="ident" id="6308249">xOffset</span>&nbsp;<span class="op" id="6308257">+</span>&nbsp;<span class="ident" id="6308259">p</span><span class="op" id="6308260">.</span><span class="ident" id="6308261">xFactor</span>&nbsp;<span class="op" id="6308269">-</span>&nbsp;<span class="num" id="6308271">1</span><span class="op" id="6308272">)</span>&nbsp;<span class="op" id="6308274">/</span>&nbsp;<span class="ident" id="6308276">p</span><span class="op" id="6308277">.</span><span class="ident" id="6308278">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308288">height</span>&nbsp;<span class="op" id="6308295">=</span>&nbsp;<span class="op" id="6308297">(</span><span class="ident" id="6308298">height</span>&nbsp;<span class="op" id="6308305">-</span>&nbsp;<span class="ident" id="6308307">p</span><span class="op" id="6308308">.</span><span class="ident" id="6308309">yOffset</span>&nbsp;<span class="op" id="6308317">+</span>&nbsp;<span class="ident" id="6308319">p</span><span class="op" id="6308320">.</span><span class="ident" id="6308321">yFactor</span>&nbsp;<span class="op" id="6308329">-</span>&nbsp;<span class="num" id="6308331">1</span><span class="op" id="6308332">)</span>&nbsp;<span class="op" id="6308334">/</span>&nbsp;<span class="ident" id="6308336">p</span><span class="op" id="6308337">.</span><span class="ident" id="6308338">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308347">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308350">switch</span>&nbsp;<span class="ident" id="6308357">d</span><span class="op" id="6308358">.</span><span class="ident" id="6308359">cb</span>&nbsp;<span class="op" id="6308362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308365">case</span>&nbsp;<span class="ident" id="6308370">cbG1</span><span class="op" id="6308374">,</span>&nbsp;<span class="ident" id="6308376">cbG2</span><span class="op" id="6308380">,</span>&nbsp;<span class="ident" id="6308382">cbG4</span><span class="op" id="6308386">,</span>&nbsp;<span class="ident" id="6308388">cbG8</span><span class="op" id="6308392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308396">bitsPerPixel</span>&nbsp;<span class="op" id="6308409">=</span>&nbsp;<span class="ident" id="6308411">d</span><span class="op" id="6308412">.</span><span class="ident" id="6308413">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308421">gray</span>&nbsp;<span class="op" id="6308426">=</span>&nbsp;<span class="ident" id="6308428">image</span><span class="op" id="6308433">.</span><span class="ident" id="6308434">NewGray</span><span class="op" id="6308441">(</span><span class="ident" id="6308442">image</span><span class="op" id="6308447">.</span><span class="ident" id="6308448">Rect</span><span class="op" id="6308452">(</span><span class="num" id="6308453">0</span><span class="op" id="6308454">,</span>&nbsp;<span class="num" id="6308456">0</span><span class="op" id="6308457">,</span>&nbsp;<span class="ident" id="6308459">width</span><span class="op" id="6308464">,</span>&nbsp;<span class="ident" id="6308466">height</span><span class="op" id="6308472">)</span><span class="op" id="6308473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308477">img</span>&nbsp;<span class="op" id="6308481">=</span>&nbsp;<span class="ident" id="6308483">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308489">case</span>&nbsp;<span class="ident" id="6308494">cbGA8</span><span class="op" id="6308499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308503">bitsPerPixel</span>&nbsp;<span class="op" id="6308516">=</span>&nbsp;<span class="num" id="6308518">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308523">nrgba</span>&nbsp;<span class="op" id="6308529">=</span>&nbsp;<span class="ident" id="6308531">image</span><span class="op" id="6308536">.</span><span class="ident" id="6308537">NewNRGBA</span><span class="op" id="6308545">(</span><span class="ident" id="6308546">image</span><span class="op" id="6308551">.</span><span class="ident" id="6308552">Rect</span><span class="op" id="6308556">(</span><span class="num" id="6308557">0</span><span class="op" id="6308558">,</span>&nbsp;<span class="num" id="6308560">0</span><span class="op" id="6308561">,</span>&nbsp;<span class="ident" id="6308563">width</span><span class="op" id="6308568">,</span>&nbsp;<span class="ident" id="6308570">height</span><span class="op" id="6308576">)</span><span class="op" id="6308577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308581">img</span>&nbsp;<span class="op" id="6308585">=</span>&nbsp;<span class="ident" id="6308587">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308594">case</span>&nbsp;<span class="ident" id="6308599">cbTC8</span><span class="op" id="6308604">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308608">bitsPerPixel</span>&nbsp;<span class="op" id="6308621">=</span>&nbsp;<span class="num" id="6308623">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308628">rgba</span>&nbsp;<span class="op" id="6308633">=</span>&nbsp;<span class="ident" id="6308635">image</span><span class="op" id="6308640">.</span><span class="ident" id="6308641">NewRGBA</span><span class="op" id="6308648">(</span><span class="ident" id="6308649">image</span><span class="op" id="6308654">.</span><span class="ident" id="6308655">Rect</span><span class="op" id="6308659">(</span><span class="num" id="6308660">0</span><span class="op" id="6308661">,</span>&nbsp;<span class="num" id="6308663">0</span><span class="op" id="6308664">,</span>&nbsp;<span class="ident" id="6308666">width</span><span class="op" id="6308671">,</span>&nbsp;<span class="ident" id="6308673">height</span><span class="op" id="6308679">)</span><span class="op" id="6308680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308684">img</span>&nbsp;<span class="op" id="6308688">=</span>&nbsp;<span class="ident" id="6308690">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308696">case</span>&nbsp;<span class="ident" id="6308701">cbP1</span><span class="op" id="6308705">,</span>&nbsp;<span class="ident" id="6308707">cbP2</span><span class="op" id="6308711">,</span>&nbsp;<span class="ident" id="6308713">cbP4</span><span class="op" id="6308717">,</span>&nbsp;<span class="ident" id="6308719">cbP8</span><span class="op" id="6308723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308727">bitsPerPixel</span>&nbsp;<span class="op" id="6308740">=</span>&nbsp;<span class="ident" id="6308742">d</span><span class="op" id="6308743">.</span><span class="ident" id="6308744">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308752">paletted</span>&nbsp;<span class="op" id="6308761">=</span>&nbsp;<span class="ident" id="6308763">image</span><span class="op" id="6308768">.</span><span class="ident" id="6308769">NewPaletted</span><span class="op" id="6308780">(</span><span class="ident" id="6308781">image</span><span class="op" id="6308786">.</span><span class="ident" id="6308787">Rect</span><span class="op" id="6308791">(</span><span class="num" id="6308792">0</span><span class="op" id="6308793">,</span>&nbsp;<span class="num" id="6308795">0</span><span class="op" id="6308796">,</span>&nbsp;<span class="ident" id="6308798">width</span><span class="op" id="6308803">,</span>&nbsp;<span class="ident" id="6308805">height</span><span class="op" id="6308811">)</span><span class="op" id="6308812">,</span>&nbsp;<span class="ident" id="6308814">d</span><span class="op" id="6308815">.</span><span class="ident" id="6308816">palette</span><span class="op" id="6308823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308827">img</span>&nbsp;<span class="op" id="6308831">=</span>&nbsp;<span class="ident" id="6308833">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308843">case</span>&nbsp;<span class="ident" id="6308848">cbTCA8</span><span class="op" id="6308854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308858">bitsPerPixel</span>&nbsp;<span class="op" id="6308871">=</span>&nbsp;<span class="num" id="6308873">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308878">nrgba</span>&nbsp;<span class="op" id="6308884">=</span>&nbsp;<span class="ident" id="6308886">image</span><span class="op" id="6308891">.</span><span class="ident" id="6308892">NewNRGBA</span><span class="op" id="6308900">(</span><span class="ident" id="6308901">image</span><span class="op" id="6308906">.</span><span class="ident" id="6308907">Rect</span><span class="op" id="6308911">(</span><span class="num" id="6308912">0</span><span class="op" id="6308913">,</span>&nbsp;<span class="num" id="6308915">0</span><span class="op" id="6308916">,</span>&nbsp;<span class="ident" id="6308918">width</span><span class="op" id="6308923">,</span>&nbsp;<span class="ident" id="6308925">height</span><span class="op" id="6308931">)</span><span class="op" id="6308932">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308936">img</span>&nbsp;<span class="op" id="6308940">=</span>&nbsp;<span class="ident" id="6308942">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308949">case</span>&nbsp;<span class="ident" id="6308954">cbG16</span><span class="op" id="6308959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308963">bitsPerPixel</span>&nbsp;<span class="op" id="6308976">=</span>&nbsp;<span class="num" id="6308978">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308983">gray16</span>&nbsp;<span class="op" id="6308990">=</span>&nbsp;<span class="ident" id="6308992">image</span><span class="op" id="6308997">.</span><span class="ident" id="6308998">NewGray16</span><span class="op" id="6309007">(</span><span class="ident" id="6309008">image</span><span class="op" id="6309013">.</span><span class="ident" id="6309014">Rect</span><span class="op" id="6309018">(</span><span class="num" id="6309019">0</span><span class="op" id="6309020">,</span>&nbsp;<span class="num" id="6309022">0</span><span class="op" id="6309023">,</span>&nbsp;<span class="ident" id="6309025">width</span><span class="op" id="6309030">,</span>&nbsp;<span class="ident" id="6309032">height</span><span class="op" id="6309038">)</span><span class="op" id="6309039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309043">img</span>&nbsp;<span class="op" id="6309047">=</span>&nbsp;<span class="ident" id="6309049">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309057">case</span>&nbsp;<span class="ident" id="6309062">cbGA16</span><span class="op" id="6309068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309072">bitsPerPixel</span>&nbsp;<span class="op" id="6309085">=</span>&nbsp;<span class="num" id="6309087">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309092">nrgba64</span>&nbsp;<span class="op" id="6309100">=</span>&nbsp;<span class="ident" id="6309102">image</span><span class="op" id="6309107">.</span><span class="ident" id="6309108">NewNRGBA64</span><span class="op" id="6309118">(</span><span class="ident" id="6309119">image</span><span class="op" id="6309124">.</span><span class="ident" id="6309125">Rect</span><span class="op" id="6309129">(</span><span class="num" id="6309130">0</span><span class="op" id="6309131">,</span>&nbsp;<span class="num" id="6309133">0</span><span class="op" id="6309134">,</span>&nbsp;<span class="ident" id="6309136">width</span><span class="op" id="6309141">,</span>&nbsp;<span class="ident" id="6309143">height</span><span class="op" id="6309149">)</span><span class="op" id="6309150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309154">img</span>&nbsp;<span class="op" id="6309158">=</span>&nbsp;<span class="ident" id="6309160">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309169">case</span>&nbsp;<span class="ident" id="6309174">cbTC16</span><span class="op" id="6309180">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309184">bitsPerPixel</span>&nbsp;<span class="op" id="6309197">=</span>&nbsp;<span class="num" id="6309199">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309204">rgba64</span>&nbsp;<span class="op" id="6309211">=</span>&nbsp;<span class="ident" id="6309213">image</span><span class="op" id="6309218">.</span><span class="ident" id="6309219">NewRGBA64</span><span class="op" id="6309228">(</span><span class="ident" id="6309229">image</span><span class="op" id="6309234">.</span><span class="ident" id="6309235">Rect</span><span class="op" id="6309239">(</span><span class="num" id="6309240">0</span><span class="op" id="6309241">,</span>&nbsp;<span class="num" id="6309243">0</span><span class="op" id="6309244">,</span>&nbsp;<span class="ident" id="6309246">width</span><span class="op" id="6309251">,</span>&nbsp;<span class="ident" id="6309253">height</span><span class="op" id="6309259">)</span><span class="op" id="6309260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309264">img</span>&nbsp;<span class="op" id="6309268">=</span>&nbsp;<span class="ident" id="6309270">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309278">case</span>&nbsp;<span class="ident" id="6309283">cbTCA16</span><span class="op" id="6309290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309294">bitsPerPixel</span>&nbsp;<span class="op" id="6309307">=</span>&nbsp;<span class="num" id="6309309">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309314">nrgba64</span>&nbsp;<span class="op" id="6309322">=</span>&nbsp;<span class="ident" id="6309324">image</span><span class="op" id="6309329">.</span><span class="ident" id="6309330">NewNRGBA64</span><span class="op" id="6309340">(</span><span class="ident" id="6309341">image</span><span class="op" id="6309346">.</span><span class="ident" id="6309347">Rect</span><span class="op" id="6309351">(</span><span class="num" id="6309352">0</span><span class="op" id="6309353">,</span>&nbsp;<span class="num" id="6309355">0</span><span class="op" id="6309356">,</span>&nbsp;<span class="ident" id="6309358">width</span><span class="op" id="6309363">,</span>&nbsp;<span class="ident" id="6309365">height</span><span class="op" id="6309371">)</span><span class="op" id="6309372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309376">img</span>&nbsp;<span class="op" id="6309380">=</span>&nbsp;<span class="ident" id="6309382">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6309391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309394">if</span>&nbsp;<span class="ident" id="6309397">allocateOnly</span>&nbsp;<span class="op" id="6309410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309414">return</span>&nbsp;<span class="ident" id="6309421">img</span><span class="op" id="6309424">,</span>&nbsp;<span class="ident" id="6309426">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6309431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309434">bytesPerPixel</span>&nbsp;<span class="op" id="6309448">:=</span>&nbsp;<span class="op" id="6309451">(</span><span class="ident" id="6309452">bitsPerPixel</span>&nbsp;<span class="op" id="6309465">+</span>&nbsp;<span class="num" id="6309467">7</span><span class="op" id="6309468">)</span>&nbsp;<span class="op" id="6309470">/</span>&nbsp;<span class="num" id="6309472">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309476">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309538">rowSize</span>&nbsp;<span class="op" id="6309546">:=</span>&nbsp;<span class="num" id="6309549">1</span>&nbsp;<span class="op" id="6309551">+</span>&nbsp;<span class="op" id="6309553">(</span><span class="ident" id="6309554">bitsPerPixel</span><span class="op" id="6309566">*</span><span class="ident" id="6309567">width</span><span class="op" id="6309572">+</span><span class="num" id="6309573">7</span><span class="op" id="6309574">)</span><span class="op" id="6309575">/</span><span class="num" id="6309576">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309579">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309641">cr</span>&nbsp;<span class="op" id="6309644">:=</span>&nbsp;<span class="builtinfunc" id="6309647">make</span><span class="op" id="6309651">(</span><span class="op" id="6309652">[</span><span class="op" id="6309653">]</span><span class="builtintype" id="6309654">uint8</span><span class="op" id="6309659">,</span>&nbsp;<span class="ident" id="6309661">rowSize</span><span class="op" id="6309668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309671">pr</span>&nbsp;<span class="op" id="6309674">:=</span>&nbsp;<span class="builtinfunc" id="6309677">make</span><span class="op" id="6309681">(</span><span class="op" id="6309682">[</span><span class="op" id="6309683">]</span><span class="builtintype" id="6309684">uint8</span><span class="op" id="6309689">,</span>&nbsp;<span class="ident" id="6309691">rowSize</span><span class="op" id="6309698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309702">for</span>&nbsp;<span class="ident" id="6309706">y</span>&nbsp;<span class="op" id="6309708">:=</span>&nbsp;<span class="num" id="6309711">0</span><span class="op" id="6309712">;</span>&nbsp;<span class="ident" id="6309714">y</span>&nbsp;<span class="op" id="6309716">&lt;</span>&nbsp;<span class="ident" id="6309718">height</span><span class="op" id="6309724">;</span>&nbsp;<span class="ident" id="6309726">y</span><span class="op" id="6309727">++</span>&nbsp;<span class="op" id="6309730">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309734">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309768">_</span><span class="op" id="6309769">,</span>&nbsp;<span class="ident" id="6309771">err</span>&nbsp;<span class="op" id="6309775">:=</span>&nbsp;<span class="ident" id="6309778">io</span><span class="op" id="6309780">.</span><span class="ident" id="6309781">ReadFull</span><span class="op" id="6309789">(</span><span class="ident" id="6309790">r</span><span class="op" id="6309791">,</span>&nbsp;<span class="ident" id="6309793">cr</span><span class="op" id="6309795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309799">if</span>&nbsp;<span class="ident" id="6309802">err</span>&nbsp;<span class="op" id="6309806">!=</span>&nbsp;<span class="ident" id="6309809">nil</span>&nbsp;<span class="op" id="6309813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309818">return</span>&nbsp;<span class="ident" id="6309825">nil</span><span class="op" id="6309828">,</span>&nbsp;<span class="ident" id="6309830">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6309836">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309841">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309864">cdat</span>&nbsp;<span class="op" id="6309869">:=</span>&nbsp;<span class="ident" id="6309872">cr</span><span class="op" id="6309874">[</span><span class="num" id="6309875">1</span><span class="op" id="6309876">:</span><span class="op" id="6309877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309881">pdat</span>&nbsp;<span class="op" id="6309886">:=</span>&nbsp;<span class="ident" id="6309889">pr</span><span class="op" id="6309891">[</span><span class="num" id="6309892">1</span><span class="op" id="6309893">:</span><span class="op" id="6309894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309898">switch</span>&nbsp;<span class="ident" id="6309905">cr</span><span class="op" id="6309907">[</span><span class="num" id="6309908">0</span><span class="op" id="6309909">]</span>&nbsp;<span class="op" id="6309911">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309915">case</span>&nbsp;<span class="ident" id="6309920">ftNone</span><span class="op" id="6309926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309931">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309943">case</span>&nbsp;<span class="ident" id="6309948">ftSub</span><span class="op" id="6309953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309958">for</span>&nbsp;<span class="ident" id="6309962">i</span>&nbsp;<span class="op" id="6309964">:=</span>&nbsp;<span class="ident" id="6309967">bytesPerPixel</span><span class="op" id="6309980">;</span>&nbsp;<span class="ident" id="6309982">i</span>&nbsp;<span class="op" id="6309984">&lt;</span>&nbsp;<span class="builtinfunc" id="6309986">len</span><span class="op" id="6309989">(</span><span class="ident" id="6309990">cdat</span><span class="op" id="6309994">)</span><span class="op" id="6309995">;</span>&nbsp;<span class="ident" id="6309997">i</span><span class="op" id="6309998">++</span>&nbsp;<span class="op" id="6310001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310007">cdat</span><span class="op" id="6310011">[</span><span class="ident" id="6310012">i</span><span class="op" id="6310013">]</span>&nbsp;<span class="op" id="6310015">+=</span>&nbsp;<span class="ident" id="6310018">cdat</span><span class="op" id="6310022">[</span><span class="ident" id="6310023">i</span><span class="op" id="6310024">-</span><span class="ident" id="6310025">bytesPerPixel</span><span class="op" id="6310038">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310047">case</span>&nbsp;<span class="ident" id="6310052">ftUp</span><span class="op" id="6310056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310061">for</span>&nbsp;<span class="ident" id="6310065">i</span><span class="op" id="6310066">,</span>&nbsp;<span class="ident" id="6310068">p</span>&nbsp;<span class="op" id="6310070">:=</span>&nbsp;<span class="keyword" id="6310073">range</span>&nbsp;<span class="ident" id="6310079">pdat</span>&nbsp;<span class="op" id="6310084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310090">cdat</span><span class="op" id="6310094">[</span><span class="ident" id="6310095">i</span><span class="op" id="6310096">]</span>&nbsp;<span class="op" id="6310098">+=</span>&nbsp;<span class="ident" id="6310101">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310106">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310110">case</span>&nbsp;<span class="ident" id="6310115">ftAverage</span><span class="op" id="6310124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310129">for</span>&nbsp;<span class="ident" id="6310133">i</span>&nbsp;<span class="op" id="6310135">:=</span>&nbsp;<span class="num" id="6310138">0</span><span class="op" id="6310139">;</span>&nbsp;<span class="ident" id="6310141">i</span>&nbsp;<span class="op" id="6310143">&lt;</span>&nbsp;<span class="ident" id="6310145">bytesPerPixel</span><span class="op" id="6310158">;</span>&nbsp;<span class="ident" id="6310160">i</span><span class="op" id="6310161">++</span>&nbsp;<span class="op" id="6310164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310170">cdat</span><span class="op" id="6310174">[</span><span class="ident" id="6310175">i</span><span class="op" id="6310176">]</span>&nbsp;<span class="op" id="6310178">+=</span>&nbsp;<span class="ident" id="6310181">pdat</span><span class="op" id="6310185">[</span><span class="ident" id="6310186">i</span><span class="op" id="6310187">]</span>&nbsp;<span class="op" id="6310189">/</span>&nbsp;<span class="num" id="6310191">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310201">for</span>&nbsp;<span class="ident" id="6310205">i</span>&nbsp;<span class="op" id="6310207">:=</span>&nbsp;<span class="ident" id="6310210">bytesPerPixel</span><span class="op" id="6310223">;</span>&nbsp;<span class="ident" id="6310225">i</span>&nbsp;<span class="op" id="6310227">&lt;</span>&nbsp;<span class="builtinfunc" id="6310229">len</span><span class="op" id="6310232">(</span><span class="ident" id="6310233">cdat</span><span class="op" id="6310237">)</span><span class="op" id="6310238">;</span>&nbsp;<span class="ident" id="6310240">i</span><span class="op" id="6310241">++</span>&nbsp;<span class="op" id="6310244">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310250">cdat</span><span class="op" id="6310254">[</span><span class="ident" id="6310255">i</span><span class="op" id="6310256">]</span>&nbsp;<span class="op" id="6310258">+=</span>&nbsp;<span class="builtintype" id="6310261">uint8</span><span class="op" id="6310266">(</span><span class="op" id="6310267">(</span><span class="builtintype" id="6310268">int</span><span class="op" id="6310271">(</span><span class="ident" id="6310272">cdat</span><span class="op" id="6310276">[</span><span class="ident" id="6310277">i</span><span class="op" id="6310278">-</span><span class="ident" id="6310279">bytesPerPixel</span><span class="op" id="6310292">]</span><span class="op" id="6310293">)</span>&nbsp;<span class="op" id="6310295">+</span>&nbsp;<span class="builtintype" id="6310297">int</span><span class="op" id="6310300">(</span><span class="ident" id="6310301">pdat</span><span class="op" id="6310305">[</span><span class="ident" id="6310306">i</span><span class="op" id="6310307">]</span><span class="op" id="6310308">)</span><span class="op" id="6310309">)</span>&nbsp;<span class="op" id="6310311">/</span>&nbsp;<span class="num" id="6310313">2</span><span class="op" id="6310314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310323">case</span>&nbsp;<span class="ident" id="6310328">ftPaeth</span><span class="op" id="6310335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310340">filterPaeth</span><span class="op" id="6310351">(</span><span class="ident" id="6310352">cdat</span><span class="op" id="6310356">,</span>&nbsp;<span class="ident" id="6310358">pdat</span><span class="op" id="6310362">,</span>&nbsp;<span class="ident" id="6310364">bytesPerPixel</span><span class="op" id="6310377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310381">default</span><span class="op" id="6310388">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310393">return</span>&nbsp;<span class="ident" id="6310400">nil</span><span class="op" id="6310403">,</span>&nbsp;<span class="ident" id="6310405">FormatError</span><span class="op" id="6310416">(</span><span class="string" id="6310417">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="6310434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6310443">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310478">switch</span>&nbsp;<span class="ident" id="6310485">d</span><span class="op" id="6310486">.</span><span class="ident" id="6310487">cb</span>&nbsp;<span class="op" id="6310490">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310494">case</span>&nbsp;<span class="ident" id="6310499">cbG1</span><span class="op" id="6310503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310508">for</span>&nbsp;<span class="ident" id="6310512">x</span>&nbsp;<span class="op" id="6310514">:=</span>&nbsp;<span class="num" id="6310517">0</span><span class="op" id="6310518">;</span>&nbsp;<span class="ident" id="6310520">x</span>&nbsp;<span class="op" id="6310522">&lt;</span>&nbsp;<span class="ident" id="6310524">width</span><span class="op" id="6310529">;</span>&nbsp;<span class="ident" id="6310531">x</span>&nbsp;<span class="op" id="6310533">+=</span>&nbsp;<span class="num" id="6310536">8</span>&nbsp;<span class="op" id="6310538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310544">b</span>&nbsp;<span class="op" id="6310546">:=</span>&nbsp;<span class="ident" id="6310549">cdat</span><span class="op" id="6310553">[</span><span class="ident" id="6310554">x</span><span class="op" id="6310555">/</span><span class="num" id="6310556">8</span><span class="op" id="6310557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310563">for</span>&nbsp;<span class="ident" id="6310567">x2</span>&nbsp;<span class="op" id="6310570">:=</span>&nbsp;<span class="num" id="6310573">0</span><span class="op" id="6310574">;</span>&nbsp;<span class="ident" id="6310576">x2</span>&nbsp;<span class="op" id="6310579">&lt;</span>&nbsp;<span class="num" id="6310581">8</span>&nbsp;<span class="op" id="6310583">&amp;&amp;</span>&nbsp;<span class="ident" id="6310586">x</span><span class="op" id="6310587">+</span><span class="ident" id="6310588">x2</span>&nbsp;<span class="op" id="6310591">&lt;</span>&nbsp;<span class="ident" id="6310593">width</span><span class="op" id="6310598">;</span>&nbsp;<span class="ident" id="6310600">x2</span><span class="op" id="6310602">++</span>&nbsp;<span class="op" id="6310605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310612">gray</span><span class="op" id="6310616">.</span><span class="ident" id="6310617">SetGray</span><span class="op" id="6310624">(</span><span class="ident" id="6310625">x</span><span class="op" id="6310626">+</span><span class="ident" id="6310627">x2</span><span class="op" id="6310629">,</span>&nbsp;<span class="ident" id="6310631">y</span><span class="op" id="6310632">,</span>&nbsp;<span class="ident" id="6310634">color</span><span class="op" id="6310639">.</span><span class="ident" id="6310640">Gray</span><span class="op" id="6310644">{</span><span class="op" id="6310645">(</span><span class="ident" id="6310646">b</span>&nbsp;<span class="op" id="6310648">&gt;&gt;</span>&nbsp;<span class="num" id="6310651">7</span><span class="op" id="6310652">)</span>&nbsp;<span class="op" id="6310654">*</span>&nbsp;<span class="num" id="6310656">0xff</span><span class="op" id="6310660">}</span><span class="op" id="6310661">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310668">b</span>&nbsp;<span class="op" id="6310670">&lt;&lt;=</span>&nbsp;<span class="num" id="6310674">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310689">case</span>&nbsp;<span class="ident" id="6310694">cbG2</span><span class="op" id="6310698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310703">for</span>&nbsp;<span class="ident" id="6310707">x</span>&nbsp;<span class="op" id="6310709">:=</span>&nbsp;<span class="num" id="6310712">0</span><span class="op" id="6310713">;</span>&nbsp;<span class="ident" id="6310715">x</span>&nbsp;<span class="op" id="6310717">&lt;</span>&nbsp;<span class="ident" id="6310719">width</span><span class="op" id="6310724">;</span>&nbsp;<span class="ident" id="6310726">x</span>&nbsp;<span class="op" id="6310728">+=</span>&nbsp;<span class="num" id="6310731">4</span>&nbsp;<span class="op" id="6310733">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310739">b</span>&nbsp;<span class="op" id="6310741">:=</span>&nbsp;<span class="ident" id="6310744">cdat</span><span class="op" id="6310748">[</span><span class="ident" id="6310749">x</span><span class="op" id="6310750">/</span><span class="num" id="6310751">4</span><span class="op" id="6310752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310758">for</span>&nbsp;<span class="ident" id="6310762">x2</span>&nbsp;<span class="op" id="6310765">:=</span>&nbsp;<span class="num" id="6310768">0</span><span class="op" id="6310769">;</span>&nbsp;<span class="ident" id="6310771">x2</span>&nbsp;<span class="op" id="6310774">&lt;</span>&nbsp;<span class="num" id="6310776">4</span>&nbsp;<span class="op" id="6310778">&amp;&amp;</span>&nbsp;<span class="ident" id="6310781">x</span><span class="op" id="6310782">+</span><span class="ident" id="6310783">x2</span>&nbsp;<span class="op" id="6310786">&lt;</span>&nbsp;<span class="ident" id="6310788">width</span><span class="op" id="6310793">;</span>&nbsp;<span class="ident" id="6310795">x2</span><span class="op" id="6310797">++</span>&nbsp;<span class="op" id="6310800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310807">gray</span><span class="op" id="6310811">.</span><span class="ident" id="6310812">SetGray</span><span class="op" id="6310819">(</span><span class="ident" id="6310820">x</span><span class="op" id="6310821">+</span><span class="ident" id="6310822">x2</span><span class="op" id="6310824">,</span>&nbsp;<span class="ident" id="6310826">y</span><span class="op" id="6310827">,</span>&nbsp;<span class="ident" id="6310829">color</span><span class="op" id="6310834">.</span><span class="ident" id="6310835">Gray</span><span class="op" id="6310839">{</span><span class="op" id="6310840">(</span><span class="ident" id="6310841">b</span>&nbsp;<span class="op" id="6310843">&gt;&gt;</span>&nbsp;<span class="num" id="6310846">6</span><span class="op" id="6310847">)</span>&nbsp;<span class="op" id="6310849">*</span>&nbsp;<span class="num" id="6310851">0x55</span><span class="op" id="6310855">}</span><span class="op" id="6310856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310863">b</span>&nbsp;<span class="op" id="6310865">&lt;&lt;=</span>&nbsp;<span class="num" id="6310869">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310875">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310884">case</span>&nbsp;<span class="ident" id="6310889">cbG4</span><span class="op" id="6310893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310898">for</span>&nbsp;<span class="ident" id="6310902">x</span>&nbsp;<span class="op" id="6310904">:=</span>&nbsp;<span class="num" id="6310907">0</span><span class="op" id="6310908">;</span>&nbsp;<span class="ident" id="6310910">x</span>&nbsp;<span class="op" id="6310912">&lt;</span>&nbsp;<span class="ident" id="6310914">width</span><span class="op" id="6310919">;</span>&nbsp;<span class="ident" id="6310921">x</span>&nbsp;<span class="op" id="6310923">+=</span>&nbsp;<span class="num" id="6310926">2</span>&nbsp;<span class="op" id="6310928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6310934">b</span>&nbsp;<span class="op" id="6310936">:=</span>&nbsp;<span class="ident" id="6310939">cdat</span><span class="op" id="6310943">[</span><span class="ident" id="6310944">x</span><span class="op" id="6310945">/</span><span class="num" id="6310946">2</span><span class="op" id="6310947">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6310953">for</span>&nbsp;<span class="ident" id="6310957">x2</span>&nbsp;<span class="op" id="6310960">:=</span>&nbsp;<span class="num" id="6310963">0</span><span class="op" id="6310964">;</span>&nbsp;<span class="ident" id="6310966">x2</span>&nbsp;<span class="op" id="6310969">&lt;</span>&nbsp;<span class="num" id="6310971">2</span>&nbsp;<span class="op" id="6310973">&amp;&amp;</span>&nbsp;<span class="ident" id="6310976">x</span><span class="op" id="6310977">+</span><span class="ident" id="6310978">x2</span>&nbsp;<span class="op" id="6310981">&lt;</span>&nbsp;<span class="ident" id="6310983">width</span><span class="op" id="6310988">;</span>&nbsp;<span class="ident" id="6310990">x2</span><span class="op" id="6310992">++</span>&nbsp;<span class="op" id="6310995">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311002">gray</span><span class="op" id="6311006">.</span><span class="ident" id="6311007">SetGray</span><span class="op" id="6311014">(</span><span class="ident" id="6311015">x</span><span class="op" id="6311016">+</span><span class="ident" id="6311017">x2</span><span class="op" id="6311019">,</span>&nbsp;<span class="ident" id="6311021">y</span><span class="op" id="6311022">,</span>&nbsp;<span class="ident" id="6311024">color</span><span class="op" id="6311029">.</span><span class="ident" id="6311030">Gray</span><span class="op" id="6311034">{</span><span class="op" id="6311035">(</span><span class="ident" id="6311036">b</span>&nbsp;<span class="op" id="6311038">&gt;&gt;</span>&nbsp;<span class="num" id="6311041">4</span><span class="op" id="6311042">)</span>&nbsp;<span class="op" id="6311044">*</span>&nbsp;<span class="num" id="6311046">0x11</span><span class="op" id="6311050">}</span><span class="op" id="6311051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311058">b</span>&nbsp;<span class="op" id="6311060">&lt;&lt;=</span>&nbsp;<span class="num" id="6311064">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311079">case</span>&nbsp;<span class="ident" id="6311084">cbG8</span><span class="op" id="6311088">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6311093">copy</span><span class="op" id="6311097">(</span><span class="ident" id="6311098">gray</span><span class="op" id="6311102">.</span><span class="ident" id="6311103">Pix</span><span class="op" id="6311106">[</span><span class="ident" id="6311107">pixOffset</span><span class="op" id="6311116">:</span><span class="op" id="6311117">]</span><span class="op" id="6311118">,</span>&nbsp;<span class="ident" id="6311120">cdat</span><span class="op" id="6311124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311129">pixOffset</span>&nbsp;<span class="op" id="6311139">+=</span>&nbsp;<span class="ident" id="6311142">gray</span><span class="op" id="6311146">.</span><span class="ident" id="6311147">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311156">case</span>&nbsp;<span class="ident" id="6311161">cbGA8</span><span class="op" id="6311166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311171">for</span>&nbsp;<span class="ident" id="6311175">x</span>&nbsp;<span class="op" id="6311177">:=</span>&nbsp;<span class="num" id="6311180">0</span><span class="op" id="6311181">;</span>&nbsp;<span class="ident" id="6311183">x</span>&nbsp;<span class="op" id="6311185">&lt;</span>&nbsp;<span class="ident" id="6311187">width</span><span class="op" id="6311192">;</span>&nbsp;<span class="ident" id="6311194">x</span><span class="op" id="6311195">++</span>&nbsp;<span class="op" id="6311198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311204">ycol</span>&nbsp;<span class="op" id="6311209">:=</span>&nbsp;<span class="ident" id="6311212">cdat</span><span class="op" id="6311216">[</span><span class="num" id="6311217">2</span><span class="op" id="6311218">*</span><span class="ident" id="6311219">x</span><span class="op" id="6311220">+</span><span class="num" id="6311221">0</span><span class="op" id="6311222">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311228">nrgba</span><span class="op" id="6311233">.</span><span class="ident" id="6311234">SetNRGBA</span><span class="op" id="6311242">(</span><span class="ident" id="6311243">x</span><span class="op" id="6311244">,</span>&nbsp;<span class="ident" id="6311246">y</span><span class="op" id="6311247">,</span>&nbsp;<span class="ident" id="6311249">color</span><span class="op" id="6311254">.</span><span class="ident" id="6311255">NRGBA</span><span class="op" id="6311260">{</span><span class="ident" id="6311261">ycol</span><span class="op" id="6311265">,</span>&nbsp;<span class="ident" id="6311267">ycol</span><span class="op" id="6311271">,</span>&nbsp;<span class="ident" id="6311273">ycol</span><span class="op" id="6311277">,</span>&nbsp;<span class="ident" id="6311279">cdat</span><span class="op" id="6311283">[</span><span class="num" id="6311284">2</span><span class="op" id="6311285">*</span><span class="ident" id="6311286">x</span><span class="op" id="6311287">+</span><span class="num" id="6311288">1</span><span class="op" id="6311289">]</span><span class="op" id="6311290">}</span><span class="op" id="6311291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311300">case</span>&nbsp;<span class="ident" id="6311305">cbTC8</span><span class="op" id="6311310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311315">pix</span><span class="op" id="6311318">,</span>&nbsp;<span class="ident" id="6311320">i</span><span class="op" id="6311321">,</span>&nbsp;<span class="ident" id="6311323">j</span>&nbsp;<span class="op" id="6311325">:=</span>&nbsp;<span class="ident" id="6311328">rgba</span><span class="op" id="6311332">.</span><span class="ident" id="6311333">Pix</span><span class="op" id="6311336">,</span>&nbsp;<span class="ident" id="6311338">pixOffset</span><span class="op" id="6311347">,</span>&nbsp;<span class="num" id="6311349">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311354">for</span>&nbsp;<span class="ident" id="6311358">x</span>&nbsp;<span class="op" id="6311360">:=</span>&nbsp;<span class="num" id="6311363">0</span><span class="op" id="6311364">;</span>&nbsp;<span class="ident" id="6311366">x</span>&nbsp;<span class="op" id="6311368">&lt;</span>&nbsp;<span class="ident" id="6311370">width</span><span class="op" id="6311375">;</span>&nbsp;<span class="ident" id="6311377">x</span><span class="op" id="6311378">++</span>&nbsp;<span class="op" id="6311381">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311387">pix</span><span class="op" id="6311390">[</span><span class="ident" id="6311391">i</span><span class="op" id="6311392">+</span><span class="num" id="6311393">0</span><span class="op" id="6311394">]</span>&nbsp;<span class="op" id="6311396">=</span>&nbsp;<span class="ident" id="6311398">cdat</span><span class="op" id="6311402">[</span><span class="ident" id="6311403">j</span><span class="op" id="6311404">+</span><span class="num" id="6311405">0</span><span class="op" id="6311406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311412">pix</span><span class="op" id="6311415">[</span><span class="ident" id="6311416">i</span><span class="op" id="6311417">+</span><span class="num" id="6311418">1</span><span class="op" id="6311419">]</span>&nbsp;<span class="op" id="6311421">=</span>&nbsp;<span class="ident" id="6311423">cdat</span><span class="op" id="6311427">[</span><span class="ident" id="6311428">j</span><span class="op" id="6311429">+</span><span class="num" id="6311430">1</span><span class="op" id="6311431">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311437">pix</span><span class="op" id="6311440">[</span><span class="ident" id="6311441">i</span><span class="op" id="6311442">+</span><span class="num" id="6311443">2</span><span class="op" id="6311444">]</span>&nbsp;<span class="op" id="6311446">=</span>&nbsp;<span class="ident" id="6311448">cdat</span><span class="op" id="6311452">[</span><span class="ident" id="6311453">j</span><span class="op" id="6311454">+</span><span class="num" id="6311455">2</span><span class="op" id="6311456">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311462">pix</span><span class="op" id="6311465">[</span><span class="ident" id="6311466">i</span><span class="op" id="6311467">+</span><span class="num" id="6311468">3</span><span class="op" id="6311469">]</span>&nbsp;<span class="op" id="6311471">=</span>&nbsp;<span class="num" id="6311473">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311482">i</span>&nbsp;<span class="op" id="6311484">+=</span>&nbsp;<span class="num" id="6311487">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311493">j</span>&nbsp;<span class="op" id="6311495">+=</span>&nbsp;<span class="num" id="6311498">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311508">pixOffset</span>&nbsp;<span class="op" id="6311518">+=</span>&nbsp;<span class="ident" id="6311521">rgba</span><span class="op" id="6311525">.</span><span class="ident" id="6311526">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311535">case</span>&nbsp;<span class="ident" id="6311540">cbP1</span><span class="op" id="6311544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311549">for</span>&nbsp;<span class="ident" id="6311553">x</span>&nbsp;<span class="op" id="6311555">:=</span>&nbsp;<span class="num" id="6311558">0</span><span class="op" id="6311559">;</span>&nbsp;<span class="ident" id="6311561">x</span>&nbsp;<span class="op" id="6311563">&lt;</span>&nbsp;<span class="ident" id="6311565">width</span><span class="op" id="6311570">;</span>&nbsp;<span class="ident" id="6311572">x</span>&nbsp;<span class="op" id="6311574">+=</span>&nbsp;<span class="num" id="6311577">8</span>&nbsp;<span class="op" id="6311579">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311585">b</span>&nbsp;<span class="op" id="6311587">:=</span>&nbsp;<span class="ident" id="6311590">cdat</span><span class="op" id="6311594">[</span><span class="ident" id="6311595">x</span><span class="op" id="6311596">/</span><span class="num" id="6311597">8</span><span class="op" id="6311598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311604">for</span>&nbsp;<span class="ident" id="6311608">x2</span>&nbsp;<span class="op" id="6311611">:=</span>&nbsp;<span class="num" id="6311614">0</span><span class="op" id="6311615">;</span>&nbsp;<span class="ident" id="6311617">x2</span>&nbsp;<span class="op" id="6311620">&lt;</span>&nbsp;<span class="num" id="6311622">8</span>&nbsp;<span class="op" id="6311624">&amp;&amp;</span>&nbsp;<span class="ident" id="6311627">x</span><span class="op" id="6311628">+</span><span class="ident" id="6311629">x2</span>&nbsp;<span class="op" id="6311632">&lt;</span>&nbsp;<span class="ident" id="6311634">width</span><span class="op" id="6311639">;</span>&nbsp;<span class="ident" id="6311641">x2</span><span class="op" id="6311643">++</span>&nbsp;<span class="op" id="6311646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311653">idx</span>&nbsp;<span class="op" id="6311657">:=</span>&nbsp;<span class="ident" id="6311660">b</span>&nbsp;<span class="op" id="6311662">&gt;&gt;</span>&nbsp;<span class="num" id="6311665">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311672">if</span>&nbsp;<span class="builtinfunc" id="6311675">len</span><span class="op" id="6311678">(</span><span class="ident" id="6311679">paletted</span><span class="op" id="6311687">.</span><span class="ident" id="6311688">Palette</span><span class="op" id="6311695">)</span>&nbsp;<span class="op" id="6311697">&lt;=</span>&nbsp;<span class="builtintype" id="6311700">int</span><span class="op" id="6311703">(</span><span class="ident" id="6311704">idx</span><span class="op" id="6311707">)</span>&nbsp;<span class="op" id="6311709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311717">paletted</span><span class="op" id="6311725">.</span><span class="ident" id="6311726">Palette</span>&nbsp;<span class="op" id="6311734">=</span>&nbsp;<span class="ident" id="6311736">paletted</span><span class="op" id="6311744">.</span><span class="ident" id="6311745">Palette</span><span class="op" id="6311752">[</span><span class="op" id="6311753">:</span><span class="builtintype" id="6311754">int</span><span class="op" id="6311757">(</span><span class="ident" id="6311758">idx</span><span class="op" id="6311761">)</span><span class="op" id="6311762">+</span><span class="num" id="6311763">1</span><span class="op" id="6311764">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311778">paletted</span><span class="op" id="6311786">.</span><span class="ident" id="6311787">SetColorIndex</span><span class="op" id="6311800">(</span><span class="ident" id="6311801">x</span><span class="op" id="6311802">+</span><span class="ident" id="6311803">x2</span><span class="op" id="6311805">,</span>&nbsp;<span class="ident" id="6311807">y</span><span class="op" id="6311808">,</span>&nbsp;<span class="ident" id="6311810">idx</span><span class="op" id="6311813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311820">b</span>&nbsp;<span class="op" id="6311822">&lt;&lt;=</span>&nbsp;<span class="num" id="6311826">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311837">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311841">case</span>&nbsp;<span class="ident" id="6311846">cbP2</span><span class="op" id="6311850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311855">for</span>&nbsp;<span class="ident" id="6311859">x</span>&nbsp;<span class="op" id="6311861">:=</span>&nbsp;<span class="num" id="6311864">0</span><span class="op" id="6311865">;</span>&nbsp;<span class="ident" id="6311867">x</span>&nbsp;<span class="op" id="6311869">&lt;</span>&nbsp;<span class="ident" id="6311871">width</span><span class="op" id="6311876">;</span>&nbsp;<span class="ident" id="6311878">x</span>&nbsp;<span class="op" id="6311880">+=</span>&nbsp;<span class="num" id="6311883">4</span>&nbsp;<span class="op" id="6311885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311891">b</span>&nbsp;<span class="op" id="6311893">:=</span>&nbsp;<span class="ident" id="6311896">cdat</span><span class="op" id="6311900">[</span><span class="ident" id="6311901">x</span><span class="op" id="6311902">/</span><span class="num" id="6311903">4</span><span class="op" id="6311904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311910">for</span>&nbsp;<span class="ident" id="6311914">x2</span>&nbsp;<span class="op" id="6311917">:=</span>&nbsp;<span class="num" id="6311920">0</span><span class="op" id="6311921">;</span>&nbsp;<span class="ident" id="6311923">x2</span>&nbsp;<span class="op" id="6311926">&lt;</span>&nbsp;<span class="num" id="6311928">4</span>&nbsp;<span class="op" id="6311930">&amp;&amp;</span>&nbsp;<span class="ident" id="6311933">x</span><span class="op" id="6311934">+</span><span class="ident" id="6311935">x2</span>&nbsp;<span class="op" id="6311938">&lt;</span>&nbsp;<span class="ident" id="6311940">width</span><span class="op" id="6311945">;</span>&nbsp;<span class="ident" id="6311947">x2</span><span class="op" id="6311949">++</span>&nbsp;<span class="op" id="6311952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6311959">idx</span>&nbsp;<span class="op" id="6311963">:=</span>&nbsp;<span class="ident" id="6311966">b</span>&nbsp;<span class="op" id="6311968">&gt;&gt;</span>&nbsp;<span class="num" id="6311971">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6311978">if</span>&nbsp;<span class="builtinfunc" id="6311981">len</span><span class="op" id="6311984">(</span><span class="ident" id="6311985">paletted</span><span class="op" id="6311993">.</span><span class="ident" id="6311994">Palette</span><span class="op" id="6312001">)</span>&nbsp;<span class="op" id="6312003">&lt;=</span>&nbsp;<span class="builtintype" id="6312006">int</span><span class="op" id="6312009">(</span><span class="ident" id="6312010">idx</span><span class="op" id="6312013">)</span>&nbsp;<span class="op" id="6312015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312023">paletted</span><span class="op" id="6312031">.</span><span class="ident" id="6312032">Palette</span>&nbsp;<span class="op" id="6312040">=</span>&nbsp;<span class="ident" id="6312042">paletted</span><span class="op" id="6312050">.</span><span class="ident" id="6312051">Palette</span><span class="op" id="6312058">[</span><span class="op" id="6312059">:</span><span class="builtintype" id="6312060">int</span><span class="op" id="6312063">(</span><span class="ident" id="6312064">idx</span><span class="op" id="6312067">)</span><span class="op" id="6312068">+</span><span class="num" id="6312069">1</span><span class="op" id="6312070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312084">paletted</span><span class="op" id="6312092">.</span><span class="ident" id="6312093">SetColorIndex</span><span class="op" id="6312106">(</span><span class="ident" id="6312107">x</span><span class="op" id="6312108">+</span><span class="ident" id="6312109">x2</span><span class="op" id="6312111">,</span>&nbsp;<span class="ident" id="6312113">y</span><span class="op" id="6312114">,</span>&nbsp;<span class="ident" id="6312116">idx</span><span class="op" id="6312119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312126">b</span>&nbsp;<span class="op" id="6312128">&lt;&lt;=</span>&nbsp;<span class="num" id="6312132">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312147">case</span>&nbsp;<span class="ident" id="6312152">cbP4</span><span class="op" id="6312156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312161">for</span>&nbsp;<span class="ident" id="6312165">x</span>&nbsp;<span class="op" id="6312167">:=</span>&nbsp;<span class="num" id="6312170">0</span><span class="op" id="6312171">;</span>&nbsp;<span class="ident" id="6312173">x</span>&nbsp;<span class="op" id="6312175">&lt;</span>&nbsp;<span class="ident" id="6312177">width</span><span class="op" id="6312182">;</span>&nbsp;<span class="ident" id="6312184">x</span>&nbsp;<span class="op" id="6312186">+=</span>&nbsp;<span class="num" id="6312189">2</span>&nbsp;<span class="op" id="6312191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312197">b</span>&nbsp;<span class="op" id="6312199">:=</span>&nbsp;<span class="ident" id="6312202">cdat</span><span class="op" id="6312206">[</span><span class="ident" id="6312207">x</span><span class="op" id="6312208">/</span><span class="num" id="6312209">2</span><span class="op" id="6312210">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312216">for</span>&nbsp;<span class="ident" id="6312220">x2</span>&nbsp;<span class="op" id="6312223">:=</span>&nbsp;<span class="num" id="6312226">0</span><span class="op" id="6312227">;</span>&nbsp;<span class="ident" id="6312229">x2</span>&nbsp;<span class="op" id="6312232">&lt;</span>&nbsp;<span class="num" id="6312234">2</span>&nbsp;<span class="op" id="6312236">&amp;&amp;</span>&nbsp;<span class="ident" id="6312239">x</span><span class="op" id="6312240">+</span><span class="ident" id="6312241">x2</span>&nbsp;<span class="op" id="6312244">&lt;</span>&nbsp;<span class="ident" id="6312246">width</span><span class="op" id="6312251">;</span>&nbsp;<span class="ident" id="6312253">x2</span><span class="op" id="6312255">++</span>&nbsp;<span class="op" id="6312258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312265">idx</span>&nbsp;<span class="op" id="6312269">:=</span>&nbsp;<span class="ident" id="6312272">b</span>&nbsp;<span class="op" id="6312274">&gt;&gt;</span>&nbsp;<span class="num" id="6312277">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312284">if</span>&nbsp;<span class="builtinfunc" id="6312287">len</span><span class="op" id="6312290">(</span><span class="ident" id="6312291">paletted</span><span class="op" id="6312299">.</span><span class="ident" id="6312300">Palette</span><span class="op" id="6312307">)</span>&nbsp;<span class="op" id="6312309">&lt;=</span>&nbsp;<span class="builtintype" id="6312312">int</span><span class="op" id="6312315">(</span><span class="ident" id="6312316">idx</span><span class="op" id="6312319">)</span>&nbsp;<span class="op" id="6312321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312329">paletted</span><span class="op" id="6312337">.</span><span class="ident" id="6312338">Palette</span>&nbsp;<span class="op" id="6312346">=</span>&nbsp;<span class="ident" id="6312348">paletted</span><span class="op" id="6312356">.</span><span class="ident" id="6312357">Palette</span><span class="op" id="6312364">[</span><span class="op" id="6312365">:</span><span class="builtintype" id="6312366">int</span><span class="op" id="6312369">(</span><span class="ident" id="6312370">idx</span><span class="op" id="6312373">)</span><span class="op" id="6312374">+</span><span class="num" id="6312375">1</span><span class="op" id="6312376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312383">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312390">paletted</span><span class="op" id="6312398">.</span><span class="ident" id="6312399">SetColorIndex</span><span class="op" id="6312412">(</span><span class="ident" id="6312413">x</span><span class="op" id="6312414">+</span><span class="ident" id="6312415">x2</span><span class="op" id="6312417">,</span>&nbsp;<span class="ident" id="6312419">y</span><span class="op" id="6312420">,</span>&nbsp;<span class="ident" id="6312422">idx</span><span class="op" id="6312425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312432">b</span>&nbsp;<span class="op" id="6312434">&lt;&lt;=</span>&nbsp;<span class="num" id="6312438">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312453">case</span>&nbsp;<span class="ident" id="6312458">cbP8</span><span class="op" id="6312462">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312467">if</span>&nbsp;<span class="builtinfunc" id="6312470">len</span><span class="op" id="6312473">(</span><span class="ident" id="6312474">paletted</span><span class="op" id="6312482">.</span><span class="ident" id="6312483">Palette</span><span class="op" id="6312490">)</span>&nbsp;<span class="op" id="6312492">!=</span>&nbsp;<span class="num" id="6312495">255</span>&nbsp;<span class="op" id="6312499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312505">for</span>&nbsp;<span class="ident" id="6312509">x</span>&nbsp;<span class="op" id="6312511">:=</span>&nbsp;<span class="num" id="6312514">0</span><span class="op" id="6312515">;</span>&nbsp;<span class="ident" id="6312517">x</span>&nbsp;<span class="op" id="6312519">&lt;</span>&nbsp;<span class="ident" id="6312521">width</span><span class="op" id="6312526">;</span>&nbsp;<span class="ident" id="6312528">x</span><span class="op" id="6312529">++</span>&nbsp;<span class="op" id="6312532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312539">if</span>&nbsp;<span class="builtinfunc" id="6312542">len</span><span class="op" id="6312545">(</span><span class="ident" id="6312546">paletted</span><span class="op" id="6312554">.</span><span class="ident" id="6312555">Palette</span><span class="op" id="6312562">)</span>&nbsp;<span class="op" id="6312564">&lt;=</span>&nbsp;<span class="builtintype" id="6312567">int</span><span class="op" id="6312570">(</span><span class="ident" id="6312571">cdat</span><span class="op" id="6312575">[</span><span class="ident" id="6312576">x</span><span class="op" id="6312577">]</span><span class="op" id="6312578">)</span>&nbsp;<span class="op" id="6312580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312588">paletted</span><span class="op" id="6312596">.</span><span class="ident" id="6312597">Palette</span>&nbsp;<span class="op" id="6312605">=</span>&nbsp;<span class="ident" id="6312607">paletted</span><span class="op" id="6312615">.</span><span class="ident" id="6312616">Palette</span><span class="op" id="6312623">[</span><span class="op" id="6312624">:</span><span class="builtintype" id="6312625">int</span><span class="op" id="6312628">(</span><span class="ident" id="6312629">cdat</span><span class="op" id="6312633">[</span><span class="ident" id="6312634">x</span><span class="op" id="6312635">]</span><span class="op" id="6312636">)</span><span class="op" id="6312637">+</span><span class="num" id="6312638">1</span><span class="op" id="6312639">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312646">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6312662">copy</span><span class="op" id="6312666">(</span><span class="ident" id="6312667">paletted</span><span class="op" id="6312675">.</span><span class="ident" id="6312676">Pix</span><span class="op" id="6312679">[</span><span class="ident" id="6312680">pixOffset</span><span class="op" id="6312689">:</span><span class="op" id="6312690">]</span><span class="op" id="6312691">,</span>&nbsp;<span class="ident" id="6312693">cdat</span><span class="op" id="6312697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312702">pixOffset</span>&nbsp;<span class="op" id="6312712">+=</span>&nbsp;<span class="ident" id="6312715">paletted</span><span class="op" id="6312723">.</span><span class="ident" id="6312724">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312733">case</span>&nbsp;<span class="ident" id="6312738">cbTCA8</span><span class="op" id="6312744">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6312749">copy</span><span class="op" id="6312753">(</span><span class="ident" id="6312754">nrgba</span><span class="op" id="6312759">.</span><span class="ident" id="6312760">Pix</span><span class="op" id="6312763">[</span><span class="ident" id="6312764">pixOffset</span><span class="op" id="6312773">:</span><span class="op" id="6312774">]</span><span class="op" id="6312775">,</span>&nbsp;<span class="ident" id="6312777">cdat</span><span class="op" id="6312781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312786">pixOffset</span>&nbsp;<span class="op" id="6312796">+=</span>&nbsp;<span class="ident" id="6312799">nrgba</span><span class="op" id="6312804">.</span><span class="ident" id="6312805">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312814">case</span>&nbsp;<span class="ident" id="6312819">cbG16</span><span class="op" id="6312824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312829">for</span>&nbsp;<span class="ident" id="6312833">x</span>&nbsp;<span class="op" id="6312835">:=</span>&nbsp;<span class="num" id="6312838">0</span><span class="op" id="6312839">;</span>&nbsp;<span class="ident" id="6312841">x</span>&nbsp;<span class="op" id="6312843">&lt;</span>&nbsp;<span class="ident" id="6312845">width</span><span class="op" id="6312850">;</span>&nbsp;<span class="ident" id="6312852">x</span><span class="op" id="6312853">++</span>&nbsp;<span class="op" id="6312856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312862">ycol</span>&nbsp;<span class="op" id="6312867">:=</span>&nbsp;<span class="builtintype" id="6312870">uint16</span><span class="op" id="6312876">(</span><span class="ident" id="6312877">cdat</span><span class="op" id="6312881">[</span><span class="num" id="6312882">2</span><span class="op" id="6312883">*</span><span class="ident" id="6312884">x</span><span class="op" id="6312885">+</span><span class="num" id="6312886">0</span><span class="op" id="6312887">]</span><span class="op" id="6312888">)</span><span class="op" id="6312889">&lt;&lt;</span><span class="num" id="6312891">8</span>&nbsp;<span class="op" id="6312893">|</span>&nbsp;<span class="builtintype" id="6312895">uint16</span><span class="op" id="6312901">(</span><span class="ident" id="6312902">cdat</span><span class="op" id="6312906">[</span><span class="num" id="6312907">2</span><span class="op" id="6312908">*</span><span class="ident" id="6312909">x</span><span class="op" id="6312910">+</span><span class="num" id="6312911">1</span><span class="op" id="6312912">]</span><span class="op" id="6312913">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6312919">gray16</span><span class="op" id="6312925">.</span><span class="ident" id="6312926">SetGray16</span><span class="op" id="6312935">(</span><span class="ident" id="6312936">x</span><span class="op" id="6312937">,</span>&nbsp;<span class="ident" id="6312939">y</span><span class="op" id="6312940">,</span>&nbsp;<span class="ident" id="6312942">color</span><span class="op" id="6312947">.</span><span class="ident" id="6312948">Gray16</span><span class="op" id="6312954">{</span><span class="ident" id="6312955">ycol</span><span class="op" id="6312959">}</span><span class="op" id="6312960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6312965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312969">case</span>&nbsp;<span class="ident" id="6312974">cbGA16</span><span class="op" id="6312980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312985">for</span>&nbsp;<span class="ident" id="6312989">x</span>&nbsp;<span class="op" id="6312991">:=</span>&nbsp;<span class="num" id="6312994">0</span><span class="op" id="6312995">;</span>&nbsp;<span class="ident" id="6312997">x</span>&nbsp;<span class="op" id="6312999">&lt;</span>&nbsp;<span class="ident" id="6313001">width</span><span class="op" id="6313006">;</span>&nbsp;<span class="ident" id="6313008">x</span><span class="op" id="6313009">++</span>&nbsp;<span class="op" id="6313012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313018">ycol</span>&nbsp;<span class="op" id="6313023">:=</span>&nbsp;<span class="builtintype" id="6313026">uint16</span><span class="op" id="6313032">(</span><span class="ident" id="6313033">cdat</span><span class="op" id="6313037">[</span><span class="num" id="6313038">4</span><span class="op" id="6313039">*</span><span class="ident" id="6313040">x</span><span class="op" id="6313041">+</span><span class="num" id="6313042">0</span><span class="op" id="6313043">]</span><span class="op" id="6313044">)</span><span class="op" id="6313045">&lt;&lt;</span><span class="num" id="6313047">8</span>&nbsp;<span class="op" id="6313049">|</span>&nbsp;<span class="builtintype" id="6313051">uint16</span><span class="op" id="6313057">(</span><span class="ident" id="6313058">cdat</span><span class="op" id="6313062">[</span><span class="num" id="6313063">4</span><span class="op" id="6313064">*</span><span class="ident" id="6313065">x</span><span class="op" id="6313066">+</span><span class="num" id="6313067">1</span><span class="op" id="6313068">]</span><span class="op" id="6313069">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313075">acol</span>&nbsp;<span class="op" id="6313080">:=</span>&nbsp;<span class="builtintype" id="6313083">uint16</span><span class="op" id="6313089">(</span><span class="ident" id="6313090">cdat</span><span class="op" id="6313094">[</span><span class="num" id="6313095">4</span><span class="op" id="6313096">*</span><span class="ident" id="6313097">x</span><span class="op" id="6313098">+</span><span class="num" id="6313099">2</span><span class="op" id="6313100">]</span><span class="op" id="6313101">)</span><span class="op" id="6313102">&lt;&lt;</span><span class="num" id="6313104">8</span>&nbsp;<span class="op" id="6313106">|</span>&nbsp;<span class="builtintype" id="6313108">uint16</span><span class="op" id="6313114">(</span><span class="ident" id="6313115">cdat</span><span class="op" id="6313119">[</span><span class="num" id="6313120">4</span><span class="op" id="6313121">*</span><span class="ident" id="6313122">x</span><span class="op" id="6313123">+</span><span class="num" id="6313124">3</span><span class="op" id="6313125">]</span><span class="op" id="6313126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313132">nrgba64</span><span class="op" id="6313139">.</span><span class="ident" id="6313140">SetNRGBA64</span><span class="op" id="6313150">(</span><span class="ident" id="6313151">x</span><span class="op" id="6313152">,</span>&nbsp;<span class="ident" id="6313154">y</span><span class="op" id="6313155">,</span>&nbsp;<span class="ident" id="6313157">color</span><span class="op" id="6313162">.</span><span class="ident" id="6313163">NRGBA64</span><span class="op" id="6313170">{</span><span class="ident" id="6313171">ycol</span><span class="op" id="6313175">,</span>&nbsp;<span class="ident" id="6313177">ycol</span><span class="op" id="6313181">,</span>&nbsp;<span class="ident" id="6313183">ycol</span><span class="op" id="6313187">,</span>&nbsp;<span class="ident" id="6313189">acol</span><span class="op" id="6313193">}</span><span class="op" id="6313194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313203">case</span>&nbsp;<span class="ident" id="6313208">cbTC16</span><span class="op" id="6313214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313219">for</span>&nbsp;<span class="ident" id="6313223">x</span>&nbsp;<span class="op" id="6313225">:=</span>&nbsp;<span class="num" id="6313228">0</span><span class="op" id="6313229">;</span>&nbsp;<span class="ident" id="6313231">x</span>&nbsp;<span class="op" id="6313233">&lt;</span>&nbsp;<span class="ident" id="6313235">width</span><span class="op" id="6313240">;</span>&nbsp;<span class="ident" id="6313242">x</span><span class="op" id="6313243">++</span>&nbsp;<span class="op" id="6313246">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313252">rcol</span>&nbsp;<span class="op" id="6313257">:=</span>&nbsp;<span class="builtintype" id="6313260">uint16</span><span class="op" id="6313266">(</span><span class="ident" id="6313267">cdat</span><span class="op" id="6313271">[</span><span class="num" id="6313272">6</span><span class="op" id="6313273">*</span><span class="ident" id="6313274">x</span><span class="op" id="6313275">+</span><span class="num" id="6313276">0</span><span class="op" id="6313277">]</span><span class="op" id="6313278">)</span><span class="op" id="6313279">&lt;&lt;</span><span class="num" id="6313281">8</span>&nbsp;<span class="op" id="6313283">|</span>&nbsp;<span class="builtintype" id="6313285">uint16</span><span class="op" id="6313291">(</span><span class="ident" id="6313292">cdat</span><span class="op" id="6313296">[</span><span class="num" id="6313297">6</span><span class="op" id="6313298">*</span><span class="ident" id="6313299">x</span><span class="op" id="6313300">+</span><span class="num" id="6313301">1</span><span class="op" id="6313302">]</span><span class="op" id="6313303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313309">gcol</span>&nbsp;<span class="op" id="6313314">:=</span>&nbsp;<span class="builtintype" id="6313317">uint16</span><span class="op" id="6313323">(</span><span class="ident" id="6313324">cdat</span><span class="op" id="6313328">[</span><span class="num" id="6313329">6</span><span class="op" id="6313330">*</span><span class="ident" id="6313331">x</span><span class="op" id="6313332">+</span><span class="num" id="6313333">2</span><span class="op" id="6313334">]</span><span class="op" id="6313335">)</span><span class="op" id="6313336">&lt;&lt;</span><span class="num" id="6313338">8</span>&nbsp;<span class="op" id="6313340">|</span>&nbsp;<span class="builtintype" id="6313342">uint16</span><span class="op" id="6313348">(</span><span class="ident" id="6313349">cdat</span><span class="op" id="6313353">[</span><span class="num" id="6313354">6</span><span class="op" id="6313355">*</span><span class="ident" id="6313356">x</span><span class="op" id="6313357">+</span><span class="num" id="6313358">3</span><span class="op" id="6313359">]</span><span class="op" id="6313360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313366">bcol</span>&nbsp;<span class="op" id="6313371">:=</span>&nbsp;<span class="builtintype" id="6313374">uint16</span><span class="op" id="6313380">(</span><span class="ident" id="6313381">cdat</span><span class="op" id="6313385">[</span><span class="num" id="6313386">6</span><span class="op" id="6313387">*</span><span class="ident" id="6313388">x</span><span class="op" id="6313389">+</span><span class="num" id="6313390">4</span><span class="op" id="6313391">]</span><span class="op" id="6313392">)</span><span class="op" id="6313393">&lt;&lt;</span><span class="num" id="6313395">8</span>&nbsp;<span class="op" id="6313397">|</span>&nbsp;<span class="builtintype" id="6313399">uint16</span><span class="op" id="6313405">(</span><span class="ident" id="6313406">cdat</span><span class="op" id="6313410">[</span><span class="num" id="6313411">6</span><span class="op" id="6313412">*</span><span class="ident" id="6313413">x</span><span class="op" id="6313414">+</span><span class="num" id="6313415">5</span><span class="op" id="6313416">]</span><span class="op" id="6313417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313423">rgba64</span><span class="op" id="6313429">.</span><span class="ident" id="6313430">SetRGBA64</span><span class="op" id="6313439">(</span><span class="ident" id="6313440">x</span><span class="op" id="6313441">,</span>&nbsp;<span class="ident" id="6313443">y</span><span class="op" id="6313444">,</span>&nbsp;<span class="ident" id="6313446">color</span><span class="op" id="6313451">.</span><span class="ident" id="6313452">RGBA64</span><span class="op" id="6313458">{</span><span class="ident" id="6313459">rcol</span><span class="op" id="6313463">,</span>&nbsp;<span class="ident" id="6313465">gcol</span><span class="op" id="6313469">,</span>&nbsp;<span class="ident" id="6313471">bcol</span><span class="op" id="6313475">,</span>&nbsp;<span class="num" id="6313477">0xffff</span><span class="op" id="6313483">}</span><span class="op" id="6313484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313489">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313493">case</span>&nbsp;<span class="ident" id="6313498">cbTCA16</span><span class="op" id="6313505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313510">for</span>&nbsp;<span class="ident" id="6313514">x</span>&nbsp;<span class="op" id="6313516">:=</span>&nbsp;<span class="num" id="6313519">0</span><span class="op" id="6313520">;</span>&nbsp;<span class="ident" id="6313522">x</span>&nbsp;<span class="op" id="6313524">&lt;</span>&nbsp;<span class="ident" id="6313526">width</span><span class="op" id="6313531">;</span>&nbsp;<span class="ident" id="6313533">x</span><span class="op" id="6313534">++</span>&nbsp;<span class="op" id="6313537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313543">rcol</span>&nbsp;<span class="op" id="6313548">:=</span>&nbsp;<span class="builtintype" id="6313551">uint16</span><span class="op" id="6313557">(</span><span class="ident" id="6313558">cdat</span><span class="op" id="6313562">[</span><span class="num" id="6313563">8</span><span class="op" id="6313564">*</span><span class="ident" id="6313565">x</span><span class="op" id="6313566">+</span><span class="num" id="6313567">0</span><span class="op" id="6313568">]</span><span class="op" id="6313569">)</span><span class="op" id="6313570">&lt;&lt;</span><span class="num" id="6313572">8</span>&nbsp;<span class="op" id="6313574">|</span>&nbsp;<span class="builtintype" id="6313576">uint16</span><span class="op" id="6313582">(</span><span class="ident" id="6313583">cdat</span><span class="op" id="6313587">[</span><span class="num" id="6313588">8</span><span class="op" id="6313589">*</span><span class="ident" id="6313590">x</span><span class="op" id="6313591">+</span><span class="num" id="6313592">1</span><span class="op" id="6313593">]</span><span class="op" id="6313594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313600">gcol</span>&nbsp;<span class="op" id="6313605">:=</span>&nbsp;<span class="builtintype" id="6313608">uint16</span><span class="op" id="6313614">(</span><span class="ident" id="6313615">cdat</span><span class="op" id="6313619">[</span><span class="num" id="6313620">8</span><span class="op" id="6313621">*</span><span class="ident" id="6313622">x</span><span class="op" id="6313623">+</span><span class="num" id="6313624">2</span><span class="op" id="6313625">]</span><span class="op" id="6313626">)</span><span class="op" id="6313627">&lt;&lt;</span><span class="num" id="6313629">8</span>&nbsp;<span class="op" id="6313631">|</span>&nbsp;<span class="builtintype" id="6313633">uint16</span><span class="op" id="6313639">(</span><span class="ident" id="6313640">cdat</span><span class="op" id="6313644">[</span><span class="num" id="6313645">8</span><span class="op" id="6313646">*</span><span class="ident" id="6313647">x</span><span class="op" id="6313648">+</span><span class="num" id="6313649">3</span><span class="op" id="6313650">]</span><span class="op" id="6313651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313657">bcol</span>&nbsp;<span class="op" id="6313662">:=</span>&nbsp;<span class="builtintype" id="6313665">uint16</span><span class="op" id="6313671">(</span><span class="ident" id="6313672">cdat</span><span class="op" id="6313676">[</span><span class="num" id="6313677">8</span><span class="op" id="6313678">*</span><span class="ident" id="6313679">x</span><span class="op" id="6313680">+</span><span class="num" id="6313681">4</span><span class="op" id="6313682">]</span><span class="op" id="6313683">)</span><span class="op" id="6313684">&lt;&lt;</span><span class="num" id="6313686">8</span>&nbsp;<span class="op" id="6313688">|</span>&nbsp;<span class="builtintype" id="6313690">uint16</span><span class="op" id="6313696">(</span><span class="ident" id="6313697">cdat</span><span class="op" id="6313701">[</span><span class="num" id="6313702">8</span><span class="op" id="6313703">*</span><span class="ident" id="6313704">x</span><span class="op" id="6313705">+</span><span class="num" id="6313706">5</span><span class="op" id="6313707">]</span><span class="op" id="6313708">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313714">acol</span>&nbsp;<span class="op" id="6313719">:=</span>&nbsp;<span class="builtintype" id="6313722">uint16</span><span class="op" id="6313728">(</span><span class="ident" id="6313729">cdat</span><span class="op" id="6313733">[</span><span class="num" id="6313734">8</span><span class="op" id="6313735">*</span><span class="ident" id="6313736">x</span><span class="op" id="6313737">+</span><span class="num" id="6313738">6</span><span class="op" id="6313739">]</span><span class="op" id="6313740">)</span><span class="op" id="6313741">&lt;&lt;</span><span class="num" id="6313743">8</span>&nbsp;<span class="op" id="6313745">|</span>&nbsp;<span class="builtintype" id="6313747">uint16</span><span class="op" id="6313753">(</span><span class="ident" id="6313754">cdat</span><span class="op" id="6313758">[</span><span class="num" id="6313759">8</span><span class="op" id="6313760">*</span><span class="ident" id="6313761">x</span><span class="op" id="6313762">+</span><span class="num" id="6313763">7</span><span class="op" id="6313764">]</span><span class="op" id="6313765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313771">nrgba64</span><span class="op" id="6313778">.</span><span class="ident" id="6313779">SetNRGBA64</span><span class="op" id="6313789">(</span><span class="ident" id="6313790">x</span><span class="op" id="6313791">,</span>&nbsp;<span class="ident" id="6313793">y</span><span class="op" id="6313794">,</span>&nbsp;<span class="ident" id="6313796">color</span><span class="op" id="6313801">.</span><span class="ident" id="6313802">NRGBA64</span><span class="op" id="6313809">{</span><span class="ident" id="6313810">rcol</span><span class="op" id="6313814">,</span>&nbsp;<span class="ident" id="6313816">gcol</span><span class="op" id="6313820">,</span>&nbsp;<span class="ident" id="6313822">bcol</span><span class="op" id="6313826">,</span>&nbsp;<span class="ident" id="6313828">acol</span><span class="op" id="6313832">}</span><span class="op" id="6313833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6313847">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313903">pr</span><span class="op" id="6313905">,</span>&nbsp;<span class="ident" id="6313907">cr</span>&nbsp;<span class="op" id="6313910">=</span>&nbsp;<span class="ident" id="6313912">cr</span><span class="op" id="6313914">,</span>&nbsp;<span class="ident" id="6313916">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6313924">return</span>&nbsp;<span class="ident" id="6313931">img</span><span class="op" id="6313934">,</span>&nbsp;<span class="ident" id="6313936">nil</span><br>
<span class="lineno">585</span><span class="op" id="6313940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6313943">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6314006">func</span>&nbsp;<span class="op" id="6314011">(</span><span class="ident" id="6314012">d</span>&nbsp;<span class="op" id="6314014">*</span><span class="ident" id="6314015">decoder</span><span class="op" id="6314022">)</span>&nbsp;<span class="ident" id="6314024">mergePassInto</span><span class="op" id="6314037">(</span><span class="ident" id="6314038">dst</span>&nbsp;<span class="ident" id="6314042">image</span><span class="op" id="6314047">.</span><span class="ident" id="6314048">Image</span><span class="op" id="6314053">,</span>&nbsp;<span class="ident" id="6314055">src</span>&nbsp;<span class="ident" id="6314059">image</span><span class="op" id="6314064">.</span><span class="ident" id="6314065">Image</span><span class="op" id="6314070">,</span>&nbsp;<span class="ident" id="6314072">pass</span>&nbsp;<span class="builtintype" id="6314077">int</span><span class="op" id="6314080">)</span>&nbsp;<span class="op" id="6314082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314085">p</span>&nbsp;<span class="op" id="6314087">:=</span>&nbsp;<span class="ident" id="6314090">interlacing</span><span class="op" id="6314101">[</span><span class="ident" id="6314102">pass</span><span class="op" id="6314106">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314109">var</span>&nbsp;<span class="op" id="6314113">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314117">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314131">[</span><span class="op" id="6314132">]</span><span class="builtintype" id="6314133">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314141">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314155">[</span><span class="op" id="6314156">]</span><span class="builtintype" id="6314157">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314165">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6314179">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314185">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314199">image</span><span class="op" id="6314204">.</span><span class="ident" id="6314205">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314217">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6314231">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314239">switch</span>&nbsp;<span class="ident" id="6314246">target</span>&nbsp;<span class="op" id="6314253">:=</span>&nbsp;<span class="ident" id="6314256">dst</span><span class="op" id="6314259">.</span><span class="op" id="6314260">(</span><span class="keyword" id="6314261">type</span><span class="op" id="6314265">)</span>&nbsp;<span class="op" id="6314267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314270">case</span>&nbsp;<span class="op" id="6314275">*</span><span class="ident" id="6314276">image</span><span class="op" id="6314281">.</span><span class="ident" id="6314282">Alpha</span><span class="op" id="6314287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314291">srcPix</span>&nbsp;<span class="op" id="6314298">=</span>&nbsp;<span class="ident" id="6314300">src</span><span class="op" id="6314303">.</span><span class="op" id="6314304">(</span><span class="op" id="6314305">*</span><span class="ident" id="6314306">image</span><span class="op" id="6314311">.</span><span class="ident" id="6314312">Alpha</span><span class="op" id="6314317">)</span><span class="op" id="6314318">.</span><span class="ident" id="6314319">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314325">dstPix</span><span class="op" id="6314331">,</span>&nbsp;<span class="ident" id="6314333">stride</span><span class="op" id="6314339">,</span>&nbsp;<span class="ident" id="6314341">rect</span>&nbsp;<span class="op" id="6314346">=</span>&nbsp;<span class="ident" id="6314348">target</span><span class="op" id="6314354">.</span><span class="ident" id="6314355">Pix</span><span class="op" id="6314358">,</span>&nbsp;<span class="ident" id="6314360">target</span><span class="op" id="6314366">.</span><span class="ident" id="6314367">Stride</span><span class="op" id="6314373">,</span>&nbsp;<span class="ident" id="6314375">target</span><span class="op" id="6314381">.</span><span class="ident" id="6314382">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314389">bytesPerPixel</span>&nbsp;<span class="op" id="6314403">=</span>&nbsp;<span class="num" id="6314405">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314408">case</span>&nbsp;<span class="op" id="6314413">*</span><span class="ident" id="6314414">image</span><span class="op" id="6314419">.</span><span class="ident" id="6314420">Alpha16</span><span class="op" id="6314427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314431">srcPix</span>&nbsp;<span class="op" id="6314438">=</span>&nbsp;<span class="ident" id="6314440">src</span><span class="op" id="6314443">.</span><span class="op" id="6314444">(</span><span class="op" id="6314445">*</span><span class="ident" id="6314446">image</span><span class="op" id="6314451">.</span><span class="ident" id="6314452">Alpha16</span><span class="op" id="6314459">)</span><span class="op" id="6314460">.</span><span class="ident" id="6314461">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314467">dstPix</span><span class="op" id="6314473">,</span>&nbsp;<span class="ident" id="6314475">stride</span><span class="op" id="6314481">,</span>&nbsp;<span class="ident" id="6314483">rect</span>&nbsp;<span class="op" id="6314488">=</span>&nbsp;<span class="ident" id="6314490">target</span><span class="op" id="6314496">.</span><span class="ident" id="6314497">Pix</span><span class="op" id="6314500">,</span>&nbsp;<span class="ident" id="6314502">target</span><span class="op" id="6314508">.</span><span class="ident" id="6314509">Stride</span><span class="op" id="6314515">,</span>&nbsp;<span class="ident" id="6314517">target</span><span class="op" id="6314523">.</span><span class="ident" id="6314524">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314531">bytesPerPixel</span>&nbsp;<span class="op" id="6314545">=</span>&nbsp;<span class="num" id="6314547">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314550">case</span>&nbsp;<span class="op" id="6314555">*</span><span class="ident" id="6314556">image</span><span class="op" id="6314561">.</span><span class="ident" id="6314562">Gray</span><span class="op" id="6314566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314570">srcPix</span>&nbsp;<span class="op" id="6314577">=</span>&nbsp;<span class="ident" id="6314579">src</span><span class="op" id="6314582">.</span><span class="op" id="6314583">(</span><span class="op" id="6314584">*</span><span class="ident" id="6314585">image</span><span class="op" id="6314590">.</span><span class="ident" id="6314591">Gray</span><span class="op" id="6314595">)</span><span class="op" id="6314596">.</span><span class="ident" id="6314597">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314603">dstPix</span><span class="op" id="6314609">,</span>&nbsp;<span class="ident" id="6314611">stride</span><span class="op" id="6314617">,</span>&nbsp;<span class="ident" id="6314619">rect</span>&nbsp;<span class="op" id="6314624">=</span>&nbsp;<span class="ident" id="6314626">target</span><span class="op" id="6314632">.</span><span class="ident" id="6314633">Pix</span><span class="op" id="6314636">,</span>&nbsp;<span class="ident" id="6314638">target</span><span class="op" id="6314644">.</span><span class="ident" id="6314645">Stride</span><span class="op" id="6314651">,</span>&nbsp;<span class="ident" id="6314653">target</span><span class="op" id="6314659">.</span><span class="ident" id="6314660">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314667">bytesPerPixel</span>&nbsp;<span class="op" id="6314681">=</span>&nbsp;<span class="num" id="6314683">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314686">case</span>&nbsp;<span class="op" id="6314691">*</span><span class="ident" id="6314692">image</span><span class="op" id="6314697">.</span><span class="ident" id="6314698">Gray16</span><span class="op" id="6314704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314708">srcPix</span>&nbsp;<span class="op" id="6314715">=</span>&nbsp;<span class="ident" id="6314717">src</span><span class="op" id="6314720">.</span><span class="op" id="6314721">(</span><span class="op" id="6314722">*</span><span class="ident" id="6314723">image</span><span class="op" id="6314728">.</span><span class="ident" id="6314729">Gray16</span><span class="op" id="6314735">)</span><span class="op" id="6314736">.</span><span class="ident" id="6314737">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314743">dstPix</span><span class="op" id="6314749">,</span>&nbsp;<span class="ident" id="6314751">stride</span><span class="op" id="6314757">,</span>&nbsp;<span class="ident" id="6314759">rect</span>&nbsp;<span class="op" id="6314764">=</span>&nbsp;<span class="ident" id="6314766">target</span><span class="op" id="6314772">.</span><span class="ident" id="6314773">Pix</span><span class="op" id="6314776">,</span>&nbsp;<span class="ident" id="6314778">target</span><span class="op" id="6314784">.</span><span class="ident" id="6314785">Stride</span><span class="op" id="6314791">,</span>&nbsp;<span class="ident" id="6314793">target</span><span class="op" id="6314799">.</span><span class="ident" id="6314800">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314807">bytesPerPixel</span>&nbsp;<span class="op" id="6314821">=</span>&nbsp;<span class="num" id="6314823">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314826">case</span>&nbsp;<span class="op" id="6314831">*</span><span class="ident" id="6314832">image</span><span class="op" id="6314837">.</span><span class="ident" id="6314838">NRGBA</span><span class="op" id="6314843">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314847">srcPix</span>&nbsp;<span class="op" id="6314854">=</span>&nbsp;<span class="ident" id="6314856">src</span><span class="op" id="6314859">.</span><span class="op" id="6314860">(</span><span class="op" id="6314861">*</span><span class="ident" id="6314862">image</span><span class="op" id="6314867">.</span><span class="ident" id="6314868">NRGBA</span><span class="op" id="6314873">)</span><span class="op" id="6314874">.</span><span class="ident" id="6314875">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314881">dstPix</span><span class="op" id="6314887">,</span>&nbsp;<span class="ident" id="6314889">stride</span><span class="op" id="6314895">,</span>&nbsp;<span class="ident" id="6314897">rect</span>&nbsp;<span class="op" id="6314902">=</span>&nbsp;<span class="ident" id="6314904">target</span><span class="op" id="6314910">.</span><span class="ident" id="6314911">Pix</span><span class="op" id="6314914">,</span>&nbsp;<span class="ident" id="6314916">target</span><span class="op" id="6314922">.</span><span class="ident" id="6314923">Stride</span><span class="op" id="6314929">,</span>&nbsp;<span class="ident" id="6314931">target</span><span class="op" id="6314937">.</span><span class="ident" id="6314938">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314945">bytesPerPixel</span>&nbsp;<span class="op" id="6314959">=</span>&nbsp;<span class="num" id="6314961">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314964">case</span>&nbsp;<span class="op" id="6314969">*</span><span class="ident" id="6314970">image</span><span class="op" id="6314975">.</span><span class="ident" id="6314976">NRGBA64</span><span class="op" id="6314983">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314987">srcPix</span>&nbsp;<span class="op" id="6314994">=</span>&nbsp;<span class="ident" id="6314996">src</span><span class="op" id="6314999">.</span><span class="op" id="6315000">(</span><span class="op" id="6315001">*</span><span class="ident" id="6315002">image</span><span class="op" id="6315007">.</span><span class="ident" id="6315008">NRGBA64</span><span class="op" id="6315015">)</span><span class="op" id="6315016">.</span><span class="ident" id="6315017">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315023">dstPix</span><span class="op" id="6315029">,</span>&nbsp;<span class="ident" id="6315031">stride</span><span class="op" id="6315037">,</span>&nbsp;<span class="ident" id="6315039">rect</span>&nbsp;<span class="op" id="6315044">=</span>&nbsp;<span class="ident" id="6315046">target</span><span class="op" id="6315052">.</span><span class="ident" id="6315053">Pix</span><span class="op" id="6315056">,</span>&nbsp;<span class="ident" id="6315058">target</span><span class="op" id="6315064">.</span><span class="ident" id="6315065">Stride</span><span class="op" id="6315071">,</span>&nbsp;<span class="ident" id="6315073">target</span><span class="op" id="6315079">.</span><span class="ident" id="6315080">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315087">bytesPerPixel</span>&nbsp;<span class="op" id="6315101">=</span>&nbsp;<span class="num" id="6315103">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315106">case</span>&nbsp;<span class="op" id="6315111">*</span><span class="ident" id="6315112">image</span><span class="op" id="6315117">.</span><span class="ident" id="6315118">Paletted</span><span class="op" id="6315126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315130">srcPix</span>&nbsp;<span class="op" id="6315137">=</span>&nbsp;<span class="ident" id="6315139">src</span><span class="op" id="6315142">.</span><span class="op" id="6315143">(</span><span class="op" id="6315144">*</span><span class="ident" id="6315145">image</span><span class="op" id="6315150">.</span><span class="ident" id="6315151">Paletted</span><span class="op" id="6315159">)</span><span class="op" id="6315160">.</span><span class="ident" id="6315161">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315167">dstPix</span><span class="op" id="6315173">,</span>&nbsp;<span class="ident" id="6315175">stride</span><span class="op" id="6315181">,</span>&nbsp;<span class="ident" id="6315183">rect</span>&nbsp;<span class="op" id="6315188">=</span>&nbsp;<span class="ident" id="6315190">target</span><span class="op" id="6315196">.</span><span class="ident" id="6315197">Pix</span><span class="op" id="6315200">,</span>&nbsp;<span class="ident" id="6315202">target</span><span class="op" id="6315208">.</span><span class="ident" id="6315209">Stride</span><span class="op" id="6315215">,</span>&nbsp;<span class="ident" id="6315217">target</span><span class="op" id="6315223">.</span><span class="ident" id="6315224">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315231">bytesPerPixel</span>&nbsp;<span class="op" id="6315245">=</span>&nbsp;<span class="num" id="6315247">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315250">case</span>&nbsp;<span class="op" id="6315255">*</span><span class="ident" id="6315256">image</span><span class="op" id="6315261">.</span><span class="ident" id="6315262">RGBA</span><span class="op" id="6315266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315270">srcPix</span>&nbsp;<span class="op" id="6315277">=</span>&nbsp;<span class="ident" id="6315279">src</span><span class="op" id="6315282">.</span><span class="op" id="6315283">(</span><span class="op" id="6315284">*</span><span class="ident" id="6315285">image</span><span class="op" id="6315290">.</span><span class="ident" id="6315291">RGBA</span><span class="op" id="6315295">)</span><span class="op" id="6315296">.</span><span class="ident" id="6315297">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315303">dstPix</span><span class="op" id="6315309">,</span>&nbsp;<span class="ident" id="6315311">stride</span><span class="op" id="6315317">,</span>&nbsp;<span class="ident" id="6315319">rect</span>&nbsp;<span class="op" id="6315324">=</span>&nbsp;<span class="ident" id="6315326">target</span><span class="op" id="6315332">.</span><span class="ident" id="6315333">Pix</span><span class="op" id="6315336">,</span>&nbsp;<span class="ident" id="6315338">target</span><span class="op" id="6315344">.</span><span class="ident" id="6315345">Stride</span><span class="op" id="6315351">,</span>&nbsp;<span class="ident" id="6315353">target</span><span class="op" id="6315359">.</span><span class="ident" id="6315360">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315367">bytesPerPixel</span>&nbsp;<span class="op" id="6315381">=</span>&nbsp;<span class="num" id="6315383">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315386">case</span>&nbsp;<span class="op" id="6315391">*</span><span class="ident" id="6315392">image</span><span class="op" id="6315397">.</span><span class="ident" id="6315398">RGBA64</span><span class="op" id="6315404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315408">srcPix</span>&nbsp;<span class="op" id="6315415">=</span>&nbsp;<span class="ident" id="6315417">src</span><span class="op" id="6315420">.</span><span class="op" id="6315421">(</span><span class="op" id="6315422">*</span><span class="ident" id="6315423">image</span><span class="op" id="6315428">.</span><span class="ident" id="6315429">RGBA64</span><span class="op" id="6315435">)</span><span class="op" id="6315436">.</span><span class="ident" id="6315437">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315443">dstPix</span><span class="op" id="6315449">,</span>&nbsp;<span class="ident" id="6315451">stride</span><span class="op" id="6315457">,</span>&nbsp;<span class="ident" id="6315459">rect</span>&nbsp;<span class="op" id="6315464">=</span>&nbsp;<span class="ident" id="6315466">target</span><span class="op" id="6315472">.</span><span class="ident" id="6315473">Pix</span><span class="op" id="6315476">,</span>&nbsp;<span class="ident" id="6315478">target</span><span class="op" id="6315484">.</span><span class="ident" id="6315485">Stride</span><span class="op" id="6315491">,</span>&nbsp;<span class="ident" id="6315493">target</span><span class="op" id="6315499">.</span><span class="ident" id="6315500">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315507">bytesPerPixel</span>&nbsp;<span class="op" id="6315521">=</span>&nbsp;<span class="num" id="6315523">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315526">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315529">s</span><span class="op" id="6315530">,</span>&nbsp;<span class="ident" id="6315532">bounds</span>&nbsp;<span class="op" id="6315539">:=</span>&nbsp;<span class="num" id="6315542">0</span><span class="op" id="6315543">,</span>&nbsp;<span class="ident" id="6315545">src</span><span class="op" id="6315548">.</span><span class="ident" id="6315549">Bounds</span><span class="op" id="6315555">(</span><span class="op" id="6315556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315559">for</span>&nbsp;<span class="ident" id="6315563">y</span>&nbsp;<span class="op" id="6315565">:=</span>&nbsp;<span class="ident" id="6315568">bounds</span><span class="op" id="6315574">.</span><span class="ident" id="6315575">Min</span><span class="op" id="6315578">.</span><span class="ident" id="6315579">Y</span><span class="op" id="6315580">;</span>&nbsp;<span class="ident" id="6315582">y</span>&nbsp;<span class="op" id="6315584">&lt;</span>&nbsp;<span class="ident" id="6315586">bounds</span><span class="op" id="6315592">.</span><span class="ident" id="6315593">Max</span><span class="op" id="6315596">.</span><span class="ident" id="6315597">Y</span><span class="op" id="6315598">;</span>&nbsp;<span class="ident" id="6315600">y</span><span class="op" id="6315601">++</span>&nbsp;<span class="op" id="6315604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315608">dBase</span>&nbsp;<span class="op" id="6315614">:=</span>&nbsp;<span class="op" id="6315617">(</span><span class="ident" id="6315618">y</span><span class="op" id="6315619">*</span><span class="ident" id="6315620">p</span><span class="op" id="6315621">.</span><span class="ident" id="6315622">yFactor</span><span class="op" id="6315629">+</span><span class="ident" id="6315630">p</span><span class="op" id="6315631">.</span><span class="ident" id="6315632">yOffset</span><span class="op" id="6315639">-</span><span class="ident" id="6315640">rect</span><span class="op" id="6315644">.</span><span class="ident" id="6315645">Min</span><span class="op" id="6315648">.</span><span class="ident" id="6315649">Y</span><span class="op" id="6315650">)</span><span class="op" id="6315651">*</span><span class="ident" id="6315652">stride</span>&nbsp;<span class="op" id="6315659">+</span>&nbsp;<span class="op" id="6315661">(</span><span class="ident" id="6315662">p</span><span class="op" id="6315663">.</span><span class="ident" id="6315664">xOffset</span><span class="op" id="6315671">-</span><span class="ident" id="6315672">rect</span><span class="op" id="6315676">.</span><span class="ident" id="6315677">Min</span><span class="op" id="6315680">.</span><span class="ident" id="6315681">X</span><span class="op" id="6315682">)</span><span class="op" id="6315683">*</span><span class="ident" id="6315684">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315700">for</span>&nbsp;<span class="ident" id="6315704">x</span>&nbsp;<span class="op" id="6315706">:=</span>&nbsp;<span class="ident" id="6315709">bounds</span><span class="op" id="6315715">.</span><span class="ident" id="6315716">Min</span><span class="op" id="6315719">.</span><span class="ident" id="6315720">X</span><span class="op" id="6315721">;</span>&nbsp;<span class="ident" id="6315723">x</span>&nbsp;<span class="op" id="6315725">&lt;</span>&nbsp;<span class="ident" id="6315727">bounds</span><span class="op" id="6315733">.</span><span class="ident" id="6315734">Max</span><span class="op" id="6315737">.</span><span class="ident" id="6315738">X</span><span class="op" id="6315739">;</span>&nbsp;<span class="ident" id="6315741">x</span><span class="op" id="6315742">++</span>&nbsp;<span class="op" id="6315745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315750">d</span>&nbsp;<span class="op" id="6315752">:=</span>&nbsp;<span class="ident" id="6315755">dBase</span>&nbsp;<span class="op" id="6315761">+</span>&nbsp;<span class="ident" id="6315763">x</span><span class="op" id="6315764">*</span><span class="ident" id="6315765">p</span><span class="op" id="6315766">.</span><span class="ident" id="6315767">xFactor</span><span class="op" id="6315774">*</span><span class="ident" id="6315775">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6315792">copy</span><span class="op" id="6315796">(</span><span class="ident" id="6315797">dstPix</span><span class="op" id="6315803">[</span><span class="ident" id="6315804">d</span><span class="op" id="6315805">:</span><span class="op" id="6315806">]</span><span class="op" id="6315807">,</span>&nbsp;<span class="ident" id="6315809">srcPix</span><span class="op" id="6315815">[</span><span class="ident" id="6315816">s</span><span class="op" id="6315817">:</span><span class="ident" id="6315818">s</span><span class="op" id="6315819">+</span><span class="ident" id="6315820">bytesPerPixel</span><span class="op" id="6315833">]</span><span class="op" id="6315834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315839">s</span>&nbsp;<span class="op" id="6315841">+=</span>&nbsp;<span class="ident" id="6315844">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315863">}</span><br>
<span class="lineno"></span><span class="op" id="6315865">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="6315868">func</span>&nbsp;<span class="op" id="6315873">(</span><span class="ident" id="6315874">d</span>&nbsp;<span class="op" id="6315876">*</span><span class="ident" id="6315877">decoder</span><span class="op" id="6315884">)</span>&nbsp;<span class="ident" id="6315886">parseIDAT</span><span class="op" id="6315895">(</span><span class="ident" id="6315896">length</span>&nbsp;<span class="builtintype" id="6315903">uint32</span><span class="op" id="6315909">)</span>&nbsp;<span class="op" id="6315911">(</span><span class="ident" id="6315912">err</span>&nbsp;<span class="builtintype" id="6315916">error</span><span class="op" id="6315921">)</span>&nbsp;<span class="op" id="6315923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315926">d</span><span class="op" id="6315927">.</span><span class="ident" id="6315928">idatLength</span>&nbsp;<span class="op" id="6315939">=</span>&nbsp;<span class="ident" id="6315941">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315949">d</span><span class="op" id="6315950">.</span><span class="ident" id="6315951">img</span><span class="op" id="6315954">,</span>&nbsp;<span class="ident" id="6315956">err</span>&nbsp;<span class="op" id="6315960">=</span>&nbsp;<span class="ident" id="6315962">d</span><span class="op" id="6315963">.</span><span class="ident" id="6315964">decode</span><span class="op" id="6315970">(</span><span class="op" id="6315971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315974">if</span>&nbsp;<span class="ident" id="6315977">err</span>&nbsp;<span class="op" id="6315981">!=</span>&nbsp;<span class="ident" id="6315984">nil</span>&nbsp;<span class="op" id="6315988">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315992">return</span>&nbsp;<span class="ident" id="6315999">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316007">return</span>&nbsp;<span class="ident" id="6316014">d</span><span class="op" id="6316015">.</span><span class="ident" id="6316016">verifyChecksum</span><span class="op" id="6316030">(</span><span class="op" id="6316031">)</span><br>
<span class="lineno"></span><span class="op" id="6316033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="6316036">func</span>&nbsp;<span class="op" id="6316041">(</span><span class="ident" id="6316042">d</span>&nbsp;<span class="op" id="6316044">*</span><span class="ident" id="6316045">decoder</span><span class="op" id="6316052">)</span>&nbsp;<span class="ident" id="6316054">parseIEND</span><span class="op" id="6316063">(</span><span class="ident" id="6316064">length</span>&nbsp;<span class="builtintype" id="6316071">uint32</span><span class="op" id="6316077">)</span>&nbsp;<span class="builtintype" id="6316079">error</span>&nbsp;<span class="op" id="6316085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316088">if</span>&nbsp;<span class="ident" id="6316091">length</span>&nbsp;<span class="op" id="6316098">!=</span>&nbsp;<span class="num" id="6316101">0</span>&nbsp;<span class="op" id="6316103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316107">return</span>&nbsp;<span class="ident" id="6316114">FormatError</span><span class="op" id="6316125">(</span><span class="string" id="6316126">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="6316143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316149">return</span>&nbsp;<span class="ident" id="6316156">d</span><span class="op" id="6316157">.</span><span class="ident" id="6316158">verifyChecksum</span><span class="op" id="6316172">(</span><span class="op" id="6316173">)</span><br>
<span class="lineno">660</span><span class="op" id="6316175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6316178">func</span>&nbsp;<span class="op" id="6316183">(</span><span class="ident" id="6316184">d</span>&nbsp;<span class="op" id="6316186">*</span><span class="ident" id="6316187">decoder</span><span class="op" id="6316194">)</span>&nbsp;<span class="ident" id="6316196">parseChunk</span><span class="op" id="6316206">(</span><span class="op" id="6316207">)</span>&nbsp;<span class="builtintype" id="6316209">error</span>&nbsp;<span class="op" id="6316215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316218">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316254">n</span><span class="op" id="6316255">,</span>&nbsp;<span class="ident" id="6316257">err</span>&nbsp;<span class="op" id="6316261">:=</span>&nbsp;<span class="ident" id="6316264">io</span><span class="op" id="6316266">.</span><span class="ident" id="6316267">ReadFull</span><span class="op" id="6316275">(</span><span class="ident" id="6316276">d</span><span class="op" id="6316277">.</span><span class="ident" id="6316278">r</span><span class="op" id="6316279">,</span>&nbsp;<span class="ident" id="6316281">d</span><span class="op" id="6316282">.</span><span class="ident" id="6316283">tmp</span><span class="op" id="6316286">[</span><span class="op" id="6316287">:</span><span class="num" id="6316288">8</span><span class="op" id="6316289">]</span><span class="op" id="6316290">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316293">if</span>&nbsp;<span class="ident" id="6316296">err</span>&nbsp;<span class="op" id="6316300">!=</span>&nbsp;<span class="ident" id="6316303">nil</span>&nbsp;<span class="op" id="6316307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316311">return</span>&nbsp;<span class="ident" id="6316318">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316326">length</span>&nbsp;<span class="op" id="6316333">:=</span>&nbsp;<span class="ident" id="6316336">binary</span><span class="op" id="6316342">.</span><span class="ident" id="6316343">BigEndian</span><span class="op" id="6316352">.</span><span class="ident" id="6316353">Uint32</span><span class="op" id="6316359">(</span><span class="ident" id="6316360">d</span><span class="op" id="6316361">.</span><span class="ident" id="6316362">tmp</span><span class="op" id="6316365">[</span><span class="op" id="6316366">:</span><span class="num" id="6316367">4</span><span class="op" id="6316368">]</span><span class="op" id="6316369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316372">d</span><span class="op" id="6316373">.</span><span class="ident" id="6316374">crc</span><span class="op" id="6316377">.</span><span class="ident" id="6316378">Reset</span><span class="op" id="6316383">(</span><span class="op" id="6316384">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316387">d</span><span class="op" id="6316388">.</span><span class="ident" id="6316389">crc</span><span class="op" id="6316392">.</span><span class="ident" id="6316393">Write</span><span class="op" id="6316398">(</span><span class="ident" id="6316399">d</span><span class="op" id="6316400">.</span><span class="ident" id="6316401">tmp</span><span class="op" id="6316404">[</span><span class="num" id="6316405">4</span><span class="op" id="6316406">:</span><span class="num" id="6316407">8</span><span class="op" id="6316408">]</span><span class="op" id="6316409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316413">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316438">switch</span>&nbsp;<span class="builtintype" id="6316445">string</span><span class="op" id="6316451">(</span><span class="ident" id="6316452">d</span><span class="op" id="6316453">.</span><span class="ident" id="6316454">tmp</span><span class="op" id="6316457">[</span><span class="num" id="6316458">4</span><span class="op" id="6316459">:</span><span class="num" id="6316460">8</span><span class="op" id="6316461">]</span><span class="op" id="6316462">)</span>&nbsp;<span class="op" id="6316464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316467">case</span>&nbsp;<span class="string" id="6316472">&#34;IHDR&#34;</span><span class="op" id="6316478">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316482">if</span>&nbsp;<span class="ident" id="6316485">d</span><span class="op" id="6316486">.</span><span class="ident" id="6316487">stage</span>&nbsp;<span class="op" id="6316493">!=</span>&nbsp;<span class="ident" id="6316496">dsStart</span>&nbsp;<span class="op" id="6316504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316509">return</span>&nbsp;<span class="ident" id="6316516">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316538">d</span><span class="op" id="6316539">.</span><span class="ident" id="6316540">stage</span>&nbsp;<span class="op" id="6316546">=</span>&nbsp;<span class="ident" id="6316548">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316561">return</span>&nbsp;<span class="ident" id="6316568">d</span><span class="op" id="6316569">.</span><span class="ident" id="6316570">parseIHDR</span><span class="op" id="6316579">(</span><span class="ident" id="6316580">length</span><span class="op" id="6316586">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316589">case</span>&nbsp;<span class="string" id="6316594">&#34;PLTE&#34;</span><span class="op" id="6316600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316604">if</span>&nbsp;<span class="ident" id="6316607">d</span><span class="op" id="6316608">.</span><span class="ident" id="6316609">stage</span>&nbsp;<span class="op" id="6316615">!=</span>&nbsp;<span class="ident" id="6316618">dsSeenIHDR</span>&nbsp;<span class="op" id="6316629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316634">return</span>&nbsp;<span class="ident" id="6316641">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316663">d</span><span class="op" id="6316664">.</span><span class="ident" id="6316665">stage</span>&nbsp;<span class="op" id="6316671">=</span>&nbsp;<span class="ident" id="6316673">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316686">return</span>&nbsp;<span class="ident" id="6316693">d</span><span class="op" id="6316694">.</span><span class="ident" id="6316695">parsePLTE</span><span class="op" id="6316704">(</span><span class="ident" id="6316705">length</span><span class="op" id="6316711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316714">case</span>&nbsp;<span class="string" id="6316719">&#34;tRNS&#34;</span><span class="op" id="6316725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316729">if</span>&nbsp;<span class="ident" id="6316732">d</span><span class="op" id="6316733">.</span><span class="ident" id="6316734">stage</span>&nbsp;<span class="op" id="6316740">!=</span>&nbsp;<span class="ident" id="6316743">dsSeenPLTE</span>&nbsp;<span class="op" id="6316754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316759">return</span>&nbsp;<span class="ident" id="6316766">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316784">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316788">return</span>&nbsp;<span class="ident" id="6316795">d</span><span class="op" id="6316796">.</span><span class="ident" id="6316797">parsetRNS</span><span class="op" id="6316806">(</span><span class="ident" id="6316807">length</span><span class="op" id="6316813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316816">case</span>&nbsp;<span class="string" id="6316821">&#34;IDAT&#34;</span><span class="op" id="6316827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316831">if</span>&nbsp;<span class="ident" id="6316834">d</span><span class="op" id="6316835">.</span><span class="ident" id="6316836">stage</span>&nbsp;<span class="op" id="6316842">&lt;</span>&nbsp;<span class="ident" id="6316844">dsSeenIHDR</span>&nbsp;<span class="op" id="6316855">||</span>&nbsp;<span class="ident" id="6316858">d</span><span class="op" id="6316859">.</span><span class="ident" id="6316860">stage</span>&nbsp;<span class="op" id="6316866">&gt;</span>&nbsp;<span class="ident" id="6316868">dsSeenIDAT</span>&nbsp;<span class="op" id="6316879">||</span>&nbsp;<span class="op" id="6316882">(</span><span class="ident" id="6316883">d</span><span class="op" id="6316884">.</span><span class="ident" id="6316885">cb</span>&nbsp;<span class="op" id="6316888">==</span>&nbsp;<span class="ident" id="6316891">cbP8</span>&nbsp;<span class="op" id="6316896">&amp;&amp;</span>&nbsp;<span class="ident" id="6316899">d</span><span class="op" id="6316900">.</span><span class="ident" id="6316901">stage</span>&nbsp;<span class="op" id="6316907">==</span>&nbsp;<span class="ident" id="6316910">dsSeenIHDR</span><span class="op" id="6316920">)</span>&nbsp;<span class="op" id="6316922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316927">return</span>&nbsp;<span class="ident" id="6316934">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316952">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316956">d</span><span class="op" id="6316957">.</span><span class="ident" id="6316958">stage</span>&nbsp;<span class="op" id="6316964">=</span>&nbsp;<span class="ident" id="6316966">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316979">return</span>&nbsp;<span class="ident" id="6316986">d</span><span class="op" id="6316987">.</span><span class="ident" id="6316988">parseIDAT</span><span class="op" id="6316997">(</span><span class="ident" id="6316998">length</span><span class="op" id="6317004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317007">case</span>&nbsp;<span class="string" id="6317012">&#34;IEND&#34;</span><span class="op" id="6317018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317022">if</span>&nbsp;<span class="ident" id="6317025">d</span><span class="op" id="6317026">.</span><span class="ident" id="6317027">stage</span>&nbsp;<span class="op" id="6317033">!=</span>&nbsp;<span class="ident" id="6317036">dsSeenIDAT</span>&nbsp;<span class="op" id="6317047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317052">return</span>&nbsp;<span class="ident" id="6317059">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317081">d</span><span class="op" id="6317082">.</span><span class="ident" id="6317083">stage</span>&nbsp;<span class="op" id="6317089">=</span>&nbsp;<span class="ident" id="6317091">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317104">return</span>&nbsp;<span class="ident" id="6317111">d</span><span class="op" id="6317112">.</span><span class="ident" id="6317113">parseIEND</span><span class="op" id="6317122">(</span><span class="ident" id="6317123">length</span><span class="op" id="6317129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6317135">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317178">var</span>&nbsp;<span class="ident" id="6317182">ignored</span>&nbsp;<span class="op" id="6317190">[</span><span class="num" id="6317191">4096</span><span class="op" id="6317195">]</span><span class="builtintype" id="6317196">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317202">for</span>&nbsp;<span class="ident" id="6317206">length</span>&nbsp;<span class="op" id="6317213">&gt;</span>&nbsp;<span class="num" id="6317215">0</span>&nbsp;<span class="op" id="6317217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317221">n</span><span class="op" id="6317222">,</span>&nbsp;<span class="ident" id="6317224">err</span>&nbsp;<span class="op" id="6317228">=</span>&nbsp;<span class="ident" id="6317230">io</span><span class="op" id="6317232">.</span><span class="ident" id="6317233">ReadFull</span><span class="op" id="6317241">(</span><span class="ident" id="6317242">d</span><span class="op" id="6317243">.</span><span class="ident" id="6317244">r</span><span class="op" id="6317245">,</span>&nbsp;<span class="ident" id="6317247">ignored</span><span class="op" id="6317254">[</span><span class="op" id="6317255">:</span><span class="ident" id="6317256">min</span><span class="op" id="6317259">(</span><span class="builtinfunc" id="6317260">len</span><span class="op" id="6317263">(</span><span class="ident" id="6317264">ignored</span><span class="op" id="6317271">)</span><span class="op" id="6317272">,</span>&nbsp;<span class="builtintype" id="6317274">int</span><span class="op" id="6317277">(</span><span class="ident" id="6317278">length</span><span class="op" id="6317284">)</span><span class="op" id="6317285">)</span><span class="op" id="6317286">]</span><span class="op" id="6317287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317291">if</span>&nbsp;<span class="ident" id="6317294">err</span>&nbsp;<span class="op" id="6317298">!=</span>&nbsp;<span class="ident" id="6317301">nil</span>&nbsp;<span class="op" id="6317305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317310">return</span>&nbsp;<span class="ident" id="6317317">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317327">d</span><span class="op" id="6317328">.</span><span class="ident" id="6317329">crc</span><span class="op" id="6317332">.</span><span class="ident" id="6317333">Write</span><span class="op" id="6317338">(</span><span class="ident" id="6317339">ignored</span><span class="op" id="6317346">[</span><span class="op" id="6317347">:</span><span class="ident" id="6317348">n</span><span class="op" id="6317349">]</span><span class="op" id="6317350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317354">length</span>&nbsp;<span class="op" id="6317361">-=</span>&nbsp;<span class="builtintype" id="6317364">uint32</span><span class="op" id="6317370">(</span><span class="ident" id="6317371">n</span><span class="op" id="6317372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317378">return</span>&nbsp;<span class="ident" id="6317385">d</span><span class="op" id="6317386">.</span><span class="ident" id="6317387">verifyChecksum</span><span class="op" id="6317401">(</span><span class="op" id="6317402">)</span><br>
<span class="lineno">715</span><span class="op" id="6317404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317407">func</span>&nbsp;<span class="op" id="6317412">(</span><span class="ident" id="6317413">d</span>&nbsp;<span class="op" id="6317415">*</span><span class="ident" id="6317416">decoder</span><span class="op" id="6317423">)</span>&nbsp;<span class="ident" id="6317425">verifyChecksum</span><span class="op" id="6317439">(</span><span class="op" id="6317440">)</span>&nbsp;<span class="builtintype" id="6317442">error</span>&nbsp;<span class="op" id="6317448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317451">if</span>&nbsp;<span class="ident" id="6317454">_</span><span class="op" id="6317455">,</span>&nbsp;<span class="ident" id="6317457">err</span>&nbsp;<span class="op" id="6317461">:=</span>&nbsp;<span class="ident" id="6317464">io</span><span class="op" id="6317466">.</span><span class="ident" id="6317467">ReadFull</span><span class="op" id="6317475">(</span><span class="ident" id="6317476">d</span><span class="op" id="6317477">.</span><span class="ident" id="6317478">r</span><span class="op" id="6317479">,</span>&nbsp;<span class="ident" id="6317481">d</span><span class="op" id="6317482">.</span><span class="ident" id="6317483">tmp</span><span class="op" id="6317486">[</span><span class="op" id="6317487">:</span><span class="num" id="6317488">4</span><span class="op" id="6317489">]</span><span class="op" id="6317490">)</span><span class="op" id="6317491">;</span>&nbsp;<span class="ident" id="6317493">err</span>&nbsp;<span class="op" id="6317497">!=</span>&nbsp;<span class="ident" id="6317500">nil</span>&nbsp;<span class="op" id="6317504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317508">return</span>&nbsp;<span class="ident" id="6317515">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317523">if</span>&nbsp;<span class="ident" id="6317526">binary</span><span class="op" id="6317532">.</span><span class="ident" id="6317533">BigEndian</span><span class="op" id="6317542">.</span><span class="ident" id="6317543">Uint32</span><span class="op" id="6317549">(</span><span class="ident" id="6317550">d</span><span class="op" id="6317551">.</span><span class="ident" id="6317552">tmp</span><span class="op" id="6317555">[</span><span class="op" id="6317556">:</span><span class="num" id="6317557">4</span><span class="op" id="6317558">]</span><span class="op" id="6317559">)</span>&nbsp;<span class="op" id="6317561">!=</span>&nbsp;<span class="ident" id="6317564">d</span><span class="op" id="6317565">.</span><span class="ident" id="6317566">crc</span><span class="op" id="6317569">.</span><span class="ident" id="6317570">Sum32</span><span class="op" id="6317575">(</span><span class="op" id="6317576">)</span>&nbsp;<span class="op" id="6317578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317582">return</span>&nbsp;<span class="ident" id="6317589">FormatError</span><span class="op" id="6317600">(</span><span class="string" id="6317601">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6317619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317625">return</span>&nbsp;<span class="ident" id="6317632">nil</span><br>
<span class="lineno">725</span><span class="op" id="6317636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317639">func</span>&nbsp;<span class="op" id="6317644">(</span><span class="ident" id="6317645">d</span>&nbsp;<span class="op" id="6317647">*</span><span class="ident" id="6317648">decoder</span><span class="op" id="6317655">)</span>&nbsp;<span class="ident" id="6317657">checkHeader</span><span class="op" id="6317668">(</span><span class="op" id="6317669">)</span>&nbsp;<span class="builtintype" id="6317671">error</span>&nbsp;<span class="op" id="6317677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317680">_</span><span class="op" id="6317681">,</span>&nbsp;<span class="ident" id="6317683">err</span>&nbsp;<span class="op" id="6317687">:=</span>&nbsp;<span class="ident" id="6317690">io</span><span class="op" id="6317692">.</span><span class="ident" id="6317693">ReadFull</span><span class="op" id="6317701">(</span><span class="ident" id="6317702">d</span><span class="op" id="6317703">.</span><span class="ident" id="6317704">r</span><span class="op" id="6317705">,</span>&nbsp;<span class="ident" id="6317707">d</span><span class="op" id="6317708">.</span><span class="ident" id="6317709">tmp</span><span class="op" id="6317712">[</span><span class="op" id="6317713">:</span><span class="builtinfunc" id="6317714">len</span><span class="op" id="6317717">(</span><span class="ident" id="6317718">pngHeader</span><span class="op" id="6317727">)</span><span class="op" id="6317728">]</span><span class="op" id="6317729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317732">if</span>&nbsp;<span class="ident" id="6317735">err</span>&nbsp;<span class="op" id="6317739">!=</span>&nbsp;<span class="ident" id="6317742">nil</span>&nbsp;<span class="op" id="6317746">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317750">return</span>&nbsp;<span class="ident" id="6317757">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317765">if</span>&nbsp;<span class="builtintype" id="6317768">string</span><span class="op" id="6317774">(</span><span class="ident" id="6317775">d</span><span class="op" id="6317776">.</span><span class="ident" id="6317777">tmp</span><span class="op" id="6317780">[</span><span class="op" id="6317781">:</span><span class="builtinfunc" id="6317782">len</span><span class="op" id="6317785">(</span><span class="ident" id="6317786">pngHeader</span><span class="op" id="6317795">)</span><span class="op" id="6317796">]</span><span class="op" id="6317797">)</span>&nbsp;<span class="op" id="6317799">!=</span>&nbsp;<span class="ident" id="6317802">pngHeader</span>&nbsp;<span class="op" id="6317812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317816">return</span>&nbsp;<span class="ident" id="6317823">FormatError</span><span class="op" id="6317834">(</span><span class="string" id="6317835">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="6317851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317854">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317857">return</span>&nbsp;<span class="ident" id="6317864">nil</span><br>
<span class="lineno"></span><span class="op" id="6317868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317871">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="6317940">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="6317999">func</span>&nbsp;<span class="ident" id="6318004">Decode</span><span class="op" id="6318010">(</span><span class="ident" id="6318011">r</span>&nbsp;<span class="ident" id="6318013">io</span><span class="op" id="6318015">.</span><span class="ident" id="6318016">Reader</span><span class="op" id="6318022">)</span>&nbsp;<span class="op" id="6318024">(</span><span class="ident" id="6318025">image</span><span class="op" id="6318030">.</span><span class="ident" id="6318031">Image</span><span class="op" id="6318036">,</span>&nbsp;<span class="builtintype" id="6318038">error</span><span class="op" id="6318043">)</span>&nbsp;<span class="op" id="6318045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318048">d</span>&nbsp;<span class="op" id="6318050">:=</span>&nbsp;<span class="op" id="6318053">&amp;</span><span class="ident" id="6318054">decoder</span><span class="op" id="6318061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318065">r</span><span class="op" id="6318066">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6318070">r</span><span class="op" id="6318071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318075">crc</span><span class="op" id="6318078">:</span>&nbsp;<span class="ident" id="6318080">crc32</span><span class="op" id="6318085">.</span><span class="ident" id="6318086">NewIEEE</span><span class="op" id="6318093">(</span><span class="op" id="6318094">)</span><span class="op" id="6318095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318098">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318101">if</span>&nbsp;<span class="ident" id="6318104">err</span>&nbsp;<span class="op" id="6318108">:=</span>&nbsp;<span class="ident" id="6318111">d</span><span class="op" id="6318112">.</span><span class="ident" id="6318113">checkHeader</span><span class="op" id="6318124">(</span><span class="op" id="6318125">)</span><span class="op" id="6318126">;</span>&nbsp;<span class="ident" id="6318128">err</span>&nbsp;<span class="op" id="6318132">!=</span>&nbsp;<span class="ident" id="6318135">nil</span>&nbsp;<span class="op" id="6318139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318143">if</span>&nbsp;<span class="ident" id="6318146">err</span>&nbsp;<span class="op" id="6318150">==</span>&nbsp;<span class="ident" id="6318153">io</span><span class="op" id="6318155">.</span><span class="ident" id="6318156">EOF</span>&nbsp;<span class="op" id="6318160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318165">err</span>&nbsp;<span class="op" id="6318169">=</span>&nbsp;<span class="ident" id="6318171">io</span><span class="op" id="6318173">.</span><span class="ident" id="6318174">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318197">return</span>&nbsp;<span class="ident" id="6318204">nil</span><span class="op" id="6318207">,</span>&nbsp;<span class="ident" id="6318209">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318217">for</span>&nbsp;<span class="ident" id="6318221">d</span><span class="op" id="6318222">.</span><span class="ident" id="6318223">stage</span>&nbsp;<span class="op" id="6318229">!=</span>&nbsp;<span class="ident" id="6318232">dsSeenIEND</span>&nbsp;<span class="op" id="6318243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318247">if</span>&nbsp;<span class="ident" id="6318250">err</span>&nbsp;<span class="op" id="6318254">:=</span>&nbsp;<span class="ident" id="6318257">d</span><span class="op" id="6318258">.</span><span class="ident" id="6318259">parseChunk</span><span class="op" id="6318269">(</span><span class="op" id="6318270">)</span><span class="op" id="6318271">;</span>&nbsp;<span class="ident" id="6318273">err</span>&nbsp;<span class="op" id="6318277">!=</span>&nbsp;<span class="ident" id="6318280">nil</span>&nbsp;<span class="op" id="6318284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318289">if</span>&nbsp;<span class="ident" id="6318292">err</span>&nbsp;<span class="op" id="6318296">==</span>&nbsp;<span class="ident" id="6318299">io</span><span class="op" id="6318301">.</span><span class="ident" id="6318302">EOF</span>&nbsp;<span class="op" id="6318306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318312">err</span>&nbsp;<span class="op" id="6318316">=</span>&nbsp;<span class="ident" id="6318318">io</span><span class="op" id="6318320">.</span><span class="ident" id="6318321">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318346">return</span>&nbsp;<span class="ident" id="6318353">nil</span><span class="op" id="6318356">,</span>&nbsp;<span class="ident" id="6318358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318370">return</span>&nbsp;<span class="ident" id="6318377">d</span><span class="op" id="6318378">.</span><span class="ident" id="6318379">img</span><span class="op" id="6318382">,</span>&nbsp;<span class="ident" id="6318384">nil</span><br>
<span class="lineno">760</span><span class="op" id="6318388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6318391">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="6318469">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6318499">func</span>&nbsp;<span class="ident" id="6318504">DecodeConfig</span><span class="op" id="6318516">(</span><span class="ident" id="6318517">r</span>&nbsp;<span class="ident" id="6318519">io</span><span class="op" id="6318521">.</span><span class="ident" id="6318522">Reader</span><span class="op" id="6318528">)</span>&nbsp;<span class="op" id="6318530">(</span><span class="ident" id="6318531">image</span><span class="op" id="6318536">.</span><span class="ident" id="6318537">Config</span><span class="op" id="6318543">,</span>&nbsp;<span class="builtintype" id="6318545">error</span><span class="op" id="6318550">)</span>&nbsp;<span class="op" id="6318552">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318555">d</span>&nbsp;<span class="op" id="6318557">:=</span>&nbsp;<span class="op" id="6318560">&amp;</span><span class="ident" id="6318561">decoder</span><span class="op" id="6318568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318572">r</span><span class="op" id="6318573">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6318577">r</span><span class="op" id="6318578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318582">crc</span><span class="op" id="6318585">:</span>&nbsp;<span class="ident" id="6318587">crc32</span><span class="op" id="6318592">.</span><span class="ident" id="6318593">NewIEEE</span><span class="op" id="6318600">(</span><span class="op" id="6318601">)</span><span class="op" id="6318602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318608">if</span>&nbsp;<span class="ident" id="6318611">err</span>&nbsp;<span class="op" id="6318615">:=</span>&nbsp;<span class="ident" id="6318618">d</span><span class="op" id="6318619">.</span><span class="ident" id="6318620">checkHeader</span><span class="op" id="6318631">(</span><span class="op" id="6318632">)</span><span class="op" id="6318633">;</span>&nbsp;<span class="ident" id="6318635">err</span>&nbsp;<span class="op" id="6318639">!=</span>&nbsp;<span class="ident" id="6318642">nil</span>&nbsp;<span class="op" id="6318646">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318650">if</span>&nbsp;<span class="ident" id="6318653">err</span>&nbsp;<span class="op" id="6318657">==</span>&nbsp;<span class="ident" id="6318660">io</span><span class="op" id="6318662">.</span><span class="ident" id="6318663">EOF</span>&nbsp;<span class="op" id="6318667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318672">err</span>&nbsp;<span class="op" id="6318676">=</span>&nbsp;<span class="ident" id="6318678">io</span><span class="op" id="6318680">.</span><span class="ident" id="6318681">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318704">return</span>&nbsp;<span class="ident" id="6318711">image</span><span class="op" id="6318716">.</span><span class="ident" id="6318717">Config</span><span class="op" id="6318723">{</span><span class="op" id="6318724">}</span><span class="op" id="6318725">,</span>&nbsp;<span class="ident" id="6318727">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318732">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318735">for</span>&nbsp;<span class="op" id="6318739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318743">if</span>&nbsp;<span class="ident" id="6318746">err</span>&nbsp;<span class="op" id="6318750">:=</span>&nbsp;<span class="ident" id="6318753">d</span><span class="op" id="6318754">.</span><span class="ident" id="6318755">parseChunk</span><span class="op" id="6318765">(</span><span class="op" id="6318766">)</span><span class="op" id="6318767">;</span>&nbsp;<span class="ident" id="6318769">err</span>&nbsp;<span class="op" id="6318773">!=</span>&nbsp;<span class="ident" id="6318776">nil</span>&nbsp;<span class="op" id="6318780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318785">if</span>&nbsp;<span class="ident" id="6318788">err</span>&nbsp;<span class="op" id="6318792">==</span>&nbsp;<span class="ident" id="6318795">io</span><span class="op" id="6318797">.</span><span class="ident" id="6318798">EOF</span>&nbsp;<span class="op" id="6318802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318808">err</span>&nbsp;<span class="op" id="6318812">=</span>&nbsp;<span class="ident" id="6318814">io</span><span class="op" id="6318816">.</span><span class="ident" id="6318817">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318837">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318842">return</span>&nbsp;<span class="ident" id="6318849">image</span><span class="op" id="6318854">.</span><span class="ident" id="6318855">Config</span><span class="op" id="6318861">{</span><span class="op" id="6318862">}</span><span class="op" id="6318863">,</span>&nbsp;<span class="ident" id="6318865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318875">paletted</span>&nbsp;<span class="op" id="6318884">:=</span>&nbsp;<span class="ident" id="6318887">d</span><span class="op" id="6318888">.</span><span class="ident" id="6318889">cb</span>&nbsp;<span class="op" id="6318892">==</span>&nbsp;<span class="ident" id="6318895">cbP8</span>&nbsp;<span class="op" id="6318900">||</span>&nbsp;<span class="ident" id="6318903">d</span><span class="op" id="6318904">.</span><span class="ident" id="6318905">cb</span>&nbsp;<span class="op" id="6318908">==</span>&nbsp;<span class="ident" id="6318911">cbP4</span>&nbsp;<span class="op" id="6318916">||</span>&nbsp;<span class="ident" id="6318919">d</span><span class="op" id="6318920">.</span><span class="ident" id="6318921">cb</span>&nbsp;<span class="op" id="6318924">==</span>&nbsp;<span class="ident" id="6318927">cbP2</span>&nbsp;<span class="op" id="6318932">||</span>&nbsp;<span class="ident" id="6318935">d</span><span class="op" id="6318936">.</span><span class="ident" id="6318937">cb</span>&nbsp;<span class="op" id="6318940">==</span>&nbsp;<span class="ident" id="6318943">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318950">if</span>&nbsp;<span class="ident" id="6318953">d</span><span class="op" id="6318954">.</span><span class="ident" id="6318955">stage</span>&nbsp;<span class="op" id="6318961">==</span>&nbsp;<span class="ident" id="6318964">dsSeenIHDR</span>&nbsp;<span class="op" id="6318975">&amp;&amp;</span>&nbsp;<span class="op" id="6318978">!</span><span class="ident" id="6318979">paletted</span>&nbsp;<span class="op" id="6318988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318993">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319005">if</span>&nbsp;<span class="ident" id="6319008">d</span><span class="op" id="6319009">.</span><span class="ident" id="6319010">stage</span>&nbsp;<span class="op" id="6319016">==</span>&nbsp;<span class="ident" id="6319019">dsSeenPLTE</span>&nbsp;<span class="op" id="6319030">&amp;&amp;</span>&nbsp;<span class="ident" id="6319033">paletted</span>&nbsp;<span class="op" id="6319042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319047">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319058">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319061">var</span>&nbsp;<span class="ident" id="6319065">cm</span>&nbsp;<span class="ident" id="6319068">color</span><span class="op" id="6319073">.</span><span class="ident" id="6319074">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319081">switch</span>&nbsp;<span class="ident" id="6319088">d</span><span class="op" id="6319089">.</span><span class="ident" id="6319090">cb</span>&nbsp;<span class="op" id="6319093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319096">case</span>&nbsp;<span class="ident" id="6319101">cbG1</span><span class="op" id="6319105">,</span>&nbsp;<span class="ident" id="6319107">cbG2</span><span class="op" id="6319111">,</span>&nbsp;<span class="ident" id="6319113">cbG4</span><span class="op" id="6319117">,</span>&nbsp;<span class="ident" id="6319119">cbG8</span><span class="op" id="6319123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319127">cm</span>&nbsp;<span class="op" id="6319130">=</span>&nbsp;<span class="ident" id="6319132">color</span><span class="op" id="6319137">.</span><span class="ident" id="6319138">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319149">case</span>&nbsp;<span class="ident" id="6319154">cbGA8</span><span class="op" id="6319159">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319163">cm</span>&nbsp;<span class="op" id="6319166">=</span>&nbsp;<span class="ident" id="6319168">color</span><span class="op" id="6319173">.</span><span class="ident" id="6319174">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319186">case</span>&nbsp;<span class="ident" id="6319191">cbTC8</span><span class="op" id="6319196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319200">cm</span>&nbsp;<span class="op" id="6319203">=</span>&nbsp;<span class="ident" id="6319205">color</span><span class="op" id="6319210">.</span><span class="ident" id="6319211">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319222">case</span>&nbsp;<span class="ident" id="6319227">cbP1</span><span class="op" id="6319231">,</span>&nbsp;<span class="ident" id="6319233">cbP2</span><span class="op" id="6319237">,</span>&nbsp;<span class="ident" id="6319239">cbP4</span><span class="op" id="6319243">,</span>&nbsp;<span class="ident" id="6319245">cbP8</span><span class="op" id="6319249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319253">cm</span>&nbsp;<span class="op" id="6319256">=</span>&nbsp;<span class="ident" id="6319258">d</span><span class="op" id="6319259">.</span><span class="ident" id="6319260">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319269">case</span>&nbsp;<span class="ident" id="6319274">cbTCA8</span><span class="op" id="6319280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319284">cm</span>&nbsp;<span class="op" id="6319287">=</span>&nbsp;<span class="ident" id="6319289">color</span><span class="op" id="6319294">.</span><span class="ident" id="6319295">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319307">case</span>&nbsp;<span class="ident" id="6319312">cbG16</span><span class="op" id="6319317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319321">cm</span>&nbsp;<span class="op" id="6319324">=</span>&nbsp;<span class="ident" id="6319326">color</span><span class="op" id="6319331">.</span><span class="ident" id="6319332">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319345">case</span>&nbsp;<span class="ident" id="6319350">cbGA16</span><span class="op" id="6319356">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319360">cm</span>&nbsp;<span class="op" id="6319363">=</span>&nbsp;<span class="ident" id="6319365">color</span><span class="op" id="6319370">.</span><span class="ident" id="6319371">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319385">case</span>&nbsp;<span class="ident" id="6319390">cbTC16</span><span class="op" id="6319396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319400">cm</span>&nbsp;<span class="op" id="6319403">=</span>&nbsp;<span class="ident" id="6319405">color</span><span class="op" id="6319410">.</span><span class="ident" id="6319411">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319424">case</span>&nbsp;<span class="ident" id="6319429">cbTCA16</span><span class="op" id="6319436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319440">cm</span>&nbsp;<span class="op" id="6319443">=</span>&nbsp;<span class="ident" id="6319445">color</span><span class="op" id="6319450">.</span><span class="ident" id="6319451">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319468">return</span>&nbsp;<span class="ident" id="6319475">image</span><span class="op" id="6319480">.</span><span class="ident" id="6319481">Config</span><span class="op" id="6319487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319491">ColorModel</span><span class="op" id="6319501">:</span>&nbsp;<span class="ident" id="6319503">cm</span><span class="op" id="6319505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319509">Width</span><span class="op" id="6319514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319521">d</span><span class="op" id="6319522">.</span><span class="ident" id="6319523">width</span><span class="op" id="6319528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319532">Height</span><span class="op" id="6319538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319544">d</span><span class="op" id="6319545">.</span><span class="ident" id="6319546">height</span><span class="op" id="6319552">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319555">}</span><span class="op" id="6319556">,</span>&nbsp;<span class="ident" id="6319558">nil</span><br>
<span class="lineno"></span><span class="op" id="6319562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6319565">func</span>&nbsp;<span class="ident" id="6319570">init</span><span class="op" id="6319574">(</span><span class="op" id="6319575">)</span>&nbsp;<span class="op" id="6319577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319580">image</span><span class="op" id="6319585">.</span><span class="ident" id="6319586">RegisterFormat</span><span class="op" id="6319600">(</span><span class="string" id="6319601">&#34;png&#34;</span><span class="op" id="6319606">,</span>&nbsp;<span class="ident" id="6319608">pngHeader</span><span class="op" id="6319617">,</span>&nbsp;<span class="ident" id="6319619">Decode</span><span class="op" id="6319625">,</span>&nbsp;<span class="ident" id="6319627">DecodeConfig</span><span class="op" id="6319639">)</span><br>
<span class="lineno">820</span><span class="op" id="6319641">}</span>
</div>
</body>
</html>
