<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6375973">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6376028">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6376082">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6376133">package</span>&nbsp;<span class="ident" id="6376141">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6376146">import</span>&nbsp;<span class="op" id="6376153">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376156">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376165">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376174">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376186">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376193">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376199">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376210">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376221">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6376231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6376234">const</span>&nbsp;<span class="op" id="6376240">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376243">//&nbsp;A&nbsp;generic&nbsp;XML&nbsp;header&nbsp;suitable&nbsp;for&nbsp;use&nbsp;with&nbsp;the&nbsp;output&nbsp;of&nbsp;Marshal.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376313">//&nbsp;This&nbsp;is&nbsp;not&nbsp;automatically&nbsp;added&nbsp;to&nbsp;any&nbsp;output&nbsp;of&nbsp;this&nbsp;package,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376380">//&nbsp;it&nbsp;is&nbsp;provided&nbsp;as&nbsp;a&nbsp;convenience.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376417">Header</span>&nbsp;<span class="op" id="6376424">=</span>&nbsp;<span class="string" id="6376426">`&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;UTF-8&#34;?&gt;`</span>&nbsp;<span class="op" id="6376467">+</span>&nbsp;<span class="string" id="6376469">&#34;\n&#34;</span><br>
<span class="lineno"></span><span class="op" id="6376474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6376477">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="6376519">//</span><br>
<span class="lineno"></span><span class="comment" id="6376522">//&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;array&nbsp;or&nbsp;slice&nbsp;by&nbsp;marshalling&nbsp;each&nbsp;of&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="6376596">//&nbsp;Marshal&nbsp;handles&nbsp;a&nbsp;pointer&nbsp;by&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;points&nbsp;at&nbsp;or,&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6376674">//&nbsp;pointer&nbsp;is&nbsp;nil,&nbsp;by&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;interface&nbsp;value&nbsp;by</span><br>
<span class="lineno">30</span><span class="comment" id="6376752">//&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;contains&nbsp;or,&nbsp;if&nbsp;the&nbsp;interface&nbsp;value&nbsp;is&nbsp;nil,&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6376827">//&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;all&nbsp;other&nbsp;data&nbsp;by&nbsp;writing&nbsp;one&nbsp;or&nbsp;more&nbsp;XML</span><br>
<span class="lineno"></span><span class="comment" id="6376906">//&nbsp;elements&nbsp;containing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6376939">//</span><br>
<span class="lineno"></span><span class="comment" id="6376942">//&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;XML&nbsp;elements&nbsp;is&nbsp;taken&nbsp;from,&nbsp;in&nbsp;order&nbsp;of&nbsp;preference:</span><br>
<span class="lineno">35</span><span class="comment" id="6377014">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;on&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="6377077">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;XMLName&nbsp;field&nbsp;of&nbsp;type&nbsp;xml.Name</span><br>
<span class="lineno"></span><span class="comment" id="6377134">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6377195">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6377257">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;marshalled&nbsp;type</span><br>
<span class="lineno">40</span><span class="comment" id="6377298">//</span><br>
<span class="lineno"></span><span class="comment" id="6377301">//&nbsp;The&nbsp;XML&nbsp;element&nbsp;for&nbsp;a&nbsp;struct&nbsp;contains&nbsp;marshalled&nbsp;elements&nbsp;for&nbsp;each&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6377378">//&nbsp;exported&nbsp;fields&nbsp;of&nbsp;the&nbsp;struct,&nbsp;with&nbsp;these&nbsp;exceptions:</span><br>
<span class="lineno"></span><span class="comment" id="6377435">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;described&nbsp;above,&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="6377492">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;-&#34;&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">45</span><span class="comment" id="6377534">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;name,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6377598">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6377642">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6377706">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6377746">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,chardata&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;character&nbsp;data,</span><br>
<span class="lineno">50</span><span class="comment" id="6377814">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;as&nbsp;an&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6377846">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,innerxml&#34;&nbsp;is&nbsp;written&nbsp;verbatim,&nbsp;not&nbsp;subject</span><br>
<span class="lineno"></span><span class="comment" id="6377917">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.</span><br>
<span class="lineno"></span><span class="comment" id="6377962">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,comment&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;an&nbsp;XML&nbsp;comment,&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6378033">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.&nbsp;It&nbsp;must&nbsp;not&nbsp;contain</span><br>
<span class="lineno">55</span><span class="comment" id="6378106">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;&#34;--&#34;&nbsp;string&nbsp;within&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="6378142">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;including&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option&nbsp;is&nbsp;omitted</span><br>
<span class="lineno"></span><span class="comment" id="6378214">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;field&nbsp;value&nbsp;is&nbsp;empty.&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6378287">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6378358">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;of&nbsp;length&nbsp;zero.</span><br>
<span class="lineno">60</span><span class="comment" id="6378390">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;is&nbsp;handled&nbsp;as&nbsp;if&nbsp;the&nbsp;fields&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6378460">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;were&nbsp;part&nbsp;of&nbsp;the&nbsp;outer&nbsp;struct.</span><br>
<span class="lineno"></span><span class="comment" id="6378506">//</span><br>
<span class="lineno"></span><span class="comment" id="6378509">//&nbsp;If&nbsp;a&nbsp;field&nbsp;uses&nbsp;a&nbsp;tag&nbsp;&#34;a&gt;b&gt;c&#34;,&nbsp;then&nbsp;the&nbsp;element&nbsp;c&nbsp;will&nbsp;be&nbsp;nested&nbsp;inside</span><br>
<span class="lineno"></span><span class="comment" id="6378584">//&nbsp;parent&nbsp;elements&nbsp;a&nbsp;and&nbsp;b.&nbsp;&nbsp;Fields&nbsp;that&nbsp;appear&nbsp;next&nbsp;to&nbsp;each&nbsp;other&nbsp;that&nbsp;name</span><br>
<span class="lineno">65</span><span class="comment" id="6378661">//&nbsp;the&nbsp;same&nbsp;parent&nbsp;will&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;one&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6378717">//</span><br>
<span class="lineno"></span><span class="comment" id="6378720">//&nbsp;See&nbsp;MarshalIndent&nbsp;for&nbsp;an&nbsp;example.</span><br>
<span class="lineno"></span><span class="comment" id="6378757">//</span><br>
<span class="lineno"></span><span class="comment" id="6378760">//&nbsp;Marshal&nbsp;will&nbsp;return&nbsp;an&nbsp;error&nbsp;if&nbsp;asked&nbsp;to&nbsp;marshal&nbsp;a&nbsp;channel,&nbsp;function,&nbsp;or&nbsp;map.</span><br>
<span class="lineno">70</span><span class="keyword" id="6378841">func</span>&nbsp;<span class="ident" id="6378846">Marshal</span><span class="op" id="6378853">(</span><span class="ident" id="6378854">v</span>&nbsp;<span class="keyword" id="6378856">interface</span><span class="op" id="6378865">{</span><span class="op" id="6378866">}</span><span class="op" id="6378867">)</span>&nbsp;<span class="op" id="6378869">(</span><span class="op" id="6378870">[</span><span class="op" id="6378871">]</span><span class="builtintype" id="6378872">byte</span><span class="op" id="6378876">,</span>&nbsp;<span class="builtintype" id="6378878">error</span><span class="op" id="6378883">)</span>&nbsp;<span class="op" id="6378885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378888">var</span>&nbsp;<span class="ident" id="6378892">b</span>&nbsp;<span class="ident" id="6378894">bytes</span><span class="op" id="6378899">.</span><span class="ident" id="6378900">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378908">if</span>&nbsp;<span class="ident" id="6378911">err</span>&nbsp;<span class="op" id="6378915">:=</span>&nbsp;<span class="ident" id="6378918">NewEncoder</span><span class="op" id="6378928">(</span><span class="op" id="6378929">&amp;</span><span class="ident" id="6378930">b</span><span class="op" id="6378931">)</span><span class="op" id="6378932">.</span><span class="ident" id="6378933">Encode</span><span class="op" id="6378939">(</span><span class="ident" id="6378940">v</span><span class="op" id="6378941">)</span><span class="op" id="6378942">;</span>&nbsp;<span class="ident" id="6378944">err</span>&nbsp;<span class="op" id="6378948">!=</span>&nbsp;<span class="ident" id="6378951">nil</span>&nbsp;<span class="op" id="6378955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378959">return</span>&nbsp;<span class="ident" id="6378966">nil</span><span class="op" id="6378969">,</span>&nbsp;<span class="ident" id="6378971">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378976">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378979">return</span>&nbsp;<span class="ident" id="6378986">b</span><span class="op" id="6378987">.</span><span class="ident" id="6378988">Bytes</span><span class="op" id="6378993">(</span><span class="op" id="6378994">)</span><span class="op" id="6378995">,</span>&nbsp;<span class="ident" id="6378997">nil</span><br>
<span class="lineno"></span><span class="op" id="6379001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6379004">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="6379074">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno">80</span><span class="comment" id="6379113">//</span><br>
<span class="lineno"></span><span class="comment" id="6379116">//&nbsp;MarshalXML&nbsp;encodes&nbsp;the&nbsp;receiver&nbsp;as&nbsp;zero&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="6379181">//&nbsp;By&nbsp;convention,&nbsp;arrays&nbsp;or&nbsp;slices&nbsp;are&nbsp;typically&nbsp;encoded&nbsp;as&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="6379252">//&nbsp;of&nbsp;elements,&nbsp;one&nbsp;per&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="6379283">//&nbsp;Using&nbsp;start&nbsp;as&nbsp;the&nbsp;element&nbsp;tag&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno">85</span><span class="comment" id="6379347">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;XML&nbsp;elements&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="6379413">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno"></span><span class="comment" id="6379430">//&nbsp;One&nbsp;common&nbsp;implementation&nbsp;strategy&nbsp;is&nbsp;to&nbsp;construct&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span><span class="comment" id="6379495">//&nbsp;value&nbsp;with&nbsp;a&nbsp;layout&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;desired&nbsp;XML&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="6379560">//&nbsp;to&nbsp;encode&nbsp;it&nbsp;using&nbsp;e.EncodeElement.</span><br>
<span class="lineno">90</span><span class="comment" id="6379599">//&nbsp;Another&nbsp;common&nbsp;strategy&nbsp;is&nbsp;to&nbsp;use&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;e.EncodeToken</span><br>
<span class="lineno"></span><span class="comment" id="6379668">//&nbsp;to&nbsp;generate&nbsp;the&nbsp;XML&nbsp;output&nbsp;one&nbsp;token&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6379719">//&nbsp;The&nbsp;sequence&nbsp;of&nbsp;encoded&nbsp;tokens&nbsp;must&nbsp;make&nbsp;up&nbsp;zero&nbsp;or&nbsp;more&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="6379785">//&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="6379802">type</span>&nbsp;<span class="ident" id="6379807">Marshaler</span>&nbsp;<span class="keyword" id="6379817">interface</span>&nbsp;<span class="op" id="6379827">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379830">MarshalXML</span><span class="op" id="6379840">(</span><span class="ident" id="6379841">e</span>&nbsp;<span class="op" id="6379843">*</span><span class="ident" id="6379844">Encoder</span><span class="op" id="6379851">,</span>&nbsp;<span class="ident" id="6379853">start</span>&nbsp;<span class="ident" id="6379859">StartElement</span><span class="op" id="6379871">)</span>&nbsp;<span class="builtintype" id="6379873">error</span><br>
<span class="lineno"></span><span class="op" id="6379879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6379882">//&nbsp;MarshalerAttr&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="6379956">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;attributes.</span><br>
<span class="lineno">100</span><span class="comment" id="6379997">//</span><br>
<span class="lineno"></span><span class="comment" id="6380000">//&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;an&nbsp;XML&nbsp;attribute&nbsp;with&nbsp;the&nbsp;encoded&nbsp;value&nbsp;of&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="comment" id="6380083">//&nbsp;Using&nbsp;name&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="6380149">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;attribute&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="6380212">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno">105</span><span class="comment" id="6380229">//&nbsp;If&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;the&nbsp;zero&nbsp;attribute&nbsp;Attr{},&nbsp;no&nbsp;attribute</span><br>
<span class="lineno"></span><span class="comment" id="6380298">//&nbsp;will&nbsp;be&nbsp;generated&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="6380334">//&nbsp;MarshalXMLAttr&nbsp;is&nbsp;used&nbsp;only&nbsp;for&nbsp;struct&nbsp;fields&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6380392">//&nbsp;&#34;attr&#34;&nbsp;option&nbsp;in&nbsp;the&nbsp;field&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="6380427">type</span>&nbsp;<span class="ident" id="6380432">MarshalerAttr</span>&nbsp;<span class="keyword" id="6380446">interface</span>&nbsp;<span class="op" id="6380456">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380459">MarshalXMLAttr</span><span class="op" id="6380473">(</span><span class="ident" id="6380474">name</span>&nbsp;<span class="ident" id="6380479">Name</span><span class="op" id="6380483">)</span>&nbsp;<span class="op" id="6380485">(</span><span class="ident" id="6380486">Attr</span><span class="op" id="6380490">,</span>&nbsp;<span class="builtintype" id="6380492">error</span><span class="op" id="6380497">)</span><br>
<span class="lineno"></span><span class="op" id="6380499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6380502">//&nbsp;MarshalIndent&nbsp;works&nbsp;like&nbsp;Marshal,&nbsp;but&nbsp;each&nbsp;XML&nbsp;element&nbsp;begins&nbsp;on&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="6380576">//&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno">115</span><span class="comment" id="6380648">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6380700">func</span>&nbsp;<span class="ident" id="6380705">MarshalIndent</span><span class="op" id="6380718">(</span><span class="ident" id="6380719">v</span>&nbsp;<span class="keyword" id="6380721">interface</span><span class="op" id="6380730">{</span><span class="op" id="6380731">}</span><span class="op" id="6380732">,</span>&nbsp;<span class="ident" id="6380734">prefix</span><span class="op" id="6380740">,</span>&nbsp;<span class="ident" id="6380742">indent</span>&nbsp;<span class="builtintype" id="6380749">string</span><span class="op" id="6380755">)</span>&nbsp;<span class="op" id="6380757">(</span><span class="op" id="6380758">[</span><span class="op" id="6380759">]</span><span class="builtintype" id="6380760">byte</span><span class="op" id="6380764">,</span>&nbsp;<span class="builtintype" id="6380766">error</span><span class="op" id="6380771">)</span>&nbsp;<span class="op" id="6380773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380776">var</span>&nbsp;<span class="ident" id="6380780">b</span>&nbsp;<span class="ident" id="6380782">bytes</span><span class="op" id="6380787">.</span><span class="ident" id="6380788">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380796">enc</span>&nbsp;<span class="op" id="6380800">:=</span>&nbsp;<span class="ident" id="6380803">NewEncoder</span><span class="op" id="6380813">(</span><span class="op" id="6380814">&amp;</span><span class="ident" id="6380815">b</span><span class="op" id="6380816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380819">enc</span><span class="op" id="6380822">.</span><span class="ident" id="6380823">Indent</span><span class="op" id="6380829">(</span><span class="ident" id="6380830">prefix</span><span class="op" id="6380836">,</span>&nbsp;<span class="ident" id="6380838">indent</span><span class="op" id="6380844">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380847">if</span>&nbsp;<span class="ident" id="6380850">err</span>&nbsp;<span class="op" id="6380854">:=</span>&nbsp;<span class="ident" id="6380857">enc</span><span class="op" id="6380860">.</span><span class="ident" id="6380861">Encode</span><span class="op" id="6380867">(</span><span class="ident" id="6380868">v</span><span class="op" id="6380869">)</span><span class="op" id="6380870">;</span>&nbsp;<span class="ident" id="6380872">err</span>&nbsp;<span class="op" id="6380876">!=</span>&nbsp;<span class="ident" id="6380879">nil</span>&nbsp;<span class="op" id="6380883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380887">return</span>&nbsp;<span class="ident" id="6380894">nil</span><span class="op" id="6380897">,</span>&nbsp;<span class="ident" id="6380899">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380907">return</span>&nbsp;<span class="ident" id="6380914">b</span><span class="op" id="6380915">.</span><span class="ident" id="6380916">Bytes</span><span class="op" id="6380921">(</span><span class="op" id="6380922">)</span><span class="op" id="6380923">,</span>&nbsp;<span class="ident" id="6380925">nil</span><br>
<span class="lineno"></span><span class="op" id="6380929">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="6380932">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;XML&nbsp;data&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6380983">type</span>&nbsp;<span class="ident" id="6380988">Encoder</span>&nbsp;<span class="keyword" id="6380996">struct</span>&nbsp;<span class="op" id="6381003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381006">p</span>&nbsp;<span class="ident" id="6381008">printer</span><br>
<span class="lineno"></span><span class="op" id="6381016">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="6381019">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6381073">func</span>&nbsp;<span class="ident" id="6381078">NewEncoder</span><span class="op" id="6381088">(</span><span class="ident" id="6381089">w</span>&nbsp;<span class="ident" id="6381091">io</span><span class="op" id="6381093">.</span><span class="ident" id="6381094">Writer</span><span class="op" id="6381100">)</span>&nbsp;<span class="op" id="6381102">*</span><span class="ident" id="6381103">Encoder</span>&nbsp;<span class="op" id="6381111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381114">e</span>&nbsp;<span class="op" id="6381116">:=</span>&nbsp;<span class="op" id="6381119">&amp;</span><span class="ident" id="6381120">Encoder</span><span class="op" id="6381127">{</span><span class="ident" id="6381128">printer</span><span class="op" id="6381135">{</span><span class="ident" id="6381136">Writer</span><span class="op" id="6381142">:</span>&nbsp;<span class="ident" id="6381144">bufio</span><span class="op" id="6381149">.</span><span class="ident" id="6381150">NewWriter</span><span class="op" id="6381159">(</span><span class="ident" id="6381160">w</span><span class="op" id="6381161">)</span><span class="op" id="6381162">}</span><span class="op" id="6381163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381166">e</span><span class="op" id="6381167">.</span><span class="ident" id="6381168">p</span><span class="op" id="6381169">.</span><span class="ident" id="6381170">encoder</span>&nbsp;<span class="op" id="6381178">=</span>&nbsp;<span class="ident" id="6381180">e</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381183">return</span>&nbsp;<span class="ident" id="6381190">e</span><br>
<span class="lineno"></span><span class="op" id="6381192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6381195">//&nbsp;Indent&nbsp;sets&nbsp;the&nbsp;encoder&nbsp;to&nbsp;generate&nbsp;XML&nbsp;in&nbsp;which&nbsp;each&nbsp;element</span><br>
<span class="lineno"></span><span class="comment" id="6381260">//&nbsp;begins&nbsp;on&nbsp;a&nbsp;new&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by</span><br>
<span class="lineno">140</span><span class="comment" id="6381336">//&nbsp;one&nbsp;or&nbsp;more&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6381400">func</span>&nbsp;<span class="op" id="6381405">(</span><span class="ident" id="6381406">enc</span>&nbsp;<span class="op" id="6381410">*</span><span class="ident" id="6381411">Encoder</span><span class="op" id="6381418">)</span>&nbsp;<span class="ident" id="6381420">Indent</span><span class="op" id="6381426">(</span><span class="ident" id="6381427">prefix</span><span class="op" id="6381433">,</span>&nbsp;<span class="ident" id="6381435">indent</span>&nbsp;<span class="builtintype" id="6381442">string</span><span class="op" id="6381448">)</span>&nbsp;<span class="op" id="6381450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381453">enc</span><span class="op" id="6381456">.</span><span class="ident" id="6381457">p</span><span class="op" id="6381458">.</span><span class="ident" id="6381459">prefix</span>&nbsp;<span class="op" id="6381466">=</span>&nbsp;<span class="ident" id="6381468">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381476">enc</span><span class="op" id="6381479">.</span><span class="ident" id="6381480">p</span><span class="op" id="6381481">.</span><span class="ident" id="6381482">indent</span>&nbsp;<span class="op" id="6381489">=</span>&nbsp;<span class="ident" id="6381491">indent</span><br>
<span class="lineno"></span><span class="op" id="6381498">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="6381501">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="6381555">//</span><br>
<span class="lineno"></span><span class="comment" id="6381558">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="6381628">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">150</span><span class="comment" id="6381652">//</span><br>
<span class="lineno"></span><span class="comment" id="6381655">//&nbsp;Encode&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="6381695">func</span>&nbsp;<span class="op" id="6381700">(</span><span class="ident" id="6381701">enc</span>&nbsp;<span class="op" id="6381705">*</span><span class="ident" id="6381706">Encoder</span><span class="op" id="6381713">)</span>&nbsp;<span class="ident" id="6381715">Encode</span><span class="op" id="6381721">(</span><span class="ident" id="6381722">v</span>&nbsp;<span class="keyword" id="6381724">interface</span><span class="op" id="6381733">{</span><span class="op" id="6381734">}</span><span class="op" id="6381735">)</span>&nbsp;<span class="builtintype" id="6381737">error</span>&nbsp;<span class="op" id="6381743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381746">err</span>&nbsp;<span class="op" id="6381750">:=</span>&nbsp;<span class="ident" id="6381753">enc</span><span class="op" id="6381756">.</span><span class="ident" id="6381757">p</span><span class="op" id="6381758">.</span><span class="ident" id="6381759">marshalValue</span><span class="op" id="6381771">(</span><span class="ident" id="6381772">reflect</span><span class="op" id="6381779">.</span><span class="ident" id="6381780">ValueOf</span><span class="op" id="6381787">(</span><span class="ident" id="6381788">v</span><span class="op" id="6381789">)</span><span class="op" id="6381790">,</span>&nbsp;<span class="ident" id="6381792">nil</span><span class="op" id="6381795">,</span>&nbsp;<span class="ident" id="6381797">nil</span><span class="op" id="6381800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381803">if</span>&nbsp;<span class="ident" id="6381806">err</span>&nbsp;<span class="op" id="6381810">!=</span>&nbsp;<span class="ident" id="6381813">nil</span>&nbsp;<span class="op" id="6381817">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381821">return</span>&nbsp;<span class="ident" id="6381828">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381836">return</span>&nbsp;<span class="ident" id="6381843">enc</span><span class="op" id="6381846">.</span><span class="ident" id="6381847">p</span><span class="op" id="6381848">.</span><span class="ident" id="6381849">Flush</span><span class="op" id="6381854">(</span><span class="op" id="6381855">)</span><br>
<span class="lineno"></span><span class="op" id="6381857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6381860">//&nbsp;EncodeElement&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="6381921">//&nbsp;using&nbsp;start&nbsp;as&nbsp;the&nbsp;outermost&nbsp;tag&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="6381974">//</span><br>
<span class="lineno"></span><span class="comment" id="6381977">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="6382047">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">165</span><span class="comment" id="6382071">//</span><br>
<span class="lineno"></span><span class="comment" id="6382074">//&nbsp;EncodeElement&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="6382121">func</span>&nbsp;<span class="op" id="6382126">(</span><span class="ident" id="6382127">enc</span>&nbsp;<span class="op" id="6382131">*</span><span class="ident" id="6382132">Encoder</span><span class="op" id="6382139">)</span>&nbsp;<span class="ident" id="6382141">EncodeElement</span><span class="op" id="6382154">(</span><span class="ident" id="6382155">v</span>&nbsp;<span class="keyword" id="6382157">interface</span><span class="op" id="6382166">{</span><span class="op" id="6382167">}</span><span class="op" id="6382168">,</span>&nbsp;<span class="ident" id="6382170">start</span>&nbsp;<span class="ident" id="6382176">StartElement</span><span class="op" id="6382188">)</span>&nbsp;<span class="builtintype" id="6382190">error</span>&nbsp;<span class="op" id="6382196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382199">err</span>&nbsp;<span class="op" id="6382203">:=</span>&nbsp;<span class="ident" id="6382206">enc</span><span class="op" id="6382209">.</span><span class="ident" id="6382210">p</span><span class="op" id="6382211">.</span><span class="ident" id="6382212">marshalValue</span><span class="op" id="6382224">(</span><span class="ident" id="6382225">reflect</span><span class="op" id="6382232">.</span><span class="ident" id="6382233">ValueOf</span><span class="op" id="6382240">(</span><span class="ident" id="6382241">v</span><span class="op" id="6382242">)</span><span class="op" id="6382243">,</span>&nbsp;<span class="ident" id="6382245">nil</span><span class="op" id="6382248">,</span>&nbsp;<span class="op" id="6382250">&amp;</span><span class="ident" id="6382251">start</span><span class="op" id="6382256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382259">if</span>&nbsp;<span class="ident" id="6382262">err</span>&nbsp;<span class="op" id="6382266">!=</span>&nbsp;<span class="ident" id="6382269">nil</span>&nbsp;<span class="op" id="6382273">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382277">return</span>&nbsp;<span class="ident" id="6382284">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382292">return</span>&nbsp;<span class="ident" id="6382299">enc</span><span class="op" id="6382302">.</span><span class="ident" id="6382303">p</span><span class="op" id="6382304">.</span><span class="ident" id="6382305">Flush</span><span class="op" id="6382310">(</span><span class="op" id="6382311">)</span><br>
<span class="lineno"></span><span class="op" id="6382313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6382316">var</span>&nbsp;<span class="op" id="6382320">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382323">endComment</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6382336">=</span>&nbsp;<span class="op" id="6382338">[</span><span class="op" id="6382339">]</span><span class="builtintype" id="6382340">byte</span><span class="op" id="6382344">(</span><span class="string" id="6382345">&#34;--&gt;&#34;</span><span class="op" id="6382350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382353">endProcInst</span>&nbsp;&nbsp;<span class="op" id="6382366">=</span>&nbsp;<span class="op" id="6382368">[</span><span class="op" id="6382369">]</span><span class="builtintype" id="6382370">byte</span><span class="op" id="6382374">(</span><span class="string" id="6382375">&#34;?&gt;&#34;</span><span class="op" id="6382379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382382">endDirective</span>&nbsp;<span class="op" id="6382395">=</span>&nbsp;<span class="op" id="6382397">[</span><span class="op" id="6382398">]</span><span class="builtintype" id="6382399">byte</span><span class="op" id="6382403">(</span><span class="string" id="6382404">&#34;&gt;&#34;</span><span class="op" id="6382407">)</span><br>
<span class="lineno"></span><span class="op" id="6382409">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="6382412">//&nbsp;EncodeToken&nbsp;writes&nbsp;the&nbsp;given&nbsp;XML&nbsp;token&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="6382469">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;StartElement&nbsp;and&nbsp;EndElement&nbsp;tokens&nbsp;are&nbsp;not&nbsp;properly&nbsp;matched.</span><br>
<span class="lineno"></span><span class="comment" id="6382556">//</span><br>
<span class="lineno"></span><span class="comment" id="6382559">//&nbsp;EncodeToken&nbsp;does&nbsp;not&nbsp;call&nbsp;Flush,&nbsp;because&nbsp;usually&nbsp;it&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;larger&nbsp;operation</span><br>
<span class="lineno">185</span><span class="comment" id="6382644">//&nbsp;such&nbsp;as&nbsp;Encode&nbsp;or&nbsp;EncodeElement&nbsp;(or&nbsp;a&nbsp;custom&nbsp;Marshaler&#39;s&nbsp;MarshalXML&nbsp;invoked</span><br>
<span class="lineno"></span><span class="comment" id="6382723">//&nbsp;during&nbsp;those),&nbsp;and&nbsp;those&nbsp;will&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="6382782">//&nbsp;Callers&nbsp;that&nbsp;create&nbsp;an&nbsp;Encoder&nbsp;and&nbsp;then&nbsp;invoke&nbsp;EncodeToken&nbsp;directly,&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="6382862">//&nbsp;using&nbsp;Encode&nbsp;or&nbsp;EncodeElement,&nbsp;need&nbsp;to&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6382939">//&nbsp;that&nbsp;the&nbsp;XML&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">190</span><span class="comment" id="6382992">//</span><br>
<span class="lineno"></span><span class="comment" id="6382995">//&nbsp;EncodeToken&nbsp;allows&nbsp;writing&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;Target&nbsp;set&nbsp;to&nbsp;&#34;xml&#34;&nbsp;only&nbsp;as&nbsp;the&nbsp;first&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="6383085">//&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6383103">func</span>&nbsp;<span class="op" id="6383108">(</span><span class="ident" id="6383109">enc</span>&nbsp;<span class="op" id="6383113">*</span><span class="ident" id="6383114">Encoder</span><span class="op" id="6383121">)</span>&nbsp;<span class="ident" id="6383123">EncodeToken</span><span class="op" id="6383134">(</span><span class="ident" id="6383135">t</span>&nbsp;<span class="ident" id="6383137">Token</span><span class="op" id="6383142">)</span>&nbsp;<span class="builtintype" id="6383144">error</span>&nbsp;<span class="op" id="6383150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383153">p</span>&nbsp;<span class="op" id="6383155">:=</span>&nbsp;<span class="op" id="6383158">&amp;</span><span class="ident" id="6383159">enc</span><span class="op" id="6383162">.</span><span class="ident" id="6383163">p</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383166">switch</span>&nbsp;<span class="ident" id="6383173">t</span>&nbsp;<span class="op" id="6383175">:=</span>&nbsp;<span class="ident" id="6383178">t</span><span class="op" id="6383179">.</span><span class="op" id="6383180">(</span><span class="keyword" id="6383181">type</span><span class="op" id="6383185">)</span>&nbsp;<span class="op" id="6383187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383190">case</span>&nbsp;<span class="ident" id="6383195">StartElement</span><span class="op" id="6383207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383211">if</span>&nbsp;<span class="ident" id="6383214">err</span>&nbsp;<span class="op" id="6383218">:=</span>&nbsp;<span class="ident" id="6383221">p</span><span class="op" id="6383222">.</span><span class="ident" id="6383223">writeStart</span><span class="op" id="6383233">(</span><span class="op" id="6383234">&amp;</span><span class="ident" id="6383235">t</span><span class="op" id="6383236">)</span><span class="op" id="6383237">;</span>&nbsp;<span class="ident" id="6383239">err</span>&nbsp;<span class="op" id="6383243">!=</span>&nbsp;<span class="ident" id="6383246">nil</span>&nbsp;<span class="op" id="6383250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383255">return</span>&nbsp;<span class="ident" id="6383262">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383268">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383271">case</span>&nbsp;<span class="ident" id="6383276">EndElement</span><span class="op" id="6383286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383290">if</span>&nbsp;<span class="ident" id="6383293">err</span>&nbsp;<span class="op" id="6383297">:=</span>&nbsp;<span class="ident" id="6383300">p</span><span class="op" id="6383301">.</span><span class="ident" id="6383302">writeEnd</span><span class="op" id="6383310">(</span><span class="ident" id="6383311">t</span><span class="op" id="6383312">.</span><span class="ident" id="6383313">Name</span><span class="op" id="6383317">)</span><span class="op" id="6383318">;</span>&nbsp;<span class="ident" id="6383320">err</span>&nbsp;<span class="op" id="6383324">!=</span>&nbsp;<span class="ident" id="6383327">nil</span>&nbsp;<span class="op" id="6383331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383336">return</span>&nbsp;<span class="ident" id="6383343">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383352">case</span>&nbsp;<span class="ident" id="6383357">CharData</span><span class="op" id="6383365">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383369">EscapeText</span><span class="op" id="6383379">(</span><span class="ident" id="6383380">p</span><span class="op" id="6383381">,</span>&nbsp;<span class="ident" id="6383383">t</span><span class="op" id="6383384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383387">case</span>&nbsp;<span class="ident" id="6383392">Comment</span><span class="op" id="6383399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383403">if</span>&nbsp;<span class="ident" id="6383406">bytes</span><span class="op" id="6383411">.</span><span class="ident" id="6383412">Contains</span><span class="op" id="6383420">(</span><span class="ident" id="6383421">t</span><span class="op" id="6383422">,</span>&nbsp;<span class="ident" id="6383424">endComment</span><span class="op" id="6383434">)</span>&nbsp;<span class="op" id="6383436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383441">return</span>&nbsp;<span class="ident" id="6383448">fmt</span><span class="op" id="6383451">.</span><span class="ident" id="6383452">Errorf</span><span class="op" id="6383458">(</span><span class="string" id="6383459">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Comment&nbsp;containing&nbsp;--&gt;&nbsp;marker&#34;</span><span class="op" id="6383510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383514">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383518">p</span><span class="op" id="6383519">.</span><span class="ident" id="6383520">WriteString</span><span class="op" id="6383531">(</span><span class="string" id="6383532">&#34;&lt;!--&#34;</span><span class="op" id="6383538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383542">p</span><span class="op" id="6383543">.</span><span class="ident" id="6383544">Write</span><span class="op" id="6383549">(</span><span class="ident" id="6383550">t</span><span class="op" id="6383551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383555">p</span><span class="op" id="6383556">.</span><span class="ident" id="6383557">WriteString</span><span class="op" id="6383568">(</span><span class="string" id="6383569">&#34;--&gt;&#34;</span><span class="op" id="6383574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383578">return</span>&nbsp;<span class="ident" id="6383585">p</span><span class="op" id="6383586">.</span><span class="ident" id="6383587">cachedWriteError</span><span class="op" id="6383603">(</span><span class="op" id="6383604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383607">case</span>&nbsp;<span class="ident" id="6383612">ProcInst</span><span class="op" id="6383620">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383624">//&nbsp;First&nbsp;token&nbsp;to&nbsp;be&nbsp;encoded&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;target&nbsp;of&nbsp;xml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383699">//&nbsp;is&nbsp;the&nbsp;xml&nbsp;declaration.&nbsp;&nbsp;The&nbsp;only&nbsp;ProcInst&nbsp;where&nbsp;target&nbsp;of&nbsp;xml&nbsp;is&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383779">if</span>&nbsp;<span class="ident" id="6383782">t</span><span class="op" id="6383783">.</span><span class="ident" id="6383784">Target</span>&nbsp;<span class="op" id="6383791">==</span>&nbsp;<span class="string" id="6383794">&#34;xml&#34;</span>&nbsp;<span class="op" id="6383800">&amp;&amp;</span>&nbsp;<span class="ident" id="6383803">p</span><span class="op" id="6383804">.</span><span class="ident" id="6383805">Buffered</span><span class="op" id="6383813">(</span><span class="op" id="6383814">)</span>&nbsp;<span class="op" id="6383816">!=</span>&nbsp;<span class="num" id="6383819">0</span>&nbsp;<span class="op" id="6383821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383826">return</span>&nbsp;<span class="ident" id="6383833">fmt</span><span class="op" id="6383836">.</span><span class="ident" id="6383837">Errorf</span><span class="op" id="6383843">(</span><span class="string" id="6383844">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;xml&nbsp;target&nbsp;only&nbsp;valid&nbsp;for&nbsp;xml&nbsp;declaration,&nbsp;first&nbsp;token&nbsp;encoded&#34;</span><span class="op" id="6383937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383941">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383945">if</span>&nbsp;<span class="op" id="6383948">!</span><span class="ident" id="6383949">isNameString</span><span class="op" id="6383961">(</span><span class="ident" id="6383962">t</span><span class="op" id="6383963">.</span><span class="ident" id="6383964">Target</span><span class="op" id="6383970">)</span>&nbsp;<span class="op" id="6383972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383977">return</span>&nbsp;<span class="ident" id="6383984">fmt</span><span class="op" id="6383987">.</span><span class="ident" id="6383988">Errorf</span><span class="op" id="6383994">(</span><span class="string" id="6383995">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;with&nbsp;invalid&nbsp;Target&#34;</span><span class="op" id="6384045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384053">if</span>&nbsp;<span class="ident" id="6384056">bytes</span><span class="op" id="6384061">.</span><span class="ident" id="6384062">Contains</span><span class="op" id="6384070">(</span><span class="ident" id="6384071">t</span><span class="op" id="6384072">.</span><span class="ident" id="6384073">Inst</span><span class="op" id="6384077">,</span>&nbsp;<span class="ident" id="6384079">endProcInst</span><span class="op" id="6384090">)</span>&nbsp;<span class="op" id="6384092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384097">return</span>&nbsp;<span class="ident" id="6384104">fmt</span><span class="op" id="6384107">.</span><span class="ident" id="6384108">Errorf</span><span class="op" id="6384114">(</span><span class="string" id="6384115">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;containing&nbsp;?&gt;&nbsp;marker&#34;</span><span class="op" id="6384166">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384174">p</span><span class="op" id="6384175">.</span><span class="ident" id="6384176">WriteString</span><span class="op" id="6384187">(</span><span class="string" id="6384188">&#34;&lt;?&#34;</span><span class="op" id="6384192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384196">p</span><span class="op" id="6384197">.</span><span class="ident" id="6384198">WriteString</span><span class="op" id="6384209">(</span><span class="ident" id="6384210">t</span><span class="op" id="6384211">.</span><span class="ident" id="6384212">Target</span><span class="op" id="6384218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384222">if</span>&nbsp;<span class="builtinfunc" id="6384225">len</span><span class="op" id="6384228">(</span><span class="ident" id="6384229">t</span><span class="op" id="6384230">.</span><span class="ident" id="6384231">Inst</span><span class="op" id="6384235">)</span>&nbsp;<span class="op" id="6384237">&gt;</span>&nbsp;<span class="num" id="6384239">0</span>&nbsp;<span class="op" id="6384241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384246">p</span><span class="op" id="6384247">.</span><span class="ident" id="6384248">WriteByte</span><span class="op" id="6384257">(</span><span class="string" id="6384258">&#39;&nbsp;&#39;</span><span class="op" id="6384261">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384266">p</span><span class="op" id="6384267">.</span><span class="ident" id="6384268">Write</span><span class="op" id="6384273">(</span><span class="ident" id="6384274">t</span><span class="op" id="6384275">.</span><span class="ident" id="6384276">Inst</span><span class="op" id="6384280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384288">p</span><span class="op" id="6384289">.</span><span class="ident" id="6384290">WriteString</span><span class="op" id="6384301">(</span><span class="string" id="6384302">&#34;?&gt;&#34;</span><span class="op" id="6384306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384309">case</span>&nbsp;<span class="ident" id="6384314">Directive</span><span class="op" id="6384323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384327">if</span>&nbsp;<span class="ident" id="6384330">bytes</span><span class="op" id="6384335">.</span><span class="ident" id="6384336">Contains</span><span class="op" id="6384344">(</span><span class="ident" id="6384345">t</span><span class="op" id="6384346">,</span>&nbsp;<span class="ident" id="6384348">endDirective</span><span class="op" id="6384360">)</span>&nbsp;<span class="op" id="6384362">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384367">return</span>&nbsp;<span class="ident" id="6384374">fmt</span><span class="op" id="6384377">.</span><span class="ident" id="6384378">Errorf</span><span class="op" id="6384384">(</span><span class="string" id="6384385">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Directive&nbsp;containing&nbsp;&gt;&nbsp;marker&#34;</span><span class="op" id="6384436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384444">p</span><span class="op" id="6384445">.</span><span class="ident" id="6384446">WriteString</span><span class="op" id="6384457">(</span><span class="string" id="6384458">&#34;&lt;!&#34;</span><span class="op" id="6384462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384466">p</span><span class="op" id="6384467">.</span><span class="ident" id="6384468">Write</span><span class="op" id="6384473">(</span><span class="ident" id="6384474">t</span><span class="op" id="6384475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384479">p</span><span class="op" id="6384480">.</span><span class="ident" id="6384481">WriteString</span><span class="op" id="6384492">(</span><span class="string" id="6384493">&#34;&gt;&#34;</span><span class="op" id="6384496">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384502">return</span>&nbsp;<span class="ident" id="6384509">p</span><span class="op" id="6384510">.</span><span class="ident" id="6384511">cachedWriteError</span><span class="op" id="6384527">(</span><span class="op" id="6384528">)</span><br>
<span class="lineno"></span><span class="op" id="6384530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6384533">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;XML&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">245</span><span class="comment" id="6384593">//&nbsp;See&nbsp;the&nbsp;EncodeToken&nbsp;documentation&nbsp;for&nbsp;details&nbsp;about&nbsp;when&nbsp;it&nbsp;is&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6384670">func</span>&nbsp;<span class="op" id="6384675">(</span><span class="ident" id="6384676">enc</span>&nbsp;<span class="op" id="6384680">*</span><span class="ident" id="6384681">Encoder</span><span class="op" id="6384688">)</span>&nbsp;<span class="ident" id="6384690">Flush</span><span class="op" id="6384695">(</span><span class="op" id="6384696">)</span>&nbsp;<span class="builtintype" id="6384698">error</span>&nbsp;<span class="op" id="6384704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384707">return</span>&nbsp;<span class="ident" id="6384714">enc</span><span class="op" id="6384717">.</span><span class="ident" id="6384718">p</span><span class="op" id="6384719">.</span><span class="ident" id="6384720">Flush</span><span class="op" id="6384725">(</span><span class="op" id="6384726">)</span><br>
<span class="lineno"></span><span class="op" id="6384728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6384731">type</span>&nbsp;<span class="ident" id="6384736">printer</span>&nbsp;<span class="keyword" id="6384744">struct</span>&nbsp;<span class="op" id="6384751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384754">*</span><span class="ident" id="6384755">bufio</span><span class="op" id="6384760">.</span><span class="ident" id="6384761">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384769">encoder</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384780">*</span><span class="ident" id="6384781">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384790">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6384801">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384806">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6384817">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384825">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6384836">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384844">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6384855">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384860">indentedIn</span>&nbsp;<span class="builtintype" id="6384871">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384877">putNewline</span>&nbsp;<span class="builtintype" id="6384888">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384894">attrNS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384905">map</span><span class="op" id="6384908">[</span><span class="builtintype" id="6384909">string</span><span class="op" id="6384915">]</span><span class="builtintype" id="6384916">string</span>&nbsp;<span class="comment" id="6384923">//&nbsp;map&nbsp;prefix&nbsp;-&gt;&nbsp;name&nbsp;space</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384952">attrPrefix</span>&nbsp;<span class="keyword" id="6384963">map</span><span class="op" id="6384966">[</span><span class="builtintype" id="6384967">string</span><span class="op" id="6384973">]</span><span class="builtintype" id="6384974">string</span>&nbsp;<span class="comment" id="6384981">//&nbsp;map&nbsp;name&nbsp;space&nbsp;-&gt;&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385010">prefixes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6385021">[</span><span class="op" id="6385022">]</span><span class="builtintype" id="6385023">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385031">tags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6385042">[</span><span class="op" id="6385043">]</span><span class="ident" id="6385044">Name</span><br>
<span class="lineno"></span><span class="op" id="6385049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment" id="6385052">//&nbsp;createAttrPrefix&nbsp;finds&nbsp;the&nbsp;name&nbsp;space&nbsp;prefix&nbsp;attribute&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;given&nbsp;name&nbsp;space,</span><br>
<span class="lineno"></span><span class="comment" id="6385143">//&nbsp;defining&nbsp;a&nbsp;new&nbsp;prefix&nbsp;if&nbsp;necessary.&nbsp;It&nbsp;returns&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6385205">func</span>&nbsp;<span class="op" id="6385210">(</span><span class="ident" id="6385211">p</span>&nbsp;<span class="op" id="6385213">*</span><span class="ident" id="6385214">printer</span><span class="op" id="6385221">)</span>&nbsp;<span class="ident" id="6385223">createAttrPrefix</span><span class="op" id="6385239">(</span><span class="ident" id="6385240">url</span>&nbsp;<span class="builtintype" id="6385244">string</span><span class="op" id="6385250">)</span>&nbsp;<span class="builtintype" id="6385252">string</span>&nbsp;<span class="op" id="6385259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385262">if</span>&nbsp;<span class="ident" id="6385265">prefix</span>&nbsp;<span class="op" id="6385272">:=</span>&nbsp;<span class="ident" id="6385275">p</span><span class="op" id="6385276">.</span><span class="ident" id="6385277">attrPrefix</span><span class="op" id="6385287">[</span><span class="ident" id="6385288">url</span><span class="op" id="6385291">]</span><span class="op" id="6385292">;</span>&nbsp;<span class="ident" id="6385294">prefix</span>&nbsp;<span class="op" id="6385301">!=</span>&nbsp;<span class="string" id="6385304">&#34;&#34;</span>&nbsp;<span class="op" id="6385307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385311">return</span>&nbsp;<span class="ident" id="6385318">prefix</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385330">//&nbsp;The&nbsp;&#34;http://www.w3.org/XML/1998/namespace&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;predefined&nbsp;as&nbsp;&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385411">//&nbsp;and&nbsp;must&nbsp;be&nbsp;referred&nbsp;to&nbsp;that&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385449">//&nbsp;(The&nbsp;&#34;http://www.w3.org/2000/xmlns/&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;also&nbsp;predefined&nbsp;as&nbsp;&#34;xmlns&#34;,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385532">//&nbsp;but&nbsp;users&nbsp;should&nbsp;not&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;that&nbsp;one&nbsp;directly&nbsp;-&nbsp;that&#39;s&nbsp;our&nbsp;job.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385611">if</span>&nbsp;<span class="ident" id="6385614">url</span>&nbsp;<span class="op" id="6385618">==</span>&nbsp;<span class="ident" id="6385621">xmlURL</span>&nbsp;<span class="op" id="6385628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385632">return</span>&nbsp;<span class="string" id="6385639">&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385650">//&nbsp;Need&nbsp;to&nbsp;define&nbsp;a&nbsp;new&nbsp;name&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385687">if</span>&nbsp;<span class="ident" id="6385690">p</span><span class="op" id="6385691">.</span><span class="ident" id="6385692">attrPrefix</span>&nbsp;<span class="op" id="6385703">==</span>&nbsp;<span class="ident" id="6385706">nil</span>&nbsp;<span class="op" id="6385710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385714">p</span><span class="op" id="6385715">.</span><span class="ident" id="6385716">attrPrefix</span>&nbsp;<span class="op" id="6385727">=</span>&nbsp;<span class="builtinfunc" id="6385729">make</span><span class="op" id="6385733">(</span><span class="keyword" id="6385734">map</span><span class="op" id="6385737">[</span><span class="builtintype" id="6385738">string</span><span class="op" id="6385744">]</span><span class="builtintype" id="6385745">string</span><span class="op" id="6385751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385755">p</span><span class="op" id="6385756">.</span><span class="ident" id="6385757">attrNS</span>&nbsp;<span class="op" id="6385764">=</span>&nbsp;<span class="builtinfunc" id="6385766">make</span><span class="op" id="6385770">(</span><span class="keyword" id="6385771">map</span><span class="op" id="6385774">[</span><span class="builtintype" id="6385775">string</span><span class="op" id="6385781">]</span><span class="builtintype" id="6385782">string</span><span class="op" id="6385788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385791">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385795">//&nbsp;Pick&nbsp;a&nbsp;name.&nbsp;We&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;the&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385856">//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385880">prefix</span>&nbsp;<span class="op" id="6385887">:=</span>&nbsp;<span class="ident" id="6385890">strings</span><span class="op" id="6385897">.</span><span class="ident" id="6385898">TrimRight</span><span class="op" id="6385907">(</span><span class="ident" id="6385908">url</span><span class="op" id="6385911">,</span>&nbsp;<span class="string" id="6385913">&#34;/&#34;</span><span class="op" id="6385916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385919">if</span>&nbsp;<span class="ident" id="6385922">i</span>&nbsp;<span class="op" id="6385924">:=</span>&nbsp;<span class="ident" id="6385927">strings</span><span class="op" id="6385934">.</span><span class="ident" id="6385935">LastIndex</span><span class="op" id="6385944">(</span><span class="ident" id="6385945">prefix</span><span class="op" id="6385951">,</span>&nbsp;<span class="string" id="6385953">&#34;/&#34;</span><span class="op" id="6385956">)</span><span class="op" id="6385957">;</span>&nbsp;<span class="ident" id="6385959">i</span>&nbsp;<span class="op" id="6385961">&gt;=</span>&nbsp;<span class="num" id="6385964">0</span>&nbsp;<span class="op" id="6385966">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385970">prefix</span>&nbsp;<span class="op" id="6385977">=</span>&nbsp;<span class="ident" id="6385979">prefix</span><span class="op" id="6385985">[</span><span class="ident" id="6385986">i</span><span class="op" id="6385987">+</span><span class="num" id="6385988">1</span><span class="op" id="6385989">:</span><span class="op" id="6385990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385996">if</span>&nbsp;<span class="ident" id="6385999">prefix</span>&nbsp;<span class="op" id="6386006">==</span>&nbsp;<span class="string" id="6386009">&#34;&#34;</span>&nbsp;<span class="op" id="6386012">||</span>&nbsp;<span class="op" id="6386015">!</span><span class="ident" id="6386016">isName</span><span class="op" id="6386022">(</span><span class="op" id="6386023">[</span><span class="op" id="6386024">]</span><span class="builtintype" id="6386025">byte</span><span class="op" id="6386029">(</span><span class="ident" id="6386030">prefix</span><span class="op" id="6386036">)</span><span class="op" id="6386037">)</span>&nbsp;<span class="op" id="6386039">||</span>&nbsp;<span class="ident" id="6386042">strings</span><span class="op" id="6386049">.</span><span class="ident" id="6386050">Contains</span><span class="op" id="6386058">(</span><span class="ident" id="6386059">prefix</span><span class="op" id="6386065">,</span>&nbsp;<span class="string" id="6386067">&#34;:&#34;</span><span class="op" id="6386070">)</span>&nbsp;<span class="op" id="6386072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386076">prefix</span>&nbsp;<span class="op" id="6386083">=</span>&nbsp;<span class="string" id="6386085">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386090">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386093">if</span>&nbsp;<span class="ident" id="6386096">strings</span><span class="op" id="6386103">.</span><span class="ident" id="6386104">HasPrefix</span><span class="op" id="6386113">(</span><span class="ident" id="6386114">prefix</span><span class="op" id="6386120">,</span>&nbsp;<span class="string" id="6386122">&#34;xml&#34;</span><span class="op" id="6386127">)</span>&nbsp;<span class="op" id="6386129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386133">//&nbsp;xmlanything&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386163">prefix</span>&nbsp;<span class="op" id="6386170">=</span>&nbsp;<span class="string" id="6386172">&#34;_&#34;</span>&nbsp;<span class="op" id="6386176">+</span>&nbsp;<span class="ident" id="6386178">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386189">if</span>&nbsp;<span class="ident" id="6386192">p</span><span class="op" id="6386193">.</span><span class="ident" id="6386194">attrNS</span><span class="op" id="6386200">[</span><span class="ident" id="6386201">prefix</span><span class="op" id="6386207">]</span>&nbsp;<span class="op" id="6386209">!=</span>&nbsp;<span class="string" id="6386212">&#34;&#34;</span>&nbsp;<span class="op" id="6386215">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386219">//&nbsp;Name&nbsp;is&nbsp;taken.&nbsp;Find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386258">for</span>&nbsp;<span class="ident" id="6386262">p</span><span class="op" id="6386263">.</span><span class="ident" id="6386264">seq</span><span class="op" id="6386267">++</span><span class="op" id="6386269">;</span>&nbsp;<span class="op" id="6386271">;</span>&nbsp;<span class="ident" id="6386273">p</span><span class="op" id="6386274">.</span><span class="ident" id="6386275">seq</span><span class="op" id="6386278">++</span>&nbsp;<span class="op" id="6386281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386286">if</span>&nbsp;<span class="ident" id="6386289">id</span>&nbsp;<span class="op" id="6386292">:=</span>&nbsp;<span class="ident" id="6386295">prefix</span>&nbsp;<span class="op" id="6386302">+</span>&nbsp;<span class="string" id="6386304">&#34;_&#34;</span>&nbsp;<span class="op" id="6386308">+</span>&nbsp;<span class="ident" id="6386310">strconv</span><span class="op" id="6386317">.</span><span class="ident" id="6386318">Itoa</span><span class="op" id="6386322">(</span><span class="ident" id="6386323">p</span><span class="op" id="6386324">.</span><span class="ident" id="6386325">seq</span><span class="op" id="6386328">)</span><span class="op" id="6386329">;</span>&nbsp;<span class="ident" id="6386331">p</span><span class="op" id="6386332">.</span><span class="ident" id="6386333">attrNS</span><span class="op" id="6386339">[</span><span class="ident" id="6386340">id</span><span class="op" id="6386342">]</span>&nbsp;<span class="op" id="6386344">==</span>&nbsp;<span class="string" id="6386347">&#34;&#34;</span>&nbsp;<span class="op" id="6386350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386356">prefix</span>&nbsp;<span class="op" id="6386363">=</span>&nbsp;<span class="ident" id="6386365">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386372">break</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386392">p</span><span class="op" id="6386393">.</span><span class="ident" id="6386394">attrPrefix</span><span class="op" id="6386404">[</span><span class="ident" id="6386405">url</span><span class="op" id="6386408">]</span>&nbsp;<span class="op" id="6386410">=</span>&nbsp;<span class="ident" id="6386412">prefix</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386420">p</span><span class="op" id="6386421">.</span><span class="ident" id="6386422">attrNS</span><span class="op" id="6386428">[</span><span class="ident" id="6386429">prefix</span><span class="op" id="6386435">]</span>&nbsp;<span class="op" id="6386437">=</span>&nbsp;<span class="ident" id="6386439">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386445">p</span><span class="op" id="6386446">.</span><span class="ident" id="6386447">WriteString</span><span class="op" id="6386458">(</span><span class="string" id="6386459">`xmlns:`</span><span class="op" id="6386467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386470">p</span><span class="op" id="6386471">.</span><span class="ident" id="6386472">WriteString</span><span class="op" id="6386483">(</span><span class="ident" id="6386484">prefix</span><span class="op" id="6386490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386493">p</span><span class="op" id="6386494">.</span><span class="ident" id="6386495">WriteString</span><span class="op" id="6386506">(</span><span class="string" id="6386507">`=&#34;`</span><span class="op" id="6386511">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386514">EscapeText</span><span class="op" id="6386524">(</span><span class="ident" id="6386525">p</span><span class="op" id="6386526">,</span>&nbsp;<span class="op" id="6386528">[</span><span class="op" id="6386529">]</span><span class="builtintype" id="6386530">byte</span><span class="op" id="6386534">(</span><span class="ident" id="6386535">url</span><span class="op" id="6386538">)</span><span class="op" id="6386539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386542">p</span><span class="op" id="6386543">.</span><span class="ident" id="6386544">WriteString</span><span class="op" id="6386555">(</span><span class="string" id="6386556">`&#34;&nbsp;`</span><span class="op" id="6386560">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386564">p</span><span class="op" id="6386565">.</span><span class="ident" id="6386566">prefixes</span>&nbsp;<span class="op" id="6386575">=</span>&nbsp;<span class="builtinfunc" id="6386577">append</span><span class="op" id="6386583">(</span><span class="ident" id="6386584">p</span><span class="op" id="6386585">.</span><span class="ident" id="6386586">prefixes</span><span class="op" id="6386594">,</span>&nbsp;<span class="ident" id="6386596">prefix</span><span class="op" id="6386602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386606">return</span>&nbsp;<span class="ident" id="6386613">prefix</span><br>
<span class="lineno"></span><span class="op" id="6386620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6386623">//&nbsp;deleteAttrPrefix&nbsp;removes&nbsp;an&nbsp;attribute&nbsp;name&nbsp;space&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6386683">func</span>&nbsp;<span class="op" id="6386688">(</span><span class="ident" id="6386689">p</span>&nbsp;<span class="op" id="6386691">*</span><span class="ident" id="6386692">printer</span><span class="op" id="6386699">)</span>&nbsp;<span class="ident" id="6386701">deleteAttrPrefix</span><span class="op" id="6386717">(</span><span class="ident" id="6386718">prefix</span>&nbsp;<span class="builtintype" id="6386725">string</span><span class="op" id="6386731">)</span>&nbsp;<span class="op" id="6386733">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6386736">delete</span><span class="op" id="6386742">(</span><span class="ident" id="6386743">p</span><span class="op" id="6386744">.</span><span class="ident" id="6386745">attrPrefix</span><span class="op" id="6386755">,</span>&nbsp;<span class="ident" id="6386757">p</span><span class="op" id="6386758">.</span><span class="ident" id="6386759">attrNS</span><span class="op" id="6386765">[</span><span class="ident" id="6386766">prefix</span><span class="op" id="6386772">]</span><span class="op" id="6386773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6386776">delete</span><span class="op" id="6386782">(</span><span class="ident" id="6386783">p</span><span class="op" id="6386784">.</span><span class="ident" id="6386785">attrNS</span><span class="op" id="6386791">,</span>&nbsp;<span class="ident" id="6386793">prefix</span><span class="op" id="6386799">)</span><br>
<span class="lineno"></span><span class="op" id="6386801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6386804">func</span>&nbsp;<span class="op" id="6386809">(</span><span class="ident" id="6386810">p</span>&nbsp;<span class="op" id="6386812">*</span><span class="ident" id="6386813">printer</span><span class="op" id="6386820">)</span>&nbsp;<span class="ident" id="6386822">markPrefix</span><span class="op" id="6386832">(</span><span class="op" id="6386833">)</span>&nbsp;<span class="op" id="6386835">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386838">p</span><span class="op" id="6386839">.</span><span class="ident" id="6386840">prefixes</span>&nbsp;<span class="op" id="6386849">=</span>&nbsp;<span class="builtinfunc" id="6386851">append</span><span class="op" id="6386857">(</span><span class="ident" id="6386858">p</span><span class="op" id="6386859">.</span><span class="ident" id="6386860">prefixes</span><span class="op" id="6386868">,</span>&nbsp;<span class="string" id="6386870">&#34;&#34;</span><span class="op" id="6386872">)</span><br>
<span class="lineno"></span><span class="op" id="6386874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6386877">func</span>&nbsp;<span class="op" id="6386882">(</span><span class="ident" id="6386883">p</span>&nbsp;<span class="op" id="6386885">*</span><span class="ident" id="6386886">printer</span><span class="op" id="6386893">)</span>&nbsp;<span class="ident" id="6386895">popPrefix</span><span class="op" id="6386904">(</span><span class="op" id="6386905">)</span>&nbsp;<span class="op" id="6386907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386910">for</span>&nbsp;<span class="builtinfunc" id="6386914">len</span><span class="op" id="6386917">(</span><span class="ident" id="6386918">p</span><span class="op" id="6386919">.</span><span class="ident" id="6386920">prefixes</span><span class="op" id="6386928">)</span>&nbsp;<span class="op" id="6386930">&gt;</span>&nbsp;<span class="num" id="6386932">0</span>&nbsp;<span class="op" id="6386934">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386938">prefix</span>&nbsp;<span class="op" id="6386945">:=</span>&nbsp;<span class="ident" id="6386948">p</span><span class="op" id="6386949">.</span><span class="ident" id="6386950">prefixes</span><span class="op" id="6386958">[</span><span class="builtinfunc" id="6386959">len</span><span class="op" id="6386962">(</span><span class="ident" id="6386963">p</span><span class="op" id="6386964">.</span><span class="ident" id="6386965">prefixes</span><span class="op" id="6386973">)</span><span class="op" id="6386974">-</span><span class="num" id="6386975">1</span><span class="op" id="6386976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386980">p</span><span class="op" id="6386981">.</span><span class="ident" id="6386982">prefixes</span>&nbsp;<span class="op" id="6386991">=</span>&nbsp;<span class="ident" id="6386993">p</span><span class="op" id="6386994">.</span><span class="ident" id="6386995">prefixes</span><span class="op" id="6387003">[</span><span class="op" id="6387004">:</span><span class="builtinfunc" id="6387005">len</span><span class="op" id="6387008">(</span><span class="ident" id="6387009">p</span><span class="op" id="6387010">.</span><span class="ident" id="6387011">prefixes</span><span class="op" id="6387019">)</span><span class="op" id="6387020">-</span><span class="num" id="6387021">1</span><span class="op" id="6387022">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387026">if</span>&nbsp;<span class="ident" id="6387029">prefix</span>&nbsp;<span class="op" id="6387036">==</span>&nbsp;<span class="string" id="6387039">&#34;&#34;</span>&nbsp;<span class="op" id="6387042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387047">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387055">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387059">p</span><span class="op" id="6387060">.</span><span class="ident" id="6387061">deleteAttrPrefix</span><span class="op" id="6387077">(</span><span class="ident" id="6387078">prefix</span><span class="op" id="6387084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387087">}</span><br>
<span class="lineno"></span><span class="op" id="6387089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6387092">var</span>&nbsp;<span class="op" id="6387096">(</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387099">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387117">=</span>&nbsp;<span class="ident" id="6387119">reflect</span><span class="op" id="6387126">.</span><span class="ident" id="6387127">TypeOf</span><span class="op" id="6387133">(</span><span class="op" id="6387134">(</span><span class="op" id="6387135">*</span><span class="ident" id="6387136">Marshaler</span><span class="op" id="6387145">)</span><span class="op" id="6387146">(</span><span class="ident" id="6387147">nil</span><span class="op" id="6387150">)</span><span class="op" id="6387151">)</span><span class="op" id="6387152">.</span><span class="ident" id="6387153">Elem</span><span class="op" id="6387157">(</span><span class="op" id="6387158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387161">marshalerAttrType</span>&nbsp;<span class="op" id="6387179">=</span>&nbsp;<span class="ident" id="6387181">reflect</span><span class="op" id="6387188">.</span><span class="ident" id="6387189">TypeOf</span><span class="op" id="6387195">(</span><span class="op" id="6387196">(</span><span class="op" id="6387197">*</span><span class="ident" id="6387198">MarshalerAttr</span><span class="op" id="6387211">)</span><span class="op" id="6387212">(</span><span class="ident" id="6387213">nil</span><span class="op" id="6387216">)</span><span class="op" id="6387217">)</span><span class="op" id="6387218">.</span><span class="ident" id="6387219">Elem</span><span class="op" id="6387223">(</span><span class="op" id="6387224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387227">textMarshalerType</span>&nbsp;<span class="op" id="6387245">=</span>&nbsp;<span class="ident" id="6387247">reflect</span><span class="op" id="6387254">.</span><span class="ident" id="6387255">TypeOf</span><span class="op" id="6387261">(</span><span class="op" id="6387262">(</span><span class="op" id="6387263">*</span><span class="ident" id="6387264">encoding</span><span class="op" id="6387272">.</span><span class="ident" id="6387273">TextMarshaler</span><span class="op" id="6387286">)</span><span class="op" id="6387287">(</span><span class="ident" id="6387288">nil</span><span class="op" id="6387291">)</span><span class="op" id="6387292">)</span><span class="op" id="6387293">.</span><span class="ident" id="6387294">Elem</span><span class="op" id="6387298">(</span><span class="op" id="6387299">)</span><br>
<span class="lineno"></span><span class="op" id="6387301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="6387304">//&nbsp;marshalValue&nbsp;writes&nbsp;one&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements&nbsp;representing&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="6387370">//&nbsp;If&nbsp;val&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;struct&nbsp;field,&nbsp;finfo&nbsp;must&nbsp;have&nbsp;its&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="6387443">func</span>&nbsp;<span class="op" id="6387448">(</span><span class="ident" id="6387449">p</span>&nbsp;<span class="op" id="6387451">*</span><span class="ident" id="6387452">printer</span><span class="op" id="6387459">)</span>&nbsp;<span class="ident" id="6387461">marshalValue</span><span class="op" id="6387473">(</span><span class="ident" id="6387474">val</span>&nbsp;<span class="ident" id="6387478">reflect</span><span class="op" id="6387485">.</span><span class="ident" id="6387486">Value</span><span class="op" id="6387491">,</span>&nbsp;<span class="ident" id="6387493">finfo</span>&nbsp;<span class="op" id="6387499">*</span><span class="ident" id="6387500">fieldInfo</span><span class="op" id="6387509">,</span>&nbsp;<span class="ident" id="6387511">startTemplate</span>&nbsp;<span class="op" id="6387525">*</span><span class="ident" id="6387526">StartElement</span><span class="op" id="6387538">)</span>&nbsp;<span class="builtintype" id="6387540">error</span>&nbsp;<span class="op" id="6387546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387549">if</span>&nbsp;<span class="ident" id="6387552">startTemplate</span>&nbsp;<span class="op" id="6387566">!=</span>&nbsp;<span class="ident" id="6387569">nil</span>&nbsp;<span class="op" id="6387573">&amp;&amp;</span>&nbsp;<span class="ident" id="6387576">startTemplate</span><span class="op" id="6387589">.</span><span class="ident" id="6387590">Name</span><span class="op" id="6387594">.</span><span class="ident" id="6387595">Local</span>&nbsp;<span class="op" id="6387601">==</span>&nbsp;<span class="string" id="6387604">&#34;&#34;</span>&nbsp;<span class="op" id="6387607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387611">return</span>&nbsp;<span class="ident" id="6387618">fmt</span><span class="op" id="6387621">.</span><span class="ident" id="6387622">Errorf</span><span class="op" id="6387628">(</span><span class="string" id="6387629">&#34;xml:&nbsp;EncodeElement&nbsp;of&nbsp;StartElement&nbsp;with&nbsp;missing&nbsp;name&#34;</span><span class="op" id="6387683">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387690">if</span>&nbsp;<span class="op" id="6387693">!</span><span class="ident" id="6387694">val</span><span class="op" id="6387697">.</span><span class="ident" id="6387698">IsValid</span><span class="op" id="6387705">(</span><span class="op" id="6387706">)</span>&nbsp;<span class="op" id="6387708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387712">return</span>&nbsp;<span class="ident" id="6387719">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387724">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387727">if</span>&nbsp;<span class="ident" id="6387730">finfo</span>&nbsp;<span class="op" id="6387736">!=</span>&nbsp;<span class="ident" id="6387739">nil</span>&nbsp;<span class="op" id="6387743">&amp;&amp;</span>&nbsp;<span class="ident" id="6387746">finfo</span><span class="op" id="6387751">.</span><span class="ident" id="6387752">flags</span><span class="op" id="6387757">&amp;</span><span class="ident" id="6387758">fOmitEmpty</span>&nbsp;<span class="op" id="6387769">!=</span>&nbsp;<span class="num" id="6387772">0</span>&nbsp;<span class="op" id="6387774">&amp;&amp;</span>&nbsp;<span class="ident" id="6387777">isEmptyValue</span><span class="op" id="6387789">(</span><span class="ident" id="6387790">val</span><span class="op" id="6387793">)</span>&nbsp;<span class="op" id="6387795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387799">return</span>&nbsp;<span class="ident" id="6387806">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387815">//&nbsp;Drill&nbsp;into&nbsp;interfaces&nbsp;and&nbsp;pointers.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387855">//&nbsp;This&nbsp;can&nbsp;turn&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;given&nbsp;a&nbsp;cyclic&nbsp;chain,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387917">//&nbsp;but&nbsp;it&nbsp;matches&nbsp;the&nbsp;Go&nbsp;1&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387955">for</span>&nbsp;<span class="ident" id="6387959">val</span><span class="op" id="6387962">.</span><span class="ident" id="6387963">Kind</span><span class="op" id="6387967">(</span><span class="op" id="6387968">)</span>&nbsp;<span class="op" id="6387970">==</span>&nbsp;<span class="ident" id="6387973">reflect</span><span class="op" id="6387980">.</span><span class="ident" id="6387981">Interface</span>&nbsp;<span class="op" id="6387991">||</span>&nbsp;<span class="ident" id="6387994">val</span><span class="op" id="6387997">.</span><span class="ident" id="6387998">Kind</span><span class="op" id="6388002">(</span><span class="op" id="6388003">)</span>&nbsp;<span class="op" id="6388005">==</span>&nbsp;<span class="ident" id="6388008">reflect</span><span class="op" id="6388015">.</span><span class="ident" id="6388016">Ptr</span>&nbsp;<span class="op" id="6388020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388024">if</span>&nbsp;<span class="ident" id="6388027">val</span><span class="op" id="6388030">.</span><span class="ident" id="6388031">IsNil</span><span class="op" id="6388036">(</span><span class="op" id="6388037">)</span>&nbsp;<span class="op" id="6388039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388044">return</span>&nbsp;<span class="ident" id="6388051">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388061">val</span>&nbsp;<span class="op" id="6388065">=</span>&nbsp;<span class="ident" id="6388067">val</span><span class="op" id="6388070">.</span><span class="ident" id="6388071">Elem</span><span class="op" id="6388075">(</span><span class="op" id="6388076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388083">kind</span>&nbsp;<span class="op" id="6388088">:=</span>&nbsp;<span class="ident" id="6388091">val</span><span class="op" id="6388094">.</span><span class="ident" id="6388095">Kind</span><span class="op" id="6388099">(</span><span class="op" id="6388100">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388103">typ</span>&nbsp;<span class="op" id="6388107">:=</span>&nbsp;<span class="ident" id="6388110">val</span><span class="op" id="6388113">.</span><span class="ident" id="6388114">Type</span><span class="op" id="6388118">(</span><span class="op" id="6388119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388123">//&nbsp;Check&nbsp;for&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388148">if</span>&nbsp;<span class="ident" id="6388151">val</span><span class="op" id="6388154">.</span><span class="ident" id="6388155">CanInterface</span><span class="op" id="6388167">(</span><span class="op" id="6388168">)</span>&nbsp;<span class="op" id="6388170">&amp;&amp;</span>&nbsp;<span class="ident" id="6388173">typ</span><span class="op" id="6388176">.</span><span class="ident" id="6388177">Implements</span><span class="op" id="6388187">(</span><span class="ident" id="6388188">marshalerType</span><span class="op" id="6388201">)</span>&nbsp;<span class="op" id="6388203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388207">return</span>&nbsp;<span class="ident" id="6388214">p</span><span class="op" id="6388215">.</span><span class="ident" id="6388216">marshalInterface</span><span class="op" id="6388232">(</span><span class="ident" id="6388233">val</span><span class="op" id="6388236">.</span><span class="ident" id="6388237">Interface</span><span class="op" id="6388246">(</span><span class="op" id="6388247">)</span><span class="op" id="6388248">.</span><span class="op" id="6388249">(</span><span class="ident" id="6388250">Marshaler</span><span class="op" id="6388259">)</span><span class="op" id="6388260">,</span>&nbsp;<span class="ident" id="6388262">defaultStart</span><span class="op" id="6388274">(</span><span class="ident" id="6388275">typ</span><span class="op" id="6388278">,</span>&nbsp;<span class="ident" id="6388280">finfo</span><span class="op" id="6388285">,</span>&nbsp;<span class="ident" id="6388287">startTemplate</span><span class="op" id="6388300">)</span><span class="op" id="6388301">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388307">if</span>&nbsp;<span class="ident" id="6388310">val</span><span class="op" id="6388313">.</span><span class="ident" id="6388314">CanAddr</span><span class="op" id="6388321">(</span><span class="op" id="6388322">)</span>&nbsp;<span class="op" id="6388324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388328">pv</span>&nbsp;<span class="op" id="6388331">:=</span>&nbsp;<span class="ident" id="6388334">val</span><span class="op" id="6388337">.</span><span class="ident" id="6388338">Addr</span><span class="op" id="6388342">(</span><span class="op" id="6388343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388347">if</span>&nbsp;<span class="ident" id="6388350">pv</span><span class="op" id="6388352">.</span><span class="ident" id="6388353">CanInterface</span><span class="op" id="6388365">(</span><span class="op" id="6388366">)</span>&nbsp;<span class="op" id="6388368">&amp;&amp;</span>&nbsp;<span class="ident" id="6388371">pv</span><span class="op" id="6388373">.</span><span class="ident" id="6388374">Type</span><span class="op" id="6388378">(</span><span class="op" id="6388379">)</span><span class="op" id="6388380">.</span><span class="ident" id="6388381">Implements</span><span class="op" id="6388391">(</span><span class="ident" id="6388392">marshalerType</span><span class="op" id="6388405">)</span>&nbsp;<span class="op" id="6388407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388412">return</span>&nbsp;<span class="ident" id="6388419">p</span><span class="op" id="6388420">.</span><span class="ident" id="6388421">marshalInterface</span><span class="op" id="6388437">(</span><span class="ident" id="6388438">pv</span><span class="op" id="6388440">.</span><span class="ident" id="6388441">Interface</span><span class="op" id="6388450">(</span><span class="op" id="6388451">)</span><span class="op" id="6388452">.</span><span class="op" id="6388453">(</span><span class="ident" id="6388454">Marshaler</span><span class="op" id="6388463">)</span><span class="op" id="6388464">,</span>&nbsp;<span class="ident" id="6388466">defaultStart</span><span class="op" id="6388478">(</span><span class="ident" id="6388479">pv</span><span class="op" id="6388481">.</span><span class="ident" id="6388482">Type</span><span class="op" id="6388486">(</span><span class="op" id="6388487">)</span><span class="op" id="6388488">,</span>&nbsp;<span class="ident" id="6388490">finfo</span><span class="op" id="6388495">,</span>&nbsp;<span class="ident" id="6388497">startTemplate</span><span class="op" id="6388510">)</span><span class="op" id="6388511">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388522">//&nbsp;Check&nbsp;for&nbsp;text&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388552">if</span>&nbsp;<span class="ident" id="6388555">val</span><span class="op" id="6388558">.</span><span class="ident" id="6388559">CanInterface</span><span class="op" id="6388571">(</span><span class="op" id="6388572">)</span>&nbsp;<span class="op" id="6388574">&amp;&amp;</span>&nbsp;<span class="ident" id="6388577">typ</span><span class="op" id="6388580">.</span><span class="ident" id="6388581">Implements</span><span class="op" id="6388591">(</span><span class="ident" id="6388592">textMarshalerType</span><span class="op" id="6388609">)</span>&nbsp;<span class="op" id="6388611">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388615">return</span>&nbsp;<span class="ident" id="6388622">p</span><span class="op" id="6388623">.</span><span class="ident" id="6388624">marshalTextInterface</span><span class="op" id="6388644">(</span><span class="ident" id="6388645">val</span><span class="op" id="6388648">.</span><span class="ident" id="6388649">Interface</span><span class="op" id="6388658">(</span><span class="op" id="6388659">)</span><span class="op" id="6388660">.</span><span class="op" id="6388661">(</span><span class="ident" id="6388662">encoding</span><span class="op" id="6388670">.</span><span class="ident" id="6388671">TextMarshaler</span><span class="op" id="6388684">)</span><span class="op" id="6388685">,</span>&nbsp;<span class="ident" id="6388687">defaultStart</span><span class="op" id="6388699">(</span><span class="ident" id="6388700">typ</span><span class="op" id="6388703">,</span>&nbsp;<span class="ident" id="6388705">finfo</span><span class="op" id="6388710">,</span>&nbsp;<span class="ident" id="6388712">startTemplate</span><span class="op" id="6388725">)</span><span class="op" id="6388726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388732">if</span>&nbsp;<span class="ident" id="6388735">val</span><span class="op" id="6388738">.</span><span class="ident" id="6388739">CanAddr</span><span class="op" id="6388746">(</span><span class="op" id="6388747">)</span>&nbsp;<span class="op" id="6388749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388753">pv</span>&nbsp;<span class="op" id="6388756">:=</span>&nbsp;<span class="ident" id="6388759">val</span><span class="op" id="6388762">.</span><span class="ident" id="6388763">Addr</span><span class="op" id="6388767">(</span><span class="op" id="6388768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388772">if</span>&nbsp;<span class="ident" id="6388775">pv</span><span class="op" id="6388777">.</span><span class="ident" id="6388778">CanInterface</span><span class="op" id="6388790">(</span><span class="op" id="6388791">)</span>&nbsp;<span class="op" id="6388793">&amp;&amp;</span>&nbsp;<span class="ident" id="6388796">pv</span><span class="op" id="6388798">.</span><span class="ident" id="6388799">Type</span><span class="op" id="6388803">(</span><span class="op" id="6388804">)</span><span class="op" id="6388805">.</span><span class="ident" id="6388806">Implements</span><span class="op" id="6388816">(</span><span class="ident" id="6388817">textMarshalerType</span><span class="op" id="6388834">)</span>&nbsp;<span class="op" id="6388836">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388841">return</span>&nbsp;<span class="ident" id="6388848">p</span><span class="op" id="6388849">.</span><span class="ident" id="6388850">marshalTextInterface</span><span class="op" id="6388870">(</span><span class="ident" id="6388871">pv</span><span class="op" id="6388873">.</span><span class="ident" id="6388874">Interface</span><span class="op" id="6388883">(</span><span class="op" id="6388884">)</span><span class="op" id="6388885">.</span><span class="op" id="6388886">(</span><span class="ident" id="6388887">encoding</span><span class="op" id="6388895">.</span><span class="ident" id="6388896">TextMarshaler</span><span class="op" id="6388909">)</span><span class="op" id="6388910">,</span>&nbsp;<span class="ident" id="6388912">defaultStart</span><span class="op" id="6388924">(</span><span class="ident" id="6388925">pv</span><span class="op" id="6388927">.</span><span class="ident" id="6388928">Type</span><span class="op" id="6388932">(</span><span class="op" id="6388933">)</span><span class="op" id="6388934">,</span>&nbsp;<span class="ident" id="6388936">finfo</span><span class="op" id="6388941">,</span>&nbsp;<span class="ident" id="6388943">startTemplate</span><span class="op" id="6388956">)</span><span class="op" id="6388957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388968">//&nbsp;Slices&nbsp;and&nbsp;arrays&nbsp;iterate&nbsp;over&nbsp;the&nbsp;elements.&nbsp;They&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;enclosing&nbsp;tag.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389052">if</span>&nbsp;<span class="op" id="6389055">(</span><span class="ident" id="6389056">kind</span>&nbsp;<span class="op" id="6389061">==</span>&nbsp;<span class="ident" id="6389064">reflect</span><span class="op" id="6389071">.</span><span class="ident" id="6389072">Slice</span>&nbsp;<span class="op" id="6389078">||</span>&nbsp;<span class="ident" id="6389081">kind</span>&nbsp;<span class="op" id="6389086">==</span>&nbsp;<span class="ident" id="6389089">reflect</span><span class="op" id="6389096">.</span><span class="ident" id="6389097">Array</span><span class="op" id="6389102">)</span>&nbsp;<span class="op" id="6389104">&amp;&amp;</span>&nbsp;<span class="ident" id="6389107">typ</span><span class="op" id="6389110">.</span><span class="ident" id="6389111">Elem</span><span class="op" id="6389115">(</span><span class="op" id="6389116">)</span><span class="op" id="6389117">.</span><span class="ident" id="6389118">Kind</span><span class="op" id="6389122">(</span><span class="op" id="6389123">)</span>&nbsp;<span class="op" id="6389125">!=</span>&nbsp;<span class="ident" id="6389128">reflect</span><span class="op" id="6389135">.</span><span class="ident" id="6389136">Uint8</span>&nbsp;<span class="op" id="6389142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389146">for</span>&nbsp;<span class="ident" id="6389150">i</span><span class="op" id="6389151">,</span>&nbsp;<span class="ident" id="6389153">n</span>&nbsp;<span class="op" id="6389155">:=</span>&nbsp;<span class="num" id="6389158">0</span><span class="op" id="6389159">,</span>&nbsp;<span class="ident" id="6389161">val</span><span class="op" id="6389164">.</span><span class="ident" id="6389165">Len</span><span class="op" id="6389168">(</span><span class="op" id="6389169">)</span><span class="op" id="6389170">;</span>&nbsp;<span class="ident" id="6389172">i</span>&nbsp;<span class="op" id="6389174">&lt;</span>&nbsp;<span class="ident" id="6389176">n</span><span class="op" id="6389177">;</span>&nbsp;<span class="ident" id="6389179">i</span><span class="op" id="6389180">++</span>&nbsp;<span class="op" id="6389183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389188">if</span>&nbsp;<span class="ident" id="6389191">err</span>&nbsp;<span class="op" id="6389195">:=</span>&nbsp;<span class="ident" id="6389198">p</span><span class="op" id="6389199">.</span><span class="ident" id="6389200">marshalValue</span><span class="op" id="6389212">(</span><span class="ident" id="6389213">val</span><span class="op" id="6389216">.</span><span class="ident" id="6389217">Index</span><span class="op" id="6389222">(</span><span class="ident" id="6389223">i</span><span class="op" id="6389224">)</span><span class="op" id="6389225">,</span>&nbsp;<span class="ident" id="6389227">finfo</span><span class="op" id="6389232">,</span>&nbsp;<span class="ident" id="6389234">startTemplate</span><span class="op" id="6389247">)</span><span class="op" id="6389248">;</span>&nbsp;<span class="ident" id="6389250">err</span>&nbsp;<span class="op" id="6389254">!=</span>&nbsp;<span class="ident" id="6389257">nil</span>&nbsp;<span class="op" id="6389261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389267">return</span>&nbsp;<span class="ident" id="6389274">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389281">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389289">return</span>&nbsp;<span class="ident" id="6389296">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389305">tinfo</span><span class="op" id="6389310">,</span>&nbsp;<span class="ident" id="6389312">err</span>&nbsp;<span class="op" id="6389316">:=</span>&nbsp;<span class="ident" id="6389319">getTypeInfo</span><span class="op" id="6389330">(</span><span class="ident" id="6389331">typ</span><span class="op" id="6389334">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389337">if</span>&nbsp;<span class="ident" id="6389340">err</span>&nbsp;<span class="op" id="6389344">!=</span>&nbsp;<span class="ident" id="6389347">nil</span>&nbsp;<span class="op" id="6389351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389355">return</span>&nbsp;<span class="ident" id="6389362">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389371">//&nbsp;Create&nbsp;start&nbsp;element.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389397">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389441">//&nbsp;0.&nbsp;startTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389462">//&nbsp;1.&nbsp;XMLName&nbsp;field&nbsp;in&nbsp;underlying&nbsp;struct;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389505">//&nbsp;2.&nbsp;field&nbsp;name/tag&nbsp;in&nbsp;the&nbsp;struct&nbsp;field;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389552">//&nbsp;3.&nbsp;type&nbsp;name</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389569">var</span>&nbsp;<span class="ident" id="6389573">start</span>&nbsp;<span class="ident" id="6389579">StartElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389594">if</span>&nbsp;<span class="ident" id="6389597">startTemplate</span>&nbsp;<span class="op" id="6389611">!=</span>&nbsp;<span class="ident" id="6389614">nil</span>&nbsp;<span class="op" id="6389618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389622">start</span><span class="op" id="6389627">.</span><span class="ident" id="6389628">Name</span>&nbsp;<span class="op" id="6389633">=</span>&nbsp;<span class="ident" id="6389635">startTemplate</span><span class="op" id="6389648">.</span><span class="ident" id="6389649">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389656">start</span><span class="op" id="6389661">.</span><span class="ident" id="6389662">Attr</span>&nbsp;<span class="op" id="6389667">=</span>&nbsp;<span class="builtinfunc" id="6389669">append</span><span class="op" id="6389675">(</span><span class="ident" id="6389676">start</span><span class="op" id="6389681">.</span><span class="ident" id="6389682">Attr</span><span class="op" id="6389686">,</span>&nbsp;<span class="ident" id="6389688">startTemplate</span><span class="op" id="6389701">.</span><span class="ident" id="6389702">Attr</span><span class="op" id="6389706">...</span><span class="op" id="6389709">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389712">}</span>&nbsp;<span class="keyword" id="6389714">else</span>&nbsp;<span class="keyword" id="6389719">if</span>&nbsp;<span class="ident" id="6389722">tinfo</span><span class="op" id="6389727">.</span><span class="ident" id="6389728">xmlname</span>&nbsp;<span class="op" id="6389736">!=</span>&nbsp;<span class="ident" id="6389739">nil</span>&nbsp;<span class="op" id="6389743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389747">xmlname</span>&nbsp;<span class="op" id="6389755">:=</span>&nbsp;<span class="ident" id="6389758">tinfo</span><span class="op" id="6389763">.</span><span class="ident" id="6389764">xmlname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389774">if</span>&nbsp;<span class="ident" id="6389777">xmlname</span><span class="op" id="6389784">.</span><span class="ident" id="6389785">name</span>&nbsp;<span class="op" id="6389790">!=</span>&nbsp;<span class="string" id="6389793">&#34;&#34;</span>&nbsp;<span class="op" id="6389796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389801">start</span><span class="op" id="6389806">.</span><span class="ident" id="6389807">Name</span><span class="op" id="6389811">.</span><span class="ident" id="6389812">Space</span><span class="op" id="6389817">,</span>&nbsp;<span class="ident" id="6389819">start</span><span class="op" id="6389824">.</span><span class="ident" id="6389825">Name</span><span class="op" id="6389829">.</span><span class="ident" id="6389830">Local</span>&nbsp;<span class="op" id="6389836">=</span>&nbsp;<span class="ident" id="6389838">xmlname</span><span class="op" id="6389845">.</span><span class="ident" id="6389846">xmlns</span><span class="op" id="6389851">,</span>&nbsp;<span class="ident" id="6389853">xmlname</span><span class="op" id="6389860">.</span><span class="ident" id="6389861">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389868">}</span>&nbsp;<span class="keyword" id="6389870">else</span>&nbsp;<span class="keyword" id="6389875">if</span>&nbsp;<span class="ident" id="6389878">v</span><span class="op" id="6389879">,</span>&nbsp;<span class="ident" id="6389881">ok</span>&nbsp;<span class="op" id="6389884">:=</span>&nbsp;<span class="ident" id="6389887">xmlname</span><span class="op" id="6389894">.</span><span class="ident" id="6389895">value</span><span class="op" id="6389900">(</span><span class="ident" id="6389901">val</span><span class="op" id="6389904">)</span><span class="op" id="6389905">.</span><span class="ident" id="6389906">Interface</span><span class="op" id="6389915">(</span><span class="op" id="6389916">)</span><span class="op" id="6389917">.</span><span class="op" id="6389918">(</span><span class="ident" id="6389919">Name</span><span class="op" id="6389923">)</span><span class="op" id="6389924">;</span>&nbsp;<span class="ident" id="6389926">ok</span>&nbsp;<span class="op" id="6389929">&amp;&amp;</span>&nbsp;<span class="ident" id="6389932">v</span><span class="op" id="6389933">.</span><span class="ident" id="6389934">Local</span>&nbsp;<span class="op" id="6389940">!=</span>&nbsp;<span class="string" id="6389943">&#34;&#34;</span>&nbsp;<span class="op" id="6389946">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389951">start</span><span class="op" id="6389956">.</span><span class="ident" id="6389957">Name</span>&nbsp;<span class="op" id="6389962">=</span>&nbsp;<span class="ident" id="6389964">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389974">if</span>&nbsp;<span class="ident" id="6389977">start</span><span class="op" id="6389982">.</span><span class="ident" id="6389983">Name</span><span class="op" id="6389987">.</span><span class="ident" id="6389988">Local</span>&nbsp;<span class="op" id="6389994">==</span>&nbsp;<span class="string" id="6389997">&#34;&#34;</span>&nbsp;<span class="op" id="6390000">&amp;&amp;</span>&nbsp;<span class="ident" id="6390003">finfo</span>&nbsp;<span class="op" id="6390009">!=</span>&nbsp;<span class="ident" id="6390012">nil</span>&nbsp;<span class="op" id="6390016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390020">start</span><span class="op" id="6390025">.</span><span class="ident" id="6390026">Name</span><span class="op" id="6390030">.</span><span class="ident" id="6390031">Space</span><span class="op" id="6390036">,</span>&nbsp;<span class="ident" id="6390038">start</span><span class="op" id="6390043">.</span><span class="ident" id="6390044">Name</span><span class="op" id="6390048">.</span><span class="ident" id="6390049">Local</span>&nbsp;<span class="op" id="6390055">=</span>&nbsp;<span class="ident" id="6390057">finfo</span><span class="op" id="6390062">.</span><span class="ident" id="6390063">xmlns</span><span class="op" id="6390068">,</span>&nbsp;<span class="ident" id="6390070">finfo</span><span class="op" id="6390075">.</span><span class="ident" id="6390076">name</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390085">if</span>&nbsp;<span class="ident" id="6390088">start</span><span class="op" id="6390093">.</span><span class="ident" id="6390094">Name</span><span class="op" id="6390098">.</span><span class="ident" id="6390099">Local</span>&nbsp;<span class="op" id="6390105">==</span>&nbsp;<span class="string" id="6390108">&#34;&#34;</span>&nbsp;<span class="op" id="6390111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390115">name</span>&nbsp;<span class="op" id="6390120">:=</span>&nbsp;<span class="ident" id="6390123">typ</span><span class="op" id="6390126">.</span><span class="ident" id="6390127">Name</span><span class="op" id="6390131">(</span><span class="op" id="6390132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390136">if</span>&nbsp;<span class="ident" id="6390139">name</span>&nbsp;<span class="op" id="6390144">==</span>&nbsp;<span class="string" id="6390147">&#34;&#34;</span>&nbsp;<span class="op" id="6390150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390155">return</span>&nbsp;<span class="op" id="6390162">&amp;</span><span class="ident" id="6390163">UnsupportedTypeError</span><span class="op" id="6390183">{</span><span class="ident" id="6390184">typ</span><span class="op" id="6390187">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390195">start</span><span class="op" id="6390200">.</span><span class="ident" id="6390201">Name</span><span class="op" id="6390205">.</span><span class="ident" id="6390206">Local</span>&nbsp;<span class="op" id="6390212">=</span>&nbsp;<span class="ident" id="6390214">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390224">//&nbsp;Attributes</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390239">for</span>&nbsp;<span class="ident" id="6390243">i</span>&nbsp;<span class="op" id="6390245">:=</span>&nbsp;<span class="keyword" id="6390248">range</span>&nbsp;<span class="ident" id="6390254">tinfo</span><span class="op" id="6390259">.</span><span class="ident" id="6390260">fields</span>&nbsp;<span class="op" id="6390267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390271">finfo</span>&nbsp;<span class="op" id="6390277">:=</span>&nbsp;<span class="op" id="6390280">&amp;</span><span class="ident" id="6390281">tinfo</span><span class="op" id="6390286">.</span><span class="ident" id="6390287">fields</span><span class="op" id="6390293">[</span><span class="ident" id="6390294">i</span><span class="op" id="6390295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390299">if</span>&nbsp;<span class="ident" id="6390302">finfo</span><span class="op" id="6390307">.</span><span class="ident" id="6390308">flags</span><span class="op" id="6390313">&amp;</span><span class="ident" id="6390314">fAttr</span>&nbsp;<span class="op" id="6390320">==</span>&nbsp;<span class="num" id="6390323">0</span>&nbsp;<span class="op" id="6390325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390330">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390341">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390345">fv</span>&nbsp;<span class="op" id="6390348">:=</span>&nbsp;<span class="ident" id="6390351">finfo</span><span class="op" id="6390356">.</span><span class="ident" id="6390357">value</span><span class="op" id="6390362">(</span><span class="ident" id="6390363">val</span><span class="op" id="6390366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390370">name</span>&nbsp;<span class="op" id="6390375">:=</span>&nbsp;<span class="ident" id="6390378">Name</span><span class="op" id="6390382">{</span><span class="ident" id="6390383">Space</span><span class="op" id="6390388">:</span>&nbsp;<span class="ident" id="6390390">finfo</span><span class="op" id="6390395">.</span><span class="ident" id="6390396">xmlns</span><span class="op" id="6390401">,</span>&nbsp;<span class="ident" id="6390403">Local</span><span class="op" id="6390408">:</span>&nbsp;<span class="ident" id="6390410">finfo</span><span class="op" id="6390415">.</span><span class="ident" id="6390416">name</span><span class="op" id="6390420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390425">if</span>&nbsp;<span class="ident" id="6390428">finfo</span><span class="op" id="6390433">.</span><span class="ident" id="6390434">flags</span><span class="op" id="6390439">&amp;</span><span class="ident" id="6390440">fOmitEmpty</span>&nbsp;<span class="op" id="6390451">!=</span>&nbsp;<span class="num" id="6390454">0</span>&nbsp;<span class="op" id="6390456">&amp;&amp;</span>&nbsp;<span class="ident" id="6390459">isEmptyValue</span><span class="op" id="6390471">(</span><span class="ident" id="6390472">fv</span><span class="op" id="6390474">)</span>&nbsp;<span class="op" id="6390476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390481">continue</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390497">if</span>&nbsp;<span class="ident" id="6390500">fv</span><span class="op" id="6390502">.</span><span class="ident" id="6390503">Kind</span><span class="op" id="6390507">(</span><span class="op" id="6390508">)</span>&nbsp;<span class="op" id="6390510">==</span>&nbsp;<span class="ident" id="6390513">reflect</span><span class="op" id="6390520">.</span><span class="ident" id="6390521">Interface</span>&nbsp;<span class="op" id="6390531">&amp;&amp;</span>&nbsp;<span class="ident" id="6390534">fv</span><span class="op" id="6390536">.</span><span class="ident" id="6390537">IsNil</span><span class="op" id="6390542">(</span><span class="op" id="6390543">)</span>&nbsp;<span class="op" id="6390545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390550">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390561">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390566">if</span>&nbsp;<span class="ident" id="6390569">fv</span><span class="op" id="6390571">.</span><span class="ident" id="6390572">CanInterface</span><span class="op" id="6390584">(</span><span class="op" id="6390585">)</span>&nbsp;<span class="op" id="6390587">&amp;&amp;</span>&nbsp;<span class="ident" id="6390590">fv</span><span class="op" id="6390592">.</span><span class="ident" id="6390593">Type</span><span class="op" id="6390597">(</span><span class="op" id="6390598">)</span><span class="op" id="6390599">.</span><span class="ident" id="6390600">Implements</span><span class="op" id="6390610">(</span><span class="ident" id="6390611">marshalerAttrType</span><span class="op" id="6390628">)</span>&nbsp;<span class="op" id="6390630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390635">attr</span><span class="op" id="6390639">,</span>&nbsp;<span class="ident" id="6390641">err</span>&nbsp;<span class="op" id="6390645">:=</span>&nbsp;<span class="ident" id="6390648">fv</span><span class="op" id="6390650">.</span><span class="ident" id="6390651">Interface</span><span class="op" id="6390660">(</span><span class="op" id="6390661">)</span><span class="op" id="6390662">.</span><span class="op" id="6390663">(</span><span class="ident" id="6390664">MarshalerAttr</span><span class="op" id="6390677">)</span><span class="op" id="6390678">.</span><span class="ident" id="6390679">MarshalXMLAttr</span><span class="op" id="6390693">(</span><span class="ident" id="6390694">name</span><span class="op" id="6390698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390703">if</span>&nbsp;<span class="ident" id="6390706">err</span>&nbsp;<span class="op" id="6390710">!=</span>&nbsp;<span class="ident" id="6390713">nil</span>&nbsp;<span class="op" id="6390717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390723">return</span>&nbsp;<span class="ident" id="6390730">err</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390742">if</span>&nbsp;<span class="ident" id="6390745">attr</span><span class="op" id="6390749">.</span><span class="ident" id="6390750">Name</span><span class="op" id="6390754">.</span><span class="ident" id="6390755">Local</span>&nbsp;<span class="op" id="6390761">!=</span>&nbsp;<span class="string" id="6390764">&#34;&#34;</span>&nbsp;<span class="op" id="6390767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390773">start</span><span class="op" id="6390778">.</span><span class="ident" id="6390779">Attr</span>&nbsp;<span class="op" id="6390784">=</span>&nbsp;<span class="builtinfunc" id="6390786">append</span><span class="op" id="6390792">(</span><span class="ident" id="6390793">start</span><span class="op" id="6390798">.</span><span class="ident" id="6390799">Attr</span><span class="op" id="6390803">,</span>&nbsp;<span class="ident" id="6390805">attr</span><span class="op" id="6390809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390819">continue</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390835">if</span>&nbsp;<span class="ident" id="6390838">fv</span><span class="op" id="6390840">.</span><span class="ident" id="6390841">CanAddr</span><span class="op" id="6390848">(</span><span class="op" id="6390849">)</span>&nbsp;<span class="op" id="6390851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390856">pv</span>&nbsp;<span class="op" id="6390859">:=</span>&nbsp;<span class="ident" id="6390862">fv</span><span class="op" id="6390864">.</span><span class="ident" id="6390865">Addr</span><span class="op" id="6390869">(</span><span class="op" id="6390870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390875">if</span>&nbsp;<span class="ident" id="6390878">pv</span><span class="op" id="6390880">.</span><span class="ident" id="6390881">CanInterface</span><span class="op" id="6390893">(</span><span class="op" id="6390894">)</span>&nbsp;<span class="op" id="6390896">&amp;&amp;</span>&nbsp;<span class="ident" id="6390899">pv</span><span class="op" id="6390901">.</span><span class="ident" id="6390902">Type</span><span class="op" id="6390906">(</span><span class="op" id="6390907">)</span><span class="op" id="6390908">.</span><span class="ident" id="6390909">Implements</span><span class="op" id="6390919">(</span><span class="ident" id="6390920">marshalerAttrType</span><span class="op" id="6390937">)</span>&nbsp;<span class="op" id="6390939">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390945">attr</span><span class="op" id="6390949">,</span>&nbsp;<span class="ident" id="6390951">err</span>&nbsp;<span class="op" id="6390955">:=</span>&nbsp;<span class="ident" id="6390958">pv</span><span class="op" id="6390960">.</span><span class="ident" id="6390961">Interface</span><span class="op" id="6390970">(</span><span class="op" id="6390971">)</span><span class="op" id="6390972">.</span><span class="op" id="6390973">(</span><span class="ident" id="6390974">MarshalerAttr</span><span class="op" id="6390987">)</span><span class="op" id="6390988">.</span><span class="ident" id="6390989">MarshalXMLAttr</span><span class="op" id="6391003">(</span><span class="ident" id="6391004">name</span><span class="op" id="6391008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391014">if</span>&nbsp;<span class="ident" id="6391017">err</span>&nbsp;<span class="op" id="6391021">!=</span>&nbsp;<span class="ident" id="6391024">nil</span>&nbsp;<span class="op" id="6391028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391035">return</span>&nbsp;<span class="ident" id="6391042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391056">if</span>&nbsp;<span class="ident" id="6391059">attr</span><span class="op" id="6391063">.</span><span class="ident" id="6391064">Name</span><span class="op" id="6391068">.</span><span class="ident" id="6391069">Local</span>&nbsp;<span class="op" id="6391075">!=</span>&nbsp;<span class="string" id="6391078">&#34;&#34;</span>&nbsp;<span class="op" id="6391081">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391088">start</span><span class="op" id="6391093">.</span><span class="ident" id="6391094">Attr</span>&nbsp;<span class="op" id="6391099">=</span>&nbsp;<span class="builtinfunc" id="6391101">append</span><span class="op" id="6391107">(</span><span class="ident" id="6391108">start</span><span class="op" id="6391113">.</span><span class="ident" id="6391114">Attr</span><span class="op" id="6391118">,</span>&nbsp;<span class="ident" id="6391120">attr</span><span class="op" id="6391124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391136">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391152">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391157">if</span>&nbsp;<span class="ident" id="6391160">fv</span><span class="op" id="6391162">.</span><span class="ident" id="6391163">CanInterface</span><span class="op" id="6391175">(</span><span class="op" id="6391176">)</span>&nbsp;<span class="op" id="6391178">&amp;&amp;</span>&nbsp;<span class="ident" id="6391181">fv</span><span class="op" id="6391183">.</span><span class="ident" id="6391184">Type</span><span class="op" id="6391188">(</span><span class="op" id="6391189">)</span><span class="op" id="6391190">.</span><span class="ident" id="6391191">Implements</span><span class="op" id="6391201">(</span><span class="ident" id="6391202">textMarshalerType</span><span class="op" id="6391219">)</span>&nbsp;<span class="op" id="6391221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391226">text</span><span class="op" id="6391230">,</span>&nbsp;<span class="ident" id="6391232">err</span>&nbsp;<span class="op" id="6391236">:=</span>&nbsp;<span class="ident" id="6391239">fv</span><span class="op" id="6391241">.</span><span class="ident" id="6391242">Interface</span><span class="op" id="6391251">(</span><span class="op" id="6391252">)</span><span class="op" id="6391253">.</span><span class="op" id="6391254">(</span><span class="ident" id="6391255">encoding</span><span class="op" id="6391263">.</span><span class="ident" id="6391264">TextMarshaler</span><span class="op" id="6391277">)</span><span class="op" id="6391278">.</span><span class="ident" id="6391279">MarshalText</span><span class="op" id="6391290">(</span><span class="op" id="6391291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391296">if</span>&nbsp;<span class="ident" id="6391299">err</span>&nbsp;<span class="op" id="6391303">!=</span>&nbsp;<span class="ident" id="6391306">nil</span>&nbsp;<span class="op" id="6391310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391316">return</span>&nbsp;<span class="ident" id="6391323">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391335">start</span><span class="op" id="6391340">.</span><span class="ident" id="6391341">Attr</span>&nbsp;<span class="op" id="6391346">=</span>&nbsp;<span class="builtinfunc" id="6391348">append</span><span class="op" id="6391354">(</span><span class="ident" id="6391355">start</span><span class="op" id="6391360">.</span><span class="ident" id="6391361">Attr</span><span class="op" id="6391365">,</span>&nbsp;<span class="ident" id="6391367">Attr</span><span class="op" id="6391371">{</span><span class="ident" id="6391372">name</span><span class="op" id="6391376">,</span>&nbsp;<span class="builtintype" id="6391378">string</span><span class="op" id="6391384">(</span><span class="ident" id="6391385">text</span><span class="op" id="6391389">)</span><span class="op" id="6391390">}</span><span class="op" id="6391391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391396">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391412">if</span>&nbsp;<span class="ident" id="6391415">fv</span><span class="op" id="6391417">.</span><span class="ident" id="6391418">CanAddr</span><span class="op" id="6391425">(</span><span class="op" id="6391426">)</span>&nbsp;<span class="op" id="6391428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391433">pv</span>&nbsp;<span class="op" id="6391436">:=</span>&nbsp;<span class="ident" id="6391439">fv</span><span class="op" id="6391441">.</span><span class="ident" id="6391442">Addr</span><span class="op" id="6391446">(</span><span class="op" id="6391447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391452">if</span>&nbsp;<span class="ident" id="6391455">pv</span><span class="op" id="6391457">.</span><span class="ident" id="6391458">CanInterface</span><span class="op" id="6391470">(</span><span class="op" id="6391471">)</span>&nbsp;<span class="op" id="6391473">&amp;&amp;</span>&nbsp;<span class="ident" id="6391476">pv</span><span class="op" id="6391478">.</span><span class="ident" id="6391479">Type</span><span class="op" id="6391483">(</span><span class="op" id="6391484">)</span><span class="op" id="6391485">.</span><span class="ident" id="6391486">Implements</span><span class="op" id="6391496">(</span><span class="ident" id="6391497">textMarshalerType</span><span class="op" id="6391514">)</span>&nbsp;<span class="op" id="6391516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391522">text</span><span class="op" id="6391526">,</span>&nbsp;<span class="ident" id="6391528">err</span>&nbsp;<span class="op" id="6391532">:=</span>&nbsp;<span class="ident" id="6391535">pv</span><span class="op" id="6391537">.</span><span class="ident" id="6391538">Interface</span><span class="op" id="6391547">(</span><span class="op" id="6391548">)</span><span class="op" id="6391549">.</span><span class="op" id="6391550">(</span><span class="ident" id="6391551">encoding</span><span class="op" id="6391559">.</span><span class="ident" id="6391560">TextMarshaler</span><span class="op" id="6391573">)</span><span class="op" id="6391574">.</span><span class="ident" id="6391575">MarshalText</span><span class="op" id="6391586">(</span><span class="op" id="6391587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391593">if</span>&nbsp;<span class="ident" id="6391596">err</span>&nbsp;<span class="op" id="6391600">!=</span>&nbsp;<span class="ident" id="6391603">nil</span>&nbsp;<span class="op" id="6391607">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391614">return</span>&nbsp;<span class="ident" id="6391621">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391635">start</span><span class="op" id="6391640">.</span><span class="ident" id="6391641">Attr</span>&nbsp;<span class="op" id="6391646">=</span>&nbsp;<span class="builtinfunc" id="6391648">append</span><span class="op" id="6391654">(</span><span class="ident" id="6391655">start</span><span class="op" id="6391660">.</span><span class="ident" id="6391661">Attr</span><span class="op" id="6391665">,</span>&nbsp;<span class="ident" id="6391667">Attr</span><span class="op" id="6391671">{</span><span class="ident" id="6391672">name</span><span class="op" id="6391676">,</span>&nbsp;<span class="builtintype" id="6391678">string</span><span class="op" id="6391684">(</span><span class="ident" id="6391685">text</span><span class="op" id="6391689">)</span><span class="op" id="6391690">}</span><span class="op" id="6391691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391697">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391709">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391718">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391774">switch</span>&nbsp;<span class="ident" id="6391781">fv</span><span class="op" id="6391783">.</span><span class="ident" id="6391784">Kind</span><span class="op" id="6391788">(</span><span class="op" id="6391789">)</span>&nbsp;<span class="op" id="6391791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391795">case</span>&nbsp;<span class="ident" id="6391800">reflect</span><span class="op" id="6391807">.</span><span class="ident" id="6391808">Ptr</span><span class="op" id="6391811">,</span>&nbsp;<span class="ident" id="6391813">reflect</span><span class="op" id="6391820">.</span><span class="ident" id="6391821">Interface</span><span class="op" id="6391830">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391835">if</span>&nbsp;<span class="ident" id="6391838">fv</span><span class="op" id="6391840">.</span><span class="ident" id="6391841">IsNil</span><span class="op" id="6391846">(</span><span class="op" id="6391847">)</span>&nbsp;<span class="op" id="6391849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391855">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391872">fv</span>&nbsp;<span class="op" id="6391875">=</span>&nbsp;<span class="ident" id="6391877">fv</span><span class="op" id="6391879">.</span><span class="ident" id="6391880">Elem</span><span class="op" id="6391884">(</span><span class="op" id="6391885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391889">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391894">s</span><span class="op" id="6391895">,</span>&nbsp;<span class="ident" id="6391897">b</span><span class="op" id="6391898">,</span>&nbsp;<span class="ident" id="6391900">err</span>&nbsp;<span class="op" id="6391904">:=</span>&nbsp;<span class="ident" id="6391907">p</span><span class="op" id="6391908">.</span><span class="ident" id="6391909">marshalSimple</span><span class="op" id="6391922">(</span><span class="ident" id="6391923">fv</span><span class="op" id="6391925">.</span><span class="ident" id="6391926">Type</span><span class="op" id="6391930">(</span><span class="op" id="6391931">)</span><span class="op" id="6391932">,</span>&nbsp;<span class="ident" id="6391934">fv</span><span class="op" id="6391936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391940">if</span>&nbsp;<span class="ident" id="6391943">err</span>&nbsp;<span class="op" id="6391947">!=</span>&nbsp;<span class="ident" id="6391950">nil</span>&nbsp;<span class="op" id="6391954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391959">return</span>&nbsp;<span class="ident" id="6391966">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391972">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391976">if</span>&nbsp;<span class="ident" id="6391979">b</span>&nbsp;<span class="op" id="6391981">!=</span>&nbsp;<span class="ident" id="6391984">nil</span>&nbsp;<span class="op" id="6391988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391993">s</span>&nbsp;<span class="op" id="6391995">=</span>&nbsp;<span class="builtintype" id="6391997">string</span><span class="op" id="6392003">(</span><span class="ident" id="6392004">b</span><span class="op" id="6392005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392013">start</span><span class="op" id="6392018">.</span><span class="ident" id="6392019">Attr</span>&nbsp;<span class="op" id="6392024">=</span>&nbsp;<span class="builtinfunc" id="6392026">append</span><span class="op" id="6392032">(</span><span class="ident" id="6392033">start</span><span class="op" id="6392038">.</span><span class="ident" id="6392039">Attr</span><span class="op" id="6392043">,</span>&nbsp;<span class="ident" id="6392045">Attr</span><span class="op" id="6392049">{</span><span class="ident" id="6392050">name</span><span class="op" id="6392054">,</span>&nbsp;<span class="ident" id="6392056">s</span><span class="op" id="6392057">}</span><span class="op" id="6392058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392061">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392065">if</span>&nbsp;<span class="ident" id="6392068">err</span>&nbsp;<span class="op" id="6392072">:=</span>&nbsp;<span class="ident" id="6392075">p</span><span class="op" id="6392076">.</span><span class="ident" id="6392077">writeStart</span><span class="op" id="6392087">(</span><span class="op" id="6392088">&amp;</span><span class="ident" id="6392089">start</span><span class="op" id="6392094">)</span><span class="op" id="6392095">;</span>&nbsp;<span class="ident" id="6392097">err</span>&nbsp;<span class="op" id="6392101">!=</span>&nbsp;<span class="ident" id="6392104">nil</span>&nbsp;<span class="op" id="6392108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392112">return</span>&nbsp;<span class="ident" id="6392119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392128">if</span>&nbsp;<span class="ident" id="6392131">val</span><span class="op" id="6392134">.</span><span class="ident" id="6392135">Kind</span><span class="op" id="6392139">(</span><span class="op" id="6392140">)</span>&nbsp;<span class="op" id="6392142">==</span>&nbsp;<span class="ident" id="6392145">reflect</span><span class="op" id="6392152">.</span><span class="ident" id="6392153">Struct</span>&nbsp;<span class="op" id="6392160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392164">err</span>&nbsp;<span class="op" id="6392168">=</span>&nbsp;<span class="ident" id="6392170">p</span><span class="op" id="6392171">.</span><span class="ident" id="6392172">marshalStruct</span><span class="op" id="6392185">(</span><span class="ident" id="6392186">tinfo</span><span class="op" id="6392191">,</span>&nbsp;<span class="ident" id="6392193">val</span><span class="op" id="6392196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392199">}</span>&nbsp;<span class="keyword" id="6392201">else</span>&nbsp;<span class="op" id="6392206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392210">s</span><span class="op" id="6392211">,</span>&nbsp;<span class="ident" id="6392213">b</span><span class="op" id="6392214">,</span>&nbsp;<span class="ident" id="6392216">err1</span>&nbsp;<span class="op" id="6392221">:=</span>&nbsp;<span class="ident" id="6392224">p</span><span class="op" id="6392225">.</span><span class="ident" id="6392226">marshalSimple</span><span class="op" id="6392239">(</span><span class="ident" id="6392240">typ</span><span class="op" id="6392243">,</span>&nbsp;<span class="ident" id="6392245">val</span><span class="op" id="6392248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392252">if</span>&nbsp;<span class="ident" id="6392255">err1</span>&nbsp;<span class="op" id="6392260">!=</span>&nbsp;<span class="ident" id="6392263">nil</span>&nbsp;<span class="op" id="6392267">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392272">err</span>&nbsp;<span class="op" id="6392276">=</span>&nbsp;<span class="ident" id="6392278">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392285">}</span>&nbsp;<span class="keyword" id="6392287">else</span>&nbsp;<span class="keyword" id="6392292">if</span>&nbsp;<span class="ident" id="6392295">b</span>&nbsp;<span class="op" id="6392297">!=</span>&nbsp;<span class="ident" id="6392300">nil</span>&nbsp;<span class="op" id="6392304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392309">EscapeText</span><span class="op" id="6392319">(</span><span class="ident" id="6392320">p</span><span class="op" id="6392321">,</span>&nbsp;<span class="ident" id="6392323">b</span><span class="op" id="6392324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392328">}</span>&nbsp;<span class="keyword" id="6392330">else</span>&nbsp;<span class="op" id="6392335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392340">p</span><span class="op" id="6392341">.</span><span class="ident" id="6392342">EscapeString</span><span class="op" id="6392354">(</span><span class="ident" id="6392355">s</span><span class="op" id="6392356">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392366">if</span>&nbsp;<span class="ident" id="6392369">err</span>&nbsp;<span class="op" id="6392373">!=</span>&nbsp;<span class="ident" id="6392376">nil</span>&nbsp;<span class="op" id="6392380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392384">return</span>&nbsp;<span class="ident" id="6392391">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392396">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392400">if</span>&nbsp;<span class="ident" id="6392403">err</span>&nbsp;<span class="op" id="6392407">:=</span>&nbsp;<span class="ident" id="6392410">p</span><span class="op" id="6392411">.</span><span class="ident" id="6392412">writeEnd</span><span class="op" id="6392420">(</span><span class="ident" id="6392421">start</span><span class="op" id="6392426">.</span><span class="ident" id="6392427">Name</span><span class="op" id="6392431">)</span><span class="op" id="6392432">;</span>&nbsp;<span class="ident" id="6392434">err</span>&nbsp;<span class="op" id="6392438">!=</span>&nbsp;<span class="ident" id="6392441">nil</span>&nbsp;<span class="op" id="6392445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392449">return</span>&nbsp;<span class="ident" id="6392456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392465">return</span>&nbsp;<span class="ident" id="6392472">p</span><span class="op" id="6392473">.</span><span class="ident" id="6392474">cachedWriteError</span><span class="op" id="6392490">(</span><span class="op" id="6392491">)</span><br>
<span class="lineno"></span><span class="op" id="6392493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392496">//&nbsp;defaultStart&nbsp;returns&nbsp;the&nbsp;default&nbsp;start&nbsp;element&nbsp;to&nbsp;use,</span><br>
<span class="lineno"></span><span class="comment" id="6392554">//&nbsp;given&nbsp;the&nbsp;reflect&nbsp;type,&nbsp;field&nbsp;info,&nbsp;and&nbsp;start&nbsp;template.</span><br>
<span class="lineno">555</span><span class="keyword" id="6392613">func</span>&nbsp;<span class="ident" id="6392618">defaultStart</span><span class="op" id="6392630">(</span><span class="ident" id="6392631">typ</span>&nbsp;<span class="ident" id="6392635">reflect</span><span class="op" id="6392642">.</span><span class="ident" id="6392643">Type</span><span class="op" id="6392647">,</span>&nbsp;<span class="ident" id="6392649">finfo</span>&nbsp;<span class="op" id="6392655">*</span><span class="ident" id="6392656">fieldInfo</span><span class="op" id="6392665">,</span>&nbsp;<span class="ident" id="6392667">startTemplate</span>&nbsp;<span class="op" id="6392681">*</span><span class="ident" id="6392682">StartElement</span><span class="op" id="6392694">)</span>&nbsp;<span class="ident" id="6392696">StartElement</span>&nbsp;<span class="op" id="6392709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392712">var</span>&nbsp;<span class="ident" id="6392716">start</span>&nbsp;<span class="ident" id="6392722">StartElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392736">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is&nbsp;as&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392789">//&nbsp;except&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;look&nbsp;inside&nbsp;structs&nbsp;for&nbsp;the&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392856">if</span>&nbsp;<span class="ident" id="6392859">startTemplate</span>&nbsp;<span class="op" id="6392873">!=</span>&nbsp;<span class="ident" id="6392876">nil</span>&nbsp;<span class="op" id="6392880">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392884">start</span><span class="op" id="6392889">.</span><span class="ident" id="6392890">Name</span>&nbsp;<span class="op" id="6392895">=</span>&nbsp;<span class="ident" id="6392897">startTemplate</span><span class="op" id="6392910">.</span><span class="ident" id="6392911">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392918">start</span><span class="op" id="6392923">.</span><span class="ident" id="6392924">Attr</span>&nbsp;<span class="op" id="6392929">=</span>&nbsp;<span class="builtinfunc" id="6392931">append</span><span class="op" id="6392937">(</span><span class="ident" id="6392938">start</span><span class="op" id="6392943">.</span><span class="ident" id="6392944">Attr</span><span class="op" id="6392948">,</span>&nbsp;<span class="ident" id="6392950">startTemplate</span><span class="op" id="6392963">.</span><span class="ident" id="6392964">Attr</span><span class="op" id="6392968">...</span><span class="op" id="6392971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392974">}</span>&nbsp;<span class="keyword" id="6392976">else</span>&nbsp;<span class="keyword" id="6392981">if</span>&nbsp;<span class="ident" id="6392984">finfo</span>&nbsp;<span class="op" id="6392990">!=</span>&nbsp;<span class="ident" id="6392993">nil</span>&nbsp;<span class="op" id="6392997">&amp;&amp;</span>&nbsp;<span class="ident" id="6393000">finfo</span><span class="op" id="6393005">.</span><span class="ident" id="6393006">name</span>&nbsp;<span class="op" id="6393011">!=</span>&nbsp;<span class="string" id="6393014">&#34;&#34;</span>&nbsp;<span class="op" id="6393017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393021">start</span><span class="op" id="6393026">.</span><span class="ident" id="6393027">Name</span><span class="op" id="6393031">.</span><span class="ident" id="6393032">Local</span>&nbsp;<span class="op" id="6393038">=</span>&nbsp;<span class="ident" id="6393040">finfo</span><span class="op" id="6393045">.</span><span class="ident" id="6393046">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393053">start</span><span class="op" id="6393058">.</span><span class="ident" id="6393059">Name</span><span class="op" id="6393063">.</span><span class="ident" id="6393064">Space</span>&nbsp;<span class="op" id="6393070">=</span>&nbsp;<span class="ident" id="6393072">finfo</span><span class="op" id="6393077">.</span><span class="ident" id="6393078">xmlns</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393085">}</span>&nbsp;<span class="keyword" id="6393087">else</span>&nbsp;<span class="keyword" id="6393092">if</span>&nbsp;<span class="ident" id="6393095">typ</span><span class="op" id="6393098">.</span><span class="ident" id="6393099">Name</span><span class="op" id="6393103">(</span><span class="op" id="6393104">)</span>&nbsp;<span class="op" id="6393106">!=</span>&nbsp;<span class="string" id="6393109">&#34;&#34;</span>&nbsp;<span class="op" id="6393112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393116">start</span><span class="op" id="6393121">.</span><span class="ident" id="6393122">Name</span><span class="op" id="6393126">.</span><span class="ident" id="6393127">Local</span>&nbsp;<span class="op" id="6393133">=</span>&nbsp;<span class="ident" id="6393135">typ</span><span class="op" id="6393138">.</span><span class="ident" id="6393139">Name</span><span class="op" id="6393143">(</span><span class="op" id="6393144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393147">}</span>&nbsp;<span class="keyword" id="6393149">else</span>&nbsp;<span class="op" id="6393154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393158">//&nbsp;Must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;named&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393198">//&nbsp;since&nbsp;it&nbsp;has&nbsp;the&nbsp;Marshaler&nbsp;methods.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393239">start</span><span class="op" id="6393244">.</span><span class="ident" id="6393245">Name</span><span class="op" id="6393249">.</span><span class="ident" id="6393250">Local</span>&nbsp;<span class="op" id="6393256">=</span>&nbsp;<span class="ident" id="6393258">typ</span><span class="op" id="6393261">.</span><span class="ident" id="6393262">Elem</span><span class="op" id="6393266">(</span><span class="op" id="6393267">)</span><span class="op" id="6393268">.</span><span class="ident" id="6393269">Name</span><span class="op" id="6393273">(</span><span class="op" id="6393274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393280">return</span>&nbsp;<span class="ident" id="6393287">start</span><br>
<span class="lineno"></span><span class="op" id="6393293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="6393296">//&nbsp;marshalInterface&nbsp;marshals&nbsp;a&nbsp;Marshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="6393354">func</span>&nbsp;<span class="op" id="6393359">(</span><span class="ident" id="6393360">p</span>&nbsp;<span class="op" id="6393362">*</span><span class="ident" id="6393363">printer</span><span class="op" id="6393370">)</span>&nbsp;<span class="ident" id="6393372">marshalInterface</span><span class="op" id="6393388">(</span><span class="ident" id="6393389">val</span>&nbsp;<span class="ident" id="6393393">Marshaler</span><span class="op" id="6393402">,</span>&nbsp;<span class="ident" id="6393404">start</span>&nbsp;<span class="ident" id="6393410">StartElement</span><span class="op" id="6393422">)</span>&nbsp;<span class="builtintype" id="6393424">error</span>&nbsp;<span class="op" id="6393430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393433">//&nbsp;Push&nbsp;a&nbsp;marker&nbsp;onto&nbsp;the&nbsp;tag&nbsp;stack&nbsp;so&nbsp;that&nbsp;MarshalXML</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393489">//&nbsp;cannot&nbsp;close&nbsp;the&nbsp;XML&nbsp;tags&nbsp;that&nbsp;it&nbsp;did&nbsp;not&nbsp;open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393541">p</span><span class="op" id="6393542">.</span><span class="ident" id="6393543">tags</span>&nbsp;<span class="op" id="6393548">=</span>&nbsp;<span class="builtinfunc" id="6393550">append</span><span class="op" id="6393556">(</span><span class="ident" id="6393557">p</span><span class="op" id="6393558">.</span><span class="ident" id="6393559">tags</span><span class="op" id="6393563">,</span>&nbsp;<span class="ident" id="6393565">Name</span><span class="op" id="6393569">{</span><span class="op" id="6393570">}</span><span class="op" id="6393571">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393574">n</span>&nbsp;<span class="op" id="6393576">:=</span>&nbsp;<span class="builtinfunc" id="6393579">len</span><span class="op" id="6393582">(</span><span class="ident" id="6393583">p</span><span class="op" id="6393584">.</span><span class="ident" id="6393585">tags</span><span class="op" id="6393589">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393593">err</span>&nbsp;<span class="op" id="6393597">:=</span>&nbsp;<span class="ident" id="6393600">val</span><span class="op" id="6393603">.</span><span class="ident" id="6393604">MarshalXML</span><span class="op" id="6393614">(</span><span class="ident" id="6393615">p</span><span class="op" id="6393616">.</span><span class="ident" id="6393617">encoder</span><span class="op" id="6393624">,</span>&nbsp;<span class="ident" id="6393626">start</span><span class="op" id="6393631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393634">if</span>&nbsp;<span class="ident" id="6393637">err</span>&nbsp;<span class="op" id="6393641">!=</span>&nbsp;<span class="ident" id="6393644">nil</span>&nbsp;<span class="op" id="6393648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393652">return</span>&nbsp;<span class="ident" id="6393659">err</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393668">//&nbsp;Make&nbsp;sure&nbsp;MarshalXML&nbsp;closed&nbsp;all&nbsp;its&nbsp;tags.&nbsp;p.tags[n-1]&nbsp;is&nbsp;the&nbsp;mark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393739">if</span>&nbsp;<span class="builtinfunc" id="6393742">len</span><span class="op" id="6393745">(</span><span class="ident" id="6393746">p</span><span class="op" id="6393747">.</span><span class="ident" id="6393748">tags</span><span class="op" id="6393752">)</span>&nbsp;<span class="op" id="6393754">&gt;</span>&nbsp;<span class="ident" id="6393756">n</span>&nbsp;<span class="op" id="6393758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393762">return</span>&nbsp;<span class="ident" id="6393769">fmt</span><span class="op" id="6393772">.</span><span class="ident" id="6393773">Errorf</span><span class="op" id="6393779">(</span><span class="string" id="6393780">&#34;xml:&nbsp;%s.MarshalXML&nbsp;wrote&nbsp;invalid&nbsp;XML:&nbsp;&lt;%s&gt;&nbsp;not&nbsp;closed&#34;</span><span class="op" id="6393835">,</span>&nbsp;<span class="ident" id="6393837">receiverType</span><span class="op" id="6393849">(</span><span class="ident" id="6393850">val</span><span class="op" id="6393853">)</span><span class="op" id="6393854">,</span>&nbsp;<span class="ident" id="6393856">p</span><span class="op" id="6393857">.</span><span class="ident" id="6393858">tags</span><span class="op" id="6393862">[</span><span class="builtinfunc" id="6393863">len</span><span class="op" id="6393866">(</span><span class="ident" id="6393867">p</span><span class="op" id="6393868">.</span><span class="ident" id="6393869">tags</span><span class="op" id="6393873">)</span><span class="op" id="6393874">-</span><span class="num" id="6393875">1</span><span class="op" id="6393876">]</span><span class="op" id="6393877">.</span><span class="ident" id="6393878">Local</span><span class="op" id="6393883">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393889">p</span><span class="op" id="6393890">.</span><span class="ident" id="6393891">tags</span>&nbsp;<span class="op" id="6393896">=</span>&nbsp;<span class="ident" id="6393898">p</span><span class="op" id="6393899">.</span><span class="ident" id="6393900">tags</span><span class="op" id="6393904">[</span><span class="op" id="6393905">:</span><span class="ident" id="6393906">n</span><span class="op" id="6393907">-</span><span class="num" id="6393908">1</span><span class="op" id="6393909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393912">return</span>&nbsp;<span class="ident" id="6393919">nil</span><br>
<span class="lineno"></span><span class="op" id="6393923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="6393926">//&nbsp;marshalTextInterface&nbsp;marshals&nbsp;a&nbsp;TextMarshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="6393992">func</span>&nbsp;<span class="op" id="6393997">(</span><span class="ident" id="6393998">p</span>&nbsp;<span class="op" id="6394000">*</span><span class="ident" id="6394001">printer</span><span class="op" id="6394008">)</span>&nbsp;<span class="ident" id="6394010">marshalTextInterface</span><span class="op" id="6394030">(</span><span class="ident" id="6394031">val</span>&nbsp;<span class="ident" id="6394035">encoding</span><span class="op" id="6394043">.</span><span class="ident" id="6394044">TextMarshaler</span><span class="op" id="6394057">,</span>&nbsp;<span class="ident" id="6394059">start</span>&nbsp;<span class="ident" id="6394065">StartElement</span><span class="op" id="6394077">)</span>&nbsp;<span class="builtintype" id="6394079">error</span>&nbsp;<span class="op" id="6394085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394088">if</span>&nbsp;<span class="ident" id="6394091">err</span>&nbsp;<span class="op" id="6394095">:=</span>&nbsp;<span class="ident" id="6394098">p</span><span class="op" id="6394099">.</span><span class="ident" id="6394100">writeStart</span><span class="op" id="6394110">(</span><span class="op" id="6394111">&amp;</span><span class="ident" id="6394112">start</span><span class="op" id="6394117">)</span><span class="op" id="6394118">;</span>&nbsp;<span class="ident" id="6394120">err</span>&nbsp;<span class="op" id="6394124">!=</span>&nbsp;<span class="ident" id="6394127">nil</span>&nbsp;<span class="op" id="6394131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394135">return</span>&nbsp;<span class="ident" id="6394142">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394147">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394150">text</span><span class="op" id="6394154">,</span>&nbsp;<span class="ident" id="6394156">err</span>&nbsp;<span class="op" id="6394160">:=</span>&nbsp;<span class="ident" id="6394163">val</span><span class="op" id="6394166">.</span><span class="ident" id="6394167">MarshalText</span><span class="op" id="6394178">(</span><span class="op" id="6394179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394182">if</span>&nbsp;<span class="ident" id="6394185">err</span>&nbsp;<span class="op" id="6394189">!=</span>&nbsp;<span class="ident" id="6394192">nil</span>&nbsp;<span class="op" id="6394196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394200">return</span>&nbsp;<span class="ident" id="6394207">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394215">EscapeText</span><span class="op" id="6394225">(</span><span class="ident" id="6394226">p</span><span class="op" id="6394227">,</span>&nbsp;<span class="ident" id="6394229">text</span><span class="op" id="6394233">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394236">return</span>&nbsp;<span class="ident" id="6394243">p</span><span class="op" id="6394244">.</span><span class="ident" id="6394245">writeEnd</span><span class="op" id="6394253">(</span><span class="ident" id="6394254">start</span><span class="op" id="6394259">.</span><span class="ident" id="6394260">Name</span><span class="op" id="6394264">)</span><br>
<span class="lineno"></span><span class="op" id="6394266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6394269">//&nbsp;writeStart&nbsp;writes&nbsp;the&nbsp;given&nbsp;start&nbsp;element.</span><br>
<span class="lineno"></span><span class="keyword" id="6394315">func</span>&nbsp;<span class="op" id="6394320">(</span><span class="ident" id="6394321">p</span>&nbsp;<span class="op" id="6394323">*</span><span class="ident" id="6394324">printer</span><span class="op" id="6394331">)</span>&nbsp;<span class="ident" id="6394333">writeStart</span><span class="op" id="6394343">(</span><span class="ident" id="6394344">start</span>&nbsp;<span class="op" id="6394350">*</span><span class="ident" id="6394351">StartElement</span><span class="op" id="6394363">)</span>&nbsp;<span class="builtintype" id="6394365">error</span>&nbsp;<span class="op" id="6394371">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394374">if</span>&nbsp;<span class="ident" id="6394377">start</span><span class="op" id="6394382">.</span><span class="ident" id="6394383">Name</span><span class="op" id="6394387">.</span><span class="ident" id="6394388">Local</span>&nbsp;<span class="op" id="6394394">==</span>&nbsp;<span class="string" id="6394397">&#34;&#34;</span>&nbsp;<span class="op" id="6394400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394404">return</span>&nbsp;<span class="ident" id="6394411">fmt</span><span class="op" id="6394414">.</span><span class="ident" id="6394415">Errorf</span><span class="op" id="6394421">(</span><span class="string" id="6394422">&#34;xml:&nbsp;start&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="6394451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394458">p</span><span class="op" id="6394459">.</span><span class="ident" id="6394460">tags</span>&nbsp;<span class="op" id="6394465">=</span>&nbsp;<span class="builtinfunc" id="6394467">append</span><span class="op" id="6394473">(</span><span class="ident" id="6394474">p</span><span class="op" id="6394475">.</span><span class="ident" id="6394476">tags</span><span class="op" id="6394480">,</span>&nbsp;<span class="ident" id="6394482">start</span><span class="op" id="6394487">.</span><span class="ident" id="6394488">Name</span><span class="op" id="6394492">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394495">p</span><span class="op" id="6394496">.</span><span class="ident" id="6394497">markPrefix</span><span class="op" id="6394507">(</span><span class="op" id="6394508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394512">p</span><span class="op" id="6394513">.</span><span class="ident" id="6394514">writeIndent</span><span class="op" id="6394525">(</span><span class="num" id="6394526">1</span><span class="op" id="6394527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394530">p</span><span class="op" id="6394531">.</span><span class="ident" id="6394532">WriteByte</span><span class="op" id="6394541">(</span><span class="string" id="6394542">&#39;&lt;&#39;</span><span class="op" id="6394545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394548">p</span><span class="op" id="6394549">.</span><span class="ident" id="6394550">WriteString</span><span class="op" id="6394561">(</span><span class="ident" id="6394562">start</span><span class="op" id="6394567">.</span><span class="ident" id="6394568">Name</span><span class="op" id="6394572">.</span><span class="ident" id="6394573">Local</span><span class="op" id="6394578">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394582">if</span>&nbsp;<span class="ident" id="6394585">start</span><span class="op" id="6394590">.</span><span class="ident" id="6394591">Name</span><span class="op" id="6394595">.</span><span class="ident" id="6394596">Space</span>&nbsp;<span class="op" id="6394602">!=</span>&nbsp;<span class="string" id="6394605">&#34;&#34;</span>&nbsp;<span class="op" id="6394608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394612">p</span><span class="op" id="6394613">.</span><span class="ident" id="6394614">WriteString</span><span class="op" id="6394625">(</span><span class="string" id="6394626">`&nbsp;xmlns=&#34;`</span><span class="op" id="6394636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394640">p</span><span class="op" id="6394641">.</span><span class="ident" id="6394642">EscapeString</span><span class="op" id="6394654">(</span><span class="ident" id="6394655">start</span><span class="op" id="6394660">.</span><span class="ident" id="6394661">Name</span><span class="op" id="6394665">.</span><span class="ident" id="6394666">Space</span><span class="op" id="6394671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394675">p</span><span class="op" id="6394676">.</span><span class="ident" id="6394677">WriteByte</span><span class="op" id="6394686">(</span><span class="string" id="6394687">&#39;&#34;&#39;</span><span class="op" id="6394690">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394697">//&nbsp;Attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394712">for</span>&nbsp;<span class="ident" id="6394716">_</span><span class="op" id="6394717">,</span>&nbsp;<span class="ident" id="6394719">attr</span>&nbsp;<span class="op" id="6394724">:=</span>&nbsp;<span class="keyword" id="6394727">range</span>&nbsp;<span class="ident" id="6394733">start</span><span class="op" id="6394738">.</span><span class="ident" id="6394739">Attr</span>&nbsp;<span class="op" id="6394744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394748">name</span>&nbsp;<span class="op" id="6394753">:=</span>&nbsp;<span class="ident" id="6394756">attr</span><span class="op" id="6394760">.</span><span class="ident" id="6394761">Name</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394768">if</span>&nbsp;<span class="ident" id="6394771">name</span><span class="op" id="6394775">.</span><span class="ident" id="6394776">Local</span>&nbsp;<span class="op" id="6394782">==</span>&nbsp;<span class="string" id="6394785">&#34;&#34;</span>&nbsp;<span class="op" id="6394788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394793">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394808">p</span><span class="op" id="6394809">.</span><span class="ident" id="6394810">WriteByte</span><span class="op" id="6394819">(</span><span class="string" id="6394820">&#39;&nbsp;&#39;</span><span class="op" id="6394823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394827">if</span>&nbsp;<span class="ident" id="6394830">name</span><span class="op" id="6394834">.</span><span class="ident" id="6394835">Space</span>&nbsp;<span class="op" id="6394841">!=</span>&nbsp;<span class="string" id="6394844">&#34;&#34;</span>&nbsp;<span class="op" id="6394847">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394852">p</span><span class="op" id="6394853">.</span><span class="ident" id="6394854">WriteString</span><span class="op" id="6394865">(</span><span class="ident" id="6394866">p</span><span class="op" id="6394867">.</span><span class="ident" id="6394868">createAttrPrefix</span><span class="op" id="6394884">(</span><span class="ident" id="6394885">name</span><span class="op" id="6394889">.</span><span class="ident" id="6394890">Space</span><span class="op" id="6394895">)</span><span class="op" id="6394896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394901">p</span><span class="op" id="6394902">.</span><span class="ident" id="6394903">WriteByte</span><span class="op" id="6394912">(</span><span class="string" id="6394913">&#39;:&#39;</span><span class="op" id="6394916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394924">p</span><span class="op" id="6394925">.</span><span class="ident" id="6394926">WriteString</span><span class="op" id="6394937">(</span><span class="ident" id="6394938">name</span><span class="op" id="6394942">.</span><span class="ident" id="6394943">Local</span><span class="op" id="6394948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394952">p</span><span class="op" id="6394953">.</span><span class="ident" id="6394954">WriteString</span><span class="op" id="6394965">(</span><span class="string" id="6394966">`=&#34;`</span><span class="op" id="6394970">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394974">p</span><span class="op" id="6394975">.</span><span class="ident" id="6394976">EscapeString</span><span class="op" id="6394988">(</span><span class="ident" id="6394989">attr</span><span class="op" id="6394993">.</span><span class="ident" id="6394994">Value</span><span class="op" id="6394999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395003">p</span><span class="op" id="6395004">.</span><span class="ident" id="6395005">WriteByte</span><span class="op" id="6395014">(</span><span class="string" id="6395015">&#39;&#34;&#39;</span><span class="op" id="6395018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395024">p</span><span class="op" id="6395025">.</span><span class="ident" id="6395026">WriteByte</span><span class="op" id="6395035">(</span><span class="string" id="6395036">&#39;&gt;&#39;</span><span class="op" id="6395039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395042">return</span>&nbsp;<span class="ident" id="6395049">nil</span><br>
<span class="lineno">645</span><span class="op" id="6395053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6395056">func</span>&nbsp;<span class="op" id="6395061">(</span><span class="ident" id="6395062">p</span>&nbsp;<span class="op" id="6395064">*</span><span class="ident" id="6395065">printer</span><span class="op" id="6395072">)</span>&nbsp;<span class="ident" id="6395074">writeEnd</span><span class="op" id="6395082">(</span><span class="ident" id="6395083">name</span>&nbsp;<span class="ident" id="6395088">Name</span><span class="op" id="6395092">)</span>&nbsp;<span class="builtintype" id="6395094">error</span>&nbsp;<span class="op" id="6395100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395103">if</span>&nbsp;<span class="ident" id="6395106">name</span><span class="op" id="6395110">.</span><span class="ident" id="6395111">Local</span>&nbsp;<span class="op" id="6395117">==</span>&nbsp;<span class="string" id="6395120">&#34;&#34;</span>&nbsp;<span class="op" id="6395123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395127">return</span>&nbsp;<span class="ident" id="6395134">fmt</span><span class="op" id="6395137">.</span><span class="ident" id="6395138">Errorf</span><span class="op" id="6395144">(</span><span class="string" id="6395145">&#34;xml:&nbsp;end&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="6395172">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395178">if</span>&nbsp;<span class="builtinfunc" id="6395181">len</span><span class="op" id="6395184">(</span><span class="ident" id="6395185">p</span><span class="op" id="6395186">.</span><span class="ident" id="6395187">tags</span><span class="op" id="6395191">)</span>&nbsp;<span class="op" id="6395193">==</span>&nbsp;<span class="num" id="6395196">0</span>&nbsp;<span class="op" id="6395198">||</span>&nbsp;<span class="ident" id="6395201">p</span><span class="op" id="6395202">.</span><span class="ident" id="6395203">tags</span><span class="op" id="6395207">[</span><span class="builtinfunc" id="6395208">len</span><span class="op" id="6395211">(</span><span class="ident" id="6395212">p</span><span class="op" id="6395213">.</span><span class="ident" id="6395214">tags</span><span class="op" id="6395218">)</span><span class="op" id="6395219">-</span><span class="num" id="6395220">1</span><span class="op" id="6395221">]</span><span class="op" id="6395222">.</span><span class="ident" id="6395223">Local</span>&nbsp;<span class="op" id="6395229">==</span>&nbsp;<span class="string" id="6395232">&#34;&#34;</span>&nbsp;<span class="op" id="6395235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395239">return</span>&nbsp;<span class="ident" id="6395246">fmt</span><span class="op" id="6395249">.</span><span class="ident" id="6395250">Errorf</span><span class="op" id="6395256">(</span><span class="string" id="6395257">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;without&nbsp;start&nbsp;tag&#34;</span><span class="op" id="6395295">,</span>&nbsp;<span class="ident" id="6395297">name</span><span class="op" id="6395301">.</span><span class="ident" id="6395302">Local</span><span class="op" id="6395307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395313">if</span>&nbsp;<span class="ident" id="6395316">top</span>&nbsp;<span class="op" id="6395320">:=</span>&nbsp;<span class="ident" id="6395323">p</span><span class="op" id="6395324">.</span><span class="ident" id="6395325">tags</span><span class="op" id="6395329">[</span><span class="builtinfunc" id="6395330">len</span><span class="op" id="6395333">(</span><span class="ident" id="6395334">p</span><span class="op" id="6395335">.</span><span class="ident" id="6395336">tags</span><span class="op" id="6395340">)</span><span class="op" id="6395341">-</span><span class="num" id="6395342">1</span><span class="op" id="6395343">]</span><span class="op" id="6395344">;</span>&nbsp;<span class="ident" id="6395346">top</span>&nbsp;<span class="op" id="6395350">!=</span>&nbsp;<span class="ident" id="6395353">name</span>&nbsp;<span class="op" id="6395358">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395362">if</span>&nbsp;<span class="ident" id="6395365">top</span><span class="op" id="6395368">.</span><span class="ident" id="6395369">Local</span>&nbsp;<span class="op" id="6395375">!=</span>&nbsp;<span class="ident" id="6395378">name</span><span class="op" id="6395382">.</span><span class="ident" id="6395383">Local</span>&nbsp;<span class="op" id="6395389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395394">return</span>&nbsp;<span class="ident" id="6395401">fmt</span><span class="op" id="6395404">.</span><span class="ident" id="6395405">Errorf</span><span class="op" id="6395411">(</span><span class="string" id="6395412">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="6395462">,</span>&nbsp;<span class="ident" id="6395464">name</span><span class="op" id="6395468">.</span><span class="ident" id="6395469">Local</span><span class="op" id="6395474">,</span>&nbsp;<span class="ident" id="6395476">top</span><span class="op" id="6395479">.</span><span class="ident" id="6395480">Local</span><span class="op" id="6395485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395493">return</span>&nbsp;<span class="ident" id="6395500">fmt</span><span class="op" id="6395503">.</span><span class="ident" id="6395504">Errorf</span><span class="op" id="6395510">(</span><span class="string" id="6395511">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&#34;</span><span class="op" id="6395593">,</span>&nbsp;<span class="ident" id="6395595">name</span><span class="op" id="6395599">.</span><span class="ident" id="6395600">Local</span><span class="op" id="6395605">,</span>&nbsp;<span class="ident" id="6395607">name</span><span class="op" id="6395611">.</span><span class="ident" id="6395612">Space</span><span class="op" id="6395617">,</span>&nbsp;<span class="ident" id="6395619">top</span><span class="op" id="6395622">.</span><span class="ident" id="6395623">Local</span><span class="op" id="6395628">,</span>&nbsp;<span class="ident" id="6395630">top</span><span class="op" id="6395633">.</span><span class="ident" id="6395634">Space</span><span class="op" id="6395639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395642">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395645">p</span><span class="op" id="6395646">.</span><span class="ident" id="6395647">tags</span>&nbsp;<span class="op" id="6395652">=</span>&nbsp;<span class="ident" id="6395654">p</span><span class="op" id="6395655">.</span><span class="ident" id="6395656">tags</span><span class="op" id="6395660">[</span><span class="op" id="6395661">:</span><span class="builtinfunc" id="6395662">len</span><span class="op" id="6395665">(</span><span class="ident" id="6395666">p</span><span class="op" id="6395667">.</span><span class="ident" id="6395668">tags</span><span class="op" id="6395672">)</span><span class="op" id="6395673">-</span><span class="num" id="6395674">1</span><span class="op" id="6395675">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395679">p</span><span class="op" id="6395680">.</span><span class="ident" id="6395681">writeIndent</span><span class="op" id="6395692">(</span><span class="op" id="6395693">-</span><span class="num" id="6395694">1</span><span class="op" id="6395695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395698">p</span><span class="op" id="6395699">.</span><span class="ident" id="6395700">WriteByte</span><span class="op" id="6395709">(</span><span class="string" id="6395710">&#39;&lt;&#39;</span><span class="op" id="6395713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395716">p</span><span class="op" id="6395717">.</span><span class="ident" id="6395718">WriteByte</span><span class="op" id="6395727">(</span><span class="string" id="6395728">&#39;/&#39;</span><span class="op" id="6395731">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395734">p</span><span class="op" id="6395735">.</span><span class="ident" id="6395736">WriteString</span><span class="op" id="6395747">(</span><span class="ident" id="6395748">name</span><span class="op" id="6395752">.</span><span class="ident" id="6395753">Local</span><span class="op" id="6395758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395761">p</span><span class="op" id="6395762">.</span><span class="ident" id="6395763">WriteByte</span><span class="op" id="6395772">(</span><span class="string" id="6395773">&#39;&gt;&#39;</span><span class="op" id="6395776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395779">p</span><span class="op" id="6395780">.</span><span class="ident" id="6395781">popPrefix</span><span class="op" id="6395790">(</span><span class="op" id="6395791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395794">return</span>&nbsp;<span class="ident" id="6395801">nil</span><br>
<span class="lineno"></span><span class="op" id="6395805">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="keyword" id="6395808">func</span>&nbsp;<span class="op" id="6395813">(</span><span class="ident" id="6395814">p</span>&nbsp;<span class="op" id="6395816">*</span><span class="ident" id="6395817">printer</span><span class="op" id="6395824">)</span>&nbsp;<span class="ident" id="6395826">marshalSimple</span><span class="op" id="6395839">(</span><span class="ident" id="6395840">typ</span>&nbsp;<span class="ident" id="6395844">reflect</span><span class="op" id="6395851">.</span><span class="ident" id="6395852">Type</span><span class="op" id="6395856">,</span>&nbsp;<span class="ident" id="6395858">val</span>&nbsp;<span class="ident" id="6395862">reflect</span><span class="op" id="6395869">.</span><span class="ident" id="6395870">Value</span><span class="op" id="6395875">)</span>&nbsp;<span class="op" id="6395877">(</span><span class="builtintype" id="6395878">string</span><span class="op" id="6395884">,</span>&nbsp;<span class="op" id="6395886">[</span><span class="op" id="6395887">]</span><span class="builtintype" id="6395888">byte</span><span class="op" id="6395892">,</span>&nbsp;<span class="builtintype" id="6395894">error</span><span class="op" id="6395899">)</span>&nbsp;<span class="op" id="6395901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395904">switch</span>&nbsp;<span class="ident" id="6395911">val</span><span class="op" id="6395914">.</span><span class="ident" id="6395915">Kind</span><span class="op" id="6395919">(</span><span class="op" id="6395920">)</span>&nbsp;<span class="op" id="6395922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395925">case</span>&nbsp;<span class="ident" id="6395930">reflect</span><span class="op" id="6395937">.</span><span class="ident" id="6395938">Int</span><span class="op" id="6395941">,</span>&nbsp;<span class="ident" id="6395943">reflect</span><span class="op" id="6395950">.</span><span class="ident" id="6395951">Int8</span><span class="op" id="6395955">,</span>&nbsp;<span class="ident" id="6395957">reflect</span><span class="op" id="6395964">.</span><span class="ident" id="6395965">Int16</span><span class="op" id="6395970">,</span>&nbsp;<span class="ident" id="6395972">reflect</span><span class="op" id="6395979">.</span><span class="ident" id="6395980">Int32</span><span class="op" id="6395985">,</span>&nbsp;<span class="ident" id="6395987">reflect</span><span class="op" id="6395994">.</span><span class="ident" id="6395995">Int64</span><span class="op" id="6396000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396004">return</span>&nbsp;<span class="ident" id="6396011">strconv</span><span class="op" id="6396018">.</span><span class="ident" id="6396019">FormatInt</span><span class="op" id="6396028">(</span><span class="ident" id="6396029">val</span><span class="op" id="6396032">.</span><span class="ident" id="6396033">Int</span><span class="op" id="6396036">(</span><span class="op" id="6396037">)</span><span class="op" id="6396038">,</span>&nbsp;<span class="num" id="6396040">10</span><span class="op" id="6396042">)</span><span class="op" id="6396043">,</span>&nbsp;<span class="ident" id="6396045">nil</span><span class="op" id="6396048">,</span>&nbsp;<span class="ident" id="6396050">nil</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396055">case</span>&nbsp;<span class="ident" id="6396060">reflect</span><span class="op" id="6396067">.</span><span class="ident" id="6396068">Uint</span><span class="op" id="6396072">,</span>&nbsp;<span class="ident" id="6396074">reflect</span><span class="op" id="6396081">.</span><span class="ident" id="6396082">Uint8</span><span class="op" id="6396087">,</span>&nbsp;<span class="ident" id="6396089">reflect</span><span class="op" id="6396096">.</span><span class="ident" id="6396097">Uint16</span><span class="op" id="6396103">,</span>&nbsp;<span class="ident" id="6396105">reflect</span><span class="op" id="6396112">.</span><span class="ident" id="6396113">Uint32</span><span class="op" id="6396119">,</span>&nbsp;<span class="ident" id="6396121">reflect</span><span class="op" id="6396128">.</span><span class="ident" id="6396129">Uint64</span><span class="op" id="6396135">,</span>&nbsp;<span class="ident" id="6396137">reflect</span><span class="op" id="6396144">.</span><span class="ident" id="6396145">Uintptr</span><span class="op" id="6396152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396156">return</span>&nbsp;<span class="ident" id="6396163">strconv</span><span class="op" id="6396170">.</span><span class="ident" id="6396171">FormatUint</span><span class="op" id="6396181">(</span><span class="ident" id="6396182">val</span><span class="op" id="6396185">.</span><span class="ident" id="6396186">Uint</span><span class="op" id="6396190">(</span><span class="op" id="6396191">)</span><span class="op" id="6396192">,</span>&nbsp;<span class="num" id="6396194">10</span><span class="op" id="6396196">)</span><span class="op" id="6396197">,</span>&nbsp;<span class="ident" id="6396199">nil</span><span class="op" id="6396202">,</span>&nbsp;<span class="ident" id="6396204">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396209">case</span>&nbsp;<span class="ident" id="6396214">reflect</span><span class="op" id="6396221">.</span><span class="ident" id="6396222">Float32</span><span class="op" id="6396229">,</span>&nbsp;<span class="ident" id="6396231">reflect</span><span class="op" id="6396238">.</span><span class="ident" id="6396239">Float64</span><span class="op" id="6396246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396250">return</span>&nbsp;<span class="ident" id="6396257">strconv</span><span class="op" id="6396264">.</span><span class="ident" id="6396265">FormatFloat</span><span class="op" id="6396276">(</span><span class="ident" id="6396277">val</span><span class="op" id="6396280">.</span><span class="ident" id="6396281">Float</span><span class="op" id="6396286">(</span><span class="op" id="6396287">)</span><span class="op" id="6396288">,</span>&nbsp;<span class="string" id="6396290">&#39;g&#39;</span><span class="op" id="6396293">,</span>&nbsp;<span class="op" id="6396295">-</span><span class="num" id="6396296">1</span><span class="op" id="6396297">,</span>&nbsp;<span class="ident" id="6396299">val</span><span class="op" id="6396302">.</span><span class="ident" id="6396303">Type</span><span class="op" id="6396307">(</span><span class="op" id="6396308">)</span><span class="op" id="6396309">.</span><span class="ident" id="6396310">Bits</span><span class="op" id="6396314">(</span><span class="op" id="6396315">)</span><span class="op" id="6396316">)</span><span class="op" id="6396317">,</span>&nbsp;<span class="ident" id="6396319">nil</span><span class="op" id="6396322">,</span>&nbsp;<span class="ident" id="6396324">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396329">case</span>&nbsp;<span class="ident" id="6396334">reflect</span><span class="op" id="6396341">.</span><span class="ident" id="6396342">String</span><span class="op" id="6396348">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396352">return</span>&nbsp;<span class="ident" id="6396359">val</span><span class="op" id="6396362">.</span><span class="ident" id="6396363">String</span><span class="op" id="6396369">(</span><span class="op" id="6396370">)</span><span class="op" id="6396371">,</span>&nbsp;<span class="ident" id="6396373">nil</span><span class="op" id="6396376">,</span>&nbsp;<span class="ident" id="6396378">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396383">case</span>&nbsp;<span class="ident" id="6396388">reflect</span><span class="op" id="6396395">.</span><span class="ident" id="6396396">Bool</span><span class="op" id="6396400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396404">return</span>&nbsp;<span class="ident" id="6396411">strconv</span><span class="op" id="6396418">.</span><span class="ident" id="6396419">FormatBool</span><span class="op" id="6396429">(</span><span class="ident" id="6396430">val</span><span class="op" id="6396433">.</span><span class="ident" id="6396434">Bool</span><span class="op" id="6396438">(</span><span class="op" id="6396439">)</span><span class="op" id="6396440">)</span><span class="op" id="6396441">,</span>&nbsp;<span class="ident" id="6396443">nil</span><span class="op" id="6396446">,</span>&nbsp;<span class="ident" id="6396448">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396453">case</span>&nbsp;<span class="ident" id="6396458">reflect</span><span class="op" id="6396465">.</span><span class="ident" id="6396466">Array</span><span class="op" id="6396471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396475">if</span>&nbsp;<span class="ident" id="6396478">typ</span><span class="op" id="6396481">.</span><span class="ident" id="6396482">Elem</span><span class="op" id="6396486">(</span><span class="op" id="6396487">)</span><span class="op" id="6396488">.</span><span class="ident" id="6396489">Kind</span><span class="op" id="6396493">(</span><span class="op" id="6396494">)</span>&nbsp;<span class="op" id="6396496">!=</span>&nbsp;<span class="ident" id="6396499">reflect</span><span class="op" id="6396506">.</span><span class="ident" id="6396507">Uint8</span>&nbsp;<span class="op" id="6396513">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396518">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396530">//&nbsp;[...]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396545">var</span>&nbsp;<span class="ident" id="6396549">bytes</span>&nbsp;<span class="op" id="6396555">[</span><span class="op" id="6396556">]</span><span class="builtintype" id="6396557">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396564">if</span>&nbsp;<span class="ident" id="6396567">val</span><span class="op" id="6396570">.</span><span class="ident" id="6396571">CanAddr</span><span class="op" id="6396578">(</span><span class="op" id="6396579">)</span>&nbsp;<span class="op" id="6396581">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396586">bytes</span>&nbsp;<span class="op" id="6396592">=</span>&nbsp;<span class="ident" id="6396594">val</span><span class="op" id="6396597">.</span><span class="ident" id="6396598">Slice</span><span class="op" id="6396603">(</span><span class="num" id="6396604">0</span><span class="op" id="6396605">,</span>&nbsp;<span class="ident" id="6396607">val</span><span class="op" id="6396610">.</span><span class="ident" id="6396611">Len</span><span class="op" id="6396614">(</span><span class="op" id="6396615">)</span><span class="op" id="6396616">)</span><span class="op" id="6396617">.</span><span class="ident" id="6396618">Bytes</span><span class="op" id="6396623">(</span><span class="op" id="6396624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396628">}</span>&nbsp;<span class="keyword" id="6396630">else</span>&nbsp;<span class="op" id="6396635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396640">bytes</span>&nbsp;<span class="op" id="6396646">=</span>&nbsp;<span class="builtinfunc" id="6396648">make</span><span class="op" id="6396652">(</span><span class="op" id="6396653">[</span><span class="op" id="6396654">]</span><span class="builtintype" id="6396655">byte</span><span class="op" id="6396659">,</span>&nbsp;<span class="ident" id="6396661">val</span><span class="op" id="6396664">.</span><span class="ident" id="6396665">Len</span><span class="op" id="6396668">(</span><span class="op" id="6396669">)</span><span class="op" id="6396670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396675">reflect</span><span class="op" id="6396682">.</span><span class="ident" id="6396683">Copy</span><span class="op" id="6396687">(</span><span class="ident" id="6396688">reflect</span><span class="op" id="6396695">.</span><span class="ident" id="6396696">ValueOf</span><span class="op" id="6396703">(</span><span class="ident" id="6396704">bytes</span><span class="op" id="6396709">)</span><span class="op" id="6396710">,</span>&nbsp;<span class="ident" id="6396712">val</span><span class="op" id="6396715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396719">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396723">return</span>&nbsp;<span class="string" id="6396730">&#34;&#34;</span><span class="op" id="6396732">,</span>&nbsp;<span class="ident" id="6396734">bytes</span><span class="op" id="6396739">,</span>&nbsp;<span class="ident" id="6396741">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396746">case</span>&nbsp;<span class="ident" id="6396751">reflect</span><span class="op" id="6396758">.</span><span class="ident" id="6396759">Slice</span><span class="op" id="6396764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396768">if</span>&nbsp;<span class="ident" id="6396771">typ</span><span class="op" id="6396774">.</span><span class="ident" id="6396775">Elem</span><span class="op" id="6396779">(</span><span class="op" id="6396780">)</span><span class="op" id="6396781">.</span><span class="ident" id="6396782">Kind</span><span class="op" id="6396786">(</span><span class="op" id="6396787">)</span>&nbsp;<span class="op" id="6396789">!=</span>&nbsp;<span class="ident" id="6396792">reflect</span><span class="op" id="6396799">.</span><span class="ident" id="6396800">Uint8</span>&nbsp;<span class="op" id="6396806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396811">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396819">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396823">//&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396835">return</span>&nbsp;<span class="string" id="6396842">&#34;&#34;</span><span class="op" id="6396844">,</span>&nbsp;<span class="ident" id="6396846">val</span><span class="op" id="6396849">.</span><span class="ident" id="6396850">Bytes</span><span class="op" id="6396855">(</span><span class="op" id="6396856">)</span><span class="op" id="6396857">,</span>&nbsp;<span class="ident" id="6396859">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396867">return</span>&nbsp;<span class="string" id="6396874">&#34;&#34;</span><span class="op" id="6396876">,</span>&nbsp;<span class="ident" id="6396878">nil</span><span class="op" id="6396881">,</span>&nbsp;<span class="op" id="6396883">&amp;</span><span class="ident" id="6396884">UnsupportedTypeError</span><span class="op" id="6396904">{</span><span class="ident" id="6396905">typ</span><span class="op" id="6396908">}</span><br>
<span class="lineno"></span><span class="op" id="6396910">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span><span class="keyword" id="6396913">var</span>&nbsp;<span class="ident" id="6396917">ddBytes</span>&nbsp;<span class="op" id="6396925">=</span>&nbsp;<span class="op" id="6396927">[</span><span class="op" id="6396928">]</span><span class="builtintype" id="6396929">byte</span><span class="op" id="6396933">(</span><span class="string" id="6396934">&#34;--&#34;</span><span class="op" id="6396938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6396941">func</span>&nbsp;<span class="op" id="6396946">(</span><span class="ident" id="6396947">p</span>&nbsp;<span class="op" id="6396949">*</span><span class="ident" id="6396950">printer</span><span class="op" id="6396957">)</span>&nbsp;<span class="ident" id="6396959">marshalStruct</span><span class="op" id="6396972">(</span><span class="ident" id="6396973">tinfo</span>&nbsp;<span class="op" id="6396979">*</span><span class="ident" id="6396980">typeInfo</span><span class="op" id="6396988">,</span>&nbsp;<span class="ident" id="6396990">val</span>&nbsp;<span class="ident" id="6396994">reflect</span><span class="op" id="6397001">.</span><span class="ident" id="6397002">Value</span><span class="op" id="6397007">)</span>&nbsp;<span class="builtintype" id="6397009">error</span>&nbsp;<span class="op" id="6397015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397018">s</span>&nbsp;<span class="op" id="6397020">:=</span>&nbsp;<span class="ident" id="6397023">parentStack</span><span class="op" id="6397034">{</span><span class="ident" id="6397035">p</span><span class="op" id="6397036">:</span>&nbsp;<span class="ident" id="6397038">p</span><span class="op" id="6397039">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397042">for</span>&nbsp;<span class="ident" id="6397046">i</span>&nbsp;<span class="op" id="6397048">:=</span>&nbsp;<span class="keyword" id="6397051">range</span>&nbsp;<span class="ident" id="6397057">tinfo</span><span class="op" id="6397062">.</span><span class="ident" id="6397063">fields</span>&nbsp;<span class="op" id="6397070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397074">finfo</span>&nbsp;<span class="op" id="6397080">:=</span>&nbsp;<span class="op" id="6397083">&amp;</span><span class="ident" id="6397084">tinfo</span><span class="op" id="6397089">.</span><span class="ident" id="6397090">fields</span><span class="op" id="6397096">[</span><span class="ident" id="6397097">i</span><span class="op" id="6397098">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397102">if</span>&nbsp;<span class="ident" id="6397105">finfo</span><span class="op" id="6397110">.</span><span class="ident" id="6397111">flags</span><span class="op" id="6397116">&amp;</span><span class="ident" id="6397117">fAttr</span>&nbsp;<span class="op" id="6397123">!=</span>&nbsp;<span class="num" id="6397126">0</span>&nbsp;<span class="op" id="6397128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397133">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397144">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397148">vf</span>&nbsp;<span class="op" id="6397151">:=</span>&nbsp;<span class="ident" id="6397154">finfo</span><span class="op" id="6397159">.</span><span class="ident" id="6397160">value</span><span class="op" id="6397165">(</span><span class="ident" id="6397166">val</span><span class="op" id="6397169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397174">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397230">switch</span>&nbsp;<span class="ident" id="6397237">vf</span><span class="op" id="6397239">.</span><span class="ident" id="6397240">Kind</span><span class="op" id="6397244">(</span><span class="op" id="6397245">)</span>&nbsp;<span class="op" id="6397247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397251">case</span>&nbsp;<span class="ident" id="6397256">reflect</span><span class="op" id="6397263">.</span><span class="ident" id="6397264">Ptr</span><span class="op" id="6397267">,</span>&nbsp;<span class="ident" id="6397269">reflect</span><span class="op" id="6397276">.</span><span class="ident" id="6397277">Interface</span><span class="op" id="6397286">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397291">if</span>&nbsp;<span class="op" id="6397294">!</span><span class="ident" id="6397295">vf</span><span class="op" id="6397297">.</span><span class="ident" id="6397298">IsNil</span><span class="op" id="6397303">(</span><span class="op" id="6397304">)</span>&nbsp;<span class="op" id="6397306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397312">vf</span>&nbsp;<span class="op" id="6397315">=</span>&nbsp;<span class="ident" id="6397317">vf</span><span class="op" id="6397319">.</span><span class="ident" id="6397320">Elem</span><span class="op" id="6397324">(</span><span class="op" id="6397325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397339">switch</span>&nbsp;<span class="ident" id="6397346">finfo</span><span class="op" id="6397351">.</span><span class="ident" id="6397352">flags</span>&nbsp;<span class="op" id="6397358">&amp;</span>&nbsp;<span class="ident" id="6397360">fMode</span>&nbsp;<span class="op" id="6397366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397370">case</span>&nbsp;<span class="ident" id="6397375">fCharData</span><span class="op" id="6397384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397389">if</span>&nbsp;<span class="ident" id="6397392">vf</span><span class="op" id="6397394">.</span><span class="ident" id="6397395">CanInterface</span><span class="op" id="6397407">(</span><span class="op" id="6397408">)</span>&nbsp;<span class="op" id="6397410">&amp;&amp;</span>&nbsp;<span class="ident" id="6397413">vf</span><span class="op" id="6397415">.</span><span class="ident" id="6397416">Type</span><span class="op" id="6397420">(</span><span class="op" id="6397421">)</span><span class="op" id="6397422">.</span><span class="ident" id="6397423">Implements</span><span class="op" id="6397433">(</span><span class="ident" id="6397434">textMarshalerType</span><span class="op" id="6397451">)</span>&nbsp;<span class="op" id="6397453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397459">data</span><span class="op" id="6397463">,</span>&nbsp;<span class="ident" id="6397465">err</span>&nbsp;<span class="op" id="6397469">:=</span>&nbsp;<span class="ident" id="6397472">vf</span><span class="op" id="6397474">.</span><span class="ident" id="6397475">Interface</span><span class="op" id="6397484">(</span><span class="op" id="6397485">)</span><span class="op" id="6397486">.</span><span class="op" id="6397487">(</span><span class="ident" id="6397488">encoding</span><span class="op" id="6397496">.</span><span class="ident" id="6397497">TextMarshaler</span><span class="op" id="6397510">)</span><span class="op" id="6397511">.</span><span class="ident" id="6397512">MarshalText</span><span class="op" id="6397523">(</span><span class="op" id="6397524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397530">if</span>&nbsp;<span class="ident" id="6397533">err</span>&nbsp;<span class="op" id="6397537">!=</span>&nbsp;<span class="ident" id="6397540">nil</span>&nbsp;<span class="op" id="6397544">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397551">return</span>&nbsp;<span class="ident" id="6397558">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397572">Escape</span><span class="op" id="6397578">(</span><span class="ident" id="6397579">p</span><span class="op" id="6397580">,</span>&nbsp;<span class="ident" id="6397582">data</span><span class="op" id="6397586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397592">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397604">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397609">if</span>&nbsp;<span class="ident" id="6397612">vf</span><span class="op" id="6397614">.</span><span class="ident" id="6397615">CanAddr</span><span class="op" id="6397622">(</span><span class="op" id="6397623">)</span>&nbsp;<span class="op" id="6397625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397631">pv</span>&nbsp;<span class="op" id="6397634">:=</span>&nbsp;<span class="ident" id="6397637">vf</span><span class="op" id="6397639">.</span><span class="ident" id="6397640">Addr</span><span class="op" id="6397644">(</span><span class="op" id="6397645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397651">if</span>&nbsp;<span class="ident" id="6397654">pv</span><span class="op" id="6397656">.</span><span class="ident" id="6397657">CanInterface</span><span class="op" id="6397669">(</span><span class="op" id="6397670">)</span>&nbsp;<span class="op" id="6397672">&amp;&amp;</span>&nbsp;<span class="ident" id="6397675">pv</span><span class="op" id="6397677">.</span><span class="ident" id="6397678">Type</span><span class="op" id="6397682">(</span><span class="op" id="6397683">)</span><span class="op" id="6397684">.</span><span class="ident" id="6397685">Implements</span><span class="op" id="6397695">(</span><span class="ident" id="6397696">textMarshalerType</span><span class="op" id="6397713">)</span>&nbsp;<span class="op" id="6397715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397722">data</span><span class="op" id="6397726">,</span>&nbsp;<span class="ident" id="6397728">err</span>&nbsp;<span class="op" id="6397732">:=</span>&nbsp;<span class="ident" id="6397735">pv</span><span class="op" id="6397737">.</span><span class="ident" id="6397738">Interface</span><span class="op" id="6397747">(</span><span class="op" id="6397748">)</span><span class="op" id="6397749">.</span><span class="op" id="6397750">(</span><span class="ident" id="6397751">encoding</span><span class="op" id="6397759">.</span><span class="ident" id="6397760">TextMarshaler</span><span class="op" id="6397773">)</span><span class="op" id="6397774">.</span><span class="ident" id="6397775">MarshalText</span><span class="op" id="6397786">(</span><span class="op" id="6397787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397794">if</span>&nbsp;<span class="ident" id="6397797">err</span>&nbsp;<span class="op" id="6397801">!=</span>&nbsp;<span class="ident" id="6397804">nil</span>&nbsp;<span class="op" id="6397808">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397816">return</span>&nbsp;<span class="ident" id="6397823">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397839">Escape</span><span class="op" id="6397845">(</span><span class="ident" id="6397846">p</span><span class="op" id="6397847">,</span>&nbsp;<span class="ident" id="6397849">data</span><span class="op" id="6397853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397860">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397873">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397883">var</span>&nbsp;<span class="ident" id="6397887">scratch</span>&nbsp;<span class="op" id="6397895">[</span><span class="num" id="6397896">64</span><span class="op" id="6397898">]</span><span class="builtintype" id="6397899">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397907">switch</span>&nbsp;<span class="ident" id="6397914">vf</span><span class="op" id="6397916">.</span><span class="ident" id="6397917">Kind</span><span class="op" id="6397921">(</span><span class="op" id="6397922">)</span>&nbsp;<span class="op" id="6397924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397929">case</span>&nbsp;<span class="ident" id="6397934">reflect</span><span class="op" id="6397941">.</span><span class="ident" id="6397942">Int</span><span class="op" id="6397945">,</span>&nbsp;<span class="ident" id="6397947">reflect</span><span class="op" id="6397954">.</span><span class="ident" id="6397955">Int8</span><span class="op" id="6397959">,</span>&nbsp;<span class="ident" id="6397961">reflect</span><span class="op" id="6397968">.</span><span class="ident" id="6397969">Int16</span><span class="op" id="6397974">,</span>&nbsp;<span class="ident" id="6397976">reflect</span><span class="op" id="6397983">.</span><span class="ident" id="6397984">Int32</span><span class="op" id="6397989">,</span>&nbsp;<span class="ident" id="6397991">reflect</span><span class="op" id="6397998">.</span><span class="ident" id="6397999">Int64</span><span class="op" id="6398004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398010">Escape</span><span class="op" id="6398016">(</span><span class="ident" id="6398017">p</span><span class="op" id="6398018">,</span>&nbsp;<span class="ident" id="6398020">strconv</span><span class="op" id="6398027">.</span><span class="ident" id="6398028">AppendInt</span><span class="op" id="6398037">(</span><span class="ident" id="6398038">scratch</span><span class="op" id="6398045">[</span><span class="op" id="6398046">:</span><span class="num" id="6398047">0</span><span class="op" id="6398048">]</span><span class="op" id="6398049">,</span>&nbsp;<span class="ident" id="6398051">vf</span><span class="op" id="6398053">.</span><span class="ident" id="6398054">Int</span><span class="op" id="6398057">(</span><span class="op" id="6398058">)</span><span class="op" id="6398059">,</span>&nbsp;<span class="num" id="6398061">10</span><span class="op" id="6398063">)</span><span class="op" id="6398064">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398069">case</span>&nbsp;<span class="ident" id="6398074">reflect</span><span class="op" id="6398081">.</span><span class="ident" id="6398082">Uint</span><span class="op" id="6398086">,</span>&nbsp;<span class="ident" id="6398088">reflect</span><span class="op" id="6398095">.</span><span class="ident" id="6398096">Uint8</span><span class="op" id="6398101">,</span>&nbsp;<span class="ident" id="6398103">reflect</span><span class="op" id="6398110">.</span><span class="ident" id="6398111">Uint16</span><span class="op" id="6398117">,</span>&nbsp;<span class="ident" id="6398119">reflect</span><span class="op" id="6398126">.</span><span class="ident" id="6398127">Uint32</span><span class="op" id="6398133">,</span>&nbsp;<span class="ident" id="6398135">reflect</span><span class="op" id="6398142">.</span><span class="ident" id="6398143">Uint64</span><span class="op" id="6398149">,</span>&nbsp;<span class="ident" id="6398151">reflect</span><span class="op" id="6398158">.</span><span class="ident" id="6398159">Uintptr</span><span class="op" id="6398166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398172">Escape</span><span class="op" id="6398178">(</span><span class="ident" id="6398179">p</span><span class="op" id="6398180">,</span>&nbsp;<span class="ident" id="6398182">strconv</span><span class="op" id="6398189">.</span><span class="ident" id="6398190">AppendUint</span><span class="op" id="6398200">(</span><span class="ident" id="6398201">scratch</span><span class="op" id="6398208">[</span><span class="op" id="6398209">:</span><span class="num" id="6398210">0</span><span class="op" id="6398211">]</span><span class="op" id="6398212">,</span>&nbsp;<span class="ident" id="6398214">vf</span><span class="op" id="6398216">.</span><span class="ident" id="6398217">Uint</span><span class="op" id="6398221">(</span><span class="op" id="6398222">)</span><span class="op" id="6398223">,</span>&nbsp;<span class="num" id="6398225">10</span><span class="op" id="6398227">)</span><span class="op" id="6398228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398233">case</span>&nbsp;<span class="ident" id="6398238">reflect</span><span class="op" id="6398245">.</span><span class="ident" id="6398246">Float32</span><span class="op" id="6398253">,</span>&nbsp;<span class="ident" id="6398255">reflect</span><span class="op" id="6398262">.</span><span class="ident" id="6398263">Float64</span><span class="op" id="6398270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398276">Escape</span><span class="op" id="6398282">(</span><span class="ident" id="6398283">p</span><span class="op" id="6398284">,</span>&nbsp;<span class="ident" id="6398286">strconv</span><span class="op" id="6398293">.</span><span class="ident" id="6398294">AppendFloat</span><span class="op" id="6398305">(</span><span class="ident" id="6398306">scratch</span><span class="op" id="6398313">[</span><span class="op" id="6398314">:</span><span class="num" id="6398315">0</span><span class="op" id="6398316">]</span><span class="op" id="6398317">,</span>&nbsp;<span class="ident" id="6398319">vf</span><span class="op" id="6398321">.</span><span class="ident" id="6398322">Float</span><span class="op" id="6398327">(</span><span class="op" id="6398328">)</span><span class="op" id="6398329">,</span>&nbsp;<span class="string" id="6398331">&#39;g&#39;</span><span class="op" id="6398334">,</span>&nbsp;<span class="op" id="6398336">-</span><span class="num" id="6398337">1</span><span class="op" id="6398338">,</span>&nbsp;<span class="ident" id="6398340">vf</span><span class="op" id="6398342">.</span><span class="ident" id="6398343">Type</span><span class="op" id="6398347">(</span><span class="op" id="6398348">)</span><span class="op" id="6398349">.</span><span class="ident" id="6398350">Bits</span><span class="op" id="6398354">(</span><span class="op" id="6398355">)</span><span class="op" id="6398356">)</span><span class="op" id="6398357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398362">case</span>&nbsp;<span class="ident" id="6398367">reflect</span><span class="op" id="6398374">.</span><span class="ident" id="6398375">Bool</span><span class="op" id="6398379">:</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398385">Escape</span><span class="op" id="6398391">(</span><span class="ident" id="6398392">p</span><span class="op" id="6398393">,</span>&nbsp;<span class="ident" id="6398395">strconv</span><span class="op" id="6398402">.</span><span class="ident" id="6398403">AppendBool</span><span class="op" id="6398413">(</span><span class="ident" id="6398414">scratch</span><span class="op" id="6398421">[</span><span class="op" id="6398422">:</span><span class="num" id="6398423">0</span><span class="op" id="6398424">]</span><span class="op" id="6398425">,</span>&nbsp;<span class="ident" id="6398427">vf</span><span class="op" id="6398429">.</span><span class="ident" id="6398430">Bool</span><span class="op" id="6398434">(</span><span class="op" id="6398435">)</span><span class="op" id="6398436">)</span><span class="op" id="6398437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398442">case</span>&nbsp;<span class="ident" id="6398447">reflect</span><span class="op" id="6398454">.</span><span class="ident" id="6398455">String</span><span class="op" id="6398461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398467">if</span>&nbsp;<span class="ident" id="6398470">err</span>&nbsp;<span class="op" id="6398474">:=</span>&nbsp;<span class="ident" id="6398477">EscapeText</span><span class="op" id="6398487">(</span><span class="ident" id="6398488">p</span><span class="op" id="6398489">,</span>&nbsp;<span class="op" id="6398491">[</span><span class="op" id="6398492">]</span><span class="builtintype" id="6398493">byte</span><span class="op" id="6398497">(</span><span class="ident" id="6398498">vf</span><span class="op" id="6398500">.</span><span class="ident" id="6398501">String</span><span class="op" id="6398507">(</span><span class="op" id="6398508">)</span><span class="op" id="6398509">)</span><span class="op" id="6398510">)</span><span class="op" id="6398511">;</span>&nbsp;<span class="ident" id="6398513">err</span>&nbsp;<span class="op" id="6398517">!=</span>&nbsp;<span class="ident" id="6398520">nil</span>&nbsp;<span class="op" id="6398524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398531">return</span>&nbsp;<span class="ident" id="6398538">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398546">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398551">case</span>&nbsp;<span class="ident" id="6398556">reflect</span><span class="op" id="6398563">.</span><span class="ident" id="6398564">Slice</span><span class="op" id="6398569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398575">if</span>&nbsp;<span class="ident" id="6398578">elem</span><span class="op" id="6398582">,</span>&nbsp;<span class="ident" id="6398584">ok</span>&nbsp;<span class="op" id="6398587">:=</span>&nbsp;<span class="ident" id="6398590">vf</span><span class="op" id="6398592">.</span><span class="ident" id="6398593">Interface</span><span class="op" id="6398602">(</span><span class="op" id="6398603">)</span><span class="op" id="6398604">.</span><span class="op" id="6398605">(</span><span class="op" id="6398606">[</span><span class="op" id="6398607">]</span><span class="builtintype" id="6398608">byte</span><span class="op" id="6398612">)</span><span class="op" id="6398613">;</span>&nbsp;<span class="ident" id="6398615">ok</span>&nbsp;<span class="op" id="6398618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398625">if</span>&nbsp;<span class="ident" id="6398628">err</span>&nbsp;<span class="op" id="6398632">:=</span>&nbsp;<span class="ident" id="6398635">EscapeText</span><span class="op" id="6398645">(</span><span class="ident" id="6398646">p</span><span class="op" id="6398647">,</span>&nbsp;<span class="ident" id="6398649">elem</span><span class="op" id="6398653">)</span><span class="op" id="6398654">;</span>&nbsp;<span class="ident" id="6398656">err</span>&nbsp;<span class="op" id="6398660">!=</span>&nbsp;<span class="ident" id="6398663">nil</span>&nbsp;<span class="op" id="6398667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398675">return</span>&nbsp;<span class="ident" id="6398682">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398691">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398707">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398719">case</span>&nbsp;<span class="ident" id="6398724">fComment</span><span class="op" id="6398732">:</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398737">k</span>&nbsp;<span class="op" id="6398739">:=</span>&nbsp;<span class="ident" id="6398742">vf</span><span class="op" id="6398744">.</span><span class="ident" id="6398745">Kind</span><span class="op" id="6398749">(</span><span class="op" id="6398750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398755">if</span>&nbsp;<span class="op" id="6398758">!</span><span class="op" id="6398759">(</span><span class="ident" id="6398760">k</span>&nbsp;<span class="op" id="6398762">==</span>&nbsp;<span class="ident" id="6398765">reflect</span><span class="op" id="6398772">.</span><span class="ident" id="6398773">String</span>&nbsp;<span class="op" id="6398780">||</span>&nbsp;<span class="ident" id="6398783">k</span>&nbsp;<span class="op" id="6398785">==</span>&nbsp;<span class="ident" id="6398788">reflect</span><span class="op" id="6398795">.</span><span class="ident" id="6398796">Slice</span>&nbsp;<span class="op" id="6398802">&amp;&amp;</span>&nbsp;<span class="ident" id="6398805">vf</span><span class="op" id="6398807">.</span><span class="ident" id="6398808">Type</span><span class="op" id="6398812">(</span><span class="op" id="6398813">)</span><span class="op" id="6398814">.</span><span class="ident" id="6398815">Elem</span><span class="op" id="6398819">(</span><span class="op" id="6398820">)</span><span class="op" id="6398821">.</span><span class="ident" id="6398822">Kind</span><span class="op" id="6398826">(</span><span class="op" id="6398827">)</span>&nbsp;<span class="op" id="6398829">==</span>&nbsp;<span class="ident" id="6398832">reflect</span><span class="op" id="6398839">.</span><span class="ident" id="6398840">Uint8</span><span class="op" id="6398845">)</span>&nbsp;<span class="op" id="6398847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398853">return</span>&nbsp;<span class="ident" id="6398860">fmt</span><span class="op" id="6398863">.</span><span class="ident" id="6398864">Errorf</span><span class="op" id="6398870">(</span><span class="string" id="6398871">&#34;xml:&nbsp;bad&nbsp;type&nbsp;for&nbsp;comment&nbsp;field&nbsp;of&nbsp;%s&#34;</span><span class="op" id="6398910">,</span>&nbsp;<span class="ident" id="6398912">val</span><span class="op" id="6398915">.</span><span class="ident" id="6398916">Type</span><span class="op" id="6398920">(</span><span class="op" id="6398921">)</span><span class="op" id="6398922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398932">if</span>&nbsp;<span class="ident" id="6398935">vf</span><span class="op" id="6398937">.</span><span class="ident" id="6398938">Len</span><span class="op" id="6398941">(</span><span class="op" id="6398942">)</span>&nbsp;<span class="op" id="6398944">==</span>&nbsp;<span class="num" id="6398947">0</span>&nbsp;<span class="op" id="6398949">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398955">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398972">p</span><span class="op" id="6398973">.</span><span class="ident" id="6398974">writeIndent</span><span class="op" id="6398985">(</span><span class="num" id="6398986">0</span><span class="op" id="6398987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398992">p</span><span class="op" id="6398993">.</span><span class="ident" id="6398994">WriteString</span><span class="op" id="6399005">(</span><span class="string" id="6399006">&#34;&lt;!--&#34;</span><span class="op" id="6399012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399017">dashDash</span>&nbsp;<span class="op" id="6399026">:=</span>&nbsp;<span class="builtintype" id="6399029">false</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399038">dashLast</span>&nbsp;<span class="op" id="6399047">:=</span>&nbsp;<span class="builtintype" id="6399050">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399059">switch</span>&nbsp;<span class="ident" id="6399066">k</span>&nbsp;<span class="op" id="6399068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399073">case</span>&nbsp;<span class="ident" id="6399078">reflect</span><span class="op" id="6399085">.</span><span class="ident" id="6399086">String</span><span class="op" id="6399092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399098">s</span>&nbsp;<span class="op" id="6399100">:=</span>&nbsp;<span class="ident" id="6399103">vf</span><span class="op" id="6399105">.</span><span class="ident" id="6399106">String</span><span class="op" id="6399112">(</span><span class="op" id="6399113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399119">dashDash</span>&nbsp;<span class="op" id="6399128">=</span>&nbsp;<span class="ident" id="6399130">strings</span><span class="op" id="6399137">.</span><span class="ident" id="6399138">Index</span><span class="op" id="6399143">(</span><span class="ident" id="6399144">s</span><span class="op" id="6399145">,</span>&nbsp;<span class="string" id="6399147">&#34;--&#34;</span><span class="op" id="6399151">)</span>&nbsp;<span class="op" id="6399153">&gt;=</span>&nbsp;<span class="num" id="6399156">0</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399162">dashLast</span>&nbsp;<span class="op" id="6399171">=</span>&nbsp;<span class="ident" id="6399173">s</span><span class="op" id="6399174">[</span><span class="builtinfunc" id="6399175">len</span><span class="op" id="6399178">(</span><span class="ident" id="6399179">s</span><span class="op" id="6399180">)</span><span class="op" id="6399181">-</span><span class="num" id="6399182">1</span><span class="op" id="6399183">]</span>&nbsp;<span class="op" id="6399185">==</span>&nbsp;<span class="string" id="6399188">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399196">if</span>&nbsp;<span class="op" id="6399199">!</span><span class="ident" id="6399200">dashDash</span>&nbsp;<span class="op" id="6399209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399216">p</span><span class="op" id="6399217">.</span><span class="ident" id="6399218">WriteString</span><span class="op" id="6399229">(</span><span class="ident" id="6399230">s</span><span class="op" id="6399231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399242">case</span>&nbsp;<span class="ident" id="6399247">reflect</span><span class="op" id="6399254">.</span><span class="ident" id="6399255">Slice</span><span class="op" id="6399260">:</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399266">b</span>&nbsp;<span class="op" id="6399268">:=</span>&nbsp;<span class="ident" id="6399271">vf</span><span class="op" id="6399273">.</span><span class="ident" id="6399274">Bytes</span><span class="op" id="6399279">(</span><span class="op" id="6399280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399286">dashDash</span>&nbsp;<span class="op" id="6399295">=</span>&nbsp;<span class="ident" id="6399297">bytes</span><span class="op" id="6399302">.</span><span class="ident" id="6399303">Index</span><span class="op" id="6399308">(</span><span class="ident" id="6399309">b</span><span class="op" id="6399310">,</span>&nbsp;<span class="ident" id="6399312">ddBytes</span><span class="op" id="6399319">)</span>&nbsp;<span class="op" id="6399321">&gt;=</span>&nbsp;<span class="num" id="6399324">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399330">dashLast</span>&nbsp;<span class="op" id="6399339">=</span>&nbsp;<span class="ident" id="6399341">b</span><span class="op" id="6399342">[</span><span class="builtinfunc" id="6399343">len</span><span class="op" id="6399346">(</span><span class="ident" id="6399347">b</span><span class="op" id="6399348">)</span><span class="op" id="6399349">-</span><span class="num" id="6399350">1</span><span class="op" id="6399351">]</span>&nbsp;<span class="op" id="6399353">==</span>&nbsp;<span class="string" id="6399356">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399364">if</span>&nbsp;<span class="op" id="6399367">!</span><span class="ident" id="6399368">dashDash</span>&nbsp;<span class="op" id="6399377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399384">p</span><span class="op" id="6399385">.</span><span class="ident" id="6399386">Write</span><span class="op" id="6399391">(</span><span class="ident" id="6399392">b</span><span class="op" id="6399393">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399404">default</span><span class="op" id="6399411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6399417">panic</span><span class="op" id="6399422">(</span><span class="string" id="6399423">&#34;can&#39;t&nbsp;happen&#34;</span><span class="op" id="6399437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399447">if</span>&nbsp;<span class="ident" id="6399450">dashDash</span>&nbsp;<span class="op" id="6399459">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399465">return</span>&nbsp;<span class="ident" id="6399472">fmt</span><span class="op" id="6399475">.</span><span class="ident" id="6399476">Errorf</span><span class="op" id="6399482">(</span><span class="string" id="6399483">`xml:&nbsp;comments&nbsp;must&nbsp;not&nbsp;contain&nbsp;&#34;--&#34;`</span><span class="op" id="6399520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399530">if</span>&nbsp;<span class="ident" id="6399533">dashLast</span>&nbsp;<span class="op" id="6399542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399548">//&nbsp;&#34;---&gt;&#34;&nbsp;is&nbsp;invalid&nbsp;grammar.&nbsp;Make&nbsp;it&nbsp;&#34;-&nbsp;--&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399598">p</span><span class="op" id="6399599">.</span><span class="ident" id="6399600">WriteByte</span><span class="op" id="6399609">(</span><span class="string" id="6399610">&#39;&nbsp;&#39;</span><span class="op" id="6399613">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399623">p</span><span class="op" id="6399624">.</span><span class="ident" id="6399625">WriteString</span><span class="op" id="6399636">(</span><span class="string" id="6399637">&#34;--&gt;&#34;</span><span class="op" id="6399642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399647">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399659">case</span>&nbsp;<span class="ident" id="6399664">fInnerXml</span><span class="op" id="6399673">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399678">iface</span>&nbsp;<span class="op" id="6399684">:=</span>&nbsp;<span class="ident" id="6399687">vf</span><span class="op" id="6399689">.</span><span class="ident" id="6399690">Interface</span><span class="op" id="6399699">(</span><span class="op" id="6399700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399705">switch</span>&nbsp;<span class="ident" id="6399712">raw</span>&nbsp;<span class="op" id="6399716">:=</span>&nbsp;<span class="ident" id="6399719">iface</span><span class="op" id="6399724">.</span><span class="op" id="6399725">(</span><span class="keyword" id="6399726">type</span><span class="op" id="6399730">)</span>&nbsp;<span class="op" id="6399732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399737">case</span>&nbsp;<span class="op" id="6399742">[</span><span class="op" id="6399743">]</span><span class="builtintype" id="6399744">byte</span><span class="op" id="6399748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399754">p</span><span class="op" id="6399755">.</span><span class="ident" id="6399756">Write</span><span class="op" id="6399761">(</span><span class="ident" id="6399762">raw</span><span class="op" id="6399765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399771">continue</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399783">case</span>&nbsp;<span class="builtintype" id="6399788">string</span><span class="op" id="6399794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399800">p</span><span class="op" id="6399801">.</span><span class="ident" id="6399802">WriteString</span><span class="op" id="6399813">(</span><span class="ident" id="6399814">raw</span><span class="op" id="6399817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399823">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399840">case</span>&nbsp;<span class="ident" id="6399845">fElement</span><span class="op" id="6399853">,</span>&nbsp;<span class="ident" id="6399855">fElement</span>&nbsp;<span class="op" id="6399864">|</span>&nbsp;<span class="ident" id="6399866">fAny</span><span class="op" id="6399870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399875">if</span>&nbsp;<span class="ident" id="6399878">err</span>&nbsp;<span class="op" id="6399882">:=</span>&nbsp;<span class="ident" id="6399885">s</span><span class="op" id="6399886">.</span><span class="ident" id="6399887">trim</span><span class="op" id="6399891">(</span><span class="ident" id="6399892">finfo</span><span class="op" id="6399897">.</span><span class="ident" id="6399898">parents</span><span class="op" id="6399905">)</span><span class="op" id="6399906">;</span>&nbsp;<span class="ident" id="6399908">err</span>&nbsp;<span class="op" id="6399912">!=</span>&nbsp;<span class="ident" id="6399915">nil</span>&nbsp;<span class="op" id="6399919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399925">return</span>&nbsp;<span class="ident" id="6399932">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399944">if</span>&nbsp;<span class="builtinfunc" id="6399947">len</span><span class="op" id="6399950">(</span><span class="ident" id="6399951">finfo</span><span class="op" id="6399956">.</span><span class="ident" id="6399957">parents</span><span class="op" id="6399964">)</span>&nbsp;<span class="op" id="6399966">&gt;</span>&nbsp;<span class="builtinfunc" id="6399968">len</span><span class="op" id="6399971">(</span><span class="ident" id="6399972">s</span><span class="op" id="6399973">.</span><span class="ident" id="6399974">stack</span><span class="op" id="6399979">)</span>&nbsp;<span class="op" id="6399981">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399987">if</span>&nbsp;<span class="ident" id="6399990">vf</span><span class="op" id="6399992">.</span><span class="ident" id="6399993">Kind</span><span class="op" id="6399997">(</span><span class="op" id="6399998">)</span>&nbsp;<span class="op" id="6400000">!=</span>&nbsp;<span class="ident" id="6400003">reflect</span><span class="op" id="6400010">.</span><span class="ident" id="6400011">Ptr</span>&nbsp;<span class="op" id="6400015">&amp;&amp;</span>&nbsp;<span class="ident" id="6400018">vf</span><span class="op" id="6400020">.</span><span class="ident" id="6400021">Kind</span><span class="op" id="6400025">(</span><span class="op" id="6400026">)</span>&nbsp;<span class="op" id="6400028">!=</span>&nbsp;<span class="ident" id="6400031">reflect</span><span class="op" id="6400038">.</span><span class="ident" id="6400039">Interface</span>&nbsp;<span class="op" id="6400049">||</span>&nbsp;<span class="op" id="6400052">!</span><span class="ident" id="6400053">vf</span><span class="op" id="6400055">.</span><span class="ident" id="6400056">IsNil</span><span class="op" id="6400061">(</span><span class="op" id="6400062">)</span>&nbsp;<span class="op" id="6400064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400071">if</span>&nbsp;<span class="ident" id="6400074">err</span>&nbsp;<span class="op" id="6400078">:=</span>&nbsp;<span class="ident" id="6400081">s</span><span class="op" id="6400082">.</span><span class="ident" id="6400083">push</span><span class="op" id="6400087">(</span><span class="ident" id="6400088">finfo</span><span class="op" id="6400093">.</span><span class="ident" id="6400094">parents</span><span class="op" id="6400101">[</span><span class="builtinfunc" id="6400102">len</span><span class="op" id="6400105">(</span><span class="ident" id="6400106">s</span><span class="op" id="6400107">.</span><span class="ident" id="6400108">stack</span><span class="op" id="6400113">)</span><span class="op" id="6400114">:</span><span class="op" id="6400115">]</span><span class="op" id="6400116">)</span><span class="op" id="6400117">;</span>&nbsp;<span class="ident" id="6400119">err</span>&nbsp;<span class="op" id="6400123">!=</span>&nbsp;<span class="ident" id="6400126">nil</span>&nbsp;<span class="op" id="6400130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400138">return</span>&nbsp;<span class="ident" id="6400145">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400160">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400173">if</span>&nbsp;<span class="ident" id="6400176">err</span>&nbsp;<span class="op" id="6400180">:=</span>&nbsp;<span class="ident" id="6400183">p</span><span class="op" id="6400184">.</span><span class="ident" id="6400185">marshalValue</span><span class="op" id="6400197">(</span><span class="ident" id="6400198">vf</span><span class="op" id="6400200">,</span>&nbsp;<span class="ident" id="6400202">finfo</span><span class="op" id="6400207">,</span>&nbsp;<span class="ident" id="6400209">nil</span><span class="op" id="6400212">)</span><span class="op" id="6400213">;</span>&nbsp;<span class="ident" id="6400215">err</span>&nbsp;<span class="op" id="6400219">!=</span>&nbsp;<span class="ident" id="6400222">nil</span>&nbsp;<span class="op" id="6400226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400231">return</span>&nbsp;<span class="ident" id="6400238">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400244">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400250">s</span><span class="op" id="6400251">.</span><span class="ident" id="6400252">trim</span><span class="op" id="6400256">(</span><span class="ident" id="6400257">nil</span><span class="op" id="6400260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400263">return</span>&nbsp;<span class="ident" id="6400270">p</span><span class="op" id="6400271">.</span><span class="ident" id="6400272">cachedWriteError</span><span class="op" id="6400288">(</span><span class="op" id="6400289">)</span><br>
<span class="lineno"></span><span class="op" id="6400291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="6400294">//&nbsp;return&nbsp;the&nbsp;bufio&nbsp;Writer&#39;s&nbsp;cached&nbsp;write&nbsp;error</span><br>
<span class="lineno"></span><span class="keyword" id="6400342">func</span>&nbsp;<span class="op" id="6400347">(</span><span class="ident" id="6400348">p</span>&nbsp;<span class="op" id="6400350">*</span><span class="ident" id="6400351">printer</span><span class="op" id="6400358">)</span>&nbsp;<span class="ident" id="6400360">cachedWriteError</span><span class="op" id="6400376">(</span><span class="op" id="6400377">)</span>&nbsp;<span class="builtintype" id="6400379">error</span>&nbsp;<span class="op" id="6400385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400388">_</span><span class="op" id="6400389">,</span>&nbsp;<span class="ident" id="6400391">err</span>&nbsp;<span class="op" id="6400395">:=</span>&nbsp;<span class="ident" id="6400398">p</span><span class="op" id="6400399">.</span><span class="ident" id="6400400">Write</span><span class="op" id="6400405">(</span><span class="ident" id="6400406">nil</span><span class="op" id="6400409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400412">return</span>&nbsp;<span class="ident" id="6400419">err</span><br>
<span class="lineno"></span><span class="op" id="6400423">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="6400426">func</span>&nbsp;<span class="op" id="6400431">(</span><span class="ident" id="6400432">p</span>&nbsp;<span class="op" id="6400434">*</span><span class="ident" id="6400435">printer</span><span class="op" id="6400442">)</span>&nbsp;<span class="ident" id="6400444">writeIndent</span><span class="op" id="6400455">(</span><span class="ident" id="6400456">depthDelta</span>&nbsp;<span class="builtintype" id="6400467">int</span><span class="op" id="6400470">)</span>&nbsp;<span class="op" id="6400472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400475">if</span>&nbsp;<span class="builtinfunc" id="6400478">len</span><span class="op" id="6400481">(</span><span class="ident" id="6400482">p</span><span class="op" id="6400483">.</span><span class="ident" id="6400484">prefix</span><span class="op" id="6400490">)</span>&nbsp;<span class="op" id="6400492">==</span>&nbsp;<span class="num" id="6400495">0</span>&nbsp;<span class="op" id="6400497">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6400500">len</span><span class="op" id="6400503">(</span><span class="ident" id="6400504">p</span><span class="op" id="6400505">.</span><span class="ident" id="6400506">indent</span><span class="op" id="6400512">)</span>&nbsp;<span class="op" id="6400514">==</span>&nbsp;<span class="num" id="6400517">0</span>&nbsp;<span class="op" id="6400519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400523">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400531">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400534">if</span>&nbsp;<span class="ident" id="6400537">depthDelta</span>&nbsp;<span class="op" id="6400548">&lt;</span>&nbsp;<span class="num" id="6400550">0</span>&nbsp;<span class="op" id="6400552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400556">p</span><span class="op" id="6400557">.</span><span class="ident" id="6400558">depth</span><span class="op" id="6400563">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400568">if</span>&nbsp;<span class="ident" id="6400571">p</span><span class="op" id="6400572">.</span><span class="ident" id="6400573">indentedIn</span>&nbsp;<span class="op" id="6400584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400589">p</span><span class="op" id="6400590">.</span><span class="ident" id="6400591">indentedIn</span>&nbsp;<span class="op" id="6400602">=</span>&nbsp;<span class="builtintype" id="6400604">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400613">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400626">p</span><span class="op" id="6400627">.</span><span class="ident" id="6400628">indentedIn</span>&nbsp;<span class="op" id="6400639">=</span>&nbsp;<span class="builtintype" id="6400641">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400651">if</span>&nbsp;<span class="ident" id="6400654">p</span><span class="op" id="6400655">.</span><span class="ident" id="6400656">putNewline</span>&nbsp;<span class="op" id="6400667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400671">p</span><span class="op" id="6400672">.</span><span class="ident" id="6400673">WriteByte</span><span class="op" id="6400682">(</span><span class="string" id="6400683">&#39;\n&#39;</span><span class="op" id="6400687">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400690">}</span>&nbsp;<span class="keyword" id="6400692">else</span>&nbsp;<span class="op" id="6400697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400701">p</span><span class="op" id="6400702">.</span><span class="ident" id="6400703">putNewline</span>&nbsp;<span class="op" id="6400714">=</span>&nbsp;<span class="builtintype" id="6400716">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400725">if</span>&nbsp;<span class="builtinfunc" id="6400728">len</span><span class="op" id="6400731">(</span><span class="ident" id="6400732">p</span><span class="op" id="6400733">.</span><span class="ident" id="6400734">prefix</span><span class="op" id="6400740">)</span>&nbsp;<span class="op" id="6400742">&gt;</span>&nbsp;<span class="num" id="6400744">0</span>&nbsp;<span class="op" id="6400746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400750">p</span><span class="op" id="6400751">.</span><span class="ident" id="6400752">WriteString</span><span class="op" id="6400763">(</span><span class="ident" id="6400764">p</span><span class="op" id="6400765">.</span><span class="ident" id="6400766">prefix</span><span class="op" id="6400772">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400778">if</span>&nbsp;<span class="builtinfunc" id="6400781">len</span><span class="op" id="6400784">(</span><span class="ident" id="6400785">p</span><span class="op" id="6400786">.</span><span class="ident" id="6400787">indent</span><span class="op" id="6400793">)</span>&nbsp;<span class="op" id="6400795">&gt;</span>&nbsp;<span class="num" id="6400797">0</span>&nbsp;<span class="op" id="6400799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400803">for</span>&nbsp;<span class="ident" id="6400807">i</span>&nbsp;<span class="op" id="6400809">:=</span>&nbsp;<span class="num" id="6400812">0</span><span class="op" id="6400813">;</span>&nbsp;<span class="ident" id="6400815">i</span>&nbsp;<span class="op" id="6400817">&lt;</span>&nbsp;<span class="ident" id="6400819">p</span><span class="op" id="6400820">.</span><span class="ident" id="6400821">depth</span><span class="op" id="6400826">;</span>&nbsp;<span class="ident" id="6400828">i</span><span class="op" id="6400829">++</span>&nbsp;<span class="op" id="6400832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400837">p</span><span class="op" id="6400838">.</span><span class="ident" id="6400839">WriteString</span><span class="op" id="6400850">(</span><span class="ident" id="6400851">p</span><span class="op" id="6400852">.</span><span class="ident" id="6400853">indent</span><span class="op" id="6400859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400863">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400869">if</span>&nbsp;<span class="ident" id="6400872">depthDelta</span>&nbsp;<span class="op" id="6400883">&gt;</span>&nbsp;<span class="num" id="6400885">0</span>&nbsp;<span class="op" id="6400887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400891">p</span><span class="op" id="6400892">.</span><span class="ident" id="6400893">depth</span><span class="op" id="6400898">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400903">p</span><span class="op" id="6400904">.</span><span class="ident" id="6400905">indentedIn</span>&nbsp;<span class="op" id="6400916">=</span>&nbsp;<span class="builtintype" id="6400918">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400924">}</span><br>
<span class="lineno">875</span><span class="op" id="6400926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6400929">type</span>&nbsp;<span class="ident" id="6400934">parentStack</span>&nbsp;<span class="keyword" id="6400946">struct</span>&nbsp;<span class="op" id="6400953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400956">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6400962">*</span><span class="ident" id="6400963">printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400972">stack</span>&nbsp;<span class="op" id="6400978">[</span><span class="op" id="6400979">]</span><span class="builtintype" id="6400980">string</span><br>
<span class="lineno">880</span><span class="op" id="6400987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6400990">//&nbsp;trim&nbsp;updates&nbsp;the&nbsp;XML&nbsp;context&nbsp;to&nbsp;match&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="6401070">//&nbsp;and&nbsp;the&nbsp;given&nbsp;parents.&nbsp;&nbsp;A&nbsp;closing&nbsp;tag&nbsp;will&nbsp;be&nbsp;written&nbsp;for&nbsp;every&nbsp;parent</span><br>
<span class="lineno"></span><span class="comment" id="6401144">//&nbsp;popped.&nbsp;&nbsp;Passing&nbsp;a&nbsp;zero&nbsp;slice&nbsp;or&nbsp;nil&nbsp;will&nbsp;close&nbsp;all&nbsp;the&nbsp;elements.</span><br>
<span class="lineno">885</span><span class="keyword" id="6401213">func</span>&nbsp;<span class="op" id="6401218">(</span><span class="ident" id="6401219">s</span>&nbsp;<span class="op" id="6401221">*</span><span class="ident" id="6401222">parentStack</span><span class="op" id="6401233">)</span>&nbsp;<span class="ident" id="6401235">trim</span><span class="op" id="6401239">(</span><span class="ident" id="6401240">parents</span>&nbsp;<span class="op" id="6401248">[</span><span class="op" id="6401249">]</span><span class="builtintype" id="6401250">string</span><span class="op" id="6401256">)</span>&nbsp;<span class="builtintype" id="6401258">error</span>&nbsp;<span class="op" id="6401264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401267">split</span>&nbsp;<span class="op" id="6401273">:=</span>&nbsp;<span class="num" id="6401276">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401279">for</span>&nbsp;<span class="op" id="6401283">;</span>&nbsp;<span class="ident" id="6401285">split</span>&nbsp;<span class="op" id="6401291">&lt;</span>&nbsp;<span class="builtinfunc" id="6401293">len</span><span class="op" id="6401296">(</span><span class="ident" id="6401297">parents</span><span class="op" id="6401304">)</span>&nbsp;<span class="op" id="6401306">&amp;&amp;</span>&nbsp;<span class="ident" id="6401309">split</span>&nbsp;<span class="op" id="6401315">&lt;</span>&nbsp;<span class="builtinfunc" id="6401317">len</span><span class="op" id="6401320">(</span><span class="ident" id="6401321">s</span><span class="op" id="6401322">.</span><span class="ident" id="6401323">stack</span><span class="op" id="6401328">)</span><span class="op" id="6401329">;</span>&nbsp;<span class="ident" id="6401331">split</span><span class="op" id="6401336">++</span>&nbsp;<span class="op" id="6401339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401343">if</span>&nbsp;<span class="ident" id="6401346">parents</span><span class="op" id="6401353">[</span><span class="ident" id="6401354">split</span><span class="op" id="6401359">]</span>&nbsp;<span class="op" id="6401361">!=</span>&nbsp;<span class="ident" id="6401364">s</span><span class="op" id="6401365">.</span><span class="ident" id="6401366">stack</span><span class="op" id="6401371">[</span><span class="ident" id="6401372">split</span><span class="op" id="6401377">]</span>&nbsp;<span class="op" id="6401379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401384">break</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401398">for</span>&nbsp;<span class="ident" id="6401402">i</span>&nbsp;<span class="op" id="6401404">:=</span>&nbsp;<span class="builtinfunc" id="6401407">len</span><span class="op" id="6401410">(</span><span class="ident" id="6401411">s</span><span class="op" id="6401412">.</span><span class="ident" id="6401413">stack</span><span class="op" id="6401418">)</span>&nbsp;<span class="op" id="6401420">-</span>&nbsp;<span class="num" id="6401422">1</span><span class="op" id="6401423">;</span>&nbsp;<span class="ident" id="6401425">i</span>&nbsp;<span class="op" id="6401427">&gt;=</span>&nbsp;<span class="ident" id="6401430">split</span><span class="op" id="6401435">;</span>&nbsp;<span class="ident" id="6401437">i</span><span class="op" id="6401438">--</span>&nbsp;<span class="op" id="6401441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401445">if</span>&nbsp;<span class="ident" id="6401448">err</span>&nbsp;<span class="op" id="6401452">:=</span>&nbsp;<span class="ident" id="6401455">s</span><span class="op" id="6401456">.</span><span class="ident" id="6401457">p</span><span class="op" id="6401458">.</span><span class="ident" id="6401459">writeEnd</span><span class="op" id="6401467">(</span><span class="ident" id="6401468">Name</span><span class="op" id="6401472">{</span><span class="ident" id="6401473">Local</span><span class="op" id="6401478">:</span>&nbsp;<span class="ident" id="6401480">s</span><span class="op" id="6401481">.</span><span class="ident" id="6401482">stack</span><span class="op" id="6401487">[</span><span class="ident" id="6401488">i</span><span class="op" id="6401489">]</span><span class="op" id="6401490">}</span><span class="op" id="6401491">)</span><span class="op" id="6401492">;</span>&nbsp;<span class="ident" id="6401494">err</span>&nbsp;<span class="op" id="6401498">!=</span>&nbsp;<span class="ident" id="6401501">nil</span>&nbsp;<span class="op" id="6401505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401510">return</span>&nbsp;<span class="ident" id="6401517">err</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401529">s</span><span class="op" id="6401530">.</span><span class="ident" id="6401531">stack</span>&nbsp;<span class="op" id="6401537">=</span>&nbsp;<span class="ident" id="6401539">parents</span><span class="op" id="6401546">[</span><span class="op" id="6401547">:</span><span class="ident" id="6401548">split</span><span class="op" id="6401553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401556">return</span>&nbsp;<span class="ident" id="6401563">nil</span><br>
<span class="lineno"></span><span class="op" id="6401567">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span><span class="comment" id="6401570">//&nbsp;push&nbsp;adds&nbsp;parent&nbsp;elements&nbsp;to&nbsp;the&nbsp;stack&nbsp;and&nbsp;writes&nbsp;open&nbsp;tags.</span><br>
<span class="lineno"></span><span class="keyword" id="6401634">func</span>&nbsp;<span class="op" id="6401639">(</span><span class="ident" id="6401640">s</span>&nbsp;<span class="op" id="6401642">*</span><span class="ident" id="6401643">parentStack</span><span class="op" id="6401654">)</span>&nbsp;<span class="ident" id="6401656">push</span><span class="op" id="6401660">(</span><span class="ident" id="6401661">parents</span>&nbsp;<span class="op" id="6401669">[</span><span class="op" id="6401670">]</span><span class="builtintype" id="6401671">string</span><span class="op" id="6401677">)</span>&nbsp;<span class="builtintype" id="6401679">error</span>&nbsp;<span class="op" id="6401685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401688">for</span>&nbsp;<span class="ident" id="6401692">i</span>&nbsp;<span class="op" id="6401694">:=</span>&nbsp;<span class="num" id="6401697">0</span><span class="op" id="6401698">;</span>&nbsp;<span class="ident" id="6401700">i</span>&nbsp;<span class="op" id="6401702">&lt;</span>&nbsp;<span class="builtinfunc" id="6401704">len</span><span class="op" id="6401707">(</span><span class="ident" id="6401708">parents</span><span class="op" id="6401715">)</span><span class="op" id="6401716">;</span>&nbsp;<span class="ident" id="6401718">i</span><span class="op" id="6401719">++</span>&nbsp;<span class="op" id="6401722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401726">if</span>&nbsp;<span class="ident" id="6401729">err</span>&nbsp;<span class="op" id="6401733">:=</span>&nbsp;<span class="ident" id="6401736">s</span><span class="op" id="6401737">.</span><span class="ident" id="6401738">p</span><span class="op" id="6401739">.</span><span class="ident" id="6401740">writeStart</span><span class="op" id="6401750">(</span><span class="op" id="6401751">&amp;</span><span class="ident" id="6401752">StartElement</span><span class="op" id="6401764">{</span><span class="ident" id="6401765">Name</span><span class="op" id="6401769">:</span>&nbsp;<span class="ident" id="6401771">Name</span><span class="op" id="6401775">{</span><span class="ident" id="6401776">Local</span><span class="op" id="6401781">:</span>&nbsp;<span class="ident" id="6401783">parents</span><span class="op" id="6401790">[</span><span class="ident" id="6401791">i</span><span class="op" id="6401792">]</span><span class="op" id="6401793">}</span><span class="op" id="6401794">}</span><span class="op" id="6401795">)</span><span class="op" id="6401796">;</span>&nbsp;<span class="ident" id="6401798">err</span>&nbsp;<span class="op" id="6401802">!=</span>&nbsp;<span class="ident" id="6401805">nil</span>&nbsp;<span class="op" id="6401809">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401814">return</span>&nbsp;<span class="ident" id="6401821">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401833">s</span><span class="op" id="6401834">.</span><span class="ident" id="6401835">stack</span>&nbsp;<span class="op" id="6401841">=</span>&nbsp;<span class="builtinfunc" id="6401843">append</span><span class="op" id="6401849">(</span><span class="ident" id="6401850">s</span><span class="op" id="6401851">.</span><span class="ident" id="6401852">stack</span><span class="op" id="6401857">,</span>&nbsp;<span class="ident" id="6401859">parents</span><span class="op" id="6401866">...</span><span class="op" id="6401869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401872">return</span>&nbsp;<span class="ident" id="6401879">nil</span><br>
<span class="lineno">910</span><span class="op" id="6401883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401886">//&nbsp;A&nbsp;MarshalXMLError&nbsp;is&nbsp;returned&nbsp;when&nbsp;Marshal&nbsp;encounters&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="6401950">//&nbsp;that&nbsp;cannot&nbsp;be&nbsp;converted&nbsp;into&nbsp;XML.</span><br>
<span class="lineno"></span><span class="keyword" id="6401988">type</span>&nbsp;<span class="ident" id="6401993">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="6402014">struct</span>&nbsp;<span class="op" id="6402021">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402024">Type</span>&nbsp;<span class="ident" id="6402029">reflect</span><span class="op" id="6402036">.</span><span class="ident" id="6402037">Type</span><br>
<span class="lineno"></span><span class="op" id="6402042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6402045">func</span>&nbsp;<span class="op" id="6402050">(</span><span class="ident" id="6402051">e</span>&nbsp;<span class="op" id="6402053">*</span><span class="ident" id="6402054">UnsupportedTypeError</span><span class="op" id="6402074">)</span>&nbsp;<span class="ident" id="6402076">Error</span><span class="op" id="6402081">(</span><span class="op" id="6402082">)</span>&nbsp;<span class="builtintype" id="6402084">string</span>&nbsp;<span class="op" id="6402091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402094">return</span>&nbsp;<span class="string" id="6402101">&#34;xml:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="6402127">+</span>&nbsp;<span class="ident" id="6402129">e</span><span class="op" id="6402130">.</span><span class="ident" id="6402131">Type</span><span class="op" id="6402135">.</span><span class="ident" id="6402136">String</span><span class="op" id="6402142">(</span><span class="op" id="6402143">)</span><br>
<span class="lineno">920</span><span class="op" id="6402145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6402148">func</span>&nbsp;<span class="ident" id="6402153">isEmptyValue</span><span class="op" id="6402165">(</span><span class="ident" id="6402166">v</span>&nbsp;<span class="ident" id="6402168">reflect</span><span class="op" id="6402175">.</span><span class="ident" id="6402176">Value</span><span class="op" id="6402181">)</span>&nbsp;<span class="builtintype" id="6402183">bool</span>&nbsp;<span class="op" id="6402188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402191">switch</span>&nbsp;<span class="ident" id="6402198">v</span><span class="op" id="6402199">.</span><span class="ident" id="6402200">Kind</span><span class="op" id="6402204">(</span><span class="op" id="6402205">)</span>&nbsp;<span class="op" id="6402207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402210">case</span>&nbsp;<span class="ident" id="6402215">reflect</span><span class="op" id="6402222">.</span><span class="ident" id="6402223">Array</span><span class="op" id="6402228">,</span>&nbsp;<span class="ident" id="6402230">reflect</span><span class="op" id="6402237">.</span><span class="ident" id="6402238">Map</span><span class="op" id="6402241">,</span>&nbsp;<span class="ident" id="6402243">reflect</span><span class="op" id="6402250">.</span><span class="ident" id="6402251">Slice</span><span class="op" id="6402256">,</span>&nbsp;<span class="ident" id="6402258">reflect</span><span class="op" id="6402265">.</span><span class="ident" id="6402266">String</span><span class="op" id="6402272">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402276">return</span>&nbsp;<span class="ident" id="6402283">v</span><span class="op" id="6402284">.</span><span class="ident" id="6402285">Len</span><span class="op" id="6402288">(</span><span class="op" id="6402289">)</span>&nbsp;<span class="op" id="6402291">==</span>&nbsp;<span class="num" id="6402294">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402297">case</span>&nbsp;<span class="ident" id="6402302">reflect</span><span class="op" id="6402309">.</span><span class="ident" id="6402310">Bool</span><span class="op" id="6402314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402318">return</span>&nbsp;<span class="op" id="6402325">!</span><span class="ident" id="6402326">v</span><span class="op" id="6402327">.</span><span class="ident" id="6402328">Bool</span><span class="op" id="6402332">(</span><span class="op" id="6402333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402336">case</span>&nbsp;<span class="ident" id="6402341">reflect</span><span class="op" id="6402348">.</span><span class="ident" id="6402349">Int</span><span class="op" id="6402352">,</span>&nbsp;<span class="ident" id="6402354">reflect</span><span class="op" id="6402361">.</span><span class="ident" id="6402362">Int8</span><span class="op" id="6402366">,</span>&nbsp;<span class="ident" id="6402368">reflect</span><span class="op" id="6402375">.</span><span class="ident" id="6402376">Int16</span><span class="op" id="6402381">,</span>&nbsp;<span class="ident" id="6402383">reflect</span><span class="op" id="6402390">.</span><span class="ident" id="6402391">Int32</span><span class="op" id="6402396">,</span>&nbsp;<span class="ident" id="6402398">reflect</span><span class="op" id="6402405">.</span><span class="ident" id="6402406">Int64</span><span class="op" id="6402411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402415">return</span>&nbsp;<span class="ident" id="6402422">v</span><span class="op" id="6402423">.</span><span class="ident" id="6402424">Int</span><span class="op" id="6402427">(</span><span class="op" id="6402428">)</span>&nbsp;<span class="op" id="6402430">==</span>&nbsp;<span class="num" id="6402433">0</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402436">case</span>&nbsp;<span class="ident" id="6402441">reflect</span><span class="op" id="6402448">.</span><span class="ident" id="6402449">Uint</span><span class="op" id="6402453">,</span>&nbsp;<span class="ident" id="6402455">reflect</span><span class="op" id="6402462">.</span><span class="ident" id="6402463">Uint8</span><span class="op" id="6402468">,</span>&nbsp;<span class="ident" id="6402470">reflect</span><span class="op" id="6402477">.</span><span class="ident" id="6402478">Uint16</span><span class="op" id="6402484">,</span>&nbsp;<span class="ident" id="6402486">reflect</span><span class="op" id="6402493">.</span><span class="ident" id="6402494">Uint32</span><span class="op" id="6402500">,</span>&nbsp;<span class="ident" id="6402502">reflect</span><span class="op" id="6402509">.</span><span class="ident" id="6402510">Uint64</span><span class="op" id="6402516">,</span>&nbsp;<span class="ident" id="6402518">reflect</span><span class="op" id="6402525">.</span><span class="ident" id="6402526">Uintptr</span><span class="op" id="6402533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402537">return</span>&nbsp;<span class="ident" id="6402544">v</span><span class="op" id="6402545">.</span><span class="ident" id="6402546">Uint</span><span class="op" id="6402550">(</span><span class="op" id="6402551">)</span>&nbsp;<span class="op" id="6402553">==</span>&nbsp;<span class="num" id="6402556">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402559">case</span>&nbsp;<span class="ident" id="6402564">reflect</span><span class="op" id="6402571">.</span><span class="ident" id="6402572">Float32</span><span class="op" id="6402579">,</span>&nbsp;<span class="ident" id="6402581">reflect</span><span class="op" id="6402588">.</span><span class="ident" id="6402589">Float64</span><span class="op" id="6402596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402600">return</span>&nbsp;<span class="ident" id="6402607">v</span><span class="op" id="6402608">.</span><span class="ident" id="6402609">Float</span><span class="op" id="6402614">(</span><span class="op" id="6402615">)</span>&nbsp;<span class="op" id="6402617">==</span>&nbsp;<span class="num" id="6402620">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402623">case</span>&nbsp;<span class="ident" id="6402628">reflect</span><span class="op" id="6402635">.</span><span class="ident" id="6402636">Interface</span><span class="op" id="6402645">,</span>&nbsp;<span class="ident" id="6402647">reflect</span><span class="op" id="6402654">.</span><span class="ident" id="6402655">Ptr</span><span class="op" id="6402658">:</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402662">return</span>&nbsp;<span class="ident" id="6402669">v</span><span class="op" id="6402670">.</span><span class="ident" id="6402671">IsNil</span><span class="op" id="6402676">(</span><span class="op" id="6402677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402683">return</span>&nbsp;<span class="builtintype" id="6402690">false</span><br>
<span class="lineno"></span><span class="op" id="6402696">}</span>
</div>
</body>
</html>
