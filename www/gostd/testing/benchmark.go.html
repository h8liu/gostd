<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html" class="current">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6365029">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6365084">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6365138">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6365189">package</span>&nbsp;<span class="ident" id="6365197">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6365206">import</span>&nbsp;<span class="op" id="6365213">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6365216">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6365224">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6365231">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6365237">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6365248">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6365256">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6365271">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6365278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6365281">var</span>&nbsp;<span class="ident" id="6365285">matchBenchmarks</span>&nbsp;<span class="op" id="6365301">=</span>&nbsp;<span class="ident" id="6365303">flag</span><span class="op" id="6365307">.</span><span class="ident" id="6365308">String</span><span class="op" id="6365314">(</span><span class="string" id="6365315">&#34;test.bench&#34;</span><span class="op" id="6365327">,</span>&nbsp;<span class="string" id="6365329">&#34;&#34;</span><span class="op" id="6365331">,</span>&nbsp;<span class="string" id="6365333">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6365381">)</span><br>
<span class="lineno"></span><span class="keyword" id="6365383">var</span>&nbsp;<span class="ident" id="6365387">benchTime</span>&nbsp;<span class="op" id="6365397">=</span>&nbsp;<span class="ident" id="6365399">flag</span><span class="op" id="6365403">.</span><span class="ident" id="6365404">Duration</span><span class="op" id="6365412">(</span><span class="string" id="6365413">&#34;test.benchtime&#34;</span><span class="op" id="6365429">,</span>&nbsp;<span class="num" id="6365431">1</span><span class="op" id="6365432">*</span><span class="ident" id="6365433">time</span><span class="op" id="6365437">.</span><span class="ident" id="6365438">Second</span><span class="op" id="6365444">,</span>&nbsp;<span class="string" id="6365446">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6365487">)</span><br>
<span class="lineno"></span><span class="keyword" id="6365489">var</span>&nbsp;<span class="ident" id="6365493">benchmarkMemory</span>&nbsp;<span class="op" id="6365509">=</span>&nbsp;<span class="ident" id="6365511">flag</span><span class="op" id="6365515">.</span><span class="ident" id="6365516">Bool</span><span class="op" id="6365520">(</span><span class="string" id="6365521">&#34;test.benchmem&#34;</span><span class="op" id="6365536">,</span>&nbsp;<span class="builtintype" id="6365538">false</span><span class="op" id="6365543">,</span>&nbsp;<span class="string" id="6365545">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6365586">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6365589">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6365649">var</span>&nbsp;<span class="ident" id="6365653">benchmarkLock</span>&nbsp;<span class="ident" id="6365667">sync</span><span class="op" id="6365671">.</span><span class="ident" id="6365672">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6365679">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6365729">var</span>&nbsp;<span class="ident" id="6365733">memStats</span>&nbsp;<span class="ident" id="6365742">runtime</span><span class="op" id="6365749">.</span><span class="ident" id="6365750">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6365760">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6365849">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6365878">type</span>&nbsp;<span class="ident" id="6365883">InternalBenchmark</span>&nbsp;<span class="keyword" id="6365901">struct</span>&nbsp;<span class="op" id="6365908">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365911">Name</span>&nbsp;<span class="builtintype" id="6365916">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365924">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365929">func</span><span class="op" id="6365933">(</span><span class="ident" id="6365934">b</span>&nbsp;<span class="op" id="6365936">*</span><span class="ident" id="6365937">B</span><span class="op" id="6365938">)</span><br>
<span class="lineno"></span><span class="op" id="6365940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6365943">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6366008">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6366066">type</span>&nbsp;<span class="ident" id="6366071">B</span>&nbsp;<span class="keyword" id="6366073">struct</span>&nbsp;<span class="op" id="6366080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366083">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366091">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6366108">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366113">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6366130">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6366144">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366189">previousDuration</span>&nbsp;<span class="ident" id="6366206">time</span><span class="op" id="6366210">.</span><span class="ident" id="6366211">Duration</span>&nbsp;<span class="comment" id="6366220">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366259">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366276">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366295">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6366312">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366319">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6366336">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366342">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6366359">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366365">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366382">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366399">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6366416">int</span>&nbsp;<span class="comment" id="6366420">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6366478">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366546">startAllocs</span>&nbsp;<span class="builtintype" id="6366558">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366566">startBytes</span>&nbsp;&nbsp;<span class="builtintype" id="6366578">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6366586">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366634">netAllocs</span>&nbsp;<span class="builtintype" id="6366644">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366652">netBytes</span>&nbsp;&nbsp;<span class="builtintype" id="6366662">uint64</span><br>
<span class="lineno"></span><span class="op" id="6366669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6366672">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6366747">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6366821">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6366845">func</span>&nbsp;<span class="op" id="6366850">(</span><span class="ident" id="6366851">b</span>&nbsp;<span class="op" id="6366853">*</span><span class="ident" id="6366854">B</span><span class="op" id="6366855">)</span>&nbsp;<span class="ident" id="6366857">StartTimer</span><span class="op" id="6366867">(</span><span class="op" id="6366868">)</span>&nbsp;<span class="op" id="6366870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6366873">if</span>&nbsp;<span class="op" id="6366876">!</span><span class="ident" id="6366877">b</span><span class="op" id="6366878">.</span><span class="ident" id="6366879">timerOn</span>&nbsp;<span class="op" id="6366887">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366891">runtime</span><span class="op" id="6366898">.</span><span class="ident" id="6366899">ReadMemStats</span><span class="op" id="6366911">(</span><span class="op" id="6366912">&amp;</span><span class="ident" id="6366913">memStats</span><span class="op" id="6366921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366925">b</span><span class="op" id="6366926">.</span><span class="ident" id="6366927">startAllocs</span>&nbsp;<span class="op" id="6366939">=</span>&nbsp;<span class="ident" id="6366941">memStats</span><span class="op" id="6366949">.</span><span class="ident" id="6366950">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366960">b</span><span class="op" id="6366961">.</span><span class="ident" id="6366962">startBytes</span>&nbsp;<span class="op" id="6366973">=</span>&nbsp;<span class="ident" id="6366975">memStats</span><span class="op" id="6366983">.</span><span class="ident" id="6366984">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366997">b</span><span class="op" id="6366998">.</span><span class="ident" id="6366999">start</span>&nbsp;<span class="op" id="6367005">=</span>&nbsp;<span class="ident" id="6367007">time</span><span class="op" id="6367011">.</span><span class="ident" id="6367012">Now</span><span class="op" id="6367015">(</span><span class="op" id="6367016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367020">b</span><span class="op" id="6367021">.</span><span class="ident" id="6367022">timerOn</span>&nbsp;<span class="op" id="6367030">=</span>&nbsp;<span class="builtintype" id="6367032">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367038">}</span><br>
<span class="lineno"></span><span class="op" id="6367040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6367043">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6367114">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6367172">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6367192">func</span>&nbsp;<span class="op" id="6367197">(</span><span class="ident" id="6367198">b</span>&nbsp;<span class="op" id="6367200">*</span><span class="ident" id="6367201">B</span><span class="op" id="6367202">)</span>&nbsp;<span class="ident" id="6367204">StopTimer</span><span class="op" id="6367213">(</span><span class="op" id="6367214">)</span>&nbsp;<span class="op" id="6367216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367219">if</span>&nbsp;<span class="ident" id="6367222">b</span><span class="op" id="6367223">.</span><span class="ident" id="6367224">timerOn</span>&nbsp;<span class="op" id="6367232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367236">b</span><span class="op" id="6367237">.</span><span class="ident" id="6367238">duration</span>&nbsp;<span class="op" id="6367247">+=</span>&nbsp;<span class="ident" id="6367250">time</span><span class="op" id="6367254">.</span><span class="ident" id="6367255">Now</span><span class="op" id="6367258">(</span><span class="op" id="6367259">)</span><span class="op" id="6367260">.</span><span class="ident" id="6367261">Sub</span><span class="op" id="6367264">(</span><span class="ident" id="6367265">b</span><span class="op" id="6367266">.</span><span class="ident" id="6367267">start</span><span class="op" id="6367272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367276">runtime</span><span class="op" id="6367283">.</span><span class="ident" id="6367284">ReadMemStats</span><span class="op" id="6367296">(</span><span class="op" id="6367297">&amp;</span><span class="ident" id="6367298">memStats</span><span class="op" id="6367306">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367310">b</span><span class="op" id="6367311">.</span><span class="ident" id="6367312">netAllocs</span>&nbsp;<span class="op" id="6367322">+=</span>&nbsp;<span class="ident" id="6367325">memStats</span><span class="op" id="6367333">.</span><span class="ident" id="6367334">Mallocs</span>&nbsp;<span class="op" id="6367342">-</span>&nbsp;<span class="ident" id="6367344">b</span><span class="op" id="6367345">.</span><span class="ident" id="6367346">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367360">b</span><span class="op" id="6367361">.</span><span class="ident" id="6367362">netBytes</span>&nbsp;<span class="op" id="6367371">+=</span>&nbsp;<span class="ident" id="6367374">memStats</span><span class="op" id="6367382">.</span><span class="ident" id="6367383">TotalAlloc</span>&nbsp;<span class="op" id="6367394">-</span>&nbsp;<span class="ident" id="6367396">b</span><span class="op" id="6367397">.</span><span class="ident" id="6367398">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367411">b</span><span class="op" id="6367412">.</span><span class="ident" id="6367413">timerOn</span>&nbsp;<span class="op" id="6367421">=</span>&nbsp;<span class="builtintype" id="6367423">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367430">}</span><br>
<span class="lineno"></span><span class="op" id="6367432">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6367435">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6367514">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6367566">func</span>&nbsp;<span class="op" id="6367571">(</span><span class="ident" id="6367572">b</span>&nbsp;<span class="op" id="6367574">*</span><span class="ident" id="6367575">B</span><span class="op" id="6367576">)</span>&nbsp;<span class="ident" id="6367578">ResetTimer</span><span class="op" id="6367588">(</span><span class="op" id="6367589">)</span>&nbsp;<span class="op" id="6367591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367594">if</span>&nbsp;<span class="ident" id="6367597">b</span><span class="op" id="6367598">.</span><span class="ident" id="6367599">timerOn</span>&nbsp;<span class="op" id="6367607">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367611">runtime</span><span class="op" id="6367618">.</span><span class="ident" id="6367619">ReadMemStats</span><span class="op" id="6367631">(</span><span class="op" id="6367632">&amp;</span><span class="ident" id="6367633">memStats</span><span class="op" id="6367641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367645">b</span><span class="op" id="6367646">.</span><span class="ident" id="6367647">startAllocs</span>&nbsp;<span class="op" id="6367659">=</span>&nbsp;<span class="ident" id="6367661">memStats</span><span class="op" id="6367669">.</span><span class="ident" id="6367670">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367680">b</span><span class="op" id="6367681">.</span><span class="ident" id="6367682">startBytes</span>&nbsp;<span class="op" id="6367693">=</span>&nbsp;<span class="ident" id="6367695">memStats</span><span class="op" id="6367703">.</span><span class="ident" id="6367704">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367717">b</span><span class="op" id="6367718">.</span><span class="ident" id="6367719">start</span>&nbsp;<span class="op" id="6367725">=</span>&nbsp;<span class="ident" id="6367727">time</span><span class="op" id="6367731">.</span><span class="ident" id="6367732">Now</span><span class="op" id="6367735">(</span><span class="op" id="6367736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367739">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367742">b</span><span class="op" id="6367743">.</span><span class="ident" id="6367744">duration</span>&nbsp;<span class="op" id="6367753">=</span>&nbsp;<span class="num" id="6367755">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367758">b</span><span class="op" id="6367759">.</span><span class="ident" id="6367760">netAllocs</span>&nbsp;<span class="op" id="6367770">=</span>&nbsp;<span class="num" id="6367772">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367775">b</span><span class="op" id="6367776">.</span><span class="ident" id="6367777">netBytes</span>&nbsp;<span class="op" id="6367786">=</span>&nbsp;<span class="num" id="6367788">0</span><br>
<span class="lineno"></span><span class="op" id="6367790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6367793">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6367866">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6367930">func</span>&nbsp;<span class="op" id="6367935">(</span><span class="ident" id="6367936">b</span>&nbsp;<span class="op" id="6367938">*</span><span class="ident" id="6367939">B</span><span class="op" id="6367940">)</span>&nbsp;<span class="ident" id="6367942">SetBytes</span><span class="op" id="6367950">(</span><span class="ident" id="6367951">n</span>&nbsp;<span class="builtintype" id="6367953">int64</span><span class="op" id="6367958">)</span>&nbsp;<span class="op" id="6367960">{</span>&nbsp;<span class="ident" id="6367962">b</span><span class="op" id="6367963">.</span><span class="ident" id="6367964">bytes</span>&nbsp;<span class="op" id="6367970">=</span>&nbsp;<span class="ident" id="6367972">n</span>&nbsp;<span class="op" id="6367974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6367977">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6368039">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6368110">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6368157">func</span>&nbsp;<span class="op" id="6368162">(</span><span class="ident" id="6368163">b</span>&nbsp;<span class="op" id="6368165">*</span><span class="ident" id="6368166">B</span><span class="op" id="6368167">)</span>&nbsp;<span class="ident" id="6368169">ReportAllocs</span><span class="op" id="6368181">(</span><span class="op" id="6368182">)</span>&nbsp;<span class="op" id="6368184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368187">b</span><span class="op" id="6368188">.</span><span class="ident" id="6368189">showAllocResult</span>&nbsp;<span class="op" id="6368205">=</span>&nbsp;<span class="builtintype" id="6368207">true</span><br>
<span class="lineno"></span><span class="op" id="6368212">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6368215">func</span>&nbsp;<span class="op" id="6368220">(</span><span class="ident" id="6368221">b</span>&nbsp;<span class="op" id="6368223">*</span><span class="ident" id="6368224">B</span><span class="op" id="6368225">)</span>&nbsp;<span class="ident" id="6368227">nsPerOp</span><span class="op" id="6368234">(</span><span class="op" id="6368235">)</span>&nbsp;<span class="builtintype" id="6368237">int64</span>&nbsp;<span class="op" id="6368243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368246">if</span>&nbsp;<span class="ident" id="6368249">b</span><span class="op" id="6368250">.</span><span class="ident" id="6368251">N</span>&nbsp;<span class="op" id="6368253">&lt;=</span>&nbsp;<span class="num" id="6368256">0</span>&nbsp;<span class="op" id="6368258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368262">return</span>&nbsp;<span class="num" id="6368269">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368272">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368275">return</span>&nbsp;<span class="ident" id="6368282">b</span><span class="op" id="6368283">.</span><span class="ident" id="6368284">duration</span><span class="op" id="6368292">.</span><span class="ident" id="6368293">Nanoseconds</span><span class="op" id="6368304">(</span><span class="op" id="6368305">)</span>&nbsp;<span class="op" id="6368307">/</span>&nbsp;<span class="builtintype" id="6368309">int64</span><span class="op" id="6368314">(</span><span class="ident" id="6368315">b</span><span class="op" id="6368316">.</span><span class="ident" id="6368317">N</span><span class="op" id="6368318">)</span><br>
<span class="lineno"></span><span class="op" id="6368320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6368323">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6368395">func</span>&nbsp;<span class="op" id="6368400">(</span><span class="ident" id="6368401">b</span>&nbsp;<span class="op" id="6368403">*</span><span class="ident" id="6368404">B</span><span class="op" id="6368405">)</span>&nbsp;<span class="ident" id="6368407">runN</span><span class="op" id="6368411">(</span><span class="ident" id="6368412">n</span>&nbsp;<span class="builtintype" id="6368414">int</span><span class="op" id="6368417">)</span>&nbsp;<span class="op" id="6368419">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368422">benchmarkLock</span><span class="op" id="6368435">.</span><span class="ident" id="6368436">Lock</span><span class="op" id="6368440">(</span><span class="op" id="6368441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368444">defer</span>&nbsp;<span class="ident" id="6368450">benchmarkLock</span><span class="op" id="6368463">.</span><span class="ident" id="6368464">Unlock</span><span class="op" id="6368470">(</span><span class="op" id="6368471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6368474">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6368527">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368571">runtime</span><span class="op" id="6368578">.</span><span class="ident" id="6368579">GC</span><span class="op" id="6368581">(</span><span class="op" id="6368582">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368585">b</span><span class="op" id="6368586">.</span><span class="ident" id="6368587">N</span>&nbsp;<span class="op" id="6368589">=</span>&nbsp;<span class="ident" id="6368591">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368594">b</span><span class="op" id="6368595">.</span><span class="ident" id="6368596">parallelism</span>&nbsp;<span class="op" id="6368608">=</span>&nbsp;<span class="num" id="6368610">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368613">b</span><span class="op" id="6368614">.</span><span class="ident" id="6368615">ResetTimer</span><span class="op" id="6368625">(</span><span class="op" id="6368626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368629">b</span><span class="op" id="6368630">.</span><span class="ident" id="6368631">StartTimer</span><span class="op" id="6368641">(</span><span class="op" id="6368642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368645">b</span><span class="op" id="6368646">.</span><span class="ident" id="6368647">benchmark</span><span class="op" id="6368656">.</span><span class="ident" id="6368657">F</span><span class="op" id="6368658">(</span><span class="ident" id="6368659">b</span><span class="op" id="6368660">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368663">b</span><span class="op" id="6368664">.</span><span class="ident" id="6368665">StopTimer</span><span class="op" id="6368674">(</span><span class="op" id="6368675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368678">b</span><span class="op" id="6368679">.</span><span class="ident" id="6368680">previousN</span>&nbsp;<span class="op" id="6368690">=</span>&nbsp;<span class="ident" id="6368692">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368695">b</span><span class="op" id="6368696">.</span><span class="ident" id="6368697">previousDuration</span>&nbsp;<span class="op" id="6368714">=</span>&nbsp;<span class="ident" id="6368716">b</span><span class="op" id="6368717">.</span><span class="ident" id="6368718">duration</span><br>
<span class="lineno"></span><span class="op" id="6368727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6368730">func</span>&nbsp;<span class="ident" id="6368735">min</span><span class="op" id="6368738">(</span><span class="ident" id="6368739">x</span><span class="op" id="6368740">,</span>&nbsp;<span class="ident" id="6368742">y</span>&nbsp;<span class="builtintype" id="6368744">int</span><span class="op" id="6368747">)</span>&nbsp;<span class="builtintype" id="6368749">int</span>&nbsp;<span class="op" id="6368753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368756">if</span>&nbsp;<span class="ident" id="6368759">x</span>&nbsp;<span class="op" id="6368761">&gt;</span>&nbsp;<span class="ident" id="6368763">y</span>&nbsp;<span class="op" id="6368765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368769">return</span>&nbsp;<span class="ident" id="6368776">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368782">return</span>&nbsp;<span class="ident" id="6368789">x</span><br>
<span class="lineno">135</span><span class="op" id="6368791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6368794">func</span>&nbsp;<span class="ident" id="6368799">max</span><span class="op" id="6368802">(</span><span class="ident" id="6368803">x</span><span class="op" id="6368804">,</span>&nbsp;<span class="ident" id="6368806">y</span>&nbsp;<span class="builtintype" id="6368808">int</span><span class="op" id="6368811">)</span>&nbsp;<span class="builtintype" id="6368813">int</span>&nbsp;<span class="op" id="6368817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368820">if</span>&nbsp;<span class="ident" id="6368823">x</span>&nbsp;<span class="op" id="6368825">&lt;</span>&nbsp;<span class="ident" id="6368827">y</span>&nbsp;<span class="op" id="6368829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368833">return</span>&nbsp;<span class="ident" id="6368840">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368846">return</span>&nbsp;<span class="ident" id="6368853">x</span><br>
<span class="lineno"></span><span class="op" id="6368855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6368858">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6368922">func</span>&nbsp;<span class="ident" id="6368927">roundDown10</span><span class="op" id="6368938">(</span><span class="ident" id="6368939">n</span>&nbsp;<span class="builtintype" id="6368941">int</span><span class="op" id="6368944">)</span>&nbsp;<span class="builtintype" id="6368946">int</span>&nbsp;<span class="op" id="6368950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368953">var</span>&nbsp;<span class="ident" id="6368957">tens</span>&nbsp;<span class="op" id="6368962">=</span>&nbsp;<span class="num" id="6368964">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6368967">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368995">for</span>&nbsp;<span class="ident" id="6368999">n</span>&nbsp;<span class="op" id="6369001">&gt;=</span>&nbsp;<span class="num" id="6369004">10</span>&nbsp;<span class="op" id="6369007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369011">n</span>&nbsp;<span class="op" id="6369013">=</span>&nbsp;<span class="ident" id="6369015">n</span>&nbsp;<span class="op" id="6369017">/</span>&nbsp;<span class="num" id="6369019">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369024">tens</span><span class="op" id="6369028">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6369035">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369056">result</span>&nbsp;<span class="op" id="6369063">:=</span>&nbsp;<span class="num" id="6369066">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369069">for</span>&nbsp;<span class="ident" id="6369073">i</span>&nbsp;<span class="op" id="6369075">:=</span>&nbsp;<span class="num" id="6369078">0</span><span class="op" id="6369079">;</span>&nbsp;<span class="ident" id="6369081">i</span>&nbsp;<span class="op" id="6369083">&lt;</span>&nbsp;<span class="ident" id="6369085">tens</span><span class="op" id="6369089">;</span>&nbsp;<span class="ident" id="6369091">i</span><span class="op" id="6369092">++</span>&nbsp;<span class="op" id="6369095">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369099">result</span>&nbsp;<span class="op" id="6369106">*=</span>&nbsp;<span class="num" id="6369109">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369116">return</span>&nbsp;<span class="ident" id="6369123">result</span><br>
<span class="lineno"></span><span class="op" id="6369130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6369133">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6369202">func</span>&nbsp;<span class="ident" id="6369207">roundUp</span><span class="op" id="6369214">(</span><span class="ident" id="6369215">n</span>&nbsp;<span class="builtintype" id="6369217">int</span><span class="op" id="6369220">)</span>&nbsp;<span class="builtintype" id="6369222">int</span>&nbsp;<span class="op" id="6369226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369229">base</span>&nbsp;<span class="op" id="6369234">:=</span>&nbsp;<span class="ident" id="6369237">roundDown10</span><span class="op" id="6369248">(</span><span class="ident" id="6369249">n</span><span class="op" id="6369250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369253">switch</span>&nbsp;<span class="op" id="6369260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369263">case</span>&nbsp;<span class="ident" id="6369268">n</span>&nbsp;<span class="op" id="6369270">&lt;=</span>&nbsp;<span class="ident" id="6369273">base</span><span class="op" id="6369277">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369281">return</span>&nbsp;<span class="ident" id="6369288">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369294">case</span>&nbsp;<span class="ident" id="6369299">n</span>&nbsp;<span class="op" id="6369301">&lt;=</span>&nbsp;<span class="op" id="6369304">(</span><span class="num" id="6369305">2</span>&nbsp;<span class="op" id="6369307">*</span>&nbsp;<span class="ident" id="6369309">base</span><span class="op" id="6369313">)</span><span class="op" id="6369314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369318">return</span>&nbsp;<span class="num" id="6369325">2</span>&nbsp;<span class="op" id="6369327">*</span>&nbsp;<span class="ident" id="6369329">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369335">case</span>&nbsp;<span class="ident" id="6369340">n</span>&nbsp;<span class="op" id="6369342">&lt;=</span>&nbsp;<span class="op" id="6369345">(</span><span class="num" id="6369346">3</span>&nbsp;<span class="op" id="6369348">*</span>&nbsp;<span class="ident" id="6369350">base</span><span class="op" id="6369354">)</span><span class="op" id="6369355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369359">return</span>&nbsp;<span class="num" id="6369366">3</span>&nbsp;<span class="op" id="6369368">*</span>&nbsp;<span class="ident" id="6369370">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369376">case</span>&nbsp;<span class="ident" id="6369381">n</span>&nbsp;<span class="op" id="6369383">&lt;=</span>&nbsp;<span class="op" id="6369386">(</span><span class="num" id="6369387">5</span>&nbsp;<span class="op" id="6369389">*</span>&nbsp;<span class="ident" id="6369391">base</span><span class="op" id="6369395">)</span><span class="op" id="6369396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369400">return</span>&nbsp;<span class="num" id="6369407">5</span>&nbsp;<span class="op" id="6369409">*</span>&nbsp;<span class="ident" id="6369411">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369417">default</span><span class="op" id="6369424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369428">return</span>&nbsp;<span class="num" id="6369435">10</span>&nbsp;<span class="op" id="6369438">*</span>&nbsp;<span class="ident" id="6369440">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369446">}</span><br>
<span class="lineno">175</span><span class="op" id="6369448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6369451">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6369512">func</span>&nbsp;<span class="op" id="6369517">(</span><span class="ident" id="6369518">b</span>&nbsp;<span class="op" id="6369520">*</span><span class="ident" id="6369521">B</span><span class="op" id="6369522">)</span>&nbsp;<span class="ident" id="6369524">run</span><span class="op" id="6369527">(</span><span class="op" id="6369528">)</span>&nbsp;<span class="ident" id="6369530">BenchmarkResult</span>&nbsp;<span class="op" id="6369546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369549">go</span>&nbsp;<span class="ident" id="6369552">b</span><span class="op" id="6369553">.</span><span class="ident" id="6369554">launch</span><span class="op" id="6369560">(</span><span class="op" id="6369561">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369564">&lt;-</span><span class="ident" id="6369566">b</span><span class="op" id="6369567">.</span><span class="ident" id="6369568">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369576">return</span>&nbsp;<span class="ident" id="6369583">b</span><span class="op" id="6369584">.</span><span class="ident" id="6369585">result</span><br>
<span class="lineno"></span><span class="op" id="6369592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6369595">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6369673">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6369754">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6369799">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testing.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;100000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6369843">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6369905">func</span>&nbsp;<span class="op" id="6369910">(</span><span class="ident" id="6369911">b</span>&nbsp;<span class="op" id="6369913">*</span><span class="ident" id="6369914">B</span><span class="op" id="6369915">)</span>&nbsp;<span class="ident" id="6369917">launch</span><span class="op" id="6369923">(</span><span class="op" id="6369924">)</span>&nbsp;<span class="op" id="6369926">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6369929">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369998">n</span>&nbsp;<span class="op" id="6370000">:=</span>&nbsp;<span class="num" id="6370003">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370007">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370061">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370097">defer</span>&nbsp;<span class="keyword" id="6370103">func</span><span class="op" id="6370107">(</span><span class="op" id="6370108">)</span>&nbsp;<span class="op" id="6370110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370114">b</span><span class="op" id="6370115">.</span><span class="ident" id="6370116">signal</span>&nbsp;<span class="op" id="6370123">&lt;-</span>&nbsp;<span class="ident" id="6370126">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370129">}</span><span class="op" id="6370130">(</span><span class="op" id="6370131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370135">b</span><span class="op" id="6370136">.</span><span class="ident" id="6370137">runN</span><span class="op" id="6370141">(</span><span class="ident" id="6370142">n</span><span class="op" id="6370143">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370146">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370211">d</span>&nbsp;<span class="op" id="6370213">:=</span>&nbsp;<span class="op" id="6370216">*</span><span class="ident" id="6370217">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370228">for</span>&nbsp;<span class="op" id="6370232">!</span><span class="ident" id="6370233">b</span><span class="op" id="6370234">.</span><span class="ident" id="6370235">failed</span>&nbsp;<span class="op" id="6370242">&amp;&amp;</span>&nbsp;<span class="ident" id="6370245">b</span><span class="op" id="6370246">.</span><span class="ident" id="6370247">duration</span>&nbsp;<span class="op" id="6370256">&lt;</span>&nbsp;<span class="ident" id="6370258">d</span>&nbsp;<span class="op" id="6370260">&amp;&amp;</span>&nbsp;<span class="ident" id="6370263">n</span>&nbsp;<span class="op" id="6370265">&lt;</span>&nbsp;<span class="num" id="6370267">1e9</span>&nbsp;<span class="op" id="6370271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370275">last</span>&nbsp;<span class="op" id="6370280">:=</span>&nbsp;<span class="ident" id="6370283">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370287">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370321">if</span>&nbsp;<span class="ident" id="6370324">b</span><span class="op" id="6370325">.</span><span class="ident" id="6370326">nsPerOp</span><span class="op" id="6370333">(</span><span class="op" id="6370334">)</span>&nbsp;<span class="op" id="6370336">==</span>&nbsp;<span class="num" id="6370339">0</span>&nbsp;<span class="op" id="6370341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370346">n</span>&nbsp;<span class="op" id="6370348">=</span>&nbsp;<span class="num" id="6370350">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370356">}</span>&nbsp;<span class="keyword" id="6370358">else</span>&nbsp;<span class="op" id="6370363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370368">n</span>&nbsp;<span class="op" id="6370370">=</span>&nbsp;<span class="builtintype" id="6370372">int</span><span class="op" id="6370375">(</span><span class="ident" id="6370376">d</span><span class="op" id="6370377">.</span><span class="ident" id="6370378">Nanoseconds</span><span class="op" id="6370389">(</span><span class="op" id="6370390">)</span>&nbsp;<span class="op" id="6370392">/</span>&nbsp;<span class="ident" id="6370394">b</span><span class="op" id="6370395">.</span><span class="ident" id="6370396">nsPerOp</span><span class="op" id="6370403">(</span><span class="op" id="6370404">)</span><span class="op" id="6370405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370409">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370413">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370471">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370537">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370591">n</span>&nbsp;<span class="op" id="6370593">=</span>&nbsp;<span class="ident" id="6370595">max</span><span class="op" id="6370598">(</span><span class="ident" id="6370599">min</span><span class="op" id="6370602">(</span><span class="ident" id="6370603">n</span><span class="op" id="6370604">+</span><span class="ident" id="6370605">n</span><span class="op" id="6370606">/</span><span class="num" id="6370607">5</span><span class="op" id="6370608">,</span>&nbsp;<span class="num" id="6370610">100</span><span class="op" id="6370613">*</span><span class="ident" id="6370614">last</span><span class="op" id="6370618">)</span><span class="op" id="6370619">,</span>&nbsp;<span class="ident" id="6370621">last</span><span class="op" id="6370625">+</span><span class="num" id="6370626">1</span><span class="op" id="6370627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370631">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370672">n</span>&nbsp;<span class="op" id="6370674">=</span>&nbsp;<span class="ident" id="6370676">roundUp</span><span class="op" id="6370683">(</span><span class="ident" id="6370684">n</span><span class="op" id="6370685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370689">b</span><span class="op" id="6370690">.</span><span class="ident" id="6370691">runN</span><span class="op" id="6370695">(</span><span class="ident" id="6370696">n</span><span class="op" id="6370697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370703">b</span><span class="op" id="6370704">.</span><span class="ident" id="6370705">result</span>&nbsp;<span class="op" id="6370712">=</span>&nbsp;<span class="ident" id="6370714">BenchmarkResult</span><span class="op" id="6370729">{</span><span class="ident" id="6370730">b</span><span class="op" id="6370731">.</span><span class="ident" id="6370732">N</span><span class="op" id="6370733">,</span>&nbsp;<span class="ident" id="6370735">b</span><span class="op" id="6370736">.</span><span class="ident" id="6370737">duration</span><span class="op" id="6370745">,</span>&nbsp;<span class="ident" id="6370747">b</span><span class="op" id="6370748">.</span><span class="ident" id="6370749">bytes</span><span class="op" id="6370754">,</span>&nbsp;<span class="ident" id="6370756">b</span><span class="op" id="6370757">.</span><span class="ident" id="6370758">netAllocs</span><span class="op" id="6370767">,</span>&nbsp;<span class="ident" id="6370769">b</span><span class="op" id="6370770">.</span><span class="ident" id="6370771">netBytes</span><span class="op" id="6370779">}</span><br>
<span class="lineno"></span><span class="op" id="6370781">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6370784">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6370819">type</span>&nbsp;<span class="ident" id="6370824">BenchmarkResult</span>&nbsp;<span class="keyword" id="6370840">struct</span>&nbsp;<span class="op" id="6370847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370850">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6370860">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370874">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370904">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370914">time</span><span class="op" id="6370918">.</span><span class="ident" id="6370919">Duration</span>&nbsp;<span class="comment" id="6370928">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370954">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6370964">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370978">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371016">MemAllocs</span>&nbsp;<span class="builtintype" id="6371026">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371040">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371084">MemBytes</span>&nbsp;&nbsp;<span class="builtintype" id="6371094">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371108">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6371148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6371151">func</span>&nbsp;<span class="op" id="6371156">(</span><span class="ident" id="6371157">r</span>&nbsp;<span class="ident" id="6371159">BenchmarkResult</span><span class="op" id="6371174">)</span>&nbsp;<span class="ident" id="6371176">NsPerOp</span><span class="op" id="6371183">(</span><span class="op" id="6371184">)</span>&nbsp;<span class="builtintype" id="6371186">int64</span>&nbsp;<span class="op" id="6371192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371195">if</span>&nbsp;<span class="ident" id="6371198">r</span><span class="op" id="6371199">.</span><span class="ident" id="6371200">N</span>&nbsp;<span class="op" id="6371202">&lt;=</span>&nbsp;<span class="num" id="6371205">0</span>&nbsp;<span class="op" id="6371207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371211">return</span>&nbsp;<span class="num" id="6371218">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371224">return</span>&nbsp;<span class="ident" id="6371231">r</span><span class="op" id="6371232">.</span><span class="ident" id="6371233">T</span><span class="op" id="6371234">.</span><span class="ident" id="6371235">Nanoseconds</span><span class="op" id="6371246">(</span><span class="op" id="6371247">)</span>&nbsp;<span class="op" id="6371249">/</span>&nbsp;<span class="builtintype" id="6371251">int64</span><span class="op" id="6371256">(</span><span class="ident" id="6371257">r</span><span class="op" id="6371258">.</span><span class="ident" id="6371259">N</span><span class="op" id="6371260">)</span><br>
<span class="lineno">235</span><span class="op" id="6371262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6371265">func</span>&nbsp;<span class="op" id="6371270">(</span><span class="ident" id="6371271">r</span>&nbsp;<span class="ident" id="6371273">BenchmarkResult</span><span class="op" id="6371288">)</span>&nbsp;<span class="ident" id="6371290">mbPerSec</span><span class="op" id="6371298">(</span><span class="op" id="6371299">)</span>&nbsp;<span class="builtintype" id="6371301">float64</span>&nbsp;<span class="op" id="6371309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371312">if</span>&nbsp;<span class="ident" id="6371315">r</span><span class="op" id="6371316">.</span><span class="ident" id="6371317">Bytes</span>&nbsp;<span class="op" id="6371323">&lt;=</span>&nbsp;<span class="num" id="6371326">0</span>&nbsp;<span class="op" id="6371328">||</span>&nbsp;<span class="ident" id="6371331">r</span><span class="op" id="6371332">.</span><span class="ident" id="6371333">T</span>&nbsp;<span class="op" id="6371335">&lt;=</span>&nbsp;<span class="num" id="6371338">0</span>&nbsp;<span class="op" id="6371340">||</span>&nbsp;<span class="ident" id="6371343">r</span><span class="op" id="6371344">.</span><span class="ident" id="6371345">N</span>&nbsp;<span class="op" id="6371347">&lt;=</span>&nbsp;<span class="num" id="6371350">0</span>&nbsp;<span class="op" id="6371352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371356">return</span>&nbsp;<span class="num" id="6371363">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371369">return</span>&nbsp;<span class="op" id="6371376">(</span><span class="builtintype" id="6371377">float64</span><span class="op" id="6371384">(</span><span class="ident" id="6371385">r</span><span class="op" id="6371386">.</span><span class="ident" id="6371387">Bytes</span><span class="op" id="6371392">)</span>&nbsp;<span class="op" id="6371394">*</span>&nbsp;<span class="builtintype" id="6371396">float64</span><span class="op" id="6371403">(</span><span class="ident" id="6371404">r</span><span class="op" id="6371405">.</span><span class="ident" id="6371406">N</span><span class="op" id="6371407">)</span>&nbsp;<span class="op" id="6371409">/</span>&nbsp;<span class="num" id="6371411">1e6</span><span class="op" id="6371414">)</span>&nbsp;<span class="op" id="6371416">/</span>&nbsp;<span class="ident" id="6371418">r</span><span class="op" id="6371419">.</span><span class="ident" id="6371420">T</span><span class="op" id="6371421">.</span><span class="ident" id="6371422">Seconds</span><span class="op" id="6371429">(</span><span class="op" id="6371430">)</span><br>
<span class="lineno"></span><span class="op" id="6371432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6371435">func</span>&nbsp;<span class="op" id="6371440">(</span><span class="ident" id="6371441">r</span>&nbsp;<span class="ident" id="6371443">BenchmarkResult</span><span class="op" id="6371458">)</span>&nbsp;<span class="ident" id="6371460">AllocsPerOp</span><span class="op" id="6371471">(</span><span class="op" id="6371472">)</span>&nbsp;<span class="builtintype" id="6371474">int64</span>&nbsp;<span class="op" id="6371480">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371483">if</span>&nbsp;<span class="ident" id="6371486">r</span><span class="op" id="6371487">.</span><span class="ident" id="6371488">N</span>&nbsp;<span class="op" id="6371490">&lt;=</span>&nbsp;<span class="num" id="6371493">0</span>&nbsp;<span class="op" id="6371495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371499">return</span>&nbsp;<span class="num" id="6371506">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371512">return</span>&nbsp;<span class="builtintype" id="6371519">int64</span><span class="op" id="6371524">(</span><span class="ident" id="6371525">r</span><span class="op" id="6371526">.</span><span class="ident" id="6371527">MemAllocs</span><span class="op" id="6371536">)</span>&nbsp;<span class="op" id="6371538">/</span>&nbsp;<span class="builtintype" id="6371540">int64</span><span class="op" id="6371545">(</span><span class="ident" id="6371546">r</span><span class="op" id="6371547">.</span><span class="ident" id="6371548">N</span><span class="op" id="6371549">)</span><br>
<span class="lineno"></span><span class="op" id="6371551">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6371554">func</span>&nbsp;<span class="op" id="6371559">(</span><span class="ident" id="6371560">r</span>&nbsp;<span class="ident" id="6371562">BenchmarkResult</span><span class="op" id="6371577">)</span>&nbsp;<span class="ident" id="6371579">AllocedBytesPerOp</span><span class="op" id="6371596">(</span><span class="op" id="6371597">)</span>&nbsp;<span class="builtintype" id="6371599">int64</span>&nbsp;<span class="op" id="6371605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371608">if</span>&nbsp;<span class="ident" id="6371611">r</span><span class="op" id="6371612">.</span><span class="ident" id="6371613">N</span>&nbsp;<span class="op" id="6371615">&lt;=</span>&nbsp;<span class="num" id="6371618">0</span>&nbsp;<span class="op" id="6371620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371624">return</span>&nbsp;<span class="num" id="6371631">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371634">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371637">return</span>&nbsp;<span class="builtintype" id="6371644">int64</span><span class="op" id="6371649">(</span><span class="ident" id="6371650">r</span><span class="op" id="6371651">.</span><span class="ident" id="6371652">MemBytes</span><span class="op" id="6371660">)</span>&nbsp;<span class="op" id="6371662">/</span>&nbsp;<span class="builtintype" id="6371664">int64</span><span class="op" id="6371669">(</span><span class="ident" id="6371670">r</span><span class="op" id="6371671">.</span><span class="ident" id="6371672">N</span><span class="op" id="6371673">)</span><br>
<span class="lineno"></span><span class="op" id="6371675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6371678">func</span>&nbsp;<span class="op" id="6371683">(</span><span class="ident" id="6371684">r</span>&nbsp;<span class="ident" id="6371686">BenchmarkResult</span><span class="op" id="6371701">)</span>&nbsp;<span class="ident" id="6371703">String</span><span class="op" id="6371709">(</span><span class="op" id="6371710">)</span>&nbsp;<span class="builtintype" id="6371712">string</span>&nbsp;<span class="op" id="6371719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371722">mbs</span>&nbsp;<span class="op" id="6371726">:=</span>&nbsp;<span class="ident" id="6371729">r</span><span class="op" id="6371730">.</span><span class="ident" id="6371731">mbPerSec</span><span class="op" id="6371739">(</span><span class="op" id="6371740">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371743">mb</span>&nbsp;<span class="op" id="6371746">:=</span>&nbsp;<span class="string" id="6371749">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371753">if</span>&nbsp;<span class="ident" id="6371756">mbs</span>&nbsp;<span class="op" id="6371760">!=</span>&nbsp;<span class="num" id="6371763">0</span>&nbsp;<span class="op" id="6371765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371769">mb</span>&nbsp;<span class="op" id="6371772">=</span>&nbsp;<span class="ident" id="6371774">fmt</span><span class="op" id="6371777">.</span><span class="ident" id="6371778">Sprintf</span><span class="op" id="6371785">(</span><span class="string" id="6371786">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6371800">,</span>&nbsp;<span class="ident" id="6371802">mbs</span><span class="op" id="6371805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371811">nsop</span>&nbsp;<span class="op" id="6371816">:=</span>&nbsp;<span class="ident" id="6371819">r</span><span class="op" id="6371820">.</span><span class="ident" id="6371821">NsPerOp</span><span class="op" id="6371828">(</span><span class="op" id="6371829">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371832">ns</span>&nbsp;<span class="op" id="6371835">:=</span>&nbsp;<span class="ident" id="6371838">fmt</span><span class="op" id="6371841">.</span><span class="ident" id="6371842">Sprintf</span><span class="op" id="6371849">(</span><span class="string" id="6371850">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6371862">,</span>&nbsp;<span class="ident" id="6371864">nsop</span><span class="op" id="6371868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371871">if</span>&nbsp;<span class="ident" id="6371874">r</span><span class="op" id="6371875">.</span><span class="ident" id="6371876">N</span>&nbsp;<span class="op" id="6371878">&gt;</span>&nbsp;<span class="num" id="6371880">0</span>&nbsp;<span class="op" id="6371882">&amp;&amp;</span>&nbsp;<span class="ident" id="6371885">nsop</span>&nbsp;<span class="op" id="6371890">&lt;</span>&nbsp;<span class="num" id="6371892">100</span>&nbsp;<span class="op" id="6371896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371900">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371947">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372008">if</span>&nbsp;<span class="ident" id="6372011">nsop</span>&nbsp;<span class="op" id="6372016">&lt;</span>&nbsp;<span class="num" id="6372018">10</span>&nbsp;<span class="op" id="6372021">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372026">ns</span>&nbsp;<span class="op" id="6372029">=</span>&nbsp;<span class="ident" id="6372031">fmt</span><span class="op" id="6372034">.</span><span class="ident" id="6372035">Sprintf</span><span class="op" id="6372042">(</span><span class="string" id="6372043">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6372057">,</span>&nbsp;<span class="builtintype" id="6372059">float64</span><span class="op" id="6372066">(</span><span class="ident" id="6372067">r</span><span class="op" id="6372068">.</span><span class="ident" id="6372069">T</span><span class="op" id="6372070">.</span><span class="ident" id="6372071">Nanoseconds</span><span class="op" id="6372082">(</span><span class="op" id="6372083">)</span><span class="op" id="6372084">)</span><span class="op" id="6372085">/</span><span class="builtintype" id="6372086">float64</span><span class="op" id="6372093">(</span><span class="ident" id="6372094">r</span><span class="op" id="6372095">.</span><span class="ident" id="6372096">N</span><span class="op" id="6372097">)</span><span class="op" id="6372098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372102">}</span>&nbsp;<span class="keyword" id="6372104">else</span>&nbsp;<span class="op" id="6372109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372114">ns</span>&nbsp;<span class="op" id="6372117">=</span>&nbsp;<span class="ident" id="6372119">fmt</span><span class="op" id="6372122">.</span><span class="ident" id="6372123">Sprintf</span><span class="op" id="6372130">(</span><span class="string" id="6372131">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6372145">,</span>&nbsp;<span class="builtintype" id="6372147">float64</span><span class="op" id="6372154">(</span><span class="ident" id="6372155">r</span><span class="op" id="6372156">.</span><span class="ident" id="6372157">T</span><span class="op" id="6372158">.</span><span class="ident" id="6372159">Nanoseconds</span><span class="op" id="6372170">(</span><span class="op" id="6372171">)</span><span class="op" id="6372172">)</span><span class="op" id="6372173">/</span><span class="builtintype" id="6372174">float64</span><span class="op" id="6372181">(</span><span class="ident" id="6372182">r</span><span class="op" id="6372183">.</span><span class="ident" id="6372184">N</span><span class="op" id="6372185">)</span><span class="op" id="6372186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372193">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372196">return</span>&nbsp;<span class="ident" id="6372203">fmt</span><span class="op" id="6372206">.</span><span class="ident" id="6372207">Sprintf</span><span class="op" id="6372214">(</span><span class="string" id="6372215">&#34;%8d\t%s%s&#34;</span><span class="op" id="6372226">,</span>&nbsp;<span class="ident" id="6372228">r</span><span class="op" id="6372229">.</span><span class="ident" id="6372230">N</span><span class="op" id="6372231">,</span>&nbsp;<span class="ident" id="6372233">ns</span><span class="op" id="6372235">,</span>&nbsp;<span class="ident" id="6372237">mb</span><span class="op" id="6372239">)</span><br>
<span class="lineno"></span><span class="op" id="6372241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6372244">func</span>&nbsp;<span class="op" id="6372249">(</span><span class="ident" id="6372250">r</span>&nbsp;<span class="ident" id="6372252">BenchmarkResult</span><span class="op" id="6372267">)</span>&nbsp;<span class="ident" id="6372269">MemString</span><span class="op" id="6372278">(</span><span class="op" id="6372279">)</span>&nbsp;<span class="builtintype" id="6372281">string</span>&nbsp;<span class="op" id="6372288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372291">return</span>&nbsp;<span class="ident" id="6372298">fmt</span><span class="op" id="6372301">.</span><span class="ident" id="6372302">Sprintf</span><span class="op" id="6372309">(</span><span class="string" id="6372310">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6372335">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372339">r</span><span class="op" id="6372340">.</span><span class="ident" id="6372341">AllocedBytesPerOp</span><span class="op" id="6372358">(</span><span class="op" id="6372359">)</span><span class="op" id="6372360">,</span>&nbsp;<span class="ident" id="6372362">r</span><span class="op" id="6372363">.</span><span class="ident" id="6372364">AllocsPerOp</span><span class="op" id="6372375">(</span><span class="op" id="6372376">)</span><span class="op" id="6372377">)</span><br>
<span class="lineno"></span><span class="op" id="6372379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6372382">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6372475">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6372504">func</span>&nbsp;<span class="ident" id="6372509">RunBenchmarks</span><span class="op" id="6372522">(</span><span class="ident" id="6372523">matchString</span>&nbsp;<span class="keyword" id="6372535">func</span><span class="op" id="6372539">(</span><span class="ident" id="6372540">pat</span><span class="op" id="6372543">,</span>&nbsp;<span class="ident" id="6372545">str</span>&nbsp;<span class="builtintype" id="6372549">string</span><span class="op" id="6372555">)</span>&nbsp;<span class="op" id="6372557">(</span><span class="builtintype" id="6372558">bool</span><span class="op" id="6372562">,</span>&nbsp;<span class="builtintype" id="6372564">error</span><span class="op" id="6372569">)</span><span class="op" id="6372570">,</span>&nbsp;<span class="ident" id="6372572">benchmarks</span>&nbsp;<span class="op" id="6372583">[</span><span class="op" id="6372584">]</span><span class="ident" id="6372585">InternalBenchmark</span><span class="op" id="6372602">)</span>&nbsp;<span class="op" id="6372604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6372607">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372659">if</span>&nbsp;<span class="builtinfunc" id="6372662">len</span><span class="op" id="6372665">(</span><span class="op" id="6372666">*</span><span class="ident" id="6372667">matchBenchmarks</span><span class="op" id="6372682">)</span>&nbsp;<span class="op" id="6372684">==</span>&nbsp;<span class="num" id="6372687">0</span>&nbsp;<span class="op" id="6372689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372693">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372701">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372704">for</span>&nbsp;<span class="ident" id="6372708">_</span><span class="op" id="6372709">,</span>&nbsp;<span class="ident" id="6372711">Benchmark</span>&nbsp;<span class="op" id="6372721">:=</span>&nbsp;<span class="keyword" id="6372724">range</span>&nbsp;<span class="ident" id="6372730">benchmarks</span>&nbsp;<span class="op" id="6372741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372745">matched</span><span class="op" id="6372752">,</span>&nbsp;<span class="ident" id="6372754">err</span>&nbsp;<span class="op" id="6372758">:=</span>&nbsp;<span class="ident" id="6372761">matchString</span><span class="op" id="6372772">(</span><span class="op" id="6372773">*</span><span class="ident" id="6372774">matchBenchmarks</span><span class="op" id="6372789">,</span>&nbsp;<span class="ident" id="6372791">Benchmark</span><span class="op" id="6372800">.</span><span class="ident" id="6372801">Name</span><span class="op" id="6372805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372809">if</span>&nbsp;<span class="ident" id="6372812">err</span>&nbsp;<span class="op" id="6372816">!=</span>&nbsp;<span class="builtintype" id="6372819">nil</span>&nbsp;<span class="op" id="6372823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372828">fmt</span><span class="op" id="6372831">.</span><span class="ident" id="6372832">Fprintf</span><span class="op" id="6372839">(</span><span class="ident" id="6372840">os</span><span class="op" id="6372842">.</span><span class="ident" id="6372843">Stderr</span><span class="op" id="6372849">,</span>&nbsp;<span class="string" id="6372851">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6372898">,</span>&nbsp;<span class="ident" id="6372900">err</span><span class="op" id="6372903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372908">os</span><span class="op" id="6372910">.</span><span class="ident" id="6372911">Exit</span><span class="op" id="6372915">(</span><span class="num" id="6372916">1</span><span class="op" id="6372917">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372925">if</span>&nbsp;<span class="op" id="6372928">!</span><span class="ident" id="6372929">matched</span>&nbsp;<span class="op" id="6372937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372942">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372957">for</span>&nbsp;<span class="ident" id="6372961">_</span><span class="op" id="6372962">,</span>&nbsp;<span class="ident" id="6372964">procs</span>&nbsp;<span class="op" id="6372970">:=</span>&nbsp;<span class="keyword" id="6372973">range</span>&nbsp;<span class="ident" id="6372979">cpuList</span>&nbsp;<span class="op" id="6372987">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372992">runtime</span><span class="op" id="6372999">.</span><span class="ident" id="6373000">GOMAXPROCS</span><span class="op" id="6373010">(</span><span class="ident" id="6373011">procs</span><span class="op" id="6373016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373021">b</span>&nbsp;<span class="op" id="6373023">:=</span>&nbsp;<span class="op" id="6373026">&amp;</span><span class="ident" id="6373027">B</span><span class="op" id="6373028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373034">common</span><span class="op" id="6373040">:</span>&nbsp;<span class="ident" id="6373042">common</span><span class="op" id="6373048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373055">signal</span><span class="op" id="6373061">:</span>&nbsp;<span class="builtinfunc" id="6373063">make</span><span class="op" id="6373067">(</span><span class="keyword" id="6373068">chan</span>&nbsp;<span class="keyword" id="6373073">interface</span><span class="op" id="6373082">{</span><span class="op" id="6373083">}</span><span class="op" id="6373084">)</span><span class="op" id="6373085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373091">}</span><span class="op" id="6373092">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373098">benchmark</span><span class="op" id="6373107">:</span>&nbsp;<span class="ident" id="6373109">Benchmark</span><span class="op" id="6373118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373128">benchName</span>&nbsp;<span class="op" id="6373138">:=</span>&nbsp;<span class="ident" id="6373141">Benchmark</span><span class="op" id="6373150">.</span><span class="ident" id="6373151">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373159">if</span>&nbsp;<span class="ident" id="6373162">procs</span>&nbsp;<span class="op" id="6373168">!=</span>&nbsp;<span class="num" id="6373171">1</span>&nbsp;<span class="op" id="6373173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373179">benchName</span>&nbsp;<span class="op" id="6373189">=</span>&nbsp;<span class="ident" id="6373191">fmt</span><span class="op" id="6373194">.</span><span class="ident" id="6373195">Sprintf</span><span class="op" id="6373202">(</span><span class="string" id="6373203">&#34;%s-%d&#34;</span><span class="op" id="6373210">,</span>&nbsp;<span class="ident" id="6373212">Benchmark</span><span class="op" id="6373221">.</span><span class="ident" id="6373222">Name</span><span class="op" id="6373226">,</span>&nbsp;<span class="ident" id="6373228">procs</span><span class="op" id="6373233">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373243">fmt</span><span class="op" id="6373246">.</span><span class="ident" id="6373247">Printf</span><span class="op" id="6373253">(</span><span class="string" id="6373254">&#34;%s\t&#34;</span><span class="op" id="6373260">,</span>&nbsp;<span class="ident" id="6373262">benchName</span><span class="op" id="6373271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373276">r</span>&nbsp;<span class="op" id="6373278">:=</span>&nbsp;<span class="ident" id="6373281">b</span><span class="op" id="6373282">.</span><span class="ident" id="6373283">run</span><span class="op" id="6373286">(</span><span class="op" id="6373287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373292">if</span>&nbsp;<span class="ident" id="6373295">b</span><span class="op" id="6373296">.</span><span class="ident" id="6373297">failed</span>&nbsp;<span class="op" id="6373304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6373310">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6373373">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6373450">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373479">fmt</span><span class="op" id="6373482">.</span><span class="ident" id="6373483">Printf</span><span class="op" id="6373489">(</span><span class="string" id="6373490">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6373508">,</span>&nbsp;<span class="ident" id="6373510">benchName</span><span class="op" id="6373519">,</span>&nbsp;<span class="ident" id="6373521">b</span><span class="op" id="6373522">.</span><span class="ident" id="6373523">output</span><span class="op" id="6373529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373535">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373547">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373552">results</span>&nbsp;<span class="op" id="6373560">:=</span>&nbsp;<span class="ident" id="6373563">r</span><span class="op" id="6373564">.</span><span class="ident" id="6373565">String</span><span class="op" id="6373571">(</span><span class="op" id="6373572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373577">if</span>&nbsp;<span class="op" id="6373580">*</span><span class="ident" id="6373581">benchmarkMemory</span>&nbsp;<span class="op" id="6373597">||</span>&nbsp;<span class="ident" id="6373600">b</span><span class="op" id="6373601">.</span><span class="ident" id="6373602">showAllocResult</span>&nbsp;<span class="op" id="6373618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373624">results</span>&nbsp;<span class="op" id="6373632">+=</span>&nbsp;<span class="string" id="6373635">&#34;\t&#34;</span>&nbsp;<span class="op" id="6373640">+</span>&nbsp;<span class="ident" id="6373642">r</span><span class="op" id="6373643">.</span><span class="ident" id="6373644">MemString</span><span class="op" id="6373653">(</span><span class="op" id="6373654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373664">fmt</span><span class="op" id="6373667">.</span><span class="ident" id="6373668">Println</span><span class="op" id="6373675">(</span><span class="ident" id="6373676">results</span><span class="op" id="6373683">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6373688">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6373768">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373841">if</span>&nbsp;<span class="builtinfunc" id="6373844">len</span><span class="op" id="6373847">(</span><span class="ident" id="6373848">b</span><span class="op" id="6373849">.</span><span class="ident" id="6373850">output</span><span class="op" id="6373856">)</span>&nbsp;<span class="op" id="6373858">&gt;</span>&nbsp;<span class="num" id="6373860">0</span>&nbsp;<span class="op" id="6373862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373868">b</span><span class="op" id="6373869">.</span><span class="ident" id="6373870">trimOutput</span><span class="op" id="6373880">(</span><span class="op" id="6373881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373887">fmt</span><span class="op" id="6373890">.</span><span class="ident" id="6373891">Printf</span><span class="op" id="6373897">(</span><span class="string" id="6373898">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6373917">,</span>&nbsp;<span class="ident" id="6373919">benchName</span><span class="op" id="6373928">,</span>&nbsp;<span class="ident" id="6373930">b</span><span class="op" id="6373931">.</span><span class="ident" id="6373932">output</span><span class="op" id="6373938">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373948">if</span>&nbsp;<span class="ident" id="6373951">p</span>&nbsp;<span class="op" id="6373953">:=</span>&nbsp;<span class="ident" id="6373956">runtime</span><span class="op" id="6373963">.</span><span class="ident" id="6373964">GOMAXPROCS</span><span class="op" id="6373974">(</span><span class="op" id="6373975">-</span><span class="num" id="6373976">1</span><span class="op" id="6373977">)</span><span class="op" id="6373978">;</span>&nbsp;<span class="ident" id="6373980">p</span>&nbsp;<span class="op" id="6373982">!=</span>&nbsp;<span class="ident" id="6373985">procs</span>&nbsp;<span class="op" id="6373991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373997">fmt</span><span class="op" id="6374000">.</span><span class="ident" id="6374001">Fprintf</span><span class="op" id="6374008">(</span><span class="ident" id="6374009">os</span><span class="op" id="6374011">.</span><span class="ident" id="6374012">Stderr</span><span class="op" id="6374018">,</span>&nbsp;<span class="string" id="6374020">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6374061">,</span>&nbsp;<span class="ident" id="6374063">benchName</span><span class="op" id="6374072">,</span>&nbsp;<span class="ident" id="6374074">p</span><span class="op" id="6374075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374084">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374087">}</span><br>
<span class="lineno"></span><span class="op" id="6374089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6374092">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6374168">func</span>&nbsp;<span class="op" id="6374173">(</span><span class="ident" id="6374174">b</span>&nbsp;<span class="op" id="6374176">*</span><span class="ident" id="6374177">B</span><span class="op" id="6374178">)</span>&nbsp;<span class="ident" id="6374180">trimOutput</span><span class="op" id="6374190">(</span><span class="op" id="6374191">)</span>&nbsp;<span class="op" id="6374193">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6374196">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6374268">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6374348">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374432">const</span>&nbsp;<span class="ident" id="6374438">maxNewlines</span>&nbsp;<span class="op" id="6374450">=</span>&nbsp;<span class="num" id="6374452">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374456">for</span>&nbsp;<span class="ident" id="6374460">nlCount</span><span class="op" id="6374467">,</span>&nbsp;<span class="ident" id="6374469">j</span>&nbsp;<span class="op" id="6374471">:=</span>&nbsp;<span class="num" id="6374474">0</span><span class="op" id="6374475">,</span>&nbsp;<span class="num" id="6374477">0</span><span class="op" id="6374478">;</span>&nbsp;<span class="ident" id="6374480">j</span>&nbsp;<span class="op" id="6374482">&lt;</span>&nbsp;<span class="builtinfunc" id="6374484">len</span><span class="op" id="6374487">(</span><span class="ident" id="6374488">b</span><span class="op" id="6374489">.</span><span class="ident" id="6374490">output</span><span class="op" id="6374496">)</span><span class="op" id="6374497">;</span>&nbsp;<span class="ident" id="6374499">j</span><span class="op" id="6374500">++</span>&nbsp;<span class="op" id="6374503">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374507">if</span>&nbsp;<span class="ident" id="6374510">b</span><span class="op" id="6374511">.</span><span class="ident" id="6374512">output</span><span class="op" id="6374518">[</span><span class="ident" id="6374519">j</span><span class="op" id="6374520">]</span>&nbsp;<span class="op" id="6374522">==</span>&nbsp;<span class="string" id="6374525">&#39;\n&#39;</span>&nbsp;<span class="op" id="6374530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374535">nlCount</span><span class="op" id="6374542">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374548">if</span>&nbsp;<span class="ident" id="6374551">nlCount</span>&nbsp;<span class="op" id="6374559">&gt;=</span>&nbsp;<span class="ident" id="6374562">maxNewlines</span>&nbsp;<span class="op" id="6374574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374580">b</span><span class="op" id="6374581">.</span><span class="ident" id="6374582">output</span>&nbsp;<span class="op" id="6374589">=</span>&nbsp;<span class="builtinfunc" id="6374591">append</span><span class="op" id="6374597">(</span><span class="ident" id="6374598">b</span><span class="op" id="6374599">.</span><span class="ident" id="6374600">output</span><span class="op" id="6374606">[</span><span class="op" id="6374607">:</span><span class="ident" id="6374608">j</span><span class="op" id="6374609">]</span><span class="op" id="6374610">,</span>&nbsp;<span class="string" id="6374612">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6374642">...</span><span class="op" id="6374645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374651">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374667">}</span><br>
<span class="lineno"></span><span class="op" id="6374669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6374672">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6374736">type</span>&nbsp;<span class="ident" id="6374741">PB</span>&nbsp;<span class="keyword" id="6374744">struct</span>&nbsp;<span class="op" id="6374751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374754">globalN</span>&nbsp;<span class="op" id="6374762">*</span><span class="builtintype" id="6374763">uint64</span>&nbsp;<span class="comment" id="6374770">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374829">grain</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6374837">uint64</span>&nbsp;&nbsp;<span class="comment" id="6374845">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374899">cache</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6374907">uint64</span>&nbsp;&nbsp;<span class="comment" id="6374915">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374954">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6374962">uint64</span>&nbsp;&nbsp;<span class="comment" id="6374970">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6375017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6375020">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6375082">func</span>&nbsp;<span class="op" id="6375087">(</span><span class="ident" id="6375088">pb</span>&nbsp;<span class="op" id="6375091">*</span><span class="ident" id="6375092">PB</span><span class="op" id="6375094">)</span>&nbsp;<span class="ident" id="6375096">Next</span><span class="op" id="6375100">(</span><span class="op" id="6375101">)</span>&nbsp;<span class="builtintype" id="6375103">bool</span>&nbsp;<span class="op" id="6375108">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375111">if</span>&nbsp;<span class="ident" id="6375114">pb</span><span class="op" id="6375116">.</span><span class="ident" id="6375117">cache</span>&nbsp;<span class="op" id="6375123">==</span>&nbsp;<span class="num" id="6375126">0</span>&nbsp;<span class="op" id="6375128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375132">n</span>&nbsp;<span class="op" id="6375134">:=</span>&nbsp;<span class="ident" id="6375137">atomic</span><span class="op" id="6375143">.</span><span class="ident" id="6375144">AddUint64</span><span class="op" id="6375153">(</span><span class="ident" id="6375154">pb</span><span class="op" id="6375156">.</span><span class="ident" id="6375157">globalN</span><span class="op" id="6375164">,</span>&nbsp;<span class="ident" id="6375166">pb</span><span class="op" id="6375168">.</span><span class="ident" id="6375169">grain</span><span class="op" id="6375174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375178">if</span>&nbsp;<span class="ident" id="6375181">n</span>&nbsp;<span class="op" id="6375183">&lt;=</span>&nbsp;<span class="ident" id="6375186">pb</span><span class="op" id="6375188">.</span><span class="ident" id="6375189">bN</span>&nbsp;<span class="op" id="6375192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375197">pb</span><span class="op" id="6375199">.</span><span class="ident" id="6375200">cache</span>&nbsp;<span class="op" id="6375206">=</span>&nbsp;<span class="ident" id="6375208">pb</span><span class="op" id="6375210">.</span><span class="ident" id="6375211">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375219">}</span>&nbsp;<span class="keyword" id="6375221">else</span>&nbsp;<span class="keyword" id="6375226">if</span>&nbsp;<span class="ident" id="6375229">n</span>&nbsp;<span class="op" id="6375231">&lt;</span>&nbsp;<span class="ident" id="6375233">pb</span><span class="op" id="6375235">.</span><span class="ident" id="6375236">bN</span><span class="op" id="6375238">+</span><span class="ident" id="6375239">pb</span><span class="op" id="6375241">.</span><span class="ident" id="6375242">grain</span>&nbsp;<span class="op" id="6375248">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375253">pb</span><span class="op" id="6375255">.</span><span class="ident" id="6375256">cache</span>&nbsp;<span class="op" id="6375262">=</span>&nbsp;<span class="ident" id="6375264">pb</span><span class="op" id="6375266">.</span><span class="ident" id="6375267">bN</span>&nbsp;<span class="op" id="6375270">+</span>&nbsp;<span class="ident" id="6375272">pb</span><span class="op" id="6375274">.</span><span class="ident" id="6375275">grain</span>&nbsp;<span class="op" id="6375281">-</span>&nbsp;<span class="ident" id="6375283">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375287">}</span>&nbsp;<span class="keyword" id="6375289">else</span>&nbsp;<span class="op" id="6375294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375299">return</span>&nbsp;<span class="builtintype" id="6375306">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375317">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375320">pb</span><span class="op" id="6375322">.</span><span class="ident" id="6375323">cache</span><span class="op" id="6375328">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375332">return</span>&nbsp;<span class="builtintype" id="6375339">true</span><br>
<span class="lineno"></span><span class="op" id="6375344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6375347">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6375392">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6375469">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6375549">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6375618">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6375677">//</span><br>
<span class="lineno">385</span><span class="comment" id="6375680">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6375753">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6375824">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6375897">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6375933">func</span>&nbsp;<span class="op" id="6375938">(</span><span class="ident" id="6375939">b</span>&nbsp;<span class="op" id="6375941">*</span><span class="ident" id="6375942">B</span><span class="op" id="6375943">)</span>&nbsp;<span class="ident" id="6375945">RunParallel</span><span class="op" id="6375956">(</span><span class="ident" id="6375957">body</span>&nbsp;<span class="keyword" id="6375962">func</span><span class="op" id="6375966">(</span><span class="op" id="6375967">*</span><span class="ident" id="6375968">PB</span><span class="op" id="6375970">)</span><span class="op" id="6375971">)</span>&nbsp;<span class="op" id="6375973">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6375976">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6376044">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6376113">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376141">grain</span>&nbsp;<span class="op" id="6376147">:=</span>&nbsp;<span class="builtintype" id="6376150">uint64</span><span class="op" id="6376156">(</span><span class="num" id="6376157">0</span><span class="op" id="6376158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376161">if</span>&nbsp;<span class="ident" id="6376164">b</span><span class="op" id="6376165">.</span><span class="ident" id="6376166">previousN</span>&nbsp;<span class="op" id="6376176">&gt;</span>&nbsp;<span class="num" id="6376178">0</span>&nbsp;<span class="op" id="6376180">&amp;&amp;</span>&nbsp;<span class="ident" id="6376183">b</span><span class="op" id="6376184">.</span><span class="ident" id="6376185">previousDuration</span>&nbsp;<span class="op" id="6376202">&gt;</span>&nbsp;<span class="num" id="6376204">0</span>&nbsp;<span class="op" id="6376206">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376210">grain</span>&nbsp;<span class="op" id="6376216">=</span>&nbsp;<span class="num" id="6376218">1e5</span>&nbsp;<span class="op" id="6376222">*</span>&nbsp;<span class="builtintype" id="6376224">uint64</span><span class="op" id="6376230">(</span><span class="ident" id="6376231">b</span><span class="op" id="6376232">.</span><span class="ident" id="6376233">previousN</span><span class="op" id="6376242">)</span>&nbsp;<span class="op" id="6376244">/</span>&nbsp;<span class="builtintype" id="6376246">uint64</span><span class="op" id="6376252">(</span><span class="ident" id="6376253">b</span><span class="op" id="6376254">.</span><span class="ident" id="6376255">previousDuration</span><span class="op" id="6376271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376277">if</span>&nbsp;<span class="ident" id="6376280">grain</span>&nbsp;<span class="op" id="6376286">&lt;</span>&nbsp;<span class="num" id="6376288">1</span>&nbsp;<span class="op" id="6376290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376294">grain</span>&nbsp;<span class="op" id="6376300">=</span>&nbsp;<span class="num" id="6376302">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376305">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6376308">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6376378">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376433">if</span>&nbsp;<span class="ident" id="6376436">grain</span>&nbsp;<span class="op" id="6376442">&gt;</span>&nbsp;<span class="num" id="6376444">1e4</span>&nbsp;<span class="op" id="6376448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376452">grain</span>&nbsp;<span class="op" id="6376458">=</span>&nbsp;<span class="num" id="6376460">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376465">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376469">n</span>&nbsp;<span class="op" id="6376471">:=</span>&nbsp;<span class="builtintype" id="6376474">uint64</span><span class="op" id="6376480">(</span><span class="num" id="6376481">0</span><span class="op" id="6376482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376485">numProcs</span>&nbsp;<span class="op" id="6376494">:=</span>&nbsp;<span class="ident" id="6376497">b</span><span class="op" id="6376498">.</span><span class="ident" id="6376499">parallelism</span>&nbsp;<span class="op" id="6376511">*</span>&nbsp;<span class="ident" id="6376513">runtime</span><span class="op" id="6376520">.</span><span class="ident" id="6376521">GOMAXPROCS</span><span class="op" id="6376531">(</span><span class="num" id="6376532">0</span><span class="op" id="6376533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376536">var</span>&nbsp;<span class="ident" id="6376540">wg</span>&nbsp;<span class="ident" id="6376543">sync</span><span class="op" id="6376547">.</span><span class="ident" id="6376548">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376559">wg</span><span class="op" id="6376561">.</span><span class="ident" id="6376562">Add</span><span class="op" id="6376565">(</span><span class="ident" id="6376566">numProcs</span><span class="op" id="6376574">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376577">for</span>&nbsp;<span class="ident" id="6376581">p</span>&nbsp;<span class="op" id="6376583">:=</span>&nbsp;<span class="num" id="6376586">0</span><span class="op" id="6376587">;</span>&nbsp;<span class="ident" id="6376589">p</span>&nbsp;<span class="op" id="6376591">&lt;</span>&nbsp;<span class="ident" id="6376593">numProcs</span><span class="op" id="6376601">;</span>&nbsp;<span class="ident" id="6376603">p</span><span class="op" id="6376604">++</span>&nbsp;<span class="op" id="6376607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376611">go</span>&nbsp;<span class="keyword" id="6376614">func</span><span class="op" id="6376618">(</span><span class="op" id="6376619">)</span>&nbsp;<span class="op" id="6376621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376626">defer</span>&nbsp;<span class="ident" id="6376632">wg</span><span class="op" id="6376634">.</span><span class="ident" id="6376635">Done</span><span class="op" id="6376639">(</span><span class="op" id="6376640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376645">pb</span>&nbsp;<span class="op" id="6376648">:=</span>&nbsp;<span class="op" id="6376651">&amp;</span><span class="ident" id="6376652">PB</span><span class="op" id="6376654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376660">globalN</span><span class="op" id="6376667">:</span>&nbsp;<span class="op" id="6376669">&amp;</span><span class="ident" id="6376670">n</span><span class="op" id="6376671">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376677">grain</span><span class="op" id="6376682">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6376686">grain</span><span class="op" id="6376691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376697">bN</span><span class="op" id="6376699">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6376706">uint64</span><span class="op" id="6376712">(</span><span class="ident" id="6376713">b</span><span class="op" id="6376714">.</span><span class="ident" id="6376715">N</span><span class="op" id="6376716">)</span><span class="op" id="6376717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376727">body</span><span class="op" id="6376731">(</span><span class="ident" id="6376732">pb</span><span class="op" id="6376734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376738">}</span><span class="op" id="6376739">(</span><span class="op" id="6376740">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376746">wg</span><span class="op" id="6376748">.</span><span class="ident" id="6376749">Wait</span><span class="op" id="6376753">(</span><span class="op" id="6376754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376757">if</span>&nbsp;<span class="ident" id="6376760">n</span>&nbsp;<span class="op" id="6376762">&lt;=</span>&nbsp;<span class="builtintype" id="6376765">uint64</span><span class="op" id="6376771">(</span><span class="ident" id="6376772">b</span><span class="op" id="6376773">.</span><span class="ident" id="6376774">N</span><span class="op" id="6376775">)</span>&nbsp;<span class="op" id="6376777">&amp;&amp;</span>&nbsp;<span class="op" id="6376780">!</span><span class="ident" id="6376781">b</span><span class="op" id="6376782">.</span><span class="ident" id="6376783">Failed</span><span class="op" id="6376789">(</span><span class="op" id="6376790">)</span>&nbsp;<span class="op" id="6376792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376796">b</span><span class="op" id="6376797">.</span><span class="ident" id="6376798">Fatal</span><span class="op" id="6376803">(</span><span class="string" id="6376804">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6376857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376860">}</span><br>
<span class="lineno">425</span><span class="op" id="6376862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6376865">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6376950">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6377027">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6377082">func</span>&nbsp;<span class="op" id="6377087">(</span><span class="ident" id="6377088">b</span>&nbsp;<span class="op" id="6377090">*</span><span class="ident" id="6377091">B</span><span class="op" id="6377092">)</span>&nbsp;<span class="ident" id="6377094">SetParallelism</span><span class="op" id="6377108">(</span><span class="ident" id="6377109">p</span>&nbsp;<span class="builtintype" id="6377111">int</span><span class="op" id="6377114">)</span>&nbsp;<span class="op" id="6377116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377119">if</span>&nbsp;<span class="ident" id="6377122">p</span>&nbsp;<span class="op" id="6377124">&gt;=</span>&nbsp;<span class="num" id="6377127">1</span>&nbsp;<span class="op" id="6377129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377133">b</span><span class="op" id="6377134">.</span><span class="ident" id="6377135">parallelism</span>&nbsp;<span class="op" id="6377147">=</span>&nbsp;<span class="ident" id="6377149">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377152">}</span><br>
<span class="lineno"></span><span class="op" id="6377154">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6377157">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6377220">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6377280">func</span>&nbsp;<span class="ident" id="6377285">Benchmark</span><span class="op" id="6377294">(</span><span class="ident" id="6377295">f</span>&nbsp;<span class="keyword" id="6377297">func</span><span class="op" id="6377301">(</span><span class="ident" id="6377302">b</span>&nbsp;<span class="op" id="6377304">*</span><span class="ident" id="6377305">B</span><span class="op" id="6377306">)</span><span class="op" id="6377307">)</span>&nbsp;<span class="ident" id="6377309">BenchmarkResult</span>&nbsp;<span class="op" id="6377325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377328">b</span>&nbsp;<span class="op" id="6377330">:=</span>&nbsp;<span class="op" id="6377333">&amp;</span><span class="ident" id="6377334">B</span><span class="op" id="6377335">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377339">common</span><span class="op" id="6377345">:</span>&nbsp;<span class="ident" id="6377347">common</span><span class="op" id="6377353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377358">signal</span><span class="op" id="6377364">:</span>&nbsp;<span class="builtinfunc" id="6377366">make</span><span class="op" id="6377370">(</span><span class="keyword" id="6377371">chan</span>&nbsp;<span class="keyword" id="6377376">interface</span><span class="op" id="6377385">{</span><span class="op" id="6377386">}</span><span class="op" id="6377387">)</span><span class="op" id="6377388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377392">}</span><span class="op" id="6377393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377397">benchmark</span><span class="op" id="6377406">:</span>&nbsp;<span class="ident" id="6377408">InternalBenchmark</span><span class="op" id="6377425">{</span><span class="string" id="6377426">&#34;&#34;</span><span class="op" id="6377428">,</span>&nbsp;<span class="ident" id="6377430">f</span><span class="op" id="6377431">}</span><span class="op" id="6377432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377435">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377438">return</span>&nbsp;<span class="ident" id="6377445">b</span><span class="op" id="6377446">.</span><span class="ident" id="6377447">run</span><span class="op" id="6377450">(</span><span class="op" id="6377451">)</span><br>
<span class="lineno"></span><span class="op" id="6377453">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
