<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html" class="current">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5354676">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5354731">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5354785">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5354836">package</span>&nbsp;<span class="ident" id="5354844">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5354852">import</span>&nbsp;<span class="op" id="5354859">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5354862">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5354868">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5354884">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5354887">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5354956">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="5355041">type</span>&nbsp;<span class="ident" id="5355046">queue</span>&nbsp;<span class="keyword" id="5355052">struct</span>&nbsp;<span class="op" id="5355059">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355062">sparse</span>&nbsp;<span class="op" id="5355069">[</span><span class="op" id="5355070">]</span><span class="builtintype" id="5355071">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355079">dense</span>&nbsp;&nbsp;<span class="op" id="5355086">[</span><span class="op" id="5355087">]</span><span class="ident" id="5355088">entry</span><br>
<span class="lineno"></span><span class="op" id="5355094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5355097">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="5355132">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="5355191">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5355256">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5355321">type</span>&nbsp;<span class="ident" id="5355326">entry</span>&nbsp;<span class="keyword" id="5355332">struct</span>&nbsp;<span class="op" id="5355339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355342">pc</span>&nbsp;<span class="builtintype" id="5355345">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355353">t</span>&nbsp;&nbsp;<span class="op" id="5355356">*</span><span class="ident" id="5355357">thread</span><br>
<span class="lineno"></span><span class="op" id="5355364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5355367">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="5355430">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="5355483">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="5355532">type</span>&nbsp;<span class="ident" id="5355537">thread</span>&nbsp;<span class="keyword" id="5355544">struct</span>&nbsp;<span class="op" id="5355551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355554">inst</span>&nbsp;<span class="op" id="5355559">*</span><span class="ident" id="5355560">syntax</span><span class="op" id="5355566">.</span><span class="ident" id="5355567">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5355573">cap</span>&nbsp;&nbsp;<span class="op" id="5355578">[</span><span class="op" id="5355579">]</span><span class="builtintype" id="5355580">int</span><br>
<span class="lineno"></span><span class="op" id="5355584">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5355587">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5355652">type</span>&nbsp;<span class="ident" id="5355657">machine</span>&nbsp;<span class="keyword" id="5355665">struct</span>&nbsp;<span class="op" id="5355672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355675">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5355684">*</span><span class="ident" id="5355685">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5355697">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355722">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5355731">*</span><span class="ident" id="5355732">syntax</span><span class="op" id="5355738">.</span><span class="ident" id="5355739">Prog</span>&nbsp;<span class="comment" id="5355744">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355765">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5355774">*</span><span class="ident" id="5355775">onePassProg</span>&nbsp;<span class="comment" id="5355787">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355831">q0</span><span class="op" id="5355833">,</span>&nbsp;<span class="ident" id="5355835">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5355840">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5355853">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355884">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5355893">[</span><span class="op" id="5355894">]</span><span class="op" id="5355895">*</span><span class="ident" id="5355896">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5355906">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355936">matched</span>&nbsp;&nbsp;<span class="builtintype" id="5355945">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5355958">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355988">matchcap</span>&nbsp;<span class="op" id="5355997">[</span><span class="op" id="5355998">]</span><span class="builtintype" id="5355999">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5356010">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5356049">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356088">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="5356100">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356112">inputString</span>&nbsp;<span class="ident" id="5356124">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356137">inputReader</span>&nbsp;<span class="ident" id="5356149">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="5356161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5356164">func</span>&nbsp;<span class="op" id="5356169">(</span><span class="ident" id="5356170">m</span>&nbsp;<span class="op" id="5356172">*</span><span class="ident" id="5356173">machine</span><span class="op" id="5356180">)</span>&nbsp;<span class="ident" id="5356182">newInputBytes</span><span class="op" id="5356195">(</span><span class="ident" id="5356196">b</span>&nbsp;<span class="op" id="5356198">[</span><span class="op" id="5356199">]</span><span class="builtintype" id="5356200">byte</span><span class="op" id="5356204">)</span>&nbsp;<span class="ident" id="5356206">input</span>&nbsp;<span class="op" id="5356212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356215">m</span><span class="op" id="5356216">.</span><span class="ident" id="5356217">inputBytes</span><span class="op" id="5356227">.</span><span class="ident" id="5356228">str</span>&nbsp;<span class="op" id="5356232">=</span>&nbsp;<span class="ident" id="5356234">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356237">return</span>&nbsp;<span class="op" id="5356244">&amp;</span><span class="ident" id="5356245">m</span><span class="op" id="5356246">.</span><span class="ident" id="5356247">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="5356258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5356261">func</span>&nbsp;<span class="op" id="5356266">(</span><span class="ident" id="5356267">m</span>&nbsp;<span class="op" id="5356269">*</span><span class="ident" id="5356270">machine</span><span class="op" id="5356277">)</span>&nbsp;<span class="ident" id="5356279">newInputString</span><span class="op" id="5356293">(</span><span class="ident" id="5356294">s</span>&nbsp;<span class="builtintype" id="5356296">string</span><span class="op" id="5356302">)</span>&nbsp;<span class="ident" id="5356304">input</span>&nbsp;<span class="op" id="5356310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356313">m</span><span class="op" id="5356314">.</span><span class="ident" id="5356315">inputString</span><span class="op" id="5356326">.</span><span class="ident" id="5356327">str</span>&nbsp;<span class="op" id="5356331">=</span>&nbsp;<span class="ident" id="5356333">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356336">return</span>&nbsp;<span class="op" id="5356343">&amp;</span><span class="ident" id="5356344">m</span><span class="op" id="5356345">.</span><span class="ident" id="5356346">inputString</span><br>
<span class="lineno">60</span><span class="op" id="5356358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5356361">func</span>&nbsp;<span class="op" id="5356366">(</span><span class="ident" id="5356367">m</span>&nbsp;<span class="op" id="5356369">*</span><span class="ident" id="5356370">machine</span><span class="op" id="5356377">)</span>&nbsp;<span class="ident" id="5356379">newInputReader</span><span class="op" id="5356393">(</span><span class="ident" id="5356394">r</span>&nbsp;<span class="ident" id="5356396">io</span><span class="op" id="5356398">.</span><span class="ident" id="5356399">RuneReader</span><span class="op" id="5356409">)</span>&nbsp;<span class="ident" id="5356411">input</span>&nbsp;<span class="op" id="5356417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356420">m</span><span class="op" id="5356421">.</span><span class="ident" id="5356422">inputReader</span><span class="op" id="5356433">.</span><span class="ident" id="5356434">r</span>&nbsp;<span class="op" id="5356436">=</span>&nbsp;<span class="ident" id="5356438">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356441">m</span><span class="op" id="5356442">.</span><span class="ident" id="5356443">inputReader</span><span class="op" id="5356454">.</span><span class="ident" id="5356455">atEOT</span>&nbsp;<span class="op" id="5356461">=</span>&nbsp;<span class="builtintype" id="5356463">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356470">m</span><span class="op" id="5356471">.</span><span class="ident" id="5356472">inputReader</span><span class="op" id="5356483">.</span><span class="ident" id="5356484">pos</span>&nbsp;<span class="op" id="5356488">=</span>&nbsp;<span class="num" id="5356490">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356493">return</span>&nbsp;<span class="op" id="5356500">&amp;</span><span class="ident" id="5356501">m</span><span class="op" id="5356502">.</span><span class="ident" id="5356503">inputReader</span><br>
<span class="lineno"></span><span class="op" id="5356515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5356518">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="5356575">func</span>&nbsp;<span class="ident" id="5356580">progMachine</span><span class="op" id="5356591">(</span><span class="ident" id="5356592">p</span>&nbsp;<span class="op" id="5356594">*</span><span class="ident" id="5356595">syntax</span><span class="op" id="5356601">.</span><span class="ident" id="5356602">Prog</span><span class="op" id="5356606">,</span>&nbsp;<span class="ident" id="5356608">op</span>&nbsp;<span class="op" id="5356611">*</span><span class="ident" id="5356612">onePassProg</span><span class="op" id="5356623">)</span>&nbsp;<span class="op" id="5356625">*</span><span class="ident" id="5356626">machine</span>&nbsp;<span class="op" id="5356634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356637">m</span>&nbsp;<span class="op" id="5356639">:=</span>&nbsp;<span class="op" id="5356642">&amp;</span><span class="ident" id="5356643">machine</span><span class="op" id="5356650">{</span><span class="ident" id="5356651">p</span><span class="op" id="5356652">:</span>&nbsp;<span class="ident" id="5356654">p</span><span class="op" id="5356655">,</span>&nbsp;<span class="ident" id="5356657">op</span><span class="op" id="5356659">:</span>&nbsp;<span class="ident" id="5356661">op</span><span class="op" id="5356663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356666">n</span>&nbsp;<span class="op" id="5356668">:=</span>&nbsp;<span class="builtinfunc" id="5356671">len</span><span class="op" id="5356674">(</span><span class="ident" id="5356675">m</span><span class="op" id="5356676">.</span><span class="ident" id="5356677">p</span><span class="op" id="5356678">.</span><span class="ident" id="5356679">Inst</span><span class="op" id="5356683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356686">m</span><span class="op" id="5356687">.</span><span class="ident" id="5356688">q0</span>&nbsp;<span class="op" id="5356691">=</span>&nbsp;<span class="ident" id="5356693">queue</span><span class="op" id="5356698">{</span><span class="builtinfunc" id="5356699">make</span><span class="op" id="5356703">(</span><span class="op" id="5356704">[</span><span class="op" id="5356705">]</span><span class="builtintype" id="5356706">uint32</span><span class="op" id="5356712">,</span>&nbsp;<span class="ident" id="5356714">n</span><span class="op" id="5356715">)</span><span class="op" id="5356716">,</span>&nbsp;<span class="builtinfunc" id="5356718">make</span><span class="op" id="5356722">(</span><span class="op" id="5356723">[</span><span class="op" id="5356724">]</span><span class="ident" id="5356725">entry</span><span class="op" id="5356730">,</span>&nbsp;<span class="num" id="5356732">0</span><span class="op" id="5356733">,</span>&nbsp;<span class="ident" id="5356735">n</span><span class="op" id="5356736">)</span><span class="op" id="5356737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356740">m</span><span class="op" id="5356741">.</span><span class="ident" id="5356742">q1</span>&nbsp;<span class="op" id="5356745">=</span>&nbsp;<span class="ident" id="5356747">queue</span><span class="op" id="5356752">{</span><span class="builtinfunc" id="5356753">make</span><span class="op" id="5356757">(</span><span class="op" id="5356758">[</span><span class="op" id="5356759">]</span><span class="builtintype" id="5356760">uint32</span><span class="op" id="5356766">,</span>&nbsp;<span class="ident" id="5356768">n</span><span class="op" id="5356769">)</span><span class="op" id="5356770">,</span>&nbsp;<span class="builtinfunc" id="5356772">make</span><span class="op" id="5356776">(</span><span class="op" id="5356777">[</span><span class="op" id="5356778">]</span><span class="ident" id="5356779">entry</span><span class="op" id="5356784">,</span>&nbsp;<span class="num" id="5356786">0</span><span class="op" id="5356787">,</span>&nbsp;<span class="ident" id="5356789">n</span><span class="op" id="5356790">)</span><span class="op" id="5356791">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356794">ncap</span>&nbsp;<span class="op" id="5356799">:=</span>&nbsp;<span class="ident" id="5356802">p</span><span class="op" id="5356803">.</span><span class="ident" id="5356804">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356812">if</span>&nbsp;<span class="ident" id="5356815">ncap</span>&nbsp;<span class="op" id="5356820">&lt;</span>&nbsp;<span class="num" id="5356822">2</span>&nbsp;<span class="op" id="5356824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356828">ncap</span>&nbsp;<span class="op" id="5356833">=</span>&nbsp;<span class="num" id="5356835">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356841">m</span><span class="op" id="5356842">.</span><span class="ident" id="5356843">matchcap</span>&nbsp;<span class="op" id="5356852">=</span>&nbsp;<span class="builtinfunc" id="5356854">make</span><span class="op" id="5356858">(</span><span class="op" id="5356859">[</span><span class="op" id="5356860">]</span><span class="builtintype" id="5356861">int</span><span class="op" id="5356864">,</span>&nbsp;<span class="ident" id="5356866">ncap</span><span class="op" id="5356870">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356873">return</span>&nbsp;<span class="ident" id="5356880">m</span><br>
<span class="lineno"></span><span class="op" id="5356882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5356885">func</span>&nbsp;<span class="op" id="5356890">(</span><span class="ident" id="5356891">m</span>&nbsp;<span class="op" id="5356893">*</span><span class="ident" id="5356894">machine</span><span class="op" id="5356901">)</span>&nbsp;<span class="ident" id="5356903">init</span><span class="op" id="5356907">(</span><span class="ident" id="5356908">ncap</span>&nbsp;<span class="builtintype" id="5356913">int</span><span class="op" id="5356916">)</span>&nbsp;<span class="op" id="5356918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356921">for</span>&nbsp;<span class="ident" id="5356925">_</span><span class="op" id="5356926">,</span>&nbsp;<span class="ident" id="5356928">t</span>&nbsp;<span class="op" id="5356930">:=</span>&nbsp;<span class="keyword" id="5356933">range</span>&nbsp;<span class="ident" id="5356939">m</span><span class="op" id="5356940">.</span><span class="ident" id="5356941">pool</span>&nbsp;<span class="op" id="5356946">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356950">t</span><span class="op" id="5356951">.</span><span class="builtinfunc" id="5356952">cap</span>&nbsp;<span class="op" id="5356956">=</span>&nbsp;<span class="ident" id="5356958">t</span><span class="op" id="5356959">.</span><span class="builtinfunc" id="5356960">cap</span><span class="op" id="5356963">[</span><span class="op" id="5356964">:</span><span class="ident" id="5356965">ncap</span><span class="op" id="5356969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356975">m</span><span class="op" id="5356976">.</span><span class="ident" id="5356977">matchcap</span>&nbsp;<span class="op" id="5356986">=</span>&nbsp;<span class="ident" id="5356988">m</span><span class="op" id="5356989">.</span><span class="ident" id="5356990">matchcap</span><span class="op" id="5356998">[</span><span class="op" id="5356999">:</span><span class="ident" id="5357000">ncap</span><span class="op" id="5357004">]</span><br>
<span class="lineno"></span><span class="op" id="5357006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5357009">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5357069">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5357107">func</span>&nbsp;<span class="op" id="5357112">(</span><span class="ident" id="5357113">m</span>&nbsp;<span class="op" id="5357115">*</span><span class="ident" id="5357116">machine</span><span class="op" id="5357123">)</span>&nbsp;<span class="ident" id="5357125">alloc</span><span class="op" id="5357130">(</span><span class="ident" id="5357131">i</span>&nbsp;<span class="op" id="5357133">*</span><span class="ident" id="5357134">syntax</span><span class="op" id="5357140">.</span><span class="ident" id="5357141">Inst</span><span class="op" id="5357145">)</span>&nbsp;<span class="op" id="5357147">*</span><span class="ident" id="5357148">thread</span>&nbsp;<span class="op" id="5357155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357158">var</span>&nbsp;<span class="ident" id="5357162">t</span>&nbsp;<span class="op" id="5357164">*</span><span class="ident" id="5357165">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357173">if</span>&nbsp;<span class="ident" id="5357176">n</span>&nbsp;<span class="op" id="5357178">:=</span>&nbsp;<span class="builtinfunc" id="5357181">len</span><span class="op" id="5357184">(</span><span class="ident" id="5357185">m</span><span class="op" id="5357186">.</span><span class="ident" id="5357187">pool</span><span class="op" id="5357191">)</span><span class="op" id="5357192">;</span>&nbsp;<span class="ident" id="5357194">n</span>&nbsp;<span class="op" id="5357196">&gt;</span>&nbsp;<span class="num" id="5357198">0</span>&nbsp;<span class="op" id="5357200">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357204">t</span>&nbsp;<span class="op" id="5357206">=</span>&nbsp;<span class="ident" id="5357208">m</span><span class="op" id="5357209">.</span><span class="ident" id="5357210">pool</span><span class="op" id="5357214">[</span><span class="ident" id="5357215">n</span><span class="op" id="5357216">-</span><span class="num" id="5357217">1</span><span class="op" id="5357218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357222">m</span><span class="op" id="5357223">.</span><span class="ident" id="5357224">pool</span>&nbsp;<span class="op" id="5357229">=</span>&nbsp;<span class="ident" id="5357231">m</span><span class="op" id="5357232">.</span><span class="ident" id="5357233">pool</span><span class="op" id="5357237">[</span><span class="op" id="5357238">:</span><span class="ident" id="5357239">n</span><span class="op" id="5357240">-</span><span class="num" id="5357241">1</span><span class="op" id="5357242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357245">}</span>&nbsp;<span class="keyword" id="5357247">else</span>&nbsp;<span class="op" id="5357252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357256">t</span>&nbsp;<span class="op" id="5357258">=</span>&nbsp;<span class="builtinfunc" id="5357260">new</span><span class="op" id="5357263">(</span><span class="ident" id="5357264">thread</span><span class="op" id="5357270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357274">t</span><span class="op" id="5357275">.</span><span class="builtinfunc" id="5357276">cap</span>&nbsp;<span class="op" id="5357280">=</span>&nbsp;<span class="builtinfunc" id="5357282">make</span><span class="op" id="5357286">(</span><span class="op" id="5357287">[</span><span class="op" id="5357288">]</span><span class="builtintype" id="5357289">int</span><span class="op" id="5357292">,</span>&nbsp;<span class="builtinfunc" id="5357294">len</span><span class="op" id="5357297">(</span><span class="ident" id="5357298">m</span><span class="op" id="5357299">.</span><span class="ident" id="5357300">matchcap</span><span class="op" id="5357308">)</span><span class="op" id="5357309">,</span>&nbsp;<span class="builtinfunc" id="5357311">cap</span><span class="op" id="5357314">(</span><span class="ident" id="5357315">m</span><span class="op" id="5357316">.</span><span class="ident" id="5357317">matchcap</span><span class="op" id="5357325">)</span><span class="op" id="5357326">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357332">t</span><span class="op" id="5357333">.</span><span class="ident" id="5357334">inst</span>&nbsp;<span class="op" id="5357339">=</span>&nbsp;<span class="ident" id="5357341">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357344">return</span>&nbsp;<span class="ident" id="5357351">t</span><br>
<span class="lineno"></span><span class="op" id="5357353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5357356">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="5357392">func</span>&nbsp;<span class="op" id="5357397">(</span><span class="ident" id="5357398">m</span>&nbsp;<span class="op" id="5357400">*</span><span class="ident" id="5357401">machine</span><span class="op" id="5357408">)</span>&nbsp;<span class="ident" id="5357410">free</span><span class="op" id="5357414">(</span><span class="ident" id="5357415">t</span>&nbsp;<span class="op" id="5357417">*</span><span class="ident" id="5357418">thread</span><span class="op" id="5357424">)</span>&nbsp;<span class="op" id="5357426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357429">m</span><span class="op" id="5357430">.</span><span class="ident" id="5357431">inputBytes</span><span class="op" id="5357441">.</span><span class="ident" id="5357442">str</span>&nbsp;<span class="op" id="5357446">=</span>&nbsp;<span class="ident" id="5357448">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357453">m</span><span class="op" id="5357454">.</span><span class="ident" id="5357455">inputString</span><span class="op" id="5357466">.</span><span class="ident" id="5357467">str</span>&nbsp;<span class="op" id="5357471">=</span>&nbsp;<span class="string" id="5357473">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357477">m</span><span class="op" id="5357478">.</span><span class="ident" id="5357479">inputReader</span><span class="op" id="5357490">.</span><span class="ident" id="5357491">r</span>&nbsp;<span class="op" id="5357493">=</span>&nbsp;<span class="ident" id="5357495">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357500">m</span><span class="op" id="5357501">.</span><span class="ident" id="5357502">pool</span>&nbsp;<span class="op" id="5357507">=</span>&nbsp;<span class="builtinfunc" id="5357509">append</span><span class="op" id="5357515">(</span><span class="ident" id="5357516">m</span><span class="op" id="5357517">.</span><span class="ident" id="5357518">pool</span><span class="op" id="5357522">,</span>&nbsp;<span class="ident" id="5357524">t</span><span class="op" id="5357525">)</span><br>
<span class="lineno"></span><span class="op" id="5357527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5357530">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5357588">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="5357629">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5357682">func</span>&nbsp;<span class="op" id="5357687">(</span><span class="ident" id="5357688">m</span>&nbsp;<span class="op" id="5357690">*</span><span class="ident" id="5357691">machine</span><span class="op" id="5357698">)</span>&nbsp;<span class="ident" id="5357700">match</span><span class="op" id="5357705">(</span><span class="ident" id="5357706">i</span>&nbsp;<span class="ident" id="5357708">input</span><span class="op" id="5357713">,</span>&nbsp;<span class="ident" id="5357715">pos</span>&nbsp;<span class="builtintype" id="5357719">int</span><span class="op" id="5357722">)</span>&nbsp;<span class="builtintype" id="5357724">bool</span>&nbsp;<span class="op" id="5357729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357732">startCond</span>&nbsp;<span class="op" id="5357742">:=</span>&nbsp;<span class="ident" id="5357745">m</span><span class="op" id="5357746">.</span><span class="ident" id="5357747">re</span><span class="op" id="5357749">.</span><span class="ident" id="5357750">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357756">if</span>&nbsp;<span class="ident" id="5357759">startCond</span>&nbsp;<span class="op" id="5357769">==</span>&nbsp;<span class="op" id="5357772">^</span><span class="ident" id="5357773">syntax</span><span class="op" id="5357779">.</span><span class="ident" id="5357780">EmptyOp</span><span class="op" id="5357787">(</span><span class="num" id="5357788">0</span><span class="op" id="5357789">)</span>&nbsp;<span class="op" id="5357791">{</span>&nbsp;<span class="comment" id="5357793">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357809">return</span>&nbsp;<span class="builtintype" id="5357816">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357826">m</span><span class="op" id="5357827">.</span><span class="ident" id="5357828">matched</span>&nbsp;<span class="op" id="5357836">=</span>&nbsp;<span class="builtintype" id="5357838">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357845">for</span>&nbsp;<span class="ident" id="5357849">i</span>&nbsp;<span class="op" id="5357851">:=</span>&nbsp;<span class="keyword" id="5357854">range</span>&nbsp;<span class="ident" id="5357860">m</span><span class="op" id="5357861">.</span><span class="ident" id="5357862">matchcap</span>&nbsp;<span class="op" id="5357871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357875">m</span><span class="op" id="5357876">.</span><span class="ident" id="5357877">matchcap</span><span class="op" id="5357885">[</span><span class="ident" id="5357886">i</span><span class="op" id="5357887">]</span>&nbsp;<span class="op" id="5357889">=</span>&nbsp;<span class="op" id="5357891">-</span><span class="num" id="5357892">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357895">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357898">runq</span><span class="op" id="5357902">,</span>&nbsp;<span class="ident" id="5357904">nextq</span>&nbsp;<span class="op" id="5357910">:=</span>&nbsp;<span class="op" id="5357913">&amp;</span><span class="ident" id="5357914">m</span><span class="op" id="5357915">.</span><span class="ident" id="5357916">q0</span><span class="op" id="5357918">,</span>&nbsp;<span class="op" id="5357920">&amp;</span><span class="ident" id="5357921">m</span><span class="op" id="5357922">.</span><span class="ident" id="5357923">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357927">r</span><span class="op" id="5357928">,</span>&nbsp;<span class="ident" id="5357930">r1</span>&nbsp;<span class="op" id="5357933">:=</span>&nbsp;<span class="ident" id="5357936">endOfText</span><span class="op" id="5357945">,</span>&nbsp;<span class="ident" id="5357947">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357958">width</span><span class="op" id="5357963">,</span>&nbsp;<span class="ident" id="5357965">width1</span>&nbsp;<span class="op" id="5357972">:=</span>&nbsp;<span class="num" id="5357975">0</span><span class="op" id="5357976">,</span>&nbsp;<span class="num" id="5357978">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357981">r</span><span class="op" id="5357982">,</span>&nbsp;<span class="ident" id="5357984">width</span>&nbsp;<span class="op" id="5357990">=</span>&nbsp;<span class="ident" id="5357992">i</span><span class="op" id="5357993">.</span><span class="ident" id="5357994">step</span><span class="op" id="5357998">(</span><span class="ident" id="5357999">pos</span><span class="op" id="5358002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358005">if</span>&nbsp;<span class="ident" id="5358008">r</span>&nbsp;<span class="op" id="5358010">!=</span>&nbsp;<span class="ident" id="5358013">endOfText</span>&nbsp;<span class="op" id="5358023">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358027">r1</span><span class="op" id="5358029">,</span>&nbsp;<span class="ident" id="5358031">width1</span>&nbsp;<span class="op" id="5358038">=</span>&nbsp;<span class="ident" id="5358040">i</span><span class="op" id="5358041">.</span><span class="ident" id="5358042">step</span><span class="op" id="5358046">(</span><span class="ident" id="5358047">pos</span>&nbsp;<span class="op" id="5358051">+</span>&nbsp;<span class="ident" id="5358053">width</span><span class="op" id="5358058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358064">var</span>&nbsp;<span class="ident" id="5358068">flag</span>&nbsp;<span class="ident" id="5358073">syntax</span><span class="op" id="5358079">.</span><span class="ident" id="5358080">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358089">if</span>&nbsp;<span class="ident" id="5358092">pos</span>&nbsp;<span class="op" id="5358096">==</span>&nbsp;<span class="num" id="5358099">0</span>&nbsp;<span class="op" id="5358101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358105">flag</span>&nbsp;<span class="op" id="5358110">=</span>&nbsp;<span class="ident" id="5358112">syntax</span><span class="op" id="5358118">.</span><span class="ident" id="5358119">EmptyOpContext</span><span class="op" id="5358133">(</span><span class="op" id="5358134">-</span><span class="num" id="5358135">1</span><span class="op" id="5358136">,</span>&nbsp;<span class="ident" id="5358138">r</span><span class="op" id="5358139">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358142">}</span>&nbsp;<span class="keyword" id="5358144">else</span>&nbsp;<span class="op" id="5358149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358153">flag</span>&nbsp;<span class="op" id="5358158">=</span>&nbsp;<span class="ident" id="5358160">i</span><span class="op" id="5358161">.</span><span class="ident" id="5358162">context</span><span class="op" id="5358169">(</span><span class="ident" id="5358170">pos</span><span class="op" id="5358173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358179">for</span>&nbsp;<span class="op" id="5358183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358187">if</span>&nbsp;<span class="builtinfunc" id="5358190">len</span><span class="op" id="5358193">(</span><span class="ident" id="5358194">runq</span><span class="op" id="5358198">.</span><span class="ident" id="5358199">dense</span><span class="op" id="5358204">)</span>&nbsp;<span class="op" id="5358206">==</span>&nbsp;<span class="num" id="5358209">0</span>&nbsp;<span class="op" id="5358211">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358216">if</span>&nbsp;<span class="ident" id="5358219">startCond</span><span class="op" id="5358228">&amp;</span><span class="ident" id="5358229">syntax</span><span class="op" id="5358235">.</span><span class="ident" id="5358236">EmptyBeginText</span>&nbsp;<span class="op" id="5358251">!=</span>&nbsp;<span class="num" id="5358254">0</span>&nbsp;<span class="op" id="5358256">&amp;&amp;</span>&nbsp;<span class="ident" id="5358259">pos</span>&nbsp;<span class="op" id="5358263">!=</span>&nbsp;<span class="num" id="5358266">0</span>&nbsp;<span class="op" id="5358268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5358274">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358321">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358335">if</span>&nbsp;<span class="ident" id="5358338">m</span><span class="op" id="5358339">.</span><span class="ident" id="5358340">matched</span>&nbsp;<span class="op" id="5358348">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5358354">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358406">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358420">if</span>&nbsp;<span class="builtinfunc" id="5358423">len</span><span class="op" id="5358426">(</span><span class="ident" id="5358427">m</span><span class="op" id="5358428">.</span><span class="ident" id="5358429">re</span><span class="op" id="5358431">.</span><span class="ident" id="5358432">prefix</span><span class="op" id="5358438">)</span>&nbsp;<span class="op" id="5358440">&gt;</span>&nbsp;<span class="num" id="5358442">0</span>&nbsp;<span class="op" id="5358444">&amp;&amp;</span>&nbsp;<span class="ident" id="5358447">r1</span>&nbsp;<span class="op" id="5358450">!=</span>&nbsp;<span class="ident" id="5358453">m</span><span class="op" id="5358454">.</span><span class="ident" id="5358455">re</span><span class="op" id="5358457">.</span><span class="ident" id="5358458">prefixRune</span>&nbsp;<span class="op" id="5358469">&amp;&amp;</span>&nbsp;<span class="ident" id="5358472">i</span><span class="op" id="5358473">.</span><span class="ident" id="5358474">canCheckPrefix</span><span class="op" id="5358488">(</span><span class="op" id="5358489">)</span>&nbsp;<span class="op" id="5358491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5358497">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358555">advance</span>&nbsp;<span class="op" id="5358563">:=</span>&nbsp;<span class="ident" id="5358566">i</span><span class="op" id="5358567">.</span><span class="ident" id="5358568">index</span><span class="op" id="5358573">(</span><span class="ident" id="5358574">m</span><span class="op" id="5358575">.</span><span class="ident" id="5358576">re</span><span class="op" id="5358578">,</span>&nbsp;<span class="ident" id="5358580">pos</span><span class="op" id="5358583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358589">if</span>&nbsp;<span class="ident" id="5358592">advance</span>&nbsp;<span class="op" id="5358600">&lt;</span>&nbsp;<span class="num" id="5358602">0</span>&nbsp;<span class="op" id="5358604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358611">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358627">pos</span>&nbsp;<span class="op" id="5358631">+=</span>&nbsp;<span class="ident" id="5358634">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358646">r</span><span class="op" id="5358647">,</span>&nbsp;<span class="ident" id="5358649">width</span>&nbsp;<span class="op" id="5358655">=</span>&nbsp;<span class="ident" id="5358657">i</span><span class="op" id="5358658">.</span><span class="ident" id="5358659">step</span><span class="op" id="5358663">(</span><span class="ident" id="5358664">pos</span><span class="op" id="5358667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358673">r1</span><span class="op" id="5358675">,</span>&nbsp;<span class="ident" id="5358677">width1</span>&nbsp;<span class="op" id="5358684">=</span>&nbsp;<span class="ident" id="5358686">i</span><span class="op" id="5358687">.</span><span class="ident" id="5358688">step</span><span class="op" id="5358692">(</span><span class="ident" id="5358693">pos</span>&nbsp;<span class="op" id="5358697">+</span>&nbsp;<span class="ident" id="5358699">width</span><span class="op" id="5358704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358717">if</span>&nbsp;<span class="op" id="5358720">!</span><span class="ident" id="5358721">m</span><span class="op" id="5358722">.</span><span class="ident" id="5358723">matched</span>&nbsp;<span class="op" id="5358731">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358736">if</span>&nbsp;<span class="builtinfunc" id="5358739">len</span><span class="op" id="5358742">(</span><span class="ident" id="5358743">m</span><span class="op" id="5358744">.</span><span class="ident" id="5358745">matchcap</span><span class="op" id="5358753">)</span>&nbsp;<span class="op" id="5358755">&gt;</span>&nbsp;<span class="num" id="5358757">0</span>&nbsp;<span class="op" id="5358759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358765">m</span><span class="op" id="5358766">.</span><span class="ident" id="5358767">matchcap</span><span class="op" id="5358775">[</span><span class="num" id="5358776">0</span><span class="op" id="5358777">]</span>&nbsp;<span class="op" id="5358779">=</span>&nbsp;<span class="ident" id="5358781">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358793">m</span><span class="op" id="5358794">.</span><span class="ident" id="5358795">add</span><span class="op" id="5358798">(</span><span class="ident" id="5358799">runq</span><span class="op" id="5358803">,</span>&nbsp;<span class="builtintype" id="5358805">uint32</span><span class="op" id="5358811">(</span><span class="ident" id="5358812">m</span><span class="op" id="5358813">.</span><span class="ident" id="5358814">p</span><span class="op" id="5358815">.</span><span class="ident" id="5358816">Start</span><span class="op" id="5358821">)</span><span class="op" id="5358822">,</span>&nbsp;<span class="ident" id="5358824">pos</span><span class="op" id="5358827">,</span>&nbsp;<span class="ident" id="5358829">m</span><span class="op" id="5358830">.</span><span class="ident" id="5358831">matchcap</span><span class="op" id="5358839">,</span>&nbsp;<span class="ident" id="5358841">flag</span><span class="op" id="5358845">,</span>&nbsp;<span class="ident" id="5358847">nil</span><span class="op" id="5358850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358854">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358858">flag</span>&nbsp;<span class="op" id="5358863">=</span>&nbsp;<span class="ident" id="5358865">syntax</span><span class="op" id="5358871">.</span><span class="ident" id="5358872">EmptyOpContext</span><span class="op" id="5358886">(</span><span class="ident" id="5358887">r</span><span class="op" id="5358888">,</span>&nbsp;<span class="ident" id="5358890">r1</span><span class="op" id="5358892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358896">m</span><span class="op" id="5358897">.</span><span class="ident" id="5358898">step</span><span class="op" id="5358902">(</span><span class="ident" id="5358903">runq</span><span class="op" id="5358907">,</span>&nbsp;<span class="ident" id="5358909">nextq</span><span class="op" id="5358914">,</span>&nbsp;<span class="ident" id="5358916">pos</span><span class="op" id="5358919">,</span>&nbsp;<span class="ident" id="5358921">pos</span><span class="op" id="5358924">+</span><span class="ident" id="5358925">width</span><span class="op" id="5358930">,</span>&nbsp;<span class="ident" id="5358932">r</span><span class="op" id="5358933">,</span>&nbsp;<span class="ident" id="5358935">flag</span><span class="op" id="5358939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358943">if</span>&nbsp;<span class="ident" id="5358946">width</span>&nbsp;<span class="op" id="5358952">==</span>&nbsp;<span class="num" id="5358955">0</span>&nbsp;<span class="op" id="5358957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358962">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358970">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358974">if</span>&nbsp;<span class="builtinfunc" id="5358977">len</span><span class="op" id="5358980">(</span><span class="ident" id="5358981">m</span><span class="op" id="5358982">.</span><span class="ident" id="5358983">matchcap</span><span class="op" id="5358991">)</span>&nbsp;<span class="op" id="5358993">==</span>&nbsp;<span class="num" id="5358996">0</span>&nbsp;<span class="op" id="5358998">&amp;&amp;</span>&nbsp;<span class="ident" id="5359001">m</span><span class="op" id="5359002">.</span><span class="ident" id="5359003">matched</span>&nbsp;<span class="op" id="5359011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5359016">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5359061">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359105">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359113">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359117">pos</span>&nbsp;<span class="op" id="5359121">+=</span>&nbsp;<span class="ident" id="5359124">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359132">r</span><span class="op" id="5359133">,</span>&nbsp;<span class="ident" id="5359135">width</span>&nbsp;<span class="op" id="5359141">=</span>&nbsp;<span class="ident" id="5359143">r1</span><span class="op" id="5359145">,</span>&nbsp;<span class="ident" id="5359147">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359156">if</span>&nbsp;<span class="ident" id="5359159">r</span>&nbsp;<span class="op" id="5359161">!=</span>&nbsp;<span class="ident" id="5359164">endOfText</span>&nbsp;<span class="op" id="5359174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359179">r1</span><span class="op" id="5359181">,</span>&nbsp;<span class="ident" id="5359183">width1</span>&nbsp;<span class="op" id="5359190">=</span>&nbsp;<span class="ident" id="5359192">i</span><span class="op" id="5359193">.</span><span class="ident" id="5359194">step</span><span class="op" id="5359198">(</span><span class="ident" id="5359199">pos</span>&nbsp;<span class="op" id="5359203">+</span>&nbsp;<span class="ident" id="5359205">width</span><span class="op" id="5359210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359214">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359218">runq</span><span class="op" id="5359222">,</span>&nbsp;<span class="ident" id="5359224">nextq</span>&nbsp;<span class="op" id="5359230">=</span>&nbsp;<span class="ident" id="5359232">nextq</span><span class="op" id="5359237">,</span>&nbsp;<span class="ident" id="5359239">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359248">m</span><span class="op" id="5359249">.</span><span class="ident" id="5359250">clear</span><span class="op" id="5359255">(</span><span class="ident" id="5359256">nextq</span><span class="op" id="5359261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359264">return</span>&nbsp;<span class="ident" id="5359271">m</span><span class="op" id="5359272">.</span><span class="ident" id="5359273">matched</span><br>
<span class="lineno"></span><span class="op" id="5359281">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="5359284">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="5359332">func</span>&nbsp;<span class="op" id="5359337">(</span><span class="ident" id="5359338">m</span>&nbsp;<span class="op" id="5359340">*</span><span class="ident" id="5359341">machine</span><span class="op" id="5359348">)</span>&nbsp;<span class="ident" id="5359350">clear</span><span class="op" id="5359355">(</span><span class="ident" id="5359356">q</span>&nbsp;<span class="op" id="5359358">*</span><span class="ident" id="5359359">queue</span><span class="op" id="5359364">)</span>&nbsp;<span class="op" id="5359366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359369">for</span>&nbsp;<span class="ident" id="5359373">_</span><span class="op" id="5359374">,</span>&nbsp;<span class="ident" id="5359376">d</span>&nbsp;<span class="op" id="5359378">:=</span>&nbsp;<span class="keyword" id="5359381">range</span>&nbsp;<span class="ident" id="5359387">q</span><span class="op" id="5359388">.</span><span class="ident" id="5359389">dense</span>&nbsp;<span class="op" id="5359395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359399">if</span>&nbsp;<span class="ident" id="5359402">d</span><span class="op" id="5359403">.</span><span class="ident" id="5359404">t</span>&nbsp;<span class="op" id="5359406">!=</span>&nbsp;<span class="ident" id="5359409">nil</span>&nbsp;<span class="op" id="5359413">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5359418">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359436">m</span><span class="op" id="5359437">.</span><span class="ident" id="5359438">pool</span>&nbsp;<span class="op" id="5359443">=</span>&nbsp;<span class="builtinfunc" id="5359445">append</span><span class="op" id="5359451">(</span><span class="ident" id="5359452">m</span><span class="op" id="5359453">.</span><span class="ident" id="5359454">pool</span><span class="op" id="5359458">,</span>&nbsp;<span class="ident" id="5359460">d</span><span class="op" id="5359461">.</span><span class="ident" id="5359462">t</span><span class="op" id="5359463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359473">q</span><span class="op" id="5359474">.</span><span class="ident" id="5359475">dense</span>&nbsp;<span class="op" id="5359481">=</span>&nbsp;<span class="ident" id="5359483">q</span><span class="op" id="5359484">.</span><span class="ident" id="5359485">dense</span><span class="op" id="5359490">[</span><span class="op" id="5359491">:</span><span class="num" id="5359492">0</span><span class="op" id="5359493">]</span><br>
<span class="lineno">195</span><span class="op" id="5359495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5359498">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5359568">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="5359615">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="5359674">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="5359727">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="5359792">func</span>&nbsp;<span class="op" id="5359797">(</span><span class="ident" id="5359798">m</span>&nbsp;<span class="op" id="5359800">*</span><span class="ident" id="5359801">machine</span><span class="op" id="5359808">)</span>&nbsp;<span class="ident" id="5359810">step</span><span class="op" id="5359814">(</span><span class="ident" id="5359815">runq</span><span class="op" id="5359819">,</span>&nbsp;<span class="ident" id="5359821">nextq</span>&nbsp;<span class="op" id="5359827">*</span><span class="ident" id="5359828">queue</span><span class="op" id="5359833">,</span>&nbsp;<span class="ident" id="5359835">pos</span><span class="op" id="5359838">,</span>&nbsp;<span class="ident" id="5359840">nextPos</span>&nbsp;<span class="builtintype" id="5359848">int</span><span class="op" id="5359851">,</span>&nbsp;<span class="ident" id="5359853">c</span>&nbsp;<span class="builtintype" id="5359855">rune</span><span class="op" id="5359859">,</span>&nbsp;<span class="ident" id="5359861">nextCond</span>&nbsp;<span class="ident" id="5359870">syntax</span><span class="op" id="5359876">.</span><span class="ident" id="5359877">EmptyOp</span><span class="op" id="5359884">)</span>&nbsp;<span class="op" id="5359886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359889">longest</span>&nbsp;<span class="op" id="5359897">:=</span>&nbsp;<span class="ident" id="5359900">m</span><span class="op" id="5359901">.</span><span class="ident" id="5359902">re</span><span class="op" id="5359904">.</span><span class="ident" id="5359905">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359914">for</span>&nbsp;<span class="ident" id="5359918">j</span>&nbsp;<span class="op" id="5359920">:=</span>&nbsp;<span class="num" id="5359923">0</span><span class="op" id="5359924">;</span>&nbsp;<span class="ident" id="5359926">j</span>&nbsp;<span class="op" id="5359928">&lt;</span>&nbsp;<span class="builtinfunc" id="5359930">len</span><span class="op" id="5359933">(</span><span class="ident" id="5359934">runq</span><span class="op" id="5359938">.</span><span class="ident" id="5359939">dense</span><span class="op" id="5359944">)</span><span class="op" id="5359945">;</span>&nbsp;<span class="ident" id="5359947">j</span><span class="op" id="5359948">++</span>&nbsp;<span class="op" id="5359951">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359955">d</span>&nbsp;<span class="op" id="5359957">:=</span>&nbsp;<span class="op" id="5359960">&amp;</span><span class="ident" id="5359961">runq</span><span class="op" id="5359965">.</span><span class="ident" id="5359966">dense</span><span class="op" id="5359971">[</span><span class="ident" id="5359972">j</span><span class="op" id="5359973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359977">t</span>&nbsp;<span class="op" id="5359979">:=</span>&nbsp;<span class="ident" id="5359982">d</span><span class="op" id="5359983">.</span><span class="ident" id="5359984">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359988">if</span>&nbsp;<span class="ident" id="5359991">t</span>&nbsp;<span class="op" id="5359993">==</span>&nbsp;<span class="ident" id="5359996">nil</span>&nbsp;<span class="op" id="5360000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360005">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360016">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360020">if</span>&nbsp;<span class="ident" id="5360023">longest</span>&nbsp;<span class="op" id="5360031">&amp;&amp;</span>&nbsp;<span class="ident" id="5360034">m</span><span class="op" id="5360035">.</span><span class="ident" id="5360036">matched</span>&nbsp;<span class="op" id="5360044">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5360047">len</span><span class="op" id="5360050">(</span><span class="ident" id="5360051">t</span><span class="op" id="5360052">.</span><span class="builtinfunc" id="5360053">cap</span><span class="op" id="5360056">)</span>&nbsp;<span class="op" id="5360058">&gt;</span>&nbsp;<span class="num" id="5360060">0</span>&nbsp;<span class="op" id="5360062">&amp;&amp;</span>&nbsp;<span class="ident" id="5360065">m</span><span class="op" id="5360066">.</span><span class="ident" id="5360067">matchcap</span><span class="op" id="5360075">[</span><span class="num" id="5360076">0</span><span class="op" id="5360077">]</span>&nbsp;<span class="op" id="5360079">&lt;</span>&nbsp;<span class="ident" id="5360081">t</span><span class="op" id="5360082">.</span><span class="builtinfunc" id="5360083">cap</span><span class="op" id="5360086">[</span><span class="num" id="5360087">0</span><span class="op" id="5360088">]</span>&nbsp;<span class="op" id="5360090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5360095">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360111">m</span><span class="op" id="5360112">.</span><span class="ident" id="5360113">pool</span>&nbsp;<span class="op" id="5360118">=</span>&nbsp;<span class="builtinfunc" id="5360120">append</span><span class="op" id="5360126">(</span><span class="ident" id="5360127">m</span><span class="op" id="5360128">.</span><span class="ident" id="5360129">pool</span><span class="op" id="5360133">,</span>&nbsp;<span class="ident" id="5360135">t</span><span class="op" id="5360136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360141">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360152">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360156">i</span>&nbsp;<span class="op" id="5360158">:=</span>&nbsp;<span class="ident" id="5360161">t</span><span class="op" id="5360162">.</span><span class="ident" id="5360163">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360170">add</span>&nbsp;<span class="op" id="5360174">:=</span>&nbsp;<span class="builtintype" id="5360177">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360185">switch</span>&nbsp;<span class="ident" id="5360192">i</span><span class="op" id="5360193">.</span><span class="ident" id="5360194">Op</span>&nbsp;<span class="op" id="5360197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360201">default</span><span class="op" id="5360208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5360213">panic</span><span class="op" id="5360218">(</span><span class="string" id="5360219">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5360229">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360234">case</span>&nbsp;<span class="ident" id="5360239">syntax</span><span class="op" id="5360245">.</span><span class="ident" id="5360246">InstMatch</span><span class="op" id="5360255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360260">if</span>&nbsp;<span class="builtinfunc" id="5360263">len</span><span class="op" id="5360266">(</span><span class="ident" id="5360267">t</span><span class="op" id="5360268">.</span><span class="builtinfunc" id="5360269">cap</span><span class="op" id="5360272">)</span>&nbsp;<span class="op" id="5360274">&gt;</span>&nbsp;<span class="num" id="5360276">0</span>&nbsp;<span class="op" id="5360278">&amp;&amp;</span>&nbsp;<span class="op" id="5360281">(</span><span class="op" id="5360282">!</span><span class="ident" id="5360283">longest</span>&nbsp;<span class="op" id="5360291">||</span>&nbsp;<span class="op" id="5360294">!</span><span class="ident" id="5360295">m</span><span class="op" id="5360296">.</span><span class="ident" id="5360297">matched</span>&nbsp;<span class="op" id="5360305">||</span>&nbsp;<span class="ident" id="5360308">m</span><span class="op" id="5360309">.</span><span class="ident" id="5360310">matchcap</span><span class="op" id="5360318">[</span><span class="num" id="5360319">1</span><span class="op" id="5360320">]</span>&nbsp;<span class="op" id="5360322">&lt;</span>&nbsp;<span class="ident" id="5360324">pos</span><span class="op" id="5360327">)</span>&nbsp;<span class="op" id="5360329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360335">t</span><span class="op" id="5360336">.</span><span class="builtinfunc" id="5360337">cap</span><span class="op" id="5360340">[</span><span class="num" id="5360341">1</span><span class="op" id="5360342">]</span>&nbsp;<span class="op" id="5360344">=</span>&nbsp;<span class="ident" id="5360346">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5360354">copy</span><span class="op" id="5360358">(</span><span class="ident" id="5360359">m</span><span class="op" id="5360360">.</span><span class="ident" id="5360361">matchcap</span><span class="op" id="5360369">,</span>&nbsp;<span class="ident" id="5360371">t</span><span class="op" id="5360372">.</span><span class="builtinfunc" id="5360373">cap</span><span class="op" id="5360376">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360386">if</span>&nbsp;<span class="op" id="5360389">!</span><span class="ident" id="5360390">longest</span>&nbsp;<span class="op" id="5360398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5360404">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360465">for</span>&nbsp;<span class="ident" id="5360469">_</span><span class="op" id="5360470">,</span>&nbsp;<span class="ident" id="5360472">d</span>&nbsp;<span class="op" id="5360474">:=</span>&nbsp;<span class="keyword" id="5360477">range</span>&nbsp;<span class="ident" id="5360483">runq</span><span class="op" id="5360487">.</span><span class="ident" id="5360488">dense</span><span class="op" id="5360493">[</span><span class="ident" id="5360494">j</span><span class="op" id="5360495">+</span><span class="num" id="5360496">1</span><span class="op" id="5360497">:</span><span class="op" id="5360498">]</span>&nbsp;<span class="op" id="5360500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360507">if</span>&nbsp;<span class="ident" id="5360510">d</span><span class="op" id="5360511">.</span><span class="ident" id="5360512">t</span>&nbsp;<span class="op" id="5360514">!=</span>&nbsp;<span class="ident" id="5360517">nil</span>&nbsp;<span class="op" id="5360521">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5360529">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360550">m</span><span class="op" id="5360551">.</span><span class="ident" id="5360552">pool</span>&nbsp;<span class="op" id="5360557">=</span>&nbsp;<span class="builtinfunc" id="5360559">append</span><span class="op" id="5360565">(</span><span class="ident" id="5360566">m</span><span class="op" id="5360567">.</span><span class="ident" id="5360568">pool</span><span class="op" id="5360572">,</span>&nbsp;<span class="ident" id="5360574">d</span><span class="op" id="5360575">.</span><span class="ident" id="5360576">t</span><span class="op" id="5360577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360596">runq</span><span class="op" id="5360600">.</span><span class="ident" id="5360601">dense</span>&nbsp;<span class="op" id="5360607">=</span>&nbsp;<span class="ident" id="5360609">runq</span><span class="op" id="5360613">.</span><span class="ident" id="5360614">dense</span><span class="op" id="5360619">[</span><span class="op" id="5360620">:</span><span class="num" id="5360621">0</span><span class="op" id="5360622">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360632">m</span><span class="op" id="5360633">.</span><span class="ident" id="5360634">matched</span>&nbsp;<span class="op" id="5360642">=</span>&nbsp;<span class="builtintype" id="5360644">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360652">case</span>&nbsp;<span class="ident" id="5360657">syntax</span><span class="op" id="5360663">.</span><span class="ident" id="5360664">InstRune</span><span class="op" id="5360672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360677">add</span>&nbsp;<span class="op" id="5360681">=</span>&nbsp;<span class="ident" id="5360683">i</span><span class="op" id="5360684">.</span><span class="ident" id="5360685">MatchRune</span><span class="op" id="5360694">(</span><span class="ident" id="5360695">c</span><span class="op" id="5360696">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360700">case</span>&nbsp;<span class="ident" id="5360705">syntax</span><span class="op" id="5360711">.</span><span class="ident" id="5360712">InstRune1</span><span class="op" id="5360721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360726">add</span>&nbsp;<span class="op" id="5360730">=</span>&nbsp;<span class="ident" id="5360732">c</span>&nbsp;<span class="op" id="5360734">==</span>&nbsp;<span class="ident" id="5360737">i</span><span class="op" id="5360738">.</span><span class="ident" id="5360739">Rune</span><span class="op" id="5360743">[</span><span class="num" id="5360744">0</span><span class="op" id="5360745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360749">case</span>&nbsp;<span class="ident" id="5360754">syntax</span><span class="op" id="5360760">.</span><span class="ident" id="5360761">InstRuneAny</span><span class="op" id="5360772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360777">add</span>&nbsp;<span class="op" id="5360781">=</span>&nbsp;<span class="builtintype" id="5360783">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360790">case</span>&nbsp;<span class="ident" id="5360795">syntax</span><span class="op" id="5360801">.</span><span class="ident" id="5360802">InstRuneAnyNotNL</span><span class="op" id="5360818">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360823">add</span>&nbsp;<span class="op" id="5360827">=</span>&nbsp;<span class="ident" id="5360829">c</span>&nbsp;<span class="op" id="5360831">!=</span>&nbsp;<span class="string" id="5360834">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360845">if</span>&nbsp;<span class="ident" id="5360848">add</span>&nbsp;<span class="op" id="5360852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360857">t</span>&nbsp;<span class="op" id="5360859">=</span>&nbsp;<span class="ident" id="5360861">m</span><span class="op" id="5360862">.</span><span class="ident" id="5360863">add</span><span class="op" id="5360866">(</span><span class="ident" id="5360867">nextq</span><span class="op" id="5360872">,</span>&nbsp;<span class="ident" id="5360874">i</span><span class="op" id="5360875">.</span><span class="ident" id="5360876">Out</span><span class="op" id="5360879">,</span>&nbsp;<span class="ident" id="5360881">nextPos</span><span class="op" id="5360888">,</span>&nbsp;<span class="ident" id="5360890">t</span><span class="op" id="5360891">.</span><span class="builtinfunc" id="5360892">cap</span><span class="op" id="5360895">,</span>&nbsp;<span class="ident" id="5360897">nextCond</span><span class="op" id="5360905">,</span>&nbsp;<span class="ident" id="5360907">t</span><span class="op" id="5360908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360912">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360916">if</span>&nbsp;<span class="ident" id="5360919">t</span>&nbsp;<span class="op" id="5360921">!=</span>&nbsp;<span class="ident" id="5360924">nil</span>&nbsp;<span class="op" id="5360928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5360933">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360949">m</span><span class="op" id="5360950">.</span><span class="ident" id="5360951">pool</span>&nbsp;<span class="op" id="5360956">=</span>&nbsp;<span class="builtinfunc" id="5360958">append</span><span class="op" id="5360964">(</span><span class="ident" id="5360965">m</span><span class="op" id="5360966">.</span><span class="ident" id="5360967">pool</span><span class="op" id="5360971">,</span>&nbsp;<span class="ident" id="5360973">t</span><span class="op" id="5360974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360981">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360984">runq</span><span class="op" id="5360988">.</span><span class="ident" id="5360989">dense</span>&nbsp;<span class="op" id="5360995">=</span>&nbsp;<span class="ident" id="5360997">runq</span><span class="op" id="5361001">.</span><span class="ident" id="5361002">dense</span><span class="op" id="5361007">[</span><span class="op" id="5361008">:</span><span class="num" id="5361009">0</span><span class="op" id="5361010">]</span><br>
<span class="lineno"></span><span class="op" id="5361012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5361015">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5361089">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5361178">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5361255">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5361272">func</span>&nbsp;<span class="op" id="5361277">(</span><span class="ident" id="5361278">m</span>&nbsp;<span class="op" id="5361280">*</span><span class="ident" id="5361281">machine</span><span class="op" id="5361288">)</span>&nbsp;<span class="ident" id="5361290">add</span><span class="op" id="5361293">(</span><span class="ident" id="5361294">q</span>&nbsp;<span class="op" id="5361296">*</span><span class="ident" id="5361297">queue</span><span class="op" id="5361302">,</span>&nbsp;<span class="ident" id="5361304">pc</span>&nbsp;<span class="builtintype" id="5361307">uint32</span><span class="op" id="5361313">,</span>&nbsp;<span class="ident" id="5361315">pos</span>&nbsp;<span class="builtintype" id="5361319">int</span><span class="op" id="5361322">,</span>&nbsp;<span class="builtinfunc" id="5361324">cap</span>&nbsp;<span class="op" id="5361328">[</span><span class="op" id="5361329">]</span><span class="builtintype" id="5361330">int</span><span class="op" id="5361333">,</span>&nbsp;<span class="ident" id="5361335">cond</span>&nbsp;<span class="ident" id="5361340">syntax</span><span class="op" id="5361346">.</span><span class="ident" id="5361347">EmptyOp</span><span class="op" id="5361354">,</span>&nbsp;<span class="ident" id="5361356">t</span>&nbsp;<span class="op" id="5361358">*</span><span class="ident" id="5361359">thread</span><span class="op" id="5361365">)</span>&nbsp;<span class="op" id="5361367">*</span><span class="ident" id="5361368">thread</span>&nbsp;<span class="op" id="5361375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361378">if</span>&nbsp;<span class="ident" id="5361381">pc</span>&nbsp;<span class="op" id="5361384">==</span>&nbsp;<span class="num" id="5361387">0</span>&nbsp;<span class="op" id="5361389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361393">return</span>&nbsp;<span class="ident" id="5361400">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361406">if</span>&nbsp;<span class="ident" id="5361409">j</span>&nbsp;<span class="op" id="5361411">:=</span>&nbsp;<span class="ident" id="5361414">q</span><span class="op" id="5361415">.</span><span class="ident" id="5361416">sparse</span><span class="op" id="5361422">[</span><span class="ident" id="5361423">pc</span><span class="op" id="5361425">]</span><span class="op" id="5361426">;</span>&nbsp;<span class="ident" id="5361428">j</span>&nbsp;<span class="op" id="5361430">&lt;</span>&nbsp;<span class="builtintype" id="5361432">uint32</span><span class="op" id="5361438">(</span><span class="builtinfunc" id="5361439">len</span><span class="op" id="5361442">(</span><span class="ident" id="5361443">q</span><span class="op" id="5361444">.</span><span class="ident" id="5361445">dense</span><span class="op" id="5361450">)</span><span class="op" id="5361451">)</span>&nbsp;<span class="op" id="5361453">&amp;&amp;</span>&nbsp;<span class="ident" id="5361456">q</span><span class="op" id="5361457">.</span><span class="ident" id="5361458">dense</span><span class="op" id="5361463">[</span><span class="ident" id="5361464">j</span><span class="op" id="5361465">]</span><span class="op" id="5361466">.</span><span class="ident" id="5361467">pc</span>&nbsp;<span class="op" id="5361470">==</span>&nbsp;<span class="ident" id="5361473">pc</span>&nbsp;<span class="op" id="5361476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361480">return</span>&nbsp;<span class="ident" id="5361487">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361494">j</span>&nbsp;<span class="op" id="5361496">:=</span>&nbsp;<span class="builtinfunc" id="5361499">len</span><span class="op" id="5361502">(</span><span class="ident" id="5361503">q</span><span class="op" id="5361504">.</span><span class="ident" id="5361505">dense</span><span class="op" id="5361510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361513">q</span><span class="op" id="5361514">.</span><span class="ident" id="5361515">dense</span>&nbsp;<span class="op" id="5361521">=</span>&nbsp;<span class="ident" id="5361523">q</span><span class="op" id="5361524">.</span><span class="ident" id="5361525">dense</span><span class="op" id="5361530">[</span><span class="op" id="5361531">:</span><span class="ident" id="5361532">j</span><span class="op" id="5361533">+</span><span class="num" id="5361534">1</span><span class="op" id="5361535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361538">d</span>&nbsp;<span class="op" id="5361540">:=</span>&nbsp;<span class="op" id="5361543">&amp;</span><span class="ident" id="5361544">q</span><span class="op" id="5361545">.</span><span class="ident" id="5361546">dense</span><span class="op" id="5361551">[</span><span class="ident" id="5361552">j</span><span class="op" id="5361553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361556">d</span><span class="op" id="5361557">.</span><span class="ident" id="5361558">t</span>&nbsp;<span class="op" id="5361560">=</span>&nbsp;<span class="ident" id="5361562">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361567">d</span><span class="op" id="5361568">.</span><span class="ident" id="5361569">pc</span>&nbsp;<span class="op" id="5361572">=</span>&nbsp;<span class="ident" id="5361574">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361578">q</span><span class="op" id="5361579">.</span><span class="ident" id="5361580">sparse</span><span class="op" id="5361586">[</span><span class="ident" id="5361587">pc</span><span class="op" id="5361589">]</span>&nbsp;<span class="op" id="5361591">=</span>&nbsp;<span class="builtintype" id="5361593">uint32</span><span class="op" id="5361599">(</span><span class="ident" id="5361600">j</span><span class="op" id="5361601">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361605">i</span>&nbsp;<span class="op" id="5361607">:=</span>&nbsp;<span class="op" id="5361610">&amp;</span><span class="ident" id="5361611">m</span><span class="op" id="5361612">.</span><span class="ident" id="5361613">p</span><span class="op" id="5361614">.</span><span class="ident" id="5361615">Inst</span><span class="op" id="5361619">[</span><span class="ident" id="5361620">pc</span><span class="op" id="5361622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361625">switch</span>&nbsp;<span class="ident" id="5361632">i</span><span class="op" id="5361633">.</span><span class="ident" id="5361634">Op</span>&nbsp;<span class="op" id="5361637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361640">default</span><span class="op" id="5361647">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5361651">panic</span><span class="op" id="5361656">(</span><span class="string" id="5361657">&#34;unhandled&#34;</span><span class="op" id="5361668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361671">case</span>&nbsp;<span class="ident" id="5361676">syntax</span><span class="op" id="5361682">.</span><span class="ident" id="5361683">InstFail</span><span class="op" id="5361691">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5361695">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361707">case</span>&nbsp;<span class="ident" id="5361712">syntax</span><span class="op" id="5361718">.</span><span class="ident" id="5361719">InstAlt</span><span class="op" id="5361726">,</span>&nbsp;<span class="ident" id="5361728">syntax</span><span class="op" id="5361734">.</span><span class="ident" id="5361735">InstAltMatch</span><span class="op" id="5361747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361751">t</span>&nbsp;<span class="op" id="5361753">=</span>&nbsp;<span class="ident" id="5361755">m</span><span class="op" id="5361756">.</span><span class="ident" id="5361757">add</span><span class="op" id="5361760">(</span><span class="ident" id="5361761">q</span><span class="op" id="5361762">,</span>&nbsp;<span class="ident" id="5361764">i</span><span class="op" id="5361765">.</span><span class="ident" id="5361766">Out</span><span class="op" id="5361769">,</span>&nbsp;<span class="ident" id="5361771">pos</span><span class="op" id="5361774">,</span>&nbsp;<span class="builtinfunc" id="5361776">cap</span><span class="op" id="5361779">,</span>&nbsp;<span class="ident" id="5361781">cond</span><span class="op" id="5361785">,</span>&nbsp;<span class="ident" id="5361787">t</span><span class="op" id="5361788">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361792">t</span>&nbsp;<span class="op" id="5361794">=</span>&nbsp;<span class="ident" id="5361796">m</span><span class="op" id="5361797">.</span><span class="ident" id="5361798">add</span><span class="op" id="5361801">(</span><span class="ident" id="5361802">q</span><span class="op" id="5361803">,</span>&nbsp;<span class="ident" id="5361805">i</span><span class="op" id="5361806">.</span><span class="ident" id="5361807">Arg</span><span class="op" id="5361810">,</span>&nbsp;<span class="ident" id="5361812">pos</span><span class="op" id="5361815">,</span>&nbsp;<span class="builtinfunc" id="5361817">cap</span><span class="op" id="5361820">,</span>&nbsp;<span class="ident" id="5361822">cond</span><span class="op" id="5361826">,</span>&nbsp;<span class="ident" id="5361828">t</span><span class="op" id="5361829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361832">case</span>&nbsp;<span class="ident" id="5361837">syntax</span><span class="op" id="5361843">.</span><span class="ident" id="5361844">InstEmptyWidth</span><span class="op" id="5361858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361862">if</span>&nbsp;<span class="ident" id="5361865">syntax</span><span class="op" id="5361871">.</span><span class="ident" id="5361872">EmptyOp</span><span class="op" id="5361879">(</span><span class="ident" id="5361880">i</span><span class="op" id="5361881">.</span><span class="ident" id="5361882">Arg</span><span class="op" id="5361885">)</span><span class="op" id="5361886">&amp;^</span><span class="ident" id="5361888">cond</span>&nbsp;<span class="op" id="5361893">==</span>&nbsp;<span class="num" id="5361896">0</span>&nbsp;<span class="op" id="5361898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361903">t</span>&nbsp;<span class="op" id="5361905">=</span>&nbsp;<span class="ident" id="5361907">m</span><span class="op" id="5361908">.</span><span class="ident" id="5361909">add</span><span class="op" id="5361912">(</span><span class="ident" id="5361913">q</span><span class="op" id="5361914">,</span>&nbsp;<span class="ident" id="5361916">i</span><span class="op" id="5361917">.</span><span class="ident" id="5361918">Out</span><span class="op" id="5361921">,</span>&nbsp;<span class="ident" id="5361923">pos</span><span class="op" id="5361926">,</span>&nbsp;<span class="builtinfunc" id="5361928">cap</span><span class="op" id="5361931">,</span>&nbsp;<span class="ident" id="5361933">cond</span><span class="op" id="5361937">,</span>&nbsp;<span class="ident" id="5361939">t</span><span class="op" id="5361940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361944">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361947">case</span>&nbsp;<span class="ident" id="5361952">syntax</span><span class="op" id="5361958">.</span><span class="ident" id="5361959">InstNop</span><span class="op" id="5361966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361970">t</span>&nbsp;<span class="op" id="5361972">=</span>&nbsp;<span class="ident" id="5361974">m</span><span class="op" id="5361975">.</span><span class="ident" id="5361976">add</span><span class="op" id="5361979">(</span><span class="ident" id="5361980">q</span><span class="op" id="5361981">,</span>&nbsp;<span class="ident" id="5361983">i</span><span class="op" id="5361984">.</span><span class="ident" id="5361985">Out</span><span class="op" id="5361988">,</span>&nbsp;<span class="ident" id="5361990">pos</span><span class="op" id="5361993">,</span>&nbsp;<span class="builtinfunc" id="5361995">cap</span><span class="op" id="5361998">,</span>&nbsp;<span class="ident" id="5362000">cond</span><span class="op" id="5362004">,</span>&nbsp;<span class="ident" id="5362006">t</span><span class="op" id="5362007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362010">case</span>&nbsp;<span class="ident" id="5362015">syntax</span><span class="op" id="5362021">.</span><span class="ident" id="5362022">InstCapture</span><span class="op" id="5362033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362037">if</span>&nbsp;<span class="builtintype" id="5362040">int</span><span class="op" id="5362043">(</span><span class="ident" id="5362044">i</span><span class="op" id="5362045">.</span><span class="ident" id="5362046">Arg</span><span class="op" id="5362049">)</span>&nbsp;<span class="op" id="5362051">&lt;</span>&nbsp;<span class="builtinfunc" id="5362053">len</span><span class="op" id="5362056">(</span><span class="builtinfunc" id="5362057">cap</span><span class="op" id="5362060">)</span>&nbsp;<span class="op" id="5362062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362067">opos</span>&nbsp;<span class="op" id="5362072">:=</span>&nbsp;<span class="builtinfunc" id="5362075">cap</span><span class="op" id="5362078">[</span><span class="ident" id="5362079">i</span><span class="op" id="5362080">.</span><span class="ident" id="5362081">Arg</span><span class="op" id="5362084">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5362089">cap</span><span class="op" id="5362092">[</span><span class="ident" id="5362093">i</span><span class="op" id="5362094">.</span><span class="ident" id="5362095">Arg</span><span class="op" id="5362098">]</span>&nbsp;<span class="op" id="5362100">=</span>&nbsp;<span class="ident" id="5362102">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362109">m</span><span class="op" id="5362110">.</span><span class="ident" id="5362111">add</span><span class="op" id="5362114">(</span><span class="ident" id="5362115">q</span><span class="op" id="5362116">,</span>&nbsp;<span class="ident" id="5362118">i</span><span class="op" id="5362119">.</span><span class="ident" id="5362120">Out</span><span class="op" id="5362123">,</span>&nbsp;<span class="ident" id="5362125">pos</span><span class="op" id="5362128">,</span>&nbsp;<span class="builtinfunc" id="5362130">cap</span><span class="op" id="5362133">,</span>&nbsp;<span class="ident" id="5362135">cond</span><span class="op" id="5362139">,</span>&nbsp;<span class="ident" id="5362141">nil</span><span class="op" id="5362144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5362149">cap</span><span class="op" id="5362152">[</span><span class="ident" id="5362153">i</span><span class="op" id="5362154">.</span><span class="ident" id="5362155">Arg</span><span class="op" id="5362158">]</span>&nbsp;<span class="op" id="5362160">=</span>&nbsp;<span class="ident" id="5362162">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362169">}</span>&nbsp;<span class="keyword" id="5362171">else</span>&nbsp;<span class="op" id="5362176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362181">t</span>&nbsp;<span class="op" id="5362183">=</span>&nbsp;<span class="ident" id="5362185">m</span><span class="op" id="5362186">.</span><span class="ident" id="5362187">add</span><span class="op" id="5362190">(</span><span class="ident" id="5362191">q</span><span class="op" id="5362192">,</span>&nbsp;<span class="ident" id="5362194">i</span><span class="op" id="5362195">.</span><span class="ident" id="5362196">Out</span><span class="op" id="5362199">,</span>&nbsp;<span class="ident" id="5362201">pos</span><span class="op" id="5362204">,</span>&nbsp;<span class="builtinfunc" id="5362206">cap</span><span class="op" id="5362209">,</span>&nbsp;<span class="ident" id="5362211">cond</span><span class="op" id="5362215">,</span>&nbsp;<span class="ident" id="5362217">t</span><span class="op" id="5362218">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362225">case</span>&nbsp;<span class="ident" id="5362230">syntax</span><span class="op" id="5362236">.</span><span class="ident" id="5362237">InstMatch</span><span class="op" id="5362246">,</span>&nbsp;<span class="ident" id="5362248">syntax</span><span class="op" id="5362254">.</span><span class="ident" id="5362255">InstRune</span><span class="op" id="5362263">,</span>&nbsp;<span class="ident" id="5362265">syntax</span><span class="op" id="5362271">.</span><span class="ident" id="5362272">InstRune1</span><span class="op" id="5362281">,</span>&nbsp;<span class="ident" id="5362283">syntax</span><span class="op" id="5362289">.</span><span class="ident" id="5362290">InstRuneAny</span><span class="op" id="5362301">,</span>&nbsp;<span class="ident" id="5362303">syntax</span><span class="op" id="5362309">.</span><span class="ident" id="5362310">InstRuneAnyNotNL</span><span class="op" id="5362326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362330">if</span>&nbsp;<span class="ident" id="5362333">t</span>&nbsp;<span class="op" id="5362335">==</span>&nbsp;<span class="ident" id="5362338">nil</span>&nbsp;<span class="op" id="5362342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362347">t</span>&nbsp;<span class="op" id="5362349">=</span>&nbsp;<span class="ident" id="5362351">m</span><span class="op" id="5362352">.</span><span class="ident" id="5362353">alloc</span><span class="op" id="5362358">(</span><span class="ident" id="5362359">i</span><span class="op" id="5362360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362364">}</span>&nbsp;<span class="keyword" id="5362366">else</span>&nbsp;<span class="op" id="5362371">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362376">t</span><span class="op" id="5362377">.</span><span class="ident" id="5362378">inst</span>&nbsp;<span class="op" id="5362383">=</span>&nbsp;<span class="ident" id="5362385">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362393">if</span>&nbsp;<span class="builtinfunc" id="5362396">len</span><span class="op" id="5362399">(</span><span class="builtinfunc" id="5362400">cap</span><span class="op" id="5362403">)</span>&nbsp;<span class="op" id="5362405">&gt;</span>&nbsp;<span class="num" id="5362407">0</span>&nbsp;<span class="op" id="5362409">&amp;&amp;</span>&nbsp;<span class="op" id="5362412">&amp;</span><span class="ident" id="5362413">t</span><span class="op" id="5362414">.</span><span class="builtinfunc" id="5362415">cap</span><span class="op" id="5362418">[</span><span class="num" id="5362419">0</span><span class="op" id="5362420">]</span>&nbsp;<span class="op" id="5362422">!=</span>&nbsp;<span class="op" id="5362425">&amp;</span><span class="builtinfunc" id="5362426">cap</span><span class="op" id="5362429">[</span><span class="num" id="5362430">0</span><span class="op" id="5362431">]</span>&nbsp;<span class="op" id="5362433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5362438">copy</span><span class="op" id="5362442">(</span><span class="ident" id="5362443">t</span><span class="op" id="5362444">.</span><span class="builtinfunc" id="5362445">cap</span><span class="op" id="5362448">,</span>&nbsp;<span class="builtinfunc" id="5362450">cap</span><span class="op" id="5362453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362457">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362461">d</span><span class="op" id="5362462">.</span><span class="ident" id="5362463">t</span>&nbsp;<span class="op" id="5362465">=</span>&nbsp;<span class="ident" id="5362467">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362471">t</span>&nbsp;<span class="op" id="5362473">=</span>&nbsp;<span class="ident" id="5362475">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362483">return</span>&nbsp;<span class="ident" id="5362490">t</span><br>
<span class="lineno"></span><span class="op" id="5362492">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5362495">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5362555">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5362596">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5362649">func</span>&nbsp;<span class="op" id="5362654">(</span><span class="ident" id="5362655">m</span>&nbsp;<span class="op" id="5362657">*</span><span class="ident" id="5362658">machine</span><span class="op" id="5362665">)</span>&nbsp;<span class="ident" id="5362667">onepass</span><span class="op" id="5362674">(</span><span class="ident" id="5362675">i</span>&nbsp;<span class="ident" id="5362677">input</span><span class="op" id="5362682">,</span>&nbsp;<span class="ident" id="5362684">pos</span>&nbsp;<span class="builtintype" id="5362688">int</span><span class="op" id="5362691">)</span>&nbsp;<span class="builtintype" id="5362693">bool</span>&nbsp;<span class="op" id="5362698">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362701">startCond</span>&nbsp;<span class="op" id="5362711">:=</span>&nbsp;<span class="ident" id="5362714">m</span><span class="op" id="5362715">.</span><span class="ident" id="5362716">re</span><span class="op" id="5362718">.</span><span class="ident" id="5362719">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362725">if</span>&nbsp;<span class="ident" id="5362728">startCond</span>&nbsp;<span class="op" id="5362738">==</span>&nbsp;<span class="op" id="5362741">^</span><span class="ident" id="5362742">syntax</span><span class="op" id="5362748">.</span><span class="ident" id="5362749">EmptyOp</span><span class="op" id="5362756">(</span><span class="num" id="5362757">0</span><span class="op" id="5362758">)</span>&nbsp;<span class="op" id="5362760">{</span>&nbsp;<span class="comment" id="5362762">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362778">return</span>&nbsp;<span class="builtintype" id="5362785">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362795">m</span><span class="op" id="5362796">.</span><span class="ident" id="5362797">matched</span>&nbsp;<span class="op" id="5362805">=</span>&nbsp;<span class="builtintype" id="5362807">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362814">for</span>&nbsp;<span class="ident" id="5362818">i</span>&nbsp;<span class="op" id="5362820">:=</span>&nbsp;<span class="keyword" id="5362823">range</span>&nbsp;<span class="ident" id="5362829">m</span><span class="op" id="5362830">.</span><span class="ident" id="5362831">matchcap</span>&nbsp;<span class="op" id="5362840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362844">m</span><span class="op" id="5362845">.</span><span class="ident" id="5362846">matchcap</span><span class="op" id="5362854">[</span><span class="ident" id="5362855">i</span><span class="op" id="5362856">]</span>&nbsp;<span class="op" id="5362858">=</span>&nbsp;<span class="op" id="5362860">-</span><span class="num" id="5362861">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362867">r</span><span class="op" id="5362868">,</span>&nbsp;<span class="ident" id="5362870">r1</span>&nbsp;<span class="op" id="5362873">:=</span>&nbsp;<span class="ident" id="5362876">endOfText</span><span class="op" id="5362885">,</span>&nbsp;<span class="ident" id="5362887">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362898">width</span><span class="op" id="5362903">,</span>&nbsp;<span class="ident" id="5362905">width1</span>&nbsp;<span class="op" id="5362912">:=</span>&nbsp;<span class="num" id="5362915">0</span><span class="op" id="5362916">,</span>&nbsp;<span class="num" id="5362918">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362921">r</span><span class="op" id="5362922">,</span>&nbsp;<span class="ident" id="5362924">width</span>&nbsp;<span class="op" id="5362930">=</span>&nbsp;<span class="ident" id="5362932">i</span><span class="op" id="5362933">.</span><span class="ident" id="5362934">step</span><span class="op" id="5362938">(</span><span class="ident" id="5362939">pos</span><span class="op" id="5362942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362945">if</span>&nbsp;<span class="ident" id="5362948">r</span>&nbsp;<span class="op" id="5362950">!=</span>&nbsp;<span class="ident" id="5362953">endOfText</span>&nbsp;<span class="op" id="5362963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362967">r1</span><span class="op" id="5362969">,</span>&nbsp;<span class="ident" id="5362971">width1</span>&nbsp;<span class="op" id="5362978">=</span>&nbsp;<span class="ident" id="5362980">i</span><span class="op" id="5362981">.</span><span class="ident" id="5362982">step</span><span class="op" id="5362986">(</span><span class="ident" id="5362987">pos</span>&nbsp;<span class="op" id="5362991">+</span>&nbsp;<span class="ident" id="5362993">width</span><span class="op" id="5362998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363004">var</span>&nbsp;<span class="ident" id="5363008">flag</span>&nbsp;<span class="ident" id="5363013">syntax</span><span class="op" id="5363019">.</span><span class="ident" id="5363020">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363029">if</span>&nbsp;<span class="ident" id="5363032">pos</span>&nbsp;<span class="op" id="5363036">==</span>&nbsp;<span class="num" id="5363039">0</span>&nbsp;<span class="op" id="5363041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363045">flag</span>&nbsp;<span class="op" id="5363050">=</span>&nbsp;<span class="ident" id="5363052">syntax</span><span class="op" id="5363058">.</span><span class="ident" id="5363059">EmptyOpContext</span><span class="op" id="5363073">(</span><span class="op" id="5363074">-</span><span class="num" id="5363075">1</span><span class="op" id="5363076">,</span>&nbsp;<span class="ident" id="5363078">r</span><span class="op" id="5363079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363082">}</span>&nbsp;<span class="keyword" id="5363084">else</span>&nbsp;<span class="op" id="5363089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363093">flag</span>&nbsp;<span class="op" id="5363098">=</span>&nbsp;<span class="ident" id="5363100">i</span><span class="op" id="5363101">.</span><span class="ident" id="5363102">context</span><span class="op" id="5363109">(</span><span class="ident" id="5363110">pos</span><span class="op" id="5363113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363116">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363119">pc</span>&nbsp;<span class="op" id="5363122">:=</span>&nbsp;<span class="ident" id="5363125">m</span><span class="op" id="5363126">.</span><span class="ident" id="5363127">op</span><span class="op" id="5363129">.</span><span class="ident" id="5363130">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363137">inst</span>&nbsp;<span class="op" id="5363142">:=</span>&nbsp;<span class="ident" id="5363145">m</span><span class="op" id="5363146">.</span><span class="ident" id="5363147">op</span><span class="op" id="5363149">.</span><span class="ident" id="5363150">Inst</span><span class="op" id="5363154">[</span><span class="ident" id="5363155">pc</span><span class="op" id="5363157">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363160">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363215">if</span>&nbsp;<span class="ident" id="5363218">pos</span>&nbsp;<span class="op" id="5363222">==</span>&nbsp;<span class="num" id="5363225">0</span>&nbsp;<span class="op" id="5363227">&amp;&amp;</span>&nbsp;<span class="ident" id="5363230">syntax</span><span class="op" id="5363236">.</span><span class="ident" id="5363237">EmptyOp</span><span class="op" id="5363244">(</span><span class="ident" id="5363245">inst</span><span class="op" id="5363249">.</span><span class="ident" id="5363250">Arg</span><span class="op" id="5363253">)</span><span class="op" id="5363254">&amp;^</span><span class="ident" id="5363256">flag</span>&nbsp;<span class="op" id="5363261">==</span>&nbsp;<span class="num" id="5363264">0</span>&nbsp;<span class="op" id="5363266">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5363271">len</span><span class="op" id="5363274">(</span><span class="ident" id="5363275">m</span><span class="op" id="5363276">.</span><span class="ident" id="5363277">re</span><span class="op" id="5363279">.</span><span class="ident" id="5363280">prefix</span><span class="op" id="5363286">)</span>&nbsp;<span class="op" id="5363288">&gt;</span>&nbsp;<span class="num" id="5363290">0</span>&nbsp;<span class="op" id="5363292">&amp;&amp;</span>&nbsp;<span class="ident" id="5363295">i</span><span class="op" id="5363296">.</span><span class="ident" id="5363297">canCheckPrefix</span><span class="op" id="5363311">(</span><span class="op" id="5363312">)</span>&nbsp;<span class="op" id="5363314">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363318">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363374">if</span>&nbsp;<span class="ident" id="5363377">i</span><span class="op" id="5363378">.</span><span class="ident" id="5363379">hasPrefix</span><span class="op" id="5363388">(</span><span class="ident" id="5363389">m</span><span class="op" id="5363390">.</span><span class="ident" id="5363391">re</span><span class="op" id="5363393">)</span>&nbsp;<span class="op" id="5363395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363400">pos</span>&nbsp;<span class="op" id="5363404">+=</span>&nbsp;<span class="builtinfunc" id="5363407">len</span><span class="op" id="5363410">(</span><span class="ident" id="5363411">m</span><span class="op" id="5363412">.</span><span class="ident" id="5363413">re</span><span class="op" id="5363415">.</span><span class="ident" id="5363416">prefix</span><span class="op" id="5363422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363427">r</span><span class="op" id="5363428">,</span>&nbsp;<span class="ident" id="5363430">width</span>&nbsp;<span class="op" id="5363436">=</span>&nbsp;<span class="ident" id="5363438">i</span><span class="op" id="5363439">.</span><span class="ident" id="5363440">step</span><span class="op" id="5363444">(</span><span class="ident" id="5363445">pos</span><span class="op" id="5363448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363453">r1</span><span class="op" id="5363455">,</span>&nbsp;<span class="ident" id="5363457">width1</span>&nbsp;<span class="op" id="5363464">=</span>&nbsp;<span class="ident" id="5363466">i</span><span class="op" id="5363467">.</span><span class="ident" id="5363468">step</span><span class="op" id="5363472">(</span><span class="ident" id="5363473">pos</span>&nbsp;<span class="op" id="5363477">+</span>&nbsp;<span class="ident" id="5363479">width</span><span class="op" id="5363484">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363489">flag</span>&nbsp;<span class="op" id="5363494">=</span>&nbsp;<span class="ident" id="5363496">i</span><span class="op" id="5363497">.</span><span class="ident" id="5363498">context</span><span class="op" id="5363505">(</span><span class="ident" id="5363506">pos</span><span class="op" id="5363509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363514">pc</span>&nbsp;<span class="op" id="5363517">=</span>&nbsp;<span class="builtintype" id="5363519">int</span><span class="op" id="5363522">(</span><span class="ident" id="5363523">m</span><span class="op" id="5363524">.</span><span class="ident" id="5363525">re</span><span class="op" id="5363527">.</span><span class="ident" id="5363528">prefixEnd</span><span class="op" id="5363537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363541">}</span>&nbsp;<span class="keyword" id="5363543">else</span>&nbsp;<span class="op" id="5363548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363553">return</span>&nbsp;<span class="ident" id="5363560">m</span><span class="op" id="5363561">.</span><span class="ident" id="5363562">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363572">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363578">for</span>&nbsp;<span class="op" id="5363582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363586">inst</span>&nbsp;<span class="op" id="5363591">=</span>&nbsp;<span class="ident" id="5363593">m</span><span class="op" id="5363594">.</span><span class="ident" id="5363595">op</span><span class="op" id="5363597">.</span><span class="ident" id="5363598">Inst</span><span class="op" id="5363602">[</span><span class="ident" id="5363603">pc</span><span class="op" id="5363605">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363609">pc</span>&nbsp;<span class="op" id="5363612">=</span>&nbsp;<span class="builtintype" id="5363614">int</span><span class="op" id="5363617">(</span><span class="ident" id="5363618">inst</span><span class="op" id="5363622">.</span><span class="ident" id="5363623">Out</span><span class="op" id="5363626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363630">switch</span>&nbsp;<span class="ident" id="5363637">inst</span><span class="op" id="5363641">.</span><span class="ident" id="5363642">Op</span>&nbsp;<span class="op" id="5363645">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363649">default</span><span class="op" id="5363656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5363661">panic</span><span class="op" id="5363666">(</span><span class="string" id="5363667">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5363677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363681">case</span>&nbsp;<span class="ident" id="5363686">syntax</span><span class="op" id="5363692">.</span><span class="ident" id="5363693">InstMatch</span><span class="op" id="5363702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363707">m</span><span class="op" id="5363708">.</span><span class="ident" id="5363709">matched</span>&nbsp;<span class="op" id="5363717">=</span>&nbsp;<span class="builtintype" id="5363719">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363727">if</span>&nbsp;<span class="builtinfunc" id="5363730">len</span><span class="op" id="5363733">(</span><span class="ident" id="5363734">m</span><span class="op" id="5363735">.</span><span class="ident" id="5363736">matchcap</span><span class="op" id="5363744">)</span>&nbsp;<span class="op" id="5363746">&gt;</span>&nbsp;<span class="num" id="5363748">0</span>&nbsp;<span class="op" id="5363750">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363756">m</span><span class="op" id="5363757">.</span><span class="ident" id="5363758">matchcap</span><span class="op" id="5363766">[</span><span class="num" id="5363767">0</span><span class="op" id="5363768">]</span>&nbsp;<span class="op" id="5363770">=</span>&nbsp;<span class="num" id="5363772">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363778">m</span><span class="op" id="5363779">.</span><span class="ident" id="5363780">matchcap</span><span class="op" id="5363788">[</span><span class="num" id="5363789">1</span><span class="op" id="5363790">]</span>&nbsp;<span class="op" id="5363792">=</span>&nbsp;<span class="ident" id="5363794">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363806">return</span>&nbsp;<span class="ident" id="5363813">m</span><span class="op" id="5363814">.</span><span class="ident" id="5363815">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363825">case</span>&nbsp;<span class="ident" id="5363830">syntax</span><span class="op" id="5363836">.</span><span class="ident" id="5363837">InstRune</span><span class="op" id="5363845">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363850">if</span>&nbsp;<span class="op" id="5363853">!</span><span class="ident" id="5363854">inst</span><span class="op" id="5363858">.</span><span class="ident" id="5363859">MatchRune</span><span class="op" id="5363868">(</span><span class="ident" id="5363869">r</span><span class="op" id="5363870">)</span>&nbsp;<span class="op" id="5363872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363878">return</span>&nbsp;<span class="ident" id="5363885">m</span><span class="op" id="5363886">.</span><span class="ident" id="5363887">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363902">case</span>&nbsp;<span class="ident" id="5363907">syntax</span><span class="op" id="5363913">.</span><span class="ident" id="5363914">InstRune1</span><span class="op" id="5363923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363928">if</span>&nbsp;<span class="ident" id="5363931">r</span>&nbsp;<span class="op" id="5363933">!=</span>&nbsp;<span class="ident" id="5363936">inst</span><span class="op" id="5363940">.</span><span class="ident" id="5363941">Rune</span><span class="op" id="5363945">[</span><span class="num" id="5363946">0</span><span class="op" id="5363947">]</span>&nbsp;<span class="op" id="5363949">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363955">return</span>&nbsp;<span class="ident" id="5363962">m</span><span class="op" id="5363963">.</span><span class="ident" id="5363964">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363979">case</span>&nbsp;<span class="ident" id="5363984">syntax</span><span class="op" id="5363990">.</span><span class="ident" id="5363991">InstRuneAny</span><span class="op" id="5364002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364007">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364020">case</span>&nbsp;<span class="ident" id="5364025">syntax</span><span class="op" id="5364031">.</span><span class="ident" id="5364032">InstRuneAnyNotNL</span><span class="op" id="5364048">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364053">if</span>&nbsp;<span class="ident" id="5364056">r</span>&nbsp;<span class="op" id="5364058">==</span>&nbsp;<span class="string" id="5364061">&#39;\n&#39;</span>&nbsp;<span class="op" id="5364066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364072">return</span>&nbsp;<span class="ident" id="5364079">m</span><span class="op" id="5364080">.</span><span class="ident" id="5364081">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364096">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364163">case</span>&nbsp;<span class="ident" id="5364168">syntax</span><span class="op" id="5364174">.</span><span class="ident" id="5364175">InstAlt</span><span class="op" id="5364182">,</span>&nbsp;<span class="ident" id="5364184">syntax</span><span class="op" id="5364190">.</span><span class="ident" id="5364191">InstAltMatch</span><span class="op" id="5364203">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364208">pc</span>&nbsp;<span class="op" id="5364211">=</span>&nbsp;<span class="builtintype" id="5364213">int</span><span class="op" id="5364216">(</span><span class="ident" id="5364217">onePassNext</span><span class="op" id="5364228">(</span><span class="op" id="5364229">&amp;</span><span class="ident" id="5364230">inst</span><span class="op" id="5364234">,</span>&nbsp;<span class="ident" id="5364236">r</span><span class="op" id="5364237">)</span><span class="op" id="5364238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364243">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364254">case</span>&nbsp;<span class="ident" id="5364259">syntax</span><span class="op" id="5364265">.</span><span class="ident" id="5364266">InstFail</span><span class="op" id="5364274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364279">return</span>&nbsp;<span class="ident" id="5364286">m</span><span class="op" id="5364287">.</span><span class="ident" id="5364288">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364298">case</span>&nbsp;<span class="ident" id="5364303">syntax</span><span class="op" id="5364309">.</span><span class="ident" id="5364310">InstNop</span><span class="op" id="5364317">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364322">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364333">case</span>&nbsp;<span class="ident" id="5364338">syntax</span><span class="op" id="5364344">.</span><span class="ident" id="5364345">InstEmptyWidth</span><span class="op" id="5364359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364364">if</span>&nbsp;<span class="ident" id="5364367">syntax</span><span class="op" id="5364373">.</span><span class="ident" id="5364374">EmptyOp</span><span class="op" id="5364381">(</span><span class="ident" id="5364382">inst</span><span class="op" id="5364386">.</span><span class="ident" id="5364387">Arg</span><span class="op" id="5364390">)</span><span class="op" id="5364391">&amp;^</span><span class="ident" id="5364393">flag</span>&nbsp;<span class="op" id="5364398">!=</span>&nbsp;<span class="num" id="5364401">0</span>&nbsp;<span class="op" id="5364403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364409">return</span>&nbsp;<span class="ident" id="5364416">m</span><span class="op" id="5364417">.</span><span class="ident" id="5364418">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364429">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364434">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364445">case</span>&nbsp;<span class="ident" id="5364450">syntax</span><span class="op" id="5364456">.</span><span class="ident" id="5364457">InstCapture</span><span class="op" id="5364468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364473">if</span>&nbsp;<span class="builtintype" id="5364476">int</span><span class="op" id="5364479">(</span><span class="ident" id="5364480">inst</span><span class="op" id="5364484">.</span><span class="ident" id="5364485">Arg</span><span class="op" id="5364488">)</span>&nbsp;<span class="op" id="5364490">&lt;</span>&nbsp;<span class="builtinfunc" id="5364492">len</span><span class="op" id="5364495">(</span><span class="ident" id="5364496">m</span><span class="op" id="5364497">.</span><span class="ident" id="5364498">matchcap</span><span class="op" id="5364506">)</span>&nbsp;<span class="op" id="5364508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364514">m</span><span class="op" id="5364515">.</span><span class="ident" id="5364516">matchcap</span><span class="op" id="5364524">[</span><span class="ident" id="5364525">inst</span><span class="op" id="5364529">.</span><span class="ident" id="5364530">Arg</span><span class="op" id="5364533">]</span>&nbsp;<span class="op" id="5364535">=</span>&nbsp;<span class="ident" id="5364537">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364544">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364549">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364564">if</span>&nbsp;<span class="ident" id="5364567">width</span>&nbsp;<span class="op" id="5364573">==</span>&nbsp;<span class="num" id="5364576">0</span>&nbsp;<span class="op" id="5364578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364583">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364591">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364595">flag</span>&nbsp;<span class="op" id="5364600">=</span>&nbsp;<span class="ident" id="5364602">syntax</span><span class="op" id="5364608">.</span><span class="ident" id="5364609">EmptyOpContext</span><span class="op" id="5364623">(</span><span class="ident" id="5364624">r</span><span class="op" id="5364625">,</span>&nbsp;<span class="ident" id="5364627">r1</span><span class="op" id="5364629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364633">pos</span>&nbsp;<span class="op" id="5364637">+=</span>&nbsp;<span class="ident" id="5364640">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364648">r</span><span class="op" id="5364649">,</span>&nbsp;<span class="ident" id="5364651">width</span>&nbsp;<span class="op" id="5364657">=</span>&nbsp;<span class="ident" id="5364659">r1</span><span class="op" id="5364661">,</span>&nbsp;<span class="ident" id="5364663">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364672">if</span>&nbsp;<span class="ident" id="5364675">r</span>&nbsp;<span class="op" id="5364677">!=</span>&nbsp;<span class="ident" id="5364680">endOfText</span>&nbsp;<span class="op" id="5364690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364695">r1</span><span class="op" id="5364697">,</span>&nbsp;<span class="ident" id="5364699">width1</span>&nbsp;<span class="op" id="5364706">=</span>&nbsp;<span class="ident" id="5364708">i</span><span class="op" id="5364709">.</span><span class="ident" id="5364710">step</span><span class="op" id="5364714">(</span><span class="ident" id="5364715">pos</span>&nbsp;<span class="op" id="5364719">+</span>&nbsp;<span class="ident" id="5364721">width</span><span class="op" id="5364726">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364736">return</span>&nbsp;<span class="ident" id="5364743">m</span><span class="op" id="5364744">.</span><span class="ident" id="5364745">matched</span><br>
<span class="lineno"></span><span class="op" id="5364753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5364756">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="5364795">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="5364835">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5364893">var</span>&nbsp;<span class="ident" id="5364897">empty</span>&nbsp;<span class="op" id="5364903">=</span>&nbsp;<span class="builtinfunc" id="5364905">make</span><span class="op" id="5364909">(</span><span class="op" id="5364910">[</span><span class="op" id="5364911">]</span><span class="builtintype" id="5364912">int</span><span class="op" id="5364915">,</span>&nbsp;<span class="num" id="5364917">0</span><span class="op" id="5364918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5364921">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5364984">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5365023">func</span>&nbsp;<span class="op" id="5365028">(</span><span class="ident" id="5365029">re</span>&nbsp;<span class="op" id="5365032">*</span><span class="ident" id="5365033">Regexp</span><span class="op" id="5365039">)</span>&nbsp;<span class="ident" id="5365041">doExecute</span><span class="op" id="5365050">(</span><span class="ident" id="5365051">r</span>&nbsp;<span class="ident" id="5365053">io</span><span class="op" id="5365055">.</span><span class="ident" id="5365056">RuneReader</span><span class="op" id="5365066">,</span>&nbsp;<span class="ident" id="5365068">b</span>&nbsp;<span class="op" id="5365070">[</span><span class="op" id="5365071">]</span><span class="builtintype" id="5365072">byte</span><span class="op" id="5365076">,</span>&nbsp;<span class="ident" id="5365078">s</span>&nbsp;<span class="builtintype" id="5365080">string</span><span class="op" id="5365086">,</span>&nbsp;<span class="ident" id="5365088">pos</span>&nbsp;<span class="builtintype" id="5365092">int</span><span class="op" id="5365095">,</span>&nbsp;<span class="ident" id="5365097">ncap</span>&nbsp;<span class="builtintype" id="5365102">int</span><span class="op" id="5365105">)</span>&nbsp;<span class="op" id="5365107">[</span><span class="op" id="5365108">]</span><span class="builtintype" id="5365109">int</span>&nbsp;<span class="op" id="5365113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365116">m</span>&nbsp;<span class="op" id="5365118">:=</span>&nbsp;<span class="ident" id="5365121">re</span><span class="op" id="5365123">.</span><span class="ident" id="5365124">get</span><span class="op" id="5365127">(</span><span class="op" id="5365128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365131">var</span>&nbsp;<span class="ident" id="5365135">i</span>&nbsp;<span class="ident" id="5365137">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365144">if</span>&nbsp;<span class="ident" id="5365147">r</span>&nbsp;<span class="op" id="5365149">!=</span>&nbsp;<span class="ident" id="5365152">nil</span>&nbsp;<span class="op" id="5365156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365160">i</span>&nbsp;<span class="op" id="5365162">=</span>&nbsp;<span class="ident" id="5365164">m</span><span class="op" id="5365165">.</span><span class="ident" id="5365166">newInputReader</span><span class="op" id="5365180">(</span><span class="ident" id="5365181">r</span><span class="op" id="5365182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365185">}</span>&nbsp;<span class="keyword" id="5365187">else</span>&nbsp;<span class="keyword" id="5365192">if</span>&nbsp;<span class="ident" id="5365195">b</span>&nbsp;<span class="op" id="5365197">!=</span>&nbsp;<span class="ident" id="5365200">nil</span>&nbsp;<span class="op" id="5365204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365208">i</span>&nbsp;<span class="op" id="5365210">=</span>&nbsp;<span class="ident" id="5365212">m</span><span class="op" id="5365213">.</span><span class="ident" id="5365214">newInputBytes</span><span class="op" id="5365227">(</span><span class="ident" id="5365228">b</span><span class="op" id="5365229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365232">}</span>&nbsp;<span class="keyword" id="5365234">else</span>&nbsp;<span class="op" id="5365239">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365243">i</span>&nbsp;<span class="op" id="5365245">=</span>&nbsp;<span class="ident" id="5365247">m</span><span class="op" id="5365248">.</span><span class="ident" id="5365249">newInputString</span><span class="op" id="5365263">(</span><span class="ident" id="5365264">s</span><span class="op" id="5365265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365271">if</span>&nbsp;<span class="ident" id="5365274">m</span><span class="op" id="5365275">.</span><span class="ident" id="5365276">op</span>&nbsp;<span class="op" id="5365279">!=</span>&nbsp;<span class="ident" id="5365282">notOnePass</span>&nbsp;<span class="op" id="5365293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365297">if</span>&nbsp;<span class="op" id="5365300">!</span><span class="ident" id="5365301">m</span><span class="op" id="5365302">.</span><span class="ident" id="5365303">onepass</span><span class="op" id="5365310">(</span><span class="ident" id="5365311">i</span><span class="op" id="5365312">,</span>&nbsp;<span class="ident" id="5365314">pos</span><span class="op" id="5365317">)</span>&nbsp;<span class="op" id="5365319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365324">re</span><span class="op" id="5365326">.</span><span class="ident" id="5365327">put</span><span class="op" id="5365330">(</span><span class="ident" id="5365331">m</span><span class="op" id="5365332">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365337">return</span>&nbsp;<span class="ident" id="5365344">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365353">}</span>&nbsp;<span class="keyword" id="5365355">else</span>&nbsp;<span class="op" id="5365360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365364">m</span><span class="op" id="5365365">.</span><span class="ident" id="5365366">init</span><span class="op" id="5365370">(</span><span class="ident" id="5365371">ncap</span><span class="op" id="5365375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365379">if</span>&nbsp;<span class="op" id="5365382">!</span><span class="ident" id="5365383">m</span><span class="op" id="5365384">.</span><span class="ident" id="5365385">match</span><span class="op" id="5365390">(</span><span class="ident" id="5365391">i</span><span class="op" id="5365392">,</span>&nbsp;<span class="ident" id="5365394">pos</span><span class="op" id="5365397">)</span>&nbsp;<span class="op" id="5365399">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365404">re</span><span class="op" id="5365406">.</span><span class="ident" id="5365407">put</span><span class="op" id="5365410">(</span><span class="ident" id="5365411">m</span><span class="op" id="5365412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365417">return</span>&nbsp;<span class="ident" id="5365424">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365436">if</span>&nbsp;<span class="ident" id="5365439">ncap</span>&nbsp;<span class="op" id="5365444">==</span>&nbsp;<span class="num" id="5365447">0</span>&nbsp;<span class="op" id="5365449">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365453">re</span><span class="op" id="5365455">.</span><span class="ident" id="5365456">put</span><span class="op" id="5365459">(</span><span class="ident" id="5365460">m</span><span class="op" id="5365461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365465">return</span>&nbsp;<span class="ident" id="5365472">empty</span>&nbsp;<span class="comment" id="5365478">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5365503">cap</span>&nbsp;<span class="op" id="5365507">:=</span>&nbsp;<span class="builtinfunc" id="5365510">make</span><span class="op" id="5365514">(</span><span class="op" id="5365515">[</span><span class="op" id="5365516">]</span><span class="builtintype" id="5365517">int</span><span class="op" id="5365520">,</span>&nbsp;<span class="builtinfunc" id="5365522">len</span><span class="op" id="5365525">(</span><span class="ident" id="5365526">m</span><span class="op" id="5365527">.</span><span class="ident" id="5365528">matchcap</span><span class="op" id="5365536">)</span><span class="op" id="5365537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5365540">copy</span><span class="op" id="5365544">(</span><span class="builtinfunc" id="5365545">cap</span><span class="op" id="5365548">,</span>&nbsp;<span class="ident" id="5365550">m</span><span class="op" id="5365551">.</span><span class="ident" id="5365552">matchcap</span><span class="op" id="5365560">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365563">re</span><span class="op" id="5365565">.</span><span class="ident" id="5365566">put</span><span class="op" id="5365569">(</span><span class="ident" id="5365570">m</span><span class="op" id="5365571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365574">return</span>&nbsp;<span class="builtinfunc" id="5365581">cap</span><br>
<span class="lineno"></span><span class="op" id="5365585">}</span>
</div>
</body>
</html>
