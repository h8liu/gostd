<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="8503807">package</span>&nbsp;<span class="ident" id="8503815">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8503822">import</span>&nbsp;<span class="op" id="8503829">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8503832">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8503842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8503845">func</span>&nbsp;<span class="ident" id="8503850">TestPhyMemory</span><span class="op" id="8503863">(</span><span class="ident" id="8503864">t</span>&nbsp;<span class="op" id="8503866">*</span><span class="ident" id="8503867">testing</span><span class="op" id="8503874">.</span><span class="ident" id="8503875">T</span><span class="op" id="8503876">)</span>&nbsp;<span class="op" id="8503878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503881">eo</span>&nbsp;<span class="op" id="8503884">:=</span>&nbsp;<span class="keyword" id="8503887">func</span><span class="op" id="8503891">(</span><span class="ident" id="8503892">cond</span>&nbsp;<span class="builtintype" id="8503897">bool</span><span class="op" id="8503901">,</span>&nbsp;<span class="ident" id="8503903">s</span>&nbsp;<span class="builtintype" id="8503905">string</span><span class="op" id="8503911">,</span>&nbsp;<span class="ident" id="8503913">args</span>&nbsp;<span class="op" id="8503918">...</span><span class="keyword" id="8503921">interface</span><span class="op" id="8503930">{</span><span class="op" id="8503931">}</span><span class="op" id="8503932">)</span>&nbsp;<span class="op" id="8503934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503938">if</span>&nbsp;<span class="ident" id="8503941">cond</span>&nbsp;<span class="op" id="8503946">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503951">t</span><span class="op" id="8503952">.</span><span class="ident" id="8503953">Fatalf</span><span class="op" id="8503959">(</span><span class="ident" id="8503960">s</span><span class="op" id="8503961">,</span>&nbsp;<span class="ident" id="8503963">args</span><span class="op" id="8503967">...</span><span class="op" id="8503970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8503974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8503977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503981">as</span>&nbsp;<span class="op" id="8503984">:=</span>&nbsp;<span class="keyword" id="8503987">func</span><span class="op" id="8503991">(</span><span class="ident" id="8503992">cond</span>&nbsp;<span class="builtintype" id="8503997">bool</span><span class="op" id="8504001">)</span>&nbsp;<span class="op" id="8504003">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504007">if</span>&nbsp;<span class="op" id="8504010">!</span><span class="ident" id="8504011">cond</span>&nbsp;<span class="op" id="8504016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504021">t</span><span class="op" id="8504022">.</span><span class="ident" id="8504023">Fatal</span><span class="op" id="8504028">(</span><span class="string" id="8504029">&#34;assertion&nbsp;failed&#34;</span><span class="op" id="8504047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504058">size</span>&nbsp;<span class="op" id="8504063">:=</span>&nbsp;<span class="builtintype" id="8504066">uint32</span><span class="op" id="8504072">(</span><span class="num" id="8504073">20</span>&nbsp;<span class="op" id="8504076">*</span>&nbsp;<span class="ident" id="8504078">PageSize</span><span class="op" id="8504086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504089">m</span>&nbsp;<span class="op" id="8504091">:=</span>&nbsp;<span class="ident" id="8504094">newPhyMemory</span><span class="op" id="8504106">(</span><span class="ident" id="8504107">size</span><span class="op" id="8504111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504114">eo</span><span class="op" id="8504116">(</span><span class="ident" id="8504117">m</span><span class="op" id="8504118">.</span><span class="ident" id="8504119">Size</span><span class="op" id="8504123">(</span><span class="op" id="8504124">)</span>&nbsp;<span class="op" id="8504126">!=</span>&nbsp;<span class="ident" id="8504129">size</span><span class="op" id="8504133">,</span>&nbsp;<span class="string" id="8504135">&#34;size&nbsp;mismatch&#34;</span><span class="op" id="8504150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504154">w</span><span class="op" id="8504155">,</span>&nbsp;<span class="ident" id="8504157">e</span>&nbsp;<span class="op" id="8504159">:=</span>&nbsp;<span class="ident" id="8504162">m</span><span class="op" id="8504163">.</span><span class="ident" id="8504164">ReadWord</span><span class="op" id="8504172">(</span><span class="num" id="8504173">4</span><span class="op" id="8504174">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504177">eo</span><span class="op" id="8504179">(</span><span class="ident" id="8504180">e</span>&nbsp;<span class="op" id="8504182">!=</span>&nbsp;<span class="ident" id="8504185">nil</span><span class="op" id="8504188">,</span>&nbsp;<span class="string" id="8504190">&#34;get&nbsp;an&nbsp;error&nbsp;for&nbsp;word&nbsp;reading&#34;</span><span class="op" id="8504221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504224">eo</span><span class="op" id="8504226">(</span><span class="ident" id="8504227">w</span>&nbsp;<span class="op" id="8504229">!=</span>&nbsp;<span class="num" id="8504232">0</span><span class="op" id="8504233">,</span>&nbsp;<span class="string" id="8504235">&#34;page&nbsp;is&nbsp;not&nbsp;zeroed&nbsp;out&#34;</span><span class="op" id="8504259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504263">_</span><span class="op" id="8504264">,</span>&nbsp;<span class="ident" id="8504266">e</span>&nbsp;<span class="op" id="8504268">=</span>&nbsp;<span class="ident" id="8504270">m</span><span class="op" id="8504271">.</span><span class="ident" id="8504272">ReadWord</span><span class="op" id="8504280">(</span><span class="num" id="8504281">13</span><span class="op" id="8504283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504286">eo</span><span class="op" id="8504288">(</span><span class="ident" id="8504289">e</span>&nbsp;<span class="op" id="8504291">!=</span>&nbsp;<span class="ident" id="8504294">errMisalign</span><span class="op" id="8504305">,</span>&nbsp;<span class="string" id="8504307">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="8504335">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504338">_</span><span class="op" id="8504339">,</span>&nbsp;<span class="ident" id="8504341">e</span>&nbsp;<span class="op" id="8504343">=</span>&nbsp;<span class="ident" id="8504345">m</span><span class="op" id="8504346">.</span><span class="ident" id="8504347">ReadWord</span><span class="op" id="8504355">(</span><span class="ident" id="8504356">size</span>&nbsp;<span class="op" id="8504361">-</span>&nbsp;<span class="num" id="8504363">1</span><span class="op" id="8504364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504367">eo</span><span class="op" id="8504369">(</span><span class="ident" id="8504370">e</span>&nbsp;<span class="op" id="8504372">!=</span>&nbsp;<span class="ident" id="8504375">errMisalign</span><span class="op" id="8504386">,</span>&nbsp;<span class="string" id="8504388">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="8504416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504420">_</span><span class="op" id="8504421">,</span>&nbsp;<span class="ident" id="8504423">e</span>&nbsp;<span class="op" id="8504425">=</span>&nbsp;<span class="ident" id="8504427">m</span><span class="op" id="8504428">.</span><span class="ident" id="8504429">ReadWord</span><span class="op" id="8504437">(</span><span class="ident" id="8504438">size</span><span class="op" id="8504442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504445">eo</span><span class="op" id="8504447">(</span><span class="ident" id="8504448">e</span>&nbsp;<span class="op" id="8504450">!=</span>&nbsp;<span class="ident" id="8504453">errOutOfRange</span><span class="op" id="8504466">,</span>&nbsp;<span class="string" id="8504468">&#34;should&nbsp;have&nbsp;out&nbsp;of&nbsp;range&nbsp;error&#34;</span><span class="op" id="8504500">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504504">off</span>&nbsp;<span class="op" id="8504508">:=</span>&nbsp;<span class="builtintype" id="8504511">uint32</span><span class="op" id="8504517">(</span><span class="num" id="8504518">56</span>&nbsp;<span class="op" id="8504521">+</span>&nbsp;<span class="ident" id="8504523">PageSize</span><span class="op" id="8504531">*</span><span class="num" id="8504532">2</span><span class="op" id="8504533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504536">as</span><span class="op" id="8504538">(</span><span class="ident" id="8504539">m</span><span class="op" id="8504540">.</span><span class="ident" id="8504541">WriteByte</span><span class="op" id="8504550">(</span><span class="ident" id="8504551">off</span><span class="op" id="8504554">+</span><span class="num" id="8504555">0</span><span class="op" id="8504556">,</span>&nbsp;<span class="num" id="8504558">0x37</span><span class="op" id="8504562">)</span>&nbsp;<span class="op" id="8504564">==</span>&nbsp;<span class="ident" id="8504567">nil</span><span class="op" id="8504570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504573">as</span><span class="op" id="8504575">(</span><span class="ident" id="8504576">m</span><span class="op" id="8504577">.</span><span class="ident" id="8504578">WriteByte</span><span class="op" id="8504587">(</span><span class="ident" id="8504588">off</span><span class="op" id="8504591">+</span><span class="num" id="8504592">1</span><span class="op" id="8504593">,</span>&nbsp;<span class="num" id="8504595">0x21</span><span class="op" id="8504599">)</span>&nbsp;<span class="op" id="8504601">==</span>&nbsp;<span class="ident" id="8504604">nil</span><span class="op" id="8504607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504610">as</span><span class="op" id="8504612">(</span><span class="ident" id="8504613">m</span><span class="op" id="8504614">.</span><span class="ident" id="8504615">WriteByte</span><span class="op" id="8504624">(</span><span class="ident" id="8504625">off</span><span class="op" id="8504628">+</span><span class="num" id="8504629">2</span><span class="op" id="8504630">,</span>&nbsp;<span class="num" id="8504632">0x5a</span><span class="op" id="8504636">)</span>&nbsp;<span class="op" id="8504638">==</span>&nbsp;<span class="ident" id="8504641">nil</span><span class="op" id="8504644">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504647">as</span><span class="op" id="8504649">(</span><span class="ident" id="8504650">m</span><span class="op" id="8504651">.</span><span class="ident" id="8504652">WriteByte</span><span class="op" id="8504661">(</span><span class="ident" id="8504662">off</span><span class="op" id="8504665">+</span><span class="num" id="8504666">3</span><span class="op" id="8504667">,</span>&nbsp;<span class="num" id="8504669">0x70</span><span class="op" id="8504673">)</span>&nbsp;<span class="op" id="8504675">==</span>&nbsp;<span class="ident" id="8504678">nil</span><span class="op" id="8504681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504684">exp</span>&nbsp;<span class="op" id="8504688">:=</span>&nbsp;<span class="builtintype" id="8504691">uint32</span><span class="op" id="8504697">(</span><span class="num" id="8504698">0x705a2137</span><span class="op" id="8504708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504711">w</span><span class="op" id="8504712">,</span>&nbsp;<span class="ident" id="8504714">e</span>&nbsp;<span class="op" id="8504716">=</span>&nbsp;<span class="ident" id="8504718">m</span><span class="op" id="8504719">.</span><span class="ident" id="8504720">ReadWord</span><span class="op" id="8504728">(</span><span class="ident" id="8504729">off</span><span class="op" id="8504732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504735">as</span><span class="op" id="8504737">(</span><span class="ident" id="8504738">e</span>&nbsp;<span class="op" id="8504740">==</span>&nbsp;<span class="ident" id="8504743">nil</span><span class="op" id="8504746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504749">eo</span><span class="op" id="8504751">(</span><span class="ident" id="8504752">w</span>&nbsp;<span class="op" id="8504754">!=</span>&nbsp;<span class="ident" id="8504757">exp</span><span class="op" id="8504760">,</span>&nbsp;<span class="string" id="8504762">&#34;expect&nbsp;0x%08x&nbsp;got&nbsp;0x%08x&#34;</span><span class="op" id="8504788">,</span>&nbsp;<span class="ident" id="8504790">exp</span><span class="op" id="8504793">,</span>&nbsp;<span class="ident" id="8504795">w</span><span class="op" id="8504796">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504799">b</span><span class="op" id="8504800">,</span>&nbsp;<span class="ident" id="8504802">e</span>&nbsp;<span class="op" id="8504804">:=</span>&nbsp;<span class="ident" id="8504807">m</span><span class="op" id="8504808">.</span><span class="ident" id="8504809">ReadByte</span><span class="op" id="8504817">(</span><span class="ident" id="8504818">off</span>&nbsp;<span class="op" id="8504822">+</span>&nbsp;<span class="num" id="8504824">2</span><span class="op" id="8504825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504828">as</span><span class="op" id="8504830">(</span><span class="ident" id="8504831">e</span>&nbsp;<span class="op" id="8504833">==</span>&nbsp;<span class="ident" id="8504836">nil</span><span class="op" id="8504839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504842">eo</span><span class="op" id="8504844">(</span><span class="ident" id="8504845">b</span>&nbsp;<span class="op" id="8504847">!=</span>&nbsp;<span class="num" id="8504850">0x5a</span><span class="op" id="8504854">,</span>&nbsp;<span class="string" id="8504856">&#34;expect&nbsp;0x5a&nbsp;got&nbsp;%02x&#34;</span><span class="op" id="8504878">,</span>&nbsp;<span class="ident" id="8504880">b</span><span class="op" id="8504881">)</span><br>
<span class="lineno"></span><span class="op" id="8504883">}</span>
</div>
</body>
</html>
