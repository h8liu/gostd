<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html" class="current">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1672535">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1672590">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1672644">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1672695">package</span>&nbsp;<span class="ident" id="1672703">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672712">import</span>&nbsp;<span class="op" id="1672719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1672722">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1672731">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1672734">type</span>&nbsp;<span class="ident" id="1672739">sliceStruct</span>&nbsp;<span class="keyword" id="1672751">struct</span>&nbsp;<span class="op" id="1672758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1672761">array</span>&nbsp;<span class="ident" id="1672767">unsafe</span><span class="op" id="1672773">.</span><span class="ident" id="1672774">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1672783">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1672789">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1672794">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1672800">int</span><br>
<span class="lineno">15</span><span class="op" id="1672804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1672807">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1672849">func</span>&nbsp;<span class="ident" id="1672854">makeslice</span><span class="op" id="1672863">(</span><span class="ident" id="1672864">t</span>&nbsp;<span class="op" id="1672866">*</span><span class="ident" id="1672867">slicetype</span><span class="op" id="1672876">,</span>&nbsp;<span class="ident" id="1672878">len64</span>&nbsp;<span class="ident" id="1672884">int64</span><span class="op" id="1672889">,</span>&nbsp;<span class="ident" id="1672891">cap64</span>&nbsp;<span class="ident" id="1672897">int64</span><span class="op" id="1672902">)</span>&nbsp;<span class="ident" id="1672904">sliceStruct</span>&nbsp;<span class="op" id="1672916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1672919">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1672993">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1673078">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1673154">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1673234">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1673254">len</span>&nbsp;<span class="op" id="1673258">:=</span>&nbsp;<span class="builtintype" id="1673261">int</span><span class="op" id="1673264">(</span><span class="ident" id="1673265">len64</span><span class="op" id="1673270">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1673273">if</span>&nbsp;<span class="ident" id="1673276">len64</span>&nbsp;<span class="op" id="1673282">&lt;</span>&nbsp;<span class="num" id="1673284">0</span>&nbsp;<span class="op" id="1673286">||</span>&nbsp;<span class="ident" id="1673289">int64</span><span class="op" id="1673294">(</span><span class="builtinfunc" id="1673295">len</span><span class="op" id="1673298">)</span>&nbsp;<span class="op" id="1673300">!=</span>&nbsp;<span class="ident" id="1673303">len64</span>&nbsp;<span class="op" id="1673309">||</span>&nbsp;<span class="ident" id="1673312">t</span><span class="op" id="1673313">.</span><span class="ident" id="1673314">elem</span><span class="op" id="1673318">.</span><span class="ident" id="1673319">size</span>&nbsp;<span class="op" id="1673324">&gt;</span>&nbsp;<span class="num" id="1673326">0</span>&nbsp;<span class="op" id="1673328">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1673331">uintptr</span><span class="op" id="1673338">(</span><span class="builtinfunc" id="1673339">len</span><span class="op" id="1673342">)</span>&nbsp;<span class="op" id="1673344">&gt;</span>&nbsp;<span class="ident" id="1673346">maxmem</span><span class="op" id="1673352">/</span><span class="builtintype" id="1673353">uintptr</span><span class="op" id="1673360">(</span><span class="ident" id="1673361">t</span><span class="op" id="1673362">.</span><span class="ident" id="1673363">elem</span><span class="op" id="1673367">.</span><span class="ident" id="1673368">size</span><span class="op" id="1673372">)</span>&nbsp;<span class="op" id="1673374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1673378">panic</span><span class="op" id="1673383">(</span><span class="ident" id="1673384">errorString</span><span class="op" id="1673395">(</span><span class="string" id="1673396">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1673425">)</span><span class="op" id="1673426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1673429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1673432">cap</span>&nbsp;<span class="op" id="1673436">:=</span>&nbsp;<span class="builtintype" id="1673439">int</span><span class="op" id="1673442">(</span><span class="ident" id="1673443">cap64</span><span class="op" id="1673448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1673451">if</span>&nbsp;<span class="builtinfunc" id="1673454">cap</span>&nbsp;<span class="op" id="1673458">&lt;</span>&nbsp;<span class="builtinfunc" id="1673460">len</span>&nbsp;<span class="op" id="1673464">||</span>&nbsp;<span class="ident" id="1673467">int64</span><span class="op" id="1673472">(</span><span class="builtinfunc" id="1673473">cap</span><span class="op" id="1673476">)</span>&nbsp;<span class="op" id="1673478">!=</span>&nbsp;<span class="ident" id="1673481">cap64</span>&nbsp;<span class="op" id="1673487">||</span>&nbsp;<span class="ident" id="1673490">t</span><span class="op" id="1673491">.</span><span class="ident" id="1673492">elem</span><span class="op" id="1673496">.</span><span class="ident" id="1673497">size</span>&nbsp;<span class="op" id="1673502">&gt;</span>&nbsp;<span class="num" id="1673504">0</span>&nbsp;<span class="op" id="1673506">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1673509">uintptr</span><span class="op" id="1673516">(</span><span class="builtinfunc" id="1673517">cap</span><span class="op" id="1673520">)</span>&nbsp;<span class="op" id="1673522">&gt;</span>&nbsp;<span class="ident" id="1673524">maxmem</span><span class="op" id="1673530">/</span><span class="builtintype" id="1673531">uintptr</span><span class="op" id="1673538">(</span><span class="ident" id="1673539">t</span><span class="op" id="1673540">.</span><span class="ident" id="1673541">elem</span><span class="op" id="1673545">.</span><span class="ident" id="1673546">size</span><span class="op" id="1673550">)</span>&nbsp;<span class="op" id="1673552">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1673556">panic</span><span class="op" id="1673561">(</span><span class="ident" id="1673562">errorString</span><span class="op" id="1673573">(</span><span class="string" id="1673574">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1673603">)</span><span class="op" id="1673604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1673607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1673610">p</span>&nbsp;<span class="op" id="1673612">:=</span>&nbsp;<span class="ident" id="1673615">newarray</span><span class="op" id="1673623">(</span><span class="ident" id="1673624">t</span><span class="op" id="1673625">.</span><span class="ident" id="1673626">elem</span><span class="op" id="1673630">,</span>&nbsp;<span class="builtintype" id="1673632">uintptr</span><span class="op" id="1673639">(</span><span class="builtinfunc" id="1673640">cap</span><span class="op" id="1673643">)</span><span class="op" id="1673644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1673647">return</span>&nbsp;<span class="ident" id="1673654">sliceStruct</span><span class="op" id="1673665">{</span><span class="ident" id="1673666">p</span><span class="op" id="1673667">,</span>&nbsp;<span class="builtinfunc" id="1673669">len</span><span class="op" id="1673672">,</span>&nbsp;<span class="builtinfunc" id="1673674">cap</span><span class="op" id="1673677">}</span><br>
<span class="lineno"></span><span class="op" id="1673679">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1673682">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1673722">func</span>&nbsp;<span class="ident" id="1673727">growslice</span><span class="op" id="1673736">(</span><span class="ident" id="1673737">t</span>&nbsp;<span class="op" id="1673739">*</span><span class="ident" id="1673740">slicetype</span><span class="op" id="1673749">,</span>&nbsp;<span class="ident" id="1673751">old</span>&nbsp;<span class="ident" id="1673755">sliceStruct</span><span class="op" id="1673766">,</span>&nbsp;<span class="ident" id="1673768">n</span>&nbsp;<span class="ident" id="1673770">int64</span><span class="op" id="1673775">)</span>&nbsp;<span class="ident" id="1673777">sliceStruct</span>&nbsp;<span class="op" id="1673789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1673792">if</span>&nbsp;<span class="ident" id="1673795">n</span>&nbsp;<span class="op" id="1673797">&lt;</span>&nbsp;<span class="num" id="1673799">1</span>&nbsp;<span class="op" id="1673801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1673805">panic</span><span class="op" id="1673810">(</span><span class="ident" id="1673811">errorString</span><span class="op" id="1673822">(</span><span class="string" id="1673823">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1673845">)</span><span class="op" id="1673846">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1673849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1673853">cap64</span>&nbsp;<span class="op" id="1673859">:=</span>&nbsp;<span class="ident" id="1673862">int64</span><span class="op" id="1673867">(</span><span class="ident" id="1673868">old</span><span class="op" id="1673871">.</span><span class="builtinfunc" id="1673872">cap</span><span class="op" id="1673875">)</span>&nbsp;<span class="op" id="1673877">+</span>&nbsp;<span class="ident" id="1673879">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1673882">cap</span>&nbsp;<span class="op" id="1673886">:=</span>&nbsp;<span class="builtintype" id="1673889">int</span><span class="op" id="1673892">(</span><span class="ident" id="1673893">cap64</span><span class="op" id="1673898">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1673902">if</span>&nbsp;<span class="ident" id="1673905">int64</span><span class="op" id="1673910">(</span><span class="builtinfunc" id="1673911">cap</span><span class="op" id="1673914">)</span>&nbsp;<span class="op" id="1673916">!=</span>&nbsp;<span class="ident" id="1673919">cap64</span>&nbsp;<span class="op" id="1673925">||</span>&nbsp;<span class="builtinfunc" id="1673928">cap</span>&nbsp;<span class="op" id="1673932">&lt;</span>&nbsp;<span class="ident" id="1673934">old</span><span class="op" id="1673937">.</span><span class="builtinfunc" id="1673938">cap</span>&nbsp;<span class="op" id="1673942">||</span>&nbsp;<span class="ident" id="1673945">t</span><span class="op" id="1673946">.</span><span class="ident" id="1673947">elem</span><span class="op" id="1673951">.</span><span class="ident" id="1673952">size</span>&nbsp;<span class="op" id="1673957">&gt;</span>&nbsp;<span class="num" id="1673959">0</span>&nbsp;<span class="op" id="1673961">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1673964">uintptr</span><span class="op" id="1673971">(</span><span class="builtinfunc" id="1673972">cap</span><span class="op" id="1673975">)</span>&nbsp;<span class="op" id="1673977">&gt;</span>&nbsp;<span class="ident" id="1673979">maxmem</span><span class="op" id="1673985">/</span><span class="builtintype" id="1673986">uintptr</span><span class="op" id="1673993">(</span><span class="ident" id="1673994">t</span><span class="op" id="1673995">.</span><span class="ident" id="1673996">elem</span><span class="op" id="1674000">.</span><span class="ident" id="1674001">size</span><span class="op" id="1674005">)</span>&nbsp;<span class="op" id="1674007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1674011">panic</span><span class="op" id="1674016">(</span><span class="ident" id="1674017">errorString</span><span class="op" id="1674028">(</span><span class="string" id="1674029">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1674058">)</span><span class="op" id="1674059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674066">if</span>&nbsp;<span class="ident" id="1674069">raceenabled</span>&nbsp;<span class="op" id="1674081">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674085">callerpc</span>&nbsp;<span class="op" id="1674094">:=</span>&nbsp;<span class="ident" id="1674097">getcallerpc</span><span class="op" id="1674108">(</span><span class="ident" id="1674109">unsafe</span><span class="op" id="1674115">.</span><span class="ident" id="1674116">Pointer</span><span class="op" id="1674123">(</span><span class="op" id="1674124">&amp;</span><span class="ident" id="1674125">t</span><span class="op" id="1674126">)</span><span class="op" id="1674127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674131">racereadrangepc</span><span class="op" id="1674146">(</span><span class="ident" id="1674147">old</span><span class="op" id="1674150">.</span><span class="ident" id="1674151">array</span><span class="op" id="1674156">,</span>&nbsp;<span class="builtintype" id="1674158">uintptr</span><span class="op" id="1674165">(</span><span class="ident" id="1674166">old</span><span class="op" id="1674169">.</span><span class="builtinfunc" id="1674170">len</span><span class="op" id="1674173">*</span><span class="builtintype" id="1674174">int</span><span class="op" id="1674177">(</span><span class="ident" id="1674178">t</span><span class="op" id="1674179">.</span><span class="ident" id="1674180">elem</span><span class="op" id="1674184">.</span><span class="ident" id="1674185">size</span><span class="op" id="1674189">)</span><span class="op" id="1674190">)</span><span class="op" id="1674191">,</span>&nbsp;<span class="ident" id="1674193">callerpc</span><span class="op" id="1674201">,</span>&nbsp;<span class="ident" id="1674203">funcPC</span><span class="op" id="1674209">(</span><span class="ident" id="1674210">growslice</span><span class="op" id="1674219">)</span><span class="op" id="1674220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674227">et</span>&nbsp;<span class="op" id="1674230">:=</span>&nbsp;<span class="ident" id="1674233">t</span><span class="op" id="1674234">.</span><span class="ident" id="1674235">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674241">if</span>&nbsp;<span class="ident" id="1674244">et</span><span class="op" id="1674246">.</span><span class="ident" id="1674247">size</span>&nbsp;<span class="op" id="1674252">==</span>&nbsp;<span class="num" id="1674255">0</span>&nbsp;<span class="op" id="1674257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674261">return</span>&nbsp;<span class="ident" id="1674268">sliceStruct</span><span class="op" id="1674279">{</span><span class="ident" id="1674280">old</span><span class="op" id="1674283">.</span><span class="ident" id="1674284">array</span><span class="op" id="1674289">,</span>&nbsp;<span class="ident" id="1674291">old</span><span class="op" id="1674294">.</span><span class="builtinfunc" id="1674295">len</span><span class="op" id="1674298">,</span>&nbsp;<span class="builtinfunc" id="1674300">cap</span><span class="op" id="1674303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674310">newcap</span>&nbsp;<span class="op" id="1674317">:=</span>&nbsp;<span class="ident" id="1674320">old</span><span class="op" id="1674323">.</span><span class="builtinfunc" id="1674324">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674329">if</span>&nbsp;<span class="ident" id="1674332">newcap</span><span class="op" id="1674338">+</span><span class="ident" id="1674339">newcap</span>&nbsp;<span class="op" id="1674346">&lt;</span>&nbsp;<span class="builtinfunc" id="1674348">cap</span>&nbsp;<span class="op" id="1674352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674356">newcap</span>&nbsp;<span class="op" id="1674363">=</span>&nbsp;<span class="builtinfunc" id="1674365">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674370">}</span>&nbsp;<span class="keyword" id="1674372">else</span>&nbsp;<span class="op" id="1674377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674381">for</span>&nbsp;<span class="op" id="1674385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674390">if</span>&nbsp;<span class="ident" id="1674393">old</span><span class="op" id="1674396">.</span><span class="builtinfunc" id="1674397">len</span>&nbsp;<span class="op" id="1674401">&lt;</span>&nbsp;<span class="num" id="1674403">1024</span>&nbsp;<span class="op" id="1674408">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674414">newcap</span>&nbsp;<span class="op" id="1674421">+=</span>&nbsp;<span class="ident" id="1674424">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674434">}</span>&nbsp;<span class="keyword" id="1674436">else</span>&nbsp;<span class="op" id="1674441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674447">newcap</span>&nbsp;<span class="op" id="1674454">+=</span>&nbsp;<span class="ident" id="1674457">newcap</span>&nbsp;<span class="op" id="1674464">/</span>&nbsp;<span class="num" id="1674466">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674476">if</span>&nbsp;<span class="ident" id="1674479">newcap</span>&nbsp;<span class="op" id="1674486">&gt;=</span>&nbsp;<span class="builtinfunc" id="1674489">cap</span>&nbsp;<span class="op" id="1674493">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674499">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674519">if</span>&nbsp;<span class="builtintype" id="1674522">uintptr</span><span class="op" id="1674529">(</span><span class="ident" id="1674530">newcap</span><span class="op" id="1674536">)</span>&nbsp;<span class="op" id="1674538">&gt;=</span>&nbsp;<span class="ident" id="1674541">maxmem</span><span class="op" id="1674547">/</span><span class="builtintype" id="1674548">uintptr</span><span class="op" id="1674555">(</span><span class="ident" id="1674556">et</span><span class="op" id="1674558">.</span><span class="ident" id="1674559">size</span><span class="op" id="1674563">)</span>&nbsp;<span class="op" id="1674565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1674569">panic</span><span class="op" id="1674574">(</span><span class="ident" id="1674575">errorString</span><span class="op" id="1674586">(</span><span class="string" id="1674587">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1674616">)</span><span class="op" id="1674617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674623">lenmem</span>&nbsp;<span class="op" id="1674630">:=</span>&nbsp;<span class="builtintype" id="1674633">uintptr</span><span class="op" id="1674640">(</span><span class="ident" id="1674641">old</span><span class="op" id="1674644">.</span><span class="builtinfunc" id="1674645">len</span><span class="op" id="1674648">)</span>&nbsp;<span class="op" id="1674650">*</span>&nbsp;<span class="builtintype" id="1674652">uintptr</span><span class="op" id="1674659">(</span><span class="ident" id="1674660">et</span><span class="op" id="1674662">.</span><span class="ident" id="1674663">size</span><span class="op" id="1674667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674670">capmem</span>&nbsp;<span class="op" id="1674677">:=</span>&nbsp;<span class="ident" id="1674680">goroundupsize</span><span class="op" id="1674693">(</span><span class="builtintype" id="1674694">uintptr</span><span class="op" id="1674701">(</span><span class="ident" id="1674702">newcap</span><span class="op" id="1674708">)</span>&nbsp;<span class="op" id="1674710">*</span>&nbsp;<span class="builtintype" id="1674712">uintptr</span><span class="op" id="1674719">(</span><span class="ident" id="1674720">et</span><span class="op" id="1674722">.</span><span class="ident" id="1674723">size</span><span class="op" id="1674727">)</span><span class="op" id="1674728">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674731">newcap</span>&nbsp;<span class="op" id="1674738">=</span>&nbsp;<span class="builtintype" id="1674740">int</span><span class="op" id="1674743">(</span><span class="ident" id="1674744">capmem</span>&nbsp;<span class="op" id="1674751">/</span>&nbsp;<span class="builtintype" id="1674753">uintptr</span><span class="op" id="1674760">(</span><span class="ident" id="1674761">et</span><span class="op" id="1674763">.</span><span class="ident" id="1674764">size</span><span class="op" id="1674768">)</span><span class="op" id="1674769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674772">var</span>&nbsp;<span class="ident" id="1674776">p</span>&nbsp;<span class="ident" id="1674778">unsafe</span><span class="op" id="1674784">.</span><span class="ident" id="1674785">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1674794">if</span>&nbsp;<span class="ident" id="1674797">et</span><span class="op" id="1674799">.</span><span class="ident" id="1674800">kind</span><span class="op" id="1674804">&amp;</span><span class="ident" id="1674805">kindNoPointers</span>&nbsp;<span class="op" id="1674820">!=</span>&nbsp;<span class="num" id="1674823">0</span>&nbsp;<span class="op" id="1674825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674829">p</span>&nbsp;<span class="op" id="1674831">=</span>&nbsp;<span class="ident" id="1674833">rawmem</span><span class="op" id="1674839">(</span><span class="ident" id="1674840">capmem</span><span class="op" id="1674846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1674850">memclr</span><span class="op" id="1674856">(</span><span class="ident" id="1674857">add</span><span class="op" id="1674860">(</span><span class="ident" id="1674861">p</span><span class="op" id="1674862">,</span>&nbsp;<span class="ident" id="1674864">lenmem</span><span class="op" id="1674870">)</span><span class="op" id="1674871">,</span>&nbsp;<span class="ident" id="1674873">capmem</span><span class="op" id="1674879">-</span><span class="ident" id="1674880">lenmem</span><span class="op" id="1674886">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1674889">}</span>&nbsp;<span class="keyword" id="1674891">else</span>&nbsp;<span class="op" id="1674896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1674900">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675006">p</span>&nbsp;<span class="op" id="1675008">=</span>&nbsp;<span class="ident" id="1675010">newarray</span><span class="op" id="1675018">(</span><span class="ident" id="1675019">et</span><span class="op" id="1675021">,</span>&nbsp;<span class="builtintype" id="1675023">uintptr</span><span class="op" id="1675030">(</span><span class="ident" id="1675031">newcap</span><span class="op" id="1675037">)</span><span class="op" id="1675038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675044">memmove</span><span class="op" id="1675051">(</span><span class="ident" id="1675052">p</span><span class="op" id="1675053">,</span>&nbsp;<span class="ident" id="1675055">old</span><span class="op" id="1675058">.</span><span class="ident" id="1675059">array</span><span class="op" id="1675064">,</span>&nbsp;<span class="ident" id="1675066">lenmem</span><span class="op" id="1675072">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675076">return</span>&nbsp;<span class="ident" id="1675083">sliceStruct</span><span class="op" id="1675094">{</span><span class="ident" id="1675095">p</span><span class="op" id="1675096">,</span>&nbsp;<span class="ident" id="1675098">old</span><span class="op" id="1675101">.</span><span class="builtinfunc" id="1675102">len</span><span class="op" id="1675105">,</span>&nbsp;<span class="ident" id="1675107">newcap</span><span class="op" id="1675113">}</span><br>
<span class="lineno"></span><span class="op" id="1675115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1675118">func</span>&nbsp;<span class="ident" id="1675123">slicecopy</span><span class="op" id="1675132">(</span><span class="ident" id="1675133">to</span>&nbsp;<span class="ident" id="1675136">sliceStruct</span><span class="op" id="1675147">,</span>&nbsp;<span class="ident" id="1675149">fm</span>&nbsp;<span class="ident" id="1675152">sliceStruct</span><span class="op" id="1675163">,</span>&nbsp;<span class="ident" id="1675165">width</span>&nbsp;<span class="builtintype" id="1675171">uintptr</span><span class="op" id="1675178">)</span>&nbsp;<span class="builtintype" id="1675180">int</span>&nbsp;<span class="op" id="1675184">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675187">if</span>&nbsp;<span class="ident" id="1675190">fm</span><span class="op" id="1675192">.</span><span class="builtinfunc" id="1675193">len</span>&nbsp;<span class="op" id="1675197">==</span>&nbsp;<span class="num" id="1675200">0</span>&nbsp;<span class="op" id="1675202">||</span>&nbsp;<span class="ident" id="1675205">to</span><span class="op" id="1675207">.</span><span class="builtinfunc" id="1675208">len</span>&nbsp;<span class="op" id="1675212">==</span>&nbsp;<span class="num" id="1675215">0</span>&nbsp;<span class="op" id="1675217">||</span>&nbsp;<span class="ident" id="1675220">width</span>&nbsp;<span class="op" id="1675226">==</span>&nbsp;<span class="num" id="1675229">0</span>&nbsp;<span class="op" id="1675231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675235">return</span>&nbsp;<span class="num" id="1675242">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675249">n</span>&nbsp;<span class="op" id="1675251">:=</span>&nbsp;<span class="ident" id="1675254">fm</span><span class="op" id="1675256">.</span><span class="builtinfunc" id="1675257">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675262">if</span>&nbsp;<span class="ident" id="1675265">to</span><span class="op" id="1675267">.</span><span class="builtinfunc" id="1675268">len</span>&nbsp;<span class="op" id="1675272">&lt;</span>&nbsp;<span class="ident" id="1675274">n</span>&nbsp;<span class="op" id="1675276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675280">n</span>&nbsp;<span class="op" id="1675282">=</span>&nbsp;<span class="ident" id="1675284">to</span><span class="op" id="1675286">.</span><span class="builtinfunc" id="1675287">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675296">if</span>&nbsp;<span class="ident" id="1675299">raceenabled</span>&nbsp;<span class="op" id="1675311">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675315">callerpc</span>&nbsp;<span class="op" id="1675324">:=</span>&nbsp;<span class="ident" id="1675327">getcallerpc</span><span class="op" id="1675338">(</span><span class="ident" id="1675339">unsafe</span><span class="op" id="1675345">.</span><span class="ident" id="1675346">Pointer</span><span class="op" id="1675353">(</span><span class="op" id="1675354">&amp;</span><span class="ident" id="1675355">to</span><span class="op" id="1675357">)</span><span class="op" id="1675358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675362">pc</span>&nbsp;<span class="op" id="1675365">:=</span>&nbsp;<span class="ident" id="1675368">funcPC</span><span class="op" id="1675374">(</span><span class="ident" id="1675375">slicecopy</span><span class="op" id="1675384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675388">racewriterangepc</span><span class="op" id="1675404">(</span><span class="ident" id="1675405">to</span><span class="op" id="1675407">.</span><span class="ident" id="1675408">array</span><span class="op" id="1675413">,</span>&nbsp;<span class="builtintype" id="1675415">uintptr</span><span class="op" id="1675422">(</span><span class="ident" id="1675423">n</span><span class="op" id="1675424">*</span><span class="builtintype" id="1675425">int</span><span class="op" id="1675428">(</span><span class="ident" id="1675429">width</span><span class="op" id="1675434">)</span><span class="op" id="1675435">)</span><span class="op" id="1675436">,</span>&nbsp;<span class="ident" id="1675438">callerpc</span><span class="op" id="1675446">,</span>&nbsp;<span class="ident" id="1675448">pc</span><span class="op" id="1675450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675454">racereadrangepc</span><span class="op" id="1675469">(</span><span class="ident" id="1675470">fm</span><span class="op" id="1675472">.</span><span class="ident" id="1675473">array</span><span class="op" id="1675478">,</span>&nbsp;<span class="builtintype" id="1675480">uintptr</span><span class="op" id="1675487">(</span><span class="ident" id="1675488">n</span><span class="op" id="1675489">*</span><span class="builtintype" id="1675490">int</span><span class="op" id="1675493">(</span><span class="ident" id="1675494">width</span><span class="op" id="1675499">)</span><span class="op" id="1675500">)</span><span class="op" id="1675501">,</span>&nbsp;<span class="ident" id="1675503">callerpc</span><span class="op" id="1675511">,</span>&nbsp;<span class="ident" id="1675513">pc</span><span class="op" id="1675515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675518">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675522">size</span>&nbsp;<span class="op" id="1675527">:=</span>&nbsp;<span class="builtintype" id="1675530">uintptr</span><span class="op" id="1675537">(</span><span class="ident" id="1675538">n</span><span class="op" id="1675539">)</span>&nbsp;<span class="op" id="1675541">*</span>&nbsp;<span class="ident" id="1675543">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675550">if</span>&nbsp;<span class="ident" id="1675553">size</span>&nbsp;<span class="op" id="1675558">==</span>&nbsp;<span class="num" id="1675561">1</span>&nbsp;<span class="op" id="1675563">{</span>&nbsp;<span class="comment" id="1675565">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1675608">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675665">*</span><span class="op" id="1675666">(</span><span class="op" id="1675667">*</span><span class="builtintype" id="1675668">byte</span><span class="op" id="1675672">)</span><span class="op" id="1675673">(</span><span class="ident" id="1675674">to</span><span class="op" id="1675676">.</span><span class="ident" id="1675677">array</span><span class="op" id="1675682">)</span>&nbsp;<span class="op" id="1675684">=</span>&nbsp;<span class="op" id="1675686">*</span><span class="op" id="1675687">(</span><span class="op" id="1675688">*</span><span class="builtintype" id="1675689">byte</span><span class="op" id="1675693">)</span><span class="op" id="1675694">(</span><span class="ident" id="1675695">fm</span><span class="op" id="1675697">.</span><span class="ident" id="1675698">array</span><span class="op" id="1675703">)</span>&nbsp;<span class="comment" id="1675705">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675736">}</span>&nbsp;<span class="keyword" id="1675738">else</span>&nbsp;<span class="op" id="1675743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675747">memmove</span><span class="op" id="1675754">(</span><span class="ident" id="1675755">to</span><span class="op" id="1675757">.</span><span class="ident" id="1675758">array</span><span class="op" id="1675763">,</span>&nbsp;<span class="ident" id="1675765">fm</span><span class="op" id="1675767">.</span><span class="ident" id="1675768">array</span><span class="op" id="1675773">,</span>&nbsp;<span class="ident" id="1675775">size</span><span class="op" id="1675779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675785">return</span>&nbsp;<span class="builtintype" id="1675792">int</span><span class="op" id="1675795">(</span><span class="ident" id="1675796">n</span><span class="op" id="1675797">)</span><br>
<span class="lineno"></span><span class="op" id="1675799">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1675802">func</span>&nbsp;<span class="ident" id="1675807">slicestringcopy</span><span class="op" id="1675822">(</span><span class="ident" id="1675823">to</span>&nbsp;<span class="op" id="1675826">[</span><span class="op" id="1675827">]</span><span class="builtintype" id="1675828">byte</span><span class="op" id="1675832">,</span>&nbsp;<span class="ident" id="1675834">fm</span>&nbsp;<span class="builtintype" id="1675837">string</span><span class="op" id="1675843">)</span>&nbsp;<span class="builtintype" id="1675845">int</span>&nbsp;<span class="op" id="1675849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675852">if</span>&nbsp;<span class="builtinfunc" id="1675855">len</span><span class="op" id="1675858">(</span><span class="ident" id="1675859">fm</span><span class="op" id="1675861">)</span>&nbsp;<span class="op" id="1675863">==</span>&nbsp;<span class="num" id="1675866">0</span>&nbsp;<span class="op" id="1675868">||</span>&nbsp;<span class="builtinfunc" id="1675871">len</span><span class="op" id="1675874">(</span><span class="ident" id="1675875">to</span><span class="op" id="1675877">)</span>&nbsp;<span class="op" id="1675879">==</span>&nbsp;<span class="num" id="1675882">0</span>&nbsp;<span class="op" id="1675884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675888">return</span>&nbsp;<span class="num" id="1675895">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675898">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675902">n</span>&nbsp;<span class="op" id="1675904">:=</span>&nbsp;<span class="builtinfunc" id="1675907">len</span><span class="op" id="1675910">(</span><span class="ident" id="1675911">fm</span><span class="op" id="1675913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675916">if</span>&nbsp;<span class="builtinfunc" id="1675919">len</span><span class="op" id="1675922">(</span><span class="ident" id="1675923">to</span><span class="op" id="1675925">)</span>&nbsp;<span class="op" id="1675927">&lt;</span>&nbsp;<span class="ident" id="1675929">n</span>&nbsp;<span class="op" id="1675931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675935">n</span>&nbsp;<span class="op" id="1675937">=</span>&nbsp;<span class="builtinfunc" id="1675939">len</span><span class="op" id="1675942">(</span><span class="ident" id="1675943">to</span><span class="op" id="1675945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1675948">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1675952">if</span>&nbsp;<span class="ident" id="1675955">raceenabled</span>&nbsp;<span class="op" id="1675967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1675971">callerpc</span>&nbsp;<span class="op" id="1675980">:=</span>&nbsp;<span class="ident" id="1675983">getcallerpc</span><span class="op" id="1675994">(</span><span class="ident" id="1675995">unsafe</span><span class="op" id="1676001">.</span><span class="ident" id="1676002">Pointer</span><span class="op" id="1676009">(</span><span class="op" id="1676010">&amp;</span><span class="ident" id="1676011">to</span><span class="op" id="1676013">)</span><span class="op" id="1676014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1676018">pc</span>&nbsp;<span class="op" id="1676021">:=</span>&nbsp;<span class="ident" id="1676024">funcPC</span><span class="op" id="1676030">(</span><span class="ident" id="1676031">slicestringcopy</span><span class="op" id="1676046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1676050">racewriterangepc</span><span class="op" id="1676066">(</span><span class="ident" id="1676067">unsafe</span><span class="op" id="1676073">.</span><span class="ident" id="1676074">Pointer</span><span class="op" id="1676081">(</span><span class="op" id="1676082">&amp;</span><span class="ident" id="1676083">to</span><span class="op" id="1676085">[</span><span class="num" id="1676086">0</span><span class="op" id="1676087">]</span><span class="op" id="1676088">)</span><span class="op" id="1676089">,</span>&nbsp;<span class="builtintype" id="1676091">uintptr</span><span class="op" id="1676098">(</span><span class="ident" id="1676099">n</span><span class="op" id="1676100">)</span><span class="op" id="1676101">,</span>&nbsp;<span class="ident" id="1676103">callerpc</span><span class="op" id="1676111">,</span>&nbsp;<span class="ident" id="1676113">pc</span><span class="op" id="1676115">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1676118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1676122">memmove</span><span class="op" id="1676129">(</span><span class="ident" id="1676130">unsafe</span><span class="op" id="1676136">.</span><span class="ident" id="1676137">Pointer</span><span class="op" id="1676144">(</span><span class="op" id="1676145">&amp;</span><span class="ident" id="1676146">to</span><span class="op" id="1676148">[</span><span class="num" id="1676149">0</span><span class="op" id="1676150">]</span><span class="op" id="1676151">)</span><span class="op" id="1676152">,</span>&nbsp;<span class="ident" id="1676154">unsafe</span><span class="op" id="1676160">.</span><span class="ident" id="1676161">Pointer</span><span class="op" id="1676168">(</span><span class="op" id="1676169">(</span><span class="op" id="1676170">*</span><span class="ident" id="1676171">stringStruct</span><span class="op" id="1676183">)</span><span class="op" id="1676184">(</span><span class="ident" id="1676185">unsafe</span><span class="op" id="1676191">.</span><span class="ident" id="1676192">Pointer</span><span class="op" id="1676199">(</span><span class="op" id="1676200">&amp;</span><span class="ident" id="1676201">fm</span><span class="op" id="1676203">)</span><span class="op" id="1676204">)</span><span class="op" id="1676205">.</span><span class="ident" id="1676206">str</span><span class="op" id="1676209">)</span><span class="op" id="1676210">,</span>&nbsp;<span class="builtintype" id="1676212">uintptr</span><span class="op" id="1676219">(</span><span class="ident" id="1676220">n</span><span class="op" id="1676221">)</span><span class="op" id="1676222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1676225">return</span>&nbsp;<span class="ident" id="1676232">n</span><br>
<span class="lineno"></span><span class="op" id="1676234">}</span>
</div>
</body>
</html>
