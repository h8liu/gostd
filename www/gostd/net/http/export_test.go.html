<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html" class="current">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7696039">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7696095">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7696149">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7696200">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="7696269">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696282">package</span>&nbsp;<span class="ident" id="7696290">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7696296">import</span>&nbsp;<span class="op" id="7696303">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7696306">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7696313">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7696324">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7696331">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7696334">func</span>&nbsp;<span class="ident" id="7696339">NewLoggingConn</span><span class="op" id="7696353">(</span><span class="ident" id="7696354">baseName</span>&nbsp;<span class="builtintype" id="7696363">string</span><span class="op" id="7696369">,</span>&nbsp;<span class="ident" id="7696371">c</span>&nbsp;<span class="ident" id="7696373">net</span><span class="op" id="7696376">.</span><span class="ident" id="7696377">Conn</span><span class="op" id="7696381">)</span>&nbsp;<span class="ident" id="7696383">net</span><span class="op" id="7696386">.</span><span class="ident" id="7696387">Conn</span>&nbsp;<span class="op" id="7696392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696395">return</span>&nbsp;<span class="ident" id="7696402">newLoggingConn</span><span class="op" id="7696416">(</span><span class="ident" id="7696417">baseName</span><span class="op" id="7696425">,</span>&nbsp;<span class="ident" id="7696427">c</span><span class="op" id="7696428">)</span><br>
<span class="lineno"></span><span class="op" id="7696430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7696433">var</span>&nbsp;<span class="ident" id="7696437">ExportAppendTime</span>&nbsp;<span class="op" id="7696454">=</span>&nbsp;<span class="ident" id="7696456">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696468">func</span>&nbsp;<span class="op" id="7696473">(</span><span class="ident" id="7696474">t</span>&nbsp;<span class="op" id="7696476">*</span><span class="ident" id="7696477">Transport</span><span class="op" id="7696486">)</span>&nbsp;<span class="ident" id="7696488">NumPendingRequestsForTesting</span><span class="op" id="7696516">(</span><span class="op" id="7696517">)</span>&nbsp;<span class="builtintype" id="7696519">int</span>&nbsp;<span class="op" id="7696523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7696526">t</span><span class="op" id="7696527">.</span><span class="ident" id="7696528">reqMu</span><span class="op" id="7696533">.</span><span class="ident" id="7696534">Lock</span><span class="op" id="7696538">(</span><span class="op" id="7696539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696542">defer</span>&nbsp;<span class="ident" id="7696548">t</span><span class="op" id="7696549">.</span><span class="ident" id="7696550">reqMu</span><span class="op" id="7696555">.</span><span class="ident" id="7696556">Unlock</span><span class="op" id="7696562">(</span><span class="op" id="7696563">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696566">return</span>&nbsp;<span class="builtinfunc" id="7696573">len</span><span class="op" id="7696576">(</span><span class="ident" id="7696577">t</span><span class="op" id="7696578">.</span><span class="ident" id="7696579">reqCanceler</span><span class="op" id="7696590">)</span><br>
<span class="lineno"></span><span class="op" id="7696592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696595">func</span>&nbsp;<span class="op" id="7696600">(</span><span class="ident" id="7696601">t</span>&nbsp;<span class="op" id="7696603">*</span><span class="ident" id="7696604">Transport</span><span class="op" id="7696613">)</span>&nbsp;<span class="ident" id="7696615">IdleConnKeysForTesting</span><span class="op" id="7696637">(</span><span class="op" id="7696638">)</span>&nbsp;<span class="op" id="7696640">(</span><span class="ident" id="7696641">keys</span>&nbsp;<span class="op" id="7696646">[</span><span class="op" id="7696647">]</span><span class="builtintype" id="7696648">string</span><span class="op" id="7696654">)</span>&nbsp;<span class="op" id="7696656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7696659">keys</span>&nbsp;<span class="op" id="7696664">=</span>&nbsp;<span class="builtinfunc" id="7696666">make</span><span class="op" id="7696670">(</span><span class="op" id="7696671">[</span><span class="op" id="7696672">]</span><span class="builtintype" id="7696673">string</span><span class="op" id="7696679">,</span>&nbsp;<span class="num" id="7696681">0</span><span class="op" id="7696682">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7696685">t</span><span class="op" id="7696686">.</span><span class="ident" id="7696687">idleMu</span><span class="op" id="7696693">.</span><span class="ident" id="7696694">Lock</span><span class="op" id="7696698">(</span><span class="op" id="7696699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696702">defer</span>&nbsp;<span class="ident" id="7696708">t</span><span class="op" id="7696709">.</span><span class="ident" id="7696710">idleMu</span><span class="op" id="7696716">.</span><span class="ident" id="7696717">Unlock</span><span class="op" id="7696723">(</span><span class="op" id="7696724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696727">if</span>&nbsp;<span class="ident" id="7696730">t</span><span class="op" id="7696731">.</span><span class="ident" id="7696732">idleConn</span>&nbsp;<span class="op" id="7696741">==</span>&nbsp;<span class="builtintype" id="7696744">nil</span>&nbsp;<span class="op" id="7696748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696752">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7696760">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696763">for</span>&nbsp;<span class="ident" id="7696767">key</span>&nbsp;<span class="op" id="7696771">:=</span>&nbsp;<span class="keyword" id="7696774">range</span>&nbsp;<span class="ident" id="7696780">t</span><span class="op" id="7696781">.</span><span class="ident" id="7696782">idleConn</span>&nbsp;<span class="op" id="7696791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7696795">keys</span>&nbsp;<span class="op" id="7696800">=</span>&nbsp;<span class="builtinfunc" id="7696802">append</span><span class="op" id="7696808">(</span><span class="ident" id="7696809">keys</span><span class="op" id="7696813">,</span>&nbsp;<span class="ident" id="7696815">key</span><span class="op" id="7696818">.</span><span class="ident" id="7696819">String</span><span class="op" id="7696825">(</span><span class="op" id="7696826">)</span><span class="op" id="7696827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7696830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696833">return</span><br>
<span class="lineno"></span><span class="op" id="7696840">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7696843">func</span>&nbsp;<span class="op" id="7696848">(</span><span class="ident" id="7696849">t</span>&nbsp;<span class="op" id="7696851">*</span><span class="ident" id="7696852">Transport</span><span class="op" id="7696861">)</span>&nbsp;<span class="ident" id="7696863">IdleConnCountForTesting</span><span class="op" id="7696886">(</span><span class="ident" id="7696887">cacheKey</span>&nbsp;<span class="builtintype" id="7696896">string</span><span class="op" id="7696902">)</span>&nbsp;<span class="builtintype" id="7696904">int</span>&nbsp;<span class="op" id="7696908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7696911">t</span><span class="op" id="7696912">.</span><span class="ident" id="7696913">idleMu</span><span class="op" id="7696919">.</span><span class="ident" id="7696920">Lock</span><span class="op" id="7696924">(</span><span class="op" id="7696925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696928">defer</span>&nbsp;<span class="ident" id="7696934">t</span><span class="op" id="7696935">.</span><span class="ident" id="7696936">idleMu</span><span class="op" id="7696942">.</span><span class="ident" id="7696943">Unlock</span><span class="op" id="7696949">(</span><span class="op" id="7696950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696953">if</span>&nbsp;<span class="ident" id="7696956">t</span><span class="op" id="7696957">.</span><span class="ident" id="7696958">idleConn</span>&nbsp;<span class="op" id="7696967">==</span>&nbsp;<span class="builtintype" id="7696970">nil</span>&nbsp;<span class="op" id="7696974">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696978">return</span>&nbsp;<span class="num" id="7696985">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7696988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7696991">for</span>&nbsp;<span class="ident" id="7696995">k</span><span class="op" id="7696996">,</span>&nbsp;<span class="ident" id="7696998">conns</span>&nbsp;<span class="op" id="7697004">:=</span>&nbsp;<span class="keyword" id="7697007">range</span>&nbsp;<span class="ident" id="7697013">t</span><span class="op" id="7697014">.</span><span class="ident" id="7697015">idleConn</span>&nbsp;<span class="op" id="7697024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697028">if</span>&nbsp;<span class="ident" id="7697031">k</span><span class="op" id="7697032">.</span><span class="ident" id="7697033">String</span><span class="op" id="7697039">(</span><span class="op" id="7697040">)</span>&nbsp;<span class="op" id="7697042">==</span>&nbsp;<span class="ident" id="7697045">cacheKey</span>&nbsp;<span class="op" id="7697054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697059">return</span>&nbsp;<span class="builtinfunc" id="7697066">len</span><span class="op" id="7697069">(</span><span class="ident" id="7697070">conns</span><span class="op" id="7697075">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7697079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7697082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697085">return</span>&nbsp;<span class="num" id="7697092">0</span><br>
<span class="lineno"></span><span class="op" id="7697094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7697097">func</span>&nbsp;<span class="op" id="7697102">(</span><span class="ident" id="7697103">t</span>&nbsp;<span class="op" id="7697105">*</span><span class="ident" id="7697106">Transport</span><span class="op" id="7697115">)</span>&nbsp;<span class="ident" id="7697117">IdleConnChMapSizeForTesting</span><span class="op" id="7697144">(</span><span class="op" id="7697145">)</span>&nbsp;<span class="builtintype" id="7697147">int</span>&nbsp;<span class="op" id="7697151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697154">t</span><span class="op" id="7697155">.</span><span class="ident" id="7697156">idleMu</span><span class="op" id="7697162">.</span><span class="ident" id="7697163">Lock</span><span class="op" id="7697167">(</span><span class="op" id="7697168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697171">defer</span>&nbsp;<span class="ident" id="7697177">t</span><span class="op" id="7697178">.</span><span class="ident" id="7697179">idleMu</span><span class="op" id="7697185">.</span><span class="ident" id="7697186">Unlock</span><span class="op" id="7697192">(</span><span class="op" id="7697193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697196">return</span>&nbsp;<span class="builtinfunc" id="7697203">len</span><span class="op" id="7697206">(</span><span class="ident" id="7697207">t</span><span class="op" id="7697208">.</span><span class="ident" id="7697209">idleConnCh</span><span class="op" id="7697219">)</span><br>
<span class="lineno"></span><span class="op" id="7697221">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7697224">func</span>&nbsp;<span class="op" id="7697229">(</span><span class="ident" id="7697230">t</span>&nbsp;<span class="op" id="7697232">*</span><span class="ident" id="7697233">Transport</span><span class="op" id="7697242">)</span>&nbsp;<span class="ident" id="7697244">IsIdleForTesting</span><span class="op" id="7697260">(</span><span class="op" id="7697261">)</span>&nbsp;<span class="builtintype" id="7697263">bool</span>&nbsp;<span class="op" id="7697268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697271">t</span><span class="op" id="7697272">.</span><span class="ident" id="7697273">idleMu</span><span class="op" id="7697279">.</span><span class="ident" id="7697280">Lock</span><span class="op" id="7697284">(</span><span class="op" id="7697285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697288">defer</span>&nbsp;<span class="ident" id="7697294">t</span><span class="op" id="7697295">.</span><span class="ident" id="7697296">idleMu</span><span class="op" id="7697302">.</span><span class="ident" id="7697303">Unlock</span><span class="op" id="7697309">(</span><span class="op" id="7697310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697313">return</span>&nbsp;<span class="ident" id="7697320">t</span><span class="op" id="7697321">.</span><span class="ident" id="7697322">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="7697331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697334">func</span>&nbsp;<span class="op" id="7697339">(</span><span class="ident" id="7697340">t</span>&nbsp;<span class="op" id="7697342">*</span><span class="ident" id="7697343">Transport</span><span class="op" id="7697352">)</span>&nbsp;<span class="ident" id="7697354">RequestIdleConnChForTesting</span><span class="op" id="7697381">(</span><span class="op" id="7697382">)</span>&nbsp;<span class="op" id="7697384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697387">t</span><span class="op" id="7697388">.</span><span class="ident" id="7697389">getIdleConnCh</span><span class="op" id="7697402">(</span><span class="ident" id="7697403">connectMethod</span><span class="op" id="7697416">{</span><span class="builtintype" id="7697417">nil</span><span class="op" id="7697420">,</span>&nbsp;<span class="string" id="7697422">&#34;http&#34;</span><span class="op" id="7697428">,</span>&nbsp;<span class="string" id="7697430">&#34;example.com&#34;</span><span class="op" id="7697443">}</span><span class="op" id="7697444">)</span><br>
<span class="lineno"></span><span class="op" id="7697446">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7697449">func</span>&nbsp;<span class="op" id="7697454">(</span><span class="ident" id="7697455">t</span>&nbsp;<span class="op" id="7697457">*</span><span class="ident" id="7697458">Transport</span><span class="op" id="7697467">)</span>&nbsp;<span class="ident" id="7697469">PutIdleTestConn</span><span class="op" id="7697484">(</span><span class="op" id="7697485">)</span>&nbsp;<span class="builtintype" id="7697487">bool</span>&nbsp;<span class="op" id="7697492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697495">c</span><span class="op" id="7697496">,</span>&nbsp;<span class="ident" id="7697498">_</span>&nbsp;<span class="op" id="7697500">:=</span>&nbsp;<span class="ident" id="7697503">net</span><span class="op" id="7697506">.</span><span class="ident" id="7697507">Pipe</span><span class="op" id="7697511">(</span><span class="op" id="7697512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697515">return</span>&nbsp;<span class="ident" id="7697522">t</span><span class="op" id="7697523">.</span><span class="ident" id="7697524">putIdleConn</span><span class="op" id="7697535">(</span><span class="op" id="7697536">&amp;</span><span class="ident" id="7697537">persistConn</span><span class="op" id="7697548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697552">t</span><span class="op" id="7697553">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697562">t</span><span class="op" id="7697563">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697567">conn</span><span class="op" id="7697571">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697577">c</span><span class="op" id="7697578">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7697598">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697609">closech</span><span class="op" id="7697616">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="7697619">make</span><span class="op" id="7697623">(</span><span class="keyword" id="7697624">chan</span>&nbsp;<span class="keyword" id="7697629">struct</span><span class="op" id="7697635">{</span><span class="op" id="7697636">}</span><span class="op" id="7697637">)</span><span class="op" id="7697638">,</span>&nbsp;<span class="comment" id="7697640">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697665">cacheKey</span><span class="op" id="7697673">:</span>&nbsp;<span class="ident" id="7697675">connectMethodKey</span><span class="op" id="7697691">{</span><span class="string" id="7697692">&#34;&#34;</span><span class="op" id="7697694">,</span>&nbsp;<span class="string" id="7697696">&#34;http&#34;</span><span class="op" id="7697702">,</span>&nbsp;<span class="string" id="7697704">&#34;example.com&#34;</span><span class="op" id="7697717">}</span><span class="op" id="7697718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7697721">}</span><span class="op" id="7697722">)</span><br>
<span class="lineno"></span><span class="op" id="7697724">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7697727">func</span>&nbsp;<span class="ident" id="7697732">NewTestTimeoutHandler</span><span class="op" id="7697753">(</span><span class="ident" id="7697754">handler</span>&nbsp;<span class="ident" id="7697762">Handler</span><span class="op" id="7697769">,</span>&nbsp;<span class="ident" id="7697771">ch</span>&nbsp;<span class="op" id="7697774">&lt;-</span><span class="keyword" id="7697776">chan</span>&nbsp;<span class="ident" id="7697781">time</span><span class="op" id="7697785">.</span><span class="ident" id="7697786">Time</span><span class="op" id="7697790">)</span>&nbsp;<span class="ident" id="7697792">Handler</span>&nbsp;<span class="op" id="7697800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697803">f</span>&nbsp;<span class="op" id="7697805">:=</span>&nbsp;<span class="keyword" id="7697808">func</span><span class="op" id="7697812">(</span><span class="op" id="7697813">)</span>&nbsp;<span class="op" id="7697815">&lt;-</span><span class="keyword" id="7697817">chan</span>&nbsp;<span class="ident" id="7697822">time</span><span class="op" id="7697826">.</span><span class="ident" id="7697827">Time</span>&nbsp;<span class="op" id="7697832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697836">return</span>&nbsp;<span class="ident" id="7697843">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7697847">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7697850">return</span>&nbsp;<span class="op" id="7697857">&amp;</span><span class="ident" id="7697858">timeoutHandler</span><span class="op" id="7697872">{</span><span class="ident" id="7697873">handler</span><span class="op" id="7697880">,</span>&nbsp;<span class="ident" id="7697882">f</span><span class="op" id="7697883">,</span>&nbsp;<span class="string" id="7697885">&#34;&#34;</span><span class="op" id="7697887">}</span><br>
<span class="lineno"></span><span class="op" id="7697889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697892">func</span>&nbsp;<span class="ident" id="7697897">ResetCachedEnvironment</span><span class="op" id="7697919">(</span><span class="op" id="7697920">)</span>&nbsp;<span class="op" id="7697922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697925">httpProxyEnv</span><span class="op" id="7697937">.</span><span class="ident" id="7697938">reset</span><span class="op" id="7697943">(</span><span class="op" id="7697944">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697947">httpsProxyEnv</span><span class="op" id="7697960">.</span><span class="ident" id="7697961">reset</span><span class="op" id="7697966">(</span><span class="op" id="7697967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7697970">noProxyEnv</span><span class="op" id="7697980">.</span><span class="ident" id="7697981">reset</span><span class="op" id="7697986">(</span><span class="op" id="7697987">)</span><br>
<span class="lineno"></span><span class="op" id="7697989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697992">var</span>&nbsp;<span class="ident" id="7697996">DefaultUserAgent</span>&nbsp;<span class="op" id="7698013">=</span>&nbsp;<span class="ident" id="7698015">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="7698033">func</span>&nbsp;<span class="ident" id="7698038">ExportRefererForURL</span><span class="op" id="7698057">(</span><span class="ident" id="7698058">lastReq</span><span class="op" id="7698065">,</span>&nbsp;<span class="ident" id="7698067">newReq</span>&nbsp;<span class="op" id="7698074">*</span><span class="ident" id="7698075">url</span><span class="op" id="7698078">.</span><span class="ident" id="7698079">URL</span><span class="op" id="7698082">)</span>&nbsp;<span class="builtintype" id="7698084">string</span>&nbsp;<span class="op" id="7698091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7698094">return</span>&nbsp;<span class="ident" id="7698101">refererForURL</span><span class="op" id="7698114">(</span><span class="ident" id="7698115">lastReq</span><span class="op" id="7698122">,</span>&nbsp;<span class="ident" id="7698124">newReq</span><span class="op" id="7698130">)</span><br>
<span class="lineno"></span><span class="op" id="7698132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="7698135">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="7698208">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="7698226">func</span>&nbsp;<span class="ident" id="7698231">SetPendingDialHooks</span><span class="op" id="7698250">(</span><span class="ident" id="7698251">before</span><span class="op" id="7698257">,</span>&nbsp;<span class="ident" id="7698259">after</span>&nbsp;<span class="keyword" id="7698265">func</span><span class="op" id="7698269">(</span><span class="op" id="7698270">)</span><span class="op" id="7698271">)</span>&nbsp;<span class="op" id="7698273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7698276">prePendingDial</span><span class="op" id="7698290">,</span>&nbsp;<span class="ident" id="7698292">postPendingDial</span>&nbsp;<span class="op" id="7698308">=</span>&nbsp;<span class="ident" id="7698310">before</span><span class="op" id="7698316">,</span>&nbsp;<span class="ident" id="7698318">after</span><br>
<span class="lineno"></span><span class="op" id="7698324">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7698327">var</span>&nbsp;<span class="ident" id="7698331">ExportServerNewConn</span>&nbsp;<span class="op" id="7698351">=</span>&nbsp;<span class="op" id="7698353">(</span><span class="op" id="7698354">*</span><span class="ident" id="7698355">Server</span><span class="op" id="7698361">)</span><span class="op" id="7698362">.</span><span class="ident" id="7698363">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7698372">var</span>&nbsp;<span class="ident" id="7698376">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="7698400">=</span>&nbsp;<span class="op" id="7698402">(</span><span class="op" id="7698403">*</span><span class="ident" id="7698404">conn</span><span class="op" id="7698408">)</span><span class="op" id="7698409">.</span><span class="ident" id="7698410">closeWriteAndWait</span>
</div>
</body>
</html>
