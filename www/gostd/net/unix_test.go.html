<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7941743">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7941799">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7941853">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7941904">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7941937">package</span>&nbsp;<span class="ident" id="7941945">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7941950">import</span>&nbsp;<span class="op" id="7941957">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941960">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941969">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941975">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941986">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941997">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942008">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942019">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7942026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7942029">func</span>&nbsp;<span class="ident" id="7942034">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="7942067">(</span><span class="ident" id="7942068">t</span>&nbsp;<span class="op" id="7942070">*</span><span class="ident" id="7942071">testing</span><span class="op" id="7942078">.</span><span class="ident" id="7942079">T</span><span class="op" id="7942080">)</span>&nbsp;<span class="op" id="7942082">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942085">addr</span>&nbsp;<span class="op" id="7942090">:=</span>&nbsp;<span class="ident" id="7942093">testUnixAddr</span><span class="op" id="7942105">(</span><span class="op" id="7942106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942109">la</span><span class="op" id="7942111">,</span>&nbsp;<span class="ident" id="7942113">err</span>&nbsp;<span class="op" id="7942117">:=</span>&nbsp;<span class="ident" id="7942120">ResolveUnixAddr</span><span class="op" id="7942135">(</span><span class="string" id="7942136">&#34;unixgram&#34;</span><span class="op" id="7942146">,</span>&nbsp;<span class="ident" id="7942148">addr</span><span class="op" id="7942152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942155">if</span>&nbsp;<span class="ident" id="7942158">err</span>&nbsp;<span class="op" id="7942162">!=</span>&nbsp;<span class="ident" id="7942165">nil</span>&nbsp;<span class="op" id="7942169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942173">t</span><span class="op" id="7942174">.</span><span class="ident" id="7942175">Fatalf</span><span class="op" id="7942181">(</span><span class="string" id="7942182">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7942210">,</span>&nbsp;<span class="ident" id="7942212">err</span><span class="op" id="7942215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942218">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942221">c</span><span class="op" id="7942222">,</span>&nbsp;<span class="ident" id="7942224">err</span>&nbsp;<span class="op" id="7942228">:=</span>&nbsp;<span class="ident" id="7942231">ListenUnixgram</span><span class="op" id="7942245">(</span><span class="string" id="7942246">&#34;unixgram&#34;</span><span class="op" id="7942256">,</span>&nbsp;<span class="ident" id="7942258">la</span><span class="op" id="7942260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942263">if</span>&nbsp;<span class="ident" id="7942266">err</span>&nbsp;<span class="op" id="7942270">!=</span>&nbsp;<span class="ident" id="7942273">nil</span>&nbsp;<span class="op" id="7942277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942281">t</span><span class="op" id="7942282">.</span><span class="ident" id="7942283">Fatalf</span><span class="op" id="7942289">(</span><span class="string" id="7942290">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7942317">,</span>&nbsp;<span class="ident" id="7942319">err</span><span class="op" id="7942322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942328">defer</span>&nbsp;<span class="keyword" id="7942334">func</span><span class="op" id="7942338">(</span><span class="op" id="7942339">)</span>&nbsp;<span class="op" id="7942341">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942345">c</span><span class="op" id="7942346">.</span><span class="ident" id="7942347">Close</span><span class="op" id="7942352">(</span><span class="op" id="7942353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942357">os</span><span class="op" id="7942359">.</span><span class="ident" id="7942360">Remove</span><span class="op" id="7942366">(</span><span class="ident" id="7942367">addr</span><span class="op" id="7942371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942374">}</span><span class="op" id="7942375">(</span><span class="op" id="7942376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942380">off</span>&nbsp;<span class="op" id="7942384">:=</span>&nbsp;<span class="builtinfunc" id="7942387">make</span><span class="op" id="7942391">(</span><span class="keyword" id="7942392">chan</span>&nbsp;<span class="builtintype" id="7942397">bool</span><span class="op" id="7942401">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942404">data</span>&nbsp;<span class="op" id="7942409">:=</span>&nbsp;<span class="op" id="7942412">[</span><span class="num" id="7942413">5</span><span class="op" id="7942414">]</span><span class="builtintype" id="7942415">byte</span><span class="op" id="7942419">{</span><span class="num" id="7942420">1</span><span class="op" id="7942421">,</span>&nbsp;<span class="num" id="7942423">2</span><span class="op" id="7942424">,</span>&nbsp;<span class="num" id="7942426">3</span><span class="op" id="7942427">,</span>&nbsp;<span class="num" id="7942429">4</span><span class="op" id="7942430">,</span>&nbsp;<span class="num" id="7942432">5</span><span class="op" id="7942433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942436">go</span>&nbsp;<span class="keyword" id="7942439">func</span><span class="op" id="7942443">(</span><span class="op" id="7942444">)</span>&nbsp;<span class="op" id="7942446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942450">defer</span>&nbsp;<span class="keyword" id="7942456">func</span><span class="op" id="7942460">(</span><span class="op" id="7942461">)</span>&nbsp;<span class="op" id="7942463">{</span>&nbsp;<span class="ident" id="7942465">off</span>&nbsp;<span class="op" id="7942469">&lt;-</span>&nbsp;<span class="builtintype" id="7942472">true</span>&nbsp;<span class="op" id="7942477">}</span><span class="op" id="7942478">(</span><span class="op" id="7942479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942483">s</span><span class="op" id="7942484">,</span>&nbsp;<span class="ident" id="7942486">err</span>&nbsp;<span class="op" id="7942490">:=</span>&nbsp;<span class="ident" id="7942493">syscall</span><span class="op" id="7942500">.</span><span class="ident" id="7942501">Socket</span><span class="op" id="7942507">(</span><span class="ident" id="7942508">syscall</span><span class="op" id="7942515">.</span><span class="ident" id="7942516">AF_UNIX</span><span class="op" id="7942523">,</span>&nbsp;<span class="ident" id="7942525">syscall</span><span class="op" id="7942532">.</span><span class="ident" id="7942533">SOCK_DGRAM</span><span class="op" id="7942543">,</span>&nbsp;<span class="num" id="7942545">0</span><span class="op" id="7942546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942550">if</span>&nbsp;<span class="ident" id="7942553">err</span>&nbsp;<span class="op" id="7942557">!=</span>&nbsp;<span class="ident" id="7942560">nil</span>&nbsp;<span class="op" id="7942564">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942569">t</span><span class="op" id="7942570">.</span><span class="ident" id="7942571">Errorf</span><span class="op" id="7942577">(</span><span class="string" id="7942578">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7942605">,</span>&nbsp;<span class="ident" id="7942607">err</span><span class="op" id="7942610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942615">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942628">defer</span>&nbsp;<span class="ident" id="7942634">syscall</span><span class="op" id="7942641">.</span><span class="ident" id="7942642">Close</span><span class="op" id="7942647">(</span><span class="ident" id="7942648">s</span><span class="op" id="7942649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942653">rsa</span>&nbsp;<span class="op" id="7942657">:=</span>&nbsp;<span class="op" id="7942660">&amp;</span><span class="ident" id="7942661">syscall</span><span class="op" id="7942668">.</span><span class="ident" id="7942669">SockaddrUnix</span><span class="op" id="7942681">{</span><span class="ident" id="7942682">Name</span><span class="op" id="7942686">:</span>&nbsp;<span class="ident" id="7942688">addr</span><span class="op" id="7942692">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942696">if</span>&nbsp;<span class="ident" id="7942699">err</span>&nbsp;<span class="op" id="7942703">:=</span>&nbsp;<span class="ident" id="7942706">syscall</span><span class="op" id="7942713">.</span><span class="ident" id="7942714">Sendto</span><span class="op" id="7942720">(</span><span class="ident" id="7942721">s</span><span class="op" id="7942722">,</span>&nbsp;<span class="ident" id="7942724">data</span><span class="op" id="7942728">[</span><span class="op" id="7942729">:</span><span class="op" id="7942730">]</span><span class="op" id="7942731">,</span>&nbsp;<span class="num" id="7942733">0</span><span class="op" id="7942734">,</span>&nbsp;<span class="ident" id="7942736">rsa</span><span class="op" id="7942739">)</span><span class="op" id="7942740">;</span>&nbsp;<span class="ident" id="7942742">err</span>&nbsp;<span class="op" id="7942746">!=</span>&nbsp;<span class="ident" id="7942749">nil</span>&nbsp;<span class="op" id="7942753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942758">t</span><span class="op" id="7942759">.</span><span class="ident" id="7942760">Errorf</span><span class="op" id="7942766">(</span><span class="string" id="7942767">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7942794">,</span>&nbsp;<span class="ident" id="7942796">err</span><span class="op" id="7942799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942804">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942816">}</span><span class="op" id="7942817">(</span><span class="op" id="7942818">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942822">&lt;-</span><span class="ident" id="7942824">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942829">b</span>&nbsp;<span class="op" id="7942831">:=</span>&nbsp;<span class="builtinfunc" id="7942834">make</span><span class="op" id="7942838">(</span><span class="op" id="7942839">[</span><span class="op" id="7942840">]</span><span class="builtintype" id="7942841">byte</span><span class="op" id="7942845">,</span>&nbsp;<span class="num" id="7942847">64</span><span class="op" id="7942849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942852">c</span><span class="op" id="7942853">.</span><span class="ident" id="7942854">SetReadDeadline</span><span class="op" id="7942869">(</span><span class="ident" id="7942870">time</span><span class="op" id="7942874">.</span><span class="ident" id="7942875">Now</span><span class="op" id="7942878">(</span><span class="op" id="7942879">)</span><span class="op" id="7942880">.</span><span class="ident" id="7942881">Add</span><span class="op" id="7942884">(</span><span class="num" id="7942885">100</span>&nbsp;<span class="op" id="7942889">*</span>&nbsp;<span class="ident" id="7942891">time</span><span class="op" id="7942895">.</span><span class="ident" id="7942896">Millisecond</span><span class="op" id="7942907">)</span><span class="op" id="7942908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942911">n</span><span class="op" id="7942912">,</span>&nbsp;<span class="ident" id="7942914">from</span><span class="op" id="7942918">,</span>&nbsp;<span class="ident" id="7942920">err</span>&nbsp;<span class="op" id="7942924">:=</span>&nbsp;<span class="ident" id="7942927">c</span><span class="op" id="7942928">.</span><span class="ident" id="7942929">ReadFrom</span><span class="op" id="7942937">(</span><span class="ident" id="7942938">b</span><span class="op" id="7942939">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942942">if</span>&nbsp;<span class="ident" id="7942945">err</span>&nbsp;<span class="op" id="7942949">!=</span>&nbsp;<span class="ident" id="7942952">nil</span>&nbsp;<span class="op" id="7942956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942960">t</span><span class="op" id="7942961">.</span><span class="ident" id="7942962">Fatalf</span><span class="op" id="7942968">(</span><span class="string" id="7942969">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7942999">,</span>&nbsp;<span class="ident" id="7943001">err</span><span class="op" id="7943004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943010">if</span>&nbsp;<span class="ident" id="7943013">from</span>&nbsp;<span class="op" id="7943018">!=</span>&nbsp;<span class="ident" id="7943021">nil</span>&nbsp;<span class="op" id="7943025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943029">t</span><span class="op" id="7943030">.</span><span class="ident" id="7943031">Fatalf</span><span class="op" id="7943037">(</span><span class="string" id="7943038">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="7943062">,</span>&nbsp;<span class="ident" id="7943064">from</span><span class="op" id="7943068">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943074">if</span>&nbsp;<span class="op" id="7943077">!</span><span class="ident" id="7943078">bytes</span><span class="op" id="7943083">.</span><span class="ident" id="7943084">Equal</span><span class="op" id="7943089">(</span><span class="ident" id="7943090">b</span><span class="op" id="7943091">[</span><span class="op" id="7943092">:</span><span class="ident" id="7943093">n</span><span class="op" id="7943094">]</span><span class="op" id="7943095">,</span>&nbsp;<span class="ident" id="7943097">data</span><span class="op" id="7943101">[</span><span class="op" id="7943102">:</span><span class="op" id="7943103">]</span><span class="op" id="7943104">)</span>&nbsp;<span class="op" id="7943106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943110">t</span><span class="op" id="7943111">.</span><span class="ident" id="7943112">Fatalf</span><span class="op" id="7943118">(</span><span class="string" id="7943119">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7943136">,</span>&nbsp;<span class="ident" id="7943138">b</span><span class="op" id="7943139">[</span><span class="op" id="7943140">:</span><span class="ident" id="7943141">n</span><span class="op" id="7943142">]</span><span class="op" id="7943143">,</span>&nbsp;<span class="ident" id="7943145">data</span><span class="op" id="7943149">[</span><span class="op" id="7943150">:</span><span class="op" id="7943151">]</span><span class="op" id="7943152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943155">}</span><br>
<span class="lineno"></span><span class="op" id="7943157">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7943160">func</span>&nbsp;<span class="ident" id="7943165">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="7943200">(</span><span class="ident" id="7943201">t</span>&nbsp;<span class="op" id="7943203">*</span><span class="ident" id="7943204">testing</span><span class="op" id="7943211">.</span><span class="ident" id="7943212">T</span><span class="op" id="7943213">)</span>&nbsp;<span class="op" id="7943215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7943218">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7943275">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943341">addr</span>&nbsp;<span class="op" id="7943346">:=</span>&nbsp;<span class="ident" id="7943349">testUnixAddr</span><span class="op" id="7943361">(</span><span class="op" id="7943362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943365">la</span><span class="op" id="7943367">,</span>&nbsp;<span class="ident" id="7943369">err</span>&nbsp;<span class="op" id="7943373">:=</span>&nbsp;<span class="ident" id="7943376">ResolveUnixAddr</span><span class="op" id="7943391">(</span><span class="string" id="7943392">&#34;unixgram&#34;</span><span class="op" id="7943402">,</span>&nbsp;<span class="ident" id="7943404">addr</span><span class="op" id="7943408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943411">if</span>&nbsp;<span class="ident" id="7943414">err</span>&nbsp;<span class="op" id="7943418">!=</span>&nbsp;<span class="ident" id="7943421">nil</span>&nbsp;<span class="op" id="7943425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943429">t</span><span class="op" id="7943430">.</span><span class="ident" id="7943431">Fatalf</span><span class="op" id="7943437">(</span><span class="string" id="7943438">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943466">,</span>&nbsp;<span class="ident" id="7943468">err</span><span class="op" id="7943471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943474">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943477">c</span><span class="op" id="7943478">,</span>&nbsp;<span class="ident" id="7943480">err</span>&nbsp;<span class="op" id="7943484">:=</span>&nbsp;<span class="ident" id="7943487">ListenUnixgram</span><span class="op" id="7943501">(</span><span class="string" id="7943502">&#34;unixgram&#34;</span><span class="op" id="7943512">,</span>&nbsp;<span class="ident" id="7943514">la</span><span class="op" id="7943516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943519">if</span>&nbsp;<span class="ident" id="7943522">err</span>&nbsp;<span class="op" id="7943526">!=</span>&nbsp;<span class="ident" id="7943529">nil</span>&nbsp;<span class="op" id="7943533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943537">t</span><span class="op" id="7943538">.</span><span class="ident" id="7943539">Fatalf</span><span class="op" id="7943545">(</span><span class="string" id="7943546">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943573">,</span>&nbsp;<span class="ident" id="7943575">err</span><span class="op" id="7943578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943584">defer</span>&nbsp;<span class="keyword" id="7943590">func</span><span class="op" id="7943594">(</span><span class="op" id="7943595">)</span>&nbsp;<span class="op" id="7943597">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943601">c</span><span class="op" id="7943602">.</span><span class="ident" id="7943603">Close</span><span class="op" id="7943608">(</span><span class="op" id="7943609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943613">os</span><span class="op" id="7943615">.</span><span class="ident" id="7943616">Remove</span><span class="op" id="7943622">(</span><span class="ident" id="7943623">addr</span><span class="op" id="7943627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943630">}</span><span class="op" id="7943631">(</span><span class="op" id="7943632">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943636">off</span>&nbsp;<span class="op" id="7943640">:=</span>&nbsp;<span class="builtinfunc" id="7943643">make</span><span class="op" id="7943647">(</span><span class="keyword" id="7943648">chan</span>&nbsp;<span class="builtintype" id="7943653">bool</span><span class="op" id="7943657">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943660">go</span>&nbsp;<span class="keyword" id="7943663">func</span><span class="op" id="7943667">(</span><span class="op" id="7943668">)</span>&nbsp;<span class="op" id="7943670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943674">defer</span>&nbsp;<span class="keyword" id="7943680">func</span><span class="op" id="7943684">(</span><span class="op" id="7943685">)</span>&nbsp;<span class="op" id="7943687">{</span>&nbsp;<span class="ident" id="7943689">off</span>&nbsp;<span class="op" id="7943693">&lt;-</span>&nbsp;<span class="builtintype" id="7943696">true</span>&nbsp;<span class="op" id="7943701">}</span><span class="op" id="7943702">(</span><span class="op" id="7943703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943707">c</span><span class="op" id="7943708">,</span>&nbsp;<span class="ident" id="7943710">err</span>&nbsp;<span class="op" id="7943714">:=</span>&nbsp;<span class="ident" id="7943717">DialUnix</span><span class="op" id="7943725">(</span><span class="string" id="7943726">&#34;unixgram&#34;</span><span class="op" id="7943736">,</span>&nbsp;<span class="ident" id="7943738">nil</span><span class="op" id="7943741">,</span>&nbsp;<span class="ident" id="7943743">la</span><span class="op" id="7943745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943749">if</span>&nbsp;<span class="ident" id="7943752">err</span>&nbsp;<span class="op" id="7943756">!=</span>&nbsp;<span class="ident" id="7943759">nil</span>&nbsp;<span class="op" id="7943763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943768">t</span><span class="op" id="7943769">.</span><span class="ident" id="7943770">Errorf</span><span class="op" id="7943776">(</span><span class="string" id="7943777">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943798">,</span>&nbsp;<span class="ident" id="7943800">err</span><span class="op" id="7943803">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943808">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943821">defer</span>&nbsp;<span class="ident" id="7943827">c</span><span class="op" id="7943828">.</span><span class="ident" id="7943829">Close</span><span class="op" id="7943834">(</span><span class="op" id="7943835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943839">if</span>&nbsp;<span class="ident" id="7943842">_</span><span class="op" id="7943843">,</span>&nbsp;<span class="ident" id="7943845">err</span>&nbsp;<span class="op" id="7943849">:=</span>&nbsp;<span class="ident" id="7943852">c</span><span class="op" id="7943853">.</span><span class="ident" id="7943854">Write</span><span class="op" id="7943859">(</span><span class="op" id="7943860">[</span><span class="op" id="7943861">]</span><span class="builtintype" id="7943862">byte</span><span class="op" id="7943866">{</span><span class="num" id="7943867">1</span><span class="op" id="7943868">,</span>&nbsp;<span class="num" id="7943870">2</span><span class="op" id="7943871">,</span>&nbsp;<span class="num" id="7943873">3</span><span class="op" id="7943874">,</span>&nbsp;<span class="num" id="7943876">4</span><span class="op" id="7943877">,</span>&nbsp;<span class="num" id="7943879">5</span><span class="op" id="7943880">}</span><span class="op" id="7943881">)</span><span class="op" id="7943882">;</span>&nbsp;<span class="ident" id="7943884">err</span>&nbsp;<span class="op" id="7943888">!=</span>&nbsp;<span class="ident" id="7943891">nil</span>&nbsp;<span class="op" id="7943895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943900">t</span><span class="op" id="7943901">.</span><span class="ident" id="7943902">Errorf</span><span class="op" id="7943908">(</span><span class="string" id="7943909">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943936">,</span>&nbsp;<span class="ident" id="7943938">err</span><span class="op" id="7943941">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943946">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943958">}</span><span class="op" id="7943959">(</span><span class="op" id="7943960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943964">&lt;-</span><span class="ident" id="7943966">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943971">c</span><span class="op" id="7943972">.</span><span class="ident" id="7943973">SetReadDeadline</span><span class="op" id="7943988">(</span><span class="ident" id="7943989">time</span><span class="op" id="7943993">.</span><span class="ident" id="7943994">Now</span><span class="op" id="7943997">(</span><span class="op" id="7943998">)</span><span class="op" id="7943999">.</span><span class="ident" id="7944000">Add</span><span class="op" id="7944003">(</span><span class="num" id="7944004">100</span>&nbsp;<span class="op" id="7944008">*</span>&nbsp;<span class="ident" id="7944010">time</span><span class="op" id="7944014">.</span><span class="ident" id="7944015">Millisecond</span><span class="op" id="7944026">)</span><span class="op" id="7944027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944030">_</span><span class="op" id="7944031">,</span>&nbsp;<span class="ident" id="7944033">from</span><span class="op" id="7944037">,</span>&nbsp;<span class="ident" id="7944039">err</span>&nbsp;<span class="op" id="7944043">:=</span>&nbsp;<span class="ident" id="7944046">c</span><span class="op" id="7944047">.</span><span class="ident" id="7944048">ReadFrom</span><span class="op" id="7944056">(</span><span class="ident" id="7944057">nil</span><span class="op" id="7944060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944063">if</span>&nbsp;<span class="ident" id="7944066">err</span>&nbsp;<span class="op" id="7944070">!=</span>&nbsp;<span class="ident" id="7944073">nil</span>&nbsp;<span class="op" id="7944077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944081">t</span><span class="op" id="7944082">.</span><span class="ident" id="7944083">Fatalf</span><span class="op" id="7944089">(</span><span class="string" id="7944090">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944120">,</span>&nbsp;<span class="ident" id="7944122">err</span><span class="op" id="7944125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944128">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944131">if</span>&nbsp;<span class="ident" id="7944134">from</span>&nbsp;<span class="op" id="7944139">!=</span>&nbsp;<span class="ident" id="7944142">nil</span>&nbsp;<span class="op" id="7944146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944150">t</span><span class="op" id="7944151">.</span><span class="ident" id="7944152">Fatalf</span><span class="op" id="7944158">(</span><span class="string" id="7944159">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="7944183">,</span>&nbsp;<span class="ident" id="7944185">from</span><span class="op" id="7944189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944192">}</span><br>
<span class="lineno"></span><span class="op" id="7944194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7944197">func</span>&nbsp;<span class="ident" id="7944202">TestUnixgramAutobind</span><span class="op" id="7944222">(</span><span class="ident" id="7944223">t</span>&nbsp;<span class="op" id="7944225">*</span><span class="ident" id="7944226">testing</span><span class="op" id="7944233">.</span><span class="ident" id="7944234">T</span><span class="op" id="7944235">)</span>&nbsp;<span class="op" id="7944237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944240">if</span>&nbsp;<span class="ident" id="7944243">runtime</span><span class="op" id="7944250">.</span><span class="ident" id="7944251">GOOS</span>&nbsp;<span class="op" id="7944256">!=</span>&nbsp;<span class="string" id="7944259">&#34;linux&#34;</span>&nbsp;<span class="op" id="7944267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944271">t</span><span class="op" id="7944272">.</span><span class="ident" id="7944273">Skip</span><span class="op" id="7944277">(</span><span class="string" id="7944278">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="7944312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944319">laddr</span>&nbsp;<span class="op" id="7944325">:=</span>&nbsp;<span class="op" id="7944328">&amp;</span><span class="ident" id="7944329">UnixAddr</span><span class="op" id="7944337">{</span><span class="ident" id="7944338">Name</span><span class="op" id="7944342">:</span>&nbsp;<span class="string" id="7944344">&#34;&#34;</span><span class="op" id="7944346">,</span>&nbsp;<span class="ident" id="7944348">Net</span><span class="op" id="7944351">:</span>&nbsp;<span class="string" id="7944353">&#34;unixgram&#34;</span><span class="op" id="7944363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944366">c1</span><span class="op" id="7944368">,</span>&nbsp;<span class="ident" id="7944370">err</span>&nbsp;<span class="op" id="7944374">:=</span>&nbsp;<span class="ident" id="7944377">ListenUnixgram</span><span class="op" id="7944391">(</span><span class="string" id="7944392">&#34;unixgram&#34;</span><span class="op" id="7944402">,</span>&nbsp;<span class="ident" id="7944404">laddr</span><span class="op" id="7944409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944412">if</span>&nbsp;<span class="ident" id="7944415">err</span>&nbsp;<span class="op" id="7944419">!=</span>&nbsp;<span class="ident" id="7944422">nil</span>&nbsp;<span class="op" id="7944426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944430">t</span><span class="op" id="7944431">.</span><span class="ident" id="7944432">Fatalf</span><span class="op" id="7944438">(</span><span class="string" id="7944439">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944466">,</span>&nbsp;<span class="ident" id="7944468">err</span><span class="op" id="7944471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944474">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944477">defer</span>&nbsp;<span class="ident" id="7944483">c1</span><span class="op" id="7944485">.</span><span class="ident" id="7944486">Close</span><span class="op" id="7944491">(</span><span class="op" id="7944492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7944496">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944530">autoAddr</span>&nbsp;<span class="op" id="7944539">:=</span>&nbsp;<span class="ident" id="7944542">c1</span><span class="op" id="7944544">.</span><span class="ident" id="7944545">LocalAddr</span><span class="op" id="7944554">(</span><span class="op" id="7944555">)</span><span class="op" id="7944556">.</span><span class="op" id="7944557">(</span><span class="op" id="7944558">*</span><span class="ident" id="7944559">UnixAddr</span><span class="op" id="7944567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944570">if</span>&nbsp;<span class="builtinfunc" id="7944573">len</span><span class="op" id="7944576">(</span><span class="ident" id="7944577">autoAddr</span><span class="op" id="7944585">.</span><span class="ident" id="7944586">Name</span><span class="op" id="7944590">)</span>&nbsp;<span class="op" id="7944592">&lt;=</span>&nbsp;<span class="num" id="7944595">1</span>&nbsp;<span class="op" id="7944597">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944601">t</span><span class="op" id="7944602">.</span><span class="ident" id="7944603">Fatalf</span><span class="op" id="7944609">(</span><span class="string" id="7944610">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="7944640">,</span>&nbsp;<span class="ident" id="7944642">autoAddr</span><span class="op" id="7944650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944656">if</span>&nbsp;<span class="ident" id="7944659">autoAddr</span><span class="op" id="7944667">.</span><span class="ident" id="7944668">Name</span><span class="op" id="7944672">[</span><span class="num" id="7944673">0</span><span class="op" id="7944674">]</span>&nbsp;<span class="op" id="7944676">!=</span>&nbsp;<span class="string" id="7944679">&#39;@&#39;</span>&nbsp;<span class="op" id="7944683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944687">t</span><span class="op" id="7944688">.</span><span class="ident" id="7944689">Fatalf</span><span class="op" id="7944695">(</span><span class="string" id="7944696">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="7944726">,</span>&nbsp;<span class="ident" id="7944728">autoAddr</span><span class="op" id="7944736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944739">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944743">c2</span><span class="op" id="7944745">,</span>&nbsp;<span class="ident" id="7944747">err</span>&nbsp;<span class="op" id="7944751">:=</span>&nbsp;<span class="ident" id="7944754">DialUnix</span><span class="op" id="7944762">(</span><span class="string" id="7944763">&#34;unixgram&#34;</span><span class="op" id="7944773">,</span>&nbsp;<span class="ident" id="7944775">nil</span><span class="op" id="7944778">,</span>&nbsp;<span class="ident" id="7944780">autoAddr</span><span class="op" id="7944788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944791">if</span>&nbsp;<span class="ident" id="7944794">err</span>&nbsp;<span class="op" id="7944798">!=</span>&nbsp;<span class="ident" id="7944801">nil</span>&nbsp;<span class="op" id="7944805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944809">t</span><span class="op" id="7944810">.</span><span class="ident" id="7944811">Fatalf</span><span class="op" id="7944817">(</span><span class="string" id="7944818">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944839">,</span>&nbsp;<span class="ident" id="7944841">err</span><span class="op" id="7944844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944847">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944850">defer</span>&nbsp;<span class="ident" id="7944856">c2</span><span class="op" id="7944858">.</span><span class="ident" id="7944859">Close</span><span class="op" id="7944864">(</span><span class="op" id="7944865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944869">if</span>&nbsp;<span class="op" id="7944872">!</span><span class="ident" id="7944873">reflect</span><span class="op" id="7944880">.</span><span class="ident" id="7944881">DeepEqual</span><span class="op" id="7944890">(</span><span class="ident" id="7944891">c1</span><span class="op" id="7944893">.</span><span class="ident" id="7944894">LocalAddr</span><span class="op" id="7944903">(</span><span class="op" id="7944904">)</span><span class="op" id="7944905">,</span>&nbsp;<span class="ident" id="7944907">c2</span><span class="op" id="7944909">.</span><span class="ident" id="7944910">RemoteAddr</span><span class="op" id="7944920">(</span><span class="op" id="7944921">)</span><span class="op" id="7944922">)</span>&nbsp;<span class="op" id="7944924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944928">t</span><span class="op" id="7944929">.</span><span class="ident" id="7944930">Fatalf</span><span class="op" id="7944936">(</span><span class="string" id="7944937">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7944975">,</span>&nbsp;<span class="ident" id="7944977">c1</span><span class="op" id="7944979">.</span><span class="ident" id="7944980">LocalAddr</span><span class="op" id="7944989">(</span><span class="op" id="7944990">)</span><span class="op" id="7944991">,</span>&nbsp;<span class="ident" id="7944993">c2</span><span class="op" id="7944995">.</span><span class="ident" id="7944996">RemoteAddr</span><span class="op" id="7945006">(</span><span class="op" id="7945007">)</span><span class="op" id="7945008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945011">}</span><br>
<span class="lineno">140</span><span class="op" id="7945013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7945016">func</span>&nbsp;<span class="ident" id="7945021">TestUnixAutobindClose</span><span class="op" id="7945042">(</span><span class="ident" id="7945043">t</span>&nbsp;<span class="op" id="7945045">*</span><span class="ident" id="7945046">testing</span><span class="op" id="7945053">.</span><span class="ident" id="7945054">T</span><span class="op" id="7945055">)</span>&nbsp;<span class="op" id="7945057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945060">if</span>&nbsp;<span class="ident" id="7945063">runtime</span><span class="op" id="7945070">.</span><span class="ident" id="7945071">GOOS</span>&nbsp;<span class="op" id="7945076">!=</span>&nbsp;<span class="string" id="7945079">&#34;linux&#34;</span>&nbsp;<span class="op" id="7945087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945091">t</span><span class="op" id="7945092">.</span><span class="ident" id="7945093">Skip</span><span class="op" id="7945097">(</span><span class="string" id="7945098">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="7945132">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945138">laddr</span>&nbsp;<span class="op" id="7945144">:=</span>&nbsp;<span class="op" id="7945147">&amp;</span><span class="ident" id="7945148">UnixAddr</span><span class="op" id="7945156">{</span><span class="ident" id="7945157">Name</span><span class="op" id="7945161">:</span>&nbsp;<span class="string" id="7945163">&#34;&#34;</span><span class="op" id="7945165">,</span>&nbsp;<span class="ident" id="7945167">Net</span><span class="op" id="7945170">:</span>&nbsp;<span class="string" id="7945172">&#34;unix&#34;</span><span class="op" id="7945178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945181">ln</span><span class="op" id="7945183">,</span>&nbsp;<span class="ident" id="7945185">err</span>&nbsp;<span class="op" id="7945189">:=</span>&nbsp;<span class="ident" id="7945192">ListenUnix</span><span class="op" id="7945202">(</span><span class="string" id="7945203">&#34;unix&#34;</span><span class="op" id="7945209">,</span>&nbsp;<span class="ident" id="7945211">laddr</span><span class="op" id="7945216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945219">if</span>&nbsp;<span class="ident" id="7945222">err</span>&nbsp;<span class="op" id="7945226">!=</span>&nbsp;<span class="ident" id="7945229">nil</span>&nbsp;<span class="op" id="7945233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945237">t</span><span class="op" id="7945238">.</span><span class="ident" id="7945239">Fatalf</span><span class="op" id="7945245">(</span><span class="string" id="7945246">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945269">,</span>&nbsp;<span class="ident" id="7945271">err</span><span class="op" id="7945274">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945280">ln</span><span class="op" id="7945282">.</span><span class="ident" id="7945283">Close</span><span class="op" id="7945288">(</span><span class="op" id="7945289">)</span><br>
<span class="lineno"></span><span class="op" id="7945291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7945294">func</span>&nbsp;<span class="ident" id="7945299">TestUnixgramWrite</span><span class="op" id="7945316">(</span><span class="ident" id="7945317">t</span>&nbsp;<span class="op" id="7945319">*</span><span class="ident" id="7945320">testing</span><span class="op" id="7945327">.</span><span class="ident" id="7945328">T</span><span class="op" id="7945329">)</span>&nbsp;<span class="op" id="7945331">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945334">addr</span>&nbsp;<span class="op" id="7945339">:=</span>&nbsp;<span class="ident" id="7945342">testUnixAddr</span><span class="op" id="7945354">(</span><span class="op" id="7945355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945358">laddr</span><span class="op" id="7945363">,</span>&nbsp;<span class="ident" id="7945365">err</span>&nbsp;<span class="op" id="7945369">:=</span>&nbsp;<span class="ident" id="7945372">ResolveUnixAddr</span><span class="op" id="7945387">(</span><span class="string" id="7945388">&#34;unixgram&#34;</span><span class="op" id="7945398">,</span>&nbsp;<span class="ident" id="7945400">addr</span><span class="op" id="7945404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945407">if</span>&nbsp;<span class="ident" id="7945410">err</span>&nbsp;<span class="op" id="7945414">!=</span>&nbsp;<span class="ident" id="7945417">nil</span>&nbsp;<span class="op" id="7945421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945425">t</span><span class="op" id="7945426">.</span><span class="ident" id="7945427">Fatalf</span><span class="op" id="7945433">(</span><span class="string" id="7945434">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945462">,</span>&nbsp;<span class="ident" id="7945464">err</span><span class="op" id="7945467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945470">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945473">c</span><span class="op" id="7945474">,</span>&nbsp;<span class="ident" id="7945476">err</span>&nbsp;<span class="op" id="7945480">:=</span>&nbsp;<span class="ident" id="7945483">ListenPacket</span><span class="op" id="7945495">(</span><span class="string" id="7945496">&#34;unixgram&#34;</span><span class="op" id="7945506">,</span>&nbsp;<span class="ident" id="7945508">addr</span><span class="op" id="7945512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945515">if</span>&nbsp;<span class="ident" id="7945518">err</span>&nbsp;<span class="op" id="7945522">!=</span>&nbsp;<span class="ident" id="7945525">nil</span>&nbsp;<span class="op" id="7945529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945533">t</span><span class="op" id="7945534">.</span><span class="ident" id="7945535">Fatalf</span><span class="op" id="7945541">(</span><span class="string" id="7945542">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945567">,</span>&nbsp;<span class="ident" id="7945569">err</span><span class="op" id="7945572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945578">defer</span>&nbsp;<span class="ident" id="7945584">os</span><span class="op" id="7945586">.</span><span class="ident" id="7945587">Remove</span><span class="op" id="7945593">(</span><span class="ident" id="7945594">addr</span><span class="op" id="7945598">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945601">defer</span>&nbsp;<span class="ident" id="7945607">c</span><span class="op" id="7945608">.</span><span class="ident" id="7945609">Close</span><span class="op" id="7945614">(</span><span class="op" id="7945615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945619">testUnixgramWriteConn</span><span class="op" id="7945640">(</span><span class="ident" id="7945641">t</span><span class="op" id="7945642">,</span>&nbsp;<span class="ident" id="7945644">laddr</span><span class="op" id="7945649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945652">testUnixgramWritePacketConn</span><span class="op" id="7945679">(</span><span class="ident" id="7945680">t</span><span class="op" id="7945681">,</span>&nbsp;<span class="ident" id="7945683">laddr</span><span class="op" id="7945688">)</span><br>
<span class="lineno"></span><span class="op" id="7945690">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7945693">func</span>&nbsp;<span class="ident" id="7945698">testUnixgramWriteConn</span><span class="op" id="7945719">(</span><span class="ident" id="7945720">t</span>&nbsp;<span class="op" id="7945722">*</span><span class="ident" id="7945723">testing</span><span class="op" id="7945730">.</span><span class="ident" id="7945731">T</span><span class="op" id="7945732">,</span>&nbsp;<span class="ident" id="7945734">raddr</span>&nbsp;<span class="op" id="7945740">*</span><span class="ident" id="7945741">UnixAddr</span><span class="op" id="7945749">)</span>&nbsp;<span class="op" id="7945751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945754">c</span><span class="op" id="7945755">,</span>&nbsp;<span class="ident" id="7945757">err</span>&nbsp;<span class="op" id="7945761">:=</span>&nbsp;<span class="ident" id="7945764">Dial</span><span class="op" id="7945768">(</span><span class="string" id="7945769">&#34;unixgram&#34;</span><span class="op" id="7945779">,</span>&nbsp;<span class="ident" id="7945781">raddr</span><span class="op" id="7945786">.</span><span class="ident" id="7945787">String</span><span class="op" id="7945793">(</span><span class="op" id="7945794">)</span><span class="op" id="7945795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945798">if</span>&nbsp;<span class="ident" id="7945801">err</span>&nbsp;<span class="op" id="7945805">!=</span>&nbsp;<span class="ident" id="7945808">nil</span>&nbsp;<span class="op" id="7945812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945816">t</span><span class="op" id="7945817">.</span><span class="ident" id="7945818">Fatalf</span><span class="op" id="7945824">(</span><span class="string" id="7945825">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945842">,</span>&nbsp;<span class="ident" id="7945844">err</span><span class="op" id="7945847">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945853">defer</span>&nbsp;<span class="ident" id="7945859">c</span><span class="op" id="7945860">.</span><span class="ident" id="7945861">Close</span><span class="op" id="7945866">(</span><span class="op" id="7945867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945871">if</span>&nbsp;<span class="ident" id="7945874">_</span><span class="op" id="7945875">,</span>&nbsp;<span class="ident" id="7945877">err</span>&nbsp;<span class="op" id="7945881">:=</span>&nbsp;<span class="ident" id="7945884">c</span><span class="op" id="7945885">.</span><span class="op" id="7945886">(</span><span class="op" id="7945887">*</span><span class="ident" id="7945888">UnixConn</span><span class="op" id="7945896">)</span><span class="op" id="7945897">.</span><span class="ident" id="7945898">WriteToUnix</span><span class="op" id="7945909">(</span><span class="op" id="7945910">[</span><span class="op" id="7945911">]</span><span class="builtintype" id="7945912">byte</span><span class="op" id="7945916">(</span><span class="string" id="7945917">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7945950">)</span><span class="op" id="7945951">,</span>&nbsp;<span class="ident" id="7945953">raddr</span><span class="op" id="7945958">)</span><span class="op" id="7945959">;</span>&nbsp;<span class="ident" id="7945961">err</span>&nbsp;<span class="op" id="7945965">==</span>&nbsp;<span class="ident" id="7945968">nil</span>&nbsp;<span class="op" id="7945972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945976">t</span><span class="op" id="7945977">.</span><span class="ident" id="7945978">Fatal</span><span class="op" id="7945983">(</span><span class="string" id="7945984">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7946009">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946012">}</span>&nbsp;<span class="keyword" id="7946014">else</span>&nbsp;<span class="keyword" id="7946019">if</span>&nbsp;<span class="ident" id="7946022">err</span><span class="op" id="7946025">.</span><span class="op" id="7946026">(</span><span class="op" id="7946027">*</span><span class="ident" id="7946028">OpError</span><span class="op" id="7946035">)</span><span class="op" id="7946036">.</span><span class="ident" id="7946037">Err</span>&nbsp;<span class="op" id="7946041">!=</span>&nbsp;<span class="ident" id="7946044">ErrWriteToConnected</span>&nbsp;<span class="op" id="7946064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946068">t</span><span class="op" id="7946069">.</span><span class="ident" id="7946070">Fatalf</span><span class="op" id="7946076">(</span><span class="string" id="7946077">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7946129">,</span>&nbsp;<span class="ident" id="7946131">err</span><span class="op" id="7946134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946140">if</span>&nbsp;<span class="ident" id="7946143">_</span><span class="op" id="7946144">,</span>&nbsp;<span class="ident" id="7946146">err</span>&nbsp;<span class="op" id="7946150">=</span>&nbsp;<span class="ident" id="7946152">c</span><span class="op" id="7946153">.</span><span class="op" id="7946154">(</span><span class="op" id="7946155">*</span><span class="ident" id="7946156">UnixConn</span><span class="op" id="7946164">)</span><span class="op" id="7946165">.</span><span class="ident" id="7946166">WriteTo</span><span class="op" id="7946173">(</span><span class="op" id="7946174">[</span><span class="op" id="7946175">]</span><span class="builtintype" id="7946176">byte</span><span class="op" id="7946180">(</span><span class="string" id="7946181">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7946214">)</span><span class="op" id="7946215">,</span>&nbsp;<span class="ident" id="7946217">raddr</span><span class="op" id="7946222">)</span><span class="op" id="7946223">;</span>&nbsp;<span class="ident" id="7946225">err</span>&nbsp;<span class="op" id="7946229">==</span>&nbsp;<span class="ident" id="7946232">nil</span>&nbsp;<span class="op" id="7946236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946240">t</span><span class="op" id="7946241">.</span><span class="ident" id="7946242">Fatal</span><span class="op" id="7946247">(</span><span class="string" id="7946248">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7946269">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946272">}</span>&nbsp;<span class="keyword" id="7946274">else</span>&nbsp;<span class="keyword" id="7946279">if</span>&nbsp;<span class="ident" id="7946282">err</span><span class="op" id="7946285">.</span><span class="op" id="7946286">(</span><span class="op" id="7946287">*</span><span class="ident" id="7946288">OpError</span><span class="op" id="7946295">)</span><span class="op" id="7946296">.</span><span class="ident" id="7946297">Err</span>&nbsp;<span class="op" id="7946301">!=</span>&nbsp;<span class="ident" id="7946304">ErrWriteToConnected</span>&nbsp;<span class="op" id="7946324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946328">t</span><span class="op" id="7946329">.</span><span class="ident" id="7946330">Fatalf</span><span class="op" id="7946336">(</span><span class="string" id="7946337">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7946385">,</span>&nbsp;<span class="ident" id="7946387">err</span><span class="op" id="7946390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946396">if</span>&nbsp;<span class="ident" id="7946399">_</span><span class="op" id="7946400">,</span>&nbsp;<span class="ident" id="7946402">_</span><span class="op" id="7946403">,</span>&nbsp;<span class="ident" id="7946405">err</span>&nbsp;<span class="op" id="7946409">=</span>&nbsp;<span class="ident" id="7946411">c</span><span class="op" id="7946412">.</span><span class="op" id="7946413">(</span><span class="op" id="7946414">*</span><span class="ident" id="7946415">UnixConn</span><span class="op" id="7946423">)</span><span class="op" id="7946424">.</span><span class="ident" id="7946425">WriteMsgUnix</span><span class="op" id="7946437">(</span><span class="op" id="7946438">[</span><span class="op" id="7946439">]</span><span class="builtintype" id="7946440">byte</span><span class="op" id="7946444">(</span><span class="string" id="7946445">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7946478">)</span><span class="op" id="7946479">,</span>&nbsp;<span class="ident" id="7946481">nil</span><span class="op" id="7946484">,</span>&nbsp;<span class="ident" id="7946486">raddr</span><span class="op" id="7946491">)</span><span class="op" id="7946492">;</span>&nbsp;<span class="ident" id="7946494">err</span>&nbsp;<span class="op" id="7946498">==</span>&nbsp;<span class="ident" id="7946501">nil</span>&nbsp;<span class="op" id="7946505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946509">t</span><span class="op" id="7946510">.</span><span class="ident" id="7946511">Fatal</span><span class="op" id="7946516">(</span><span class="string" id="7946517">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7946538">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946541">}</span>&nbsp;<span class="keyword" id="7946543">else</span>&nbsp;<span class="keyword" id="7946548">if</span>&nbsp;<span class="ident" id="7946551">err</span><span class="op" id="7946554">.</span><span class="op" id="7946555">(</span><span class="op" id="7946556">*</span><span class="ident" id="7946557">OpError</span><span class="op" id="7946564">)</span><span class="op" id="7946565">.</span><span class="ident" id="7946566">Err</span>&nbsp;<span class="op" id="7946570">!=</span>&nbsp;<span class="ident" id="7946573">ErrWriteToConnected</span>&nbsp;<span class="op" id="7946593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946597">t</span><span class="op" id="7946598">.</span><span class="ident" id="7946599">Fatalf</span><span class="op" id="7946605">(</span><span class="string" id="7946606">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7946659">,</span>&nbsp;<span class="ident" id="7946661">err</span><span class="op" id="7946664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946670">if</span>&nbsp;<span class="ident" id="7946673">_</span><span class="op" id="7946674">,</span>&nbsp;<span class="ident" id="7946676">err</span>&nbsp;<span class="op" id="7946680">:=</span>&nbsp;<span class="ident" id="7946683">c</span><span class="op" id="7946684">.</span><span class="ident" id="7946685">Write</span><span class="op" id="7946690">(</span><span class="op" id="7946691">[</span><span class="op" id="7946692">]</span><span class="builtintype" id="7946693">byte</span><span class="op" id="7946697">(</span><span class="string" id="7946698">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7946731">)</span><span class="op" id="7946732">)</span><span class="op" id="7946733">;</span>&nbsp;<span class="ident" id="7946735">err</span>&nbsp;<span class="op" id="7946739">!=</span>&nbsp;<span class="ident" id="7946742">nil</span>&nbsp;<span class="op" id="7946746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946750">t</span><span class="op" id="7946751">.</span><span class="ident" id="7946752">Fatalf</span><span class="op" id="7946758">(</span><span class="string" id="7946759">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7946777">,</span>&nbsp;<span class="ident" id="7946779">err</span><span class="op" id="7946782">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946785">}</span><br>
<span class="lineno"></span><span class="op" id="7946787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7946790">func</span>&nbsp;<span class="ident" id="7946795">testUnixgramWritePacketConn</span><span class="op" id="7946822">(</span><span class="ident" id="7946823">t</span>&nbsp;<span class="op" id="7946825">*</span><span class="ident" id="7946826">testing</span><span class="op" id="7946833">.</span><span class="ident" id="7946834">T</span><span class="op" id="7946835">,</span>&nbsp;<span class="ident" id="7946837">raddr</span>&nbsp;<span class="op" id="7946843">*</span><span class="ident" id="7946844">UnixAddr</span><span class="op" id="7946852">)</span>&nbsp;<span class="op" id="7946854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946857">addr</span>&nbsp;<span class="op" id="7946862">:=</span>&nbsp;<span class="ident" id="7946865">testUnixAddr</span><span class="op" id="7946877">(</span><span class="op" id="7946878">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946881">c</span><span class="op" id="7946882">,</span>&nbsp;<span class="ident" id="7946884">err</span>&nbsp;<span class="op" id="7946888">:=</span>&nbsp;<span class="ident" id="7946891">ListenPacket</span><span class="op" id="7946903">(</span><span class="string" id="7946904">&#34;unixgram&#34;</span><span class="op" id="7946914">,</span>&nbsp;<span class="ident" id="7946916">addr</span><span class="op" id="7946920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946923">if</span>&nbsp;<span class="ident" id="7946926">err</span>&nbsp;<span class="op" id="7946930">!=</span>&nbsp;<span class="ident" id="7946933">nil</span>&nbsp;<span class="op" id="7946937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946941">t</span><span class="op" id="7946942">.</span><span class="ident" id="7946943">Fatalf</span><span class="op" id="7946949">(</span><span class="string" id="7946950">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7946975">,</span>&nbsp;<span class="ident" id="7946977">err</span><span class="op" id="7946980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946986">defer</span>&nbsp;<span class="ident" id="7946992">os</span><span class="op" id="7946994">.</span><span class="ident" id="7946995">Remove</span><span class="op" id="7947001">(</span><span class="ident" id="7947002">addr</span><span class="op" id="7947006">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947009">defer</span>&nbsp;<span class="ident" id="7947015">c</span><span class="op" id="7947016">.</span><span class="ident" id="7947017">Close</span><span class="op" id="7947022">(</span><span class="op" id="7947023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947027">if</span>&nbsp;<span class="ident" id="7947030">_</span><span class="op" id="7947031">,</span>&nbsp;<span class="ident" id="7947033">err</span>&nbsp;<span class="op" id="7947037">:=</span>&nbsp;<span class="ident" id="7947040">c</span><span class="op" id="7947041">.</span><span class="op" id="7947042">(</span><span class="op" id="7947043">*</span><span class="ident" id="7947044">UnixConn</span><span class="op" id="7947052">)</span><span class="op" id="7947053">.</span><span class="ident" id="7947054">WriteToUnix</span><span class="op" id="7947065">(</span><span class="op" id="7947066">[</span><span class="op" id="7947067">]</span><span class="builtintype" id="7947068">byte</span><span class="op" id="7947072">(</span><span class="string" id="7947073">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7947101">)</span><span class="op" id="7947102">,</span>&nbsp;<span class="ident" id="7947104">raddr</span><span class="op" id="7947109">)</span><span class="op" id="7947110">;</span>&nbsp;<span class="ident" id="7947112">err</span>&nbsp;<span class="op" id="7947116">!=</span>&nbsp;<span class="ident" id="7947119">nil</span>&nbsp;<span class="op" id="7947123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947127">t</span><span class="op" id="7947128">.</span><span class="ident" id="7947129">Fatalf</span><span class="op" id="7947135">(</span><span class="string" id="7947136">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947160">,</span>&nbsp;<span class="ident" id="7947162">err</span><span class="op" id="7947165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947168">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947171">if</span>&nbsp;<span class="ident" id="7947174">_</span><span class="op" id="7947175">,</span>&nbsp;<span class="ident" id="7947177">err</span>&nbsp;<span class="op" id="7947181">:=</span>&nbsp;<span class="ident" id="7947184">c</span><span class="op" id="7947185">.</span><span class="ident" id="7947186">WriteTo</span><span class="op" id="7947193">(</span><span class="op" id="7947194">[</span><span class="op" id="7947195">]</span><span class="builtintype" id="7947196">byte</span><span class="op" id="7947200">(</span><span class="string" id="7947201">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7947229">)</span><span class="op" id="7947230">,</span>&nbsp;<span class="ident" id="7947232">raddr</span><span class="op" id="7947237">)</span><span class="op" id="7947238">;</span>&nbsp;<span class="ident" id="7947240">err</span>&nbsp;<span class="op" id="7947244">!=</span>&nbsp;<span class="ident" id="7947247">nil</span>&nbsp;<span class="op" id="7947251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947255">t</span><span class="op" id="7947256">.</span><span class="ident" id="7947257">Fatalf</span><span class="op" id="7947263">(</span><span class="string" id="7947264">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947284">,</span>&nbsp;<span class="ident" id="7947286">err</span><span class="op" id="7947289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947295">if</span>&nbsp;<span class="ident" id="7947298">_</span><span class="op" id="7947299">,</span>&nbsp;<span class="ident" id="7947301">_</span><span class="op" id="7947302">,</span>&nbsp;<span class="ident" id="7947304">err</span>&nbsp;<span class="op" id="7947308">:=</span>&nbsp;<span class="ident" id="7947311">c</span><span class="op" id="7947312">.</span><span class="op" id="7947313">(</span><span class="op" id="7947314">*</span><span class="ident" id="7947315">UnixConn</span><span class="op" id="7947323">)</span><span class="op" id="7947324">.</span><span class="ident" id="7947325">WriteMsgUnix</span><span class="op" id="7947337">(</span><span class="op" id="7947338">[</span><span class="op" id="7947339">]</span><span class="builtintype" id="7947340">byte</span><span class="op" id="7947344">(</span><span class="string" id="7947345">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7947373">)</span><span class="op" id="7947374">,</span>&nbsp;<span class="ident" id="7947376">nil</span><span class="op" id="7947379">,</span>&nbsp;<span class="ident" id="7947381">raddr</span><span class="op" id="7947386">)</span><span class="op" id="7947387">;</span>&nbsp;<span class="ident" id="7947389">err</span>&nbsp;<span class="op" id="7947393">!=</span>&nbsp;<span class="ident" id="7947396">nil</span>&nbsp;<span class="op" id="7947400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947404">t</span><span class="op" id="7947405">.</span><span class="ident" id="7947406">Fatalf</span><span class="op" id="7947412">(</span><span class="string" id="7947413">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947438">,</span>&nbsp;<span class="ident" id="7947440">err</span><span class="op" id="7947443">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947449">if</span>&nbsp;<span class="ident" id="7947452">_</span><span class="op" id="7947453">,</span>&nbsp;<span class="ident" id="7947455">err</span>&nbsp;<span class="op" id="7947459">:=</span>&nbsp;<span class="ident" id="7947462">c</span><span class="op" id="7947463">.</span><span class="op" id="7947464">(</span><span class="op" id="7947465">*</span><span class="ident" id="7947466">UnixConn</span><span class="op" id="7947474">)</span><span class="op" id="7947475">.</span><span class="ident" id="7947476">Write</span><span class="op" id="7947481">(</span><span class="op" id="7947482">[</span><span class="op" id="7947483">]</span><span class="builtintype" id="7947484">byte</span><span class="op" id="7947488">(</span><span class="string" id="7947489">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7947517">)</span><span class="op" id="7947518">)</span><span class="op" id="7947519">;</span>&nbsp;<span class="ident" id="7947521">err</span>&nbsp;<span class="op" id="7947525">==</span>&nbsp;<span class="ident" id="7947528">nil</span>&nbsp;<span class="op" id="7947532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947536">t</span><span class="op" id="7947537">.</span><span class="ident" id="7947538">Fatal</span><span class="op" id="7947543">(</span><span class="string" id="7947544">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7947563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947566">}</span><br>
<span class="lineno"></span><span class="op" id="7947568">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7947571">func</span>&nbsp;<span class="ident" id="7947576">TestUnixConnLocalAndRemoteNames</span><span class="op" id="7947607">(</span><span class="ident" id="7947608">t</span>&nbsp;<span class="op" id="7947610">*</span><span class="ident" id="7947611">testing</span><span class="op" id="7947618">.</span><span class="ident" id="7947619">T</span><span class="op" id="7947620">)</span>&nbsp;<span class="op" id="7947622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947625">for</span>&nbsp;<span class="ident" id="7947629">_</span><span class="op" id="7947630">,</span>&nbsp;<span class="ident" id="7947632">laddr</span>&nbsp;<span class="op" id="7947638">:=</span>&nbsp;<span class="keyword" id="7947641">range</span>&nbsp;<span class="op" id="7947647">[</span><span class="op" id="7947648">]</span><span class="builtintype" id="7947649">string</span><span class="op" id="7947655">{</span><span class="string" id="7947656">&#34;&#34;</span><span class="op" id="7947658">,</span>&nbsp;<span class="ident" id="7947660">testUnixAddr</span><span class="op" id="7947672">(</span><span class="op" id="7947673">)</span><span class="op" id="7947674">}</span>&nbsp;<span class="op" id="7947676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947680">laddr</span>&nbsp;<span class="op" id="7947686">:=</span>&nbsp;<span class="ident" id="7947689">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947697">taddr</span>&nbsp;<span class="op" id="7947703">:=</span>&nbsp;<span class="ident" id="7947706">testUnixAddr</span><span class="op" id="7947718">(</span><span class="op" id="7947719">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947723">ta</span><span class="op" id="7947725">,</span>&nbsp;<span class="ident" id="7947727">err</span>&nbsp;<span class="op" id="7947731">:=</span>&nbsp;<span class="ident" id="7947734">ResolveUnixAddr</span><span class="op" id="7947749">(</span><span class="string" id="7947750">&#34;unix&#34;</span><span class="op" id="7947756">,</span>&nbsp;<span class="ident" id="7947758">taddr</span><span class="op" id="7947763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947767">if</span>&nbsp;<span class="ident" id="7947770">err</span>&nbsp;<span class="op" id="7947774">!=</span>&nbsp;<span class="ident" id="7947777">nil</span>&nbsp;<span class="op" id="7947781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947786">t</span><span class="op" id="7947787">.</span><span class="ident" id="7947788">Fatalf</span><span class="op" id="7947794">(</span><span class="string" id="7947795">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947823">,</span>&nbsp;<span class="ident" id="7947825">err</span><span class="op" id="7947828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947836">ln</span><span class="op" id="7947838">,</span>&nbsp;<span class="ident" id="7947840">err</span>&nbsp;<span class="op" id="7947844">:=</span>&nbsp;<span class="ident" id="7947847">ListenUnix</span><span class="op" id="7947857">(</span><span class="string" id="7947858">&#34;unix&#34;</span><span class="op" id="7947864">,</span>&nbsp;<span class="ident" id="7947866">ta</span><span class="op" id="7947868">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947872">if</span>&nbsp;<span class="ident" id="7947875">err</span>&nbsp;<span class="op" id="7947879">!=</span>&nbsp;<span class="ident" id="7947882">nil</span>&nbsp;<span class="op" id="7947886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947891">t</span><span class="op" id="7947892">.</span><span class="ident" id="7947893">Fatalf</span><span class="op" id="7947899">(</span><span class="string" id="7947900">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947923">,</span>&nbsp;<span class="ident" id="7947925">err</span><span class="op" id="7947928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947936">defer</span>&nbsp;<span class="keyword" id="7947942">func</span><span class="op" id="7947946">(</span><span class="op" id="7947947">)</span>&nbsp;<span class="op" id="7947949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947954">ln</span><span class="op" id="7947956">.</span><span class="ident" id="7947957">Close</span><span class="op" id="7947962">(</span><span class="op" id="7947963">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947968">os</span><span class="op" id="7947970">.</span><span class="ident" id="7947971">Remove</span><span class="op" id="7947977">(</span><span class="ident" id="7947978">taddr</span><span class="op" id="7947983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947987">}</span><span class="op" id="7947988">(</span><span class="op" id="7947989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947994">done</span>&nbsp;<span class="op" id="7947999">:=</span>&nbsp;<span class="builtinfunc" id="7948002">make</span><span class="op" id="7948006">(</span><span class="keyword" id="7948007">chan</span>&nbsp;<span class="builtintype" id="7948012">int</span><span class="op" id="7948015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948019">go</span>&nbsp;<span class="ident" id="7948022">transponder</span><span class="op" id="7948033">(</span><span class="ident" id="7948034">t</span><span class="op" id="7948035">,</span>&nbsp;<span class="ident" id="7948037">ln</span><span class="op" id="7948039">,</span>&nbsp;<span class="ident" id="7948041">done</span><span class="op" id="7948045">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948050">la</span><span class="op" id="7948052">,</span>&nbsp;<span class="ident" id="7948054">err</span>&nbsp;<span class="op" id="7948058">:=</span>&nbsp;<span class="ident" id="7948061">ResolveUnixAddr</span><span class="op" id="7948076">(</span><span class="string" id="7948077">&#34;unix&#34;</span><span class="op" id="7948083">,</span>&nbsp;<span class="ident" id="7948085">laddr</span><span class="op" id="7948090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948094">if</span>&nbsp;<span class="ident" id="7948097">err</span>&nbsp;<span class="op" id="7948101">!=</span>&nbsp;<span class="ident" id="7948104">nil</span>&nbsp;<span class="op" id="7948108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948113">t</span><span class="op" id="7948114">.</span><span class="ident" id="7948115">Fatalf</span><span class="op" id="7948121">(</span><span class="string" id="7948122">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948150">,</span>&nbsp;<span class="ident" id="7948152">err</span><span class="op" id="7948155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948159">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948163">c</span><span class="op" id="7948164">,</span>&nbsp;<span class="ident" id="7948166">err</span>&nbsp;<span class="op" id="7948170">:=</span>&nbsp;<span class="ident" id="7948173">DialUnix</span><span class="op" id="7948181">(</span><span class="string" id="7948182">&#34;unix&#34;</span><span class="op" id="7948188">,</span>&nbsp;<span class="ident" id="7948190">la</span><span class="op" id="7948192">,</span>&nbsp;<span class="ident" id="7948194">ta</span><span class="op" id="7948196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948200">if</span>&nbsp;<span class="ident" id="7948203">err</span>&nbsp;<span class="op" id="7948207">!=</span>&nbsp;<span class="ident" id="7948210">nil</span>&nbsp;<span class="op" id="7948214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948219">t</span><span class="op" id="7948220">.</span><span class="ident" id="7948221">Fatalf</span><span class="op" id="7948227">(</span><span class="string" id="7948228">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948249">,</span>&nbsp;<span class="ident" id="7948251">err</span><span class="op" id="7948254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948262">defer</span>&nbsp;<span class="keyword" id="7948268">func</span><span class="op" id="7948272">(</span><span class="op" id="7948273">)</span>&nbsp;<span class="op" id="7948275">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948280">c</span><span class="op" id="7948281">.</span><span class="ident" id="7948282">Close</span><span class="op" id="7948287">(</span><span class="op" id="7948288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948293">if</span>&nbsp;<span class="ident" id="7948296">la</span>&nbsp;<span class="op" id="7948299">!=</span>&nbsp;<span class="ident" id="7948302">nil</span>&nbsp;<span class="op" id="7948306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948312">defer</span>&nbsp;<span class="ident" id="7948318">os</span><span class="op" id="7948320">.</span><span class="ident" id="7948321">Remove</span><span class="op" id="7948327">(</span><span class="ident" id="7948328">laddr</span><span class="op" id="7948333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948342">}</span><span class="op" id="7948343">(</span><span class="op" id="7948344">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948348">if</span>&nbsp;<span class="ident" id="7948351">_</span><span class="op" id="7948352">,</span>&nbsp;<span class="ident" id="7948354">err</span>&nbsp;<span class="op" id="7948358">:=</span>&nbsp;<span class="ident" id="7948361">c</span><span class="op" id="7948362">.</span><span class="ident" id="7948363">Write</span><span class="op" id="7948368">(</span><span class="op" id="7948369">[</span><span class="op" id="7948370">]</span><span class="builtintype" id="7948371">byte</span><span class="op" id="7948375">(</span><span class="string" id="7948376">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="7948413">)</span><span class="op" id="7948414">)</span><span class="op" id="7948415">;</span>&nbsp;<span class="ident" id="7948417">err</span>&nbsp;<span class="op" id="7948421">!=</span>&nbsp;<span class="ident" id="7948424">nil</span>&nbsp;<span class="op" id="7948428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948433">t</span><span class="op" id="7948434">.</span><span class="ident" id="7948435">Fatalf</span><span class="op" id="7948441">(</span><span class="string" id="7948442">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948469">,</span>&nbsp;<span class="ident" id="7948471">err</span><span class="op" id="7948474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948483">switch</span>&nbsp;<span class="ident" id="7948490">runtime</span><span class="op" id="7948497">.</span><span class="ident" id="7948498">GOOS</span>&nbsp;<span class="op" id="7948503">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948507">case</span>&nbsp;<span class="string" id="7948512">&#34;android&#34;</span><span class="op" id="7948521">,</span>&nbsp;<span class="string" id="7948523">&#34;linux&#34;</span><span class="op" id="7948530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948535">if</span>&nbsp;<span class="ident" id="7948538">laddr</span>&nbsp;<span class="op" id="7948544">==</span>&nbsp;<span class="string" id="7948547">&#34;&#34;</span>&nbsp;<span class="op" id="7948550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948556">laddr</span>&nbsp;<span class="op" id="7948562">=</span>&nbsp;<span class="string" id="7948564">&#34;@&#34;</span>&nbsp;<span class="comment" id="7948568">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948595">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948599">var</span>&nbsp;<span class="ident" id="7948603">connAddrs</span>&nbsp;<span class="op" id="7948613">=</span>&nbsp;<span class="op" id="7948615">[</span><span class="num" id="7948616">3</span><span class="op" id="7948617">]</span><span class="keyword" id="7948618">struct</span><span class="op" id="7948624">{</span>&nbsp;<span class="ident" id="7948626">got</span><span class="op" id="7948629">,</span>&nbsp;<span class="ident" id="7948631">want</span>&nbsp;<span class="ident" id="7948636">Addr</span>&nbsp;<span class="op" id="7948641">}</span><span class="op" id="7948642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948647">{</span><span class="ident" id="7948648">ln</span><span class="op" id="7948650">.</span><span class="ident" id="7948651">Addr</span><span class="op" id="7948655">(</span><span class="op" id="7948656">)</span><span class="op" id="7948657">,</span>&nbsp;<span class="ident" id="7948659">ta</span><span class="op" id="7948661">}</span><span class="op" id="7948662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948667">{</span><span class="ident" id="7948668">c</span><span class="op" id="7948669">.</span><span class="ident" id="7948670">LocalAddr</span><span class="op" id="7948679">(</span><span class="op" id="7948680">)</span><span class="op" id="7948681">,</span>&nbsp;<span class="op" id="7948683">&amp;</span><span class="ident" id="7948684">UnixAddr</span><span class="op" id="7948692">{</span><span class="ident" id="7948693">Name</span><span class="op" id="7948697">:</span>&nbsp;<span class="ident" id="7948699">laddr</span><span class="op" id="7948704">,</span>&nbsp;<span class="ident" id="7948706">Net</span><span class="op" id="7948709">:</span>&nbsp;<span class="string" id="7948711">&#34;unix&#34;</span><span class="op" id="7948717">}</span><span class="op" id="7948718">}</span><span class="op" id="7948719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948724">{</span><span class="ident" id="7948725">c</span><span class="op" id="7948726">.</span><span class="ident" id="7948727">RemoteAddr</span><span class="op" id="7948737">(</span><span class="op" id="7948738">)</span><span class="op" id="7948739">,</span>&nbsp;<span class="ident" id="7948741">ta</span><span class="op" id="7948743">}</span><span class="op" id="7948744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948748">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948752">for</span>&nbsp;<span class="ident" id="7948756">_</span><span class="op" id="7948757">,</span>&nbsp;<span class="ident" id="7948759">ca</span>&nbsp;<span class="op" id="7948762">:=</span>&nbsp;<span class="keyword" id="7948765">range</span>&nbsp;<span class="ident" id="7948771">connAddrs</span>&nbsp;<span class="op" id="7948781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948786">if</span>&nbsp;<span class="op" id="7948789">!</span><span class="ident" id="7948790">reflect</span><span class="op" id="7948797">.</span><span class="ident" id="7948798">DeepEqual</span><span class="op" id="7948807">(</span><span class="ident" id="7948808">ca</span><span class="op" id="7948810">.</span><span class="ident" id="7948811">got</span><span class="op" id="7948814">,</span>&nbsp;<span class="ident" id="7948816">ca</span><span class="op" id="7948818">.</span><span class="ident" id="7948819">want</span><span class="op" id="7948823">)</span>&nbsp;<span class="op" id="7948825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948831">t</span><span class="op" id="7948832">.</span><span class="ident" id="7948833">Fatalf</span><span class="op" id="7948839">(</span><span class="string" id="7948840">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7948863">,</span>&nbsp;<span class="ident" id="7948865">ca</span><span class="op" id="7948867">.</span><span class="ident" id="7948868">got</span><span class="op" id="7948871">,</span>&nbsp;<span class="ident" id="7948873">ca</span><span class="op" id="7948875">.</span><span class="ident" id="7948876">want</span><span class="op" id="7948880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948889">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948894">&lt;-</span><span class="ident" id="7948896">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948902">}</span><br>
<span class="lineno"></span><span class="op" id="7948904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7948907">func</span>&nbsp;<span class="ident" id="7948912">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="7948947">(</span><span class="ident" id="7948948">t</span>&nbsp;<span class="op" id="7948950">*</span><span class="ident" id="7948951">testing</span><span class="op" id="7948958">.</span><span class="ident" id="7948959">T</span><span class="op" id="7948960">)</span>&nbsp;<span class="op" id="7948962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948965">for</span>&nbsp;<span class="ident" id="7948969">_</span><span class="op" id="7948970">,</span>&nbsp;<span class="ident" id="7948972">laddr</span>&nbsp;<span class="op" id="7948978">:=</span>&nbsp;<span class="keyword" id="7948981">range</span>&nbsp;<span class="op" id="7948987">[</span><span class="op" id="7948988">]</span><span class="builtintype" id="7948989">string</span><span class="op" id="7948995">{</span><span class="string" id="7948996">&#34;&#34;</span><span class="op" id="7948998">,</span>&nbsp;<span class="ident" id="7949000">testUnixAddr</span><span class="op" id="7949012">(</span><span class="op" id="7949013">)</span><span class="op" id="7949014">}</span>&nbsp;<span class="op" id="7949016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949020">laddr</span>&nbsp;<span class="op" id="7949026">:=</span>&nbsp;<span class="ident" id="7949029">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949037">taddr</span>&nbsp;<span class="op" id="7949043">:=</span>&nbsp;<span class="ident" id="7949046">testUnixAddr</span><span class="op" id="7949058">(</span><span class="op" id="7949059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949063">ta</span><span class="op" id="7949065">,</span>&nbsp;<span class="ident" id="7949067">err</span>&nbsp;<span class="op" id="7949071">:=</span>&nbsp;<span class="ident" id="7949074">ResolveUnixAddr</span><span class="op" id="7949089">(</span><span class="string" id="7949090">&#34;unixgram&#34;</span><span class="op" id="7949100">,</span>&nbsp;<span class="ident" id="7949102">taddr</span><span class="op" id="7949107">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949111">if</span>&nbsp;<span class="ident" id="7949114">err</span>&nbsp;<span class="op" id="7949118">!=</span>&nbsp;<span class="ident" id="7949121">nil</span>&nbsp;<span class="op" id="7949125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949130">t</span><span class="op" id="7949131">.</span><span class="ident" id="7949132">Fatalf</span><span class="op" id="7949138">(</span><span class="string" id="7949139">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949167">,</span>&nbsp;<span class="ident" id="7949169">err</span><span class="op" id="7949172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949180">c1</span><span class="op" id="7949182">,</span>&nbsp;<span class="ident" id="7949184">err</span>&nbsp;<span class="op" id="7949188">:=</span>&nbsp;<span class="ident" id="7949191">ListenUnixgram</span><span class="op" id="7949205">(</span><span class="string" id="7949206">&#34;unixgram&#34;</span><span class="op" id="7949216">,</span>&nbsp;<span class="ident" id="7949218">ta</span><span class="op" id="7949220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949224">if</span>&nbsp;<span class="ident" id="7949227">err</span>&nbsp;<span class="op" id="7949231">!=</span>&nbsp;<span class="ident" id="7949234">nil</span>&nbsp;<span class="op" id="7949238">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949243">t</span><span class="op" id="7949244">.</span><span class="ident" id="7949245">Fatalf</span><span class="op" id="7949251">(</span><span class="string" id="7949252">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949279">,</span>&nbsp;<span class="ident" id="7949281">err</span><span class="op" id="7949284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949292">defer</span>&nbsp;<span class="keyword" id="7949298">func</span><span class="op" id="7949302">(</span><span class="op" id="7949303">)</span>&nbsp;<span class="op" id="7949305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949310">c1</span><span class="op" id="7949312">.</span><span class="ident" id="7949313">Close</span><span class="op" id="7949318">(</span><span class="op" id="7949319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949324">os</span><span class="op" id="7949326">.</span><span class="ident" id="7949327">Remove</span><span class="op" id="7949333">(</span><span class="ident" id="7949334">taddr</span><span class="op" id="7949339">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949343">}</span><span class="op" id="7949344">(</span><span class="op" id="7949345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949350">var</span>&nbsp;<span class="ident" id="7949354">la</span>&nbsp;<span class="op" id="7949357">*</span><span class="ident" id="7949358">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949369">if</span>&nbsp;<span class="ident" id="7949372">laddr</span>&nbsp;<span class="op" id="7949378">!=</span>&nbsp;<span class="string" id="7949381">&#34;&#34;</span>&nbsp;<span class="op" id="7949384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949389">if</span>&nbsp;<span class="ident" id="7949392">la</span><span class="op" id="7949394">,</span>&nbsp;<span class="ident" id="7949396">err</span>&nbsp;<span class="op" id="7949400">=</span>&nbsp;<span class="ident" id="7949402">ResolveUnixAddr</span><span class="op" id="7949417">(</span><span class="string" id="7949418">&#34;unixgram&#34;</span><span class="op" id="7949428">,</span>&nbsp;<span class="ident" id="7949430">laddr</span><span class="op" id="7949435">)</span><span class="op" id="7949436">;</span>&nbsp;<span class="ident" id="7949438">err</span>&nbsp;<span class="op" id="7949442">!=</span>&nbsp;<span class="ident" id="7949445">nil</span>&nbsp;<span class="op" id="7949449">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949455">t</span><span class="op" id="7949456">.</span><span class="ident" id="7949457">Fatalf</span><span class="op" id="7949463">(</span><span class="string" id="7949464">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949492">,</span>&nbsp;<span class="ident" id="7949494">err</span><span class="op" id="7949497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949510">c2</span><span class="op" id="7949512">,</span>&nbsp;<span class="ident" id="7949514">err</span>&nbsp;<span class="op" id="7949518">:=</span>&nbsp;<span class="ident" id="7949521">DialUnix</span><span class="op" id="7949529">(</span><span class="string" id="7949530">&#34;unixgram&#34;</span><span class="op" id="7949540">,</span>&nbsp;<span class="ident" id="7949542">la</span><span class="op" id="7949544">,</span>&nbsp;<span class="ident" id="7949546">ta</span><span class="op" id="7949548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949552">if</span>&nbsp;<span class="ident" id="7949555">err</span>&nbsp;<span class="op" id="7949559">!=</span>&nbsp;<span class="ident" id="7949562">nil</span>&nbsp;<span class="op" id="7949566">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949571">t</span><span class="op" id="7949572">.</span><span class="ident" id="7949573">Fatalf</span><span class="op" id="7949579">(</span><span class="string" id="7949580">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949601">,</span>&nbsp;<span class="ident" id="7949603">err</span><span class="op" id="7949606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949614">defer</span>&nbsp;<span class="keyword" id="7949620">func</span><span class="op" id="7949624">(</span><span class="op" id="7949625">)</span>&nbsp;<span class="op" id="7949627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949632">c2</span><span class="op" id="7949634">.</span><span class="ident" id="7949635">Close</span><span class="op" id="7949640">(</span><span class="op" id="7949641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949646">if</span>&nbsp;<span class="ident" id="7949649">la</span>&nbsp;<span class="op" id="7949652">!=</span>&nbsp;<span class="ident" id="7949655">nil</span>&nbsp;<span class="op" id="7949659">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949665">defer</span>&nbsp;<span class="ident" id="7949671">os</span><span class="op" id="7949673">.</span><span class="ident" id="7949674">Remove</span><span class="op" id="7949680">(</span><span class="ident" id="7949681">laddr</span><span class="op" id="7949686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949695">}</span><span class="op" id="7949696">(</span><span class="op" id="7949697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949702">switch</span>&nbsp;<span class="ident" id="7949709">runtime</span><span class="op" id="7949716">.</span><span class="ident" id="7949717">GOOS</span>&nbsp;<span class="op" id="7949722">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949726">case</span>&nbsp;<span class="string" id="7949731">&#34;android&#34;</span><span class="op" id="7949740">,</span>&nbsp;<span class="string" id="7949742">&#34;linux&#34;</span><span class="op" id="7949749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949754">if</span>&nbsp;<span class="ident" id="7949757">laddr</span>&nbsp;<span class="op" id="7949763">==</span>&nbsp;<span class="string" id="7949766">&#34;&#34;</span>&nbsp;<span class="op" id="7949769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949775">laddr</span>&nbsp;<span class="op" id="7949781">=</span>&nbsp;<span class="string" id="7949783">&#34;@&#34;</span>&nbsp;<span class="comment" id="7949787">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949814">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949819">var</span>&nbsp;<span class="ident" id="7949823">connAddrs</span>&nbsp;<span class="op" id="7949833">=</span>&nbsp;<span class="op" id="7949835">[</span><span class="num" id="7949836">4</span><span class="op" id="7949837">]</span><span class="keyword" id="7949838">struct</span><span class="op" id="7949844">{</span>&nbsp;<span class="ident" id="7949846">got</span><span class="op" id="7949849">,</span>&nbsp;<span class="ident" id="7949851">want</span>&nbsp;<span class="ident" id="7949856">Addr</span>&nbsp;<span class="op" id="7949861">}</span><span class="op" id="7949862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949867">{</span><span class="ident" id="7949868">c1</span><span class="op" id="7949870">.</span><span class="ident" id="7949871">LocalAddr</span><span class="op" id="7949880">(</span><span class="op" id="7949881">)</span><span class="op" id="7949882">,</span>&nbsp;<span class="ident" id="7949884">ta</span><span class="op" id="7949886">}</span><span class="op" id="7949887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949892">{</span><span class="ident" id="7949893">c1</span><span class="op" id="7949895">.</span><span class="ident" id="7949896">RemoteAddr</span><span class="op" id="7949906">(</span><span class="op" id="7949907">)</span><span class="op" id="7949908">,</span>&nbsp;<span class="ident" id="7949910">nil</span><span class="op" id="7949913">}</span><span class="op" id="7949914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949919">{</span><span class="ident" id="7949920">c2</span><span class="op" id="7949922">.</span><span class="ident" id="7949923">LocalAddr</span><span class="op" id="7949932">(</span><span class="op" id="7949933">)</span><span class="op" id="7949934">,</span>&nbsp;<span class="op" id="7949936">&amp;</span><span class="ident" id="7949937">UnixAddr</span><span class="op" id="7949945">{</span><span class="ident" id="7949946">Name</span><span class="op" id="7949950">:</span>&nbsp;<span class="ident" id="7949952">laddr</span><span class="op" id="7949957">,</span>&nbsp;<span class="ident" id="7949959">Net</span><span class="op" id="7949962">:</span>&nbsp;<span class="string" id="7949964">&#34;unixgram&#34;</span><span class="op" id="7949974">}</span><span class="op" id="7949975">}</span><span class="op" id="7949976">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949981">{</span><span class="ident" id="7949982">c2</span><span class="op" id="7949984">.</span><span class="ident" id="7949985">RemoteAddr</span><span class="op" id="7949995">(</span><span class="op" id="7949996">)</span><span class="op" id="7949997">,</span>&nbsp;<span class="ident" id="7949999">ta</span><span class="op" id="7950001">}</span><span class="op" id="7950002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950010">for</span>&nbsp;<span class="ident" id="7950014">_</span><span class="op" id="7950015">,</span>&nbsp;<span class="ident" id="7950017">ca</span>&nbsp;<span class="op" id="7950020">:=</span>&nbsp;<span class="keyword" id="7950023">range</span>&nbsp;<span class="ident" id="7950029">connAddrs</span>&nbsp;<span class="op" id="7950039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950044">if</span>&nbsp;<span class="op" id="7950047">!</span><span class="ident" id="7950048">reflect</span><span class="op" id="7950055">.</span><span class="ident" id="7950056">DeepEqual</span><span class="op" id="7950065">(</span><span class="ident" id="7950066">ca</span><span class="op" id="7950068">.</span><span class="ident" id="7950069">got</span><span class="op" id="7950072">,</span>&nbsp;<span class="ident" id="7950074">ca</span><span class="op" id="7950076">.</span><span class="ident" id="7950077">want</span><span class="op" id="7950081">)</span>&nbsp;<span class="op" id="7950083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950089">t</span><span class="op" id="7950090">.</span><span class="ident" id="7950091">Fatalf</span><span class="op" id="7950097">(</span><span class="string" id="7950098">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7950121">,</span>&nbsp;<span class="ident" id="7950123">ca</span><span class="op" id="7950125">.</span><span class="ident" id="7950126">got</span><span class="op" id="7950129">,</span>&nbsp;<span class="ident" id="7950131">ca</span><span class="op" id="7950133">.</span><span class="ident" id="7950134">want</span><span class="op" id="7950138">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950150">}</span><br>
<span class="lineno"></span><span class="op" id="7950152">}</span>
</div>
</body>
</html>
