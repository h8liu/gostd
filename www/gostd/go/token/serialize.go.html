<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html" class="current">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5056196">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5056251">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5056305">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5056356">package</span>&nbsp;<span class="ident" id="5056364">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5056371">type</span>&nbsp;<span class="ident" id="5056376">serializedFile</span>&nbsp;<span class="keyword" id="5056391">struct</span>&nbsp;<span class="op" id="5056398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5056401">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056473">Name</span>&nbsp;&nbsp;<span class="builtintype" id="5056479">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056487">Base</span>&nbsp;&nbsp;<span class="builtintype" id="5056493">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056498">Size</span>&nbsp;&nbsp;<span class="builtintype" id="5056504">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056509">Lines</span>&nbsp;<span class="op" id="5056515">[</span><span class="op" id="5056516">]</span><span class="builtintype" id="5056517">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056522">Infos</span>&nbsp;<span class="op" id="5056528">[</span><span class="op" id="5056529">]</span><span class="ident" id="5056530">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="5056539">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5056542">type</span>&nbsp;<span class="ident" id="5056547">serializedFileSet</span>&nbsp;<span class="keyword" id="5056565">struct</span>&nbsp;<span class="op" id="5056572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056575">Base</span>&nbsp;&nbsp;<span class="builtintype" id="5056581">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056586">Files</span>&nbsp;<span class="op" id="5056592">[</span><span class="op" id="5056593">]</span><span class="ident" id="5056594">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="5056609">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5056612">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5056686">func</span>&nbsp;<span class="op" id="5056691">(</span><span class="ident" id="5056692">s</span>&nbsp;<span class="op" id="5056694">*</span><span class="ident" id="5056695">FileSet</span><span class="op" id="5056702">)</span>&nbsp;<span class="ident" id="5056704">Read</span><span class="op" id="5056708">(</span><span class="ident" id="5056709">decode</span>&nbsp;<span class="keyword" id="5056716">func</span><span class="op" id="5056720">(</span><span class="keyword" id="5056721">interface</span><span class="op" id="5056730">{</span><span class="op" id="5056731">}</span><span class="op" id="5056732">)</span>&nbsp;<span class="builtintype" id="5056734">error</span><span class="op" id="5056739">)</span>&nbsp;<span class="builtintype" id="5056741">error</span>&nbsp;<span class="op" id="5056747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5056750">var</span>&nbsp;<span class="ident" id="5056754">ss</span>&nbsp;<span class="ident" id="5056757">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5056776">if</span>&nbsp;<span class="ident" id="5056779">err</span>&nbsp;<span class="op" id="5056783">:=</span>&nbsp;<span class="ident" id="5056786">decode</span><span class="op" id="5056792">(</span><span class="op" id="5056793">&amp;</span><span class="ident" id="5056794">ss</span><span class="op" id="5056796">)</span><span class="op" id="5056797">;</span>&nbsp;<span class="ident" id="5056799">err</span>&nbsp;<span class="op" id="5056803">!=</span>&nbsp;<span class="builtintype" id="5056806">nil</span>&nbsp;<span class="op" id="5056810">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5056814">return</span>&nbsp;<span class="ident" id="5056821">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5056826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056830">s</span><span class="op" id="5056831">.</span><span class="ident" id="5056832">mutex</span><span class="op" id="5056837">.</span><span class="ident" id="5056838">Lock</span><span class="op" id="5056842">(</span><span class="op" id="5056843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056846">s</span><span class="op" id="5056847">.</span><span class="ident" id="5056848">base</span>&nbsp;<span class="op" id="5056853">=</span>&nbsp;<span class="ident" id="5056855">ss</span><span class="op" id="5056857">.</span><span class="ident" id="5056858">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056864">files</span>&nbsp;<span class="op" id="5056870">:=</span>&nbsp;<span class="builtinfunc" id="5056873">make</span><span class="op" id="5056877">(</span><span class="op" id="5056878">[</span><span class="op" id="5056879">]</span><span class="op" id="5056880">*</span><span class="ident" id="5056881">File</span><span class="op" id="5056885">,</span>&nbsp;<span class="builtinfunc" id="5056887">len</span><span class="op" id="5056890">(</span><span class="ident" id="5056891">ss</span><span class="op" id="5056893">.</span><span class="ident" id="5056894">Files</span><span class="op" id="5056899">)</span><span class="op" id="5056900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5056903">for</span>&nbsp;<span class="ident" id="5056907">i</span>&nbsp;<span class="op" id="5056909">:=</span>&nbsp;<span class="num" id="5056912">0</span><span class="op" id="5056913">;</span>&nbsp;<span class="ident" id="5056915">i</span>&nbsp;<span class="op" id="5056917">&lt;</span>&nbsp;<span class="builtinfunc" id="5056919">len</span><span class="op" id="5056922">(</span><span class="ident" id="5056923">ss</span><span class="op" id="5056925">.</span><span class="ident" id="5056926">Files</span><span class="op" id="5056931">)</span><span class="op" id="5056932">;</span>&nbsp;<span class="ident" id="5056934">i</span><span class="op" id="5056935">++</span>&nbsp;<span class="op" id="5056938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056942">f</span>&nbsp;<span class="op" id="5056944">:=</span>&nbsp;<span class="op" id="5056947">&amp;</span><span class="ident" id="5056948">ss</span><span class="op" id="5056950">.</span><span class="ident" id="5056951">Files</span><span class="op" id="5056956">[</span><span class="ident" id="5056957">i</span><span class="op" id="5056958">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056962">files</span><span class="op" id="5056967">[</span><span class="ident" id="5056968">i</span><span class="op" id="5056969">]</span>&nbsp;<span class="op" id="5056971">=</span>&nbsp;<span class="op" id="5056973">&amp;</span><span class="ident" id="5056974">File</span><span class="op" id="5056978">{</span><span class="ident" id="5056979">s</span><span class="op" id="5056980">,</span>&nbsp;<span class="ident" id="5056982">f</span><span class="op" id="5056983">.</span><span class="ident" id="5056984">Name</span><span class="op" id="5056988">,</span>&nbsp;<span class="ident" id="5056990">f</span><span class="op" id="5056991">.</span><span class="ident" id="5056992">Base</span><span class="op" id="5056996">,</span>&nbsp;<span class="ident" id="5056998">f</span><span class="op" id="5056999">.</span><span class="ident" id="5057000">Size</span><span class="op" id="5057004">,</span>&nbsp;<span class="ident" id="5057006">f</span><span class="op" id="5057007">.</span><span class="ident" id="5057008">Lines</span><span class="op" id="5057013">,</span>&nbsp;<span class="ident" id="5057015">f</span><span class="op" id="5057016">.</span><span class="ident" id="5057017">Infos</span><span class="op" id="5057022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5057025">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057028">s</span><span class="op" id="5057029">.</span><span class="ident" id="5057030">files</span>&nbsp;<span class="op" id="5057036">=</span>&nbsp;<span class="ident" id="5057038">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057045">s</span><span class="op" id="5057046">.</span><span class="ident" id="5057047">last</span>&nbsp;<span class="op" id="5057052">=</span>&nbsp;<span class="builtintype" id="5057054">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057059">s</span><span class="op" id="5057060">.</span><span class="ident" id="5057061">mutex</span><span class="op" id="5057066">.</span><span class="ident" id="5057067">Unlock</span><span class="op" id="5057073">(</span><span class="op" id="5057074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5057078">return</span>&nbsp;<span class="builtintype" id="5057085">nil</span><br>
<span class="lineno">40</span><span class="op" id="5057089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5057092">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5057143">func</span>&nbsp;<span class="op" id="5057148">(</span><span class="ident" id="5057149">s</span>&nbsp;<span class="op" id="5057151">*</span><span class="ident" id="5057152">FileSet</span><span class="op" id="5057159">)</span>&nbsp;<span class="ident" id="5057161">Write</span><span class="op" id="5057166">(</span><span class="ident" id="5057167">encode</span>&nbsp;<span class="keyword" id="5057174">func</span><span class="op" id="5057178">(</span><span class="keyword" id="5057179">interface</span><span class="op" id="5057188">{</span><span class="op" id="5057189">}</span><span class="op" id="5057190">)</span>&nbsp;<span class="builtintype" id="5057192">error</span><span class="op" id="5057197">)</span>&nbsp;<span class="builtintype" id="5057199">error</span>&nbsp;<span class="op" id="5057205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5057208">var</span>&nbsp;<span class="ident" id="5057212">ss</span>&nbsp;<span class="ident" id="5057215">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057235">s</span><span class="op" id="5057236">.</span><span class="ident" id="5057237">mutex</span><span class="op" id="5057242">.</span><span class="ident" id="5057243">Lock</span><span class="op" id="5057247">(</span><span class="op" id="5057248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057251">ss</span><span class="op" id="5057253">.</span><span class="ident" id="5057254">Base</span>&nbsp;<span class="op" id="5057259">=</span>&nbsp;<span class="ident" id="5057261">s</span><span class="op" id="5057262">.</span><span class="ident" id="5057263">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057269">files</span>&nbsp;<span class="op" id="5057275">:=</span>&nbsp;<span class="builtinfunc" id="5057278">make</span><span class="op" id="5057282">(</span><span class="op" id="5057283">[</span><span class="op" id="5057284">]</span><span class="ident" id="5057285">serializedFile</span><span class="op" id="5057299">,</span>&nbsp;<span class="builtinfunc" id="5057301">len</span><span class="op" id="5057304">(</span><span class="ident" id="5057305">s</span><span class="op" id="5057306">.</span><span class="ident" id="5057307">files</span><span class="op" id="5057312">)</span><span class="op" id="5057313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5057316">for</span>&nbsp;<span class="ident" id="5057320">i</span><span class="op" id="5057321">,</span>&nbsp;<span class="ident" id="5057323">f</span>&nbsp;<span class="op" id="5057325">:=</span>&nbsp;<span class="keyword" id="5057328">range</span>&nbsp;<span class="ident" id="5057334">s</span><span class="op" id="5057335">.</span><span class="ident" id="5057336">files</span>&nbsp;<span class="op" id="5057342">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057346">files</span><span class="op" id="5057351">[</span><span class="ident" id="5057352">i</span><span class="op" id="5057353">]</span>&nbsp;<span class="op" id="5057355">=</span>&nbsp;<span class="ident" id="5057357">serializedFile</span><span class="op" id="5057371">{</span><span class="ident" id="5057372">f</span><span class="op" id="5057373">.</span><span class="ident" id="5057374">name</span><span class="op" id="5057378">,</span>&nbsp;<span class="ident" id="5057380">f</span><span class="op" id="5057381">.</span><span class="ident" id="5057382">base</span><span class="op" id="5057386">,</span>&nbsp;<span class="ident" id="5057388">f</span><span class="op" id="5057389">.</span><span class="ident" id="5057390">size</span><span class="op" id="5057394">,</span>&nbsp;<span class="ident" id="5057396">f</span><span class="op" id="5057397">.</span><span class="ident" id="5057398">lines</span><span class="op" id="5057403">,</span>&nbsp;<span class="ident" id="5057405">f</span><span class="op" id="5057406">.</span><span class="ident" id="5057407">infos</span><span class="op" id="5057412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5057415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057418">ss</span><span class="op" id="5057420">.</span><span class="ident" id="5057421">Files</span>&nbsp;<span class="op" id="5057427">=</span>&nbsp;<span class="ident" id="5057429">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5057436">s</span><span class="op" id="5057437">.</span><span class="ident" id="5057438">mutex</span><span class="op" id="5057443">.</span><span class="ident" id="5057444">Unlock</span><span class="op" id="5057450">(</span><span class="op" id="5057451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5057455">return</span>&nbsp;<span class="ident" id="5057462">encode</span><span class="op" id="5057468">(</span><span class="ident" id="5057469">ss</span><span class="op" id="5057471">)</span><br>
<span class="lineno"></span><span class="op" id="5057473">}</span>
</div>
</body>
</html>
