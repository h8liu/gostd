<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html" class="current">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1521879">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1521934">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1521988">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1522039">package</span>&nbsp;<span class="ident" id="1522047">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1522056">import</span>&nbsp;<span class="op" id="1522063">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1522066">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1522075">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1522078">func</span>&nbsp;<span class="ident" id="1522083">mapaccess1_fast32</span><span class="op" id="1522100">(</span><span class="ident" id="1522101">t</span>&nbsp;<span class="op" id="1522103">*</span><span class="ident" id="1522104">maptype</span><span class="op" id="1522111">,</span>&nbsp;<span class="ident" id="1522113">h</span>&nbsp;<span class="op" id="1522115">*</span><span class="ident" id="1522116">hmap</span><span class="op" id="1522120">,</span>&nbsp;<span class="ident" id="1522122">key</span>&nbsp;<span class="builtintype" id="1522126">uint32</span><span class="op" id="1522132">)</span>&nbsp;<span class="ident" id="1522134">unsafe</span><span class="op" id="1522140">.</span><span class="ident" id="1522141">Pointer</span>&nbsp;<span class="op" id="1522149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522152">if</span>&nbsp;<span class="ident" id="1522155">raceenabled</span>&nbsp;<span class="op" id="1522167">&amp;&amp;</span>&nbsp;<span class="ident" id="1522170">h</span>&nbsp;<span class="op" id="1522172">!=</span>&nbsp;<span class="builtintype" id="1522175">nil</span>&nbsp;<span class="op" id="1522179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522183">callerpc</span>&nbsp;<span class="op" id="1522192">:=</span>&nbsp;<span class="ident" id="1522195">getcallerpc</span><span class="op" id="1522206">(</span><span class="ident" id="1522207">unsafe</span><span class="op" id="1522213">.</span><span class="ident" id="1522214">Pointer</span><span class="op" id="1522221">(</span><span class="op" id="1522222">&amp;</span><span class="ident" id="1522223">t</span><span class="op" id="1522224">)</span><span class="op" id="1522225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522229">racereadpc</span><span class="op" id="1522239">(</span><span class="ident" id="1522240">unsafe</span><span class="op" id="1522246">.</span><span class="ident" id="1522247">Pointer</span><span class="op" id="1522254">(</span><span class="ident" id="1522255">h</span><span class="op" id="1522256">)</span><span class="op" id="1522257">,</span>&nbsp;<span class="ident" id="1522259">callerpc</span><span class="op" id="1522267">,</span>&nbsp;<span class="ident" id="1522269">funcPC</span><span class="op" id="1522275">(</span><span class="ident" id="1522276">mapaccess1_fast32</span><span class="op" id="1522293">)</span><span class="op" id="1522294">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1522297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522300">if</span>&nbsp;<span class="ident" id="1522303">h</span>&nbsp;<span class="op" id="1522305">==</span>&nbsp;<span class="builtintype" id="1522308">nil</span>&nbsp;<span class="op" id="1522312">||</span>&nbsp;<span class="ident" id="1522315">h</span><span class="op" id="1522316">.</span><span class="ident" id="1522317">count</span>&nbsp;<span class="op" id="1522323">==</span>&nbsp;<span class="num" id="1522326">0</span>&nbsp;<span class="op" id="1522328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522332">return</span>&nbsp;<span class="ident" id="1522339">unsafe</span><span class="op" id="1522345">.</span><span class="ident" id="1522346">Pointer</span><span class="op" id="1522353">(</span><span class="ident" id="1522354">t</span><span class="op" id="1522355">.</span><span class="ident" id="1522356">elem</span><span class="op" id="1522360">.</span><span class="ident" id="1522361">zero</span><span class="op" id="1522365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1522368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522371">var</span>&nbsp;<span class="ident" id="1522375">b</span>&nbsp;<span class="op" id="1522377">*</span><span class="ident" id="1522378">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522384">if</span>&nbsp;<span class="ident" id="1522387">h</span><span class="op" id="1522388">.</span><span class="ident" id="1522389">B</span>&nbsp;<span class="op" id="1522391">==</span>&nbsp;<span class="num" id="1522394">0</span>&nbsp;<span class="op" id="1522396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1522400">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522441">b</span>&nbsp;<span class="op" id="1522443">=</span>&nbsp;<span class="op" id="1522445">(</span><span class="op" id="1522446">*</span><span class="ident" id="1522447">bmap</span><span class="op" id="1522451">)</span><span class="op" id="1522452">(</span><span class="ident" id="1522453">h</span><span class="op" id="1522454">.</span><span class="ident" id="1522455">buckets</span><span class="op" id="1522462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1522465">}</span>&nbsp;<span class="keyword" id="1522467">else</span>&nbsp;<span class="op" id="1522472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522476">hash</span>&nbsp;<span class="op" id="1522481">:=</span>&nbsp;<span class="ident" id="1522484">goalg</span><span class="op" id="1522489">(</span><span class="ident" id="1522490">t</span><span class="op" id="1522491">.</span><span class="ident" id="1522492">key</span><span class="op" id="1522495">.</span><span class="ident" id="1522496">alg</span><span class="op" id="1522499">)</span><span class="op" id="1522500">.</span><span class="ident" id="1522501">hash</span><span class="op" id="1522505">(</span><span class="ident" id="1522506">noescape</span><span class="op" id="1522514">(</span><span class="ident" id="1522515">unsafe</span><span class="op" id="1522521">.</span><span class="ident" id="1522522">Pointer</span><span class="op" id="1522529">(</span><span class="op" id="1522530">&amp;</span><span class="ident" id="1522531">key</span><span class="op" id="1522534">)</span><span class="op" id="1522535">)</span><span class="op" id="1522536">,</span>&nbsp;<span class="num" id="1522538">4</span><span class="op" id="1522539">,</span>&nbsp;<span class="builtintype" id="1522541">uintptr</span><span class="op" id="1522548">(</span><span class="ident" id="1522549">h</span><span class="op" id="1522550">.</span><span class="ident" id="1522551">hash0</span><span class="op" id="1522556">)</span><span class="op" id="1522557">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522561">m</span>&nbsp;<span class="op" id="1522563">:=</span>&nbsp;<span class="builtintype" id="1522566">uintptr</span><span class="op" id="1522573">(</span><span class="num" id="1522574">1</span><span class="op" id="1522575">)</span><span class="op" id="1522576">&lt;&lt;</span><span class="ident" id="1522578">h</span><span class="op" id="1522579">.</span><span class="ident" id="1522580">B</span>&nbsp;<span class="op" id="1522582">-</span>&nbsp;<span class="num" id="1522584">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522588">b</span>&nbsp;<span class="op" id="1522590">=</span>&nbsp;<span class="op" id="1522592">(</span><span class="op" id="1522593">*</span><span class="ident" id="1522594">bmap</span><span class="op" id="1522598">)</span><span class="op" id="1522599">(</span><span class="ident" id="1522600">add</span><span class="op" id="1522603">(</span><span class="ident" id="1522604">h</span><span class="op" id="1522605">.</span><span class="ident" id="1522606">buckets</span><span class="op" id="1522613">,</span>&nbsp;<span class="op" id="1522615">(</span><span class="ident" id="1522616">hash</span><span class="op" id="1522620">&amp;</span><span class="ident" id="1522621">m</span><span class="op" id="1522622">)</span><span class="op" id="1522623">*</span><span class="builtintype" id="1522624">uintptr</span><span class="op" id="1522631">(</span><span class="ident" id="1522632">t</span><span class="op" id="1522633">.</span><span class="ident" id="1522634">bucketsize</span><span class="op" id="1522644">)</span><span class="op" id="1522645">)</span><span class="op" id="1522646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522650">if</span>&nbsp;<span class="ident" id="1522653">c</span>&nbsp;<span class="op" id="1522655">:=</span>&nbsp;<span class="ident" id="1522658">h</span><span class="op" id="1522659">.</span><span class="ident" id="1522660">oldbuckets</span><span class="op" id="1522670">;</span>&nbsp;<span class="ident" id="1522672">c</span>&nbsp;<span class="op" id="1522674">!=</span>&nbsp;<span class="builtintype" id="1522677">nil</span>&nbsp;<span class="op" id="1522681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522686">oldb</span>&nbsp;<span class="op" id="1522691">:=</span>&nbsp;<span class="op" id="1522694">(</span><span class="op" id="1522695">*</span><span class="ident" id="1522696">bmap</span><span class="op" id="1522700">)</span><span class="op" id="1522701">(</span><span class="ident" id="1522702">add</span><span class="op" id="1522705">(</span><span class="ident" id="1522706">c</span><span class="op" id="1522707">,</span>&nbsp;<span class="op" id="1522709">(</span><span class="ident" id="1522710">hash</span><span class="op" id="1522714">&amp;</span><span class="op" id="1522715">(</span><span class="ident" id="1522716">m</span><span class="op" id="1522717">&gt;&gt;</span><span class="num" id="1522719">1</span><span class="op" id="1522720">)</span><span class="op" id="1522721">)</span><span class="op" id="1522722">*</span><span class="builtintype" id="1522723">uintptr</span><span class="op" id="1522730">(</span><span class="ident" id="1522731">t</span><span class="op" id="1522732">.</span><span class="ident" id="1522733">bucketsize</span><span class="op" id="1522743">)</span><span class="op" id="1522744">)</span><span class="op" id="1522745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522750">if</span>&nbsp;<span class="op" id="1522753">!</span><span class="ident" id="1522754">evacuated</span><span class="op" id="1522763">(</span><span class="ident" id="1522764">oldb</span><span class="op" id="1522768">)</span>&nbsp;<span class="op" id="1522770">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522776">b</span>&nbsp;<span class="op" id="1522778">=</span>&nbsp;<span class="ident" id="1522780">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1522788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1522792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1522795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522798">for</span>&nbsp;<span class="op" id="1522802">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522806">for</span>&nbsp;<span class="ident" id="1522810">i</span>&nbsp;<span class="op" id="1522812">:=</span>&nbsp;<span class="builtintype" id="1522815">uintptr</span><span class="op" id="1522822">(</span><span class="num" id="1522823">0</span><span class="op" id="1522824">)</span><span class="op" id="1522825">;</span>&nbsp;<span class="ident" id="1522827">i</span>&nbsp;<span class="op" id="1522829">&lt;</span>&nbsp;<span class="ident" id="1522831">bucketCnt</span><span class="op" id="1522840">;</span>&nbsp;<span class="ident" id="1522842">i</span><span class="op" id="1522843">++</span>&nbsp;<span class="op" id="1522846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522851">k</span>&nbsp;<span class="op" id="1522853">:=</span>&nbsp;<span class="op" id="1522856">*</span><span class="op" id="1522857">(</span><span class="op" id="1522858">(</span><span class="op" id="1522859">*</span><span class="builtintype" id="1522860">uint32</span><span class="op" id="1522866">)</span><span class="op" id="1522867">(</span><span class="ident" id="1522868">add</span><span class="op" id="1522871">(</span><span class="ident" id="1522872">unsafe</span><span class="op" id="1522878">.</span><span class="ident" id="1522879">Pointer</span><span class="op" id="1522886">(</span><span class="ident" id="1522887">b</span><span class="op" id="1522888">)</span><span class="op" id="1522889">,</span>&nbsp;<span class="ident" id="1522891">dataOffset</span><span class="op" id="1522901">+</span><span class="ident" id="1522902">i</span><span class="op" id="1522903">*</span><span class="num" id="1522904">4</span><span class="op" id="1522905">)</span><span class="op" id="1522906">)</span><span class="op" id="1522907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522912">if</span>&nbsp;<span class="ident" id="1522915">k</span>&nbsp;<span class="op" id="1522917">!=</span>&nbsp;<span class="ident" id="1522920">key</span>&nbsp;<span class="op" id="1522924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1522930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1522942">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1522947">x</span>&nbsp;<span class="op" id="1522949">:=</span>&nbsp;<span class="op" id="1522952">*</span><span class="op" id="1522953">(</span><span class="op" id="1522954">(</span><span class="op" id="1522955">*</span><span class="builtintype" id="1522956">uint8</span><span class="op" id="1522961">)</span><span class="op" id="1522962">(</span><span class="ident" id="1522963">add</span><span class="op" id="1522966">(</span><span class="ident" id="1522967">unsafe</span><span class="op" id="1522973">.</span><span class="ident" id="1522974">Pointer</span><span class="op" id="1522981">(</span><span class="ident" id="1522982">b</span><span class="op" id="1522983">)</span><span class="op" id="1522984">,</span>&nbsp;<span class="ident" id="1522986">i</span><span class="op" id="1522987">)</span><span class="op" id="1522988">)</span><span class="op" id="1522989">)</span>&nbsp;<span class="comment" id="1522991">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523035">if</span>&nbsp;<span class="ident" id="1523038">x</span>&nbsp;<span class="op" id="1523040">==</span>&nbsp;<span class="ident" id="1523043">empty</span>&nbsp;<span class="op" id="1523049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523055">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523072">return</span>&nbsp;<span class="ident" id="1523079">add</span><span class="op" id="1523082">(</span><span class="ident" id="1523083">unsafe</span><span class="op" id="1523089">.</span><span class="ident" id="1523090">Pointer</span><span class="op" id="1523097">(</span><span class="ident" id="1523098">b</span><span class="op" id="1523099">)</span><span class="op" id="1523100">,</span>&nbsp;<span class="ident" id="1523102">dataOffset</span><span class="op" id="1523112">+</span><span class="ident" id="1523113">bucketCnt</span><span class="op" id="1523122">*</span><span class="num" id="1523123">4</span><span class="op" id="1523124">+</span><span class="ident" id="1523125">i</span><span class="op" id="1523126">*</span><span class="builtintype" id="1523127">uintptr</span><span class="op" id="1523134">(</span><span class="ident" id="1523135">t</span><span class="op" id="1523136">.</span><span class="ident" id="1523137">valuesize</span><span class="op" id="1523146">)</span><span class="op" id="1523147">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523155">b</span>&nbsp;<span class="op" id="1523157">=</span>&nbsp;<span class="ident" id="1523159">b</span><span class="op" id="1523160">.</span><span class="ident" id="1523161">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523172">if</span>&nbsp;<span class="ident" id="1523175">b</span>&nbsp;<span class="op" id="1523177">==</span>&nbsp;<span class="builtintype" id="1523180">nil</span>&nbsp;<span class="op" id="1523184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523189">return</span>&nbsp;<span class="ident" id="1523196">unsafe</span><span class="op" id="1523202">.</span><span class="ident" id="1523203">Pointer</span><span class="op" id="1523210">(</span><span class="ident" id="1523211">t</span><span class="op" id="1523212">.</span><span class="ident" id="1523213">elem</span><span class="op" id="1523217">.</span><span class="ident" id="1523218">zero</span><span class="op" id="1523222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523226">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523229">}</span><br>
<span class="lineno"></span><span class="op" id="1523231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1523234">func</span>&nbsp;<span class="ident" id="1523239">mapaccess2_fast32</span><span class="op" id="1523256">(</span><span class="ident" id="1523257">t</span>&nbsp;<span class="op" id="1523259">*</span><span class="ident" id="1523260">maptype</span><span class="op" id="1523267">,</span>&nbsp;<span class="ident" id="1523269">h</span>&nbsp;<span class="op" id="1523271">*</span><span class="ident" id="1523272">hmap</span><span class="op" id="1523276">,</span>&nbsp;<span class="ident" id="1523278">key</span>&nbsp;<span class="builtintype" id="1523282">uint32</span><span class="op" id="1523288">)</span>&nbsp;<span class="op" id="1523290">(</span><span class="ident" id="1523291">unsafe</span><span class="op" id="1523297">.</span><span class="ident" id="1523298">Pointer</span><span class="op" id="1523305">,</span>&nbsp;<span class="builtintype" id="1523307">bool</span><span class="op" id="1523311">)</span>&nbsp;<span class="op" id="1523313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523316">if</span>&nbsp;<span class="ident" id="1523319">raceenabled</span>&nbsp;<span class="op" id="1523331">&amp;&amp;</span>&nbsp;<span class="ident" id="1523334">h</span>&nbsp;<span class="op" id="1523336">!=</span>&nbsp;<span class="builtintype" id="1523339">nil</span>&nbsp;<span class="op" id="1523343">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523347">callerpc</span>&nbsp;<span class="op" id="1523356">:=</span>&nbsp;<span class="ident" id="1523359">getcallerpc</span><span class="op" id="1523370">(</span><span class="ident" id="1523371">unsafe</span><span class="op" id="1523377">.</span><span class="ident" id="1523378">Pointer</span><span class="op" id="1523385">(</span><span class="op" id="1523386">&amp;</span><span class="ident" id="1523387">t</span><span class="op" id="1523388">)</span><span class="op" id="1523389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523393">racereadpc</span><span class="op" id="1523403">(</span><span class="ident" id="1523404">unsafe</span><span class="op" id="1523410">.</span><span class="ident" id="1523411">Pointer</span><span class="op" id="1523418">(</span><span class="ident" id="1523419">h</span><span class="op" id="1523420">)</span><span class="op" id="1523421">,</span>&nbsp;<span class="ident" id="1523423">callerpc</span><span class="op" id="1523431">,</span>&nbsp;<span class="ident" id="1523433">funcPC</span><span class="op" id="1523439">(</span><span class="ident" id="1523440">mapaccess2_fast32</span><span class="op" id="1523457">)</span><span class="op" id="1523458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523464">if</span>&nbsp;<span class="ident" id="1523467">h</span>&nbsp;<span class="op" id="1523469">==</span>&nbsp;<span class="builtintype" id="1523472">nil</span>&nbsp;<span class="op" id="1523476">||</span>&nbsp;<span class="ident" id="1523479">h</span><span class="op" id="1523480">.</span><span class="ident" id="1523481">count</span>&nbsp;<span class="op" id="1523487">==</span>&nbsp;<span class="num" id="1523490">0</span>&nbsp;<span class="op" id="1523492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523496">return</span>&nbsp;<span class="ident" id="1523503">unsafe</span><span class="op" id="1523509">.</span><span class="ident" id="1523510">Pointer</span><span class="op" id="1523517">(</span><span class="ident" id="1523518">t</span><span class="op" id="1523519">.</span><span class="ident" id="1523520">elem</span><span class="op" id="1523524">.</span><span class="ident" id="1523525">zero</span><span class="op" id="1523529">)</span><span class="op" id="1523530">,</span>&nbsp;<span class="builtintype" id="1523532">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523542">var</span>&nbsp;<span class="ident" id="1523546">b</span>&nbsp;<span class="op" id="1523548">*</span><span class="ident" id="1523549">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523555">if</span>&nbsp;<span class="ident" id="1523558">h</span><span class="op" id="1523559">.</span><span class="ident" id="1523560">B</span>&nbsp;<span class="op" id="1523562">==</span>&nbsp;<span class="num" id="1523565">0</span>&nbsp;<span class="op" id="1523567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1523571">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523612">b</span>&nbsp;<span class="op" id="1523614">=</span>&nbsp;<span class="op" id="1523616">(</span><span class="op" id="1523617">*</span><span class="ident" id="1523618">bmap</span><span class="op" id="1523622">)</span><span class="op" id="1523623">(</span><span class="ident" id="1523624">h</span><span class="op" id="1523625">.</span><span class="ident" id="1523626">buckets</span><span class="op" id="1523633">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523636">}</span>&nbsp;<span class="keyword" id="1523638">else</span>&nbsp;<span class="op" id="1523643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523647">hash</span>&nbsp;<span class="op" id="1523652">:=</span>&nbsp;<span class="ident" id="1523655">goalg</span><span class="op" id="1523660">(</span><span class="ident" id="1523661">t</span><span class="op" id="1523662">.</span><span class="ident" id="1523663">key</span><span class="op" id="1523666">.</span><span class="ident" id="1523667">alg</span><span class="op" id="1523670">)</span><span class="op" id="1523671">.</span><span class="ident" id="1523672">hash</span><span class="op" id="1523676">(</span><span class="ident" id="1523677">noescape</span><span class="op" id="1523685">(</span><span class="ident" id="1523686">unsafe</span><span class="op" id="1523692">.</span><span class="ident" id="1523693">Pointer</span><span class="op" id="1523700">(</span><span class="op" id="1523701">&amp;</span><span class="ident" id="1523702">key</span><span class="op" id="1523705">)</span><span class="op" id="1523706">)</span><span class="op" id="1523707">,</span>&nbsp;<span class="num" id="1523709">4</span><span class="op" id="1523710">,</span>&nbsp;<span class="builtintype" id="1523712">uintptr</span><span class="op" id="1523719">(</span><span class="ident" id="1523720">h</span><span class="op" id="1523721">.</span><span class="ident" id="1523722">hash0</span><span class="op" id="1523727">)</span><span class="op" id="1523728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523732">m</span>&nbsp;<span class="op" id="1523734">:=</span>&nbsp;<span class="builtintype" id="1523737">uintptr</span><span class="op" id="1523744">(</span><span class="num" id="1523745">1</span><span class="op" id="1523746">)</span><span class="op" id="1523747">&lt;&lt;</span><span class="ident" id="1523749">h</span><span class="op" id="1523750">.</span><span class="ident" id="1523751">B</span>&nbsp;<span class="op" id="1523753">-</span>&nbsp;<span class="num" id="1523755">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523759">b</span>&nbsp;<span class="op" id="1523761">=</span>&nbsp;<span class="op" id="1523763">(</span><span class="op" id="1523764">*</span><span class="ident" id="1523765">bmap</span><span class="op" id="1523769">)</span><span class="op" id="1523770">(</span><span class="ident" id="1523771">add</span><span class="op" id="1523774">(</span><span class="ident" id="1523775">h</span><span class="op" id="1523776">.</span><span class="ident" id="1523777">buckets</span><span class="op" id="1523784">,</span>&nbsp;<span class="op" id="1523786">(</span><span class="ident" id="1523787">hash</span><span class="op" id="1523791">&amp;</span><span class="ident" id="1523792">m</span><span class="op" id="1523793">)</span><span class="op" id="1523794">*</span><span class="builtintype" id="1523795">uintptr</span><span class="op" id="1523802">(</span><span class="ident" id="1523803">t</span><span class="op" id="1523804">.</span><span class="ident" id="1523805">bucketsize</span><span class="op" id="1523815">)</span><span class="op" id="1523816">)</span><span class="op" id="1523817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523821">if</span>&nbsp;<span class="ident" id="1523824">c</span>&nbsp;<span class="op" id="1523826">:=</span>&nbsp;<span class="ident" id="1523829">h</span><span class="op" id="1523830">.</span><span class="ident" id="1523831">oldbuckets</span><span class="op" id="1523841">;</span>&nbsp;<span class="ident" id="1523843">c</span>&nbsp;<span class="op" id="1523845">!=</span>&nbsp;<span class="builtintype" id="1523848">nil</span>&nbsp;<span class="op" id="1523852">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523857">oldb</span>&nbsp;<span class="op" id="1523862">:=</span>&nbsp;<span class="op" id="1523865">(</span><span class="op" id="1523866">*</span><span class="ident" id="1523867">bmap</span><span class="op" id="1523871">)</span><span class="op" id="1523872">(</span><span class="ident" id="1523873">add</span><span class="op" id="1523876">(</span><span class="ident" id="1523877">c</span><span class="op" id="1523878">,</span>&nbsp;<span class="op" id="1523880">(</span><span class="ident" id="1523881">hash</span><span class="op" id="1523885">&amp;</span><span class="op" id="1523886">(</span><span class="ident" id="1523887">m</span><span class="op" id="1523888">&gt;&gt;</span><span class="num" id="1523890">1</span><span class="op" id="1523891">)</span><span class="op" id="1523892">)</span><span class="op" id="1523893">*</span><span class="builtintype" id="1523894">uintptr</span><span class="op" id="1523901">(</span><span class="ident" id="1523902">t</span><span class="op" id="1523903">.</span><span class="ident" id="1523904">bucketsize</span><span class="op" id="1523914">)</span><span class="op" id="1523915">)</span><span class="op" id="1523916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523921">if</span>&nbsp;<span class="op" id="1523924">!</span><span class="ident" id="1523925">evacuated</span><span class="op" id="1523934">(</span><span class="ident" id="1523935">oldb</span><span class="op" id="1523939">)</span>&nbsp;<span class="op" id="1523941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1523947">b</span>&nbsp;<span class="op" id="1523949">=</span>&nbsp;<span class="ident" id="1523951">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523963">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1523966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523969">for</span>&nbsp;<span class="op" id="1523973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1523977">for</span>&nbsp;<span class="ident" id="1523981">i</span>&nbsp;<span class="op" id="1523983">:=</span>&nbsp;<span class="builtintype" id="1523986">uintptr</span><span class="op" id="1523993">(</span><span class="num" id="1523994">0</span><span class="op" id="1523995">)</span><span class="op" id="1523996">;</span>&nbsp;<span class="ident" id="1523998">i</span>&nbsp;<span class="op" id="1524000">&lt;</span>&nbsp;<span class="ident" id="1524002">bucketCnt</span><span class="op" id="1524011">;</span>&nbsp;<span class="ident" id="1524013">i</span><span class="op" id="1524014">++</span>&nbsp;<span class="op" id="1524017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524022">k</span>&nbsp;<span class="op" id="1524024">:=</span>&nbsp;<span class="op" id="1524027">*</span><span class="op" id="1524028">(</span><span class="op" id="1524029">(</span><span class="op" id="1524030">*</span><span class="builtintype" id="1524031">uint32</span><span class="op" id="1524037">)</span><span class="op" id="1524038">(</span><span class="ident" id="1524039">add</span><span class="op" id="1524042">(</span><span class="ident" id="1524043">unsafe</span><span class="op" id="1524049">.</span><span class="ident" id="1524050">Pointer</span><span class="op" id="1524057">(</span><span class="ident" id="1524058">b</span><span class="op" id="1524059">)</span><span class="op" id="1524060">,</span>&nbsp;<span class="ident" id="1524062">dataOffset</span><span class="op" id="1524072">+</span><span class="ident" id="1524073">i</span><span class="op" id="1524074">*</span><span class="num" id="1524075">4</span><span class="op" id="1524076">)</span><span class="op" id="1524077">)</span><span class="op" id="1524078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524083">if</span>&nbsp;<span class="ident" id="1524086">k</span>&nbsp;<span class="op" id="1524088">!=</span>&nbsp;<span class="ident" id="1524091">key</span>&nbsp;<span class="op" id="1524095">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524101">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524118">x</span>&nbsp;<span class="op" id="1524120">:=</span>&nbsp;<span class="op" id="1524123">*</span><span class="op" id="1524124">(</span><span class="op" id="1524125">(</span><span class="op" id="1524126">*</span><span class="builtintype" id="1524127">uint8</span><span class="op" id="1524132">)</span><span class="op" id="1524133">(</span><span class="ident" id="1524134">add</span><span class="op" id="1524137">(</span><span class="ident" id="1524138">unsafe</span><span class="op" id="1524144">.</span><span class="ident" id="1524145">Pointer</span><span class="op" id="1524152">(</span><span class="ident" id="1524153">b</span><span class="op" id="1524154">)</span><span class="op" id="1524155">,</span>&nbsp;<span class="ident" id="1524157">i</span><span class="op" id="1524158">)</span><span class="op" id="1524159">)</span><span class="op" id="1524160">)</span>&nbsp;<span class="comment" id="1524162">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524206">if</span>&nbsp;<span class="ident" id="1524209">x</span>&nbsp;<span class="op" id="1524211">==</span>&nbsp;<span class="ident" id="1524214">empty</span>&nbsp;<span class="op" id="1524220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524226">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524243">return</span>&nbsp;<span class="ident" id="1524250">add</span><span class="op" id="1524253">(</span><span class="ident" id="1524254">unsafe</span><span class="op" id="1524260">.</span><span class="ident" id="1524261">Pointer</span><span class="op" id="1524268">(</span><span class="ident" id="1524269">b</span><span class="op" id="1524270">)</span><span class="op" id="1524271">,</span>&nbsp;<span class="ident" id="1524273">dataOffset</span><span class="op" id="1524283">+</span><span class="ident" id="1524284">bucketCnt</span><span class="op" id="1524293">*</span><span class="num" id="1524294">4</span><span class="op" id="1524295">+</span><span class="ident" id="1524296">i</span><span class="op" id="1524297">*</span><span class="builtintype" id="1524298">uintptr</span><span class="op" id="1524305">(</span><span class="ident" id="1524306">t</span><span class="op" id="1524307">.</span><span class="ident" id="1524308">valuesize</span><span class="op" id="1524317">)</span><span class="op" id="1524318">)</span><span class="op" id="1524319">,</span>&nbsp;<span class="builtintype" id="1524321">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524332">b</span>&nbsp;<span class="op" id="1524334">=</span>&nbsp;<span class="ident" id="1524336">b</span><span class="op" id="1524337">.</span><span class="ident" id="1524338">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524349">if</span>&nbsp;<span class="ident" id="1524352">b</span>&nbsp;<span class="op" id="1524354">==</span>&nbsp;<span class="builtintype" id="1524357">nil</span>&nbsp;<span class="op" id="1524361">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524366">return</span>&nbsp;<span class="ident" id="1524373">unsafe</span><span class="op" id="1524379">.</span><span class="ident" id="1524380">Pointer</span><span class="op" id="1524387">(</span><span class="ident" id="1524388">t</span><span class="op" id="1524389">.</span><span class="ident" id="1524390">elem</span><span class="op" id="1524394">.</span><span class="ident" id="1524395">zero</span><span class="op" id="1524399">)</span><span class="op" id="1524400">,</span>&nbsp;<span class="builtintype" id="1524402">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524413">}</span><br>
<span class="lineno"></span><span class="op" id="1524415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1524418">func</span>&nbsp;<span class="ident" id="1524423">mapaccess1_fast64</span><span class="op" id="1524440">(</span><span class="ident" id="1524441">t</span>&nbsp;<span class="op" id="1524443">*</span><span class="ident" id="1524444">maptype</span><span class="op" id="1524451">,</span>&nbsp;<span class="ident" id="1524453">h</span>&nbsp;<span class="op" id="1524455">*</span><span class="ident" id="1524456">hmap</span><span class="op" id="1524460">,</span>&nbsp;<span class="ident" id="1524462">key</span>&nbsp;<span class="ident" id="1524466">uint64</span><span class="op" id="1524472">)</span>&nbsp;<span class="ident" id="1524474">unsafe</span><span class="op" id="1524480">.</span><span class="ident" id="1524481">Pointer</span>&nbsp;<span class="op" id="1524489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524492">if</span>&nbsp;<span class="ident" id="1524495">raceenabled</span>&nbsp;<span class="op" id="1524507">&amp;&amp;</span>&nbsp;<span class="ident" id="1524510">h</span>&nbsp;<span class="op" id="1524512">!=</span>&nbsp;<span class="builtintype" id="1524515">nil</span>&nbsp;<span class="op" id="1524519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524523">callerpc</span>&nbsp;<span class="op" id="1524532">:=</span>&nbsp;<span class="ident" id="1524535">getcallerpc</span><span class="op" id="1524546">(</span><span class="ident" id="1524547">unsafe</span><span class="op" id="1524553">.</span><span class="ident" id="1524554">Pointer</span><span class="op" id="1524561">(</span><span class="op" id="1524562">&amp;</span><span class="ident" id="1524563">t</span><span class="op" id="1524564">)</span><span class="op" id="1524565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524569">racereadpc</span><span class="op" id="1524579">(</span><span class="ident" id="1524580">unsafe</span><span class="op" id="1524586">.</span><span class="ident" id="1524587">Pointer</span><span class="op" id="1524594">(</span><span class="ident" id="1524595">h</span><span class="op" id="1524596">)</span><span class="op" id="1524597">,</span>&nbsp;<span class="ident" id="1524599">callerpc</span><span class="op" id="1524607">,</span>&nbsp;<span class="ident" id="1524609">funcPC</span><span class="op" id="1524615">(</span><span class="ident" id="1524616">mapaccess1_fast64</span><span class="op" id="1524633">)</span><span class="op" id="1524634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524637">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524640">if</span>&nbsp;<span class="ident" id="1524643">h</span>&nbsp;<span class="op" id="1524645">==</span>&nbsp;<span class="builtintype" id="1524648">nil</span>&nbsp;<span class="op" id="1524652">||</span>&nbsp;<span class="ident" id="1524655">h</span><span class="op" id="1524656">.</span><span class="ident" id="1524657">count</span>&nbsp;<span class="op" id="1524663">==</span>&nbsp;<span class="num" id="1524666">0</span>&nbsp;<span class="op" id="1524668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524672">return</span>&nbsp;<span class="ident" id="1524679">unsafe</span><span class="op" id="1524685">.</span><span class="ident" id="1524686">Pointer</span><span class="op" id="1524693">(</span><span class="ident" id="1524694">t</span><span class="op" id="1524695">.</span><span class="ident" id="1524696">elem</span><span class="op" id="1524700">.</span><span class="ident" id="1524701">zero</span><span class="op" id="1524705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524711">var</span>&nbsp;<span class="ident" id="1524715">b</span>&nbsp;<span class="op" id="1524717">*</span><span class="ident" id="1524718">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524724">if</span>&nbsp;<span class="ident" id="1524727">h</span><span class="op" id="1524728">.</span><span class="ident" id="1524729">B</span>&nbsp;<span class="op" id="1524731">==</span>&nbsp;<span class="num" id="1524734">0</span>&nbsp;<span class="op" id="1524736">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1524740">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524781">b</span>&nbsp;<span class="op" id="1524783">=</span>&nbsp;<span class="op" id="1524785">(</span><span class="op" id="1524786">*</span><span class="ident" id="1524787">bmap</span><span class="op" id="1524791">)</span><span class="op" id="1524792">(</span><span class="ident" id="1524793">h</span><span class="op" id="1524794">.</span><span class="ident" id="1524795">buckets</span><span class="op" id="1524802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1524805">}</span>&nbsp;<span class="keyword" id="1524807">else</span>&nbsp;<span class="op" id="1524812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524816">hash</span>&nbsp;<span class="op" id="1524821">:=</span>&nbsp;<span class="ident" id="1524824">goalg</span><span class="op" id="1524829">(</span><span class="ident" id="1524830">t</span><span class="op" id="1524831">.</span><span class="ident" id="1524832">key</span><span class="op" id="1524835">.</span><span class="ident" id="1524836">alg</span><span class="op" id="1524839">)</span><span class="op" id="1524840">.</span><span class="ident" id="1524841">hash</span><span class="op" id="1524845">(</span><span class="ident" id="1524846">noescape</span><span class="op" id="1524854">(</span><span class="ident" id="1524855">unsafe</span><span class="op" id="1524861">.</span><span class="ident" id="1524862">Pointer</span><span class="op" id="1524869">(</span><span class="op" id="1524870">&amp;</span><span class="ident" id="1524871">key</span><span class="op" id="1524874">)</span><span class="op" id="1524875">)</span><span class="op" id="1524876">,</span>&nbsp;<span class="num" id="1524878">8</span><span class="op" id="1524879">,</span>&nbsp;<span class="builtintype" id="1524881">uintptr</span><span class="op" id="1524888">(</span><span class="ident" id="1524889">h</span><span class="op" id="1524890">.</span><span class="ident" id="1524891">hash0</span><span class="op" id="1524896">)</span><span class="op" id="1524897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524901">m</span>&nbsp;<span class="op" id="1524903">:=</span>&nbsp;<span class="builtintype" id="1524906">uintptr</span><span class="op" id="1524913">(</span><span class="num" id="1524914">1</span><span class="op" id="1524915">)</span><span class="op" id="1524916">&lt;&lt;</span><span class="ident" id="1524918">h</span><span class="op" id="1524919">.</span><span class="ident" id="1524920">B</span>&nbsp;<span class="op" id="1524922">-</span>&nbsp;<span class="num" id="1524924">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1524928">b</span>&nbsp;<span class="op" id="1524930">=</span>&nbsp;<span class="op" id="1524932">(</span><span class="op" id="1524933">*</span><span class="ident" id="1524934">bmap</span><span class="op" id="1524938">)</span><span class="op" id="1524939">(</span><span class="ident" id="1524940">add</span><span class="op" id="1524943">(</span><span class="ident" id="1524944">h</span><span class="op" id="1524945">.</span><span class="ident" id="1524946">buckets</span><span class="op" id="1524953">,</span>&nbsp;<span class="op" id="1524955">(</span><span class="ident" id="1524956">hash</span><span class="op" id="1524960">&amp;</span><span class="ident" id="1524961">m</span><span class="op" id="1524962">)</span><span class="op" id="1524963">*</span><span class="builtintype" id="1524964">uintptr</span><span class="op" id="1524971">(</span><span class="ident" id="1524972">t</span><span class="op" id="1524973">.</span><span class="ident" id="1524974">bucketsize</span><span class="op" id="1524984">)</span><span class="op" id="1524985">)</span><span class="op" id="1524986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1524990">if</span>&nbsp;<span class="ident" id="1524993">c</span>&nbsp;<span class="op" id="1524995">:=</span>&nbsp;<span class="ident" id="1524998">h</span><span class="op" id="1524999">.</span><span class="ident" id="1525000">oldbuckets</span><span class="op" id="1525010">;</span>&nbsp;<span class="ident" id="1525012">c</span>&nbsp;<span class="op" id="1525014">!=</span>&nbsp;<span class="builtintype" id="1525017">nil</span>&nbsp;<span class="op" id="1525021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525026">oldb</span>&nbsp;<span class="op" id="1525031">:=</span>&nbsp;<span class="op" id="1525034">(</span><span class="op" id="1525035">*</span><span class="ident" id="1525036">bmap</span><span class="op" id="1525040">)</span><span class="op" id="1525041">(</span><span class="ident" id="1525042">add</span><span class="op" id="1525045">(</span><span class="ident" id="1525046">c</span><span class="op" id="1525047">,</span>&nbsp;<span class="op" id="1525049">(</span><span class="ident" id="1525050">hash</span><span class="op" id="1525054">&amp;</span><span class="op" id="1525055">(</span><span class="ident" id="1525056">m</span><span class="op" id="1525057">&gt;&gt;</span><span class="num" id="1525059">1</span><span class="op" id="1525060">)</span><span class="op" id="1525061">)</span><span class="op" id="1525062">*</span><span class="builtintype" id="1525063">uintptr</span><span class="op" id="1525070">(</span><span class="ident" id="1525071">t</span><span class="op" id="1525072">.</span><span class="ident" id="1525073">bucketsize</span><span class="op" id="1525083">)</span><span class="op" id="1525084">)</span><span class="op" id="1525085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525090">if</span>&nbsp;<span class="op" id="1525093">!</span><span class="ident" id="1525094">evacuated</span><span class="op" id="1525103">(</span><span class="ident" id="1525104">oldb</span><span class="op" id="1525108">)</span>&nbsp;<span class="op" id="1525110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525116">b</span>&nbsp;<span class="op" id="1525118">=</span>&nbsp;<span class="ident" id="1525120">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525138">for</span>&nbsp;<span class="op" id="1525142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525146">for</span>&nbsp;<span class="ident" id="1525150">i</span>&nbsp;<span class="op" id="1525152">:=</span>&nbsp;<span class="builtintype" id="1525155">uintptr</span><span class="op" id="1525162">(</span><span class="num" id="1525163">0</span><span class="op" id="1525164">)</span><span class="op" id="1525165">;</span>&nbsp;<span class="ident" id="1525167">i</span>&nbsp;<span class="op" id="1525169">&lt;</span>&nbsp;<span class="ident" id="1525171">bucketCnt</span><span class="op" id="1525180">;</span>&nbsp;<span class="ident" id="1525182">i</span><span class="op" id="1525183">++</span>&nbsp;<span class="op" id="1525186">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525191">k</span>&nbsp;<span class="op" id="1525193">:=</span>&nbsp;<span class="op" id="1525196">*</span><span class="op" id="1525197">(</span><span class="op" id="1525198">(</span><span class="op" id="1525199">*</span><span class="ident" id="1525200">uint64</span><span class="op" id="1525206">)</span><span class="op" id="1525207">(</span><span class="ident" id="1525208">add</span><span class="op" id="1525211">(</span><span class="ident" id="1525212">unsafe</span><span class="op" id="1525218">.</span><span class="ident" id="1525219">Pointer</span><span class="op" id="1525226">(</span><span class="ident" id="1525227">b</span><span class="op" id="1525228">)</span><span class="op" id="1525229">,</span>&nbsp;<span class="ident" id="1525231">dataOffset</span><span class="op" id="1525241">+</span><span class="ident" id="1525242">i</span><span class="op" id="1525243">*</span><span class="num" id="1525244">8</span><span class="op" id="1525245">)</span><span class="op" id="1525246">)</span><span class="op" id="1525247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525252">if</span>&nbsp;<span class="ident" id="1525255">k</span>&nbsp;<span class="op" id="1525257">!=</span>&nbsp;<span class="ident" id="1525260">key</span>&nbsp;<span class="op" id="1525264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525270">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525287">x</span>&nbsp;<span class="op" id="1525289">:=</span>&nbsp;<span class="op" id="1525292">*</span><span class="op" id="1525293">(</span><span class="op" id="1525294">(</span><span class="op" id="1525295">*</span><span class="builtintype" id="1525296">uint8</span><span class="op" id="1525301">)</span><span class="op" id="1525302">(</span><span class="ident" id="1525303">add</span><span class="op" id="1525306">(</span><span class="ident" id="1525307">unsafe</span><span class="op" id="1525313">.</span><span class="ident" id="1525314">Pointer</span><span class="op" id="1525321">(</span><span class="ident" id="1525322">b</span><span class="op" id="1525323">)</span><span class="op" id="1525324">,</span>&nbsp;<span class="ident" id="1525326">i</span><span class="op" id="1525327">)</span><span class="op" id="1525328">)</span><span class="op" id="1525329">)</span>&nbsp;<span class="comment" id="1525331">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525375">if</span>&nbsp;<span class="ident" id="1525378">x</span>&nbsp;<span class="op" id="1525380">==</span>&nbsp;<span class="ident" id="1525383">empty</span>&nbsp;<span class="op" id="1525389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525395">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525412">return</span>&nbsp;<span class="ident" id="1525419">add</span><span class="op" id="1525422">(</span><span class="ident" id="1525423">unsafe</span><span class="op" id="1525429">.</span><span class="ident" id="1525430">Pointer</span><span class="op" id="1525437">(</span><span class="ident" id="1525438">b</span><span class="op" id="1525439">)</span><span class="op" id="1525440">,</span>&nbsp;<span class="ident" id="1525442">dataOffset</span><span class="op" id="1525452">+</span><span class="ident" id="1525453">bucketCnt</span><span class="op" id="1525462">*</span><span class="num" id="1525463">8</span><span class="op" id="1525464">+</span><span class="ident" id="1525465">i</span><span class="op" id="1525466">*</span><span class="builtintype" id="1525467">uintptr</span><span class="op" id="1525474">(</span><span class="ident" id="1525475">t</span><span class="op" id="1525476">.</span><span class="ident" id="1525477">valuesize</span><span class="op" id="1525486">)</span><span class="op" id="1525487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525491">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525495">b</span>&nbsp;<span class="op" id="1525497">=</span>&nbsp;<span class="ident" id="1525499">b</span><span class="op" id="1525500">.</span><span class="ident" id="1525501">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525512">if</span>&nbsp;<span class="ident" id="1525515">b</span>&nbsp;<span class="op" id="1525517">==</span>&nbsp;<span class="builtintype" id="1525520">nil</span>&nbsp;<span class="op" id="1525524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525529">return</span>&nbsp;<span class="ident" id="1525536">unsafe</span><span class="op" id="1525542">.</span><span class="ident" id="1525543">Pointer</span><span class="op" id="1525550">(</span><span class="ident" id="1525551">t</span><span class="op" id="1525552">.</span><span class="ident" id="1525553">elem</span><span class="op" id="1525557">.</span><span class="ident" id="1525558">zero</span><span class="op" id="1525562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525569">}</span><br>
<span class="lineno">135</span><span class="op" id="1525571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1525574">func</span>&nbsp;<span class="ident" id="1525579">mapaccess2_fast64</span><span class="op" id="1525596">(</span><span class="ident" id="1525597">t</span>&nbsp;<span class="op" id="1525599">*</span><span class="ident" id="1525600">maptype</span><span class="op" id="1525607">,</span>&nbsp;<span class="ident" id="1525609">h</span>&nbsp;<span class="op" id="1525611">*</span><span class="ident" id="1525612">hmap</span><span class="op" id="1525616">,</span>&nbsp;<span class="ident" id="1525618">key</span>&nbsp;<span class="ident" id="1525622">uint64</span><span class="op" id="1525628">)</span>&nbsp;<span class="op" id="1525630">(</span><span class="ident" id="1525631">unsafe</span><span class="op" id="1525637">.</span><span class="ident" id="1525638">Pointer</span><span class="op" id="1525645">,</span>&nbsp;<span class="builtintype" id="1525647">bool</span><span class="op" id="1525651">)</span>&nbsp;<span class="op" id="1525653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525656">if</span>&nbsp;<span class="ident" id="1525659">raceenabled</span>&nbsp;<span class="op" id="1525671">&amp;&amp;</span>&nbsp;<span class="ident" id="1525674">h</span>&nbsp;<span class="op" id="1525676">!=</span>&nbsp;<span class="builtintype" id="1525679">nil</span>&nbsp;<span class="op" id="1525683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525687">callerpc</span>&nbsp;<span class="op" id="1525696">:=</span>&nbsp;<span class="ident" id="1525699">getcallerpc</span><span class="op" id="1525710">(</span><span class="ident" id="1525711">unsafe</span><span class="op" id="1525717">.</span><span class="ident" id="1525718">Pointer</span><span class="op" id="1525725">(</span><span class="op" id="1525726">&amp;</span><span class="ident" id="1525727">t</span><span class="op" id="1525728">)</span><span class="op" id="1525729">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525733">racereadpc</span><span class="op" id="1525743">(</span><span class="ident" id="1525744">unsafe</span><span class="op" id="1525750">.</span><span class="ident" id="1525751">Pointer</span><span class="op" id="1525758">(</span><span class="ident" id="1525759">h</span><span class="op" id="1525760">)</span><span class="op" id="1525761">,</span>&nbsp;<span class="ident" id="1525763">callerpc</span><span class="op" id="1525771">,</span>&nbsp;<span class="ident" id="1525773">funcPC</span><span class="op" id="1525779">(</span><span class="ident" id="1525780">mapaccess2_fast64</span><span class="op" id="1525797">)</span><span class="op" id="1525798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525804">if</span>&nbsp;<span class="ident" id="1525807">h</span>&nbsp;<span class="op" id="1525809">==</span>&nbsp;<span class="builtintype" id="1525812">nil</span>&nbsp;<span class="op" id="1525816">||</span>&nbsp;<span class="ident" id="1525819">h</span><span class="op" id="1525820">.</span><span class="ident" id="1525821">count</span>&nbsp;<span class="op" id="1525827">==</span>&nbsp;<span class="num" id="1525830">0</span>&nbsp;<span class="op" id="1525832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525836">return</span>&nbsp;<span class="ident" id="1525843">unsafe</span><span class="op" id="1525849">.</span><span class="ident" id="1525850">Pointer</span><span class="op" id="1525857">(</span><span class="ident" id="1525858">t</span><span class="op" id="1525859">.</span><span class="ident" id="1525860">elem</span><span class="op" id="1525864">.</span><span class="ident" id="1525865">zero</span><span class="op" id="1525869">)</span><span class="op" id="1525870">,</span>&nbsp;<span class="builtintype" id="1525872">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525879">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525882">var</span>&nbsp;<span class="ident" id="1525886">b</span>&nbsp;<span class="op" id="1525888">*</span><span class="ident" id="1525889">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1525895">if</span>&nbsp;<span class="ident" id="1525898">h</span><span class="op" id="1525899">.</span><span class="ident" id="1525900">B</span>&nbsp;<span class="op" id="1525902">==</span>&nbsp;<span class="num" id="1525905">0</span>&nbsp;<span class="op" id="1525907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1525911">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525952">b</span>&nbsp;<span class="op" id="1525954">=</span>&nbsp;<span class="op" id="1525956">(</span><span class="op" id="1525957">*</span><span class="ident" id="1525958">bmap</span><span class="op" id="1525962">)</span><span class="op" id="1525963">(</span><span class="ident" id="1525964">h</span><span class="op" id="1525965">.</span><span class="ident" id="1525966">buckets</span><span class="op" id="1525973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1525976">}</span>&nbsp;<span class="keyword" id="1525978">else</span>&nbsp;<span class="op" id="1525983">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1525987">hash</span>&nbsp;<span class="op" id="1525992">:=</span>&nbsp;<span class="ident" id="1525995">goalg</span><span class="op" id="1526000">(</span><span class="ident" id="1526001">t</span><span class="op" id="1526002">.</span><span class="ident" id="1526003">key</span><span class="op" id="1526006">.</span><span class="ident" id="1526007">alg</span><span class="op" id="1526010">)</span><span class="op" id="1526011">.</span><span class="ident" id="1526012">hash</span><span class="op" id="1526016">(</span><span class="ident" id="1526017">noescape</span><span class="op" id="1526025">(</span><span class="ident" id="1526026">unsafe</span><span class="op" id="1526032">.</span><span class="ident" id="1526033">Pointer</span><span class="op" id="1526040">(</span><span class="op" id="1526041">&amp;</span><span class="ident" id="1526042">key</span><span class="op" id="1526045">)</span><span class="op" id="1526046">)</span><span class="op" id="1526047">,</span>&nbsp;<span class="num" id="1526049">8</span><span class="op" id="1526050">,</span>&nbsp;<span class="builtintype" id="1526052">uintptr</span><span class="op" id="1526059">(</span><span class="ident" id="1526060">h</span><span class="op" id="1526061">.</span><span class="ident" id="1526062">hash0</span><span class="op" id="1526067">)</span><span class="op" id="1526068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526072">m</span>&nbsp;<span class="op" id="1526074">:=</span>&nbsp;<span class="builtintype" id="1526077">uintptr</span><span class="op" id="1526084">(</span><span class="num" id="1526085">1</span><span class="op" id="1526086">)</span><span class="op" id="1526087">&lt;&lt;</span><span class="ident" id="1526089">h</span><span class="op" id="1526090">.</span><span class="ident" id="1526091">B</span>&nbsp;<span class="op" id="1526093">-</span>&nbsp;<span class="num" id="1526095">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526099">b</span>&nbsp;<span class="op" id="1526101">=</span>&nbsp;<span class="op" id="1526103">(</span><span class="op" id="1526104">*</span><span class="ident" id="1526105">bmap</span><span class="op" id="1526109">)</span><span class="op" id="1526110">(</span><span class="ident" id="1526111">add</span><span class="op" id="1526114">(</span><span class="ident" id="1526115">h</span><span class="op" id="1526116">.</span><span class="ident" id="1526117">buckets</span><span class="op" id="1526124">,</span>&nbsp;<span class="op" id="1526126">(</span><span class="ident" id="1526127">hash</span><span class="op" id="1526131">&amp;</span><span class="ident" id="1526132">m</span><span class="op" id="1526133">)</span><span class="op" id="1526134">*</span><span class="builtintype" id="1526135">uintptr</span><span class="op" id="1526142">(</span><span class="ident" id="1526143">t</span><span class="op" id="1526144">.</span><span class="ident" id="1526145">bucketsize</span><span class="op" id="1526155">)</span><span class="op" id="1526156">)</span><span class="op" id="1526157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526161">if</span>&nbsp;<span class="ident" id="1526164">c</span>&nbsp;<span class="op" id="1526166">:=</span>&nbsp;<span class="ident" id="1526169">h</span><span class="op" id="1526170">.</span><span class="ident" id="1526171">oldbuckets</span><span class="op" id="1526181">;</span>&nbsp;<span class="ident" id="1526183">c</span>&nbsp;<span class="op" id="1526185">!=</span>&nbsp;<span class="builtintype" id="1526188">nil</span>&nbsp;<span class="op" id="1526192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526197">oldb</span>&nbsp;<span class="op" id="1526202">:=</span>&nbsp;<span class="op" id="1526205">(</span><span class="op" id="1526206">*</span><span class="ident" id="1526207">bmap</span><span class="op" id="1526211">)</span><span class="op" id="1526212">(</span><span class="ident" id="1526213">add</span><span class="op" id="1526216">(</span><span class="ident" id="1526217">c</span><span class="op" id="1526218">,</span>&nbsp;<span class="op" id="1526220">(</span><span class="ident" id="1526221">hash</span><span class="op" id="1526225">&amp;</span><span class="op" id="1526226">(</span><span class="ident" id="1526227">m</span><span class="op" id="1526228">&gt;&gt;</span><span class="num" id="1526230">1</span><span class="op" id="1526231">)</span><span class="op" id="1526232">)</span><span class="op" id="1526233">*</span><span class="builtintype" id="1526234">uintptr</span><span class="op" id="1526241">(</span><span class="ident" id="1526242">t</span><span class="op" id="1526243">.</span><span class="ident" id="1526244">bucketsize</span><span class="op" id="1526254">)</span><span class="op" id="1526255">)</span><span class="op" id="1526256">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526261">if</span>&nbsp;<span class="op" id="1526264">!</span><span class="ident" id="1526265">evacuated</span><span class="op" id="1526274">(</span><span class="ident" id="1526275">oldb</span><span class="op" id="1526279">)</span>&nbsp;<span class="op" id="1526281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526287">b</span>&nbsp;<span class="op" id="1526289">=</span>&nbsp;<span class="ident" id="1526291">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526306">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526309">for</span>&nbsp;<span class="op" id="1526313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526317">for</span>&nbsp;<span class="ident" id="1526321">i</span>&nbsp;<span class="op" id="1526323">:=</span>&nbsp;<span class="builtintype" id="1526326">uintptr</span><span class="op" id="1526333">(</span><span class="num" id="1526334">0</span><span class="op" id="1526335">)</span><span class="op" id="1526336">;</span>&nbsp;<span class="ident" id="1526338">i</span>&nbsp;<span class="op" id="1526340">&lt;</span>&nbsp;<span class="ident" id="1526342">bucketCnt</span><span class="op" id="1526351">;</span>&nbsp;<span class="ident" id="1526353">i</span><span class="op" id="1526354">++</span>&nbsp;<span class="op" id="1526357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526362">k</span>&nbsp;<span class="op" id="1526364">:=</span>&nbsp;<span class="op" id="1526367">*</span><span class="op" id="1526368">(</span><span class="op" id="1526369">(</span><span class="op" id="1526370">*</span><span class="ident" id="1526371">uint64</span><span class="op" id="1526377">)</span><span class="op" id="1526378">(</span><span class="ident" id="1526379">add</span><span class="op" id="1526382">(</span><span class="ident" id="1526383">unsafe</span><span class="op" id="1526389">.</span><span class="ident" id="1526390">Pointer</span><span class="op" id="1526397">(</span><span class="ident" id="1526398">b</span><span class="op" id="1526399">)</span><span class="op" id="1526400">,</span>&nbsp;<span class="ident" id="1526402">dataOffset</span><span class="op" id="1526412">+</span><span class="ident" id="1526413">i</span><span class="op" id="1526414">*</span><span class="num" id="1526415">8</span><span class="op" id="1526416">)</span><span class="op" id="1526417">)</span><span class="op" id="1526418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526423">if</span>&nbsp;<span class="ident" id="1526426">k</span>&nbsp;<span class="op" id="1526428">!=</span>&nbsp;<span class="ident" id="1526431">key</span>&nbsp;<span class="op" id="1526435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526441">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526458">x</span>&nbsp;<span class="op" id="1526460">:=</span>&nbsp;<span class="op" id="1526463">*</span><span class="op" id="1526464">(</span><span class="op" id="1526465">(</span><span class="op" id="1526466">*</span><span class="builtintype" id="1526467">uint8</span><span class="op" id="1526472">)</span><span class="op" id="1526473">(</span><span class="ident" id="1526474">add</span><span class="op" id="1526477">(</span><span class="ident" id="1526478">unsafe</span><span class="op" id="1526484">.</span><span class="ident" id="1526485">Pointer</span><span class="op" id="1526492">(</span><span class="ident" id="1526493">b</span><span class="op" id="1526494">)</span><span class="op" id="1526495">,</span>&nbsp;<span class="ident" id="1526497">i</span><span class="op" id="1526498">)</span><span class="op" id="1526499">)</span><span class="op" id="1526500">)</span>&nbsp;<span class="comment" id="1526502">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526546">if</span>&nbsp;<span class="ident" id="1526549">x</span>&nbsp;<span class="op" id="1526551">==</span>&nbsp;<span class="ident" id="1526554">empty</span>&nbsp;<span class="op" id="1526560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526566">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526578">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526583">return</span>&nbsp;<span class="ident" id="1526590">add</span><span class="op" id="1526593">(</span><span class="ident" id="1526594">unsafe</span><span class="op" id="1526600">.</span><span class="ident" id="1526601">Pointer</span><span class="op" id="1526608">(</span><span class="ident" id="1526609">b</span><span class="op" id="1526610">)</span><span class="op" id="1526611">,</span>&nbsp;<span class="ident" id="1526613">dataOffset</span><span class="op" id="1526623">+</span><span class="ident" id="1526624">bucketCnt</span><span class="op" id="1526633">*</span><span class="num" id="1526634">8</span><span class="op" id="1526635">+</span><span class="ident" id="1526636">i</span><span class="op" id="1526637">*</span><span class="builtintype" id="1526638">uintptr</span><span class="op" id="1526645">(</span><span class="ident" id="1526646">t</span><span class="op" id="1526647">.</span><span class="ident" id="1526648">valuesize</span><span class="op" id="1526657">)</span><span class="op" id="1526658">)</span><span class="op" id="1526659">,</span>&nbsp;<span class="builtintype" id="1526661">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526672">b</span>&nbsp;<span class="op" id="1526674">=</span>&nbsp;<span class="ident" id="1526676">b</span><span class="op" id="1526677">.</span><span class="ident" id="1526678">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526689">if</span>&nbsp;<span class="ident" id="1526692">b</span>&nbsp;<span class="op" id="1526694">==</span>&nbsp;<span class="builtintype" id="1526697">nil</span>&nbsp;<span class="op" id="1526701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526706">return</span>&nbsp;<span class="ident" id="1526713">unsafe</span><span class="op" id="1526719">.</span><span class="ident" id="1526720">Pointer</span><span class="op" id="1526727">(</span><span class="ident" id="1526728">t</span><span class="op" id="1526729">.</span><span class="ident" id="1526730">elem</span><span class="op" id="1526734">.</span><span class="ident" id="1526735">zero</span><span class="op" id="1526739">)</span><span class="op" id="1526740">,</span>&nbsp;<span class="builtintype" id="1526742">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526753">}</span><br>
<span class="lineno"></span><span class="op" id="1526755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1526758">func</span>&nbsp;<span class="ident" id="1526763">mapaccess1_faststr</span><span class="op" id="1526781">(</span><span class="ident" id="1526782">t</span>&nbsp;<span class="op" id="1526784">*</span><span class="ident" id="1526785">maptype</span><span class="op" id="1526792">,</span>&nbsp;<span class="ident" id="1526794">h</span>&nbsp;<span class="op" id="1526796">*</span><span class="ident" id="1526797">hmap</span><span class="op" id="1526801">,</span>&nbsp;<span class="ident" id="1526803">ky</span>&nbsp;<span class="builtintype" id="1526806">string</span><span class="op" id="1526812">)</span>&nbsp;<span class="ident" id="1526814">unsafe</span><span class="op" id="1526820">.</span><span class="ident" id="1526821">Pointer</span>&nbsp;<span class="op" id="1526829">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526832">if</span>&nbsp;<span class="ident" id="1526835">raceenabled</span>&nbsp;<span class="op" id="1526847">&amp;&amp;</span>&nbsp;<span class="ident" id="1526850">h</span>&nbsp;<span class="op" id="1526852">!=</span>&nbsp;<span class="builtintype" id="1526855">nil</span>&nbsp;<span class="op" id="1526859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526863">callerpc</span>&nbsp;<span class="op" id="1526872">:=</span>&nbsp;<span class="ident" id="1526875">getcallerpc</span><span class="op" id="1526886">(</span><span class="ident" id="1526887">unsafe</span><span class="op" id="1526893">.</span><span class="ident" id="1526894">Pointer</span><span class="op" id="1526901">(</span><span class="op" id="1526902">&amp;</span><span class="ident" id="1526903">t</span><span class="op" id="1526904">)</span><span class="op" id="1526905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1526909">racereadpc</span><span class="op" id="1526919">(</span><span class="ident" id="1526920">unsafe</span><span class="op" id="1526926">.</span><span class="ident" id="1526927">Pointer</span><span class="op" id="1526934">(</span><span class="ident" id="1526935">h</span><span class="op" id="1526936">)</span><span class="op" id="1526937">,</span>&nbsp;<span class="ident" id="1526939">callerpc</span><span class="op" id="1526947">,</span>&nbsp;<span class="ident" id="1526949">funcPC</span><span class="op" id="1526955">(</span><span class="ident" id="1526956">mapaccess1_faststr</span><span class="op" id="1526974">)</span><span class="op" id="1526975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1526978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1526981">if</span>&nbsp;<span class="ident" id="1526984">h</span>&nbsp;<span class="op" id="1526986">==</span>&nbsp;<span class="builtintype" id="1526989">nil</span>&nbsp;<span class="op" id="1526993">||</span>&nbsp;<span class="ident" id="1526996">h</span><span class="op" id="1526997">.</span><span class="ident" id="1526998">count</span>&nbsp;<span class="op" id="1527004">==</span>&nbsp;<span class="num" id="1527007">0</span>&nbsp;<span class="op" id="1527009">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527013">return</span>&nbsp;<span class="ident" id="1527020">unsafe</span><span class="op" id="1527026">.</span><span class="ident" id="1527027">Pointer</span><span class="op" id="1527034">(</span><span class="ident" id="1527035">t</span><span class="op" id="1527036">.</span><span class="ident" id="1527037">elem</span><span class="op" id="1527041">.</span><span class="ident" id="1527042">zero</span><span class="op" id="1527046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1527049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1527052">key</span>&nbsp;<span class="op" id="1527056">:=</span>&nbsp;<span class="op" id="1527059">(</span><span class="op" id="1527060">*</span><span class="ident" id="1527061">stringStruct</span><span class="op" id="1527073">)</span><span class="op" id="1527074">(</span><span class="ident" id="1527075">unsafe</span><span class="op" id="1527081">.</span><span class="ident" id="1527082">Pointer</span><span class="op" id="1527089">(</span><span class="op" id="1527090">&amp;</span><span class="ident" id="1527091">ky</span><span class="op" id="1527093">)</span><span class="op" id="1527094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527097">if</span>&nbsp;<span class="ident" id="1527100">h</span><span class="op" id="1527101">.</span><span class="ident" id="1527102">B</span>&nbsp;<span class="op" id="1527104">==</span>&nbsp;<span class="num" id="1527107">0</span>&nbsp;<span class="op" id="1527109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1527113">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1527136">b</span>&nbsp;<span class="op" id="1527138">:=</span>&nbsp;<span class="op" id="1527141">(</span><span class="op" id="1527142">*</span><span class="ident" id="1527143">bmap</span><span class="op" id="1527147">)</span><span class="op" id="1527148">(</span><span class="ident" id="1527149">h</span><span class="op" id="1527150">.</span><span class="ident" id="1527151">buckets</span><span class="op" id="1527158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527162">if</span>&nbsp;<span class="ident" id="1527165">key</span><span class="op" id="1527168">.</span><span class="builtinfunc" id="1527169">len</span>&nbsp;<span class="op" id="1527173">&lt;</span>&nbsp;<span class="num" id="1527175">32</span>&nbsp;<span class="op" id="1527178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1527183">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527232">for</span>&nbsp;<span class="ident" id="1527236">i</span>&nbsp;<span class="op" id="1527238">:=</span>&nbsp;<span class="builtintype" id="1527241">uintptr</span><span class="op" id="1527248">(</span><span class="num" id="1527249">0</span><span class="op" id="1527250">)</span><span class="op" id="1527251">;</span>&nbsp;<span class="ident" id="1527253">i</span>&nbsp;<span class="op" id="1527255">&lt;</span>&nbsp;<span class="ident" id="1527257">bucketCnt</span><span class="op" id="1527266">;</span>&nbsp;<span class="ident" id="1527268">i</span><span class="op" id="1527269">++</span>&nbsp;<span class="op" id="1527272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1527278">x</span>&nbsp;<span class="op" id="1527280">:=</span>&nbsp;<span class="op" id="1527283">*</span><span class="op" id="1527284">(</span><span class="op" id="1527285">(</span><span class="op" id="1527286">*</span><span class="builtintype" id="1527287">uint8</span><span class="op" id="1527292">)</span><span class="op" id="1527293">(</span><span class="ident" id="1527294">add</span><span class="op" id="1527297">(</span><span class="ident" id="1527298">unsafe</span><span class="op" id="1527304">.</span><span class="ident" id="1527305">Pointer</span><span class="op" id="1527312">(</span><span class="ident" id="1527313">b</span><span class="op" id="1527314">)</span><span class="op" id="1527315">,</span>&nbsp;<span class="ident" id="1527317">i</span><span class="op" id="1527318">)</span><span class="op" id="1527319">)</span><span class="op" id="1527320">)</span>&nbsp;<span class="comment" id="1527322">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527367">if</span>&nbsp;<span class="ident" id="1527370">x</span>&nbsp;<span class="op" id="1527372">==</span>&nbsp;<span class="ident" id="1527375">empty</span>&nbsp;<span class="op" id="1527381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527388">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1527401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1527407">k</span>&nbsp;<span class="op" id="1527409">:=</span>&nbsp;<span class="op" id="1527412">(</span><span class="op" id="1527413">*</span><span class="ident" id="1527414">stringStruct</span><span class="op" id="1527426">)</span><span class="op" id="1527427">(</span><span class="ident" id="1527428">add</span><span class="op" id="1527431">(</span><span class="ident" id="1527432">unsafe</span><span class="op" id="1527438">.</span><span class="ident" id="1527439">Pointer</span><span class="op" id="1527446">(</span><span class="ident" id="1527447">b</span><span class="op" id="1527448">)</span><span class="op" id="1527449">,</span>&nbsp;<span class="ident" id="1527451">dataOffset</span><span class="op" id="1527461">+</span><span class="ident" id="1527462">i</span><span class="op" id="1527463">*</span><span class="num" id="1527464">2</span><span class="op" id="1527465">*</span><span class="ident" id="1527466">ptrSize</span><span class="op" id="1527473">)</span><span class="op" id="1527474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527480">if</span>&nbsp;<span class="ident" id="1527483">k</span><span class="op" id="1527484">.</span><span class="builtinfunc" id="1527485">len</span>&nbsp;<span class="op" id="1527489">!=</span>&nbsp;<span class="ident" id="1527492">key</span><span class="op" id="1527495">.</span><span class="builtinfunc" id="1527496">len</span>&nbsp;<span class="op" id="1527500">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527507">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1527520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527526">if</span>&nbsp;<span class="ident" id="1527529">k</span><span class="op" id="1527530">.</span><span class="ident" id="1527531">str</span>&nbsp;<span class="op" id="1527535">==</span>&nbsp;<span class="ident" id="1527538">key</span><span class="op" id="1527541">.</span><span class="ident" id="1527542">str</span>&nbsp;<span class="op" id="1527546">||</span>&nbsp;<span class="ident" id="1527549">memeq</span><span class="op" id="1527554">(</span><span class="ident" id="1527555">k</span><span class="op" id="1527556">.</span><span class="ident" id="1527557">str</span><span class="op" id="1527560">,</span>&nbsp;<span class="ident" id="1527562">key</span><span class="op" id="1527565">.</span><span class="ident" id="1527566">str</span><span class="op" id="1527569">,</span>&nbsp;<span class="builtintype" id="1527571">uintptr</span><span class="op" id="1527578">(</span><span class="ident" id="1527579">key</span><span class="op" id="1527582">.</span><span class="builtinfunc" id="1527583">len</span><span class="op" id="1527586">)</span><span class="op" id="1527587">)</span>&nbsp;<span class="op" id="1527589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527596">return</span>&nbsp;<span class="ident" id="1527603">add</span><span class="op" id="1527606">(</span><span class="ident" id="1527607">unsafe</span><span class="op" id="1527613">.</span><span class="ident" id="1527614">Pointer</span><span class="op" id="1527621">(</span><span class="ident" id="1527622">b</span><span class="op" id="1527623">)</span><span class="op" id="1527624">,</span>&nbsp;<span class="ident" id="1527626">dataOffset</span><span class="op" id="1527636">+</span><span class="ident" id="1527637">bucketCnt</span><span class="op" id="1527646">*</span><span class="num" id="1527647">2</span><span class="op" id="1527648">*</span><span class="ident" id="1527649">ptrSize</span><span class="op" id="1527656">+</span><span class="ident" id="1527657">i</span><span class="op" id="1527658">*</span><span class="builtintype" id="1527659">uintptr</span><span class="op" id="1527666">(</span><span class="ident" id="1527667">t</span><span class="op" id="1527668">.</span><span class="ident" id="1527669">valuesize</span><span class="op" id="1527678">)</span><span class="op" id="1527679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1527685">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1527690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527695">return</span>&nbsp;<span class="ident" id="1527702">unsafe</span><span class="op" id="1527708">.</span><span class="ident" id="1527709">Pointer</span><span class="op" id="1527716">(</span><span class="ident" id="1527717">t</span><span class="op" id="1527718">.</span><span class="ident" id="1527719">elem</span><span class="op" id="1527723">.</span><span class="ident" id="1527724">zero</span><span class="op" id="1527728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1527732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1527736">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1527797">keymaybe</span>&nbsp;<span class="op" id="1527806">:=</span>&nbsp;<span class="builtintype" id="1527809">uintptr</span><span class="op" id="1527816">(</span><span class="ident" id="1527817">bucketCnt</span><span class="op" id="1527826">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527830">for</span>&nbsp;<span class="ident" id="1527834">i</span>&nbsp;<span class="op" id="1527836">:=</span>&nbsp;<span class="builtintype" id="1527839">uintptr</span><span class="op" id="1527846">(</span><span class="num" id="1527847">0</span><span class="op" id="1527848">)</span><span class="op" id="1527849">;</span>&nbsp;<span class="ident" id="1527851">i</span>&nbsp;<span class="op" id="1527853">&lt;</span>&nbsp;<span class="ident" id="1527855">bucketCnt</span><span class="op" id="1527864">;</span>&nbsp;<span class="ident" id="1527866">i</span><span class="op" id="1527867">++</span>&nbsp;<span class="op" id="1527870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1527875">x</span>&nbsp;<span class="op" id="1527877">:=</span>&nbsp;<span class="op" id="1527880">*</span><span class="op" id="1527881">(</span><span class="op" id="1527882">(</span><span class="op" id="1527883">*</span><span class="builtintype" id="1527884">uint8</span><span class="op" id="1527889">)</span><span class="op" id="1527890">(</span><span class="ident" id="1527891">add</span><span class="op" id="1527894">(</span><span class="ident" id="1527895">unsafe</span><span class="op" id="1527901">.</span><span class="ident" id="1527902">Pointer</span><span class="op" id="1527909">(</span><span class="ident" id="1527910">b</span><span class="op" id="1527911">)</span><span class="op" id="1527912">,</span>&nbsp;<span class="ident" id="1527914">i</span><span class="op" id="1527915">)</span><span class="op" id="1527916">)</span><span class="op" id="1527917">)</span>&nbsp;<span class="comment" id="1527919">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527963">if</span>&nbsp;<span class="ident" id="1527966">x</span>&nbsp;<span class="op" id="1527968">==</span>&nbsp;<span class="ident" id="1527971">empty</span>&nbsp;<span class="op" id="1527977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527983">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1527995">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528000">k</span>&nbsp;<span class="op" id="1528002">:=</span>&nbsp;<span class="op" id="1528005">(</span><span class="op" id="1528006">*</span><span class="ident" id="1528007">stringStruct</span><span class="op" id="1528019">)</span><span class="op" id="1528020">(</span><span class="ident" id="1528021">add</span><span class="op" id="1528024">(</span><span class="ident" id="1528025">unsafe</span><span class="op" id="1528031">.</span><span class="ident" id="1528032">Pointer</span><span class="op" id="1528039">(</span><span class="ident" id="1528040">b</span><span class="op" id="1528041">)</span><span class="op" id="1528042">,</span>&nbsp;<span class="ident" id="1528044">dataOffset</span><span class="op" id="1528054">+</span><span class="ident" id="1528055">i</span><span class="op" id="1528056">*</span><span class="num" id="1528057">2</span><span class="op" id="1528058">*</span><span class="ident" id="1528059">ptrSize</span><span class="op" id="1528066">)</span><span class="op" id="1528067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528072">if</span>&nbsp;<span class="ident" id="1528075">k</span><span class="op" id="1528076">.</span><span class="builtinfunc" id="1528077">len</span>&nbsp;<span class="op" id="1528081">!=</span>&nbsp;<span class="ident" id="1528084">key</span><span class="op" id="1528087">.</span><span class="builtinfunc" id="1528088">len</span>&nbsp;<span class="op" id="1528092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528115">if</span>&nbsp;<span class="ident" id="1528118">k</span><span class="op" id="1528119">.</span><span class="ident" id="1528120">str</span>&nbsp;<span class="op" id="1528124">==</span>&nbsp;<span class="ident" id="1528127">key</span><span class="op" id="1528130">.</span><span class="ident" id="1528131">str</span>&nbsp;<span class="op" id="1528135">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528141">return</span>&nbsp;<span class="ident" id="1528148">add</span><span class="op" id="1528151">(</span><span class="ident" id="1528152">unsafe</span><span class="op" id="1528158">.</span><span class="ident" id="1528159">Pointer</span><span class="op" id="1528166">(</span><span class="ident" id="1528167">b</span><span class="op" id="1528168">)</span><span class="op" id="1528169">,</span>&nbsp;<span class="ident" id="1528171">dataOffset</span><span class="op" id="1528181">+</span><span class="ident" id="1528182">bucketCnt</span><span class="op" id="1528191">*</span><span class="num" id="1528192">2</span><span class="op" id="1528193">*</span><span class="ident" id="1528194">ptrSize</span><span class="op" id="1528201">+</span><span class="ident" id="1528202">i</span><span class="op" id="1528203">*</span><span class="builtintype" id="1528204">uintptr</span><span class="op" id="1528211">(</span><span class="ident" id="1528212">t</span><span class="op" id="1528213">.</span><span class="ident" id="1528214">valuesize</span><span class="op" id="1528223">)</span><span class="op" id="1528224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1528234">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1528260">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1528349">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528380">if</span>&nbsp;<span class="op" id="1528383">*</span><span class="op" id="1528384">(</span><span class="op" id="1528385">(</span><span class="op" id="1528386">*</span><span class="op" id="1528387">[</span><span class="num" id="1528388">4</span><span class="op" id="1528389">]</span><span class="builtintype" id="1528390">byte</span><span class="op" id="1528394">)</span><span class="op" id="1528395">(</span><span class="ident" id="1528396">key</span><span class="op" id="1528399">.</span><span class="ident" id="1528400">str</span><span class="op" id="1528403">)</span><span class="op" id="1528404">)</span>&nbsp;<span class="op" id="1528406">!=</span>&nbsp;<span class="op" id="1528409">*</span><span class="op" id="1528410">(</span><span class="op" id="1528411">(</span><span class="op" id="1528412">*</span><span class="op" id="1528413">[</span><span class="num" id="1528414">4</span><span class="op" id="1528415">]</span><span class="builtintype" id="1528416">byte</span><span class="op" id="1528420">)</span><span class="op" id="1528421">(</span><span class="ident" id="1528422">k</span><span class="op" id="1528423">.</span><span class="ident" id="1528424">str</span><span class="op" id="1528427">)</span><span class="op" id="1528428">)</span>&nbsp;<span class="op" id="1528430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528436">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1528453">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528478">if</span>&nbsp;<span class="op" id="1528481">*</span><span class="op" id="1528482">(</span><span class="op" id="1528483">(</span><span class="op" id="1528484">*</span><span class="op" id="1528485">[</span><span class="num" id="1528486">4</span><span class="op" id="1528487">]</span><span class="builtintype" id="1528488">byte</span><span class="op" id="1528492">)</span><span class="op" id="1528493">(</span><span class="ident" id="1528494">add</span><span class="op" id="1528497">(</span><span class="ident" id="1528498">key</span><span class="op" id="1528501">.</span><span class="ident" id="1528502">str</span><span class="op" id="1528505">,</span>&nbsp;<span class="builtintype" id="1528507">uintptr</span><span class="op" id="1528514">(</span><span class="ident" id="1528515">key</span><span class="op" id="1528518">.</span><span class="builtinfunc" id="1528519">len</span><span class="op" id="1528522">)</span><span class="op" id="1528523">-</span><span class="num" id="1528524">4</span><span class="op" id="1528525">)</span><span class="op" id="1528526">)</span><span class="op" id="1528527">)</span>&nbsp;<span class="op" id="1528529">!=</span>&nbsp;<span class="op" id="1528532">*</span><span class="op" id="1528533">(</span><span class="op" id="1528534">(</span><span class="op" id="1528535">*</span><span class="op" id="1528536">[</span><span class="num" id="1528537">4</span><span class="op" id="1528538">]</span><span class="builtintype" id="1528539">byte</span><span class="op" id="1528543">)</span><span class="op" id="1528544">(</span><span class="ident" id="1528545">add</span><span class="op" id="1528548">(</span><span class="ident" id="1528549">k</span><span class="op" id="1528550">.</span><span class="ident" id="1528551">str</span><span class="op" id="1528554">,</span>&nbsp;<span class="builtintype" id="1528556">uintptr</span><span class="op" id="1528563">(</span><span class="ident" id="1528564">key</span><span class="op" id="1528567">.</span><span class="builtinfunc" id="1528568">len</span><span class="op" id="1528571">)</span><span class="op" id="1528572">-</span><span class="num" id="1528573">4</span><span class="op" id="1528574">)</span><span class="op" id="1528575">)</span><span class="op" id="1528576">)</span>&nbsp;<span class="op" id="1528578">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528584">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528601">if</span>&nbsp;<span class="ident" id="1528604">keymaybe</span>&nbsp;<span class="op" id="1528613">!=</span>&nbsp;<span class="ident" id="1528616">bucketCnt</span>&nbsp;<span class="op" id="1528626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1528632">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528702">goto</span>&nbsp;<span class="ident" id="1528707">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528722">keymaybe</span>&nbsp;<span class="op" id="1528731">=</span>&nbsp;<span class="ident" id="1528733">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528741">if</span>&nbsp;<span class="ident" id="1528744">keymaybe</span>&nbsp;<span class="op" id="1528753">!=</span>&nbsp;<span class="ident" id="1528756">bucketCnt</span>&nbsp;<span class="op" id="1528766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528771">k</span>&nbsp;<span class="op" id="1528773">:=</span>&nbsp;<span class="op" id="1528776">(</span><span class="op" id="1528777">*</span><span class="ident" id="1528778">stringStruct</span><span class="op" id="1528790">)</span><span class="op" id="1528791">(</span><span class="ident" id="1528792">add</span><span class="op" id="1528795">(</span><span class="ident" id="1528796">unsafe</span><span class="op" id="1528802">.</span><span class="ident" id="1528803">Pointer</span><span class="op" id="1528810">(</span><span class="ident" id="1528811">b</span><span class="op" id="1528812">)</span><span class="op" id="1528813">,</span>&nbsp;<span class="ident" id="1528815">dataOffset</span><span class="op" id="1528825">+</span><span class="ident" id="1528826">keymaybe</span><span class="op" id="1528834">*</span><span class="num" id="1528835">2</span><span class="op" id="1528836">*</span><span class="ident" id="1528837">ptrSize</span><span class="op" id="1528844">)</span><span class="op" id="1528845">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528850">if</span>&nbsp;<span class="ident" id="1528853">memeq</span><span class="op" id="1528858">(</span><span class="ident" id="1528859">k</span><span class="op" id="1528860">.</span><span class="ident" id="1528861">str</span><span class="op" id="1528864">,</span>&nbsp;<span class="ident" id="1528866">key</span><span class="op" id="1528869">.</span><span class="ident" id="1528870">str</span><span class="op" id="1528873">,</span>&nbsp;<span class="builtintype" id="1528875">uintptr</span><span class="op" id="1528882">(</span><span class="ident" id="1528883">key</span><span class="op" id="1528886">.</span><span class="builtinfunc" id="1528887">len</span><span class="op" id="1528890">)</span><span class="op" id="1528891">)</span>&nbsp;<span class="op" id="1528893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528899">return</span>&nbsp;<span class="ident" id="1528906">add</span><span class="op" id="1528909">(</span><span class="ident" id="1528910">unsafe</span><span class="op" id="1528916">.</span><span class="ident" id="1528917">Pointer</span><span class="op" id="1528924">(</span><span class="ident" id="1528925">b</span><span class="op" id="1528926">)</span><span class="op" id="1528927">,</span>&nbsp;<span class="ident" id="1528929">dataOffset</span><span class="op" id="1528939">+</span><span class="ident" id="1528940">bucketCnt</span><span class="op" id="1528949">*</span><span class="num" id="1528950">2</span><span class="op" id="1528951">*</span><span class="ident" id="1528952">ptrSize</span><span class="op" id="1528959">+</span><span class="ident" id="1528960">keymaybe</span><span class="op" id="1528968">*</span><span class="builtintype" id="1528969">uintptr</span><span class="op" id="1528976">(</span><span class="ident" id="1528977">t</span><span class="op" id="1528978">.</span><span class="ident" id="1528979">valuesize</span><span class="op" id="1528988">)</span><span class="op" id="1528989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529002">return</span>&nbsp;<span class="ident" id="1529009">unsafe</span><span class="op" id="1529015">.</span><span class="ident" id="1529016">Pointer</span><span class="op" id="1529023">(</span><span class="ident" id="1529024">t</span><span class="op" id="1529025">.</span><span class="ident" id="1529026">elem</span><span class="op" id="1529030">.</span><span class="ident" id="1529031">zero</span><span class="op" id="1529035">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529038">}</span><br>
<span class="lineno"></span><span class="ident" id="1529040">dohash</span><span class="op" id="1529046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529049">hash</span>&nbsp;<span class="op" id="1529054">:=</span>&nbsp;<span class="ident" id="1529057">goalg</span><span class="op" id="1529062">(</span><span class="ident" id="1529063">t</span><span class="op" id="1529064">.</span><span class="ident" id="1529065">key</span><span class="op" id="1529068">.</span><span class="ident" id="1529069">alg</span><span class="op" id="1529072">)</span><span class="op" id="1529073">.</span><span class="ident" id="1529074">hash</span><span class="op" id="1529078">(</span><span class="ident" id="1529079">noescape</span><span class="op" id="1529087">(</span><span class="ident" id="1529088">unsafe</span><span class="op" id="1529094">.</span><span class="ident" id="1529095">Pointer</span><span class="op" id="1529102">(</span><span class="op" id="1529103">&amp;</span><span class="ident" id="1529104">ky</span><span class="op" id="1529106">)</span><span class="op" id="1529107">)</span><span class="op" id="1529108">,</span>&nbsp;<span class="num" id="1529110">2</span><span class="op" id="1529111">*</span><span class="ident" id="1529112">ptrSize</span><span class="op" id="1529119">,</span>&nbsp;<span class="builtintype" id="1529121">uintptr</span><span class="op" id="1529128">(</span><span class="ident" id="1529129">h</span><span class="op" id="1529130">.</span><span class="ident" id="1529131">hash0</span><span class="op" id="1529136">)</span><span class="op" id="1529137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529140">m</span>&nbsp;<span class="op" id="1529142">:=</span>&nbsp;<span class="builtintype" id="1529145">uintptr</span><span class="op" id="1529152">(</span><span class="num" id="1529153">1</span><span class="op" id="1529154">)</span><span class="op" id="1529155">&lt;&lt;</span><span class="ident" id="1529157">h</span><span class="op" id="1529158">.</span><span class="ident" id="1529159">B</span>&nbsp;<span class="op" id="1529161">-</span>&nbsp;<span class="num" id="1529163">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529166">b</span>&nbsp;<span class="op" id="1529168">:=</span>&nbsp;<span class="op" id="1529171">(</span><span class="op" id="1529172">*</span><span class="ident" id="1529173">bmap</span><span class="op" id="1529177">)</span><span class="op" id="1529178">(</span><span class="ident" id="1529179">add</span><span class="op" id="1529182">(</span><span class="ident" id="1529183">h</span><span class="op" id="1529184">.</span><span class="ident" id="1529185">buckets</span><span class="op" id="1529192">,</span>&nbsp;<span class="op" id="1529194">(</span><span class="ident" id="1529195">hash</span><span class="op" id="1529199">&amp;</span><span class="ident" id="1529200">m</span><span class="op" id="1529201">)</span><span class="op" id="1529202">*</span><span class="builtintype" id="1529203">uintptr</span><span class="op" id="1529210">(</span><span class="ident" id="1529211">t</span><span class="op" id="1529212">.</span><span class="ident" id="1529213">bucketsize</span><span class="op" id="1529223">)</span><span class="op" id="1529224">)</span><span class="op" id="1529225">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529228">if</span>&nbsp;<span class="ident" id="1529231">c</span>&nbsp;<span class="op" id="1529233">:=</span>&nbsp;<span class="ident" id="1529236">h</span><span class="op" id="1529237">.</span><span class="ident" id="1529238">oldbuckets</span><span class="op" id="1529248">;</span>&nbsp;<span class="ident" id="1529250">c</span>&nbsp;<span class="op" id="1529252">!=</span>&nbsp;<span class="builtintype" id="1529255">nil</span>&nbsp;<span class="op" id="1529259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529263">oldb</span>&nbsp;<span class="op" id="1529268">:=</span>&nbsp;<span class="op" id="1529271">(</span><span class="op" id="1529272">*</span><span class="ident" id="1529273">bmap</span><span class="op" id="1529277">)</span><span class="op" id="1529278">(</span><span class="ident" id="1529279">add</span><span class="op" id="1529282">(</span><span class="ident" id="1529283">c</span><span class="op" id="1529284">,</span>&nbsp;<span class="op" id="1529286">(</span><span class="ident" id="1529287">hash</span><span class="op" id="1529291">&amp;</span><span class="op" id="1529292">(</span><span class="ident" id="1529293">m</span><span class="op" id="1529294">&gt;&gt;</span><span class="num" id="1529296">1</span><span class="op" id="1529297">)</span><span class="op" id="1529298">)</span><span class="op" id="1529299">*</span><span class="builtintype" id="1529300">uintptr</span><span class="op" id="1529307">(</span><span class="ident" id="1529308">t</span><span class="op" id="1529309">.</span><span class="ident" id="1529310">bucketsize</span><span class="op" id="1529320">)</span><span class="op" id="1529321">)</span><span class="op" id="1529322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529326">if</span>&nbsp;<span class="op" id="1529329">!</span><span class="ident" id="1529330">evacuated</span><span class="op" id="1529339">(</span><span class="ident" id="1529340">oldb</span><span class="op" id="1529344">)</span>&nbsp;<span class="op" id="1529346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529351">b</span>&nbsp;<span class="op" id="1529353">=</span>&nbsp;<span class="ident" id="1529355">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529362">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529368">top</span>&nbsp;<span class="op" id="1529372">:=</span>&nbsp;<span class="builtintype" id="1529375">uint8</span><span class="op" id="1529380">(</span><span class="ident" id="1529381">hash</span>&nbsp;<span class="op" id="1529386">&gt;&gt;</span>&nbsp;<span class="op" id="1529389">(</span><span class="ident" id="1529390">ptrSize</span><span class="op" id="1529397">*</span><span class="num" id="1529398">8</span>&nbsp;<span class="op" id="1529400">-</span>&nbsp;<span class="num" id="1529402">8</span><span class="op" id="1529403">)</span><span class="op" id="1529404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529407">if</span>&nbsp;<span class="ident" id="1529410">top</span>&nbsp;<span class="op" id="1529414">&lt;</span>&nbsp;<span class="ident" id="1529416">minTopHash</span>&nbsp;<span class="op" id="1529427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529431">top</span>&nbsp;<span class="op" id="1529435">+=</span>&nbsp;<span class="ident" id="1529438">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529450">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529453">for</span>&nbsp;<span class="op" id="1529457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529461">for</span>&nbsp;<span class="ident" id="1529465">i</span>&nbsp;<span class="op" id="1529467">:=</span>&nbsp;<span class="builtintype" id="1529470">uintptr</span><span class="op" id="1529477">(</span><span class="num" id="1529478">0</span><span class="op" id="1529479">)</span><span class="op" id="1529480">;</span>&nbsp;<span class="ident" id="1529482">i</span>&nbsp;<span class="op" id="1529484">&lt;</span>&nbsp;<span class="ident" id="1529486">bucketCnt</span><span class="op" id="1529495">;</span>&nbsp;<span class="ident" id="1529497">i</span><span class="op" id="1529498">++</span>&nbsp;<span class="op" id="1529501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529506">x</span>&nbsp;<span class="op" id="1529508">:=</span>&nbsp;<span class="op" id="1529511">*</span><span class="op" id="1529512">(</span><span class="op" id="1529513">(</span><span class="op" id="1529514">*</span><span class="builtintype" id="1529515">uint8</span><span class="op" id="1529520">)</span><span class="op" id="1529521">(</span><span class="ident" id="1529522">add</span><span class="op" id="1529525">(</span><span class="ident" id="1529526">unsafe</span><span class="op" id="1529532">.</span><span class="ident" id="1529533">Pointer</span><span class="op" id="1529540">(</span><span class="ident" id="1529541">b</span><span class="op" id="1529542">)</span><span class="op" id="1529543">,</span>&nbsp;<span class="ident" id="1529545">i</span><span class="op" id="1529546">)</span><span class="op" id="1529547">)</span><span class="op" id="1529548">)</span>&nbsp;<span class="comment" id="1529550">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529594">if</span>&nbsp;<span class="ident" id="1529597">x</span>&nbsp;<span class="op" id="1529599">!=</span>&nbsp;<span class="ident" id="1529602">top</span>&nbsp;<span class="op" id="1529606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529612">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529629">k</span>&nbsp;<span class="op" id="1529631">:=</span>&nbsp;<span class="op" id="1529634">(</span><span class="op" id="1529635">*</span><span class="ident" id="1529636">stringStruct</span><span class="op" id="1529648">)</span><span class="op" id="1529649">(</span><span class="ident" id="1529650">add</span><span class="op" id="1529653">(</span><span class="ident" id="1529654">unsafe</span><span class="op" id="1529660">.</span><span class="ident" id="1529661">Pointer</span><span class="op" id="1529668">(</span><span class="ident" id="1529669">b</span><span class="op" id="1529670">)</span><span class="op" id="1529671">,</span>&nbsp;<span class="ident" id="1529673">dataOffset</span><span class="op" id="1529683">+</span><span class="ident" id="1529684">i</span><span class="op" id="1529685">*</span><span class="num" id="1529686">2</span><span class="op" id="1529687">*</span><span class="ident" id="1529688">ptrSize</span><span class="op" id="1529695">)</span><span class="op" id="1529696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529701">if</span>&nbsp;<span class="ident" id="1529704">k</span><span class="op" id="1529705">.</span><span class="builtinfunc" id="1529706">len</span>&nbsp;<span class="op" id="1529710">!=</span>&nbsp;<span class="ident" id="1529713">key</span><span class="op" id="1529716">.</span><span class="builtinfunc" id="1529717">len</span>&nbsp;<span class="op" id="1529721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529727">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529739">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529744">if</span>&nbsp;<span class="ident" id="1529747">k</span><span class="op" id="1529748">.</span><span class="ident" id="1529749">str</span>&nbsp;<span class="op" id="1529753">==</span>&nbsp;<span class="ident" id="1529756">key</span><span class="op" id="1529759">.</span><span class="ident" id="1529760">str</span>&nbsp;<span class="op" id="1529764">||</span>&nbsp;<span class="ident" id="1529767">memeq</span><span class="op" id="1529772">(</span><span class="ident" id="1529773">k</span><span class="op" id="1529774">.</span><span class="ident" id="1529775">str</span><span class="op" id="1529778">,</span>&nbsp;<span class="ident" id="1529780">key</span><span class="op" id="1529783">.</span><span class="ident" id="1529784">str</span><span class="op" id="1529787">,</span>&nbsp;<span class="builtintype" id="1529789">uintptr</span><span class="op" id="1529796">(</span><span class="ident" id="1529797">key</span><span class="op" id="1529800">.</span><span class="builtinfunc" id="1529801">len</span><span class="op" id="1529804">)</span><span class="op" id="1529805">)</span>&nbsp;<span class="op" id="1529807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529813">return</span>&nbsp;<span class="ident" id="1529820">add</span><span class="op" id="1529823">(</span><span class="ident" id="1529824">unsafe</span><span class="op" id="1529830">.</span><span class="ident" id="1529831">Pointer</span><span class="op" id="1529838">(</span><span class="ident" id="1529839">b</span><span class="op" id="1529840">)</span><span class="op" id="1529841">,</span>&nbsp;<span class="ident" id="1529843">dataOffset</span><span class="op" id="1529853">+</span><span class="ident" id="1529854">bucketCnt</span><span class="op" id="1529863">*</span><span class="num" id="1529864">2</span><span class="op" id="1529865">*</span><span class="ident" id="1529866">ptrSize</span><span class="op" id="1529873">+</span><span class="ident" id="1529874">i</span><span class="op" id="1529875">*</span><span class="builtintype" id="1529876">uintptr</span><span class="op" id="1529883">(</span><span class="ident" id="1529884">t</span><span class="op" id="1529885">.</span><span class="ident" id="1529886">valuesize</span><span class="op" id="1529895">)</span><span class="op" id="1529896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529909">b</span>&nbsp;<span class="op" id="1529911">=</span>&nbsp;<span class="ident" id="1529913">b</span><span class="op" id="1529914">.</span><span class="ident" id="1529915">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529926">if</span>&nbsp;<span class="ident" id="1529929">b</span>&nbsp;<span class="op" id="1529931">==</span>&nbsp;<span class="builtintype" id="1529934">nil</span>&nbsp;<span class="op" id="1529938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529943">return</span>&nbsp;<span class="ident" id="1529950">unsafe</span><span class="op" id="1529956">.</span><span class="ident" id="1529957">Pointer</span><span class="op" id="1529964">(</span><span class="ident" id="1529965">t</span><span class="op" id="1529966">.</span><span class="ident" id="1529967">elem</span><span class="op" id="1529971">.</span><span class="ident" id="1529972">zero</span><span class="op" id="1529976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529983">}</span><br>
<span class="lineno"></span><span class="op" id="1529985">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1529988">func</span>&nbsp;<span class="ident" id="1529993">mapaccess2_faststr</span><span class="op" id="1530011">(</span><span class="ident" id="1530012">t</span>&nbsp;<span class="op" id="1530014">*</span><span class="ident" id="1530015">maptype</span><span class="op" id="1530022">,</span>&nbsp;<span class="ident" id="1530024">h</span>&nbsp;<span class="op" id="1530026">*</span><span class="ident" id="1530027">hmap</span><span class="op" id="1530031">,</span>&nbsp;<span class="ident" id="1530033">ky</span>&nbsp;<span class="builtintype" id="1530036">string</span><span class="op" id="1530042">)</span>&nbsp;<span class="op" id="1530044">(</span><span class="ident" id="1530045">unsafe</span><span class="op" id="1530051">.</span><span class="ident" id="1530052">Pointer</span><span class="op" id="1530059">,</span>&nbsp;<span class="builtintype" id="1530061">bool</span><span class="op" id="1530065">)</span>&nbsp;<span class="op" id="1530067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530070">if</span>&nbsp;<span class="ident" id="1530073">raceenabled</span>&nbsp;<span class="op" id="1530085">&amp;&amp;</span>&nbsp;<span class="ident" id="1530088">h</span>&nbsp;<span class="op" id="1530090">!=</span>&nbsp;<span class="builtintype" id="1530093">nil</span>&nbsp;<span class="op" id="1530097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530101">callerpc</span>&nbsp;<span class="op" id="1530110">:=</span>&nbsp;<span class="ident" id="1530113">getcallerpc</span><span class="op" id="1530124">(</span><span class="ident" id="1530125">unsafe</span><span class="op" id="1530131">.</span><span class="ident" id="1530132">Pointer</span><span class="op" id="1530139">(</span><span class="op" id="1530140">&amp;</span><span class="ident" id="1530141">t</span><span class="op" id="1530142">)</span><span class="op" id="1530143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530147">racereadpc</span><span class="op" id="1530157">(</span><span class="ident" id="1530158">unsafe</span><span class="op" id="1530164">.</span><span class="ident" id="1530165">Pointer</span><span class="op" id="1530172">(</span><span class="ident" id="1530173">h</span><span class="op" id="1530174">)</span><span class="op" id="1530175">,</span>&nbsp;<span class="ident" id="1530177">callerpc</span><span class="op" id="1530185">,</span>&nbsp;<span class="ident" id="1530187">funcPC</span><span class="op" id="1530193">(</span><span class="ident" id="1530194">mapaccess2_faststr</span><span class="op" id="1530212">)</span><span class="op" id="1530213">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530219">if</span>&nbsp;<span class="ident" id="1530222">h</span>&nbsp;<span class="op" id="1530224">==</span>&nbsp;<span class="builtintype" id="1530227">nil</span>&nbsp;<span class="op" id="1530231">||</span>&nbsp;<span class="ident" id="1530234">h</span><span class="op" id="1530235">.</span><span class="ident" id="1530236">count</span>&nbsp;<span class="op" id="1530242">==</span>&nbsp;<span class="num" id="1530245">0</span>&nbsp;<span class="op" id="1530247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530251">return</span>&nbsp;<span class="ident" id="1530258">unsafe</span><span class="op" id="1530264">.</span><span class="ident" id="1530265">Pointer</span><span class="op" id="1530272">(</span><span class="ident" id="1530273">t</span><span class="op" id="1530274">.</span><span class="ident" id="1530275">elem</span><span class="op" id="1530279">.</span><span class="ident" id="1530280">zero</span><span class="op" id="1530284">)</span><span class="op" id="1530285">,</span>&nbsp;<span class="builtintype" id="1530287">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530297">key</span>&nbsp;<span class="op" id="1530301">:=</span>&nbsp;<span class="op" id="1530304">(</span><span class="op" id="1530305">*</span><span class="ident" id="1530306">stringStruct</span><span class="op" id="1530318">)</span><span class="op" id="1530319">(</span><span class="ident" id="1530320">unsafe</span><span class="op" id="1530326">.</span><span class="ident" id="1530327">Pointer</span><span class="op" id="1530334">(</span><span class="op" id="1530335">&amp;</span><span class="ident" id="1530336">ky</span><span class="op" id="1530338">)</span><span class="op" id="1530339">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530342">if</span>&nbsp;<span class="ident" id="1530345">h</span><span class="op" id="1530346">.</span><span class="ident" id="1530347">B</span>&nbsp;<span class="op" id="1530349">==</span>&nbsp;<span class="num" id="1530352">0</span>&nbsp;<span class="op" id="1530354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1530358">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530381">b</span>&nbsp;<span class="op" id="1530383">:=</span>&nbsp;<span class="op" id="1530386">(</span><span class="op" id="1530387">*</span><span class="ident" id="1530388">bmap</span><span class="op" id="1530392">)</span><span class="op" id="1530393">(</span><span class="ident" id="1530394">h</span><span class="op" id="1530395">.</span><span class="ident" id="1530396">buckets</span><span class="op" id="1530403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530407">if</span>&nbsp;<span class="ident" id="1530410">key</span><span class="op" id="1530413">.</span><span class="builtinfunc" id="1530414">len</span>&nbsp;<span class="op" id="1530418">&lt;</span>&nbsp;<span class="num" id="1530420">32</span>&nbsp;<span class="op" id="1530423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1530428">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530477">for</span>&nbsp;<span class="ident" id="1530481">i</span>&nbsp;<span class="op" id="1530483">:=</span>&nbsp;<span class="builtintype" id="1530486">uintptr</span><span class="op" id="1530493">(</span><span class="num" id="1530494">0</span><span class="op" id="1530495">)</span><span class="op" id="1530496">;</span>&nbsp;<span class="ident" id="1530498">i</span>&nbsp;<span class="op" id="1530500">&lt;</span>&nbsp;<span class="ident" id="1530502">bucketCnt</span><span class="op" id="1530511">;</span>&nbsp;<span class="ident" id="1530513">i</span><span class="op" id="1530514">++</span>&nbsp;<span class="op" id="1530517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530523">x</span>&nbsp;<span class="op" id="1530525">:=</span>&nbsp;<span class="op" id="1530528">*</span><span class="op" id="1530529">(</span><span class="op" id="1530530">(</span><span class="op" id="1530531">*</span><span class="builtintype" id="1530532">uint8</span><span class="op" id="1530537">)</span><span class="op" id="1530538">(</span><span class="ident" id="1530539">add</span><span class="op" id="1530542">(</span><span class="ident" id="1530543">unsafe</span><span class="op" id="1530549">.</span><span class="ident" id="1530550">Pointer</span><span class="op" id="1530557">(</span><span class="ident" id="1530558">b</span><span class="op" id="1530559">)</span><span class="op" id="1530560">,</span>&nbsp;<span class="ident" id="1530562">i</span><span class="op" id="1530563">)</span><span class="op" id="1530564">)</span><span class="op" id="1530565">)</span>&nbsp;<span class="comment" id="1530567">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530612">if</span>&nbsp;<span class="ident" id="1530615">x</span>&nbsp;<span class="op" id="1530617">==</span>&nbsp;<span class="ident" id="1530620">empty</span>&nbsp;<span class="op" id="1530626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530633">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530646">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530652">k</span>&nbsp;<span class="op" id="1530654">:=</span>&nbsp;<span class="op" id="1530657">(</span><span class="op" id="1530658">*</span><span class="ident" id="1530659">stringStruct</span><span class="op" id="1530671">)</span><span class="op" id="1530672">(</span><span class="ident" id="1530673">add</span><span class="op" id="1530676">(</span><span class="ident" id="1530677">unsafe</span><span class="op" id="1530683">.</span><span class="ident" id="1530684">Pointer</span><span class="op" id="1530691">(</span><span class="ident" id="1530692">b</span><span class="op" id="1530693">)</span><span class="op" id="1530694">,</span>&nbsp;<span class="ident" id="1530696">dataOffset</span><span class="op" id="1530706">+</span><span class="ident" id="1530707">i</span><span class="op" id="1530708">*</span><span class="num" id="1530709">2</span><span class="op" id="1530710">*</span><span class="ident" id="1530711">ptrSize</span><span class="op" id="1530718">)</span><span class="op" id="1530719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530725">if</span>&nbsp;<span class="ident" id="1530728">k</span><span class="op" id="1530729">.</span><span class="builtinfunc" id="1530730">len</span>&nbsp;<span class="op" id="1530734">!=</span>&nbsp;<span class="ident" id="1530737">key</span><span class="op" id="1530740">.</span><span class="builtinfunc" id="1530741">len</span>&nbsp;<span class="op" id="1530745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530752">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530771">if</span>&nbsp;<span class="ident" id="1530774">k</span><span class="op" id="1530775">.</span><span class="ident" id="1530776">str</span>&nbsp;<span class="op" id="1530780">==</span>&nbsp;<span class="ident" id="1530783">key</span><span class="op" id="1530786">.</span><span class="ident" id="1530787">str</span>&nbsp;<span class="op" id="1530791">||</span>&nbsp;<span class="ident" id="1530794">memeq</span><span class="op" id="1530799">(</span><span class="ident" id="1530800">k</span><span class="op" id="1530801">.</span><span class="ident" id="1530802">str</span><span class="op" id="1530805">,</span>&nbsp;<span class="ident" id="1530807">key</span><span class="op" id="1530810">.</span><span class="ident" id="1530811">str</span><span class="op" id="1530814">,</span>&nbsp;<span class="builtintype" id="1530816">uintptr</span><span class="op" id="1530823">(</span><span class="ident" id="1530824">key</span><span class="op" id="1530827">.</span><span class="builtinfunc" id="1530828">len</span><span class="op" id="1530831">)</span><span class="op" id="1530832">)</span>&nbsp;<span class="op" id="1530834">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530841">return</span>&nbsp;<span class="ident" id="1530848">add</span><span class="op" id="1530851">(</span><span class="ident" id="1530852">unsafe</span><span class="op" id="1530858">.</span><span class="ident" id="1530859">Pointer</span><span class="op" id="1530866">(</span><span class="ident" id="1530867">b</span><span class="op" id="1530868">)</span><span class="op" id="1530869">,</span>&nbsp;<span class="ident" id="1530871">dataOffset</span><span class="op" id="1530881">+</span><span class="ident" id="1530882">bucketCnt</span><span class="op" id="1530891">*</span><span class="num" id="1530892">2</span><span class="op" id="1530893">*</span><span class="ident" id="1530894">ptrSize</span><span class="op" id="1530901">+</span><span class="ident" id="1530902">i</span><span class="op" id="1530903">*</span><span class="builtintype" id="1530904">uintptr</span><span class="op" id="1530911">(</span><span class="ident" id="1530912">t</span><span class="op" id="1530913">.</span><span class="ident" id="1530914">valuesize</span><span class="op" id="1530923">)</span><span class="op" id="1530924">)</span><span class="op" id="1530925">,</span>&nbsp;<span class="builtintype" id="1530927">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530946">return</span>&nbsp;<span class="ident" id="1530953">unsafe</span><span class="op" id="1530959">.</span><span class="ident" id="1530960">Pointer</span><span class="op" id="1530967">(</span><span class="ident" id="1530968">t</span><span class="op" id="1530969">.</span><span class="ident" id="1530970">elem</span><span class="op" id="1530974">.</span><span class="ident" id="1530975">zero</span><span class="op" id="1530979">)</span><span class="op" id="1530980">,</span>&nbsp;<span class="builtintype" id="1530982">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530990">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1530994">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531055">keymaybe</span>&nbsp;<span class="op" id="1531064">:=</span>&nbsp;<span class="builtintype" id="1531067">uintptr</span><span class="op" id="1531074">(</span><span class="ident" id="1531075">bucketCnt</span><span class="op" id="1531084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531088">for</span>&nbsp;<span class="ident" id="1531092">i</span>&nbsp;<span class="op" id="1531094">:=</span>&nbsp;<span class="builtintype" id="1531097">uintptr</span><span class="op" id="1531104">(</span><span class="num" id="1531105">0</span><span class="op" id="1531106">)</span><span class="op" id="1531107">;</span>&nbsp;<span class="ident" id="1531109">i</span>&nbsp;<span class="op" id="1531111">&lt;</span>&nbsp;<span class="ident" id="1531113">bucketCnt</span><span class="op" id="1531122">;</span>&nbsp;<span class="ident" id="1531124">i</span><span class="op" id="1531125">++</span>&nbsp;<span class="op" id="1531128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531133">x</span>&nbsp;<span class="op" id="1531135">:=</span>&nbsp;<span class="op" id="1531138">*</span><span class="op" id="1531139">(</span><span class="op" id="1531140">(</span><span class="op" id="1531141">*</span><span class="builtintype" id="1531142">uint8</span><span class="op" id="1531147">)</span><span class="op" id="1531148">(</span><span class="ident" id="1531149">add</span><span class="op" id="1531152">(</span><span class="ident" id="1531153">unsafe</span><span class="op" id="1531159">.</span><span class="ident" id="1531160">Pointer</span><span class="op" id="1531167">(</span><span class="ident" id="1531168">b</span><span class="op" id="1531169">)</span><span class="op" id="1531170">,</span>&nbsp;<span class="ident" id="1531172">i</span><span class="op" id="1531173">)</span><span class="op" id="1531174">)</span><span class="op" id="1531175">)</span>&nbsp;<span class="comment" id="1531177">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531221">if</span>&nbsp;<span class="ident" id="1531224">x</span>&nbsp;<span class="op" id="1531226">==</span>&nbsp;<span class="ident" id="1531229">empty</span>&nbsp;<span class="op" id="1531235">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531241">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531258">k</span>&nbsp;<span class="op" id="1531260">:=</span>&nbsp;<span class="op" id="1531263">(</span><span class="op" id="1531264">*</span><span class="ident" id="1531265">stringStruct</span><span class="op" id="1531277">)</span><span class="op" id="1531278">(</span><span class="ident" id="1531279">add</span><span class="op" id="1531282">(</span><span class="ident" id="1531283">unsafe</span><span class="op" id="1531289">.</span><span class="ident" id="1531290">Pointer</span><span class="op" id="1531297">(</span><span class="ident" id="1531298">b</span><span class="op" id="1531299">)</span><span class="op" id="1531300">,</span>&nbsp;<span class="ident" id="1531302">dataOffset</span><span class="op" id="1531312">+</span><span class="ident" id="1531313">i</span><span class="op" id="1531314">*</span><span class="num" id="1531315">2</span><span class="op" id="1531316">*</span><span class="ident" id="1531317">ptrSize</span><span class="op" id="1531324">)</span><span class="op" id="1531325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531330">if</span>&nbsp;<span class="ident" id="1531333">k</span><span class="op" id="1531334">.</span><span class="builtinfunc" id="1531335">len</span>&nbsp;<span class="op" id="1531339">!=</span>&nbsp;<span class="ident" id="1531342">key</span><span class="op" id="1531345">.</span><span class="builtinfunc" id="1531346">len</span>&nbsp;<span class="op" id="1531350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531356">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531373">if</span>&nbsp;<span class="ident" id="1531376">k</span><span class="op" id="1531377">.</span><span class="ident" id="1531378">str</span>&nbsp;<span class="op" id="1531382">==</span>&nbsp;<span class="ident" id="1531385">key</span><span class="op" id="1531388">.</span><span class="ident" id="1531389">str</span>&nbsp;<span class="op" id="1531393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531399">return</span>&nbsp;<span class="ident" id="1531406">add</span><span class="op" id="1531409">(</span><span class="ident" id="1531410">unsafe</span><span class="op" id="1531416">.</span><span class="ident" id="1531417">Pointer</span><span class="op" id="1531424">(</span><span class="ident" id="1531425">b</span><span class="op" id="1531426">)</span><span class="op" id="1531427">,</span>&nbsp;<span class="ident" id="1531429">dataOffset</span><span class="op" id="1531439">+</span><span class="ident" id="1531440">bucketCnt</span><span class="op" id="1531449">*</span><span class="num" id="1531450">2</span><span class="op" id="1531451">*</span><span class="ident" id="1531452">ptrSize</span><span class="op" id="1531459">+</span><span class="ident" id="1531460">i</span><span class="op" id="1531461">*</span><span class="builtintype" id="1531462">uintptr</span><span class="op" id="1531469">(</span><span class="ident" id="1531470">t</span><span class="op" id="1531471">.</span><span class="ident" id="1531472">valuesize</span><span class="op" id="1531481">)</span><span class="op" id="1531482">)</span><span class="op" id="1531483">,</span>&nbsp;<span class="builtintype" id="1531485">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1531498">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531524">if</span>&nbsp;<span class="op" id="1531527">*</span><span class="op" id="1531528">(</span><span class="op" id="1531529">(</span><span class="op" id="1531530">*</span><span class="op" id="1531531">[</span><span class="num" id="1531532">4</span><span class="op" id="1531533">]</span><span class="builtintype" id="1531534">byte</span><span class="op" id="1531538">)</span><span class="op" id="1531539">(</span><span class="ident" id="1531540">key</span><span class="op" id="1531543">.</span><span class="ident" id="1531544">str</span><span class="op" id="1531547">)</span><span class="op" id="1531548">)</span>&nbsp;<span class="op" id="1531550">!=</span>&nbsp;<span class="op" id="1531553">*</span><span class="op" id="1531554">(</span><span class="op" id="1531555">(</span><span class="op" id="1531556">*</span><span class="op" id="1531557">[</span><span class="num" id="1531558">4</span><span class="op" id="1531559">]</span><span class="builtintype" id="1531560">byte</span><span class="op" id="1531564">)</span><span class="op" id="1531565">(</span><span class="ident" id="1531566">k</span><span class="op" id="1531567">.</span><span class="ident" id="1531568">str</span><span class="op" id="1531571">)</span><span class="op" id="1531572">)</span>&nbsp;<span class="op" id="1531574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531580">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1531597">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531622">if</span>&nbsp;<span class="op" id="1531625">*</span><span class="op" id="1531626">(</span><span class="op" id="1531627">(</span><span class="op" id="1531628">*</span><span class="op" id="1531629">[</span><span class="num" id="1531630">4</span><span class="op" id="1531631">]</span><span class="builtintype" id="1531632">byte</span><span class="op" id="1531636">)</span><span class="op" id="1531637">(</span><span class="ident" id="1531638">add</span><span class="op" id="1531641">(</span><span class="ident" id="1531642">key</span><span class="op" id="1531645">.</span><span class="ident" id="1531646">str</span><span class="op" id="1531649">,</span>&nbsp;<span class="builtintype" id="1531651">uintptr</span><span class="op" id="1531658">(</span><span class="ident" id="1531659">key</span><span class="op" id="1531662">.</span><span class="builtinfunc" id="1531663">len</span><span class="op" id="1531666">)</span><span class="op" id="1531667">-</span><span class="num" id="1531668">4</span><span class="op" id="1531669">)</span><span class="op" id="1531670">)</span><span class="op" id="1531671">)</span>&nbsp;<span class="op" id="1531673">!=</span>&nbsp;<span class="op" id="1531676">*</span><span class="op" id="1531677">(</span><span class="op" id="1531678">(</span><span class="op" id="1531679">*</span><span class="op" id="1531680">[</span><span class="num" id="1531681">4</span><span class="op" id="1531682">]</span><span class="builtintype" id="1531683">byte</span><span class="op" id="1531687">)</span><span class="op" id="1531688">(</span><span class="ident" id="1531689">add</span><span class="op" id="1531692">(</span><span class="ident" id="1531693">k</span><span class="op" id="1531694">.</span><span class="ident" id="1531695">str</span><span class="op" id="1531698">,</span>&nbsp;<span class="builtintype" id="1531700">uintptr</span><span class="op" id="1531707">(</span><span class="ident" id="1531708">key</span><span class="op" id="1531711">.</span><span class="builtinfunc" id="1531712">len</span><span class="op" id="1531715">)</span><span class="op" id="1531716">-</span><span class="num" id="1531717">4</span><span class="op" id="1531718">)</span><span class="op" id="1531719">)</span><span class="op" id="1531720">)</span>&nbsp;<span class="op" id="1531722">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531728">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531745">if</span>&nbsp;<span class="ident" id="1531748">keymaybe</span>&nbsp;<span class="op" id="1531757">!=</span>&nbsp;<span class="ident" id="1531760">bucketCnt</span>&nbsp;<span class="op" id="1531770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1531776">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531846">goto</span>&nbsp;<span class="ident" id="1531851">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531866">keymaybe</span>&nbsp;<span class="op" id="1531875">=</span>&nbsp;<span class="ident" id="1531877">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531885">if</span>&nbsp;<span class="ident" id="1531888">keymaybe</span>&nbsp;<span class="op" id="1531897">!=</span>&nbsp;<span class="ident" id="1531900">bucketCnt</span>&nbsp;<span class="op" id="1531910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531915">k</span>&nbsp;<span class="op" id="1531917">:=</span>&nbsp;<span class="op" id="1531920">(</span><span class="op" id="1531921">*</span><span class="ident" id="1531922">stringStruct</span><span class="op" id="1531934">)</span><span class="op" id="1531935">(</span><span class="ident" id="1531936">add</span><span class="op" id="1531939">(</span><span class="ident" id="1531940">unsafe</span><span class="op" id="1531946">.</span><span class="ident" id="1531947">Pointer</span><span class="op" id="1531954">(</span><span class="ident" id="1531955">b</span><span class="op" id="1531956">)</span><span class="op" id="1531957">,</span>&nbsp;<span class="ident" id="1531959">dataOffset</span><span class="op" id="1531969">+</span><span class="ident" id="1531970">keymaybe</span><span class="op" id="1531978">*</span><span class="num" id="1531979">2</span><span class="op" id="1531980">*</span><span class="ident" id="1531981">ptrSize</span><span class="op" id="1531988">)</span><span class="op" id="1531989">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531994">if</span>&nbsp;<span class="ident" id="1531997">memeq</span><span class="op" id="1532002">(</span><span class="ident" id="1532003">k</span><span class="op" id="1532004">.</span><span class="ident" id="1532005">str</span><span class="op" id="1532008">,</span>&nbsp;<span class="ident" id="1532010">key</span><span class="op" id="1532013">.</span><span class="ident" id="1532014">str</span><span class="op" id="1532017">,</span>&nbsp;<span class="builtintype" id="1532019">uintptr</span><span class="op" id="1532026">(</span><span class="ident" id="1532027">key</span><span class="op" id="1532030">.</span><span class="builtinfunc" id="1532031">len</span><span class="op" id="1532034">)</span><span class="op" id="1532035">)</span>&nbsp;<span class="op" id="1532037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532043">return</span>&nbsp;<span class="ident" id="1532050">add</span><span class="op" id="1532053">(</span><span class="ident" id="1532054">unsafe</span><span class="op" id="1532060">.</span><span class="ident" id="1532061">Pointer</span><span class="op" id="1532068">(</span><span class="ident" id="1532069">b</span><span class="op" id="1532070">)</span><span class="op" id="1532071">,</span>&nbsp;<span class="ident" id="1532073">dataOffset</span><span class="op" id="1532083">+</span><span class="ident" id="1532084">bucketCnt</span><span class="op" id="1532093">*</span><span class="num" id="1532094">2</span><span class="op" id="1532095">*</span><span class="ident" id="1532096">ptrSize</span><span class="op" id="1532103">+</span><span class="ident" id="1532104">keymaybe</span><span class="op" id="1532112">*</span><span class="builtintype" id="1532113">uintptr</span><span class="op" id="1532120">(</span><span class="ident" id="1532121">t</span><span class="op" id="1532122">.</span><span class="ident" id="1532123">valuesize</span><span class="op" id="1532132">)</span><span class="op" id="1532133">)</span><span class="op" id="1532134">,</span>&nbsp;<span class="builtintype" id="1532136">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532152">return</span>&nbsp;<span class="ident" id="1532159">unsafe</span><span class="op" id="1532165">.</span><span class="ident" id="1532166">Pointer</span><span class="op" id="1532173">(</span><span class="ident" id="1532174">t</span><span class="op" id="1532175">.</span><span class="ident" id="1532176">elem</span><span class="op" id="1532180">.</span><span class="ident" id="1532181">zero</span><span class="op" id="1532185">)</span><span class="op" id="1532186">,</span>&nbsp;<span class="builtintype" id="1532188">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532195">}</span><br>
<span class="lineno"></span><span class="ident" id="1532197">dohash</span><span class="op" id="1532203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532206">hash</span>&nbsp;<span class="op" id="1532211">:=</span>&nbsp;<span class="ident" id="1532214">goalg</span><span class="op" id="1532219">(</span><span class="ident" id="1532220">t</span><span class="op" id="1532221">.</span><span class="ident" id="1532222">key</span><span class="op" id="1532225">.</span><span class="ident" id="1532226">alg</span><span class="op" id="1532229">)</span><span class="op" id="1532230">.</span><span class="ident" id="1532231">hash</span><span class="op" id="1532235">(</span><span class="ident" id="1532236">noescape</span><span class="op" id="1532244">(</span><span class="ident" id="1532245">unsafe</span><span class="op" id="1532251">.</span><span class="ident" id="1532252">Pointer</span><span class="op" id="1532259">(</span><span class="op" id="1532260">&amp;</span><span class="ident" id="1532261">ky</span><span class="op" id="1532263">)</span><span class="op" id="1532264">)</span><span class="op" id="1532265">,</span>&nbsp;<span class="num" id="1532267">2</span><span class="op" id="1532268">*</span><span class="ident" id="1532269">ptrSize</span><span class="op" id="1532276">,</span>&nbsp;<span class="builtintype" id="1532278">uintptr</span><span class="op" id="1532285">(</span><span class="ident" id="1532286">h</span><span class="op" id="1532287">.</span><span class="ident" id="1532288">hash0</span><span class="op" id="1532293">)</span><span class="op" id="1532294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532297">m</span>&nbsp;<span class="op" id="1532299">:=</span>&nbsp;<span class="builtintype" id="1532302">uintptr</span><span class="op" id="1532309">(</span><span class="num" id="1532310">1</span><span class="op" id="1532311">)</span><span class="op" id="1532312">&lt;&lt;</span><span class="ident" id="1532314">h</span><span class="op" id="1532315">.</span><span class="ident" id="1532316">B</span>&nbsp;<span class="op" id="1532318">-</span>&nbsp;<span class="num" id="1532320">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532323">b</span>&nbsp;<span class="op" id="1532325">:=</span>&nbsp;<span class="op" id="1532328">(</span><span class="op" id="1532329">*</span><span class="ident" id="1532330">bmap</span><span class="op" id="1532334">)</span><span class="op" id="1532335">(</span><span class="ident" id="1532336">add</span><span class="op" id="1532339">(</span><span class="ident" id="1532340">h</span><span class="op" id="1532341">.</span><span class="ident" id="1532342">buckets</span><span class="op" id="1532349">,</span>&nbsp;<span class="op" id="1532351">(</span><span class="ident" id="1532352">hash</span><span class="op" id="1532356">&amp;</span><span class="ident" id="1532357">m</span><span class="op" id="1532358">)</span><span class="op" id="1532359">*</span><span class="builtintype" id="1532360">uintptr</span><span class="op" id="1532367">(</span><span class="ident" id="1532368">t</span><span class="op" id="1532369">.</span><span class="ident" id="1532370">bucketsize</span><span class="op" id="1532380">)</span><span class="op" id="1532381">)</span><span class="op" id="1532382">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532385">if</span>&nbsp;<span class="ident" id="1532388">c</span>&nbsp;<span class="op" id="1532390">:=</span>&nbsp;<span class="ident" id="1532393">h</span><span class="op" id="1532394">.</span><span class="ident" id="1532395">oldbuckets</span><span class="op" id="1532405">;</span>&nbsp;<span class="ident" id="1532407">c</span>&nbsp;<span class="op" id="1532409">!=</span>&nbsp;<span class="builtintype" id="1532412">nil</span>&nbsp;<span class="op" id="1532416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532420">oldb</span>&nbsp;<span class="op" id="1532425">:=</span>&nbsp;<span class="op" id="1532428">(</span><span class="op" id="1532429">*</span><span class="ident" id="1532430">bmap</span><span class="op" id="1532434">)</span><span class="op" id="1532435">(</span><span class="ident" id="1532436">add</span><span class="op" id="1532439">(</span><span class="ident" id="1532440">c</span><span class="op" id="1532441">,</span>&nbsp;<span class="op" id="1532443">(</span><span class="ident" id="1532444">hash</span><span class="op" id="1532448">&amp;</span><span class="op" id="1532449">(</span><span class="ident" id="1532450">m</span><span class="op" id="1532451">&gt;&gt;</span><span class="num" id="1532453">1</span><span class="op" id="1532454">)</span><span class="op" id="1532455">)</span><span class="op" id="1532456">*</span><span class="builtintype" id="1532457">uintptr</span><span class="op" id="1532464">(</span><span class="ident" id="1532465">t</span><span class="op" id="1532466">.</span><span class="ident" id="1532467">bucketsize</span><span class="op" id="1532477">)</span><span class="op" id="1532478">)</span><span class="op" id="1532479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532483">if</span>&nbsp;<span class="op" id="1532486">!</span><span class="ident" id="1532487">evacuated</span><span class="op" id="1532496">(</span><span class="ident" id="1532497">oldb</span><span class="op" id="1532501">)</span>&nbsp;<span class="op" id="1532503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532508">b</span>&nbsp;<span class="op" id="1532510">=</span>&nbsp;<span class="ident" id="1532512">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532519">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532525">top</span>&nbsp;<span class="op" id="1532529">:=</span>&nbsp;<span class="builtintype" id="1532532">uint8</span><span class="op" id="1532537">(</span><span class="ident" id="1532538">hash</span>&nbsp;<span class="op" id="1532543">&gt;&gt;</span>&nbsp;<span class="op" id="1532546">(</span><span class="ident" id="1532547">ptrSize</span><span class="op" id="1532554">*</span><span class="num" id="1532555">8</span>&nbsp;<span class="op" id="1532557">-</span>&nbsp;<span class="num" id="1532559">8</span><span class="op" id="1532560">)</span><span class="op" id="1532561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532564">if</span>&nbsp;<span class="ident" id="1532567">top</span>&nbsp;<span class="op" id="1532571">&lt;</span>&nbsp;<span class="ident" id="1532573">minTopHash</span>&nbsp;<span class="op" id="1532584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532588">top</span>&nbsp;<span class="op" id="1532592">+=</span>&nbsp;<span class="ident" id="1532595">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532607">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532610">for</span>&nbsp;<span class="op" id="1532614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532618">for</span>&nbsp;<span class="ident" id="1532622">i</span>&nbsp;<span class="op" id="1532624">:=</span>&nbsp;<span class="builtintype" id="1532627">uintptr</span><span class="op" id="1532634">(</span><span class="num" id="1532635">0</span><span class="op" id="1532636">)</span><span class="op" id="1532637">;</span>&nbsp;<span class="ident" id="1532639">i</span>&nbsp;<span class="op" id="1532641">&lt;</span>&nbsp;<span class="ident" id="1532643">bucketCnt</span><span class="op" id="1532652">;</span>&nbsp;<span class="ident" id="1532654">i</span><span class="op" id="1532655">++</span>&nbsp;<span class="op" id="1532658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532663">x</span>&nbsp;<span class="op" id="1532665">:=</span>&nbsp;<span class="op" id="1532668">*</span><span class="op" id="1532669">(</span><span class="op" id="1532670">(</span><span class="op" id="1532671">*</span><span class="builtintype" id="1532672">uint8</span><span class="op" id="1532677">)</span><span class="op" id="1532678">(</span><span class="ident" id="1532679">add</span><span class="op" id="1532682">(</span><span class="ident" id="1532683">unsafe</span><span class="op" id="1532689">.</span><span class="ident" id="1532690">Pointer</span><span class="op" id="1532697">(</span><span class="ident" id="1532698">b</span><span class="op" id="1532699">)</span><span class="op" id="1532700">,</span>&nbsp;<span class="ident" id="1532702">i</span><span class="op" id="1532703">)</span><span class="op" id="1532704">)</span><span class="op" id="1532705">)</span>&nbsp;<span class="comment" id="1532707">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532751">if</span>&nbsp;<span class="ident" id="1532754">x</span>&nbsp;<span class="op" id="1532756">!=</span>&nbsp;<span class="ident" id="1532759">top</span>&nbsp;<span class="op" id="1532763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532769">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532786">k</span>&nbsp;<span class="op" id="1532788">:=</span>&nbsp;<span class="op" id="1532791">(</span><span class="op" id="1532792">*</span><span class="ident" id="1532793">stringStruct</span><span class="op" id="1532805">)</span><span class="op" id="1532806">(</span><span class="ident" id="1532807">add</span><span class="op" id="1532810">(</span><span class="ident" id="1532811">unsafe</span><span class="op" id="1532817">.</span><span class="ident" id="1532818">Pointer</span><span class="op" id="1532825">(</span><span class="ident" id="1532826">b</span><span class="op" id="1532827">)</span><span class="op" id="1532828">,</span>&nbsp;<span class="ident" id="1532830">dataOffset</span><span class="op" id="1532840">+</span><span class="ident" id="1532841">i</span><span class="op" id="1532842">*</span><span class="num" id="1532843">2</span><span class="op" id="1532844">*</span><span class="ident" id="1532845">ptrSize</span><span class="op" id="1532852">)</span><span class="op" id="1532853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532858">if</span>&nbsp;<span class="ident" id="1532861">k</span><span class="op" id="1532862">.</span><span class="builtinfunc" id="1532863">len</span>&nbsp;<span class="op" id="1532867">!=</span>&nbsp;<span class="ident" id="1532870">key</span><span class="op" id="1532873">.</span><span class="builtinfunc" id="1532874">len</span>&nbsp;<span class="op" id="1532878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532884">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532896">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532901">if</span>&nbsp;<span class="ident" id="1532904">k</span><span class="op" id="1532905">.</span><span class="ident" id="1532906">str</span>&nbsp;<span class="op" id="1532910">==</span>&nbsp;<span class="ident" id="1532913">key</span><span class="op" id="1532916">.</span><span class="ident" id="1532917">str</span>&nbsp;<span class="op" id="1532921">||</span>&nbsp;<span class="ident" id="1532924">memeq</span><span class="op" id="1532929">(</span><span class="ident" id="1532930">k</span><span class="op" id="1532931">.</span><span class="ident" id="1532932">str</span><span class="op" id="1532935">,</span>&nbsp;<span class="ident" id="1532937">key</span><span class="op" id="1532940">.</span><span class="ident" id="1532941">str</span><span class="op" id="1532944">,</span>&nbsp;<span class="builtintype" id="1532946">uintptr</span><span class="op" id="1532953">(</span><span class="ident" id="1532954">key</span><span class="op" id="1532957">.</span><span class="builtinfunc" id="1532958">len</span><span class="op" id="1532961">)</span><span class="op" id="1532962">)</span>&nbsp;<span class="op" id="1532964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532970">return</span>&nbsp;<span class="ident" id="1532977">add</span><span class="op" id="1532980">(</span><span class="ident" id="1532981">unsafe</span><span class="op" id="1532987">.</span><span class="ident" id="1532988">Pointer</span><span class="op" id="1532995">(</span><span class="ident" id="1532996">b</span><span class="op" id="1532997">)</span><span class="op" id="1532998">,</span>&nbsp;<span class="ident" id="1533000">dataOffset</span><span class="op" id="1533010">+</span><span class="ident" id="1533011">bucketCnt</span><span class="op" id="1533020">*</span><span class="num" id="1533021">2</span><span class="op" id="1533022">*</span><span class="ident" id="1533023">ptrSize</span><span class="op" id="1533030">+</span><span class="ident" id="1533031">i</span><span class="op" id="1533032">*</span><span class="builtintype" id="1533033">uintptr</span><span class="op" id="1533040">(</span><span class="ident" id="1533041">t</span><span class="op" id="1533042">.</span><span class="ident" id="1533043">valuesize</span><span class="op" id="1533052">)</span><span class="op" id="1533053">)</span><span class="op" id="1533054">,</span>&nbsp;<span class="builtintype" id="1533056">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1533072">b</span>&nbsp;<span class="op" id="1533074">=</span>&nbsp;<span class="ident" id="1533076">b</span><span class="op" id="1533077">.</span><span class="ident" id="1533078">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533089">if</span>&nbsp;<span class="ident" id="1533092">b</span>&nbsp;<span class="op" id="1533094">==</span>&nbsp;<span class="builtintype" id="1533097">nil</span>&nbsp;<span class="op" id="1533101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533106">return</span>&nbsp;<span class="ident" id="1533113">unsafe</span><span class="op" id="1533119">.</span><span class="ident" id="1533120">Pointer</span><span class="op" id="1533127">(</span><span class="ident" id="1533128">t</span><span class="op" id="1533129">.</span><span class="ident" id="1533130">elem</span><span class="op" id="1533134">.</span><span class="ident" id="1533135">zero</span><span class="op" id="1533139">)</span><span class="op" id="1533140">,</span>&nbsp;<span class="builtintype" id="1533142">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533153">}</span><br>
<span class="lineno"></span><span class="op" id="1533155">}</span>
</div>
</body>
</html>
