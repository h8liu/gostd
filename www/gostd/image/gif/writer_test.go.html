<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7697689">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7697744">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7697798">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7697849">package</span>&nbsp;<span class="ident" id="7697857">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697862">import</span>&nbsp;<span class="op" id="7697869">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7697872">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7697881">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7697890">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697905">_</span>&nbsp;<span class="string" id="7697907">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7697920">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7697933">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7697946">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7697952">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7697962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697965">func</span>&nbsp;<span class="ident" id="7697970">readImg</span><span class="op" id="7697977">(</span><span class="ident" id="7697978">filename</span>&nbsp;<span class="builtintype" id="7697987">string</span><span class="op" id="7697993">)</span>&nbsp;<span class="op" id="7697995">(</span><span class="ident" id="7697996">image</span><span class="op" id="7698001">.</span><span class="ident" id="7698002">Image</span><span class="op" id="7698007">,</span>&nbsp;<span class="builtintype" id="7698009">error</span><span class="op" id="7698014">)</span>&nbsp;<span class="op" id="7698016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698019">f</span><span class="op" id="7698020">,</span>&nbsp;<span class="ident" id="7698022">err</span>&nbsp;<span class="op" id="7698026">:=</span>&nbsp;<span class="ident" id="7698029">os</span><span class="op" id="7698031">.</span><span class="ident" id="7698032">Open</span><span class="op" id="7698036">(</span><span class="ident" id="7698037">filename</span><span class="op" id="7698045">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698048">if</span>&nbsp;<span class="ident" id="7698051">err</span>&nbsp;<span class="op" id="7698055">!=</span>&nbsp;<span class="ident" id="7698058">nil</span>&nbsp;<span class="op" id="7698062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698066">return</span>&nbsp;<span class="ident" id="7698073">nil</span><span class="op" id="7698076">,</span>&nbsp;<span class="ident" id="7698078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698086">defer</span>&nbsp;<span class="ident" id="7698092">f</span><span class="op" id="7698093">.</span><span class="ident" id="7698094">Close</span><span class="op" id="7698099">(</span><span class="op" id="7698100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698103">m</span><span class="op" id="7698104">,</span>&nbsp;<span class="ident" id="7698106">_</span><span class="op" id="7698107">,</span>&nbsp;<span class="ident" id="7698109">err</span>&nbsp;<span class="op" id="7698113">:=</span>&nbsp;<span class="ident" id="7698116">image</span><span class="op" id="7698121">.</span><span class="ident" id="7698122">Decode</span><span class="op" id="7698128">(</span><span class="ident" id="7698129">f</span><span class="op" id="7698130">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698133">return</span>&nbsp;<span class="ident" id="7698140">m</span><span class="op" id="7698141">,</span>&nbsp;<span class="ident" id="7698143">err</span><br>
<span class="lineno"></span><span class="op" id="7698147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7698150">func</span>&nbsp;<span class="ident" id="7698155">readGIF</span><span class="op" id="7698162">(</span><span class="ident" id="7698163">filename</span>&nbsp;<span class="builtintype" id="7698172">string</span><span class="op" id="7698178">)</span>&nbsp;<span class="op" id="7698180">(</span><span class="op" id="7698181">*</span><span class="ident" id="7698182">GIF</span><span class="op" id="7698185">,</span>&nbsp;<span class="builtintype" id="7698187">error</span><span class="op" id="7698192">)</span>&nbsp;<span class="op" id="7698194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698197">f</span><span class="op" id="7698198">,</span>&nbsp;<span class="ident" id="7698200">err</span>&nbsp;<span class="op" id="7698204">:=</span>&nbsp;<span class="ident" id="7698207">os</span><span class="op" id="7698209">.</span><span class="ident" id="7698210">Open</span><span class="op" id="7698214">(</span><span class="ident" id="7698215">filename</span><span class="op" id="7698223">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698226">if</span>&nbsp;<span class="ident" id="7698229">err</span>&nbsp;<span class="op" id="7698233">!=</span>&nbsp;<span class="ident" id="7698236">nil</span>&nbsp;<span class="op" id="7698240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698244">return</span>&nbsp;<span class="ident" id="7698251">nil</span><span class="op" id="7698254">,</span>&nbsp;<span class="ident" id="7698256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698264">defer</span>&nbsp;<span class="ident" id="7698270">f</span><span class="op" id="7698271">.</span><span class="ident" id="7698272">Close</span><span class="op" id="7698277">(</span><span class="op" id="7698278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698281">return</span>&nbsp;<span class="ident" id="7698288">DecodeAll</span><span class="op" id="7698297">(</span><span class="ident" id="7698298">f</span><span class="op" id="7698299">)</span><br>
<span class="lineno">35</span><span class="op" id="7698301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7698304">func</span>&nbsp;<span class="ident" id="7698309">delta</span><span class="op" id="7698314">(</span><span class="ident" id="7698315">u0</span><span class="op" id="7698317">,</span>&nbsp;<span class="ident" id="7698319">u1</span>&nbsp;<span class="builtintype" id="7698322">uint32</span><span class="op" id="7698328">)</span>&nbsp;<span class="ident" id="7698330">int64</span>&nbsp;<span class="op" id="7698336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698339">d</span>&nbsp;<span class="op" id="7698341">:=</span>&nbsp;<span class="ident" id="7698344">int64</span><span class="op" id="7698349">(</span><span class="ident" id="7698350">u0</span><span class="op" id="7698352">)</span>&nbsp;<span class="op" id="7698354">-</span>&nbsp;<span class="ident" id="7698356">int64</span><span class="op" id="7698361">(</span><span class="ident" id="7698362">u1</span><span class="op" id="7698364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698367">if</span>&nbsp;<span class="ident" id="7698370">d</span>&nbsp;<span class="op" id="7698372">&lt;</span>&nbsp;<span class="num" id="7698374">0</span>&nbsp;<span class="op" id="7698376">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698380">return</span>&nbsp;<span class="op" id="7698387">-</span><span class="ident" id="7698388">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698394">return</span>&nbsp;<span class="ident" id="7698401">d</span><br>
<span class="lineno"></span><span class="op" id="7698403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7698406">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7698482">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7698507">func</span>&nbsp;<span class="ident" id="7698512">averageDelta</span><span class="op" id="7698524">(</span><span class="ident" id="7698525">m0</span><span class="op" id="7698527">,</span>&nbsp;<span class="ident" id="7698529">m1</span>&nbsp;<span class="ident" id="7698532">image</span><span class="op" id="7698537">.</span><span class="ident" id="7698538">Image</span><span class="op" id="7698543">)</span>&nbsp;<span class="ident" id="7698545">int64</span>&nbsp;<span class="op" id="7698551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698554">b</span>&nbsp;<span class="op" id="7698556">:=</span>&nbsp;<span class="ident" id="7698559">m0</span><span class="op" id="7698561">.</span><span class="ident" id="7698562">Bounds</span><span class="op" id="7698568">(</span><span class="op" id="7698569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698572">var</span>&nbsp;<span class="ident" id="7698576">sum</span><span class="op" id="7698579">,</span>&nbsp;<span class="ident" id="7698581">n</span>&nbsp;<span class="ident" id="7698583">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698590">for</span>&nbsp;<span class="ident" id="7698594">y</span>&nbsp;<span class="op" id="7698596">:=</span>&nbsp;<span class="ident" id="7698599">b</span><span class="op" id="7698600">.</span><span class="ident" id="7698601">Min</span><span class="op" id="7698604">.</span><span class="ident" id="7698605">Y</span><span class="op" id="7698606">;</span>&nbsp;<span class="ident" id="7698608">y</span>&nbsp;<span class="op" id="7698610">&lt;</span>&nbsp;<span class="ident" id="7698612">b</span><span class="op" id="7698613">.</span><span class="ident" id="7698614">Max</span><span class="op" id="7698617">.</span><span class="ident" id="7698618">Y</span><span class="op" id="7698619">;</span>&nbsp;<span class="ident" id="7698621">y</span><span class="op" id="7698622">++</span>&nbsp;<span class="op" id="7698625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698629">for</span>&nbsp;<span class="ident" id="7698633">x</span>&nbsp;<span class="op" id="7698635">:=</span>&nbsp;<span class="ident" id="7698638">b</span><span class="op" id="7698639">.</span><span class="ident" id="7698640">Min</span><span class="op" id="7698643">.</span><span class="ident" id="7698644">X</span><span class="op" id="7698645">;</span>&nbsp;<span class="ident" id="7698647">x</span>&nbsp;<span class="op" id="7698649">&lt;</span>&nbsp;<span class="ident" id="7698651">b</span><span class="op" id="7698652">.</span><span class="ident" id="7698653">Max</span><span class="op" id="7698656">.</span><span class="ident" id="7698657">X</span><span class="op" id="7698658">;</span>&nbsp;<span class="ident" id="7698660">x</span><span class="op" id="7698661">++</span>&nbsp;<span class="op" id="7698664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698669">c0</span>&nbsp;<span class="op" id="7698672">:=</span>&nbsp;<span class="ident" id="7698675">m0</span><span class="op" id="7698677">.</span><span class="ident" id="7698678">At</span><span class="op" id="7698680">(</span><span class="ident" id="7698681">x</span><span class="op" id="7698682">,</span>&nbsp;<span class="ident" id="7698684">y</span><span class="op" id="7698685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698690">c1</span>&nbsp;<span class="op" id="7698693">:=</span>&nbsp;<span class="ident" id="7698696">m1</span><span class="op" id="7698698">.</span><span class="ident" id="7698699">At</span><span class="op" id="7698701">(</span><span class="ident" id="7698702">x</span><span class="op" id="7698703">,</span>&nbsp;<span class="ident" id="7698705">y</span><span class="op" id="7698706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698711">r0</span><span class="op" id="7698713">,</span>&nbsp;<span class="ident" id="7698715">g0</span><span class="op" id="7698717">,</span>&nbsp;<span class="ident" id="7698719">b0</span><span class="op" id="7698721">,</span>&nbsp;<span class="ident" id="7698723">_</span>&nbsp;<span class="op" id="7698725">:=</span>&nbsp;<span class="ident" id="7698728">c0</span><span class="op" id="7698730">.</span><span class="ident" id="7698731">RGBA</span><span class="op" id="7698735">(</span><span class="op" id="7698736">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698741">r1</span><span class="op" id="7698743">,</span>&nbsp;<span class="ident" id="7698745">g1</span><span class="op" id="7698747">,</span>&nbsp;<span class="ident" id="7698749">b1</span><span class="op" id="7698751">,</span>&nbsp;<span class="ident" id="7698753">_</span>&nbsp;<span class="op" id="7698755">:=</span>&nbsp;<span class="ident" id="7698758">c1</span><span class="op" id="7698760">.</span><span class="ident" id="7698761">RGBA</span><span class="op" id="7698765">(</span><span class="op" id="7698766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698771">sum</span>&nbsp;<span class="op" id="7698775">+=</span>&nbsp;<span class="ident" id="7698778">delta</span><span class="op" id="7698783">(</span><span class="ident" id="7698784">r0</span><span class="op" id="7698786">,</span>&nbsp;<span class="ident" id="7698788">r1</span><span class="op" id="7698790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698795">sum</span>&nbsp;<span class="op" id="7698799">+=</span>&nbsp;<span class="ident" id="7698802">delta</span><span class="op" id="7698807">(</span><span class="ident" id="7698808">g0</span><span class="op" id="7698810">,</span>&nbsp;<span class="ident" id="7698812">g1</span><span class="op" id="7698814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698819">sum</span>&nbsp;<span class="op" id="7698823">+=</span>&nbsp;<span class="ident" id="7698826">delta</span><span class="op" id="7698831">(</span><span class="ident" id="7698832">b0</span><span class="op" id="7698834">,</span>&nbsp;<span class="ident" id="7698836">b1</span><span class="op" id="7698838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698843">n</span>&nbsp;<span class="op" id="7698845">+=</span>&nbsp;<span class="num" id="7698848">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698858">return</span>&nbsp;<span class="ident" id="7698865">sum</span>&nbsp;<span class="op" id="7698869">/</span>&nbsp;<span class="ident" id="7698871">n</span><br>
<span class="lineno"></span><span class="op" id="7698873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7698876">var</span>&nbsp;<span class="ident" id="7698880">testCase</span>&nbsp;<span class="op" id="7698889">=</span>&nbsp;<span class="op" id="7698891">[</span><span class="op" id="7698892">]</span><span class="keyword" id="7698893">struct</span>&nbsp;<span class="op" id="7698900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698903">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7698913">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698921">tolerance</span>&nbsp;<span class="ident" id="7698931">int64</span><br>
<span class="lineno"></span><span class="op" id="7698937">}</span><span class="op" id="7698938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698941">{</span><span class="string" id="7698942">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7698969">,</span>&nbsp;<span class="num" id="7698971">1</span>&nbsp;<span class="op" id="7698973">&lt;&lt;</span>&nbsp;<span class="num" id="7698976">12</span><span class="op" id="7698978">}</span><span class="op" id="7698979">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698982">{</span><span class="string" id="7698983">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7699010">,</span>&nbsp;<span class="num" id="7699012">0</span><span class="op" id="7699013">}</span><span class="op" id="7699014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699017">{</span><span class="string" id="7699018">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7699056">,</span>&nbsp;<span class="num" id="7699058">0</span><span class="op" id="7699059">}</span><span class="op" id="7699060">,</span><br>
<span class="lineno"></span><span class="op" id="7699062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7699065">func</span>&nbsp;<span class="ident" id="7699070">TestWriter</span><span class="op" id="7699080">(</span><span class="ident" id="7699081">t</span>&nbsp;<span class="op" id="7699083">*</span><span class="ident" id="7699084">testing</span><span class="op" id="7699091">.</span><span class="ident" id="7699092">T</span><span class="op" id="7699093">)</span>&nbsp;<span class="op" id="7699095">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699098">for</span>&nbsp;<span class="ident" id="7699102">_</span><span class="op" id="7699103">,</span>&nbsp;<span class="ident" id="7699105">tc</span>&nbsp;<span class="op" id="7699108">:=</span>&nbsp;<span class="keyword" id="7699111">range</span>&nbsp;<span class="ident" id="7699117">testCase</span>&nbsp;<span class="op" id="7699126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699130">m0</span><span class="op" id="7699132">,</span>&nbsp;<span class="ident" id="7699134">err</span>&nbsp;<span class="op" id="7699138">:=</span>&nbsp;<span class="ident" id="7699141">readImg</span><span class="op" id="7699148">(</span><span class="ident" id="7699149">tc</span><span class="op" id="7699151">.</span><span class="ident" id="7699152">filename</span><span class="op" id="7699160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699164">if</span>&nbsp;<span class="ident" id="7699167">err</span>&nbsp;<span class="op" id="7699171">!=</span>&nbsp;<span class="ident" id="7699174">nil</span>&nbsp;<span class="op" id="7699178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699183">t</span><span class="op" id="7699184">.</span><span class="ident" id="7699185">Error</span><span class="op" id="7699190">(</span><span class="ident" id="7699191">tc</span><span class="op" id="7699193">.</span><span class="ident" id="7699194">filename</span><span class="op" id="7699202">,</span>&nbsp;<span class="ident" id="7699204">err</span><span class="op" id="7699207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699212">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699227">var</span>&nbsp;<span class="ident" id="7699231">buf</span>&nbsp;<span class="ident" id="7699235">bytes</span><span class="op" id="7699240">.</span><span class="ident" id="7699241">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699250">err</span>&nbsp;<span class="op" id="7699254">=</span>&nbsp;<span class="ident" id="7699256">Encode</span><span class="op" id="7699262">(</span><span class="op" id="7699263">&amp;</span><span class="ident" id="7699264">buf</span><span class="op" id="7699267">,</span>&nbsp;<span class="ident" id="7699269">m0</span><span class="op" id="7699271">,</span>&nbsp;<span class="ident" id="7699273">nil</span><span class="op" id="7699276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699280">if</span>&nbsp;<span class="ident" id="7699283">err</span>&nbsp;<span class="op" id="7699287">!=</span>&nbsp;<span class="ident" id="7699290">nil</span>&nbsp;<span class="op" id="7699294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699299">t</span><span class="op" id="7699300">.</span><span class="ident" id="7699301">Error</span><span class="op" id="7699306">(</span><span class="ident" id="7699307">tc</span><span class="op" id="7699309">.</span><span class="ident" id="7699310">filename</span><span class="op" id="7699318">,</span>&nbsp;<span class="ident" id="7699320">err</span><span class="op" id="7699323">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699328">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699343">m1</span><span class="op" id="7699345">,</span>&nbsp;<span class="ident" id="7699347">err</span>&nbsp;<span class="op" id="7699351">:=</span>&nbsp;<span class="ident" id="7699354">Decode</span><span class="op" id="7699360">(</span><span class="op" id="7699361">&amp;</span><span class="ident" id="7699362">buf</span><span class="op" id="7699365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699369">if</span>&nbsp;<span class="ident" id="7699372">err</span>&nbsp;<span class="op" id="7699376">!=</span>&nbsp;<span class="ident" id="7699379">nil</span>&nbsp;<span class="op" id="7699383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699388">t</span><span class="op" id="7699389">.</span><span class="ident" id="7699390">Error</span><span class="op" id="7699395">(</span><span class="ident" id="7699396">tc</span><span class="op" id="7699398">.</span><span class="ident" id="7699399">filename</span><span class="op" id="7699407">,</span>&nbsp;<span class="ident" id="7699409">err</span><span class="op" id="7699412">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699417">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699432">if</span>&nbsp;<span class="ident" id="7699435">m0</span><span class="op" id="7699437">.</span><span class="ident" id="7699438">Bounds</span><span class="op" id="7699444">(</span><span class="op" id="7699445">)</span>&nbsp;<span class="op" id="7699447">!=</span>&nbsp;<span class="ident" id="7699450">m1</span><span class="op" id="7699452">.</span><span class="ident" id="7699453">Bounds</span><span class="op" id="7699459">(</span><span class="op" id="7699460">)</span>&nbsp;<span class="op" id="7699462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699467">t</span><span class="op" id="7699468">.</span><span class="ident" id="7699469">Errorf</span><span class="op" id="7699475">(</span><span class="string" id="7699476">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7699506">,</span>&nbsp;<span class="ident" id="7699508">tc</span><span class="op" id="7699510">.</span><span class="ident" id="7699511">filename</span><span class="op" id="7699519">,</span>&nbsp;<span class="ident" id="7699521">m0</span><span class="op" id="7699523">.</span><span class="ident" id="7699524">Bounds</span><span class="op" id="7699530">(</span><span class="op" id="7699531">)</span><span class="op" id="7699532">,</span>&nbsp;<span class="ident" id="7699534">m1</span><span class="op" id="7699536">.</span><span class="ident" id="7699537">Bounds</span><span class="op" id="7699543">(</span><span class="op" id="7699544">)</span><span class="op" id="7699545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699550">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7699565">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699620">avgDelta</span>&nbsp;<span class="op" id="7699629">:=</span>&nbsp;<span class="ident" id="7699632">averageDelta</span><span class="op" id="7699644">(</span><span class="ident" id="7699645">m0</span><span class="op" id="7699647">,</span>&nbsp;<span class="ident" id="7699649">m1</span><span class="op" id="7699651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699655">if</span>&nbsp;<span class="ident" id="7699658">avgDelta</span>&nbsp;<span class="op" id="7699667">&gt;</span>&nbsp;<span class="ident" id="7699669">tc</span><span class="op" id="7699671">.</span><span class="ident" id="7699672">tolerance</span>&nbsp;<span class="op" id="7699682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699687">t</span><span class="op" id="7699688">.</span><span class="ident" id="7699689">Errorf</span><span class="op" id="7699695">(</span><span class="string" id="7699696">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7699749">,</span>&nbsp;<span class="ident" id="7699751">tc</span><span class="op" id="7699753">.</span><span class="ident" id="7699754">filename</span><span class="op" id="7699762">,</span>&nbsp;<span class="ident" id="7699764">tc</span><span class="op" id="7699766">.</span><span class="ident" id="7699767">tolerance</span><span class="op" id="7699776">,</span>&nbsp;<span class="ident" id="7699778">avgDelta</span><span class="op" id="7699786">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699791">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699805">}</span><br>
<span class="lineno"></span><span class="op" id="7699807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7699810">func</span>&nbsp;<span class="ident" id="7699815">TestSubImage</span><span class="op" id="7699827">(</span><span class="ident" id="7699828">t</span>&nbsp;<span class="op" id="7699830">*</span><span class="ident" id="7699831">testing</span><span class="op" id="7699838">.</span><span class="ident" id="7699839">T</span><span class="op" id="7699840">)</span>&nbsp;<span class="op" id="7699842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699845">m0</span><span class="op" id="7699847">,</span>&nbsp;<span class="ident" id="7699849">err</span>&nbsp;<span class="op" id="7699853">:=</span>&nbsp;<span class="ident" id="7699856">readImg</span><span class="op" id="7699863">(</span><span class="string" id="7699864">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7699891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699894">if</span>&nbsp;<span class="ident" id="7699897">err</span>&nbsp;<span class="op" id="7699901">!=</span>&nbsp;<span class="ident" id="7699904">nil</span>&nbsp;<span class="op" id="7699908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699912">t</span><span class="op" id="7699913">.</span><span class="ident" id="7699914">Fatalf</span><span class="op" id="7699920">(</span><span class="string" id="7699921">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7699934">,</span>&nbsp;<span class="ident" id="7699936">err</span><span class="op" id="7699939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699942">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699945">m0</span>&nbsp;<span class="op" id="7699948">=</span>&nbsp;<span class="ident" id="7699950">m0</span><span class="op" id="7699952">.</span><span class="op" id="7699953">(</span><span class="op" id="7699954">*</span><span class="ident" id="7699955">image</span><span class="op" id="7699960">.</span><span class="ident" id="7699961">Paletted</span><span class="op" id="7699969">)</span><span class="op" id="7699970">.</span><span class="ident" id="7699971">SubImage</span><span class="op" id="7699979">(</span><span class="ident" id="7699980">image</span><span class="op" id="7699985">.</span><span class="ident" id="7699986">Rect</span><span class="op" id="7699990">(</span><span class="num" id="7699991">0</span><span class="op" id="7699992">,</span>&nbsp;<span class="num" id="7699994">0</span><span class="op" id="7699995">,</span>&nbsp;<span class="num" id="7699997">50</span><span class="op" id="7699999">,</span>&nbsp;<span class="num" id="7700001">30</span><span class="op" id="7700003">)</span><span class="op" id="7700004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700007">var</span>&nbsp;<span class="ident" id="7700011">buf</span>&nbsp;<span class="ident" id="7700015">bytes</span><span class="op" id="7700020">.</span><span class="ident" id="7700021">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700029">err</span>&nbsp;<span class="op" id="7700033">=</span>&nbsp;<span class="ident" id="7700035">Encode</span><span class="op" id="7700041">(</span><span class="op" id="7700042">&amp;</span><span class="ident" id="7700043">buf</span><span class="op" id="7700046">,</span>&nbsp;<span class="ident" id="7700048">m0</span><span class="op" id="7700050">,</span>&nbsp;<span class="ident" id="7700052">nil</span><span class="op" id="7700055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700058">if</span>&nbsp;<span class="ident" id="7700061">err</span>&nbsp;<span class="op" id="7700065">!=</span>&nbsp;<span class="ident" id="7700068">nil</span>&nbsp;<span class="op" id="7700072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700076">t</span><span class="op" id="7700077">.</span><span class="ident" id="7700078">Fatalf</span><span class="op" id="7700084">(</span><span class="string" id="7700085">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7700097">,</span>&nbsp;<span class="ident" id="7700099">err</span><span class="op" id="7700102">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700108">m1</span><span class="op" id="7700110">,</span>&nbsp;<span class="ident" id="7700112">err</span>&nbsp;<span class="op" id="7700116">:=</span>&nbsp;<span class="ident" id="7700119">Decode</span><span class="op" id="7700125">(</span><span class="op" id="7700126">&amp;</span><span class="ident" id="7700127">buf</span><span class="op" id="7700130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700133">if</span>&nbsp;<span class="ident" id="7700136">err</span>&nbsp;<span class="op" id="7700140">!=</span>&nbsp;<span class="ident" id="7700143">nil</span>&nbsp;<span class="op" id="7700147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700151">t</span><span class="op" id="7700152">.</span><span class="ident" id="7700153">Fatalf</span><span class="op" id="7700159">(</span><span class="string" id="7700160">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7700172">,</span>&nbsp;<span class="ident" id="7700174">err</span><span class="op" id="7700177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700180">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700183">if</span>&nbsp;<span class="ident" id="7700186">m0</span><span class="op" id="7700188">.</span><span class="ident" id="7700189">Bounds</span><span class="op" id="7700195">(</span><span class="op" id="7700196">)</span>&nbsp;<span class="op" id="7700198">!=</span>&nbsp;<span class="ident" id="7700201">m1</span><span class="op" id="7700203">.</span><span class="ident" id="7700204">Bounds</span><span class="op" id="7700210">(</span><span class="op" id="7700211">)</span>&nbsp;<span class="op" id="7700213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700217">t</span><span class="op" id="7700218">.</span><span class="ident" id="7700219">Fatalf</span><span class="op" id="7700225">(</span><span class="string" id="7700226">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7700252">,</span>&nbsp;<span class="ident" id="7700254">m0</span><span class="op" id="7700256">.</span><span class="ident" id="7700257">Bounds</span><span class="op" id="7700263">(</span><span class="op" id="7700264">)</span><span class="op" id="7700265">,</span>&nbsp;<span class="ident" id="7700267">m1</span><span class="op" id="7700269">.</span><span class="ident" id="7700270">Bounds</span><span class="op" id="7700276">(</span><span class="op" id="7700277">)</span><span class="op" id="7700278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700284">if</span>&nbsp;<span class="ident" id="7700287">averageDelta</span><span class="op" id="7700299">(</span><span class="ident" id="7700300">m0</span><span class="op" id="7700302">,</span>&nbsp;<span class="ident" id="7700304">m1</span><span class="op" id="7700306">)</span>&nbsp;<span class="op" id="7700308">!=</span>&nbsp;<span class="num" id="7700311">0</span>&nbsp;<span class="op" id="7700313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700317">t</span><span class="op" id="7700318">.</span><span class="ident" id="7700319">Fatalf</span><span class="op" id="7700325">(</span><span class="string" id="7700326">&#34;images&nbsp;differ&#34;</span><span class="op" id="7700341">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700344">}</span><br>
<span class="lineno"></span><span class="op" id="7700346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7700349">var</span>&nbsp;<span class="ident" id="7700353">frames</span>&nbsp;<span class="op" id="7700360">=</span>&nbsp;<span class="op" id="7700362">[</span><span class="op" id="7700363">]</span><span class="builtintype" id="7700364">string</span><span class="op" id="7700370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700373">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7700400">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700403">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7700435">,</span><br>
<span class="lineno"></span><span class="op" id="7700437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7700440">func</span>&nbsp;<span class="ident" id="7700445">TestEncodeAll</span><span class="op" id="7700458">(</span><span class="ident" id="7700459">t</span>&nbsp;<span class="op" id="7700461">*</span><span class="ident" id="7700462">testing</span><span class="op" id="7700469">.</span><span class="ident" id="7700470">T</span><span class="op" id="7700471">)</span>&nbsp;<span class="op" id="7700473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700476">g0</span>&nbsp;<span class="op" id="7700479">:=</span>&nbsp;<span class="op" id="7700482">&amp;</span><span class="ident" id="7700483">GIF</span><span class="op" id="7700486">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700490">Image</span><span class="op" id="7700495">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7700501">make</span><span class="op" id="7700505">(</span><span class="op" id="7700506">[</span><span class="op" id="7700507">]</span><span class="op" id="7700508">*</span><span class="ident" id="7700509">image</span><span class="op" id="7700514">.</span><span class="ident" id="7700515">Paletted</span><span class="op" id="7700523">,</span>&nbsp;<span class="builtinfunc" id="7700525">len</span><span class="op" id="7700528">(</span><span class="ident" id="7700529">frames</span><span class="op" id="7700535">)</span><span class="op" id="7700536">)</span><span class="op" id="7700537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700541">Delay</span><span class="op" id="7700546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7700552">make</span><span class="op" id="7700556">(</span><span class="op" id="7700557">[</span><span class="op" id="7700558">]</span><span class="builtintype" id="7700559">int</span><span class="op" id="7700562">,</span>&nbsp;<span class="builtinfunc" id="7700564">len</span><span class="op" id="7700567">(</span><span class="ident" id="7700568">frames</span><span class="op" id="7700574">)</span><span class="op" id="7700575">)</span><span class="op" id="7700576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700580">LoopCount</span><span class="op" id="7700589">:</span>&nbsp;<span class="num" id="7700591">5</span><span class="op" id="7700592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700598">for</span>&nbsp;<span class="ident" id="7700602">i</span><span class="op" id="7700603">,</span>&nbsp;<span class="ident" id="7700605">f</span>&nbsp;<span class="op" id="7700607">:=</span>&nbsp;<span class="keyword" id="7700610">range</span>&nbsp;<span class="ident" id="7700616">frames</span>&nbsp;<span class="op" id="7700623">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700627">m</span><span class="op" id="7700628">,</span>&nbsp;<span class="ident" id="7700630">err</span>&nbsp;<span class="op" id="7700634">:=</span>&nbsp;<span class="ident" id="7700637">readGIF</span><span class="op" id="7700644">(</span><span class="ident" id="7700645">f</span><span class="op" id="7700646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700650">if</span>&nbsp;<span class="ident" id="7700653">err</span>&nbsp;<span class="op" id="7700657">!=</span>&nbsp;<span class="ident" id="7700660">nil</span>&nbsp;<span class="op" id="7700664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700669">t</span><span class="op" id="7700670">.</span><span class="ident" id="7700671">Fatal</span><span class="op" id="7700676">(</span><span class="ident" id="7700677">f</span><span class="op" id="7700678">,</span>&nbsp;<span class="ident" id="7700680">err</span><span class="op" id="7700683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700691">g0</span><span class="op" id="7700693">.</span><span class="ident" id="7700694">Image</span><span class="op" id="7700699">[</span><span class="ident" id="7700700">i</span><span class="op" id="7700701">]</span>&nbsp;<span class="op" id="7700703">=</span>&nbsp;<span class="ident" id="7700705">m</span><span class="op" id="7700706">.</span><span class="ident" id="7700707">Image</span><span class="op" id="7700712">[</span><span class="num" id="7700713">0</span><span class="op" id="7700714">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700720">var</span>&nbsp;<span class="ident" id="7700724">buf</span>&nbsp;<span class="ident" id="7700728">bytes</span><span class="op" id="7700733">.</span><span class="ident" id="7700734">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700742">if</span>&nbsp;<span class="ident" id="7700745">err</span>&nbsp;<span class="op" id="7700749">:=</span>&nbsp;<span class="ident" id="7700752">EncodeAll</span><span class="op" id="7700761">(</span><span class="op" id="7700762">&amp;</span><span class="ident" id="7700763">buf</span><span class="op" id="7700766">,</span>&nbsp;<span class="ident" id="7700768">g0</span><span class="op" id="7700770">)</span><span class="op" id="7700771">;</span>&nbsp;<span class="ident" id="7700773">err</span>&nbsp;<span class="op" id="7700777">!=</span>&nbsp;<span class="ident" id="7700780">nil</span>&nbsp;<span class="op" id="7700784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700788">t</span><span class="op" id="7700789">.</span><span class="ident" id="7700790">Fatal</span><span class="op" id="7700795">(</span><span class="string" id="7700796">&#34;EncodeAll:&#34;</span><span class="op" id="7700808">,</span>&nbsp;<span class="ident" id="7700810">err</span><span class="op" id="7700813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700816">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700819">g1</span><span class="op" id="7700821">,</span>&nbsp;<span class="ident" id="7700823">err</span>&nbsp;<span class="op" id="7700827">:=</span>&nbsp;<span class="ident" id="7700830">DecodeAll</span><span class="op" id="7700839">(</span><span class="op" id="7700840">&amp;</span><span class="ident" id="7700841">buf</span><span class="op" id="7700844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700847">if</span>&nbsp;<span class="ident" id="7700850">err</span>&nbsp;<span class="op" id="7700854">!=</span>&nbsp;<span class="ident" id="7700857">nil</span>&nbsp;<span class="op" id="7700861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700865">t</span><span class="op" id="7700866">.</span><span class="ident" id="7700867">Fatal</span><span class="op" id="7700872">(</span><span class="string" id="7700873">&#34;DecodeAll:&#34;</span><span class="op" id="7700885">,</span>&nbsp;<span class="ident" id="7700887">err</span><span class="op" id="7700890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700896">if</span>&nbsp;<span class="ident" id="7700899">g0</span><span class="op" id="7700901">.</span><span class="ident" id="7700902">LoopCount</span>&nbsp;<span class="op" id="7700912">!=</span>&nbsp;<span class="ident" id="7700915">g1</span><span class="op" id="7700917">.</span><span class="ident" id="7700918">LoopCount</span>&nbsp;<span class="op" id="7700928">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700932">t</span><span class="op" id="7700933">.</span><span class="ident" id="7700934">Errorf</span><span class="op" id="7700940">(</span><span class="string" id="7700941">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7700972">,</span>&nbsp;<span class="ident" id="7700974">g0</span><span class="op" id="7700976">.</span><span class="ident" id="7700977">LoopCount</span><span class="op" id="7700986">,</span>&nbsp;<span class="ident" id="7700988">g1</span><span class="op" id="7700990">.</span><span class="ident" id="7700991">LoopCount</span><span class="op" id="7701000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701006">for</span>&nbsp;<span class="ident" id="7701010">i</span>&nbsp;<span class="op" id="7701012">:=</span>&nbsp;<span class="keyword" id="7701015">range</span>&nbsp;<span class="ident" id="7701021">g0</span><span class="op" id="7701023">.</span><span class="ident" id="7701024">Image</span>&nbsp;<span class="op" id="7701030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701034">m0</span><span class="op" id="7701036">,</span>&nbsp;<span class="ident" id="7701038">m1</span>&nbsp;<span class="op" id="7701041">:=</span>&nbsp;<span class="ident" id="7701044">g0</span><span class="op" id="7701046">.</span><span class="ident" id="7701047">Image</span><span class="op" id="7701052">[</span><span class="ident" id="7701053">i</span><span class="op" id="7701054">]</span><span class="op" id="7701055">,</span>&nbsp;<span class="ident" id="7701057">g1</span><span class="op" id="7701059">.</span><span class="ident" id="7701060">Image</span><span class="op" id="7701065">[</span><span class="ident" id="7701066">i</span><span class="op" id="7701067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701071">if</span>&nbsp;<span class="ident" id="7701074">m0</span><span class="op" id="7701076">.</span><span class="ident" id="7701077">Bounds</span><span class="op" id="7701083">(</span><span class="op" id="7701084">)</span>&nbsp;<span class="op" id="7701086">!=</span>&nbsp;<span class="ident" id="7701089">m1</span><span class="op" id="7701091">.</span><span class="ident" id="7701092">Bounds</span><span class="op" id="7701098">(</span><span class="op" id="7701099">)</span>&nbsp;<span class="op" id="7701101">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701106">t</span><span class="op" id="7701107">.</span><span class="ident" id="7701108">Errorf</span><span class="op" id="7701114">(</span><span class="string" id="7701115">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7701145">,</span>&nbsp;<span class="ident" id="7701147">frames</span><span class="op" id="7701153">[</span><span class="ident" id="7701154">i</span><span class="op" id="7701155">]</span><span class="op" id="7701156">,</span>&nbsp;<span class="ident" id="7701158">m0</span><span class="op" id="7701160">.</span><span class="ident" id="7701161">Bounds</span><span class="op" id="7701167">(</span><span class="op" id="7701168">)</span><span class="op" id="7701169">,</span>&nbsp;<span class="ident" id="7701171">m1</span><span class="op" id="7701173">.</span><span class="ident" id="7701174">Bounds</span><span class="op" id="7701180">(</span><span class="op" id="7701181">)</span><span class="op" id="7701182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701190">d0</span><span class="op" id="7701192">,</span>&nbsp;<span class="ident" id="7701194">d1</span>&nbsp;<span class="op" id="7701197">:=</span>&nbsp;<span class="ident" id="7701200">g0</span><span class="op" id="7701202">.</span><span class="ident" id="7701203">Delay</span><span class="op" id="7701208">[</span><span class="ident" id="7701209">i</span><span class="op" id="7701210">]</span><span class="op" id="7701211">,</span>&nbsp;<span class="ident" id="7701213">g1</span><span class="op" id="7701215">.</span><span class="ident" id="7701216">Delay</span><span class="op" id="7701221">[</span><span class="ident" id="7701222">i</span><span class="op" id="7701223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701227">if</span>&nbsp;<span class="ident" id="7701230">d0</span>&nbsp;<span class="op" id="7701233">!=</span>&nbsp;<span class="ident" id="7701236">d1</span>&nbsp;<span class="op" id="7701239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701244">t</span><span class="op" id="7701245">.</span><span class="ident" id="7701246">Errorf</span><span class="op" id="7701252">(</span><span class="string" id="7701253">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7701289">,</span>&nbsp;<span class="ident" id="7701291">frames</span><span class="op" id="7701297">[</span><span class="ident" id="7701298">i</span><span class="op" id="7701299">]</span><span class="op" id="7701300">,</span>&nbsp;<span class="ident" id="7701302">d0</span><span class="op" id="7701304">,</span>&nbsp;<span class="ident" id="7701306">d1</span><span class="op" id="7701308">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701319">g1</span><span class="op" id="7701321">.</span><span class="ident" id="7701322">Delay</span>&nbsp;<span class="op" id="7701328">=</span>&nbsp;<span class="builtinfunc" id="7701330">make</span><span class="op" id="7701334">(</span><span class="op" id="7701335">[</span><span class="op" id="7701336">]</span><span class="builtintype" id="7701337">int</span><span class="op" id="7701340">,</span>&nbsp;<span class="num" id="7701342">1</span><span class="op" id="7701343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701346">if</span>&nbsp;<span class="ident" id="7701349">err</span>&nbsp;<span class="op" id="7701353">:=</span>&nbsp;<span class="ident" id="7701356">EncodeAll</span><span class="op" id="7701365">(</span><span class="ident" id="7701366">ioutil</span><span class="op" id="7701372">.</span><span class="ident" id="7701373">Discard</span><span class="op" id="7701380">,</span>&nbsp;<span class="ident" id="7701382">g1</span><span class="op" id="7701384">)</span><span class="op" id="7701385">;</span>&nbsp;<span class="ident" id="7701387">err</span>&nbsp;<span class="op" id="7701391">==</span>&nbsp;<span class="ident" id="7701394">nil</span>&nbsp;<span class="op" id="7701398">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701402">t</span><span class="op" id="7701403">.</span><span class="ident" id="7701404">Error</span><span class="op" id="7701409">(</span><span class="string" id="7701410">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7701472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701478">if</span>&nbsp;<span class="ident" id="7701481">err</span>&nbsp;<span class="op" id="7701485">:=</span>&nbsp;<span class="ident" id="7701488">EncodeAll</span><span class="op" id="7701497">(</span><span class="ident" id="7701498">ioutil</span><span class="op" id="7701504">.</span><span class="ident" id="7701505">Discard</span><span class="op" id="7701512">,</span>&nbsp;<span class="op" id="7701514">&amp;</span><span class="ident" id="7701515">GIF</span><span class="op" id="7701518">{</span><span class="op" id="7701519">}</span><span class="op" id="7701520">)</span><span class="op" id="7701521">;</span>&nbsp;<span class="ident" id="7701523">err</span>&nbsp;<span class="op" id="7701527">==</span>&nbsp;<span class="ident" id="7701530">nil</span>&nbsp;<span class="op" id="7701534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701538">t</span><span class="op" id="7701539">.</span><span class="ident" id="7701540">Error</span><span class="op" id="7701545">(</span><span class="string" id="7701546">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7701587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701590">}</span><br>
<span class="lineno">175</span><span class="op" id="7701592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7701595">func</span>&nbsp;<span class="ident" id="7701600">BenchmarkEncode</span><span class="op" id="7701615">(</span><span class="ident" id="7701616">b</span>&nbsp;<span class="op" id="7701618">*</span><span class="ident" id="7701619">testing</span><span class="op" id="7701626">.</span><span class="ident" id="7701627">B</span><span class="op" id="7701628">)</span>&nbsp;<span class="op" id="7701630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701633">b</span><span class="op" id="7701634">.</span><span class="ident" id="7701635">StopTimer</span><span class="op" id="7701644">(</span><span class="op" id="7701645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701649">bo</span>&nbsp;<span class="op" id="7701652">:=</span>&nbsp;<span class="ident" id="7701655">image</span><span class="op" id="7701660">.</span><span class="ident" id="7701661">Rect</span><span class="op" id="7701665">(</span><span class="num" id="7701666">0</span><span class="op" id="7701667">,</span>&nbsp;<span class="num" id="7701669">0</span><span class="op" id="7701670">,</span>&nbsp;<span class="num" id="7701672">640</span><span class="op" id="7701675">,</span>&nbsp;<span class="num" id="7701677">480</span><span class="op" id="7701680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701683">rnd</span>&nbsp;<span class="op" id="7701687">:=</span>&nbsp;<span class="ident" id="7701690">rand</span><span class="op" id="7701694">.</span><span class="ident" id="7701695">New</span><span class="op" id="7701698">(</span><span class="ident" id="7701699">rand</span><span class="op" id="7701703">.</span><span class="ident" id="7701704">NewSource</span><span class="op" id="7701713">(</span><span class="num" id="7701714">123</span><span class="op" id="7701717">)</span><span class="op" id="7701718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7701722">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701793">palette</span>&nbsp;<span class="op" id="7701801">:=</span>&nbsp;<span class="builtinfunc" id="7701804">make</span><span class="op" id="7701808">(</span><span class="ident" id="7701809">color</span><span class="op" id="7701814">.</span><span class="ident" id="7701815">Palette</span><span class="op" id="7701822">,</span>&nbsp;<span class="num" id="7701824">256</span><span class="op" id="7701827">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701830">for</span>&nbsp;<span class="ident" id="7701834">i</span>&nbsp;<span class="op" id="7701836">:=</span>&nbsp;<span class="keyword" id="7701839">range</span>&nbsp;<span class="ident" id="7701845">palette</span>&nbsp;<span class="op" id="7701853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701857">palette</span><span class="op" id="7701864">[</span><span class="ident" id="7701865">i</span><span class="op" id="7701866">]</span>&nbsp;<span class="op" id="7701868">=</span>&nbsp;<span class="ident" id="7701870">color</span><span class="op" id="7701875">.</span><span class="ident" id="7701876">RGBA</span><span class="op" id="7701880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7701885">uint8</span><span class="op" id="7701890">(</span><span class="ident" id="7701891">rnd</span><span class="op" id="7701894">.</span><span class="ident" id="7701895">Intn</span><span class="op" id="7701899">(</span><span class="num" id="7701900">256</span><span class="op" id="7701903">)</span><span class="op" id="7701904">)</span><span class="op" id="7701905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7701910">uint8</span><span class="op" id="7701915">(</span><span class="ident" id="7701916">rnd</span><span class="op" id="7701919">.</span><span class="ident" id="7701920">Intn</span><span class="op" id="7701924">(</span><span class="num" id="7701925">256</span><span class="op" id="7701928">)</span><span class="op" id="7701929">)</span><span class="op" id="7701930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7701935">uint8</span><span class="op" id="7701940">(</span><span class="ident" id="7701941">rnd</span><span class="op" id="7701944">.</span><span class="ident" id="7701945">Intn</span><span class="op" id="7701949">(</span><span class="num" id="7701950">256</span><span class="op" id="7701953">)</span><span class="op" id="7701954">)</span><span class="op" id="7701955">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7701960">255</span><span class="op" id="7701963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701973">img</span>&nbsp;<span class="op" id="7701977">:=</span>&nbsp;<span class="ident" id="7701980">image</span><span class="op" id="7701985">.</span><span class="ident" id="7701986">NewPaletted</span><span class="op" id="7701997">(</span><span class="ident" id="7701998">image</span><span class="op" id="7702003">.</span><span class="ident" id="7702004">Rect</span><span class="op" id="7702008">(</span><span class="num" id="7702009">0</span><span class="op" id="7702010">,</span>&nbsp;<span class="num" id="7702012">0</span><span class="op" id="7702013">,</span>&nbsp;<span class="num" id="7702015">640</span><span class="op" id="7702018">,</span>&nbsp;<span class="num" id="7702020">480</span><span class="op" id="7702023">)</span><span class="op" id="7702024">,</span>&nbsp;<span class="ident" id="7702026">palette</span><span class="op" id="7702033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702036">for</span>&nbsp;<span class="ident" id="7702040">y</span>&nbsp;<span class="op" id="7702042">:=</span>&nbsp;<span class="ident" id="7702045">bo</span><span class="op" id="7702047">.</span><span class="ident" id="7702048">Min</span><span class="op" id="7702051">.</span><span class="ident" id="7702052">Y</span><span class="op" id="7702053">;</span>&nbsp;<span class="ident" id="7702055">y</span>&nbsp;<span class="op" id="7702057">&lt;</span>&nbsp;<span class="ident" id="7702059">bo</span><span class="op" id="7702061">.</span><span class="ident" id="7702062">Max</span><span class="op" id="7702065">.</span><span class="ident" id="7702066">Y</span><span class="op" id="7702067">;</span>&nbsp;<span class="ident" id="7702069">y</span><span class="op" id="7702070">++</span>&nbsp;<span class="op" id="7702073">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702077">for</span>&nbsp;<span class="ident" id="7702081">x</span>&nbsp;<span class="op" id="7702083">:=</span>&nbsp;<span class="ident" id="7702086">bo</span><span class="op" id="7702088">.</span><span class="ident" id="7702089">Min</span><span class="op" id="7702092">.</span><span class="ident" id="7702093">X</span><span class="op" id="7702094">;</span>&nbsp;<span class="ident" id="7702096">x</span>&nbsp;<span class="op" id="7702098">&lt;</span>&nbsp;<span class="ident" id="7702100">bo</span><span class="op" id="7702102">.</span><span class="ident" id="7702103">Max</span><span class="op" id="7702106">.</span><span class="ident" id="7702107">X</span><span class="op" id="7702108">;</span>&nbsp;<span class="ident" id="7702110">x</span><span class="op" id="7702111">++</span>&nbsp;<span class="op" id="7702114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702119">img</span><span class="op" id="7702122">.</span><span class="ident" id="7702123">Set</span><span class="op" id="7702126">(</span><span class="ident" id="7702127">x</span><span class="op" id="7702128">,</span>&nbsp;<span class="ident" id="7702130">y</span><span class="op" id="7702131">,</span>&nbsp;<span class="ident" id="7702133">palette</span><span class="op" id="7702140">[</span><span class="ident" id="7702141">rnd</span><span class="op" id="7702144">.</span><span class="ident" id="7702145">Intn</span><span class="op" id="7702149">(</span><span class="num" id="7702150">256</span><span class="op" id="7702153">)</span><span class="op" id="7702154">]</span><span class="op" id="7702155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702166">b</span><span class="op" id="7702167">.</span><span class="ident" id="7702168">SetBytes</span><span class="op" id="7702176">(</span><span class="num" id="7702177">640</span>&nbsp;<span class="op" id="7702181">*</span>&nbsp;<span class="num" id="7702183">480</span>&nbsp;<span class="op" id="7702187">*</span>&nbsp;<span class="num" id="7702189">4</span><span class="op" id="7702190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702193">b</span><span class="op" id="7702194">.</span><span class="ident" id="7702195">StartTimer</span><span class="op" id="7702205">(</span><span class="op" id="7702206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702209">for</span>&nbsp;<span class="ident" id="7702213">i</span>&nbsp;<span class="op" id="7702215">:=</span>&nbsp;<span class="num" id="7702218">0</span><span class="op" id="7702219">;</span>&nbsp;<span class="ident" id="7702221">i</span>&nbsp;<span class="op" id="7702223">&lt;</span>&nbsp;<span class="ident" id="7702225">b</span><span class="op" id="7702226">.</span><span class="ident" id="7702227">N</span><span class="op" id="7702228">;</span>&nbsp;<span class="ident" id="7702230">i</span><span class="op" id="7702231">++</span>&nbsp;<span class="op" id="7702234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702238">Encode</span><span class="op" id="7702244">(</span><span class="ident" id="7702245">ioutil</span><span class="op" id="7702251">.</span><span class="ident" id="7702252">Discard</span><span class="op" id="7702259">,</span>&nbsp;<span class="ident" id="7702261">img</span><span class="op" id="7702264">,</span>&nbsp;<span class="ident" id="7702266">nil</span><span class="op" id="7702269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702272">}</span><br>
<span class="lineno">205</span><span class="op" id="7702274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7702277">func</span>&nbsp;<span class="ident" id="7702282">BenchmarkQuantizedEncode</span><span class="op" id="7702306">(</span><span class="ident" id="7702307">b</span>&nbsp;<span class="op" id="7702309">*</span><span class="ident" id="7702310">testing</span><span class="op" id="7702317">.</span><span class="ident" id="7702318">B</span><span class="op" id="7702319">)</span>&nbsp;<span class="op" id="7702321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702324">b</span><span class="op" id="7702325">.</span><span class="ident" id="7702326">StopTimer</span><span class="op" id="7702335">(</span><span class="op" id="7702336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702339">img</span>&nbsp;<span class="op" id="7702343">:=</span>&nbsp;<span class="ident" id="7702346">image</span><span class="op" id="7702351">.</span><span class="ident" id="7702352">NewRGBA</span><span class="op" id="7702359">(</span><span class="ident" id="7702360">image</span><span class="op" id="7702365">.</span><span class="ident" id="7702366">Rect</span><span class="op" id="7702370">(</span><span class="num" id="7702371">0</span><span class="op" id="7702372">,</span>&nbsp;<span class="num" id="7702374">0</span><span class="op" id="7702375">,</span>&nbsp;<span class="num" id="7702377">640</span><span class="op" id="7702380">,</span>&nbsp;<span class="num" id="7702382">480</span><span class="op" id="7702385">)</span><span class="op" id="7702386">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702389">bo</span>&nbsp;<span class="op" id="7702392">:=</span>&nbsp;<span class="ident" id="7702395">img</span><span class="op" id="7702398">.</span><span class="ident" id="7702399">Bounds</span><span class="op" id="7702405">(</span><span class="op" id="7702406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702409">rnd</span>&nbsp;<span class="op" id="7702413">:=</span>&nbsp;<span class="ident" id="7702416">rand</span><span class="op" id="7702420">.</span><span class="ident" id="7702421">New</span><span class="op" id="7702424">(</span><span class="ident" id="7702425">rand</span><span class="op" id="7702429">.</span><span class="ident" id="7702430">NewSource</span><span class="op" id="7702439">(</span><span class="num" id="7702440">123</span><span class="op" id="7702443">)</span><span class="op" id="7702444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702447">for</span>&nbsp;<span class="ident" id="7702451">y</span>&nbsp;<span class="op" id="7702453">:=</span>&nbsp;<span class="ident" id="7702456">bo</span><span class="op" id="7702458">.</span><span class="ident" id="7702459">Min</span><span class="op" id="7702462">.</span><span class="ident" id="7702463">Y</span><span class="op" id="7702464">;</span>&nbsp;<span class="ident" id="7702466">y</span>&nbsp;<span class="op" id="7702468">&lt;</span>&nbsp;<span class="ident" id="7702470">bo</span><span class="op" id="7702472">.</span><span class="ident" id="7702473">Max</span><span class="op" id="7702476">.</span><span class="ident" id="7702477">Y</span><span class="op" id="7702478">;</span>&nbsp;<span class="ident" id="7702480">y</span><span class="op" id="7702481">++</span>&nbsp;<span class="op" id="7702484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702488">for</span>&nbsp;<span class="ident" id="7702492">x</span>&nbsp;<span class="op" id="7702494">:=</span>&nbsp;<span class="ident" id="7702497">bo</span><span class="op" id="7702499">.</span><span class="ident" id="7702500">Min</span><span class="op" id="7702503">.</span><span class="ident" id="7702504">X</span><span class="op" id="7702505">;</span>&nbsp;<span class="ident" id="7702507">x</span>&nbsp;<span class="op" id="7702509">&lt;</span>&nbsp;<span class="ident" id="7702511">bo</span><span class="op" id="7702513">.</span><span class="ident" id="7702514">Max</span><span class="op" id="7702517">.</span><span class="ident" id="7702518">X</span><span class="op" id="7702519">;</span>&nbsp;<span class="ident" id="7702521">x</span><span class="op" id="7702522">++</span>&nbsp;<span class="op" id="7702525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702530">img</span><span class="op" id="7702533">.</span><span class="ident" id="7702534">SetRGBA</span><span class="op" id="7702541">(</span><span class="ident" id="7702542">x</span><span class="op" id="7702543">,</span>&nbsp;<span class="ident" id="7702545">y</span><span class="op" id="7702546">,</span>&nbsp;<span class="ident" id="7702548">color</span><span class="op" id="7702553">.</span><span class="ident" id="7702554">RGBA</span><span class="op" id="7702558">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7702564">uint8</span><span class="op" id="7702569">(</span><span class="ident" id="7702570">rnd</span><span class="op" id="7702573">.</span><span class="ident" id="7702574">Intn</span><span class="op" id="7702578">(</span><span class="num" id="7702579">256</span><span class="op" id="7702582">)</span><span class="op" id="7702583">)</span><span class="op" id="7702584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7702590">uint8</span><span class="op" id="7702595">(</span><span class="ident" id="7702596">rnd</span><span class="op" id="7702599">.</span><span class="ident" id="7702600">Intn</span><span class="op" id="7702604">(</span><span class="num" id="7702605">256</span><span class="op" id="7702608">)</span><span class="op" id="7702609">)</span><span class="op" id="7702610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7702616">uint8</span><span class="op" id="7702621">(</span><span class="ident" id="7702622">rnd</span><span class="op" id="7702625">.</span><span class="ident" id="7702626">Intn</span><span class="op" id="7702630">(</span><span class="num" id="7702631">256</span><span class="op" id="7702634">)</span><span class="op" id="7702635">)</span><span class="op" id="7702636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7702642">255</span><span class="op" id="7702645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702650">}</span><span class="op" id="7702651">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702661">b</span><span class="op" id="7702662">.</span><span class="ident" id="7702663">SetBytes</span><span class="op" id="7702671">(</span><span class="num" id="7702672">640</span>&nbsp;<span class="op" id="7702676">*</span>&nbsp;<span class="num" id="7702678">480</span>&nbsp;<span class="op" id="7702682">*</span>&nbsp;<span class="num" id="7702684">4</span><span class="op" id="7702685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702688">b</span><span class="op" id="7702689">.</span><span class="ident" id="7702690">StartTimer</span><span class="op" id="7702700">(</span><span class="op" id="7702701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702704">for</span>&nbsp;<span class="ident" id="7702708">i</span>&nbsp;<span class="op" id="7702710">:=</span>&nbsp;<span class="num" id="7702713">0</span><span class="op" id="7702714">;</span>&nbsp;<span class="ident" id="7702716">i</span>&nbsp;<span class="op" id="7702718">&lt;</span>&nbsp;<span class="ident" id="7702720">b</span><span class="op" id="7702721">.</span><span class="ident" id="7702722">N</span><span class="op" id="7702723">;</span>&nbsp;<span class="ident" id="7702725">i</span><span class="op" id="7702726">++</span>&nbsp;<span class="op" id="7702729">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702733">Encode</span><span class="op" id="7702739">(</span><span class="ident" id="7702740">ioutil</span><span class="op" id="7702746">.</span><span class="ident" id="7702747">Discard</span><span class="op" id="7702754">,</span>&nbsp;<span class="ident" id="7702756">img</span><span class="op" id="7702759">,</span>&nbsp;<span class="ident" id="7702761">nil</span><span class="op" id="7702764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702767">}</span><br>
<span class="lineno"></span><span class="op" id="7702769">}</span>
</div>
</body>
</html>
