<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf16</h2>
<ul>
<li><a href="/gostd/unicode/utf16/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/unicode/utf16/utf16.go.html" class="current">utf16.go</a></li>
<li><a href="/gostd/unicode/utf16/utf16_test.go.html">utf16_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3784910">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3784966">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3785020">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3785071">//&nbsp;Package&nbsp;utf16&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;UTF-16&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="3785142">package</span>&nbsp;<span class="ident" id="3785150">utf16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3785157">//&nbsp;The&nbsp;conditions&nbsp;replacementChar==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3785220">//&nbsp;maxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno">10</span><span class="comment" id="3785275">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3785351">const</span>&nbsp;<span class="op" id="3785357">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785360">replacementChar</span>&nbsp;<span class="op" id="3785376">=</span>&nbsp;<span class="string" id="3785378">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3785391">//&nbsp;Unicode&nbsp;replacement&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785425">maxRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3785441">=</span>&nbsp;<span class="string" id="3785443">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="3785456">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno">15</span><span class="op" id="3785493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3785496">const</span>&nbsp;<span class="op" id="3785502">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785505">//&nbsp;0xd800-0xdc00&nbsp;encodes&nbsp;the&nbsp;high&nbsp;10&nbsp;bits&nbsp;of&nbsp;a&nbsp;pair.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785559">//&nbsp;0xdc00-0xe000&nbsp;encodes&nbsp;the&nbsp;low&nbsp;10&nbsp;bits&nbsp;of&nbsp;a&nbsp;pair.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785612">//&nbsp;the&nbsp;value&nbsp;is&nbsp;those&nbsp;20&nbsp;bits&nbsp;plus&nbsp;0x10000.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785657">surr1</span>&nbsp;<span class="op" id="3785663">=</span>&nbsp;<span class="num" id="3785665">0xd800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785673">surr2</span>&nbsp;<span class="op" id="3785679">=</span>&nbsp;<span class="num" id="3785681">0xdc00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785689">surr3</span>&nbsp;<span class="op" id="3785695">=</span>&nbsp;<span class="num" id="3785697">0xe000</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785706">surrSelf</span>&nbsp;<span class="op" id="3785715">=</span>&nbsp;<span class="num" id="3785717">0x10000</span><br>
<span class="lineno"></span><span class="op" id="3785725">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3785728">//&nbsp;IsSurrogate&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="3785792">//&nbsp;can&nbsp;appear&nbsp;in&nbsp;a&nbsp;surrogate&nbsp;pair.</span><br>
<span class="lineno">30</span><span class="keyword" id="3785827">func</span>&nbsp;<span class="ident" id="3785832">IsSurrogate</span><span class="op" id="3785843">(</span><span class="ident" id="3785844">r</span>&nbsp;<span class="builtintype" id="3785846">rune</span><span class="op" id="3785850">)</span>&nbsp;<span class="builtintype" id="3785852">bool</span>&nbsp;<span class="op" id="3785857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785860">return</span>&nbsp;<span class="ident" id="3785867">surr1</span>&nbsp;<span class="op" id="3785873">&lt;=</span>&nbsp;<span class="ident" id="3785876">r</span>&nbsp;<span class="op" id="3785878">&amp;&amp;</span>&nbsp;<span class="ident" id="3785881">r</span>&nbsp;<span class="op" id="3785883">&lt;</span>&nbsp;<span class="ident" id="3785885">surr3</span><br>
<span class="lineno"></span><span class="op" id="3785891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3785894">//&nbsp;DecodeRune&nbsp;returns&nbsp;the&nbsp;UTF-16&nbsp;decoding&nbsp;of&nbsp;a&nbsp;surrogate&nbsp;pair.</span><br>
<span class="lineno">35</span><span class="comment" id="3785957">//&nbsp;If&nbsp;the&nbsp;pair&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;UTF-16&nbsp;surrogate&nbsp;pair,&nbsp;DecodeRune&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3786029">//&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;code&nbsp;point&nbsp;U+FFFD.</span><br>
<span class="lineno"></span><span class="keyword" id="3786075">func</span>&nbsp;<span class="ident" id="3786080">DecodeRune</span><span class="op" id="3786090">(</span><span class="ident" id="3786091">r1</span><span class="op" id="3786093">,</span>&nbsp;<span class="ident" id="3786095">r2</span>&nbsp;<span class="builtintype" id="3786098">rune</span><span class="op" id="3786102">)</span>&nbsp;<span class="builtintype" id="3786104">rune</span>&nbsp;<span class="op" id="3786109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786112">if</span>&nbsp;<span class="ident" id="3786115">surr1</span>&nbsp;<span class="op" id="3786121">&lt;=</span>&nbsp;<span class="ident" id="3786124">r1</span>&nbsp;<span class="op" id="3786127">&amp;&amp;</span>&nbsp;<span class="ident" id="3786130">r1</span>&nbsp;<span class="op" id="3786133">&lt;</span>&nbsp;<span class="ident" id="3786135">surr2</span>&nbsp;<span class="op" id="3786141">&amp;&amp;</span>&nbsp;<span class="ident" id="3786144">surr2</span>&nbsp;<span class="op" id="3786150">&lt;=</span>&nbsp;<span class="ident" id="3786153">r2</span>&nbsp;<span class="op" id="3786156">&amp;&amp;</span>&nbsp;<span class="ident" id="3786159">r2</span>&nbsp;<span class="op" id="3786162">&lt;</span>&nbsp;<span class="ident" id="3786164">surr3</span>&nbsp;<span class="op" id="3786170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786174">return</span>&nbsp;<span class="op" id="3786181">(</span><span class="ident" id="3786182">r1</span><span class="op" id="3786184">-</span><span class="ident" id="3786185">surr1</span><span class="op" id="3786190">)</span><span class="op" id="3786191">&lt;&lt;</span><span class="num" id="3786193">10</span>&nbsp;<span class="op" id="3786196">|</span>&nbsp;<span class="op" id="3786198">(</span><span class="ident" id="3786199">r2</span>&nbsp;<span class="op" id="3786202">-</span>&nbsp;<span class="ident" id="3786204">surr2</span><span class="op" id="3786209">)</span>&nbsp;<span class="op" id="3786211">+</span>&nbsp;<span class="num" id="3786213">0x10000</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786225">return</span>&nbsp;<span class="ident" id="3786232">replacementChar</span><br>
<span class="lineno"></span><span class="op" id="3786248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786251">//&nbsp;EncodeRune&nbsp;returns&nbsp;the&nbsp;UTF-16&nbsp;surrogate&nbsp;pair&nbsp;r1,&nbsp;r2&nbsp;for&nbsp;the&nbsp;given&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="3786326">//&nbsp;If&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;or&nbsp;does&nbsp;not&nbsp;need&nbsp;encoding,</span><br>
<span class="lineno"></span><span class="comment" id="3786402">//&nbsp;EncodeRune&nbsp;returns&nbsp;U+FFFD,&nbsp;U+FFFD.</span><br>
<span class="lineno"></span><span class="keyword" id="3786440">func</span>&nbsp;<span class="ident" id="3786445">EncodeRune</span><span class="op" id="3786455">(</span><span class="ident" id="3786456">r</span>&nbsp;<span class="builtintype" id="3786458">rune</span><span class="op" id="3786462">)</span>&nbsp;<span class="op" id="3786464">(</span><span class="ident" id="3786465">r1</span><span class="op" id="3786467">,</span>&nbsp;<span class="ident" id="3786469">r2</span>&nbsp;<span class="builtintype" id="3786472">rune</span><span class="op" id="3786476">)</span>&nbsp;<span class="op" id="3786478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786481">if</span>&nbsp;<span class="ident" id="3786484">r</span>&nbsp;<span class="op" id="3786486">&lt;</span>&nbsp;<span class="ident" id="3786488">surrSelf</span>&nbsp;<span class="op" id="3786497">||</span>&nbsp;<span class="ident" id="3786500">r</span>&nbsp;<span class="op" id="3786502">&gt;</span>&nbsp;<span class="ident" id="3786504">maxRune</span>&nbsp;<span class="op" id="3786512">||</span>&nbsp;<span class="ident" id="3786515">IsSurrogate</span><span class="op" id="3786526">(</span><span class="ident" id="3786527">r</span><span class="op" id="3786528">)</span>&nbsp;<span class="op" id="3786530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786534">return</span>&nbsp;<span class="ident" id="3786541">replacementChar</span><span class="op" id="3786556">,</span>&nbsp;<span class="ident" id="3786558">replacementChar</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786578">r</span>&nbsp;<span class="op" id="3786580">-=</span>&nbsp;<span class="ident" id="3786583">surrSelf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786593">return</span>&nbsp;<span class="ident" id="3786600">surr1</span>&nbsp;<span class="op" id="3786606">+</span>&nbsp;<span class="op" id="3786608">(</span><span class="ident" id="3786609">r</span><span class="op" id="3786610">&gt;&gt;</span><span class="num" id="3786612">10</span><span class="op" id="3786614">)</span><span class="op" id="3786615">&amp;</span><span class="num" id="3786616">0x3ff</span><span class="op" id="3786621">,</span>&nbsp;<span class="ident" id="3786623">surr2</span>&nbsp;<span class="op" id="3786629">+</span>&nbsp;<span class="ident" id="3786631">r</span><span class="op" id="3786632">&amp;</span><span class="num" id="3786633">0x3ff</span><br>
<span class="lineno"></span><span class="op" id="3786639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3786642">//&nbsp;Encode&nbsp;returns&nbsp;the&nbsp;UTF-16&nbsp;encoding&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;sequence&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3786718">func</span>&nbsp;<span class="ident" id="3786723">Encode</span><span class="op" id="3786729">(</span><span class="ident" id="3786730">s</span>&nbsp;<span class="op" id="3786732">[</span><span class="op" id="3786733">]</span><span class="builtintype" id="3786734">rune</span><span class="op" id="3786738">)</span>&nbsp;<span class="op" id="3786740">[</span><span class="op" id="3786741">]</span><span class="builtintype" id="3786742">uint16</span>&nbsp;<span class="op" id="3786749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786752">n</span>&nbsp;<span class="op" id="3786754">:=</span>&nbsp;<span class="builtinfunc" id="3786757">len</span><span class="op" id="3786760">(</span><span class="ident" id="3786761">s</span><span class="op" id="3786762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786765">for</span>&nbsp;<span class="ident" id="3786769">_</span><span class="op" id="3786770">,</span>&nbsp;<span class="ident" id="3786772">v</span>&nbsp;<span class="op" id="3786774">:=</span>&nbsp;<span class="keyword" id="3786777">range</span>&nbsp;<span class="ident" id="3786783">s</span>&nbsp;<span class="op" id="3786785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786789">if</span>&nbsp;<span class="ident" id="3786792">v</span>&nbsp;<span class="op" id="3786794">&gt;=</span>&nbsp;<span class="ident" id="3786797">surrSelf</span>&nbsp;<span class="op" id="3786806">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786811">n</span><span class="op" id="3786812">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786824">a</span>&nbsp;<span class="op" id="3786826">:=</span>&nbsp;<span class="builtinfunc" id="3786829">make</span><span class="op" id="3786833">(</span><span class="op" id="3786834">[</span><span class="op" id="3786835">]</span><span class="builtintype" id="3786836">uint16</span><span class="op" id="3786842">,</span>&nbsp;<span class="ident" id="3786844">n</span><span class="op" id="3786845">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786848">n</span>&nbsp;<span class="op" id="3786850">=</span>&nbsp;<span class="num" id="3786852">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786855">for</span>&nbsp;<span class="ident" id="3786859">_</span><span class="op" id="3786860">,</span>&nbsp;<span class="ident" id="3786862">v</span>&nbsp;<span class="op" id="3786864">:=</span>&nbsp;<span class="keyword" id="3786867">range</span>&nbsp;<span class="ident" id="3786873">s</span>&nbsp;<span class="op" id="3786875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786879">switch</span>&nbsp;<span class="op" id="3786886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786890">case</span>&nbsp;<span class="ident" id="3786895">v</span>&nbsp;<span class="op" id="3786897">&lt;</span>&nbsp;<span class="num" id="3786899">0</span><span class="op" id="3786900">,</span>&nbsp;<span class="ident" id="3786902">surr1</span>&nbsp;<span class="op" id="3786908">&lt;=</span>&nbsp;<span class="ident" id="3786911">v</span>&nbsp;<span class="op" id="3786913">&amp;&amp;</span>&nbsp;<span class="ident" id="3786916">v</span>&nbsp;<span class="op" id="3786918">&lt;</span>&nbsp;<span class="ident" id="3786920">surr3</span><span class="op" id="3786925">,</span>&nbsp;<span class="ident" id="3786927">v</span>&nbsp;<span class="op" id="3786929">&gt;</span>&nbsp;<span class="ident" id="3786931">maxRune</span><span class="op" id="3786938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786943">v</span>&nbsp;<span class="op" id="3786945">=</span>&nbsp;<span class="ident" id="3786947">replacementChar</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786966">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786980">case</span>&nbsp;<span class="ident" id="3786985">v</span>&nbsp;<span class="op" id="3786987">&lt;</span>&nbsp;<span class="ident" id="3786989">surrSelf</span><span class="op" id="3786997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787002">a</span><span class="op" id="3787003">[</span><span class="ident" id="3787004">n</span><span class="op" id="3787005">]</span>&nbsp;<span class="op" id="3787007">=</span>&nbsp;<span class="builtintype" id="3787009">uint16</span><span class="op" id="3787015">(</span><span class="ident" id="3787016">v</span><span class="op" id="3787017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787022">n</span><span class="op" id="3787023">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787028">default</span><span class="op" id="3787035">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787040">r1</span><span class="op" id="3787042">,</span>&nbsp;<span class="ident" id="3787044">r2</span>&nbsp;<span class="op" id="3787047">:=</span>&nbsp;<span class="ident" id="3787050">EncodeRune</span><span class="op" id="3787060">(</span><span class="ident" id="3787061">v</span><span class="op" id="3787062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787067">a</span><span class="op" id="3787068">[</span><span class="ident" id="3787069">n</span><span class="op" id="3787070">]</span>&nbsp;<span class="op" id="3787072">=</span>&nbsp;<span class="builtintype" id="3787074">uint16</span><span class="op" id="3787080">(</span><span class="ident" id="3787081">r1</span><span class="op" id="3787083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787088">a</span><span class="op" id="3787089">[</span><span class="ident" id="3787090">n</span><span class="op" id="3787091">+</span><span class="num" id="3787092">1</span><span class="op" id="3787093">]</span>&nbsp;<span class="op" id="3787095">=</span>&nbsp;<span class="builtintype" id="3787097">uint16</span><span class="op" id="3787103">(</span><span class="ident" id="3787104">r2</span><span class="op" id="3787106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787111">n</span>&nbsp;<span class="op" id="3787113">+=</span>&nbsp;<span class="num" id="3787116">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787120">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787126">return</span>&nbsp;<span class="ident" id="3787133">a</span><span class="op" id="3787134">[</span><span class="num" id="3787135">0</span><span class="op" id="3787136">:</span><span class="ident" id="3787137">n</span><span class="op" id="3787138">]</span><br>
<span class="lineno"></span><span class="op" id="3787140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3787143">//&nbsp;Decode&nbsp;returns&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;sequence&nbsp;represented</span><br>
<span class="lineno">85</span><span class="comment" id="3787205">//&nbsp;by&nbsp;the&nbsp;UTF-16&nbsp;encoding&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3787234">func</span>&nbsp;<span class="ident" id="3787239">Decode</span><span class="op" id="3787245">(</span><span class="ident" id="3787246">s</span>&nbsp;<span class="op" id="3787248">[</span><span class="op" id="3787249">]</span><span class="builtintype" id="3787250">uint16</span><span class="op" id="3787256">)</span>&nbsp;<span class="op" id="3787258">[</span><span class="op" id="3787259">]</span><span class="builtintype" id="3787260">rune</span>&nbsp;<span class="op" id="3787265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787268">a</span>&nbsp;<span class="op" id="3787270">:=</span>&nbsp;<span class="builtinfunc" id="3787273">make</span><span class="op" id="3787277">(</span><span class="op" id="3787278">[</span><span class="op" id="3787279">]</span><span class="builtintype" id="3787280">rune</span><span class="op" id="3787284">,</span>&nbsp;<span class="builtinfunc" id="3787286">len</span><span class="op" id="3787289">(</span><span class="ident" id="3787290">s</span><span class="op" id="3787291">)</span><span class="op" id="3787292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787295">n</span>&nbsp;<span class="op" id="3787297">:=</span>&nbsp;<span class="num" id="3787300">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787303">for</span>&nbsp;<span class="ident" id="3787307">i</span>&nbsp;<span class="op" id="3787309">:=</span>&nbsp;<span class="num" id="3787312">0</span><span class="op" id="3787313">;</span>&nbsp;<span class="ident" id="3787315">i</span>&nbsp;<span class="op" id="3787317">&lt;</span>&nbsp;<span class="builtinfunc" id="3787319">len</span><span class="op" id="3787322">(</span><span class="ident" id="3787323">s</span><span class="op" id="3787324">)</span><span class="op" id="3787325">;</span>&nbsp;<span class="ident" id="3787327">i</span><span class="op" id="3787328">++</span>&nbsp;<span class="op" id="3787331">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787335">switch</span>&nbsp;<span class="ident" id="3787342">r</span>&nbsp;<span class="op" id="3787344">:=</span>&nbsp;<span class="ident" id="3787347">s</span><span class="op" id="3787348">[</span><span class="ident" id="3787349">i</span><span class="op" id="3787350">]</span><span class="op" id="3787351">;</span>&nbsp;<span class="op" id="3787353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787357">case</span>&nbsp;<span class="ident" id="3787362">surr1</span>&nbsp;<span class="op" id="3787368">&lt;=</span>&nbsp;<span class="ident" id="3787371">r</span>&nbsp;<span class="op" id="3787373">&amp;&amp;</span>&nbsp;<span class="ident" id="3787376">r</span>&nbsp;<span class="op" id="3787378">&lt;</span>&nbsp;<span class="ident" id="3787380">surr2</span>&nbsp;<span class="op" id="3787386">&amp;&amp;</span>&nbsp;<span class="ident" id="3787389">i</span><span class="op" id="3787390">+</span><span class="num" id="3787391">1</span>&nbsp;<span class="op" id="3787393">&lt;</span>&nbsp;<span class="builtinfunc" id="3787395">len</span><span class="op" id="3787398">(</span><span class="ident" id="3787399">s</span><span class="op" id="3787400">)</span>&nbsp;<span class="op" id="3787402">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787408">surr2</span>&nbsp;<span class="op" id="3787414">&lt;=</span>&nbsp;<span class="ident" id="3787417">s</span><span class="op" id="3787418">[</span><span class="ident" id="3787419">i</span><span class="op" id="3787420">+</span><span class="num" id="3787421">1</span><span class="op" id="3787422">]</span>&nbsp;<span class="op" id="3787424">&amp;&amp;</span>&nbsp;<span class="ident" id="3787427">s</span><span class="op" id="3787428">[</span><span class="ident" id="3787429">i</span><span class="op" id="3787430">+</span><span class="num" id="3787431">1</span><span class="op" id="3787432">]</span>&nbsp;<span class="op" id="3787434">&lt;</span>&nbsp;<span class="ident" id="3787436">surr3</span><span class="op" id="3787441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787446">//&nbsp;valid&nbsp;surrogate&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787477">a</span><span class="op" id="3787478">[</span><span class="ident" id="3787479">n</span><span class="op" id="3787480">]</span>&nbsp;<span class="op" id="3787482">=</span>&nbsp;<span class="ident" id="3787484">DecodeRune</span><span class="op" id="3787494">(</span><span class="builtintype" id="3787495">rune</span><span class="op" id="3787499">(</span><span class="ident" id="3787500">r</span><span class="op" id="3787501">)</span><span class="op" id="3787502">,</span>&nbsp;<span class="builtintype" id="3787504">rune</span><span class="op" id="3787508">(</span><span class="ident" id="3787509">s</span><span class="op" id="3787510">[</span><span class="ident" id="3787511">i</span><span class="op" id="3787512">+</span><span class="num" id="3787513">1</span><span class="op" id="3787514">]</span><span class="op" id="3787515">)</span><span class="op" id="3787516">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787521">i</span><span class="op" id="3787522">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787528">n</span><span class="op" id="3787529">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787534">case</span>&nbsp;<span class="ident" id="3787539">surr1</span>&nbsp;<span class="op" id="3787545">&lt;=</span>&nbsp;<span class="ident" id="3787548">r</span>&nbsp;<span class="op" id="3787550">&amp;&amp;</span>&nbsp;<span class="ident" id="3787553">r</span>&nbsp;<span class="op" id="3787555">&lt;</span>&nbsp;<span class="ident" id="3787557">surr3</span><span class="op" id="3787562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787567">//&nbsp;invalid&nbsp;surrogate&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787600">a</span><span class="op" id="3787601">[</span><span class="ident" id="3787602">n</span><span class="op" id="3787603">]</span>&nbsp;<span class="op" id="3787605">=</span>&nbsp;<span class="ident" id="3787607">replacementChar</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787626">n</span><span class="op" id="3787627">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787632">default</span><span class="op" id="3787639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787644">//&nbsp;normal&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787662">a</span><span class="op" id="3787663">[</span><span class="ident" id="3787664">n</span><span class="op" id="3787665">]</span>&nbsp;<span class="op" id="3787667">=</span>&nbsp;<span class="builtintype" id="3787669">rune</span><span class="op" id="3787673">(</span><span class="ident" id="3787674">r</span><span class="op" id="3787675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787680">n</span><span class="op" id="3787681">++</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787692">return</span>&nbsp;<span class="ident" id="3787699">a</span><span class="op" id="3787700">[</span><span class="num" id="3787701">0</span><span class="op" id="3787702">:</span><span class="ident" id="3787703">n</span><span class="op" id="3787704">]</span><br>
<span class="lineno"></span><span class="op" id="3787706">}</span>
</div>
</body>
</html>
