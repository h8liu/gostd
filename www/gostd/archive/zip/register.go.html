<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6310646">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6310701">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6310755">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6310806">package</span>&nbsp;<span class="ident" id="6310814">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6310819">import</span>&nbsp;<span class="op" id="6310826">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310829">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310847">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310857">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310863">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310876">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6310883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6310886">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6310947">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6311013">type</span>&nbsp;<span class="ident" id="6311018">Compressor</span>&nbsp;<span class="keyword" id="6311029">func</span><span class="op" id="6311033">(</span><span class="ident" id="6311034">io</span><span class="op" id="6311036">.</span><span class="ident" id="6311037">Writer</span><span class="op" id="6311043">)</span>&nbsp;<span class="op" id="6311045">(</span><span class="ident" id="6311046">io</span><span class="op" id="6311048">.</span><span class="ident" id="6311049">WriteCloser</span><span class="op" id="6311060">,</span>&nbsp;<span class="builtintype" id="6311062">error</span><span class="op" id="6311067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6311070">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="6311149">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6311223">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="6311301">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="6311335">type</span>&nbsp;<span class="ident" id="6311340">Decompressor</span>&nbsp;<span class="keyword" id="6311353">func</span><span class="op" id="6311357">(</span><span class="ident" id="6311358">io</span><span class="op" id="6311360">.</span><span class="ident" id="6311361">Reader</span><span class="op" id="6311367">)</span>&nbsp;<span class="ident" id="6311369">io</span><span class="op" id="6311371">.</span><span class="ident" id="6311372">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6311384">var</span>&nbsp;<span class="ident" id="6311388">flateWriterPool</span>&nbsp;<span class="ident" id="6311404">sync</span><span class="op" id="6311408">.</span><span class="ident" id="6311409">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6311415">func</span>&nbsp;<span class="ident" id="6311420">newFlateWriter</span><span class="op" id="6311434">(</span><span class="ident" id="6311435">w</span>&nbsp;<span class="ident" id="6311437">io</span><span class="op" id="6311439">.</span><span class="ident" id="6311440">Writer</span><span class="op" id="6311446">)</span>&nbsp;<span class="ident" id="6311448">io</span><span class="op" id="6311450">.</span><span class="ident" id="6311451">WriteCloser</span>&nbsp;<span class="op" id="6311463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311466">fw</span><span class="op" id="6311468">,</span>&nbsp;<span class="ident" id="6311470">ok</span>&nbsp;<span class="op" id="6311473">:=</span>&nbsp;<span class="ident" id="6311476">flateWriterPool</span><span class="op" id="6311491">.</span><span class="ident" id="6311492">Get</span><span class="op" id="6311495">(</span><span class="op" id="6311496">)</span><span class="op" id="6311497">.</span><span class="op" id="6311498">(</span><span class="op" id="6311499">*</span><span class="ident" id="6311500">flate</span><span class="op" id="6311505">.</span><span class="ident" id="6311506">Writer</span><span class="op" id="6311512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311515">if</span>&nbsp;<span class="ident" id="6311518">ok</span>&nbsp;<span class="op" id="6311521">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311525">fw</span><span class="op" id="6311527">.</span><span class="ident" id="6311528">Reset</span><span class="op" id="6311533">(</span><span class="ident" id="6311534">w</span><span class="op" id="6311535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311538">}</span>&nbsp;<span class="keyword" id="6311540">else</span>&nbsp;<span class="op" id="6311545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311549">fw</span><span class="op" id="6311551">,</span>&nbsp;<span class="ident" id="6311553">_</span>&nbsp;<span class="op" id="6311555">=</span>&nbsp;<span class="ident" id="6311557">flate</span><span class="op" id="6311562">.</span><span class="ident" id="6311563">NewWriter</span><span class="op" id="6311572">(</span><span class="ident" id="6311573">w</span><span class="op" id="6311574">,</span>&nbsp;<span class="num" id="6311576">5</span><span class="op" id="6311577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311583">return</span>&nbsp;<span class="op" id="6311590">&amp;</span><span class="ident" id="6311591">pooledFlateWriter</span><span class="op" id="6311608">{</span><span class="ident" id="6311609">fw</span><span class="op" id="6311611">:</span>&nbsp;<span class="ident" id="6311613">fw</span><span class="op" id="6311615">}</span><br>
<span class="lineno">35</span><span class="op" id="6311617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6311620">type</span>&nbsp;<span class="ident" id="6311625">pooledFlateWriter</span>&nbsp;<span class="keyword" id="6311643">struct</span>&nbsp;<span class="op" id="6311650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311653">mu</span>&nbsp;<span class="ident" id="6311656">sync</span><span class="op" id="6311660">.</span><span class="ident" id="6311661">Mutex</span>&nbsp;<span class="comment" id="6311667">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311694">fw</span>&nbsp;<span class="op" id="6311697">*</span><span class="ident" id="6311698">flate</span><span class="op" id="6311703">.</span><span class="ident" id="6311704">Writer</span><br>
<span class="lineno">40</span><span class="op" id="6311711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6311714">func</span>&nbsp;<span class="op" id="6311719">(</span><span class="ident" id="6311720">w</span>&nbsp;<span class="op" id="6311722">*</span><span class="ident" id="6311723">pooledFlateWriter</span><span class="op" id="6311740">)</span>&nbsp;<span class="ident" id="6311742">Write</span><span class="op" id="6311747">(</span><span class="ident" id="6311748">p</span>&nbsp;<span class="op" id="6311750">[</span><span class="op" id="6311751">]</span><span class="builtintype" id="6311752">byte</span><span class="op" id="6311756">)</span>&nbsp;<span class="op" id="6311758">(</span><span class="ident" id="6311759">n</span>&nbsp;<span class="builtintype" id="6311761">int</span><span class="op" id="6311764">,</span>&nbsp;<span class="ident" id="6311766">err</span>&nbsp;<span class="builtintype" id="6311770">error</span><span class="op" id="6311775">)</span>&nbsp;<span class="op" id="6311777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311780">w</span><span class="op" id="6311781">.</span><span class="ident" id="6311782">mu</span><span class="op" id="6311784">.</span><span class="ident" id="6311785">Lock</span><span class="op" id="6311789">(</span><span class="op" id="6311790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311793">defer</span>&nbsp;<span class="ident" id="6311799">w</span><span class="op" id="6311800">.</span><span class="ident" id="6311801">mu</span><span class="op" id="6311803">.</span><span class="ident" id="6311804">Unlock</span><span class="op" id="6311810">(</span><span class="op" id="6311811">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311814">if</span>&nbsp;<span class="ident" id="6311817">w</span><span class="op" id="6311818">.</span><span class="ident" id="6311819">fw</span>&nbsp;<span class="op" id="6311822">==</span>&nbsp;<span class="ident" id="6311825">nil</span>&nbsp;<span class="op" id="6311829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311833">return</span>&nbsp;<span class="num" id="6311840">0</span><span class="op" id="6311841">,</span>&nbsp;<span class="ident" id="6311843">errors</span><span class="op" id="6311849">.</span><span class="ident" id="6311850">New</span><span class="op" id="6311853">(</span><span class="string" id="6311854">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="6311873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311879">return</span>&nbsp;<span class="ident" id="6311886">w</span><span class="op" id="6311887">.</span><span class="ident" id="6311888">fw</span><span class="op" id="6311890">.</span><span class="ident" id="6311891">Write</span><span class="op" id="6311896">(</span><span class="ident" id="6311897">p</span><span class="op" id="6311898">)</span><br>
<span class="lineno"></span><span class="op" id="6311900">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6311903">func</span>&nbsp;<span class="op" id="6311908">(</span><span class="ident" id="6311909">w</span>&nbsp;<span class="op" id="6311911">*</span><span class="ident" id="6311912">pooledFlateWriter</span><span class="op" id="6311929">)</span>&nbsp;<span class="ident" id="6311931">Close</span><span class="op" id="6311936">(</span><span class="op" id="6311937">)</span>&nbsp;<span class="builtintype" id="6311939">error</span>&nbsp;<span class="op" id="6311945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311948">w</span><span class="op" id="6311949">.</span><span class="ident" id="6311950">mu</span><span class="op" id="6311952">.</span><span class="ident" id="6311953">Lock</span><span class="op" id="6311957">(</span><span class="op" id="6311958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311961">defer</span>&nbsp;<span class="ident" id="6311967">w</span><span class="op" id="6311968">.</span><span class="ident" id="6311969">mu</span><span class="op" id="6311971">.</span><span class="ident" id="6311972">Unlock</span><span class="op" id="6311978">(</span><span class="op" id="6311979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311982">var</span>&nbsp;<span class="ident" id="6311986">err</span>&nbsp;<span class="builtintype" id="6311990">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311997">if</span>&nbsp;<span class="ident" id="6312000">w</span><span class="op" id="6312001">.</span><span class="ident" id="6312002">fw</span>&nbsp;<span class="op" id="6312005">!=</span>&nbsp;<span class="ident" id="6312008">nil</span>&nbsp;<span class="op" id="6312012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312016">err</span>&nbsp;<span class="op" id="6312020">=</span>&nbsp;<span class="ident" id="6312022">w</span><span class="op" id="6312023">.</span><span class="ident" id="6312024">fw</span><span class="op" id="6312026">.</span><span class="ident" id="6312027">Close</span><span class="op" id="6312032">(</span><span class="op" id="6312033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312037">flateWriterPool</span><span class="op" id="6312052">.</span><span class="ident" id="6312053">Put</span><span class="op" id="6312056">(</span><span class="ident" id="6312057">w</span><span class="op" id="6312058">.</span><span class="ident" id="6312059">fw</span><span class="op" id="6312061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312065">w</span><span class="op" id="6312066">.</span><span class="ident" id="6312067">fw</span>&nbsp;<span class="op" id="6312070">=</span>&nbsp;<span class="ident" id="6312072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312077">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312080">return</span>&nbsp;<span class="ident" id="6312087">err</span><br>
<span class="lineno"></span><span class="op" id="6312091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6312094">var</span>&nbsp;<span class="op" id="6312098">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312101">mu</span>&nbsp;<span class="ident" id="6312104">sync</span><span class="op" id="6312108">.</span><span class="ident" id="6312109">RWMutex</span>&nbsp;<span class="comment" id="6312117">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312162">compressors</span>&nbsp;<span class="op" id="6312174">=</span>&nbsp;<span class="keyword" id="6312176">map</span><span class="op" id="6312179">[</span><span class="builtintype" id="6312180">uint16</span><span class="op" id="6312186">]</span><span class="ident" id="6312187">Compressor</span><span class="op" id="6312197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312201">Store</span><span class="op" id="6312206">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6312210">func</span><span class="op" id="6312214">(</span><span class="ident" id="6312215">w</span>&nbsp;<span class="ident" id="6312217">io</span><span class="op" id="6312219">.</span><span class="ident" id="6312220">Writer</span><span class="op" id="6312226">)</span>&nbsp;<span class="op" id="6312228">(</span><span class="ident" id="6312229">io</span><span class="op" id="6312231">.</span><span class="ident" id="6312232">WriteCloser</span><span class="op" id="6312243">,</span>&nbsp;<span class="builtintype" id="6312245">error</span><span class="op" id="6312250">)</span>&nbsp;<span class="op" id="6312252">{</span>&nbsp;<span class="keyword" id="6312254">return</span>&nbsp;<span class="op" id="6312261">&amp;</span><span class="ident" id="6312262">nopCloser</span><span class="op" id="6312271">{</span><span class="ident" id="6312272">w</span><span class="op" id="6312273">}</span><span class="op" id="6312274">,</span>&nbsp;<span class="ident" id="6312276">nil</span>&nbsp;<span class="op" id="6312280">}</span><span class="op" id="6312281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312285">Deflate</span><span class="op" id="6312292">:</span>&nbsp;<span class="keyword" id="6312294">func</span><span class="op" id="6312298">(</span><span class="ident" id="6312299">w</span>&nbsp;<span class="ident" id="6312301">io</span><span class="op" id="6312303">.</span><span class="ident" id="6312304">Writer</span><span class="op" id="6312310">)</span>&nbsp;<span class="op" id="6312312">(</span><span class="ident" id="6312313">io</span><span class="op" id="6312315">.</span><span class="ident" id="6312316">WriteCloser</span><span class="op" id="6312327">,</span>&nbsp;<span class="builtintype" id="6312329">error</span><span class="op" id="6312334">)</span>&nbsp;<span class="op" id="6312336">{</span>&nbsp;<span class="keyword" id="6312338">return</span>&nbsp;<span class="ident" id="6312345">newFlateWriter</span><span class="op" id="6312359">(</span><span class="ident" id="6312360">w</span><span class="op" id="6312361">)</span><span class="op" id="6312362">,</span>&nbsp;<span class="ident" id="6312364">nil</span>&nbsp;<span class="op" id="6312368">}</span><span class="op" id="6312369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312372">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312376">decompressors</span>&nbsp;<span class="op" id="6312390">=</span>&nbsp;<span class="keyword" id="6312392">map</span><span class="op" id="6312395">[</span><span class="builtintype" id="6312396">uint16</span><span class="op" id="6312402">]</span><span class="ident" id="6312403">Decompressor</span><span class="op" id="6312415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312419">Store</span><span class="op" id="6312424">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6312428">ioutil</span><span class="op" id="6312434">.</span><span class="ident" id="6312435">NopCloser</span><span class="op" id="6312444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312448">Deflate</span><span class="op" id="6312455">:</span>&nbsp;<span class="ident" id="6312457">flate</span><span class="op" id="6312462">.</span><span class="ident" id="6312463">NewReader</span><span class="op" id="6312472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312475">}</span><br>
<span class="lineno">75</span><span class="op" id="6312477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6312480">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="6312559">func</span>&nbsp;<span class="ident" id="6312564">RegisterDecompressor</span><span class="op" id="6312584">(</span><span class="ident" id="6312585">method</span>&nbsp;<span class="builtintype" id="6312592">uint16</span><span class="op" id="6312598">,</span>&nbsp;<span class="ident" id="6312600">d</span>&nbsp;<span class="ident" id="6312602">Decompressor</span><span class="op" id="6312614">)</span>&nbsp;<span class="op" id="6312616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312619">mu</span><span class="op" id="6312621">.</span><span class="ident" id="6312622">Lock</span><span class="op" id="6312626">(</span><span class="op" id="6312627">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312630">defer</span>&nbsp;<span class="ident" id="6312636">mu</span><span class="op" id="6312638">.</span><span class="ident" id="6312639">Unlock</span><span class="op" id="6312645">(</span><span class="op" id="6312646">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312650">if</span>&nbsp;<span class="ident" id="6312653">_</span><span class="op" id="6312654">,</span>&nbsp;<span class="ident" id="6312656">ok</span>&nbsp;<span class="op" id="6312659">:=</span>&nbsp;<span class="ident" id="6312662">decompressors</span><span class="op" id="6312675">[</span><span class="ident" id="6312676">method</span><span class="op" id="6312682">]</span><span class="op" id="6312683">;</span>&nbsp;<span class="ident" id="6312685">ok</span>&nbsp;<span class="op" id="6312688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6312692">panic</span><span class="op" id="6312697">(</span><span class="string" id="6312698">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6312731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312734">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312737">decompressors</span><span class="op" id="6312750">[</span><span class="ident" id="6312751">method</span><span class="op" id="6312757">]</span>&nbsp;<span class="op" id="6312759">=</span>&nbsp;<span class="ident" id="6312761">d</span><br>
<span class="lineno"></span><span class="op" id="6312763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6312766">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="6312844">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="6312898">func</span>&nbsp;<span class="ident" id="6312903">RegisterCompressor</span><span class="op" id="6312921">(</span><span class="ident" id="6312922">method</span>&nbsp;<span class="builtintype" id="6312929">uint16</span><span class="op" id="6312935">,</span>&nbsp;<span class="ident" id="6312937">comp</span>&nbsp;<span class="ident" id="6312942">Compressor</span><span class="op" id="6312952">)</span>&nbsp;<span class="op" id="6312954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312957">mu</span><span class="op" id="6312959">.</span><span class="ident" id="6312960">Lock</span><span class="op" id="6312964">(</span><span class="op" id="6312965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312968">defer</span>&nbsp;<span class="ident" id="6312974">mu</span><span class="op" id="6312976">.</span><span class="ident" id="6312977">Unlock</span><span class="op" id="6312983">(</span><span class="op" id="6312984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312988">if</span>&nbsp;<span class="ident" id="6312991">_</span><span class="op" id="6312992">,</span>&nbsp;<span class="ident" id="6312994">ok</span>&nbsp;<span class="op" id="6312997">:=</span>&nbsp;<span class="ident" id="6313000">compressors</span><span class="op" id="6313011">[</span><span class="ident" id="6313012">method</span><span class="op" id="6313018">]</span><span class="op" id="6313019">;</span>&nbsp;<span class="ident" id="6313021">ok</span>&nbsp;<span class="op" id="6313024">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6313028">panic</span><span class="op" id="6313033">(</span><span class="string" id="6313034">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6313065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313071">compressors</span><span class="op" id="6313082">[</span><span class="ident" id="6313083">method</span><span class="op" id="6313089">]</span>&nbsp;<span class="op" id="6313091">=</span>&nbsp;<span class="ident" id="6313093">comp</span><br>
<span class="lineno"></span><span class="op" id="6313098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6313101">func</span>&nbsp;<span class="ident" id="6313106">compressor</span><span class="op" id="6313116">(</span><span class="ident" id="6313117">method</span>&nbsp;<span class="builtintype" id="6313124">uint16</span><span class="op" id="6313130">)</span>&nbsp;<span class="ident" id="6313132">Compressor</span>&nbsp;<span class="op" id="6313143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313146">mu</span><span class="op" id="6313148">.</span><span class="ident" id="6313149">RLock</span><span class="op" id="6313154">(</span><span class="op" id="6313155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313158">defer</span>&nbsp;<span class="ident" id="6313164">mu</span><span class="op" id="6313166">.</span><span class="ident" id="6313167">RUnlock</span><span class="op" id="6313174">(</span><span class="op" id="6313175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313178">return</span>&nbsp;<span class="ident" id="6313185">compressors</span><span class="op" id="6313196">[</span><span class="ident" id="6313197">method</span><span class="op" id="6313203">]</span><br>
<span class="lineno"></span><span class="op" id="6313205">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6313208">func</span>&nbsp;<span class="ident" id="6313213">decompressor</span><span class="op" id="6313225">(</span><span class="ident" id="6313226">method</span>&nbsp;<span class="builtintype" id="6313233">uint16</span><span class="op" id="6313239">)</span>&nbsp;<span class="ident" id="6313241">Decompressor</span>&nbsp;<span class="op" id="6313254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313257">mu</span><span class="op" id="6313259">.</span><span class="ident" id="6313260">RLock</span><span class="op" id="6313265">(</span><span class="op" id="6313266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313269">defer</span>&nbsp;<span class="ident" id="6313275">mu</span><span class="op" id="6313277">.</span><span class="ident" id="6313278">RUnlock</span><span class="op" id="6313285">(</span><span class="op" id="6313286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313289">return</span>&nbsp;<span class="ident" id="6313296">decompressors</span><span class="op" id="6313309">[</span><span class="ident" id="6313310">method</span><span class="op" id="6313316">]</span><br>
<span class="lineno">110</span><span class="op" id="6313318">}</span>
</div>
</body>
</html>
