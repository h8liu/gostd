<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2034763">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2034818">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2034872">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2034923">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2034993">package</span>&nbsp;<span class="ident" id="2035001">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2035005">import</span>&nbsp;<span class="op" id="2035012">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2035015">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2035021">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2035031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2035034">const</span>&nbsp;<span class="op" id="2035040">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035043">blockSize</span>&nbsp;<span class="op" id="2035053">=</span>&nbsp;<span class="num" id="2035055">4096</span><br>
<span class="lineno"></span><span class="op" id="2035060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2035063">func</span>&nbsp;<span class="op" id="2035068">(</span><span class="ident" id="2035069">f</span>&nbsp;<span class="op" id="2035071">*</span><span class="ident" id="2035072"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2035076">)</span>&nbsp;<span class="ident" id="2035078">readdirnames</span><span class="op" id="2035090">(</span><span class="ident" id="2035091">n</span>&nbsp;<span class="builtintype" id="2035093">int</span><span class="op" id="2035096">)</span>&nbsp;<span class="op" id="2035098">(</span><span class="ident" id="2035099">names</span>&nbsp;<span class="op" id="2035105">[</span><span class="op" id="2035106">]</span><span class="builtintype" id="2035107">string</span><span class="op" id="2035113">,</span>&nbsp;<span class="ident" id="2035115">err</span>&nbsp;<span class="builtintype" id="2035119">error</span><span class="op" id="2035124">)</span>&nbsp;<span class="op" id="2035126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035129">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035174">if</span>&nbsp;<span class="ident" id="2035177"><a href="/os/dir_unix.go.html#2035069">f</a></span><span class="op" id="2035178">.</span><span class="ident" id="2035179">dirinfo</span>&nbsp;<span class="op" id="2035187">==</span>&nbsp;<span class="ident" id="2035190">nil</span>&nbsp;<span class="op" id="2035194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035198"><a href="/os/dir_unix.go.html#2035069">f</a></span><span class="op" id="2035199">.</span><span class="ident" id="2035200">dirinfo</span>&nbsp;<span class="op" id="2035208">=</span>&nbsp;<span class="builtinfunc" id="2035210">new</span><span class="op" id="2035213">(</span><span class="ident" id="2035214"><a href="/os/file_unix.go.html#2066593">dirInfo</a></span><span class="op" id="2035221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035225">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035272"><a href="/os/dir_unix.go.html#2035069">f</a></span><span class="op" id="2035273">.</span><span class="ident" id="2035274">dirinfo</span><span class="op" id="2035281">.</span><span class="ident" id="2035282">buf</span>&nbsp;<span class="op" id="2035286">=</span>&nbsp;<span class="builtinfunc" id="2035288">make</span><span class="op" id="2035292">(</span><span class="op" id="2035293">[</span><span class="op" id="2035294">]</span><span class="builtintype" id="2035295">byte</span><span class="op" id="2035299">,</span>&nbsp;<span class="ident" id="2035301"><a href="/os/dir_unix.go.html#2035043">blockSize</a></span><span class="op" id="2035310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035313">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035316">d</span>&nbsp;<span class="op" id="2035318">:=</span>&nbsp;<span class="ident" id="2035321"><a href="/os/dir_unix.go.html#2035069">f</a></span><span class="op" id="2035322">.</span><span class="ident" id="2035323">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035333">size</span>&nbsp;<span class="op" id="2035338">:=</span>&nbsp;<span class="ident" id="2035341"><a href="/os/dir_unix.go.html#2035091">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035344">if</span>&nbsp;<span class="ident" id="2035347"><a href="/os/dir_unix.go.html#2035333">size</a></span>&nbsp;<span class="op" id="2035352">&lt;=</span>&nbsp;<span class="num" id="2035355">0</span>&nbsp;<span class="op" id="2035357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035361"><a href="/os/dir_unix.go.html#2035333">size</a></span>&nbsp;<span class="op" id="2035366">=</span>&nbsp;<span class="num" id="2035368">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035374"><a href="/os/dir_unix.go.html#2035091">n</a></span>&nbsp;<span class="op" id="2035376">=</span>&nbsp;<span class="op" id="2035378">-</span><span class="num" id="2035379">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035386"><a href="/os/dir_unix.go.html#2035099">names</a></span>&nbsp;<span class="op" id="2035392">=</span>&nbsp;<span class="builtinfunc" id="2035394">make</span><span class="op" id="2035398">(</span><span class="op" id="2035399">[</span><span class="op" id="2035400">]</span><span class="builtintype" id="2035401">string</span><span class="op" id="2035407">,</span>&nbsp;<span class="num" id="2035409">0</span><span class="op" id="2035410">,</span>&nbsp;<span class="ident" id="2035412"><a href="/os/dir_unix.go.html#2035333">size</a></span><span class="op" id="2035416">)</span>&nbsp;<span class="comment" id="2035418">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035447">for</span>&nbsp;<span class="ident" id="2035451"><a href="/os/dir_unix.go.html#2035091">n</a></span>&nbsp;<span class="op" id="2035453">!=</span>&nbsp;<span class="num" id="2035456">0</span>&nbsp;<span class="op" id="2035458">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035462">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035498">if</span>&nbsp;<span class="ident" id="2035501"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035502">.</span><span class="ident" id="2035503">bufp</span>&nbsp;<span class="op" id="2035508">&gt;=</span>&nbsp;<span class="ident" id="2035511"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035512">.</span><span class="ident" id="2035513">nbuf</span>&nbsp;<span class="op" id="2035518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035523"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035524">.</span><span class="ident" id="2035525">bufp</span>&nbsp;<span class="op" id="2035530">=</span>&nbsp;<span class="num" id="2035532">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035537">var</span>&nbsp;<span class="ident" id="2035541">errno</span>&nbsp;<span class="builtintype" id="2035547">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035556"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035557">.</span><span class="ident" id="2035558">nbuf</span><span class="op" id="2035562">,</span>&nbsp;<span class="ident" id="2035564"><a href="/os/dir_unix.go.html#2035541">errno</a></span>&nbsp;<span class="op" id="2035570">=</span>&nbsp;<span class="ident" id="2035572"><a href="/os/file.go.html#2061002">fixCount</a></span><span class="op" id="2035580">(</span><span class="ident" id="2035581"><a href="/os/dir_unix.go.html#2035021">syscall</a></span><span class="op" id="2035588">.</span><span class="ident" id="2035589">ReadDirent</span><span class="op" id="2035599">(</span><span class="ident" id="2035600"><a href="/os/dir_unix.go.html#2035069">f</a></span><span class="op" id="2035601">.</span><span class="ident" id="2035602">fd</span><span class="op" id="2035604">,</span>&nbsp;<span class="ident" id="2035606"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035607">.</span><span class="ident" id="2035608">buf</span><span class="op" id="2035611">)</span><span class="op" id="2035612">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035617">if</span>&nbsp;<span class="ident" id="2035620"><a href="/os/dir_unix.go.html#2035541">errno</a></span>&nbsp;<span class="op" id="2035626">!=</span>&nbsp;<span class="ident" id="2035629">nil</span>&nbsp;<span class="op" id="2035633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035639">return</span>&nbsp;<span class="ident" id="2035646"><a href="/os/dir_unix.go.html#2035099">names</a></span><span class="op" id="2035651">,</span>&nbsp;<span class="ident" id="2035653"><a href="/os/error.go.html#2044800">NewSyscallError</a></span><span class="op" id="2035668">(</span><span class="string" id="2035669">&#34;readdirent&#34;</span><span class="op" id="2035681">,</span>&nbsp;<span class="ident" id="2035683"><a href="/os/dir_unix.go.html#2035541">errno</a></span><span class="op" id="2035688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035698">if</span>&nbsp;<span class="ident" id="2035701"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035702">.</span><span class="ident" id="2035703">nbuf</span>&nbsp;<span class="op" id="2035708">&lt;=</span>&nbsp;<span class="num" id="2035711">0</span>&nbsp;<span class="op" id="2035713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035719">break</span>&nbsp;<span class="comment" id="2035725">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035744">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035766">var</span>&nbsp;<span class="ident" id="2035770">nb</span><span class="op" id="2035772">,</span>&nbsp;<span class="ident" id="2035774">nc</span>&nbsp;<span class="builtintype" id="2035777">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035783"><a href="/os/dir_unix.go.html#2035770">nb</a></span><span class="op" id="2035785">,</span>&nbsp;<span class="ident" id="2035787"><a href="/os/dir_unix.go.html#2035774">nc</a></span><span class="op" id="2035789">,</span>&nbsp;<span class="ident" id="2035791"><a href="/os/dir_unix.go.html#2035099">names</a></span>&nbsp;<span class="op" id="2035797">=</span>&nbsp;<span class="ident" id="2035799"><a href="/os/dir_unix.go.html#2035021">syscall</a></span><span class="op" id="2035806">.</span><span class="ident" id="2035807">ParseDirent</span><span class="op" id="2035818">(</span><span class="ident" id="2035819"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035820">.</span><span class="ident" id="2035821">buf</span><span class="op" id="2035824">[</span><span class="ident" id="2035825"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035826">.</span><span class="ident" id="2035827">bufp</span><span class="op" id="2035831">:</span><span class="ident" id="2035832"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035833">.</span><span class="ident" id="2035834">nbuf</span><span class="op" id="2035838">]</span><span class="op" id="2035839">,</span>&nbsp;<span class="ident" id="2035841"><a href="/os/dir_unix.go.html#2035091">n</a></span><span class="op" id="2035842">,</span>&nbsp;<span class="ident" id="2035844"><a href="/os/dir_unix.go.html#2035099">names</a></span><span class="op" id="2035849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035853"><a href="/os/dir_unix.go.html#2035316">d</a></span><span class="op" id="2035854">.</span><span class="ident" id="2035855">bufp</span>&nbsp;<span class="op" id="2035860">+=</span>&nbsp;<span class="ident" id="2035863"><a href="/os/dir_unix.go.html#2035770">nb</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035868"><a href="/os/dir_unix.go.html#2035091">n</a></span>&nbsp;<span class="op" id="2035870">-=</span>&nbsp;<span class="ident" id="2035873"><a href="/os/dir_unix.go.html#2035774">nc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035880">if</span>&nbsp;<span class="ident" id="2035883"><a href="/os/dir_unix.go.html#2035091">n</a></span>&nbsp;<span class="op" id="2035885">&gt;=</span>&nbsp;<span class="num" id="2035888">0</span>&nbsp;<span class="op" id="2035890">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2035893">len</span><span class="op" id="2035896">(</span><span class="ident" id="2035897"><a href="/os/dir_unix.go.html#2035099">names</a></span><span class="op" id="2035902">)</span>&nbsp;<span class="op" id="2035904">==</span>&nbsp;<span class="num" id="2035907">0</span>&nbsp;<span class="op" id="2035909">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035913">return</span>&nbsp;<span class="ident" id="2035920"><a href="/os/dir_unix.go.html#2035099">names</a></span><span class="op" id="2035925">,</span>&nbsp;<span class="ident" id="2035927"><a href="/os/dir_unix.go.html#2035015">io</a></span><span class="op" id="2035929">.</span><span class="ident" id="2035930">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035938">return</span>&nbsp;<span class="ident" id="2035945"><a href="/os/dir_unix.go.html#2035099">names</a></span><span class="op" id="2035950">,</span>&nbsp;<span class="ident" id="2035952">nil</span><br>
<span class="lineno"></span><span class="op" id="2035956">}</span>
</div>
</body>
</html>
