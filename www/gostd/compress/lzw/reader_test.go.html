<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8115881">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8115936">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8115990">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8116041">package</span>&nbsp;<span class="ident" id="8116049">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116054">import</span>&nbsp;<span class="op" id="8116061">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116064">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116073">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116079">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116092">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116103">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116114">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116125">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8116135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116138">type</span>&nbsp;<span class="ident" id="8116143">lzwTest</span>&nbsp;<span class="keyword" id="8116151">struct</span>&nbsp;<span class="op" id="8116158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116161">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8116172">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116180">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8116191">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116199">compressed</span>&nbsp;<span class="builtintype" id="8116210">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116218">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8116229">error</span><br>
<span class="lineno"></span><span class="op" id="8116235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116238">var</span>&nbsp;<span class="ident" id="8116242">lzwTests</span>&nbsp;<span class="op" id="8116251">=</span>&nbsp;<span class="op" id="8116253">[</span><span class="op" id="8116254">]</span><span class="ident" id="8116255">lzwTest</span><span class="op" id="8116262">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116269">&#34;empty;LSB;8&#34;</span><span class="op" id="8116282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116286">&#34;&#34;</span><span class="op" id="8116288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116292">&#34;\x01\x01&#34;</span><span class="op" id="8116302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116306">nil</span><span class="op" id="8116309">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116312">}</span><span class="op" id="8116313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116320">&#34;empty;MSB;8&#34;</span><span class="op" id="8116333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116337">&#34;&#34;</span><span class="op" id="8116339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116343">&#34;\x80\x80&#34;</span><span class="op" id="8116353">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116357">nil</span><span class="op" id="8116360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116363">}</span><span class="op" id="8116364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116371">&#34;tobe;LSB;7&#34;</span><span class="op" id="8116383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116387">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8116413">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116417">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8116487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116491">nil</span><span class="op" id="8116494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116497">}</span><span class="op" id="8116498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116505">&#34;tobe;LSB;8&#34;</span><span class="op" id="8116517">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116521">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8116547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116551">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="8116633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116637">nil</span><span class="op" id="8116640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116643">}</span><span class="op" id="8116644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116647">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116651">&#34;tobe;MSB;7&#34;</span><span class="op" id="8116663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116667">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8116693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116697">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8116767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116771">nil</span><span class="op" id="8116774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116777">}</span><span class="op" id="8116778">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116785">&#34;tobe;MSB;8&#34;</span><span class="op" id="8116797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116801">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8116827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116831">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="8116913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116917">nil</span><span class="op" id="8116920">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116923">}</span><span class="op" id="8116924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116931">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="8116953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116957">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8116983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8116987">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="8117033">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117037">io</span><span class="op" id="8117039">.</span><span class="ident" id="8117040">ErrUnexpectedEOF</span><span class="op" id="8117056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117059">}</span><span class="op" id="8117060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8117063">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8117153">&#34;gif;LSB;8&#34;</span><span class="op" id="8117164">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8117168">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="8117230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8117234">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="8117280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117284">nil</span><span class="op" id="8117287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117290">}</span><span class="op" id="8117291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8117294">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8117407">&#34;pdf;MSB;8&#34;</span><span class="op" id="8117418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8117422">&#34;-----A---B&#34;</span><span class="op" id="8117434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8117438">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="8117476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117480">nil</span><span class="op" id="8117483">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117486">}</span><span class="op" id="8117487">,</span><br>
<span class="lineno"></span><span class="op" id="8117489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8117492">func</span>&nbsp;<span class="ident" id="8117497">TestReader</span><span class="op" id="8117507">(</span><span class="ident" id="8117508">t</span>&nbsp;<span class="op" id="8117510">*</span><span class="ident" id="8117511">testing</span><span class="op" id="8117518">.</span><span class="ident" id="8117519">T</span><span class="op" id="8117520">)</span>&nbsp;<span class="op" id="8117522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117525">var</span>&nbsp;<span class="ident" id="8117529">b</span>&nbsp;<span class="ident" id="8117531">bytes</span><span class="op" id="8117536">.</span><span class="ident" id="8117537">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117545">for</span>&nbsp;<span class="ident" id="8117549">_</span><span class="op" id="8117550">,</span>&nbsp;<span class="ident" id="8117552">tt</span>&nbsp;<span class="op" id="8117555">:=</span>&nbsp;<span class="keyword" id="8117558">range</span>&nbsp;<span class="ident" id="8117564">lzwTests</span>&nbsp;<span class="op" id="8117573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117577">d</span>&nbsp;<span class="op" id="8117579">:=</span>&nbsp;<span class="ident" id="8117582">strings</span><span class="op" id="8117589">.</span><span class="ident" id="8117590">Split</span><span class="op" id="8117595">(</span><span class="ident" id="8117596">tt</span><span class="op" id="8117598">.</span><span class="ident" id="8117599">desc</span><span class="op" id="8117603">,</span>&nbsp;<span class="string" id="8117605">&#34;;&#34;</span><span class="op" id="8117608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117612">var</span>&nbsp;<span class="ident" id="8117616">order</span>&nbsp;<span class="ident" id="8117622">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117630">switch</span>&nbsp;<span class="ident" id="8117637">d</span><span class="op" id="8117638">[</span><span class="num" id="8117639">1</span><span class="op" id="8117640">]</span>&nbsp;<span class="op" id="8117642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117646">case</span>&nbsp;<span class="string" id="8117651">&#34;LSB&#34;</span><span class="op" id="8117656">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117661">order</span>&nbsp;<span class="op" id="8117667">=</span>&nbsp;<span class="ident" id="8117669">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117675">case</span>&nbsp;<span class="string" id="8117680">&#34;MSB&#34;</span><span class="op" id="8117685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117690">order</span>&nbsp;<span class="op" id="8117696">=</span>&nbsp;<span class="ident" id="8117698">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117704">default</span><span class="op" id="8117711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117716">t</span><span class="op" id="8117717">.</span><span class="ident" id="8117718">Errorf</span><span class="op" id="8117724">(</span><span class="string" id="8117725">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="8117743">,</span>&nbsp;<span class="ident" id="8117745">tt</span><span class="op" id="8117747">.</span><span class="ident" id="8117748">desc</span><span class="op" id="8117752">,</span>&nbsp;<span class="ident" id="8117754">d</span><span class="op" id="8117755">[</span><span class="num" id="8117756">1</span><span class="op" id="8117757">]</span><span class="op" id="8117758">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117766">litWidth</span><span class="op" id="8117774">,</span>&nbsp;<span class="ident" id="8117776">_</span>&nbsp;<span class="op" id="8117778">:=</span>&nbsp;<span class="ident" id="8117781">strconv</span><span class="op" id="8117788">.</span><span class="ident" id="8117789">Atoi</span><span class="op" id="8117793">(</span><span class="ident" id="8117794">d</span><span class="op" id="8117795">[</span><span class="num" id="8117796">2</span><span class="op" id="8117797">]</span><span class="op" id="8117798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117802">rc</span>&nbsp;<span class="op" id="8117805">:=</span>&nbsp;<span class="ident" id="8117808">NewReader</span><span class="op" id="8117817">(</span><span class="ident" id="8117818">strings</span><span class="op" id="8117825">.</span><span class="ident" id="8117826">NewReader</span><span class="op" id="8117835">(</span><span class="ident" id="8117836">tt</span><span class="op" id="8117838">.</span><span class="ident" id="8117839">compressed</span><span class="op" id="8117849">)</span><span class="op" id="8117850">,</span>&nbsp;<span class="ident" id="8117852">order</span><span class="op" id="8117857">,</span>&nbsp;<span class="ident" id="8117859">litWidth</span><span class="op" id="8117867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117871">defer</span>&nbsp;<span class="ident" id="8117877">rc</span><span class="op" id="8117879">.</span><span class="ident" id="8117880">Close</span><span class="op" id="8117885">(</span><span class="op" id="8117886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117890">b</span><span class="op" id="8117891">.</span><span class="ident" id="8117892">Reset</span><span class="op" id="8117897">(</span><span class="op" id="8117898">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117902">n</span><span class="op" id="8117903">,</span>&nbsp;<span class="ident" id="8117905">err</span>&nbsp;<span class="op" id="8117909">:=</span>&nbsp;<span class="ident" id="8117912">io</span><span class="op" id="8117914">.</span><span class="ident" id="8117915">Copy</span><span class="op" id="8117919">(</span><span class="op" id="8117920">&amp;</span><span class="ident" id="8117921">b</span><span class="op" id="8117922">,</span>&nbsp;<span class="ident" id="8117924">rc</span><span class="op" id="8117926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117930">if</span>&nbsp;<span class="ident" id="8117933">err</span>&nbsp;<span class="op" id="8117937">!=</span>&nbsp;<span class="ident" id="8117940">nil</span>&nbsp;<span class="op" id="8117944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117949">if</span>&nbsp;<span class="ident" id="8117952">err</span>&nbsp;<span class="op" id="8117956">!=</span>&nbsp;<span class="ident" id="8117959">tt</span><span class="op" id="8117961">.</span><span class="ident" id="8117962">err</span>&nbsp;<span class="op" id="8117966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117972">t</span><span class="op" id="8117973">.</span><span class="ident" id="8117974">Errorf</span><span class="op" id="8117980">(</span><span class="string" id="8117981">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8118006">,</span>&nbsp;<span class="ident" id="8118008">tt</span><span class="op" id="8118010">.</span><span class="ident" id="8118011">desc</span><span class="op" id="8118015">,</span>&nbsp;<span class="ident" id="8118017">err</span><span class="op" id="8118020">,</span>&nbsp;<span class="ident" id="8118022">tt</span><span class="op" id="8118024">.</span><span class="ident" id="8118025">err</span><span class="op" id="8118028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118033">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118038">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118053">s</span>&nbsp;<span class="op" id="8118055">:=</span>&nbsp;<span class="ident" id="8118058">b</span><span class="op" id="8118059">.</span><span class="ident" id="8118060">String</span><span class="op" id="8118066">(</span><span class="op" id="8118067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118071">if</span>&nbsp;<span class="ident" id="8118074">s</span>&nbsp;<span class="op" id="8118076">!=</span>&nbsp;<span class="ident" id="8118079">tt</span><span class="op" id="8118081">.</span><span class="ident" id="8118082">raw</span>&nbsp;<span class="op" id="8118086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118091">t</span><span class="op" id="8118092">.</span><span class="ident" id="8118093">Errorf</span><span class="op" id="8118099">(</span><span class="string" id="8118100">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="8118136">,</span>&nbsp;<span class="ident" id="8118138">tt</span><span class="op" id="8118140">.</span><span class="ident" id="8118141">desc</span><span class="op" id="8118145">,</span>&nbsp;<span class="ident" id="8118147">n</span><span class="op" id="8118148">,</span>&nbsp;<span class="ident" id="8118150">s</span><span class="op" id="8118151">,</span>&nbsp;<span class="builtinfunc" id="8118153">len</span><span class="op" id="8118156">(</span><span class="ident" id="8118157">tt</span><span class="op" id="8118159">.</span><span class="ident" id="8118160">raw</span><span class="op" id="8118163">)</span><span class="op" id="8118164">,</span>&nbsp;<span class="ident" id="8118166">tt</span><span class="op" id="8118168">.</span><span class="ident" id="8118169">raw</span><span class="op" id="8118172">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118179">}</span><br>
<span class="lineno"></span><span class="op" id="8118181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8118184">func</span>&nbsp;<span class="ident" id="8118189">benchmarkDecoder</span><span class="op" id="8118205">(</span><span class="ident" id="8118206">b</span>&nbsp;<span class="op" id="8118208">*</span><span class="ident" id="8118209">testing</span><span class="op" id="8118216">.</span><span class="ident" id="8118217">B</span><span class="op" id="8118218">,</span>&nbsp;<span class="ident" id="8118220">n</span>&nbsp;<span class="builtintype" id="8118222">int</span><span class="op" id="8118225">)</span>&nbsp;<span class="op" id="8118227">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118230">b</span><span class="op" id="8118231">.</span><span class="ident" id="8118232">StopTimer</span><span class="op" id="8118241">(</span><span class="op" id="8118242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118245">b</span><span class="op" id="8118246">.</span><span class="ident" id="8118247">SetBytes</span><span class="op" id="8118255">(</span><span class="ident" id="8118256">int64</span><span class="op" id="8118261">(</span><span class="ident" id="8118262">n</span><span class="op" id="8118263">)</span><span class="op" id="8118264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118267">buf0</span><span class="op" id="8118271">,</span>&nbsp;<span class="ident" id="8118273">err</span>&nbsp;<span class="op" id="8118277">:=</span>&nbsp;<span class="ident" id="8118280">ioutil</span><span class="op" id="8118286">.</span><span class="ident" id="8118287">ReadFile</span><span class="op" id="8118295">(</span><span class="string" id="8118296">&#34;../testdata/e.txt&#34;</span><span class="op" id="8118315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118318">if</span>&nbsp;<span class="ident" id="8118321">err</span>&nbsp;<span class="op" id="8118325">!=</span>&nbsp;<span class="ident" id="8118328">nil</span>&nbsp;<span class="op" id="8118332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118336">b</span><span class="op" id="8118337">.</span><span class="ident" id="8118338">Fatal</span><span class="op" id="8118343">(</span><span class="ident" id="8118344">err</span><span class="op" id="8118347">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118353">if</span>&nbsp;<span class="builtinfunc" id="8118356">len</span><span class="op" id="8118359">(</span><span class="ident" id="8118360">buf0</span><span class="op" id="8118364">)</span>&nbsp;<span class="op" id="8118366">==</span>&nbsp;<span class="num" id="8118369">0</span>&nbsp;<span class="op" id="8118371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118375">b</span><span class="op" id="8118376">.</span><span class="ident" id="8118377">Fatalf</span><span class="op" id="8118383">(</span><span class="string" id="8118384">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="8118407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118413">compressed</span>&nbsp;<span class="op" id="8118424">:=</span>&nbsp;<span class="builtinfunc" id="8118427">new</span><span class="op" id="8118430">(</span><span class="ident" id="8118431">bytes</span><span class="op" id="8118436">.</span><span class="ident" id="8118437">Buffer</span><span class="op" id="8118443">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118446">w</span>&nbsp;<span class="op" id="8118448">:=</span>&nbsp;<span class="ident" id="8118451">NewWriter</span><span class="op" id="8118460">(</span><span class="ident" id="8118461">compressed</span><span class="op" id="8118471">,</span>&nbsp;<span class="ident" id="8118473">LSB</span><span class="op" id="8118476">,</span>&nbsp;<span class="num" id="8118478">8</span><span class="op" id="8118479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118482">for</span>&nbsp;<span class="ident" id="8118486">i</span>&nbsp;<span class="op" id="8118488">:=</span>&nbsp;<span class="num" id="8118491">0</span><span class="op" id="8118492">;</span>&nbsp;<span class="ident" id="8118494">i</span>&nbsp;<span class="op" id="8118496">&lt;</span>&nbsp;<span class="ident" id="8118498">n</span><span class="op" id="8118499">;</span>&nbsp;<span class="ident" id="8118501">i</span>&nbsp;<span class="op" id="8118503">+=</span>&nbsp;<span class="builtinfunc" id="8118506">len</span><span class="op" id="8118509">(</span><span class="ident" id="8118510">buf0</span><span class="op" id="8118514">)</span>&nbsp;<span class="op" id="8118516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118520">if</span>&nbsp;<span class="builtinfunc" id="8118523">len</span><span class="op" id="8118526">(</span><span class="ident" id="8118527">buf0</span><span class="op" id="8118531">)</span>&nbsp;<span class="op" id="8118533">&gt;</span>&nbsp;<span class="ident" id="8118535">n</span><span class="op" id="8118536">-</span><span class="ident" id="8118537">i</span>&nbsp;<span class="op" id="8118539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118544">buf0</span>&nbsp;<span class="op" id="8118549">=</span>&nbsp;<span class="ident" id="8118551">buf0</span><span class="op" id="8118555">[</span><span class="op" id="8118556">:</span><span class="ident" id="8118557">n</span><span class="op" id="8118558">-</span><span class="ident" id="8118559">i</span><span class="op" id="8118560">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118564">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118568">w</span><span class="op" id="8118569">.</span><span class="ident" id="8118570">Write</span><span class="op" id="8118575">(</span><span class="ident" id="8118576">buf0</span><span class="op" id="8118580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118586">w</span><span class="op" id="8118587">.</span><span class="ident" id="8118588">Close</span><span class="op" id="8118593">(</span><span class="op" id="8118594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118597">buf1</span>&nbsp;<span class="op" id="8118602">:=</span>&nbsp;<span class="ident" id="8118605">compressed</span><span class="op" id="8118615">.</span><span class="ident" id="8118616">Bytes</span><span class="op" id="8118621">(</span><span class="op" id="8118622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118625">buf0</span><span class="op" id="8118629">,</span>&nbsp;<span class="ident" id="8118631">compressed</span><span class="op" id="8118641">,</span>&nbsp;<span class="ident" id="8118643">w</span>&nbsp;<span class="op" id="8118645">=</span>&nbsp;<span class="ident" id="8118647">nil</span><span class="op" id="8118650">,</span>&nbsp;<span class="ident" id="8118652">nil</span><span class="op" id="8118655">,</span>&nbsp;<span class="ident" id="8118657">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118662">runtime</span><span class="op" id="8118669">.</span><span class="ident" id="8118670">GC</span><span class="op" id="8118672">(</span><span class="op" id="8118673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118676">b</span><span class="op" id="8118677">.</span><span class="ident" id="8118678">StartTimer</span><span class="op" id="8118688">(</span><span class="op" id="8118689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118692">for</span>&nbsp;<span class="ident" id="8118696">i</span>&nbsp;<span class="op" id="8118698">:=</span>&nbsp;<span class="num" id="8118701">0</span><span class="op" id="8118702">;</span>&nbsp;<span class="ident" id="8118704">i</span>&nbsp;<span class="op" id="8118706">&lt;</span>&nbsp;<span class="ident" id="8118708">b</span><span class="op" id="8118709">.</span><span class="ident" id="8118710">N</span><span class="op" id="8118711">;</span>&nbsp;<span class="ident" id="8118713">i</span><span class="op" id="8118714">++</span>&nbsp;<span class="op" id="8118717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118721">io</span><span class="op" id="8118723">.</span><span class="ident" id="8118724">Copy</span><span class="op" id="8118728">(</span><span class="ident" id="8118729">ioutil</span><span class="op" id="8118735">.</span><span class="ident" id="8118736">Discard</span><span class="op" id="8118743">,</span>&nbsp;<span class="ident" id="8118745">NewReader</span><span class="op" id="8118754">(</span><span class="ident" id="8118755">bytes</span><span class="op" id="8118760">.</span><span class="ident" id="8118761">NewReader</span><span class="op" id="8118770">(</span><span class="ident" id="8118771">buf1</span><span class="op" id="8118775">)</span><span class="op" id="8118776">,</span>&nbsp;<span class="ident" id="8118778">LSB</span><span class="op" id="8118781">,</span>&nbsp;<span class="num" id="8118783">8</span><span class="op" id="8118784">)</span><span class="op" id="8118785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118788">}</span><br>
<span class="lineno">140</span><span class="op" id="8118790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8118793">func</span>&nbsp;<span class="ident" id="8118798">BenchmarkDecoder1e4</span><span class="op" id="8118817">(</span><span class="ident" id="8118818">b</span>&nbsp;<span class="op" id="8118820">*</span><span class="ident" id="8118821">testing</span><span class="op" id="8118828">.</span><span class="ident" id="8118829">B</span><span class="op" id="8118830">)</span>&nbsp;<span class="op" id="8118832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118835">benchmarkDecoder</span><span class="op" id="8118851">(</span><span class="ident" id="8118852">b</span><span class="op" id="8118853">,</span>&nbsp;<span class="num" id="8118855">1e4</span><span class="op" id="8118858">)</span><br>
<span class="lineno"></span><span class="op" id="8118860">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="8118863">func</span>&nbsp;<span class="ident" id="8118868">BenchmarkDecoder1e5</span><span class="op" id="8118887">(</span><span class="ident" id="8118888">b</span>&nbsp;<span class="op" id="8118890">*</span><span class="ident" id="8118891">testing</span><span class="op" id="8118898">.</span><span class="ident" id="8118899">B</span><span class="op" id="8118900">)</span>&nbsp;<span class="op" id="8118902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118905">benchmarkDecoder</span><span class="op" id="8118921">(</span><span class="ident" id="8118922">b</span><span class="op" id="8118923">,</span>&nbsp;<span class="num" id="8118925">1e5</span><span class="op" id="8118928">)</span><br>
<span class="lineno"></span><span class="op" id="8118930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="8118933">func</span>&nbsp;<span class="ident" id="8118938">BenchmarkDecoder1e6</span><span class="op" id="8118957">(</span><span class="ident" id="8118958">b</span>&nbsp;<span class="op" id="8118960">*</span><span class="ident" id="8118961">testing</span><span class="op" id="8118968">.</span><span class="ident" id="8118969">B</span><span class="op" id="8118970">)</span>&nbsp;<span class="op" id="8118972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118975">benchmarkDecoder</span><span class="op" id="8118991">(</span><span class="ident" id="8118992">b</span><span class="op" id="8118993">,</span>&nbsp;<span class="num" id="8118995">1e6</span><span class="op" id="8118998">)</span><br>
<span class="lineno"></span><span class="op" id="8119000">}</span>
</div>
</body>
</html>
