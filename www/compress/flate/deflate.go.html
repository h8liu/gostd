<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4552228">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4552283">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4552337">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4552388">package</span>&nbsp;<span class="ident" id="4552396">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4552403">import</span>&nbsp;<span class="op" id="4552410">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552413">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552420">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552426">&#34;math&#34;</span><br>
<span class="lineno"></span><span class="op" id="4552433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4552436">const</span>&nbsp;<span class="op" id="4552442">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552445">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552464">=</span>&nbsp;<span class="num" id="4552466">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552469">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552488">=</span>&nbsp;<span class="num" id="4552490">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552493">fastCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552512">=</span>&nbsp;<span class="num" id="4552514">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552517">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552536">=</span>&nbsp;<span class="num" id="4552538">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552541">DefaultCompression</span>&nbsp;<span class="op" id="4552560">=</span>&nbsp;<span class="op" id="4552562">-</span><span class="num" id="4552563">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552566">logWindowSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552585">=</span>&nbsp;<span class="num" id="4552587">15</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552591">windowSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552610">=</span>&nbsp;<span class="num" id="4552612">1</span>&nbsp;<span class="op" id="4552614">&lt;&lt;</span>&nbsp;<span class="ident" id="4552617"><a href="/compress/flate/deflate.go.html#4552566">logWindowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552632">windowMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552651">=</span>&nbsp;<span class="ident" id="4552653"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span>&nbsp;<span class="op" id="4552664">-</span>&nbsp;<span class="num" id="4552666">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552669">logMaxOffsetSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4552688">=</span>&nbsp;<span class="num" id="4552690">15</span>&nbsp;&nbsp;<span class="comment" id="4552694">//&nbsp;Standard&nbsp;DEFLATE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552715">minMatchLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552734">=</span>&nbsp;<span class="num" id="4552736">3</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4552740">//&nbsp;The&nbsp;smallest&nbsp;match&nbsp;that&nbsp;the&nbsp;compressor&nbsp;looks&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552793">maxMatchLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552812">=</span>&nbsp;<span class="num" id="4552814">258</span>&nbsp;<span class="comment" id="4552818">//&nbsp;The&nbsp;longest&nbsp;match&nbsp;for&nbsp;the&nbsp;compressor</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552859">minOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552878">=</span>&nbsp;<span class="num" id="4552880">1</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4552884">//&nbsp;The&nbsp;shortest&nbsp;offset&nbsp;that&nbsp;makes&nbsp;any&nbsp;sense</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552930">//&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;tokens&nbsp;we&nbsp;put&nbsp;into&nbsp;a&nbsp;single&nbsp;flat&nbsp;block,&nbsp;just&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553005">//&nbsp;stop&nbsp;things&nbsp;from&nbsp;getting&nbsp;too&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553045">maxFlateBlockTokens</span>&nbsp;<span class="op" id="4553065">=</span>&nbsp;<span class="num" id="4553067">1</span>&nbsp;<span class="op" id="4553069">&lt;&lt;</span>&nbsp;<span class="num" id="4553072">14</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553076">maxStoreBlockSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4553096">=</span>&nbsp;<span class="num" id="4553098">65535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553105">hashBits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553125">=</span>&nbsp;<span class="num" id="4553127">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553131">hashSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553151">=</span>&nbsp;<span class="num" id="4553153">1</span>&nbsp;<span class="op" id="4553155">&lt;&lt;</span>&nbsp;<span class="ident" id="4553158"><a href="/compress/flate/deflate.go.html#4553105">hashBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553168">hashMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553188">=</span>&nbsp;<span class="op" id="4553190">(</span><span class="num" id="4553191">1</span>&nbsp;<span class="op" id="4553193">&lt;&lt;</span>&nbsp;<span class="ident" id="4553196"><a href="/compress/flate/deflate.go.html#4553105">hashBits</a></span><span class="op" id="4553204">)</span>&nbsp;<span class="op" id="4553206">-</span>&nbsp;<span class="num" id="4553208">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553211">hashShift</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553231">=</span>&nbsp;<span class="op" id="4553233">(</span><span class="ident" id="4553234"><a href="/compress/flate/deflate.go.html#4553105">hashBits</a></span>&nbsp;<span class="op" id="4553243">+</span>&nbsp;<span class="ident" id="4553245"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4553260">-</span>&nbsp;<span class="num" id="4553262">1</span><span class="op" id="4553263">)</span>&nbsp;<span class="op" id="4553265">/</span>&nbsp;<span class="ident" id="4553267"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553283">maxHashOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553303">=</span>&nbsp;<span class="num" id="4553305">1</span>&nbsp;<span class="op" id="4553307">&lt;&lt;</span>&nbsp;<span class="num" id="4553310">24</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553315">skipNever</span>&nbsp;<span class="op" id="4553325">=</span>&nbsp;<span class="ident" id="4553327"><a href="/compress/flate/deflate.go.html#4552426">math</a></span><span class="op" id="4553331">.</span><span class="ident" id="4553332">MaxInt32</span><br>
<span class="lineno"></span><span class="op" id="4553341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4553344">type</span>&nbsp;<span class="ident" id="4553349">compressionLevel</span>&nbsp;<span class="keyword" id="4553366">struct</span>&nbsp;<span class="op" id="4553373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553376">good</span><span class="op" id="4553380">,</span>&nbsp;<span class="ident" id="4553382">lazy</span><span class="op" id="4553386">,</span>&nbsp;<span class="ident" id="4553388">nice</span><span class="op" id="4553392">,</span>&nbsp;<span class="ident" id="4553394">chain</span><span class="op" id="4553399">,</span>&nbsp;<span class="ident" id="4553401">fastSkipHashing</span>&nbsp;<span class="builtintype" id="4553417">int</span><br>
<span class="lineno"></span><span class="op" id="4553421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4553424">var</span>&nbsp;<span class="ident" id="4553428">levels</span>&nbsp;<span class="op" id="4553435">=</span>&nbsp;<span class="op" id="4553437">[</span><span class="op" id="4553438">]</span><span class="ident" id="4553439"><a href="/compress/flate/deflate.go.html#4553349">compressionLevel</a></span><span class="op" id="4553455">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553458">{</span><span class="op" id="4553459">}</span><span class="op" id="4553460">,</span>&nbsp;<span class="comment" id="4553462">//&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553468">//&nbsp;For&nbsp;levels&nbsp;1-3&nbsp;we&nbsp;don&#39;t&nbsp;bother&nbsp;trying&nbsp;with&nbsp;lazy&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553528">{</span><span class="num" id="4553529">3</span><span class="op" id="4553530">,</span>&nbsp;<span class="num" id="4553532">0</span><span class="op" id="4553533">,</span>&nbsp;<span class="num" id="4553535">8</span><span class="op" id="4553536">,</span>&nbsp;<span class="num" id="4553538">4</span><span class="op" id="4553539">,</span>&nbsp;<span class="num" id="4553541">4</span><span class="op" id="4553542">}</span><span class="op" id="4553543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553546">{</span><span class="num" id="4553547">3</span><span class="op" id="4553548">,</span>&nbsp;<span class="num" id="4553550">0</span><span class="op" id="4553551">,</span>&nbsp;<span class="num" id="4553553">16</span><span class="op" id="4553555">,</span>&nbsp;<span class="num" id="4553557">8</span><span class="op" id="4553558">,</span>&nbsp;<span class="num" id="4553560">5</span><span class="op" id="4553561">}</span><span class="op" id="4553562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553565">{</span><span class="num" id="4553566">3</span><span class="op" id="4553567">,</span>&nbsp;<span class="num" id="4553569">0</span><span class="op" id="4553570">,</span>&nbsp;<span class="num" id="4553572">32</span><span class="op" id="4553574">,</span>&nbsp;<span class="num" id="4553576">32</span><span class="op" id="4553578">,</span>&nbsp;<span class="num" id="4553580">6</span><span class="op" id="4553581">}</span><span class="op" id="4553582">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553585">//&nbsp;Levels&nbsp;4-9&nbsp;use&nbsp;increasingly&nbsp;more&nbsp;lazy&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553636">//&nbsp;and&nbsp;increasingly&nbsp;stringent&nbsp;conditions&nbsp;for&nbsp;&#34;good&nbsp;enough&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553697">{</span><span class="num" id="4553698">4</span><span class="op" id="4553699">,</span>&nbsp;<span class="num" id="4553701">4</span><span class="op" id="4553702">,</span>&nbsp;<span class="num" id="4553704">16</span><span class="op" id="4553706">,</span>&nbsp;<span class="num" id="4553708">16</span><span class="op" id="4553710">,</span>&nbsp;<span class="ident" id="4553712"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span><span class="op" id="4553721">}</span><span class="op" id="4553722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553725">{</span><span class="num" id="4553726">8</span><span class="op" id="4553727">,</span>&nbsp;<span class="num" id="4553729">16</span><span class="op" id="4553731">,</span>&nbsp;<span class="num" id="4553733">32</span><span class="op" id="4553735">,</span>&nbsp;<span class="num" id="4553737">32</span><span class="op" id="4553739">,</span>&nbsp;<span class="ident" id="4553741"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span><span class="op" id="4553750">}</span><span class="op" id="4553751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553754">{</span><span class="num" id="4553755">8</span><span class="op" id="4553756">,</span>&nbsp;<span class="num" id="4553758">16</span><span class="op" id="4553760">,</span>&nbsp;<span class="num" id="4553762">128</span><span class="op" id="4553765">,</span>&nbsp;<span class="num" id="4553767">128</span><span class="op" id="4553770">,</span>&nbsp;<span class="ident" id="4553772"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span><span class="op" id="4553781">}</span><span class="op" id="4553782">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553785">{</span><span class="num" id="4553786">8</span><span class="op" id="4553787">,</span>&nbsp;<span class="num" id="4553789">32</span><span class="op" id="4553791">,</span>&nbsp;<span class="num" id="4553793">128</span><span class="op" id="4553796">,</span>&nbsp;<span class="num" id="4553798">256</span><span class="op" id="4553801">,</span>&nbsp;<span class="ident" id="4553803"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span><span class="op" id="4553812">}</span><span class="op" id="4553813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553816">{</span><span class="num" id="4553817">32</span><span class="op" id="4553819">,</span>&nbsp;<span class="num" id="4553821">128</span><span class="op" id="4553824">,</span>&nbsp;<span class="num" id="4553826">258</span><span class="op" id="4553829">,</span>&nbsp;<span class="num" id="4553831">1024</span><span class="op" id="4553835">,</span>&nbsp;<span class="ident" id="4553837"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span><span class="op" id="4553846">}</span><span class="op" id="4553847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553850">{</span><span class="num" id="4553851">32</span><span class="op" id="4553853">,</span>&nbsp;<span class="num" id="4553855">258</span><span class="op" id="4553858">,</span>&nbsp;<span class="num" id="4553860">258</span><span class="op" id="4553863">,</span>&nbsp;<span class="num" id="4553865">4096</span><span class="op" id="4553869">,</span>&nbsp;<span class="ident" id="4553871"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span><span class="op" id="4553880">}</span><span class="op" id="4553881">,</span><br>
<span class="lineno"></span><span class="op" id="4553883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4553886">type</span>&nbsp;<span class="ident" id="4553891">compressor</span>&nbsp;<span class="keyword" id="4553902">struct</span>&nbsp;<span class="op" id="4553909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553912"><a href="/compress/flate/deflate.go.html#4553349">compressionLevel</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553931">w</span>&nbsp;<span class="op" id="4553933">*</span><span class="ident" id="4553934"><a href="/compress/flate/huffman_bit_writer.go.html#4573935">huffmanBitWriter</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553953">//&nbsp;compression&nbsp;algorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553979">fill</span>&nbsp;<span class="keyword" id="4553984">func</span><span class="op" id="4553988">(</span><span class="op" id="4553989">*</span><span class="ident" id="4553990"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4554000">,</span>&nbsp;<span class="op" id="4554002">[</span><span class="op" id="4554003">]</span><span class="builtintype" id="4554004">byte</span><span class="op" id="4554008">)</span>&nbsp;<span class="builtintype" id="4554010">int</span>&nbsp;<span class="comment" id="4554014">//&nbsp;copy&nbsp;data&nbsp;to&nbsp;window</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554038">step</span>&nbsp;<span class="keyword" id="4554043">func</span><span class="op" id="4554047">(</span><span class="op" id="4554048">*</span><span class="ident" id="4554049"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4554059">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554073">//&nbsp;process&nbsp;window</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554092">sync</span>&nbsp;<span class="builtintype" id="4554097">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554127">//&nbsp;requesting&nbsp;flush</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554149">//&nbsp;Input&nbsp;hash&nbsp;chains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554171">//&nbsp;hashHead[hashValue]&nbsp;contains&nbsp;the&nbsp;largest&nbsp;inputIndex&nbsp;with&nbsp;the&nbsp;specified&nbsp;hash&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554257">//&nbsp;If&nbsp;hashHead[hashValue]&nbsp;is&nbsp;within&nbsp;the&nbsp;current&nbsp;window,&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554319">//&nbsp;hashPrev[hashHead[hashValue]&nbsp;&amp;&nbsp;windowMask]&nbsp;contains&nbsp;the&nbsp;previous&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554394">//&nbsp;with&nbsp;the&nbsp;same&nbsp;hash&nbsp;value.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554424">chainHead</span>&nbsp;&nbsp;<span class="builtintype" id="4554435">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554440">hashHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4554451">[</span><span class="op" id="4554452">]</span><span class="builtintype" id="4554453">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554458">hashPrev</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4554469">[</span><span class="op" id="4554470">]</span><span class="builtintype" id="4554471">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554476">hashOffset</span>&nbsp;<span class="builtintype" id="4554487">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554493">//&nbsp;input&nbsp;window:&nbsp;unprocessed&nbsp;data&nbsp;is&nbsp;window[index:windowEnd]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554555">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4554569">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554574">window</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554588">[</span><span class="op" id="4554589">]</span><span class="builtintype" id="4554590">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554596">windowEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4554610">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554615">blockStart</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4554629">int</span>&nbsp;&nbsp;<span class="comment" id="4554634">//&nbsp;window&nbsp;index&nbsp;where&nbsp;current&nbsp;tokens&nbsp;start</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554678">byteAvailable</span>&nbsp;<span class="builtintype" id="4554692">bool</span>&nbsp;<span class="comment" id="4554697">//&nbsp;if&nbsp;true,&nbsp;still&nbsp;need&nbsp;to&nbsp;process&nbsp;window[index-1].</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554750">//&nbsp;queued&nbsp;output&nbsp;tokens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554775">tokens</span>&nbsp;<span class="op" id="4554782">[</span><span class="op" id="4554783">]</span><span class="ident" id="4554784"><a href="/compress/flate/token.go.html#4616305">token</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554792">//&nbsp;deflate&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554810">length</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4554825">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554830">offset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4554845">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554850">hash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4554865">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554870">maxInsertIndex</span>&nbsp;<span class="builtintype" id="4554885">int</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554890">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4554905">error</span><br>
<span class="lineno"></span><span class="op" id="4554911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4554914">func</span>&nbsp;<span class="op" id="4554919">(</span><span class="ident" id="4554920">d</span>&nbsp;<span class="op" id="4554922">*</span><span class="ident" id="4554923"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4554933">)</span>&nbsp;<span class="ident" id="4554935">fillDeflate</span><span class="op" id="4554946">(</span><span class="ident" id="4554947">b</span>&nbsp;<span class="op" id="4554949">[</span><span class="op" id="4554950">]</span><span class="builtintype" id="4554951">byte</span><span class="op" id="4554955">)</span>&nbsp;<span class="builtintype" id="4554957">int</span>&nbsp;<span class="op" id="4554961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554964">if</span>&nbsp;<span class="ident" id="4554967"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4554968">.</span><span class="ident" id="4554969">index</span>&nbsp;<span class="op" id="4554975">&gt;=</span>&nbsp;<span class="num" id="4554978">2</span><span class="op" id="4554979">*</span><span class="ident" id="4554980"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><span class="op" id="4554990">-</span><span class="op" id="4554991">(</span><span class="ident" id="4554992"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><span class="op" id="4555006">+</span><span class="ident" id="4555007"><a href="/compress/flate/deflate.go.html#4552793">maxMatchLength</a></span><span class="op" id="4555021">)</span>&nbsp;<span class="op" id="4555023">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4555027">//&nbsp;shift&nbsp;the&nbsp;window&nbsp;by&nbsp;windowSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4555063">copy</span><span class="op" id="4555067">(</span><span class="ident" id="4555068"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555069">.</span><span class="ident" id="4555070">window</span><span class="op" id="4555076">,</span>&nbsp;<span class="ident" id="4555078"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555079">.</span><span class="ident" id="4555080">window</span><span class="op" id="4555086">[</span><span class="ident" id="4555087"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><span class="op" id="4555097">:</span><span class="num" id="4555098">2</span><span class="op" id="4555099">*</span><span class="ident" id="4555100"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><span class="op" id="4555110">]</span><span class="op" id="4555111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555115"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555116">.</span><span class="ident" id="4555117">index</span>&nbsp;<span class="op" id="4555123">-=</span>&nbsp;<span class="ident" id="4555126"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555139"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555140">.</span><span class="ident" id="4555141">windowEnd</span>&nbsp;<span class="op" id="4555151">-=</span>&nbsp;<span class="ident" id="4555154"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555167">if</span>&nbsp;<span class="ident" id="4555170"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555171">.</span><span class="ident" id="4555172">blockStart</span>&nbsp;<span class="op" id="4555183">&gt;=</span>&nbsp;<span class="ident" id="4555186"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span>&nbsp;<span class="op" id="4555197">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555202"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555203">.</span><span class="ident" id="4555204">blockStart</span>&nbsp;<span class="op" id="4555215">-=</span>&nbsp;<span class="ident" id="4555218"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555231">}</span>&nbsp;<span class="keyword" id="4555233">else</span>&nbsp;<span class="op" id="4555238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555243"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555244">.</span><span class="ident" id="4555245">blockStart</span>&nbsp;<span class="op" id="4555256">=</span>&nbsp;<span class="ident" id="4555258"><a href="/compress/flate/deflate.go.html#4552426">math</a></span><span class="op" id="4555262">.</span><span class="ident" id="4555263">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555278"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555279">.</span><span class="ident" id="4555280">hashOffset</span>&nbsp;<span class="op" id="4555291">+=</span>&nbsp;<span class="ident" id="4555294"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555307">if</span>&nbsp;<span class="ident" id="4555310"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555311">.</span><span class="ident" id="4555312">hashOffset</span>&nbsp;<span class="op" id="4555323">&gt;</span>&nbsp;<span class="ident" id="4555325"><a href="/compress/flate/deflate.go.html#4553283">maxHashOffset</a></span>&nbsp;<span class="op" id="4555339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555344">delta</span>&nbsp;<span class="op" id="4555350">:=</span>&nbsp;<span class="ident" id="4555353"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555354">.</span><span class="ident" id="4555355">hashOffset</span>&nbsp;<span class="op" id="4555366">-</span>&nbsp;<span class="num" id="4555368">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555373"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555374">.</span><span class="ident" id="4555375">hashOffset</span>&nbsp;<span class="op" id="4555386">-=</span>&nbsp;<span class="ident" id="4555389"><a href="/compress/flate/deflate.go.html#4555344">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555398"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555399">.</span><span class="ident" id="4555400">chainHead</span>&nbsp;<span class="op" id="4555410">-=</span>&nbsp;<span class="ident" id="4555413"><a href="/compress/flate/deflate.go.html#4555344">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555422">for</span>&nbsp;<span class="ident" id="4555426">i</span><span class="op" id="4555427">,</span>&nbsp;<span class="ident" id="4555429">v</span>&nbsp;<span class="op" id="4555431">:=</span>&nbsp;<span class="keyword" id="4555434">range</span>&nbsp;<span class="ident" id="4555440"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555441">.</span><span class="ident" id="4555442">hashPrev</span>&nbsp;<span class="op" id="4555451">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555457">if</span>&nbsp;<span class="ident" id="4555460"><a href="/compress/flate/deflate.go.html#4555429">v</a></span>&nbsp;<span class="op" id="4555462">&gt;</span>&nbsp;<span class="ident" id="4555464"><a href="/compress/flate/deflate.go.html#4555344">delta</a></span>&nbsp;<span class="op" id="4555470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555477"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555478">.</span><span class="ident" id="4555479">hashPrev</span><span class="op" id="4555487">[</span><span class="ident" id="4555488"><a href="/compress/flate/deflate.go.html#4555426">i</a></span><span class="op" id="4555489">]</span>&nbsp;<span class="op" id="4555491">-=</span>&nbsp;<span class="ident" id="4555494"><a href="/compress/flate/deflate.go.html#4555344">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555504">}</span>&nbsp;<span class="keyword" id="4555506">else</span>&nbsp;<span class="op" id="4555511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555518"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555519">.</span><span class="ident" id="4555520">hashPrev</span><span class="op" id="4555528">[</span><span class="ident" id="4555529"><a href="/compress/flate/deflate.go.html#4555426">i</a></span><span class="op" id="4555530">]</span>&nbsp;<span class="op" id="4555532">=</span>&nbsp;<span class="num" id="4555534">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555540">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555550">for</span>&nbsp;<span class="ident" id="4555554">i</span><span class="op" id="4555555">,</span>&nbsp;<span class="ident" id="4555557">v</span>&nbsp;<span class="op" id="4555559">:=</span>&nbsp;<span class="keyword" id="4555562">range</span>&nbsp;<span class="ident" id="4555568"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555569">.</span><span class="ident" id="4555570">hashHead</span>&nbsp;<span class="op" id="4555579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555585">if</span>&nbsp;<span class="ident" id="4555588"><a href="/compress/flate/deflate.go.html#4555557">v</a></span>&nbsp;<span class="op" id="4555590">&gt;</span>&nbsp;<span class="ident" id="4555592"><a href="/compress/flate/deflate.go.html#4555344">delta</a></span>&nbsp;<span class="op" id="4555598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555605"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555606">.</span><span class="ident" id="4555607">hashHead</span><span class="op" id="4555615">[</span><span class="ident" id="4555616"><a href="/compress/flate/deflate.go.html#4555554">i</a></span><span class="op" id="4555617">]</span>&nbsp;<span class="op" id="4555619">-=</span>&nbsp;<span class="ident" id="4555622"><a href="/compress/flate/deflate.go.html#4555344">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555632">}</span>&nbsp;<span class="keyword" id="4555634">else</span>&nbsp;<span class="op" id="4555639">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555646"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555647">.</span><span class="ident" id="4555648">hashHead</span><span class="op" id="4555656">[</span><span class="ident" id="4555657"><a href="/compress/flate/deflate.go.html#4555554">i</a></span><span class="op" id="4555658">]</span>&nbsp;<span class="op" id="4555660">=</span>&nbsp;<span class="num" id="4555662">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555680">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555683">n</span>&nbsp;<span class="op" id="4555685">:=</span>&nbsp;<span class="builtinfunc" id="4555688">copy</span><span class="op" id="4555692">(</span><span class="ident" id="4555693"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555694">.</span><span class="ident" id="4555695">window</span><span class="op" id="4555701">[</span><span class="ident" id="4555702"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555703">.</span><span class="ident" id="4555704">windowEnd</span><span class="op" id="4555713">:</span><span class="op" id="4555714">]</span><span class="op" id="4555715">,</span>&nbsp;<span class="ident" id="4555717"><a href="/compress/flate/deflate.go.html#4554947">b</a></span><span class="op" id="4555718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555721"><a href="/compress/flate/deflate.go.html#4554920">d</a></span><span class="op" id="4555722">.</span><span class="ident" id="4555723">windowEnd</span>&nbsp;<span class="op" id="4555733">+=</span>&nbsp;<span class="ident" id="4555736"><a href="/compress/flate/deflate.go.html#4555683">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555739">return</span>&nbsp;<span class="ident" id="4555746"><a href="/compress/flate/deflate.go.html#4555683">n</a></span><br>
<span class="lineno"></span><span class="op" id="4555748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="4555751">func</span>&nbsp;<span class="op" id="4555756">(</span><span class="ident" id="4555757">d</span>&nbsp;<span class="op" id="4555759">*</span><span class="ident" id="4555760"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4555770">)</span>&nbsp;<span class="ident" id="4555772">writeBlock</span><span class="op" id="4555782">(</span><span class="ident" id="4555783">tokens</span>&nbsp;<span class="op" id="4555790">[</span><span class="op" id="4555791">]</span><span class="ident" id="4555792"><a href="/compress/flate/token.go.html#4616305">token</a></span><span class="op" id="4555797">,</span>&nbsp;<span class="ident" id="4555799">index</span>&nbsp;<span class="builtintype" id="4555805">int</span><span class="op" id="4555808">,</span>&nbsp;<span class="ident" id="4555810">eof</span>&nbsp;<span class="builtintype" id="4555814">bool</span><span class="op" id="4555818">)</span>&nbsp;<span class="builtintype" id="4555820">error</span>&nbsp;<span class="op" id="4555826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555829">if</span>&nbsp;<span class="ident" id="4555832"><a href="/compress/flate/deflate.go.html#4555799">index</a></span>&nbsp;<span class="op" id="4555838">&gt;</span>&nbsp;<span class="num" id="4555840">0</span>&nbsp;<span class="op" id="4555842">||</span>&nbsp;<span class="ident" id="4555845"><a href="/compress/flate/deflate.go.html#4555810">eof</a></span>&nbsp;<span class="op" id="4555849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555853">var</span>&nbsp;<span class="ident" id="4555857">window</span>&nbsp;<span class="op" id="4555864">[</span><span class="op" id="4555865">]</span><span class="builtintype" id="4555866">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555873">if</span>&nbsp;<span class="ident" id="4555876"><a href="/compress/flate/deflate.go.html#4555757">d</a></span><span class="op" id="4555877">.</span><span class="ident" id="4555878">blockStart</span>&nbsp;<span class="op" id="4555889">&lt;=</span>&nbsp;<span class="ident" id="4555892"><a href="/compress/flate/deflate.go.html#4555799">index</a></span>&nbsp;<span class="op" id="4555898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555903"><a href="/compress/flate/deflate.go.html#4555857">window</a></span>&nbsp;<span class="op" id="4555910">=</span>&nbsp;<span class="ident" id="4555912"><a href="/compress/flate/deflate.go.html#4555757">d</a></span><span class="op" id="4555913">.</span><span class="ident" id="4555914">window</span><span class="op" id="4555920">[</span><span class="ident" id="4555921"><a href="/compress/flate/deflate.go.html#4555757">d</a></span><span class="op" id="4555922">.</span><span class="ident" id="4555923">blockStart</span><span class="op" id="4555933">:</span><span class="ident" id="4555934"><a href="/compress/flate/deflate.go.html#4555799">index</a></span><span class="op" id="4555939">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555947"><a href="/compress/flate/deflate.go.html#4555757">d</a></span><span class="op" id="4555948">.</span><span class="ident" id="4555949">blockStart</span>&nbsp;<span class="op" id="4555960">=</span>&nbsp;<span class="ident" id="4555962"><a href="/compress/flate/deflate.go.html#4555799">index</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555970"><a href="/compress/flate/deflate.go.html#4555757">d</a></span><span class="op" id="4555971">.</span><span class="ident" id="4555972">w</span><span class="op" id="4555973">.</span><span class="ident" id="4555974">writeBlock</span><span class="op" id="4555984">(</span><span class="ident" id="4555985"><a href="/compress/flate/deflate.go.html#4555783">tokens</a></span><span class="op" id="4555991">,</span>&nbsp;<span class="ident" id="4555993"><a href="/compress/flate/deflate.go.html#4555810">eof</a></span><span class="op" id="4555996">,</span>&nbsp;<span class="ident" id="4555998"><a href="/compress/flate/deflate.go.html#4555857">window</a></span><span class="op" id="4556004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556008">return</span>&nbsp;<span class="ident" id="4556015"><a href="/compress/flate/deflate.go.html#4555757">d</a></span><span class="op" id="4556016">.</span><span class="ident" id="4556017">w</span><span class="op" id="4556018">.</span><span class="ident" id="4556019">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4556024">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556027">return</span>&nbsp;<span class="ident" id="4556034">nil</span><br>
<span class="lineno"></span><span class="op" id="4556038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4556041">//&nbsp;Try&nbsp;to&nbsp;find&nbsp;a&nbsp;match&nbsp;starting&nbsp;at&nbsp;index&nbsp;whose&nbsp;length&nbsp;is&nbsp;greater&nbsp;than&nbsp;prevSize.</span><br>
<span class="lineno"></span><span class="comment" id="4556121">//&nbsp;We&nbsp;only&nbsp;look&nbsp;at&nbsp;chainCount&nbsp;possibilities&nbsp;before&nbsp;giving&nbsp;up.</span><br>
<span class="lineno">150</span><span class="keyword" id="4556183">func</span>&nbsp;<span class="op" id="4556188">(</span><span class="ident" id="4556189">d</span>&nbsp;<span class="op" id="4556191">*</span><span class="ident" id="4556192"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4556202">)</span>&nbsp;<span class="ident" id="4556204">findMatch</span><span class="op" id="4556213">(</span><span class="ident" id="4556214">pos</span>&nbsp;<span class="builtintype" id="4556218">int</span><span class="op" id="4556221">,</span>&nbsp;<span class="ident" id="4556223">prevHead</span>&nbsp;<span class="builtintype" id="4556232">int</span><span class="op" id="4556235">,</span>&nbsp;<span class="ident" id="4556237">prevLength</span>&nbsp;<span class="builtintype" id="4556248">int</span><span class="op" id="4556251">,</span>&nbsp;<span class="ident" id="4556253">lookahead</span>&nbsp;<span class="builtintype" id="4556263">int</span><span class="op" id="4556266">)</span>&nbsp;<span class="op" id="4556268">(</span><span class="ident" id="4556269">length</span><span class="op" id="4556275">,</span>&nbsp;<span class="ident" id="4556277">offset</span>&nbsp;<span class="builtintype" id="4556284">int</span><span class="op" id="4556287">,</span>&nbsp;<span class="ident" id="4556289">ok</span>&nbsp;<span class="builtintype" id="4556292">bool</span><span class="op" id="4556296">)</span>&nbsp;<span class="op" id="4556298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556301">minMatchLook</span>&nbsp;<span class="op" id="4556314">:=</span>&nbsp;<span class="ident" id="4556317"><a href="/compress/flate/deflate.go.html#4552793">maxMatchLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556333">if</span>&nbsp;<span class="ident" id="4556336"><a href="/compress/flate/deflate.go.html#4556253">lookahead</a></span>&nbsp;<span class="op" id="4556346">&lt;</span>&nbsp;<span class="ident" id="4556348"><a href="/compress/flate/deflate.go.html#4556301">minMatchLook</a></span>&nbsp;<span class="op" id="4556361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556365"><a href="/compress/flate/deflate.go.html#4556301">minMatchLook</a></span>&nbsp;<span class="op" id="4556378">=</span>&nbsp;<span class="ident" id="4556380"><a href="/compress/flate/deflate.go.html#4556253">lookahead</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4556391">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556395">win</span>&nbsp;<span class="op" id="4556399">:=</span>&nbsp;<span class="ident" id="4556402"><a href="/compress/flate/deflate.go.html#4556189">d</a></span><span class="op" id="4556403">.</span><span class="ident" id="4556404">window</span><span class="op" id="4556410">[</span><span class="num" id="4556411">0</span>&nbsp;<span class="op" id="4556413">:</span>&nbsp;<span class="ident" id="4556415"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4556418">+</span><span class="ident" id="4556419"><a href="/compress/flate/deflate.go.html#4556301">minMatchLook</a></span><span class="op" id="4556431">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556435">//&nbsp;We&nbsp;quit&nbsp;when&nbsp;we&nbsp;get&nbsp;a&nbsp;match&nbsp;that&#39;s&nbsp;at&nbsp;least&nbsp;nice&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556493">nice</span>&nbsp;<span class="op" id="4556498">:=</span>&nbsp;<span class="builtinfunc" id="4556501">len</span><span class="op" id="4556504">(</span><span class="ident" id="4556505"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4556508">)</span>&nbsp;<span class="op" id="4556510">-</span>&nbsp;<span class="ident" id="4556512"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556517">if</span>&nbsp;<span class="ident" id="4556520"><a href="/compress/flate/deflate.go.html#4556189">d</a></span><span class="op" id="4556521">.</span><span class="ident" id="4556522">nice</span>&nbsp;<span class="op" id="4556527">&lt;</span>&nbsp;<span class="ident" id="4556529"><a href="/compress/flate/deflate.go.html#4556493">nice</a></span>&nbsp;<span class="op" id="4556534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556538"><a href="/compress/flate/deflate.go.html#4556493">nice</a></span>&nbsp;<span class="op" id="4556543">=</span>&nbsp;<span class="ident" id="4556545"><a href="/compress/flate/deflate.go.html#4556189">d</a></span><span class="op" id="4556546">.</span><span class="ident" id="4556547">nice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4556553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556557">//&nbsp;If&nbsp;we&#39;ve&nbsp;got&nbsp;a&nbsp;match&nbsp;that&#39;s&nbsp;good&nbsp;enough,&nbsp;only&nbsp;look&nbsp;in&nbsp;1/4&nbsp;the&nbsp;chain.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556630">tries</span>&nbsp;<span class="op" id="4556636">:=</span>&nbsp;<span class="ident" id="4556639"><a href="/compress/flate/deflate.go.html#4556189">d</a></span><span class="op" id="4556640">.</span><span class="ident" id="4556641">chain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556648"><a href="/compress/flate/deflate.go.html#4556269">length</a></span>&nbsp;<span class="op" id="4556655">=</span>&nbsp;<span class="ident" id="4556657"><a href="/compress/flate/deflate.go.html#4556237">prevLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556669">if</span>&nbsp;<span class="ident" id="4556672"><a href="/compress/flate/deflate.go.html#4556269">length</a></span>&nbsp;<span class="op" id="4556679">&gt;=</span>&nbsp;<span class="ident" id="4556682"><a href="/compress/flate/deflate.go.html#4556189">d</a></span><span class="op" id="4556683">.</span><span class="ident" id="4556684">good</span>&nbsp;<span class="op" id="4556689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556693"><a href="/compress/flate/deflate.go.html#4556630">tries</a></span>&nbsp;<span class="op" id="4556699">&gt;&gt;=</span>&nbsp;<span class="num" id="4556703">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4556706">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556710">w0</span>&nbsp;<span class="op" id="4556713">:=</span>&nbsp;<span class="ident" id="4556716"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4556719">[</span><span class="ident" id="4556720"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4556723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556726">w1</span>&nbsp;<span class="op" id="4556729">:=</span>&nbsp;<span class="ident" id="4556732"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4556735">[</span><span class="ident" id="4556736"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4556739">+</span><span class="num" id="4556740">1</span><span class="op" id="4556741">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556744">wEnd</span>&nbsp;<span class="op" id="4556749">:=</span>&nbsp;<span class="ident" id="4556752"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4556755">[</span><span class="ident" id="4556756"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4556759">+</span><span class="ident" id="4556760"><a href="/compress/flate/deflate.go.html#4556269">length</a></span><span class="op" id="4556766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556769">minIndex</span>&nbsp;<span class="op" id="4556778">:=</span>&nbsp;<span class="ident" id="4556781"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span>&nbsp;<span class="op" id="4556785">-</span>&nbsp;<span class="ident" id="4556787"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556800">for</span>&nbsp;<span class="ident" id="4556804">i</span>&nbsp;<span class="op" id="4556806">:=</span>&nbsp;<span class="ident" id="4556809"><a href="/compress/flate/deflate.go.html#4556223">prevHead</a></span><span class="op" id="4556817">;</span>&nbsp;<span class="ident" id="4556819"><a href="/compress/flate/deflate.go.html#4556630">tries</a></span>&nbsp;<span class="op" id="4556825">&gt;</span>&nbsp;<span class="num" id="4556827">0</span><span class="op" id="4556828">;</span>&nbsp;<span class="ident" id="4556830"><a href="/compress/flate/deflate.go.html#4556630">tries</a></span><span class="op" id="4556835">--</span>&nbsp;<span class="op" id="4556838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556842">if</span>&nbsp;<span class="ident" id="4556845"><a href="/compress/flate/deflate.go.html#4556710">w0</a></span>&nbsp;<span class="op" id="4556848">==</span>&nbsp;<span class="ident" id="4556851"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4556854">[</span><span class="ident" id="4556855"><a href="/compress/flate/deflate.go.html#4556804">i</a></span><span class="op" id="4556856">]</span>&nbsp;<span class="op" id="4556858">&amp;&amp;</span>&nbsp;<span class="ident" id="4556861"><a href="/compress/flate/deflate.go.html#4556726">w1</a></span>&nbsp;<span class="op" id="4556864">==</span>&nbsp;<span class="ident" id="4556867"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4556870">[</span><span class="ident" id="4556871"><a href="/compress/flate/deflate.go.html#4556804">i</a></span><span class="op" id="4556872">+</span><span class="num" id="4556873">1</span><span class="op" id="4556874">]</span>&nbsp;<span class="op" id="4556876">&amp;&amp;</span>&nbsp;<span class="ident" id="4556879"><a href="/compress/flate/deflate.go.html#4556744">wEnd</a></span>&nbsp;<span class="op" id="4556884">==</span>&nbsp;<span class="ident" id="4556887"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4556890">[</span><span class="ident" id="4556891"><a href="/compress/flate/deflate.go.html#4556804">i</a></span><span class="op" id="4556892">+</span><span class="ident" id="4556893"><a href="/compress/flate/deflate.go.html#4556269">length</a></span><span class="op" id="4556899">]</span>&nbsp;<span class="op" id="4556901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556906">//&nbsp;The&nbsp;hash&nbsp;function&nbsp;ensures&nbsp;that&nbsp;if&nbsp;win[i]&nbsp;and&nbsp;win[i+1]&nbsp;match,&nbsp;win[i+2]&nbsp;matches</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556991">n</span>&nbsp;<span class="op" id="4556993">:=</span>&nbsp;<span class="num" id="4556996">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557001">for</span>&nbsp;<span class="ident" id="4557005"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4557008">+</span><span class="ident" id="4557009"><a href="/compress/flate/deflate.go.html#4556991">n</a></span>&nbsp;<span class="op" id="4557011">&lt;</span>&nbsp;<span class="builtinfunc" id="4557013">len</span><span class="op" id="4557016">(</span><span class="ident" id="4557017"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4557020">)</span>&nbsp;<span class="op" id="4557022">&amp;&amp;</span>&nbsp;<span class="ident" id="4557025"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4557028">[</span><span class="ident" id="4557029"><a href="/compress/flate/deflate.go.html#4556804">i</a></span><span class="op" id="4557030">+</span><span class="ident" id="4557031"><a href="/compress/flate/deflate.go.html#4556991">n</a></span><span class="op" id="4557032">]</span>&nbsp;<span class="op" id="4557034">==</span>&nbsp;<span class="ident" id="4557037"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4557040">[</span><span class="ident" id="4557041"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4557044">+</span><span class="ident" id="4557045"><a href="/compress/flate/deflate.go.html#4556991">n</a></span><span class="op" id="4557046">]</span>&nbsp;<span class="op" id="4557048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557054"><a href="/compress/flate/deflate.go.html#4556991">n</a></span><span class="op" id="4557055">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557066">if</span>&nbsp;<span class="ident" id="4557069"><a href="/compress/flate/deflate.go.html#4556991">n</a></span>&nbsp;<span class="op" id="4557071">&gt;</span>&nbsp;<span class="ident" id="4557073"><a href="/compress/flate/deflate.go.html#4556269">length</a></span>&nbsp;<span class="op" id="4557080">&amp;&amp;</span>&nbsp;<span class="op" id="4557083">(</span><span class="ident" id="4557084"><a href="/compress/flate/deflate.go.html#4556991">n</a></span>&nbsp;<span class="op" id="4557086">&gt;</span>&nbsp;<span class="num" id="4557088">3</span>&nbsp;<span class="op" id="4557090">||</span>&nbsp;<span class="ident" id="4557093"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4557096">-</span><span class="ident" id="4557097"><a href="/compress/flate/deflate.go.html#4556804">i</a></span>&nbsp;<span class="op" id="4557099">&lt;=</span>&nbsp;<span class="num" id="4557102">4096</span><span class="op" id="4557106">)</span>&nbsp;<span class="op" id="4557108">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557114"><a href="/compress/flate/deflate.go.html#4556269">length</a></span>&nbsp;<span class="op" id="4557121">=</span>&nbsp;<span class="ident" id="4557123"><a href="/compress/flate/deflate.go.html#4556991">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557129"><a href="/compress/flate/deflate.go.html#4556277">offset</a></span>&nbsp;<span class="op" id="4557136">=</span>&nbsp;<span class="ident" id="4557138"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span>&nbsp;<span class="op" id="4557142">-</span>&nbsp;<span class="ident" id="4557144"><a href="/compress/flate/deflate.go.html#4556804">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557150"><a href="/compress/flate/deflate.go.html#4556289">ok</a></span>&nbsp;<span class="op" id="4557153">=</span>&nbsp;<span class="ident" id="4557155">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557164">if</span>&nbsp;<span class="ident" id="4557167"><a href="/compress/flate/deflate.go.html#4556991">n</a></span>&nbsp;<span class="op" id="4557169">&gt;=</span>&nbsp;<span class="ident" id="4557172"><a href="/compress/flate/deflate.go.html#4556493">nice</a></span>&nbsp;<span class="op" id="4557177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4557184">//&nbsp;The&nbsp;match&nbsp;is&nbsp;good&nbsp;enough&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;try&nbsp;to&nbsp;find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557257">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557273"><a href="/compress/flate/deflate.go.html#4556744">wEnd</a></span>&nbsp;<span class="op" id="4557278">=</span>&nbsp;<span class="ident" id="4557280"><a href="/compress/flate/deflate.go.html#4556395">win</a></span><span class="op" id="4557283">[</span><span class="ident" id="4557284"><a href="/compress/flate/deflate.go.html#4556214">pos</a></span><span class="op" id="4557287">+</span><span class="ident" id="4557288"><a href="/compress/flate/deflate.go.html#4556991">n</a></span><span class="op" id="4557289">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557298">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557302">if</span>&nbsp;<span class="ident" id="4557305"><a href="/compress/flate/deflate.go.html#4556804">i</a></span>&nbsp;<span class="op" id="4557307">==</span>&nbsp;<span class="ident" id="4557310"><a href="/compress/flate/deflate.go.html#4556769">minIndex</a></span>&nbsp;<span class="op" id="4557319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4557324">//&nbsp;hashPrev[i&nbsp;&amp;&nbsp;windowMask]&nbsp;has&nbsp;already&nbsp;been&nbsp;overwritten,&nbsp;so&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557398">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557410">if</span>&nbsp;<span class="ident" id="4557413"><a href="/compress/flate/deflate.go.html#4556804">i</a></span>&nbsp;<span class="op" id="4557415">=</span>&nbsp;<span class="ident" id="4557417"><a href="/compress/flate/deflate.go.html#4556189">d</a></span><span class="op" id="4557418">.</span><span class="ident" id="4557419">hashPrev</span><span class="op" id="4557427">[</span><span class="ident" id="4557428"><a href="/compress/flate/deflate.go.html#4556804">i</a></span><span class="op" id="4557429">&amp;</span><span class="ident" id="4557430"><a href="/compress/flate/deflate.go.html#4552632">windowMask</a></span><span class="op" id="4557440">]</span>&nbsp;<span class="op" id="4557442">-</span>&nbsp;<span class="ident" id="4557444"><a href="/compress/flate/deflate.go.html#4556189">d</a></span><span class="op" id="4557445">.</span><span class="ident" id="4557446">hashOffset</span><span class="op" id="4557456">;</span>&nbsp;<span class="ident" id="4557458"><a href="/compress/flate/deflate.go.html#4556804">i</a></span>&nbsp;<span class="op" id="4557460">&lt;</span>&nbsp;<span class="ident" id="4557462"><a href="/compress/flate/deflate.go.html#4556769">minIndex</a></span>&nbsp;<span class="op" id="4557471">||</span>&nbsp;<span class="ident" id="4557474"><a href="/compress/flate/deflate.go.html#4556804">i</a></span>&nbsp;<span class="op" id="4557476">&lt;</span>&nbsp;<span class="num" id="4557478">0</span>&nbsp;<span class="op" id="4557480">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557485">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557499">return</span><br>
<span class="lineno"></span><span class="op" id="4557506">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="4557509">func</span>&nbsp;<span class="op" id="4557514">(</span><span class="ident" id="4557515">d</span>&nbsp;<span class="op" id="4557517">*</span><span class="ident" id="4557518"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4557528">)</span>&nbsp;<span class="ident" id="4557530">writeStoredBlock</span><span class="op" id="4557546">(</span><span class="ident" id="4557547">buf</span>&nbsp;<span class="op" id="4557551">[</span><span class="op" id="4557552">]</span><span class="builtintype" id="4557553">byte</span><span class="op" id="4557557">)</span>&nbsp;<span class="builtintype" id="4557559">error</span>&nbsp;<span class="op" id="4557565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557568">if</span>&nbsp;<span class="ident" id="4557571"><a href="/compress/flate/deflate.go.html#4557515">d</a></span><span class="op" id="4557572">.</span><span class="ident" id="4557573">w</span><span class="op" id="4557574">.</span><span class="ident" id="4557575">writeStoredHeader</span><span class="op" id="4557592">(</span><span class="builtinfunc" id="4557593">len</span><span class="op" id="4557596">(</span><span class="ident" id="4557597"><a href="/compress/flate/deflate.go.html#4557547">buf</a></span><span class="op" id="4557600">)</span><span class="op" id="4557601">,</span>&nbsp;<span class="ident" id="4557603">false</span><span class="op" id="4557608">)</span><span class="op" id="4557609">;</span>&nbsp;<span class="ident" id="4557611"><a href="/compress/flate/deflate.go.html#4557515">d</a></span><span class="op" id="4557612">.</span><span class="ident" id="4557613">w</span><span class="op" id="4557614">.</span><span class="ident" id="4557615">err</span>&nbsp;<span class="op" id="4557619">!=</span>&nbsp;<span class="ident" id="4557622">nil</span>&nbsp;<span class="op" id="4557626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557630">return</span>&nbsp;<span class="ident" id="4557637"><a href="/compress/flate/deflate.go.html#4557515">d</a></span><span class="op" id="4557638">.</span><span class="ident" id="4557639">w</span><span class="op" id="4557640">.</span><span class="ident" id="4557641">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557646">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557649"><a href="/compress/flate/deflate.go.html#4557515">d</a></span><span class="op" id="4557650">.</span><span class="ident" id="4557651">w</span><span class="op" id="4557652">.</span><span class="ident" id="4557653">writeBytes</span><span class="op" id="4557663">(</span><span class="ident" id="4557664"><a href="/compress/flate/deflate.go.html#4557547">buf</a></span><span class="op" id="4557667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557670">return</span>&nbsp;<span class="ident" id="4557677"><a href="/compress/flate/deflate.go.html#4557515">d</a></span><span class="op" id="4557678">.</span><span class="ident" id="4557679">w</span><span class="op" id="4557680">.</span><span class="ident" id="4557681">err</span><br>
<span class="lineno"></span><span class="op" id="4557685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4557688">func</span>&nbsp;<span class="op" id="4557693">(</span><span class="ident" id="4557694">d</span>&nbsp;<span class="op" id="4557696">*</span><span class="ident" id="4557697"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4557707">)</span>&nbsp;<span class="ident" id="4557709">initDeflate</span><span class="op" id="4557720">(</span><span class="op" id="4557721">)</span>&nbsp;<span class="op" id="4557723">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557726"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557727">.</span><span class="ident" id="4557728">hashHead</span>&nbsp;<span class="op" id="4557737">=</span>&nbsp;<span class="builtinfunc" id="4557739">make</span><span class="op" id="4557743">(</span><span class="op" id="4557744">[</span><span class="op" id="4557745">]</span><span class="builtintype" id="4557746">int</span><span class="op" id="4557749">,</span>&nbsp;<span class="ident" id="4557751"><a href="/compress/flate/deflate.go.html#4553131">hashSize</a></span><span class="op" id="4557759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557762"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557763">.</span><span class="ident" id="4557764">hashPrev</span>&nbsp;<span class="op" id="4557773">=</span>&nbsp;<span class="builtinfunc" id="4557775">make</span><span class="op" id="4557779">(</span><span class="op" id="4557780">[</span><span class="op" id="4557781">]</span><span class="builtintype" id="4557782">int</span><span class="op" id="4557785">,</span>&nbsp;<span class="ident" id="4557787"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><span class="op" id="4557797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557800"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557801">.</span><span class="ident" id="4557802">window</span>&nbsp;<span class="op" id="4557809">=</span>&nbsp;<span class="builtinfunc" id="4557811">make</span><span class="op" id="4557815">(</span><span class="op" id="4557816">[</span><span class="op" id="4557817">]</span><span class="builtintype" id="4557818">byte</span><span class="op" id="4557822">,</span>&nbsp;<span class="num" id="4557824">2</span><span class="op" id="4557825">*</span><span class="ident" id="4557826"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><span class="op" id="4557836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557839"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557840">.</span><span class="ident" id="4557841">hashOffset</span>&nbsp;<span class="op" id="4557852">=</span>&nbsp;<span class="num" id="4557854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557857"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557858">.</span><span class="ident" id="4557859">tokens</span>&nbsp;<span class="op" id="4557866">=</span>&nbsp;<span class="builtinfunc" id="4557868">make</span><span class="op" id="4557872">(</span><span class="op" id="4557873">[</span><span class="op" id="4557874">]</span><span class="ident" id="4557875"><a href="/compress/flate/token.go.html#4616305">token</a></span><span class="op" id="4557880">,</span>&nbsp;<span class="num" id="4557882">0</span><span class="op" id="4557883">,</span>&nbsp;<span class="ident" id="4557885"><a href="/compress/flate/deflate.go.html#4553045">maxFlateBlockTokens</a></span><span class="op" id="4557904">+</span><span class="num" id="4557905">1</span><span class="op" id="4557906">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557909"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557910">.</span><span class="ident" id="4557911">length</span>&nbsp;<span class="op" id="4557918">=</span>&nbsp;<span class="ident" id="4557920"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4557935">-</span>&nbsp;<span class="num" id="4557937">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557940"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557941">.</span><span class="ident" id="4557942">offset</span>&nbsp;<span class="op" id="4557949">=</span>&nbsp;<span class="num" id="4557951">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557954"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557955">.</span><span class="ident" id="4557956">byteAvailable</span>&nbsp;<span class="op" id="4557970">=</span>&nbsp;<span class="ident" id="4557972">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557979"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557980">.</span><span class="ident" id="4557981">index</span>&nbsp;<span class="op" id="4557987">=</span>&nbsp;<span class="num" id="4557989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557992"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4557993">.</span><span class="ident" id="4557994">hash</span>&nbsp;<span class="op" id="4557999">=</span>&nbsp;<span class="num" id="4558001">0</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558004"><a href="/compress/flate/deflate.go.html#4557694">d</a></span><span class="op" id="4558005">.</span><span class="ident" id="4558006">chainHead</span>&nbsp;<span class="op" id="4558016">=</span>&nbsp;<span class="op" id="4558018">-</span><span class="num" id="4558019">1</span><br>
<span class="lineno"></span><span class="op" id="4558021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4558024">func</span>&nbsp;<span class="op" id="4558029">(</span><span class="ident" id="4558030">d</span>&nbsp;<span class="op" id="4558032">*</span><span class="ident" id="4558033"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4558043">)</span>&nbsp;<span class="ident" id="4558045">deflate</span><span class="op" id="4558052">(</span><span class="op" id="4558053">)</span>&nbsp;<span class="op" id="4558055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558058">if</span>&nbsp;<span class="ident" id="4558061"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558062">.</span><span class="ident" id="4558063">windowEnd</span><span class="op" id="4558072">-</span><span class="ident" id="4558073"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558074">.</span><span class="ident" id="4558075">index</span>&nbsp;<span class="op" id="4558081">&lt;</span>&nbsp;<span class="ident" id="4558083"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><span class="op" id="4558097">+</span><span class="ident" id="4558098"><a href="/compress/flate/deflate.go.html#4552793">maxMatchLength</a></span>&nbsp;<span class="op" id="4558113">&amp;&amp;</span>&nbsp;<span class="op" id="4558116">!</span><span class="ident" id="4558117"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558118">.</span><span class="ident" id="4558119">sync</span>&nbsp;<span class="op" id="4558124">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558128">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558140"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558141">.</span><span class="ident" id="4558142">maxInsertIndex</span>&nbsp;<span class="op" id="4558157">=</span>&nbsp;<span class="ident" id="4558159"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558160">.</span><span class="ident" id="4558161">windowEnd</span>&nbsp;<span class="op" id="4558171">-</span>&nbsp;<span class="op" id="4558173">(</span><span class="ident" id="4558174"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4558189">-</span>&nbsp;<span class="num" id="4558191">1</span><span class="op" id="4558192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558195">if</span>&nbsp;<span class="ident" id="4558198"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558199">.</span><span class="ident" id="4558200">index</span>&nbsp;<span class="op" id="4558206">&lt;</span>&nbsp;<span class="ident" id="4558208"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558209">.</span><span class="ident" id="4558210">maxInsertIndex</span>&nbsp;<span class="op" id="4558225">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558229"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558230">.</span><span class="ident" id="4558231">hash</span>&nbsp;<span class="op" id="4558236">=</span>&nbsp;<span class="builtintype" id="4558238">int</span><span class="op" id="4558241">(</span><span class="ident" id="4558242"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558243">.</span><span class="ident" id="4558244">window</span><span class="op" id="4558250">[</span><span class="ident" id="4558251"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558252">.</span><span class="ident" id="4558253">index</span><span class="op" id="4558258">]</span><span class="op" id="4558259">)</span><span class="op" id="4558260">&lt;&lt;</span><span class="ident" id="4558262"><a href="/compress/flate/deflate.go.html#4553211">hashShift</a></span>&nbsp;<span class="op" id="4558272">+</span>&nbsp;<span class="builtintype" id="4558274">int</span><span class="op" id="4558277">(</span><span class="ident" id="4558278"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558279">.</span><span class="ident" id="4558280">window</span><span class="op" id="4558286">[</span><span class="ident" id="4558287"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558288">.</span><span class="ident" id="4558289">index</span><span class="op" id="4558294">+</span><span class="num" id="4558295">1</span><span class="op" id="4558296">]</span><span class="op" id="4558297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4558303">Loop</span><span class="op" id="4558307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558310">for</span>&nbsp;<span class="op" id="4558314">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558318">if</span>&nbsp;<span class="ident" id="4558321"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558322">.</span><span class="ident" id="4558323">index</span>&nbsp;<span class="op" id="4558329">&gt;</span>&nbsp;<span class="ident" id="4558331"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558332">.</span><span class="ident" id="4558333">windowEnd</span>&nbsp;<span class="op" id="4558343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4558348">panic</span><span class="op" id="4558353">(</span><span class="string" id="4558354">&#34;index&nbsp;&gt;&nbsp;windowEnd&#34;</span><span class="op" id="4558373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558381">lookahead</span>&nbsp;<span class="op" id="4558391">:=</span>&nbsp;<span class="ident" id="4558394"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558395">.</span><span class="ident" id="4558396">windowEnd</span>&nbsp;<span class="op" id="4558406">-</span>&nbsp;<span class="ident" id="4558408"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558409">.</span><span class="ident" id="4558410">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558418">if</span>&nbsp;<span class="ident" id="4558421"><a href="/compress/flate/deflate.go.html#4558381">lookahead</a></span>&nbsp;<span class="op" id="4558431">&lt;</span>&nbsp;<span class="ident" id="4558433"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><span class="op" id="4558447">+</span><span class="ident" id="4558448"><a href="/compress/flate/deflate.go.html#4552793">maxMatchLength</a></span>&nbsp;<span class="op" id="4558463">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558468">if</span>&nbsp;<span class="op" id="4558471">!</span><span class="ident" id="4558472"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558473">.</span><span class="ident" id="4558474">sync</span>&nbsp;<span class="op" id="4558479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558485">break</span>&nbsp;<span class="ident" id="4558491">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558504">if</span>&nbsp;<span class="ident" id="4558507"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558508">.</span><span class="ident" id="4558509">index</span>&nbsp;<span class="op" id="4558515">&gt;</span>&nbsp;<span class="ident" id="4558517"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558518">.</span><span class="ident" id="4558519">windowEnd</span>&nbsp;<span class="op" id="4558529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4558535">panic</span><span class="op" id="4558540">(</span><span class="string" id="4558541">&#34;index&nbsp;&gt;&nbsp;windowEnd&#34;</span><span class="op" id="4558560">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558570">if</span>&nbsp;<span class="ident" id="4558573"><a href="/compress/flate/deflate.go.html#4558381">lookahead</a></span>&nbsp;<span class="op" id="4558583">==</span>&nbsp;<span class="num" id="4558586">0</span>&nbsp;<span class="op" id="4558588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4558594">//&nbsp;Flush&nbsp;current&nbsp;output&nbsp;block&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558636">if</span>&nbsp;<span class="ident" id="4558639"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558640">.</span><span class="ident" id="4558641">byteAvailable</span>&nbsp;<span class="op" id="4558655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4558662">//&nbsp;There&nbsp;is&nbsp;still&nbsp;one&nbsp;pending&nbsp;token&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;flushed</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558728"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558729">.</span><span class="ident" id="4558730">tokens</span>&nbsp;<span class="op" id="4558737">=</span>&nbsp;<span class="builtinfunc" id="4558739">append</span><span class="op" id="4558745">(</span><span class="ident" id="4558746"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558747">.</span><span class="ident" id="4558748">tokens</span><span class="op" id="4558754">,</span>&nbsp;<span class="ident" id="4558756"><a href="/compress/flate/token.go.html#4616367">literalToken</a></span><span class="op" id="4558768">(</span><span class="builtintype" id="4558769">uint32</span><span class="op" id="4558775">(</span><span class="ident" id="4558776"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558777">.</span><span class="ident" id="4558778">window</span><span class="op" id="4558784">[</span><span class="ident" id="4558785"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558786">.</span><span class="ident" id="4558787">index</span><span class="op" id="4558792">-</span><span class="num" id="4558793">1</span><span class="op" id="4558794">]</span><span class="op" id="4558795">)</span><span class="op" id="4558796">)</span><span class="op" id="4558797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558804"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558805">.</span><span class="ident" id="4558806">byteAvailable</span>&nbsp;<span class="op" id="4558820">=</span>&nbsp;<span class="ident" id="4558822">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558838">if</span>&nbsp;<span class="builtinfunc" id="4558841">len</span><span class="op" id="4558844">(</span><span class="ident" id="4558845"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558846">.</span><span class="ident" id="4558847">tokens</span><span class="op" id="4558853">)</span>&nbsp;<span class="op" id="4558855">&gt;</span>&nbsp;<span class="num" id="4558857">0</span>&nbsp;<span class="op" id="4558859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558866">if</span>&nbsp;<span class="ident" id="4558869"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558870">.</span><span class="ident" id="4558871">err</span>&nbsp;<span class="op" id="4558875">=</span>&nbsp;<span class="ident" id="4558877"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558878">.</span><span class="ident" id="4558879">writeBlock</span><span class="op" id="4558889">(</span><span class="ident" id="4558890"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558891">.</span><span class="ident" id="4558892">tokens</span><span class="op" id="4558898">,</span>&nbsp;<span class="ident" id="4558900"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558901">.</span><span class="ident" id="4558902">index</span><span class="op" id="4558907">,</span>&nbsp;<span class="ident" id="4558909">false</span><span class="op" id="4558914">)</span><span class="op" id="4558915">;</span>&nbsp;<span class="ident" id="4558917"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558918">.</span><span class="ident" id="4558919">err</span>&nbsp;<span class="op" id="4558923">!=</span>&nbsp;<span class="ident" id="4558926">nil</span>&nbsp;<span class="op" id="4558930">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558938">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558957"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558958">.</span><span class="ident" id="4558959">tokens</span>&nbsp;<span class="op" id="4558966">=</span>&nbsp;<span class="ident" id="4558968"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4558969">.</span><span class="ident" id="4558970">tokens</span><span class="op" id="4558976">[</span><span class="op" id="4558977">:</span><span class="num" id="4558978">0</span><span class="op" id="4558979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558991">break</span>&nbsp;<span class="ident" id="4558997">Loop</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559013">if</span>&nbsp;<span class="ident" id="4559016"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559017">.</span><span class="ident" id="4559018">index</span>&nbsp;<span class="op" id="4559024">&lt;</span>&nbsp;<span class="ident" id="4559026"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559027">.</span><span class="ident" id="4559028">maxInsertIndex</span>&nbsp;<span class="op" id="4559043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559048">//&nbsp;Update&nbsp;the&nbsp;hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559070"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559071">.</span><span class="ident" id="4559072">hash</span>&nbsp;<span class="op" id="4559077">=</span>&nbsp;<span class="op" id="4559079">(</span><span class="ident" id="4559080"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559081">.</span><span class="ident" id="4559082">hash</span><span class="op" id="4559086">&lt;&lt;</span><span class="ident" id="4559088"><a href="/compress/flate/deflate.go.html#4553211">hashShift</a></span>&nbsp;<span class="op" id="4559098">+</span>&nbsp;<span class="builtintype" id="4559100">int</span><span class="op" id="4559103">(</span><span class="ident" id="4559104"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559105">.</span><span class="ident" id="4559106">window</span><span class="op" id="4559112">[</span><span class="ident" id="4559113"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559114">.</span><span class="ident" id="4559115">index</span><span class="op" id="4559120">+</span><span class="num" id="4559121">2</span><span class="op" id="4559122">]</span><span class="op" id="4559123">)</span><span class="op" id="4559124">)</span>&nbsp;<span class="op" id="4559126">&amp;</span>&nbsp;<span class="ident" id="4559128"><a href="/compress/flate/deflate.go.html#4553168">hashMask</a></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559140"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559141">.</span><span class="ident" id="4559142">chainHead</span>&nbsp;<span class="op" id="4559152">=</span>&nbsp;<span class="ident" id="4559154"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559155">.</span><span class="ident" id="4559156">hashHead</span><span class="op" id="4559164">[</span><span class="ident" id="4559165"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559166">.</span><span class="ident" id="4559167">hash</span><span class="op" id="4559171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559176"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559177">.</span><span class="ident" id="4559178">hashPrev</span><span class="op" id="4559186">[</span><span class="ident" id="4559187"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559188">.</span><span class="ident" id="4559189">index</span><span class="op" id="4559194">&amp;</span><span class="ident" id="4559195"><a href="/compress/flate/deflate.go.html#4552632">windowMask</a></span><span class="op" id="4559205">]</span>&nbsp;<span class="op" id="4559207">=</span>&nbsp;<span class="ident" id="4559209"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559210">.</span><span class="ident" id="4559211">chainHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559224"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559225">.</span><span class="ident" id="4559226">hashHead</span><span class="op" id="4559234">[</span><span class="ident" id="4559235"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559236">.</span><span class="ident" id="4559237">hash</span><span class="op" id="4559241">]</span>&nbsp;<span class="op" id="4559243">=</span>&nbsp;<span class="ident" id="4559245"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559246">.</span><span class="ident" id="4559247">index</span>&nbsp;<span class="op" id="4559253">+</span>&nbsp;<span class="ident" id="4559255"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559256">.</span><span class="ident" id="4559257">hashOffset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559274">prevLength</span>&nbsp;<span class="op" id="4559285">:=</span>&nbsp;<span class="ident" id="4559288"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559289">.</span><span class="ident" id="4559290">length</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559299">prevOffset</span>&nbsp;<span class="op" id="4559310">:=</span>&nbsp;<span class="ident" id="4559313"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559314">.</span><span class="ident" id="4559315">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559324"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559325">.</span><span class="ident" id="4559326">length</span>&nbsp;<span class="op" id="4559333">=</span>&nbsp;<span class="ident" id="4559335"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4559350">-</span>&nbsp;<span class="num" id="4559352">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559356"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559357">.</span><span class="ident" id="4559358">offset</span>&nbsp;<span class="op" id="4559365">=</span>&nbsp;<span class="num" id="4559367">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559371">minIndex</span>&nbsp;<span class="op" id="4559380">:=</span>&nbsp;<span class="ident" id="4559383"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559384">.</span><span class="ident" id="4559385">index</span>&nbsp;<span class="op" id="4559391">-</span>&nbsp;<span class="ident" id="4559393"><a href="/compress/flate/deflate.go.html#4552591">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559406">if</span>&nbsp;<span class="ident" id="4559409"><a href="/compress/flate/deflate.go.html#4559371">minIndex</a></span>&nbsp;<span class="op" id="4559418">&lt;</span>&nbsp;<span class="num" id="4559420">0</span>&nbsp;<span class="op" id="4559422">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559427"><a href="/compress/flate/deflate.go.html#4559371">minIndex</a></span>&nbsp;<span class="op" id="4559436">=</span>&nbsp;<span class="num" id="4559438">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559447">if</span>&nbsp;<span class="ident" id="4559450"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559451">.</span><span class="ident" id="4559452">chainHead</span><span class="op" id="4559461">-</span><span class="ident" id="4559462"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559463">.</span><span class="ident" id="4559464">hashOffset</span>&nbsp;<span class="op" id="4559475">&gt;=</span>&nbsp;<span class="ident" id="4559478"><a href="/compress/flate/deflate.go.html#4559371">minIndex</a></span>&nbsp;<span class="op" id="4559487">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559493">(</span><span class="ident" id="4559494"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559495">.</span><span class="ident" id="4559496">fastSkipHashing</span>&nbsp;<span class="op" id="4559512">!=</span>&nbsp;<span class="ident" id="4559515"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4559525">&amp;&amp;</span>&nbsp;<span class="ident" id="4559528"><a href="/compress/flate/deflate.go.html#4558381">lookahead</a></span>&nbsp;<span class="op" id="4559538">&gt;</span>&nbsp;<span class="ident" id="4559540"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><span class="op" id="4559554">-</span><span class="num" id="4559555">1</span>&nbsp;<span class="op" id="4559557">||</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559564"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559565">.</span><span class="ident" id="4559566">fastSkipHashing</span>&nbsp;<span class="op" id="4559582">==</span>&nbsp;<span class="ident" id="4559585"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4559595">&amp;&amp;</span>&nbsp;<span class="ident" id="4559598"><a href="/compress/flate/deflate.go.html#4558381">lookahead</a></span>&nbsp;<span class="op" id="4559608">&gt;</span>&nbsp;<span class="ident" id="4559610"><a href="/compress/flate/deflate.go.html#4559274">prevLength</a></span>&nbsp;<span class="op" id="4559621">&amp;&amp;</span>&nbsp;<span class="ident" id="4559624"><a href="/compress/flate/deflate.go.html#4559274">prevLength</a></span>&nbsp;<span class="op" id="4559635">&lt;</span>&nbsp;<span class="ident" id="4559637"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559638">.</span><span class="ident" id="4559639">lazy</span><span class="op" id="4559643">)</span>&nbsp;<span class="op" id="4559645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559650">if</span>&nbsp;<span class="ident" id="4559653">newLength</span><span class="op" id="4559662">,</span>&nbsp;<span class="ident" id="4559664">newOffset</span><span class="op" id="4559673">,</span>&nbsp;<span class="ident" id="4559675">ok</span>&nbsp;<span class="op" id="4559678">:=</span>&nbsp;<span class="ident" id="4559681"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559682">.</span><span class="ident" id="4559683">findMatch</span><span class="op" id="4559692">(</span><span class="ident" id="4559693"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559694">.</span><span class="ident" id="4559695">index</span><span class="op" id="4559700">,</span>&nbsp;<span class="ident" id="4559702"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559703">.</span><span class="ident" id="4559704">chainHead</span><span class="op" id="4559713">-</span><span class="ident" id="4559714"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559715">.</span><span class="ident" id="4559716">hashOffset</span><span class="op" id="4559726">,</span>&nbsp;<span class="ident" id="4559728"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><span class="op" id="4559742">-</span><span class="num" id="4559743">1</span><span class="op" id="4559744">,</span>&nbsp;<span class="ident" id="4559746"><a href="/compress/flate/deflate.go.html#4558381">lookahead</a></span><span class="op" id="4559755">)</span><span class="op" id="4559756">;</span>&nbsp;<span class="ident" id="4559758"><a href="/compress/flate/deflate.go.html#4559675">ok</a></span>&nbsp;<span class="op" id="4559761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559767"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559768">.</span><span class="ident" id="4559769">length</span>&nbsp;<span class="op" id="4559776">=</span>&nbsp;<span class="ident" id="4559778"><a href="/compress/flate/deflate.go.html#4559653">newLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559792"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559793">.</span><span class="ident" id="4559794">offset</span>&nbsp;<span class="op" id="4559801">=</span>&nbsp;<span class="ident" id="4559803"><a href="/compress/flate/deflate.go.html#4559664">newOffset</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559816">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559824">if</span>&nbsp;<span class="ident" id="4559827"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559828">.</span><span class="ident" id="4559829">fastSkipHashing</span>&nbsp;<span class="op" id="4559845">!=</span>&nbsp;<span class="ident" id="4559848"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4559858">&amp;&amp;</span>&nbsp;<span class="ident" id="4559861"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559862">.</span><span class="ident" id="4559863">length</span>&nbsp;<span class="op" id="4559870">&gt;=</span>&nbsp;<span class="ident" id="4559873"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4559888">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559894"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559895">.</span><span class="ident" id="4559896">fastSkipHashing</span>&nbsp;<span class="op" id="4559912">==</span>&nbsp;<span class="ident" id="4559915"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4559925">&amp;&amp;</span>&nbsp;<span class="ident" id="4559928"><a href="/compress/flate/deflate.go.html#4559274">prevLength</a></span>&nbsp;<span class="op" id="4559939">&gt;=</span>&nbsp;<span class="ident" id="4559942"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4559957">&amp;&amp;</span>&nbsp;<span class="ident" id="4559960"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4559961">.</span><span class="ident" id="4559962">length</span>&nbsp;<span class="op" id="4559969">&lt;=</span>&nbsp;<span class="ident" id="4559972"><a href="/compress/flate/deflate.go.html#4559274">prevLength</a></span>&nbsp;<span class="op" id="4559983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559988">//&nbsp;There&nbsp;was&nbsp;a&nbsp;match&nbsp;at&nbsp;the&nbsp;previous&nbsp;step,&nbsp;and&nbsp;the&nbsp;current&nbsp;match&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560059">//&nbsp;not&nbsp;better.&nbsp;Output&nbsp;the&nbsp;previous&nbsp;match.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560104">if</span>&nbsp;<span class="ident" id="4560107"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560108">.</span><span class="ident" id="4560109">fastSkipHashing</span>&nbsp;<span class="op" id="4560125">!=</span>&nbsp;<span class="ident" id="4560128"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4560138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560144"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560145">.</span><span class="ident" id="4560146">tokens</span>&nbsp;<span class="op" id="4560153">=</span>&nbsp;<span class="builtinfunc" id="4560155">append</span><span class="op" id="4560161">(</span><span class="ident" id="4560162"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560163">.</span><span class="ident" id="4560164">tokens</span><span class="op" id="4560170">,</span>&nbsp;<span class="ident" id="4560172"><a href="/compress/flate/token.go.html#4616507">matchToken</a></span><span class="op" id="4560182">(</span><span class="builtintype" id="4560183">uint32</span><span class="op" id="4560189">(</span><span class="ident" id="4560190"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560191">.</span><span class="ident" id="4560192">length</span><span class="op" id="4560198">-</span><span class="ident" id="4560199"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><span class="op" id="4560213">)</span><span class="op" id="4560214">,</span>&nbsp;<span class="builtintype" id="4560216">uint32</span><span class="op" id="4560222">(</span><span class="ident" id="4560223"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560224">.</span><span class="ident" id="4560225">offset</span><span class="op" id="4560231">-</span><span class="ident" id="4560232"><a href="/compress/flate/deflate.go.html#4552859">minOffsetSize</a></span><span class="op" id="4560245">)</span><span class="op" id="4560246">)</span><span class="op" id="4560247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560252">}</span>&nbsp;<span class="keyword" id="4560254">else</span>&nbsp;<span class="op" id="4560259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560265"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560266">.</span><span class="ident" id="4560267">tokens</span>&nbsp;<span class="op" id="4560274">=</span>&nbsp;<span class="builtinfunc" id="4560276">append</span><span class="op" id="4560282">(</span><span class="ident" id="4560283"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560284">.</span><span class="ident" id="4560285">tokens</span><span class="op" id="4560291">,</span>&nbsp;<span class="ident" id="4560293"><a href="/compress/flate/token.go.html#4616507">matchToken</a></span><span class="op" id="4560303">(</span><span class="builtintype" id="4560304">uint32</span><span class="op" id="4560310">(</span><span class="ident" id="4560311"><a href="/compress/flate/deflate.go.html#4559274">prevLength</a></span><span class="op" id="4560321">-</span><span class="ident" id="4560322"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span><span class="op" id="4560336">)</span><span class="op" id="4560337">,</span>&nbsp;<span class="builtintype" id="4560339">uint32</span><span class="op" id="4560345">(</span><span class="ident" id="4560346"><a href="/compress/flate/deflate.go.html#4559299">prevOffset</a></span><span class="op" id="4560356">-</span><span class="ident" id="4560357"><a href="/compress/flate/deflate.go.html#4552859">minOffsetSize</a></span><span class="op" id="4560370">)</span><span class="op" id="4560371">)</span><span class="op" id="4560372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560377">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560382">//&nbsp;Insert&nbsp;in&nbsp;the&nbsp;hash&nbsp;table&nbsp;all&nbsp;strings&nbsp;up&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560453">//&nbsp;index&nbsp;and&nbsp;index-1&nbsp;are&nbsp;already&nbsp;inserted.&nbsp;If&nbsp;there&nbsp;is&nbsp;not&nbsp;enough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560522">//&nbsp;lookahead,&nbsp;the&nbsp;last&nbsp;two&nbsp;strings&nbsp;are&nbsp;not&nbsp;inserted&nbsp;into&nbsp;the&nbsp;hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560591">//&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560604">if</span>&nbsp;<span class="ident" id="4560607"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560608">.</span><span class="ident" id="4560609">length</span>&nbsp;<span class="op" id="4560616">&lt;=</span>&nbsp;<span class="ident" id="4560619"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560620">.</span><span class="ident" id="4560621">fastSkipHashing</span>&nbsp;<span class="op" id="4560637">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560643">var</span>&nbsp;<span class="ident" id="4560647">newIndex</span>&nbsp;<span class="builtintype" id="4560656">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560664">if</span>&nbsp;<span class="ident" id="4560667"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560668">.</span><span class="ident" id="4560669">fastSkipHashing</span>&nbsp;<span class="op" id="4560685">!=</span>&nbsp;<span class="ident" id="4560688"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4560698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560705"><a href="/compress/flate/deflate.go.html#4560647">newIndex</a></span>&nbsp;<span class="op" id="4560714">=</span>&nbsp;<span class="ident" id="4560716"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560717">.</span><span class="ident" id="4560718">index</span>&nbsp;<span class="op" id="4560724">+</span>&nbsp;<span class="ident" id="4560726"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560727">.</span><span class="ident" id="4560728">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560739">}</span>&nbsp;<span class="keyword" id="4560741">else</span>&nbsp;<span class="op" id="4560746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560753"><a href="/compress/flate/deflate.go.html#4560647">newIndex</a></span>&nbsp;<span class="op" id="4560762">=</span>&nbsp;<span class="ident" id="4560764"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560765">.</span><span class="ident" id="4560766">index</span>&nbsp;<span class="op" id="4560772">+</span>&nbsp;<span class="ident" id="4560774"><a href="/compress/flate/deflate.go.html#4559274">prevLength</a></span>&nbsp;<span class="op" id="4560785">-</span>&nbsp;<span class="num" id="4560787">1</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560799">for</span>&nbsp;<span class="ident" id="4560803"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560804">.</span><span class="ident" id="4560805">index</span><span class="op" id="4560810">++</span><span class="op" id="4560812">;</span>&nbsp;<span class="ident" id="4560814"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560815">.</span><span class="ident" id="4560816">index</span>&nbsp;<span class="op" id="4560822">&lt;</span>&nbsp;<span class="ident" id="4560824"><a href="/compress/flate/deflate.go.html#4560647">newIndex</a></span><span class="op" id="4560832">;</span>&nbsp;<span class="ident" id="4560834"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560835">.</span><span class="ident" id="4560836">index</span><span class="op" id="4560841">++</span>&nbsp;<span class="op" id="4560844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560851">if</span>&nbsp;<span class="ident" id="4560854"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560855">.</span><span class="ident" id="4560856">index</span>&nbsp;<span class="op" id="4560862">&lt;</span>&nbsp;<span class="ident" id="4560864"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560865">.</span><span class="ident" id="4560866">maxInsertIndex</span>&nbsp;<span class="op" id="4560881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560889"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560890">.</span><span class="ident" id="4560891">hash</span>&nbsp;<span class="op" id="4560896">=</span>&nbsp;<span class="op" id="4560898">(</span><span class="ident" id="4560899"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560900">.</span><span class="ident" id="4560901">hash</span><span class="op" id="4560905">&lt;&lt;</span><span class="ident" id="4560907"><a href="/compress/flate/deflate.go.html#4553211">hashShift</a></span>&nbsp;<span class="op" id="4560917">+</span>&nbsp;<span class="builtintype" id="4560919">int</span><span class="op" id="4560922">(</span><span class="ident" id="4560923"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560924">.</span><span class="ident" id="4560925">window</span><span class="op" id="4560931">[</span><span class="ident" id="4560932"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4560933">.</span><span class="ident" id="4560934">index</span><span class="op" id="4560939">+</span><span class="num" id="4560940">2</span><span class="op" id="4560941">]</span><span class="op" id="4560942">)</span><span class="op" id="4560943">)</span>&nbsp;<span class="op" id="4560945">&amp;</span>&nbsp;<span class="ident" id="4560947"><a href="/compress/flate/deflate.go.html#4553168">hashMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560962">//&nbsp;Get&nbsp;previous&nbsp;value&nbsp;with&nbsp;the&nbsp;same&nbsp;hash.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561010">//&nbsp;Our&nbsp;chain&nbsp;should&nbsp;point&nbsp;to&nbsp;the&nbsp;previous&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561065"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561066">.</span><span class="ident" id="4561067">hashPrev</span><span class="op" id="4561075">[</span><span class="ident" id="4561076"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561077">.</span><span class="ident" id="4561078">index</span><span class="op" id="4561083">&amp;</span><span class="ident" id="4561084"><a href="/compress/flate/deflate.go.html#4552632">windowMask</a></span><span class="op" id="4561094">]</span>&nbsp;<span class="op" id="4561096">=</span>&nbsp;<span class="ident" id="4561098"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561099">.</span><span class="ident" id="4561100">hashHead</span><span class="op" id="4561108">[</span><span class="ident" id="4561109"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561110">.</span><span class="ident" id="4561111">hash</span><span class="op" id="4561115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561123">//&nbsp;Set&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;hash&nbsp;chain&nbsp;to&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561170"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561171">.</span><span class="ident" id="4561172">hashHead</span><span class="op" id="4561180">[</span><span class="ident" id="4561181"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561182">.</span><span class="ident" id="4561183">hash</span><span class="op" id="4561187">]</span>&nbsp;<span class="op" id="4561189">=</span>&nbsp;<span class="ident" id="4561191"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561192">.</span><span class="ident" id="4561193">index</span>&nbsp;<span class="op" id="4561199">+</span>&nbsp;<span class="ident" id="4561201"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561202">.</span><span class="ident" id="4561203">hashOffset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561219">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561231">if</span>&nbsp;<span class="ident" id="4561234"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561235">.</span><span class="ident" id="4561236">fastSkipHashing</span>&nbsp;<span class="op" id="4561252">==</span>&nbsp;<span class="ident" id="4561255"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4561265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561272"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561273">.</span><span class="ident" id="4561274">byteAvailable</span>&nbsp;<span class="op" id="4561288">=</span>&nbsp;<span class="ident" id="4561290">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561301"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561302">.</span><span class="ident" id="4561303">length</span>&nbsp;<span class="op" id="4561310">=</span>&nbsp;<span class="ident" id="4561312"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4561327">-</span>&nbsp;<span class="num" id="4561329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561335">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561340">}</span>&nbsp;<span class="keyword" id="4561342">else</span>&nbsp;<span class="op" id="4561347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561353">//&nbsp;For&nbsp;matches&nbsp;this&nbsp;long,&nbsp;we&nbsp;don&#39;t&nbsp;bother&nbsp;inserting&nbsp;each&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561425">//&nbsp;item&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561453"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561454">.</span><span class="ident" id="4561455">index</span>&nbsp;<span class="op" id="4561461">+=</span>&nbsp;<span class="ident" id="4561464"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561465">.</span><span class="ident" id="4561466">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561477">if</span>&nbsp;<span class="ident" id="4561480"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561481">.</span><span class="ident" id="4561482">index</span>&nbsp;<span class="op" id="4561488">&lt;</span>&nbsp;<span class="ident" id="4561490"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561491">.</span><span class="ident" id="4561492">maxInsertIndex</span>&nbsp;<span class="op" id="4561507">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561514"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561515">.</span><span class="ident" id="4561516">hash</span>&nbsp;<span class="op" id="4561521">=</span>&nbsp;<span class="op" id="4561523">(</span><span class="builtintype" id="4561524">int</span><span class="op" id="4561527">(</span><span class="ident" id="4561528"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561529">.</span><span class="ident" id="4561530">window</span><span class="op" id="4561536">[</span><span class="ident" id="4561537"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561538">.</span><span class="ident" id="4561539">index</span><span class="op" id="4561544">]</span><span class="op" id="4561545">)</span><span class="op" id="4561546">&lt;&lt;</span><span class="ident" id="4561548"><a href="/compress/flate/deflate.go.html#4553211">hashShift</a></span>&nbsp;<span class="op" id="4561558">+</span>&nbsp;<span class="builtintype" id="4561560">int</span><span class="op" id="4561563">(</span><span class="ident" id="4561564"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561565">.</span><span class="ident" id="4561566">window</span><span class="op" id="4561572">[</span><span class="ident" id="4561573"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561574">.</span><span class="ident" id="4561575">index</span><span class="op" id="4561580">+</span><span class="num" id="4561581">1</span><span class="op" id="4561582">]</span><span class="op" id="4561583">)</span><span class="op" id="4561584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561600">if</span>&nbsp;<span class="builtinfunc" id="4561603">len</span><span class="op" id="4561606">(</span><span class="ident" id="4561607"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561608">.</span><span class="ident" id="4561609">tokens</span><span class="op" id="4561615">)</span>&nbsp;<span class="op" id="4561617">==</span>&nbsp;<span class="ident" id="4561620"><a href="/compress/flate/deflate.go.html#4553045">maxFlateBlockTokens</a></span>&nbsp;<span class="op" id="4561640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561646">//&nbsp;The&nbsp;block&nbsp;includes&nbsp;the&nbsp;current&nbsp;character</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561694">if</span>&nbsp;<span class="ident" id="4561697"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561698">.</span><span class="ident" id="4561699">err</span>&nbsp;<span class="op" id="4561703">=</span>&nbsp;<span class="ident" id="4561705"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561706">.</span><span class="ident" id="4561707">writeBlock</span><span class="op" id="4561717">(</span><span class="ident" id="4561718"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561719">.</span><span class="ident" id="4561720">tokens</span><span class="op" id="4561726">,</span>&nbsp;<span class="ident" id="4561728"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561729">.</span><span class="ident" id="4561730">index</span><span class="op" id="4561735">,</span>&nbsp;<span class="ident" id="4561737">false</span><span class="op" id="4561742">)</span><span class="op" id="4561743">;</span>&nbsp;<span class="ident" id="4561745"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561746">.</span><span class="ident" id="4561747">err</span>&nbsp;<span class="op" id="4561751">!=</span>&nbsp;<span class="ident" id="4561754">nil</span>&nbsp;<span class="op" id="4561758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561765">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561782"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561783">.</span><span class="ident" id="4561784">tokens</span>&nbsp;<span class="op" id="4561791">=</span>&nbsp;<span class="ident" id="4561793"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561794">.</span><span class="ident" id="4561795">tokens</span><span class="op" id="4561801">[</span><span class="op" id="4561802">:</span><span class="num" id="4561803">0</span><span class="op" id="4561804">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561809">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561813">}</span>&nbsp;<span class="keyword" id="4561815">else</span>&nbsp;<span class="op" id="4561820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561825">if</span>&nbsp;<span class="ident" id="4561828"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561829">.</span><span class="ident" id="4561830">fastSkipHashing</span>&nbsp;<span class="op" id="4561846">!=</span>&nbsp;<span class="ident" id="4561849"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4561859">||</span>&nbsp;<span class="ident" id="4561862"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561863">.</span><span class="ident" id="4561864">byteAvailable</span>&nbsp;<span class="op" id="4561878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561884">i</span>&nbsp;<span class="op" id="4561886">:=</span>&nbsp;<span class="ident" id="4561889"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561890">.</span><span class="ident" id="4561891">index</span>&nbsp;<span class="op" id="4561897">-</span>&nbsp;<span class="num" id="4561899">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561905">if</span>&nbsp;<span class="ident" id="4561908"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561909">.</span><span class="ident" id="4561910">fastSkipHashing</span>&nbsp;<span class="op" id="4561926">!=</span>&nbsp;<span class="ident" id="4561929"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4561939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561946"><a href="/compress/flate/deflate.go.html#4561884">i</a></span>&nbsp;<span class="op" id="4561948">=</span>&nbsp;<span class="ident" id="4561950"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561951">.</span><span class="ident" id="4561952">index</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561968"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561969">.</span><span class="ident" id="4561970">tokens</span>&nbsp;<span class="op" id="4561977">=</span>&nbsp;<span class="builtinfunc" id="4561979">append</span><span class="op" id="4561985">(</span><span class="ident" id="4561986"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4561987">.</span><span class="ident" id="4561988">tokens</span><span class="op" id="4561994">,</span>&nbsp;<span class="ident" id="4561996"><a href="/compress/flate/token.go.html#4616367">literalToken</a></span><span class="op" id="4562008">(</span><span class="builtintype" id="4562009">uint32</span><span class="op" id="4562015">(</span><span class="ident" id="4562016"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562017">.</span><span class="ident" id="4562018">window</span><span class="op" id="4562024">[</span><span class="ident" id="4562025"><a href="/compress/flate/deflate.go.html#4561884">i</a></span><span class="op" id="4562026">]</span><span class="op" id="4562027">)</span><span class="op" id="4562028">)</span><span class="op" id="4562029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562035">if</span>&nbsp;<span class="builtinfunc" id="4562038">len</span><span class="op" id="4562041">(</span><span class="ident" id="4562042"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562043">.</span><span class="ident" id="4562044">tokens</span><span class="op" id="4562050">)</span>&nbsp;<span class="op" id="4562052">==</span>&nbsp;<span class="ident" id="4562055"><a href="/compress/flate/deflate.go.html#4553045">maxFlateBlockTokens</a></span>&nbsp;<span class="op" id="4562075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562082">if</span>&nbsp;<span class="ident" id="4562085"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562086">.</span><span class="ident" id="4562087">err</span>&nbsp;<span class="op" id="4562091">=</span>&nbsp;<span class="ident" id="4562093"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562094">.</span><span class="ident" id="4562095">writeBlock</span><span class="op" id="4562105">(</span><span class="ident" id="4562106"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562107">.</span><span class="ident" id="4562108">tokens</span><span class="op" id="4562114">,</span>&nbsp;<span class="ident" id="4562116"><a href="/compress/flate/deflate.go.html#4561884">i</a></span><span class="op" id="4562117">+</span><span class="num" id="4562118">1</span><span class="op" id="4562119">,</span>&nbsp;<span class="ident" id="4562121">false</span><span class="op" id="4562126">)</span><span class="op" id="4562127">;</span>&nbsp;<span class="ident" id="4562129"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562130">.</span><span class="ident" id="4562131">err</span>&nbsp;<span class="op" id="4562135">!=</span>&nbsp;<span class="ident" id="4562138">nil</span>&nbsp;<span class="op" id="4562142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562150">return</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562169"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562170">.</span><span class="ident" id="4562171">tokens</span>&nbsp;<span class="op" id="4562178">=</span>&nbsp;<span class="ident" id="4562180"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562181">.</span><span class="ident" id="4562182">tokens</span><span class="op" id="4562188">[</span><span class="op" id="4562189">:</span><span class="num" id="4562190">0</span><span class="op" id="4562191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562207"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562208">.</span><span class="ident" id="4562209">index</span><span class="op" id="4562214">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562220">if</span>&nbsp;<span class="ident" id="4562223"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562224">.</span><span class="ident" id="4562225">fastSkipHashing</span>&nbsp;<span class="op" id="4562241">==</span>&nbsp;<span class="ident" id="4562244"><a href="/compress/flate/deflate.go.html#4553315">skipNever</a></span>&nbsp;<span class="op" id="4562254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562260"><a href="/compress/flate/deflate.go.html#4558030">d</a></span><span class="op" id="4562261">.</span><span class="ident" id="4562262">byteAvailable</span>&nbsp;<span class="op" id="4562276">=</span>&nbsp;<span class="ident" id="4562278">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562293">}</span><br>
<span class="lineno">360</span><span class="op" id="4562295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4562298">func</span>&nbsp;<span class="op" id="4562303">(</span><span class="ident" id="4562304">d</span>&nbsp;<span class="op" id="4562306">*</span><span class="ident" id="4562307"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4562317">)</span>&nbsp;<span class="ident" id="4562319">fillStore</span><span class="op" id="4562328">(</span><span class="ident" id="4562329">b</span>&nbsp;<span class="op" id="4562331">[</span><span class="op" id="4562332">]</span><span class="builtintype" id="4562333">byte</span><span class="op" id="4562337">)</span>&nbsp;<span class="builtintype" id="4562339">int</span>&nbsp;<span class="op" id="4562343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562346">n</span>&nbsp;<span class="op" id="4562348">:=</span>&nbsp;<span class="builtinfunc" id="4562351">copy</span><span class="op" id="4562355">(</span><span class="ident" id="4562356"><a href="/compress/flate/deflate.go.html#4562304">d</a></span><span class="op" id="4562357">.</span><span class="ident" id="4562358">window</span><span class="op" id="4562364">[</span><span class="ident" id="4562365"><a href="/compress/flate/deflate.go.html#4562304">d</a></span><span class="op" id="4562366">.</span><span class="ident" id="4562367">windowEnd</span><span class="op" id="4562376">:</span><span class="op" id="4562377">]</span><span class="op" id="4562378">,</span>&nbsp;<span class="ident" id="4562380"><a href="/compress/flate/deflate.go.html#4562329">b</a></span><span class="op" id="4562381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562384"><a href="/compress/flate/deflate.go.html#4562304">d</a></span><span class="op" id="4562385">.</span><span class="ident" id="4562386">windowEnd</span>&nbsp;<span class="op" id="4562396">+=</span>&nbsp;<span class="ident" id="4562399"><a href="/compress/flate/deflate.go.html#4562346">n</a></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562402">return</span>&nbsp;<span class="ident" id="4562409"><a href="/compress/flate/deflate.go.html#4562346">n</a></span><br>
<span class="lineno"></span><span class="op" id="4562411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4562414">func</span>&nbsp;<span class="op" id="4562419">(</span><span class="ident" id="4562420">d</span>&nbsp;<span class="op" id="4562422">*</span><span class="ident" id="4562423"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4562433">)</span>&nbsp;<span class="ident" id="4562435">store</span><span class="op" id="4562440">(</span><span class="op" id="4562441">)</span>&nbsp;<span class="op" id="4562443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562446">if</span>&nbsp;<span class="ident" id="4562449"><a href="/compress/flate/deflate.go.html#4562420">d</a></span><span class="op" id="4562450">.</span><span class="ident" id="4562451">windowEnd</span>&nbsp;<span class="op" id="4562461">&gt;</span>&nbsp;<span class="num" id="4562463">0</span>&nbsp;<span class="op" id="4562465">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562469"><a href="/compress/flate/deflate.go.html#4562420">d</a></span><span class="op" id="4562470">.</span><span class="ident" id="4562471">err</span>&nbsp;<span class="op" id="4562475">=</span>&nbsp;<span class="ident" id="4562477"><a href="/compress/flate/deflate.go.html#4562420">d</a></span><span class="op" id="4562478">.</span><span class="ident" id="4562479">writeStoredBlock</span><span class="op" id="4562495">(</span><span class="ident" id="4562496"><a href="/compress/flate/deflate.go.html#4562420">d</a></span><span class="op" id="4562497">.</span><span class="ident" id="4562498">window</span><span class="op" id="4562504">[</span><span class="op" id="4562505">:</span><span class="ident" id="4562506"><a href="/compress/flate/deflate.go.html#4562420">d</a></span><span class="op" id="4562507">.</span><span class="ident" id="4562508">windowEnd</span><span class="op" id="4562517">]</span><span class="op" id="4562518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562524"><a href="/compress/flate/deflate.go.html#4562420">d</a></span><span class="op" id="4562525">.</span><span class="ident" id="4562526">windowEnd</span>&nbsp;<span class="op" id="4562536">=</span>&nbsp;<span class="num" id="4562538">0</span><br>
<span class="lineno"></span><span class="op" id="4562540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="keyword" id="4562543">func</span>&nbsp;<span class="op" id="4562548">(</span><span class="ident" id="4562549">d</span>&nbsp;<span class="op" id="4562551">*</span><span class="ident" id="4562552"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4562562">)</span>&nbsp;<span class="ident" id="4562564">write</span><span class="op" id="4562569">(</span><span class="ident" id="4562570">b</span>&nbsp;<span class="op" id="4562572">[</span><span class="op" id="4562573">]</span><span class="builtintype" id="4562574">byte</span><span class="op" id="4562578">)</span>&nbsp;<span class="op" id="4562580">(</span><span class="ident" id="4562581">n</span>&nbsp;<span class="builtintype" id="4562583">int</span><span class="op" id="4562586">,</span>&nbsp;<span class="ident" id="4562588">err</span>&nbsp;<span class="builtintype" id="4562592">error</span><span class="op" id="4562597">)</span>&nbsp;<span class="op" id="4562599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562602"><a href="/compress/flate/deflate.go.html#4562581">n</a></span>&nbsp;<span class="op" id="4562604">=</span>&nbsp;<span class="builtinfunc" id="4562606">len</span><span class="op" id="4562609">(</span><span class="ident" id="4562610"><a href="/compress/flate/deflate.go.html#4562570">b</a></span><span class="op" id="4562611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562614"><a href="/compress/flate/deflate.go.html#4562570">b</a></span>&nbsp;<span class="op" id="4562616">=</span>&nbsp;<span class="ident" id="4562618"><a href="/compress/flate/deflate.go.html#4562570">b</a></span><span class="op" id="4562619">[</span><span class="ident" id="4562620"><a href="/compress/flate/deflate.go.html#4562549">d</a></span><span class="op" id="4562621">.</span><span class="ident" id="4562622">fill</span><span class="op" id="4562626">(</span><span class="ident" id="4562627"><a href="/compress/flate/deflate.go.html#4562549">d</a></span><span class="op" id="4562628">,</span>&nbsp;<span class="ident" id="4562630"><a href="/compress/flate/deflate.go.html#4562570">b</a></span><span class="op" id="4562631">)</span><span class="op" id="4562632">:</span><span class="op" id="4562633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562636">for</span>&nbsp;<span class="builtinfunc" id="4562640">len</span><span class="op" id="4562643">(</span><span class="ident" id="4562644"><a href="/compress/flate/deflate.go.html#4562570">b</a></span><span class="op" id="4562645">)</span>&nbsp;<span class="op" id="4562647">&gt;</span>&nbsp;<span class="num" id="4562649">0</span>&nbsp;<span class="op" id="4562651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562655"><a href="/compress/flate/deflate.go.html#4562549">d</a></span><span class="op" id="4562656">.</span><span class="ident" id="4562657">step</span><span class="op" id="4562661">(</span><span class="ident" id="4562662"><a href="/compress/flate/deflate.go.html#4562549">d</a></span><span class="op" id="4562663">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562667"><a href="/compress/flate/deflate.go.html#4562570">b</a></span>&nbsp;<span class="op" id="4562669">=</span>&nbsp;<span class="ident" id="4562671"><a href="/compress/flate/deflate.go.html#4562570">b</a></span><span class="op" id="4562672">[</span><span class="ident" id="4562673"><a href="/compress/flate/deflate.go.html#4562549">d</a></span><span class="op" id="4562674">.</span><span class="ident" id="4562675">fill</span><span class="op" id="4562679">(</span><span class="ident" id="4562680"><a href="/compress/flate/deflate.go.html#4562549">d</a></span><span class="op" id="4562681">,</span>&nbsp;<span class="ident" id="4562683"><a href="/compress/flate/deflate.go.html#4562570">b</a></span><span class="op" id="4562684">)</span><span class="op" id="4562685">:</span><span class="op" id="4562686">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562692">return</span>&nbsp;<span class="ident" id="4562699"><a href="/compress/flate/deflate.go.html#4562581">n</a></span><span class="op" id="4562700">,</span>&nbsp;<span class="ident" id="4562702"><a href="/compress/flate/deflate.go.html#4562549">d</a></span><span class="op" id="4562703">.</span><span class="ident" id="4562704">err</span><br>
<span class="lineno"></span><span class="op" id="4562708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4562711">func</span>&nbsp;<span class="op" id="4562716">(</span><span class="ident" id="4562717">d</span>&nbsp;<span class="op" id="4562719">*</span><span class="ident" id="4562720"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4562730">)</span>&nbsp;<span class="ident" id="4562732">syncFlush</span><span class="op" id="4562741">(</span><span class="op" id="4562742">)</span>&nbsp;<span class="builtintype" id="4562744">error</span>&nbsp;<span class="op" id="4562750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562753"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562754">.</span><span class="ident" id="4562755">sync</span>&nbsp;<span class="op" id="4562760">=</span>&nbsp;<span class="ident" id="4562762">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562768"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562769">.</span><span class="ident" id="4562770">step</span><span class="op" id="4562774">(</span><span class="ident" id="4562775"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562779">if</span>&nbsp;<span class="ident" id="4562782"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562783">.</span><span class="ident" id="4562784">err</span>&nbsp;<span class="op" id="4562788">==</span>&nbsp;<span class="ident" id="4562791">nil</span>&nbsp;<span class="op" id="4562795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562799"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562800">.</span><span class="ident" id="4562801">w</span><span class="op" id="4562802">.</span><span class="ident" id="4562803">writeStoredHeader</span><span class="op" id="4562820">(</span><span class="num" id="4562821">0</span><span class="op" id="4562822">,</span>&nbsp;<span class="ident" id="4562824">false</span><span class="op" id="4562829">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562833"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562834">.</span><span class="ident" id="4562835">w</span><span class="op" id="4562836">.</span><span class="ident" id="4562837">flush</span><span class="op" id="4562842">(</span><span class="op" id="4562843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562847"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562848">.</span><span class="ident" id="4562849">err</span>&nbsp;<span class="op" id="4562853">=</span>&nbsp;<span class="ident" id="4562855"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562856">.</span><span class="ident" id="4562857">w</span><span class="op" id="4562858">.</span><span class="ident" id="4562859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562867"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562868">.</span><span class="ident" id="4562869">sync</span>&nbsp;<span class="op" id="4562874">=</span>&nbsp;<span class="ident" id="4562876">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562883">return</span>&nbsp;<span class="ident" id="4562890"><a href="/compress/flate/deflate.go.html#4562717">d</a></span><span class="op" id="4562891">.</span><span class="ident" id="4562892">err</span><br>
<span class="lineno">395</span><span class="op" id="4562896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4562899">func</span>&nbsp;<span class="op" id="4562904">(</span><span class="ident" id="4562905">d</span>&nbsp;<span class="op" id="4562907">*</span><span class="ident" id="4562908"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4562918">)</span>&nbsp;<span class="ident" id="4562920">init</span><span class="op" id="4562924">(</span><span class="ident" id="4562925">w</span>&nbsp;<span class="ident" id="4562927"><a href="/compress/flate/deflate.go.html#4552420">io</a></span><span class="op" id="4562929">.</span><span class="ident" id="4562930">Writer</span><span class="op" id="4562936">,</span>&nbsp;<span class="ident" id="4562938">level</span>&nbsp;<span class="builtintype" id="4562944">int</span><span class="op" id="4562947">)</span>&nbsp;<span class="op" id="4562949">(</span><span class="ident" id="4562950">err</span>&nbsp;<span class="builtintype" id="4562954">error</span><span class="op" id="4562959">)</span>&nbsp;<span class="op" id="4562961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562964"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4562965">.</span><span class="ident" id="4562966">w</span>&nbsp;<span class="op" id="4562968">=</span>&nbsp;<span class="ident" id="4562970"><a href="/compress/flate/huffman_bit_writer.go.html#4574385">newHuffmanBitWriter</a></span><span class="op" id="4562989">(</span><span class="ident" id="4562990"><a href="/compress/flate/deflate.go.html#4562925">w</a></span><span class="op" id="4562991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562995">switch</span>&nbsp;<span class="op" id="4563002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563005">case</span>&nbsp;<span class="ident" id="4563010"><a href="/compress/flate/deflate.go.html#4562938">level</a></span>&nbsp;<span class="op" id="4563016">==</span>&nbsp;<span class="ident" id="4563019"><a href="/compress/flate/deflate.go.html#4552445">NoCompression</a></span><span class="op" id="4563032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563036"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4563037">.</span><span class="ident" id="4563038">window</span>&nbsp;<span class="op" id="4563045">=</span>&nbsp;<span class="builtinfunc" id="4563047">make</span><span class="op" id="4563051">(</span><span class="op" id="4563052">[</span><span class="op" id="4563053">]</span><span class="builtintype" id="4563054">byte</span><span class="op" id="4563058">,</span>&nbsp;<span class="ident" id="4563060"><a href="/compress/flate/deflate.go.html#4553076">maxStoreBlockSize</a></span><span class="op" id="4563077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563081"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4563082">.</span><span class="ident" id="4563083">fill</span>&nbsp;<span class="op" id="4563088">=</span>&nbsp;<span class="op" id="4563090">(</span><span class="op" id="4563091">*</span><span class="ident" id="4563092"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4563102">)</span><span class="op" id="4563103">.</span><span class="ident" id="4563104">fillStore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563116"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4563117">.</span><span class="ident" id="4563118">step</span>&nbsp;<span class="op" id="4563123">=</span>&nbsp;<span class="op" id="4563125">(</span><span class="op" id="4563126">*</span><span class="ident" id="4563127"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4563137">)</span><span class="op" id="4563138">.</span><span class="ident" id="4563139">store</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563146">case</span>&nbsp;<span class="ident" id="4563151"><a href="/compress/flate/deflate.go.html#4562938">level</a></span>&nbsp;<span class="op" id="4563157">==</span>&nbsp;<span class="ident" id="4563160"><a href="/compress/flate/deflate.go.html#4552541">DefaultCompression</a></span><span class="op" id="4563178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563182"><a href="/compress/flate/deflate.go.html#4562938">level</a></span>&nbsp;<span class="op" id="4563188">=</span>&nbsp;<span class="num" id="4563190">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563194">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563207">case</span>&nbsp;<span class="num" id="4563212">1</span>&nbsp;<span class="op" id="4563214">&lt;=</span>&nbsp;<span class="ident" id="4563217"><a href="/compress/flate/deflate.go.html#4562938">level</a></span>&nbsp;<span class="op" id="4563223">&amp;&amp;</span>&nbsp;<span class="ident" id="4563226"><a href="/compress/flate/deflate.go.html#4562938">level</a></span>&nbsp;<span class="op" id="4563232">&lt;=</span>&nbsp;<span class="num" id="4563235">9</span><span class="op" id="4563236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563240"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4563241">.</span><span class="ident" id="4563242">compressionLevel</span>&nbsp;<span class="op" id="4563259">=</span>&nbsp;<span class="ident" id="4563261"><a href="/compress/flate/deflate.go.html#4553428">levels</a></span><span class="op" id="4563267">[</span><span class="ident" id="4563268"><a href="/compress/flate/deflate.go.html#4562938">level</a></span><span class="op" id="4563273">]</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563277"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4563278">.</span><span class="ident" id="4563279">initDeflate</span><span class="op" id="4563290">(</span><span class="op" id="4563291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563295"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4563296">.</span><span class="ident" id="4563297">fill</span>&nbsp;<span class="op" id="4563302">=</span>&nbsp;<span class="op" id="4563304">(</span><span class="op" id="4563305">*</span><span class="ident" id="4563306"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4563316">)</span><span class="op" id="4563317">.</span><span class="ident" id="4563318">fillDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563332"><a href="/compress/flate/deflate.go.html#4562905">d</a></span><span class="op" id="4563333">.</span><span class="ident" id="4563334">step</span>&nbsp;<span class="op" id="4563339">=</span>&nbsp;<span class="op" id="4563341">(</span><span class="op" id="4563342">*</span><span class="ident" id="4563343"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4563353">)</span><span class="op" id="4563354">.</span><span class="ident" id="4563355">deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563364">default</span><span class="op" id="4563371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563375">return</span>&nbsp;<span class="ident" id="4563382"><a href="/compress/flate/deflate.go.html#4552413">fmt</a></span><span class="op" id="4563385">.</span><span class="ident" id="4563386">Errorf</span><span class="op" id="4563392">(</span><span class="string" id="4563393">&#34;flate:&nbsp;invalid&nbsp;compression&nbsp;level&nbsp;%d:&nbsp;want&nbsp;value&nbsp;in&nbsp;range&nbsp;[-1,&nbsp;9]&#34;</span><span class="op" id="4563459">,</span>&nbsp;<span class="ident" id="4563461"><a href="/compress/flate/deflate.go.html#4562938">level</a></span><span class="op" id="4563466">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563472">return</span>&nbsp;<span class="ident" id="4563479">nil</span><br>
<span class="lineno"></span><span class="op" id="4563483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4563486">var</span>&nbsp;<span class="ident" id="4563490">zeroes</span>&nbsp;<span class="op" id="4563497">[</span><span class="num" id="4563498">32</span><span class="op" id="4563500">]</span><span class="builtintype" id="4563501">int</span><br>
<span class="lineno">420</span><span class="keyword" id="4563505">var</span>&nbsp;<span class="ident" id="4563509">bzeroes</span>&nbsp;<span class="op" id="4563517">[</span><span class="num" id="4563518">256</span><span class="op" id="4563521">]</span><span class="builtintype" id="4563522">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4563528">func</span>&nbsp;<span class="op" id="4563533">(</span><span class="ident" id="4563534">d</span>&nbsp;<span class="op" id="4563536">*</span><span class="ident" id="4563537"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4563547">)</span>&nbsp;<span class="ident" id="4563549">reset</span><span class="op" id="4563554">(</span><span class="ident" id="4563555">w</span>&nbsp;<span class="ident" id="4563557"><a href="/compress/flate/deflate.go.html#4552420">io</a></span><span class="op" id="4563559">.</span><span class="ident" id="4563560">Writer</span><span class="op" id="4563566">)</span>&nbsp;<span class="op" id="4563568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563571"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563572">.</span><span class="ident" id="4563573">w</span><span class="op" id="4563574">.</span><span class="ident" id="4563575">reset</span><span class="op" id="4563580">(</span><span class="ident" id="4563581"><a href="/compress/flate/deflate.go.html#4563555">w</a></span><span class="op" id="4563582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563585"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563586">.</span><span class="ident" id="4563587">sync</span>&nbsp;<span class="op" id="4563592">=</span>&nbsp;<span class="ident" id="4563594">false</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563601"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563602">.</span><span class="ident" id="4563603">err</span>&nbsp;<span class="op" id="4563607">=</span>&nbsp;<span class="ident" id="4563609">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563614">switch</span>&nbsp;<span class="ident" id="4563621"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563622">.</span><span class="ident" id="4563623">compressionLevel</span><span class="op" id="4563639">.</span><span class="ident" id="4563640">chain</span>&nbsp;<span class="op" id="4563646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563649">case</span>&nbsp;<span class="num" id="4563654">0</span><span class="op" id="4563655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563659">//&nbsp;level&nbsp;was&nbsp;NoCompression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563689">for</span>&nbsp;<span class="ident" id="4563693">i</span>&nbsp;<span class="op" id="4563695">:=</span>&nbsp;<span class="keyword" id="4563698">range</span>&nbsp;<span class="ident" id="4563704"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563705">.</span><span class="ident" id="4563706">window</span>&nbsp;<span class="op" id="4563713">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563718"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563719">.</span><span class="ident" id="4563720">window</span><span class="op" id="4563726">[</span><span class="ident" id="4563727"><a href="/compress/flate/deflate.go.html#4563693">i</a></span><span class="op" id="4563728">]</span>&nbsp;<span class="op" id="4563730">=</span>&nbsp;<span class="num" id="4563732">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563740"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563741">.</span><span class="ident" id="4563742">windowEnd</span>&nbsp;<span class="op" id="4563752">=</span>&nbsp;<span class="num" id="4563754">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563757">default</span><span class="op" id="4563764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563768"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563769">.</span><span class="ident" id="4563770">chainHead</span>&nbsp;<span class="op" id="4563780">=</span>&nbsp;<span class="op" id="4563782">-</span><span class="num" id="4563783">1</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563787">for</span>&nbsp;<span class="ident" id="4563791">s</span>&nbsp;<span class="op" id="4563793">:=</span>&nbsp;<span class="ident" id="4563796"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563797">.</span><span class="ident" id="4563798">hashHead</span><span class="op" id="4563806">;</span>&nbsp;<span class="builtinfunc" id="4563808">len</span><span class="op" id="4563811">(</span><span class="ident" id="4563812"><a href="/compress/flate/deflate.go.html#4563791">s</a></span><span class="op" id="4563813">)</span>&nbsp;<span class="op" id="4563815">&gt;</span>&nbsp;<span class="num" id="4563817">0</span><span class="op" id="4563818">;</span>&nbsp;<span class="op" id="4563820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563825">n</span>&nbsp;<span class="op" id="4563827">:=</span>&nbsp;<span class="builtinfunc" id="4563830">copy</span><span class="op" id="4563834">(</span><span class="ident" id="4563835"><a href="/compress/flate/deflate.go.html#4563791">s</a></span><span class="op" id="4563836">,</span>&nbsp;<span class="ident" id="4563838"><a href="/compress/flate/deflate.go.html#4563490">zeroes</a></span><span class="op" id="4563844">[</span><span class="op" id="4563845">:</span><span class="op" id="4563846">]</span><span class="op" id="4563847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563852"><a href="/compress/flate/deflate.go.html#4563791">s</a></span>&nbsp;<span class="op" id="4563854">=</span>&nbsp;<span class="ident" id="4563856"><a href="/compress/flate/deflate.go.html#4563791">s</a></span><span class="op" id="4563857">[</span><span class="ident" id="4563858"><a href="/compress/flate/deflate.go.html#4563825">n</a></span><span class="op" id="4563859">:</span><span class="op" id="4563860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563868">for</span>&nbsp;<span class="ident" id="4563872">s</span>&nbsp;<span class="op" id="4563874">:=</span>&nbsp;<span class="ident" id="4563877"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563878">.</span><span class="ident" id="4563879">hashPrev</span><span class="op" id="4563887">;</span>&nbsp;<span class="builtinfunc" id="4563889">len</span><span class="op" id="4563892">(</span><span class="ident" id="4563893"><a href="/compress/flate/deflate.go.html#4563872">s</a></span><span class="op" id="4563894">)</span>&nbsp;<span class="op" id="4563896">&gt;</span>&nbsp;<span class="num" id="4563898">0</span><span class="op" id="4563899">;</span>&nbsp;<span class="ident" id="4563901"><a href="/compress/flate/deflate.go.html#4563872">s</a></span>&nbsp;<span class="op" id="4563903">=</span>&nbsp;<span class="ident" id="4563905"><a href="/compress/flate/deflate.go.html#4563872">s</a></span><span class="op" id="4563906">[</span><span class="builtinfunc" id="4563907">len</span><span class="op" id="4563910">(</span><span class="ident" id="4563911"><a href="/compress/flate/deflate.go.html#4563490">zeroes</a></span><span class="op" id="4563917">)</span><span class="op" id="4563918">:</span><span class="op" id="4563919">]</span>&nbsp;<span class="op" id="4563921">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4563926">copy</span><span class="op" id="4563930">(</span><span class="ident" id="4563931"><a href="/compress/flate/deflate.go.html#4563872">s</a></span><span class="op" id="4563932">,</span>&nbsp;<span class="ident" id="4563934"><a href="/compress/flate/deflate.go.html#4563490">zeroes</a></span><span class="op" id="4563940">[</span><span class="op" id="4563941">:</span><span class="op" id="4563942">]</span><span class="op" id="4563943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563951"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563952">.</span><span class="ident" id="4563953">hashOffset</span>&nbsp;<span class="op" id="4563964">=</span>&nbsp;<span class="num" id="4563966">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563971"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563972">.</span><span class="ident" id="4563973">index</span><span class="op" id="4563978">,</span>&nbsp;<span class="ident" id="4563980"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4563981">.</span><span class="ident" id="4563982">windowEnd</span>&nbsp;<span class="op" id="4563992">=</span>&nbsp;<span class="num" id="4563994">0</span><span class="op" id="4563995">,</span>&nbsp;<span class="num" id="4563997">0</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564001">for</span>&nbsp;<span class="ident" id="4564005">s</span>&nbsp;<span class="op" id="4564007">:=</span>&nbsp;<span class="ident" id="4564010"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564011">.</span><span class="ident" id="4564012">window</span><span class="op" id="4564018">;</span>&nbsp;<span class="builtinfunc" id="4564020">len</span><span class="op" id="4564023">(</span><span class="ident" id="4564024"><a href="/compress/flate/deflate.go.html#4564005">s</a></span><span class="op" id="4564025">)</span>&nbsp;<span class="op" id="4564027">&gt;</span>&nbsp;<span class="num" id="4564029">0</span><span class="op" id="4564030">;</span>&nbsp;<span class="op" id="4564032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564037">n</span>&nbsp;<span class="op" id="4564039">:=</span>&nbsp;<span class="builtinfunc" id="4564042">copy</span><span class="op" id="4564046">(</span><span class="ident" id="4564047"><a href="/compress/flate/deflate.go.html#4564005">s</a></span><span class="op" id="4564048">,</span>&nbsp;<span class="ident" id="4564050"><a href="/compress/flate/deflate.go.html#4563509">bzeroes</a></span><span class="op" id="4564057">[</span><span class="op" id="4564058">:</span><span class="op" id="4564059">]</span><span class="op" id="4564060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564065"><a href="/compress/flate/deflate.go.html#4564005">s</a></span>&nbsp;<span class="op" id="4564067">=</span>&nbsp;<span class="ident" id="4564069"><a href="/compress/flate/deflate.go.html#4564005">s</a></span><span class="op" id="4564070">[</span><span class="ident" id="4564071"><a href="/compress/flate/deflate.go.html#4564037">n</a></span><span class="op" id="4564072">:</span><span class="op" id="4564073">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564081"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564082">.</span><span class="ident" id="4564083">blockStart</span><span class="op" id="4564093">,</span>&nbsp;<span class="ident" id="4564095"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564096">.</span><span class="ident" id="4564097">byteAvailable</span>&nbsp;<span class="op" id="4564111">=</span>&nbsp;<span class="num" id="4564113">0</span><span class="op" id="4564114">,</span>&nbsp;<span class="ident" id="4564116">false</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564125"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564126">.</span><span class="ident" id="4564127">tokens</span>&nbsp;<span class="op" id="4564134">=</span>&nbsp;<span class="ident" id="4564136"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564137">.</span><span class="ident" id="4564138">tokens</span><span class="op" id="4564144">[</span><span class="op" id="4564145">:</span><span class="ident" id="4564146"><a href="/compress/flate/deflate.go.html#4553045">maxFlateBlockTokens</a></span><span class="op" id="4564165">+</span><span class="num" id="4564166">1</span><span class="op" id="4564167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564171">for</span>&nbsp;<span class="ident" id="4564175">i</span>&nbsp;<span class="op" id="4564177">:=</span>&nbsp;<span class="num" id="4564180">0</span><span class="op" id="4564181">;</span>&nbsp;<span class="ident" id="4564183"><a href="/compress/flate/deflate.go.html#4564175">i</a></span>&nbsp;<span class="op" id="4564185">&lt;=</span>&nbsp;<span class="ident" id="4564188"><a href="/compress/flate/deflate.go.html#4553045">maxFlateBlockTokens</a></span><span class="op" id="4564207">;</span>&nbsp;<span class="ident" id="4564209"><a href="/compress/flate/deflate.go.html#4564175">i</a></span><span class="op" id="4564210">++</span>&nbsp;<span class="op" id="4564213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564218"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564219">.</span><span class="ident" id="4564220">tokens</span><span class="op" id="4564226">[</span><span class="ident" id="4564227"><a href="/compress/flate/deflate.go.html#4564175">i</a></span><span class="op" id="4564228">]</span>&nbsp;<span class="op" id="4564230">=</span>&nbsp;<span class="num" id="4564232">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564236">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564240"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564241">.</span><span class="ident" id="4564242">tokens</span>&nbsp;<span class="op" id="4564249">=</span>&nbsp;<span class="ident" id="4564251"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564252">.</span><span class="ident" id="4564253">tokens</span><span class="op" id="4564259">[</span><span class="op" id="4564260">:</span><span class="num" id="4564261">0</span><span class="op" id="4564262">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564266"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564267">.</span><span class="ident" id="4564268">length</span>&nbsp;<span class="op" id="4564275">=</span>&nbsp;<span class="ident" id="4564277"><a href="/compress/flate/deflate.go.html#4552715">minMatchLength</a></span>&nbsp;<span class="op" id="4564292">-</span>&nbsp;<span class="num" id="4564294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564298"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564299">.</span><span class="ident" id="4564300">offset</span>&nbsp;<span class="op" id="4564307">=</span>&nbsp;<span class="num" id="4564309">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564313"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564314">.</span><span class="ident" id="4564315">hash</span>&nbsp;<span class="op" id="4564320">=</span>&nbsp;<span class="num" id="4564322">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564326"><a href="/compress/flate/deflate.go.html#4563534">d</a></span><span class="op" id="4564327">.</span><span class="ident" id="4564328">maxInsertIndex</span>&nbsp;<span class="op" id="4564343">=</span>&nbsp;<span class="num" id="4564345">0</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564348">}</span><br>
<span class="lineno"></span><span class="op" id="4564350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4564353">func</span>&nbsp;<span class="op" id="4564358">(</span><span class="ident" id="4564359">d</span>&nbsp;<span class="op" id="4564361">*</span><span class="ident" id="4564362"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><span class="op" id="4564372">)</span>&nbsp;<span class="builtinfunc" id="4564374">close</span><span class="op" id="4564379">(</span><span class="op" id="4564380">)</span>&nbsp;<span class="builtintype" id="4564382">error</span>&nbsp;<span class="op" id="4564388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564391"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564392">.</span><span class="ident" id="4564393">sync</span>&nbsp;<span class="op" id="4564398">=</span>&nbsp;<span class="ident" id="4564400">true</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564406"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564407">.</span><span class="ident" id="4564408">step</span><span class="op" id="4564412">(</span><span class="ident" id="4564413"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564417">if</span>&nbsp;<span class="ident" id="4564420"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564421">.</span><span class="ident" id="4564422">err</span>&nbsp;<span class="op" id="4564426">!=</span>&nbsp;<span class="ident" id="4564429">nil</span>&nbsp;<span class="op" id="4564433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564437">return</span>&nbsp;<span class="ident" id="4564444"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564445">.</span><span class="ident" id="4564446">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564454">if</span>&nbsp;<span class="ident" id="4564457"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564458">.</span><span class="ident" id="4564459">w</span><span class="op" id="4564460">.</span><span class="ident" id="4564461">writeStoredHeader</span><span class="op" id="4564478">(</span><span class="num" id="4564479">0</span><span class="op" id="4564480">,</span>&nbsp;<span class="ident" id="4564482">true</span><span class="op" id="4564486">)</span><span class="op" id="4564487">;</span>&nbsp;<span class="ident" id="4564489"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564490">.</span><span class="ident" id="4564491">w</span><span class="op" id="4564492">.</span><span class="ident" id="4564493">err</span>&nbsp;<span class="op" id="4564497">!=</span>&nbsp;<span class="ident" id="4564500">nil</span>&nbsp;<span class="op" id="4564504">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564508">return</span>&nbsp;<span class="ident" id="4564515"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564516">.</span><span class="ident" id="4564517">w</span><span class="op" id="4564518">.</span><span class="ident" id="4564519">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564527"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564528">.</span><span class="ident" id="4564529">w</span><span class="op" id="4564530">.</span><span class="ident" id="4564531">flush</span><span class="op" id="4564536">(</span><span class="op" id="4564537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564540">return</span>&nbsp;<span class="ident" id="4564547"><a href="/compress/flate/deflate.go.html#4564359">d</a></span><span class="op" id="4564548">.</span><span class="ident" id="4564549">w</span><span class="op" id="4564550">.</span><span class="ident" id="4564551">err</span><br>
<span class="lineno"></span><span class="op" id="4564555">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4564558">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;compressing&nbsp;data&nbsp;at&nbsp;the&nbsp;given&nbsp;level.</span><br>
<span class="lineno"></span><span class="comment" id="4564629">//&nbsp;Following&nbsp;zlib,&nbsp;levels&nbsp;range&nbsp;from&nbsp;1&nbsp;(BestSpeed)&nbsp;to&nbsp;9&nbsp;(BestCompression);</span><br>
<span class="lineno"></span><span class="comment" id="4564704">//&nbsp;higher&nbsp;levels&nbsp;typically&nbsp;run&nbsp;slower&nbsp;but&nbsp;compress&nbsp;more.&nbsp;Level&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4564769">//&nbsp;(NoCompression)&nbsp;does&nbsp;not&nbsp;attempt&nbsp;any&nbsp;compression;&nbsp;it&nbsp;only&nbsp;adds&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="4564839">//&nbsp;necessary&nbsp;DEFLATE&nbsp;framing.&nbsp;Level&nbsp;-1&nbsp;(DefaultCompression)&nbsp;uses&nbsp;the&nbsp;default</span><br>
<span class="lineno"></span><span class="comment" id="4564916">//&nbsp;compression&nbsp;level.</span><br>
<span class="lineno"></span><span class="comment" id="4564938">//</span><br>
<span class="lineno"></span><span class="comment" id="4564941">//&nbsp;If&nbsp;level&nbsp;is&nbsp;in&nbsp;the&nbsp;range&nbsp;[-1,&nbsp;9]&nbsp;then&nbsp;the&nbsp;error&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4565014">//&nbsp;Otherwise&nbsp;the&nbsp;error&nbsp;returned&nbsp;will&nbsp;be&nbsp;non-nil.</span><br>
<span class="lineno">485</span><span class="keyword" id="4565063">func</span>&nbsp;<span class="ident" id="4565068">NewWriter</span><span class="op" id="4565077">(</span><span class="ident" id="4565078">w</span>&nbsp;<span class="ident" id="4565080"><a href="/compress/flate/deflate.go.html#4552420">io</a></span><span class="op" id="4565082">.</span><span class="ident" id="4565083">Writer</span><span class="op" id="4565089">,</span>&nbsp;<span class="ident" id="4565091">level</span>&nbsp;<span class="builtintype" id="4565097">int</span><span class="op" id="4565100">)</span>&nbsp;<span class="op" id="4565102">(</span><span class="op" id="4565103">*</span><span class="ident" id="4565104"><a href="/compress/flate/deflate.go.html#4566184">Writer</a></span><span class="op" id="4565110">,</span>&nbsp;<span class="builtintype" id="4565112">error</span><span class="op" id="4565117">)</span>&nbsp;<span class="op" id="4565119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565122">var</span>&nbsp;<span class="ident" id="4565126">dw</span>&nbsp;<span class="ident" id="4565129"><a href="/compress/flate/deflate.go.html#4566184">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565137">if</span>&nbsp;<span class="ident" id="4565140">err</span>&nbsp;<span class="op" id="4565144">:=</span>&nbsp;<span class="ident" id="4565147"><a href="/compress/flate/deflate.go.html#4565126">dw</a></span><span class="op" id="4565149">.</span><span class="ident" id="4565150">d</span><span class="op" id="4565151">.</span><span class="ident" id="4565152">init</span><span class="op" id="4565156">(</span><span class="ident" id="4565157"><a href="/compress/flate/deflate.go.html#4565078">w</a></span><span class="op" id="4565158">,</span>&nbsp;<span class="ident" id="4565160"><a href="/compress/flate/deflate.go.html#4565091">level</a></span><span class="op" id="4565165">)</span><span class="op" id="4565166">;</span>&nbsp;<span class="ident" id="4565168"><a href="/compress/flate/deflate.go.html#4565140">err</a></span>&nbsp;<span class="op" id="4565172">!=</span>&nbsp;<span class="ident" id="4565175">nil</span>&nbsp;<span class="op" id="4565179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565183">return</span>&nbsp;<span class="ident" id="4565190">nil</span><span class="op" id="4565193">,</span>&nbsp;<span class="ident" id="4565195"><a href="/compress/flate/deflate.go.html#4565140">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565200">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565203">return</span>&nbsp;<span class="op" id="4565210">&amp;</span><span class="ident" id="4565211"><a href="/compress/flate/deflate.go.html#4565126">dw</a></span><span class="op" id="4565213">,</span>&nbsp;<span class="ident" id="4565215">nil</span><br>
<span class="lineno"></span><span class="op" id="4565219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4565222">//&nbsp;NewWriterDict&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;initializes&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4565281">//&nbsp;Writer&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Writer&nbsp;behaves</span><br>
<span class="lineno">495</span><span class="comment" id="4565346">//&nbsp;as&nbsp;if&nbsp;the&nbsp;dictionary&nbsp;had&nbsp;been&nbsp;written&nbsp;to&nbsp;it&nbsp;without&nbsp;producing</span><br>
<span class="lineno"></span><span class="comment" id="4565411">//&nbsp;any&nbsp;compressed&nbsp;output.&nbsp;&nbsp;The&nbsp;compressed&nbsp;data&nbsp;written&nbsp;to&nbsp;w</span><br>
<span class="lineno"></span><span class="comment" id="4565471">//&nbsp;can&nbsp;only&nbsp;be&nbsp;decompressed&nbsp;by&nbsp;a&nbsp;Reader&nbsp;initialized&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4565532">//&nbsp;same&nbsp;dictionary.</span><br>
<span class="lineno"></span><span class="keyword" id="4565552">func</span>&nbsp;<span class="ident" id="4565557">NewWriterDict</span><span class="op" id="4565570">(</span><span class="ident" id="4565571">w</span>&nbsp;<span class="ident" id="4565573"><a href="/compress/flate/deflate.go.html#4552420">io</a></span><span class="op" id="4565575">.</span><span class="ident" id="4565576">Writer</span><span class="op" id="4565582">,</span>&nbsp;<span class="ident" id="4565584">level</span>&nbsp;<span class="builtintype" id="4565590">int</span><span class="op" id="4565593">,</span>&nbsp;<span class="ident" id="4565595">dict</span>&nbsp;<span class="op" id="4565600">[</span><span class="op" id="4565601">]</span><span class="builtintype" id="4565602">byte</span><span class="op" id="4565606">)</span>&nbsp;<span class="op" id="4565608">(</span><span class="op" id="4565609">*</span><span class="ident" id="4565610"><a href="/compress/flate/deflate.go.html#4566184">Writer</a></span><span class="op" id="4565616">,</span>&nbsp;<span class="builtintype" id="4565618">error</span><span class="op" id="4565623">)</span>&nbsp;<span class="op" id="4565625">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565628">dw</span>&nbsp;<span class="op" id="4565631">:=</span>&nbsp;<span class="op" id="4565634">&amp;</span><span class="ident" id="4565635"><a href="/compress/flate/deflate.go.html#4565876">dictWriter</a></span><span class="op" id="4565645">{</span><span class="ident" id="4565646"><a href="/compress/flate/deflate.go.html#4565571">w</a></span><span class="op" id="4565647">,</span>&nbsp;<span class="ident" id="4565649">false</span><span class="op" id="4565654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565657">zw</span><span class="op" id="4565659">,</span>&nbsp;<span class="ident" id="4565661">err</span>&nbsp;<span class="op" id="4565665">:=</span>&nbsp;<span class="ident" id="4565668"><a href="/compress/flate/deflate.go.html#4565068">NewWriter</a></span><span class="op" id="4565677">(</span><span class="ident" id="4565678"><a href="/compress/flate/deflate.go.html#4565628">dw</a></span><span class="op" id="4565680">,</span>&nbsp;<span class="ident" id="4565682"><a href="/compress/flate/deflate.go.html#4565584">level</a></span><span class="op" id="4565687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565690">if</span>&nbsp;<span class="ident" id="4565693"><a href="/compress/flate/deflate.go.html#4565661">err</a></span>&nbsp;<span class="op" id="4565697">!=</span>&nbsp;<span class="ident" id="4565700">nil</span>&nbsp;<span class="op" id="4565704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565708">return</span>&nbsp;<span class="ident" id="4565715">nil</span><span class="op" id="4565718">,</span>&nbsp;<span class="ident" id="4565720"><a href="/compress/flate/deflate.go.html#4565661">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565725">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565728"><a href="/compress/flate/deflate.go.html#4565657">zw</a></span><span class="op" id="4565730">.</span><span class="ident" id="4565731">Write</span><span class="op" id="4565736">(</span><span class="ident" id="4565737"><a href="/compress/flate/deflate.go.html#4565595">dict</a></span><span class="op" id="4565741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565744"><a href="/compress/flate/deflate.go.html#4565657">zw</a></span><span class="op" id="4565746">.</span><span class="ident" id="4565747">Flush</span><span class="op" id="4565752">(</span><span class="op" id="4565753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565756"><a href="/compress/flate/deflate.go.html#4565628">dw</a></span><span class="op" id="4565758">.</span><span class="ident" id="4565759">enabled</span>&nbsp;<span class="op" id="4565767">=</span>&nbsp;<span class="ident" id="4565769">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565775"><a href="/compress/flate/deflate.go.html#4565657">zw</a></span><span class="op" id="4565777">.</span><span class="ident" id="4565778">dict</span>&nbsp;<span class="op" id="4565783">=</span>&nbsp;<span class="builtinfunc" id="4565785">append</span><span class="op" id="4565791">(</span><span class="ident" id="4565792"><a href="/compress/flate/deflate.go.html#4565657">zw</a></span><span class="op" id="4565794">.</span><span class="ident" id="4565795">dict</span><span class="op" id="4565799">,</span>&nbsp;<span class="ident" id="4565801"><a href="/compress/flate/deflate.go.html#4565595">dict</a></span><span class="op" id="4565805">...</span><span class="op" id="4565808">)</span>&nbsp;<span class="comment" id="4565810">//&nbsp;duplicate&nbsp;dictionary&nbsp;for&nbsp;Reset&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565853">return</span>&nbsp;<span class="ident" id="4565860"><a href="/compress/flate/deflate.go.html#4565657">zw</a></span><span class="op" id="4565862">,</span>&nbsp;<span class="ident" id="4565864"><a href="/compress/flate/deflate.go.html#4565661">err</a></span><br>
<span class="lineno">510</span><span class="op" id="4565868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4565871">type</span>&nbsp;<span class="ident" id="4565876">dictWriter</span>&nbsp;<span class="keyword" id="4565887">struct</span>&nbsp;<span class="op" id="4565894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565897">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565905"><a href="/compress/flate/deflate.go.html#4552420">io</a></span><span class="op" id="4565907">.</span><span class="ident" id="4565908">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565916">enabled</span>&nbsp;<span class="builtintype" id="4565924">bool</span><br>
<span class="lineno">515</span><span class="op" id="4565929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4565932">func</span>&nbsp;<span class="op" id="4565937">(</span><span class="ident" id="4565938">w</span>&nbsp;<span class="op" id="4565940">*</span><span class="ident" id="4565941"><a href="/compress/flate/deflate.go.html#4565876">dictWriter</a></span><span class="op" id="4565951">)</span>&nbsp;<span class="ident" id="4565953">Write</span><span class="op" id="4565958">(</span><span class="ident" id="4565959">b</span>&nbsp;<span class="op" id="4565961">[</span><span class="op" id="4565962">]</span><span class="builtintype" id="4565963">byte</span><span class="op" id="4565967">)</span>&nbsp;<span class="op" id="4565969">(</span><span class="ident" id="4565970">n</span>&nbsp;<span class="builtintype" id="4565972">int</span><span class="op" id="4565975">,</span>&nbsp;<span class="ident" id="4565977">err</span>&nbsp;<span class="builtintype" id="4565981">error</span><span class="op" id="4565986">)</span>&nbsp;<span class="op" id="4565988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565991">if</span>&nbsp;<span class="ident" id="4565994"><a href="/compress/flate/deflate.go.html#4565938">w</a></span><span class="op" id="4565995">.</span><span class="ident" id="4565996">enabled</span>&nbsp;<span class="op" id="4566004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566008">return</span>&nbsp;<span class="ident" id="4566015"><a href="/compress/flate/deflate.go.html#4565938">w</a></span><span class="op" id="4566016">.</span><span class="ident" id="4566017">w</span><span class="op" id="4566018">.</span><span class="ident" id="4566019">Write</span><span class="op" id="4566024">(</span><span class="ident" id="4566025"><a href="/compress/flate/deflate.go.html#4565959">b</a></span><span class="op" id="4566026">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4566029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566032">return</span>&nbsp;<span class="builtinfunc" id="4566039">len</span><span class="op" id="4566042">(</span><span class="ident" id="4566043"><a href="/compress/flate/deflate.go.html#4565959">b</a></span><span class="op" id="4566044">)</span><span class="op" id="4566045">,</span>&nbsp;<span class="ident" id="4566047">nil</span><br>
<span class="lineno"></span><span class="op" id="4566051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4566054">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">525</span><span class="comment" id="4566117">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="4566179">type</span>&nbsp;<span class="ident" id="4566184">Writer</span>&nbsp;<span class="keyword" id="4566191">struct</span>&nbsp;<span class="op" id="4566198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566201">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566206"><a href="/compress/flate/deflate.go.html#4553891">compressor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566218">dict</span>&nbsp;<span class="op" id="4566223">[</span><span class="op" id="4566224">]</span><span class="builtintype" id="4566225">byte</span><br>
<span class="lineno"></span><span class="op" id="4566230">}</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span><span class="comment" id="4566233">//&nbsp;Write&nbsp;writes&nbsp;data&nbsp;to&nbsp;w,&nbsp;which&nbsp;will&nbsp;eventually&nbsp;write&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4566292">//&nbsp;compressed&nbsp;form&nbsp;of&nbsp;data&nbsp;to&nbsp;its&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4566345">func</span>&nbsp;<span class="op" id="4566350">(</span><span class="ident" id="4566351">w</span>&nbsp;<span class="op" id="4566353">*</span><span class="ident" id="4566354"><a href="/compress/flate/deflate.go.html#4566184">Writer</a></span><span class="op" id="4566360">)</span>&nbsp;<span class="ident" id="4566362">Write</span><span class="op" id="4566367">(</span><span class="ident" id="4566368">data</span>&nbsp;<span class="op" id="4566373">[</span><span class="op" id="4566374">]</span><span class="builtintype" id="4566375">byte</span><span class="op" id="4566379">)</span>&nbsp;<span class="op" id="4566381">(</span><span class="ident" id="4566382">n</span>&nbsp;<span class="builtintype" id="4566384">int</span><span class="op" id="4566387">,</span>&nbsp;<span class="ident" id="4566389">err</span>&nbsp;<span class="builtintype" id="4566393">error</span><span class="op" id="4566398">)</span>&nbsp;<span class="op" id="4566400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566403">return</span>&nbsp;<span class="ident" id="4566410"><a href="/compress/flate/deflate.go.html#4566351">w</a></span><span class="op" id="4566411">.</span><span class="ident" id="4566412">d</span><span class="op" id="4566413">.</span><span class="ident" id="4566414">write</span><span class="op" id="4566419">(</span><span class="ident" id="4566420"><a href="/compress/flate/deflate.go.html#4566368">data</a></span><span class="op" id="4566424">)</span><br>
<span class="lineno">535</span><span class="op" id="4566426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4566429">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4566500">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4566571">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.</span><br>
<span class="lineno">540</span><span class="comment" id="4566631">//&nbsp;Flush&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="4566689">//&nbsp;If&nbsp;the&nbsp;underlying&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4566761">//</span><br>
<span class="lineno"></span><span class="comment" id="4566764">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4566844">func</span>&nbsp;<span class="op" id="4566849">(</span><span class="ident" id="4566850">w</span>&nbsp;<span class="op" id="4566852">*</span><span class="ident" id="4566853"><a href="/compress/flate/deflate.go.html#4566184">Writer</a></span><span class="op" id="4566859">)</span>&nbsp;<span class="ident" id="4566861">Flush</span><span class="op" id="4566866">(</span><span class="op" id="4566867">)</span>&nbsp;<span class="builtintype" id="4566869">error</span>&nbsp;<span class="op" id="4566875">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566878">//&nbsp;For&nbsp;more&nbsp;about&nbsp;flushing:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566907">//&nbsp;http://www.bolet.org/~pornin/deflate-flush.html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566959">return</span>&nbsp;<span class="ident" id="4566966"><a href="/compress/flate/deflate.go.html#4566850">w</a></span><span class="op" id="4566967">.</span><span class="ident" id="4566968">d</span><span class="op" id="4566969">.</span><span class="ident" id="4566970">syncFlush</span><span class="op" id="4566979">(</span><span class="op" id="4566980">)</span><br>
<span class="lineno"></span><span class="op" id="4566982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="4566985">//&nbsp;Close&nbsp;flushes&nbsp;and&nbsp;closes&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4567025">func</span>&nbsp;<span class="op" id="4567030">(</span><span class="ident" id="4567031">w</span>&nbsp;<span class="op" id="4567033">*</span><span class="ident" id="4567034"><a href="/compress/flate/deflate.go.html#4566184">Writer</a></span><span class="op" id="4567040">)</span>&nbsp;<span class="ident" id="4567042">Close</span><span class="op" id="4567047">(</span><span class="op" id="4567048">)</span>&nbsp;<span class="builtintype" id="4567050">error</span>&nbsp;<span class="op" id="4567056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4567059">return</span>&nbsp;<span class="ident" id="4567066"><a href="/compress/flate/deflate.go.html#4567031">w</a></span><span class="op" id="4567067">.</span><span class="ident" id="4567068">d</span><span class="op" id="4567069">.</span><span class="builtinfunc" id="4567070">close</span><span class="op" id="4567075">(</span><span class="op" id="4567076">)</span><br>
<span class="lineno"></span><span class="op" id="4567078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">555</span><span class="comment" id="4567081">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;writer&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4567145">//&nbsp;the&nbsp;result&nbsp;of&nbsp;NewWriter&nbsp;or&nbsp;NewWriterDict&nbsp;called&nbsp;with&nbsp;dst</span><br>
<span class="lineno"></span><span class="comment" id="4567205">//&nbsp;and&nbsp;w&#39;s&nbsp;level&nbsp;and&nbsp;dictionary.</span><br>
<span class="lineno"></span><span class="keyword" id="4567238">func</span>&nbsp;<span class="op" id="4567243">(</span><span class="ident" id="4567244">w</span>&nbsp;<span class="op" id="4567246">*</span><span class="ident" id="4567247"><a href="/compress/flate/deflate.go.html#4566184">Writer</a></span><span class="op" id="4567253">)</span>&nbsp;<span class="ident" id="4567255">Reset</span><span class="op" id="4567260">(</span><span class="ident" id="4567261">dst</span>&nbsp;<span class="ident" id="4567265"><a href="/compress/flate/deflate.go.html#4552420">io</a></span><span class="op" id="4567267">.</span><span class="ident" id="4567268">Writer</span><span class="op" id="4567274">)</span>&nbsp;<span class="op" id="4567276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4567279">if</span>&nbsp;<span class="ident" id="4567282">dw</span><span class="op" id="4567284">,</span>&nbsp;<span class="ident" id="4567286">ok</span>&nbsp;<span class="op" id="4567289">:=</span>&nbsp;<span class="ident" id="4567292"><a href="/compress/flate/deflate.go.html#4567244">w</a></span><span class="op" id="4567293">.</span><span class="ident" id="4567294">d</span><span class="op" id="4567295">.</span><span class="ident" id="4567296">w</span><span class="op" id="4567297">.</span><span class="ident" id="4567298">w</span><span class="op" id="4567299">.</span><span class="op" id="4567300">(</span><span class="op" id="4567301">*</span><span class="ident" id="4567302"><a href="/compress/flate/deflate.go.html#4565876">dictWriter</a></span><span class="op" id="4567312">)</span><span class="op" id="4567313">;</span>&nbsp;<span class="ident" id="4567315"><a href="/compress/flate/deflate.go.html#4567286">ok</a></span>&nbsp;<span class="op" id="4567318">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4567322">//&nbsp;w&nbsp;was&nbsp;created&nbsp;with&nbsp;NewWriterDict</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567360"><a href="/compress/flate/deflate.go.html#4567282">dw</a></span><span class="op" id="4567362">.</span><span class="ident" id="4567363">w</span>&nbsp;<span class="op" id="4567365">=</span>&nbsp;<span class="ident" id="4567367"><a href="/compress/flate/deflate.go.html#4567261">dst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567373"><a href="/compress/flate/deflate.go.html#4567244">w</a></span><span class="op" id="4567374">.</span><span class="ident" id="4567375">d</span><span class="op" id="4567376">.</span><span class="ident" id="4567377">reset</span><span class="op" id="4567382">(</span><span class="ident" id="4567383"><a href="/compress/flate/deflate.go.html#4567282">dw</a></span><span class="op" id="4567385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567389"><a href="/compress/flate/deflate.go.html#4567282">dw</a></span><span class="op" id="4567391">.</span><span class="ident" id="4567392">enabled</span>&nbsp;<span class="op" id="4567400">=</span>&nbsp;<span class="ident" id="4567402">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567410"><a href="/compress/flate/deflate.go.html#4567244">w</a></span><span class="op" id="4567411">.</span><span class="ident" id="4567412">Write</span><span class="op" id="4567417">(</span><span class="ident" id="4567418"><a href="/compress/flate/deflate.go.html#4567244">w</a></span><span class="op" id="4567419">.</span><span class="ident" id="4567420">dict</span><span class="op" id="4567424">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567428"><a href="/compress/flate/deflate.go.html#4567244">w</a></span><span class="op" id="4567429">.</span><span class="ident" id="4567430">Flush</span><span class="op" id="4567435">(</span><span class="op" id="4567436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567440"><a href="/compress/flate/deflate.go.html#4567282">dw</a></span><span class="op" id="4567442">.</span><span class="ident" id="4567443">enabled</span>&nbsp;<span class="op" id="4567451">=</span>&nbsp;<span class="ident" id="4567453">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4567459">}</span>&nbsp;<span class="keyword" id="4567461">else</span>&nbsp;<span class="op" id="4567466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4567470">//&nbsp;w&nbsp;was&nbsp;created&nbsp;with&nbsp;NewWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567504"><a href="/compress/flate/deflate.go.html#4567244">w</a></span><span class="op" id="4567505">.</span><span class="ident" id="4567506">d</span><span class="op" id="4567507">.</span><span class="ident" id="4567508">reset</span><span class="op" id="4567513">(</span><span class="ident" id="4567514"><a href="/compress/flate/deflate.go.html#4567261">dst</a></span><span class="op" id="4567517">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4567520">}</span><br>
<span class="lineno"></span><span class="op" id="4567522">}</span>
</div>
</body>
</html>
