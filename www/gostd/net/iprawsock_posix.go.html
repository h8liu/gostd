<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html" class="current">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3289506">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3289562">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3289616">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3289667">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3289745">package</span>&nbsp;<span class="ident" id="3289753">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3289758">import</span>&nbsp;<span class="op" id="3289765">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3289768">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3289779">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3289786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3289789">//&nbsp;BUG(mikio):&nbsp;On&nbsp;every&nbsp;POSIX&nbsp;platform,&nbsp;reads&nbsp;from&nbsp;the&nbsp;&#34;ip4&#34;&nbsp;network</span><br>
<span class="lineno">15</span><span class="comment" id="3289858">//&nbsp;using&nbsp;the&nbsp;ReadFrom&nbsp;or&nbsp;ReadFromIP&nbsp;method&nbsp;might&nbsp;not&nbsp;return&nbsp;a&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="3289929">//&nbsp;IPv4&nbsp;packet,&nbsp;including&nbsp;its&nbsp;header,&nbsp;even&nbsp;if&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3289990">//&nbsp;available.&nbsp;This&nbsp;can&nbsp;occur&nbsp;even&nbsp;in&nbsp;cases&nbsp;where&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3290057">//&nbsp;could&nbsp;return&nbsp;a&nbsp;complete&nbsp;packet.&nbsp;For&nbsp;this&nbsp;reason,&nbsp;it&nbsp;is&nbsp;recommended</span><br>
<span class="lineno"></span><span class="comment" id="3290127">//&nbsp;that&nbsp;you&nbsp;do&nbsp;not&nbsp;uses&nbsp;these&nbsp;methods&nbsp;if&nbsp;it&nbsp;is&nbsp;important&nbsp;to&nbsp;receive&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3290197">//&nbsp;full&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3290213">//</span><br>
<span class="lineno"></span><span class="comment" id="3290216">//&nbsp;The&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines&nbsp;make&nbsp;it&nbsp;impossible&nbsp;for&nbsp;us&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3290282">//&nbsp;change&nbsp;the&nbsp;behavior&nbsp;of&nbsp;these&nbsp;methods;&nbsp;use&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3290345">//&nbsp;instead.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3290358">func</span>&nbsp;<span class="ident" id="3290363">sockaddrToIP</span><span class="op" id="3290375">(</span><span class="ident" id="3290376">sa</span>&nbsp;<span class="ident" id="3290379">syscall</span><span class="op" id="3290386">.</span><span class="ident" id="3290387">Sockaddr</span><span class="op" id="3290395">)</span>&nbsp;<span class="ident" id="3290397">Addr</span>&nbsp;<span class="op" id="3290402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290405">switch</span>&nbsp;<span class="ident" id="3290412">sa</span>&nbsp;<span class="op" id="3290415">:=</span>&nbsp;<span class="ident" id="3290418">sa</span><span class="op" id="3290420">.</span><span class="op" id="3290421">(</span><span class="keyword" id="3290422">type</span><span class="op" id="3290426">)</span>&nbsp;<span class="op" id="3290428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290431">case</span>&nbsp;<span class="op" id="3290436">*</span><span class="ident" id="3290437">syscall</span><span class="op" id="3290444">.</span><span class="ident" id="3290445">SockaddrInet4</span><span class="op" id="3290458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290462">return</span>&nbsp;<span class="op" id="3290469">&amp;</span><span class="ident" id="3290470">IPAddr</span><span class="op" id="3290476">{</span><span class="ident" id="3290477">IP</span><span class="op" id="3290479">:</span>&nbsp;<span class="ident" id="3290481">sa</span><span class="op" id="3290483">.</span><span class="ident" id="3290484">Addr</span><span class="op" id="3290488">[</span><span class="num" id="3290489">0</span><span class="op" id="3290490">:</span><span class="op" id="3290491">]</span><span class="op" id="3290492">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290495">case</span>&nbsp;<span class="op" id="3290500">*</span><span class="ident" id="3290501">syscall</span><span class="op" id="3290508">.</span><span class="ident" id="3290509">SockaddrInet6</span><span class="op" id="3290522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290526">return</span>&nbsp;<span class="op" id="3290533">&amp;</span><span class="ident" id="3290534">IPAddr</span><span class="op" id="3290540">{</span><span class="ident" id="3290541">IP</span><span class="op" id="3290543">:</span>&nbsp;<span class="ident" id="3290545">sa</span><span class="op" id="3290547">.</span><span class="ident" id="3290548">Addr</span><span class="op" id="3290552">[</span><span class="num" id="3290553">0</span><span class="op" id="3290554">:</span><span class="op" id="3290555">]</span><span class="op" id="3290556">,</span>&nbsp;<span class="ident" id="3290558">Zone</span><span class="op" id="3290562">:</span>&nbsp;<span class="ident" id="3290564">zoneToString</span><span class="op" id="3290576">(</span><span class="builtintype" id="3290577">int</span><span class="op" id="3290580">(</span><span class="ident" id="3290581">sa</span><span class="op" id="3290583">.</span><span class="ident" id="3290584">ZoneId</span><span class="op" id="3290590">)</span><span class="op" id="3290591">)</span><span class="op" id="3290592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290598">return</span>&nbsp;<span class="builtintype" id="3290605">nil</span><br>
<span class="lineno"></span><span class="op" id="3290609">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3290612">func</span>&nbsp;<span class="op" id="3290617">(</span><span class="ident" id="3290618">a</span>&nbsp;<span class="op" id="3290620">*</span><span class="ident" id="3290621">IPAddr</span><span class="op" id="3290627">)</span>&nbsp;<span class="ident" id="3290629">family</span><span class="op" id="3290635">(</span><span class="op" id="3290636">)</span>&nbsp;<span class="builtintype" id="3290638">int</span>&nbsp;<span class="op" id="3290642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290645">if</span>&nbsp;<span class="ident" id="3290648">a</span>&nbsp;<span class="op" id="3290650">==</span>&nbsp;<span class="builtintype" id="3290653">nil</span>&nbsp;<span class="op" id="3290657">||</span>&nbsp;<span class="builtinfunc" id="3290660">len</span><span class="op" id="3290663">(</span><span class="ident" id="3290664">a</span><span class="op" id="3290665">.</span><span class="ident" id="3290666">IP</span><span class="op" id="3290668">)</span>&nbsp;<span class="op" id="3290670">&lt;=</span>&nbsp;<span class="ident" id="3290673">IPv4len</span>&nbsp;<span class="op" id="3290681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290685">return</span>&nbsp;<span class="ident" id="3290692">syscall</span><span class="op" id="3290699">.</span><span class="ident" id="3290700">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290709">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290712">if</span>&nbsp;<span class="ident" id="3290715">a</span><span class="op" id="3290716">.</span><span class="ident" id="3290717">IP</span><span class="op" id="3290719">.</span><span class="ident" id="3290720">To4</span><span class="op" id="3290723">(</span><span class="op" id="3290724">)</span>&nbsp;<span class="op" id="3290726">!=</span>&nbsp;<span class="builtintype" id="3290729">nil</span>&nbsp;<span class="op" id="3290733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290737">return</span>&nbsp;<span class="ident" id="3290744">syscall</span><span class="op" id="3290751">.</span><span class="ident" id="3290752">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290764">return</span>&nbsp;<span class="ident" id="3290771">syscall</span><span class="op" id="3290778">.</span><span class="ident" id="3290779">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3290788">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3290791">func</span>&nbsp;<span class="op" id="3290796">(</span><span class="ident" id="3290797">a</span>&nbsp;<span class="op" id="3290799">*</span><span class="ident" id="3290800">IPAddr</span><span class="op" id="3290806">)</span>&nbsp;<span class="ident" id="3290808">isWildcard</span><span class="op" id="3290818">(</span><span class="op" id="3290819">)</span>&nbsp;<span class="builtintype" id="3290821">bool</span>&nbsp;<span class="op" id="3290826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290829">if</span>&nbsp;<span class="ident" id="3290832">a</span>&nbsp;<span class="op" id="3290834">==</span>&nbsp;<span class="builtintype" id="3290837">nil</span>&nbsp;<span class="op" id="3290841">||</span>&nbsp;<span class="ident" id="3290844">a</span><span class="op" id="3290845">.</span><span class="ident" id="3290846">IP</span>&nbsp;<span class="op" id="3290849">==</span>&nbsp;<span class="builtintype" id="3290852">nil</span>&nbsp;<span class="op" id="3290856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290860">return</span>&nbsp;<span class="builtintype" id="3290867">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290873">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290876">return</span>&nbsp;<span class="ident" id="3290883">a</span><span class="op" id="3290884">.</span><span class="ident" id="3290885">IP</span><span class="op" id="3290887">.</span><span class="ident" id="3290888">IsUnspecified</span><span class="op" id="3290901">(</span><span class="op" id="3290902">)</span><br>
<span class="lineno"></span><span class="op" id="3290904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3290907">func</span>&nbsp;<span class="op" id="3290912">(</span><span class="ident" id="3290913">a</span>&nbsp;<span class="op" id="3290915">*</span><span class="ident" id="3290916">IPAddr</span><span class="op" id="3290922">)</span>&nbsp;<span class="ident" id="3290924">sockaddr</span><span class="op" id="3290932">(</span><span class="ident" id="3290933">family</span>&nbsp;<span class="builtintype" id="3290940">int</span><span class="op" id="3290943">)</span>&nbsp;<span class="op" id="3290945">(</span><span class="ident" id="3290946">syscall</span><span class="op" id="3290953">.</span><span class="ident" id="3290954">Sockaddr</span><span class="op" id="3290962">,</span>&nbsp;<span class="builtintype" id="3290964">error</span><span class="op" id="3290969">)</span>&nbsp;<span class="op" id="3290971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290974">if</span>&nbsp;<span class="ident" id="3290977">a</span>&nbsp;<span class="op" id="3290979">==</span>&nbsp;<span class="builtintype" id="3290982">nil</span>&nbsp;<span class="op" id="3290986">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290990">return</span>&nbsp;<span class="builtintype" id="3290997">nil</span><span class="op" id="3291000">,</span>&nbsp;<span class="builtintype" id="3291002">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3291007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291010">return</span>&nbsp;<span class="ident" id="3291017">ipToSockaddr</span><span class="op" id="3291029">(</span><span class="ident" id="3291030">family</span><span class="op" id="3291036">,</span>&nbsp;<span class="ident" id="3291038">a</span><span class="op" id="3291039">.</span><span class="ident" id="3291040">IP</span><span class="op" id="3291042">,</span>&nbsp;<span class="num" id="3291044">0</span><span class="op" id="3291045">,</span>&nbsp;<span class="ident" id="3291047">a</span><span class="op" id="3291048">.</span><span class="ident" id="3291049">Zone</span><span class="op" id="3291053">)</span><br>
<span class="lineno"></span><span class="op" id="3291055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3291058">//&nbsp;IPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3291128">//&nbsp;for&nbsp;IP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="3291159">type</span>&nbsp;<span class="ident" id="3291164">IPConn</span>&nbsp;<span class="keyword" id="3291171">struct</span>&nbsp;<span class="op" id="3291178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3291181">conn</span><br>
<span class="lineno"></span><span class="op" id="3291186">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3291189">func</span>&nbsp;<span class="ident" id="3291194">newIPConn</span><span class="op" id="3291203">(</span><span class="ident" id="3291204">fd</span>&nbsp;<span class="op" id="3291207">*</span><span class="ident" id="3291208">netFD</span><span class="op" id="3291213">)</span>&nbsp;<span class="op" id="3291215">*</span><span class="ident" id="3291216">IPConn</span>&nbsp;<span class="op" id="3291223">{</span>&nbsp;<span class="keyword" id="3291225">return</span>&nbsp;<span class="op" id="3291232">&amp;</span><span class="ident" id="3291233">IPConn</span><span class="op" id="3291239">{</span><span class="ident" id="3291240">conn</span><span class="op" id="3291244">{</span><span class="ident" id="3291245">fd</span><span class="op" id="3291247">}</span><span class="op" id="3291248">}</span>&nbsp;<span class="op" id="3291250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3291253">//&nbsp;ReadFromIP&nbsp;reads&nbsp;an&nbsp;IP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3291322">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno">70</span><span class="comment" id="3291393">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3291420">//</span><br>
<span class="lineno"></span><span class="comment" id="3291423">//&nbsp;ReadFromIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3291486">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3291553">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno">75</span><span class="keyword" id="3291573">func</span>&nbsp;<span class="op" id="3291578">(</span><span class="ident" id="3291579">c</span>&nbsp;<span class="op" id="3291581">*</span><span class="ident" id="3291582">IPConn</span><span class="op" id="3291588">)</span>&nbsp;<span class="ident" id="3291590">ReadFromIP</span><span class="op" id="3291600">(</span><span class="ident" id="3291601">b</span>&nbsp;<span class="op" id="3291603">[</span><span class="op" id="3291604">]</span><span class="builtintype" id="3291605">byte</span><span class="op" id="3291609">)</span>&nbsp;<span class="op" id="3291611">(</span><span class="builtintype" id="3291612">int</span><span class="op" id="3291615">,</span>&nbsp;<span class="op" id="3291617">*</span><span class="ident" id="3291618">IPAddr</span><span class="op" id="3291624">,</span>&nbsp;<span class="builtintype" id="3291626">error</span><span class="op" id="3291631">)</span>&nbsp;<span class="op" id="3291633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291636">if</span>&nbsp;<span class="op" id="3291639">!</span><span class="ident" id="3291640">c</span><span class="op" id="3291641">.</span><span class="ident" id="3291642">ok</span><span class="op" id="3291644">(</span><span class="op" id="3291645">)</span>&nbsp;<span class="op" id="3291647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291651">return</span>&nbsp;<span class="num" id="3291658">0</span><span class="op" id="3291659">,</span>&nbsp;<span class="builtintype" id="3291661">nil</span><span class="op" id="3291664">,</span>&nbsp;<span class="ident" id="3291666">syscall</span><span class="op" id="3291673">.</span><span class="ident" id="3291674">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3291682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3291685">//&nbsp;TODO(cw,rsc):&nbsp;consider&nbsp;using&nbsp;readv&nbsp;if&nbsp;we&nbsp;know&nbsp;the&nbsp;family</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3291746">//&nbsp;type&nbsp;to&nbsp;avoid&nbsp;the&nbsp;header&nbsp;trim/copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291785">var</span>&nbsp;<span class="ident" id="3291789">addr</span>&nbsp;<span class="op" id="3291794">*</span><span class="ident" id="3291795">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3291803">n</span><span class="op" id="3291804">,</span>&nbsp;<span class="ident" id="3291806">sa</span><span class="op" id="3291808">,</span>&nbsp;<span class="ident" id="3291810">err</span>&nbsp;<span class="op" id="3291814">:=</span>&nbsp;<span class="ident" id="3291817">c</span><span class="op" id="3291818">.</span><span class="ident" id="3291819">fd</span><span class="op" id="3291821">.</span><span class="ident" id="3291822">readFrom</span><span class="op" id="3291830">(</span><span class="ident" id="3291831">b</span><span class="op" id="3291832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291835">switch</span>&nbsp;<span class="ident" id="3291842">sa</span>&nbsp;<span class="op" id="3291845">:=</span>&nbsp;<span class="ident" id="3291848">sa</span><span class="op" id="3291850">.</span><span class="op" id="3291851">(</span><span class="keyword" id="3291852">type</span><span class="op" id="3291856">)</span>&nbsp;<span class="op" id="3291858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291861">case</span>&nbsp;<span class="op" id="3291866">*</span><span class="ident" id="3291867">syscall</span><span class="op" id="3291874">.</span><span class="ident" id="3291875">SockaddrInet4</span><span class="op" id="3291888">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3291892">addr</span>&nbsp;<span class="op" id="3291897">=</span>&nbsp;<span class="op" id="3291899">&amp;</span><span class="ident" id="3291900">IPAddr</span><span class="op" id="3291906">{</span><span class="ident" id="3291907">IP</span><span class="op" id="3291909">:</span>&nbsp;<span class="ident" id="3291911">sa</span><span class="op" id="3291913">.</span><span class="ident" id="3291914">Addr</span><span class="op" id="3291918">[</span><span class="num" id="3291919">0</span><span class="op" id="3291920">:</span><span class="op" id="3291921">]</span><span class="op" id="3291922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291926">if</span>&nbsp;<span class="builtinfunc" id="3291929">len</span><span class="op" id="3291932">(</span><span class="ident" id="3291933">b</span><span class="op" id="3291934">)</span>&nbsp;<span class="op" id="3291936">&gt;=</span>&nbsp;<span class="ident" id="3291939">IPv4len</span>&nbsp;<span class="op" id="3291947">{</span>&nbsp;<span class="comment" id="3291949">//&nbsp;discard&nbsp;ipv4&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3291975">hsize</span>&nbsp;<span class="op" id="3291981">:=</span>&nbsp;<span class="op" id="3291984">(</span><span class="builtintype" id="3291985">int</span><span class="op" id="3291988">(</span><span class="ident" id="3291989">b</span><span class="op" id="3291990">[</span><span class="num" id="3291991">0</span><span class="op" id="3291992">]</span><span class="op" id="3291993">)</span>&nbsp;<span class="op" id="3291995">&amp;</span>&nbsp;<span class="num" id="3291997">0xf</span><span class="op" id="3292000">)</span>&nbsp;<span class="op" id="3292002">*</span>&nbsp;<span class="num" id="3292004">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3292009">copy</span><span class="op" id="3292013">(</span><span class="ident" id="3292014">b</span><span class="op" id="3292015">,</span>&nbsp;<span class="ident" id="3292017">b</span><span class="op" id="3292018">[</span><span class="ident" id="3292019">hsize</span><span class="op" id="3292024">:</span><span class="op" id="3292025">]</span><span class="op" id="3292026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292031">n</span>&nbsp;<span class="op" id="3292033">-=</span>&nbsp;<span class="ident" id="3292036">hsize</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3292044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292047">case</span>&nbsp;<span class="op" id="3292052">*</span><span class="ident" id="3292053">syscall</span><span class="op" id="3292060">.</span><span class="ident" id="3292061">SockaddrInet6</span><span class="op" id="3292074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292078">addr</span>&nbsp;<span class="op" id="3292083">=</span>&nbsp;<span class="op" id="3292085">&amp;</span><span class="ident" id="3292086">IPAddr</span><span class="op" id="3292092">{</span><span class="ident" id="3292093">IP</span><span class="op" id="3292095">:</span>&nbsp;<span class="ident" id="3292097">sa</span><span class="op" id="3292099">.</span><span class="ident" id="3292100">Addr</span><span class="op" id="3292104">[</span><span class="num" id="3292105">0</span><span class="op" id="3292106">:</span><span class="op" id="3292107">]</span><span class="op" id="3292108">,</span>&nbsp;<span class="ident" id="3292110">Zone</span><span class="op" id="3292114">:</span>&nbsp;<span class="ident" id="3292116">zoneToString</span><span class="op" id="3292128">(</span><span class="builtintype" id="3292129">int</span><span class="op" id="3292132">(</span><span class="ident" id="3292133">sa</span><span class="op" id="3292135">.</span><span class="ident" id="3292136">ZoneId</span><span class="op" id="3292142">)</span><span class="op" id="3292143">)</span><span class="op" id="3292144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3292147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292150">return</span>&nbsp;<span class="ident" id="3292157">n</span><span class="op" id="3292158">,</span>&nbsp;<span class="ident" id="3292160">addr</span><span class="op" id="3292164">,</span>&nbsp;<span class="ident" id="3292166">err</span><br>
<span class="lineno">95</span><span class="op" id="3292170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3292173">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3292228">func</span>&nbsp;<span class="op" id="3292233">(</span><span class="ident" id="3292234">c</span>&nbsp;<span class="op" id="3292236">*</span><span class="ident" id="3292237">IPConn</span><span class="op" id="3292243">)</span>&nbsp;<span class="ident" id="3292245">ReadFrom</span><span class="op" id="3292253">(</span><span class="ident" id="3292254">b</span>&nbsp;<span class="op" id="3292256">[</span><span class="op" id="3292257">]</span><span class="builtintype" id="3292258">byte</span><span class="op" id="3292262">)</span>&nbsp;<span class="op" id="3292264">(</span><span class="builtintype" id="3292265">int</span><span class="op" id="3292268">,</span>&nbsp;<span class="ident" id="3292270">Addr</span><span class="op" id="3292274">,</span>&nbsp;<span class="builtintype" id="3292276">error</span><span class="op" id="3292281">)</span>&nbsp;<span class="op" id="3292283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292286">if</span>&nbsp;<span class="op" id="3292289">!</span><span class="ident" id="3292290">c</span><span class="op" id="3292291">.</span><span class="ident" id="3292292">ok</span><span class="op" id="3292294">(</span><span class="op" id="3292295">)</span>&nbsp;<span class="op" id="3292297">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292301">return</span>&nbsp;<span class="num" id="3292308">0</span><span class="op" id="3292309">,</span>&nbsp;<span class="builtintype" id="3292311">nil</span><span class="op" id="3292314">,</span>&nbsp;<span class="ident" id="3292316">syscall</span><span class="op" id="3292323">.</span><span class="ident" id="3292324">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3292332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292335">n</span><span class="op" id="3292336">,</span>&nbsp;<span class="ident" id="3292338">addr</span><span class="op" id="3292342">,</span>&nbsp;<span class="ident" id="3292344">err</span>&nbsp;<span class="op" id="3292348">:=</span>&nbsp;<span class="ident" id="3292351">c</span><span class="op" id="3292352">.</span><span class="ident" id="3292353">ReadFromIP</span><span class="op" id="3292363">(</span><span class="ident" id="3292364">b</span><span class="op" id="3292365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292368">return</span>&nbsp;<span class="ident" id="3292375">n</span><span class="op" id="3292376">,</span>&nbsp;<span class="ident" id="3292378">addr</span><span class="op" id="3292382">.</span><span class="ident" id="3292383">toAddr</span><span class="op" id="3292389">(</span><span class="op" id="3292390">)</span><span class="op" id="3292391">,</span>&nbsp;<span class="ident" id="3292393">err</span><br>
<span class="lineno"></span><span class="op" id="3292397">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3292400">//&nbsp;ReadMsgIP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3292471">//&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3292538">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3292609">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno">110</span><span class="keyword" id="3292678">func</span>&nbsp;<span class="op" id="3292683">(</span><span class="ident" id="3292684">c</span>&nbsp;<span class="op" id="3292686">*</span><span class="ident" id="3292687">IPConn</span><span class="op" id="3292693">)</span>&nbsp;<span class="ident" id="3292695">ReadMsgIP</span><span class="op" id="3292704">(</span><span class="ident" id="3292705">b</span><span class="op" id="3292706">,</span>&nbsp;<span class="ident" id="3292708">oob</span>&nbsp;<span class="op" id="3292712">[</span><span class="op" id="3292713">]</span><span class="builtintype" id="3292714">byte</span><span class="op" id="3292718">)</span>&nbsp;<span class="op" id="3292720">(</span><span class="ident" id="3292721">n</span><span class="op" id="3292722">,</span>&nbsp;<span class="ident" id="3292724">oobn</span><span class="op" id="3292728">,</span>&nbsp;<span class="ident" id="3292730">flags</span>&nbsp;<span class="builtintype" id="3292736">int</span><span class="op" id="3292739">,</span>&nbsp;<span class="ident" id="3292741">addr</span>&nbsp;<span class="op" id="3292746">*</span><span class="ident" id="3292747">IPAddr</span><span class="op" id="3292753">,</span>&nbsp;<span class="ident" id="3292755">err</span>&nbsp;<span class="builtintype" id="3292759">error</span><span class="op" id="3292764">)</span>&nbsp;<span class="op" id="3292766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292769">if</span>&nbsp;<span class="op" id="3292772">!</span><span class="ident" id="3292773">c</span><span class="op" id="3292774">.</span><span class="ident" id="3292775">ok</span><span class="op" id="3292777">(</span><span class="op" id="3292778">)</span>&nbsp;<span class="op" id="3292780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292784">return</span>&nbsp;<span class="num" id="3292791">0</span><span class="op" id="3292792">,</span>&nbsp;<span class="num" id="3292794">0</span><span class="op" id="3292795">,</span>&nbsp;<span class="num" id="3292797">0</span><span class="op" id="3292798">,</span>&nbsp;<span class="builtintype" id="3292800">nil</span><span class="op" id="3292803">,</span>&nbsp;<span class="ident" id="3292805">syscall</span><span class="op" id="3292812">.</span><span class="ident" id="3292813">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3292821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292824">var</span>&nbsp;<span class="ident" id="3292828">sa</span>&nbsp;<span class="ident" id="3292831">syscall</span><span class="op" id="3292838">.</span><span class="ident" id="3292839">Sockaddr</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292849">n</span><span class="op" id="3292850">,</span>&nbsp;<span class="ident" id="3292852">oobn</span><span class="op" id="3292856">,</span>&nbsp;<span class="ident" id="3292858">flags</span><span class="op" id="3292863">,</span>&nbsp;<span class="ident" id="3292865">sa</span><span class="op" id="3292867">,</span>&nbsp;<span class="ident" id="3292869">err</span>&nbsp;<span class="op" id="3292873">=</span>&nbsp;<span class="ident" id="3292875">c</span><span class="op" id="3292876">.</span><span class="ident" id="3292877">fd</span><span class="op" id="3292879">.</span><span class="ident" id="3292880">readMsg</span><span class="op" id="3292887">(</span><span class="ident" id="3292888">b</span><span class="op" id="3292889">,</span>&nbsp;<span class="ident" id="3292891">oob</span><span class="op" id="3292894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292897">switch</span>&nbsp;<span class="ident" id="3292904">sa</span>&nbsp;<span class="op" id="3292907">:=</span>&nbsp;<span class="ident" id="3292910">sa</span><span class="op" id="3292912">.</span><span class="op" id="3292913">(</span><span class="keyword" id="3292914">type</span><span class="op" id="3292918">)</span>&nbsp;<span class="op" id="3292920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292923">case</span>&nbsp;<span class="op" id="3292928">*</span><span class="ident" id="3292929">syscall</span><span class="op" id="3292936">.</span><span class="ident" id="3292937">SockaddrInet4</span><span class="op" id="3292950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292954">addr</span>&nbsp;<span class="op" id="3292959">=</span>&nbsp;<span class="op" id="3292961">&amp;</span><span class="ident" id="3292962">IPAddr</span><span class="op" id="3292968">{</span><span class="ident" id="3292969">IP</span><span class="op" id="3292971">:</span>&nbsp;<span class="ident" id="3292973">sa</span><span class="op" id="3292975">.</span><span class="ident" id="3292976">Addr</span><span class="op" id="3292980">[</span><span class="num" id="3292981">0</span><span class="op" id="3292982">:</span><span class="op" id="3292983">]</span><span class="op" id="3292984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292987">case</span>&nbsp;<span class="op" id="3292992">*</span><span class="ident" id="3292993">syscall</span><span class="op" id="3293000">.</span><span class="ident" id="3293001">SockaddrInet6</span><span class="op" id="3293014">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293018">addr</span>&nbsp;<span class="op" id="3293023">=</span>&nbsp;<span class="op" id="3293025">&amp;</span><span class="ident" id="3293026">IPAddr</span><span class="op" id="3293032">{</span><span class="ident" id="3293033">IP</span><span class="op" id="3293035">:</span>&nbsp;<span class="ident" id="3293037">sa</span><span class="op" id="3293039">.</span><span class="ident" id="3293040">Addr</span><span class="op" id="3293044">[</span><span class="num" id="3293045">0</span><span class="op" id="3293046">:</span><span class="op" id="3293047">]</span><span class="op" id="3293048">,</span>&nbsp;<span class="ident" id="3293050">Zone</span><span class="op" id="3293054">:</span>&nbsp;<span class="ident" id="3293056">zoneToString</span><span class="op" id="3293068">(</span><span class="builtintype" id="3293069">int</span><span class="op" id="3293072">(</span><span class="ident" id="3293073">sa</span><span class="op" id="3293075">.</span><span class="ident" id="3293076">ZoneId</span><span class="op" id="3293082">)</span><span class="op" id="3293083">)</span><span class="op" id="3293084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293090">return</span><br>
<span class="lineno"></span><span class="op" id="3293097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3293100">//&nbsp;WriteToIP&nbsp;writes&nbsp;an&nbsp;IP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3293168">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3293179">//</span><br>
<span class="lineno"></span><span class="comment" id="3293182">//&nbsp;WriteToIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3293244">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">130</span><span class="comment" id="3293311">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3293380">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3293393">func</span>&nbsp;<span class="op" id="3293398">(</span><span class="ident" id="3293399">c</span>&nbsp;<span class="op" id="3293401">*</span><span class="ident" id="3293402">IPConn</span><span class="op" id="3293408">)</span>&nbsp;<span class="ident" id="3293410">WriteToIP</span><span class="op" id="3293419">(</span><span class="ident" id="3293420">b</span>&nbsp;<span class="op" id="3293422">[</span><span class="op" id="3293423">]</span><span class="builtintype" id="3293424">byte</span><span class="op" id="3293428">,</span>&nbsp;<span class="ident" id="3293430">addr</span>&nbsp;<span class="op" id="3293435">*</span><span class="ident" id="3293436">IPAddr</span><span class="op" id="3293442">)</span>&nbsp;<span class="op" id="3293444">(</span><span class="builtintype" id="3293445">int</span><span class="op" id="3293448">,</span>&nbsp;<span class="builtintype" id="3293450">error</span><span class="op" id="3293455">)</span>&nbsp;<span class="op" id="3293457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293460">if</span>&nbsp;<span class="op" id="3293463">!</span><span class="ident" id="3293464">c</span><span class="op" id="3293465">.</span><span class="ident" id="3293466">ok</span><span class="op" id="3293468">(</span><span class="op" id="3293469">)</span>&nbsp;<span class="op" id="3293471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293475">return</span>&nbsp;<span class="num" id="3293482">0</span><span class="op" id="3293483">,</span>&nbsp;<span class="ident" id="3293485">syscall</span><span class="op" id="3293492">.</span><span class="ident" id="3293493">EINVAL</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293504">if</span>&nbsp;<span class="ident" id="3293507">c</span><span class="op" id="3293508">.</span><span class="ident" id="3293509">fd</span><span class="op" id="3293511">.</span><span class="ident" id="3293512">isConnected</span>&nbsp;<span class="op" id="3293524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293528">return</span>&nbsp;<span class="num" id="3293535">0</span><span class="op" id="3293536">,</span>&nbsp;<span class="op" id="3293538">&amp;</span><span class="ident" id="3293539">OpError</span><span class="op" id="3293546">{</span><span class="ident" id="3293547">Op</span><span class="op" id="3293549">:</span>&nbsp;<span class="string" id="3293551">&#34;write&#34;</span><span class="op" id="3293558">,</span>&nbsp;<span class="ident" id="3293560">Net</span><span class="op" id="3293563">:</span>&nbsp;<span class="ident" id="3293565">c</span><span class="op" id="3293566">.</span><span class="ident" id="3293567">fd</span><span class="op" id="3293569">.</span><span class="ident" id="3293570">net</span><span class="op" id="3293573">,</span>&nbsp;<span class="ident" id="3293575">Addr</span><span class="op" id="3293579">:</span>&nbsp;<span class="ident" id="3293581">addr</span><span class="op" id="3293585">,</span>&nbsp;<span class="ident" id="3293587">Err</span><span class="op" id="3293590">:</span>&nbsp;<span class="ident" id="3293592">ErrWriteToConnected</span><span class="op" id="3293611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293617">if</span>&nbsp;<span class="ident" id="3293620">addr</span>&nbsp;<span class="op" id="3293625">==</span>&nbsp;<span class="builtintype" id="3293628">nil</span>&nbsp;<span class="op" id="3293632">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293636">return</span>&nbsp;<span class="num" id="3293643">0</span><span class="op" id="3293644">,</span>&nbsp;<span class="op" id="3293646">&amp;</span><span class="ident" id="3293647">OpError</span><span class="op" id="3293654">{</span><span class="ident" id="3293655">Op</span><span class="op" id="3293657">:</span>&nbsp;<span class="string" id="3293659">&#34;write&#34;</span><span class="op" id="3293666">,</span>&nbsp;<span class="ident" id="3293668">Net</span><span class="op" id="3293671">:</span>&nbsp;<span class="ident" id="3293673">c</span><span class="op" id="3293674">.</span><span class="ident" id="3293675">fd</span><span class="op" id="3293677">.</span><span class="ident" id="3293678">net</span><span class="op" id="3293681">,</span>&nbsp;<span class="ident" id="3293683">Addr</span><span class="op" id="3293687">:</span>&nbsp;<span class="builtintype" id="3293689">nil</span><span class="op" id="3293692">,</span>&nbsp;<span class="ident" id="3293694">Err</span><span class="op" id="3293697">:</span>&nbsp;<span class="ident" id="3293699">errMissingAddress</span><span class="op" id="3293716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293722">sa</span><span class="op" id="3293724">,</span>&nbsp;<span class="ident" id="3293726">err</span>&nbsp;<span class="op" id="3293730">:=</span>&nbsp;<span class="ident" id="3293733">addr</span><span class="op" id="3293737">.</span><span class="ident" id="3293738">sockaddr</span><span class="op" id="3293746">(</span><span class="ident" id="3293747">c</span><span class="op" id="3293748">.</span><span class="ident" id="3293749">fd</span><span class="op" id="3293751">.</span><span class="ident" id="3293752">family</span><span class="op" id="3293758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293761">if</span>&nbsp;<span class="ident" id="3293764">err</span>&nbsp;<span class="op" id="3293768">!=</span>&nbsp;<span class="builtintype" id="3293771">nil</span>&nbsp;<span class="op" id="3293775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293779">return</span>&nbsp;<span class="num" id="3293786">0</span><span class="op" id="3293787">,</span>&nbsp;<span class="op" id="3293789">&amp;</span><span class="ident" id="3293790">OpError</span><span class="op" id="3293797">{</span><span class="string" id="3293798">&#34;write&#34;</span><span class="op" id="3293805">,</span>&nbsp;<span class="ident" id="3293807">c</span><span class="op" id="3293808">.</span><span class="ident" id="3293809">fd</span><span class="op" id="3293811">.</span><span class="ident" id="3293812">net</span><span class="op" id="3293815">,</span>&nbsp;<span class="ident" id="3293817">addr</span><span class="op" id="3293821">,</span>&nbsp;<span class="ident" id="3293823">err</span><span class="op" id="3293826">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293832">return</span>&nbsp;<span class="ident" id="3293839">c</span><span class="op" id="3293840">.</span><span class="ident" id="3293841">fd</span><span class="op" id="3293843">.</span><span class="ident" id="3293844">writeTo</span><span class="op" id="3293851">(</span><span class="ident" id="3293852">b</span><span class="op" id="3293853">,</span>&nbsp;<span class="ident" id="3293855">sa</span><span class="op" id="3293857">)</span><br>
<span class="lineno"></span><span class="op" id="3293859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3293862">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno">150</span><span class="keyword" id="3293915">func</span>&nbsp;<span class="op" id="3293920">(</span><span class="ident" id="3293921">c</span>&nbsp;<span class="op" id="3293923">*</span><span class="ident" id="3293924">IPConn</span><span class="op" id="3293930">)</span>&nbsp;<span class="ident" id="3293932">WriteTo</span><span class="op" id="3293939">(</span><span class="ident" id="3293940">b</span>&nbsp;<span class="op" id="3293942">[</span><span class="op" id="3293943">]</span><span class="builtintype" id="3293944">byte</span><span class="op" id="3293948">,</span>&nbsp;<span class="ident" id="3293950">addr</span>&nbsp;<span class="ident" id="3293955">Addr</span><span class="op" id="3293959">)</span>&nbsp;<span class="op" id="3293961">(</span><span class="builtintype" id="3293962">int</span><span class="op" id="3293965">,</span>&nbsp;<span class="builtintype" id="3293967">error</span><span class="op" id="3293972">)</span>&nbsp;<span class="op" id="3293974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293977">if</span>&nbsp;<span class="op" id="3293980">!</span><span class="ident" id="3293981">c</span><span class="op" id="3293982">.</span><span class="ident" id="3293983">ok</span><span class="op" id="3293985">(</span><span class="op" id="3293986">)</span>&nbsp;<span class="op" id="3293988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293992">return</span>&nbsp;<span class="num" id="3293999">0</span><span class="op" id="3294000">,</span>&nbsp;<span class="ident" id="3294002">syscall</span><span class="op" id="3294009">.</span><span class="ident" id="3294010">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294021">a</span><span class="op" id="3294022">,</span>&nbsp;<span class="ident" id="3294024">ok</span>&nbsp;<span class="op" id="3294027">:=</span>&nbsp;<span class="ident" id="3294030">addr</span><span class="op" id="3294034">.</span><span class="op" id="3294035">(</span><span class="op" id="3294036">*</span><span class="ident" id="3294037">IPAddr</span><span class="op" id="3294043">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294046">if</span>&nbsp;<span class="op" id="3294049">!</span><span class="ident" id="3294050">ok</span>&nbsp;<span class="op" id="3294053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294057">return</span>&nbsp;<span class="num" id="3294064">0</span><span class="op" id="3294065">,</span>&nbsp;<span class="op" id="3294067">&amp;</span><span class="ident" id="3294068">OpError</span><span class="op" id="3294075">{</span><span class="string" id="3294076">&#34;write&#34;</span><span class="op" id="3294083">,</span>&nbsp;<span class="ident" id="3294085">c</span><span class="op" id="3294086">.</span><span class="ident" id="3294087">fd</span><span class="op" id="3294089">.</span><span class="ident" id="3294090">net</span><span class="op" id="3294093">,</span>&nbsp;<span class="ident" id="3294095">addr</span><span class="op" id="3294099">,</span>&nbsp;<span class="ident" id="3294101">syscall</span><span class="op" id="3294108">.</span><span class="ident" id="3294109">EINVAL</span><span class="op" id="3294115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294121">return</span>&nbsp;<span class="ident" id="3294128">c</span><span class="op" id="3294129">.</span><span class="ident" id="3294130">WriteToIP</span><span class="op" id="3294139">(</span><span class="ident" id="3294140">b</span><span class="op" id="3294141">,</span>&nbsp;<span class="ident" id="3294143">a</span><span class="op" id="3294144">)</span><br>
<span class="lineno"></span><span class="op" id="3294146">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3294149">//&nbsp;WriteMsgIP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3294219">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3294286">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="3294338">func</span>&nbsp;<span class="op" id="3294343">(</span><span class="ident" id="3294344">c</span>&nbsp;<span class="op" id="3294346">*</span><span class="ident" id="3294347">IPConn</span><span class="op" id="3294353">)</span>&nbsp;<span class="ident" id="3294355">WriteMsgIP</span><span class="op" id="3294365">(</span><span class="ident" id="3294366">b</span><span class="op" id="3294367">,</span>&nbsp;<span class="ident" id="3294369">oob</span>&nbsp;<span class="op" id="3294373">[</span><span class="op" id="3294374">]</span><span class="builtintype" id="3294375">byte</span><span class="op" id="3294379">,</span>&nbsp;<span class="ident" id="3294381">addr</span>&nbsp;<span class="op" id="3294386">*</span><span class="ident" id="3294387">IPAddr</span><span class="op" id="3294393">)</span>&nbsp;<span class="op" id="3294395">(</span><span class="ident" id="3294396">n</span><span class="op" id="3294397">,</span>&nbsp;<span class="ident" id="3294399">oobn</span>&nbsp;<span class="builtintype" id="3294404">int</span><span class="op" id="3294407">,</span>&nbsp;<span class="ident" id="3294409">err</span>&nbsp;<span class="builtintype" id="3294413">error</span><span class="op" id="3294418">)</span>&nbsp;<span class="op" id="3294420">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294423">if</span>&nbsp;<span class="op" id="3294426">!</span><span class="ident" id="3294427">c</span><span class="op" id="3294428">.</span><span class="ident" id="3294429">ok</span><span class="op" id="3294431">(</span><span class="op" id="3294432">)</span>&nbsp;<span class="op" id="3294434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294438">return</span>&nbsp;<span class="num" id="3294445">0</span><span class="op" id="3294446">,</span>&nbsp;<span class="num" id="3294448">0</span><span class="op" id="3294449">,</span>&nbsp;<span class="ident" id="3294451">syscall</span><span class="op" id="3294458">.</span><span class="ident" id="3294459">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294470">if</span>&nbsp;<span class="ident" id="3294473">c</span><span class="op" id="3294474">.</span><span class="ident" id="3294475">fd</span><span class="op" id="3294477">.</span><span class="ident" id="3294478">isConnected</span>&nbsp;<span class="op" id="3294490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294494">return</span>&nbsp;<span class="num" id="3294501">0</span><span class="op" id="3294502">,</span>&nbsp;<span class="num" id="3294504">0</span><span class="op" id="3294505">,</span>&nbsp;<span class="op" id="3294507">&amp;</span><span class="ident" id="3294508">OpError</span><span class="op" id="3294515">{</span><span class="ident" id="3294516">Op</span><span class="op" id="3294518">:</span>&nbsp;<span class="string" id="3294520">&#34;write&#34;</span><span class="op" id="3294527">,</span>&nbsp;<span class="ident" id="3294529">Net</span><span class="op" id="3294532">:</span>&nbsp;<span class="ident" id="3294534">c</span><span class="op" id="3294535">.</span><span class="ident" id="3294536">fd</span><span class="op" id="3294538">.</span><span class="ident" id="3294539">net</span><span class="op" id="3294542">,</span>&nbsp;<span class="ident" id="3294544">Addr</span><span class="op" id="3294548">:</span>&nbsp;<span class="ident" id="3294550">addr</span><span class="op" id="3294554">,</span>&nbsp;<span class="ident" id="3294556">Err</span><span class="op" id="3294559">:</span>&nbsp;<span class="ident" id="3294561">ErrWriteToConnected</span><span class="op" id="3294580">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294586">if</span>&nbsp;<span class="ident" id="3294589">addr</span>&nbsp;<span class="op" id="3294594">==</span>&nbsp;<span class="builtintype" id="3294597">nil</span>&nbsp;<span class="op" id="3294601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294605">return</span>&nbsp;<span class="num" id="3294612">0</span><span class="op" id="3294613">,</span>&nbsp;<span class="num" id="3294615">0</span><span class="op" id="3294616">,</span>&nbsp;<span class="op" id="3294618">&amp;</span><span class="ident" id="3294619">OpError</span><span class="op" id="3294626">{</span><span class="ident" id="3294627">Op</span><span class="op" id="3294629">:</span>&nbsp;<span class="string" id="3294631">&#34;write&#34;</span><span class="op" id="3294638">,</span>&nbsp;<span class="ident" id="3294640">Net</span><span class="op" id="3294643">:</span>&nbsp;<span class="ident" id="3294645">c</span><span class="op" id="3294646">.</span><span class="ident" id="3294647">fd</span><span class="op" id="3294649">.</span><span class="ident" id="3294650">net</span><span class="op" id="3294653">,</span>&nbsp;<span class="ident" id="3294655">Addr</span><span class="op" id="3294659">:</span>&nbsp;<span class="builtintype" id="3294661">nil</span><span class="op" id="3294664">,</span>&nbsp;<span class="ident" id="3294666">Err</span><span class="op" id="3294669">:</span>&nbsp;<span class="ident" id="3294671">errMissingAddress</span><span class="op" id="3294688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294694">sa</span><span class="op" id="3294696">,</span>&nbsp;<span class="ident" id="3294698">err</span>&nbsp;<span class="op" id="3294702">:=</span>&nbsp;<span class="ident" id="3294705">addr</span><span class="op" id="3294709">.</span><span class="ident" id="3294710">sockaddr</span><span class="op" id="3294718">(</span><span class="ident" id="3294719">c</span><span class="op" id="3294720">.</span><span class="ident" id="3294721">fd</span><span class="op" id="3294723">.</span><span class="ident" id="3294724">family</span><span class="op" id="3294730">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294733">if</span>&nbsp;<span class="ident" id="3294736">err</span>&nbsp;<span class="op" id="3294740">!=</span>&nbsp;<span class="builtintype" id="3294743">nil</span>&nbsp;<span class="op" id="3294747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294751">return</span>&nbsp;<span class="num" id="3294758">0</span><span class="op" id="3294759">,</span>&nbsp;<span class="num" id="3294761">0</span><span class="op" id="3294762">,</span>&nbsp;<span class="op" id="3294764">&amp;</span><span class="ident" id="3294765">OpError</span><span class="op" id="3294772">{</span><span class="string" id="3294773">&#34;write&#34;</span><span class="op" id="3294780">,</span>&nbsp;<span class="ident" id="3294782">c</span><span class="op" id="3294783">.</span><span class="ident" id="3294784">fd</span><span class="op" id="3294786">.</span><span class="ident" id="3294787">net</span><span class="op" id="3294790">,</span>&nbsp;<span class="ident" id="3294792">addr</span><span class="op" id="3294796">,</span>&nbsp;<span class="ident" id="3294798">err</span><span class="op" id="3294801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294807">return</span>&nbsp;<span class="ident" id="3294814">c</span><span class="op" id="3294815">.</span><span class="ident" id="3294816">fd</span><span class="op" id="3294818">.</span><span class="ident" id="3294819">writeMsg</span><span class="op" id="3294827">(</span><span class="ident" id="3294828">b</span><span class="op" id="3294829">,</span>&nbsp;<span class="ident" id="3294831">oob</span><span class="op" id="3294834">,</span>&nbsp;<span class="ident" id="3294836">sa</span><span class="op" id="3294838">)</span><br>
<span class="lineno"></span><span class="op" id="3294840">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="3294843">//&nbsp;DialIP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;protocol</span><br>
<span class="lineno"></span><span class="comment" id="3294914">//&nbsp;netProto,&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon</span><br>
<span class="lineno"></span><span class="comment" id="3294983">//&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3295017">func</span>&nbsp;<span class="ident" id="3295022">DialIP</span><span class="op" id="3295028">(</span><span class="ident" id="3295029">netProto</span>&nbsp;<span class="builtintype" id="3295038">string</span><span class="op" id="3295044">,</span>&nbsp;<span class="ident" id="3295046">laddr</span><span class="op" id="3295051">,</span>&nbsp;<span class="ident" id="3295053">raddr</span>&nbsp;<span class="op" id="3295059">*</span><span class="ident" id="3295060">IPAddr</span><span class="op" id="3295066">)</span>&nbsp;<span class="op" id="3295068">(</span><span class="op" id="3295069">*</span><span class="ident" id="3295070">IPConn</span><span class="op" id="3295076">,</span>&nbsp;<span class="builtintype" id="3295078">error</span><span class="op" id="3295083">)</span>&nbsp;<span class="op" id="3295085">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295088">return</span>&nbsp;<span class="ident" id="3295095">dialIP</span><span class="op" id="3295101">(</span><span class="ident" id="3295102">netProto</span><span class="op" id="3295110">,</span>&nbsp;<span class="ident" id="3295112">laddr</span><span class="op" id="3295117">,</span>&nbsp;<span class="ident" id="3295119">raddr</span><span class="op" id="3295124">,</span>&nbsp;<span class="ident" id="3295126">noDeadline</span><span class="op" id="3295136">)</span><br>
<span class="lineno"></span><span class="op" id="3295138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3295141">func</span>&nbsp;<span class="ident" id="3295146">dialIP</span><span class="op" id="3295152">(</span><span class="ident" id="3295153">netProto</span>&nbsp;<span class="builtintype" id="3295162">string</span><span class="op" id="3295168">,</span>&nbsp;<span class="ident" id="3295170">laddr</span><span class="op" id="3295175">,</span>&nbsp;<span class="ident" id="3295177">raddr</span>&nbsp;<span class="op" id="3295183">*</span><span class="ident" id="3295184">IPAddr</span><span class="op" id="3295190">,</span>&nbsp;<span class="ident" id="3295192">deadline</span>&nbsp;<span class="ident" id="3295201">time</span><span class="op" id="3295205">.</span><span class="ident" id="3295206">Time</span><span class="op" id="3295210">)</span>&nbsp;<span class="op" id="3295212">(</span><span class="op" id="3295213">*</span><span class="ident" id="3295214">IPConn</span><span class="op" id="3295220">,</span>&nbsp;<span class="builtintype" id="3295222">error</span><span class="op" id="3295227">)</span>&nbsp;<span class="op" id="3295229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295232">net</span><span class="op" id="3295235">,</span>&nbsp;<span class="ident" id="3295237">proto</span><span class="op" id="3295242">,</span>&nbsp;<span class="ident" id="3295244">err</span>&nbsp;<span class="op" id="3295248">:=</span>&nbsp;<span class="ident" id="3295251">parseNetwork</span><span class="op" id="3295263">(</span><span class="ident" id="3295264">netProto</span><span class="op" id="3295272">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295275">if</span>&nbsp;<span class="ident" id="3295278">err</span>&nbsp;<span class="op" id="3295282">!=</span>&nbsp;<span class="builtintype" id="3295285">nil</span>&nbsp;<span class="op" id="3295289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295293">return</span>&nbsp;<span class="builtintype" id="3295300">nil</span><span class="op" id="3295303">,</span>&nbsp;<span class="op" id="3295305">&amp;</span><span class="ident" id="3295306">OpError</span><span class="op" id="3295313">{</span><span class="ident" id="3295314">Op</span><span class="op" id="3295316">:</span>&nbsp;<span class="string" id="3295318">&#34;dial&#34;</span><span class="op" id="3295324">,</span>&nbsp;<span class="ident" id="3295326">Net</span><span class="op" id="3295329">:</span>&nbsp;<span class="ident" id="3295331">netProto</span><span class="op" id="3295339">,</span>&nbsp;<span class="ident" id="3295341">Addr</span><span class="op" id="3295345">:</span>&nbsp;<span class="ident" id="3295347">raddr</span><span class="op" id="3295352">,</span>&nbsp;<span class="ident" id="3295354">Err</span><span class="op" id="3295357">:</span>&nbsp;<span class="ident" id="3295359">err</span><span class="op" id="3295362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295368">switch</span>&nbsp;<span class="ident" id="3295375">net</span>&nbsp;<span class="op" id="3295379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295382">case</span>&nbsp;<span class="string" id="3295387">&#34;ip&#34;</span><span class="op" id="3295391">,</span>&nbsp;<span class="string" id="3295393">&#34;ip4&#34;</span><span class="op" id="3295398">,</span>&nbsp;<span class="string" id="3295400">&#34;ip6&#34;</span><span class="op" id="3295405">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295408">default</span><span class="op" id="3295415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295419">return</span>&nbsp;<span class="builtintype" id="3295426">nil</span><span class="op" id="3295429">,</span>&nbsp;<span class="op" id="3295431">&amp;</span><span class="ident" id="3295432">OpError</span><span class="op" id="3295439">{</span><span class="ident" id="3295440">Op</span><span class="op" id="3295442">:</span>&nbsp;<span class="string" id="3295444">&#34;dial&#34;</span><span class="op" id="3295450">,</span>&nbsp;<span class="ident" id="3295452">Net</span><span class="op" id="3295455">:</span>&nbsp;<span class="ident" id="3295457">netProto</span><span class="op" id="3295465">,</span>&nbsp;<span class="ident" id="3295467">Addr</span><span class="op" id="3295471">:</span>&nbsp;<span class="ident" id="3295473">raddr</span><span class="op" id="3295478">,</span>&nbsp;<span class="ident" id="3295480">Err</span><span class="op" id="3295483">:</span>&nbsp;<span class="ident" id="3295485">UnknownNetworkError</span><span class="op" id="3295504">(</span><span class="ident" id="3295505">netProto</span><span class="op" id="3295513">)</span><span class="op" id="3295514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295520">if</span>&nbsp;<span class="ident" id="3295523">raddr</span>&nbsp;<span class="op" id="3295529">==</span>&nbsp;<span class="builtintype" id="3295532">nil</span>&nbsp;<span class="op" id="3295536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295540">return</span>&nbsp;<span class="builtintype" id="3295547">nil</span><span class="op" id="3295550">,</span>&nbsp;<span class="op" id="3295552">&amp;</span><span class="ident" id="3295553">OpError</span><span class="op" id="3295560">{</span><span class="ident" id="3295561">Op</span><span class="op" id="3295563">:</span>&nbsp;<span class="string" id="3295565">&#34;dial&#34;</span><span class="op" id="3295571">,</span>&nbsp;<span class="ident" id="3295573">Net</span><span class="op" id="3295576">:</span>&nbsp;<span class="ident" id="3295578">netProto</span><span class="op" id="3295586">,</span>&nbsp;<span class="ident" id="3295588">Addr</span><span class="op" id="3295592">:</span>&nbsp;<span class="builtintype" id="3295594">nil</span><span class="op" id="3295597">,</span>&nbsp;<span class="ident" id="3295599">Err</span><span class="op" id="3295602">:</span>&nbsp;<span class="ident" id="3295604">errMissingAddress</span><span class="op" id="3295621">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295627">fd</span><span class="op" id="3295629">,</span>&nbsp;<span class="ident" id="3295631">err</span>&nbsp;<span class="op" id="3295635">:=</span>&nbsp;<span class="ident" id="3295638">internetSocket</span><span class="op" id="3295652">(</span><span class="ident" id="3295653">net</span><span class="op" id="3295656">,</span>&nbsp;<span class="ident" id="3295658">laddr</span><span class="op" id="3295663">,</span>&nbsp;<span class="ident" id="3295665">raddr</span><span class="op" id="3295670">,</span>&nbsp;<span class="ident" id="3295672">deadline</span><span class="op" id="3295680">,</span>&nbsp;<span class="ident" id="3295682">syscall</span><span class="op" id="3295689">.</span><span class="ident" id="3295690">SOCK_RAW</span><span class="op" id="3295698">,</span>&nbsp;<span class="ident" id="3295700">proto</span><span class="op" id="3295705">,</span>&nbsp;<span class="string" id="3295707">&#34;dial&#34;</span><span class="op" id="3295713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295716">if</span>&nbsp;<span class="ident" id="3295719">err</span>&nbsp;<span class="op" id="3295723">!=</span>&nbsp;<span class="builtintype" id="3295726">nil</span>&nbsp;<span class="op" id="3295730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295734">return</span>&nbsp;<span class="builtintype" id="3295741">nil</span><span class="op" id="3295744">,</span>&nbsp;<span class="op" id="3295746">&amp;</span><span class="ident" id="3295747">OpError</span><span class="op" id="3295754">{</span><span class="ident" id="3295755">Op</span><span class="op" id="3295757">:</span>&nbsp;<span class="string" id="3295759">&#34;dial&#34;</span><span class="op" id="3295765">,</span>&nbsp;<span class="ident" id="3295767">Net</span><span class="op" id="3295770">:</span>&nbsp;<span class="ident" id="3295772">netProto</span><span class="op" id="3295780">,</span>&nbsp;<span class="ident" id="3295782">Addr</span><span class="op" id="3295786">:</span>&nbsp;<span class="ident" id="3295788">raddr</span><span class="op" id="3295793">,</span>&nbsp;<span class="ident" id="3295795">Err</span><span class="op" id="3295798">:</span>&nbsp;<span class="ident" id="3295800">err</span><span class="op" id="3295803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295806">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295809">return</span>&nbsp;<span class="ident" id="3295816">newIPConn</span><span class="op" id="3295825">(</span><span class="ident" id="3295826">fd</span><span class="op" id="3295828">)</span><span class="op" id="3295829">,</span>&nbsp;<span class="builtintype" id="3295831">nil</span><br>
<span class="lineno"></span><span class="op" id="3295835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3295838">//&nbsp;ListenIP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;IP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3295905">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">210</span><span class="comment" id="3295971">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;IP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3296041">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3296056">func</span>&nbsp;<span class="ident" id="3296061">ListenIP</span><span class="op" id="3296069">(</span><span class="ident" id="3296070">netProto</span>&nbsp;<span class="builtintype" id="3296079">string</span><span class="op" id="3296085">,</span>&nbsp;<span class="ident" id="3296087">laddr</span>&nbsp;<span class="op" id="3296093">*</span><span class="ident" id="3296094">IPAddr</span><span class="op" id="3296100">)</span>&nbsp;<span class="op" id="3296102">(</span><span class="op" id="3296103">*</span><span class="ident" id="3296104">IPConn</span><span class="op" id="3296110">,</span>&nbsp;<span class="builtintype" id="3296112">error</span><span class="op" id="3296117">)</span>&nbsp;<span class="op" id="3296119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296122">net</span><span class="op" id="3296125">,</span>&nbsp;<span class="ident" id="3296127">proto</span><span class="op" id="3296132">,</span>&nbsp;<span class="ident" id="3296134">err</span>&nbsp;<span class="op" id="3296138">:=</span>&nbsp;<span class="ident" id="3296141">parseNetwork</span><span class="op" id="3296153">(</span><span class="ident" id="3296154">netProto</span><span class="op" id="3296162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296165">if</span>&nbsp;<span class="ident" id="3296168">err</span>&nbsp;<span class="op" id="3296172">!=</span>&nbsp;<span class="builtintype" id="3296175">nil</span>&nbsp;<span class="op" id="3296179">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296183">return</span>&nbsp;<span class="builtintype" id="3296190">nil</span><span class="op" id="3296193">,</span>&nbsp;<span class="op" id="3296195">&amp;</span><span class="ident" id="3296196">OpError</span><span class="op" id="3296203">{</span><span class="ident" id="3296204">Op</span><span class="op" id="3296206">:</span>&nbsp;<span class="string" id="3296208">&#34;dial&#34;</span><span class="op" id="3296214">,</span>&nbsp;<span class="ident" id="3296216">Net</span><span class="op" id="3296219">:</span>&nbsp;<span class="ident" id="3296221">netProto</span><span class="op" id="3296229">,</span>&nbsp;<span class="ident" id="3296231">Addr</span><span class="op" id="3296235">:</span>&nbsp;<span class="ident" id="3296237">laddr</span><span class="op" id="3296242">,</span>&nbsp;<span class="ident" id="3296244">Err</span><span class="op" id="3296247">:</span>&nbsp;<span class="ident" id="3296249">err</span><span class="op" id="3296252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296258">switch</span>&nbsp;<span class="ident" id="3296265">net</span>&nbsp;<span class="op" id="3296269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296272">case</span>&nbsp;<span class="string" id="3296277">&#34;ip&#34;</span><span class="op" id="3296281">,</span>&nbsp;<span class="string" id="3296283">&#34;ip4&#34;</span><span class="op" id="3296288">,</span>&nbsp;<span class="string" id="3296290">&#34;ip6&#34;</span><span class="op" id="3296295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296298">default</span><span class="op" id="3296305">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296309">return</span>&nbsp;<span class="builtintype" id="3296316">nil</span><span class="op" id="3296319">,</span>&nbsp;<span class="op" id="3296321">&amp;</span><span class="ident" id="3296322">OpError</span><span class="op" id="3296329">{</span><span class="ident" id="3296330">Op</span><span class="op" id="3296332">:</span>&nbsp;<span class="string" id="3296334">&#34;listen&#34;</span><span class="op" id="3296342">,</span>&nbsp;<span class="ident" id="3296344">Net</span><span class="op" id="3296347">:</span>&nbsp;<span class="ident" id="3296349">netProto</span><span class="op" id="3296357">,</span>&nbsp;<span class="ident" id="3296359">Addr</span><span class="op" id="3296363">:</span>&nbsp;<span class="ident" id="3296365">laddr</span><span class="op" id="3296370">,</span>&nbsp;<span class="ident" id="3296372">Err</span><span class="op" id="3296375">:</span>&nbsp;<span class="ident" id="3296377">UnknownNetworkError</span><span class="op" id="3296396">(</span><span class="ident" id="3296397">netProto</span><span class="op" id="3296405">)</span><span class="op" id="3296406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296412">fd</span><span class="op" id="3296414">,</span>&nbsp;<span class="ident" id="3296416">err</span>&nbsp;<span class="op" id="3296420">:=</span>&nbsp;<span class="ident" id="3296423">internetSocket</span><span class="op" id="3296437">(</span><span class="ident" id="3296438">net</span><span class="op" id="3296441">,</span>&nbsp;<span class="ident" id="3296443">laddr</span><span class="op" id="3296448">,</span>&nbsp;<span class="builtintype" id="3296450">nil</span><span class="op" id="3296453">,</span>&nbsp;<span class="ident" id="3296455">noDeadline</span><span class="op" id="3296465">,</span>&nbsp;<span class="ident" id="3296467">syscall</span><span class="op" id="3296474">.</span><span class="ident" id="3296475">SOCK_RAW</span><span class="op" id="3296483">,</span>&nbsp;<span class="ident" id="3296485">proto</span><span class="op" id="3296490">,</span>&nbsp;<span class="string" id="3296492">&#34;listen&#34;</span><span class="op" id="3296500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296503">if</span>&nbsp;<span class="ident" id="3296506">err</span>&nbsp;<span class="op" id="3296510">!=</span>&nbsp;<span class="builtintype" id="3296513">nil</span>&nbsp;<span class="op" id="3296517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296521">return</span>&nbsp;<span class="builtintype" id="3296528">nil</span><span class="op" id="3296531">,</span>&nbsp;<span class="op" id="3296533">&amp;</span><span class="ident" id="3296534">OpError</span><span class="op" id="3296541">{</span><span class="ident" id="3296542">Op</span><span class="op" id="3296544">:</span>&nbsp;<span class="string" id="3296546">&#34;listen&#34;</span><span class="op" id="3296554">,</span>&nbsp;<span class="ident" id="3296556">Net</span><span class="op" id="3296559">:</span>&nbsp;<span class="ident" id="3296561">netProto</span><span class="op" id="3296569">,</span>&nbsp;<span class="ident" id="3296571">Addr</span><span class="op" id="3296575">:</span>&nbsp;<span class="ident" id="3296577">laddr</span><span class="op" id="3296582">,</span>&nbsp;<span class="ident" id="3296584">Err</span><span class="op" id="3296587">:</span>&nbsp;<span class="ident" id="3296589">err</span><span class="op" id="3296592">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296598">return</span>&nbsp;<span class="ident" id="3296605">newIPConn</span><span class="op" id="3296614">(</span><span class="ident" id="3296615">fd</span><span class="op" id="3296617">)</span><span class="op" id="3296618">,</span>&nbsp;<span class="builtintype" id="3296620">nil</span><br>
<span class="lineno"></span><span class="op" id="3296624">}</span>
</div>
</body>
</html>
