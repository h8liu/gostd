<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html" class="current">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7966413">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7966468">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7966522">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7966573">package</span>&nbsp;<span class="ident" id="7966581">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7966588">import</span>&nbsp;<span class="op" id="7966595">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7966598">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7966605">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7966618">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7966626">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7966636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7966639">func</span>&nbsp;<span class="ident" id="7966644">checkPos</span><span class="op" id="7966652">(</span><span class="ident" id="7966653">t</span>&nbsp;<span class="op" id="7966655">*</span><span class="ident" id="7966656">testing</span><span class="op" id="7966663">.</span><span class="ident" id="7966664">T</span><span class="op" id="7966665">,</span>&nbsp;<span class="ident" id="7966667">msg</span>&nbsp;<span class="builtintype" id="7966671">string</span><span class="op" id="7966677">,</span>&nbsp;<span class="ident" id="7966679">got</span><span class="op" id="7966682">,</span>&nbsp;<span class="ident" id="7966684">want</span>&nbsp;<span class="ident" id="7966689">Position</span><span class="op" id="7966697">)</span>&nbsp;<span class="op" id="7966699">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7966702">if</span>&nbsp;<span class="ident" id="7966705">got</span><span class="op" id="7966708">.</span><span class="ident" id="7966709">Filename</span>&nbsp;<span class="op" id="7966718">!=</span>&nbsp;<span class="ident" id="7966721">want</span><span class="op" id="7966725">.</span><span class="ident" id="7966726">Filename</span>&nbsp;<span class="op" id="7966735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7966739">t</span><span class="op" id="7966740">.</span><span class="ident" id="7966741">Errorf</span><span class="op" id="7966747">(</span><span class="string" id="7966748">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7966780">,</span>&nbsp;<span class="ident" id="7966782">msg</span><span class="op" id="7966785">,</span>&nbsp;<span class="ident" id="7966787">got</span><span class="op" id="7966790">.</span><span class="ident" id="7966791">Filename</span><span class="op" id="7966799">,</span>&nbsp;<span class="ident" id="7966801">want</span><span class="op" id="7966805">.</span><span class="ident" id="7966806">Filename</span><span class="op" id="7966814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7966817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7966820">if</span>&nbsp;<span class="ident" id="7966823">got</span><span class="op" id="7966826">.</span><span class="ident" id="7966827">Offset</span>&nbsp;<span class="op" id="7966834">!=</span>&nbsp;<span class="ident" id="7966837">want</span><span class="op" id="7966841">.</span><span class="ident" id="7966842">Offset</span>&nbsp;<span class="op" id="7966849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7966853">t</span><span class="op" id="7966854">.</span><span class="ident" id="7966855">Errorf</span><span class="op" id="7966861">(</span><span class="string" id="7966862">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7966892">,</span>&nbsp;<span class="ident" id="7966894">msg</span><span class="op" id="7966897">,</span>&nbsp;<span class="ident" id="7966899">got</span><span class="op" id="7966902">.</span><span class="ident" id="7966903">Offset</span><span class="op" id="7966909">,</span>&nbsp;<span class="ident" id="7966911">want</span><span class="op" id="7966915">.</span><span class="ident" id="7966916">Offset</span><span class="op" id="7966922">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7966925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7966928">if</span>&nbsp;<span class="ident" id="7966931">got</span><span class="op" id="7966934">.</span><span class="ident" id="7966935">Line</span>&nbsp;<span class="op" id="7966940">!=</span>&nbsp;<span class="ident" id="7966943">want</span><span class="op" id="7966947">.</span><span class="ident" id="7966948">Line</span>&nbsp;<span class="op" id="7966953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7966957">t</span><span class="op" id="7966958">.</span><span class="ident" id="7966959">Errorf</span><span class="op" id="7966965">(</span><span class="string" id="7966966">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7966994">,</span>&nbsp;<span class="ident" id="7966996">msg</span><span class="op" id="7966999">,</span>&nbsp;<span class="ident" id="7967001">got</span><span class="op" id="7967004">.</span><span class="ident" id="7967005">Line</span><span class="op" id="7967009">,</span>&nbsp;<span class="ident" id="7967011">want</span><span class="op" id="7967015">.</span><span class="ident" id="7967016">Line</span><span class="op" id="7967020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7967026">if</span>&nbsp;<span class="ident" id="7967029">got</span><span class="op" id="7967032">.</span><span class="ident" id="7967033">Column</span>&nbsp;<span class="op" id="7967040">!=</span>&nbsp;<span class="ident" id="7967043">want</span><span class="op" id="7967047">.</span><span class="ident" id="7967048">Column</span>&nbsp;<span class="op" id="7967055">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967059">t</span><span class="op" id="7967060">.</span><span class="ident" id="7967061">Errorf</span><span class="op" id="7967067">(</span><span class="string" id="7967068">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7967098">,</span>&nbsp;<span class="ident" id="7967100">msg</span><span class="op" id="7967103">,</span>&nbsp;<span class="ident" id="7967105">got</span><span class="op" id="7967108">.</span><span class="ident" id="7967109">Column</span><span class="op" id="7967115">,</span>&nbsp;<span class="ident" id="7967117">want</span><span class="op" id="7967121">.</span><span class="ident" id="7967122">Column</span><span class="op" id="7967128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967131">}</span><br>
<span class="lineno"></span><span class="op" id="7967133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7967136">func</span>&nbsp;<span class="ident" id="7967141">TestNoPos</span><span class="op" id="7967150">(</span><span class="ident" id="7967151">t</span>&nbsp;<span class="op" id="7967153">*</span><span class="ident" id="7967154">testing</span><span class="op" id="7967161">.</span><span class="ident" id="7967162">T</span><span class="op" id="7967163">)</span>&nbsp;<span class="op" id="7967165">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7967168">if</span>&nbsp;<span class="ident" id="7967171">NoPos</span><span class="op" id="7967176">.</span><span class="ident" id="7967177">IsValid</span><span class="op" id="7967184">(</span><span class="op" id="7967185">)</span>&nbsp;<span class="op" id="7967187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967191">t</span><span class="op" id="7967192">.</span><span class="ident" id="7967193">Errorf</span><span class="op" id="7967199">(</span><span class="string" id="7967200">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7967227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7967233">var</span>&nbsp;<span class="ident" id="7967237">fset</span>&nbsp;<span class="op" id="7967242">*</span><span class="ident" id="7967243">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967252">checkPos</span><span class="op" id="7967260">(</span><span class="ident" id="7967261">t</span><span class="op" id="7967262">,</span>&nbsp;<span class="string" id="7967264">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7967275">,</span>&nbsp;<span class="ident" id="7967277">fset</span><span class="op" id="7967281">.</span><span class="ident" id="7967282">Position</span><span class="op" id="7967290">(</span><span class="ident" id="7967291">NoPos</span><span class="op" id="7967296">)</span><span class="op" id="7967297">,</span>&nbsp;<span class="ident" id="7967299">Position</span><span class="op" id="7967307">{</span><span class="op" id="7967308">}</span><span class="op" id="7967309">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967312">fset</span>&nbsp;<span class="op" id="7967317">=</span>&nbsp;<span class="ident" id="7967319">NewFileSet</span><span class="op" id="7967329">(</span><span class="op" id="7967330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967333">checkPos</span><span class="op" id="7967341">(</span><span class="ident" id="7967342">t</span><span class="op" id="7967343">,</span>&nbsp;<span class="string" id="7967345">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7967357">,</span>&nbsp;<span class="ident" id="7967359">fset</span><span class="op" id="7967363">.</span><span class="ident" id="7967364">Position</span><span class="op" id="7967372">(</span><span class="ident" id="7967373">NoPos</span><span class="op" id="7967378">)</span><span class="op" id="7967379">,</span>&nbsp;<span class="ident" id="7967381">Position</span><span class="op" id="7967389">{</span><span class="op" id="7967390">}</span><span class="op" id="7967391">)</span><br>
<span class="lineno"></span><span class="op" id="7967393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7967396">var</span>&nbsp;<span class="ident" id="7967400">tests</span>&nbsp;<span class="op" id="7967406">=</span>&nbsp;<span class="op" id="7967408">[</span><span class="op" id="7967409">]</span><span class="keyword" id="7967410">struct</span>&nbsp;<span class="op" id="7967417">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967420">filename</span>&nbsp;<span class="builtintype" id="7967429">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967437">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7967446">[</span><span class="op" id="7967447">]</span><span class="builtintype" id="7967448">byte</span>&nbsp;<span class="comment" id="7967453">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967468">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7967477">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7967482">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7967491">[</span><span class="op" id="7967492">]</span><span class="builtintype" id="7967493">int</span><br>
<span class="lineno"></span><span class="op" id="7967497">}</span><span class="op" id="7967498">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967501">{</span><span class="string" id="7967502">&#34;a&#34;</span><span class="op" id="7967505">,</span>&nbsp;<span class="op" id="7967507">[</span><span class="op" id="7967508">]</span><span class="builtintype" id="7967509">byte</span><span class="op" id="7967513">{</span><span class="op" id="7967514">}</span><span class="op" id="7967515">,</span>&nbsp;<span class="num" id="7967517">0</span><span class="op" id="7967518">,</span>&nbsp;<span class="op" id="7967520">[</span><span class="op" id="7967521">]</span><span class="builtintype" id="7967522">int</span><span class="op" id="7967525">{</span><span class="op" id="7967526">}</span><span class="op" id="7967527">}</span><span class="op" id="7967528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967531">{</span><span class="string" id="7967532">&#34;b&#34;</span><span class="op" id="7967535">,</span>&nbsp;<span class="op" id="7967537">[</span><span class="op" id="7967538">]</span><span class="builtintype" id="7967539">byte</span><span class="op" id="7967543">(</span><span class="string" id="7967544">&#34;01234&#34;</span><span class="op" id="7967551">)</span><span class="op" id="7967552">,</span>&nbsp;<span class="num" id="7967554">5</span><span class="op" id="7967555">,</span>&nbsp;<span class="op" id="7967557">[</span><span class="op" id="7967558">]</span><span class="builtintype" id="7967559">int</span><span class="op" id="7967562">{</span><span class="num" id="7967563">0</span><span class="op" id="7967564">}</span><span class="op" id="7967565">}</span><span class="op" id="7967566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967569">{</span><span class="string" id="7967570">&#34;c&#34;</span><span class="op" id="7967573">,</span>&nbsp;<span class="op" id="7967575">[</span><span class="op" id="7967576">]</span><span class="builtintype" id="7967577">byte</span><span class="op" id="7967581">(</span><span class="string" id="7967582">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7967602">)</span><span class="op" id="7967603">,</span>&nbsp;<span class="num" id="7967605">9</span><span class="op" id="7967606">,</span>&nbsp;<span class="op" id="7967608">[</span><span class="op" id="7967609">]</span><span class="builtintype" id="7967610">int</span><span class="op" id="7967613">{</span><span class="num" id="7967614">0</span><span class="op" id="7967615">,</span>&nbsp;<span class="num" id="7967617">1</span><span class="op" id="7967618">,</span>&nbsp;<span class="num" id="7967620">2</span><span class="op" id="7967621">,</span>&nbsp;<span class="num" id="7967623">3</span><span class="op" id="7967624">,</span>&nbsp;<span class="num" id="7967626">4</span><span class="op" id="7967627">,</span>&nbsp;<span class="num" id="7967629">5</span><span class="op" id="7967630">,</span>&nbsp;<span class="num" id="7967632">6</span><span class="op" id="7967633">,</span>&nbsp;<span class="num" id="7967635">7</span><span class="op" id="7967636">,</span>&nbsp;<span class="num" id="7967638">8</span><span class="op" id="7967639">}</span><span class="op" id="7967640">}</span><span class="op" id="7967641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967644">{</span><span class="string" id="7967645">&#34;d&#34;</span><span class="op" id="7967648">,</span>&nbsp;<span class="ident" id="7967650">nil</span><span class="op" id="7967653">,</span>&nbsp;<span class="num" id="7967655">100</span><span class="op" id="7967658">,</span>&nbsp;<span class="op" id="7967660">[</span><span class="op" id="7967661">]</span><span class="builtintype" id="7967662">int</span><span class="op" id="7967665">{</span><span class="num" id="7967666">0</span><span class="op" id="7967667">,</span>&nbsp;<span class="num" id="7967669">5</span><span class="op" id="7967670">,</span>&nbsp;<span class="num" id="7967672">10</span><span class="op" id="7967674">,</span>&nbsp;<span class="num" id="7967676">20</span><span class="op" id="7967678">,</span>&nbsp;<span class="num" id="7967680">30</span><span class="op" id="7967682">,</span>&nbsp;<span class="num" id="7967684">70</span><span class="op" id="7967686">,</span>&nbsp;<span class="num" id="7967688">71</span><span class="op" id="7967690">,</span>&nbsp;<span class="num" id="7967692">72</span><span class="op" id="7967694">,</span>&nbsp;<span class="num" id="7967696">80</span><span class="op" id="7967698">,</span>&nbsp;<span class="num" id="7967700">85</span><span class="op" id="7967702">,</span>&nbsp;<span class="num" id="7967704">90</span><span class="op" id="7967706">,</span>&nbsp;<span class="num" id="7967708">99</span><span class="op" id="7967710">}</span><span class="op" id="7967711">}</span><span class="op" id="7967712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967715">{</span><span class="string" id="7967716">&#34;e&#34;</span><span class="op" id="7967719">,</span>&nbsp;<span class="ident" id="7967721">nil</span><span class="op" id="7967724">,</span>&nbsp;<span class="num" id="7967726">777</span><span class="op" id="7967729">,</span>&nbsp;<span class="op" id="7967731">[</span><span class="op" id="7967732">]</span><span class="builtintype" id="7967733">int</span><span class="op" id="7967736">{</span><span class="num" id="7967737">0</span><span class="op" id="7967738">,</span>&nbsp;<span class="num" id="7967740">80</span><span class="op" id="7967742">,</span>&nbsp;<span class="num" id="7967744">100</span><span class="op" id="7967747">,</span>&nbsp;<span class="num" id="7967749">120</span><span class="op" id="7967752">,</span>&nbsp;<span class="num" id="7967754">130</span><span class="op" id="7967757">,</span>&nbsp;<span class="num" id="7967759">180</span><span class="op" id="7967762">,</span>&nbsp;<span class="num" id="7967764">267</span><span class="op" id="7967767">,</span>&nbsp;<span class="num" id="7967769">455</span><span class="op" id="7967772">,</span>&nbsp;<span class="num" id="7967774">500</span><span class="op" id="7967777">,</span>&nbsp;<span class="num" id="7967779">567</span><span class="op" id="7967782">,</span>&nbsp;<span class="num" id="7967784">620</span><span class="op" id="7967787">}</span><span class="op" id="7967788">}</span><span class="op" id="7967789">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967792">{</span><span class="string" id="7967793">&#34;f&#34;</span><span class="op" id="7967796">,</span>&nbsp;<span class="op" id="7967798">[</span><span class="op" id="7967799">]</span><span class="builtintype" id="7967800">byte</span><span class="op" id="7967804">(</span><span class="string" id="7967805">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7967834">)</span><span class="op" id="7967835">,</span>&nbsp;<span class="num" id="7967837">23</span><span class="op" id="7967839">,</span>&nbsp;<span class="op" id="7967841">[</span><span class="op" id="7967842">]</span><span class="builtintype" id="7967843">int</span><span class="op" id="7967846">{</span><span class="num" id="7967847">0</span><span class="op" id="7967848">,</span>&nbsp;<span class="num" id="7967850">10</span><span class="op" id="7967852">,</span>&nbsp;<span class="num" id="7967854">11</span><span class="op" id="7967856">}</span><span class="op" id="7967857">}</span><span class="op" id="7967858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967861">{</span><span class="string" id="7967862">&#34;g&#34;</span><span class="op" id="7967865">,</span>&nbsp;<span class="op" id="7967867">[</span><span class="op" id="7967868">]</span><span class="builtintype" id="7967869">byte</span><span class="op" id="7967873">(</span><span class="string" id="7967874">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7967905">)</span><span class="op" id="7967906">,</span>&nbsp;<span class="num" id="7967908">24</span><span class="op" id="7967910">,</span>&nbsp;<span class="op" id="7967912">[</span><span class="op" id="7967913">]</span><span class="builtintype" id="7967914">int</span><span class="op" id="7967917">{</span><span class="num" id="7967918">0</span><span class="op" id="7967919">,</span>&nbsp;<span class="num" id="7967921">10</span><span class="op" id="7967923">,</span>&nbsp;<span class="num" id="7967925">11</span><span class="op" id="7967927">}</span><span class="op" id="7967928">}</span><span class="op" id="7967929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7967932">{</span><span class="string" id="7967933">&#34;h&#34;</span><span class="op" id="7967936">,</span>&nbsp;<span class="op" id="7967938">[</span><span class="op" id="7967939">]</span><span class="builtintype" id="7967940">byte</span><span class="op" id="7967944">(</span><span class="string" id="7967945">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7967977">)</span><span class="op" id="7967978">,</span>&nbsp;<span class="num" id="7967980">25</span><span class="op" id="7967982">,</span>&nbsp;<span class="op" id="7967984">[</span><span class="op" id="7967985">]</span><span class="builtintype" id="7967986">int</span><span class="op" id="7967989">{</span><span class="num" id="7967990">0</span><span class="op" id="7967991">,</span>&nbsp;<span class="num" id="7967993">10</span><span class="op" id="7967995">,</span>&nbsp;<span class="num" id="7967997">11</span><span class="op" id="7967999">,</span>&nbsp;<span class="num" id="7968001">24</span><span class="op" id="7968003">}</span><span class="op" id="7968004">}</span><span class="op" id="7968005">,</span><br>
<span class="lineno"></span><span class="op" id="7968007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7968010">func</span>&nbsp;<span class="ident" id="7968015">linecol</span><span class="op" id="7968022">(</span><span class="ident" id="7968023">lines</span>&nbsp;<span class="op" id="7968029">[</span><span class="op" id="7968030">]</span><span class="builtintype" id="7968031">int</span><span class="op" id="7968034">,</span>&nbsp;<span class="ident" id="7968036">offs</span>&nbsp;<span class="builtintype" id="7968041">int</span><span class="op" id="7968044">)</span>&nbsp;<span class="op" id="7968046">(</span><span class="builtintype" id="7968047">int</span><span class="op" id="7968050">,</span>&nbsp;<span class="builtintype" id="7968052">int</span><span class="op" id="7968055">)</span>&nbsp;<span class="op" id="7968057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968060">prevLineOffs</span>&nbsp;<span class="op" id="7968073">:=</span>&nbsp;<span class="num" id="7968076">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968079">for</span>&nbsp;<span class="ident" id="7968083">line</span><span class="op" id="7968087">,</span>&nbsp;<span class="ident" id="7968089">lineOffs</span>&nbsp;<span class="op" id="7968098">:=</span>&nbsp;<span class="keyword" id="7968101">range</span>&nbsp;<span class="ident" id="7968107">lines</span>&nbsp;<span class="op" id="7968113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968117">if</span>&nbsp;<span class="ident" id="7968120">offs</span>&nbsp;<span class="op" id="7968125">&lt;</span>&nbsp;<span class="ident" id="7968127">lineOffs</span>&nbsp;<span class="op" id="7968136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968141">return</span>&nbsp;<span class="ident" id="7968148">line</span><span class="op" id="7968152">,</span>&nbsp;<span class="ident" id="7968154">offs</span>&nbsp;<span class="op" id="7968159">-</span>&nbsp;<span class="ident" id="7968161">prevLineOffs</span>&nbsp;<span class="op" id="7968174">+</span>&nbsp;<span class="num" id="7968176">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968184">prevLineOffs</span>&nbsp;<span class="op" id="7968197">=</span>&nbsp;<span class="ident" id="7968199">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968212">return</span>&nbsp;<span class="builtinfunc" id="7968219">len</span><span class="op" id="7968222">(</span><span class="ident" id="7968223">lines</span><span class="op" id="7968228">)</span><span class="op" id="7968229">,</span>&nbsp;<span class="ident" id="7968231">offs</span>&nbsp;<span class="op" id="7968236">-</span>&nbsp;<span class="ident" id="7968238">prevLineOffs</span>&nbsp;<span class="op" id="7968251">+</span>&nbsp;<span class="num" id="7968253">1</span><br>
<span class="lineno"></span><span class="op" id="7968255">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7968258">func</span>&nbsp;<span class="ident" id="7968263">verifyPositions</span><span class="op" id="7968278">(</span><span class="ident" id="7968279">t</span>&nbsp;<span class="op" id="7968281">*</span><span class="ident" id="7968282">testing</span><span class="op" id="7968289">.</span><span class="ident" id="7968290">T</span><span class="op" id="7968291">,</span>&nbsp;<span class="ident" id="7968293">fset</span>&nbsp;<span class="op" id="7968298">*</span><span class="ident" id="7968299">FileSet</span><span class="op" id="7968306">,</span>&nbsp;<span class="ident" id="7968308">f</span>&nbsp;<span class="op" id="7968310">*</span><span class="ident" id="7968311">File</span><span class="op" id="7968315">,</span>&nbsp;<span class="ident" id="7968317">lines</span>&nbsp;<span class="op" id="7968323">[</span><span class="op" id="7968324">]</span><span class="builtintype" id="7968325">int</span><span class="op" id="7968328">)</span>&nbsp;<span class="op" id="7968330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968333">for</span>&nbsp;<span class="ident" id="7968337">offs</span>&nbsp;<span class="op" id="7968342">:=</span>&nbsp;<span class="num" id="7968345">0</span><span class="op" id="7968346">;</span>&nbsp;<span class="ident" id="7968348">offs</span>&nbsp;<span class="op" id="7968353">&lt;</span>&nbsp;<span class="ident" id="7968355">f</span><span class="op" id="7968356">.</span><span class="ident" id="7968357">Size</span><span class="op" id="7968361">(</span><span class="op" id="7968362">)</span><span class="op" id="7968363">;</span>&nbsp;<span class="ident" id="7968365">offs</span><span class="op" id="7968369">++</span>&nbsp;<span class="op" id="7968372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968376">p</span>&nbsp;<span class="op" id="7968378">:=</span>&nbsp;<span class="ident" id="7968381">f</span><span class="op" id="7968382">.</span><span class="ident" id="7968383">Pos</span><span class="op" id="7968386">(</span><span class="ident" id="7968387">offs</span><span class="op" id="7968391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968395">offs2</span>&nbsp;<span class="op" id="7968401">:=</span>&nbsp;<span class="ident" id="7968404">f</span><span class="op" id="7968405">.</span><span class="ident" id="7968406">Offset</span><span class="op" id="7968412">(</span><span class="ident" id="7968413">p</span><span class="op" id="7968414">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968418">if</span>&nbsp;<span class="ident" id="7968421">offs2</span>&nbsp;<span class="op" id="7968427">!=</span>&nbsp;<span class="ident" id="7968430">offs</span>&nbsp;<span class="op" id="7968435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968440">t</span><span class="op" id="7968441">.</span><span class="ident" id="7968442">Errorf</span><span class="op" id="7968448">(</span><span class="string" id="7968449">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7968485">,</span>&nbsp;<span class="ident" id="7968487">f</span><span class="op" id="7968488">.</span><span class="ident" id="7968489">Name</span><span class="op" id="7968493">(</span><span class="op" id="7968494">)</span><span class="op" id="7968495">,</span>&nbsp;<span class="ident" id="7968497">offs2</span><span class="op" id="7968502">,</span>&nbsp;<span class="ident" id="7968504">offs</span><span class="op" id="7968508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968516">line</span><span class="op" id="7968520">,</span>&nbsp;<span class="ident" id="7968522">col</span>&nbsp;<span class="op" id="7968526">:=</span>&nbsp;<span class="ident" id="7968529">linecol</span><span class="op" id="7968536">(</span><span class="ident" id="7968537">lines</span><span class="op" id="7968542">,</span>&nbsp;<span class="ident" id="7968544">offs</span><span class="op" id="7968548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968552">msg</span>&nbsp;<span class="op" id="7968556">:=</span>&nbsp;<span class="ident" id="7968559">fmt</span><span class="op" id="7968562">.</span><span class="ident" id="7968563">Sprintf</span><span class="op" id="7968570">(</span><span class="string" id="7968571">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7968595">,</span>&nbsp;<span class="ident" id="7968597">f</span><span class="op" id="7968598">.</span><span class="ident" id="7968599">Name</span><span class="op" id="7968603">(</span><span class="op" id="7968604">)</span><span class="op" id="7968605">,</span>&nbsp;<span class="ident" id="7968607">offs</span><span class="op" id="7968611">,</span>&nbsp;<span class="ident" id="7968613">p</span><span class="op" id="7968614">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968618">checkPos</span><span class="op" id="7968626">(</span><span class="ident" id="7968627">t</span><span class="op" id="7968628">,</span>&nbsp;<span class="ident" id="7968630">msg</span><span class="op" id="7968633">,</span>&nbsp;<span class="ident" id="7968635">f</span><span class="op" id="7968636">.</span><span class="ident" id="7968637">Position</span><span class="op" id="7968645">(</span><span class="ident" id="7968646">f</span><span class="op" id="7968647">.</span><span class="ident" id="7968648">Pos</span><span class="op" id="7968651">(</span><span class="ident" id="7968652">offs</span><span class="op" id="7968656">)</span><span class="op" id="7968657">)</span><span class="op" id="7968658">,</span>&nbsp;<span class="ident" id="7968660">Position</span><span class="op" id="7968668">{</span><span class="ident" id="7968669">f</span><span class="op" id="7968670">.</span><span class="ident" id="7968671">Name</span><span class="op" id="7968675">(</span><span class="op" id="7968676">)</span><span class="op" id="7968677">,</span>&nbsp;<span class="ident" id="7968679">offs</span><span class="op" id="7968683">,</span>&nbsp;<span class="ident" id="7968685">line</span><span class="op" id="7968689">,</span>&nbsp;<span class="ident" id="7968691">col</span><span class="op" id="7968694">}</span><span class="op" id="7968695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968699">checkPos</span><span class="op" id="7968707">(</span><span class="ident" id="7968708">t</span><span class="op" id="7968709">,</span>&nbsp;<span class="ident" id="7968711">msg</span><span class="op" id="7968714">,</span>&nbsp;<span class="ident" id="7968716">fset</span><span class="op" id="7968720">.</span><span class="ident" id="7968721">Position</span><span class="op" id="7968729">(</span><span class="ident" id="7968730">p</span><span class="op" id="7968731">)</span><span class="op" id="7968732">,</span>&nbsp;<span class="ident" id="7968734">Position</span><span class="op" id="7968742">{</span><span class="ident" id="7968743">f</span><span class="op" id="7968744">.</span><span class="ident" id="7968745">Name</span><span class="op" id="7968749">(</span><span class="op" id="7968750">)</span><span class="op" id="7968751">,</span>&nbsp;<span class="ident" id="7968753">offs</span><span class="op" id="7968757">,</span>&nbsp;<span class="ident" id="7968759">line</span><span class="op" id="7968763">,</span>&nbsp;<span class="ident" id="7968765">col</span><span class="op" id="7968768">}</span><span class="op" id="7968769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968772">}</span><br>
<span class="lineno"></span><span class="op" id="7968774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7968777">func</span>&nbsp;<span class="ident" id="7968782">makeTestSource</span><span class="op" id="7968796">(</span><span class="ident" id="7968797">size</span>&nbsp;<span class="builtintype" id="7968802">int</span><span class="op" id="7968805">,</span>&nbsp;<span class="ident" id="7968807">lines</span>&nbsp;<span class="op" id="7968813">[</span><span class="op" id="7968814">]</span><span class="builtintype" id="7968815">int</span><span class="op" id="7968818">)</span>&nbsp;<span class="op" id="7968820">[</span><span class="op" id="7968821">]</span><span class="builtintype" id="7968822">byte</span>&nbsp;<span class="op" id="7968827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968830">src</span>&nbsp;<span class="op" id="7968834">:=</span>&nbsp;<span class="builtinfunc" id="7968837">make</span><span class="op" id="7968841">(</span><span class="op" id="7968842">[</span><span class="op" id="7968843">]</span><span class="builtintype" id="7968844">byte</span><span class="op" id="7968848">,</span>&nbsp;<span class="ident" id="7968850">size</span><span class="op" id="7968854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968857">for</span>&nbsp;<span class="ident" id="7968861">_</span><span class="op" id="7968862">,</span>&nbsp;<span class="ident" id="7968864">offs</span>&nbsp;<span class="op" id="7968869">:=</span>&nbsp;<span class="keyword" id="7968872">range</span>&nbsp;<span class="ident" id="7968878">lines</span>&nbsp;<span class="op" id="7968884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968888">if</span>&nbsp;<span class="ident" id="7968891">offs</span>&nbsp;<span class="op" id="7968896">&gt;</span>&nbsp;<span class="num" id="7968898">0</span>&nbsp;<span class="op" id="7968900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968905">src</span><span class="op" id="7968908">[</span><span class="ident" id="7968909">offs</span><span class="op" id="7968913">-</span><span class="num" id="7968914">1</span><span class="op" id="7968915">]</span>&nbsp;<span class="op" id="7968917">=</span>&nbsp;<span class="string" id="7968919">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968932">return</span>&nbsp;<span class="ident" id="7968939">src</span><br>
<span class="lineno"></span><span class="op" id="7968943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7968946">func</span>&nbsp;<span class="ident" id="7968951">TestPositions</span><span class="op" id="7968964">(</span><span class="ident" id="7968965">t</span>&nbsp;<span class="op" id="7968967">*</span><span class="ident" id="7968968">testing</span><span class="op" id="7968975">.</span><span class="ident" id="7968976">T</span><span class="op" id="7968977">)</span>&nbsp;<span class="op" id="7968979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968982">const</span>&nbsp;<span class="ident" id="7968988">delta</span>&nbsp;<span class="op" id="7968994">=</span>&nbsp;<span class="num" id="7968996">7</span>&nbsp;<span class="comment" id="7968998">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969035">fset</span>&nbsp;<span class="op" id="7969040">:=</span>&nbsp;<span class="ident" id="7969043">NewFileSet</span><span class="op" id="7969053">(</span><span class="op" id="7969054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969057">for</span>&nbsp;<span class="ident" id="7969061">_</span><span class="op" id="7969062">,</span>&nbsp;<span class="ident" id="7969064">test</span>&nbsp;<span class="op" id="7969069">:=</span>&nbsp;<span class="keyword" id="7969072">range</span>&nbsp;<span class="ident" id="7969078">tests</span>&nbsp;<span class="op" id="7969084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7969088">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969125">if</span>&nbsp;<span class="ident" id="7969128">test</span><span class="op" id="7969132">.</span><span class="ident" id="7969133">source</span>&nbsp;<span class="op" id="7969140">!=</span>&nbsp;<span class="ident" id="7969143">nil</span>&nbsp;<span class="op" id="7969147">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7969150">len</span><span class="op" id="7969153">(</span><span class="ident" id="7969154">test</span><span class="op" id="7969158">.</span><span class="ident" id="7969159">source</span><span class="op" id="7969165">)</span>&nbsp;<span class="op" id="7969167">!=</span>&nbsp;<span class="ident" id="7969170">test</span><span class="op" id="7969174">.</span><span class="ident" id="7969175">size</span>&nbsp;<span class="op" id="7969180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969185">t</span><span class="op" id="7969186">.</span><span class="ident" id="7969187">Errorf</span><span class="op" id="7969193">(</span><span class="string" id="7969194">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7969249">,</span>&nbsp;<span class="ident" id="7969251">test</span><span class="op" id="7969255">.</span><span class="ident" id="7969256">filename</span><span class="op" id="7969264">,</span>&nbsp;<span class="builtinfunc" id="7969266">len</span><span class="op" id="7969269">(</span><span class="ident" id="7969270">test</span><span class="op" id="7969274">.</span><span class="ident" id="7969275">source</span><span class="op" id="7969281">)</span><span class="op" id="7969282">,</span>&nbsp;<span class="ident" id="7969284">test</span><span class="op" id="7969288">.</span><span class="ident" id="7969289">size</span><span class="op" id="7969293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7969302">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969341">f</span>&nbsp;<span class="op" id="7969343">:=</span>&nbsp;<span class="ident" id="7969346">fset</span><span class="op" id="7969350">.</span><span class="ident" id="7969351">AddFile</span><span class="op" id="7969358">(</span><span class="ident" id="7969359">test</span><span class="op" id="7969363">.</span><span class="ident" id="7969364">filename</span><span class="op" id="7969372">,</span>&nbsp;<span class="ident" id="7969374">fset</span><span class="op" id="7969378">.</span><span class="ident" id="7969379">Base</span><span class="op" id="7969383">(</span><span class="op" id="7969384">)</span><span class="op" id="7969385">+</span><span class="ident" id="7969386">delta</span><span class="op" id="7969391">,</span>&nbsp;<span class="ident" id="7969393">test</span><span class="op" id="7969397">.</span><span class="ident" id="7969398">size</span><span class="op" id="7969402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969406">if</span>&nbsp;<span class="ident" id="7969409">f</span><span class="op" id="7969410">.</span><span class="ident" id="7969411">Name</span><span class="op" id="7969415">(</span><span class="op" id="7969416">)</span>&nbsp;<span class="op" id="7969418">!=</span>&nbsp;<span class="ident" id="7969421">test</span><span class="op" id="7969425">.</span><span class="ident" id="7969426">filename</span>&nbsp;<span class="op" id="7969435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969440">t</span><span class="op" id="7969441">.</span><span class="ident" id="7969442">Errorf</span><span class="op" id="7969448">(</span><span class="string" id="7969449">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7969475">,</span>&nbsp;<span class="ident" id="7969477">f</span><span class="op" id="7969478">.</span><span class="ident" id="7969479">Name</span><span class="op" id="7969483">(</span><span class="op" id="7969484">)</span><span class="op" id="7969485">,</span>&nbsp;<span class="ident" id="7969487">test</span><span class="op" id="7969491">.</span><span class="ident" id="7969492">filename</span><span class="op" id="7969500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969508">if</span>&nbsp;<span class="ident" id="7969511">f</span><span class="op" id="7969512">.</span><span class="ident" id="7969513">Size</span><span class="op" id="7969517">(</span><span class="op" id="7969518">)</span>&nbsp;<span class="op" id="7969520">!=</span>&nbsp;<span class="ident" id="7969523">test</span><span class="op" id="7969527">.</span><span class="ident" id="7969528">size</span>&nbsp;<span class="op" id="7969533">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969538">t</span><span class="op" id="7969539">.</span><span class="ident" id="7969540">Errorf</span><span class="op" id="7969546">(</span><span class="string" id="7969547">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7969578">,</span>&nbsp;<span class="ident" id="7969580">f</span><span class="op" id="7969581">.</span><span class="ident" id="7969582">Name</span><span class="op" id="7969586">(</span><span class="op" id="7969587">)</span><span class="op" id="7969588">,</span>&nbsp;<span class="ident" id="7969590">f</span><span class="op" id="7969591">.</span><span class="ident" id="7969592">Size</span><span class="op" id="7969596">(</span><span class="op" id="7969597">)</span><span class="op" id="7969598">,</span>&nbsp;<span class="ident" id="7969600">test</span><span class="op" id="7969604">.</span><span class="ident" id="7969605">size</span><span class="op" id="7969609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969617">if</span>&nbsp;<span class="ident" id="7969620">fset</span><span class="op" id="7969624">.</span><span class="ident" id="7969625">File</span><span class="op" id="7969629">(</span><span class="ident" id="7969630">f</span><span class="op" id="7969631">.</span><span class="ident" id="7969632">Pos</span><span class="op" id="7969635">(</span><span class="num" id="7969636">0</span><span class="op" id="7969637">)</span><span class="op" id="7969638">)</span>&nbsp;<span class="op" id="7969640">!=</span>&nbsp;<span class="ident" id="7969643">f</span>&nbsp;<span class="op" id="7969645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969650">t</span><span class="op" id="7969651">.</span><span class="ident" id="7969652">Errorf</span><span class="op" id="7969658">(</span><span class="string" id="7969659">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7969692">,</span>&nbsp;<span class="ident" id="7969694">f</span><span class="op" id="7969695">.</span><span class="ident" id="7969696">Name</span><span class="op" id="7969700">(</span><span class="op" id="7969701">)</span><span class="op" id="7969702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969706">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7969711">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969764">for</span>&nbsp;<span class="ident" id="7969768">i</span><span class="op" id="7969769">,</span>&nbsp;<span class="ident" id="7969771">offset</span>&nbsp;<span class="op" id="7969778">:=</span>&nbsp;<span class="keyword" id="7969781">range</span>&nbsp;<span class="ident" id="7969787">test</span><span class="op" id="7969791">.</span><span class="ident" id="7969792">lines</span>&nbsp;<span class="op" id="7969798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969803">f</span><span class="op" id="7969804">.</span><span class="ident" id="7969805">AddLine</span><span class="op" id="7969812">(</span><span class="ident" id="7969813">offset</span><span class="op" id="7969819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969824">if</span>&nbsp;<span class="ident" id="7969827">f</span><span class="op" id="7969828">.</span><span class="ident" id="7969829">LineCount</span><span class="op" id="7969838">(</span><span class="op" id="7969839">)</span>&nbsp;<span class="op" id="7969841">!=</span>&nbsp;<span class="ident" id="7969844">i</span><span class="op" id="7969845">+</span><span class="num" id="7969846">1</span>&nbsp;<span class="op" id="7969848">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969854">t</span><span class="op" id="7969855">.</span><span class="ident" id="7969856">Errorf</span><span class="op" id="7969862">(</span><span class="string" id="7969863">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7969904">,</span>&nbsp;<span class="ident" id="7969906">f</span><span class="op" id="7969907">.</span><span class="ident" id="7969908">Name</span><span class="op" id="7969912">(</span><span class="op" id="7969913">)</span><span class="op" id="7969914">,</span>&nbsp;<span class="ident" id="7969916">f</span><span class="op" id="7969917">.</span><span class="ident" id="7969918">LineCount</span><span class="op" id="7969927">(</span><span class="op" id="7969928">)</span><span class="op" id="7969929">,</span>&nbsp;<span class="ident" id="7969931">i</span><span class="op" id="7969932">+</span><span class="num" id="7969933">1</span><span class="op" id="7969934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7969944">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969997">f</span><span class="op" id="7969998">.</span><span class="ident" id="7969999">AddLine</span><span class="op" id="7970006">(</span><span class="ident" id="7970007">offset</span><span class="op" id="7970013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970018">if</span>&nbsp;<span class="ident" id="7970021">f</span><span class="op" id="7970022">.</span><span class="ident" id="7970023">LineCount</span><span class="op" id="7970032">(</span><span class="op" id="7970033">)</span>&nbsp;<span class="op" id="7970035">!=</span>&nbsp;<span class="ident" id="7970038">i</span><span class="op" id="7970039">+</span><span class="num" id="7970040">1</span>&nbsp;<span class="op" id="7970042">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970048">t</span><span class="op" id="7970049">.</span><span class="ident" id="7970050">Errorf</span><span class="op" id="7970056">(</span><span class="string" id="7970057">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7970108">,</span>&nbsp;<span class="ident" id="7970110">f</span><span class="op" id="7970111">.</span><span class="ident" id="7970112">Name</span><span class="op" id="7970116">(</span><span class="op" id="7970117">)</span><span class="op" id="7970118">,</span>&nbsp;<span class="ident" id="7970120">f</span><span class="op" id="7970121">.</span><span class="ident" id="7970122">LineCount</span><span class="op" id="7970131">(</span><span class="op" id="7970132">)</span><span class="op" id="7970133">,</span>&nbsp;<span class="ident" id="7970135">i</span><span class="op" id="7970136">+</span><span class="num" id="7970137">1</span><span class="op" id="7970138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970148">verifyPositions</span><span class="op" id="7970163">(</span><span class="ident" id="7970164">t</span><span class="op" id="7970165">,</span>&nbsp;<span class="ident" id="7970167">fset</span><span class="op" id="7970171">,</span>&nbsp;<span class="ident" id="7970173">f</span><span class="op" id="7970174">,</span>&nbsp;<span class="ident" id="7970176">test</span><span class="op" id="7970180">.</span><span class="ident" id="7970181">lines</span><span class="op" id="7970186">[</span><span class="num" id="7970187">0</span><span class="op" id="7970188">:</span><span class="ident" id="7970189">i</span><span class="op" id="7970190">+</span><span class="num" id="7970191">1</span><span class="op" id="7970192">]</span><span class="op" id="7970193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7970202">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970256">if</span>&nbsp;<span class="ident" id="7970259">ok</span>&nbsp;<span class="op" id="7970262">:=</span>&nbsp;<span class="ident" id="7970265">f</span><span class="op" id="7970266">.</span><span class="ident" id="7970267">SetLines</span><span class="op" id="7970275">(</span><span class="ident" id="7970276">test</span><span class="op" id="7970280">.</span><span class="ident" id="7970281">lines</span><span class="op" id="7970286">)</span><span class="op" id="7970287">;</span>&nbsp;<span class="op" id="7970289">!</span><span class="ident" id="7970290">ok</span>&nbsp;<span class="op" id="7970293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970298">t</span><span class="op" id="7970299">.</span><span class="ident" id="7970300">Errorf</span><span class="op" id="7970306">(</span><span class="string" id="7970307">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7970328">,</span>&nbsp;<span class="ident" id="7970330">f</span><span class="op" id="7970331">.</span><span class="ident" id="7970332">Name</span><span class="op" id="7970336">(</span><span class="op" id="7970337">)</span><span class="op" id="7970338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970346">if</span>&nbsp;<span class="ident" id="7970349">f</span><span class="op" id="7970350">.</span><span class="ident" id="7970351">LineCount</span><span class="op" id="7970360">(</span><span class="op" id="7970361">)</span>&nbsp;<span class="op" id="7970363">!=</span>&nbsp;<span class="builtinfunc" id="7970366">len</span><span class="op" id="7970369">(</span><span class="ident" id="7970370">test</span><span class="op" id="7970374">.</span><span class="ident" id="7970375">lines</span><span class="op" id="7970380">)</span>&nbsp;<span class="op" id="7970382">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970387">t</span><span class="op" id="7970388">.</span><span class="ident" id="7970389">Errorf</span><span class="op" id="7970395">(</span><span class="string" id="7970396">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7970438">,</span>&nbsp;<span class="ident" id="7970440">f</span><span class="op" id="7970441">.</span><span class="ident" id="7970442">Name</span><span class="op" id="7970446">(</span><span class="op" id="7970447">)</span><span class="op" id="7970448">,</span>&nbsp;<span class="ident" id="7970450">f</span><span class="op" id="7970451">.</span><span class="ident" id="7970452">LineCount</span><span class="op" id="7970461">(</span><span class="op" id="7970462">)</span><span class="op" id="7970463">,</span>&nbsp;<span class="builtinfunc" id="7970465">len</span><span class="op" id="7970468">(</span><span class="ident" id="7970469">test</span><span class="op" id="7970473">.</span><span class="ident" id="7970474">lines</span><span class="op" id="7970479">)</span><span class="op" id="7970480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970488">verifyPositions</span><span class="op" id="7970503">(</span><span class="ident" id="7970504">t</span><span class="op" id="7970505">,</span>&nbsp;<span class="ident" id="7970507">fset</span><span class="op" id="7970511">,</span>&nbsp;<span class="ident" id="7970513">f</span><span class="op" id="7970514">,</span>&nbsp;<span class="ident" id="7970516">test</span><span class="op" id="7970520">.</span><span class="ident" id="7970521">lines</span><span class="op" id="7970526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7970531">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970595">src</span>&nbsp;<span class="op" id="7970599">:=</span>&nbsp;<span class="ident" id="7970602">test</span><span class="op" id="7970606">.</span><span class="ident" id="7970607">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970616">if</span>&nbsp;<span class="ident" id="7970619">src</span>&nbsp;<span class="op" id="7970623">==</span>&nbsp;<span class="ident" id="7970626">nil</span>&nbsp;<span class="op" id="7970630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7970635">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970692">src</span>&nbsp;<span class="op" id="7970696">=</span>&nbsp;<span class="ident" id="7970698">makeTestSource</span><span class="op" id="7970712">(</span><span class="ident" id="7970713">test</span><span class="op" id="7970717">.</span><span class="ident" id="7970718">size</span><span class="op" id="7970722">,</span>&nbsp;<span class="ident" id="7970724">test</span><span class="op" id="7970728">.</span><span class="ident" id="7970729">lines</span><span class="op" id="7970734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970738">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970742">f</span><span class="op" id="7970743">.</span><span class="ident" id="7970744">SetLinesForContent</span><span class="op" id="7970762">(</span><span class="ident" id="7970763">src</span><span class="op" id="7970766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970770">if</span>&nbsp;<span class="ident" id="7970773">f</span><span class="op" id="7970774">.</span><span class="ident" id="7970775">LineCount</span><span class="op" id="7970784">(</span><span class="op" id="7970785">)</span>&nbsp;<span class="op" id="7970787">!=</span>&nbsp;<span class="builtinfunc" id="7970790">len</span><span class="op" id="7970793">(</span><span class="ident" id="7970794">test</span><span class="op" id="7970798">.</span><span class="ident" id="7970799">lines</span><span class="op" id="7970804">)</span>&nbsp;<span class="op" id="7970806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970811">t</span><span class="op" id="7970812">.</span><span class="ident" id="7970813">Errorf</span><span class="op" id="7970819">(</span><span class="string" id="7970820">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7970872">,</span>&nbsp;<span class="ident" id="7970874">f</span><span class="op" id="7970875">.</span><span class="ident" id="7970876">Name</span><span class="op" id="7970880">(</span><span class="op" id="7970881">)</span><span class="op" id="7970882">,</span>&nbsp;<span class="ident" id="7970884">f</span><span class="op" id="7970885">.</span><span class="ident" id="7970886">LineCount</span><span class="op" id="7970895">(</span><span class="op" id="7970896">)</span><span class="op" id="7970897">,</span>&nbsp;<span class="builtinfunc" id="7970899">len</span><span class="op" id="7970902">(</span><span class="ident" id="7970903">test</span><span class="op" id="7970907">.</span><span class="ident" id="7970908">lines</span><span class="op" id="7970913">)</span><span class="op" id="7970914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970922">verifyPositions</span><span class="op" id="7970937">(</span><span class="ident" id="7970938">t</span><span class="op" id="7970939">,</span>&nbsp;<span class="ident" id="7970941">fset</span><span class="op" id="7970945">,</span>&nbsp;<span class="ident" id="7970947">f</span><span class="op" id="7970948">,</span>&nbsp;<span class="ident" id="7970950">test</span><span class="op" id="7970954">.</span><span class="ident" id="7970955">lines</span><span class="op" id="7970960">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970963">}</span><br>
<span class="lineno"></span><span class="op" id="7970965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7970968">func</span>&nbsp;<span class="ident" id="7970973">TestLineInfo</span><span class="op" id="7970985">(</span><span class="ident" id="7970986">t</span>&nbsp;<span class="op" id="7970988">*</span><span class="ident" id="7970989">testing</span><span class="op" id="7970996">.</span><span class="ident" id="7970997">T</span><span class="op" id="7970998">)</span>&nbsp;<span class="op" id="7971000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971003">fset</span>&nbsp;<span class="op" id="7971008">:=</span>&nbsp;<span class="ident" id="7971011">NewFileSet</span><span class="op" id="7971021">(</span><span class="op" id="7971022">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971025">f</span>&nbsp;<span class="op" id="7971027">:=</span>&nbsp;<span class="ident" id="7971030">fset</span><span class="op" id="7971034">.</span><span class="ident" id="7971035">AddFile</span><span class="op" id="7971042">(</span><span class="string" id="7971043">&#34;foo&#34;</span><span class="op" id="7971048">,</span>&nbsp;<span class="ident" id="7971050">fset</span><span class="op" id="7971054">.</span><span class="ident" id="7971055">Base</span><span class="op" id="7971059">(</span><span class="op" id="7971060">)</span><span class="op" id="7971061">,</span>&nbsp;<span class="num" id="7971063">500</span><span class="op" id="7971066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971069">lines</span>&nbsp;<span class="op" id="7971075">:=</span>&nbsp;<span class="op" id="7971078">[</span><span class="op" id="7971079">]</span><span class="builtintype" id="7971080">int</span><span class="op" id="7971083">{</span><span class="num" id="7971084">0</span><span class="op" id="7971085">,</span>&nbsp;<span class="num" id="7971087">42</span><span class="op" id="7971089">,</span>&nbsp;<span class="num" id="7971091">77</span><span class="op" id="7971093">,</span>&nbsp;<span class="num" id="7971095">100</span><span class="op" id="7971098">,</span>&nbsp;<span class="num" id="7971100">210</span><span class="op" id="7971103">,</span>&nbsp;<span class="num" id="7971105">220</span><span class="op" id="7971108">,</span>&nbsp;<span class="num" id="7971110">277</span><span class="op" id="7971113">,</span>&nbsp;<span class="num" id="7971115">300</span><span class="op" id="7971118">,</span>&nbsp;<span class="num" id="7971120">333</span><span class="op" id="7971123">,</span>&nbsp;<span class="num" id="7971125">401</span><span class="op" id="7971128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971131">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971199">for</span>&nbsp;<span class="ident" id="7971203">_</span><span class="op" id="7971204">,</span>&nbsp;<span class="ident" id="7971206">offs</span>&nbsp;<span class="op" id="7971211">:=</span>&nbsp;<span class="keyword" id="7971214">range</span>&nbsp;<span class="ident" id="7971220">lines</span>&nbsp;<span class="op" id="7971226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971230">f</span><span class="op" id="7971231">.</span><span class="ident" id="7971232">AddLine</span><span class="op" id="7971239">(</span><span class="ident" id="7971240">offs</span><span class="op" id="7971244">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971248">f</span><span class="op" id="7971249">.</span><span class="ident" id="7971250">AddLineInfo</span><span class="op" id="7971261">(</span><span class="ident" id="7971262">offs</span><span class="op" id="7971266">,</span>&nbsp;<span class="string" id="7971268">&#34;bar&#34;</span><span class="op" id="7971273">,</span>&nbsp;<span class="num" id="7971275">42</span><span class="op" id="7971277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971283">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971320">for</span>&nbsp;<span class="ident" id="7971324">offs</span>&nbsp;<span class="op" id="7971329">:=</span>&nbsp;<span class="num" id="7971332">0</span><span class="op" id="7971333">;</span>&nbsp;<span class="ident" id="7971335">offs</span>&nbsp;<span class="op" id="7971340">&lt;=</span>&nbsp;<span class="ident" id="7971343">f</span><span class="op" id="7971344">.</span><span class="ident" id="7971345">Size</span><span class="op" id="7971349">(</span><span class="op" id="7971350">)</span><span class="op" id="7971351">;</span>&nbsp;<span class="ident" id="7971353">offs</span><span class="op" id="7971357">++</span>&nbsp;<span class="op" id="7971360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971364">p</span>&nbsp;<span class="op" id="7971366">:=</span>&nbsp;<span class="ident" id="7971369">f</span><span class="op" id="7971370">.</span><span class="ident" id="7971371">Pos</span><span class="op" id="7971374">(</span><span class="ident" id="7971375">offs</span><span class="op" id="7971379">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971383">_</span><span class="op" id="7971384">,</span>&nbsp;<span class="ident" id="7971386">col</span>&nbsp;<span class="op" id="7971390">:=</span>&nbsp;<span class="ident" id="7971393">linecol</span><span class="op" id="7971400">(</span><span class="ident" id="7971401">lines</span><span class="op" id="7971406">,</span>&nbsp;<span class="ident" id="7971408">offs</span><span class="op" id="7971412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971416">msg</span>&nbsp;<span class="op" id="7971420">:=</span>&nbsp;<span class="ident" id="7971423">fmt</span><span class="op" id="7971426">.</span><span class="ident" id="7971427">Sprintf</span><span class="op" id="7971434">(</span><span class="string" id="7971435">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7971459">,</span>&nbsp;<span class="ident" id="7971461">f</span><span class="op" id="7971462">.</span><span class="ident" id="7971463">Name</span><span class="op" id="7971467">(</span><span class="op" id="7971468">)</span><span class="op" id="7971469">,</span>&nbsp;<span class="ident" id="7971471">offs</span><span class="op" id="7971475">,</span>&nbsp;<span class="ident" id="7971477">p</span><span class="op" id="7971478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971482">checkPos</span><span class="op" id="7971490">(</span><span class="ident" id="7971491">t</span><span class="op" id="7971492">,</span>&nbsp;<span class="ident" id="7971494">msg</span><span class="op" id="7971497">,</span>&nbsp;<span class="ident" id="7971499">f</span><span class="op" id="7971500">.</span><span class="ident" id="7971501">Position</span><span class="op" id="7971509">(</span><span class="ident" id="7971510">f</span><span class="op" id="7971511">.</span><span class="ident" id="7971512">Pos</span><span class="op" id="7971515">(</span><span class="ident" id="7971516">offs</span><span class="op" id="7971520">)</span><span class="op" id="7971521">)</span><span class="op" id="7971522">,</span>&nbsp;<span class="ident" id="7971524">Position</span><span class="op" id="7971532">{</span><span class="string" id="7971533">&#34;bar&#34;</span><span class="op" id="7971538">,</span>&nbsp;<span class="ident" id="7971540">offs</span><span class="op" id="7971544">,</span>&nbsp;<span class="num" id="7971546">42</span><span class="op" id="7971548">,</span>&nbsp;<span class="ident" id="7971550">col</span><span class="op" id="7971553">}</span><span class="op" id="7971554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971558">checkPos</span><span class="op" id="7971566">(</span><span class="ident" id="7971567">t</span><span class="op" id="7971568">,</span>&nbsp;<span class="ident" id="7971570">msg</span><span class="op" id="7971573">,</span>&nbsp;<span class="ident" id="7971575">fset</span><span class="op" id="7971579">.</span><span class="ident" id="7971580">Position</span><span class="op" id="7971588">(</span><span class="ident" id="7971589">p</span><span class="op" id="7971590">)</span><span class="op" id="7971591">,</span>&nbsp;<span class="ident" id="7971593">Position</span><span class="op" id="7971601">{</span><span class="string" id="7971602">&#34;bar&#34;</span><span class="op" id="7971607">,</span>&nbsp;<span class="ident" id="7971609">offs</span><span class="op" id="7971613">,</span>&nbsp;<span class="num" id="7971615">42</span><span class="op" id="7971617">,</span>&nbsp;<span class="ident" id="7971619">col</span><span class="op" id="7971622">}</span><span class="op" id="7971623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971626">}</span><br>
<span class="lineno">165</span><span class="op" id="7971628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7971631">func</span>&nbsp;<span class="ident" id="7971636">TestFiles</span><span class="op" id="7971645">(</span><span class="ident" id="7971646">t</span>&nbsp;<span class="op" id="7971648">*</span><span class="ident" id="7971649">testing</span><span class="op" id="7971656">.</span><span class="ident" id="7971657">T</span><span class="op" id="7971658">)</span>&nbsp;<span class="op" id="7971660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971663">fset</span>&nbsp;<span class="op" id="7971668">:=</span>&nbsp;<span class="ident" id="7971671">NewFileSet</span><span class="op" id="7971681">(</span><span class="op" id="7971682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971685">for</span>&nbsp;<span class="ident" id="7971689">i</span><span class="op" id="7971690">,</span>&nbsp;<span class="ident" id="7971692">test</span>&nbsp;<span class="op" id="7971697">:=</span>&nbsp;<span class="keyword" id="7971700">range</span>&nbsp;<span class="ident" id="7971706">tests</span>&nbsp;<span class="op" id="7971712">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971716">base</span>&nbsp;<span class="op" id="7971721">:=</span>&nbsp;<span class="ident" id="7971724">fset</span><span class="op" id="7971728">.</span><span class="ident" id="7971729">Base</span><span class="op" id="7971733">(</span><span class="op" id="7971734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971738">if</span>&nbsp;<span class="ident" id="7971741">i</span><span class="op" id="7971742">%</span><span class="num" id="7971743">2</span>&nbsp;<span class="op" id="7971745">==</span>&nbsp;<span class="num" id="7971748">1</span>&nbsp;<span class="op" id="7971750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971755">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971802">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971843">base</span>&nbsp;<span class="op" id="7971848">=</span>&nbsp;<span class="op" id="7971850">-</span><span class="num" id="7971851">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971859">fset</span><span class="op" id="7971863">.</span><span class="ident" id="7971864">AddFile</span><span class="op" id="7971871">(</span><span class="ident" id="7971872">test</span><span class="op" id="7971876">.</span><span class="ident" id="7971877">filename</span><span class="op" id="7971885">,</span>&nbsp;<span class="ident" id="7971887">base</span><span class="op" id="7971891">,</span>&nbsp;<span class="ident" id="7971893">test</span><span class="op" id="7971897">.</span><span class="ident" id="7971898">size</span><span class="op" id="7971902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971906">j</span>&nbsp;<span class="op" id="7971908">:=</span>&nbsp;<span class="num" id="7971911">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971915">fset</span><span class="op" id="7971919">.</span><span class="ident" id="7971920">Iterate</span><span class="op" id="7971927">(</span><span class="keyword" id="7971928">func</span><span class="op" id="7971932">(</span><span class="ident" id="7971933">f</span>&nbsp;<span class="op" id="7971935">*</span><span class="ident" id="7971936">File</span><span class="op" id="7971940">)</span>&nbsp;<span class="builtintype" id="7971942">bool</span>&nbsp;<span class="op" id="7971947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971952">if</span>&nbsp;<span class="ident" id="7971955">f</span><span class="op" id="7971956">.</span><span class="ident" id="7971957">Name</span><span class="op" id="7971961">(</span><span class="op" id="7971962">)</span>&nbsp;<span class="op" id="7971964">!=</span>&nbsp;<span class="ident" id="7971967">tests</span><span class="op" id="7971972">[</span><span class="ident" id="7971973">j</span><span class="op" id="7971974">]</span><span class="op" id="7971975">.</span><span class="ident" id="7971976">filename</span>&nbsp;<span class="op" id="7971985">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971991">t</span><span class="op" id="7971992">.</span><span class="ident" id="7971993">Errorf</span><span class="op" id="7971999">(</span><span class="string" id="7972000">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7972028">,</span>&nbsp;<span class="ident" id="7972030">f</span><span class="op" id="7972031">.</span><span class="ident" id="7972032">Name</span><span class="op" id="7972036">(</span><span class="op" id="7972037">)</span><span class="op" id="7972038">,</span>&nbsp;<span class="ident" id="7972040">tests</span><span class="op" id="7972045">[</span><span class="ident" id="7972046">j</span><span class="op" id="7972047">]</span><span class="op" id="7972048">.</span><span class="ident" id="7972049">filename</span><span class="op" id="7972057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972067">j</span><span class="op" id="7972068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972074">return</span>&nbsp;<span class="builtintype" id="7972081">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972088">}</span><span class="op" id="7972089">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972093">if</span>&nbsp;<span class="ident" id="7972096">j</span>&nbsp;<span class="op" id="7972098">!=</span>&nbsp;<span class="ident" id="7972101">i</span><span class="op" id="7972102">+</span><span class="num" id="7972103">1</span>&nbsp;<span class="op" id="7972105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972110">t</span><span class="op" id="7972111">.</span><span class="ident" id="7972112">Errorf</span><span class="op" id="7972118">(</span><span class="string" id="7972119">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7972142">,</span>&nbsp;<span class="ident" id="7972144">j</span><span class="op" id="7972145">,</span>&nbsp;<span class="ident" id="7972147">i</span><span class="op" id="7972148">+</span><span class="num" id="7972149">1</span><span class="op" id="7972150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972157">}</span><br>
<span class="lineno"></span><span class="op" id="7972159">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7972162">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7972235">func</span>&nbsp;<span class="ident" id="7972240">TestFileSetPastEnd</span><span class="op" id="7972258">(</span><span class="ident" id="7972259">t</span>&nbsp;<span class="op" id="7972261">*</span><span class="ident" id="7972262">testing</span><span class="op" id="7972269">.</span><span class="ident" id="7972270">T</span><span class="op" id="7972271">)</span>&nbsp;<span class="op" id="7972273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972276">fset</span>&nbsp;<span class="op" id="7972281">:=</span>&nbsp;<span class="ident" id="7972284">NewFileSet</span><span class="op" id="7972294">(</span><span class="op" id="7972295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972298">for</span>&nbsp;<span class="ident" id="7972302">_</span><span class="op" id="7972303">,</span>&nbsp;<span class="ident" id="7972305">test</span>&nbsp;<span class="op" id="7972310">:=</span>&nbsp;<span class="keyword" id="7972313">range</span>&nbsp;<span class="ident" id="7972319">tests</span>&nbsp;<span class="op" id="7972325">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972329">fset</span><span class="op" id="7972333">.</span><span class="ident" id="7972334">AddFile</span><span class="op" id="7972341">(</span><span class="ident" id="7972342">test</span><span class="op" id="7972346">.</span><span class="ident" id="7972347">filename</span><span class="op" id="7972355">,</span>&nbsp;<span class="ident" id="7972357">fset</span><span class="op" id="7972361">.</span><span class="ident" id="7972362">Base</span><span class="op" id="7972366">(</span><span class="op" id="7972367">)</span><span class="op" id="7972368">,</span>&nbsp;<span class="ident" id="7972370">test</span><span class="op" id="7972374">.</span><span class="ident" id="7972375">size</span><span class="op" id="7972379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972385">if</span>&nbsp;<span class="ident" id="7972388">f</span>&nbsp;<span class="op" id="7972390">:=</span>&nbsp;<span class="ident" id="7972393">fset</span><span class="op" id="7972397">.</span><span class="ident" id="7972398">File</span><span class="op" id="7972402">(</span><span class="ident" id="7972403">Pos</span><span class="op" id="7972406">(</span><span class="ident" id="7972407">fset</span><span class="op" id="7972411">.</span><span class="ident" id="7972412">Base</span><span class="op" id="7972416">(</span><span class="op" id="7972417">)</span><span class="op" id="7972418">)</span><span class="op" id="7972419">)</span><span class="op" id="7972420">;</span>&nbsp;<span class="ident" id="7972422">f</span>&nbsp;<span class="op" id="7972424">!=</span>&nbsp;<span class="ident" id="7972427">nil</span>&nbsp;<span class="op" id="7972431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972435">t</span><span class="op" id="7972436">.</span><span class="ident" id="7972437">Errorf</span><span class="op" id="7972443">(</span><span class="string" id="7972444">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7972462">,</span>&nbsp;<span class="ident" id="7972464">f</span><span class="op" id="7972465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972468">}</span><br>
<span class="lineno">200</span><span class="op" id="7972470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7972473">func</span>&nbsp;<span class="ident" id="7972478">TestFileSetCacheUnlikely</span><span class="op" id="7972502">(</span><span class="ident" id="7972503">t</span>&nbsp;<span class="op" id="7972505">*</span><span class="ident" id="7972506">testing</span><span class="op" id="7972513">.</span><span class="ident" id="7972514">T</span><span class="op" id="7972515">)</span>&nbsp;<span class="op" id="7972517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972520">fset</span>&nbsp;<span class="op" id="7972525">:=</span>&nbsp;<span class="ident" id="7972528">NewFileSet</span><span class="op" id="7972538">(</span><span class="op" id="7972539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972542">offsets</span>&nbsp;<span class="op" id="7972550">:=</span>&nbsp;<span class="builtinfunc" id="7972553">make</span><span class="op" id="7972557">(</span><span class="keyword" id="7972558">map</span><span class="op" id="7972561">[</span><span class="builtintype" id="7972562">string</span><span class="op" id="7972568">]</span><span class="builtintype" id="7972569">int</span><span class="op" id="7972572">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972575">for</span>&nbsp;<span class="ident" id="7972579">_</span><span class="op" id="7972580">,</span>&nbsp;<span class="ident" id="7972582">test</span>&nbsp;<span class="op" id="7972587">:=</span>&nbsp;<span class="keyword" id="7972590">range</span>&nbsp;<span class="ident" id="7972596">tests</span>&nbsp;<span class="op" id="7972602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972606">offsets</span><span class="op" id="7972613">[</span><span class="ident" id="7972614">test</span><span class="op" id="7972618">.</span><span class="ident" id="7972619">filename</span><span class="op" id="7972627">]</span>&nbsp;<span class="op" id="7972629">=</span>&nbsp;<span class="ident" id="7972631">fset</span><span class="op" id="7972635">.</span><span class="ident" id="7972636">Base</span><span class="op" id="7972640">(</span><span class="op" id="7972641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972645">fset</span><span class="op" id="7972649">.</span><span class="ident" id="7972650">AddFile</span><span class="op" id="7972657">(</span><span class="ident" id="7972658">test</span><span class="op" id="7972662">.</span><span class="ident" id="7972663">filename</span><span class="op" id="7972671">,</span>&nbsp;<span class="ident" id="7972673">fset</span><span class="op" id="7972677">.</span><span class="ident" id="7972678">Base</span><span class="op" id="7972682">(</span><span class="op" id="7972683">)</span><span class="op" id="7972684">,</span>&nbsp;<span class="ident" id="7972686">test</span><span class="op" id="7972690">.</span><span class="ident" id="7972691">size</span><span class="op" id="7972695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972701">for</span>&nbsp;<span class="ident" id="7972705">file</span><span class="op" id="7972709">,</span>&nbsp;<span class="ident" id="7972711">pos</span>&nbsp;<span class="op" id="7972715">:=</span>&nbsp;<span class="keyword" id="7972718">range</span>&nbsp;<span class="ident" id="7972724">offsets</span>&nbsp;<span class="op" id="7972732">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972736">f</span>&nbsp;<span class="op" id="7972738">:=</span>&nbsp;<span class="ident" id="7972741">fset</span><span class="op" id="7972745">.</span><span class="ident" id="7972746">File</span><span class="op" id="7972750">(</span><span class="ident" id="7972751">Pos</span><span class="op" id="7972754">(</span><span class="ident" id="7972755">pos</span><span class="op" id="7972758">)</span><span class="op" id="7972759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972763">if</span>&nbsp;<span class="ident" id="7972766">f</span><span class="op" id="7972767">.</span><span class="ident" id="7972768">Name</span><span class="op" id="7972772">(</span><span class="op" id="7972773">)</span>&nbsp;<span class="op" id="7972775">!=</span>&nbsp;<span class="ident" id="7972778">file</span>&nbsp;<span class="op" id="7972783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972788">t</span><span class="op" id="7972789">.</span><span class="ident" id="7972790">Errorf</span><span class="op" id="7972796">(</span><span class="string" id="7972797">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7972829">,</span>&nbsp;<span class="ident" id="7972831">f</span><span class="op" id="7972832">.</span><span class="ident" id="7972833">Name</span><span class="op" id="7972837">(</span><span class="op" id="7972838">)</span><span class="op" id="7972839">,</span>&nbsp;<span class="ident" id="7972841">pos</span><span class="op" id="7972844">,</span>&nbsp;<span class="ident" id="7972846">file</span><span class="op" id="7972850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972857">}</span><br>
<span class="lineno">215</span><span class="op" id="7972859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7972862">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7972931">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7972970">func</span>&nbsp;<span class="ident" id="7972975">TestFileSetRace</span><span class="op" id="7972990">(</span><span class="ident" id="7972991">t</span>&nbsp;<span class="op" id="7972993">*</span><span class="ident" id="7972994">testing</span><span class="op" id="7973001">.</span><span class="ident" id="7973002">T</span><span class="op" id="7973003">)</span>&nbsp;<span class="op" id="7973005">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973008">fset</span>&nbsp;<span class="op" id="7973013">:=</span>&nbsp;<span class="ident" id="7973016">NewFileSet</span><span class="op" id="7973026">(</span><span class="op" id="7973027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973030">for</span>&nbsp;<span class="ident" id="7973034">i</span>&nbsp;<span class="op" id="7973036">:=</span>&nbsp;<span class="num" id="7973039">0</span><span class="op" id="7973040">;</span>&nbsp;<span class="ident" id="7973042">i</span>&nbsp;<span class="op" id="7973044">&lt;</span>&nbsp;<span class="num" id="7973046">100</span><span class="op" id="7973049">;</span>&nbsp;<span class="ident" id="7973051">i</span><span class="op" id="7973052">++</span>&nbsp;<span class="op" id="7973055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973059">fset</span><span class="op" id="7973063">.</span><span class="ident" id="7973064">AddFile</span><span class="op" id="7973071">(</span><span class="ident" id="7973072">fmt</span><span class="op" id="7973075">.</span><span class="ident" id="7973076">Sprintf</span><span class="op" id="7973083">(</span><span class="string" id="7973084">&#34;file-%d&#34;</span><span class="op" id="7973093">,</span>&nbsp;<span class="ident" id="7973095">i</span><span class="op" id="7973096">)</span><span class="op" id="7973097">,</span>&nbsp;<span class="ident" id="7973099">fset</span><span class="op" id="7973103">.</span><span class="ident" id="7973104">Base</span><span class="op" id="7973108">(</span><span class="op" id="7973109">)</span><span class="op" id="7973110">,</span>&nbsp;<span class="num" id="7973112">1031</span><span class="op" id="7973116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973122">max</span>&nbsp;<span class="op" id="7973126">:=</span>&nbsp;<span class="builtintype" id="7973129">int32</span><span class="op" id="7973134">(</span><span class="ident" id="7973135">fset</span><span class="op" id="7973139">.</span><span class="ident" id="7973140">Base</span><span class="op" id="7973144">(</span><span class="op" id="7973145">)</span><span class="op" id="7973146">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973149">var</span>&nbsp;<span class="ident" id="7973153">stop</span>&nbsp;<span class="ident" id="7973158">sync</span><span class="op" id="7973162">.</span><span class="ident" id="7973163">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973174">r</span>&nbsp;<span class="op" id="7973176">:=</span>&nbsp;<span class="ident" id="7973179">rand</span><span class="op" id="7973183">.</span><span class="ident" id="7973184">New</span><span class="op" id="7973187">(</span><span class="ident" id="7973188">rand</span><span class="op" id="7973192">.</span><span class="ident" id="7973193">NewSource</span><span class="op" id="7973202">(</span><span class="num" id="7973203">7</span><span class="op" id="7973204">)</span><span class="op" id="7973205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973208">for</span>&nbsp;<span class="ident" id="7973212">i</span>&nbsp;<span class="op" id="7973214">:=</span>&nbsp;<span class="num" id="7973217">0</span><span class="op" id="7973218">;</span>&nbsp;<span class="ident" id="7973220">i</span>&nbsp;<span class="op" id="7973222">&lt;</span>&nbsp;<span class="num" id="7973224">2</span><span class="op" id="7973225">;</span>&nbsp;<span class="ident" id="7973227">i</span><span class="op" id="7973228">++</span>&nbsp;<span class="op" id="7973231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973235">r</span>&nbsp;<span class="op" id="7973237">:=</span>&nbsp;<span class="ident" id="7973240">rand</span><span class="op" id="7973244">.</span><span class="ident" id="7973245">New</span><span class="op" id="7973248">(</span><span class="ident" id="7973249">rand</span><span class="op" id="7973253">.</span><span class="ident" id="7973254">NewSource</span><span class="op" id="7973263">(</span><span class="ident" id="7973264">r</span><span class="op" id="7973265">.</span><span class="ident" id="7973266">Int63</span><span class="op" id="7973271">(</span><span class="op" id="7973272">)</span><span class="op" id="7973273">)</span><span class="op" id="7973274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973278">stop</span><span class="op" id="7973282">.</span><span class="ident" id="7973283">Add</span><span class="op" id="7973286">(</span><span class="num" id="7973287">1</span><span class="op" id="7973288">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973292">go</span>&nbsp;<span class="keyword" id="7973295">func</span><span class="op" id="7973299">(</span><span class="op" id="7973300">)</span>&nbsp;<span class="op" id="7973302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973307">for</span>&nbsp;<span class="ident" id="7973311">i</span>&nbsp;<span class="op" id="7973313">:=</span>&nbsp;<span class="num" id="7973316">0</span><span class="op" id="7973317">;</span>&nbsp;<span class="ident" id="7973319">i</span>&nbsp;<span class="op" id="7973321">&lt;</span>&nbsp;<span class="num" id="7973323">1000</span><span class="op" id="7973327">;</span>&nbsp;<span class="ident" id="7973329">i</span><span class="op" id="7973330">++</span>&nbsp;<span class="op" id="7973333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973339">fset</span><span class="op" id="7973343">.</span><span class="ident" id="7973344">Position</span><span class="op" id="7973352">(</span><span class="ident" id="7973353">Pos</span><span class="op" id="7973356">(</span><span class="ident" id="7973357">r</span><span class="op" id="7973358">.</span><span class="ident" id="7973359">Int31n</span><span class="op" id="7973365">(</span><span class="ident" id="7973366">max</span><span class="op" id="7973369">)</span><span class="op" id="7973370">)</span><span class="op" id="7973371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973381">stop</span><span class="op" id="7973385">.</span><span class="ident" id="7973386">Done</span><span class="op" id="7973390">(</span><span class="op" id="7973391">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973395">}</span><span class="op" id="7973396">(</span><span class="op" id="7973397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973403">stop</span><span class="op" id="7973407">.</span><span class="ident" id="7973408">Wait</span><span class="op" id="7973412">(</span><span class="op" id="7973413">)</span><br>
<span class="lineno"></span><span class="op" id="7973415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7973418">func</span>&nbsp;<span class="ident" id="7973423">TestPositionFor</span><span class="op" id="7973438">(</span><span class="ident" id="7973439">t</span>&nbsp;<span class="op" id="7973441">*</span><span class="ident" id="7973442">testing</span><span class="op" id="7973449">.</span><span class="ident" id="7973450">T</span><span class="op" id="7973451">)</span>&nbsp;<span class="op" id="7973453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973456">src</span>&nbsp;<span class="op" id="7973460">:=</span>&nbsp;<span class="op" id="7973463">[</span><span class="op" id="7973464">]</span><span class="builtintype" id="7973465">byte</span><span class="op" id="7973469">(</span><span class="string" id="7973470">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7973519">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973523">const</span>&nbsp;<span class="ident" id="7973529">filename</span>&nbsp;<span class="op" id="7973538">=</span>&nbsp;<span class="string" id="7973540">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973547">fset</span>&nbsp;<span class="op" id="7973552">:=</span>&nbsp;<span class="ident" id="7973555">NewFileSet</span><span class="op" id="7973565">(</span><span class="op" id="7973566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973569">f</span>&nbsp;<span class="op" id="7973571">:=</span>&nbsp;<span class="ident" id="7973574">fset</span><span class="op" id="7973578">.</span><span class="ident" id="7973579">AddFile</span><span class="op" id="7973586">(</span><span class="ident" id="7973587">filename</span><span class="op" id="7973595">,</span>&nbsp;<span class="ident" id="7973597">fset</span><span class="op" id="7973601">.</span><span class="ident" id="7973602">Base</span><span class="op" id="7973606">(</span><span class="op" id="7973607">)</span><span class="op" id="7973608">,</span>&nbsp;<span class="builtinfunc" id="7973610">len</span><span class="op" id="7973613">(</span><span class="ident" id="7973614">src</span><span class="op" id="7973617">)</span><span class="op" id="7973618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973621">f</span><span class="op" id="7973622">.</span><span class="ident" id="7973623">SetLinesForContent</span><span class="op" id="7973641">(</span><span class="ident" id="7973642">src</span><span class="op" id="7973645">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7973649">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973674">for</span>&nbsp;<span class="ident" id="7973678">i</span><span class="op" id="7973679">,</span>&nbsp;<span class="ident" id="7973681">offs</span>&nbsp;<span class="op" id="7973686">:=</span>&nbsp;<span class="keyword" id="7973689">range</span>&nbsp;<span class="ident" id="7973695">f</span><span class="op" id="7973696">.</span><span class="ident" id="7973697">lines</span>&nbsp;<span class="op" id="7973703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973707">got1</span>&nbsp;<span class="op" id="7973712">:=</span>&nbsp;<span class="ident" id="7973715">f</span><span class="op" id="7973716">.</span><span class="ident" id="7973717">PositionFor</span><span class="op" id="7973728">(</span><span class="ident" id="7973729">f</span><span class="op" id="7973730">.</span><span class="ident" id="7973731">Pos</span><span class="op" id="7973734">(</span><span class="ident" id="7973735">offs</span><span class="op" id="7973739">)</span><span class="op" id="7973740">,</span>&nbsp;<span class="builtintype" id="7973742">false</span><span class="op" id="7973747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973751">got2</span>&nbsp;<span class="op" id="7973756">:=</span>&nbsp;<span class="ident" id="7973759">f</span><span class="op" id="7973760">.</span><span class="ident" id="7973761">PositionFor</span><span class="op" id="7973772">(</span><span class="ident" id="7973773">f</span><span class="op" id="7973774">.</span><span class="ident" id="7973775">Pos</span><span class="op" id="7973778">(</span><span class="ident" id="7973779">offs</span><span class="op" id="7973783">)</span><span class="op" id="7973784">,</span>&nbsp;<span class="builtintype" id="7973786">true</span><span class="op" id="7973790">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973794">got3</span>&nbsp;<span class="op" id="7973799">:=</span>&nbsp;<span class="ident" id="7973802">f</span><span class="op" id="7973803">.</span><span class="ident" id="7973804">Position</span><span class="op" id="7973812">(</span><span class="ident" id="7973813">f</span><span class="op" id="7973814">.</span><span class="ident" id="7973815">Pos</span><span class="op" id="7973818">(</span><span class="ident" id="7973819">offs</span><span class="op" id="7973823">)</span><span class="op" id="7973824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973828">want</span>&nbsp;<span class="op" id="7973833">:=</span>&nbsp;<span class="ident" id="7973836">Position</span><span class="op" id="7973844">{</span><span class="ident" id="7973845">filename</span><span class="op" id="7973853">,</span>&nbsp;<span class="ident" id="7973855">offs</span><span class="op" id="7973859">,</span>&nbsp;<span class="ident" id="7973861">i</span>&nbsp;<span class="op" id="7973863">+</span>&nbsp;<span class="num" id="7973865">1</span><span class="op" id="7973866">,</span>&nbsp;<span class="num" id="7973868">1</span><span class="op" id="7973869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973873">checkPos</span><span class="op" id="7973881">(</span><span class="ident" id="7973882">t</span><span class="op" id="7973883">,</span>&nbsp;<span class="string" id="7973885">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7973912">,</span>&nbsp;<span class="ident" id="7973914">got1</span><span class="op" id="7973918">,</span>&nbsp;<span class="ident" id="7973920">want</span><span class="op" id="7973924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973928">checkPos</span><span class="op" id="7973936">(</span><span class="ident" id="7973937">t</span><span class="op" id="7973938">,</span>&nbsp;<span class="string" id="7973940">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7973965">,</span>&nbsp;<span class="ident" id="7973967">got2</span><span class="op" id="7973971">,</span>&nbsp;<span class="ident" id="7973973">want</span><span class="op" id="7973977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973981">checkPos</span><span class="op" id="7973989">(</span><span class="ident" id="7973990">t</span><span class="op" id="7973991">,</span>&nbsp;<span class="string" id="7973993">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7974006">,</span>&nbsp;<span class="ident" id="7974008">got3</span><span class="op" id="7974012">,</span>&nbsp;<span class="ident" id="7974014">want</span><span class="op" id="7974018">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974025">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974070">const</span>&nbsp;<span class="ident" id="7974076">l1</span><span class="op" id="7974078">,</span>&nbsp;<span class="ident" id="7974080">l2</span>&nbsp;<span class="op" id="7974083">=</span>&nbsp;<span class="num" id="7974085">5</span><span class="op" id="7974086">,</span>&nbsp;<span class="num" id="7974088">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974091">f</span><span class="op" id="7974092">.</span><span class="ident" id="7974093">AddLineInfo</span><span class="op" id="7974104">(</span><span class="ident" id="7974105">f</span><span class="op" id="7974106">.</span><span class="ident" id="7974107">lines</span><span class="op" id="7974112">[</span><span class="ident" id="7974113">l1</span><span class="op" id="7974115">-</span><span class="num" id="7974116">1</span><span class="op" id="7974117">]</span><span class="op" id="7974118">,</span>&nbsp;<span class="string" id="7974120">&#34;&#34;</span><span class="op" id="7974122">,</span>&nbsp;<span class="num" id="7974124">100</span><span class="op" id="7974127">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974130">f</span><span class="op" id="7974131">.</span><span class="ident" id="7974132">AddLineInfo</span><span class="op" id="7974143">(</span><span class="ident" id="7974144">f</span><span class="op" id="7974145">.</span><span class="ident" id="7974146">lines</span><span class="op" id="7974151">[</span><span class="ident" id="7974152">l2</span><span class="op" id="7974154">-</span><span class="num" id="7974155">1</span><span class="op" id="7974156">]</span><span class="op" id="7974157">,</span>&nbsp;<span class="string" id="7974159">&#34;bar&#34;</span><span class="op" id="7974164">,</span>&nbsp;<span class="num" id="7974166">3</span><span class="op" id="7974167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974171">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974222">for</span>&nbsp;<span class="ident" id="7974226">i</span><span class="op" id="7974227">,</span>&nbsp;<span class="ident" id="7974229">offs</span>&nbsp;<span class="op" id="7974234">:=</span>&nbsp;<span class="keyword" id="7974237">range</span>&nbsp;<span class="ident" id="7974243">f</span><span class="op" id="7974244">.</span><span class="ident" id="7974245">lines</span>&nbsp;<span class="op" id="7974251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974255">got1</span>&nbsp;<span class="op" id="7974260">:=</span>&nbsp;<span class="ident" id="7974263">f</span><span class="op" id="7974264">.</span><span class="ident" id="7974265">PositionFor</span><span class="op" id="7974276">(</span><span class="ident" id="7974277">f</span><span class="op" id="7974278">.</span><span class="ident" id="7974279">Pos</span><span class="op" id="7974282">(</span><span class="ident" id="7974283">offs</span><span class="op" id="7974287">)</span><span class="op" id="7974288">,</span>&nbsp;<span class="builtintype" id="7974290">false</span><span class="op" id="7974295">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974299">want</span>&nbsp;<span class="op" id="7974304">:=</span>&nbsp;<span class="ident" id="7974307">Position</span><span class="op" id="7974315">{</span><span class="ident" id="7974316">filename</span><span class="op" id="7974324">,</span>&nbsp;<span class="ident" id="7974326">offs</span><span class="op" id="7974330">,</span>&nbsp;<span class="ident" id="7974332">i</span>&nbsp;<span class="op" id="7974334">+</span>&nbsp;<span class="num" id="7974336">1</span><span class="op" id="7974337">,</span>&nbsp;<span class="num" id="7974339">1</span><span class="op" id="7974340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974344">checkPos</span><span class="op" id="7974352">(</span><span class="ident" id="7974353">t</span><span class="op" id="7974354">,</span>&nbsp;<span class="string" id="7974356">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7974383">,</span>&nbsp;<span class="ident" id="7974385">got1</span><span class="op" id="7974389">,</span>&nbsp;<span class="ident" id="7974391">want</span><span class="op" id="7974395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974402">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974449">for</span>&nbsp;<span class="ident" id="7974453">i</span><span class="op" id="7974454">,</span>&nbsp;<span class="ident" id="7974456">offs</span>&nbsp;<span class="op" id="7974461">:=</span>&nbsp;<span class="keyword" id="7974464">range</span>&nbsp;<span class="ident" id="7974470">f</span><span class="op" id="7974471">.</span><span class="ident" id="7974472">lines</span>&nbsp;<span class="op" id="7974478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974482">got2</span>&nbsp;<span class="op" id="7974487">:=</span>&nbsp;<span class="ident" id="7974490">f</span><span class="op" id="7974491">.</span><span class="ident" id="7974492">PositionFor</span><span class="op" id="7974503">(</span><span class="ident" id="7974504">f</span><span class="op" id="7974505">.</span><span class="ident" id="7974506">Pos</span><span class="op" id="7974509">(</span><span class="ident" id="7974510">offs</span><span class="op" id="7974514">)</span><span class="op" id="7974515">,</span>&nbsp;<span class="builtintype" id="7974517">true</span><span class="op" id="7974521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974525">got3</span>&nbsp;<span class="op" id="7974530">:=</span>&nbsp;<span class="ident" id="7974533">f</span><span class="op" id="7974534">.</span><span class="ident" id="7974535">Position</span><span class="op" id="7974543">(</span><span class="ident" id="7974544">f</span><span class="op" id="7974545">.</span><span class="ident" id="7974546">Pos</span><span class="op" id="7974549">(</span><span class="ident" id="7974550">offs</span><span class="op" id="7974554">)</span><span class="op" id="7974555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974559">want</span>&nbsp;<span class="op" id="7974564">:=</span>&nbsp;<span class="ident" id="7974567">Position</span><span class="op" id="7974575">{</span><span class="ident" id="7974576">filename</span><span class="op" id="7974584">,</span>&nbsp;<span class="ident" id="7974586">offs</span><span class="op" id="7974590">,</span>&nbsp;<span class="ident" id="7974592">i</span>&nbsp;<span class="op" id="7974594">+</span>&nbsp;<span class="num" id="7974596">1</span><span class="op" id="7974597">,</span>&nbsp;<span class="num" id="7974599">1</span><span class="op" id="7974600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974604">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974651">line</span>&nbsp;<span class="op" id="7974656">:=</span>&nbsp;<span class="ident" id="7974659">want</span><span class="op" id="7974663">.</span><span class="ident" id="7974664">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974671">if</span>&nbsp;<span class="ident" id="7974674">i</span><span class="op" id="7974675">+</span><span class="num" id="7974676">1</span>&nbsp;<span class="op" id="7974678">&gt;=</span>&nbsp;<span class="ident" id="7974681">l1</span>&nbsp;<span class="op" id="7974684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974689">want</span><span class="op" id="7974693">.</span><span class="ident" id="7974694">Filename</span>&nbsp;<span class="op" id="7974703">=</span>&nbsp;<span class="string" id="7974705">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974711">want</span><span class="op" id="7974715">.</span><span class="ident" id="7974716">Line</span>&nbsp;<span class="op" id="7974721">=</span>&nbsp;<span class="ident" id="7974723">line</span>&nbsp;<span class="op" id="7974728">-</span>&nbsp;<span class="ident" id="7974730">l1</span>&nbsp;<span class="op" id="7974733">+</span>&nbsp;<span class="num" id="7974735">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974741">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974745">if</span>&nbsp;<span class="ident" id="7974748">i</span><span class="op" id="7974749">+</span><span class="num" id="7974750">1</span>&nbsp;<span class="op" id="7974752">&gt;=</span>&nbsp;<span class="ident" id="7974755">l2</span>&nbsp;<span class="op" id="7974758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974763">want</span><span class="op" id="7974767">.</span><span class="ident" id="7974768">Filename</span>&nbsp;<span class="op" id="7974777">=</span>&nbsp;<span class="string" id="7974779">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974788">want</span><span class="op" id="7974792">.</span><span class="ident" id="7974793">Line</span>&nbsp;<span class="op" id="7974798">=</span>&nbsp;<span class="ident" id="7974800">line</span>&nbsp;<span class="op" id="7974805">-</span>&nbsp;<span class="ident" id="7974807">l2</span>&nbsp;<span class="op" id="7974810">+</span>&nbsp;<span class="num" id="7974812">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974820">checkPos</span><span class="op" id="7974828">(</span><span class="ident" id="7974829">t</span><span class="op" id="7974830">,</span>&nbsp;<span class="string" id="7974832">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7974857">,</span>&nbsp;<span class="ident" id="7974859">got2</span><span class="op" id="7974863">,</span>&nbsp;<span class="ident" id="7974865">want</span><span class="op" id="7974869">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974873">checkPos</span><span class="op" id="7974881">(</span><span class="ident" id="7974882">t</span><span class="op" id="7974883">,</span>&nbsp;<span class="string" id="7974885">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7974898">,</span>&nbsp;<span class="ident" id="7974900">got3</span><span class="op" id="7974904">,</span>&nbsp;<span class="ident" id="7974906">want</span><span class="op" id="7974910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974913">}</span><br>
<span class="lineno"></span><span class="op" id="7974915">}</span>
</div>
</body>
</html>
