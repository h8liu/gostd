<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2956893">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2956948">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2957002">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2957053">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="2957110">package</span>&nbsp;<span class="ident" id="2957118">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2957128">import</span>&nbsp;<span class="op" id="2957135">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2957138">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2957147">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="2957158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2957161">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2957230">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="2957286">type</span>&nbsp;<span class="ident" id="2957291">ResponseRecorder</span>&nbsp;<span class="keyword" id="2957308">struct</span>&nbsp;<span class="op" id="2957315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957318">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2957328">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2957342">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957386">HeaderMap</span>&nbsp;<span class="ident" id="2957396">http</span><span class="op" id="2957400">.</span><span class="ident" id="2957401">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2957410">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957440">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957450">*</span><span class="ident" id="2957451">bytes</span><span class="op" id="2957456">.</span><span class="ident" id="2957457">Buffer</span>&nbsp;<span class="comment" id="2957464">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957523">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2957533">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957540">wroteHeader</span>&nbsp;<span class="builtintype" id="2957552">bool</span><br>
<span class="lineno"></span><span class="op" id="2957557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2957560">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="2957616">func</span>&nbsp;<span class="ident" id="2957621">NewRecorder</span><span class="op" id="2957632">(</span><span class="op" id="2957633">)</span>&nbsp;<span class="op" id="2957635">*</span><span class="ident" id="2957636">ResponseRecorder</span>&nbsp;<span class="op" id="2957653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2957656">return</span>&nbsp;<span class="op" id="2957663">&amp;</span><span class="ident" id="2957664">ResponseRecorder</span><span class="op" id="2957680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957684">HeaderMap</span><span class="op" id="2957693">:</span>&nbsp;<span class="builtinfunc" id="2957695">make</span><span class="op" id="2957699">(</span><span class="ident" id="2957700">http</span><span class="op" id="2957704">.</span><span class="ident" id="2957705">Header</span><span class="op" id="2957711">)</span><span class="op" id="2957712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957716">Body</span><span class="op" id="2957720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2957727">new</span><span class="op" id="2957730">(</span><span class="ident" id="2957731">bytes</span><span class="op" id="2957736">.</span><span class="ident" id="2957737">Buffer</span><span class="op" id="2957743">)</span><span class="op" id="2957744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2957748">Code</span><span class="op" id="2957752">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="2957759">200</span><span class="op" id="2957762">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2957765">}</span><br>
<span class="lineno"></span><span class="op" id="2957767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2957770">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2957848">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="2957912">const</span>&nbsp;<span class="ident" id="2957918">DefaultRemoteAddr</span>&nbsp;<span class="op" id="2957936">=</span>&nbsp;<span class="string" id="2957938">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2957949">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="2957989">func</span>&nbsp;<span class="op" id="2957994">(</span><span class="ident" id="2957995">rw</span>&nbsp;<span class="op" id="2957998">*</span><span class="ident" id="2957999">ResponseRecorder</span><span class="op" id="2958015">)</span>&nbsp;<span class="ident" id="2958017">Header</span><span class="op" id="2958023">(</span><span class="op" id="2958024">)</span>&nbsp;<span class="ident" id="2958026">http</span><span class="op" id="2958030">.</span><span class="ident" id="2958031">Header</span>&nbsp;<span class="op" id="2958038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958041">m</span>&nbsp;<span class="op" id="2958043">:=</span>&nbsp;<span class="ident" id="2958046">rw</span><span class="op" id="2958048">.</span><span class="ident" id="2958049">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2958060">if</span>&nbsp;<span class="ident" id="2958063">m</span>&nbsp;<span class="op" id="2958065">==</span>&nbsp;<span class="ident" id="2958068">nil</span>&nbsp;<span class="op" id="2958072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958076">m</span>&nbsp;<span class="op" id="2958078">=</span>&nbsp;<span class="builtinfunc" id="2958080">make</span><span class="op" id="2958084">(</span><span class="ident" id="2958085">http</span><span class="op" id="2958089">.</span><span class="ident" id="2958090">Header</span><span class="op" id="2958096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958100">rw</span><span class="op" id="2958102">.</span><span class="ident" id="2958103">HeaderMap</span>&nbsp;<span class="op" id="2958113">=</span>&nbsp;<span class="ident" id="2958115">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2958118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2958121">return</span>&nbsp;<span class="ident" id="2958128">m</span><br>
<span class="lineno">45</span><span class="op" id="2958130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2958133">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2958193">func</span>&nbsp;<span class="op" id="2958198">(</span><span class="ident" id="2958199">rw</span>&nbsp;<span class="op" id="2958202">*</span><span class="ident" id="2958203">ResponseRecorder</span><span class="op" id="2958219">)</span>&nbsp;<span class="ident" id="2958221">Write</span><span class="op" id="2958226">(</span><span class="ident" id="2958227">buf</span>&nbsp;<span class="op" id="2958231">[</span><span class="op" id="2958232">]</span><span class="builtintype" id="2958233">byte</span><span class="op" id="2958237">)</span>&nbsp;<span class="op" id="2958239">(</span><span class="builtintype" id="2958240">int</span><span class="op" id="2958243">,</span>&nbsp;<span class="builtintype" id="2958245">error</span><span class="op" id="2958250">)</span>&nbsp;<span class="op" id="2958252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2958255">if</span>&nbsp;<span class="op" id="2958258">!</span><span class="ident" id="2958259">rw</span><span class="op" id="2958261">.</span><span class="ident" id="2958262">wroteHeader</span>&nbsp;<span class="op" id="2958274">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958278">rw</span><span class="op" id="2958280">.</span><span class="ident" id="2958281">WriteHeader</span><span class="op" id="2958292">(</span><span class="num" id="2958293">200</span><span class="op" id="2958296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2958299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2958302">if</span>&nbsp;<span class="ident" id="2958305">rw</span><span class="op" id="2958307">.</span><span class="ident" id="2958308">Body</span>&nbsp;<span class="op" id="2958313">!=</span>&nbsp;<span class="ident" id="2958316">nil</span>&nbsp;<span class="op" id="2958320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958324">rw</span><span class="op" id="2958326">.</span><span class="ident" id="2958327">Body</span><span class="op" id="2958331">.</span><span class="ident" id="2958332">Write</span><span class="op" id="2958337">(</span><span class="ident" id="2958338">buf</span><span class="op" id="2958341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2958344">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2958347">return</span>&nbsp;<span class="builtinfunc" id="2958354">len</span><span class="op" id="2958357">(</span><span class="ident" id="2958358">buf</span><span class="op" id="2958361">)</span><span class="op" id="2958362">,</span>&nbsp;<span class="ident" id="2958364">nil</span><br>
<span class="lineno"></span><span class="op" id="2958368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2958371">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="2958400">func</span>&nbsp;<span class="op" id="2958405">(</span><span class="ident" id="2958406">rw</span>&nbsp;<span class="op" id="2958409">*</span><span class="ident" id="2958410">ResponseRecorder</span><span class="op" id="2958426">)</span>&nbsp;<span class="ident" id="2958428">WriteHeader</span><span class="op" id="2958439">(</span><span class="ident" id="2958440">code</span>&nbsp;<span class="builtintype" id="2958445">int</span><span class="op" id="2958448">)</span>&nbsp;<span class="op" id="2958450">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2958453">if</span>&nbsp;<span class="op" id="2958456">!</span><span class="ident" id="2958457">rw</span><span class="op" id="2958459">.</span><span class="ident" id="2958460">wroteHeader</span>&nbsp;<span class="op" id="2958472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958476">rw</span><span class="op" id="2958478">.</span><span class="ident" id="2958479">Code</span>&nbsp;<span class="op" id="2958484">=</span>&nbsp;<span class="ident" id="2958486">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2958492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958495">rw</span><span class="op" id="2958497">.</span><span class="ident" id="2958498">wroteHeader</span>&nbsp;<span class="op" id="2958510">=</span>&nbsp;<span class="builtintype" id="2958512">true</span><br>
<span class="lineno"></span><span class="op" id="2958517">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2958520">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="2958554">func</span>&nbsp;<span class="op" id="2958559">(</span><span class="ident" id="2958560">rw</span>&nbsp;<span class="op" id="2958563">*</span><span class="ident" id="2958564">ResponseRecorder</span><span class="op" id="2958580">)</span>&nbsp;<span class="ident" id="2958582">Flush</span><span class="op" id="2958587">(</span><span class="op" id="2958588">)</span>&nbsp;<span class="op" id="2958590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2958593">if</span>&nbsp;<span class="op" id="2958596">!</span><span class="ident" id="2958597">rw</span><span class="op" id="2958599">.</span><span class="ident" id="2958600">wroteHeader</span>&nbsp;<span class="op" id="2958612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958616">rw</span><span class="op" id="2958618">.</span><span class="ident" id="2958619">WriteHeader</span><span class="op" id="2958630">(</span><span class="num" id="2958631">200</span><span class="op" id="2958634">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2958637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2958640">rw</span><span class="op" id="2958642">.</span><span class="ident" id="2958643">Flushed</span>&nbsp;<span class="op" id="2958651">=</span>&nbsp;<span class="builtintype" id="2958653">true</span><br>
<span class="lineno"></span><span class="op" id="2958658">}</span>
</div>
</body>
</html>
