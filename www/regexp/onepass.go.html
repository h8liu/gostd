<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4680798">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4680854">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4680908">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4680959">package</span>&nbsp;<span class="ident" id="4680967">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4680975">import</span>&nbsp;<span class="op" id="4680982">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4680985">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4680994">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681011">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681019">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="4681029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4681032">//&nbsp;&#34;One-pass&#34;&nbsp;regexp&nbsp;execution.</span><br>
<span class="lineno">15</span><span class="comment" id="4681064">//&nbsp;Some&nbsp;regexps&nbsp;can&nbsp;be&nbsp;analyzed&nbsp;to&nbsp;determine&nbsp;that&nbsp;they&nbsp;never&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="4681130">//&nbsp;backtracking:&nbsp;they&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;one&nbsp;pass&nbsp;over&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="4681202">//&nbsp;without&nbsp;bothering&nbsp;to&nbsp;save&nbsp;all&nbsp;the&nbsp;usual&nbsp;NFA&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="4681256">//&nbsp;Detect&nbsp;those&nbsp;and&nbsp;execute&nbsp;them&nbsp;more&nbsp;quickly.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4681304">//&nbsp;A&nbsp;onePassProg&nbsp;is&nbsp;a&nbsp;compiled&nbsp;one-pass&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="4681372">//&nbsp;It&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;syntax.Prog&nbsp;except&nbsp;for&nbsp;the&nbsp;use&nbsp;of&nbsp;onePassInst.</span><br>
<span class="lineno"></span><span class="keyword" id="4681440">type</span>&nbsp;<span class="ident" id="4681445">onePassProg</span>&nbsp;<span class="keyword" id="4681457">struct</span>&nbsp;<span class="op" id="4681464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681467">Inst</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4681474">[</span><span class="op" id="4681475">]</span><span class="ident" id="4681476"><a href="/regexp/onepass.go.html#4681736">onePassInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681489">Start</span>&nbsp;&nbsp;<span class="builtintype" id="4681496">int</span>&nbsp;<span class="comment" id="4681500">//&nbsp;index&nbsp;of&nbsp;start&nbsp;instruction</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681531">NumCap</span>&nbsp;<span class="builtintype" id="4681538">int</span>&nbsp;<span class="comment" id="4681542">//&nbsp;number&nbsp;of&nbsp;InstCapture&nbsp;insts&nbsp;in&nbsp;re</span><br>
<span class="lineno"></span><span class="op" id="4681579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4681582">//&nbsp;A&nbsp;onePassInst&nbsp;is&nbsp;a&nbsp;single&nbsp;instruction&nbsp;in&nbsp;a&nbsp;one-pass&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="4681665">//&nbsp;It&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;syntax.Inst&nbsp;except&nbsp;for&nbsp;the&nbsp;new&nbsp;&#39;Next&#39;&nbsp;field.</span><br>
<span class="lineno">30</span><span class="keyword" id="4681731">type</span>&nbsp;<span class="ident" id="4681736">onePassInst</span>&nbsp;<span class="keyword" id="4681748">struct</span>&nbsp;<span class="op" id="4681755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681758"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4681764">.</span><span class="ident" id="4681765">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681771">Next</span>&nbsp;<span class="op" id="4681776">[</span><span class="op" id="4681777">]</span><span class="builtintype" id="4681778">uint32</span><br>
<span class="lineno"></span><span class="op" id="4681785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4681788">//&nbsp;OnePassPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;all&nbsp;matches&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4681855">//&nbsp;regexp&nbsp;must&nbsp;start&nbsp;with.&nbsp;&nbsp;Complete&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="4681914">//&nbsp;is&nbsp;the&nbsp;entire&nbsp;match.&nbsp;Pc&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;rune&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="4681983">//&nbsp;in&nbsp;the&nbsp;string.&nbsp;The&nbsp;OnePassPrefix&nbsp;skips&nbsp;over&nbsp;the&nbsp;mandatory</span><br>
<span class="lineno"></span><span class="comment" id="4682044">//&nbsp;EmptyBeginText</span><br>
<span class="lineno">40</span><span class="keyword" id="4682062">func</span>&nbsp;<span class="ident" id="4682067">onePassPrefix</span><span class="op" id="4682080">(</span><span class="ident" id="4682081">p</span>&nbsp;<span class="op" id="4682083">*</span><span class="ident" id="4682084"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682090">.</span><span class="ident" id="4682091">Prog</span><span class="op" id="4682095">)</span>&nbsp;<span class="op" id="4682097">(</span><span class="ident" id="4682098">prefix</span>&nbsp;<span class="builtintype" id="4682105">string</span><span class="op" id="4682111">,</span>&nbsp;<span class="ident" id="4682113">complete</span>&nbsp;<span class="builtintype" id="4682122">bool</span><span class="op" id="4682126">,</span>&nbsp;<span class="ident" id="4682128">pc</span>&nbsp;<span class="builtintype" id="4682131">uint32</span><span class="op" id="4682137">)</span>&nbsp;<span class="op" id="4682139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682142">i</span>&nbsp;<span class="op" id="4682144">:=</span>&nbsp;<span class="op" id="4682147">&amp;</span><span class="ident" id="4682148"><a href="/regexp/onepass.go.html#4682081">p</a></span><span class="op" id="4682149">.</span><span class="ident" id="4682150">Inst</span><span class="op" id="4682154">[</span><span class="ident" id="4682155"><a href="/regexp/onepass.go.html#4682081">p</a></span><span class="op" id="4682156">.</span><span class="ident" id="4682157">Start</span><span class="op" id="4682162">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682165">if</span>&nbsp;<span class="ident" id="4682168"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682169">.</span><span class="ident" id="4682170">Op</span>&nbsp;<span class="op" id="4682173">!=</span>&nbsp;<span class="ident" id="4682176"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682182">.</span><span class="ident" id="4682183">InstEmptyWidth</span>&nbsp;<span class="op" id="4682198">||</span>&nbsp;<span class="op" id="4682201">(</span><span class="ident" id="4682202"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682208">.</span><span class="ident" id="4682209">EmptyOp</span><span class="op" id="4682216">(</span><span class="ident" id="4682217"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682218">.</span><span class="ident" id="4682219">Arg</span><span class="op" id="4682222">)</span><span class="op" id="4682223">)</span><span class="op" id="4682224">&amp;</span><span class="ident" id="4682225"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682231">.</span><span class="ident" id="4682232">EmptyBeginText</span>&nbsp;<span class="op" id="4682247">==</span>&nbsp;<span class="num" id="4682250">0</span>&nbsp;<span class="op" id="4682252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682256">return</span>&nbsp;<span class="string" id="4682263">&#34;&#34;</span><span class="op" id="4682265">,</span>&nbsp;<span class="ident" id="4682267"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682268">.</span><span class="ident" id="4682269">Op</span>&nbsp;<span class="op" id="4682272">==</span>&nbsp;<span class="ident" id="4682275"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682281">.</span><span class="ident" id="4682282">InstMatch</span><span class="op" id="4682291">,</span>&nbsp;<span class="builtintype" id="4682293">uint32</span><span class="op" id="4682299">(</span><span class="ident" id="4682300"><a href="/regexp/onepass.go.html#4682081">p</a></span><span class="op" id="4682301">.</span><span class="ident" id="4682302">Start</span><span class="op" id="4682307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4682310">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682313"><a href="/regexp/onepass.go.html#4682128">pc</a></span>&nbsp;<span class="op" id="4682316">=</span>&nbsp;<span class="ident" id="4682318"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682319">.</span><span class="ident" id="4682320">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682325"><a href="/regexp/onepass.go.html#4682142">i</a></span>&nbsp;<span class="op" id="4682327">=</span>&nbsp;<span class="op" id="4682329">&amp;</span><span class="ident" id="4682330"><a href="/regexp/onepass.go.html#4682081">p</a></span><span class="op" id="4682331">.</span><span class="ident" id="4682332">Inst</span><span class="op" id="4682336">[</span><span class="ident" id="4682337"><a href="/regexp/onepass.go.html#4682128">pc</a></span><span class="op" id="4682339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682342">for</span>&nbsp;<span class="ident" id="4682346"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682347">.</span><span class="ident" id="4682348">Op</span>&nbsp;<span class="op" id="4682351">==</span>&nbsp;<span class="ident" id="4682354"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682360">.</span><span class="ident" id="4682361">InstNop</span>&nbsp;<span class="op" id="4682369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682373"><a href="/regexp/onepass.go.html#4682128">pc</a></span>&nbsp;<span class="op" id="4682376">=</span>&nbsp;<span class="ident" id="4682378"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682379">.</span><span class="ident" id="4682380">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682386"><a href="/regexp/onepass.go.html#4682142">i</a></span>&nbsp;<span class="op" id="4682388">=</span>&nbsp;<span class="op" id="4682390">&amp;</span><span class="ident" id="4682391"><a href="/regexp/onepass.go.html#4682081">p</a></span><span class="op" id="4682392">.</span><span class="ident" id="4682393">Inst</span><span class="op" id="4682397">[</span><span class="ident" id="4682398"><a href="/regexp/onepass.go.html#4682128">pc</a></span><span class="op" id="4682400">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4682403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4682406">//&nbsp;Avoid&nbsp;allocation&nbsp;of&nbsp;buffer&nbsp;if&nbsp;prefix&nbsp;is&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682457">if</span>&nbsp;<span class="ident" id="4682460"><a href="/regexp/onepass.go.html#4683453">iop</a></span><span class="op" id="4682463">(</span><span class="ident" id="4682464"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682465">)</span>&nbsp;<span class="op" id="4682467">!=</span>&nbsp;<span class="ident" id="4682470"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682476">.</span><span class="ident" id="4682477">InstRune</span>&nbsp;<span class="op" id="4682486">||</span>&nbsp;<span class="builtinfunc" id="4682489">len</span><span class="op" id="4682492">(</span><span class="ident" id="4682493"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682494">.</span><span class="ident" id="4682495">Rune</span><span class="op" id="4682499">)</span>&nbsp;<span class="op" id="4682501">!=</span>&nbsp;<span class="num" id="4682504">1</span>&nbsp;<span class="op" id="4682506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682510">return</span>&nbsp;<span class="string" id="4682517">&#34;&#34;</span><span class="op" id="4682519">,</span>&nbsp;<span class="ident" id="4682521"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682522">.</span><span class="ident" id="4682523">Op</span>&nbsp;<span class="op" id="4682526">==</span>&nbsp;<span class="ident" id="4682529"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682535">.</span><span class="ident" id="4682536">InstMatch</span><span class="op" id="4682545">,</span>&nbsp;<span class="builtintype" id="4682547">uint32</span><span class="op" id="4682553">(</span><span class="ident" id="4682554"><a href="/regexp/onepass.go.html#4682081">p</a></span><span class="op" id="4682555">.</span><span class="ident" id="4682556">Start</span><span class="op" id="4682561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4682564">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4682568">//&nbsp;Have&nbsp;prefix;&nbsp;gather&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682604">var</span>&nbsp;<span class="ident" id="4682608">buf</span>&nbsp;<span class="ident" id="4682612"><a href="/regexp/onepass.go.html#4680985">bytes</a></span><span class="op" id="4682617">.</span><span class="ident" id="4682618">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682626">for</span>&nbsp;<span class="ident" id="4682630"><a href="/regexp/onepass.go.html#4683453">iop</a></span><span class="op" id="4682633">(</span><span class="ident" id="4682634"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682635">)</span>&nbsp;<span class="op" id="4682637">==</span>&nbsp;<span class="ident" id="4682640"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682646">.</span><span class="ident" id="4682647">InstRune</span>&nbsp;<span class="op" id="4682656">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4682659">len</span><span class="op" id="4682662">(</span><span class="ident" id="4682663"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682664">.</span><span class="ident" id="4682665">Rune</span><span class="op" id="4682669">)</span>&nbsp;<span class="op" id="4682671">==</span>&nbsp;<span class="num" id="4682674">1</span>&nbsp;<span class="op" id="4682676">&amp;&amp;</span>&nbsp;<span class="ident" id="4682679"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682685">.</span><span class="ident" id="4682686">Flags</span><span class="op" id="4682691">(</span><span class="ident" id="4682692"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682693">.</span><span class="ident" id="4682694">Arg</span><span class="op" id="4682697">)</span><span class="op" id="4682698">&amp;</span><span class="ident" id="4682699"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682705">.</span><span class="ident" id="4682706">FoldCase</span>&nbsp;<span class="op" id="4682715">==</span>&nbsp;<span class="num" id="4682718">0</span>&nbsp;<span class="op" id="4682720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682724"><a href="/regexp/onepass.go.html#4682608">buf</a></span><span class="op" id="4682727">.</span><span class="ident" id="4682728">WriteRune</span><span class="op" id="4682737">(</span><span class="ident" id="4682738"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682739">.</span><span class="ident" id="4682740">Rune</span><span class="op" id="4682744">[</span><span class="num" id="4682745">0</span><span class="op" id="4682746">]</span><span class="op" id="4682747">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682751"><a href="/regexp/onepass.go.html#4682128">pc</a></span><span class="op" id="4682753">,</span>&nbsp;<span class="ident" id="4682755"><a href="/regexp/onepass.go.html#4682142">i</a></span>&nbsp;<span class="op" id="4682757">=</span>&nbsp;<span class="ident" id="4682759"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682760">.</span><span class="ident" id="4682761">Out</span><span class="op" id="4682764">,</span>&nbsp;<span class="op" id="4682766">&amp;</span><span class="ident" id="4682767"><a href="/regexp/onepass.go.html#4682081">p</a></span><span class="op" id="4682768">.</span><span class="ident" id="4682769">Inst</span><span class="op" id="4682773">[</span><span class="ident" id="4682774"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682775">.</span><span class="ident" id="4682776">Out</span><span class="op" id="4682779">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4682782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682785">return</span>&nbsp;<span class="ident" id="4682792"><a href="/regexp/onepass.go.html#4682608">buf</a></span><span class="op" id="4682795">.</span><span class="ident" id="4682796">String</span><span class="op" id="4682802">(</span><span class="op" id="4682803">)</span><span class="op" id="4682804">,</span>&nbsp;<span class="ident" id="4682806"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682807">.</span><span class="ident" id="4682808">Op</span>&nbsp;<span class="op" id="4682811">==</span>&nbsp;<span class="ident" id="4682814"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682820">.</span><span class="ident" id="4682821">InstEmptyWidth</span>&nbsp;<span class="op" id="4682836">&amp;&amp;</span>&nbsp;<span class="op" id="4682839">(</span><span class="ident" id="4682840"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682846">.</span><span class="ident" id="4682847">EmptyOp</span><span class="op" id="4682854">(</span><span class="ident" id="4682855"><a href="/regexp/onepass.go.html#4682142">i</a></span><span class="op" id="4682856">.</span><span class="ident" id="4682857">Arg</span><span class="op" id="4682860">)</span><span class="op" id="4682861">)</span><span class="op" id="4682862">&amp;</span><span class="ident" id="4682863"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4682869">.</span><span class="ident" id="4682870">EmptyBeginText</span>&nbsp;<span class="op" id="4682885">!=</span>&nbsp;<span class="num" id="4682888">0</span><span class="op" id="4682889">,</span>&nbsp;<span class="ident" id="4682891"><a href="/regexp/onepass.go.html#4682128">pc</a></span><br>
<span class="lineno"></span><span class="op" id="4682894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4682897">//&nbsp;OnePassNext&nbsp;selects&nbsp;the&nbsp;next&nbsp;actionable&nbsp;state&nbsp;of&nbsp;the&nbsp;prog,&nbsp;based&nbsp;on&nbsp;the&nbsp;input&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4682989">//&nbsp;It&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstAlt&nbsp;or&nbsp;InstAltMatch,&nbsp;and&nbsp;from&nbsp;the&nbsp;one-pass&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="4683086">//&nbsp;One&nbsp;of&nbsp;the&nbsp;alternates&nbsp;may&nbsp;ultimately&nbsp;lead&nbsp;without&nbsp;input&nbsp;to&nbsp;end&nbsp;of&nbsp;line.&nbsp;If&nbsp;the&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="4683180">//&nbsp;is&nbsp;InstAltMatch&nbsp;the&nbsp;path&nbsp;to&nbsp;the&nbsp;InstMatch&nbsp;is&nbsp;in&nbsp;i.Out,&nbsp;the&nbsp;normal&nbsp;node&nbsp;in&nbsp;i.Next.</span><br>
<span class="lineno"></span><span class="keyword" id="4683265">func</span>&nbsp;<span class="ident" id="4683270">onePassNext</span><span class="op" id="4683281">(</span><span class="ident" id="4683282">i</span>&nbsp;<span class="op" id="4683284">*</span><span class="ident" id="4683285"><a href="/regexp/onepass.go.html#4681736">onePassInst</a></span><span class="op" id="4683296">,</span>&nbsp;<span class="ident" id="4683298">r</span>&nbsp;<span class="builtintype" id="4683300">rune</span><span class="op" id="4683304">)</span>&nbsp;<span class="builtintype" id="4683306">uint32</span>&nbsp;<span class="op" id="4683313">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683316">next</span>&nbsp;<span class="op" id="4683321">:=</span>&nbsp;<span class="ident" id="4683324"><a href="/regexp/onepass.go.html#4683282">i</a></span><span class="op" id="4683325">.</span><span class="ident" id="4683326">MatchRunePos</span><span class="op" id="4683338">(</span><span class="ident" id="4683339"><a href="/regexp/onepass.go.html#4683298">r</a></span><span class="op" id="4683340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683343">if</span>&nbsp;<span class="ident" id="4683346"><a href="/regexp/onepass.go.html#4683316">next</a></span>&nbsp;<span class="op" id="4683351">&gt;=</span>&nbsp;<span class="num" id="4683354">0</span>&nbsp;<span class="op" id="4683356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683360">return</span>&nbsp;<span class="ident" id="4683367"><a href="/regexp/onepass.go.html#4683282">i</a></span><span class="op" id="4683368">.</span><span class="ident" id="4683369">Next</span><span class="op" id="4683373">[</span><span class="ident" id="4683374"><a href="/regexp/onepass.go.html#4683316">next</a></span><span class="op" id="4683378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683384">if</span>&nbsp;<span class="ident" id="4683387"><a href="/regexp/onepass.go.html#4683282">i</a></span><span class="op" id="4683388">.</span><span class="ident" id="4683389">Op</span>&nbsp;<span class="op" id="4683392">==</span>&nbsp;<span class="ident" id="4683395"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4683401">.</span><span class="ident" id="4683402">InstAltMatch</span>&nbsp;<span class="op" id="4683415">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683419">return</span>&nbsp;<span class="ident" id="4683426"><a href="/regexp/onepass.go.html#4683282">i</a></span><span class="op" id="4683427">.</span><span class="ident" id="4683428">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683436">return</span>&nbsp;<span class="num" id="4683443">0</span><br>
<span class="lineno"></span><span class="op" id="4683445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4683448">func</span>&nbsp;<span class="ident" id="4683453">iop</span><span class="op" id="4683456">(</span><span class="ident" id="4683457">i</span>&nbsp;<span class="op" id="4683459">*</span><span class="ident" id="4683460"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4683466">.</span><span class="ident" id="4683467">Inst</span><span class="op" id="4683471">)</span>&nbsp;<span class="ident" id="4683473"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4683479">.</span><span class="ident" id="4683480">InstOp</span>&nbsp;<span class="op" id="4683487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683490">op</span>&nbsp;<span class="op" id="4683493">:=</span>&nbsp;<span class="ident" id="4683496"><a href="/regexp/onepass.go.html#4683457">i</a></span><span class="op" id="4683497">.</span><span class="ident" id="4683498">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683502">switch</span>&nbsp;<span class="ident" id="4683509"><a href="/regexp/onepass.go.html#4683490">op</a></span>&nbsp;<span class="op" id="4683512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683515">case</span>&nbsp;<span class="ident" id="4683520"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4683526">.</span><span class="ident" id="4683527">InstRune1</span><span class="op" id="4683536">,</span>&nbsp;<span class="ident" id="4683538"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4683544">.</span><span class="ident" id="4683545">InstRuneAny</span><span class="op" id="4683556">,</span>&nbsp;<span class="ident" id="4683558"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4683564">.</span><span class="ident" id="4683565">InstRuneAnyNotNL</span><span class="op" id="4683581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683585"><a href="/regexp/onepass.go.html#4683490">op</a></span>&nbsp;<span class="op" id="4683588">=</span>&nbsp;<span class="ident" id="4683590"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4683596">.</span><span class="ident" id="4683597">InstRune</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683610">return</span>&nbsp;<span class="ident" id="4683617"><a href="/regexp/onepass.go.html#4683490">op</a></span><br>
<span class="lineno"></span><span class="op" id="4683620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4683623">//&nbsp;Sparse&nbsp;Array&nbsp;implementation&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;queueOnePass.</span><br>
<span class="lineno">90</span><span class="keyword" id="4683681">type</span>&nbsp;<span class="ident" id="4683686">queueOnePass</span>&nbsp;<span class="keyword" id="4683699">struct</span>&nbsp;<span class="op" id="4683706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683709">sparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683725">[</span><span class="op" id="4683726">]</span><span class="builtintype" id="4683727">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683735">dense</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683751">[</span><span class="op" id="4683752">]</span><span class="builtintype" id="4683753">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683761">size</span><span class="op" id="4683765">,</span>&nbsp;<span class="ident" id="4683767">nextIndex</span>&nbsp;<span class="builtintype" id="4683777">uint32</span><br>
<span class="lineno"></span><span class="op" id="4683784">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4683787">func</span>&nbsp;<span class="op" id="4683792">(</span><span class="ident" id="4683793">q</span>&nbsp;<span class="op" id="4683795">*</span><span class="ident" id="4683796"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4683808">)</span>&nbsp;<span class="ident" id="4683810">empty</span><span class="op" id="4683815">(</span><span class="op" id="4683816">)</span>&nbsp;<span class="builtintype" id="4683818">bool</span>&nbsp;<span class="op" id="4683823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683826">return</span>&nbsp;<span class="ident" id="4683833"><a href="/regexp/onepass.go.html#4683793">q</a></span><span class="op" id="4683834">.</span><span class="ident" id="4683835">nextIndex</span>&nbsp;<span class="op" id="4683845">&gt;=</span>&nbsp;<span class="ident" id="4683848"><a href="/regexp/onepass.go.html#4683793">q</a></span><span class="op" id="4683849">.</span><span class="ident" id="4683850">size</span><br>
<span class="lineno"></span><span class="op" id="4683855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4683858">func</span>&nbsp;<span class="op" id="4683863">(</span><span class="ident" id="4683864">q</span>&nbsp;<span class="op" id="4683866">*</span><span class="ident" id="4683867"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4683879">)</span>&nbsp;<span class="ident" id="4683881">next</span><span class="op" id="4683885">(</span><span class="op" id="4683886">)</span>&nbsp;<span class="op" id="4683888">(</span><span class="ident" id="4683889">n</span>&nbsp;<span class="builtintype" id="4683891">uint32</span><span class="op" id="4683897">)</span>&nbsp;<span class="op" id="4683899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683902"><a href="/regexp/onepass.go.html#4683889">n</a></span>&nbsp;<span class="op" id="4683904">=</span>&nbsp;<span class="ident" id="4683906"><a href="/regexp/onepass.go.html#4683864">q</a></span><span class="op" id="4683907">.</span><span class="ident" id="4683908">dense</span><span class="op" id="4683913">[</span><span class="ident" id="4683914"><a href="/regexp/onepass.go.html#4683864">q</a></span><span class="op" id="4683915">.</span><span class="ident" id="4683916">nextIndex</span><span class="op" id="4683925">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683928"><a href="/regexp/onepass.go.html#4683864">q</a></span><span class="op" id="4683929">.</span><span class="ident" id="4683930">nextIndex</span><span class="op" id="4683939">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683943">return</span><br>
<span class="lineno"></span><span class="op" id="4683950">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="4683953">func</span>&nbsp;<span class="op" id="4683958">(</span><span class="ident" id="4683959">q</span>&nbsp;<span class="op" id="4683961">*</span><span class="ident" id="4683962"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4683974">)</span>&nbsp;<span class="ident" id="4683976">clear</span><span class="op" id="4683981">(</span><span class="op" id="4683982">)</span>&nbsp;<span class="op" id="4683984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683987"><a href="/regexp/onepass.go.html#4683959">q</a></span><span class="op" id="4683988">.</span><span class="ident" id="4683989">size</span>&nbsp;<span class="op" id="4683994">=</span>&nbsp;<span class="num" id="4683996">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683999"><a href="/regexp/onepass.go.html#4683959">q</a></span><span class="op" id="4684000">.</span><span class="ident" id="4684001">nextIndex</span>&nbsp;<span class="op" id="4684011">=</span>&nbsp;<span class="num" id="4684013">0</span><br>
<span class="lineno"></span><span class="op" id="4684015">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="4684018">func</span>&nbsp;<span class="op" id="4684023">(</span><span class="ident" id="4684024">q</span>&nbsp;<span class="op" id="4684026">*</span><span class="ident" id="4684027"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4684039">)</span>&nbsp;<span class="ident" id="4684041">reset</span><span class="op" id="4684046">(</span><span class="op" id="4684047">)</span>&nbsp;<span class="op" id="4684049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684052"><a href="/regexp/onepass.go.html#4684024">q</a></span><span class="op" id="4684053">.</span><span class="ident" id="4684054">nextIndex</span>&nbsp;<span class="op" id="4684064">=</span>&nbsp;<span class="num" id="4684066">0</span><br>
<span class="lineno"></span><span class="op" id="4684068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4684071">func</span>&nbsp;<span class="op" id="4684076">(</span><span class="ident" id="4684077">q</span>&nbsp;<span class="op" id="4684079">*</span><span class="ident" id="4684080"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4684092">)</span>&nbsp;<span class="ident" id="4684094">contains</span><span class="op" id="4684102">(</span><span class="ident" id="4684103">u</span>&nbsp;<span class="builtintype" id="4684105">uint32</span><span class="op" id="4684111">)</span>&nbsp;<span class="builtintype" id="4684113">bool</span>&nbsp;<span class="op" id="4684118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684121">if</span>&nbsp;<span class="ident" id="4684124"><a href="/regexp/onepass.go.html#4684103">u</a></span>&nbsp;<span class="op" id="4684126">&gt;=</span>&nbsp;<span class="builtintype" id="4684129">uint32</span><span class="op" id="4684135">(</span><span class="builtinfunc" id="4684136">len</span><span class="op" id="4684139">(</span><span class="ident" id="4684140"><a href="/regexp/onepass.go.html#4684077">q</a></span><span class="op" id="4684141">.</span><span class="ident" id="4684142">sparse</span><span class="op" id="4684148">)</span><span class="op" id="4684149">)</span>&nbsp;<span class="op" id="4684151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684155">return</span>&nbsp;<span class="ident" id="4684162">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684172">return</span>&nbsp;<span class="ident" id="4684179"><a href="/regexp/onepass.go.html#4684077">q</a></span><span class="op" id="4684180">.</span><span class="ident" id="4684181">sparse</span><span class="op" id="4684187">[</span><span class="ident" id="4684188"><a href="/regexp/onepass.go.html#4684103">u</a></span><span class="op" id="4684189">]</span>&nbsp;<span class="op" id="4684191">&lt;</span>&nbsp;<span class="ident" id="4684193"><a href="/regexp/onepass.go.html#4684077">q</a></span><span class="op" id="4684194">.</span><span class="ident" id="4684195">size</span>&nbsp;<span class="op" id="4684200">&amp;&amp;</span>&nbsp;<span class="ident" id="4684203"><a href="/regexp/onepass.go.html#4684077">q</a></span><span class="op" id="4684204">.</span><span class="ident" id="4684205">dense</span><span class="op" id="4684210">[</span><span class="ident" id="4684211"><a href="/regexp/onepass.go.html#4684077">q</a></span><span class="op" id="4684212">.</span><span class="ident" id="4684213">sparse</span><span class="op" id="4684219">[</span><span class="ident" id="4684220"><a href="/regexp/onepass.go.html#4684103">u</a></span><span class="op" id="4684221">]</span><span class="op" id="4684222">]</span>&nbsp;<span class="op" id="4684224">==</span>&nbsp;<span class="ident" id="4684227"><a href="/regexp/onepass.go.html#4684103">u</a></span><br>
<span class="lineno">120</span><span class="op" id="4684229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4684232">func</span>&nbsp;<span class="op" id="4684237">(</span><span class="ident" id="4684238">q</span>&nbsp;<span class="op" id="4684240">*</span><span class="ident" id="4684241"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4684253">)</span>&nbsp;<span class="ident" id="4684255">insert</span><span class="op" id="4684261">(</span><span class="ident" id="4684262">u</span>&nbsp;<span class="builtintype" id="4684264">uint32</span><span class="op" id="4684270">)</span>&nbsp;<span class="op" id="4684272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684275">if</span>&nbsp;<span class="op" id="4684278">!</span><span class="ident" id="4684279"><a href="/regexp/onepass.go.html#4684238">q</a></span><span class="op" id="4684280">.</span><span class="ident" id="4684281">contains</span><span class="op" id="4684289">(</span><span class="ident" id="4684290"><a href="/regexp/onepass.go.html#4684262">u</a></span><span class="op" id="4684291">)</span>&nbsp;<span class="op" id="4684293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684297"><a href="/regexp/onepass.go.html#4684238">q</a></span><span class="op" id="4684298">.</span><span class="ident" id="4684299">insertNew</span><span class="op" id="4684308">(</span><span class="ident" id="4684309"><a href="/regexp/onepass.go.html#4684262">u</a></span><span class="op" id="4684310">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684313">}</span><br>
<span class="lineno"></span><span class="op" id="4684315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4684318">func</span>&nbsp;<span class="op" id="4684323">(</span><span class="ident" id="4684324">q</span>&nbsp;<span class="op" id="4684326">*</span><span class="ident" id="4684327"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4684339">)</span>&nbsp;<span class="ident" id="4684341">insertNew</span><span class="op" id="4684350">(</span><span class="ident" id="4684351">u</span>&nbsp;<span class="builtintype" id="4684353">uint32</span><span class="op" id="4684359">)</span>&nbsp;<span class="op" id="4684361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684364">if</span>&nbsp;<span class="ident" id="4684367"><a href="/regexp/onepass.go.html#4684351">u</a></span>&nbsp;<span class="op" id="4684369">&gt;=</span>&nbsp;<span class="builtintype" id="4684372">uint32</span><span class="op" id="4684378">(</span><span class="builtinfunc" id="4684379">len</span><span class="op" id="4684382">(</span><span class="ident" id="4684383"><a href="/regexp/onepass.go.html#4684324">q</a></span><span class="op" id="4684384">.</span><span class="ident" id="4684385">sparse</span><span class="op" id="4684391">)</span><span class="op" id="4684392">)</span>&nbsp;<span class="op" id="4684394">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684398">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684409"><a href="/regexp/onepass.go.html#4684324">q</a></span><span class="op" id="4684410">.</span><span class="ident" id="4684411">sparse</span><span class="op" id="4684417">[</span><span class="ident" id="4684418"><a href="/regexp/onepass.go.html#4684351">u</a></span><span class="op" id="4684419">]</span>&nbsp;<span class="op" id="4684421">=</span>&nbsp;<span class="ident" id="4684423"><a href="/regexp/onepass.go.html#4684324">q</a></span><span class="op" id="4684424">.</span><span class="ident" id="4684425">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684431"><a href="/regexp/onepass.go.html#4684324">q</a></span><span class="op" id="4684432">.</span><span class="ident" id="4684433">dense</span><span class="op" id="4684438">[</span><span class="ident" id="4684439"><a href="/regexp/onepass.go.html#4684324">q</a></span><span class="op" id="4684440">.</span><span class="ident" id="4684441">size</span><span class="op" id="4684445">]</span>&nbsp;<span class="op" id="4684447">=</span>&nbsp;<span class="ident" id="4684449"><a href="/regexp/onepass.go.html#4684351">u</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684452"><a href="/regexp/onepass.go.html#4684324">q</a></span><span class="op" id="4684453">.</span><span class="ident" id="4684454">size</span><span class="op" id="4684458">++</span><br>
<span class="lineno">135</span><span class="op" id="4684461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4684464">func</span>&nbsp;<span class="ident" id="4684469">newQueue</span><span class="op" id="4684477">(</span><span class="ident" id="4684478">size</span>&nbsp;<span class="builtintype" id="4684483">int</span><span class="op" id="4684486">)</span>&nbsp;<span class="op" id="4684488">(</span><span class="ident" id="4684489">q</span>&nbsp;<span class="op" id="4684491">*</span><span class="ident" id="4684492"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4684504">)</span>&nbsp;<span class="op" id="4684506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684509">return</span>&nbsp;<span class="op" id="4684516">&amp;</span><span class="ident" id="4684517"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4684529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684533">sparse</span><span class="op" id="4684539">:</span>&nbsp;<span class="builtinfunc" id="4684541">make</span><span class="op" id="4684545">(</span><span class="op" id="4684546">[</span><span class="op" id="4684547">]</span><span class="builtintype" id="4684548">uint32</span><span class="op" id="4684554">,</span>&nbsp;<span class="ident" id="4684556"><a href="/regexp/onepass.go.html#4684478">size</a></span><span class="op" id="4684560">)</span><span class="op" id="4684561">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684565">dense</span><span class="op" id="4684570">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4684573">make</span><span class="op" id="4684577">(</span><span class="op" id="4684578">[</span><span class="op" id="4684579">]</span><span class="builtintype" id="4684580">uint32</span><span class="op" id="4684586">,</span>&nbsp;<span class="ident" id="4684588"><a href="/regexp/onepass.go.html#4684478">size</a></span><span class="op" id="4684592">)</span><span class="op" id="4684593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684596">}</span><br>
<span class="lineno"></span><span class="op" id="4684598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4684601">//&nbsp;mergeRuneSets&nbsp;merges&nbsp;two&nbsp;non-intersecting&nbsp;runesets,&nbsp;and&nbsp;returns&nbsp;the&nbsp;merged&nbsp;result,</span><br>
<span class="lineno">145</span><span class="comment" id="4684687">//&nbsp;and&nbsp;a&nbsp;NextIp&nbsp;array.&nbsp;The&nbsp;idea&nbsp;is&nbsp;that&nbsp;if&nbsp;a&nbsp;rune&nbsp;matches&nbsp;the&nbsp;OnePassRunes&nbsp;at&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="4684771">//&nbsp;i,&nbsp;NextIp[i/2]&nbsp;is&nbsp;the&nbsp;target.&nbsp;If&nbsp;the&nbsp;input&nbsp;sets&nbsp;intersect,&nbsp;an&nbsp;empty&nbsp;runeset&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4684856">//&nbsp;NextIp&nbsp;array&nbsp;with&nbsp;the&nbsp;single&nbsp;element&nbsp;mergeFailed&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="4684921">//&nbsp;The&nbsp;code&nbsp;assumes&nbsp;that&nbsp;both&nbsp;inputs&nbsp;contain&nbsp;ordered&nbsp;and&nbsp;non-intersecting&nbsp;rune&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="keyword" id="4685007">const</span>&nbsp;<span class="ident" id="4685013">mergeFailed</span>&nbsp;<span class="op" id="4685025">=</span>&nbsp;<span class="builtintype" id="4685027">uint32</span><span class="op" id="4685033">(</span><span class="num" id="4685034">0xffffffff</span><span class="op" id="4685044">)</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="4685047">var</span>&nbsp;<span class="op" id="4685051">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685054">noRune</span>&nbsp;<span class="op" id="4685061">=</span>&nbsp;<span class="op" id="4685063">[</span><span class="op" id="4685064">]</span><span class="builtintype" id="4685065">rune</span><span class="op" id="4685069">{</span><span class="op" id="4685070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685073">noNext</span>&nbsp;<span class="op" id="4685080">=</span>&nbsp;<span class="op" id="4685082">[</span><span class="op" id="4685083">]</span><span class="builtintype" id="4685084">uint32</span><span class="op" id="4685090">{</span><span class="ident" id="4685091"><a href="/regexp/onepass.go.html#4685013">mergeFailed</a></span><span class="op" id="4685102">}</span><br>
<span class="lineno"></span><span class="op" id="4685104">)</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="4685107">func</span>&nbsp;<span class="ident" id="4685112">mergeRuneSets</span><span class="op" id="4685125">(</span><span class="ident" id="4685126">leftRunes</span><span class="op" id="4685135">,</span>&nbsp;<span class="ident" id="4685137">rightRunes</span>&nbsp;<span class="op" id="4685148">*</span><span class="op" id="4685149">[</span><span class="op" id="4685150">]</span><span class="builtintype" id="4685151">rune</span><span class="op" id="4685155">,</span>&nbsp;<span class="ident" id="4685157">leftPC</span><span class="op" id="4685163">,</span>&nbsp;<span class="ident" id="4685165">rightPC</span>&nbsp;<span class="builtintype" id="4685173">uint32</span><span class="op" id="4685179">)</span>&nbsp;<span class="op" id="4685181">(</span><span class="op" id="4685182">[</span><span class="op" id="4685183">]</span><span class="builtintype" id="4685184">rune</span><span class="op" id="4685188">,</span>&nbsp;<span class="op" id="4685190">[</span><span class="op" id="4685191">]</span><span class="builtintype" id="4685192">uint32</span><span class="op" id="4685198">)</span>&nbsp;<span class="op" id="4685200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685203">leftLen</span>&nbsp;<span class="op" id="4685211">:=</span>&nbsp;<span class="builtinfunc" id="4685214">len</span><span class="op" id="4685217">(</span><span class="op" id="4685218">*</span><span class="ident" id="4685219"><a href="/regexp/onepass.go.html#4685126">leftRunes</a></span><span class="op" id="4685228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685231">rightLen</span>&nbsp;<span class="op" id="4685240">:=</span>&nbsp;<span class="builtinfunc" id="4685243">len</span><span class="op" id="4685246">(</span><span class="op" id="4685247">*</span><span class="ident" id="4685248"><a href="/regexp/onepass.go.html#4685137">rightRunes</a></span><span class="op" id="4685258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685261">if</span>&nbsp;<span class="ident" id="4685264"><a href="/regexp/onepass.go.html#4685203">leftLen</a></span><span class="op" id="4685271">&amp;</span><span class="num" id="4685272">0x1</span>&nbsp;<span class="op" id="4685276">!=</span>&nbsp;<span class="num" id="4685279">0</span>&nbsp;<span class="op" id="4685281">||</span>&nbsp;<span class="ident" id="4685284"><a href="/regexp/onepass.go.html#4685231">rightLen</a></span><span class="op" id="4685292">&amp;</span><span class="num" id="4685293">0x1</span>&nbsp;<span class="op" id="4685297">!=</span>&nbsp;<span class="num" id="4685300">0</span>&nbsp;<span class="op" id="4685302">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4685306">panic</span><span class="op" id="4685311">(</span><span class="string" id="4685312">&#34;mergeRuneSets&nbsp;odd&nbsp;length&nbsp;[]rune&#34;</span><span class="op" id="4685345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685351">var</span>&nbsp;<span class="op" id="4685355">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685359">lx</span><span class="op" id="4685361">,</span>&nbsp;<span class="ident" id="4685363">rx</span>&nbsp;<span class="builtintype" id="4685366">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685371">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685374">merged</span>&nbsp;<span class="op" id="4685381">:=</span>&nbsp;<span class="builtinfunc" id="4685384">make</span><span class="op" id="4685388">(</span><span class="op" id="4685389">[</span><span class="op" id="4685390">]</span><span class="builtintype" id="4685391">rune</span><span class="op" id="4685395">,</span>&nbsp;<span class="num" id="4685397">0</span><span class="op" id="4685398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685401">next</span>&nbsp;<span class="op" id="4685406">:=</span>&nbsp;<span class="builtinfunc" id="4685409">make</span><span class="op" id="4685413">(</span><span class="op" id="4685414">[</span><span class="op" id="4685415">]</span><span class="builtintype" id="4685416">uint32</span><span class="op" id="4685422">,</span>&nbsp;<span class="num" id="4685424">0</span><span class="op" id="4685425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685428">ok</span>&nbsp;<span class="op" id="4685431">:=</span>&nbsp;<span class="ident" id="4685434">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685440">defer</span>&nbsp;<span class="keyword" id="4685446">func</span><span class="op" id="4685450">(</span><span class="op" id="4685451">)</span>&nbsp;<span class="op" id="4685453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685457">if</span>&nbsp;<span class="op" id="4685460">!</span><span class="ident" id="4685461"><a href="/regexp/onepass.go.html#4685428">ok</a></span>&nbsp;<span class="op" id="4685464">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685469"><a href="/regexp/onepass.go.html#4685374">merged</a></span>&nbsp;<span class="op" id="4685476">=</span>&nbsp;<span class="ident" id="4685478">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685485"><a href="/regexp/onepass.go.html#4685401">next</a></span>&nbsp;<span class="op" id="4685490">=</span>&nbsp;<span class="ident" id="4685492">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685501">}</span><span class="op" id="4685502">(</span><span class="op" id="4685503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685507">ix</span>&nbsp;<span class="op" id="4685510">:=</span>&nbsp;<span class="op" id="4685513">-</span><span class="num" id="4685514">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685517">extend</span>&nbsp;<span class="op" id="4685524">:=</span>&nbsp;<span class="keyword" id="4685527">func</span><span class="op" id="4685531">(</span><span class="ident" id="4685532">newLow</span>&nbsp;<span class="op" id="4685539">*</span><span class="builtintype" id="4685540">int</span><span class="op" id="4685543">,</span>&nbsp;<span class="ident" id="4685545">newArray</span>&nbsp;<span class="op" id="4685554">*</span><span class="op" id="4685555">[</span><span class="op" id="4685556">]</span><span class="builtintype" id="4685557">rune</span><span class="op" id="4685561">,</span>&nbsp;<span class="ident" id="4685563">pc</span>&nbsp;<span class="builtintype" id="4685566">uint32</span><span class="op" id="4685572">)</span>&nbsp;<span class="builtintype" id="4685574">bool</span>&nbsp;<span class="op" id="4685579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685583">if</span>&nbsp;<span class="ident" id="4685586"><a href="/regexp/onepass.go.html#4685507">ix</a></span>&nbsp;<span class="op" id="4685589">&gt;</span>&nbsp;<span class="num" id="4685591">0</span>&nbsp;<span class="op" id="4685593">&amp;&amp;</span>&nbsp;<span class="op" id="4685596">(</span><span class="op" id="4685597">*</span><span class="ident" id="4685598"><a href="/regexp/onepass.go.html#4685545">newArray</a></span><span class="op" id="4685606">)</span><span class="op" id="4685607">[</span><span class="op" id="4685608">*</span><span class="ident" id="4685609"><a href="/regexp/onepass.go.html#4685532">newLow</a></span><span class="op" id="4685615">]</span>&nbsp;<span class="op" id="4685617">&lt;=</span>&nbsp;<span class="ident" id="4685620"><a href="/regexp/onepass.go.html#4685374">merged</a></span><span class="op" id="4685626">[</span><span class="ident" id="4685627"><a href="/regexp/onepass.go.html#4685507">ix</a></span><span class="op" id="4685629">]</span>&nbsp;<span class="op" id="4685631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685636">return</span>&nbsp;<span class="ident" id="4685643">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685651">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685655"><a href="/regexp/onepass.go.html#4685374">merged</a></span>&nbsp;<span class="op" id="4685662">=</span>&nbsp;<span class="builtinfunc" id="4685664">append</span><span class="op" id="4685670">(</span><span class="ident" id="4685671"><a href="/regexp/onepass.go.html#4685374">merged</a></span><span class="op" id="4685677">,</span>&nbsp;<span class="op" id="4685679">(</span><span class="op" id="4685680">*</span><span class="ident" id="4685681"><a href="/regexp/onepass.go.html#4685545">newArray</a></span><span class="op" id="4685689">)</span><span class="op" id="4685690">[</span><span class="op" id="4685691">*</span><span class="ident" id="4685692"><a href="/regexp/onepass.go.html#4685532">newLow</a></span><span class="op" id="4685698">]</span><span class="op" id="4685699">,</span>&nbsp;<span class="op" id="4685701">(</span><span class="op" id="4685702">*</span><span class="ident" id="4685703"><a href="/regexp/onepass.go.html#4685545">newArray</a></span><span class="op" id="4685711">)</span><span class="op" id="4685712">[</span><span class="op" id="4685713">*</span><span class="ident" id="4685714"><a href="/regexp/onepass.go.html#4685532">newLow</a></span><span class="op" id="4685720">+</span><span class="num" id="4685721">1</span><span class="op" id="4685722">]</span><span class="op" id="4685723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685727">*</span><span class="ident" id="4685728"><a href="/regexp/onepass.go.html#4685532">newLow</a></span>&nbsp;<span class="op" id="4685735">+=</span>&nbsp;<span class="num" id="4685738">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685742"><a href="/regexp/onepass.go.html#4685507">ix</a></span>&nbsp;<span class="op" id="4685745">+=</span>&nbsp;<span class="num" id="4685748">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685752"><a href="/regexp/onepass.go.html#4685401">next</a></span>&nbsp;<span class="op" id="4685757">=</span>&nbsp;<span class="builtinfunc" id="4685759">append</span><span class="op" id="4685765">(</span><span class="ident" id="4685766"><a href="/regexp/onepass.go.html#4685401">next</a></span><span class="op" id="4685770">,</span>&nbsp;<span class="ident" id="4685772"><a href="/regexp/onepass.go.html#4685563">pc</a></span><span class="op" id="4685774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685778">return</span>&nbsp;<span class="ident" id="4685785">true</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685795">for</span>&nbsp;<span class="ident" id="4685799"><a href="/regexp/onepass.go.html#4685359">lx</a></span>&nbsp;<span class="op" id="4685802">&lt;</span>&nbsp;<span class="ident" id="4685804"><a href="/regexp/onepass.go.html#4685203">leftLen</a></span>&nbsp;<span class="op" id="4685812">||</span>&nbsp;<span class="ident" id="4685815"><a href="/regexp/onepass.go.html#4685363">rx</a></span>&nbsp;<span class="op" id="4685818">&lt;</span>&nbsp;<span class="ident" id="4685820"><a href="/regexp/onepass.go.html#4685231">rightLen</a></span>&nbsp;<span class="op" id="4685829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685833">switch</span>&nbsp;<span class="op" id="4685840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685844">case</span>&nbsp;<span class="ident" id="4685849"><a href="/regexp/onepass.go.html#4685363">rx</a></span>&nbsp;<span class="op" id="4685852">&gt;=</span>&nbsp;<span class="ident" id="4685855"><a href="/regexp/onepass.go.html#4685231">rightLen</a></span><span class="op" id="4685863">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685868"><a href="/regexp/onepass.go.html#4685428">ok</a></span>&nbsp;<span class="op" id="4685871">=</span>&nbsp;<span class="ident" id="4685873"><a href="/regexp/onepass.go.html#4685517">extend</a></span><span class="op" id="4685879">(</span><span class="op" id="4685880">&amp;</span><span class="ident" id="4685881"><a href="/regexp/onepass.go.html#4685359">lx</a></span><span class="op" id="4685883">,</span>&nbsp;<span class="ident" id="4685885"><a href="/regexp/onepass.go.html#4685126">leftRunes</a></span><span class="op" id="4685894">,</span>&nbsp;<span class="ident" id="4685896"><a href="/regexp/onepass.go.html#4685157">leftPC</a></span><span class="op" id="4685902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685906">case</span>&nbsp;<span class="ident" id="4685911"><a href="/regexp/onepass.go.html#4685359">lx</a></span>&nbsp;<span class="op" id="4685914">&gt;=</span>&nbsp;<span class="ident" id="4685917"><a href="/regexp/onepass.go.html#4685203">leftLen</a></span><span class="op" id="4685924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685929"><a href="/regexp/onepass.go.html#4685428">ok</a></span>&nbsp;<span class="op" id="4685932">=</span>&nbsp;<span class="ident" id="4685934"><a href="/regexp/onepass.go.html#4685517">extend</a></span><span class="op" id="4685940">(</span><span class="op" id="4685941">&amp;</span><span class="ident" id="4685942"><a href="/regexp/onepass.go.html#4685363">rx</a></span><span class="op" id="4685944">,</span>&nbsp;<span class="ident" id="4685946"><a href="/regexp/onepass.go.html#4685137">rightRunes</a></span><span class="op" id="4685956">,</span>&nbsp;<span class="ident" id="4685958"><a href="/regexp/onepass.go.html#4685165">rightPC</a></span><span class="op" id="4685965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685969">case</span>&nbsp;<span class="op" id="4685974">(</span><span class="op" id="4685975">*</span><span class="ident" id="4685976"><a href="/regexp/onepass.go.html#4685137">rightRunes</a></span><span class="op" id="4685986">)</span><span class="op" id="4685987">[</span><span class="ident" id="4685988"><a href="/regexp/onepass.go.html#4685363">rx</a></span><span class="op" id="4685990">]</span>&nbsp;<span class="op" id="4685992">&lt;</span>&nbsp;<span class="op" id="4685994">(</span><span class="op" id="4685995">*</span><span class="ident" id="4685996"><a href="/regexp/onepass.go.html#4685126">leftRunes</a></span><span class="op" id="4686005">)</span><span class="op" id="4686006">[</span><span class="ident" id="4686007"><a href="/regexp/onepass.go.html#4685359">lx</a></span><span class="op" id="4686009">]</span><span class="op" id="4686010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686015"><a href="/regexp/onepass.go.html#4685428">ok</a></span>&nbsp;<span class="op" id="4686018">=</span>&nbsp;<span class="ident" id="4686020"><a href="/regexp/onepass.go.html#4685517">extend</a></span><span class="op" id="4686026">(</span><span class="op" id="4686027">&amp;</span><span class="ident" id="4686028"><a href="/regexp/onepass.go.html#4685363">rx</a></span><span class="op" id="4686030">,</span>&nbsp;<span class="ident" id="4686032"><a href="/regexp/onepass.go.html#4685137">rightRunes</a></span><span class="op" id="4686042">,</span>&nbsp;<span class="ident" id="4686044"><a href="/regexp/onepass.go.html#4685165">rightPC</a></span><span class="op" id="4686051">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686055">default</span><span class="op" id="4686062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686067"><a href="/regexp/onepass.go.html#4685428">ok</a></span>&nbsp;<span class="op" id="4686070">=</span>&nbsp;<span class="ident" id="4686072"><a href="/regexp/onepass.go.html#4685517">extend</a></span><span class="op" id="4686078">(</span><span class="op" id="4686079">&amp;</span><span class="ident" id="4686080"><a href="/regexp/onepass.go.html#4685359">lx</a></span><span class="op" id="4686082">,</span>&nbsp;<span class="ident" id="4686084"><a href="/regexp/onepass.go.html#4685126">leftRunes</a></span><span class="op" id="4686093">,</span>&nbsp;<span class="ident" id="4686095"><a href="/regexp/onepass.go.html#4685157">leftPC</a></span><span class="op" id="4686101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686109">if</span>&nbsp;<span class="op" id="4686112">!</span><span class="ident" id="4686113"><a href="/regexp/onepass.go.html#4685428">ok</a></span>&nbsp;<span class="op" id="4686116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686121">return</span>&nbsp;<span class="ident" id="4686128"><a href="/regexp/onepass.go.html#4685054">noRune</a></span><span class="op" id="4686134">,</span>&nbsp;<span class="ident" id="4686136"><a href="/regexp/onepass.go.html#4685073">noNext</a></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686151">return</span>&nbsp;<span class="ident" id="4686158"><a href="/regexp/onepass.go.html#4685374">merged</a></span><span class="op" id="4686164">,</span>&nbsp;<span class="ident" id="4686166"><a href="/regexp/onepass.go.html#4685401">next</a></span><br>
<span class="lineno"></span><span class="op" id="4686171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="4686174">//&nbsp;cleanupOnePass&nbsp;drops&nbsp;working&nbsp;memory,&nbsp;and&nbsp;restores&nbsp;certain&nbsp;shortcut&nbsp;instructions.</span><br>
<span class="lineno"></span><span class="keyword" id="4686258">func</span>&nbsp;<span class="ident" id="4686263">cleanupOnePass</span><span class="op" id="4686277">(</span><span class="ident" id="4686278">prog</span>&nbsp;<span class="op" id="4686283">*</span><span class="ident" id="4686284"><a href="/regexp/onepass.go.html#4681445">onePassProg</a></span><span class="op" id="4686295">,</span>&nbsp;<span class="ident" id="4686297">original</span>&nbsp;<span class="op" id="4686306">*</span><span class="ident" id="4686307"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686313">.</span><span class="ident" id="4686314">Prog</span><span class="op" id="4686318">)</span>&nbsp;<span class="op" id="4686320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686323">for</span>&nbsp;<span class="ident" id="4686327">ix</span><span class="op" id="4686329">,</span>&nbsp;<span class="ident" id="4686331">instOriginal</span>&nbsp;<span class="op" id="4686344">:=</span>&nbsp;<span class="keyword" id="4686347">range</span>&nbsp;<span class="ident" id="4686353"><a href="/regexp/onepass.go.html#4686297">original</a></span><span class="op" id="4686361">.</span><span class="ident" id="4686362">Inst</span>&nbsp;<span class="op" id="4686367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686371">switch</span>&nbsp;<span class="ident" id="4686378"><a href="/regexp/onepass.go.html#4686331">instOriginal</a></span><span class="op" id="4686390">.</span><span class="ident" id="4686391">Op</span>&nbsp;<span class="op" id="4686394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686398">case</span>&nbsp;<span class="ident" id="4686403"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686409">.</span><span class="ident" id="4686410">InstAlt</span><span class="op" id="4686417">,</span>&nbsp;<span class="ident" id="4686419"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686425">.</span><span class="ident" id="4686426">InstAltMatch</span><span class="op" id="4686438">,</span>&nbsp;<span class="ident" id="4686440"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686446">.</span><span class="ident" id="4686447">InstRune</span><span class="op" id="4686455">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686459">case</span>&nbsp;<span class="ident" id="4686464"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686470">.</span><span class="ident" id="4686471">InstCapture</span><span class="op" id="4686482">,</span>&nbsp;<span class="ident" id="4686484"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686490">.</span><span class="ident" id="4686491">InstEmptyWidth</span><span class="op" id="4686505">,</span>&nbsp;<span class="ident" id="4686507"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686513">.</span><span class="ident" id="4686514">InstNop</span><span class="op" id="4686521">,</span>&nbsp;<span class="ident" id="4686523"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686529">.</span><span class="ident" id="4686530">InstMatch</span><span class="op" id="4686539">,</span>&nbsp;<span class="ident" id="4686541"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686547">.</span><span class="ident" id="4686548">InstFail</span><span class="op" id="4686556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686561"><a href="/regexp/onepass.go.html#4686278">prog</a></span><span class="op" id="4686565">.</span><span class="ident" id="4686566">Inst</span><span class="op" id="4686570">[</span><span class="ident" id="4686571"><a href="/regexp/onepass.go.html#4686327">ix</a></span><span class="op" id="4686573">]</span><span class="op" id="4686574">.</span><span class="ident" id="4686575">Next</span>&nbsp;<span class="op" id="4686580">=</span>&nbsp;<span class="ident" id="4686582">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686588">case</span>&nbsp;<span class="ident" id="4686593"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686599">.</span><span class="ident" id="4686600">InstRune1</span><span class="op" id="4686609">,</span>&nbsp;<span class="ident" id="4686611"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686617">.</span><span class="ident" id="4686618">InstRuneAny</span><span class="op" id="4686629">,</span>&nbsp;<span class="ident" id="4686631"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686637">.</span><span class="ident" id="4686638">InstRuneAnyNotNL</span><span class="op" id="4686654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686659"><a href="/regexp/onepass.go.html#4686278">prog</a></span><span class="op" id="4686663">.</span><span class="ident" id="4686664">Inst</span><span class="op" id="4686668">[</span><span class="ident" id="4686669"><a href="/regexp/onepass.go.html#4686327">ix</a></span><span class="op" id="4686671">]</span><span class="op" id="4686672">.</span><span class="ident" id="4686673">Next</span>&nbsp;<span class="op" id="4686678">=</span>&nbsp;<span class="ident" id="4686680">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686687"><a href="/regexp/onepass.go.html#4686278">prog</a></span><span class="op" id="4686691">.</span><span class="ident" id="4686692">Inst</span><span class="op" id="4686696">[</span><span class="ident" id="4686697"><a href="/regexp/onepass.go.html#4686327">ix</a></span><span class="op" id="4686699">]</span>&nbsp;<span class="op" id="4686701">=</span>&nbsp;<span class="ident" id="4686703"><a href="/regexp/onepass.go.html#4681736">onePassInst</a></span><span class="op" id="4686714">{</span><span class="ident" id="4686715">Inst</span><span class="op" id="4686719">:</span>&nbsp;<span class="ident" id="4686721"><a href="/regexp/onepass.go.html#4686331">instOriginal</a></span><span class="op" id="4686733">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686740">}</span><br>
<span class="lineno"></span><span class="op" id="4686742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4686745">//&nbsp;onePassCopy&nbsp;creates&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;original&nbsp;Prog,&nbsp;as&nbsp;we&#39;ll&nbsp;be&nbsp;modifying&nbsp;it</span><br>
<span class="lineno">220</span><span class="keyword" id="4686822">func</span>&nbsp;<span class="ident" id="4686827">onePassCopy</span><span class="op" id="4686838">(</span><span class="ident" id="4686839">prog</span>&nbsp;<span class="op" id="4686844">*</span><span class="ident" id="4686845"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4686851">.</span><span class="ident" id="4686852">Prog</span><span class="op" id="4686856">)</span>&nbsp;<span class="op" id="4686858">*</span><span class="ident" id="4686859"><a href="/regexp/onepass.go.html#4681445">onePassProg</a></span>&nbsp;<span class="op" id="4686871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686874">p</span>&nbsp;<span class="op" id="4686876">:=</span>&nbsp;<span class="op" id="4686879">&amp;</span><span class="ident" id="4686880"><a href="/regexp/onepass.go.html#4681445">onePassProg</a></span><span class="op" id="4686891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686895">Start</span><span class="op" id="4686900">:</span>&nbsp;&nbsp;<span class="ident" id="4686903"><a href="/regexp/onepass.go.html#4686839">prog</a></span><span class="op" id="4686907">.</span><span class="ident" id="4686908">Start</span><span class="op" id="4686913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686917">NumCap</span><span class="op" id="4686923">:</span>&nbsp;<span class="ident" id="4686925"><a href="/regexp/onepass.go.html#4686839">prog</a></span><span class="op" id="4686929">.</span><span class="ident" id="4686930">NumCap</span><span class="op" id="4686936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686939">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686942">for</span>&nbsp;<span class="ident" id="4686946">_</span><span class="op" id="4686947">,</span>&nbsp;<span class="ident" id="4686949">inst</span>&nbsp;<span class="op" id="4686954">:=</span>&nbsp;<span class="keyword" id="4686957">range</span>&nbsp;<span class="ident" id="4686963"><a href="/regexp/onepass.go.html#4686839">prog</a></span><span class="op" id="4686967">.</span><span class="ident" id="4686968">Inst</span>&nbsp;<span class="op" id="4686973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686977"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4686978">.</span><span class="ident" id="4686979">Inst</span>&nbsp;<span class="op" id="4686984">=</span>&nbsp;<span class="builtinfunc" id="4686986">append</span><span class="op" id="4686992">(</span><span class="ident" id="4686993"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4686994">.</span><span class="ident" id="4686995">Inst</span><span class="op" id="4686999">,</span>&nbsp;<span class="ident" id="4687001"><a href="/regexp/onepass.go.html#4681736">onePassInst</a></span><span class="op" id="4687012">{</span><span class="ident" id="4687013">Inst</span><span class="op" id="4687017">:</span>&nbsp;<span class="ident" id="4687019"><a href="/regexp/onepass.go.html#4686949">inst</a></span><span class="op" id="4687023">}</span><span class="op" id="4687024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687031">//&nbsp;rewrites&nbsp;one&nbsp;or&nbsp;more&nbsp;common&nbsp;Prog&nbsp;constructs&nbsp;that&nbsp;enable&nbsp;some&nbsp;otherwise</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687106">//&nbsp;non-onepass&nbsp;Progs&nbsp;to&nbsp;be&nbsp;onepass.&nbsp;A:BD&nbsp;(for&nbsp;example)&nbsp;means&nbsp;an&nbsp;InstAlt&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687182">//&nbsp;ip&nbsp;A,&nbsp;that&nbsp;points&nbsp;to&nbsp;ips&nbsp;B&nbsp;&amp;&nbsp;C.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687218">//&nbsp;A:BC&nbsp;+&nbsp;B:DA&nbsp;=&gt;&nbsp;A:BC&nbsp;+&nbsp;B:CD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687249">//&nbsp;A:BC&nbsp;+&nbsp;B:DC&nbsp;=&gt;&nbsp;A:DC&nbsp;+&nbsp;B:DC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687280">for</span>&nbsp;<span class="ident" id="4687284">pc</span>&nbsp;<span class="op" id="4687287">:=</span>&nbsp;<span class="keyword" id="4687290">range</span>&nbsp;<span class="ident" id="4687296"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4687297">.</span><span class="ident" id="4687298">Inst</span>&nbsp;<span class="op" id="4687303">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687307">switch</span>&nbsp;<span class="ident" id="4687314"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4687315">.</span><span class="ident" id="4687316">Inst</span><span class="op" id="4687320">[</span><span class="ident" id="4687321"><a href="/regexp/onepass.go.html#4687284">pc</a></span><span class="op" id="4687323">]</span><span class="op" id="4687324">.</span><span class="ident" id="4687325">Op</span>&nbsp;<span class="op" id="4687328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687332">default</span><span class="op" id="4687339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687344">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687355">case</span>&nbsp;<span class="ident" id="4687360"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687366">.</span><span class="ident" id="4687367">InstAlt</span><span class="op" id="4687374">,</span>&nbsp;<span class="ident" id="4687376"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687382">.</span><span class="ident" id="4687383">InstAltMatch</span><span class="op" id="4687395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687400">//&nbsp;A:Bx&nbsp;+&nbsp;B:Ay</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687418">p_A_Other</span>&nbsp;<span class="op" id="4687428">:=</span>&nbsp;<span class="op" id="4687431">&amp;</span><span class="ident" id="4687432"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4687433">.</span><span class="ident" id="4687434">Inst</span><span class="op" id="4687438">[</span><span class="ident" id="4687439"><a href="/regexp/onepass.go.html#4687284">pc</a></span><span class="op" id="4687441">]</span><span class="op" id="4687442">.</span><span class="ident" id="4687443">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687450">p_A_Alt</span>&nbsp;<span class="op" id="4687458">:=</span>&nbsp;<span class="op" id="4687461">&amp;</span><span class="ident" id="4687462"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4687463">.</span><span class="ident" id="4687464">Inst</span><span class="op" id="4687468">[</span><span class="ident" id="4687469"><a href="/regexp/onepass.go.html#4687284">pc</a></span><span class="op" id="4687471">]</span><span class="op" id="4687472">.</span><span class="ident" id="4687473">Arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687480">//&nbsp;make&nbsp;sure&nbsp;a&nbsp;target&nbsp;is&nbsp;another&nbsp;Alt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687520">instAlt</span>&nbsp;<span class="op" id="4687528">:=</span>&nbsp;<span class="ident" id="4687531"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4687532">.</span><span class="ident" id="4687533">Inst</span><span class="op" id="4687537">[</span><span class="op" id="4687538">*</span><span class="ident" id="4687539"><a href="/regexp/onepass.go.html#4687450">p_A_Alt</a></span><span class="op" id="4687546">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687551">if</span>&nbsp;<span class="op" id="4687554">!</span><span class="op" id="4687555">(</span><span class="ident" id="4687556"><a href="/regexp/onepass.go.html#4687520">instAlt</a></span><span class="op" id="4687563">.</span><span class="ident" id="4687564">Op</span>&nbsp;<span class="op" id="4687567">==</span>&nbsp;<span class="ident" id="4687570"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687576">.</span><span class="ident" id="4687577">InstAlt</span>&nbsp;<span class="op" id="4687585">||</span>&nbsp;<span class="ident" id="4687588"><a href="/regexp/onepass.go.html#4687520">instAlt</a></span><span class="op" id="4687595">.</span><span class="ident" id="4687596">Op</span>&nbsp;<span class="op" id="4687599">==</span>&nbsp;<span class="ident" id="4687602"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687608">.</span><span class="ident" id="4687609">InstAltMatch</span><span class="op" id="4687621">)</span>&nbsp;<span class="op" id="4687623">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687629"><a href="/regexp/onepass.go.html#4687450">p_A_Alt</a></span><span class="op" id="4687636">,</span>&nbsp;<span class="ident" id="4687638"><a href="/regexp/onepass.go.html#4687418">p_A_Other</a></span>&nbsp;<span class="op" id="4687648">=</span>&nbsp;<span class="ident" id="4687650"><a href="/regexp/onepass.go.html#4687418">p_A_Other</a></span><span class="op" id="4687659">,</span>&nbsp;<span class="ident" id="4687661"><a href="/regexp/onepass.go.html#4687450">p_A_Alt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687673"><a href="/regexp/onepass.go.html#4687520">instAlt</a></span>&nbsp;<span class="op" id="4687681">=</span>&nbsp;<span class="ident" id="4687683"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4687684">.</span><span class="ident" id="4687685">Inst</span><span class="op" id="4687689">[</span><span class="op" id="4687690">*</span><span class="ident" id="4687691"><a href="/regexp/onepass.go.html#4687450">p_A_Alt</a></span><span class="op" id="4687698">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687704">if</span>&nbsp;<span class="op" id="4687707">!</span><span class="op" id="4687708">(</span><span class="ident" id="4687709"><a href="/regexp/onepass.go.html#4687520">instAlt</a></span><span class="op" id="4687716">.</span><span class="ident" id="4687717">Op</span>&nbsp;<span class="op" id="4687720">==</span>&nbsp;<span class="ident" id="4687723"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687729">.</span><span class="ident" id="4687730">InstAlt</span>&nbsp;<span class="op" id="4687738">||</span>&nbsp;<span class="ident" id="4687741"><a href="/regexp/onepass.go.html#4687520">instAlt</a></span><span class="op" id="4687748">.</span><span class="ident" id="4687749">Op</span>&nbsp;<span class="op" id="4687752">==</span>&nbsp;<span class="ident" id="4687755"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687761">.</span><span class="ident" id="4687762">InstAltMatch</span><span class="op" id="4687774">)</span>&nbsp;<span class="op" id="4687776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687783">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687796">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687806">instOther</span>&nbsp;<span class="op" id="4687816">:=</span>&nbsp;<span class="ident" id="4687819"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4687820">.</span><span class="ident" id="4687821">Inst</span><span class="op" id="4687825">[</span><span class="op" id="4687826">*</span><span class="ident" id="4687827"><a href="/regexp/onepass.go.html#4687418">p_A_Other</a></span><span class="op" id="4687836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687841">//&nbsp;Analyzing&nbsp;both&nbsp;legs&nbsp;pointing&nbsp;to&nbsp;Alts&nbsp;is&nbsp;for&nbsp;another&nbsp;day</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687903">if</span>&nbsp;<span class="ident" id="4687906"><a href="/regexp/onepass.go.html#4687806">instOther</a></span><span class="op" id="4687915">.</span><span class="ident" id="4687916">Op</span>&nbsp;<span class="op" id="4687919">==</span>&nbsp;<span class="ident" id="4687922"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687928">.</span><span class="ident" id="4687929">InstAlt</span>&nbsp;<span class="op" id="4687937">||</span>&nbsp;<span class="ident" id="4687940"><a href="/regexp/onepass.go.html#4687806">instOther</a></span><span class="op" id="4687949">.</span><span class="ident" id="4687950">Op</span>&nbsp;<span class="op" id="4687953">==</span>&nbsp;<span class="ident" id="4687956"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4687962">.</span><span class="ident" id="4687963">InstAltMatch</span>&nbsp;<span class="op" id="4687976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687982">//&nbsp;too&nbsp;complicated</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688005">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688022">//&nbsp;simple&nbsp;empty&nbsp;transition&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688057">//&nbsp;A:BC&nbsp;+&nbsp;B:DA&nbsp;=&gt;&nbsp;A:BC&nbsp;+&nbsp;B:DC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688090">p_B_Alt</span>&nbsp;<span class="op" id="4688098">:=</span>&nbsp;<span class="op" id="4688101">&amp;</span><span class="ident" id="4688102"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4688103">.</span><span class="ident" id="4688104">Inst</span><span class="op" id="4688108">[</span><span class="op" id="4688109">*</span><span class="ident" id="4688110"><a href="/regexp/onepass.go.html#4687450">p_A_Alt</a></span><span class="op" id="4688117">]</span><span class="op" id="4688118">.</span><span class="ident" id="4688119">Out</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688126">p_B_Other</span>&nbsp;<span class="op" id="4688136">:=</span>&nbsp;<span class="op" id="4688139">&amp;</span><span class="ident" id="4688140"><a href="/regexp/onepass.go.html#4686874">p</a></span><span class="op" id="4688141">.</span><span class="ident" id="4688142">Inst</span><span class="op" id="4688146">[</span><span class="op" id="4688147">*</span><span class="ident" id="4688148"><a href="/regexp/onepass.go.html#4687450">p_A_Alt</a></span><span class="op" id="4688155">]</span><span class="op" id="4688156">.</span><span class="ident" id="4688157">Arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688164">patch</span>&nbsp;<span class="op" id="4688170">:=</span>&nbsp;<span class="ident" id="4688173">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688182">if</span>&nbsp;<span class="ident" id="4688185"><a href="/regexp/onepass.go.html#4687520">instAlt</a></span><span class="op" id="4688192">.</span><span class="ident" id="4688193">Out</span>&nbsp;<span class="op" id="4688197">==</span>&nbsp;<span class="builtintype" id="4688200">uint32</span><span class="op" id="4688206">(</span><span class="ident" id="4688207"><a href="/regexp/onepass.go.html#4687284">pc</a></span><span class="op" id="4688209">)</span>&nbsp;<span class="op" id="4688211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688217"><a href="/regexp/onepass.go.html#4688164">patch</a></span>&nbsp;<span class="op" id="4688223">=</span>&nbsp;<span class="ident" id="4688225">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688233">}</span>&nbsp;<span class="keyword" id="4688235">else</span>&nbsp;<span class="keyword" id="4688240">if</span>&nbsp;<span class="ident" id="4688243"><a href="/regexp/onepass.go.html#4687520">instAlt</a></span><span class="op" id="4688250">.</span><span class="ident" id="4688251">Arg</span>&nbsp;<span class="op" id="4688255">==</span>&nbsp;<span class="builtintype" id="4688258">uint32</span><span class="op" id="4688264">(</span><span class="ident" id="4688265"><a href="/regexp/onepass.go.html#4687284">pc</a></span><span class="op" id="4688267">)</span>&nbsp;<span class="op" id="4688269">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688275"><a href="/regexp/onepass.go.html#4688164">patch</a></span>&nbsp;<span class="op" id="4688281">=</span>&nbsp;<span class="ident" id="4688283">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688292"><a href="/regexp/onepass.go.html#4688090">p_B_Alt</a></span><span class="op" id="4688299">,</span>&nbsp;<span class="ident" id="4688301"><a href="/regexp/onepass.go.html#4688126">p_B_Other</a></span>&nbsp;<span class="op" id="4688311">=</span>&nbsp;<span class="ident" id="4688313"><a href="/regexp/onepass.go.html#4688126">p_B_Other</a></span><span class="op" id="4688322">,</span>&nbsp;<span class="ident" id="4688324"><a href="/regexp/onepass.go.html#4688090">p_B_Alt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688340">if</span>&nbsp;<span class="ident" id="4688343"><a href="/regexp/onepass.go.html#4688164">patch</a></span>&nbsp;<span class="op" id="4688349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688355">*</span><span class="ident" id="4688356"><a href="/regexp/onepass.go.html#4688090">p_B_Alt</a></span>&nbsp;<span class="op" id="4688364">=</span>&nbsp;<span class="op" id="4688366">*</span><span class="ident" id="4688367"><a href="/regexp/onepass.go.html#4687418">p_A_Other</a></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688386">//&nbsp;empty&nbsp;transition&nbsp;to&nbsp;common&nbsp;target</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688426">//&nbsp;A:BC&nbsp;+&nbsp;B:DC&nbsp;=&gt;&nbsp;A:DC&nbsp;+&nbsp;B:DC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688459">if</span>&nbsp;<span class="op" id="4688462">*</span><span class="ident" id="4688463"><a href="/regexp/onepass.go.html#4687418">p_A_Other</a></span>&nbsp;<span class="op" id="4688473">==</span>&nbsp;<span class="op" id="4688476">*</span><span class="ident" id="4688477"><a href="/regexp/onepass.go.html#4688090">p_B_Alt</a></span>&nbsp;<span class="op" id="4688485">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688491">*</span><span class="ident" id="4688492"><a href="/regexp/onepass.go.html#4687450">p_A_Alt</a></span>&nbsp;<span class="op" id="4688500">=</span>&nbsp;<span class="op" id="4688502">*</span><span class="ident" id="4688503"><a href="/regexp/onepass.go.html#4688126">p_B_Other</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688526">return</span>&nbsp;<span class="ident" id="4688533"><a href="/regexp/onepass.go.html#4686874">p</a></span><br>
<span class="lineno">280</span><span class="op" id="4688535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4688538">//&nbsp;runeSlice&nbsp;exists&nbsp;to&nbsp;permit&nbsp;sorting&nbsp;the&nbsp;case-folded&nbsp;rune&nbsp;sets.</span><br>
<span class="lineno"></span><span class="keyword" id="4688603">type</span>&nbsp;<span class="ident" id="4688608">runeSlice</span>&nbsp;<span class="op" id="4688618">[</span><span class="op" id="4688619">]</span><span class="builtintype" id="4688620">rune</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="4688626">func</span>&nbsp;<span class="op" id="4688631">(</span><span class="ident" id="4688632">p</span>&nbsp;<span class="ident" id="4688634"><a href="/regexp/onepass.go.html#4688608">runeSlice</a></span><span class="op" id="4688643">)</span>&nbsp;<span class="ident" id="4688645">Len</span><span class="op" id="4688648">(</span><span class="op" id="4688649">)</span>&nbsp;<span class="builtintype" id="4688651">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688665">{</span>&nbsp;<span class="keyword" id="4688667">return</span>&nbsp;<span class="builtinfunc" id="4688674">len</span><span class="op" id="4688677">(</span><span class="ident" id="4688678"><a href="/regexp/onepass.go.html#4688632">p</a></span><span class="op" id="4688679">)</span>&nbsp;<span class="op" id="4688681">}</span><br>
<span class="lineno"></span><span class="keyword" id="4688683">func</span>&nbsp;<span class="op" id="4688688">(</span><span class="ident" id="4688689">p</span>&nbsp;<span class="ident" id="4688691"><a href="/regexp/onepass.go.html#4688608">runeSlice</a></span><span class="op" id="4688700">)</span>&nbsp;<span class="ident" id="4688702">Less</span><span class="op" id="4688706">(</span><span class="ident" id="4688707">i</span><span class="op" id="4688708">,</span>&nbsp;<span class="ident" id="4688710">j</span>&nbsp;<span class="builtintype" id="4688712">int</span><span class="op" id="4688715">)</span>&nbsp;<span class="builtintype" id="4688717">bool</span>&nbsp;<span class="op" id="4688722">{</span>&nbsp;<span class="keyword" id="4688724">return</span>&nbsp;<span class="ident" id="4688731"><a href="/regexp/onepass.go.html#4688689">p</a></span><span class="op" id="4688732">[</span><span class="ident" id="4688733"><a href="/regexp/onepass.go.html#4688707">i</a></span><span class="op" id="4688734">]</span>&nbsp;<span class="op" id="4688736">&lt;</span>&nbsp;<span class="ident" id="4688738"><a href="/regexp/onepass.go.html#4688689">p</a></span><span class="op" id="4688739">[</span><span class="ident" id="4688740"><a href="/regexp/onepass.go.html#4688710">j</a></span><span class="op" id="4688741">]</span>&nbsp;<span class="op" id="4688743">}</span><br>
<span class="lineno"></span><span class="keyword" id="4688745">func</span>&nbsp;<span class="op" id="4688750">(</span><span class="ident" id="4688751">p</span>&nbsp;<span class="ident" id="4688753"><a href="/regexp/onepass.go.html#4688608">runeSlice</a></span><span class="op" id="4688762">)</span>&nbsp;<span class="ident" id="4688764">Swap</span><span class="op" id="4688768">(</span><span class="ident" id="4688769">i</span><span class="op" id="4688770">,</span>&nbsp;<span class="ident" id="4688772">j</span>&nbsp;<span class="builtintype" id="4688774">int</span><span class="op" id="4688777">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688784">{</span>&nbsp;<span class="ident" id="4688786"><a href="/regexp/onepass.go.html#4688751">p</a></span><span class="op" id="4688787">[</span><span class="ident" id="4688788"><a href="/regexp/onepass.go.html#4688769">i</a></span><span class="op" id="4688789">]</span><span class="op" id="4688790">,</span>&nbsp;<span class="ident" id="4688792"><a href="/regexp/onepass.go.html#4688751">p</a></span><span class="op" id="4688793">[</span><span class="ident" id="4688794"><a href="/regexp/onepass.go.html#4688772">j</a></span><span class="op" id="4688795">]</span>&nbsp;<span class="op" id="4688797">=</span>&nbsp;<span class="ident" id="4688799"><a href="/regexp/onepass.go.html#4688751">p</a></span><span class="op" id="4688800">[</span><span class="ident" id="4688801"><a href="/regexp/onepass.go.html#4688772">j</a></span><span class="op" id="4688802">]</span><span class="op" id="4688803">,</span>&nbsp;<span class="ident" id="4688805"><a href="/regexp/onepass.go.html#4688751">p</a></span><span class="op" id="4688806">[</span><span class="ident" id="4688807"><a href="/regexp/onepass.go.html#4688769">i</a></span><span class="op" id="4688808">]</span>&nbsp;<span class="op" id="4688810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4688813">//&nbsp;Sort&nbsp;is&nbsp;a&nbsp;convenience&nbsp;method.</span><br>
<span class="lineno">290</span><span class="keyword" id="4688846">func</span>&nbsp;<span class="op" id="4688851">(</span><span class="ident" id="4688852">p</span>&nbsp;<span class="ident" id="4688854"><a href="/regexp/onepass.go.html#4688608">runeSlice</a></span><span class="op" id="4688863">)</span>&nbsp;<span class="ident" id="4688865">Sort</span><span class="op" id="4688869">(</span><span class="op" id="4688870">)</span>&nbsp;<span class="op" id="4688872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688875"><a href="/regexp/onepass.go.html#4681011">sort</a></span><span class="op" id="4688879">.</span><span class="ident" id="4688880">Sort</span><span class="op" id="4688884">(</span><span class="ident" id="4688885"><a href="/regexp/onepass.go.html#4688852">p</a></span><span class="op" id="4688886">)</span><br>
<span class="lineno"></span><span class="op" id="4688888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4688891">var</span>&nbsp;<span class="ident" id="4688895">anyRuneNotNL</span>&nbsp;<span class="op" id="4688908">=</span>&nbsp;<span class="op" id="4688910">[</span><span class="op" id="4688911">]</span><span class="builtintype" id="4688912">rune</span><span class="op" id="4688916">{</span><span class="num" id="4688917">0</span><span class="op" id="4688918">,</span>&nbsp;<span class="string" id="4688920">&#39;\n&#39;</span>&nbsp;<span class="op" id="4688925">-</span>&nbsp;<span class="num" id="4688927">1</span><span class="op" id="4688928">,</span>&nbsp;<span class="string" id="4688930">&#39;\n&#39;</span>&nbsp;<span class="op" id="4688935">+</span>&nbsp;<span class="num" id="4688937">1</span><span class="op" id="4688938">,</span>&nbsp;<span class="ident" id="4688940"><a href="/regexp/onepass.go.html#4681019">unicode</a></span><span class="op" id="4688947">.</span><span class="ident" id="4688948">MaxRune</span><span class="op" id="4688955">}</span><br>
<span class="lineno">295</span><span class="keyword" id="4688957">var</span>&nbsp;<span class="ident" id="4688961">anyRune</span>&nbsp;<span class="op" id="4688969">=</span>&nbsp;<span class="op" id="4688971">[</span><span class="op" id="4688972">]</span><span class="builtintype" id="4688973">rune</span><span class="op" id="4688977">{</span><span class="num" id="4688978">0</span><span class="op" id="4688979">,</span>&nbsp;<span class="ident" id="4688981"><a href="/regexp/onepass.go.html#4681019">unicode</a></span><span class="op" id="4688988">.</span><span class="ident" id="4688989">MaxRune</span><span class="op" id="4688996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4688999">//&nbsp;makeOnePass&nbsp;creates&nbsp;a&nbsp;onepass&nbsp;Prog,&nbsp;if&nbsp;possible.&nbsp;It&nbsp;is&nbsp;possible&nbsp;if&nbsp;at&nbsp;any&nbsp;alt,</span><br>
<span class="lineno"></span><span class="comment" id="4689081">//&nbsp;the&nbsp;match&nbsp;engine&nbsp;can&nbsp;always&nbsp;tell&nbsp;which&nbsp;branch&nbsp;to&nbsp;take.&nbsp;The&nbsp;routine&nbsp;may&nbsp;modify</span><br>
<span class="lineno"></span><span class="comment" id="4689162">//&nbsp;p&nbsp;if&nbsp;it&nbsp;is&nbsp;turned&nbsp;into&nbsp;a&nbsp;onepass&nbsp;Prog.&nbsp;If&nbsp;it&nbsp;isn&#39;t&nbsp;possible&nbsp;for&nbsp;this&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno">300</span><span class="comment" id="4689242">//&nbsp;onepass&nbsp;Prog,&nbsp;the&nbsp;Prog&nbsp;notOnePass&nbsp;is&nbsp;returned.&nbsp;makeOnePass&nbsp;is&nbsp;recursive</span><br>
<span class="lineno"></span><span class="comment" id="4689317">//&nbsp;to&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;Prog.</span><br>
<span class="lineno"></span><span class="keyword" id="4689345">func</span>&nbsp;<span class="ident" id="4689350">makeOnePass</span><span class="op" id="4689361">(</span><span class="ident" id="4689362">p</span>&nbsp;<span class="op" id="4689364">*</span><span class="ident" id="4689365"><a href="/regexp/onepass.go.html#4681445">onePassProg</a></span><span class="op" id="4689376">)</span>&nbsp;<span class="op" id="4689378">*</span><span class="ident" id="4689379"><a href="/regexp/onepass.go.html#4681445">onePassProg</a></span>&nbsp;<span class="op" id="4689391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4689394">//&nbsp;If&nbsp;the&nbsp;machine&nbsp;is&nbsp;very&nbsp;long,&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;the&nbsp;time&nbsp;to&nbsp;check&nbsp;if&nbsp;we&nbsp;can&nbsp;use&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689484">if</span>&nbsp;<span class="builtinfunc" id="4689487">len</span><span class="op" id="4689490">(</span><span class="ident" id="4689491"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4689492">.</span><span class="ident" id="4689493">Inst</span><span class="op" id="4689497">)</span>&nbsp;<span class="op" id="4689499">&gt;=</span>&nbsp;<span class="num" id="4689502">1000</span>&nbsp;<span class="op" id="4689507">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689511">return</span>&nbsp;<span class="ident" id="4689518"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689534">var</span>&nbsp;<span class="op" id="4689538">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689542">instQueue</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4689555">=</span>&nbsp;<span class="ident" id="4689557"><a href="/regexp/onepass.go.html#4684469">newQueue</a></span><span class="op" id="4689565">(</span><span class="builtinfunc" id="4689566">len</span><span class="op" id="4689569">(</span><span class="ident" id="4689570"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4689571">.</span><span class="ident" id="4689572">Inst</span><span class="op" id="4689576">)</span><span class="op" id="4689577">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689581">visitQueue</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4689594">=</span>&nbsp;<span class="ident" id="4689596"><a href="/regexp/onepass.go.html#4684469">newQueue</a></span><span class="op" id="4689604">(</span><span class="builtinfunc" id="4689605">len</span><span class="op" id="4689608">(</span><span class="ident" id="4689609"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4689610">.</span><span class="ident" id="4689611">Inst</span><span class="op" id="4689615">)</span><span class="op" id="4689616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689620">build</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689633">func</span><span class="op" id="4689637">(</span><span class="builtintype" id="4689638">uint32</span><span class="op" id="4689644">,</span>&nbsp;<span class="op" id="4689646">*</span><span class="ident" id="4689647"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4689659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689663">check</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689676">func</span><span class="op" id="4689680">(</span><span class="builtintype" id="4689681">uint32</span><span class="op" id="4689687">,</span>&nbsp;<span class="keyword" id="4689689">map</span><span class="op" id="4689692">[</span><span class="builtintype" id="4689693">uint32</span><span class="op" id="4689699">]</span><span class="builtintype" id="4689700">bool</span><span class="op" id="4689704">)</span>&nbsp;<span class="builtintype" id="4689706">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689713">onePassRunes</span>&nbsp;<span class="op" id="4689726">=</span>&nbsp;<span class="builtinfunc" id="4689728">make</span><span class="op" id="4689732">(</span><span class="op" id="4689733">[</span><span class="op" id="4689734">]</span><span class="op" id="4689735">[</span><span class="op" id="4689736">]</span><span class="builtintype" id="4689737">rune</span><span class="op" id="4689741">,</span>&nbsp;<span class="builtinfunc" id="4689743">len</span><span class="op" id="4689746">(</span><span class="ident" id="4689747"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4689748">.</span><span class="ident" id="4689749">Inst</span><span class="op" id="4689753">)</span><span class="op" id="4689754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689757">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689760"><a href="/regexp/onepass.go.html#4689620">build</a></span>&nbsp;<span class="op" id="4689766">=</span>&nbsp;<span class="keyword" id="4689768">func</span><span class="op" id="4689772">(</span><span class="ident" id="4689773">pc</span>&nbsp;<span class="builtintype" id="4689776">uint32</span><span class="op" id="4689782">,</span>&nbsp;<span class="ident" id="4689784">q</span>&nbsp;<span class="op" id="4689786">*</span><span class="ident" id="4689787"><a href="/regexp/onepass.go.html#4683686">queueOnePass</a></span><span class="op" id="4689799">)</span>&nbsp;<span class="op" id="4689801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689805">if</span>&nbsp;<span class="ident" id="4689808"><a href="/regexp/onepass.go.html#4689784">q</a></span><span class="op" id="4689809">.</span><span class="ident" id="4689810">contains</span><span class="op" id="4689818">(</span><span class="ident" id="4689819"><a href="/regexp/onepass.go.html#4689773">pc</a></span><span class="op" id="4689821">)</span>&nbsp;<span class="op" id="4689823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689828">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689841">inst</span>&nbsp;<span class="op" id="4689846">:=</span>&nbsp;<span class="ident" id="4689849"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4689850">.</span><span class="ident" id="4689851">Inst</span><span class="op" id="4689855">[</span><span class="ident" id="4689856"><a href="/regexp/onepass.go.html#4689773">pc</a></span><span class="op" id="4689858">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689862">switch</span>&nbsp;<span class="ident" id="4689869"><a href="/regexp/onepass.go.html#4689841">inst</a></span><span class="op" id="4689873">.</span><span class="ident" id="4689874">Op</span>&nbsp;<span class="op" id="4689877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689881">case</span>&nbsp;<span class="ident" id="4689886"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4689892">.</span><span class="ident" id="4689893">InstAlt</span><span class="op" id="4689900">,</span>&nbsp;<span class="ident" id="4689902"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4689908">.</span><span class="ident" id="4689909">InstAltMatch</span><span class="op" id="4689921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689926"><a href="/regexp/onepass.go.html#4689784">q</a></span><span class="op" id="4689927">.</span><span class="ident" id="4689928">insert</span><span class="op" id="4689934">(</span><span class="ident" id="4689935"><a href="/regexp/onepass.go.html#4689841">inst</a></span><span class="op" id="4689939">.</span><span class="ident" id="4689940">Out</span><span class="op" id="4689943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689948"><a href="/regexp/onepass.go.html#4689620">build</a></span><span class="op" id="4689953">(</span><span class="ident" id="4689954"><a href="/regexp/onepass.go.html#4689841">inst</a></span><span class="op" id="4689958">.</span><span class="ident" id="4689959">Out</span><span class="op" id="4689962">,</span>&nbsp;<span class="ident" id="4689964"><a href="/regexp/onepass.go.html#4689784">q</a></span><span class="op" id="4689965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689970"><a href="/regexp/onepass.go.html#4689784">q</a></span><span class="op" id="4689971">.</span><span class="ident" id="4689972">insert</span><span class="op" id="4689978">(</span><span class="ident" id="4689979"><a href="/regexp/onepass.go.html#4689841">inst</a></span><span class="op" id="4689983">.</span><span class="ident" id="4689984">Arg</span><span class="op" id="4689987">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689991">case</span>&nbsp;<span class="ident" id="4689996"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4690002">.</span><span class="ident" id="4690003">InstMatch</span><span class="op" id="4690012">,</span>&nbsp;<span class="ident" id="4690014"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4690020">.</span><span class="ident" id="4690021">InstFail</span><span class="op" id="4690029">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690033">default</span><span class="op" id="4690040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690045"><a href="/regexp/onepass.go.html#4689784">q</a></span><span class="op" id="4690046">.</span><span class="ident" id="4690047">insert</span><span class="op" id="4690053">(</span><span class="ident" id="4690054"><a href="/regexp/onepass.go.html#4689841">inst</a></span><span class="op" id="4690058">.</span><span class="ident" id="4690059">Out</span><span class="op" id="4690062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690069">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690073">//&nbsp;check&nbsp;that&nbsp;paths&nbsp;from&nbsp;Alt&nbsp;instructions&nbsp;are&nbsp;unambiguous,&nbsp;and&nbsp;rebuild&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690153">//&nbsp;program&nbsp;as&nbsp;a&nbsp;onepass&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690186"><a href="/regexp/onepass.go.html#4689663">check</a></span>&nbsp;<span class="op" id="4690192">=</span>&nbsp;<span class="keyword" id="4690194">func</span><span class="op" id="4690198">(</span><span class="ident" id="4690199">pc</span>&nbsp;<span class="builtintype" id="4690202">uint32</span><span class="op" id="4690208">,</span>&nbsp;<span class="ident" id="4690210">m</span>&nbsp;<span class="keyword" id="4690212">map</span><span class="op" id="4690215">[</span><span class="builtintype" id="4690216">uint32</span><span class="op" id="4690222">]</span><span class="builtintype" id="4690223">bool</span><span class="op" id="4690227">)</span>&nbsp;<span class="op" id="4690229">(</span><span class="ident" id="4690230">ok</span>&nbsp;<span class="builtintype" id="4690233">bool</span><span class="op" id="4690237">)</span>&nbsp;<span class="op" id="4690239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690243"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4690246">=</span>&nbsp;<span class="ident" id="4690248">true</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690255">inst</span>&nbsp;<span class="op" id="4690260">:=</span>&nbsp;<span class="op" id="4690263">&amp;</span><span class="ident" id="4690264"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4690265">.</span><span class="ident" id="4690266">Inst</span><span class="op" id="4690270">[</span><span class="ident" id="4690271"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4690273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690277">if</span>&nbsp;<span class="ident" id="4690280"><a href="/regexp/onepass.go.html#4689581">visitQueue</a></span><span class="op" id="4690290">.</span><span class="ident" id="4690291">contains</span><span class="op" id="4690299">(</span><span class="ident" id="4690300"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4690302">)</span>&nbsp;<span class="op" id="4690304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690309">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690322"><a href="/regexp/onepass.go.html#4689581">visitQueue</a></span><span class="op" id="4690332">.</span><span class="ident" id="4690333">insert</span><span class="op" id="4690339">(</span><span class="ident" id="4690340"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4690342">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690346">switch</span>&nbsp;<span class="ident" id="4690353"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690357">.</span><span class="ident" id="4690358">Op</span>&nbsp;<span class="op" id="4690361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690365">case</span>&nbsp;<span class="ident" id="4690370"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4690376">.</span><span class="ident" id="4690377">InstAlt</span><span class="op" id="4690384">,</span>&nbsp;<span class="ident" id="4690386"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4690392">.</span><span class="ident" id="4690393">InstAltMatch</span><span class="op" id="4690405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690410"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4690413">=</span>&nbsp;<span class="ident" id="4690415"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4690420">(</span><span class="ident" id="4690421"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690425">.</span><span class="ident" id="4690426">Out</span><span class="op" id="4690429">,</span>&nbsp;<span class="ident" id="4690431"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4690432">)</span>&nbsp;<span class="op" id="4690434">&amp;&amp;</span>&nbsp;<span class="ident" id="4690437"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4690442">(</span><span class="ident" id="4690443"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690447">.</span><span class="ident" id="4690448">Arg</span><span class="op" id="4690451">,</span>&nbsp;<span class="ident" id="4690453"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4690454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690459">//&nbsp;check&nbsp;no-input&nbsp;paths&nbsp;to&nbsp;InstMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690499">matchOut</span>&nbsp;<span class="op" id="4690508">:=</span>&nbsp;<span class="ident" id="4690511"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4690512">[</span><span class="ident" id="4690513"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690517">.</span><span class="ident" id="4690518">Out</span><span class="op" id="4690521">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690526">matchArg</span>&nbsp;<span class="op" id="4690535">:=</span>&nbsp;<span class="ident" id="4690538"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4690539">[</span><span class="ident" id="4690540"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690544">.</span><span class="ident" id="4690545">Arg</span><span class="op" id="4690548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690553">if</span>&nbsp;<span class="ident" id="4690556"><a href="/regexp/onepass.go.html#4690499">matchOut</a></span>&nbsp;<span class="op" id="4690565">&amp;&amp;</span>&nbsp;<span class="ident" id="4690568"><a href="/regexp/onepass.go.html#4690526">matchArg</a></span>&nbsp;<span class="op" id="4690577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690583"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4690586">=</span>&nbsp;<span class="ident" id="4690588">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690598">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690607">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690612">//&nbsp;Match&nbsp;on&nbsp;empty&nbsp;goes&nbsp;in&nbsp;inst.Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690650">if</span>&nbsp;<span class="ident" id="4690653"><a href="/regexp/onepass.go.html#4690526">matchArg</a></span>&nbsp;<span class="op" id="4690662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690668"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690672">.</span><span class="ident" id="4690673">Out</span><span class="op" id="4690676">,</span>&nbsp;<span class="ident" id="4690678"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690682">.</span><span class="ident" id="4690683">Arg</span>&nbsp;<span class="op" id="4690687">=</span>&nbsp;<span class="ident" id="4690689"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690693">.</span><span class="ident" id="4690694">Arg</span><span class="op" id="4690697">,</span>&nbsp;<span class="ident" id="4690699"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690703">.</span><span class="ident" id="4690704">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690712"><a href="/regexp/onepass.go.html#4690499">matchOut</a></span><span class="op" id="4690720">,</span>&nbsp;<span class="ident" id="4690722"><a href="/regexp/onepass.go.html#4690526">matchArg</a></span>&nbsp;<span class="op" id="4690731">=</span>&nbsp;<span class="ident" id="4690733"><a href="/regexp/onepass.go.html#4690526">matchArg</a></span><span class="op" id="4690741">,</span>&nbsp;<span class="ident" id="4690743"><a href="/regexp/onepass.go.html#4690499">matchOut</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690755">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690760">if</span>&nbsp;<span class="ident" id="4690763"><a href="/regexp/onepass.go.html#4690499">matchOut</a></span>&nbsp;<span class="op" id="4690772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690778"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4690779">[</span><span class="ident" id="4690780"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4690782">]</span>&nbsp;<span class="op" id="4690784">=</span>&nbsp;<span class="ident" id="4690786">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690795"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690799">.</span><span class="ident" id="4690800">Op</span>&nbsp;<span class="op" id="4690803">=</span>&nbsp;<span class="ident" id="4690805"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4690811">.</span><span class="ident" id="4690812">InstAltMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4690834">//&nbsp;build&nbsp;a&nbsp;dispatch&nbsp;operator&nbsp;from&nbsp;the&nbsp;two&nbsp;legs&nbsp;of&nbsp;the&nbsp;alt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690896"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4690908">[</span><span class="ident" id="4690909"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4690911">]</span><span class="op" id="4690912">,</span>&nbsp;<span class="ident" id="4690914"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690918">.</span><span class="ident" id="4690919">Next</span>&nbsp;<span class="op" id="4690924">=</span>&nbsp;<span class="ident" id="4690926"><a href="/regexp/onepass.go.html#4685112">mergeRuneSets</a></span><span class="op" id="4690939">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690945">&amp;</span><span class="ident" id="4690946"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4690958">[</span><span class="ident" id="4690959"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690963">.</span><span class="ident" id="4690964">Out</span><span class="op" id="4690967">]</span><span class="op" id="4690968">,</span>&nbsp;<span class="op" id="4690970">&amp;</span><span class="ident" id="4690971"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4690983">[</span><span class="ident" id="4690984"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690988">.</span><span class="ident" id="4690989">Arg</span><span class="op" id="4690992">]</span><span class="op" id="4690993">,</span>&nbsp;<span class="ident" id="4690995"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4690999">.</span><span class="ident" id="4691000">Out</span><span class="op" id="4691003">,</span>&nbsp;<span class="ident" id="4691005"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691009">.</span><span class="ident" id="4691010">Arg</span><span class="op" id="4691013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691018">if</span>&nbsp;<span class="builtinfunc" id="4691021">len</span><span class="op" id="4691024">(</span><span class="ident" id="4691025"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691029">.</span><span class="ident" id="4691030">Next</span><span class="op" id="4691034">)</span>&nbsp;<span class="op" id="4691036">&gt;</span>&nbsp;<span class="num" id="4691038">0</span>&nbsp;<span class="op" id="4691040">&amp;&amp;</span>&nbsp;<span class="ident" id="4691043"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691047">.</span><span class="ident" id="4691048">Next</span><span class="op" id="4691052">[</span><span class="num" id="4691053">0</span><span class="op" id="4691054">]</span>&nbsp;<span class="op" id="4691056">==</span>&nbsp;<span class="ident" id="4691059"><a href="/regexp/onepass.go.html#4685013">mergeFailed</a></span>&nbsp;<span class="op" id="4691071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691077"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4691080">=</span>&nbsp;<span class="ident" id="4691082">false</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691092">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691105">case</span>&nbsp;<span class="ident" id="4691110"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4691116">.</span><span class="ident" id="4691117">InstCapture</span><span class="op" id="4691128">,</span>&nbsp;<span class="ident" id="4691130"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4691136">.</span><span class="ident" id="4691137">InstNop</span><span class="op" id="4691144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691149"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4691152">=</span>&nbsp;<span class="ident" id="4691154"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4691159">(</span><span class="ident" id="4691160"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691164">.</span><span class="ident" id="4691165">Out</span><span class="op" id="4691168">,</span>&nbsp;<span class="ident" id="4691170"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691176"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691177">[</span><span class="ident" id="4691178"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691180">]</span>&nbsp;<span class="op" id="4691182">=</span>&nbsp;<span class="ident" id="4691184"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691185">[</span><span class="ident" id="4691186"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691190">.</span><span class="ident" id="4691191">Out</span><span class="op" id="4691194">]</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4691199">//&nbsp;pass&nbsp;matching&nbsp;runes&nbsp;back&nbsp;through&nbsp;these&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691252"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4691264">[</span><span class="ident" id="4691265"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691267">]</span>&nbsp;<span class="op" id="4691269">=</span>&nbsp;<span class="builtinfunc" id="4691271">append</span><span class="op" id="4691277">(</span><span class="op" id="4691278">[</span><span class="op" id="4691279">]</span><span class="builtintype" id="4691280">rune</span><span class="op" id="4691284">{</span><span class="op" id="4691285">}</span><span class="op" id="4691286">,</span>&nbsp;<span class="ident" id="4691288"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4691300">[</span><span class="ident" id="4691301"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691305">.</span><span class="ident" id="4691306">Out</span><span class="op" id="4691309">]</span><span class="op" id="4691310">...</span><span class="op" id="4691313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691318"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691322">.</span><span class="ident" id="4691323">Next</span>&nbsp;<span class="op" id="4691328">=</span>&nbsp;<span class="op" id="4691330">[</span><span class="op" id="4691331">]</span><span class="builtintype" id="4691332">uint32</span><span class="op" id="4691338">{</span><span class="op" id="4691339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691344">for</span>&nbsp;<span class="ident" id="4691348">i</span>&nbsp;<span class="op" id="4691350">:=</span>&nbsp;<span class="builtinfunc" id="4691353">len</span><span class="op" id="4691356">(</span><span class="ident" id="4691357"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4691369">[</span><span class="ident" id="4691370"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691372">]</span><span class="op" id="4691373">)</span>&nbsp;<span class="op" id="4691375">/</span>&nbsp;<span class="num" id="4691377">2</span><span class="op" id="4691378">;</span>&nbsp;<span class="ident" id="4691380"><a href="/regexp/onepass.go.html#4691348">i</a></span>&nbsp;<span class="op" id="4691382">&gt;=</span>&nbsp;<span class="num" id="4691385">0</span><span class="op" id="4691386">;</span>&nbsp;<span class="ident" id="4691388"><a href="/regexp/onepass.go.html#4691348">i</a></span><span class="op" id="4691389">--</span>&nbsp;<span class="op" id="4691392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691398"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691402">.</span><span class="ident" id="4691403">Next</span>&nbsp;<span class="op" id="4691408">=</span>&nbsp;<span class="builtinfunc" id="4691410">append</span><span class="op" id="4691416">(</span><span class="ident" id="4691417"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691421">.</span><span class="ident" id="4691422">Next</span><span class="op" id="4691426">,</span>&nbsp;<span class="ident" id="4691428"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691432">.</span><span class="ident" id="4691433">Out</span><span class="op" id="4691436">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691445">case</span>&nbsp;<span class="ident" id="4691450"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4691456">.</span><span class="ident" id="4691457">InstEmptyWidth</span><span class="op" id="4691471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691476"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4691479">=</span>&nbsp;<span class="ident" id="4691481"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4691486">(</span><span class="ident" id="4691487"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691491">.</span><span class="ident" id="4691492">Out</span><span class="op" id="4691495">,</span>&nbsp;<span class="ident" id="4691497"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691503"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691504">[</span><span class="ident" id="4691505"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691507">]</span>&nbsp;<span class="op" id="4691509">=</span>&nbsp;<span class="ident" id="4691511"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691512">[</span><span class="ident" id="4691513"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691517">.</span><span class="ident" id="4691518">Out</span><span class="op" id="4691521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691526"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4691538">[</span><span class="ident" id="4691539"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691541">]</span>&nbsp;<span class="op" id="4691543">=</span>&nbsp;<span class="builtinfunc" id="4691545">append</span><span class="op" id="4691551">(</span><span class="op" id="4691552">[</span><span class="op" id="4691553">]</span><span class="builtintype" id="4691554">rune</span><span class="op" id="4691558">{</span><span class="op" id="4691559">}</span><span class="op" id="4691560">,</span>&nbsp;<span class="ident" id="4691562"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4691574">[</span><span class="ident" id="4691575"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691579">.</span><span class="ident" id="4691580">Out</span><span class="op" id="4691583">]</span><span class="op" id="4691584">...</span><span class="op" id="4691587">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691592"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691596">.</span><span class="ident" id="4691597">Next</span>&nbsp;<span class="op" id="4691602">=</span>&nbsp;<span class="op" id="4691604">[</span><span class="op" id="4691605">]</span><span class="builtintype" id="4691606">uint32</span><span class="op" id="4691612">{</span><span class="op" id="4691613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691618">for</span>&nbsp;<span class="ident" id="4691622">i</span>&nbsp;<span class="op" id="4691624">:=</span>&nbsp;<span class="builtinfunc" id="4691627">len</span><span class="op" id="4691630">(</span><span class="ident" id="4691631"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4691643">[</span><span class="ident" id="4691644"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691646">]</span><span class="op" id="4691647">)</span>&nbsp;<span class="op" id="4691649">/</span>&nbsp;<span class="num" id="4691651">2</span><span class="op" id="4691652">;</span>&nbsp;<span class="ident" id="4691654"><a href="/regexp/onepass.go.html#4691622">i</a></span>&nbsp;<span class="op" id="4691656">&gt;=</span>&nbsp;<span class="num" id="4691659">0</span><span class="op" id="4691660">;</span>&nbsp;<span class="ident" id="4691662"><a href="/regexp/onepass.go.html#4691622">i</a></span><span class="op" id="4691663">--</span>&nbsp;<span class="op" id="4691666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691672"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691676">.</span><span class="ident" id="4691677">Next</span>&nbsp;<span class="op" id="4691682">=</span>&nbsp;<span class="builtinfunc" id="4691684">append</span><span class="op" id="4691690">(</span><span class="ident" id="4691691"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691695">.</span><span class="ident" id="4691696">Next</span><span class="op" id="4691700">,</span>&nbsp;<span class="ident" id="4691702"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691706">.</span><span class="ident" id="4691707">Out</span><span class="op" id="4691710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691719">case</span>&nbsp;<span class="ident" id="4691724"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4691730">.</span><span class="ident" id="4691731">InstMatch</span><span class="op" id="4691740">,</span>&nbsp;<span class="ident" id="4691742"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4691748">.</span><span class="ident" id="4691749">InstFail</span><span class="op" id="4691757">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691762"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691763">[</span><span class="ident" id="4691764"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691766">]</span>&nbsp;<span class="op" id="4691768">=</span>&nbsp;<span class="ident" id="4691770"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691774">.</span><span class="ident" id="4691775">Op</span>&nbsp;<span class="op" id="4691778">==</span>&nbsp;<span class="ident" id="4691781"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4691787">.</span><span class="ident" id="4691788">InstMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691801">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691809">case</span>&nbsp;<span class="ident" id="4691814"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4691820">.</span><span class="ident" id="4691821">InstRune</span><span class="op" id="4691829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691834"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4691837">=</span>&nbsp;<span class="ident" id="4691839"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4691844">(</span><span class="ident" id="4691845"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691849">.</span><span class="ident" id="4691850">Out</span><span class="op" id="4691853">,</span>&nbsp;<span class="ident" id="4691855"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691861"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4691862">[</span><span class="ident" id="4691863"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691865">]</span>&nbsp;<span class="op" id="4691867">=</span>&nbsp;<span class="ident" id="4691869">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691878">if</span>&nbsp;<span class="builtinfunc" id="4691881">len</span><span class="op" id="4691884">(</span><span class="ident" id="4691885"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691889">.</span><span class="ident" id="4691890">Next</span><span class="op" id="4691894">)</span>&nbsp;<span class="op" id="4691896">&gt;</span>&nbsp;<span class="num" id="4691898">0</span>&nbsp;<span class="op" id="4691900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691906">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4691915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4691920">if</span>&nbsp;<span class="builtinfunc" id="4691923">len</span><span class="op" id="4691926">(</span><span class="ident" id="4691927"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691931">.</span><span class="ident" id="4691932">Rune</span><span class="op" id="4691936">)</span>&nbsp;<span class="op" id="4691938">==</span>&nbsp;<span class="num" id="4691941">0</span>&nbsp;<span class="op" id="4691943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691949"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4691961">[</span><span class="ident" id="4691962"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4691964">]</span>&nbsp;<span class="op" id="4691966">=</span>&nbsp;<span class="op" id="4691968">[</span><span class="op" id="4691969">]</span><span class="builtintype" id="4691970">rune</span><span class="op" id="4691974">{</span><span class="op" id="4691975">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4691981"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4691985">.</span><span class="ident" id="4691986">Next</span>&nbsp;<span class="op" id="4691991">=</span>&nbsp;<span class="op" id="4691993">[</span><span class="op" id="4691994">]</span><span class="builtintype" id="4691995">uint32</span><span class="op" id="4692001">{</span><span class="ident" id="4692002"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692006">.</span><span class="ident" id="4692007">Out</span><span class="op" id="4692010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692016">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692030">runes</span>&nbsp;<span class="op" id="4692036">:=</span>&nbsp;<span class="builtinfunc" id="4692039">make</span><span class="op" id="4692043">(</span><span class="op" id="4692044">[</span><span class="op" id="4692045">]</span><span class="builtintype" id="4692046">rune</span><span class="op" id="4692050">,</span>&nbsp;<span class="num" id="4692052">0</span><span class="op" id="4692053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692058">if</span>&nbsp;<span class="builtinfunc" id="4692061">len</span><span class="op" id="4692064">(</span><span class="ident" id="4692065"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692069">.</span><span class="ident" id="4692070">Rune</span><span class="op" id="4692074">)</span>&nbsp;<span class="op" id="4692076">==</span>&nbsp;<span class="num" id="4692079">1</span>&nbsp;<span class="op" id="4692081">&amp;&amp;</span>&nbsp;<span class="ident" id="4692084"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4692090">.</span><span class="ident" id="4692091">Flags</span><span class="op" id="4692096">(</span><span class="ident" id="4692097"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692101">.</span><span class="ident" id="4692102">Arg</span><span class="op" id="4692105">)</span><span class="op" id="4692106">&amp;</span><span class="ident" id="4692107"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4692113">.</span><span class="ident" id="4692114">FoldCase</span>&nbsp;<span class="op" id="4692123">!=</span>&nbsp;<span class="num" id="4692126">0</span>&nbsp;<span class="op" id="4692128">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692134">r0</span>&nbsp;<span class="op" id="4692137">:=</span>&nbsp;<span class="ident" id="4692140"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692144">.</span><span class="ident" id="4692145">Rune</span><span class="op" id="4692149">[</span><span class="num" id="4692150">0</span><span class="op" id="4692151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692157"><a href="/regexp/onepass.go.html#4692030">runes</a></span>&nbsp;<span class="op" id="4692163">=</span>&nbsp;<span class="builtinfunc" id="4692165">append</span><span class="op" id="4692171">(</span><span class="ident" id="4692172"><a href="/regexp/onepass.go.html#4692030">runes</a></span><span class="op" id="4692177">,</span>&nbsp;<span class="ident" id="4692179"><a href="/regexp/onepass.go.html#4692134">r0</a></span><span class="op" id="4692181">,</span>&nbsp;<span class="ident" id="4692183"><a href="/regexp/onepass.go.html#4692134">r0</a></span><span class="op" id="4692185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692191">for</span>&nbsp;<span class="ident" id="4692195">r1</span>&nbsp;<span class="op" id="4692198">:=</span>&nbsp;<span class="ident" id="4692201"><a href="/regexp/onepass.go.html#4681019">unicode</a></span><span class="op" id="4692208">.</span><span class="ident" id="4692209">SimpleFold</span><span class="op" id="4692219">(</span><span class="ident" id="4692220"><a href="/regexp/onepass.go.html#4692134">r0</a></span><span class="op" id="4692222">)</span><span class="op" id="4692223">;</span>&nbsp;<span class="ident" id="4692225"><a href="/regexp/onepass.go.html#4692195">r1</a></span>&nbsp;<span class="op" id="4692228">!=</span>&nbsp;<span class="ident" id="4692231"><a href="/regexp/onepass.go.html#4692134">r0</a></span><span class="op" id="4692233">;</span>&nbsp;<span class="ident" id="4692235"><a href="/regexp/onepass.go.html#4692195">r1</a></span>&nbsp;<span class="op" id="4692238">=</span>&nbsp;<span class="ident" id="4692240"><a href="/regexp/onepass.go.html#4681019">unicode</a></span><span class="op" id="4692247">.</span><span class="ident" id="4692248">SimpleFold</span><span class="op" id="4692258">(</span><span class="ident" id="4692259"><a href="/regexp/onepass.go.html#4692195">r1</a></span><span class="op" id="4692261">)</span>&nbsp;<span class="op" id="4692263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692270"><a href="/regexp/onepass.go.html#4692030">runes</a></span>&nbsp;<span class="op" id="4692276">=</span>&nbsp;<span class="builtinfunc" id="4692278">append</span><span class="op" id="4692284">(</span><span class="ident" id="4692285"><a href="/regexp/onepass.go.html#4692030">runes</a></span><span class="op" id="4692290">,</span>&nbsp;<span class="ident" id="4692292"><a href="/regexp/onepass.go.html#4692195">r1</a></span><span class="op" id="4692294">,</span>&nbsp;<span class="ident" id="4692296"><a href="/regexp/onepass.go.html#4692195">r1</a></span><span class="op" id="4692298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692304">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692310"><a href="/regexp/onepass.go.html#4681011">sort</a></span><span class="op" id="4692314">.</span><span class="ident" id="4692315">Sort</span><span class="op" id="4692319">(</span><span class="ident" id="4692320"><a href="/regexp/onepass.go.html#4688608">runeSlice</a></span><span class="op" id="4692329">(</span><span class="ident" id="4692330"><a href="/regexp/onepass.go.html#4692030">runes</a></span><span class="op" id="4692335">)</span><span class="op" id="4692336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692341">}</span>&nbsp;<span class="keyword" id="4692343">else</span>&nbsp;<span class="op" id="4692348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692354"><a href="/regexp/onepass.go.html#4692030">runes</a></span>&nbsp;<span class="op" id="4692360">=</span>&nbsp;<span class="builtinfunc" id="4692362">append</span><span class="op" id="4692368">(</span><span class="ident" id="4692369"><a href="/regexp/onepass.go.html#4692030">runes</a></span><span class="op" id="4692374">,</span>&nbsp;<span class="ident" id="4692376"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692380">.</span><span class="ident" id="4692381">Rune</span><span class="op" id="4692385">...</span><span class="op" id="4692388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692398"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4692410">[</span><span class="ident" id="4692411"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4692413">]</span>&nbsp;<span class="op" id="4692415">=</span>&nbsp;<span class="ident" id="4692417"><a href="/regexp/onepass.go.html#4692030">runes</a></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692426"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692430">.</span><span class="ident" id="4692431">Next</span>&nbsp;<span class="op" id="4692436">=</span>&nbsp;<span class="op" id="4692438">[</span><span class="op" id="4692439">]</span><span class="builtintype" id="4692440">uint32</span><span class="op" id="4692446">{</span><span class="op" id="4692447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692452">for</span>&nbsp;<span class="ident" id="4692456">i</span>&nbsp;<span class="op" id="4692458">:=</span>&nbsp;<span class="builtinfunc" id="4692461">len</span><span class="op" id="4692464">(</span><span class="ident" id="4692465"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4692477">[</span><span class="ident" id="4692478"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4692480">]</span><span class="op" id="4692481">)</span>&nbsp;<span class="op" id="4692483">/</span>&nbsp;<span class="num" id="4692485">2</span><span class="op" id="4692486">;</span>&nbsp;<span class="ident" id="4692488"><a href="/regexp/onepass.go.html#4692456">i</a></span>&nbsp;<span class="op" id="4692490">&gt;=</span>&nbsp;<span class="num" id="4692493">0</span><span class="op" id="4692494">;</span>&nbsp;<span class="ident" id="4692496"><a href="/regexp/onepass.go.html#4692456">i</a></span><span class="op" id="4692497">--</span>&nbsp;<span class="op" id="4692500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692506"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692510">.</span><span class="ident" id="4692511">Next</span>&nbsp;<span class="op" id="4692516">=</span>&nbsp;<span class="builtinfunc" id="4692518">append</span><span class="op" id="4692524">(</span><span class="ident" id="4692525"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692529">.</span><span class="ident" id="4692530">Next</span><span class="op" id="4692534">,</span>&nbsp;<span class="ident" id="4692536"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692540">.</span><span class="ident" id="4692541">Out</span><span class="op" id="4692544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692554"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692558">.</span><span class="ident" id="4692559">Op</span>&nbsp;<span class="op" id="4692562">=</span>&nbsp;<span class="ident" id="4692564"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4692570">.</span><span class="ident" id="4692571">InstRune</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692582">case</span>&nbsp;<span class="ident" id="4692587"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4692593">.</span><span class="ident" id="4692594">InstRune1</span><span class="op" id="4692603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692608"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4692611">=</span>&nbsp;<span class="ident" id="4692613"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4692618">(</span><span class="ident" id="4692619"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692623">.</span><span class="ident" id="4692624">Out</span><span class="op" id="4692627">,</span>&nbsp;<span class="ident" id="4692629"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4692630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692635"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4692636">[</span><span class="ident" id="4692637"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4692639">]</span>&nbsp;<span class="op" id="4692641">=</span>&nbsp;<span class="ident" id="4692643">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692652">if</span>&nbsp;<span class="builtinfunc" id="4692655">len</span><span class="op" id="4692658">(</span><span class="ident" id="4692659"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692663">.</span><span class="ident" id="4692664">Next</span><span class="op" id="4692668">)</span>&nbsp;<span class="op" id="4692670">&gt;</span>&nbsp;<span class="num" id="4692672">0</span>&nbsp;<span class="op" id="4692674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692680">break</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692694">runes</span>&nbsp;<span class="op" id="4692700">:=</span>&nbsp;<span class="op" id="4692703">[</span><span class="op" id="4692704">]</span><span class="builtintype" id="4692705">rune</span><span class="op" id="4692709">{</span><span class="op" id="4692710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4692715">//&nbsp;expand&nbsp;case-folded&nbsp;runes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692746">if</span>&nbsp;<span class="ident" id="4692749"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4692755">.</span><span class="ident" id="4692756">Flags</span><span class="op" id="4692761">(</span><span class="ident" id="4692762"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692766">.</span><span class="ident" id="4692767">Arg</span><span class="op" id="4692770">)</span><span class="op" id="4692771">&amp;</span><span class="ident" id="4692772"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4692778">.</span><span class="ident" id="4692779">FoldCase</span>&nbsp;<span class="op" id="4692788">!=</span>&nbsp;<span class="num" id="4692791">0</span>&nbsp;<span class="op" id="4692793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692799">r0</span>&nbsp;<span class="op" id="4692802">:=</span>&nbsp;<span class="ident" id="4692805"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4692809">.</span><span class="ident" id="4692810">Rune</span><span class="op" id="4692814">[</span><span class="num" id="4692815">0</span><span class="op" id="4692816">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692822"><a href="/regexp/onepass.go.html#4692694">runes</a></span>&nbsp;<span class="op" id="4692828">=</span>&nbsp;<span class="builtinfunc" id="4692830">append</span><span class="op" id="4692836">(</span><span class="ident" id="4692837"><a href="/regexp/onepass.go.html#4692694">runes</a></span><span class="op" id="4692842">,</span>&nbsp;<span class="ident" id="4692844"><a href="/regexp/onepass.go.html#4692799">r0</a></span><span class="op" id="4692846">,</span>&nbsp;<span class="ident" id="4692848"><a href="/regexp/onepass.go.html#4692799">r0</a></span><span class="op" id="4692850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4692856">for</span>&nbsp;<span class="ident" id="4692860">r1</span>&nbsp;<span class="op" id="4692863">:=</span>&nbsp;<span class="ident" id="4692866"><a href="/regexp/onepass.go.html#4681019">unicode</a></span><span class="op" id="4692873">.</span><span class="ident" id="4692874">SimpleFold</span><span class="op" id="4692884">(</span><span class="ident" id="4692885"><a href="/regexp/onepass.go.html#4692799">r0</a></span><span class="op" id="4692887">)</span><span class="op" id="4692888">;</span>&nbsp;<span class="ident" id="4692890"><a href="/regexp/onepass.go.html#4692860">r1</a></span>&nbsp;<span class="op" id="4692893">!=</span>&nbsp;<span class="ident" id="4692896"><a href="/regexp/onepass.go.html#4692799">r0</a></span><span class="op" id="4692898">;</span>&nbsp;<span class="ident" id="4692900"><a href="/regexp/onepass.go.html#4692860">r1</a></span>&nbsp;<span class="op" id="4692903">=</span>&nbsp;<span class="ident" id="4692905"><a href="/regexp/onepass.go.html#4681019">unicode</a></span><span class="op" id="4692912">.</span><span class="ident" id="4692913">SimpleFold</span><span class="op" id="4692923">(</span><span class="ident" id="4692924"><a href="/regexp/onepass.go.html#4692860">r1</a></span><span class="op" id="4692926">)</span>&nbsp;<span class="op" id="4692928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692935"><a href="/regexp/onepass.go.html#4692694">runes</a></span>&nbsp;<span class="op" id="4692941">=</span>&nbsp;<span class="builtinfunc" id="4692943">append</span><span class="op" id="4692949">(</span><span class="ident" id="4692950"><a href="/regexp/onepass.go.html#4692694">runes</a></span><span class="op" id="4692955">,</span>&nbsp;<span class="ident" id="4692957"><a href="/regexp/onepass.go.html#4692860">r1</a></span><span class="op" id="4692959">,</span>&nbsp;<span class="ident" id="4692961"><a href="/regexp/onepass.go.html#4692860">r1</a></span><span class="op" id="4692963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4692969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4692975"><a href="/regexp/onepass.go.html#4681011">sort</a></span><span class="op" id="4692979">.</span><span class="ident" id="4692980">Sort</span><span class="op" id="4692984">(</span><span class="ident" id="4692985"><a href="/regexp/onepass.go.html#4688608">runeSlice</a></span><span class="op" id="4692994">(</span><span class="ident" id="4692995"><a href="/regexp/onepass.go.html#4692694">runes</a></span><span class="op" id="4693000">)</span><span class="op" id="4693001">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693006">}</span>&nbsp;<span class="keyword" id="4693008">else</span>&nbsp;<span class="op" id="4693013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693019"><a href="/regexp/onepass.go.html#4692694">runes</a></span>&nbsp;<span class="op" id="4693025">=</span>&nbsp;<span class="builtinfunc" id="4693027">append</span><span class="op" id="4693033">(</span><span class="ident" id="4693034"><a href="/regexp/onepass.go.html#4692694">runes</a></span><span class="op" id="4693039">,</span>&nbsp;<span class="ident" id="4693041"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693045">.</span><span class="ident" id="4693046">Rune</span><span class="op" id="4693050">[</span><span class="num" id="4693051">0</span><span class="op" id="4693052">]</span><span class="op" id="4693053">,</span>&nbsp;<span class="ident" id="4693055"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693059">.</span><span class="ident" id="4693060">Rune</span><span class="op" id="4693064">[</span><span class="num" id="4693065">0</span><span class="op" id="4693066">]</span><span class="op" id="4693067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693077"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4693089">[</span><span class="ident" id="4693090"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4693092">]</span>&nbsp;<span class="op" id="4693094">=</span>&nbsp;<span class="ident" id="4693096"><a href="/regexp/onepass.go.html#4692694">runes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693105"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693109">.</span><span class="ident" id="4693110">Next</span>&nbsp;<span class="op" id="4693115">=</span>&nbsp;<span class="op" id="4693117">[</span><span class="op" id="4693118">]</span><span class="builtintype" id="4693119">uint32</span><span class="op" id="4693125">{</span><span class="op" id="4693126">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693131">for</span>&nbsp;<span class="ident" id="4693135">i</span>&nbsp;<span class="op" id="4693137">:=</span>&nbsp;<span class="builtinfunc" id="4693140">len</span><span class="op" id="4693143">(</span><span class="ident" id="4693144"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4693156">[</span><span class="ident" id="4693157"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4693159">]</span><span class="op" id="4693160">)</span>&nbsp;<span class="op" id="4693162">/</span>&nbsp;<span class="num" id="4693164">2</span><span class="op" id="4693165">;</span>&nbsp;<span class="ident" id="4693167"><a href="/regexp/onepass.go.html#4693135">i</a></span>&nbsp;<span class="op" id="4693169">&gt;=</span>&nbsp;<span class="num" id="4693172">0</span><span class="op" id="4693173">;</span>&nbsp;<span class="ident" id="4693175"><a href="/regexp/onepass.go.html#4693135">i</a></span><span class="op" id="4693176">--</span>&nbsp;<span class="op" id="4693179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693185"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693189">.</span><span class="ident" id="4693190">Next</span>&nbsp;<span class="op" id="4693195">=</span>&nbsp;<span class="builtinfunc" id="4693197">append</span><span class="op" id="4693203">(</span><span class="ident" id="4693204"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693208">.</span><span class="ident" id="4693209">Next</span><span class="op" id="4693213">,</span>&nbsp;<span class="ident" id="4693215"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693219">.</span><span class="ident" id="4693220">Out</span><span class="op" id="4693223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693233"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693237">.</span><span class="ident" id="4693238">Op</span>&nbsp;<span class="op" id="4693241">=</span>&nbsp;<span class="ident" id="4693243"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4693249">.</span><span class="ident" id="4693250">InstRune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693261">case</span>&nbsp;<span class="ident" id="4693266"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4693272">.</span><span class="ident" id="4693273">InstRuneAny</span><span class="op" id="4693284">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693289"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4693292">=</span>&nbsp;<span class="ident" id="4693294"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4693299">(</span><span class="ident" id="4693300"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693304">.</span><span class="ident" id="4693305">Out</span><span class="op" id="4693308">,</span>&nbsp;<span class="ident" id="4693310"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4693311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693316"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4693317">[</span><span class="ident" id="4693318"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4693320">]</span>&nbsp;<span class="op" id="4693322">=</span>&nbsp;<span class="ident" id="4693324">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693333">if</span>&nbsp;<span class="builtinfunc" id="4693336">len</span><span class="op" id="4693339">(</span><span class="ident" id="4693340"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693344">.</span><span class="ident" id="4693345">Next</span><span class="op" id="4693349">)</span>&nbsp;<span class="op" id="4693351">&gt;</span>&nbsp;<span class="num" id="4693353">0</span>&nbsp;<span class="op" id="4693355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693361">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693370">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693375"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4693387">[</span><span class="ident" id="4693388"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4693390">]</span>&nbsp;<span class="op" id="4693392">=</span>&nbsp;<span class="builtinfunc" id="4693394">append</span><span class="op" id="4693400">(</span><span class="op" id="4693401">[</span><span class="op" id="4693402">]</span><span class="builtintype" id="4693403">rune</span><span class="op" id="4693407">{</span><span class="op" id="4693408">}</span><span class="op" id="4693409">,</span>&nbsp;<span class="ident" id="4693411"><a href="/regexp/onepass.go.html#4688961">anyRune</a></span><span class="op" id="4693418">...</span><span class="op" id="4693421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693426"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693430">.</span><span class="ident" id="4693431">Next</span>&nbsp;<span class="op" id="4693436">=</span>&nbsp;<span class="op" id="4693438">[</span><span class="op" id="4693439">]</span><span class="builtintype" id="4693440">uint32</span><span class="op" id="4693446">{</span><span class="ident" id="4693447"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693451">.</span><span class="ident" id="4693452">Out</span><span class="op" id="4693455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693459">case</span>&nbsp;<span class="ident" id="4693464"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4693470">.</span><span class="ident" id="4693471">InstRuneAnyNotNL</span><span class="op" id="4693487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693492"><a href="/regexp/onepass.go.html#4690230">ok</a></span>&nbsp;<span class="op" id="4693495">=</span>&nbsp;<span class="ident" id="4693497"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4693502">(</span><span class="ident" id="4693503"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693507">.</span><span class="ident" id="4693508">Out</span><span class="op" id="4693511">,</span>&nbsp;<span class="ident" id="4693513"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4693514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693519"><a href="/regexp/onepass.go.html#4690210">m</a></span><span class="op" id="4693520">[</span><span class="ident" id="4693521"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4693523">]</span>&nbsp;<span class="op" id="4693525">=</span>&nbsp;<span class="ident" id="4693527">false</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693536">if</span>&nbsp;<span class="builtinfunc" id="4693539">len</span><span class="op" id="4693542">(</span><span class="ident" id="4693543"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693547">.</span><span class="ident" id="4693548">Next</span><span class="op" id="4693552">)</span>&nbsp;<span class="op" id="4693554">&gt;</span>&nbsp;<span class="num" id="4693556">0</span>&nbsp;<span class="op" id="4693558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693564">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693578"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4693590">[</span><span class="ident" id="4693591"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4693593">]</span>&nbsp;<span class="op" id="4693595">=</span>&nbsp;<span class="builtinfunc" id="4693597">append</span><span class="op" id="4693603">(</span><span class="op" id="4693604">[</span><span class="op" id="4693605">]</span><span class="builtintype" id="4693606">rune</span><span class="op" id="4693610">{</span><span class="op" id="4693611">}</span><span class="op" id="4693612">,</span>&nbsp;<span class="ident" id="4693614"><a href="/regexp/onepass.go.html#4688895">anyRuneNotNL</a></span><span class="op" id="4693626">...</span><span class="op" id="4693629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693634"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693638">.</span><span class="ident" id="4693639">Next</span>&nbsp;<span class="op" id="4693644">=</span>&nbsp;<span class="op" id="4693646">[</span><span class="op" id="4693647">]</span><span class="builtintype" id="4693648">uint32</span><span class="op" id="4693654">{</span><span class="op" id="4693655">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693660">for</span>&nbsp;<span class="ident" id="4693664">i</span>&nbsp;<span class="op" id="4693666">:=</span>&nbsp;<span class="builtinfunc" id="4693669">len</span><span class="op" id="4693672">(</span><span class="ident" id="4693673"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4693685">[</span><span class="ident" id="4693686"><a href="/regexp/onepass.go.html#4690199">pc</a></span><span class="op" id="4693688">]</span><span class="op" id="4693689">)</span>&nbsp;<span class="op" id="4693691">/</span>&nbsp;<span class="num" id="4693693">2</span><span class="op" id="4693694">;</span>&nbsp;<span class="ident" id="4693696"><a href="/regexp/onepass.go.html#4693664">i</a></span>&nbsp;<span class="op" id="4693698">&gt;=</span>&nbsp;<span class="num" id="4693701">0</span><span class="op" id="4693702">;</span>&nbsp;<span class="ident" id="4693704"><a href="/regexp/onepass.go.html#4693664">i</a></span><span class="op" id="4693705">--</span>&nbsp;<span class="op" id="4693708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693714"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693718">.</span><span class="ident" id="4693719">Next</span>&nbsp;<span class="op" id="4693724">=</span>&nbsp;<span class="builtinfunc" id="4693726">append</span><span class="op" id="4693732">(</span><span class="ident" id="4693733"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693737">.</span><span class="ident" id="4693738">Next</span><span class="op" id="4693742">,</span>&nbsp;<span class="ident" id="4693744"><a href="/regexp/onepass.go.html#4690255">inst</a></span><span class="op" id="4693748">.</span><span class="ident" id="4693749">Out</span><span class="op" id="4693752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693765">return</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693777"><a href="/regexp/onepass.go.html#4689542">instQueue</a></span><span class="op" id="4693786">.</span><span class="ident" id="4693787">clear</span><span class="op" id="4693792">(</span><span class="op" id="4693793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693796"><a href="/regexp/onepass.go.html#4689542">instQueue</a></span><span class="op" id="4693805">.</span><span class="ident" id="4693806">insert</span><span class="op" id="4693812">(</span><span class="builtintype" id="4693813">uint32</span><span class="op" id="4693819">(</span><span class="ident" id="4693820"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4693821">.</span><span class="ident" id="4693822">Start</span><span class="op" id="4693827">)</span><span class="op" id="4693828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693831">m</span>&nbsp;<span class="op" id="4693833">:=</span>&nbsp;<span class="builtinfunc" id="4693836">make</span><span class="op" id="4693840">(</span><span class="keyword" id="4693841">map</span><span class="op" id="4693844">[</span><span class="builtintype" id="4693845">uint32</span><span class="op" id="4693851">]</span><span class="builtintype" id="4693852">bool</span><span class="op" id="4693856">,</span>&nbsp;<span class="builtinfunc" id="4693858">len</span><span class="op" id="4693861">(</span><span class="ident" id="4693862"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4693863">.</span><span class="ident" id="4693864">Inst</span><span class="op" id="4693868">)</span><span class="op" id="4693869">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693872">for</span>&nbsp;<span class="op" id="4693876">!</span><span class="ident" id="4693877"><a href="/regexp/onepass.go.html#4689542">instQueue</a></span><span class="op" id="4693886">.</span><span class="ident" id="4693887">empty</span><span class="op" id="4693892">(</span><span class="op" id="4693893">)</span>&nbsp;<span class="op" id="4693895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693899">pc</span>&nbsp;<span class="op" id="4693902">:=</span>&nbsp;<span class="ident" id="4693905"><a href="/regexp/onepass.go.html#4689542">instQueue</a></span><span class="op" id="4693914">.</span><span class="ident" id="4693915">next</span><span class="op" id="4693919">(</span><span class="op" id="4693920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693924">inst</span>&nbsp;<span class="op" id="4693929">:=</span>&nbsp;<span class="ident" id="4693932"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4693933">.</span><span class="ident" id="4693934">Inst</span><span class="op" id="4693938">[</span><span class="ident" id="4693939"><a href="/regexp/onepass.go.html#4693899">pc</a></span><span class="op" id="4693941">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693945"><a href="/regexp/onepass.go.html#4689581">visitQueue</a></span><span class="op" id="4693955">.</span><span class="ident" id="4693956">clear</span><span class="op" id="4693961">(</span><span class="op" id="4693962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693966">if</span>&nbsp;<span class="op" id="4693969">!</span><span class="ident" id="4693970"><a href="/regexp/onepass.go.html#4689663">check</a></span><span class="op" id="4693975">(</span><span class="builtintype" id="4693976">uint32</span><span class="op" id="4693982">(</span><span class="ident" id="4693983"><a href="/regexp/onepass.go.html#4693899">pc</a></span><span class="op" id="4693985">)</span><span class="op" id="4693986">,</span>&nbsp;<span class="ident" id="4693988"><a href="/regexp/onepass.go.html#4693831">m</a></span><span class="op" id="4693989">)</span>&nbsp;<span class="op" id="4693991">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693996"><a href="/regexp/onepass.go.html#4689362">p</a></span>&nbsp;<span class="op" id="4693998">=</span>&nbsp;<span class="ident" id="4694000"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694014">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694026">switch</span>&nbsp;<span class="ident" id="4694033"><a href="/regexp/onepass.go.html#4693924">inst</a></span><span class="op" id="4694037">.</span><span class="ident" id="4694038">Op</span>&nbsp;<span class="op" id="4694041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694045">case</span>&nbsp;<span class="ident" id="4694050"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694056">.</span><span class="ident" id="4694057">InstAlt</span><span class="op" id="4694064">,</span>&nbsp;<span class="ident" id="4694066"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694072">.</span><span class="ident" id="4694073">InstAltMatch</span><span class="op" id="4694085">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694090"><a href="/regexp/onepass.go.html#4689542">instQueue</a></span><span class="op" id="4694099">.</span><span class="ident" id="4694100">insert</span><span class="op" id="4694106">(</span><span class="ident" id="4694107"><a href="/regexp/onepass.go.html#4693924">inst</a></span><span class="op" id="4694111">.</span><span class="ident" id="4694112">Out</span><span class="op" id="4694115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694120"><a href="/regexp/onepass.go.html#4689542">instQueue</a></span><span class="op" id="4694129">.</span><span class="ident" id="4694130">insert</span><span class="op" id="4694136">(</span><span class="ident" id="4694137"><a href="/regexp/onepass.go.html#4693924">inst</a></span><span class="op" id="4694141">.</span><span class="ident" id="4694142">Arg</span><span class="op" id="4694145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694149">case</span>&nbsp;<span class="ident" id="4694154"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694160">.</span><span class="ident" id="4694161">InstCapture</span><span class="op" id="4694172">,</span>&nbsp;<span class="ident" id="4694174"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694180">.</span><span class="ident" id="4694181">InstEmptyWidth</span><span class="op" id="4694195">,</span>&nbsp;<span class="ident" id="4694197"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694203">.</span><span class="ident" id="4694204">InstNop</span><span class="op" id="4694211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694216"><a href="/regexp/onepass.go.html#4689542">instQueue</a></span><span class="op" id="4694225">.</span><span class="ident" id="4694226">insert</span><span class="op" id="4694232">(</span><span class="ident" id="4694233"><a href="/regexp/onepass.go.html#4693924">inst</a></span><span class="op" id="4694237">.</span><span class="ident" id="4694238">Out</span><span class="op" id="4694241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694245">case</span>&nbsp;<span class="ident" id="4694250"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694256">.</span><span class="ident" id="4694257">InstMatch</span><span class="op" id="4694266">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694270">case</span>&nbsp;<span class="ident" id="4694275"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694281">.</span><span class="ident" id="4694282">InstFail</span><span class="op" id="4694290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694294">case</span>&nbsp;<span class="ident" id="4694299"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694305">.</span><span class="ident" id="4694306">InstRune</span><span class="op" id="4694314">,</span>&nbsp;<span class="ident" id="4694316"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694322">.</span><span class="ident" id="4694323">InstRune1</span><span class="op" id="4694332">,</span>&nbsp;<span class="ident" id="4694334"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694340">.</span><span class="ident" id="4694341">InstRuneAny</span><span class="op" id="4694352">,</span>&nbsp;<span class="ident" id="4694354"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694360">.</span><span class="ident" id="4694361">InstRuneAnyNotNL</span><span class="op" id="4694377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694381">default</span><span class="op" id="4694388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694395">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694398">if</span>&nbsp;<span class="ident" id="4694401"><a href="/regexp/onepass.go.html#4689362">p</a></span>&nbsp;<span class="op" id="4694403">!=</span>&nbsp;<span class="ident" id="4694406"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span>&nbsp;<span class="op" id="4694417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694421">for</span>&nbsp;<span class="ident" id="4694425">i</span>&nbsp;<span class="op" id="4694427">:=</span>&nbsp;<span class="keyword" id="4694430">range</span>&nbsp;<span class="ident" id="4694436"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4694437">.</span><span class="ident" id="4694438">Inst</span>&nbsp;<span class="op" id="4694443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694448"><a href="/regexp/onepass.go.html#4689362">p</a></span><span class="op" id="4694449">.</span><span class="ident" id="4694450">Inst</span><span class="op" id="4694454">[</span><span class="ident" id="4694455"><a href="/regexp/onepass.go.html#4694425">i</a></span><span class="op" id="4694456">]</span><span class="op" id="4694457">.</span><span class="ident" id="4694458">Rune</span>&nbsp;<span class="op" id="4694463">=</span>&nbsp;<span class="ident" id="4694465"><a href="/regexp/onepass.go.html#4689713">onePassRunes</a></span><span class="op" id="4694477">[</span><span class="ident" id="4694478"><a href="/regexp/onepass.go.html#4694425">i</a></span><span class="op" id="4694479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694486">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694489">return</span>&nbsp;<span class="ident" id="4694496"><a href="/regexp/onepass.go.html#4689362">p</a></span><br>
<span class="lineno"></span><span class="op" id="4694498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4694501">//&nbsp;walk&nbsp;visits&nbsp;each&nbsp;Inst&nbsp;in&nbsp;the&nbsp;prog&nbsp;once,&nbsp;and&nbsp;applies&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="4694569">//&nbsp;function(ip,&nbsp;next),&nbsp;in&nbsp;pre-order.</span><br>
<span class="lineno">495</span><span class="keyword" id="4694606">func</span>&nbsp;<span class="ident" id="4694611">walk</span><span class="op" id="4694615">(</span><span class="ident" id="4694616">prog</span>&nbsp;<span class="op" id="4694621">*</span><span class="ident" id="4694622"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694628">.</span><span class="ident" id="4694629">Prog</span><span class="op" id="4694633">,</span>&nbsp;<span class="ident" id="4694635">funcs</span>&nbsp;<span class="op" id="4694641">...</span><span class="keyword" id="4694644">func</span><span class="op" id="4694648">(</span><span class="ident" id="4694649">ip</span><span class="op" id="4694651">,</span>&nbsp;<span class="ident" id="4694653">next</span>&nbsp;<span class="builtintype" id="4694658">uint32</span><span class="op" id="4694664">)</span><span class="op" id="4694665">)</span>&nbsp;<span class="op" id="4694667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694670">var</span>&nbsp;<span class="ident" id="4694674">walk1</span>&nbsp;<span class="keyword" id="4694680">func</span><span class="op" id="4694684">(</span><span class="builtintype" id="4694685">uint32</span><span class="op" id="4694691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694694">progQueue</span>&nbsp;<span class="op" id="4694704">:=</span>&nbsp;<span class="ident" id="4694707"><a href="/regexp/onepass.go.html#4684469">newQueue</a></span><span class="op" id="4694715">(</span><span class="builtinfunc" id="4694716">len</span><span class="op" id="4694719">(</span><span class="ident" id="4694720"><a href="/regexp/onepass.go.html#4694616">prog</a></span><span class="op" id="4694724">.</span><span class="ident" id="4694725">Inst</span><span class="op" id="4694729">)</span><span class="op" id="4694730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694733"><a href="/regexp/onepass.go.html#4694674">walk1</a></span>&nbsp;<span class="op" id="4694739">=</span>&nbsp;<span class="keyword" id="4694741">func</span><span class="op" id="4694745">(</span><span class="ident" id="4694746">ip</span>&nbsp;<span class="builtintype" id="4694749">uint32</span><span class="op" id="4694755">)</span>&nbsp;<span class="op" id="4694757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694761">if</span>&nbsp;<span class="ident" id="4694764"><a href="/regexp/onepass.go.html#4694694">progQueue</a></span><span class="op" id="4694773">.</span><span class="ident" id="4694774">contains</span><span class="op" id="4694782">(</span><span class="ident" id="4694783"><a href="/regexp/onepass.go.html#4694746">ip</a></span><span class="op" id="4694785">)</span>&nbsp;<span class="op" id="4694787">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694792">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694805"><a href="/regexp/onepass.go.html#4694694">progQueue</a></span><span class="op" id="4694814">.</span><span class="ident" id="4694815">insert</span><span class="op" id="4694821">(</span><span class="ident" id="4694822"><a href="/regexp/onepass.go.html#4694746">ip</a></span><span class="op" id="4694824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694828">inst</span>&nbsp;<span class="op" id="4694833">:=</span>&nbsp;<span class="ident" id="4694836"><a href="/regexp/onepass.go.html#4694616">prog</a></span><span class="op" id="4694840">.</span><span class="ident" id="4694841">Inst</span><span class="op" id="4694845">[</span><span class="ident" id="4694846"><a href="/regexp/onepass.go.html#4694746">ip</a></span><span class="op" id="4694848">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694852">switch</span>&nbsp;<span class="ident" id="4694859"><a href="/regexp/onepass.go.html#4694828">inst</a></span><span class="op" id="4694863">.</span><span class="ident" id="4694864">Op</span>&nbsp;<span class="op" id="4694867">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694871">case</span>&nbsp;<span class="ident" id="4694876"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694882">.</span><span class="ident" id="4694883">InstAlt</span><span class="op" id="4694890">,</span>&nbsp;<span class="ident" id="4694892"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4694898">.</span><span class="ident" id="4694899">InstAltMatch</span><span class="op" id="4694911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694916">for</span>&nbsp;<span class="ident" id="4694920">_</span><span class="op" id="4694921">,</span>&nbsp;<span class="ident" id="4694923">f</span>&nbsp;<span class="op" id="4694925">:=</span>&nbsp;<span class="keyword" id="4694928">range</span>&nbsp;<span class="ident" id="4694934"><a href="/regexp/onepass.go.html#4694635">funcs</a></span>&nbsp;<span class="op" id="4694940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694946"><a href="/regexp/onepass.go.html#4694923">f</a></span><span class="op" id="4694947">(</span><span class="ident" id="4694948"><a href="/regexp/onepass.go.html#4694746">ip</a></span><span class="op" id="4694950">,</span>&nbsp;<span class="ident" id="4694952"><a href="/regexp/onepass.go.html#4694828">inst</a></span><span class="op" id="4694956">.</span><span class="ident" id="4694957">Out</span><span class="op" id="4694960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694966"><a href="/regexp/onepass.go.html#4694923">f</a></span><span class="op" id="4694967">(</span><span class="ident" id="4694968"><a href="/regexp/onepass.go.html#4694746">ip</a></span><span class="op" id="4694970">,</span>&nbsp;<span class="ident" id="4694972"><a href="/regexp/onepass.go.html#4694828">inst</a></span><span class="op" id="4694976">.</span><span class="ident" id="4694977">Arg</span><span class="op" id="4694980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694985">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694990"><a href="/regexp/onepass.go.html#4694674">walk1</a></span><span class="op" id="4694995">(</span><span class="ident" id="4694996"><a href="/regexp/onepass.go.html#4694828">inst</a></span><span class="op" id="4695000">.</span><span class="ident" id="4695001">Out</span><span class="op" id="4695004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695009"><a href="/regexp/onepass.go.html#4694674">walk1</a></span><span class="op" id="4695014">(</span><span class="ident" id="4695015"><a href="/regexp/onepass.go.html#4694828">inst</a></span><span class="op" id="4695019">.</span><span class="ident" id="4695020">Arg</span><span class="op" id="4695023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695027">default</span><span class="op" id="4695034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695039">for</span>&nbsp;<span class="ident" id="4695043">_</span><span class="op" id="4695044">,</span>&nbsp;<span class="ident" id="4695046">f</span>&nbsp;<span class="op" id="4695048">:=</span>&nbsp;<span class="keyword" id="4695051">range</span>&nbsp;<span class="ident" id="4695057"><a href="/regexp/onepass.go.html#4694635">funcs</a></span>&nbsp;<span class="op" id="4695063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695069"><a href="/regexp/onepass.go.html#4695046">f</a></span><span class="op" id="4695070">(</span><span class="ident" id="4695071"><a href="/regexp/onepass.go.html#4694746">ip</a></span><span class="op" id="4695073">,</span>&nbsp;<span class="ident" id="4695075"><a href="/regexp/onepass.go.html#4694828">inst</a></span><span class="op" id="4695079">.</span><span class="ident" id="4695080">Out</span><span class="op" id="4695083">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695093"><a href="/regexp/onepass.go.html#4694674">walk1</a></span><span class="op" id="4695098">(</span><span class="ident" id="4695099"><a href="/regexp/onepass.go.html#4694828">inst</a></span><span class="op" id="4695103">.</span><span class="ident" id="4695104">Out</span><span class="op" id="4695107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695117"><a href="/regexp/onepass.go.html#4694674">walk1</a></span><span class="op" id="4695122">(</span><span class="builtintype" id="4695123">uint32</span><span class="op" id="4695129">(</span><span class="ident" id="4695130"><a href="/regexp/onepass.go.html#4694616">prog</a></span><span class="op" id="4695134">.</span><span class="ident" id="4695135">Start</span><span class="op" id="4695140">)</span><span class="op" id="4695141">)</span><br>
<span class="lineno">520</span><span class="op" id="4695143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4695146">//&nbsp;find&nbsp;returns&nbsp;the&nbsp;Insts&nbsp;that&nbsp;match&nbsp;the&nbsp;argument&nbsp;predicate&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="4695215">func</span>&nbsp;<span class="ident" id="4695220">find</span><span class="op" id="4695224">(</span><span class="ident" id="4695225">prog</span>&nbsp;<span class="op" id="4695230">*</span><span class="ident" id="4695231"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4695237">.</span><span class="ident" id="4695238">Prog</span><span class="op" id="4695242">,</span>&nbsp;<span class="ident" id="4695244">f</span>&nbsp;<span class="keyword" id="4695246">func</span><span class="op" id="4695250">(</span><span class="op" id="4695251">*</span><span class="ident" id="4695252"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4695258">.</span><span class="ident" id="4695259">Prog</span><span class="op" id="4695263">,</span>&nbsp;<span class="builtintype" id="4695265">int</span><span class="op" id="4695268">)</span>&nbsp;<span class="builtintype" id="4695270">bool</span><span class="op" id="4695274">)</span>&nbsp;<span class="op" id="4695276">(</span><span class="ident" id="4695277">matches</span>&nbsp;<span class="op" id="4695285">[</span><span class="op" id="4695286">]</span><span class="builtintype" id="4695287">uint32</span><span class="op" id="4695293">)</span>&nbsp;<span class="op" id="4695295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695298"><a href="/regexp/onepass.go.html#4695277">matches</a></span>&nbsp;<span class="op" id="4695306">=</span>&nbsp;<span class="op" id="4695308">[</span><span class="op" id="4695309">]</span><span class="builtintype" id="4695310">uint32</span><span class="op" id="4695316">{</span><span class="op" id="4695317">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695321">for</span>&nbsp;<span class="ident" id="4695325">ip</span>&nbsp;<span class="op" id="4695328">:=</span>&nbsp;<span class="keyword" id="4695331">range</span>&nbsp;<span class="ident" id="4695337"><a href="/regexp/onepass.go.html#4695225">prog</a></span><span class="op" id="4695341">.</span><span class="ident" id="4695342">Inst</span>&nbsp;<span class="op" id="4695347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695351">if</span>&nbsp;<span class="ident" id="4695354"><a href="/regexp/onepass.go.html#4695244">f</a></span><span class="op" id="4695355">(</span><span class="ident" id="4695356"><a href="/regexp/onepass.go.html#4695225">prog</a></span><span class="op" id="4695360">,</span>&nbsp;<span class="ident" id="4695362"><a href="/regexp/onepass.go.html#4695325">ip</a></span><span class="op" id="4695364">)</span>&nbsp;<span class="op" id="4695366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4695371"><a href="/regexp/onepass.go.html#4695277">matches</a></span>&nbsp;<span class="op" id="4695379">=</span>&nbsp;<span class="builtinfunc" id="4695381">append</span><span class="op" id="4695387">(</span><span class="ident" id="4695388"><a href="/regexp/onepass.go.html#4695277">matches</a></span><span class="op" id="4695395">,</span>&nbsp;<span class="builtintype" id="4695397">uint32</span><span class="op" id="4695403">(</span><span class="ident" id="4695404"><a href="/regexp/onepass.go.html#4695325">ip</a></span><span class="op" id="4695406">)</span><span class="op" id="4695407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695411">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695417">return</span><br>
<span class="lineno"></span><span class="op" id="4695424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4695427">var</span>&nbsp;<span class="ident" id="4695431">notOnePass</span>&nbsp;<span class="op" id="4695442">*</span><span class="ident" id="4695443"><a href="/regexp/onepass.go.html#4681445">onePassProg</a></span>&nbsp;<span class="op" id="4695455">=</span>&nbsp;<span class="ident" id="4695457">nil</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="4695462">//&nbsp;compileOnePass&nbsp;returns&nbsp;a&nbsp;new&nbsp;*syntax.Prog&nbsp;suitable&nbsp;for&nbsp;onePass&nbsp;execution&nbsp;if&nbsp;the&nbsp;original&nbsp;Prog</span><br>
<span class="lineno"></span><span class="comment" id="4695559">//&nbsp;can&nbsp;be&nbsp;recharacterized&nbsp;as&nbsp;a&nbsp;one-pass&nbsp;regexp&nbsp;program,&nbsp;or&nbsp;syntax.notOnePass&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4695643">//&nbsp;Prog&nbsp;cannot&nbsp;be&nbsp;converted.&nbsp;For&nbsp;a&nbsp;one&nbsp;pass&nbsp;prog,&nbsp;the&nbsp;fundamental&nbsp;condition&nbsp;that&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4695729">//&nbsp;be&nbsp;true&nbsp;is:&nbsp;at&nbsp;any&nbsp;InstAlt,&nbsp;there&nbsp;must&nbsp;be&nbsp;no&nbsp;ambiguity&nbsp;about&nbsp;what&nbsp;branch&nbsp;to&nbsp;&nbsp;take.</span><br>
<span class="lineno">540</span><span class="keyword" id="4695815">func</span>&nbsp;<span class="ident" id="4695820">compileOnePass</span><span class="op" id="4695834">(</span><span class="ident" id="4695835">prog</span>&nbsp;<span class="op" id="4695840">*</span><span class="ident" id="4695841"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4695847">.</span><span class="ident" id="4695848">Prog</span><span class="op" id="4695852">)</span>&nbsp;<span class="op" id="4695854">(</span><span class="ident" id="4695855">p</span>&nbsp;<span class="op" id="4695857">*</span><span class="ident" id="4695858"><a href="/regexp/onepass.go.html#4681445">onePassProg</a></span><span class="op" id="4695869">)</span>&nbsp;<span class="op" id="4695871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695874">if</span>&nbsp;<span class="ident" id="4695877"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4695881">.</span><span class="ident" id="4695882">Start</span>&nbsp;<span class="op" id="4695888">==</span>&nbsp;<span class="num" id="4695891">0</span>&nbsp;<span class="op" id="4695893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695897">return</span>&nbsp;<span class="ident" id="4695904"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4695916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4695919">//&nbsp;onepass&nbsp;regexp&nbsp;is&nbsp;anchored</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695950">if</span>&nbsp;<span class="ident" id="4695953"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4695957">.</span><span class="ident" id="4695958">Inst</span><span class="op" id="4695962">[</span><span class="ident" id="4695963"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4695967">.</span><span class="ident" id="4695968">Start</span><span class="op" id="4695973">]</span><span class="op" id="4695974">.</span><span class="ident" id="4695975">Op</span>&nbsp;<span class="op" id="4695978">!=</span>&nbsp;<span class="ident" id="4695981"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4695987">.</span><span class="ident" id="4695988">InstEmptyWidth</span>&nbsp;<span class="op" id="4696003">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696008"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696014">.</span><span class="ident" id="4696015">EmptyOp</span><span class="op" id="4696022">(</span><span class="ident" id="4696023"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4696027">.</span><span class="ident" id="4696028">Inst</span><span class="op" id="4696032">[</span><span class="ident" id="4696033"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4696037">.</span><span class="ident" id="4696038">Start</span><span class="op" id="4696043">]</span><span class="op" id="4696044">.</span><span class="ident" id="4696045">Arg</span><span class="op" id="4696048">)</span><span class="op" id="4696049">&amp;</span><span class="ident" id="4696050"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696056">.</span><span class="ident" id="4696057">EmptyBeginText</span>&nbsp;<span class="op" id="4696072">!=</span>&nbsp;<span class="ident" id="4696075"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696081">.</span><span class="ident" id="4696082">EmptyBeginText</span>&nbsp;<span class="op" id="4696097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696101">return</span>&nbsp;<span class="ident" id="4696108"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4696123">//&nbsp;every&nbsp;instruction&nbsp;leading&nbsp;to&nbsp;InstMatch&nbsp;must&nbsp;be&nbsp;EmptyEndText</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696187">for</span>&nbsp;<span class="ident" id="4696191">_</span><span class="op" id="4696192">,</span>&nbsp;<span class="ident" id="4696194">inst</span>&nbsp;<span class="op" id="4696199">:=</span>&nbsp;<span class="keyword" id="4696202">range</span>&nbsp;<span class="ident" id="4696208"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4696212">.</span><span class="ident" id="4696213">Inst</span>&nbsp;<span class="op" id="4696218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696222">opOut</span>&nbsp;<span class="op" id="4696228">:=</span>&nbsp;<span class="ident" id="4696231"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4696235">.</span><span class="ident" id="4696236">Inst</span><span class="op" id="4696240">[</span><span class="ident" id="4696241"><a href="/regexp/onepass.go.html#4696194">inst</a></span><span class="op" id="4696245">.</span><span class="ident" id="4696246">Out</span><span class="op" id="4696249">]</span><span class="op" id="4696250">.</span><span class="ident" id="4696251">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696256">switch</span>&nbsp;<span class="ident" id="4696263"><a href="/regexp/onepass.go.html#4696194">inst</a></span><span class="op" id="4696267">.</span><span class="ident" id="4696268">Op</span>&nbsp;<span class="op" id="4696271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696275">default</span><span class="op" id="4696282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696287">if</span>&nbsp;<span class="ident" id="4696290"><a href="/regexp/onepass.go.html#4696222">opOut</a></span>&nbsp;<span class="op" id="4696296">==</span>&nbsp;<span class="ident" id="4696299"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696305">.</span><span class="ident" id="4696306">InstMatch</span>&nbsp;<span class="op" id="4696316">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696322">return</span>&nbsp;<span class="ident" id="4696329"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696347">case</span>&nbsp;<span class="ident" id="4696352"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696358">.</span><span class="ident" id="4696359">InstAlt</span><span class="op" id="4696366">,</span>&nbsp;<span class="ident" id="4696368"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696374">.</span><span class="ident" id="4696375">InstAltMatch</span><span class="op" id="4696387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696392">if</span>&nbsp;<span class="ident" id="4696395"><a href="/regexp/onepass.go.html#4696222">opOut</a></span>&nbsp;<span class="op" id="4696401">==</span>&nbsp;<span class="ident" id="4696404"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696410">.</span><span class="ident" id="4696411">InstMatch</span>&nbsp;<span class="op" id="4696421">||</span>&nbsp;<span class="ident" id="4696424"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4696428">.</span><span class="ident" id="4696429">Inst</span><span class="op" id="4696433">[</span><span class="ident" id="4696434"><a href="/regexp/onepass.go.html#4696194">inst</a></span><span class="op" id="4696438">.</span><span class="ident" id="4696439">Arg</span><span class="op" id="4696442">]</span><span class="op" id="4696443">.</span><span class="ident" id="4696444">Op</span>&nbsp;<span class="op" id="4696447">==</span>&nbsp;<span class="ident" id="4696450"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696456">.</span><span class="ident" id="4696457">InstMatch</span>&nbsp;<span class="op" id="4696467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696473">return</span>&nbsp;<span class="ident" id="4696480"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696498">case</span>&nbsp;<span class="ident" id="4696503"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696509">.</span><span class="ident" id="4696510">InstEmptyWidth</span><span class="op" id="4696524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696529">if</span>&nbsp;<span class="ident" id="4696532"><a href="/regexp/onepass.go.html#4696222">opOut</a></span>&nbsp;<span class="op" id="4696538">==</span>&nbsp;<span class="ident" id="4696541"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696547">.</span><span class="ident" id="4696548">InstMatch</span>&nbsp;<span class="op" id="4696558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696564">if</span>&nbsp;<span class="ident" id="4696567"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696573">.</span><span class="ident" id="4696574">EmptyOp</span><span class="op" id="4696581">(</span><span class="ident" id="4696582"><a href="/regexp/onepass.go.html#4696194">inst</a></span><span class="op" id="4696586">.</span><span class="ident" id="4696587">Arg</span><span class="op" id="4696590">)</span><span class="op" id="4696591">&amp;</span><span class="ident" id="4696592"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696598">.</span><span class="ident" id="4696599">EmptyEndText</span>&nbsp;<span class="op" id="4696612">==</span>&nbsp;<span class="ident" id="4696615"><a href="/regexp/onepass.go.html#4680994">syntax</a></span><span class="op" id="4696621">.</span><span class="ident" id="4696622">EmptyEndText</span>&nbsp;<span class="op" id="4696635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696642">continue</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696661">return</span>&nbsp;<span class="ident" id="4696668"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696689">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4696692">//&nbsp;Creates&nbsp;a&nbsp;slightly&nbsp;optimized&nbsp;copy&nbsp;of&nbsp;the&nbsp;original&nbsp;Prog</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4696751">//&nbsp;that&nbsp;cleans&nbsp;up&nbsp;some&nbsp;Prog&nbsp;idioms&nbsp;that&nbsp;block&nbsp;valid&nbsp;onepass&nbsp;programs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696821"><a href="/regexp/onepass.go.html#4695855">p</a></span>&nbsp;<span class="op" id="4696823">=</span>&nbsp;<span class="ident" id="4696825"><a href="/regexp/onepass.go.html#4686827">onePassCopy</a></span><span class="op" id="4696836">(</span><span class="ident" id="4696837"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4696841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4696845">//&nbsp;checkAmbiguity&nbsp;on&nbsp;InstAlts,&nbsp;build&nbsp;onepass&nbsp;Prog&nbsp;if&nbsp;possible</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696908"><a href="/regexp/onepass.go.html#4695855">p</a></span>&nbsp;<span class="op" id="4696910">=</span>&nbsp;<span class="ident" id="4696912"><a href="/regexp/onepass.go.html#4689350">makeOnePass</a></span><span class="op" id="4696923">(</span><span class="ident" id="4696924"><a href="/regexp/onepass.go.html#4695855">p</a></span><span class="op" id="4696925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696929">if</span>&nbsp;<span class="ident" id="4696932"><a href="/regexp/onepass.go.html#4695855">p</a></span>&nbsp;<span class="op" id="4696934">!=</span>&nbsp;<span class="ident" id="4696937"><a href="/regexp/onepass.go.html#4695431">notOnePass</a></span>&nbsp;<span class="op" id="4696948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696952"><a href="/regexp/onepass.go.html#4686263">cleanupOnePass</a></span><span class="op" id="4696966">(</span><span class="ident" id="4696967"><a href="/regexp/onepass.go.html#4695855">p</a></span><span class="op" id="4696968">,</span>&nbsp;<span class="ident" id="4696970"><a href="/regexp/onepass.go.html#4695835">prog</a></span><span class="op" id="4696974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4696977">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696980">return</span>&nbsp;<span class="ident" id="4696987"><a href="/regexp/onepass.go.html#4695855">p</a></span><br>
<span class="lineno"></span><span class="op" id="4696989">}</span>
</div>
</body>
</html>
