<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2183601">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2183656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2183710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2183761">package</span>&nbsp;<span class="ident" id="2183769">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2183773">import</span>&nbsp;<span class="string" id="2183780">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2183791">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2183874">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2183920">func</span>&nbsp;<span class="ident" id="2183925">Pipe</span><span class="op" id="2183929">(</span><span class="op" id="2183930">)</span>&nbsp;<span class="op" id="2183932">(</span><span class="ident" id="2183933">r</span>&nbsp;<span class="op" id="2183935">*</span><span class="ident" id="2183936">File</span><span class="op" id="2183940">,</span>&nbsp;<span class="ident" id="2183942">w</span>&nbsp;<span class="op" id="2183944">*</span><span class="ident" id="2183945">File</span><span class="op" id="2183949">,</span>&nbsp;<span class="ident" id="2183951">err</span>&nbsp;<span class="builtintype" id="2183955">error</span><span class="op" id="2183960">)</span>&nbsp;<span class="op" id="2183962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2183965">var</span>&nbsp;<span class="ident" id="2183969">p</span>&nbsp;<span class="op" id="2183971">[</span><span class="num" id="2183972">2</span><span class="op" id="2183973">]</span><span class="builtintype" id="2183974">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183980">e</span>&nbsp;<span class="op" id="2183982">:=</span>&nbsp;<span class="ident" id="2183985">syscall</span><span class="op" id="2183992">.</span><span class="ident" id="2183993">Pipe2</span><span class="op" id="2183998">(</span><span class="ident" id="2183999">p</span><span class="op" id="2184000">[</span><span class="num" id="2184001">0</span><span class="op" id="2184002">:</span><span class="op" id="2184003">]</span><span class="op" id="2184004">,</span>&nbsp;<span class="ident" id="2184006">syscall</span><span class="op" id="2184013">.</span><span class="ident" id="2184014">O_CLOEXEC</span><span class="op" id="2184023">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184026">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184101">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184131">if</span>&nbsp;<span class="ident" id="2184134">e</span>&nbsp;<span class="op" id="2184136">==</span>&nbsp;<span class="ident" id="2184139">syscall</span><span class="op" id="2184146">.</span><span class="ident" id="2184147">ENOSYS</span>&nbsp;<span class="op" id="2184154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184158">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184211">syscall</span><span class="op" id="2184218">.</span><span class="ident" id="2184219">ForkLock</span><span class="op" id="2184227">.</span><span class="ident" id="2184228">RLock</span><span class="op" id="2184233">(</span><span class="op" id="2184234">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184238">e</span>&nbsp;<span class="op" id="2184240">=</span>&nbsp;<span class="ident" id="2184242">syscall</span><span class="op" id="2184249">.</span><span class="ident" id="2184250">Pipe</span><span class="op" id="2184254">(</span><span class="ident" id="2184255">p</span><span class="op" id="2184256">[</span><span class="num" id="2184257">0</span><span class="op" id="2184258">:</span><span class="op" id="2184259">]</span><span class="op" id="2184260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184264">if</span>&nbsp;<span class="ident" id="2184267">e</span>&nbsp;<span class="op" id="2184269">!=</span>&nbsp;<span class="ident" id="2184272">nil</span>&nbsp;<span class="op" id="2184276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184281">syscall</span><span class="op" id="2184288">.</span><span class="ident" id="2184289">ForkLock</span><span class="op" id="2184297">.</span><span class="ident" id="2184298">RUnlock</span><span class="op" id="2184305">(</span><span class="op" id="2184306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184311">return</span>&nbsp;<span class="ident" id="2184318">nil</span><span class="op" id="2184321">,</span>&nbsp;<span class="ident" id="2184323">nil</span><span class="op" id="2184326">,</span>&nbsp;<span class="ident" id="2184328">NewSyscallError</span><span class="op" id="2184343">(</span><span class="string" id="2184344">&#34;pipe&#34;</span><span class="op" id="2184350">,</span>&nbsp;<span class="ident" id="2184352">e</span><span class="op" id="2184353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184357">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184361">syscall</span><span class="op" id="2184368">.</span><span class="ident" id="2184369">CloseOnExec</span><span class="op" id="2184380">(</span><span class="ident" id="2184381">p</span><span class="op" id="2184382">[</span><span class="num" id="2184383">0</span><span class="op" id="2184384">]</span><span class="op" id="2184385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184389">syscall</span><span class="op" id="2184396">.</span><span class="ident" id="2184397">CloseOnExec</span><span class="op" id="2184408">(</span><span class="ident" id="2184409">p</span><span class="op" id="2184410">[</span><span class="num" id="2184411">1</span><span class="op" id="2184412">]</span><span class="op" id="2184413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184417">syscall</span><span class="op" id="2184424">.</span><span class="ident" id="2184425">ForkLock</span><span class="op" id="2184433">.</span><span class="ident" id="2184434">RUnlock</span><span class="op" id="2184441">(</span><span class="op" id="2184442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184445">}</span>&nbsp;<span class="keyword" id="2184447">else</span>&nbsp;<span class="keyword" id="2184452">if</span>&nbsp;<span class="ident" id="2184455">e</span>&nbsp;<span class="op" id="2184457">!=</span>&nbsp;<span class="ident" id="2184460">nil</span>&nbsp;<span class="op" id="2184464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184468">return</span>&nbsp;<span class="ident" id="2184475">nil</span><span class="op" id="2184478">,</span>&nbsp;<span class="ident" id="2184480">nil</span><span class="op" id="2184483">,</span>&nbsp;<span class="ident" id="2184485">NewSyscallError</span><span class="op" id="2184500">(</span><span class="string" id="2184501">&#34;pipe2&#34;</span><span class="op" id="2184508">,</span>&nbsp;<span class="ident" id="2184510">e</span><span class="op" id="2184511">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184518">return</span>&nbsp;<span class="ident" id="2184525">NewFile</span><span class="op" id="2184532">(</span><span class="builtintype" id="2184533">uintptr</span><span class="op" id="2184540">(</span><span class="ident" id="2184541">p</span><span class="op" id="2184542">[</span><span class="num" id="2184543">0</span><span class="op" id="2184544">]</span><span class="op" id="2184545">)</span><span class="op" id="2184546">,</span>&nbsp;<span class="string" id="2184548">&#34;|0&#34;</span><span class="op" id="2184552">)</span><span class="op" id="2184553">,</span>&nbsp;<span class="ident" id="2184555">NewFile</span><span class="op" id="2184562">(</span><span class="builtintype" id="2184563">uintptr</span><span class="op" id="2184570">(</span><span class="ident" id="2184571">p</span><span class="op" id="2184572">[</span><span class="num" id="2184573">1</span><span class="op" id="2184574">]</span><span class="op" id="2184575">)</span><span class="op" id="2184576">,</span>&nbsp;<span class="string" id="2184578">&#34;|1&#34;</span><span class="op" id="2184582">)</span><span class="op" id="2184583">,</span>&nbsp;<span class="ident" id="2184585">nil</span><br>
<span class="lineno"></span><span class="op" id="2184589">}</span>
</div>
</body>
</html>
