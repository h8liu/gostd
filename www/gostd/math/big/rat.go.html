<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3703539">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3703594">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3703648">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3703699">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3703758">package</span>&nbsp;<span class="ident" id="3703766">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3703771">import</span>&nbsp;<span class="op" id="3703778">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703781">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703800">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703810">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703817">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703825">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3703835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3703838">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="3703897">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3703949">type</span>&nbsp;<span class="ident" id="3703954">Rat</span>&nbsp;<span class="keyword" id="3703958">struct</span>&nbsp;<span class="op" id="3703965">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703968">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704025">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704079">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704139">a</span><span class="op" id="3704140">,</span>&nbsp;<span class="ident" id="3704142">b</span>&nbsp;<span class="ident" id="3704144">Int</span><br>
<span class="lineno"></span><span class="op" id="3704148">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3704151">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3704215">func</span>&nbsp;<span class="ident" id="3704220">NewRat</span><span class="op" id="3704226">(</span><span class="ident" id="3704227">a</span><span class="op" id="3704228">,</span>&nbsp;<span class="ident" id="3704230">b</span>&nbsp;<span class="ident" id="3704232">int64</span><span class="op" id="3704237">)</span>&nbsp;<span class="op" id="3704239">*</span><span class="ident" id="3704240">Rat</span>&nbsp;<span class="op" id="3704244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704247">return</span>&nbsp;<span class="builtinfunc" id="3704254">new</span><span class="op" id="3704257">(</span><span class="ident" id="3704258">Rat</span><span class="op" id="3704261">)</span><span class="op" id="3704262">.</span><span class="ident" id="3704263">SetFrac64</span><span class="op" id="3704272">(</span><span class="ident" id="3704273">a</span><span class="op" id="3704274">,</span>&nbsp;<span class="ident" id="3704276">b</span><span class="op" id="3704277">)</span><br>
<span class="lineno"></span><span class="op" id="3704279">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3704282">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3704331">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3704376">func</span>&nbsp;<span class="op" id="3704381">(</span><span class="ident" id="3704382">z</span>&nbsp;<span class="op" id="3704384">*</span><span class="ident" id="3704385">Rat</span><span class="op" id="3704388">)</span>&nbsp;<span class="ident" id="3704390">SetFloat64</span><span class="op" id="3704400">(</span><span class="ident" id="3704401">f</span>&nbsp;<span class="builtintype" id="3704403">float64</span><span class="op" id="3704410">)</span>&nbsp;<span class="op" id="3704412">*</span><span class="ident" id="3704413">Rat</span>&nbsp;<span class="op" id="3704417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704420">const</span>&nbsp;<span class="ident" id="3704426">expMask</span>&nbsp;<span class="op" id="3704434">=</span>&nbsp;<span class="num" id="3704436">1</span><span class="op" id="3704437">&lt;&lt;</span><span class="num" id="3704439">11</span>&nbsp;<span class="op" id="3704442">-</span>&nbsp;<span class="num" id="3704444">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704447">bits</span>&nbsp;<span class="op" id="3704452">:=</span>&nbsp;<span class="ident" id="3704455">math</span><span class="op" id="3704459">.</span><span class="ident" id="3704460">Float64bits</span><span class="op" id="3704471">(</span><span class="ident" id="3704472">f</span><span class="op" id="3704473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704476">mantissa</span>&nbsp;<span class="op" id="3704485">:=</span>&nbsp;<span class="ident" id="3704488">bits</span>&nbsp;<span class="op" id="3704493">&amp;</span>&nbsp;<span class="op" id="3704495">(</span><span class="num" id="3704496">1</span><span class="op" id="3704497">&lt;&lt;</span><span class="num" id="3704499">52</span>&nbsp;<span class="op" id="3704502">-</span>&nbsp;<span class="num" id="3704504">1</span><span class="op" id="3704505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704508">exp</span>&nbsp;<span class="op" id="3704512">:=</span>&nbsp;<span class="builtintype" id="3704515">int</span><span class="op" id="3704518">(</span><span class="op" id="3704519">(</span><span class="ident" id="3704520">bits</span>&nbsp;<span class="op" id="3704525">&gt;&gt;</span>&nbsp;<span class="num" id="3704528">52</span><span class="op" id="3704530">)</span>&nbsp;<span class="op" id="3704532">&amp;</span>&nbsp;<span class="ident" id="3704534">expMask</span><span class="op" id="3704541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704544">switch</span>&nbsp;<span class="ident" id="3704551">exp</span>&nbsp;<span class="op" id="3704555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704558">case</span>&nbsp;<span class="ident" id="3704563">expMask</span><span class="op" id="3704570">:</span>&nbsp;<span class="comment" id="3704572">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704588">return</span>&nbsp;<span class="ident" id="3704595">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704600">case</span>&nbsp;<span class="num" id="3704605">0</span><span class="op" id="3704606">:</span>&nbsp;<span class="comment" id="3704608">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704622">exp</span>&nbsp;<span class="op" id="3704626">-=</span>&nbsp;<span class="num" id="3704629">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704635">default</span><span class="op" id="3704642">:</span>&nbsp;<span class="comment" id="3704644">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704656">mantissa</span>&nbsp;<span class="op" id="3704665">|=</span>&nbsp;<span class="num" id="3704668">1</span>&nbsp;<span class="op" id="3704670">&lt;&lt;</span>&nbsp;<span class="num" id="3704673">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704678">exp</span>&nbsp;<span class="op" id="3704682">-=</span>&nbsp;<span class="num" id="3704685">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704695">shift</span>&nbsp;<span class="op" id="3704701">:=</span>&nbsp;<span class="num" id="3704704">52</span>&nbsp;<span class="op" id="3704707">-</span>&nbsp;<span class="ident" id="3704709">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704715">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704762">for</span>&nbsp;<span class="ident" id="3704766">mantissa</span><span class="op" id="3704774">&amp;</span><span class="num" id="3704775">1</span>&nbsp;<span class="op" id="3704777">==</span>&nbsp;<span class="num" id="3704780">0</span>&nbsp;<span class="op" id="3704782">&amp;&amp;</span>&nbsp;<span class="ident" id="3704785">shift</span>&nbsp;<span class="op" id="3704791">&gt;</span>&nbsp;<span class="num" id="3704793">0</span>&nbsp;<span class="op" id="3704795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704799">mantissa</span>&nbsp;<span class="op" id="3704808">&gt;&gt;=</span>&nbsp;<span class="num" id="3704812">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704816">shift</span><span class="op" id="3704821">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704825">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704829">z</span><span class="op" id="3704830">.</span><span class="ident" id="3704831">a</span><span class="op" id="3704832">.</span><span class="ident" id="3704833">SetUint64</span><span class="op" id="3704842">(</span><span class="ident" id="3704843">mantissa</span><span class="op" id="3704851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704854">z</span><span class="op" id="3704855">.</span><span class="ident" id="3704856">a</span><span class="op" id="3704857">.</span><span class="ident" id="3704858">neg</span>&nbsp;<span class="op" id="3704862">=</span>&nbsp;<span class="ident" id="3704864">f</span>&nbsp;<span class="op" id="3704866">&lt;</span>&nbsp;<span class="num" id="3704868">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704871">z</span><span class="op" id="3704872">.</span><span class="ident" id="3704873">b</span><span class="op" id="3704874">.</span><span class="ident" id="3704875">Set</span><span class="op" id="3704878">(</span><span class="ident" id="3704879">intOne</span><span class="op" id="3704885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704888">if</span>&nbsp;<span class="ident" id="3704891">shift</span>&nbsp;<span class="op" id="3704897">&gt;</span>&nbsp;<span class="num" id="3704899">0</span>&nbsp;<span class="op" id="3704901">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704905">z</span><span class="op" id="3704906">.</span><span class="ident" id="3704907">b</span><span class="op" id="3704908">.</span><span class="ident" id="3704909">Lsh</span><span class="op" id="3704912">(</span><span class="op" id="3704913">&amp;</span><span class="ident" id="3704914">z</span><span class="op" id="3704915">.</span><span class="ident" id="3704916">b</span><span class="op" id="3704917">,</span>&nbsp;<span class="builtintype" id="3704919">uint</span><span class="op" id="3704923">(</span><span class="ident" id="3704924">shift</span><span class="op" id="3704929">)</span><span class="op" id="3704930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704933">}</span>&nbsp;<span class="keyword" id="3704935">else</span>&nbsp;<span class="op" id="3704940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704944">z</span><span class="op" id="3704945">.</span><span class="ident" id="3704946">a</span><span class="op" id="3704947">.</span><span class="ident" id="3704948">Lsh</span><span class="op" id="3704951">(</span><span class="op" id="3704952">&amp;</span><span class="ident" id="3704953">z</span><span class="op" id="3704954">.</span><span class="ident" id="3704955">a</span><span class="op" id="3704956">,</span>&nbsp;<span class="builtintype" id="3704958">uint</span><span class="op" id="3704962">(</span><span class="op" id="3704963">-</span><span class="ident" id="3704964">shift</span><span class="op" id="3704969">)</span><span class="op" id="3704970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704976">return</span>&nbsp;<span class="ident" id="3704983">z</span><span class="op" id="3704984">.</span><span class="ident" id="3704985">norm</span><span class="op" id="3704989">(</span><span class="op" id="3704990">)</span><br>
<span class="lineno">65</span><span class="op" id="3704992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3704995">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3705051">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3705106">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="3705159">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3705224">func</span>&nbsp;<span class="ident" id="3705229">quotToFloat32</span><span class="op" id="3705242">(</span><span class="ident" id="3705243">a</span><span class="op" id="3705244">,</span>&nbsp;<span class="ident" id="3705246">b</span>&nbsp;<span class="ident" id="3705248">nat</span><span class="op" id="3705251">)</span>&nbsp;<span class="op" id="3705253">(</span><span class="ident" id="3705254">f</span>&nbsp;<span class="builtintype" id="3705256">float32</span><span class="op" id="3705263">,</span>&nbsp;<span class="ident" id="3705265">exact</span>&nbsp;<span class="builtintype" id="3705271">bool</span><span class="op" id="3705275">)</span>&nbsp;<span class="op" id="3705277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705280">const</span>&nbsp;<span class="op" id="3705286">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705290">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705314">Fsize</span>&nbsp;<span class="op" id="3705320">=</span>&nbsp;<span class="num" id="3705322">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705328">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705342">Msize</span>&nbsp;&nbsp;<span class="op" id="3705349">=</span>&nbsp;<span class="num" id="3705351">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705356">Msize1</span>&nbsp;<span class="op" id="3705363">=</span>&nbsp;<span class="ident" id="3705365">Msize</span>&nbsp;<span class="op" id="3705371">+</span>&nbsp;<span class="num" id="3705373">1</span>&nbsp;<span class="comment" id="3705375">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705397">Msize2</span>&nbsp;<span class="op" id="3705404">=</span>&nbsp;<span class="ident" id="3705406">Msize1</span>&nbsp;<span class="op" id="3705413">+</span>&nbsp;<span class="num" id="3705415">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705420">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705434">Esize</span>&nbsp;<span class="op" id="3705440">=</span>&nbsp;<span class="ident" id="3705442">Fsize</span>&nbsp;<span class="op" id="3705448">-</span>&nbsp;<span class="ident" id="3705450">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705459">Ebias</span>&nbsp;<span class="op" id="3705465">=</span>&nbsp;<span class="num" id="3705467">1</span><span class="op" id="3705468">&lt;&lt;</span><span class="op" id="3705470">(</span><span class="ident" id="3705471">Esize</span><span class="op" id="3705476">-</span><span class="num" id="3705477">1</span><span class="op" id="3705478">)</span>&nbsp;<span class="op" id="3705480">-</span>&nbsp;<span class="num" id="3705482">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705486">Emin</span>&nbsp;&nbsp;<span class="op" id="3705492">=</span>&nbsp;<span class="num" id="3705494">1</span>&nbsp;<span class="op" id="3705496">-</span>&nbsp;<span class="ident" id="3705498">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705506">Emax</span>&nbsp;&nbsp;<span class="op" id="3705512">=</span>&nbsp;<span class="ident" id="3705514">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705525">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705596">alen</span>&nbsp;<span class="op" id="3705601">:=</span>&nbsp;<span class="ident" id="3705604">a</span><span class="op" id="3705605">.</span><span class="ident" id="3705606">bitLen</span><span class="op" id="3705612">(</span><span class="op" id="3705613">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705616">if</span>&nbsp;<span class="ident" id="3705619">alen</span>&nbsp;<span class="op" id="3705624">==</span>&nbsp;<span class="num" id="3705627">0</span>&nbsp;<span class="op" id="3705629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705633">return</span>&nbsp;<span class="num" id="3705640">0</span><span class="op" id="3705641">,</span>&nbsp;<span class="builtintype" id="3705643">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705652">blen</span>&nbsp;<span class="op" id="3705657">:=</span>&nbsp;<span class="ident" id="3705660">b</span><span class="op" id="3705661">.</span><span class="ident" id="3705662">bitLen</span><span class="op" id="3705668">(</span><span class="op" id="3705669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705672">if</span>&nbsp;<span class="ident" id="3705675">blen</span>&nbsp;<span class="op" id="3705680">==</span>&nbsp;<span class="num" id="3705683">0</span>&nbsp;<span class="op" id="3705685">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3705689">panic</span><span class="op" id="3705694">(</span><span class="string" id="3705695">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3705713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705720">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705800">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705880">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705952">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706014">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706076">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706143">exp</span>&nbsp;<span class="op" id="3706147">:=</span>&nbsp;<span class="ident" id="3706150">alen</span>&nbsp;<span class="op" id="3706155">-</span>&nbsp;<span class="ident" id="3706157">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706163">var</span>&nbsp;<span class="ident" id="3706167">a2</span><span class="op" id="3706169">,</span>&nbsp;<span class="ident" id="3706171">b2</span>&nbsp;<span class="ident" id="3706174">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706179">a2</span>&nbsp;<span class="op" id="3706182">=</span>&nbsp;<span class="ident" id="3706184">a2</span><span class="op" id="3706186">.</span><span class="ident" id="3706187">set</span><span class="op" id="3706190">(</span><span class="ident" id="3706191">a</span><span class="op" id="3706192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706195">b2</span>&nbsp;<span class="op" id="3706198">=</span>&nbsp;<span class="ident" id="3706200">b2</span><span class="op" id="3706202">.</span><span class="ident" id="3706203">set</span><span class="op" id="3706206">(</span><span class="ident" id="3706207">b</span><span class="op" id="3706208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706211">if</span>&nbsp;<span class="ident" id="3706214">shift</span>&nbsp;<span class="op" id="3706220">:=</span>&nbsp;<span class="ident" id="3706223">Msize2</span>&nbsp;<span class="op" id="3706230">-</span>&nbsp;<span class="ident" id="3706232">exp</span><span class="op" id="3706235">;</span>&nbsp;<span class="ident" id="3706237">shift</span>&nbsp;<span class="op" id="3706243">&gt;</span>&nbsp;<span class="num" id="3706245">0</span>&nbsp;<span class="op" id="3706247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706251">a2</span>&nbsp;<span class="op" id="3706254">=</span>&nbsp;<span class="ident" id="3706256">a2</span><span class="op" id="3706258">.</span><span class="ident" id="3706259">shl</span><span class="op" id="3706262">(</span><span class="ident" id="3706263">a2</span><span class="op" id="3706265">,</span>&nbsp;<span class="builtintype" id="3706267">uint</span><span class="op" id="3706271">(</span><span class="ident" id="3706272">shift</span><span class="op" id="3706277">)</span><span class="op" id="3706278">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706281">}</span>&nbsp;<span class="keyword" id="3706283">else</span>&nbsp;<span class="keyword" id="3706288">if</span>&nbsp;<span class="ident" id="3706291">shift</span>&nbsp;<span class="op" id="3706297">&lt;</span>&nbsp;<span class="num" id="3706299">0</span>&nbsp;<span class="op" id="3706301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706305">b2</span>&nbsp;<span class="op" id="3706308">=</span>&nbsp;<span class="ident" id="3706310">b2</span><span class="op" id="3706312">.</span><span class="ident" id="3706313">shl</span><span class="op" id="3706316">(</span><span class="ident" id="3706317">b2</span><span class="op" id="3706319">,</span>&nbsp;<span class="builtintype" id="3706321">uint</span><span class="op" id="3706325">(</span><span class="op" id="3706326">-</span><span class="ident" id="3706327">shift</span><span class="op" id="3706332">)</span><span class="op" id="3706333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706340">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706402">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706459">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706484">var</span>&nbsp;<span class="ident" id="3706488">q</span>&nbsp;<span class="ident" id="3706490">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706495">q</span><span class="op" id="3706496">,</span>&nbsp;<span class="ident" id="3706498">r</span>&nbsp;<span class="op" id="3706500">:=</span>&nbsp;<span class="ident" id="3706503">q</span><span class="op" id="3706504">.</span><span class="ident" id="3706505">div</span><span class="op" id="3706508">(</span><span class="ident" id="3706509">a2</span><span class="op" id="3706511">,</span>&nbsp;<span class="ident" id="3706513">a2</span><span class="op" id="3706515">,</span>&nbsp;<span class="ident" id="3706517">b2</span><span class="op" id="3706519">)</span>&nbsp;<span class="comment" id="3706521">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706538">mantissa</span>&nbsp;<span class="op" id="3706547">:=</span>&nbsp;<span class="ident" id="3706550">low32</span><span class="op" id="3706555">(</span><span class="ident" id="3706556">q</span><span class="op" id="3706557">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706560">haveRem</span>&nbsp;<span class="op" id="3706568">:=</span>&nbsp;<span class="builtinfunc" id="3706571">len</span><span class="op" id="3706574">(</span><span class="ident" id="3706575">r</span><span class="op" id="3706576">)</span>&nbsp;<span class="op" id="3706578">&gt;</span>&nbsp;<span class="num" id="3706580">0</span>&nbsp;<span class="comment" id="3706582">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706639">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706708">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706760">if</span>&nbsp;<span class="ident" id="3706763">mantissa</span><span class="op" id="3706771">&gt;&gt;</span><span class="ident" id="3706773">Msize2</span>&nbsp;<span class="op" id="3706780">==</span>&nbsp;<span class="num" id="3706783">1</span>&nbsp;<span class="op" id="3706785">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706789">if</span>&nbsp;<span class="ident" id="3706792">mantissa</span><span class="op" id="3706800">&amp;</span><span class="num" id="3706801">1</span>&nbsp;<span class="op" id="3706803">==</span>&nbsp;<span class="num" id="3706806">1</span>&nbsp;<span class="op" id="3706808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706813">haveRem</span>&nbsp;<span class="op" id="3706821">=</span>&nbsp;<span class="builtintype" id="3706823">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706834">mantissa</span>&nbsp;<span class="op" id="3706843">&gt;&gt;=</span>&nbsp;<span class="num" id="3706847">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706851">exp</span><span class="op" id="3706854">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706861">if</span>&nbsp;<span class="ident" id="3706864">mantissa</span><span class="op" id="3706872">&gt;&gt;</span><span class="ident" id="3706874">Msize1</span>&nbsp;<span class="op" id="3706881">!=</span>&nbsp;<span class="num" id="3706884">1</span>&nbsp;<span class="op" id="3706886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3706890">panic</span><span class="op" id="3706895">(</span><span class="ident" id="3706896">fmt</span><span class="op" id="3706899">.</span><span class="ident" id="3706900">Sprintf</span><span class="op" id="3706907">(</span><span class="string" id="3706908">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3706944">,</span>&nbsp;<span class="ident" id="3706946">Msize2</span><span class="op" id="3706952">)</span><span class="op" id="3706953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706960">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706977">if</span>&nbsp;<span class="ident" id="3706980">Emin</span><span class="op" id="3706984">-</span><span class="ident" id="3706985">Msize</span>&nbsp;<span class="op" id="3706991">&lt;=</span>&nbsp;<span class="ident" id="3706994">exp</span>&nbsp;<span class="op" id="3706998">&amp;&amp;</span>&nbsp;<span class="ident" id="3707001">exp</span>&nbsp;<span class="op" id="3707005">&lt;=</span>&nbsp;<span class="ident" id="3707008">Emin</span>&nbsp;<span class="op" id="3707013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707017">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707069">shift</span>&nbsp;<span class="op" id="3707075">:=</span>&nbsp;<span class="builtintype" id="3707078">uint</span><span class="op" id="3707082">(</span><span class="ident" id="3707083">Emin</span>&nbsp;<span class="op" id="3707088">-</span>&nbsp;<span class="op" id="3707090">(</span><span class="ident" id="3707091">exp</span>&nbsp;<span class="op" id="3707095">-</span>&nbsp;<span class="num" id="3707097">1</span><span class="op" id="3707098">)</span><span class="op" id="3707099">)</span>&nbsp;<span class="comment" id="3707101">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707118">lostbits</span>&nbsp;<span class="op" id="3707127">:=</span>&nbsp;<span class="ident" id="3707130">mantissa</span>&nbsp;<span class="op" id="3707139">&amp;</span>&nbsp;<span class="op" id="3707141">(</span><span class="num" id="3707142">1</span><span class="op" id="3707143">&lt;&lt;</span><span class="ident" id="3707145">shift</span>&nbsp;<span class="op" id="3707151">-</span>&nbsp;<span class="num" id="3707153">1</span><span class="op" id="3707154">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707158">haveRem</span>&nbsp;<span class="op" id="3707166">=</span>&nbsp;<span class="ident" id="3707168">haveRem</span>&nbsp;<span class="op" id="3707176">||</span>&nbsp;<span class="ident" id="3707179">lostbits</span>&nbsp;<span class="op" id="3707188">!=</span>&nbsp;<span class="num" id="3707191">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707195">mantissa</span>&nbsp;<span class="op" id="3707204">&gt;&gt;=</span>&nbsp;<span class="ident" id="3707208">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707216">exp</span>&nbsp;<span class="op" id="3707220">=</span>&nbsp;<span class="num" id="3707222">2</span>&nbsp;<span class="op" id="3707224">-</span>&nbsp;<span class="ident" id="3707226">Ebias</span>&nbsp;<span class="comment" id="3707232">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707254">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707292">exact</span>&nbsp;<span class="op" id="3707298">=</span>&nbsp;<span class="op" id="3707300">!</span><span class="ident" id="3707301">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707310">if</span>&nbsp;<span class="ident" id="3707313">mantissa</span><span class="op" id="3707321">&amp;</span><span class="num" id="3707322">1</span>&nbsp;<span class="op" id="3707324">!=</span>&nbsp;<span class="num" id="3707327">0</span>&nbsp;<span class="op" id="3707329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707333">exact</span>&nbsp;<span class="op" id="3707339">=</span>&nbsp;<span class="builtintype" id="3707341">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707349">if</span>&nbsp;<span class="ident" id="3707352">haveRem</span>&nbsp;<span class="op" id="3707360">||</span>&nbsp;<span class="ident" id="3707363">mantissa</span><span class="op" id="3707371">&amp;</span><span class="num" id="3707372">2</span>&nbsp;<span class="op" id="3707374">!=</span>&nbsp;<span class="num" id="3707377">0</span>&nbsp;<span class="op" id="3707379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707384">if</span>&nbsp;<span class="ident" id="3707387">mantissa</span><span class="op" id="3707395">++</span><span class="op" id="3707397">;</span>&nbsp;<span class="ident" id="3707399">mantissa</span>&nbsp;<span class="op" id="3707408">&gt;=</span>&nbsp;<span class="num" id="3707411">1</span><span class="op" id="3707412">&lt;&lt;</span><span class="ident" id="3707414">Msize2</span>&nbsp;<span class="op" id="3707421">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707427">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707488">mantissa</span>&nbsp;<span class="op" id="3707497">&gt;&gt;=</span>&nbsp;<span class="num" id="3707501">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707507">exp</span><span class="op" id="3707510">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707520">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707526">mantissa</span>&nbsp;<span class="op" id="3707535">&gt;&gt;=</span>&nbsp;<span class="num" id="3707539">1</span>&nbsp;<span class="comment" id="3707541">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707603">f</span>&nbsp;<span class="op" id="3707605">=</span>&nbsp;<span class="builtintype" id="3707607">float32</span><span class="op" id="3707614">(</span><span class="ident" id="3707615">math</span><span class="op" id="3707619">.</span><span class="ident" id="3707620">Ldexp</span><span class="op" id="3707625">(</span><span class="builtintype" id="3707626">float64</span><span class="op" id="3707633">(</span><span class="ident" id="3707634">mantissa</span><span class="op" id="3707642">)</span><span class="op" id="3707643">,</span>&nbsp;<span class="ident" id="3707645">exp</span><span class="op" id="3707648">-</span><span class="ident" id="3707649">Msize1</span><span class="op" id="3707655">)</span><span class="op" id="3707656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707659">if</span>&nbsp;<span class="ident" id="3707662">math</span><span class="op" id="3707666">.</span><span class="ident" id="3707667">IsInf</span><span class="op" id="3707672">(</span><span class="builtintype" id="3707673">float64</span><span class="op" id="3707680">(</span><span class="ident" id="3707681">f</span><span class="op" id="3707682">)</span><span class="op" id="3707683">,</span>&nbsp;<span class="num" id="3707685">0</span><span class="op" id="3707686">)</span>&nbsp;<span class="op" id="3707688">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707692">exact</span>&nbsp;<span class="op" id="3707698">=</span>&nbsp;<span class="builtintype" id="3707700">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707710">return</span><br>
<span class="lineno"></span><span class="op" id="3707717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3707720">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3707776">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3707831">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3707884">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3707949">func</span>&nbsp;<span class="ident" id="3707954">quotToFloat64</span><span class="op" id="3707967">(</span><span class="ident" id="3707968">a</span><span class="op" id="3707969">,</span>&nbsp;<span class="ident" id="3707971">b</span>&nbsp;<span class="ident" id="3707973">nat</span><span class="op" id="3707976">)</span>&nbsp;<span class="op" id="3707978">(</span><span class="ident" id="3707979">f</span>&nbsp;<span class="builtintype" id="3707981">float64</span><span class="op" id="3707988">,</span>&nbsp;<span class="ident" id="3707990">exact</span>&nbsp;<span class="builtintype" id="3707996">bool</span><span class="op" id="3708000">)</span>&nbsp;<span class="op" id="3708002">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708005">const</span>&nbsp;<span class="op" id="3708011">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708015">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708039">Fsize</span>&nbsp;<span class="op" id="3708045">=</span>&nbsp;<span class="num" id="3708047">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708053">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708067">Msize</span>&nbsp;&nbsp;<span class="op" id="3708074">=</span>&nbsp;<span class="num" id="3708076">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708081">Msize1</span>&nbsp;<span class="op" id="3708088">=</span>&nbsp;<span class="ident" id="3708090">Msize</span>&nbsp;<span class="op" id="3708096">+</span>&nbsp;<span class="num" id="3708098">1</span>&nbsp;<span class="comment" id="3708100">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708122">Msize2</span>&nbsp;<span class="op" id="3708129">=</span>&nbsp;<span class="ident" id="3708131">Msize1</span>&nbsp;<span class="op" id="3708138">+</span>&nbsp;<span class="num" id="3708140">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708145">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708159">Esize</span>&nbsp;<span class="op" id="3708165">=</span>&nbsp;<span class="ident" id="3708167">Fsize</span>&nbsp;<span class="op" id="3708173">-</span>&nbsp;<span class="ident" id="3708175">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708184">Ebias</span>&nbsp;<span class="op" id="3708190">=</span>&nbsp;<span class="num" id="3708192">1</span><span class="op" id="3708193">&lt;&lt;</span><span class="op" id="3708195">(</span><span class="ident" id="3708196">Esize</span><span class="op" id="3708201">-</span><span class="num" id="3708202">1</span><span class="op" id="3708203">)</span>&nbsp;<span class="op" id="3708205">-</span>&nbsp;<span class="num" id="3708207">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708211">Emin</span>&nbsp;&nbsp;<span class="op" id="3708217">=</span>&nbsp;<span class="num" id="3708219">1</span>&nbsp;<span class="op" id="3708221">-</span>&nbsp;<span class="ident" id="3708223">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708231">Emax</span>&nbsp;&nbsp;<span class="op" id="3708237">=</span>&nbsp;<span class="ident" id="3708239">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708246">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708250">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708321">alen</span>&nbsp;<span class="op" id="3708326">:=</span>&nbsp;<span class="ident" id="3708329">a</span><span class="op" id="3708330">.</span><span class="ident" id="3708331">bitLen</span><span class="op" id="3708337">(</span><span class="op" id="3708338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708341">if</span>&nbsp;<span class="ident" id="3708344">alen</span>&nbsp;<span class="op" id="3708349">==</span>&nbsp;<span class="num" id="3708352">0</span>&nbsp;<span class="op" id="3708354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708358">return</span>&nbsp;<span class="num" id="3708365">0</span><span class="op" id="3708366">,</span>&nbsp;<span class="builtintype" id="3708368">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708377">blen</span>&nbsp;<span class="op" id="3708382">:=</span>&nbsp;<span class="ident" id="3708385">b</span><span class="op" id="3708386">.</span><span class="ident" id="3708387">bitLen</span><span class="op" id="3708393">(</span><span class="op" id="3708394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708397">if</span>&nbsp;<span class="ident" id="3708400">blen</span>&nbsp;<span class="op" id="3708405">==</span>&nbsp;<span class="num" id="3708408">0</span>&nbsp;<span class="op" id="3708410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3708414">panic</span><span class="op" id="3708419">(</span><span class="string" id="3708420">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3708438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708441">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708445">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708525">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708605">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708677">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708739">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708801">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708868">exp</span>&nbsp;<span class="op" id="3708872">:=</span>&nbsp;<span class="ident" id="3708875">alen</span>&nbsp;<span class="op" id="3708880">-</span>&nbsp;<span class="ident" id="3708882">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708888">var</span>&nbsp;<span class="ident" id="3708892">a2</span><span class="op" id="3708894">,</span>&nbsp;<span class="ident" id="3708896">b2</span>&nbsp;<span class="ident" id="3708899">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708904">a2</span>&nbsp;<span class="op" id="3708907">=</span>&nbsp;<span class="ident" id="3708909">a2</span><span class="op" id="3708911">.</span><span class="ident" id="3708912">set</span><span class="op" id="3708915">(</span><span class="ident" id="3708916">a</span><span class="op" id="3708917">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708920">b2</span>&nbsp;<span class="op" id="3708923">=</span>&nbsp;<span class="ident" id="3708925">b2</span><span class="op" id="3708927">.</span><span class="ident" id="3708928">set</span><span class="op" id="3708931">(</span><span class="ident" id="3708932">b</span><span class="op" id="3708933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708936">if</span>&nbsp;<span class="ident" id="3708939">shift</span>&nbsp;<span class="op" id="3708945">:=</span>&nbsp;<span class="ident" id="3708948">Msize2</span>&nbsp;<span class="op" id="3708955">-</span>&nbsp;<span class="ident" id="3708957">exp</span><span class="op" id="3708960">;</span>&nbsp;<span class="ident" id="3708962">shift</span>&nbsp;<span class="op" id="3708968">&gt;</span>&nbsp;<span class="num" id="3708970">0</span>&nbsp;<span class="op" id="3708972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708976">a2</span>&nbsp;<span class="op" id="3708979">=</span>&nbsp;<span class="ident" id="3708981">a2</span><span class="op" id="3708983">.</span><span class="ident" id="3708984">shl</span><span class="op" id="3708987">(</span><span class="ident" id="3708988">a2</span><span class="op" id="3708990">,</span>&nbsp;<span class="builtintype" id="3708992">uint</span><span class="op" id="3708996">(</span><span class="ident" id="3708997">shift</span><span class="op" id="3709002">)</span><span class="op" id="3709003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709006">}</span>&nbsp;<span class="keyword" id="3709008">else</span>&nbsp;<span class="keyword" id="3709013">if</span>&nbsp;<span class="ident" id="3709016">shift</span>&nbsp;<span class="op" id="3709022">&lt;</span>&nbsp;<span class="num" id="3709024">0</span>&nbsp;<span class="op" id="3709026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709030">b2</span>&nbsp;<span class="op" id="3709033">=</span>&nbsp;<span class="ident" id="3709035">b2</span><span class="op" id="3709037">.</span><span class="ident" id="3709038">shl</span><span class="op" id="3709041">(</span><span class="ident" id="3709042">b2</span><span class="op" id="3709044">,</span>&nbsp;<span class="builtintype" id="3709046">uint</span><span class="op" id="3709050">(</span><span class="op" id="3709051">-</span><span class="ident" id="3709052">shift</span><span class="op" id="3709057">)</span><span class="op" id="3709058">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709065">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709127">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709184">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709209">var</span>&nbsp;<span class="ident" id="3709213">q</span>&nbsp;<span class="ident" id="3709215">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709220">q</span><span class="op" id="3709221">,</span>&nbsp;<span class="ident" id="3709223">r</span>&nbsp;<span class="op" id="3709225">:=</span>&nbsp;<span class="ident" id="3709228">q</span><span class="op" id="3709229">.</span><span class="ident" id="3709230">div</span><span class="op" id="3709233">(</span><span class="ident" id="3709234">a2</span><span class="op" id="3709236">,</span>&nbsp;<span class="ident" id="3709238">a2</span><span class="op" id="3709240">,</span>&nbsp;<span class="ident" id="3709242">b2</span><span class="op" id="3709244">)</span>&nbsp;<span class="comment" id="3709246">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709263">mantissa</span>&nbsp;<span class="op" id="3709272">:=</span>&nbsp;<span class="ident" id="3709275">low64</span><span class="op" id="3709280">(</span><span class="ident" id="3709281">q</span><span class="op" id="3709282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709285">haveRem</span>&nbsp;<span class="op" id="3709293">:=</span>&nbsp;<span class="builtinfunc" id="3709296">len</span><span class="op" id="3709299">(</span><span class="ident" id="3709300">r</span><span class="op" id="3709301">)</span>&nbsp;<span class="op" id="3709303">&gt;</span>&nbsp;<span class="num" id="3709305">0</span>&nbsp;<span class="comment" id="3709307">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709364">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709433">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709485">if</span>&nbsp;<span class="ident" id="3709488">mantissa</span><span class="op" id="3709496">&gt;&gt;</span><span class="ident" id="3709498">Msize2</span>&nbsp;<span class="op" id="3709505">==</span>&nbsp;<span class="num" id="3709508">1</span>&nbsp;<span class="op" id="3709510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709514">if</span>&nbsp;<span class="ident" id="3709517">mantissa</span><span class="op" id="3709525">&amp;</span><span class="num" id="3709526">1</span>&nbsp;<span class="op" id="3709528">==</span>&nbsp;<span class="num" id="3709531">1</span>&nbsp;<span class="op" id="3709533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709538">haveRem</span>&nbsp;<span class="op" id="3709546">=</span>&nbsp;<span class="builtintype" id="3709548">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709559">mantissa</span>&nbsp;<span class="op" id="3709568">&gt;&gt;=</span>&nbsp;<span class="num" id="3709572">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709576">exp</span><span class="op" id="3709579">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709586">if</span>&nbsp;<span class="ident" id="3709589">mantissa</span><span class="op" id="3709597">&gt;&gt;</span><span class="ident" id="3709599">Msize1</span>&nbsp;<span class="op" id="3709606">!=</span>&nbsp;<span class="num" id="3709609">1</span>&nbsp;<span class="op" id="3709611">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3709615">panic</span><span class="op" id="3709620">(</span><span class="ident" id="3709621">fmt</span><span class="op" id="3709624">.</span><span class="ident" id="3709625">Sprintf</span><span class="op" id="3709632">(</span><span class="string" id="3709633">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3709669">,</span>&nbsp;<span class="ident" id="3709671">Msize2</span><span class="op" id="3709677">)</span><span class="op" id="3709678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709685">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709702">if</span>&nbsp;<span class="ident" id="3709705">Emin</span><span class="op" id="3709709">-</span><span class="ident" id="3709710">Msize</span>&nbsp;<span class="op" id="3709716">&lt;=</span>&nbsp;<span class="ident" id="3709719">exp</span>&nbsp;<span class="op" id="3709723">&amp;&amp;</span>&nbsp;<span class="ident" id="3709726">exp</span>&nbsp;<span class="op" id="3709730">&lt;=</span>&nbsp;<span class="ident" id="3709733">Emin</span>&nbsp;<span class="op" id="3709738">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709742">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709794">shift</span>&nbsp;<span class="op" id="3709800">:=</span>&nbsp;<span class="builtintype" id="3709803">uint</span><span class="op" id="3709807">(</span><span class="ident" id="3709808">Emin</span>&nbsp;<span class="op" id="3709813">-</span>&nbsp;<span class="op" id="3709815">(</span><span class="ident" id="3709816">exp</span>&nbsp;<span class="op" id="3709820">-</span>&nbsp;<span class="num" id="3709822">1</span><span class="op" id="3709823">)</span><span class="op" id="3709824">)</span>&nbsp;<span class="comment" id="3709826">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709843">lostbits</span>&nbsp;<span class="op" id="3709852">:=</span>&nbsp;<span class="ident" id="3709855">mantissa</span>&nbsp;<span class="op" id="3709864">&amp;</span>&nbsp;<span class="op" id="3709866">(</span><span class="num" id="3709867">1</span><span class="op" id="3709868">&lt;&lt;</span><span class="ident" id="3709870">shift</span>&nbsp;<span class="op" id="3709876">-</span>&nbsp;<span class="num" id="3709878">1</span><span class="op" id="3709879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709883">haveRem</span>&nbsp;<span class="op" id="3709891">=</span>&nbsp;<span class="ident" id="3709893">haveRem</span>&nbsp;<span class="op" id="3709901">||</span>&nbsp;<span class="ident" id="3709904">lostbits</span>&nbsp;<span class="op" id="3709913">!=</span>&nbsp;<span class="num" id="3709916">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709920">mantissa</span>&nbsp;<span class="op" id="3709929">&gt;&gt;=</span>&nbsp;<span class="ident" id="3709933">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709941">exp</span>&nbsp;<span class="op" id="3709945">=</span>&nbsp;<span class="num" id="3709947">2</span>&nbsp;<span class="op" id="3709949">-</span>&nbsp;<span class="ident" id="3709951">Ebias</span>&nbsp;<span class="comment" id="3709957">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709979">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710017">exact</span>&nbsp;<span class="op" id="3710023">=</span>&nbsp;<span class="op" id="3710025">!</span><span class="ident" id="3710026">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710035">if</span>&nbsp;<span class="ident" id="3710038">mantissa</span><span class="op" id="3710046">&amp;</span><span class="num" id="3710047">1</span>&nbsp;<span class="op" id="3710049">!=</span>&nbsp;<span class="num" id="3710052">0</span>&nbsp;<span class="op" id="3710054">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710058">exact</span>&nbsp;<span class="op" id="3710064">=</span>&nbsp;<span class="builtintype" id="3710066">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710074">if</span>&nbsp;<span class="ident" id="3710077">haveRem</span>&nbsp;<span class="op" id="3710085">||</span>&nbsp;<span class="ident" id="3710088">mantissa</span><span class="op" id="3710096">&amp;</span><span class="num" id="3710097">2</span>&nbsp;<span class="op" id="3710099">!=</span>&nbsp;<span class="num" id="3710102">0</span>&nbsp;<span class="op" id="3710104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710109">if</span>&nbsp;<span class="ident" id="3710112">mantissa</span><span class="op" id="3710120">++</span><span class="op" id="3710122">;</span>&nbsp;<span class="ident" id="3710124">mantissa</span>&nbsp;<span class="op" id="3710133">&gt;=</span>&nbsp;<span class="num" id="3710136">1</span><span class="op" id="3710137">&lt;&lt;</span><span class="ident" id="3710139">Msize2</span>&nbsp;<span class="op" id="3710146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710152">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710213">mantissa</span>&nbsp;<span class="op" id="3710222">&gt;&gt;=</span>&nbsp;<span class="num" id="3710226">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710232">exp</span><span class="op" id="3710235">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710251">mantissa</span>&nbsp;<span class="op" id="3710260">&gt;&gt;=</span>&nbsp;<span class="num" id="3710264">1</span>&nbsp;<span class="comment" id="3710266">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710328">f</span>&nbsp;<span class="op" id="3710330">=</span>&nbsp;<span class="ident" id="3710332">math</span><span class="op" id="3710336">.</span><span class="ident" id="3710337">Ldexp</span><span class="op" id="3710342">(</span><span class="builtintype" id="3710343">float64</span><span class="op" id="3710350">(</span><span class="ident" id="3710351">mantissa</span><span class="op" id="3710359">)</span><span class="op" id="3710360">,</span>&nbsp;<span class="ident" id="3710362">exp</span><span class="op" id="3710365">-</span><span class="ident" id="3710366">Msize1</span><span class="op" id="3710372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710375">if</span>&nbsp;<span class="ident" id="3710378">math</span><span class="op" id="3710382">.</span><span class="ident" id="3710383">IsInf</span><span class="op" id="3710388">(</span><span class="ident" id="3710389">f</span><span class="op" id="3710390">,</span>&nbsp;<span class="num" id="3710392">0</span><span class="op" id="3710393">)</span>&nbsp;<span class="op" id="3710395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710399">exact</span>&nbsp;<span class="op" id="3710405">=</span>&nbsp;<span class="builtintype" id="3710407">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710414">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710417">return</span><br>
<span class="lineno"></span><span class="op" id="3710424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3710427">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3710500">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="3710573">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3710642">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3710705">func</span>&nbsp;<span class="op" id="3710710">(</span><span class="ident" id="3710711">x</span>&nbsp;<span class="op" id="3710713">*</span><span class="ident" id="3710714">Rat</span><span class="op" id="3710717">)</span>&nbsp;<span class="ident" id="3710719">Float32</span><span class="op" id="3710726">(</span><span class="op" id="3710727">)</span>&nbsp;<span class="op" id="3710729">(</span><span class="ident" id="3710730">f</span>&nbsp;<span class="builtintype" id="3710732">float32</span><span class="op" id="3710739">,</span>&nbsp;<span class="ident" id="3710741">exact</span>&nbsp;<span class="builtintype" id="3710747">bool</span><span class="op" id="3710751">)</span>&nbsp;<span class="op" id="3710753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710756">b</span>&nbsp;<span class="op" id="3710758">:=</span>&nbsp;<span class="ident" id="3710761">x</span><span class="op" id="3710762">.</span><span class="ident" id="3710763">b</span><span class="op" id="3710764">.</span><span class="ident" id="3710765">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710770">if</span>&nbsp;<span class="builtinfunc" id="3710773">len</span><span class="op" id="3710776">(</span><span class="ident" id="3710777">b</span><span class="op" id="3710778">)</span>&nbsp;<span class="op" id="3710780">==</span>&nbsp;<span class="num" id="3710783">0</span>&nbsp;<span class="op" id="3710785">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710789">b</span>&nbsp;<span class="op" id="3710791">=</span>&nbsp;<span class="ident" id="3710793">b</span><span class="op" id="3710794">.</span><span class="ident" id="3710795">set</span><span class="op" id="3710798">(</span><span class="ident" id="3710799">natOne</span><span class="op" id="3710805">)</span>&nbsp;<span class="comment" id="3710807">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710838">f</span><span class="op" id="3710839">,</span>&nbsp;<span class="ident" id="3710841">exact</span>&nbsp;<span class="op" id="3710847">=</span>&nbsp;<span class="ident" id="3710849">quotToFloat32</span><span class="op" id="3710862">(</span><span class="ident" id="3710863">x</span><span class="op" id="3710864">.</span><span class="ident" id="3710865">a</span><span class="op" id="3710866">.</span><span class="ident" id="3710867">abs</span><span class="op" id="3710870">,</span>&nbsp;<span class="ident" id="3710872">b</span><span class="op" id="3710873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710876">if</span>&nbsp;<span class="ident" id="3710879">x</span><span class="op" id="3710880">.</span><span class="ident" id="3710881">a</span><span class="op" id="3710882">.</span><span class="ident" id="3710883">neg</span>&nbsp;<span class="op" id="3710887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710891">f</span>&nbsp;<span class="op" id="3710893">=</span>&nbsp;<span class="op" id="3710895">-</span><span class="ident" id="3710896">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710902">return</span><br>
<span class="lineno"></span><span class="op" id="3710909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3710912">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="3710985">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3711058">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3711127">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3711190">func</span>&nbsp;<span class="op" id="3711195">(</span><span class="ident" id="3711196">x</span>&nbsp;<span class="op" id="3711198">*</span><span class="ident" id="3711199">Rat</span><span class="op" id="3711202">)</span>&nbsp;<span class="ident" id="3711204">Float64</span><span class="op" id="3711211">(</span><span class="op" id="3711212">)</span>&nbsp;<span class="op" id="3711214">(</span><span class="ident" id="3711215">f</span>&nbsp;<span class="builtintype" id="3711217">float64</span><span class="op" id="3711224">,</span>&nbsp;<span class="ident" id="3711226">exact</span>&nbsp;<span class="builtintype" id="3711232">bool</span><span class="op" id="3711236">)</span>&nbsp;<span class="op" id="3711238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711241">b</span>&nbsp;<span class="op" id="3711243">:=</span>&nbsp;<span class="ident" id="3711246">x</span><span class="op" id="3711247">.</span><span class="ident" id="3711248">b</span><span class="op" id="3711249">.</span><span class="ident" id="3711250">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711255">if</span>&nbsp;<span class="builtinfunc" id="3711258">len</span><span class="op" id="3711261">(</span><span class="ident" id="3711262">b</span><span class="op" id="3711263">)</span>&nbsp;<span class="op" id="3711265">==</span>&nbsp;<span class="num" id="3711268">0</span>&nbsp;<span class="op" id="3711270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711274">b</span>&nbsp;<span class="op" id="3711276">=</span>&nbsp;<span class="ident" id="3711278">b</span><span class="op" id="3711279">.</span><span class="ident" id="3711280">set</span><span class="op" id="3711283">(</span><span class="ident" id="3711284">natOne</span><span class="op" id="3711290">)</span>&nbsp;<span class="comment" id="3711292">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711323">f</span><span class="op" id="3711324">,</span>&nbsp;<span class="ident" id="3711326">exact</span>&nbsp;<span class="op" id="3711332">=</span>&nbsp;<span class="ident" id="3711334">quotToFloat64</span><span class="op" id="3711347">(</span><span class="ident" id="3711348">x</span><span class="op" id="3711349">.</span><span class="ident" id="3711350">a</span><span class="op" id="3711351">.</span><span class="ident" id="3711352">abs</span><span class="op" id="3711355">,</span>&nbsp;<span class="ident" id="3711357">b</span><span class="op" id="3711358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711361">if</span>&nbsp;<span class="ident" id="3711364">x</span><span class="op" id="3711365">.</span><span class="ident" id="3711366">a</span><span class="op" id="3711367">.</span><span class="ident" id="3711368">neg</span>&nbsp;<span class="op" id="3711372">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711376">f</span>&nbsp;<span class="op" id="3711378">=</span>&nbsp;<span class="op" id="3711380">-</span><span class="ident" id="3711381">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711387">return</span><br>
<span class="lineno"></span><span class="op" id="3711394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3711397">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3711437">func</span>&nbsp;<span class="op" id="3711442">(</span><span class="ident" id="3711443">z</span>&nbsp;<span class="op" id="3711445">*</span><span class="ident" id="3711446">Rat</span><span class="op" id="3711449">)</span>&nbsp;<span class="ident" id="3711451">SetFrac</span><span class="op" id="3711458">(</span><span class="ident" id="3711459">a</span><span class="op" id="3711460">,</span>&nbsp;<span class="ident" id="3711462">b</span>&nbsp;<span class="op" id="3711464">*</span><span class="ident" id="3711465">Int</span><span class="op" id="3711468">)</span>&nbsp;<span class="op" id="3711470">*</span><span class="ident" id="3711471">Rat</span>&nbsp;<span class="op" id="3711475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711478">z</span><span class="op" id="3711479">.</span><span class="ident" id="3711480">a</span><span class="op" id="3711481">.</span><span class="ident" id="3711482">neg</span>&nbsp;<span class="op" id="3711486">=</span>&nbsp;<span class="ident" id="3711488">a</span><span class="op" id="3711489">.</span><span class="ident" id="3711490">neg</span>&nbsp;<span class="op" id="3711494">!=</span>&nbsp;<span class="ident" id="3711497">b</span><span class="op" id="3711498">.</span><span class="ident" id="3711499">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711504">babs</span>&nbsp;<span class="op" id="3711509">:=</span>&nbsp;<span class="ident" id="3711512">b</span><span class="op" id="3711513">.</span><span class="ident" id="3711514">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711519">if</span>&nbsp;<span class="builtinfunc" id="3711522">len</span><span class="op" id="3711525">(</span><span class="ident" id="3711526">babs</span><span class="op" id="3711530">)</span>&nbsp;<span class="op" id="3711532">==</span>&nbsp;<span class="num" id="3711535">0</span>&nbsp;<span class="op" id="3711537">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3711541">panic</span><span class="op" id="3711546">(</span><span class="string" id="3711547">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3711565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711571">if</span>&nbsp;<span class="op" id="3711574">&amp;</span><span class="ident" id="3711575">z</span><span class="op" id="3711576">.</span><span class="ident" id="3711577">a</span>&nbsp;<span class="op" id="3711579">==</span>&nbsp;<span class="ident" id="3711582">b</span>&nbsp;<span class="op" id="3711584">||</span>&nbsp;<span class="ident" id="3711587">alias</span><span class="op" id="3711592">(</span><span class="ident" id="3711593">z</span><span class="op" id="3711594">.</span><span class="ident" id="3711595">a</span><span class="op" id="3711596">.</span><span class="ident" id="3711597">abs</span><span class="op" id="3711600">,</span>&nbsp;<span class="ident" id="3711602">babs</span><span class="op" id="3711606">)</span>&nbsp;<span class="op" id="3711608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711612">babs</span>&nbsp;<span class="op" id="3711617">=</span>&nbsp;<span class="ident" id="3711619">nat</span><span class="op" id="3711622">(</span><span class="ident" id="3711623">nil</span><span class="op" id="3711626">)</span><span class="op" id="3711627">.</span><span class="ident" id="3711628">set</span><span class="op" id="3711631">(</span><span class="ident" id="3711632">babs</span><span class="op" id="3711636">)</span>&nbsp;<span class="comment" id="3711638">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711654">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711657">z</span><span class="op" id="3711658">.</span><span class="ident" id="3711659">a</span><span class="op" id="3711660">.</span><span class="ident" id="3711661">abs</span>&nbsp;<span class="op" id="3711665">=</span>&nbsp;<span class="ident" id="3711667">z</span><span class="op" id="3711668">.</span><span class="ident" id="3711669">a</span><span class="op" id="3711670">.</span><span class="ident" id="3711671">abs</span><span class="op" id="3711674">.</span><span class="ident" id="3711675">set</span><span class="op" id="3711678">(</span><span class="ident" id="3711679">a</span><span class="op" id="3711680">.</span><span class="ident" id="3711681">abs</span><span class="op" id="3711684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711687">z</span><span class="op" id="3711688">.</span><span class="ident" id="3711689">b</span><span class="op" id="3711690">.</span><span class="ident" id="3711691">abs</span>&nbsp;<span class="op" id="3711695">=</span>&nbsp;<span class="ident" id="3711697">z</span><span class="op" id="3711698">.</span><span class="ident" id="3711699">b</span><span class="op" id="3711700">.</span><span class="ident" id="3711701">abs</span><span class="op" id="3711704">.</span><span class="ident" id="3711705">set</span><span class="op" id="3711708">(</span><span class="ident" id="3711709">babs</span><span class="op" id="3711713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711716">return</span>&nbsp;<span class="ident" id="3711723">z</span><span class="op" id="3711724">.</span><span class="ident" id="3711725">norm</span><span class="op" id="3711729">(</span><span class="op" id="3711730">)</span><br>
<span class="lineno"></span><span class="op" id="3711732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3711735">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3711777">func</span>&nbsp;<span class="op" id="3711782">(</span><span class="ident" id="3711783">z</span>&nbsp;<span class="op" id="3711785">*</span><span class="ident" id="3711786">Rat</span><span class="op" id="3711789">)</span>&nbsp;<span class="ident" id="3711791">SetFrac64</span><span class="op" id="3711800">(</span><span class="ident" id="3711801">a</span><span class="op" id="3711802">,</span>&nbsp;<span class="ident" id="3711804">b</span>&nbsp;<span class="ident" id="3711806">int64</span><span class="op" id="3711811">)</span>&nbsp;<span class="op" id="3711813">*</span><span class="ident" id="3711814">Rat</span>&nbsp;<span class="op" id="3711818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711821">z</span><span class="op" id="3711822">.</span><span class="ident" id="3711823">a</span><span class="op" id="3711824">.</span><span class="ident" id="3711825">SetInt64</span><span class="op" id="3711833">(</span><span class="ident" id="3711834">a</span><span class="op" id="3711835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711838">if</span>&nbsp;<span class="ident" id="3711841">b</span>&nbsp;<span class="op" id="3711843">==</span>&nbsp;<span class="num" id="3711846">0</span>&nbsp;<span class="op" id="3711848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3711852">panic</span><span class="op" id="3711857">(</span><span class="string" id="3711858">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3711876">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711882">if</span>&nbsp;<span class="ident" id="3711885">b</span>&nbsp;<span class="op" id="3711887">&lt;</span>&nbsp;<span class="num" id="3711889">0</span>&nbsp;<span class="op" id="3711891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711895">b</span>&nbsp;<span class="op" id="3711897">=</span>&nbsp;<span class="op" id="3711899">-</span><span class="ident" id="3711900">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711904">z</span><span class="op" id="3711905">.</span><span class="ident" id="3711906">a</span><span class="op" id="3711907">.</span><span class="ident" id="3711908">neg</span>&nbsp;<span class="op" id="3711912">=</span>&nbsp;<span class="op" id="3711914">!</span><span class="ident" id="3711915">z</span><span class="op" id="3711916">.</span><span class="ident" id="3711917">a</span><span class="op" id="3711918">.</span><span class="ident" id="3711919">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711924">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711927">z</span><span class="op" id="3711928">.</span><span class="ident" id="3711929">b</span><span class="op" id="3711930">.</span><span class="ident" id="3711931">abs</span>&nbsp;<span class="op" id="3711935">=</span>&nbsp;<span class="ident" id="3711937">z</span><span class="op" id="3711938">.</span><span class="ident" id="3711939">b</span><span class="op" id="3711940">.</span><span class="ident" id="3711941">abs</span><span class="op" id="3711944">.</span><span class="ident" id="3711945">setUint64</span><span class="op" id="3711954">(</span><span class="ident" id="3711955">uint64</span><span class="op" id="3711961">(</span><span class="ident" id="3711962">b</span><span class="op" id="3711963">)</span><span class="op" id="3711964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711967">return</span>&nbsp;<span class="ident" id="3711974">z</span><span class="op" id="3711975">.</span><span class="ident" id="3711976">norm</span><span class="op" id="3711980">(</span><span class="op" id="3711981">)</span><br>
<span class="lineno"></span><span class="op" id="3711983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711986">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="3712047">func</span>&nbsp;<span class="op" id="3712052">(</span><span class="ident" id="3712053">z</span>&nbsp;<span class="op" id="3712055">*</span><span class="ident" id="3712056">Rat</span><span class="op" id="3712059">)</span>&nbsp;<span class="ident" id="3712061">SetInt</span><span class="op" id="3712067">(</span><span class="ident" id="3712068">x</span>&nbsp;<span class="op" id="3712070">*</span><span class="ident" id="3712071">Int</span><span class="op" id="3712074">)</span>&nbsp;<span class="op" id="3712076">*</span><span class="ident" id="3712077">Rat</span>&nbsp;<span class="op" id="3712081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712084">z</span><span class="op" id="3712085">.</span><span class="ident" id="3712086">a</span><span class="op" id="3712087">.</span><span class="ident" id="3712088">Set</span><span class="op" id="3712091">(</span><span class="ident" id="3712092">x</span><span class="op" id="3712093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712096">z</span><span class="op" id="3712097">.</span><span class="ident" id="3712098">b</span><span class="op" id="3712099">.</span><span class="ident" id="3712100">abs</span>&nbsp;<span class="op" id="3712104">=</span>&nbsp;<span class="ident" id="3712106">z</span><span class="op" id="3712107">.</span><span class="ident" id="3712108">b</span><span class="op" id="3712109">.</span><span class="ident" id="3712110">abs</span><span class="op" id="3712113">.</span><span class="builtinfunc" id="3712114">make</span><span class="op" id="3712118">(</span><span class="num" id="3712119">0</span><span class="op" id="3712120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712123">return</span>&nbsp;<span class="ident" id="3712130">z</span><br>
<span class="lineno"></span><span class="op" id="3712132">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3712135">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3712174">func</span>&nbsp;<span class="op" id="3712179">(</span><span class="ident" id="3712180">z</span>&nbsp;<span class="op" id="3712182">*</span><span class="ident" id="3712183">Rat</span><span class="op" id="3712186">)</span>&nbsp;<span class="ident" id="3712188">SetInt64</span><span class="op" id="3712196">(</span><span class="ident" id="3712197">x</span>&nbsp;<span class="ident" id="3712199">int64</span><span class="op" id="3712204">)</span>&nbsp;<span class="op" id="3712206">*</span><span class="ident" id="3712207">Rat</span>&nbsp;<span class="op" id="3712211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712214">z</span><span class="op" id="3712215">.</span><span class="ident" id="3712216">a</span><span class="op" id="3712217">.</span><span class="ident" id="3712218">SetInt64</span><span class="op" id="3712226">(</span><span class="ident" id="3712227">x</span><span class="op" id="3712228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712231">z</span><span class="op" id="3712232">.</span><span class="ident" id="3712233">b</span><span class="op" id="3712234">.</span><span class="ident" id="3712235">abs</span>&nbsp;<span class="op" id="3712239">=</span>&nbsp;<span class="ident" id="3712241">z</span><span class="op" id="3712242">.</span><span class="ident" id="3712243">b</span><span class="op" id="3712244">.</span><span class="ident" id="3712245">abs</span><span class="op" id="3712248">.</span><span class="builtinfunc" id="3712249">make</span><span class="op" id="3712253">(</span><span class="num" id="3712254">0</span><span class="op" id="3712255">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712258">return</span>&nbsp;<span class="ident" id="3712265">z</span><br>
<span class="lineno"></span><span class="op" id="3712267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712270">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3712328">func</span>&nbsp;<span class="op" id="3712333">(</span><span class="ident" id="3712334">z</span>&nbsp;<span class="op" id="3712336">*</span><span class="ident" id="3712337">Rat</span><span class="op" id="3712340">)</span>&nbsp;<span class="ident" id="3712342">Set</span><span class="op" id="3712345">(</span><span class="ident" id="3712346">x</span>&nbsp;<span class="op" id="3712348">*</span><span class="ident" id="3712349">Rat</span><span class="op" id="3712352">)</span>&nbsp;<span class="op" id="3712354">*</span><span class="ident" id="3712355">Rat</span>&nbsp;<span class="op" id="3712359">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712362">if</span>&nbsp;<span class="ident" id="3712365">z</span>&nbsp;<span class="op" id="3712367">!=</span>&nbsp;<span class="ident" id="3712370">x</span>&nbsp;<span class="op" id="3712372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712376">z</span><span class="op" id="3712377">.</span><span class="ident" id="3712378">a</span><span class="op" id="3712379">.</span><span class="ident" id="3712380">Set</span><span class="op" id="3712383">(</span><span class="op" id="3712384">&amp;</span><span class="ident" id="3712385">x</span><span class="op" id="3712386">.</span><span class="ident" id="3712387">a</span><span class="op" id="3712388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712392">z</span><span class="op" id="3712393">.</span><span class="ident" id="3712394">b</span><span class="op" id="3712395">.</span><span class="ident" id="3712396">Set</span><span class="op" id="3712399">(</span><span class="op" id="3712400">&amp;</span><span class="ident" id="3712401">x</span><span class="op" id="3712402">.</span><span class="ident" id="3712403">b</span><span class="op" id="3712404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712410">return</span>&nbsp;<span class="ident" id="3712417">z</span><br>
<span class="lineno">345</span><span class="op" id="3712419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712422">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3712484">func</span>&nbsp;<span class="op" id="3712489">(</span><span class="ident" id="3712490">z</span>&nbsp;<span class="op" id="3712492">*</span><span class="ident" id="3712493">Rat</span><span class="op" id="3712496">)</span>&nbsp;<span class="ident" id="3712498">Abs</span><span class="op" id="3712501">(</span><span class="ident" id="3712502">x</span>&nbsp;<span class="op" id="3712504">*</span><span class="ident" id="3712505">Rat</span><span class="op" id="3712508">)</span>&nbsp;<span class="op" id="3712510">*</span><span class="ident" id="3712511">Rat</span>&nbsp;<span class="op" id="3712515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712518">z</span><span class="op" id="3712519">.</span><span class="ident" id="3712520">Set</span><span class="op" id="3712523">(</span><span class="ident" id="3712524">x</span><span class="op" id="3712525">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712528">z</span><span class="op" id="3712529">.</span><span class="ident" id="3712530">a</span><span class="op" id="3712531">.</span><span class="ident" id="3712532">neg</span>&nbsp;<span class="op" id="3712536">=</span>&nbsp;<span class="builtintype" id="3712538">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712545">return</span>&nbsp;<span class="ident" id="3712552">z</span><br>
<span class="lineno"></span><span class="op" id="3712554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712557">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="3712592">func</span>&nbsp;<span class="op" id="3712597">(</span><span class="ident" id="3712598">z</span>&nbsp;<span class="op" id="3712600">*</span><span class="ident" id="3712601">Rat</span><span class="op" id="3712604">)</span>&nbsp;<span class="ident" id="3712606">Neg</span><span class="op" id="3712609">(</span><span class="ident" id="3712610">x</span>&nbsp;<span class="op" id="3712612">*</span><span class="ident" id="3712613">Rat</span><span class="op" id="3712616">)</span>&nbsp;<span class="op" id="3712618">*</span><span class="ident" id="3712619">Rat</span>&nbsp;<span class="op" id="3712623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712626">z</span><span class="op" id="3712627">.</span><span class="ident" id="3712628">Set</span><span class="op" id="3712631">(</span><span class="ident" id="3712632">x</span><span class="op" id="3712633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712636">z</span><span class="op" id="3712637">.</span><span class="ident" id="3712638">a</span><span class="op" id="3712639">.</span><span class="ident" id="3712640">neg</span>&nbsp;<span class="op" id="3712644">=</span>&nbsp;<span class="builtinfunc" id="3712646">len</span><span class="op" id="3712649">(</span><span class="ident" id="3712650">z</span><span class="op" id="3712651">.</span><span class="ident" id="3712652">a</span><span class="op" id="3712653">.</span><span class="ident" id="3712654">abs</span><span class="op" id="3712657">)</span>&nbsp;<span class="op" id="3712659">&gt;</span>&nbsp;<span class="num" id="3712661">0</span>&nbsp;<span class="op" id="3712663">&amp;&amp;</span>&nbsp;<span class="op" id="3712666">!</span><span class="ident" id="3712667">z</span><span class="op" id="3712668">.</span><span class="ident" id="3712669">a</span><span class="op" id="3712670">.</span><span class="ident" id="3712671">neg</span>&nbsp;<span class="comment" id="3712675">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712693">return</span>&nbsp;<span class="ident" id="3712700">z</span><br>
<span class="lineno"></span><span class="op" id="3712702">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3712705">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3712741">func</span>&nbsp;<span class="op" id="3712746">(</span><span class="ident" id="3712747">z</span>&nbsp;<span class="op" id="3712749">*</span><span class="ident" id="3712750">Rat</span><span class="op" id="3712753">)</span>&nbsp;<span class="ident" id="3712755">Inv</span><span class="op" id="3712758">(</span><span class="ident" id="3712759">x</span>&nbsp;<span class="op" id="3712761">*</span><span class="ident" id="3712762">Rat</span><span class="op" id="3712765">)</span>&nbsp;<span class="op" id="3712767">*</span><span class="ident" id="3712768">Rat</span>&nbsp;<span class="op" id="3712772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712775">if</span>&nbsp;<span class="builtinfunc" id="3712778">len</span><span class="op" id="3712781">(</span><span class="ident" id="3712782">x</span><span class="op" id="3712783">.</span><span class="ident" id="3712784">a</span><span class="op" id="3712785">.</span><span class="ident" id="3712786">abs</span><span class="op" id="3712789">)</span>&nbsp;<span class="op" id="3712791">==</span>&nbsp;<span class="num" id="3712794">0</span>&nbsp;<span class="op" id="3712796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3712800">panic</span><span class="op" id="3712805">(</span><span class="string" id="3712806">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3712824">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712830">z</span><span class="op" id="3712831">.</span><span class="ident" id="3712832">Set</span><span class="op" id="3712835">(</span><span class="ident" id="3712836">x</span><span class="op" id="3712837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712840">a</span>&nbsp;<span class="op" id="3712842">:=</span>&nbsp;<span class="ident" id="3712845">z</span><span class="op" id="3712846">.</span><span class="ident" id="3712847">b</span><span class="op" id="3712848">.</span><span class="ident" id="3712849">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712854">if</span>&nbsp;<span class="builtinfunc" id="3712857">len</span><span class="op" id="3712860">(</span><span class="ident" id="3712861">a</span><span class="op" id="3712862">)</span>&nbsp;<span class="op" id="3712864">==</span>&nbsp;<span class="num" id="3712867">0</span>&nbsp;<span class="op" id="3712869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712873">a</span>&nbsp;<span class="op" id="3712875">=</span>&nbsp;<span class="ident" id="3712877">a</span><span class="op" id="3712878">.</span><span class="ident" id="3712879">set</span><span class="op" id="3712882">(</span><span class="ident" id="3712883">natOne</span><span class="op" id="3712889">)</span>&nbsp;<span class="comment" id="3712891">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712920">b</span>&nbsp;<span class="op" id="3712922">:=</span>&nbsp;<span class="ident" id="3712925">z</span><span class="op" id="3712926">.</span><span class="ident" id="3712927">a</span><span class="op" id="3712928">.</span><span class="ident" id="3712929">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712934">if</span>&nbsp;<span class="ident" id="3712937">b</span><span class="op" id="3712938">.</span><span class="ident" id="3712939">cmp</span><span class="op" id="3712942">(</span><span class="ident" id="3712943">natOne</span><span class="op" id="3712949">)</span>&nbsp;<span class="op" id="3712951">==</span>&nbsp;<span class="num" id="3712954">0</span>&nbsp;<span class="op" id="3712956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712960">b</span>&nbsp;<span class="op" id="3712962">=</span>&nbsp;<span class="ident" id="3712964">b</span><span class="op" id="3712965">.</span><span class="builtinfunc" id="3712966">make</span><span class="op" id="3712970">(</span><span class="num" id="3712971">0</span><span class="op" id="3712972">)</span>&nbsp;<span class="comment" id="3712974">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713000">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713003">z</span><span class="op" id="3713004">.</span><span class="ident" id="3713005">a</span><span class="op" id="3713006">.</span><span class="ident" id="3713007">abs</span><span class="op" id="3713010">,</span>&nbsp;<span class="ident" id="3713012">z</span><span class="op" id="3713013">.</span><span class="ident" id="3713014">b</span><span class="op" id="3713015">.</span><span class="ident" id="3713016">abs</span>&nbsp;<span class="op" id="3713020">=</span>&nbsp;<span class="ident" id="3713022">a</span><span class="op" id="3713023">,</span>&nbsp;<span class="ident" id="3713025">b</span>&nbsp;<span class="comment" id="3713027">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713051">return</span>&nbsp;<span class="ident" id="3713058">z</span><br>
<span class="lineno"></span><span class="op" id="3713060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713063">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="3713080">//</span><br>
<span class="lineno"></span><span class="comment" id="3713083">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3713099">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3713115">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3713131">//</span><br>
<span class="lineno">385</span><span class="keyword" id="3713134">func</span>&nbsp;<span class="op" id="3713139">(</span><span class="ident" id="3713140">x</span>&nbsp;<span class="op" id="3713142">*</span><span class="ident" id="3713143">Rat</span><span class="op" id="3713146">)</span>&nbsp;<span class="ident" id="3713148">Sign</span><span class="op" id="3713152">(</span><span class="op" id="3713153">)</span>&nbsp;<span class="builtintype" id="3713155">int</span>&nbsp;<span class="op" id="3713159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713162">return</span>&nbsp;<span class="ident" id="3713169">x</span><span class="op" id="3713170">.</span><span class="ident" id="3713171">a</span><span class="op" id="3713172">.</span><span class="ident" id="3713173">Sign</span><span class="op" id="3713177">(</span><span class="op" id="3713178">)</span><br>
<span class="lineno"></span><span class="op" id="3713180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713183">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="3713235">func</span>&nbsp;<span class="op" id="3713240">(</span><span class="ident" id="3713241">x</span>&nbsp;<span class="op" id="3713243">*</span><span class="ident" id="3713244">Rat</span><span class="op" id="3713247">)</span>&nbsp;<span class="ident" id="3713249">IsInt</span><span class="op" id="3713254">(</span><span class="op" id="3713255">)</span>&nbsp;<span class="builtintype" id="3713257">bool</span>&nbsp;<span class="op" id="3713262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713265">return</span>&nbsp;<span class="builtinfunc" id="3713272">len</span><span class="op" id="3713275">(</span><span class="ident" id="3713276">x</span><span class="op" id="3713277">.</span><span class="ident" id="3713278">b</span><span class="op" id="3713279">.</span><span class="ident" id="3713280">abs</span><span class="op" id="3713283">)</span>&nbsp;<span class="op" id="3713285">==</span>&nbsp;<span class="num" id="3713288">0</span>&nbsp;<span class="op" id="3713290">||</span>&nbsp;<span class="ident" id="3713293">x</span><span class="op" id="3713294">.</span><span class="ident" id="3713295">b</span><span class="op" id="3713296">.</span><span class="ident" id="3713297">abs</span><span class="op" id="3713300">.</span><span class="ident" id="3713301">cmp</span><span class="op" id="3713304">(</span><span class="ident" id="3713305">natOne</span><span class="op" id="3713311">)</span>&nbsp;<span class="op" id="3713313">==</span>&nbsp;<span class="num" id="3713316">0</span><br>
<span class="lineno"></span><span class="op" id="3713318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713321">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="3713372">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3713422">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="3713485">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3713544">func</span>&nbsp;<span class="op" id="3713549">(</span><span class="ident" id="3713550">x</span>&nbsp;<span class="op" id="3713552">*</span><span class="ident" id="3713553">Rat</span><span class="op" id="3713556">)</span>&nbsp;<span class="ident" id="3713558">Num</span><span class="op" id="3713561">(</span><span class="op" id="3713562">)</span>&nbsp;<span class="op" id="3713564">*</span><span class="ident" id="3713565">Int</span>&nbsp;<span class="op" id="3713569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713572">return</span>&nbsp;<span class="op" id="3713579">&amp;</span><span class="ident" id="3713580">x</span><span class="op" id="3713581">.</span><span class="ident" id="3713582">a</span><br>
<span class="lineno">400</span><span class="op" id="3713584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713587">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3713644">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3713696">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="3713759">func</span>&nbsp;<span class="op" id="3713764">(</span><span class="ident" id="3713765">x</span>&nbsp;<span class="op" id="3713767">*</span><span class="ident" id="3713768">Rat</span><span class="op" id="3713771">)</span>&nbsp;<span class="ident" id="3713773">Denom</span><span class="op" id="3713778">(</span><span class="op" id="3713779">)</span>&nbsp;<span class="op" id="3713781">*</span><span class="ident" id="3713782">Int</span>&nbsp;<span class="op" id="3713786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713789">x</span><span class="op" id="3713790">.</span><span class="ident" id="3713791">b</span><span class="op" id="3713792">.</span><span class="ident" id="3713793">neg</span>&nbsp;<span class="op" id="3713797">=</span>&nbsp;<span class="builtintype" id="3713799">false</span>&nbsp;<span class="comment" id="3713805">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713835">if</span>&nbsp;<span class="builtinfunc" id="3713838">len</span><span class="op" id="3713841">(</span><span class="ident" id="3713842">x</span><span class="op" id="3713843">.</span><span class="ident" id="3713844">b</span><span class="op" id="3713845">.</span><span class="ident" id="3713846">abs</span><span class="op" id="3713849">)</span>&nbsp;<span class="op" id="3713851">==</span>&nbsp;<span class="num" id="3713854">0</span>&nbsp;<span class="op" id="3713856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713860">x</span><span class="op" id="3713861">.</span><span class="ident" id="3713862">b</span><span class="op" id="3713863">.</span><span class="ident" id="3713864">abs</span>&nbsp;<span class="op" id="3713868">=</span>&nbsp;<span class="ident" id="3713870">x</span><span class="op" id="3713871">.</span><span class="ident" id="3713872">b</span><span class="op" id="3713873">.</span><span class="ident" id="3713874">abs</span><span class="op" id="3713877">.</span><span class="ident" id="3713878">set</span><span class="op" id="3713881">(</span><span class="ident" id="3713882">natOne</span><span class="op" id="3713888">)</span>&nbsp;<span class="comment" id="3713890">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713918">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713921">return</span>&nbsp;<span class="op" id="3713928">&amp;</span><span class="ident" id="3713929">x</span><span class="op" id="3713930">.</span><span class="ident" id="3713931">b</span><br>
<span class="lineno"></span><span class="op" id="3713933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3713936">func</span>&nbsp;<span class="op" id="3713941">(</span><span class="ident" id="3713942">z</span>&nbsp;<span class="op" id="3713944">*</span><span class="ident" id="3713945">Rat</span><span class="op" id="3713948">)</span>&nbsp;<span class="ident" id="3713950">norm</span><span class="op" id="3713954">(</span><span class="op" id="3713955">)</span>&nbsp;<span class="op" id="3713957">*</span><span class="ident" id="3713958">Rat</span>&nbsp;<span class="op" id="3713962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713965">switch</span>&nbsp;<span class="op" id="3713972">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713975">case</span>&nbsp;<span class="builtinfunc" id="3713980">len</span><span class="op" id="3713983">(</span><span class="ident" id="3713984">z</span><span class="op" id="3713985">.</span><span class="ident" id="3713986">a</span><span class="op" id="3713987">.</span><span class="ident" id="3713988">abs</span><span class="op" id="3713991">)</span>&nbsp;<span class="op" id="3713993">==</span>&nbsp;<span class="num" id="3713996">0</span><span class="op" id="3713997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714001">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714046">z</span><span class="op" id="3714047">.</span><span class="ident" id="3714048">a</span><span class="op" id="3714049">.</span><span class="ident" id="3714050">neg</span>&nbsp;<span class="op" id="3714054">=</span>&nbsp;<span class="builtintype" id="3714056">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714064">z</span><span class="op" id="3714065">.</span><span class="ident" id="3714066">b</span><span class="op" id="3714067">.</span><span class="ident" id="3714068">abs</span>&nbsp;<span class="op" id="3714072">=</span>&nbsp;<span class="ident" id="3714074">z</span><span class="op" id="3714075">.</span><span class="ident" id="3714076">b</span><span class="op" id="3714077">.</span><span class="ident" id="3714078">abs</span><span class="op" id="3714081">.</span><span class="builtinfunc" id="3714082">make</span><span class="op" id="3714086">(</span><span class="num" id="3714087">0</span><span class="op" id="3714088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714091">case</span>&nbsp;<span class="builtinfunc" id="3714096">len</span><span class="op" id="3714099">(</span><span class="ident" id="3714100">z</span><span class="op" id="3714101">.</span><span class="ident" id="3714102">b</span><span class="op" id="3714103">.</span><span class="ident" id="3714104">abs</span><span class="op" id="3714107">)</span>&nbsp;<span class="op" id="3714109">==</span>&nbsp;<span class="num" id="3714112">0</span><span class="op" id="3714113">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714117">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714157">case</span>&nbsp;<span class="ident" id="3714162">z</span><span class="op" id="3714163">.</span><span class="ident" id="3714164">b</span><span class="op" id="3714165">.</span><span class="ident" id="3714166">abs</span><span class="op" id="3714169">.</span><span class="ident" id="3714170">cmp</span><span class="op" id="3714173">(</span><span class="ident" id="3714174">natOne</span><span class="op" id="3714180">)</span>&nbsp;<span class="op" id="3714182">==</span>&nbsp;<span class="num" id="3714185">0</span><span class="op" id="3714186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714190">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714228">z</span><span class="op" id="3714229">.</span><span class="ident" id="3714230">b</span><span class="op" id="3714231">.</span><span class="ident" id="3714232">abs</span>&nbsp;<span class="op" id="3714236">=</span>&nbsp;<span class="ident" id="3714238">z</span><span class="op" id="3714239">.</span><span class="ident" id="3714240">b</span><span class="op" id="3714241">.</span><span class="ident" id="3714242">abs</span><span class="op" id="3714245">.</span><span class="builtinfunc" id="3714246">make</span><span class="op" id="3714250">(</span><span class="num" id="3714251">0</span><span class="op" id="3714252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714255">default</span><span class="op" id="3714262">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714266">neg</span>&nbsp;<span class="op" id="3714270">:=</span>&nbsp;<span class="ident" id="3714273">z</span><span class="op" id="3714274">.</span><span class="ident" id="3714275">a</span><span class="op" id="3714276">.</span><span class="ident" id="3714277">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714283">z</span><span class="op" id="3714284">.</span><span class="ident" id="3714285">a</span><span class="op" id="3714286">.</span><span class="ident" id="3714287">neg</span>&nbsp;<span class="op" id="3714291">=</span>&nbsp;<span class="builtintype" id="3714293">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714301">z</span><span class="op" id="3714302">.</span><span class="ident" id="3714303">b</span><span class="op" id="3714304">.</span><span class="ident" id="3714305">neg</span>&nbsp;<span class="op" id="3714309">=</span>&nbsp;<span class="builtintype" id="3714311">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714319">if</span>&nbsp;<span class="ident" id="3714322">f</span>&nbsp;<span class="op" id="3714324">:=</span>&nbsp;<span class="ident" id="3714327">NewInt</span><span class="op" id="3714333">(</span><span class="num" id="3714334">0</span><span class="op" id="3714335">)</span><span class="op" id="3714336">.</span><span class="ident" id="3714337">binaryGCD</span><span class="op" id="3714346">(</span><span class="op" id="3714347">&amp;</span><span class="ident" id="3714348">z</span><span class="op" id="3714349">.</span><span class="ident" id="3714350">a</span><span class="op" id="3714351">,</span>&nbsp;<span class="op" id="3714353">&amp;</span><span class="ident" id="3714354">z</span><span class="op" id="3714355">.</span><span class="ident" id="3714356">b</span><span class="op" id="3714357">)</span><span class="op" id="3714358">;</span>&nbsp;<span class="ident" id="3714360">f</span><span class="op" id="3714361">.</span><span class="ident" id="3714362">Cmp</span><span class="op" id="3714365">(</span><span class="ident" id="3714366">intOne</span><span class="op" id="3714372">)</span>&nbsp;<span class="op" id="3714374">!=</span>&nbsp;<span class="num" id="3714377">0</span>&nbsp;<span class="op" id="3714379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714384">z</span><span class="op" id="3714385">.</span><span class="ident" id="3714386">a</span><span class="op" id="3714387">.</span><span class="ident" id="3714388">abs</span><span class="op" id="3714391">,</span>&nbsp;<span class="ident" id="3714393">_</span>&nbsp;<span class="op" id="3714395">=</span>&nbsp;<span class="ident" id="3714397">z</span><span class="op" id="3714398">.</span><span class="ident" id="3714399">a</span><span class="op" id="3714400">.</span><span class="ident" id="3714401">abs</span><span class="op" id="3714404">.</span><span class="ident" id="3714405">div</span><span class="op" id="3714408">(</span><span class="ident" id="3714409">nil</span><span class="op" id="3714412">,</span>&nbsp;<span class="ident" id="3714414">z</span><span class="op" id="3714415">.</span><span class="ident" id="3714416">a</span><span class="op" id="3714417">.</span><span class="ident" id="3714418">abs</span><span class="op" id="3714421">,</span>&nbsp;<span class="ident" id="3714423">f</span><span class="op" id="3714424">.</span><span class="ident" id="3714425">abs</span><span class="op" id="3714428">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714433">z</span><span class="op" id="3714434">.</span><span class="ident" id="3714435">b</span><span class="op" id="3714436">.</span><span class="ident" id="3714437">abs</span><span class="op" id="3714440">,</span>&nbsp;<span class="ident" id="3714442">_</span>&nbsp;<span class="op" id="3714444">=</span>&nbsp;<span class="ident" id="3714446">z</span><span class="op" id="3714447">.</span><span class="ident" id="3714448">b</span><span class="op" id="3714449">.</span><span class="ident" id="3714450">abs</span><span class="op" id="3714453">.</span><span class="ident" id="3714454">div</span><span class="op" id="3714457">(</span><span class="ident" id="3714458">nil</span><span class="op" id="3714461">,</span>&nbsp;<span class="ident" id="3714463">z</span><span class="op" id="3714464">.</span><span class="ident" id="3714465">b</span><span class="op" id="3714466">.</span><span class="ident" id="3714467">abs</span><span class="op" id="3714470">,</span>&nbsp;<span class="ident" id="3714472">f</span><span class="op" id="3714473">.</span><span class="ident" id="3714474">abs</span><span class="op" id="3714477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714482">if</span>&nbsp;<span class="ident" id="3714485">z</span><span class="op" id="3714486">.</span><span class="ident" id="3714487">b</span><span class="op" id="3714488">.</span><span class="ident" id="3714489">abs</span><span class="op" id="3714492">.</span><span class="ident" id="3714493">cmp</span><span class="op" id="3714496">(</span><span class="ident" id="3714497">natOne</span><span class="op" id="3714503">)</span>&nbsp;<span class="op" id="3714505">==</span>&nbsp;<span class="num" id="3714508">0</span>&nbsp;<span class="op" id="3714510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714516">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714556">z</span><span class="op" id="3714557">.</span><span class="ident" id="3714558">b</span><span class="op" id="3714559">.</span><span class="ident" id="3714560">abs</span>&nbsp;<span class="op" id="3714564">=</span>&nbsp;<span class="ident" id="3714566">z</span><span class="op" id="3714567">.</span><span class="ident" id="3714568">b</span><span class="op" id="3714569">.</span><span class="ident" id="3714570">abs</span><span class="op" id="3714573">.</span><span class="builtinfunc" id="3714574">make</span><span class="op" id="3714578">(</span><span class="num" id="3714579">0</span><span class="op" id="3714580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714585">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714593">z</span><span class="op" id="3714594">.</span><span class="ident" id="3714595">a</span><span class="op" id="3714596">.</span><span class="ident" id="3714597">neg</span>&nbsp;<span class="op" id="3714601">=</span>&nbsp;<span class="ident" id="3714603">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714611">return</span>&nbsp;<span class="ident" id="3714618">z</span><br>
<span class="lineno"></span><span class="op" id="3714620">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3714623">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3714689">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3714755">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3714769">func</span>&nbsp;<span class="ident" id="3714774">mulDenom</span><span class="op" id="3714782">(</span><span class="ident" id="3714783">z</span><span class="op" id="3714784">,</span>&nbsp;<span class="ident" id="3714786">x</span><span class="op" id="3714787">,</span>&nbsp;<span class="ident" id="3714789">y</span>&nbsp;<span class="ident" id="3714791">nat</span><span class="op" id="3714794">)</span>&nbsp;<span class="ident" id="3714796">nat</span>&nbsp;<span class="op" id="3714800">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714803">switch</span>&nbsp;<span class="op" id="3714810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714813">case</span>&nbsp;<span class="builtinfunc" id="3714818">len</span><span class="op" id="3714821">(</span><span class="ident" id="3714822">x</span><span class="op" id="3714823">)</span>&nbsp;<span class="op" id="3714825">==</span>&nbsp;<span class="num" id="3714828">0</span><span class="op" id="3714829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714833">return</span>&nbsp;<span class="ident" id="3714840">z</span><span class="op" id="3714841">.</span><span class="ident" id="3714842">set</span><span class="op" id="3714845">(</span><span class="ident" id="3714846">y</span><span class="op" id="3714847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714850">case</span>&nbsp;<span class="builtinfunc" id="3714855">len</span><span class="op" id="3714858">(</span><span class="ident" id="3714859">y</span><span class="op" id="3714860">)</span>&nbsp;<span class="op" id="3714862">==</span>&nbsp;<span class="num" id="3714865">0</span><span class="op" id="3714866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714870">return</span>&nbsp;<span class="ident" id="3714877">z</span><span class="op" id="3714878">.</span><span class="ident" id="3714879">set</span><span class="op" id="3714882">(</span><span class="ident" id="3714883">x</span><span class="op" id="3714884">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714890">return</span>&nbsp;<span class="ident" id="3714897">z</span><span class="op" id="3714898">.</span><span class="ident" id="3714899">mul</span><span class="op" id="3714902">(</span><span class="ident" id="3714903">x</span><span class="op" id="3714904">,</span>&nbsp;<span class="ident" id="3714906">y</span><span class="op" id="3714907">)</span><br>
<span class="lineno"></span><span class="op" id="3714909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3714912">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="3714940">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3715011">func</span>&nbsp;<span class="ident" id="3715016">scaleDenom</span><span class="op" id="3715026">(</span><span class="ident" id="3715027">x</span>&nbsp;<span class="op" id="3715029">*</span><span class="ident" id="3715030">Int</span><span class="op" id="3715033">,</span>&nbsp;<span class="ident" id="3715035">f</span>&nbsp;<span class="ident" id="3715037">nat</span><span class="op" id="3715040">)</span>&nbsp;<span class="op" id="3715042">*</span><span class="ident" id="3715043">Int</span>&nbsp;<span class="op" id="3715047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715050">var</span>&nbsp;<span class="ident" id="3715054">z</span>&nbsp;<span class="ident" id="3715056">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715061">if</span>&nbsp;<span class="builtinfunc" id="3715064">len</span><span class="op" id="3715067">(</span><span class="ident" id="3715068">f</span><span class="op" id="3715069">)</span>&nbsp;<span class="op" id="3715071">==</span>&nbsp;<span class="num" id="3715074">0</span>&nbsp;<span class="op" id="3715076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715080">return</span>&nbsp;<span class="ident" id="3715087">z</span><span class="op" id="3715088">.</span><span class="ident" id="3715089">Set</span><span class="op" id="3715092">(</span><span class="ident" id="3715093">x</span><span class="op" id="3715094">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715100">z</span><span class="op" id="3715101">.</span><span class="ident" id="3715102">abs</span>&nbsp;<span class="op" id="3715106">=</span>&nbsp;<span class="ident" id="3715108">z</span><span class="op" id="3715109">.</span><span class="ident" id="3715110">abs</span><span class="op" id="3715113">.</span><span class="ident" id="3715114">mul</span><span class="op" id="3715117">(</span><span class="ident" id="3715118">x</span><span class="op" id="3715119">.</span><span class="ident" id="3715120">abs</span><span class="op" id="3715123">,</span>&nbsp;<span class="ident" id="3715125">f</span><span class="op" id="3715126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715129">z</span><span class="op" id="3715130">.</span><span class="ident" id="3715131">neg</span>&nbsp;<span class="op" id="3715135">=</span>&nbsp;<span class="ident" id="3715137">x</span><span class="op" id="3715138">.</span><span class="ident" id="3715139">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715144">return</span>&nbsp;<span class="op" id="3715151">&amp;</span><span class="ident" id="3715152">z</span><br>
<span class="lineno"></span><span class="op" id="3715154">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="3715157">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="3715194">//</span><br>
<span class="lineno"></span><span class="comment" id="3715197">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3715215">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="3715233">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3715251">//</span><br>
<span class="lineno"></span><span class="keyword" id="3715254">func</span>&nbsp;<span class="op" id="3715259">(</span><span class="ident" id="3715260">x</span>&nbsp;<span class="op" id="3715262">*</span><span class="ident" id="3715263">Rat</span><span class="op" id="3715266">)</span>&nbsp;<span class="ident" id="3715268">Cmp</span><span class="op" id="3715271">(</span><span class="ident" id="3715272">y</span>&nbsp;<span class="op" id="3715274">*</span><span class="ident" id="3715275">Rat</span><span class="op" id="3715278">)</span>&nbsp;<span class="builtintype" id="3715280">int</span>&nbsp;<span class="op" id="3715284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715287">return</span>&nbsp;<span class="ident" id="3715294">scaleDenom</span><span class="op" id="3715304">(</span><span class="op" id="3715305">&amp;</span><span class="ident" id="3715306">x</span><span class="op" id="3715307">.</span><span class="ident" id="3715308">a</span><span class="op" id="3715309">,</span>&nbsp;<span class="ident" id="3715311">y</span><span class="op" id="3715312">.</span><span class="ident" id="3715313">b</span><span class="op" id="3715314">.</span><span class="ident" id="3715315">abs</span><span class="op" id="3715318">)</span><span class="op" id="3715319">.</span><span class="ident" id="3715320">Cmp</span><span class="op" id="3715323">(</span><span class="ident" id="3715324">scaleDenom</span><span class="op" id="3715334">(</span><span class="op" id="3715335">&amp;</span><span class="ident" id="3715336">y</span><span class="op" id="3715337">.</span><span class="ident" id="3715338">a</span><span class="op" id="3715339">,</span>&nbsp;<span class="ident" id="3715341">x</span><span class="op" id="3715342">.</span><span class="ident" id="3715343">b</span><span class="op" id="3715344">.</span><span class="ident" id="3715345">abs</span><span class="op" id="3715348">)</span><span class="op" id="3715349">)</span><br>
<span class="lineno"></span><span class="op" id="3715351">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3715354">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3715398">func</span>&nbsp;<span class="op" id="3715403">(</span><span class="ident" id="3715404">z</span>&nbsp;<span class="op" id="3715406">*</span><span class="ident" id="3715407">Rat</span><span class="op" id="3715410">)</span>&nbsp;<span class="ident" id="3715412">Add</span><span class="op" id="3715415">(</span><span class="ident" id="3715416">x</span><span class="op" id="3715417">,</span>&nbsp;<span class="ident" id="3715419">y</span>&nbsp;<span class="op" id="3715421">*</span><span class="ident" id="3715422">Rat</span><span class="op" id="3715425">)</span>&nbsp;<span class="op" id="3715427">*</span><span class="ident" id="3715428">Rat</span>&nbsp;<span class="op" id="3715432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715435">a1</span>&nbsp;<span class="op" id="3715438">:=</span>&nbsp;<span class="ident" id="3715441">scaleDenom</span><span class="op" id="3715451">(</span><span class="op" id="3715452">&amp;</span><span class="ident" id="3715453">x</span><span class="op" id="3715454">.</span><span class="ident" id="3715455">a</span><span class="op" id="3715456">,</span>&nbsp;<span class="ident" id="3715458">y</span><span class="op" id="3715459">.</span><span class="ident" id="3715460">b</span><span class="op" id="3715461">.</span><span class="ident" id="3715462">abs</span><span class="op" id="3715465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715468">a2</span>&nbsp;<span class="op" id="3715471">:=</span>&nbsp;<span class="ident" id="3715474">scaleDenom</span><span class="op" id="3715484">(</span><span class="op" id="3715485">&amp;</span><span class="ident" id="3715486">y</span><span class="op" id="3715487">.</span><span class="ident" id="3715488">a</span><span class="op" id="3715489">,</span>&nbsp;<span class="ident" id="3715491">x</span><span class="op" id="3715492">.</span><span class="ident" id="3715493">b</span><span class="op" id="3715494">.</span><span class="ident" id="3715495">abs</span><span class="op" id="3715498">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715501">z</span><span class="op" id="3715502">.</span><span class="ident" id="3715503">a</span><span class="op" id="3715504">.</span><span class="ident" id="3715505">Add</span><span class="op" id="3715508">(</span><span class="ident" id="3715509">a1</span><span class="op" id="3715511">,</span>&nbsp;<span class="ident" id="3715513">a2</span><span class="op" id="3715515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715518">z</span><span class="op" id="3715519">.</span><span class="ident" id="3715520">b</span><span class="op" id="3715521">.</span><span class="ident" id="3715522">abs</span>&nbsp;<span class="op" id="3715526">=</span>&nbsp;<span class="ident" id="3715528">mulDenom</span><span class="op" id="3715536">(</span><span class="ident" id="3715537">z</span><span class="op" id="3715538">.</span><span class="ident" id="3715539">b</span><span class="op" id="3715540">.</span><span class="ident" id="3715541">abs</span><span class="op" id="3715544">,</span>&nbsp;<span class="ident" id="3715546">x</span><span class="op" id="3715547">.</span><span class="ident" id="3715548">b</span><span class="op" id="3715549">.</span><span class="ident" id="3715550">abs</span><span class="op" id="3715553">,</span>&nbsp;<span class="ident" id="3715555">y</span><span class="op" id="3715556">.</span><span class="ident" id="3715557">b</span><span class="op" id="3715558">.</span><span class="ident" id="3715559">abs</span><span class="op" id="3715562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715565">return</span>&nbsp;<span class="ident" id="3715572">z</span><span class="op" id="3715573">.</span><span class="ident" id="3715574">norm</span><span class="op" id="3715578">(</span><span class="op" id="3715579">)</span><br>
<span class="lineno"></span><span class="op" id="3715581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="3715584">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3715635">func</span>&nbsp;<span class="op" id="3715640">(</span><span class="ident" id="3715641">z</span>&nbsp;<span class="op" id="3715643">*</span><span class="ident" id="3715644">Rat</span><span class="op" id="3715647">)</span>&nbsp;<span class="ident" id="3715649">Sub</span><span class="op" id="3715652">(</span><span class="ident" id="3715653">x</span><span class="op" id="3715654">,</span>&nbsp;<span class="ident" id="3715656">y</span>&nbsp;<span class="op" id="3715658">*</span><span class="ident" id="3715659">Rat</span><span class="op" id="3715662">)</span>&nbsp;<span class="op" id="3715664">*</span><span class="ident" id="3715665">Rat</span>&nbsp;<span class="op" id="3715669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715672">a1</span>&nbsp;<span class="op" id="3715675">:=</span>&nbsp;<span class="ident" id="3715678">scaleDenom</span><span class="op" id="3715688">(</span><span class="op" id="3715689">&amp;</span><span class="ident" id="3715690">x</span><span class="op" id="3715691">.</span><span class="ident" id="3715692">a</span><span class="op" id="3715693">,</span>&nbsp;<span class="ident" id="3715695">y</span><span class="op" id="3715696">.</span><span class="ident" id="3715697">b</span><span class="op" id="3715698">.</span><span class="ident" id="3715699">abs</span><span class="op" id="3715702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715705">a2</span>&nbsp;<span class="op" id="3715708">:=</span>&nbsp;<span class="ident" id="3715711">scaleDenom</span><span class="op" id="3715721">(</span><span class="op" id="3715722">&amp;</span><span class="ident" id="3715723">y</span><span class="op" id="3715724">.</span><span class="ident" id="3715725">a</span><span class="op" id="3715726">,</span>&nbsp;<span class="ident" id="3715728">x</span><span class="op" id="3715729">.</span><span class="ident" id="3715730">b</span><span class="op" id="3715731">.</span><span class="ident" id="3715732">abs</span><span class="op" id="3715735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715738">z</span><span class="op" id="3715739">.</span><span class="ident" id="3715740">a</span><span class="op" id="3715741">.</span><span class="ident" id="3715742">Sub</span><span class="op" id="3715745">(</span><span class="ident" id="3715746">a1</span><span class="op" id="3715748">,</span>&nbsp;<span class="ident" id="3715750">a2</span><span class="op" id="3715752">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715755">z</span><span class="op" id="3715756">.</span><span class="ident" id="3715757">b</span><span class="op" id="3715758">.</span><span class="ident" id="3715759">abs</span>&nbsp;<span class="op" id="3715763">=</span>&nbsp;<span class="ident" id="3715765">mulDenom</span><span class="op" id="3715773">(</span><span class="ident" id="3715774">z</span><span class="op" id="3715775">.</span><span class="ident" id="3715776">b</span><span class="op" id="3715777">.</span><span class="ident" id="3715778">abs</span><span class="op" id="3715781">,</span>&nbsp;<span class="ident" id="3715783">x</span><span class="op" id="3715784">.</span><span class="ident" id="3715785">b</span><span class="op" id="3715786">.</span><span class="ident" id="3715787">abs</span><span class="op" id="3715790">,</span>&nbsp;<span class="ident" id="3715792">y</span><span class="op" id="3715793">.</span><span class="ident" id="3715794">b</span><span class="op" id="3715795">.</span><span class="ident" id="3715796">abs</span><span class="op" id="3715799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715802">return</span>&nbsp;<span class="ident" id="3715809">z</span><span class="op" id="3715810">.</span><span class="ident" id="3715811">norm</span><span class="op" id="3715815">(</span><span class="op" id="3715816">)</span><br>
<span class="lineno"></span><span class="op" id="3715818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3715821">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="3715869">func</span>&nbsp;<span class="op" id="3715874">(</span><span class="ident" id="3715875">z</span>&nbsp;<span class="op" id="3715877">*</span><span class="ident" id="3715878">Rat</span><span class="op" id="3715881">)</span>&nbsp;<span class="ident" id="3715883">Mul</span><span class="op" id="3715886">(</span><span class="ident" id="3715887">x</span><span class="op" id="3715888">,</span>&nbsp;<span class="ident" id="3715890">y</span>&nbsp;<span class="op" id="3715892">*</span><span class="ident" id="3715893">Rat</span><span class="op" id="3715896">)</span>&nbsp;<span class="op" id="3715898">*</span><span class="ident" id="3715899">Rat</span>&nbsp;<span class="op" id="3715903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715906">z</span><span class="op" id="3715907">.</span><span class="ident" id="3715908">a</span><span class="op" id="3715909">.</span><span class="ident" id="3715910">Mul</span><span class="op" id="3715913">(</span><span class="op" id="3715914">&amp;</span><span class="ident" id="3715915">x</span><span class="op" id="3715916">.</span><span class="ident" id="3715917">a</span><span class="op" id="3715918">,</span>&nbsp;<span class="op" id="3715920">&amp;</span><span class="ident" id="3715921">y</span><span class="op" id="3715922">.</span><span class="ident" id="3715923">a</span><span class="op" id="3715924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715927">z</span><span class="op" id="3715928">.</span><span class="ident" id="3715929">b</span><span class="op" id="3715930">.</span><span class="ident" id="3715931">abs</span>&nbsp;<span class="op" id="3715935">=</span>&nbsp;<span class="ident" id="3715937">mulDenom</span><span class="op" id="3715945">(</span><span class="ident" id="3715946">z</span><span class="op" id="3715947">.</span><span class="ident" id="3715948">b</span><span class="op" id="3715949">.</span><span class="ident" id="3715950">abs</span><span class="op" id="3715953">,</span>&nbsp;<span class="ident" id="3715955">x</span><span class="op" id="3715956">.</span><span class="ident" id="3715957">b</span><span class="op" id="3715958">.</span><span class="ident" id="3715959">abs</span><span class="op" id="3715962">,</span>&nbsp;<span class="ident" id="3715964">y</span><span class="op" id="3715965">.</span><span class="ident" id="3715966">b</span><span class="op" id="3715967">.</span><span class="ident" id="3715968">abs</span><span class="op" id="3715971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715974">return</span>&nbsp;<span class="ident" id="3715981">z</span><span class="op" id="3715982">.</span><span class="ident" id="3715983">norm</span><span class="op" id="3715987">(</span><span class="op" id="3715988">)</span><br>
<span class="lineno"></span><span class="op" id="3715990">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3715993">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3716042">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="3716098">func</span>&nbsp;<span class="op" id="3716103">(</span><span class="ident" id="3716104">z</span>&nbsp;<span class="op" id="3716106">*</span><span class="ident" id="3716107">Rat</span><span class="op" id="3716110">)</span>&nbsp;<span class="ident" id="3716112">Quo</span><span class="op" id="3716115">(</span><span class="ident" id="3716116">x</span><span class="op" id="3716117">,</span>&nbsp;<span class="ident" id="3716119">y</span>&nbsp;<span class="op" id="3716121">*</span><span class="ident" id="3716122">Rat</span><span class="op" id="3716125">)</span>&nbsp;<span class="op" id="3716127">*</span><span class="ident" id="3716128">Rat</span>&nbsp;<span class="op" id="3716132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716135">if</span>&nbsp;<span class="builtinfunc" id="3716138">len</span><span class="op" id="3716141">(</span><span class="ident" id="3716142">y</span><span class="op" id="3716143">.</span><span class="ident" id="3716144">a</span><span class="op" id="3716145">.</span><span class="ident" id="3716146">abs</span><span class="op" id="3716149">)</span>&nbsp;<span class="op" id="3716151">==</span>&nbsp;<span class="num" id="3716154">0</span>&nbsp;<span class="op" id="3716156">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3716160">panic</span><span class="op" id="3716165">(</span><span class="string" id="3716166">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3716184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716190">a</span>&nbsp;<span class="op" id="3716192">:=</span>&nbsp;<span class="ident" id="3716195">scaleDenom</span><span class="op" id="3716205">(</span><span class="op" id="3716206">&amp;</span><span class="ident" id="3716207">x</span><span class="op" id="3716208">.</span><span class="ident" id="3716209">a</span><span class="op" id="3716210">,</span>&nbsp;<span class="ident" id="3716212">y</span><span class="op" id="3716213">.</span><span class="ident" id="3716214">b</span><span class="op" id="3716215">.</span><span class="ident" id="3716216">abs</span><span class="op" id="3716219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716222">b</span>&nbsp;<span class="op" id="3716224">:=</span>&nbsp;<span class="ident" id="3716227">scaleDenom</span><span class="op" id="3716237">(</span><span class="op" id="3716238">&amp;</span><span class="ident" id="3716239">y</span><span class="op" id="3716240">.</span><span class="ident" id="3716241">a</span><span class="op" id="3716242">,</span>&nbsp;<span class="ident" id="3716244">x</span><span class="op" id="3716245">.</span><span class="ident" id="3716246">b</span><span class="op" id="3716247">.</span><span class="ident" id="3716248">abs</span><span class="op" id="3716251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716254">z</span><span class="op" id="3716255">.</span><span class="ident" id="3716256">a</span><span class="op" id="3716257">.</span><span class="ident" id="3716258">abs</span>&nbsp;<span class="op" id="3716262">=</span>&nbsp;<span class="ident" id="3716264">a</span><span class="op" id="3716265">.</span><span class="ident" id="3716266">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716271">z</span><span class="op" id="3716272">.</span><span class="ident" id="3716273">b</span><span class="op" id="3716274">.</span><span class="ident" id="3716275">abs</span>&nbsp;<span class="op" id="3716279">=</span>&nbsp;<span class="ident" id="3716281">b</span><span class="op" id="3716282">.</span><span class="ident" id="3716283">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716288">z</span><span class="op" id="3716289">.</span><span class="ident" id="3716290">a</span><span class="op" id="3716291">.</span><span class="ident" id="3716292">neg</span>&nbsp;<span class="op" id="3716296">=</span>&nbsp;<span class="ident" id="3716298">a</span><span class="op" id="3716299">.</span><span class="ident" id="3716300">neg</span>&nbsp;<span class="op" id="3716304">!=</span>&nbsp;<span class="ident" id="3716307">b</span><span class="op" id="3716308">.</span><span class="ident" id="3716309">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716314">return</span>&nbsp;<span class="ident" id="3716321">z</span><span class="op" id="3716322">.</span><span class="ident" id="3716323">norm</span><span class="op" id="3716327">(</span><span class="op" id="3716328">)</span><br>
<span class="lineno"></span><span class="op" id="3716330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="3716333">func</span>&nbsp;<span class="ident" id="3716338">ratTok</span><span class="op" id="3716344">(</span><span class="ident" id="3716345">ch</span>&nbsp;<span class="builtintype" id="3716348">rune</span><span class="op" id="3716352">)</span>&nbsp;<span class="builtintype" id="3716354">bool</span>&nbsp;<span class="op" id="3716359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716362">return</span>&nbsp;<span class="ident" id="3716369">strings</span><span class="op" id="3716376">.</span><span class="ident" id="3716377">IndexRune</span><span class="op" id="3716386">(</span><span class="string" id="3716387">&#34;+-/0123456789.eE&#34;</span><span class="op" id="3716405">,</span>&nbsp;<span class="ident" id="3716407">ch</span><span class="op" id="3716409">)</span>&nbsp;<span class="op" id="3716411">&gt;=</span>&nbsp;<span class="num" id="3716414">0</span><br>
<span class="lineno"></span><span class="op" id="3716416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3716419">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="3716488">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="3716558">func</span>&nbsp;<span class="op" id="3716563">(</span><span class="ident" id="3716564">z</span>&nbsp;<span class="op" id="3716566">*</span><span class="ident" id="3716567">Rat</span><span class="op" id="3716570">)</span>&nbsp;<span class="ident" id="3716572">Scan</span><span class="op" id="3716576">(</span><span class="ident" id="3716577">s</span>&nbsp;<span class="ident" id="3716579">fmt</span><span class="op" id="3716582">.</span><span class="ident" id="3716583">ScanState</span><span class="op" id="3716592">,</span>&nbsp;<span class="ident" id="3716594">ch</span>&nbsp;<span class="builtintype" id="3716597">rune</span><span class="op" id="3716601">)</span>&nbsp;<span class="builtintype" id="3716603">error</span>&nbsp;<span class="op" id="3716609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716612">tok</span><span class="op" id="3716615">,</span>&nbsp;<span class="ident" id="3716617">err</span>&nbsp;<span class="op" id="3716621">:=</span>&nbsp;<span class="ident" id="3716624">s</span><span class="op" id="3716625">.</span><span class="ident" id="3716626">Token</span><span class="op" id="3716631">(</span><span class="builtintype" id="3716632">true</span><span class="op" id="3716636">,</span>&nbsp;<span class="ident" id="3716638">ratTok</span><span class="op" id="3716644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716647">if</span>&nbsp;<span class="ident" id="3716650">err</span>&nbsp;<span class="op" id="3716654">!=</span>&nbsp;<span class="ident" id="3716657">nil</span>&nbsp;<span class="op" id="3716661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716665">return</span>&nbsp;<span class="ident" id="3716672">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716680">if</span>&nbsp;<span class="ident" id="3716683">strings</span><span class="op" id="3716690">.</span><span class="ident" id="3716691">IndexRune</span><span class="op" id="3716700">(</span><span class="string" id="3716701">&#34;efgEFGv&#34;</span><span class="op" id="3716710">,</span>&nbsp;<span class="ident" id="3716712">ch</span><span class="op" id="3716714">)</span>&nbsp;<span class="op" id="3716716">&lt;</span>&nbsp;<span class="num" id="3716718">0</span>&nbsp;<span class="op" id="3716720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716724">return</span>&nbsp;<span class="ident" id="3716731">errors</span><span class="op" id="3716737">.</span><span class="ident" id="3716738">New</span><span class="op" id="3716741">(</span><span class="string" id="3716742">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="3716766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716772">if</span>&nbsp;<span class="ident" id="3716775">_</span><span class="op" id="3716776">,</span>&nbsp;<span class="ident" id="3716778">ok</span>&nbsp;<span class="op" id="3716781">:=</span>&nbsp;<span class="ident" id="3716784">z</span><span class="op" id="3716785">.</span><span class="ident" id="3716786">SetString</span><span class="op" id="3716795">(</span><span class="builtintype" id="3716796">string</span><span class="op" id="3716802">(</span><span class="ident" id="3716803">tok</span><span class="op" id="3716806">)</span><span class="op" id="3716807">)</span><span class="op" id="3716808">;</span>&nbsp;<span class="op" id="3716810">!</span><span class="ident" id="3716811">ok</span>&nbsp;<span class="op" id="3716814">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716818">return</span>&nbsp;<span class="ident" id="3716825">errors</span><span class="op" id="3716831">.</span><span class="ident" id="3716832">New</span><span class="op" id="3716835">(</span><span class="string" id="3716836">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="3716862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716868">return</span>&nbsp;<span class="ident" id="3716875">nil</span><br>
<span class="lineno"></span><span class="op" id="3716879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3716882">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3716959">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3717036">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3717113">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3717162">func</span>&nbsp;<span class="op" id="3717167">(</span><span class="ident" id="3717168">z</span>&nbsp;<span class="op" id="3717170">*</span><span class="ident" id="3717171">Rat</span><span class="op" id="3717174">)</span>&nbsp;<span class="ident" id="3717176">SetString</span><span class="op" id="3717185">(</span><span class="ident" id="3717186">s</span>&nbsp;<span class="builtintype" id="3717188">string</span><span class="op" id="3717194">)</span>&nbsp;<span class="op" id="3717196">(</span><span class="op" id="3717197">*</span><span class="ident" id="3717198">Rat</span><span class="op" id="3717201">,</span>&nbsp;<span class="builtintype" id="3717203">bool</span><span class="op" id="3717207">)</span>&nbsp;<span class="op" id="3717209">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717212">if</span>&nbsp;<span class="builtinfunc" id="3717215">len</span><span class="op" id="3717218">(</span><span class="ident" id="3717219">s</span><span class="op" id="3717220">)</span>&nbsp;<span class="op" id="3717222">==</span>&nbsp;<span class="num" id="3717225">0</span>&nbsp;<span class="op" id="3717227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717231">return</span>&nbsp;<span class="ident" id="3717238">nil</span><span class="op" id="3717241">,</span>&nbsp;<span class="builtintype" id="3717243">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717254">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717279">sep</span>&nbsp;<span class="op" id="3717283">:=</span>&nbsp;<span class="ident" id="3717286">strings</span><span class="op" id="3717293">.</span><span class="ident" id="3717294">Index</span><span class="op" id="3717299">(</span><span class="ident" id="3717300">s</span><span class="op" id="3717301">,</span>&nbsp;<span class="string" id="3717303">&#34;/&#34;</span><span class="op" id="3717306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717309">if</span>&nbsp;<span class="ident" id="3717312">sep</span>&nbsp;<span class="op" id="3717316">&gt;=</span>&nbsp;<span class="num" id="3717319">0</span>&nbsp;<span class="op" id="3717321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717325">if</span>&nbsp;<span class="ident" id="3717328">_</span><span class="op" id="3717329">,</span>&nbsp;<span class="ident" id="3717331">ok</span>&nbsp;<span class="op" id="3717334">:=</span>&nbsp;<span class="ident" id="3717337">z</span><span class="op" id="3717338">.</span><span class="ident" id="3717339">a</span><span class="op" id="3717340">.</span><span class="ident" id="3717341">SetString</span><span class="op" id="3717350">(</span><span class="ident" id="3717351">s</span><span class="op" id="3717352">[</span><span class="num" id="3717353">0</span><span class="op" id="3717354">:</span><span class="ident" id="3717355">sep</span><span class="op" id="3717358">]</span><span class="op" id="3717359">,</span>&nbsp;<span class="num" id="3717361">10</span><span class="op" id="3717363">)</span><span class="op" id="3717364">;</span>&nbsp;<span class="op" id="3717366">!</span><span class="ident" id="3717367">ok</span>&nbsp;<span class="op" id="3717370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717375">return</span>&nbsp;<span class="ident" id="3717382">nil</span><span class="op" id="3717385">,</span>&nbsp;<span class="builtintype" id="3717387">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717395">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717399">s</span>&nbsp;<span class="op" id="3717401">=</span>&nbsp;<span class="ident" id="3717403">s</span><span class="op" id="3717404">[</span><span class="ident" id="3717405">sep</span><span class="op" id="3717408">+</span><span class="num" id="3717409">1</span><span class="op" id="3717410">:</span><span class="op" id="3717411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717415">var</span>&nbsp;<span class="ident" id="3717419">err</span>&nbsp;<span class="builtintype" id="3717423">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717431">if</span>&nbsp;<span class="ident" id="3717434">z</span><span class="op" id="3717435">.</span><span class="ident" id="3717436">b</span><span class="op" id="3717437">.</span><span class="ident" id="3717438">abs</span><span class="op" id="3717441">,</span>&nbsp;<span class="ident" id="3717443">_</span><span class="op" id="3717444">,</span>&nbsp;<span class="ident" id="3717446">err</span>&nbsp;<span class="op" id="3717450">=</span>&nbsp;<span class="ident" id="3717452">z</span><span class="op" id="3717453">.</span><span class="ident" id="3717454">b</span><span class="op" id="3717455">.</span><span class="ident" id="3717456">abs</span><span class="op" id="3717459">.</span><span class="ident" id="3717460">scan</span><span class="op" id="3717464">(</span><span class="ident" id="3717465">strings</span><span class="op" id="3717472">.</span><span class="ident" id="3717473">NewReader</span><span class="op" id="3717482">(</span><span class="ident" id="3717483">s</span><span class="op" id="3717484">)</span><span class="op" id="3717485">,</span>&nbsp;<span class="num" id="3717487">10</span><span class="op" id="3717489">)</span><span class="op" id="3717490">;</span>&nbsp;<span class="ident" id="3717492">err</span>&nbsp;<span class="op" id="3717496">!=</span>&nbsp;<span class="ident" id="3717499">nil</span>&nbsp;<span class="op" id="3717503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717508">return</span>&nbsp;<span class="ident" id="3717515">nil</span><span class="op" id="3717518">,</span>&nbsp;<span class="builtintype" id="3717520">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717528">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717532">if</span>&nbsp;<span class="builtinfunc" id="3717535">len</span><span class="op" id="3717538">(</span><span class="ident" id="3717539">z</span><span class="op" id="3717540">.</span><span class="ident" id="3717541">b</span><span class="op" id="3717542">.</span><span class="ident" id="3717543">abs</span><span class="op" id="3717546">)</span>&nbsp;<span class="op" id="3717548">==</span>&nbsp;<span class="num" id="3717551">0</span>&nbsp;<span class="op" id="3717553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717558">return</span>&nbsp;<span class="ident" id="3717565">nil</span><span class="op" id="3717568">,</span>&nbsp;<span class="builtintype" id="3717570">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717582">return</span>&nbsp;<span class="ident" id="3717589">z</span><span class="op" id="3717590">.</span><span class="ident" id="3717591">norm</span><span class="op" id="3717595">(</span><span class="op" id="3717596">)</span><span class="op" id="3717597">,</span>&nbsp;<span class="builtintype" id="3717599">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717605">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717609">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717639">sep</span>&nbsp;<span class="op" id="3717643">=</span>&nbsp;<span class="ident" id="3717645">strings</span><span class="op" id="3717652">.</span><span class="ident" id="3717653">Index</span><span class="op" id="3717658">(</span><span class="ident" id="3717659">s</span><span class="op" id="3717660">,</span>&nbsp;<span class="string" id="3717662">&#34;.&#34;</span><span class="op" id="3717665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717668">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717694">e</span>&nbsp;<span class="op" id="3717696">:=</span>&nbsp;<span class="ident" id="3717699">strings</span><span class="op" id="3717706">.</span><span class="ident" id="3717707">IndexAny</span><span class="op" id="3717715">(</span><span class="ident" id="3717716">s</span><span class="op" id="3717717">,</span>&nbsp;<span class="string" id="3717719">&#34;eE&#34;</span><span class="op" id="3717723">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717726">var</span>&nbsp;<span class="ident" id="3717730">exp</span>&nbsp;<span class="ident" id="3717734">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717739">if</span>&nbsp;<span class="ident" id="3717742">e</span>&nbsp;<span class="op" id="3717744">&gt;=</span>&nbsp;<span class="num" id="3717747">0</span>&nbsp;<span class="op" id="3717749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717753">if</span>&nbsp;<span class="ident" id="3717756">e</span>&nbsp;<span class="op" id="3717758">&lt;</span>&nbsp;<span class="ident" id="3717760">sep</span>&nbsp;<span class="op" id="3717764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717769">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717816">return</span>&nbsp;<span class="ident" id="3717823">nil</span><span class="op" id="3717826">,</span>&nbsp;<span class="builtintype" id="3717828">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717840">if</span>&nbsp;<span class="ident" id="3717843">_</span><span class="op" id="3717844">,</span>&nbsp;<span class="ident" id="3717846">ok</span>&nbsp;<span class="op" id="3717849">:=</span>&nbsp;<span class="ident" id="3717852">exp</span><span class="op" id="3717855">.</span><span class="ident" id="3717856">SetString</span><span class="op" id="3717865">(</span><span class="ident" id="3717866">s</span><span class="op" id="3717867">[</span><span class="ident" id="3717868">e</span><span class="op" id="3717869">+</span><span class="num" id="3717870">1</span><span class="op" id="3717871">:</span><span class="op" id="3717872">]</span><span class="op" id="3717873">,</span>&nbsp;<span class="num" id="3717875">10</span><span class="op" id="3717877">)</span><span class="op" id="3717878">;</span>&nbsp;<span class="op" id="3717880">!</span><span class="ident" id="3717881">ok</span>&nbsp;<span class="op" id="3717884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717889">return</span>&nbsp;<span class="ident" id="3717896">nil</span><span class="op" id="3717899">,</span>&nbsp;<span class="builtintype" id="3717901">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717913">s</span>&nbsp;<span class="op" id="3717915">=</span>&nbsp;<span class="ident" id="3717917">s</span><span class="op" id="3717918">[</span><span class="num" id="3717919">0</span><span class="op" id="3717920">:</span><span class="ident" id="3717921">e</span><span class="op" id="3717922">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717928">if</span>&nbsp;<span class="ident" id="3717931">sep</span>&nbsp;<span class="op" id="3717935">&gt;=</span>&nbsp;<span class="num" id="3717938">0</span>&nbsp;<span class="op" id="3717940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717944">s</span>&nbsp;<span class="op" id="3717946">=</span>&nbsp;<span class="ident" id="3717948">s</span><span class="op" id="3717949">[</span><span class="num" id="3717950">0</span><span class="op" id="3717951">:</span><span class="ident" id="3717952">sep</span><span class="op" id="3717955">]</span>&nbsp;<span class="op" id="3717957">+</span>&nbsp;<span class="ident" id="3717959">s</span><span class="op" id="3717960">[</span><span class="ident" id="3717961">sep</span><span class="op" id="3717964">+</span><span class="num" id="3717965">1</span><span class="op" id="3717966">:</span><span class="op" id="3717967">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717971">exp</span><span class="op" id="3717974">.</span><span class="ident" id="3717975">Sub</span><span class="op" id="3717978">(</span><span class="op" id="3717979">&amp;</span><span class="ident" id="3717980">exp</span><span class="op" id="3717983">,</span>&nbsp;<span class="ident" id="3717985">NewInt</span><span class="op" id="3717991">(</span><span class="ident" id="3717992">int64</span><span class="op" id="3717997">(</span><span class="builtinfunc" id="3717998">len</span><span class="op" id="3718001">(</span><span class="ident" id="3718002">s</span><span class="op" id="3718003">)</span><span class="op" id="3718004">-</span><span class="ident" id="3718005">sep</span><span class="op" id="3718008">)</span><span class="op" id="3718009">)</span><span class="op" id="3718010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718013">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718017">if</span>&nbsp;<span class="ident" id="3718020">_</span><span class="op" id="3718021">,</span>&nbsp;<span class="ident" id="3718023">ok</span>&nbsp;<span class="op" id="3718026">:=</span>&nbsp;<span class="ident" id="3718029">z</span><span class="op" id="3718030">.</span><span class="ident" id="3718031">a</span><span class="op" id="3718032">.</span><span class="ident" id="3718033">SetString</span><span class="op" id="3718042">(</span><span class="ident" id="3718043">s</span><span class="op" id="3718044">,</span>&nbsp;<span class="num" id="3718046">10</span><span class="op" id="3718048">)</span><span class="op" id="3718049">;</span>&nbsp;<span class="op" id="3718051">!</span><span class="ident" id="3718052">ok</span>&nbsp;<span class="op" id="3718055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718059">return</span>&nbsp;<span class="ident" id="3718066">nil</span><span class="op" id="3718069">,</span>&nbsp;<span class="builtintype" id="3718071">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718081">powTen</span>&nbsp;<span class="op" id="3718088">:=</span>&nbsp;<span class="ident" id="3718091">nat</span><span class="op" id="3718094">(</span><span class="ident" id="3718095">nil</span><span class="op" id="3718098">)</span><span class="op" id="3718099">.</span><span class="ident" id="3718100">expNN</span><span class="op" id="3718105">(</span><span class="ident" id="3718106">natTen</span><span class="op" id="3718112">,</span>&nbsp;<span class="ident" id="3718114">exp</span><span class="op" id="3718117">.</span><span class="ident" id="3718118">abs</span><span class="op" id="3718121">,</span>&nbsp;<span class="ident" id="3718123">nil</span><span class="op" id="3718126">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718129">if</span>&nbsp;<span class="ident" id="3718132">exp</span><span class="op" id="3718135">.</span><span class="ident" id="3718136">neg</span>&nbsp;<span class="op" id="3718140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718144">z</span><span class="op" id="3718145">.</span><span class="ident" id="3718146">b</span><span class="op" id="3718147">.</span><span class="ident" id="3718148">abs</span>&nbsp;<span class="op" id="3718152">=</span>&nbsp;<span class="ident" id="3718154">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718163">z</span><span class="op" id="3718164">.</span><span class="ident" id="3718165">norm</span><span class="op" id="3718169">(</span><span class="op" id="3718170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718173">}</span>&nbsp;<span class="keyword" id="3718175">else</span>&nbsp;<span class="op" id="3718180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718184">z</span><span class="op" id="3718185">.</span><span class="ident" id="3718186">a</span><span class="op" id="3718187">.</span><span class="ident" id="3718188">abs</span>&nbsp;<span class="op" id="3718192">=</span>&nbsp;<span class="ident" id="3718194">z</span><span class="op" id="3718195">.</span><span class="ident" id="3718196">a</span><span class="op" id="3718197">.</span><span class="ident" id="3718198">abs</span><span class="op" id="3718201">.</span><span class="ident" id="3718202">mul</span><span class="op" id="3718205">(</span><span class="ident" id="3718206">z</span><span class="op" id="3718207">.</span><span class="ident" id="3718208">a</span><span class="op" id="3718209">.</span><span class="ident" id="3718210">abs</span><span class="op" id="3718213">,</span>&nbsp;<span class="ident" id="3718215">powTen</span><span class="op" id="3718221">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718225">z</span><span class="op" id="3718226">.</span><span class="ident" id="3718227">b</span><span class="op" id="3718228">.</span><span class="ident" id="3718229">abs</span>&nbsp;<span class="op" id="3718233">=</span>&nbsp;<span class="ident" id="3718235">z</span><span class="op" id="3718236">.</span><span class="ident" id="3718237">b</span><span class="op" id="3718238">.</span><span class="ident" id="3718239">abs</span><span class="op" id="3718242">.</span><span class="builtinfunc" id="3718243">make</span><span class="op" id="3718247">(</span><span class="num" id="3718248">0</span><span class="op" id="3718249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718256">return</span>&nbsp;<span class="ident" id="3718263">z</span><span class="op" id="3718264">,</span>&nbsp;<span class="builtintype" id="3718266">true</span><br>
<span class="lineno"></span><span class="op" id="3718271">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="3718274">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="3718357">func</span>&nbsp;<span class="op" id="3718362">(</span><span class="ident" id="3718363">x</span>&nbsp;<span class="op" id="3718365">*</span><span class="ident" id="3718366">Rat</span><span class="op" id="3718369">)</span>&nbsp;<span class="ident" id="3718371">String</span><span class="op" id="3718377">(</span><span class="op" id="3718378">)</span>&nbsp;<span class="builtintype" id="3718380">string</span>&nbsp;<span class="op" id="3718387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718390">s</span>&nbsp;<span class="op" id="3718392">:=</span>&nbsp;<span class="string" id="3718395">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718401">if</span>&nbsp;<span class="builtinfunc" id="3718404">len</span><span class="op" id="3718407">(</span><span class="ident" id="3718408">x</span><span class="op" id="3718409">.</span><span class="ident" id="3718410">b</span><span class="op" id="3718411">.</span><span class="ident" id="3718412">abs</span><span class="op" id="3718415">)</span>&nbsp;<span class="op" id="3718417">!=</span>&nbsp;<span class="num" id="3718420">0</span>&nbsp;<span class="op" id="3718422">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718426">s</span>&nbsp;<span class="op" id="3718428">=</span>&nbsp;<span class="string" id="3718430">&#34;/&#34;</span>&nbsp;<span class="op" id="3718434">+</span>&nbsp;<span class="ident" id="3718436">x</span><span class="op" id="3718437">.</span><span class="ident" id="3718438">b</span><span class="op" id="3718439">.</span><span class="ident" id="3718440">abs</span><span class="op" id="3718443">.</span><span class="ident" id="3718444">decimalString</span><span class="op" id="3718457">(</span><span class="op" id="3718458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718464">return</span>&nbsp;<span class="ident" id="3718471">x</span><span class="op" id="3718472">.</span><span class="ident" id="3718473">a</span><span class="op" id="3718474">.</span><span class="ident" id="3718475">String</span><span class="op" id="3718481">(</span><span class="op" id="3718482">)</span>&nbsp;<span class="op" id="3718484">+</span>&nbsp;<span class="ident" id="3718486">s</span><br>
<span class="lineno"></span><span class="op" id="3718488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="3718491">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="3718570">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3718604">func</span>&nbsp;<span class="op" id="3718609">(</span><span class="ident" id="3718610">x</span>&nbsp;<span class="op" id="3718612">*</span><span class="ident" id="3718613">Rat</span><span class="op" id="3718616">)</span>&nbsp;<span class="ident" id="3718618">RatString</span><span class="op" id="3718627">(</span><span class="op" id="3718628">)</span>&nbsp;<span class="builtintype" id="3718630">string</span>&nbsp;<span class="op" id="3718637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718640">if</span>&nbsp;<span class="ident" id="3718643">x</span><span class="op" id="3718644">.</span><span class="ident" id="3718645">IsInt</span><span class="op" id="3718650">(</span><span class="op" id="3718651">)</span>&nbsp;<span class="op" id="3718653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718657">return</span>&nbsp;<span class="ident" id="3718664">x</span><span class="op" id="3718665">.</span><span class="ident" id="3718666">a</span><span class="op" id="3718667">.</span><span class="ident" id="3718668">String</span><span class="op" id="3718674">(</span><span class="op" id="3718675">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718681">return</span>&nbsp;<span class="ident" id="3718688">x</span><span class="op" id="3718689">.</span><span class="ident" id="3718690">String</span><span class="op" id="3718696">(</span><span class="op" id="3718697">)</span><br>
<span class="lineno"></span><span class="op" id="3718699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3718702">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="3718780">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="3718855">func</span>&nbsp;<span class="op" id="3718860">(</span><span class="ident" id="3718861">x</span>&nbsp;<span class="op" id="3718863">*</span><span class="ident" id="3718864">Rat</span><span class="op" id="3718867">)</span>&nbsp;<span class="ident" id="3718869">FloatString</span><span class="op" id="3718880">(</span><span class="ident" id="3718881">prec</span>&nbsp;<span class="builtintype" id="3718886">int</span><span class="op" id="3718889">)</span>&nbsp;<span class="builtintype" id="3718891">string</span>&nbsp;<span class="op" id="3718898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718901">if</span>&nbsp;<span class="ident" id="3718904">x</span><span class="op" id="3718905">.</span><span class="ident" id="3718906">IsInt</span><span class="op" id="3718911">(</span><span class="op" id="3718912">)</span>&nbsp;<span class="op" id="3718914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718918">s</span>&nbsp;<span class="op" id="3718920">:=</span>&nbsp;<span class="ident" id="3718923">x</span><span class="op" id="3718924">.</span><span class="ident" id="3718925">a</span><span class="op" id="3718926">.</span><span class="ident" id="3718927">String</span><span class="op" id="3718933">(</span><span class="op" id="3718934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718938">if</span>&nbsp;<span class="ident" id="3718941">prec</span>&nbsp;<span class="op" id="3718946">&gt;</span>&nbsp;<span class="num" id="3718948">0</span>&nbsp;<span class="op" id="3718950">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718955">s</span>&nbsp;<span class="op" id="3718957">+=</span>&nbsp;<span class="string" id="3718960">&#34;.&#34;</span>&nbsp;<span class="op" id="3718964">+</span>&nbsp;<span class="ident" id="3718966">strings</span><span class="op" id="3718973">.</span><span class="ident" id="3718974">Repeat</span><span class="op" id="3718980">(</span><span class="string" id="3718981">&#34;0&#34;</span><span class="op" id="3718984">,</span>&nbsp;<span class="ident" id="3718986">prec</span><span class="op" id="3718990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718998">return</span>&nbsp;<span class="ident" id="3719005">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719011">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719029">q</span><span class="op" id="3719030">,</span>&nbsp;<span class="ident" id="3719032">r</span>&nbsp;<span class="op" id="3719034">:=</span>&nbsp;<span class="ident" id="3719037">nat</span><span class="op" id="3719040">(</span><span class="ident" id="3719041">nil</span><span class="op" id="3719044">)</span><span class="op" id="3719045">.</span><span class="ident" id="3719046">div</span><span class="op" id="3719049">(</span><span class="ident" id="3719050">nat</span><span class="op" id="3719053">(</span><span class="ident" id="3719054">nil</span><span class="op" id="3719057">)</span><span class="op" id="3719058">,</span>&nbsp;<span class="ident" id="3719060">x</span><span class="op" id="3719061">.</span><span class="ident" id="3719062">a</span><span class="op" id="3719063">.</span><span class="ident" id="3719064">abs</span><span class="op" id="3719067">,</span>&nbsp;<span class="ident" id="3719069">x</span><span class="op" id="3719070">.</span><span class="ident" id="3719071">b</span><span class="op" id="3719072">.</span><span class="ident" id="3719073">abs</span><span class="op" id="3719076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719080">p</span>&nbsp;<span class="op" id="3719082">:=</span>&nbsp;<span class="ident" id="3719085">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719093">if</span>&nbsp;<span class="ident" id="3719096">prec</span>&nbsp;<span class="op" id="3719101">&gt;</span>&nbsp;<span class="num" id="3719103">0</span>&nbsp;<span class="op" id="3719105">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719109">p</span>&nbsp;<span class="op" id="3719111">=</span>&nbsp;<span class="ident" id="3719113">nat</span><span class="op" id="3719116">(</span><span class="ident" id="3719117">nil</span><span class="op" id="3719120">)</span><span class="op" id="3719121">.</span><span class="ident" id="3719122">expNN</span><span class="op" id="3719127">(</span><span class="ident" id="3719128">natTen</span><span class="op" id="3719134">,</span>&nbsp;<span class="ident" id="3719136">nat</span><span class="op" id="3719139">(</span><span class="ident" id="3719140">nil</span><span class="op" id="3719143">)</span><span class="op" id="3719144">.</span><span class="ident" id="3719145">setUint64</span><span class="op" id="3719154">(</span><span class="ident" id="3719155">uint64</span><span class="op" id="3719161">(</span><span class="ident" id="3719162">prec</span><span class="op" id="3719166">)</span><span class="op" id="3719167">)</span><span class="op" id="3719168">,</span>&nbsp;<span class="ident" id="3719170">nil</span><span class="op" id="3719173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719180">r</span>&nbsp;<span class="op" id="3719182">=</span>&nbsp;<span class="ident" id="3719184">r</span><span class="op" id="3719185">.</span><span class="ident" id="3719186">mul</span><span class="op" id="3719189">(</span><span class="ident" id="3719190">r</span><span class="op" id="3719191">,</span>&nbsp;<span class="ident" id="3719193">p</span><span class="op" id="3719194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719197">r</span><span class="op" id="3719198">,</span>&nbsp;<span class="ident" id="3719200">r2</span>&nbsp;<span class="op" id="3719203">:=</span>&nbsp;<span class="ident" id="3719206">r</span><span class="op" id="3719207">.</span><span class="ident" id="3719208">div</span><span class="op" id="3719211">(</span><span class="ident" id="3719212">nat</span><span class="op" id="3719215">(</span><span class="ident" id="3719216">nil</span><span class="op" id="3719219">)</span><span class="op" id="3719220">,</span>&nbsp;<span class="ident" id="3719222">r</span><span class="op" id="3719223">,</span>&nbsp;<span class="ident" id="3719225">x</span><span class="op" id="3719226">.</span><span class="ident" id="3719227">b</span><span class="op" id="3719228">.</span><span class="ident" id="3719229">abs</span><span class="op" id="3719232">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719236">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719267">r2</span>&nbsp;<span class="op" id="3719270">=</span>&nbsp;<span class="ident" id="3719272">r2</span><span class="op" id="3719274">.</span><span class="ident" id="3719275">add</span><span class="op" id="3719278">(</span><span class="ident" id="3719279">r2</span><span class="op" id="3719281">,</span>&nbsp;<span class="ident" id="3719283">r2</span><span class="op" id="3719285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719288">if</span>&nbsp;<span class="ident" id="3719291">x</span><span class="op" id="3719292">.</span><span class="ident" id="3719293">b</span><span class="op" id="3719294">.</span><span class="ident" id="3719295">abs</span><span class="op" id="3719298">.</span><span class="ident" id="3719299">cmp</span><span class="op" id="3719302">(</span><span class="ident" id="3719303">r2</span><span class="op" id="3719305">)</span>&nbsp;<span class="op" id="3719307">&lt;=</span>&nbsp;<span class="num" id="3719310">0</span>&nbsp;<span class="op" id="3719312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719316">r</span>&nbsp;<span class="op" id="3719318">=</span>&nbsp;<span class="ident" id="3719320">r</span><span class="op" id="3719321">.</span><span class="ident" id="3719322">add</span><span class="op" id="3719325">(</span><span class="ident" id="3719326">r</span><span class="op" id="3719327">,</span>&nbsp;<span class="ident" id="3719329">natOne</span><span class="op" id="3719335">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719339">if</span>&nbsp;<span class="ident" id="3719342">r</span><span class="op" id="3719343">.</span><span class="ident" id="3719344">cmp</span><span class="op" id="3719347">(</span><span class="ident" id="3719348">p</span><span class="op" id="3719349">)</span>&nbsp;<span class="op" id="3719351">&gt;=</span>&nbsp;<span class="num" id="3719354">0</span>&nbsp;<span class="op" id="3719356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719361">q</span>&nbsp;<span class="op" id="3719363">=</span>&nbsp;<span class="ident" id="3719365">nat</span><span class="op" id="3719368">(</span><span class="ident" id="3719369">nil</span><span class="op" id="3719372">)</span><span class="op" id="3719373">.</span><span class="ident" id="3719374">add</span><span class="op" id="3719377">(</span><span class="ident" id="3719378">q</span><span class="op" id="3719379">,</span>&nbsp;<span class="ident" id="3719381">natOne</span><span class="op" id="3719387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719392">r</span>&nbsp;<span class="op" id="3719394">=</span>&nbsp;<span class="ident" id="3719396">nat</span><span class="op" id="3719399">(</span><span class="ident" id="3719400">nil</span><span class="op" id="3719403">)</span><span class="op" id="3719404">.</span><span class="ident" id="3719405">sub</span><span class="op" id="3719408">(</span><span class="ident" id="3719409">r</span><span class="op" id="3719410">,</span>&nbsp;<span class="ident" id="3719412">p</span><span class="op" id="3719413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719420">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719424">s</span>&nbsp;<span class="op" id="3719426">:=</span>&nbsp;<span class="ident" id="3719429">q</span><span class="op" id="3719430">.</span><span class="ident" id="3719431">decimalString</span><span class="op" id="3719444">(</span><span class="op" id="3719445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719448">if</span>&nbsp;<span class="ident" id="3719451">x</span><span class="op" id="3719452">.</span><span class="ident" id="3719453">a</span><span class="op" id="3719454">.</span><span class="ident" id="3719455">neg</span>&nbsp;<span class="op" id="3719459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719463">s</span>&nbsp;<span class="op" id="3719465">=</span>&nbsp;<span class="string" id="3719467">&#34;-&#34;</span>&nbsp;<span class="op" id="3719471">+</span>&nbsp;<span class="ident" id="3719473">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719476">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719480">if</span>&nbsp;<span class="ident" id="3719483">prec</span>&nbsp;<span class="op" id="3719488">&gt;</span>&nbsp;<span class="num" id="3719490">0</span>&nbsp;<span class="op" id="3719492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719496">rs</span>&nbsp;<span class="op" id="3719499">:=</span>&nbsp;<span class="ident" id="3719502">r</span><span class="op" id="3719503">.</span><span class="ident" id="3719504">decimalString</span><span class="op" id="3719517">(</span><span class="op" id="3719518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719522">leadingZeros</span>&nbsp;<span class="op" id="3719535">:=</span>&nbsp;<span class="ident" id="3719538">prec</span>&nbsp;<span class="op" id="3719543">-</span>&nbsp;<span class="builtinfunc" id="3719545">len</span><span class="op" id="3719548">(</span><span class="ident" id="3719549">rs</span><span class="op" id="3719551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719555">s</span>&nbsp;<span class="op" id="3719557">+=</span>&nbsp;<span class="string" id="3719560">&#34;.&#34;</span>&nbsp;<span class="op" id="3719564">+</span>&nbsp;<span class="ident" id="3719566">strings</span><span class="op" id="3719573">.</span><span class="ident" id="3719574">Repeat</span><span class="op" id="3719580">(</span><span class="string" id="3719581">&#34;0&#34;</span><span class="op" id="3719584">,</span>&nbsp;<span class="ident" id="3719586">leadingZeros</span><span class="op" id="3719598">)</span>&nbsp;<span class="op" id="3719600">+</span>&nbsp;<span class="ident" id="3719602">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719610">return</span>&nbsp;<span class="ident" id="3719617">s</span><br>
<span class="lineno"></span><span class="op" id="3719619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3719622">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3719697">const</span>&nbsp;<span class="ident" id="3719703">ratGobVersion</span>&nbsp;<span class="builtintype" id="3719717">byte</span>&nbsp;<span class="op" id="3719722">=</span>&nbsp;<span class="num" id="3719724">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719727">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3719781">func</span>&nbsp;<span class="op" id="3719786">(</span><span class="ident" id="3719787">x</span>&nbsp;<span class="op" id="3719789">*</span><span class="ident" id="3719790">Rat</span><span class="op" id="3719793">)</span>&nbsp;<span class="ident" id="3719795">GobEncode</span><span class="op" id="3719804">(</span><span class="op" id="3719805">)</span>&nbsp;<span class="op" id="3719807">(</span><span class="op" id="3719808">[</span><span class="op" id="3719809">]</span><span class="builtintype" id="3719810">byte</span><span class="op" id="3719814">,</span>&nbsp;<span class="builtintype" id="3719816">error</span><span class="op" id="3719821">)</span>&nbsp;<span class="op" id="3719823">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719826">if</span>&nbsp;<span class="ident" id="3719829">x</span>&nbsp;<span class="op" id="3719831">==</span>&nbsp;<span class="ident" id="3719834">nil</span>&nbsp;<span class="op" id="3719838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719842">return</span>&nbsp;<span class="ident" id="3719849">nil</span><span class="op" id="3719852">,</span>&nbsp;<span class="ident" id="3719854">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719862">buf</span>&nbsp;<span class="op" id="3719866">:=</span>&nbsp;<span class="builtinfunc" id="3719869">make</span><span class="op" id="3719873">(</span><span class="op" id="3719874">[</span><span class="op" id="3719875">]</span><span class="builtintype" id="3719876">byte</span><span class="op" id="3719880">,</span>&nbsp;<span class="num" id="3719882">1</span><span class="op" id="3719883">+</span><span class="num" id="3719884">4</span><span class="op" id="3719885">+</span><span class="op" id="3719886">(</span><span class="builtinfunc" id="3719887">len</span><span class="op" id="3719890">(</span><span class="ident" id="3719891">x</span><span class="op" id="3719892">.</span><span class="ident" id="3719893">a</span><span class="op" id="3719894">.</span><span class="ident" id="3719895">abs</span><span class="op" id="3719898">)</span><span class="op" id="3719899">+</span><span class="builtinfunc" id="3719900">len</span><span class="op" id="3719903">(</span><span class="ident" id="3719904">x</span><span class="op" id="3719905">.</span><span class="ident" id="3719906">b</span><span class="op" id="3719907">.</span><span class="ident" id="3719908">abs</span><span class="op" id="3719911">)</span><span class="op" id="3719912">)</span><span class="op" id="3719913">*</span><span class="ident" id="3719914">_S</span><span class="op" id="3719916">)</span>&nbsp;<span class="comment" id="3719918">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719989">i</span>&nbsp;<span class="op" id="3719991">:=</span>&nbsp;<span class="ident" id="3719994">x</span><span class="op" id="3719995">.</span><span class="ident" id="3719996">b</span><span class="op" id="3719997">.</span><span class="ident" id="3719998">abs</span><span class="op" id="3720001">.</span><span class="ident" id="3720002">bytes</span><span class="op" id="3720007">(</span><span class="ident" id="3720008">buf</span><span class="op" id="3720011">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720014">j</span>&nbsp;<span class="op" id="3720016">:=</span>&nbsp;<span class="ident" id="3720019">x</span><span class="op" id="3720020">.</span><span class="ident" id="3720021">a</span><span class="op" id="3720022">.</span><span class="ident" id="3720023">abs</span><span class="op" id="3720026">.</span><span class="ident" id="3720027">bytes</span><span class="op" id="3720032">(</span><span class="ident" id="3720033">buf</span><span class="op" id="3720036">[</span><span class="num" id="3720037">0</span><span class="op" id="3720038">:</span><span class="ident" id="3720039">i</span><span class="op" id="3720040">]</span><span class="op" id="3720041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720044">n</span>&nbsp;<span class="op" id="3720046">:=</span>&nbsp;<span class="ident" id="3720049">i</span>&nbsp;<span class="op" id="3720051">-</span>&nbsp;<span class="ident" id="3720053">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720056">if</span>&nbsp;<span class="builtintype" id="3720059">int</span><span class="op" id="3720062">(</span><span class="builtintype" id="3720063">uint32</span><span class="op" id="3720069">(</span><span class="ident" id="3720070">n</span><span class="op" id="3720071">)</span><span class="op" id="3720072">)</span>&nbsp;<span class="op" id="3720074">!=</span>&nbsp;<span class="ident" id="3720077">n</span>&nbsp;<span class="op" id="3720079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3720083">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720113">return</span>&nbsp;<span class="ident" id="3720120">nil</span><span class="op" id="3720123">,</span>&nbsp;<span class="ident" id="3720125">errors</span><span class="op" id="3720131">.</span><span class="ident" id="3720132">New</span><span class="op" id="3720135">(</span><span class="string" id="3720136">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="3720172">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720178">binary</span><span class="op" id="3720184">.</span><span class="ident" id="3720185">BigEndian</span><span class="op" id="3720194">.</span><span class="ident" id="3720195">PutUint32</span><span class="op" id="3720204">(</span><span class="ident" id="3720205">buf</span><span class="op" id="3720208">[</span><span class="ident" id="3720209">j</span><span class="op" id="3720210">-</span><span class="num" id="3720211">4</span><span class="op" id="3720212">:</span><span class="ident" id="3720213">j</span><span class="op" id="3720214">]</span><span class="op" id="3720215">,</span>&nbsp;<span class="builtintype" id="3720217">uint32</span><span class="op" id="3720223">(</span><span class="ident" id="3720224">n</span><span class="op" id="3720225">)</span><span class="op" id="3720226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720229">j</span>&nbsp;<span class="op" id="3720231">-=</span>&nbsp;<span class="num" id="3720234">1</span>&nbsp;<span class="op" id="3720236">+</span>&nbsp;<span class="num" id="3720238">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720241">b</span>&nbsp;<span class="op" id="3720243">:=</span>&nbsp;<span class="ident" id="3720246">ratGobVersion</span>&nbsp;<span class="op" id="3720260">&lt;&lt;</span>&nbsp;<span class="num" id="3720263">1</span>&nbsp;<span class="comment" id="3720265">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720293">if</span>&nbsp;<span class="ident" id="3720296">x</span><span class="op" id="3720297">.</span><span class="ident" id="3720298">a</span><span class="op" id="3720299">.</span><span class="ident" id="3720300">neg</span>&nbsp;<span class="op" id="3720304">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720308">b</span>&nbsp;<span class="op" id="3720310">|=</span>&nbsp;<span class="num" id="3720313">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720319">buf</span><span class="op" id="3720322">[</span><span class="ident" id="3720323">j</span><span class="op" id="3720324">]</span>&nbsp;<span class="op" id="3720326">=</span>&nbsp;<span class="ident" id="3720328">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720331">return</span>&nbsp;<span class="ident" id="3720338">buf</span><span class="op" id="3720341">[</span><span class="ident" id="3720342">j</span><span class="op" id="3720343">:</span><span class="op" id="3720344">]</span><span class="op" id="3720345">,</span>&nbsp;<span class="ident" id="3720347">nil</span><br>
<span class="lineno"></span><span class="op" id="3720351">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3720354">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3720408">func</span>&nbsp;<span class="op" id="3720413">(</span><span class="ident" id="3720414">z</span>&nbsp;<span class="op" id="3720416">*</span><span class="ident" id="3720417">Rat</span><span class="op" id="3720420">)</span>&nbsp;<span class="ident" id="3720422">GobDecode</span><span class="op" id="3720431">(</span><span class="ident" id="3720432">buf</span>&nbsp;<span class="op" id="3720436">[</span><span class="op" id="3720437">]</span><span class="builtintype" id="3720438">byte</span><span class="op" id="3720442">)</span>&nbsp;<span class="builtintype" id="3720444">error</span>&nbsp;<span class="op" id="3720450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720453">if</span>&nbsp;<span class="builtinfunc" id="3720456">len</span><span class="op" id="3720459">(</span><span class="ident" id="3720460">buf</span><span class="op" id="3720463">)</span>&nbsp;<span class="op" id="3720465">==</span>&nbsp;<span class="num" id="3720468">0</span>&nbsp;<span class="op" id="3720470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3720474">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720519">*</span><span class="ident" id="3720520">z</span>&nbsp;<span class="op" id="3720522">=</span>&nbsp;<span class="ident" id="3720524">Rat</span><span class="op" id="3720527">{</span><span class="op" id="3720528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720532">return</span>&nbsp;<span class="ident" id="3720539">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720547">b</span>&nbsp;<span class="op" id="3720549">:=</span>&nbsp;<span class="ident" id="3720552">buf</span><span class="op" id="3720555">[</span><span class="num" id="3720556">0</span><span class="op" id="3720557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720560">if</span>&nbsp;<span class="ident" id="3720563">b</span><span class="op" id="3720564">&gt;&gt;</span><span class="num" id="3720566">1</span>&nbsp;<span class="op" id="3720568">!=</span>&nbsp;<span class="ident" id="3720571">ratGobVersion</span>&nbsp;<span class="op" id="3720585">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720589">return</span>&nbsp;<span class="ident" id="3720596">errors</span><span class="op" id="3720602">.</span><span class="ident" id="3720603">New</span><span class="op" id="3720606">(</span><span class="ident" id="3720607">fmt</span><span class="op" id="3720610">.</span><span class="ident" id="3720611">Sprintf</span><span class="op" id="3720618">(</span><span class="string" id="3720619">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3720669">,</span>&nbsp;<span class="ident" id="3720671">b</span><span class="op" id="3720672">&gt;&gt;</span><span class="num" id="3720674">1</span><span class="op" id="3720675">)</span><span class="op" id="3720676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720682">const</span>&nbsp;<span class="ident" id="3720688">j</span>&nbsp;<span class="op" id="3720690">=</span>&nbsp;<span class="num" id="3720692">1</span>&nbsp;<span class="op" id="3720694">+</span>&nbsp;<span class="num" id="3720696">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720699">i</span>&nbsp;<span class="op" id="3720701">:=</span>&nbsp;<span class="ident" id="3720704">j</span>&nbsp;<span class="op" id="3720706">+</span>&nbsp;<span class="ident" id="3720708">binary</span><span class="op" id="3720714">.</span><span class="ident" id="3720715">BigEndian</span><span class="op" id="3720724">.</span><span class="ident" id="3720725">Uint32</span><span class="op" id="3720731">(</span><span class="ident" id="3720732">buf</span><span class="op" id="3720735">[</span><span class="ident" id="3720736">j</span><span class="op" id="3720737">-</span><span class="num" id="3720738">4</span><span class="op" id="3720739">:</span><span class="ident" id="3720740">j</span><span class="op" id="3720741">]</span><span class="op" id="3720742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720745">z</span><span class="op" id="3720746">.</span><span class="ident" id="3720747">a</span><span class="op" id="3720748">.</span><span class="ident" id="3720749">neg</span>&nbsp;<span class="op" id="3720753">=</span>&nbsp;<span class="ident" id="3720755">b</span><span class="op" id="3720756">&amp;</span><span class="num" id="3720757">1</span>&nbsp;<span class="op" id="3720759">!=</span>&nbsp;<span class="num" id="3720762">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720765">z</span><span class="op" id="3720766">.</span><span class="ident" id="3720767">a</span><span class="op" id="3720768">.</span><span class="ident" id="3720769">abs</span>&nbsp;<span class="op" id="3720773">=</span>&nbsp;<span class="ident" id="3720775">z</span><span class="op" id="3720776">.</span><span class="ident" id="3720777">a</span><span class="op" id="3720778">.</span><span class="ident" id="3720779">abs</span><span class="op" id="3720782">.</span><span class="ident" id="3720783">setBytes</span><span class="op" id="3720791">(</span><span class="ident" id="3720792">buf</span><span class="op" id="3720795">[</span><span class="ident" id="3720796">j</span><span class="op" id="3720797">:</span><span class="ident" id="3720798">i</span><span class="op" id="3720799">]</span><span class="op" id="3720800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720803">z</span><span class="op" id="3720804">.</span><span class="ident" id="3720805">b</span><span class="op" id="3720806">.</span><span class="ident" id="3720807">abs</span>&nbsp;<span class="op" id="3720811">=</span>&nbsp;<span class="ident" id="3720813">z</span><span class="op" id="3720814">.</span><span class="ident" id="3720815">b</span><span class="op" id="3720816">.</span><span class="ident" id="3720817">abs</span><span class="op" id="3720820">.</span><span class="ident" id="3720821">setBytes</span><span class="op" id="3720829">(</span><span class="ident" id="3720830">buf</span><span class="op" id="3720833">[</span><span class="ident" id="3720834">i</span><span class="op" id="3720835">:</span><span class="op" id="3720836">]</span><span class="op" id="3720837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720840">return</span>&nbsp;<span class="ident" id="3720847">nil</span><br>
<span class="lineno"></span><span class="op" id="3720851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3720854">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3720918">func</span>&nbsp;<span class="op" id="3720923">(</span><span class="ident" id="3720924">r</span>&nbsp;<span class="op" id="3720926">*</span><span class="ident" id="3720927">Rat</span><span class="op" id="3720930">)</span>&nbsp;<span class="ident" id="3720932">MarshalText</span><span class="op" id="3720943">(</span><span class="op" id="3720944">)</span>&nbsp;<span class="op" id="3720946">(</span><span class="ident" id="3720947">text</span>&nbsp;<span class="op" id="3720952">[</span><span class="op" id="3720953">]</span><span class="builtintype" id="3720954">byte</span><span class="op" id="3720958">,</span>&nbsp;<span class="ident" id="3720960">err</span>&nbsp;<span class="builtintype" id="3720964">error</span><span class="op" id="3720969">)</span>&nbsp;<span class="op" id="3720971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720974">return</span>&nbsp;<span class="op" id="3720981">[</span><span class="op" id="3720982">]</span><span class="builtintype" id="3720983">byte</span><span class="op" id="3720987">(</span><span class="ident" id="3720988">r</span><span class="op" id="3720989">.</span><span class="ident" id="3720990">RatString</span><span class="op" id="3720999">(</span><span class="op" id="3721000">)</span><span class="op" id="3721001">)</span><span class="op" id="3721002">,</span>&nbsp;<span class="ident" id="3721004">nil</span><br>
<span class="lineno"></span><span class="op" id="3721008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="3721011">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3721079">func</span>&nbsp;<span class="op" id="3721084">(</span><span class="ident" id="3721085">r</span>&nbsp;<span class="op" id="3721087">*</span><span class="ident" id="3721088">Rat</span><span class="op" id="3721091">)</span>&nbsp;<span class="ident" id="3721093">UnmarshalText</span><span class="op" id="3721106">(</span><span class="ident" id="3721107">text</span>&nbsp;<span class="op" id="3721112">[</span><span class="op" id="3721113">]</span><span class="builtintype" id="3721114">byte</span><span class="op" id="3721118">)</span>&nbsp;<span class="builtintype" id="3721120">error</span>&nbsp;<span class="op" id="3721126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721129">if</span>&nbsp;<span class="ident" id="3721132">_</span><span class="op" id="3721133">,</span>&nbsp;<span class="ident" id="3721135">ok</span>&nbsp;<span class="op" id="3721138">:=</span>&nbsp;<span class="ident" id="3721141">r</span><span class="op" id="3721142">.</span><span class="ident" id="3721143">SetString</span><span class="op" id="3721152">(</span><span class="builtintype" id="3721153">string</span><span class="op" id="3721159">(</span><span class="ident" id="3721160">text</span><span class="op" id="3721164">)</span><span class="op" id="3721165">)</span><span class="op" id="3721166">;</span>&nbsp;<span class="op" id="3721168">!</span><span class="ident" id="3721169">ok</span>&nbsp;<span class="op" id="3721172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721176">return</span>&nbsp;<span class="ident" id="3721183">fmt</span><span class="op" id="3721186">.</span><span class="ident" id="3721187">Errorf</span><span class="op" id="3721193">(</span><span class="string" id="3721194">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="3721241">,</span>&nbsp;<span class="ident" id="3721243">text</span><span class="op" id="3721247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721250">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721253">return</span>&nbsp;<span class="ident" id="3721260">nil</span><br>
<span class="lineno"></span><span class="op" id="3721264">}</span>
</div>
</body>
</html>
