<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3983491">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3983546">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3983600">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3983651">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="3984305">package</span>&nbsp;<span class="ident" id="3984313">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3984319">import</span>&nbsp;<span class="op" id="3984326">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3984329">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3984346">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3984353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3984356">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="3984369">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3984434">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3984495">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="3984539">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="3984583">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3984631">type</span>&nbsp;<span class="ident" id="3984636">hmac</span>&nbsp;<span class="keyword" id="3984641">struct</span>&nbsp;<span class="op" id="3984648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984651">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3984664">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984669">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3984682">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984687">key</span><span class="op" id="3984690">,</span>&nbsp;<span class="ident" id="3984692">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3984700">[</span><span class="op" id="3984701">]</span><span class="builtintype" id="3984702">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984708">outer</span><span class="op" id="3984713">,</span>&nbsp;<span class="ident" id="3984715">inner</span>&nbsp;<span class="ident" id="3984721"><a href="/crypto/hmac/hmac.go.html#3984346">hash</a></span><span class="op" id="3984725">.</span><span class="ident" id="3984726">Hash</span><br>
<span class="lineno"></span><span class="op" id="3984731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3984734">func</span>&nbsp;<span class="op" id="3984739">(</span><span class="ident" id="3984740">h</span>&nbsp;<span class="op" id="3984742">*</span><span class="ident" id="3984743"><a href="/crypto/hmac/hmac.go.html#3984636">hmac</a></span><span class="op" id="3984747">)</span>&nbsp;<span class="ident" id="3984749">tmpPad</span><span class="op" id="3984755">(</span><span class="ident" id="3984756">xor</span>&nbsp;<span class="builtintype" id="3984760">byte</span><span class="op" id="3984764">)</span>&nbsp;<span class="op" id="3984766">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984769">for</span>&nbsp;<span class="ident" id="3984773">i</span><span class="op" id="3984774">,</span>&nbsp;<span class="ident" id="3984776">k</span>&nbsp;<span class="op" id="3984778">:=</span>&nbsp;<span class="keyword" id="3984781">range</span>&nbsp;<span class="ident" id="3984787"><a href="/crypto/hmac/hmac.go.html#3984740">h</a></span><span class="op" id="3984788">.</span><span class="ident" id="3984789">key</span>&nbsp;<span class="op" id="3984793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984797"><a href="/crypto/hmac/hmac.go.html#3984740">h</a></span><span class="op" id="3984798">.</span><span class="ident" id="3984799">tmp</span><span class="op" id="3984802">[</span><span class="ident" id="3984803"><a href="/crypto/hmac/hmac.go.html#3984773">i</a></span><span class="op" id="3984804">]</span>&nbsp;<span class="op" id="3984806">=</span>&nbsp;<span class="ident" id="3984808"><a href="/crypto/hmac/hmac.go.html#3984756">xor</a></span>&nbsp;<span class="op" id="3984812">^</span>&nbsp;<span class="ident" id="3984814"><a href="/crypto/hmac/hmac.go.html#3984776">k</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984820">for</span>&nbsp;<span class="ident" id="3984824">i</span>&nbsp;<span class="op" id="3984826">:=</span>&nbsp;<span class="builtinfunc" id="3984829">len</span><span class="op" id="3984832">(</span><span class="ident" id="3984833"><a href="/crypto/hmac/hmac.go.html#3984740">h</a></span><span class="op" id="3984834">.</span><span class="ident" id="3984835">key</span><span class="op" id="3984838">)</span><span class="op" id="3984839">;</span>&nbsp;<span class="ident" id="3984841"><a href="/crypto/hmac/hmac.go.html#3984824">i</a></span>&nbsp;<span class="op" id="3984843">&lt;</span>&nbsp;<span class="ident" id="3984845"><a href="/crypto/hmac/hmac.go.html#3984740">h</a></span><span class="op" id="3984846">.</span><span class="ident" id="3984847">blocksize</span><span class="op" id="3984856">;</span>&nbsp;<span class="ident" id="3984858"><a href="/crypto/hmac/hmac.go.html#3984824">i</a></span><span class="op" id="3984859">++</span>&nbsp;<span class="op" id="3984862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984866"><a href="/crypto/hmac/hmac.go.html#3984740">h</a></span><span class="op" id="3984867">.</span><span class="ident" id="3984868">tmp</span><span class="op" id="3984871">[</span><span class="ident" id="3984872"><a href="/crypto/hmac/hmac.go.html#3984824">i</a></span><span class="op" id="3984873">]</span>&nbsp;<span class="op" id="3984875">=</span>&nbsp;<span class="ident" id="3984877"><a href="/crypto/hmac/hmac.go.html#3984756">xor</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984882">}</span><br>
<span class="lineno"></span><span class="op" id="3984884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3984887">func</span>&nbsp;<span class="op" id="3984892">(</span><span class="ident" id="3984893">h</span>&nbsp;<span class="op" id="3984895">*</span><span class="ident" id="3984896"><a href="/crypto/hmac/hmac.go.html#3984636">hmac</a></span><span class="op" id="3984900">)</span>&nbsp;<span class="ident" id="3984902">Sum</span><span class="op" id="3984905">(</span><span class="ident" id="3984906">in</span>&nbsp;<span class="op" id="3984909">[</span><span class="op" id="3984910">]</span><span class="builtintype" id="3984911">byte</span><span class="op" id="3984915">)</span>&nbsp;<span class="op" id="3984917">[</span><span class="op" id="3984918">]</span><span class="builtintype" id="3984919">byte</span>&nbsp;<span class="op" id="3984924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984927">origLen</span>&nbsp;<span class="op" id="3984935">:=</span>&nbsp;<span class="builtinfunc" id="3984938">len</span><span class="op" id="3984941">(</span><span class="ident" id="3984942"><a href="/crypto/hmac/hmac.go.html#3984906">in</a></span><span class="op" id="3984944">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984947"><a href="/crypto/hmac/hmac.go.html#3984906">in</a></span>&nbsp;<span class="op" id="3984950">=</span>&nbsp;<span class="ident" id="3984952"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3984953">.</span><span class="ident" id="3984954">inner</span><span class="op" id="3984959">.</span><span class="ident" id="3984960">Sum</span><span class="op" id="3984963">(</span><span class="ident" id="3984964"><a href="/crypto/hmac/hmac.go.html#3984906">in</a></span><span class="op" id="3984966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984969"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3984970">.</span><span class="ident" id="3984971">tmpPad</span><span class="op" id="3984977">(</span><span class="num" id="3984978">0x5c</span><span class="op" id="3984982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3984985">copy</span><span class="op" id="3984989">(</span><span class="ident" id="3984990"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3984991">.</span><span class="ident" id="3984992">tmp</span><span class="op" id="3984995">[</span><span class="ident" id="3984996"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3984997">.</span><span class="ident" id="3984998">blocksize</span><span class="op" id="3985007">:</span><span class="op" id="3985008">]</span><span class="op" id="3985009">,</span>&nbsp;<span class="ident" id="3985011"><a href="/crypto/hmac/hmac.go.html#3984906">in</a></span><span class="op" id="3985013">[</span><span class="ident" id="3985014"><a href="/crypto/hmac/hmac.go.html#3984927">origLen</a></span><span class="op" id="3985021">:</span><span class="op" id="3985022">]</span><span class="op" id="3985023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985026"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3985027">.</span><span class="ident" id="3985028">outer</span><span class="op" id="3985033">.</span><span class="ident" id="3985034">Reset</span><span class="op" id="3985039">(</span><span class="op" id="3985040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985043"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3985044">.</span><span class="ident" id="3985045">outer</span><span class="op" id="3985050">.</span><span class="ident" id="3985051">Write</span><span class="op" id="3985056">(</span><span class="ident" id="3985057"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3985058">.</span><span class="ident" id="3985059">tmp</span><span class="op" id="3985062">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985065">return</span>&nbsp;<span class="ident" id="3985072"><a href="/crypto/hmac/hmac.go.html#3984893">h</a></span><span class="op" id="3985073">.</span><span class="ident" id="3985074">outer</span><span class="op" id="3985079">.</span><span class="ident" id="3985080">Sum</span><span class="op" id="3985083">(</span><span class="ident" id="3985084"><a href="/crypto/hmac/hmac.go.html#3984906">in</a></span><span class="op" id="3985086">[</span><span class="op" id="3985087">:</span><span class="ident" id="3985088"><a href="/crypto/hmac/hmac.go.html#3984927">origLen</a></span><span class="op" id="3985095">]</span><span class="op" id="3985096">)</span><br>
<span class="lineno"></span><span class="op" id="3985098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3985101">func</span>&nbsp;<span class="op" id="3985106">(</span><span class="ident" id="3985107">h</span>&nbsp;<span class="op" id="3985109">*</span><span class="ident" id="3985110"><a href="/crypto/hmac/hmac.go.html#3984636">hmac</a></span><span class="op" id="3985114">)</span>&nbsp;<span class="ident" id="3985116">Write</span><span class="op" id="3985121">(</span><span class="ident" id="3985122">p</span>&nbsp;<span class="op" id="3985124">[</span><span class="op" id="3985125">]</span><span class="builtintype" id="3985126">byte</span><span class="op" id="3985130">)</span>&nbsp;<span class="op" id="3985132">(</span><span class="ident" id="3985133">n</span>&nbsp;<span class="builtintype" id="3985135">int</span><span class="op" id="3985138">,</span>&nbsp;<span class="ident" id="3985140">err</span>&nbsp;<span class="builtintype" id="3985144">error</span><span class="op" id="3985149">)</span>&nbsp;<span class="op" id="3985151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985154">return</span>&nbsp;<span class="ident" id="3985161"><a href="/crypto/hmac/hmac.go.html#3985107">h</a></span><span class="op" id="3985162">.</span><span class="ident" id="3985163">inner</span><span class="op" id="3985168">.</span><span class="ident" id="3985169">Write</span><span class="op" id="3985174">(</span><span class="ident" id="3985175"><a href="/crypto/hmac/hmac.go.html#3985122">p</a></span><span class="op" id="3985176">)</span><br>
<span class="lineno">65</span><span class="op" id="3985178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3985181">func</span>&nbsp;<span class="op" id="3985186">(</span><span class="ident" id="3985187">h</span>&nbsp;<span class="op" id="3985189">*</span><span class="ident" id="3985190"><a href="/crypto/hmac/hmac.go.html#3984636">hmac</a></span><span class="op" id="3985194">)</span>&nbsp;<span class="ident" id="3985196">Size</span><span class="op" id="3985200">(</span><span class="op" id="3985201">)</span>&nbsp;<span class="builtintype" id="3985203">int</span>&nbsp;<span class="op" id="3985207">{</span>&nbsp;<span class="keyword" id="3985209">return</span>&nbsp;<span class="ident" id="3985216"><a href="/crypto/hmac/hmac.go.html#3985187">h</a></span><span class="op" id="3985217">.</span><span class="ident" id="3985218">size</span>&nbsp;<span class="op" id="3985223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3985226">func</span>&nbsp;<span class="op" id="3985231">(</span><span class="ident" id="3985232">h</span>&nbsp;<span class="op" id="3985234">*</span><span class="ident" id="3985235"><a href="/crypto/hmac/hmac.go.html#3984636">hmac</a></span><span class="op" id="3985239">)</span>&nbsp;<span class="ident" id="3985241">BlockSize</span><span class="op" id="3985250">(</span><span class="op" id="3985251">)</span>&nbsp;<span class="builtintype" id="3985253">int</span>&nbsp;<span class="op" id="3985257">{</span>&nbsp;<span class="keyword" id="3985259">return</span>&nbsp;<span class="ident" id="3985266"><a href="/crypto/hmac/hmac.go.html#3985232">h</a></span><span class="op" id="3985267">.</span><span class="ident" id="3985268">blocksize</span>&nbsp;<span class="op" id="3985278">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3985281">func</span>&nbsp;<span class="op" id="3985286">(</span><span class="ident" id="3985287">h</span>&nbsp;<span class="op" id="3985289">*</span><span class="ident" id="3985290"><a href="/crypto/hmac/hmac.go.html#3984636">hmac</a></span><span class="op" id="3985294">)</span>&nbsp;<span class="ident" id="3985296">Reset</span><span class="op" id="3985301">(</span><span class="op" id="3985302">)</span>&nbsp;<span class="op" id="3985304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985307"><a href="/crypto/hmac/hmac.go.html#3985287">h</a></span><span class="op" id="3985308">.</span><span class="ident" id="3985309">inner</span><span class="op" id="3985314">.</span><span class="ident" id="3985315">Reset</span><span class="op" id="3985320">(</span><span class="op" id="3985321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985324"><a href="/crypto/hmac/hmac.go.html#3985287">h</a></span><span class="op" id="3985325">.</span><span class="ident" id="3985326">tmpPad</span><span class="op" id="3985332">(</span><span class="num" id="3985333">0x36</span><span class="op" id="3985337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985340"><a href="/crypto/hmac/hmac.go.html#3985287">h</a></span><span class="op" id="3985341">.</span><span class="ident" id="3985342">inner</span><span class="op" id="3985347">.</span><span class="ident" id="3985348">Write</span><span class="op" id="3985353">(</span><span class="ident" id="3985354"><a href="/crypto/hmac/hmac.go.html#3985287">h</a></span><span class="op" id="3985355">.</span><span class="ident" id="3985356">tmp</span><span class="op" id="3985359">[</span><span class="op" id="3985360">:</span><span class="ident" id="3985361"><a href="/crypto/hmac/hmac.go.html#3985287">h</a></span><span class="op" id="3985362">.</span><span class="ident" id="3985363">blocksize</span><span class="op" id="3985372">]</span><span class="op" id="3985373">)</span><br>
<span class="lineno">75</span><span class="op" id="3985375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3985378">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3985449">func</span>&nbsp;<span class="ident" id="3985454">New</span><span class="op" id="3985457">(</span><span class="ident" id="3985458">h</span>&nbsp;<span class="keyword" id="3985460">func</span><span class="op" id="3985464">(</span><span class="op" id="3985465">)</span>&nbsp;<span class="ident" id="3985467"><a href="/crypto/hmac/hmac.go.html#3984346">hash</a></span><span class="op" id="3985471">.</span><span class="ident" id="3985472">Hash</span><span class="op" id="3985476">,</span>&nbsp;<span class="ident" id="3985478">key</span>&nbsp;<span class="op" id="3985482">[</span><span class="op" id="3985483">]</span><span class="builtintype" id="3985484">byte</span><span class="op" id="3985488">)</span>&nbsp;<span class="ident" id="3985490"><a href="/crypto/hmac/hmac.go.html#3984346">hash</a></span><span class="op" id="3985494">.</span><span class="ident" id="3985495">Hash</span>&nbsp;<span class="op" id="3985500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985503">hm</span>&nbsp;<span class="op" id="3985506">:=</span>&nbsp;<span class="builtinfunc" id="3985509">new</span><span class="op" id="3985512">(</span><span class="ident" id="3985513"><a href="/crypto/hmac/hmac.go.html#3984636">hmac</a></span><span class="op" id="3985517">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985520"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985522">.</span><span class="ident" id="3985523">outer</span>&nbsp;<span class="op" id="3985529">=</span>&nbsp;<span class="ident" id="3985531"><a href="/crypto/hmac/hmac.go.html#3985458">h</a></span><span class="op" id="3985532">(</span><span class="op" id="3985533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985536"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985538">.</span><span class="ident" id="3985539">inner</span>&nbsp;<span class="op" id="3985545">=</span>&nbsp;<span class="ident" id="3985547"><a href="/crypto/hmac/hmac.go.html#3985458">h</a></span><span class="op" id="3985548">(</span><span class="op" id="3985549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985552"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985554">.</span><span class="ident" id="3985555">size</span>&nbsp;<span class="op" id="3985560">=</span>&nbsp;<span class="ident" id="3985562"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985564">.</span><span class="ident" id="3985565">inner</span><span class="op" id="3985570">.</span><span class="ident" id="3985571">Size</span><span class="op" id="3985575">(</span><span class="op" id="3985576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985579"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985581">.</span><span class="ident" id="3985582">blocksize</span>&nbsp;<span class="op" id="3985592">=</span>&nbsp;<span class="ident" id="3985594"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985596">.</span><span class="ident" id="3985597">inner</span><span class="op" id="3985602">.</span><span class="ident" id="3985603">BlockSize</span><span class="op" id="3985612">(</span><span class="op" id="3985613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985616"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985618">.</span><span class="ident" id="3985619">tmp</span>&nbsp;<span class="op" id="3985623">=</span>&nbsp;<span class="builtinfunc" id="3985625">make</span><span class="op" id="3985629">(</span><span class="op" id="3985630">[</span><span class="op" id="3985631">]</span><span class="builtintype" id="3985632">byte</span><span class="op" id="3985636">,</span>&nbsp;<span class="ident" id="3985638"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985640">.</span><span class="ident" id="3985641">blocksize</span><span class="op" id="3985650">+</span><span class="ident" id="3985651"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985653">.</span><span class="ident" id="3985654">size</span><span class="op" id="3985658">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985661">if</span>&nbsp;<span class="builtinfunc" id="3985664">len</span><span class="op" id="3985667">(</span><span class="ident" id="3985668"><a href="/crypto/hmac/hmac.go.html#3985478">key</a></span><span class="op" id="3985671">)</span>&nbsp;<span class="op" id="3985673">&gt;</span>&nbsp;<span class="ident" id="3985675"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985677">.</span><span class="ident" id="3985678">blocksize</span>&nbsp;<span class="op" id="3985688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985692">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985725"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985727">.</span><span class="ident" id="3985728">outer</span><span class="op" id="3985733">.</span><span class="ident" id="3985734">Write</span><span class="op" id="3985739">(</span><span class="ident" id="3985740"><a href="/crypto/hmac/hmac.go.html#3985478">key</a></span><span class="op" id="3985743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985747"><a href="/crypto/hmac/hmac.go.html#3985478">key</a></span>&nbsp;<span class="op" id="3985751">=</span>&nbsp;<span class="ident" id="3985753"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985755">.</span><span class="ident" id="3985756">outer</span><span class="op" id="3985761">.</span><span class="ident" id="3985762">Sum</span><span class="op" id="3985765">(</span><span class="ident" id="3985766">nil</span><span class="op" id="3985769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985772">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985775"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985777">.</span><span class="ident" id="3985778">key</span>&nbsp;<span class="op" id="3985782">=</span>&nbsp;<span class="builtinfunc" id="3985784">make</span><span class="op" id="3985788">(</span><span class="op" id="3985789">[</span><span class="op" id="3985790">]</span><span class="builtintype" id="3985791">byte</span><span class="op" id="3985795">,</span>&nbsp;<span class="builtinfunc" id="3985797">len</span><span class="op" id="3985800">(</span><span class="ident" id="3985801"><a href="/crypto/hmac/hmac.go.html#3985478">key</a></span><span class="op" id="3985804">)</span><span class="op" id="3985805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3985808">copy</span><span class="op" id="3985812">(</span><span class="ident" id="3985813"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985815">.</span><span class="ident" id="3985816">key</span><span class="op" id="3985819">,</span>&nbsp;<span class="ident" id="3985821"><a href="/crypto/hmac/hmac.go.html#3985478">key</a></span><span class="op" id="3985824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985827"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><span class="op" id="3985829">.</span><span class="ident" id="3985830">Reset</span><span class="op" id="3985835">(</span><span class="op" id="3985836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985839">return</span>&nbsp;<span class="ident" id="3985846"><a href="/crypto/hmac/hmac.go.html#3985503">hm</a></span><br>
<span class="lineno"></span><span class="op" id="3985849">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3985852">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3985928">func</span>&nbsp;<span class="ident" id="3985933">Equal</span><span class="op" id="3985938">(</span><span class="ident" id="3985939">mac1</span><span class="op" id="3985943">,</span>&nbsp;<span class="ident" id="3985945">mac2</span>&nbsp;<span class="op" id="3985950">[</span><span class="op" id="3985951">]</span><span class="builtintype" id="3985952">byte</span><span class="op" id="3985956">)</span>&nbsp;<span class="builtintype" id="3985958">bool</span>&nbsp;<span class="op" id="3985963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985966">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3986035">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3986108">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986122">return</span>&nbsp;<span class="builtinfunc" id="3986129">len</span><span class="op" id="3986132">(</span><span class="ident" id="3986133"><a href="/crypto/hmac/hmac.go.html#3985939">mac1</a></span><span class="op" id="3986137">)</span>&nbsp;<span class="op" id="3986139">==</span>&nbsp;<span class="builtinfunc" id="3986142">len</span><span class="op" id="3986145">(</span><span class="ident" id="3986146"><a href="/crypto/hmac/hmac.go.html#3985945">mac2</a></span><span class="op" id="3986150">)</span>&nbsp;<span class="op" id="3986152">&amp;&amp;</span>&nbsp;<span class="ident" id="3986155"><a href="/crypto/hmac/hmac.go.html#3984329">subtle</a></span><span class="op" id="3986161">.</span><span class="ident" id="3986162">ConstantTimeCompare</span><span class="op" id="3986181">(</span><span class="ident" id="3986182"><a href="/crypto/hmac/hmac.go.html#3985939">mac1</a></span><span class="op" id="3986186">,</span>&nbsp;<span class="ident" id="3986188"><a href="/crypto/hmac/hmac.go.html#3985945">mac2</a></span><span class="op" id="3986192">)</span>&nbsp;<span class="op" id="3986194">==</span>&nbsp;<span class="num" id="3986197">1</span><br>
<span class="lineno"></span><span class="op" id="3986199">}</span>
</div>
</body>
</html>
