<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2271076">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2271132">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2271186">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2271237">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2271270">package</span>&nbsp;<span class="ident" id="2271278">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2271287">import</span>&nbsp;<span class="string" id="2271294">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2271304">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2271370">func</span>&nbsp;<span class="ident" id="2271375">nlmAlignOf</span><span class="op" id="2271385">(</span><span class="ident" id="2271386">msglen</span>&nbsp;<span class="builtintype" id="2271393">int</span><span class="op" id="2271396">)</span>&nbsp;<span class="builtintype" id="2271398">int</span>&nbsp;<span class="op" id="2271402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271405">return</span>&nbsp;<span class="op" id="2271412">(</span><span class="ident" id="2271413">msglen</span>&nbsp;<span class="op" id="2271420">+</span>&nbsp;<span class="ident" id="2271422">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2271436">-</span>&nbsp;<span class="num" id="2271438">1</span><span class="op" id="2271439">)</span>&nbsp;<span class="op" id="2271441">&amp;</span>&nbsp;<span class="op" id="2271443">^</span><span class="op" id="2271444">(</span><span class="ident" id="2271445">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2271459">-</span>&nbsp;<span class="num" id="2271461">1</span><span class="op" id="2271462">)</span><br>
<span class="lineno"></span><span class="op" id="2271464">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2271467">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2271531">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2271544">func</span>&nbsp;<span class="ident" id="2271549">rtaAlignOf</span><span class="op" id="2271559">(</span><span class="ident" id="2271560">attrlen</span>&nbsp;<span class="builtintype" id="2271568">int</span><span class="op" id="2271571">)</span>&nbsp;<span class="builtintype" id="2271573">int</span>&nbsp;<span class="op" id="2271577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271580">return</span>&nbsp;<span class="op" id="2271587">(</span><span class="ident" id="2271588">attrlen</span>&nbsp;<span class="op" id="2271596">+</span>&nbsp;<span class="ident" id="2271598">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2271610">-</span>&nbsp;<span class="num" id="2271612">1</span><span class="op" id="2271613">)</span>&nbsp;<span class="op" id="2271615">&amp;</span>&nbsp;<span class="op" id="2271617">^</span><span class="op" id="2271618">(</span><span class="ident" id="2271619">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2271631">-</span>&nbsp;<span class="num" id="2271633">1</span><span class="op" id="2271634">)</span><br>
<span class="lineno">20</span><span class="op" id="2271636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2271639">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2271710">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2271746">type</span>&nbsp;<span class="ident" id="2271751">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2271771">struct</span>&nbsp;<span class="op" id="2271778">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271781">Header</span>&nbsp;<span class="ident" id="2271788">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271798">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2271805">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2271814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2271817">func</span>&nbsp;<span class="op" id="2271822">(</span><span class="ident" id="2271823">rr</span>&nbsp;<span class="op" id="2271826">*</span><span class="ident" id="2271827">NetlinkRouteRequest</span><span class="op" id="2271846">)</span>&nbsp;<span class="ident" id="2271848">toWireFormat</span><span class="op" id="2271860">(</span><span class="op" id="2271861">)</span>&nbsp;<span class="op" id="2271863">[</span><span class="op" id="2271864">]</span><span class="builtintype" id="2271865">byte</span>&nbsp;<span class="op" id="2271870">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271873">b</span>&nbsp;<span class="op" id="2271875">:=</span>&nbsp;<span class="builtinfunc" id="2271878">make</span><span class="op" id="2271882">(</span><span class="op" id="2271883">[</span><span class="op" id="2271884">]</span><span class="builtintype" id="2271885">byte</span><span class="op" id="2271889">,</span>&nbsp;<span class="ident" id="2271891">rr</span><span class="op" id="2271893">.</span><span class="ident" id="2271894">Header</span><span class="op" id="2271900">.</span><span class="ident" id="2271901">Len</span><span class="op" id="2271904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271907">*</span><span class="op" id="2271908">(</span><span class="op" id="2271909">*</span><span class="builtintype" id="2271910">uint32</span><span class="op" id="2271916">)</span><span class="op" id="2271917">(</span><span class="ident" id="2271918">unsafe</span><span class="op" id="2271924">.</span><span class="ident" id="2271925">Pointer</span><span class="op" id="2271932">(</span><span class="op" id="2271933">&amp;</span><span class="ident" id="2271934">b</span><span class="op" id="2271935">[</span><span class="num" id="2271936">0</span><span class="op" id="2271937">:</span><span class="num" id="2271938">4</span><span class="op" id="2271939">]</span><span class="op" id="2271940">[</span><span class="num" id="2271941">0</span><span class="op" id="2271942">]</span><span class="op" id="2271943">)</span><span class="op" id="2271944">)</span>&nbsp;<span class="op" id="2271946">=</span>&nbsp;<span class="ident" id="2271948">rr</span><span class="op" id="2271950">.</span><span class="ident" id="2271951">Header</span><span class="op" id="2271957">.</span><span class="ident" id="2271958">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271963">*</span><span class="op" id="2271964">(</span><span class="op" id="2271965">*</span><span class="builtintype" id="2271966">uint16</span><span class="op" id="2271972">)</span><span class="op" id="2271973">(</span><span class="ident" id="2271974">unsafe</span><span class="op" id="2271980">.</span><span class="ident" id="2271981">Pointer</span><span class="op" id="2271988">(</span><span class="op" id="2271989">&amp;</span><span class="ident" id="2271990">b</span><span class="op" id="2271991">[</span><span class="num" id="2271992">4</span><span class="op" id="2271993">:</span><span class="num" id="2271994">6</span><span class="op" id="2271995">]</span><span class="op" id="2271996">[</span><span class="num" id="2271997">0</span><span class="op" id="2271998">]</span><span class="op" id="2271999">)</span><span class="op" id="2272000">)</span>&nbsp;<span class="op" id="2272002">=</span>&nbsp;<span class="ident" id="2272004">rr</span><span class="op" id="2272006">.</span><span class="ident" id="2272007">Header</span><span class="op" id="2272013">.</span><span class="ident" id="2272014">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272020">*</span><span class="op" id="2272021">(</span><span class="op" id="2272022">*</span><span class="builtintype" id="2272023">uint16</span><span class="op" id="2272029">)</span><span class="op" id="2272030">(</span><span class="ident" id="2272031">unsafe</span><span class="op" id="2272037">.</span><span class="ident" id="2272038">Pointer</span><span class="op" id="2272045">(</span><span class="op" id="2272046">&amp;</span><span class="ident" id="2272047">b</span><span class="op" id="2272048">[</span><span class="num" id="2272049">6</span><span class="op" id="2272050">:</span><span class="num" id="2272051">8</span><span class="op" id="2272052">]</span><span class="op" id="2272053">[</span><span class="num" id="2272054">0</span><span class="op" id="2272055">]</span><span class="op" id="2272056">)</span><span class="op" id="2272057">)</span>&nbsp;<span class="op" id="2272059">=</span>&nbsp;<span class="ident" id="2272061">rr</span><span class="op" id="2272063">.</span><span class="ident" id="2272064">Header</span><span class="op" id="2272070">.</span><span class="ident" id="2272071">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272078">*</span><span class="op" id="2272079">(</span><span class="op" id="2272080">*</span><span class="builtintype" id="2272081">uint32</span><span class="op" id="2272087">)</span><span class="op" id="2272088">(</span><span class="ident" id="2272089">unsafe</span><span class="op" id="2272095">.</span><span class="ident" id="2272096">Pointer</span><span class="op" id="2272103">(</span><span class="op" id="2272104">&amp;</span><span class="ident" id="2272105">b</span><span class="op" id="2272106">[</span><span class="num" id="2272107">8</span><span class="op" id="2272108">:</span><span class="num" id="2272109">12</span><span class="op" id="2272111">]</span><span class="op" id="2272112">[</span><span class="num" id="2272113">0</span><span class="op" id="2272114">]</span><span class="op" id="2272115">)</span><span class="op" id="2272116">)</span>&nbsp;<span class="op" id="2272118">=</span>&nbsp;<span class="ident" id="2272120">rr</span><span class="op" id="2272122">.</span><span class="ident" id="2272123">Header</span><span class="op" id="2272129">.</span><span class="ident" id="2272130">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272135">*</span><span class="op" id="2272136">(</span><span class="op" id="2272137">*</span><span class="builtintype" id="2272138">uint32</span><span class="op" id="2272144">)</span><span class="op" id="2272145">(</span><span class="ident" id="2272146">unsafe</span><span class="op" id="2272152">.</span><span class="ident" id="2272153">Pointer</span><span class="op" id="2272160">(</span><span class="op" id="2272161">&amp;</span><span class="ident" id="2272162">b</span><span class="op" id="2272163">[</span><span class="num" id="2272164">12</span><span class="op" id="2272166">:</span><span class="num" id="2272167">16</span><span class="op" id="2272169">]</span><span class="op" id="2272170">[</span><span class="num" id="2272171">0</span><span class="op" id="2272172">]</span><span class="op" id="2272173">)</span><span class="op" id="2272174">)</span>&nbsp;<span class="op" id="2272176">=</span>&nbsp;<span class="ident" id="2272178">rr</span><span class="op" id="2272180">.</span><span class="ident" id="2272181">Header</span><span class="op" id="2272187">.</span><span class="ident" id="2272188">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272193">b</span><span class="op" id="2272194">[</span><span class="num" id="2272195">16</span><span class="op" id="2272197">]</span>&nbsp;<span class="op" id="2272199">=</span>&nbsp;<span class="builtintype" id="2272201">byte</span><span class="op" id="2272205">(</span><span class="ident" id="2272206">rr</span><span class="op" id="2272208">.</span><span class="ident" id="2272209">Data</span><span class="op" id="2272213">.</span><span class="ident" id="2272214">Family</span><span class="op" id="2272220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272223">return</span>&nbsp;<span class="ident" id="2272230">b</span><br>
<span class="lineno"></span><span class="op" id="2272232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2272235">func</span>&nbsp;<span class="ident" id="2272240">newNetlinkRouteRequest</span><span class="op" id="2272262">(</span><span class="ident" id="2272263">proto</span><span class="op" id="2272268">,</span>&nbsp;<span class="ident" id="2272270">seq</span><span class="op" id="2272273">,</span>&nbsp;<span class="ident" id="2272275">family</span>&nbsp;<span class="builtintype" id="2272282">int</span><span class="op" id="2272285">)</span>&nbsp;<span class="op" id="2272287">[</span><span class="op" id="2272288">]</span><span class="builtintype" id="2272289">byte</span>&nbsp;<span class="op" id="2272294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272297">rr</span>&nbsp;<span class="op" id="2272300">:=</span>&nbsp;<span class="op" id="2272303">&amp;</span><span class="ident" id="2272304">NetlinkRouteRequest</span><span class="op" id="2272323">{</span><span class="op" id="2272324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272327">rr</span><span class="op" id="2272329">.</span><span class="ident" id="2272330">Header</span><span class="op" id="2272336">.</span><span class="ident" id="2272337">Len</span>&nbsp;<span class="op" id="2272341">=</span>&nbsp;<span class="builtintype" id="2272343">uint32</span><span class="op" id="2272349">(</span><span class="ident" id="2272350">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2272363">+</span>&nbsp;<span class="ident" id="2272365">SizeofRtGenmsg</span><span class="op" id="2272379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272382">rr</span><span class="op" id="2272384">.</span><span class="ident" id="2272385">Header</span><span class="op" id="2272391">.</span><span class="ident" id="2272392">Type</span>&nbsp;<span class="op" id="2272397">=</span>&nbsp;<span class="builtintype" id="2272399">uint16</span><span class="op" id="2272405">(</span><span class="ident" id="2272406">proto</span><span class="op" id="2272411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272414">rr</span><span class="op" id="2272416">.</span><span class="ident" id="2272417">Header</span><span class="op" id="2272423">.</span><span class="ident" id="2272424">Flags</span>&nbsp;<span class="op" id="2272430">=</span>&nbsp;<span class="ident" id="2272432">NLM_F_DUMP</span>&nbsp;<span class="op" id="2272443">|</span>&nbsp;<span class="ident" id="2272445">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272460">rr</span><span class="op" id="2272462">.</span><span class="ident" id="2272463">Header</span><span class="op" id="2272469">.</span><span class="ident" id="2272470">Seq</span>&nbsp;<span class="op" id="2272474">=</span>&nbsp;<span class="builtintype" id="2272476">uint32</span><span class="op" id="2272482">(</span><span class="ident" id="2272483">seq</span><span class="op" id="2272486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272489">rr</span><span class="op" id="2272491">.</span><span class="ident" id="2272492">Data</span><span class="op" id="2272496">.</span><span class="ident" id="2272497">Family</span>&nbsp;<span class="op" id="2272504">=</span>&nbsp;<span class="builtintype" id="2272506">uint8</span><span class="op" id="2272511">(</span><span class="ident" id="2272512">family</span><span class="op" id="2272518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272521">return</span>&nbsp;<span class="ident" id="2272528">rr</span><span class="op" id="2272530">.</span><span class="ident" id="2272531">toWireFormat</span><span class="op" id="2272543">(</span><span class="op" id="2272544">)</span><br>
<span class="lineno"></span><span class="op" id="2272546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2272549">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2272620">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2272688">func</span>&nbsp;<span class="ident" id="2272693">NetlinkRIB</span><span class="op" id="2272703">(</span><span class="ident" id="2272704">proto</span><span class="op" id="2272709">,</span>&nbsp;<span class="ident" id="2272711">family</span>&nbsp;<span class="builtintype" id="2272718">int</span><span class="op" id="2272721">)</span>&nbsp;<span class="op" id="2272723">(</span><span class="op" id="2272724">[</span><span class="op" id="2272725">]</span><span class="builtintype" id="2272726">byte</span><span class="op" id="2272730">,</span>&nbsp;<span class="builtintype" id="2272732">error</span><span class="op" id="2272737">)</span>&nbsp;<span class="op" id="2272739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272742">s</span><span class="op" id="2272743">,</span>&nbsp;<span class="ident" id="2272745">err</span>&nbsp;<span class="op" id="2272749">:=</span>&nbsp;<span class="ident" id="2272752">Socket</span><span class="op" id="2272758">(</span><span class="ident" id="2272759">AF_NETLINK</span><span class="op" id="2272769">,</span>&nbsp;<span class="ident" id="2272771">SOCK_RAW</span><span class="op" id="2272779">,</span>&nbsp;<span class="ident" id="2272781">NETLINK_ROUTE</span><span class="op" id="2272794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272797">if</span>&nbsp;<span class="ident" id="2272800">err</span>&nbsp;<span class="op" id="2272804">!=</span>&nbsp;<span class="ident" id="2272807">nil</span>&nbsp;<span class="op" id="2272811">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272815">return</span>&nbsp;<span class="ident" id="2272822">nil</span><span class="op" id="2272825">,</span>&nbsp;<span class="ident" id="2272827">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272835">defer</span>&nbsp;<span class="ident" id="2272841">Close</span><span class="op" id="2272846">(</span><span class="ident" id="2272847">s</span><span class="op" id="2272848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272851">lsa</span>&nbsp;<span class="op" id="2272855">:=</span>&nbsp;<span class="op" id="2272858">&amp;</span><span class="ident" id="2272859">SockaddrNetlink</span><span class="op" id="2272874">{</span><span class="ident" id="2272875">Family</span><span class="op" id="2272881">:</span>&nbsp;<span class="ident" id="2272883">AF_NETLINK</span><span class="op" id="2272893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272896">if</span>&nbsp;<span class="ident" id="2272899">err</span>&nbsp;<span class="op" id="2272903">:=</span>&nbsp;<span class="ident" id="2272906">Bind</span><span class="op" id="2272910">(</span><span class="ident" id="2272911">s</span><span class="op" id="2272912">,</span>&nbsp;<span class="ident" id="2272914">lsa</span><span class="op" id="2272917">)</span><span class="op" id="2272918">;</span>&nbsp;<span class="ident" id="2272920">err</span>&nbsp;<span class="op" id="2272924">!=</span>&nbsp;<span class="ident" id="2272927">nil</span>&nbsp;<span class="op" id="2272931">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272935">return</span>&nbsp;<span class="ident" id="2272942">nil</span><span class="op" id="2272945">,</span>&nbsp;<span class="ident" id="2272947">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272955">wb</span>&nbsp;<span class="op" id="2272958">:=</span>&nbsp;<span class="ident" id="2272961">newNetlinkRouteRequest</span><span class="op" id="2272983">(</span><span class="ident" id="2272984">proto</span><span class="op" id="2272989">,</span>&nbsp;<span class="num" id="2272991">1</span><span class="op" id="2272992">,</span>&nbsp;<span class="ident" id="2272994">family</span><span class="op" id="2273000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273003">if</span>&nbsp;<span class="ident" id="2273006">err</span>&nbsp;<span class="op" id="2273010">:=</span>&nbsp;<span class="ident" id="2273013">Sendto</span><span class="op" id="2273019">(</span><span class="ident" id="2273020">s</span><span class="op" id="2273021">,</span>&nbsp;<span class="ident" id="2273023">wb</span><span class="op" id="2273025">,</span>&nbsp;<span class="num" id="2273027">0</span><span class="op" id="2273028">,</span>&nbsp;<span class="ident" id="2273030">lsa</span><span class="op" id="2273033">)</span><span class="op" id="2273034">;</span>&nbsp;<span class="ident" id="2273036">err</span>&nbsp;<span class="op" id="2273040">!=</span>&nbsp;<span class="ident" id="2273043">nil</span>&nbsp;<span class="op" id="2273047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273051">return</span>&nbsp;<span class="ident" id="2273058">nil</span><span class="op" id="2273061">,</span>&nbsp;<span class="ident" id="2273063">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273071">var</span>&nbsp;<span class="ident" id="2273075">tab</span>&nbsp;<span class="op" id="2273079">[</span><span class="op" id="2273080">]</span><span class="builtintype" id="2273081">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273087">rbNew</span>&nbsp;<span class="op" id="2273093">:=</span>&nbsp;<span class="builtinfunc" id="2273096">make</span><span class="op" id="2273100">(</span><span class="op" id="2273101">[</span><span class="op" id="2273102">]</span><span class="builtintype" id="2273103">byte</span><span class="op" id="2273107">,</span>&nbsp;<span class="ident" id="2273109">Getpagesize</span><span class="op" id="2273120">(</span><span class="op" id="2273121">)</span><span class="op" id="2273122">)</span><br>
<span class="lineno"></span><span class="ident" id="2273124">done</span><span class="op" id="2273128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273131">for</span>&nbsp;<span class="op" id="2273135">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273139">rb</span>&nbsp;<span class="op" id="2273142">:=</span>&nbsp;<span class="ident" id="2273145">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273153">nr</span><span class="op" id="2273155">,</span>&nbsp;<span class="ident" id="2273157">_</span><span class="op" id="2273158">,</span>&nbsp;<span class="ident" id="2273160">err</span>&nbsp;<span class="op" id="2273164">:=</span>&nbsp;<span class="ident" id="2273167">Recvfrom</span><span class="op" id="2273175">(</span><span class="ident" id="2273176">s</span><span class="op" id="2273177">,</span>&nbsp;<span class="ident" id="2273179">rb</span><span class="op" id="2273181">,</span>&nbsp;<span class="num" id="2273183">0</span><span class="op" id="2273184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273188">if</span>&nbsp;<span class="ident" id="2273191">err</span>&nbsp;<span class="op" id="2273195">!=</span>&nbsp;<span class="ident" id="2273198">nil</span>&nbsp;<span class="op" id="2273202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273207">return</span>&nbsp;<span class="ident" id="2273214">nil</span><span class="op" id="2273217">,</span>&nbsp;<span class="ident" id="2273219">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273225">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273229">if</span>&nbsp;<span class="ident" id="2273232">nr</span>&nbsp;<span class="op" id="2273235">&lt;</span>&nbsp;<span class="ident" id="2273237">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2273250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273255">return</span>&nbsp;<span class="ident" id="2273262">nil</span><span class="op" id="2273265">,</span>&nbsp;<span class="ident" id="2273267">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273280">rb</span>&nbsp;<span class="op" id="2273283">=</span>&nbsp;<span class="ident" id="2273285">rb</span><span class="op" id="2273287">[</span><span class="op" id="2273288">:</span><span class="ident" id="2273289">nr</span><span class="op" id="2273291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273295">tab</span>&nbsp;<span class="op" id="2273299">=</span>&nbsp;<span class="builtinfunc" id="2273301">append</span><span class="op" id="2273307">(</span><span class="ident" id="2273308">tab</span><span class="op" id="2273311">,</span>&nbsp;<span class="ident" id="2273313">rb</span><span class="op" id="2273315">...</span><span class="op" id="2273318">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273322">msgs</span><span class="op" id="2273326">,</span>&nbsp;<span class="ident" id="2273328">err</span>&nbsp;<span class="op" id="2273332">:=</span>&nbsp;<span class="ident" id="2273335">ParseNetlinkMessage</span><span class="op" id="2273354">(</span><span class="ident" id="2273355">rb</span><span class="op" id="2273357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273361">if</span>&nbsp;<span class="ident" id="2273364">err</span>&nbsp;<span class="op" id="2273368">!=</span>&nbsp;<span class="ident" id="2273371">nil</span>&nbsp;<span class="op" id="2273375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273380">return</span>&nbsp;<span class="ident" id="2273387">nil</span><span class="op" id="2273390">,</span>&nbsp;<span class="ident" id="2273392">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273402">for</span>&nbsp;<span class="ident" id="2273406">_</span><span class="op" id="2273407">,</span>&nbsp;<span class="ident" id="2273409">m</span>&nbsp;<span class="op" id="2273411">:=</span>&nbsp;<span class="keyword" id="2273414">range</span>&nbsp;<span class="ident" id="2273420">msgs</span>&nbsp;<span class="op" id="2273425">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273430">lsa</span><span class="op" id="2273433">,</span>&nbsp;<span class="ident" id="2273435">err</span>&nbsp;<span class="op" id="2273439">:=</span>&nbsp;<span class="ident" id="2273442">Getsockname</span><span class="op" id="2273453">(</span><span class="ident" id="2273454">s</span><span class="op" id="2273455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273460">if</span>&nbsp;<span class="ident" id="2273463">err</span>&nbsp;<span class="op" id="2273467">!=</span>&nbsp;<span class="ident" id="2273470">nil</span>&nbsp;<span class="op" id="2273474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273480">return</span>&nbsp;<span class="ident" id="2273487">nil</span><span class="op" id="2273490">,</span>&nbsp;<span class="ident" id="2273492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273504">switch</span>&nbsp;<span class="ident" id="2273511">v</span>&nbsp;<span class="op" id="2273513">:=</span>&nbsp;<span class="ident" id="2273516">lsa</span><span class="op" id="2273519">.</span><span class="op" id="2273520">(</span><span class="keyword" id="2273521">type</span><span class="op" id="2273525">)</span>&nbsp;<span class="op" id="2273527">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273532">case</span>&nbsp;<span class="op" id="2273537">*</span><span class="ident" id="2273538">SockaddrNetlink</span><span class="op" id="2273553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273559">if</span>&nbsp;<span class="ident" id="2273562">m</span><span class="op" id="2273563">.</span><span class="ident" id="2273564">Header</span><span class="op" id="2273570">.</span><span class="ident" id="2273571">Seq</span>&nbsp;<span class="op" id="2273575">!=</span>&nbsp;<span class="num" id="2273578">1</span>&nbsp;<span class="op" id="2273580">||</span>&nbsp;<span class="ident" id="2273583">m</span><span class="op" id="2273584">.</span><span class="ident" id="2273585">Header</span><span class="op" id="2273591">.</span><span class="ident" id="2273592">Pid</span>&nbsp;<span class="op" id="2273596">!=</span>&nbsp;<span class="ident" id="2273599">v</span><span class="op" id="2273600">.</span><span class="ident" id="2273601">Pid</span>&nbsp;<span class="op" id="2273605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273612">return</span>&nbsp;<span class="ident" id="2273619">nil</span><span class="op" id="2273622">,</span>&nbsp;<span class="ident" id="2273624">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273640">default</span><span class="op" id="2273647">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273653">return</span>&nbsp;<span class="ident" id="2273660">nil</span><span class="op" id="2273663">,</span>&nbsp;<span class="ident" id="2273665">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273680">if</span>&nbsp;<span class="ident" id="2273683">m</span><span class="op" id="2273684">.</span><span class="ident" id="2273685">Header</span><span class="op" id="2273691">.</span><span class="ident" id="2273692">Type</span>&nbsp;<span class="op" id="2273697">==</span>&nbsp;<span class="ident" id="2273700">NLMSG_DONE</span>&nbsp;<span class="op" id="2273711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273717">break</span>&nbsp;<span class="ident" id="2273723">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273731">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273736">if</span>&nbsp;<span class="ident" id="2273739">m</span><span class="op" id="2273740">.</span><span class="ident" id="2273741">Header</span><span class="op" id="2273747">.</span><span class="ident" id="2273748">Type</span>&nbsp;<span class="op" id="2273753">==</span>&nbsp;<span class="ident" id="2273756">NLMSG_ERROR</span>&nbsp;<span class="op" id="2273768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273774">return</span>&nbsp;<span class="ident" id="2273781">nil</span><span class="op" id="2273784">,</span>&nbsp;<span class="ident" id="2273786">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273803">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273806">return</span>&nbsp;<span class="ident" id="2273813">tab</span><span class="op" id="2273816">,</span>&nbsp;<span class="ident" id="2273818">nil</span><br>
<span class="lineno"></span><span class="op" id="2273822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2273825">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2273873">type</span>&nbsp;<span class="ident" id="2273878">NetlinkMessage</span>&nbsp;<span class="keyword" id="2273893">struct</span>&nbsp;<span class="op" id="2273900">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273903">Header</span>&nbsp;<span class="ident" id="2273910">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273920">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2273927">[</span><span class="op" id="2273928">]</span><span class="builtintype" id="2273929">byte</span><br>
<span class="lineno"></span><span class="op" id="2273934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2273937">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2274005">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2274068">func</span>&nbsp;<span class="ident" id="2274073">ParseNetlinkMessage</span><span class="op" id="2274092">(</span><span class="ident" id="2274093">b</span>&nbsp;<span class="op" id="2274095">[</span><span class="op" id="2274096">]</span><span class="builtintype" id="2274097">byte</span><span class="op" id="2274101">)</span>&nbsp;<span class="op" id="2274103">(</span><span class="op" id="2274104">[</span><span class="op" id="2274105">]</span><span class="ident" id="2274106">NetlinkMessage</span><span class="op" id="2274120">,</span>&nbsp;<span class="builtintype" id="2274122">error</span><span class="op" id="2274127">)</span>&nbsp;<span class="op" id="2274129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274132">var</span>&nbsp;<span class="ident" id="2274136">msgs</span>&nbsp;<span class="op" id="2274141">[</span><span class="op" id="2274142">]</span><span class="ident" id="2274143">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274159">for</span>&nbsp;<span class="builtinfunc" id="2274163">len</span><span class="op" id="2274166">(</span><span class="ident" id="2274167">b</span><span class="op" id="2274168">)</span>&nbsp;<span class="op" id="2274170">&gt;=</span>&nbsp;<span class="ident" id="2274173">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2274186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274190">h</span><span class="op" id="2274191">,</span>&nbsp;<span class="ident" id="2274193">dbuf</span><span class="op" id="2274197">,</span>&nbsp;<span class="ident" id="2274199">dlen</span><span class="op" id="2274203">,</span>&nbsp;<span class="ident" id="2274205">err</span>&nbsp;<span class="op" id="2274209">:=</span>&nbsp;<span class="ident" id="2274212">netlinkMessageHeaderAndData</span><span class="op" id="2274239">(</span><span class="ident" id="2274240">b</span><span class="op" id="2274241">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274245">if</span>&nbsp;<span class="ident" id="2274248">err</span>&nbsp;<span class="op" id="2274252">!=</span>&nbsp;<span class="ident" id="2274255">nil</span>&nbsp;<span class="op" id="2274259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274264">return</span>&nbsp;<span class="ident" id="2274271">nil</span><span class="op" id="2274274">,</span>&nbsp;<span class="ident" id="2274276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274286">m</span>&nbsp;<span class="op" id="2274288">:=</span>&nbsp;<span class="ident" id="2274291">NetlinkMessage</span><span class="op" id="2274305">{</span><span class="ident" id="2274306">Header</span><span class="op" id="2274312">:</span>&nbsp;<span class="op" id="2274314">*</span><span class="ident" id="2274315">h</span><span class="op" id="2274316">,</span>&nbsp;<span class="ident" id="2274318">Data</span><span class="op" id="2274322">:</span>&nbsp;<span class="ident" id="2274324">dbuf</span><span class="op" id="2274328">[</span><span class="op" id="2274329">:</span><span class="builtintype" id="2274330">int</span><span class="op" id="2274333">(</span><span class="ident" id="2274334">h</span><span class="op" id="2274335">.</span><span class="ident" id="2274336">Len</span><span class="op" id="2274339">)</span><span class="op" id="2274340">-</span><span class="ident" id="2274341">NLMSG_HDRLEN</span><span class="op" id="2274353">]</span><span class="op" id="2274354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274358">msgs</span>&nbsp;<span class="op" id="2274363">=</span>&nbsp;<span class="builtinfunc" id="2274365">append</span><span class="op" id="2274371">(</span><span class="ident" id="2274372">msgs</span><span class="op" id="2274376">,</span>&nbsp;<span class="ident" id="2274378">m</span><span class="op" id="2274379">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274383">b</span>&nbsp;<span class="op" id="2274385">=</span>&nbsp;<span class="ident" id="2274387">b</span><span class="op" id="2274388">[</span><span class="ident" id="2274389">dlen</span><span class="op" id="2274393">:</span><span class="op" id="2274394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274400">return</span>&nbsp;<span class="ident" id="2274407">msgs</span><span class="op" id="2274411">,</span>&nbsp;<span class="ident" id="2274413">nil</span><br>
<span class="lineno"></span><span class="op" id="2274417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2274420">func</span>&nbsp;<span class="ident" id="2274425">netlinkMessageHeaderAndData</span><span class="op" id="2274452">(</span><span class="ident" id="2274453">b</span>&nbsp;<span class="op" id="2274455">[</span><span class="op" id="2274456">]</span><span class="builtintype" id="2274457">byte</span><span class="op" id="2274461">)</span>&nbsp;<span class="op" id="2274463">(</span><span class="op" id="2274464">*</span><span class="ident" id="2274465">NlMsghdr</span><span class="op" id="2274473">,</span>&nbsp;<span class="op" id="2274475">[</span><span class="op" id="2274476">]</span><span class="builtintype" id="2274477">byte</span><span class="op" id="2274481">,</span>&nbsp;<span class="builtintype" id="2274483">int</span><span class="op" id="2274486">,</span>&nbsp;<span class="builtintype" id="2274488">error</span><span class="op" id="2274493">)</span>&nbsp;<span class="op" id="2274495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274498">h</span>&nbsp;<span class="op" id="2274500">:=</span>&nbsp;<span class="op" id="2274503">(</span><span class="op" id="2274504">*</span><span class="ident" id="2274505">NlMsghdr</span><span class="op" id="2274513">)</span><span class="op" id="2274514">(</span><span class="ident" id="2274515">unsafe</span><span class="op" id="2274521">.</span><span class="ident" id="2274522">Pointer</span><span class="op" id="2274529">(</span><span class="op" id="2274530">&amp;</span><span class="ident" id="2274531">b</span><span class="op" id="2274532">[</span><span class="num" id="2274533">0</span><span class="op" id="2274534">]</span><span class="op" id="2274535">)</span><span class="op" id="2274536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274539">if</span>&nbsp;<span class="builtintype" id="2274542">int</span><span class="op" id="2274545">(</span><span class="ident" id="2274546">h</span><span class="op" id="2274547">.</span><span class="ident" id="2274548">Len</span><span class="op" id="2274551">)</span>&nbsp;<span class="op" id="2274553">&lt;</span>&nbsp;<span class="ident" id="2274555">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2274568">||</span>&nbsp;<span class="builtintype" id="2274571">int</span><span class="op" id="2274574">(</span><span class="ident" id="2274575">h</span><span class="op" id="2274576">.</span><span class="ident" id="2274577">Len</span><span class="op" id="2274580">)</span>&nbsp;<span class="op" id="2274582">&gt;</span>&nbsp;<span class="builtinfunc" id="2274584">len</span><span class="op" id="2274587">(</span><span class="ident" id="2274588">b</span><span class="op" id="2274589">)</span>&nbsp;<span class="op" id="2274591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274595">return</span>&nbsp;<span class="ident" id="2274602">nil</span><span class="op" id="2274605">,</span>&nbsp;<span class="ident" id="2274607">nil</span><span class="op" id="2274610">,</span>&nbsp;<span class="num" id="2274612">0</span><span class="op" id="2274613">,</span>&nbsp;<span class="ident" id="2274615">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274623">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274626">return</span>&nbsp;<span class="ident" id="2274633">h</span><span class="op" id="2274634">,</span>&nbsp;<span class="ident" id="2274636">b</span><span class="op" id="2274637">[</span><span class="ident" id="2274638">NLMSG_HDRLEN</span><span class="op" id="2274650">:</span><span class="op" id="2274651">]</span><span class="op" id="2274652">,</span>&nbsp;<span class="ident" id="2274654">nlmAlignOf</span><span class="op" id="2274664">(</span><span class="builtintype" id="2274665">int</span><span class="op" id="2274668">(</span><span class="ident" id="2274669">h</span><span class="op" id="2274670">.</span><span class="ident" id="2274671">Len</span><span class="op" id="2274674">)</span><span class="op" id="2274675">)</span><span class="op" id="2274676">,</span>&nbsp;<span class="ident" id="2274678">nil</span><br>
<span class="lineno"></span><span class="op" id="2274682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2274685">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2274743">type</span>&nbsp;<span class="ident" id="2274748">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2274765">struct</span>&nbsp;<span class="op" id="2274772">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274775">Attr</span>&nbsp;&nbsp;<span class="ident" id="2274781">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274789">Value</span>&nbsp;<span class="op" id="2274795">[</span><span class="op" id="2274796">]</span><span class="builtintype" id="2274797">byte</span><br>
<span class="lineno"></span><span class="op" id="2274802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2274805">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2274872">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2274929">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2274961">func</span>&nbsp;<span class="ident" id="2274966">ParseNetlinkRouteAttr</span><span class="op" id="2274987">(</span><span class="ident" id="2274988">m</span>&nbsp;<span class="op" id="2274990">*</span><span class="ident" id="2274991">NetlinkMessage</span><span class="op" id="2275005">)</span>&nbsp;<span class="op" id="2275007">(</span><span class="op" id="2275008">[</span><span class="op" id="2275009">]</span><span class="ident" id="2275010">NetlinkRouteAttr</span><span class="op" id="2275026">,</span>&nbsp;<span class="builtintype" id="2275028">error</span><span class="op" id="2275033">)</span>&nbsp;<span class="op" id="2275035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275038">var</span>&nbsp;<span class="ident" id="2275042">b</span>&nbsp;<span class="op" id="2275044">[</span><span class="op" id="2275045">]</span><span class="builtintype" id="2275046">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275052">switch</span>&nbsp;<span class="ident" id="2275059">m</span><span class="op" id="2275060">.</span><span class="ident" id="2275061">Header</span><span class="op" id="2275067">.</span><span class="ident" id="2275068">Type</span>&nbsp;<span class="op" id="2275073">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275076">case</span>&nbsp;<span class="ident" id="2275081">RTM_NEWLINK</span><span class="op" id="2275092">,</span>&nbsp;<span class="ident" id="2275094">RTM_DELLINK</span><span class="op" id="2275105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275109">b</span>&nbsp;<span class="op" id="2275111">=</span>&nbsp;<span class="ident" id="2275113">m</span><span class="op" id="2275114">.</span><span class="ident" id="2275115">Data</span><span class="op" id="2275119">[</span><span class="ident" id="2275120">SizeofIfInfomsg</span><span class="op" id="2275135">:</span><span class="op" id="2275136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275139">case</span>&nbsp;<span class="ident" id="2275144">RTM_NEWADDR</span><span class="op" id="2275155">,</span>&nbsp;<span class="ident" id="2275157">RTM_DELADDR</span><span class="op" id="2275168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275172">b</span>&nbsp;<span class="op" id="2275174">=</span>&nbsp;<span class="ident" id="2275176">m</span><span class="op" id="2275177">.</span><span class="ident" id="2275178">Data</span><span class="op" id="2275182">[</span><span class="ident" id="2275183">SizeofIfAddrmsg</span><span class="op" id="2275198">:</span><span class="op" id="2275199">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275202">case</span>&nbsp;<span class="ident" id="2275207">RTM_NEWROUTE</span><span class="op" id="2275219">,</span>&nbsp;<span class="ident" id="2275221">RTM_DELROUTE</span><span class="op" id="2275233">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275237">b</span>&nbsp;<span class="op" id="2275239">=</span>&nbsp;<span class="ident" id="2275241">m</span><span class="op" id="2275242">.</span><span class="ident" id="2275243">Data</span><span class="op" id="2275247">[</span><span class="ident" id="2275248">SizeofRtMsg</span><span class="op" id="2275259">:</span><span class="op" id="2275260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275263">default</span><span class="op" id="2275270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275274">return</span>&nbsp;<span class="ident" id="2275281">nil</span><span class="op" id="2275284">,</span>&nbsp;<span class="ident" id="2275286">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275297">var</span>&nbsp;<span class="ident" id="2275301">attrs</span>&nbsp;<span class="op" id="2275307">[</span><span class="op" id="2275308">]</span><span class="ident" id="2275309">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275327">for</span>&nbsp;<span class="builtinfunc" id="2275331">len</span><span class="op" id="2275334">(</span><span class="ident" id="2275335">b</span><span class="op" id="2275336">)</span>&nbsp;<span class="op" id="2275338">&gt;=</span>&nbsp;<span class="ident" id="2275341">SizeofRtAttr</span>&nbsp;<span class="op" id="2275354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275358">a</span><span class="op" id="2275359">,</span>&nbsp;<span class="ident" id="2275361">vbuf</span><span class="op" id="2275365">,</span>&nbsp;<span class="ident" id="2275367">alen</span><span class="op" id="2275371">,</span>&nbsp;<span class="ident" id="2275373">err</span>&nbsp;<span class="op" id="2275377">:=</span>&nbsp;<span class="ident" id="2275380">netlinkRouteAttrAndValue</span><span class="op" id="2275404">(</span><span class="ident" id="2275405">b</span><span class="op" id="2275406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275410">if</span>&nbsp;<span class="ident" id="2275413">err</span>&nbsp;<span class="op" id="2275417">!=</span>&nbsp;<span class="ident" id="2275420">nil</span>&nbsp;<span class="op" id="2275424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275429">return</span>&nbsp;<span class="ident" id="2275436">nil</span><span class="op" id="2275439">,</span>&nbsp;<span class="ident" id="2275441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275447">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275451">ra</span>&nbsp;<span class="op" id="2275454">:=</span>&nbsp;<span class="ident" id="2275457">NetlinkRouteAttr</span><span class="op" id="2275473">{</span><span class="ident" id="2275474">Attr</span><span class="op" id="2275478">:</span>&nbsp;<span class="op" id="2275480">*</span><span class="ident" id="2275481">a</span><span class="op" id="2275482">,</span>&nbsp;<span class="ident" id="2275484">Value</span><span class="op" id="2275489">:</span>&nbsp;<span class="ident" id="2275491">vbuf</span><span class="op" id="2275495">[</span><span class="op" id="2275496">:</span><span class="builtintype" id="2275497">int</span><span class="op" id="2275500">(</span><span class="ident" id="2275501">a</span><span class="op" id="2275502">.</span><span class="ident" id="2275503">Len</span><span class="op" id="2275506">)</span><span class="op" id="2275507">-</span><span class="ident" id="2275508">SizeofRtAttr</span><span class="op" id="2275520">]</span><span class="op" id="2275521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275525">attrs</span>&nbsp;<span class="op" id="2275531">=</span>&nbsp;<span class="builtinfunc" id="2275533">append</span><span class="op" id="2275539">(</span><span class="ident" id="2275540">attrs</span><span class="op" id="2275545">,</span>&nbsp;<span class="ident" id="2275547">ra</span><span class="op" id="2275549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275553">b</span>&nbsp;<span class="op" id="2275555">=</span>&nbsp;<span class="ident" id="2275557">b</span><span class="op" id="2275558">[</span><span class="ident" id="2275559">alen</span><span class="op" id="2275563">:</span><span class="op" id="2275564">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275570">return</span>&nbsp;<span class="ident" id="2275577">attrs</span><span class="op" id="2275582">,</span>&nbsp;<span class="ident" id="2275584">nil</span><br>
<span class="lineno">170</span><span class="op" id="2275588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2275591">func</span>&nbsp;<span class="ident" id="2275596">netlinkRouteAttrAndValue</span><span class="op" id="2275620">(</span><span class="ident" id="2275621">b</span>&nbsp;<span class="op" id="2275623">[</span><span class="op" id="2275624">]</span><span class="builtintype" id="2275625">byte</span><span class="op" id="2275629">)</span>&nbsp;<span class="op" id="2275631">(</span><span class="op" id="2275632">*</span><span class="ident" id="2275633">RtAttr</span><span class="op" id="2275639">,</span>&nbsp;<span class="op" id="2275641">[</span><span class="op" id="2275642">]</span><span class="builtintype" id="2275643">byte</span><span class="op" id="2275647">,</span>&nbsp;<span class="builtintype" id="2275649">int</span><span class="op" id="2275652">,</span>&nbsp;<span class="builtintype" id="2275654">error</span><span class="op" id="2275659">)</span>&nbsp;<span class="op" id="2275661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275664">a</span>&nbsp;<span class="op" id="2275666">:=</span>&nbsp;<span class="op" id="2275669">(</span><span class="op" id="2275670">*</span><span class="ident" id="2275671">RtAttr</span><span class="op" id="2275677">)</span><span class="op" id="2275678">(</span><span class="ident" id="2275679">unsafe</span><span class="op" id="2275685">.</span><span class="ident" id="2275686">Pointer</span><span class="op" id="2275693">(</span><span class="op" id="2275694">&amp;</span><span class="ident" id="2275695">b</span><span class="op" id="2275696">[</span><span class="num" id="2275697">0</span><span class="op" id="2275698">]</span><span class="op" id="2275699">)</span><span class="op" id="2275700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275703">if</span>&nbsp;<span class="builtintype" id="2275706">int</span><span class="op" id="2275709">(</span><span class="ident" id="2275710">a</span><span class="op" id="2275711">.</span><span class="ident" id="2275712">Len</span><span class="op" id="2275715">)</span>&nbsp;<span class="op" id="2275717">&lt;</span>&nbsp;<span class="ident" id="2275719">SizeofRtAttr</span>&nbsp;<span class="op" id="2275732">||</span>&nbsp;<span class="builtintype" id="2275735">int</span><span class="op" id="2275738">(</span><span class="ident" id="2275739">a</span><span class="op" id="2275740">.</span><span class="ident" id="2275741">Len</span><span class="op" id="2275744">)</span>&nbsp;<span class="op" id="2275746">&gt;</span>&nbsp;<span class="builtinfunc" id="2275748">len</span><span class="op" id="2275751">(</span><span class="ident" id="2275752">b</span><span class="op" id="2275753">)</span>&nbsp;<span class="op" id="2275755">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275759">return</span>&nbsp;<span class="ident" id="2275766">nil</span><span class="op" id="2275769">,</span>&nbsp;<span class="ident" id="2275771">nil</span><span class="op" id="2275774">,</span>&nbsp;<span class="num" id="2275776">0</span><span class="op" id="2275777">,</span>&nbsp;<span class="ident" id="2275779">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275790">return</span>&nbsp;<span class="ident" id="2275797">a</span><span class="op" id="2275798">,</span>&nbsp;<span class="ident" id="2275800">b</span><span class="op" id="2275801">[</span><span class="ident" id="2275802">SizeofRtAttr</span><span class="op" id="2275814">:</span><span class="op" id="2275815">]</span><span class="op" id="2275816">,</span>&nbsp;<span class="ident" id="2275818">rtaAlignOf</span><span class="op" id="2275828">(</span><span class="builtintype" id="2275829">int</span><span class="op" id="2275832">(</span><span class="ident" id="2275833">a</span><span class="op" id="2275834">.</span><span class="ident" id="2275835">Len</span><span class="op" id="2275838">)</span><span class="op" id="2275839">)</span><span class="op" id="2275840">,</span>&nbsp;<span class="ident" id="2275842">nil</span><br>
<span class="lineno"></span><span class="op" id="2275846">}</span>
</div>
</body>
</html>
