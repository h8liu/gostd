<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html" class="current">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2932118">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2932173">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2932227">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2932278">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2932348">package</span>&nbsp;<span class="ident" id="2932356">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2932365">import</span>&nbsp;<span class="op" id="2932372">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2932375">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2932386">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2932401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2932404">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2932545">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2932608">func</span>&nbsp;<span class="ident" id="2932613">explode</span><span class="op" id="2932620">(</span><span class="ident" id="2932621">s</span>&nbsp;<span class="builtintype" id="2932623">string</span><span class="op" id="2932629">,</span>&nbsp;<span class="ident" id="2932631">n</span>&nbsp;<span class="builtintype" id="2932633">int</span><span class="op" id="2932636">)</span>&nbsp;<span class="op" id="2932638">[</span><span class="op" id="2932639">]</span><span class="builtintype" id="2932640">string</span>&nbsp;<span class="op" id="2932647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932650">if</span>&nbsp;<span class="ident" id="2932653">n</span>&nbsp;<span class="op" id="2932655">==</span>&nbsp;<span class="num" id="2932658">0</span>&nbsp;<span class="op" id="2932660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932664">return</span>&nbsp;<span class="ident" id="2932671">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932679">l</span>&nbsp;<span class="op" id="2932681">:=</span>&nbsp;<span class="ident" id="2932684">utf8</span><span class="op" id="2932688">.</span><span class="ident" id="2932689">RuneCountInString</span><span class="op" id="2932706">(</span><span class="ident" id="2932707">s</span><span class="op" id="2932708">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932711">if</span>&nbsp;<span class="ident" id="2932714">n</span>&nbsp;<span class="op" id="2932716">&lt;=</span>&nbsp;<span class="num" id="2932719">0</span>&nbsp;<span class="op" id="2932721">||</span>&nbsp;<span class="ident" id="2932724">n</span>&nbsp;<span class="op" id="2932726">&gt;</span>&nbsp;<span class="ident" id="2932728">l</span>&nbsp;<span class="op" id="2932730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932734">n</span>&nbsp;<span class="op" id="2932736">=</span>&nbsp;<span class="ident" id="2932738">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932744">a</span>&nbsp;<span class="op" id="2932746">:=</span>&nbsp;<span class="builtinfunc" id="2932749">make</span><span class="op" id="2932753">(</span><span class="op" id="2932754">[</span><span class="op" id="2932755">]</span><span class="builtintype" id="2932756">string</span><span class="op" id="2932762">,</span>&nbsp;<span class="ident" id="2932764">n</span><span class="op" id="2932765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932768">var</span>&nbsp;<span class="ident" id="2932772">size</span>&nbsp;<span class="builtintype" id="2932777">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932782">var</span>&nbsp;<span class="ident" id="2932786">ch</span>&nbsp;<span class="builtintype" id="2932789">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932795">i</span><span class="op" id="2932796">,</span>&nbsp;<span class="ident" id="2932798">cur</span>&nbsp;<span class="op" id="2932802">:=</span>&nbsp;<span class="num" id="2932805">0</span><span class="op" id="2932806">,</span>&nbsp;<span class="num" id="2932808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932811">for</span>&nbsp;<span class="op" id="2932815">;</span>&nbsp;<span class="ident" id="2932817">i</span><span class="op" id="2932818">+</span><span class="num" id="2932819">1</span>&nbsp;<span class="op" id="2932821">&lt;</span>&nbsp;<span class="ident" id="2932823">n</span><span class="op" id="2932824">;</span>&nbsp;<span class="ident" id="2932826">i</span><span class="op" id="2932827">++</span>&nbsp;<span class="op" id="2932830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932834">ch</span><span class="op" id="2932836">,</span>&nbsp;<span class="ident" id="2932838">size</span>&nbsp;<span class="op" id="2932843">=</span>&nbsp;<span class="ident" id="2932845">utf8</span><span class="op" id="2932849">.</span><span class="ident" id="2932850">DecodeRuneInString</span><span class="op" id="2932868">(</span><span class="ident" id="2932869">s</span><span class="op" id="2932870">[</span><span class="ident" id="2932871">cur</span><span class="op" id="2932874">:</span><span class="op" id="2932875">]</span><span class="op" id="2932876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932880">if</span>&nbsp;<span class="ident" id="2932883">ch</span>&nbsp;<span class="op" id="2932886">==</span>&nbsp;<span class="ident" id="2932889">utf8</span><span class="op" id="2932893">.</span><span class="ident" id="2932894">RuneError</span>&nbsp;<span class="op" id="2932904">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932909">a</span><span class="op" id="2932910">[</span><span class="ident" id="2932911">i</span><span class="op" id="2932912">]</span>&nbsp;<span class="op" id="2932914">=</span>&nbsp;<span class="builtintype" id="2932916">string</span><span class="op" id="2932922">(</span><span class="ident" id="2932923">utf8</span><span class="op" id="2932927">.</span><span class="ident" id="2932928">RuneError</span><span class="op" id="2932937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932941">}</span>&nbsp;<span class="keyword" id="2932943">else</span>&nbsp;<span class="op" id="2932948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932953">a</span><span class="op" id="2932954">[</span><span class="ident" id="2932955">i</span><span class="op" id="2932956">]</span>&nbsp;<span class="op" id="2932958">=</span>&nbsp;<span class="ident" id="2932960">s</span><span class="op" id="2932961">[</span><span class="ident" id="2932962">cur</span>&nbsp;<span class="op" id="2932966">:</span>&nbsp;<span class="ident" id="2932968">cur</span><span class="op" id="2932971">+</span><span class="ident" id="2932972">size</span><span class="op" id="2932976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932984">cur</span>&nbsp;<span class="op" id="2932988">+=</span>&nbsp;<span class="ident" id="2932991">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933000">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933034">if</span>&nbsp;<span class="ident" id="2933037">cur</span>&nbsp;<span class="op" id="2933041">&lt;</span>&nbsp;<span class="builtinfunc" id="2933043">len</span><span class="op" id="2933046">(</span><span class="ident" id="2933047">s</span><span class="op" id="2933048">)</span>&nbsp;<span class="op" id="2933050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933054">a</span><span class="op" id="2933055">[</span><span class="ident" id="2933056">i</span><span class="op" id="2933057">]</span>&nbsp;<span class="op" id="2933059">=</span>&nbsp;<span class="ident" id="2933061">s</span><span class="op" id="2933062">[</span><span class="ident" id="2933063">cur</span><span class="op" id="2933066">:</span><span class="op" id="2933067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933070">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933073">return</span>&nbsp;<span class="ident" id="2933080">a</span><br>
<span class="lineno"></span><span class="op" id="2933082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2933085">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2933144">const</span>&nbsp;<span class="ident" id="2933150">primeRK</span>&nbsp;<span class="op" id="2933158">=</span>&nbsp;<span class="num" id="2933160">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2933170">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2933233">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2933276">func</span>&nbsp;<span class="ident" id="2933281">hashStr</span><span class="op" id="2933288">(</span><span class="ident" id="2933289">sep</span>&nbsp;<span class="builtintype" id="2933293">string</span><span class="op" id="2933299">)</span>&nbsp;<span class="op" id="2933301">(</span><span class="builtintype" id="2933302">uint32</span><span class="op" id="2933308">,</span>&nbsp;<span class="builtintype" id="2933310">uint32</span><span class="op" id="2933316">)</span>&nbsp;<span class="op" id="2933318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933321">hash</span>&nbsp;<span class="op" id="2933326">:=</span>&nbsp;<span class="builtintype" id="2933329">uint32</span><span class="op" id="2933335">(</span><span class="num" id="2933336">0</span><span class="op" id="2933337">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933340">for</span>&nbsp;<span class="ident" id="2933344">i</span>&nbsp;<span class="op" id="2933346">:=</span>&nbsp;<span class="num" id="2933349">0</span><span class="op" id="2933350">;</span>&nbsp;<span class="ident" id="2933352">i</span>&nbsp;<span class="op" id="2933354">&lt;</span>&nbsp;<span class="builtinfunc" id="2933356">len</span><span class="op" id="2933359">(</span><span class="ident" id="2933360">sep</span><span class="op" id="2933363">)</span><span class="op" id="2933364">;</span>&nbsp;<span class="ident" id="2933366">i</span><span class="op" id="2933367">++</span>&nbsp;<span class="op" id="2933370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933374">hash</span>&nbsp;<span class="op" id="2933379">=</span>&nbsp;<span class="ident" id="2933381">hash</span><span class="op" id="2933385">*</span><span class="ident" id="2933386">primeRK</span>&nbsp;<span class="op" id="2933394">+</span>&nbsp;<span class="builtintype" id="2933396">uint32</span><span class="op" id="2933402">(</span><span class="ident" id="2933403">sep</span><span class="op" id="2933406">[</span><span class="ident" id="2933407">i</span><span class="op" id="2933408">]</span><span class="op" id="2933409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933415">var</span>&nbsp;<span class="ident" id="2933419">pow</span><span class="op" id="2933422">,</span>&nbsp;<span class="ident" id="2933424">sq</span>&nbsp;<span class="builtintype" id="2933427">uint32</span>&nbsp;<span class="op" id="2933434">=</span>&nbsp;<span class="num" id="2933436">1</span><span class="op" id="2933437">,</span>&nbsp;<span class="ident" id="2933439">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933448">for</span>&nbsp;<span class="ident" id="2933452">i</span>&nbsp;<span class="op" id="2933454">:=</span>&nbsp;<span class="builtinfunc" id="2933457">len</span><span class="op" id="2933460">(</span><span class="ident" id="2933461">sep</span><span class="op" id="2933464">)</span><span class="op" id="2933465">;</span>&nbsp;<span class="ident" id="2933467">i</span>&nbsp;<span class="op" id="2933469">&gt;</span>&nbsp;<span class="num" id="2933471">0</span><span class="op" id="2933472">;</span>&nbsp;<span class="ident" id="2933474">i</span>&nbsp;<span class="op" id="2933476">&gt;&gt;=</span>&nbsp;<span class="num" id="2933480">1</span>&nbsp;<span class="op" id="2933482">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933486">if</span>&nbsp;<span class="ident" id="2933489">i</span><span class="op" id="2933490">&amp;</span><span class="num" id="2933491">1</span>&nbsp;<span class="op" id="2933493">!=</span>&nbsp;<span class="num" id="2933496">0</span>&nbsp;<span class="op" id="2933498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933503">pow</span>&nbsp;<span class="op" id="2933507">*=</span>&nbsp;<span class="ident" id="2933510">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933519">sq</span>&nbsp;<span class="op" id="2933522">*=</span>&nbsp;<span class="ident" id="2933525">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933529">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933532">return</span>&nbsp;<span class="ident" id="2933539">hash</span><span class="op" id="2933543">,</span>&nbsp;<span class="ident" id="2933545">pow</span><br>
<span class="lineno"></span><span class="op" id="2933549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2933552">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2933613">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2933683">func</span>&nbsp;<span class="ident" id="2933688">hashStrRev</span><span class="op" id="2933698">(</span><span class="ident" id="2933699">sep</span>&nbsp;<span class="builtintype" id="2933703">string</span><span class="op" id="2933709">)</span>&nbsp;<span class="op" id="2933711">(</span><span class="builtintype" id="2933712">uint32</span><span class="op" id="2933718">,</span>&nbsp;<span class="builtintype" id="2933720">uint32</span><span class="op" id="2933726">)</span>&nbsp;<span class="op" id="2933728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933731">hash</span>&nbsp;<span class="op" id="2933736">:=</span>&nbsp;<span class="builtintype" id="2933739">uint32</span><span class="op" id="2933745">(</span><span class="num" id="2933746">0</span><span class="op" id="2933747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933750">for</span>&nbsp;<span class="ident" id="2933754">i</span>&nbsp;<span class="op" id="2933756">:=</span>&nbsp;<span class="builtinfunc" id="2933759">len</span><span class="op" id="2933762">(</span><span class="ident" id="2933763">sep</span><span class="op" id="2933766">)</span>&nbsp;<span class="op" id="2933768">-</span>&nbsp;<span class="num" id="2933770">1</span><span class="op" id="2933771">;</span>&nbsp;<span class="ident" id="2933773">i</span>&nbsp;<span class="op" id="2933775">&gt;=</span>&nbsp;<span class="num" id="2933778">0</span><span class="op" id="2933779">;</span>&nbsp;<span class="ident" id="2933781">i</span><span class="op" id="2933782">--</span>&nbsp;<span class="op" id="2933785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933789">hash</span>&nbsp;<span class="op" id="2933794">=</span>&nbsp;<span class="ident" id="2933796">hash</span><span class="op" id="2933800">*</span><span class="ident" id="2933801">primeRK</span>&nbsp;<span class="op" id="2933809">+</span>&nbsp;<span class="builtintype" id="2933811">uint32</span><span class="op" id="2933817">(</span><span class="ident" id="2933818">sep</span><span class="op" id="2933821">[</span><span class="ident" id="2933822">i</span><span class="op" id="2933823">]</span><span class="op" id="2933824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933827">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933830">var</span>&nbsp;<span class="ident" id="2933834">pow</span><span class="op" id="2933837">,</span>&nbsp;<span class="ident" id="2933839">sq</span>&nbsp;<span class="builtintype" id="2933842">uint32</span>&nbsp;<span class="op" id="2933849">=</span>&nbsp;<span class="num" id="2933851">1</span><span class="op" id="2933852">,</span>&nbsp;<span class="ident" id="2933854">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933863">for</span>&nbsp;<span class="ident" id="2933867">i</span>&nbsp;<span class="op" id="2933869">:=</span>&nbsp;<span class="builtinfunc" id="2933872">len</span><span class="op" id="2933875">(</span><span class="ident" id="2933876">sep</span><span class="op" id="2933879">)</span><span class="op" id="2933880">;</span>&nbsp;<span class="ident" id="2933882">i</span>&nbsp;<span class="op" id="2933884">&gt;</span>&nbsp;<span class="num" id="2933886">0</span><span class="op" id="2933887">;</span>&nbsp;<span class="ident" id="2933889">i</span>&nbsp;<span class="op" id="2933891">&gt;&gt;=</span>&nbsp;<span class="num" id="2933895">1</span>&nbsp;<span class="op" id="2933897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933901">if</span>&nbsp;<span class="ident" id="2933904">i</span><span class="op" id="2933905">&amp;</span><span class="num" id="2933906">1</span>&nbsp;<span class="op" id="2933908">!=</span>&nbsp;<span class="num" id="2933911">0</span>&nbsp;<span class="op" id="2933913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933918">pow</span>&nbsp;<span class="op" id="2933922">*=</span>&nbsp;<span class="ident" id="2933925">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933930">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933934">sq</span>&nbsp;<span class="op" id="2933937">*=</span>&nbsp;<span class="ident" id="2933940">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933947">return</span>&nbsp;<span class="ident" id="2933954">hash</span><span class="op" id="2933958">,</span>&nbsp;<span class="ident" id="2933960">pow</span><br>
<span class="lineno"></span><span class="op" id="2933964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2933967">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2934036">func</span>&nbsp;<span class="ident" id="2934041">Count</span><span class="op" id="2934046">(</span><span class="ident" id="2934047">s</span><span class="op" id="2934048">,</span>&nbsp;<span class="ident" id="2934050">sep</span>&nbsp;<span class="builtintype" id="2934054">string</span><span class="op" id="2934060">)</span>&nbsp;<span class="builtintype" id="2934062">int</span>&nbsp;<span class="op" id="2934066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934069">n</span>&nbsp;<span class="op" id="2934071">:=</span>&nbsp;<span class="num" id="2934074">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2934077">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934095">switch</span>&nbsp;<span class="op" id="2934102">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934105">case</span>&nbsp;<span class="builtinfunc" id="2934110">len</span><span class="op" id="2934113">(</span><span class="ident" id="2934114">sep</span><span class="op" id="2934117">)</span>&nbsp;<span class="op" id="2934119">==</span>&nbsp;<span class="num" id="2934122">0</span><span class="op" id="2934123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934127">return</span>&nbsp;<span class="ident" id="2934134">utf8</span><span class="op" id="2934138">.</span><span class="ident" id="2934139">RuneCountInString</span><span class="op" id="2934156">(</span><span class="ident" id="2934157">s</span><span class="op" id="2934158">)</span>&nbsp;<span class="op" id="2934160">+</span>&nbsp;<span class="num" id="2934162">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934165">case</span>&nbsp;<span class="builtinfunc" id="2934170">len</span><span class="op" id="2934173">(</span><span class="ident" id="2934174">sep</span><span class="op" id="2934177">)</span>&nbsp;<span class="op" id="2934179">==</span>&nbsp;<span class="num" id="2934182">1</span><span class="op" id="2934183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2934187">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934223">c</span>&nbsp;<span class="op" id="2934225">:=</span>&nbsp;<span class="ident" id="2934228">sep</span><span class="op" id="2934231">[</span><span class="num" id="2934232">0</span><span class="op" id="2934233">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934237">for</span>&nbsp;<span class="ident" id="2934241">i</span>&nbsp;<span class="op" id="2934243">:=</span>&nbsp;<span class="num" id="2934246">0</span><span class="op" id="2934247">;</span>&nbsp;<span class="ident" id="2934249">i</span>&nbsp;<span class="op" id="2934251">&lt;</span>&nbsp;<span class="builtinfunc" id="2934253">len</span><span class="op" id="2934256">(</span><span class="ident" id="2934257">s</span><span class="op" id="2934258">)</span><span class="op" id="2934259">;</span>&nbsp;<span class="ident" id="2934261">i</span><span class="op" id="2934262">++</span>&nbsp;<span class="op" id="2934265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934270">if</span>&nbsp;<span class="ident" id="2934273">s</span><span class="op" id="2934274">[</span><span class="ident" id="2934275">i</span><span class="op" id="2934276">]</span>&nbsp;<span class="op" id="2934278">==</span>&nbsp;<span class="ident" id="2934281">c</span>&nbsp;<span class="op" id="2934283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934289">n</span><span class="op" id="2934290">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934300">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934304">return</span>&nbsp;<span class="ident" id="2934311">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934314">case</span>&nbsp;<span class="builtinfunc" id="2934319">len</span><span class="op" id="2934322">(</span><span class="ident" id="2934323">sep</span><span class="op" id="2934326">)</span>&nbsp;<span class="op" id="2934328">&gt;</span>&nbsp;<span class="builtinfunc" id="2934330">len</span><span class="op" id="2934333">(</span><span class="ident" id="2934334">s</span><span class="op" id="2934335">)</span><span class="op" id="2934336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934340">return</span>&nbsp;<span class="num" id="2934347">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934350">case</span>&nbsp;<span class="builtinfunc" id="2934355">len</span><span class="op" id="2934358">(</span><span class="ident" id="2934359">sep</span><span class="op" id="2934362">)</span>&nbsp;<span class="op" id="2934364">==</span>&nbsp;<span class="builtinfunc" id="2934367">len</span><span class="op" id="2934370">(</span><span class="ident" id="2934371">s</span><span class="op" id="2934372">)</span><span class="op" id="2934373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934377">if</span>&nbsp;<span class="ident" id="2934380">sep</span>&nbsp;<span class="op" id="2934384">==</span>&nbsp;<span class="ident" id="2934387">s</span>&nbsp;<span class="op" id="2934389">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934394">return</span>&nbsp;<span class="num" id="2934401">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934409">return</span>&nbsp;<span class="num" id="2934416">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2934422">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934444">hashsep</span><span class="op" id="2934451">,</span>&nbsp;<span class="ident" id="2934453">pow</span>&nbsp;<span class="op" id="2934457">:=</span>&nbsp;<span class="ident" id="2934460">hashStr</span><span class="op" id="2934467">(</span><span class="ident" id="2934468">sep</span><span class="op" id="2934471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934474">h</span>&nbsp;<span class="op" id="2934476">:=</span>&nbsp;<span class="builtintype" id="2934479">uint32</span><span class="op" id="2934485">(</span><span class="num" id="2934486">0</span><span class="op" id="2934487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934490">for</span>&nbsp;<span class="ident" id="2934494">i</span>&nbsp;<span class="op" id="2934496">:=</span>&nbsp;<span class="num" id="2934499">0</span><span class="op" id="2934500">;</span>&nbsp;<span class="ident" id="2934502">i</span>&nbsp;<span class="op" id="2934504">&lt;</span>&nbsp;<span class="builtinfunc" id="2934506">len</span><span class="op" id="2934509">(</span><span class="ident" id="2934510">sep</span><span class="op" id="2934513">)</span><span class="op" id="2934514">;</span>&nbsp;<span class="ident" id="2934516">i</span><span class="op" id="2934517">++</span>&nbsp;<span class="op" id="2934520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934524">h</span>&nbsp;<span class="op" id="2934526">=</span>&nbsp;<span class="ident" id="2934528">h</span><span class="op" id="2934529">*</span><span class="ident" id="2934530">primeRK</span>&nbsp;<span class="op" id="2934538">+</span>&nbsp;<span class="builtintype" id="2934540">uint32</span><span class="op" id="2934546">(</span><span class="ident" id="2934547">s</span><span class="op" id="2934548">[</span><span class="ident" id="2934549">i</span><span class="op" id="2934550">]</span><span class="op" id="2934551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934554">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934557">lastmatch</span>&nbsp;<span class="op" id="2934567">:=</span>&nbsp;<span class="num" id="2934570">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934573">if</span>&nbsp;<span class="ident" id="2934576">h</span>&nbsp;<span class="op" id="2934578">==</span>&nbsp;<span class="ident" id="2934581">hashsep</span>&nbsp;<span class="op" id="2934589">&amp;&amp;</span>&nbsp;<span class="ident" id="2934592">s</span><span class="op" id="2934593">[</span><span class="op" id="2934594">:</span><span class="builtinfunc" id="2934595">len</span><span class="op" id="2934598">(</span><span class="ident" id="2934599">sep</span><span class="op" id="2934602">)</span><span class="op" id="2934603">]</span>&nbsp;<span class="op" id="2934605">==</span>&nbsp;<span class="ident" id="2934608">sep</span>&nbsp;<span class="op" id="2934612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934616">n</span><span class="op" id="2934617">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934622">lastmatch</span>&nbsp;<span class="op" id="2934632">=</span>&nbsp;<span class="builtinfunc" id="2934634">len</span><span class="op" id="2934637">(</span><span class="ident" id="2934638">sep</span><span class="op" id="2934641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934644">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934647">for</span>&nbsp;<span class="ident" id="2934651">i</span>&nbsp;<span class="op" id="2934653">:=</span>&nbsp;<span class="builtinfunc" id="2934656">len</span><span class="op" id="2934659">(</span><span class="ident" id="2934660">sep</span><span class="op" id="2934663">)</span><span class="op" id="2934664">;</span>&nbsp;<span class="ident" id="2934666">i</span>&nbsp;<span class="op" id="2934668">&lt;</span>&nbsp;<span class="builtinfunc" id="2934670">len</span><span class="op" id="2934673">(</span><span class="ident" id="2934674">s</span><span class="op" id="2934675">)</span><span class="op" id="2934676">;</span>&nbsp;<span class="op" id="2934678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934682">h</span>&nbsp;<span class="op" id="2934684">*=</span>&nbsp;<span class="ident" id="2934687">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934697">h</span>&nbsp;<span class="op" id="2934699">+=</span>&nbsp;<span class="builtintype" id="2934702">uint32</span><span class="op" id="2934708">(</span><span class="ident" id="2934709">s</span><span class="op" id="2934710">[</span><span class="ident" id="2934711">i</span><span class="op" id="2934712">]</span><span class="op" id="2934713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934717">h</span>&nbsp;<span class="op" id="2934719">-=</span>&nbsp;<span class="ident" id="2934722">pow</span>&nbsp;<span class="op" id="2934726">*</span>&nbsp;<span class="builtintype" id="2934728">uint32</span><span class="op" id="2934734">(</span><span class="ident" id="2934735">s</span><span class="op" id="2934736">[</span><span class="ident" id="2934737">i</span><span class="op" id="2934738">-</span><span class="builtinfunc" id="2934739">len</span><span class="op" id="2934742">(</span><span class="ident" id="2934743">sep</span><span class="op" id="2934746">)</span><span class="op" id="2934747">]</span><span class="op" id="2934748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934752">i</span><span class="op" id="2934753">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934758">if</span>&nbsp;<span class="ident" id="2934761">h</span>&nbsp;<span class="op" id="2934763">==</span>&nbsp;<span class="ident" id="2934766">hashsep</span>&nbsp;<span class="op" id="2934774">&amp;&amp;</span>&nbsp;<span class="ident" id="2934777">lastmatch</span>&nbsp;<span class="op" id="2934787">&lt;=</span>&nbsp;<span class="ident" id="2934790">i</span><span class="op" id="2934791">-</span><span class="builtinfunc" id="2934792">len</span><span class="op" id="2934795">(</span><span class="ident" id="2934796">sep</span><span class="op" id="2934799">)</span>&nbsp;<span class="op" id="2934801">&amp;&amp;</span>&nbsp;<span class="ident" id="2934804">s</span><span class="op" id="2934805">[</span><span class="ident" id="2934806">i</span><span class="op" id="2934807">-</span><span class="builtinfunc" id="2934808">len</span><span class="op" id="2934811">(</span><span class="ident" id="2934812">sep</span><span class="op" id="2934815">)</span><span class="op" id="2934816">:</span><span class="ident" id="2934817">i</span><span class="op" id="2934818">]</span>&nbsp;<span class="op" id="2934820">==</span>&nbsp;<span class="ident" id="2934823">sep</span>&nbsp;<span class="op" id="2934827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934832">n</span><span class="op" id="2934833">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934839">lastmatch</span>&nbsp;<span class="op" id="2934849">=</span>&nbsp;<span class="ident" id="2934851">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934858">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934861">return</span>&nbsp;<span class="ident" id="2934868">n</span><br>
<span class="lineno"></span><span class="op" id="2934870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2934873">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2934921">func</span>&nbsp;<span class="ident" id="2934926">Contains</span><span class="op" id="2934934">(</span><span class="ident" id="2934935">s</span><span class="op" id="2934936">,</span>&nbsp;<span class="ident" id="2934938">substr</span>&nbsp;<span class="builtintype" id="2934945">string</span><span class="op" id="2934951">)</span>&nbsp;<span class="builtintype" id="2934953">bool</span>&nbsp;<span class="op" id="2934958">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934961">return</span>&nbsp;<span class="ident" id="2934968">Index</span><span class="op" id="2934973">(</span><span class="ident" id="2934974">s</span><span class="op" id="2934975">,</span>&nbsp;<span class="ident" id="2934977">substr</span><span class="op" id="2934983">)</span>&nbsp;<span class="op" id="2934985">&gt;=</span>&nbsp;<span class="num" id="2934988">0</span><br>
<span class="lineno"></span><span class="op" id="2934990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2934993">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2935071">func</span>&nbsp;<span class="ident" id="2935076">ContainsAny</span><span class="op" id="2935087">(</span><span class="ident" id="2935088">s</span><span class="op" id="2935089">,</span>&nbsp;<span class="ident" id="2935091">chars</span>&nbsp;<span class="builtintype" id="2935097">string</span><span class="op" id="2935103">)</span>&nbsp;<span class="builtintype" id="2935105">bool</span>&nbsp;<span class="op" id="2935110">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935113">return</span>&nbsp;<span class="ident" id="2935120">IndexAny</span><span class="op" id="2935128">(</span><span class="ident" id="2935129">s</span><span class="op" id="2935130">,</span>&nbsp;<span class="ident" id="2935132">chars</span><span class="op" id="2935137">)</span>&nbsp;<span class="op" id="2935139">&gt;=</span>&nbsp;<span class="num" id="2935142">0</span><br>
<span class="lineno"></span><span class="op" id="2935144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2935147">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2935217">func</span>&nbsp;<span class="ident" id="2935222">ContainsRune</span><span class="op" id="2935234">(</span><span class="ident" id="2935235">s</span>&nbsp;<span class="builtintype" id="2935237">string</span><span class="op" id="2935243">,</span>&nbsp;<span class="ident" id="2935245">r</span>&nbsp;<span class="builtintype" id="2935247">rune</span><span class="op" id="2935251">)</span>&nbsp;<span class="builtintype" id="2935253">bool</span>&nbsp;<span class="op" id="2935258">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935261">return</span>&nbsp;<span class="ident" id="2935268">IndexRune</span><span class="op" id="2935277">(</span><span class="ident" id="2935278">s</span><span class="op" id="2935279">,</span>&nbsp;<span class="ident" id="2935281">r</span><span class="op" id="2935282">)</span>&nbsp;<span class="op" id="2935284">&gt;=</span>&nbsp;<span class="num" id="2935287">0</span><br>
<span class="lineno"></span><span class="op" id="2935289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2935292">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2935388">func</span>&nbsp;<span class="ident" id="2935393">Index</span><span class="op" id="2935398">(</span><span class="ident" id="2935399">s</span><span class="op" id="2935400">,</span>&nbsp;<span class="ident" id="2935402">sep</span>&nbsp;<span class="builtintype" id="2935406">string</span><span class="op" id="2935412">)</span>&nbsp;<span class="builtintype" id="2935414">int</span>&nbsp;<span class="op" id="2935418">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935421">n</span>&nbsp;<span class="op" id="2935423">:=</span>&nbsp;<span class="builtinfunc" id="2935426">len</span><span class="op" id="2935429">(</span><span class="ident" id="2935430">sep</span><span class="op" id="2935433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935436">switch</span>&nbsp;<span class="op" id="2935443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935446">case</span>&nbsp;<span class="ident" id="2935451">n</span>&nbsp;<span class="op" id="2935453">==</span>&nbsp;<span class="num" id="2935456">0</span><span class="op" id="2935457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935461">return</span>&nbsp;<span class="num" id="2935468">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935471">case</span>&nbsp;<span class="ident" id="2935476">n</span>&nbsp;<span class="op" id="2935478">==</span>&nbsp;<span class="num" id="2935481">1</span><span class="op" id="2935482">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935486">return</span>&nbsp;<span class="ident" id="2935493">IndexByte</span><span class="op" id="2935502">(</span><span class="ident" id="2935503">s</span><span class="op" id="2935504">,</span>&nbsp;<span class="ident" id="2935506">sep</span><span class="op" id="2935509">[</span><span class="num" id="2935510">0</span><span class="op" id="2935511">]</span><span class="op" id="2935512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935515">case</span>&nbsp;<span class="ident" id="2935520">n</span>&nbsp;<span class="op" id="2935522">==</span>&nbsp;<span class="builtinfunc" id="2935525">len</span><span class="op" id="2935528">(</span><span class="ident" id="2935529">s</span><span class="op" id="2935530">)</span><span class="op" id="2935531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935535">if</span>&nbsp;<span class="ident" id="2935538">sep</span>&nbsp;<span class="op" id="2935542">==</span>&nbsp;<span class="ident" id="2935545">s</span>&nbsp;<span class="op" id="2935547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935552">return</span>&nbsp;<span class="num" id="2935559">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935563">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935567">return</span>&nbsp;<span class="op" id="2935574">-</span><span class="num" id="2935575">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935578">case</span>&nbsp;<span class="ident" id="2935583">n</span>&nbsp;<span class="op" id="2935585">&gt;</span>&nbsp;<span class="builtinfunc" id="2935587">len</span><span class="op" id="2935590">(</span><span class="ident" id="2935591">s</span><span class="op" id="2935592">)</span><span class="op" id="2935593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935597">return</span>&nbsp;<span class="op" id="2935604">-</span><span class="num" id="2935605">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2935611">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935633">hashsep</span><span class="op" id="2935640">,</span>&nbsp;<span class="ident" id="2935642">pow</span>&nbsp;<span class="op" id="2935646">:=</span>&nbsp;<span class="ident" id="2935649">hashStr</span><span class="op" id="2935656">(</span><span class="ident" id="2935657">sep</span><span class="op" id="2935660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935663">var</span>&nbsp;<span class="ident" id="2935667">h</span>&nbsp;<span class="builtintype" id="2935669">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935677">for</span>&nbsp;<span class="ident" id="2935681">i</span>&nbsp;<span class="op" id="2935683">:=</span>&nbsp;<span class="num" id="2935686">0</span><span class="op" id="2935687">;</span>&nbsp;<span class="ident" id="2935689">i</span>&nbsp;<span class="op" id="2935691">&lt;</span>&nbsp;<span class="ident" id="2935693">n</span><span class="op" id="2935694">;</span>&nbsp;<span class="ident" id="2935696">i</span><span class="op" id="2935697">++</span>&nbsp;<span class="op" id="2935700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935704">h</span>&nbsp;<span class="op" id="2935706">=</span>&nbsp;<span class="ident" id="2935708">h</span><span class="op" id="2935709">*</span><span class="ident" id="2935710">primeRK</span>&nbsp;<span class="op" id="2935718">+</span>&nbsp;<span class="builtintype" id="2935720">uint32</span><span class="op" id="2935726">(</span><span class="ident" id="2935727">s</span><span class="op" id="2935728">[</span><span class="ident" id="2935729">i</span><span class="op" id="2935730">]</span><span class="op" id="2935731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935734">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935737">if</span>&nbsp;<span class="ident" id="2935740">h</span>&nbsp;<span class="op" id="2935742">==</span>&nbsp;<span class="ident" id="2935745">hashsep</span>&nbsp;<span class="op" id="2935753">&amp;&amp;</span>&nbsp;<span class="ident" id="2935756">s</span><span class="op" id="2935757">[</span><span class="op" id="2935758">:</span><span class="ident" id="2935759">n</span><span class="op" id="2935760">]</span>&nbsp;<span class="op" id="2935762">==</span>&nbsp;<span class="ident" id="2935765">sep</span>&nbsp;<span class="op" id="2935769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935773">return</span>&nbsp;<span class="num" id="2935780">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935786">for</span>&nbsp;<span class="ident" id="2935790">i</span>&nbsp;<span class="op" id="2935792">:=</span>&nbsp;<span class="ident" id="2935795">n</span><span class="op" id="2935796">;</span>&nbsp;<span class="ident" id="2935798">i</span>&nbsp;<span class="op" id="2935800">&lt;</span>&nbsp;<span class="builtinfunc" id="2935802">len</span><span class="op" id="2935805">(</span><span class="ident" id="2935806">s</span><span class="op" id="2935807">)</span><span class="op" id="2935808">;</span>&nbsp;<span class="op" id="2935810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935814">h</span>&nbsp;<span class="op" id="2935816">*=</span>&nbsp;<span class="ident" id="2935819">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935829">h</span>&nbsp;<span class="op" id="2935831">+=</span>&nbsp;<span class="builtintype" id="2935834">uint32</span><span class="op" id="2935840">(</span><span class="ident" id="2935841">s</span><span class="op" id="2935842">[</span><span class="ident" id="2935843">i</span><span class="op" id="2935844">]</span><span class="op" id="2935845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935849">h</span>&nbsp;<span class="op" id="2935851">-=</span>&nbsp;<span class="ident" id="2935854">pow</span>&nbsp;<span class="op" id="2935858">*</span>&nbsp;<span class="builtintype" id="2935860">uint32</span><span class="op" id="2935866">(</span><span class="ident" id="2935867">s</span><span class="op" id="2935868">[</span><span class="ident" id="2935869">i</span><span class="op" id="2935870">-</span><span class="ident" id="2935871">n</span><span class="op" id="2935872">]</span><span class="op" id="2935873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935877">i</span><span class="op" id="2935878">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935883">if</span>&nbsp;<span class="ident" id="2935886">h</span>&nbsp;<span class="op" id="2935888">==</span>&nbsp;<span class="ident" id="2935891">hashsep</span>&nbsp;<span class="op" id="2935899">&amp;&amp;</span>&nbsp;<span class="ident" id="2935902">s</span><span class="op" id="2935903">[</span><span class="ident" id="2935904">i</span><span class="op" id="2935905">-</span><span class="ident" id="2935906">n</span><span class="op" id="2935907">:</span><span class="ident" id="2935908">i</span><span class="op" id="2935909">]</span>&nbsp;<span class="op" id="2935911">==</span>&nbsp;<span class="ident" id="2935914">sep</span>&nbsp;<span class="op" id="2935918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935923">return</span>&nbsp;<span class="ident" id="2935930">i</span>&nbsp;<span class="op" id="2935932">-</span>&nbsp;<span class="ident" id="2935934">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935944">return</span>&nbsp;<span class="op" id="2935951">-</span><span class="num" id="2935952">1</span><br>
<span class="lineno"></span><span class="op" id="2935954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2935957">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2936056">func</span>&nbsp;<span class="ident" id="2936061">LastIndex</span><span class="op" id="2936070">(</span><span class="ident" id="2936071">s</span><span class="op" id="2936072">,</span>&nbsp;<span class="ident" id="2936074">sep</span>&nbsp;<span class="builtintype" id="2936078">string</span><span class="op" id="2936084">)</span>&nbsp;<span class="builtintype" id="2936086">int</span>&nbsp;<span class="op" id="2936090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936093">n</span>&nbsp;<span class="op" id="2936095">:=</span>&nbsp;<span class="builtinfunc" id="2936098">len</span><span class="op" id="2936101">(</span><span class="ident" id="2936102">sep</span><span class="op" id="2936105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936108">switch</span>&nbsp;<span class="op" id="2936115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936118">case</span>&nbsp;<span class="ident" id="2936123">n</span>&nbsp;<span class="op" id="2936125">==</span>&nbsp;<span class="num" id="2936128">0</span><span class="op" id="2936129">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936133">return</span>&nbsp;<span class="builtinfunc" id="2936140">len</span><span class="op" id="2936143">(</span><span class="ident" id="2936144">s</span><span class="op" id="2936145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936148">case</span>&nbsp;<span class="ident" id="2936153">n</span>&nbsp;<span class="op" id="2936155">==</span>&nbsp;<span class="num" id="2936158">1</span><span class="op" id="2936159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2936163">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936199">c</span>&nbsp;<span class="op" id="2936201">:=</span>&nbsp;<span class="ident" id="2936204">sep</span><span class="op" id="2936207">[</span><span class="num" id="2936208">0</span><span class="op" id="2936209">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936213">for</span>&nbsp;<span class="ident" id="2936217">i</span>&nbsp;<span class="op" id="2936219">:=</span>&nbsp;<span class="builtinfunc" id="2936222">len</span><span class="op" id="2936225">(</span><span class="ident" id="2936226">s</span><span class="op" id="2936227">)</span>&nbsp;<span class="op" id="2936229">-</span>&nbsp;<span class="num" id="2936231">1</span><span class="op" id="2936232">;</span>&nbsp;<span class="ident" id="2936234">i</span>&nbsp;<span class="op" id="2936236">&gt;=</span>&nbsp;<span class="num" id="2936239">0</span><span class="op" id="2936240">;</span>&nbsp;<span class="ident" id="2936242">i</span><span class="op" id="2936243">--</span>&nbsp;<span class="op" id="2936246">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936251">if</span>&nbsp;<span class="ident" id="2936254">s</span><span class="op" id="2936255">[</span><span class="ident" id="2936256">i</span><span class="op" id="2936257">]</span>&nbsp;<span class="op" id="2936259">==</span>&nbsp;<span class="ident" id="2936262">c</span>&nbsp;<span class="op" id="2936264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936270">return</span>&nbsp;<span class="ident" id="2936277">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936290">return</span>&nbsp;<span class="op" id="2936297">-</span><span class="num" id="2936298">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936301">case</span>&nbsp;<span class="ident" id="2936306">n</span>&nbsp;<span class="op" id="2936308">==</span>&nbsp;<span class="builtinfunc" id="2936311">len</span><span class="op" id="2936314">(</span><span class="ident" id="2936315">s</span><span class="op" id="2936316">)</span><span class="op" id="2936317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936321">if</span>&nbsp;<span class="ident" id="2936324">sep</span>&nbsp;<span class="op" id="2936328">==</span>&nbsp;<span class="ident" id="2936331">s</span>&nbsp;<span class="op" id="2936333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936338">return</span>&nbsp;<span class="num" id="2936345">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936353">return</span>&nbsp;<span class="op" id="2936360">-</span><span class="num" id="2936361">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936364">case</span>&nbsp;<span class="ident" id="2936369">n</span>&nbsp;<span class="op" id="2936371">&gt;</span>&nbsp;<span class="builtinfunc" id="2936373">len</span><span class="op" id="2936376">(</span><span class="ident" id="2936377">s</span><span class="op" id="2936378">)</span><span class="op" id="2936379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936383">return</span>&nbsp;<span class="op" id="2936390">-</span><span class="num" id="2936391">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2936397">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936446">hashsep</span><span class="op" id="2936453">,</span>&nbsp;<span class="ident" id="2936455">pow</span>&nbsp;<span class="op" id="2936459">:=</span>&nbsp;<span class="ident" id="2936462">hashStrRev</span><span class="op" id="2936472">(</span><span class="ident" id="2936473">sep</span><span class="op" id="2936476">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936479">last</span>&nbsp;<span class="op" id="2936484">:=</span>&nbsp;<span class="builtinfunc" id="2936487">len</span><span class="op" id="2936490">(</span><span class="ident" id="2936491">s</span><span class="op" id="2936492">)</span>&nbsp;<span class="op" id="2936494">-</span>&nbsp;<span class="ident" id="2936496">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936499">var</span>&nbsp;<span class="ident" id="2936503">h</span>&nbsp;<span class="builtintype" id="2936505">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936513">for</span>&nbsp;<span class="ident" id="2936517">i</span>&nbsp;<span class="op" id="2936519">:=</span>&nbsp;<span class="builtinfunc" id="2936522">len</span><span class="op" id="2936525">(</span><span class="ident" id="2936526">s</span><span class="op" id="2936527">)</span>&nbsp;<span class="op" id="2936529">-</span>&nbsp;<span class="num" id="2936531">1</span><span class="op" id="2936532">;</span>&nbsp;<span class="ident" id="2936534">i</span>&nbsp;<span class="op" id="2936536">&gt;=</span>&nbsp;<span class="ident" id="2936539">last</span><span class="op" id="2936543">;</span>&nbsp;<span class="ident" id="2936545">i</span><span class="op" id="2936546">--</span>&nbsp;<span class="op" id="2936549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936553">h</span>&nbsp;<span class="op" id="2936555">=</span>&nbsp;<span class="ident" id="2936557">h</span><span class="op" id="2936558">*</span><span class="ident" id="2936559">primeRK</span>&nbsp;<span class="op" id="2936567">+</span>&nbsp;<span class="builtintype" id="2936569">uint32</span><span class="op" id="2936575">(</span><span class="ident" id="2936576">s</span><span class="op" id="2936577">[</span><span class="ident" id="2936578">i</span><span class="op" id="2936579">]</span><span class="op" id="2936580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936583">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936586">if</span>&nbsp;<span class="ident" id="2936589">h</span>&nbsp;<span class="op" id="2936591">==</span>&nbsp;<span class="ident" id="2936594">hashsep</span>&nbsp;<span class="op" id="2936602">&amp;&amp;</span>&nbsp;<span class="ident" id="2936605">s</span><span class="op" id="2936606">[</span><span class="ident" id="2936607">last</span><span class="op" id="2936611">:</span><span class="op" id="2936612">]</span>&nbsp;<span class="op" id="2936614">==</span>&nbsp;<span class="ident" id="2936617">sep</span>&nbsp;<span class="op" id="2936621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936625">return</span>&nbsp;<span class="ident" id="2936632">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936641">for</span>&nbsp;<span class="ident" id="2936645">i</span>&nbsp;<span class="op" id="2936647">:=</span>&nbsp;<span class="ident" id="2936650">last</span>&nbsp;<span class="op" id="2936655">-</span>&nbsp;<span class="num" id="2936657">1</span><span class="op" id="2936658">;</span>&nbsp;<span class="ident" id="2936660">i</span>&nbsp;<span class="op" id="2936662">&gt;=</span>&nbsp;<span class="num" id="2936665">0</span><span class="op" id="2936666">;</span>&nbsp;<span class="ident" id="2936668">i</span><span class="op" id="2936669">--</span>&nbsp;<span class="op" id="2936672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936676">h</span>&nbsp;<span class="op" id="2936678">*=</span>&nbsp;<span class="ident" id="2936681">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936691">h</span>&nbsp;<span class="op" id="2936693">+=</span>&nbsp;<span class="builtintype" id="2936696">uint32</span><span class="op" id="2936702">(</span><span class="ident" id="2936703">s</span><span class="op" id="2936704">[</span><span class="ident" id="2936705">i</span><span class="op" id="2936706">]</span><span class="op" id="2936707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936711">h</span>&nbsp;<span class="op" id="2936713">-=</span>&nbsp;<span class="ident" id="2936716">pow</span>&nbsp;<span class="op" id="2936720">*</span>&nbsp;<span class="builtintype" id="2936722">uint32</span><span class="op" id="2936728">(</span><span class="ident" id="2936729">s</span><span class="op" id="2936730">[</span><span class="ident" id="2936731">i</span><span class="op" id="2936732">+</span><span class="ident" id="2936733">n</span><span class="op" id="2936734">]</span><span class="op" id="2936735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936739">if</span>&nbsp;<span class="ident" id="2936742">h</span>&nbsp;<span class="op" id="2936744">==</span>&nbsp;<span class="ident" id="2936747">hashsep</span>&nbsp;<span class="op" id="2936755">&amp;&amp;</span>&nbsp;<span class="ident" id="2936758">s</span><span class="op" id="2936759">[</span><span class="ident" id="2936760">i</span><span class="op" id="2936761">:</span><span class="ident" id="2936762">i</span><span class="op" id="2936763">+</span><span class="ident" id="2936764">n</span><span class="op" id="2936765">]</span>&nbsp;<span class="op" id="2936767">==</span>&nbsp;<span class="ident" id="2936770">sep</span>&nbsp;<span class="op" id="2936774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936779">return</span>&nbsp;<span class="ident" id="2936786">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936790">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936796">return</span>&nbsp;<span class="op" id="2936803">-</span><span class="num" id="2936804">1</span><br>
<span class="lineno"></span><span class="op" id="2936806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2936809">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2936888">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2936929">func</span>&nbsp;<span class="ident" id="2936934">IndexRune</span><span class="op" id="2936943">(</span><span class="ident" id="2936944">s</span>&nbsp;<span class="builtintype" id="2936946">string</span><span class="op" id="2936952">,</span>&nbsp;<span class="ident" id="2936954">r</span>&nbsp;<span class="builtintype" id="2936956">rune</span><span class="op" id="2936960">)</span>&nbsp;<span class="builtintype" id="2936962">int</span>&nbsp;<span class="op" id="2936966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936969">switch</span>&nbsp;<span class="op" id="2936976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936979">case</span>&nbsp;<span class="ident" id="2936984">r</span>&nbsp;<span class="op" id="2936986">&lt;</span>&nbsp;<span class="ident" id="2936988">utf8</span><span class="op" id="2936992">.</span><span class="ident" id="2936993">RuneSelf</span><span class="op" id="2937001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937005">return</span>&nbsp;<span class="ident" id="2937012">IndexByte</span><span class="op" id="2937021">(</span><span class="ident" id="2937022">s</span><span class="op" id="2937023">,</span>&nbsp;<span class="builtintype" id="2937025">byte</span><span class="op" id="2937029">(</span><span class="ident" id="2937030">r</span><span class="op" id="2937031">)</span><span class="op" id="2937032">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937035">default</span><span class="op" id="2937042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937046">for</span>&nbsp;<span class="ident" id="2937050">i</span><span class="op" id="2937051">,</span>&nbsp;<span class="ident" id="2937053">c</span>&nbsp;<span class="op" id="2937055">:=</span>&nbsp;<span class="keyword" id="2937058">range</span>&nbsp;<span class="ident" id="2937064">s</span>&nbsp;<span class="op" id="2937066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937071">if</span>&nbsp;<span class="ident" id="2937074">c</span>&nbsp;<span class="op" id="2937076">==</span>&nbsp;<span class="ident" id="2937079">r</span>&nbsp;<span class="op" id="2937081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937087">return</span>&nbsp;<span class="ident" id="2937094">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937099">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937109">return</span>&nbsp;<span class="op" id="2937116">-</span><span class="num" id="2937117">1</span><br>
<span class="lineno"></span><span class="op" id="2937119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2937122">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2937200">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2937279">func</span>&nbsp;<span class="ident" id="2937284">IndexAny</span><span class="op" id="2937292">(</span><span class="ident" id="2937293">s</span><span class="op" id="2937294">,</span>&nbsp;<span class="ident" id="2937296">chars</span>&nbsp;<span class="builtintype" id="2937302">string</span><span class="op" id="2937308">)</span>&nbsp;<span class="builtintype" id="2937310">int</span>&nbsp;<span class="op" id="2937314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937317">if</span>&nbsp;<span class="builtinfunc" id="2937320">len</span><span class="op" id="2937323">(</span><span class="ident" id="2937324">chars</span><span class="op" id="2937329">)</span>&nbsp;<span class="op" id="2937331">&gt;</span>&nbsp;<span class="num" id="2937333">0</span>&nbsp;<span class="op" id="2937335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937339">for</span>&nbsp;<span class="ident" id="2937343">i</span><span class="op" id="2937344">,</span>&nbsp;<span class="ident" id="2937346">c</span>&nbsp;<span class="op" id="2937348">:=</span>&nbsp;<span class="keyword" id="2937351">range</span>&nbsp;<span class="ident" id="2937357">s</span>&nbsp;<span class="op" id="2937359">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937364">for</span>&nbsp;<span class="ident" id="2937368">_</span><span class="op" id="2937369">,</span>&nbsp;<span class="ident" id="2937371">m</span>&nbsp;<span class="op" id="2937373">:=</span>&nbsp;<span class="keyword" id="2937376">range</span>&nbsp;<span class="ident" id="2937382">chars</span>&nbsp;<span class="op" id="2937388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937394">if</span>&nbsp;<span class="ident" id="2937397">c</span>&nbsp;<span class="op" id="2937399">==</span>&nbsp;<span class="ident" id="2937402">m</span>&nbsp;<span class="op" id="2937404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937411">return</span>&nbsp;<span class="ident" id="2937418">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937429">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937439">return</span>&nbsp;<span class="op" id="2937446">-</span><span class="num" id="2937447">1</span><br>
<span class="lineno"></span><span class="op" id="2937449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2937452">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2937527">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2937598">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2937615">func</span>&nbsp;<span class="ident" id="2937620">LastIndexAny</span><span class="op" id="2937632">(</span><span class="ident" id="2937633">s</span><span class="op" id="2937634">,</span>&nbsp;<span class="ident" id="2937636">chars</span>&nbsp;<span class="builtintype" id="2937642">string</span><span class="op" id="2937648">)</span>&nbsp;<span class="builtintype" id="2937650">int</span>&nbsp;<span class="op" id="2937654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937657">if</span>&nbsp;<span class="builtinfunc" id="2937660">len</span><span class="op" id="2937663">(</span><span class="ident" id="2937664">chars</span><span class="op" id="2937669">)</span>&nbsp;<span class="op" id="2937671">&gt;</span>&nbsp;<span class="num" id="2937673">0</span>&nbsp;<span class="op" id="2937675">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937679">for</span>&nbsp;<span class="ident" id="2937683">i</span>&nbsp;<span class="op" id="2937685">:=</span>&nbsp;<span class="builtinfunc" id="2937688">len</span><span class="op" id="2937691">(</span><span class="ident" id="2937692">s</span><span class="op" id="2937693">)</span><span class="op" id="2937694">;</span>&nbsp;<span class="ident" id="2937696">i</span>&nbsp;<span class="op" id="2937698">&gt;</span>&nbsp;<span class="num" id="2937700">0</span><span class="op" id="2937701">;</span>&nbsp;<span class="op" id="2937703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2937708">rune</span><span class="op" id="2937712">,</span>&nbsp;<span class="ident" id="2937714">size</span>&nbsp;<span class="op" id="2937719">:=</span>&nbsp;<span class="ident" id="2937722">utf8</span><span class="op" id="2937726">.</span><span class="ident" id="2937727">DecodeLastRuneInString</span><span class="op" id="2937749">(</span><span class="ident" id="2937750">s</span><span class="op" id="2937751">[</span><span class="num" id="2937752">0</span><span class="op" id="2937753">:</span><span class="ident" id="2937754">i</span><span class="op" id="2937755">]</span><span class="op" id="2937756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937761">i</span>&nbsp;<span class="op" id="2937763">-=</span>&nbsp;<span class="ident" id="2937766">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937774">for</span>&nbsp;<span class="ident" id="2937778">_</span><span class="op" id="2937779">,</span>&nbsp;<span class="ident" id="2937781">m</span>&nbsp;<span class="op" id="2937783">:=</span>&nbsp;<span class="keyword" id="2937786">range</span>&nbsp;<span class="ident" id="2937792">chars</span>&nbsp;<span class="op" id="2937798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937804">if</span>&nbsp;<span class="builtintype" id="2937807">rune</span>&nbsp;<span class="op" id="2937812">==</span>&nbsp;<span class="ident" id="2937815">m</span>&nbsp;<span class="op" id="2937817">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937824">return</span>&nbsp;<span class="ident" id="2937831">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937849">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937852">return</span>&nbsp;<span class="op" id="2937859">-</span><span class="num" id="2937860">1</span><br>
<span class="lineno"></span><span class="op" id="2937862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2937865">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2937918">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2937970">func</span>&nbsp;<span class="ident" id="2937975">genSplit</span><span class="op" id="2937983">(</span><span class="ident" id="2937984">s</span><span class="op" id="2937985">,</span>&nbsp;<span class="ident" id="2937987">sep</span>&nbsp;<span class="builtintype" id="2937991">string</span><span class="op" id="2937997">,</span>&nbsp;<span class="ident" id="2937999">sepSave</span><span class="op" id="2938006">,</span>&nbsp;<span class="ident" id="2938008">n</span>&nbsp;<span class="builtintype" id="2938010">int</span><span class="op" id="2938013">)</span>&nbsp;<span class="op" id="2938015">[</span><span class="op" id="2938016">]</span><span class="builtintype" id="2938017">string</span>&nbsp;<span class="op" id="2938024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938027">if</span>&nbsp;<span class="ident" id="2938030">n</span>&nbsp;<span class="op" id="2938032">==</span>&nbsp;<span class="num" id="2938035">0</span>&nbsp;<span class="op" id="2938037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938041">return</span>&nbsp;<span class="ident" id="2938048">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938056">if</span>&nbsp;<span class="ident" id="2938059">sep</span>&nbsp;<span class="op" id="2938063">==</span>&nbsp;<span class="string" id="2938066">&#34;&#34;</span>&nbsp;<span class="op" id="2938069">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938073">return</span>&nbsp;<span class="ident" id="2938080">explode</span><span class="op" id="2938087">(</span><span class="ident" id="2938088">s</span><span class="op" id="2938089">,</span>&nbsp;<span class="ident" id="2938091">n</span><span class="op" id="2938092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938098">if</span>&nbsp;<span class="ident" id="2938101">n</span>&nbsp;<span class="op" id="2938103">&lt;</span>&nbsp;<span class="num" id="2938105">0</span>&nbsp;<span class="op" id="2938107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938111">n</span>&nbsp;<span class="op" id="2938113">=</span>&nbsp;<span class="ident" id="2938115">Count</span><span class="op" id="2938120">(</span><span class="ident" id="2938121">s</span><span class="op" id="2938122">,</span>&nbsp;<span class="ident" id="2938124">sep</span><span class="op" id="2938127">)</span>&nbsp;<span class="op" id="2938129">+</span>&nbsp;<span class="num" id="2938131">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938134">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938137">c</span>&nbsp;<span class="op" id="2938139">:=</span>&nbsp;<span class="ident" id="2938142">sep</span><span class="op" id="2938145">[</span><span class="num" id="2938146">0</span><span class="op" id="2938147">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938150">start</span>&nbsp;<span class="op" id="2938156">:=</span>&nbsp;<span class="num" id="2938159">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938162">a</span>&nbsp;<span class="op" id="2938164">:=</span>&nbsp;<span class="builtinfunc" id="2938167">make</span><span class="op" id="2938171">(</span><span class="op" id="2938172">[</span><span class="op" id="2938173">]</span><span class="builtintype" id="2938174">string</span><span class="op" id="2938180">,</span>&nbsp;<span class="ident" id="2938182">n</span><span class="op" id="2938183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938186">na</span>&nbsp;<span class="op" id="2938189">:=</span>&nbsp;<span class="num" id="2938192">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938195">for</span>&nbsp;<span class="ident" id="2938199">i</span>&nbsp;<span class="op" id="2938201">:=</span>&nbsp;<span class="num" id="2938204">0</span><span class="op" id="2938205">;</span>&nbsp;<span class="ident" id="2938207">i</span><span class="op" id="2938208">+</span><span class="builtinfunc" id="2938209">len</span><span class="op" id="2938212">(</span><span class="ident" id="2938213">sep</span><span class="op" id="2938216">)</span>&nbsp;<span class="op" id="2938218">&lt;=</span>&nbsp;<span class="builtinfunc" id="2938221">len</span><span class="op" id="2938224">(</span><span class="ident" id="2938225">s</span><span class="op" id="2938226">)</span>&nbsp;<span class="op" id="2938228">&amp;&amp;</span>&nbsp;<span class="ident" id="2938231">na</span><span class="op" id="2938233">+</span><span class="num" id="2938234">1</span>&nbsp;<span class="op" id="2938236">&lt;</span>&nbsp;<span class="ident" id="2938238">n</span><span class="op" id="2938239">;</span>&nbsp;<span class="ident" id="2938241">i</span><span class="op" id="2938242">++</span>&nbsp;<span class="op" id="2938245">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938249">if</span>&nbsp;<span class="ident" id="2938252">s</span><span class="op" id="2938253">[</span><span class="ident" id="2938254">i</span><span class="op" id="2938255">]</span>&nbsp;<span class="op" id="2938257">==</span>&nbsp;<span class="ident" id="2938260">c</span>&nbsp;<span class="op" id="2938262">&amp;&amp;</span>&nbsp;<span class="op" id="2938265">(</span><span class="builtinfunc" id="2938266">len</span><span class="op" id="2938269">(</span><span class="ident" id="2938270">sep</span><span class="op" id="2938273">)</span>&nbsp;<span class="op" id="2938275">==</span>&nbsp;<span class="num" id="2938278">1</span>&nbsp;<span class="op" id="2938280">||</span>&nbsp;<span class="ident" id="2938283">s</span><span class="op" id="2938284">[</span><span class="ident" id="2938285">i</span><span class="op" id="2938286">:</span><span class="ident" id="2938287">i</span><span class="op" id="2938288">+</span><span class="builtinfunc" id="2938289">len</span><span class="op" id="2938292">(</span><span class="ident" id="2938293">sep</span><span class="op" id="2938296">)</span><span class="op" id="2938297">]</span>&nbsp;<span class="op" id="2938299">==</span>&nbsp;<span class="ident" id="2938302">sep</span><span class="op" id="2938305">)</span>&nbsp;<span class="op" id="2938307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938312">a</span><span class="op" id="2938313">[</span><span class="ident" id="2938314">na</span><span class="op" id="2938316">]</span>&nbsp;<span class="op" id="2938318">=</span>&nbsp;<span class="ident" id="2938320">s</span><span class="op" id="2938321">[</span><span class="ident" id="2938322">start</span>&nbsp;<span class="op" id="2938328">:</span>&nbsp;<span class="ident" id="2938330">i</span><span class="op" id="2938331">+</span><span class="ident" id="2938332">sepSave</span><span class="op" id="2938339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938344">na</span><span class="op" id="2938346">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938352">start</span>&nbsp;<span class="op" id="2938358">=</span>&nbsp;<span class="ident" id="2938360">i</span>&nbsp;<span class="op" id="2938362">+</span>&nbsp;<span class="builtinfunc" id="2938364">len</span><span class="op" id="2938367">(</span><span class="ident" id="2938368">sep</span><span class="op" id="2938371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938376">i</span>&nbsp;<span class="op" id="2938378">+=</span>&nbsp;<span class="builtinfunc" id="2938381">len</span><span class="op" id="2938384">(</span><span class="ident" id="2938385">sep</span><span class="op" id="2938388">)</span>&nbsp;<span class="op" id="2938390">-</span>&nbsp;<span class="num" id="2938392">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938402">a</span><span class="op" id="2938403">[</span><span class="ident" id="2938404">na</span><span class="op" id="2938406">]</span>&nbsp;<span class="op" id="2938408">=</span>&nbsp;<span class="ident" id="2938410">s</span><span class="op" id="2938411">[</span><span class="ident" id="2938412">start</span><span class="op" id="2938417">:</span><span class="op" id="2938418">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938421">return</span>&nbsp;<span class="ident" id="2938428">a</span><span class="op" id="2938429">[</span><span class="num" id="2938430">0</span>&nbsp;<span class="op" id="2938432">:</span>&nbsp;<span class="ident" id="2938434">na</span><span class="op" id="2938436">+</span><span class="num" id="2938437">1</span><span class="op" id="2938438">]</span><br>
<span class="lineno"></span><span class="op" id="2938440">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2938443">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2938518">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2938562">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2938623">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2938683">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2938767">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2938816">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2938843">func</span>&nbsp;<span class="ident" id="2938848">SplitN</span><span class="op" id="2938854">(</span><span class="ident" id="2938855">s</span><span class="op" id="2938856">,</span>&nbsp;<span class="ident" id="2938858">sep</span>&nbsp;<span class="builtintype" id="2938862">string</span><span class="op" id="2938868">,</span>&nbsp;<span class="ident" id="2938870">n</span>&nbsp;<span class="builtintype" id="2938872">int</span><span class="op" id="2938875">)</span>&nbsp;<span class="op" id="2938877">[</span><span class="op" id="2938878">]</span><span class="builtintype" id="2938879">string</span>&nbsp;<span class="op" id="2938886">{</span>&nbsp;<span class="keyword" id="2938888">return</span>&nbsp;<span class="ident" id="2938895">genSplit</span><span class="op" id="2938903">(</span><span class="ident" id="2938904">s</span><span class="op" id="2938905">,</span>&nbsp;<span class="ident" id="2938907">sep</span><span class="op" id="2938910">,</span>&nbsp;<span class="num" id="2938912">0</span><span class="op" id="2938913">,</span>&nbsp;<span class="ident" id="2938915">n</span><span class="op" id="2938916">)</span>&nbsp;<span class="op" id="2938918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2938921">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2938992">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2939032">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2939098">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2939158">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2939242">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2939291">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2939318">func</span>&nbsp;<span class="ident" id="2939323">SplitAfterN</span><span class="op" id="2939334">(</span><span class="ident" id="2939335">s</span><span class="op" id="2939336">,</span>&nbsp;<span class="ident" id="2939338">sep</span>&nbsp;<span class="builtintype" id="2939342">string</span><span class="op" id="2939348">,</span>&nbsp;<span class="ident" id="2939350">n</span>&nbsp;<span class="builtintype" id="2939352">int</span><span class="op" id="2939355">)</span>&nbsp;<span class="op" id="2939357">[</span><span class="op" id="2939358">]</span><span class="builtintype" id="2939359">string</span>&nbsp;<span class="op" id="2939366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939369">return</span>&nbsp;<span class="ident" id="2939376">genSplit</span><span class="op" id="2939384">(</span><span class="ident" id="2939385">s</span><span class="op" id="2939386">,</span>&nbsp;<span class="ident" id="2939388">sep</span><span class="op" id="2939391">,</span>&nbsp;<span class="builtinfunc" id="2939393">len</span><span class="op" id="2939396">(</span><span class="ident" id="2939397">sep</span><span class="op" id="2939400">)</span><span class="op" id="2939401">,</span>&nbsp;<span class="ident" id="2939403">n</span><span class="op" id="2939404">)</span><br>
<span class="lineno"></span><span class="op" id="2939406">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2939409">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2939487">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2939531">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2939591">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2939641">func</span>&nbsp;<span class="ident" id="2939646">Split</span><span class="op" id="2939651">(</span><span class="ident" id="2939652">s</span><span class="op" id="2939653">,</span>&nbsp;<span class="ident" id="2939655">sep</span>&nbsp;<span class="builtintype" id="2939659">string</span><span class="op" id="2939665">)</span>&nbsp;<span class="op" id="2939667">[</span><span class="op" id="2939668">]</span><span class="builtintype" id="2939669">string</span>&nbsp;<span class="op" id="2939676">{</span>&nbsp;<span class="keyword" id="2939678">return</span>&nbsp;<span class="ident" id="2939685">genSplit</span><span class="op" id="2939693">(</span><span class="ident" id="2939694">s</span><span class="op" id="2939695">,</span>&nbsp;<span class="ident" id="2939697">sep</span><span class="op" id="2939700">,</span>&nbsp;<span class="num" id="2939702">0</span><span class="op" id="2939703">,</span>&nbsp;<span class="op" id="2939705">-</span><span class="num" id="2939706">1</span><span class="op" id="2939707">)</span>&nbsp;<span class="op" id="2939709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2939712">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2939786">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2939826">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2939891">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2939946">func</span>&nbsp;<span class="ident" id="2939951">SplitAfter</span><span class="op" id="2939961">(</span><span class="ident" id="2939962">s</span><span class="op" id="2939963">,</span>&nbsp;<span class="ident" id="2939965">sep</span>&nbsp;<span class="builtintype" id="2939969">string</span><span class="op" id="2939975">)</span>&nbsp;<span class="op" id="2939977">[</span><span class="op" id="2939978">]</span><span class="builtintype" id="2939979">string</span>&nbsp;<span class="op" id="2939986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939989">return</span>&nbsp;<span class="ident" id="2939996">genSplit</span><span class="op" id="2940004">(</span><span class="ident" id="2940005">s</span><span class="op" id="2940006">,</span>&nbsp;<span class="ident" id="2940008">sep</span><span class="op" id="2940011">,</span>&nbsp;<span class="builtinfunc" id="2940013">len</span><span class="op" id="2940016">(</span><span class="ident" id="2940017">sep</span><span class="op" id="2940020">)</span><span class="op" id="2940021">,</span>&nbsp;<span class="op" id="2940023">-</span><span class="num" id="2940024">1</span><span class="op" id="2940025">)</span><br>
<span class="lineno"></span><span class="op" id="2940027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2940030">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2940120">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2940210">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2940256">func</span>&nbsp;<span class="ident" id="2940261">Fields</span><span class="op" id="2940267">(</span><span class="ident" id="2940268">s</span>&nbsp;<span class="builtintype" id="2940270">string</span><span class="op" id="2940276">)</span>&nbsp;<span class="op" id="2940278">[</span><span class="op" id="2940279">]</span><span class="builtintype" id="2940280">string</span>&nbsp;<span class="op" id="2940287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940290">return</span>&nbsp;<span class="ident" id="2940297">FieldsFunc</span><span class="op" id="2940307">(</span><span class="ident" id="2940308">s</span><span class="op" id="2940309">,</span>&nbsp;<span class="ident" id="2940311">unicode</span><span class="op" id="2940318">.</span><span class="ident" id="2940319">IsSpace</span><span class="op" id="2940326">)</span><br>
<span class="lineno">340</span><span class="op" id="2940328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2940331">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2940418">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2940502">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2940550">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2940624">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2940704">func</span>&nbsp;<span class="ident" id="2940709">FieldsFunc</span><span class="op" id="2940719">(</span><span class="ident" id="2940720">s</span>&nbsp;<span class="builtintype" id="2940722">string</span><span class="op" id="2940728">,</span>&nbsp;<span class="ident" id="2940730">f</span>&nbsp;<span class="keyword" id="2940732">func</span><span class="op" id="2940736">(</span><span class="builtintype" id="2940737">rune</span><span class="op" id="2940741">)</span>&nbsp;<span class="builtintype" id="2940743">bool</span><span class="op" id="2940747">)</span>&nbsp;<span class="op" id="2940749">[</span><span class="op" id="2940750">]</span><span class="builtintype" id="2940751">string</span>&nbsp;<span class="op" id="2940758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2940761">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940789">n</span>&nbsp;<span class="op" id="2940791">:=</span>&nbsp;<span class="num" id="2940794">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940797">inField</span>&nbsp;<span class="op" id="2940805">:=</span>&nbsp;<span class="builtintype" id="2940808">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940815">for</span>&nbsp;<span class="ident" id="2940819">_</span><span class="op" id="2940820">,</span>&nbsp;<span class="builtintype" id="2940822">rune</span>&nbsp;<span class="op" id="2940827">:=</span>&nbsp;<span class="keyword" id="2940830">range</span>&nbsp;<span class="ident" id="2940836">s</span>&nbsp;<span class="op" id="2940838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940842">wasInField</span>&nbsp;<span class="op" id="2940853">:=</span>&nbsp;<span class="ident" id="2940856">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940866">inField</span>&nbsp;<span class="op" id="2940874">=</span>&nbsp;<span class="op" id="2940876">!</span><span class="ident" id="2940877">f</span><span class="op" id="2940878">(</span><span class="builtintype" id="2940879">rune</span><span class="op" id="2940883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940887">if</span>&nbsp;<span class="ident" id="2940890">inField</span>&nbsp;<span class="op" id="2940898">&amp;&amp;</span>&nbsp;<span class="op" id="2940901">!</span><span class="ident" id="2940902">wasInField</span>&nbsp;<span class="op" id="2940913">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940918">n</span><span class="op" id="2940919">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2940931">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940952">a</span>&nbsp;<span class="op" id="2940954">:=</span>&nbsp;<span class="builtinfunc" id="2940957">make</span><span class="op" id="2940961">(</span><span class="op" id="2940962">[</span><span class="op" id="2940963">]</span><span class="builtintype" id="2940964">string</span><span class="op" id="2940970">,</span>&nbsp;<span class="ident" id="2940972">n</span><span class="op" id="2940973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940976">na</span>&nbsp;<span class="op" id="2940979">:=</span>&nbsp;<span class="num" id="2940982">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940985">fieldStart</span>&nbsp;<span class="op" id="2940996">:=</span>&nbsp;<span class="op" id="2940999">-</span><span class="num" id="2941000">1</span>&nbsp;<span class="comment" id="2941002">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941049">for</span>&nbsp;<span class="ident" id="2941053">i</span><span class="op" id="2941054">,</span>&nbsp;<span class="builtintype" id="2941056">rune</span>&nbsp;<span class="op" id="2941061">:=</span>&nbsp;<span class="keyword" id="2941064">range</span>&nbsp;<span class="ident" id="2941070">s</span>&nbsp;<span class="op" id="2941072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941076">if</span>&nbsp;<span class="ident" id="2941079">f</span><span class="op" id="2941080">(</span><span class="builtintype" id="2941081">rune</span><span class="op" id="2941085">)</span>&nbsp;<span class="op" id="2941087">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941092">if</span>&nbsp;<span class="ident" id="2941095">fieldStart</span>&nbsp;<span class="op" id="2941106">&gt;=</span>&nbsp;<span class="num" id="2941109">0</span>&nbsp;<span class="op" id="2941111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941117">a</span><span class="op" id="2941118">[</span><span class="ident" id="2941119">na</span><span class="op" id="2941121">]</span>&nbsp;<span class="op" id="2941123">=</span>&nbsp;<span class="ident" id="2941125">s</span><span class="op" id="2941126">[</span><span class="ident" id="2941127">fieldStart</span><span class="op" id="2941137">:</span><span class="ident" id="2941138">i</span><span class="op" id="2941139">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941145">na</span><span class="op" id="2941147">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941154">fieldStart</span>&nbsp;<span class="op" id="2941165">=</span>&nbsp;<span class="op" id="2941167">-</span><span class="num" id="2941168">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941173">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941177">}</span>&nbsp;<span class="keyword" id="2941179">else</span>&nbsp;<span class="keyword" id="2941184">if</span>&nbsp;<span class="ident" id="2941187">fieldStart</span>&nbsp;<span class="op" id="2941198">==</span>&nbsp;<span class="op" id="2941201">-</span><span class="num" id="2941202">1</span>&nbsp;<span class="op" id="2941204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941209">fieldStart</span>&nbsp;<span class="op" id="2941220">=</span>&nbsp;<span class="ident" id="2941222">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941232">if</span>&nbsp;<span class="ident" id="2941235">fieldStart</span>&nbsp;<span class="op" id="2941246">&gt;=</span>&nbsp;<span class="num" id="2941249">0</span>&nbsp;<span class="op" id="2941251">{</span>&nbsp;<span class="comment" id="2941253">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941287">a</span><span class="op" id="2941288">[</span><span class="ident" id="2941289">na</span><span class="op" id="2941291">]</span>&nbsp;<span class="op" id="2941293">=</span>&nbsp;<span class="ident" id="2941295">s</span><span class="op" id="2941296">[</span><span class="ident" id="2941297">fieldStart</span><span class="op" id="2941307">:</span><span class="op" id="2941308">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941314">return</span>&nbsp;<span class="ident" id="2941321">a</span><br>
<span class="lineno"></span><span class="op" id="2941323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2941326">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2941415">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2941474">func</span>&nbsp;<span class="ident" id="2941479">Join</span><span class="op" id="2941483">(</span><span class="ident" id="2941484">a</span>&nbsp;<span class="op" id="2941486">[</span><span class="op" id="2941487">]</span><span class="builtintype" id="2941488">string</span><span class="op" id="2941494">,</span>&nbsp;<span class="ident" id="2941496">sep</span>&nbsp;<span class="builtintype" id="2941500">string</span><span class="op" id="2941506">)</span>&nbsp;<span class="builtintype" id="2941508">string</span>&nbsp;<span class="op" id="2941515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941518">if</span>&nbsp;<span class="builtinfunc" id="2941521">len</span><span class="op" id="2941524">(</span><span class="ident" id="2941525">a</span><span class="op" id="2941526">)</span>&nbsp;<span class="op" id="2941528">==</span>&nbsp;<span class="num" id="2941531">0</span>&nbsp;<span class="op" id="2941533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941537">return</span>&nbsp;<span class="string" id="2941544">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941551">if</span>&nbsp;<span class="builtinfunc" id="2941554">len</span><span class="op" id="2941557">(</span><span class="ident" id="2941558">a</span><span class="op" id="2941559">)</span>&nbsp;<span class="op" id="2941561">==</span>&nbsp;<span class="num" id="2941564">1</span>&nbsp;<span class="op" id="2941566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941570">return</span>&nbsp;<span class="ident" id="2941577">a</span><span class="op" id="2941578">[</span><span class="num" id="2941579">0</span><span class="op" id="2941580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941586">n</span>&nbsp;<span class="op" id="2941588">:=</span>&nbsp;<span class="builtinfunc" id="2941591">len</span><span class="op" id="2941594">(</span><span class="ident" id="2941595">sep</span><span class="op" id="2941598">)</span>&nbsp;<span class="op" id="2941600">*</span>&nbsp;<span class="op" id="2941602">(</span><span class="builtinfunc" id="2941603">len</span><span class="op" id="2941606">(</span><span class="ident" id="2941607">a</span><span class="op" id="2941608">)</span>&nbsp;<span class="op" id="2941610">-</span>&nbsp;<span class="num" id="2941612">1</span><span class="op" id="2941613">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941616">for</span>&nbsp;<span class="ident" id="2941620">i</span>&nbsp;<span class="op" id="2941622">:=</span>&nbsp;<span class="num" id="2941625">0</span><span class="op" id="2941626">;</span>&nbsp;<span class="ident" id="2941628">i</span>&nbsp;<span class="op" id="2941630">&lt;</span>&nbsp;<span class="builtinfunc" id="2941632">len</span><span class="op" id="2941635">(</span><span class="ident" id="2941636">a</span><span class="op" id="2941637">)</span><span class="op" id="2941638">;</span>&nbsp;<span class="ident" id="2941640">i</span><span class="op" id="2941641">++</span>&nbsp;<span class="op" id="2941644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941648">n</span>&nbsp;<span class="op" id="2941650">+=</span>&nbsp;<span class="builtinfunc" id="2941653">len</span><span class="op" id="2941656">(</span><span class="ident" id="2941657">a</span><span class="op" id="2941658">[</span><span class="ident" id="2941659">i</span><span class="op" id="2941660">]</span><span class="op" id="2941661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941668">b</span>&nbsp;<span class="op" id="2941670">:=</span>&nbsp;<span class="builtinfunc" id="2941673">make</span><span class="op" id="2941677">(</span><span class="op" id="2941678">[</span><span class="op" id="2941679">]</span><span class="builtintype" id="2941680">byte</span><span class="op" id="2941684">,</span>&nbsp;<span class="ident" id="2941686">n</span><span class="op" id="2941687">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941690">bp</span>&nbsp;<span class="op" id="2941693">:=</span>&nbsp;<span class="builtinfunc" id="2941696">copy</span><span class="op" id="2941700">(</span><span class="ident" id="2941701">b</span><span class="op" id="2941702">,</span>&nbsp;<span class="ident" id="2941704">a</span><span class="op" id="2941705">[</span><span class="num" id="2941706">0</span><span class="op" id="2941707">]</span><span class="op" id="2941708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941711">for</span>&nbsp;<span class="ident" id="2941715">_</span><span class="op" id="2941716">,</span>&nbsp;<span class="ident" id="2941718">s</span>&nbsp;<span class="op" id="2941720">:=</span>&nbsp;<span class="keyword" id="2941723">range</span>&nbsp;<span class="ident" id="2941729">a</span><span class="op" id="2941730">[</span><span class="num" id="2941731">1</span><span class="op" id="2941732">:</span><span class="op" id="2941733">]</span>&nbsp;<span class="op" id="2941735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941739">bp</span>&nbsp;<span class="op" id="2941742">+=</span>&nbsp;<span class="builtinfunc" id="2941745">copy</span><span class="op" id="2941749">(</span><span class="ident" id="2941750">b</span><span class="op" id="2941751">[</span><span class="ident" id="2941752">bp</span><span class="op" id="2941754">:</span><span class="op" id="2941755">]</span><span class="op" id="2941756">,</span>&nbsp;<span class="ident" id="2941758">sep</span><span class="op" id="2941761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941765">bp</span>&nbsp;<span class="op" id="2941768">+=</span>&nbsp;<span class="builtinfunc" id="2941771">copy</span><span class="op" id="2941775">(</span><span class="ident" id="2941776">b</span><span class="op" id="2941777">[</span><span class="ident" id="2941778">bp</span><span class="op" id="2941780">:</span><span class="op" id="2941781">]</span><span class="op" id="2941782">,</span>&nbsp;<span class="ident" id="2941784">s</span><span class="op" id="2941785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941788">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941791">return</span>&nbsp;<span class="builtintype" id="2941798">string</span><span class="op" id="2941804">(</span><span class="ident" id="2941805">b</span><span class="op" id="2941806">)</span><br>
<span class="lineno"></span><span class="op" id="2941808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2941811">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2941871">func</span>&nbsp;<span class="ident" id="2941876">HasPrefix</span><span class="op" id="2941885">(</span><span class="ident" id="2941886">s</span><span class="op" id="2941887">,</span>&nbsp;<span class="ident" id="2941889">prefix</span>&nbsp;<span class="builtintype" id="2941896">string</span><span class="op" id="2941902">)</span>&nbsp;<span class="builtintype" id="2941904">bool</span>&nbsp;<span class="op" id="2941909">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941912">return</span>&nbsp;<span class="builtinfunc" id="2941919">len</span><span class="op" id="2941922">(</span><span class="ident" id="2941923">s</span><span class="op" id="2941924">)</span>&nbsp;<span class="op" id="2941926">&gt;=</span>&nbsp;<span class="builtinfunc" id="2941929">len</span><span class="op" id="2941932">(</span><span class="ident" id="2941933">prefix</span><span class="op" id="2941939">)</span>&nbsp;<span class="op" id="2941941">&amp;&amp;</span>&nbsp;<span class="ident" id="2941944">s</span><span class="op" id="2941945">[</span><span class="num" id="2941946">0</span><span class="op" id="2941947">:</span><span class="builtinfunc" id="2941948">len</span><span class="op" id="2941951">(</span><span class="ident" id="2941952">prefix</span><span class="op" id="2941958">)</span><span class="op" id="2941959">]</span>&nbsp;<span class="op" id="2941961">==</span>&nbsp;<span class="ident" id="2941964">prefix</span><br>
<span class="lineno"></span><span class="op" id="2941971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2941974">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2942032">func</span>&nbsp;<span class="ident" id="2942037">HasSuffix</span><span class="op" id="2942046">(</span><span class="ident" id="2942047">s</span><span class="op" id="2942048">,</span>&nbsp;<span class="ident" id="2942050">suffix</span>&nbsp;<span class="builtintype" id="2942057">string</span><span class="op" id="2942063">)</span>&nbsp;<span class="builtintype" id="2942065">bool</span>&nbsp;<span class="op" id="2942070">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942073">return</span>&nbsp;<span class="builtinfunc" id="2942080">len</span><span class="op" id="2942083">(</span><span class="ident" id="2942084">s</span><span class="op" id="2942085">)</span>&nbsp;<span class="op" id="2942087">&gt;=</span>&nbsp;<span class="builtinfunc" id="2942090">len</span><span class="op" id="2942093">(</span><span class="ident" id="2942094">suffix</span><span class="op" id="2942100">)</span>&nbsp;<span class="op" id="2942102">&amp;&amp;</span>&nbsp;<span class="ident" id="2942105">s</span><span class="op" id="2942106">[</span><span class="builtinfunc" id="2942107">len</span><span class="op" id="2942110">(</span><span class="ident" id="2942111">s</span><span class="op" id="2942112">)</span><span class="op" id="2942113">-</span><span class="builtinfunc" id="2942114">len</span><span class="op" id="2942117">(</span><span class="ident" id="2942118">suffix</span><span class="op" id="2942124">)</span><span class="op" id="2942125">:</span><span class="op" id="2942126">]</span>&nbsp;<span class="op" id="2942128">==</span>&nbsp;<span class="ident" id="2942131">suffix</span><br>
<span class="lineno"></span><span class="op" id="2942138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2942141">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2942212">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2942304">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2942352">func</span>&nbsp;<span class="ident" id="2942357">Map</span><span class="op" id="2942360">(</span><span class="ident" id="2942361">mapping</span>&nbsp;<span class="keyword" id="2942369">func</span><span class="op" id="2942373">(</span><span class="builtintype" id="2942374">rune</span><span class="op" id="2942378">)</span>&nbsp;<span class="builtintype" id="2942380">rune</span><span class="op" id="2942384">,</span>&nbsp;<span class="ident" id="2942386">s</span>&nbsp;<span class="builtintype" id="2942388">string</span><span class="op" id="2942394">)</span>&nbsp;<span class="builtintype" id="2942396">string</span>&nbsp;<span class="op" id="2942403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942406">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942469">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942536">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942598">maxbytes</span>&nbsp;<span class="op" id="2942607">:=</span>&nbsp;<span class="builtinfunc" id="2942610">len</span><span class="op" id="2942613">(</span><span class="ident" id="2942614">s</span><span class="op" id="2942615">)</span>&nbsp;<span class="comment" id="2942617">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942633">nbytes</span>&nbsp;<span class="op" id="2942640">:=</span>&nbsp;<span class="num" id="2942643">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2942652">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942685">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942745">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942775">var</span>&nbsp;<span class="ident" id="2942779">b</span>&nbsp;<span class="op" id="2942781">[</span><span class="op" id="2942782">]</span><span class="builtintype" id="2942783">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942790">for</span>&nbsp;<span class="ident" id="2942794">i</span><span class="op" id="2942795">,</span>&nbsp;<span class="ident" id="2942797">c</span>&nbsp;<span class="op" id="2942799">:=</span>&nbsp;<span class="keyword" id="2942802">range</span>&nbsp;<span class="ident" id="2942808">s</span>&nbsp;<span class="op" id="2942810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942814">r</span>&nbsp;<span class="op" id="2942816">:=</span>&nbsp;<span class="ident" id="2942819">mapping</span><span class="op" id="2942826">(</span><span class="ident" id="2942827">c</span><span class="op" id="2942828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942832">if</span>&nbsp;<span class="ident" id="2942835">b</span>&nbsp;<span class="op" id="2942837">==</span>&nbsp;<span class="ident" id="2942840">nil</span>&nbsp;<span class="op" id="2942844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942849">if</span>&nbsp;<span class="ident" id="2942852">r</span>&nbsp;<span class="op" id="2942854">==</span>&nbsp;<span class="ident" id="2942857">c</span>&nbsp;<span class="op" id="2942859">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942865">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942882">b</span>&nbsp;<span class="op" id="2942884">=</span>&nbsp;<span class="builtinfunc" id="2942886">make</span><span class="op" id="2942890">(</span><span class="op" id="2942891">[</span><span class="op" id="2942892">]</span><span class="builtintype" id="2942893">byte</span><span class="op" id="2942897">,</span>&nbsp;<span class="ident" id="2942899">maxbytes</span><span class="op" id="2942907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942912">nbytes</span>&nbsp;<span class="op" id="2942919">=</span>&nbsp;<span class="builtinfunc" id="2942921">copy</span><span class="op" id="2942925">(</span><span class="ident" id="2942926">b</span><span class="op" id="2942927">,</span>&nbsp;<span class="ident" id="2942929">s</span><span class="op" id="2942930">[</span><span class="op" id="2942931">:</span><span class="ident" id="2942932">i</span><span class="op" id="2942933">]</span><span class="op" id="2942934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942938">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942942">if</span>&nbsp;<span class="ident" id="2942945">r</span>&nbsp;<span class="op" id="2942947">&gt;=</span>&nbsp;<span class="num" id="2942950">0</span>&nbsp;<span class="op" id="2942952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942957">wid</span>&nbsp;<span class="op" id="2942961">:=</span>&nbsp;<span class="num" id="2942964">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942969">if</span>&nbsp;<span class="ident" id="2942972">r</span>&nbsp;<span class="op" id="2942974">&gt;=</span>&nbsp;<span class="ident" id="2942977">utf8</span><span class="op" id="2942981">.</span><span class="ident" id="2942982">RuneSelf</span>&nbsp;<span class="op" id="2942991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942997">wid</span>&nbsp;<span class="op" id="2943001">=</span>&nbsp;<span class="ident" id="2943003">utf8</span><span class="op" id="2943007">.</span><span class="ident" id="2943008">RuneLen</span><span class="op" id="2943015">(</span><span class="ident" id="2943016">r</span><span class="op" id="2943017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943022">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943027">if</span>&nbsp;<span class="ident" id="2943030">nbytes</span><span class="op" id="2943036">+</span><span class="ident" id="2943037">wid</span>&nbsp;<span class="op" id="2943041">&gt;</span>&nbsp;<span class="ident" id="2943043">maxbytes</span>&nbsp;<span class="op" id="2943052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943058">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943082">maxbytes</span>&nbsp;<span class="op" id="2943091">=</span>&nbsp;<span class="ident" id="2943093">maxbytes</span><span class="op" id="2943101">*</span><span class="num" id="2943102">2</span>&nbsp;<span class="op" id="2943104">+</span>&nbsp;<span class="ident" id="2943106">utf8</span><span class="op" id="2943110">.</span><span class="ident" id="2943111">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943122">nb</span>&nbsp;<span class="op" id="2943125">:=</span>&nbsp;<span class="builtinfunc" id="2943128">make</span><span class="op" id="2943132">(</span><span class="op" id="2943133">[</span><span class="op" id="2943134">]</span><span class="builtintype" id="2943135">byte</span><span class="op" id="2943139">,</span>&nbsp;<span class="ident" id="2943141">maxbytes</span><span class="op" id="2943149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2943155">copy</span><span class="op" id="2943159">(</span><span class="ident" id="2943160">nb</span><span class="op" id="2943162">,</span>&nbsp;<span class="ident" id="2943164">b</span><span class="op" id="2943165">[</span><span class="num" id="2943166">0</span><span class="op" id="2943167">:</span><span class="ident" id="2943168">nbytes</span><span class="op" id="2943174">]</span><span class="op" id="2943175">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943181">b</span>&nbsp;<span class="op" id="2943183">=</span>&nbsp;<span class="ident" id="2943185">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943196">nbytes</span>&nbsp;<span class="op" id="2943203">+=</span>&nbsp;<span class="ident" id="2943206">utf8</span><span class="op" id="2943210">.</span><span class="ident" id="2943211">EncodeRune</span><span class="op" id="2943221">(</span><span class="ident" id="2943222">b</span><span class="op" id="2943223">[</span><span class="ident" id="2943224">nbytes</span><span class="op" id="2943230">:</span><span class="ident" id="2943231">maxbytes</span><span class="op" id="2943239">]</span><span class="op" id="2943240">,</span>&nbsp;<span class="ident" id="2943242">r</span><span class="op" id="2943243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943250">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943253">if</span>&nbsp;<span class="ident" id="2943256">b</span>&nbsp;<span class="op" id="2943258">==</span>&nbsp;<span class="ident" id="2943261">nil</span>&nbsp;<span class="op" id="2943265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943269">return</span>&nbsp;<span class="ident" id="2943276">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943282">return</span>&nbsp;<span class="builtintype" id="2943289">string</span><span class="op" id="2943295">(</span><span class="ident" id="2943296">b</span><span class="op" id="2943297">[</span><span class="num" id="2943298">0</span><span class="op" id="2943299">:</span><span class="ident" id="2943300">nbytes</span><span class="op" id="2943306">]</span><span class="op" id="2943307">)</span><br>
<span class="lineno"></span><span class="op" id="2943309">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2943312">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2943387">func</span>&nbsp;<span class="ident" id="2943392">Repeat</span><span class="op" id="2943398">(</span><span class="ident" id="2943399">s</span>&nbsp;<span class="builtintype" id="2943401">string</span><span class="op" id="2943407">,</span>&nbsp;<span class="ident" id="2943409">count</span>&nbsp;<span class="builtintype" id="2943415">int</span><span class="op" id="2943418">)</span>&nbsp;<span class="builtintype" id="2943420">string</span>&nbsp;<span class="op" id="2943427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943430">b</span>&nbsp;<span class="op" id="2943432">:=</span>&nbsp;<span class="builtinfunc" id="2943435">make</span><span class="op" id="2943439">(</span><span class="op" id="2943440">[</span><span class="op" id="2943441">]</span><span class="builtintype" id="2943442">byte</span><span class="op" id="2943446">,</span>&nbsp;<span class="builtinfunc" id="2943448">len</span><span class="op" id="2943451">(</span><span class="ident" id="2943452">s</span><span class="op" id="2943453">)</span><span class="op" id="2943454">*</span><span class="ident" id="2943455">count</span><span class="op" id="2943460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943463">bp</span>&nbsp;<span class="op" id="2943466">:=</span>&nbsp;<span class="builtinfunc" id="2943469">copy</span><span class="op" id="2943473">(</span><span class="ident" id="2943474">b</span><span class="op" id="2943475">,</span>&nbsp;<span class="ident" id="2943477">s</span><span class="op" id="2943478">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943481">for</span>&nbsp;<span class="ident" id="2943485">bp</span>&nbsp;<span class="op" id="2943488">&lt;</span>&nbsp;<span class="builtinfunc" id="2943490">len</span><span class="op" id="2943493">(</span><span class="ident" id="2943494">b</span><span class="op" id="2943495">)</span>&nbsp;<span class="op" id="2943497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2943501">copy</span><span class="op" id="2943505">(</span><span class="ident" id="2943506">b</span><span class="op" id="2943507">[</span><span class="ident" id="2943508">bp</span><span class="op" id="2943510">:</span><span class="op" id="2943511">]</span><span class="op" id="2943512">,</span>&nbsp;<span class="ident" id="2943514">b</span><span class="op" id="2943515">[</span><span class="op" id="2943516">:</span><span class="ident" id="2943517">bp</span><span class="op" id="2943519">]</span><span class="op" id="2943520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943524">bp</span>&nbsp;<span class="op" id="2943527">*=</span>&nbsp;<span class="num" id="2943530">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943536">return</span>&nbsp;<span class="builtintype" id="2943543">string</span><span class="op" id="2943549">(</span><span class="ident" id="2943550">b</span><span class="op" id="2943551">)</span><br>
<span class="lineno">465</span><span class="op" id="2943553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2943556">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2943651">func</span>&nbsp;<span class="ident" id="2943656">ToUpper</span><span class="op" id="2943663">(</span><span class="ident" id="2943664">s</span>&nbsp;<span class="builtintype" id="2943666">string</span><span class="op" id="2943672">)</span>&nbsp;<span class="builtintype" id="2943674">string</span>&nbsp;<span class="op" id="2943681">{</span>&nbsp;<span class="keyword" id="2943683">return</span>&nbsp;<span class="ident" id="2943690">Map</span><span class="op" id="2943693">(</span><span class="ident" id="2943694">unicode</span><span class="op" id="2943701">.</span><span class="ident" id="2943702">ToUpper</span><span class="op" id="2943709">,</span>&nbsp;<span class="ident" id="2943711">s</span><span class="op" id="2943712">)</span>&nbsp;<span class="op" id="2943714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2943717">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2943812">func</span>&nbsp;<span class="ident" id="2943817">ToLower</span><span class="op" id="2943824">(</span><span class="ident" id="2943825">s</span>&nbsp;<span class="builtintype" id="2943827">string</span><span class="op" id="2943833">)</span>&nbsp;<span class="builtintype" id="2943835">string</span>&nbsp;<span class="op" id="2943842">{</span>&nbsp;<span class="keyword" id="2943844">return</span>&nbsp;<span class="ident" id="2943851">Map</span><span class="op" id="2943854">(</span><span class="ident" id="2943855">unicode</span><span class="op" id="2943862">.</span><span class="ident" id="2943863">ToLower</span><span class="op" id="2943870">,</span>&nbsp;<span class="ident" id="2943872">s</span><span class="op" id="2943873">)</span>&nbsp;<span class="op" id="2943875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2943878">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2943973">func</span>&nbsp;<span class="ident" id="2943978">ToTitle</span><span class="op" id="2943985">(</span><span class="ident" id="2943986">s</span>&nbsp;<span class="builtintype" id="2943988">string</span><span class="op" id="2943994">)</span>&nbsp;<span class="builtintype" id="2943996">string</span>&nbsp;<span class="op" id="2944003">{</span>&nbsp;<span class="keyword" id="2944005">return</span>&nbsp;<span class="ident" id="2944012">Map</span><span class="op" id="2944015">(</span><span class="ident" id="2944016">unicode</span><span class="op" id="2944023">.</span><span class="ident" id="2944024">ToTitle</span><span class="op" id="2944031">,</span>&nbsp;<span class="ident" id="2944033">s</span><span class="op" id="2944034">)</span>&nbsp;<span class="op" id="2944036">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2944039">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2944129">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2944189">func</span>&nbsp;<span class="ident" id="2944194">ToUpperSpecial</span><span class="op" id="2944208">(</span><span class="ident" id="2944209">_case</span>&nbsp;<span class="ident" id="2944215">unicode</span><span class="op" id="2944222">.</span><span class="ident" id="2944223">SpecialCase</span><span class="op" id="2944234">,</span>&nbsp;<span class="ident" id="2944236">s</span>&nbsp;<span class="builtintype" id="2944238">string</span><span class="op" id="2944244">)</span>&nbsp;<span class="builtintype" id="2944246">string</span>&nbsp;<span class="op" id="2944253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944256">return</span>&nbsp;<span class="ident" id="2944263">Map</span><span class="op" id="2944266">(</span><span class="keyword" id="2944267">func</span><span class="op" id="2944271">(</span><span class="ident" id="2944272">r</span>&nbsp;<span class="builtintype" id="2944274">rune</span><span class="op" id="2944278">)</span>&nbsp;<span class="builtintype" id="2944280">rune</span>&nbsp;<span class="op" id="2944285">{</span>&nbsp;<span class="keyword" id="2944287">return</span>&nbsp;<span class="ident" id="2944294">_case</span><span class="op" id="2944299">.</span><span class="ident" id="2944300">ToUpper</span><span class="op" id="2944307">(</span><span class="ident" id="2944308">r</span><span class="op" id="2944309">)</span>&nbsp;<span class="op" id="2944311">}</span><span class="op" id="2944312">,</span>&nbsp;<span class="ident" id="2944314">s</span><span class="op" id="2944315">)</span><br>
<span class="lineno">480</span><span class="op" id="2944317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2944320">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2944410">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2944470">func</span>&nbsp;<span class="ident" id="2944475">ToLowerSpecial</span><span class="op" id="2944489">(</span><span class="ident" id="2944490">_case</span>&nbsp;<span class="ident" id="2944496">unicode</span><span class="op" id="2944503">.</span><span class="ident" id="2944504">SpecialCase</span><span class="op" id="2944515">,</span>&nbsp;<span class="ident" id="2944517">s</span>&nbsp;<span class="builtintype" id="2944519">string</span><span class="op" id="2944525">)</span>&nbsp;<span class="builtintype" id="2944527">string</span>&nbsp;<span class="op" id="2944534">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944537">return</span>&nbsp;<span class="ident" id="2944544">Map</span><span class="op" id="2944547">(</span><span class="keyword" id="2944548">func</span><span class="op" id="2944552">(</span><span class="ident" id="2944553">r</span>&nbsp;<span class="builtintype" id="2944555">rune</span><span class="op" id="2944559">)</span>&nbsp;<span class="builtintype" id="2944561">rune</span>&nbsp;<span class="op" id="2944566">{</span>&nbsp;<span class="keyword" id="2944568">return</span>&nbsp;<span class="ident" id="2944575">_case</span><span class="op" id="2944580">.</span><span class="ident" id="2944581">ToLower</span><span class="op" id="2944588">(</span><span class="ident" id="2944589">r</span><span class="op" id="2944590">)</span>&nbsp;<span class="op" id="2944592">}</span><span class="op" id="2944593">,</span>&nbsp;<span class="ident" id="2944595">s</span><span class="op" id="2944596">)</span><br>
<span class="lineno"></span><span class="op" id="2944598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2944601">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2944691">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2944751">func</span>&nbsp;<span class="ident" id="2944756">ToTitleSpecial</span><span class="op" id="2944770">(</span><span class="ident" id="2944771">_case</span>&nbsp;<span class="ident" id="2944777">unicode</span><span class="op" id="2944784">.</span><span class="ident" id="2944785">SpecialCase</span><span class="op" id="2944796">,</span>&nbsp;<span class="ident" id="2944798">s</span>&nbsp;<span class="builtintype" id="2944800">string</span><span class="op" id="2944806">)</span>&nbsp;<span class="builtintype" id="2944808">string</span>&nbsp;<span class="op" id="2944815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944818">return</span>&nbsp;<span class="ident" id="2944825">Map</span><span class="op" id="2944828">(</span><span class="keyword" id="2944829">func</span><span class="op" id="2944833">(</span><span class="ident" id="2944834">r</span>&nbsp;<span class="builtintype" id="2944836">rune</span><span class="op" id="2944840">)</span>&nbsp;<span class="builtintype" id="2944842">rune</span>&nbsp;<span class="op" id="2944847">{</span>&nbsp;<span class="keyword" id="2944849">return</span>&nbsp;<span class="ident" id="2944856">_case</span><span class="op" id="2944861">.</span><span class="ident" id="2944862">ToTitle</span><span class="op" id="2944869">(</span><span class="ident" id="2944870">r</span><span class="op" id="2944871">)</span>&nbsp;<span class="op" id="2944873">}</span><span class="op" id="2944874">,</span>&nbsp;<span class="ident" id="2944876">s</span><span class="op" id="2944877">)</span><br>
<span class="lineno"></span><span class="op" id="2944879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2944882">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2944950">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2945020">func</span>&nbsp;<span class="ident" id="2945025">isSeparator</span><span class="op" id="2945036">(</span><span class="ident" id="2945037">r</span>&nbsp;<span class="builtintype" id="2945039">rune</span><span class="op" id="2945043">)</span>&nbsp;<span class="builtintype" id="2945045">bool</span>&nbsp;<span class="op" id="2945050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945053">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945111">if</span>&nbsp;<span class="ident" id="2945114">r</span>&nbsp;<span class="op" id="2945116">&lt;=</span>&nbsp;<span class="num" id="2945119">0x7F</span>&nbsp;<span class="op" id="2945124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945128">switch</span>&nbsp;<span class="op" id="2945135">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945139">case</span>&nbsp;<span class="string" id="2945144">&#39;0&#39;</span>&nbsp;<span class="op" id="2945148">&lt;=</span>&nbsp;<span class="ident" id="2945151">r</span>&nbsp;<span class="op" id="2945153">&amp;&amp;</span>&nbsp;<span class="ident" id="2945156">r</span>&nbsp;<span class="op" id="2945158">&lt;=</span>&nbsp;<span class="string" id="2945161">&#39;9&#39;</span><span class="op" id="2945164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945169">return</span>&nbsp;<span class="builtintype" id="2945176">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945184">case</span>&nbsp;<span class="string" id="2945189">&#39;a&#39;</span>&nbsp;<span class="op" id="2945193">&lt;=</span>&nbsp;<span class="ident" id="2945196">r</span>&nbsp;<span class="op" id="2945198">&amp;&amp;</span>&nbsp;<span class="ident" id="2945201">r</span>&nbsp;<span class="op" id="2945203">&lt;=</span>&nbsp;<span class="string" id="2945206">&#39;z&#39;</span><span class="op" id="2945209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945214">return</span>&nbsp;<span class="builtintype" id="2945221">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945229">case</span>&nbsp;<span class="string" id="2945234">&#39;A&#39;</span>&nbsp;<span class="op" id="2945238">&lt;=</span>&nbsp;<span class="ident" id="2945241">r</span>&nbsp;<span class="op" id="2945243">&amp;&amp;</span>&nbsp;<span class="ident" id="2945246">r</span>&nbsp;<span class="op" id="2945248">&lt;=</span>&nbsp;<span class="string" id="2945251">&#39;Z&#39;</span><span class="op" id="2945254">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945259">return</span>&nbsp;<span class="builtintype" id="2945266">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945274">case</span>&nbsp;<span class="ident" id="2945279">r</span>&nbsp;<span class="op" id="2945281">==</span>&nbsp;<span class="string" id="2945284">&#39;_&#39;</span><span class="op" id="2945287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945292">return</span>&nbsp;<span class="builtintype" id="2945299">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945311">return</span>&nbsp;<span class="builtintype" id="2945318">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945327">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945369">if</span>&nbsp;<span class="ident" id="2945372">unicode</span><span class="op" id="2945379">.</span><span class="ident" id="2945380">IsLetter</span><span class="op" id="2945388">(</span><span class="ident" id="2945389">r</span><span class="op" id="2945390">)</span>&nbsp;<span class="op" id="2945392">||</span>&nbsp;<span class="ident" id="2945395">unicode</span><span class="op" id="2945402">.</span><span class="ident" id="2945403">IsDigit</span><span class="op" id="2945410">(</span><span class="ident" id="2945411">r</span><span class="op" id="2945412">)</span>&nbsp;<span class="op" id="2945414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945418">return</span>&nbsp;<span class="builtintype" id="2945425">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945432">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945435">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945503">return</span>&nbsp;<span class="ident" id="2945510">unicode</span><span class="op" id="2945517">.</span><span class="ident" id="2945518">IsSpace</span><span class="op" id="2945525">(</span><span class="ident" id="2945526">r</span><span class="op" id="2945527">)</span><br>
<span class="lineno"></span><span class="op" id="2945529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2945532">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2945614">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2945645">//</span><br>
<span class="lineno"></span><span class="comment" id="2945648">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2945742">func</span>&nbsp;<span class="ident" id="2945747">Title</span><span class="op" id="2945752">(</span><span class="ident" id="2945753">s</span>&nbsp;<span class="builtintype" id="2945755">string</span><span class="op" id="2945761">)</span>&nbsp;<span class="builtintype" id="2945763">string</span>&nbsp;<span class="op" id="2945770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945773">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945815">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945887">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945918">prev</span>&nbsp;<span class="op" id="2945923">:=</span>&nbsp;<span class="string" id="2945926">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945931">return</span>&nbsp;<span class="ident" id="2945938">Map</span><span class="op" id="2945941">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945945">func</span><span class="op" id="2945949">(</span><span class="ident" id="2945950">r</span>&nbsp;<span class="builtintype" id="2945952">rune</span><span class="op" id="2945956">)</span>&nbsp;<span class="builtintype" id="2945958">rune</span>&nbsp;<span class="op" id="2945963">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945968">if</span>&nbsp;<span class="ident" id="2945971">isSeparator</span><span class="op" id="2945982">(</span><span class="ident" id="2945983">prev</span><span class="op" id="2945987">)</span>&nbsp;<span class="op" id="2945989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945995">prev</span>&nbsp;<span class="op" id="2946000">=</span>&nbsp;<span class="ident" id="2946002">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946008">return</span>&nbsp;<span class="ident" id="2946015">unicode</span><span class="op" id="2946022">.</span><span class="ident" id="2946023">ToTitle</span><span class="op" id="2946030">(</span><span class="ident" id="2946031">r</span><span class="op" id="2946032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946042">prev</span>&nbsp;<span class="op" id="2946047">=</span>&nbsp;<span class="ident" id="2946049">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946054">return</span>&nbsp;<span class="ident" id="2946061">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946065">}</span><span class="op" id="2946066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946070">s</span><span class="op" id="2946071">)</span><br>
<span class="lineno"></span><span class="op" id="2946073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2946076">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2946141">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2946191">func</span>&nbsp;<span class="ident" id="2946196">TrimLeftFunc</span><span class="op" id="2946208">(</span><span class="ident" id="2946209">s</span>&nbsp;<span class="builtintype" id="2946211">string</span><span class="op" id="2946217">,</span>&nbsp;<span class="ident" id="2946219">f</span>&nbsp;<span class="keyword" id="2946221">func</span><span class="op" id="2946225">(</span><span class="builtintype" id="2946226">rune</span><span class="op" id="2946230">)</span>&nbsp;<span class="builtintype" id="2946232">bool</span><span class="op" id="2946236">)</span>&nbsp;<span class="builtintype" id="2946238">string</span>&nbsp;<span class="op" id="2946245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946248">i</span>&nbsp;<span class="op" id="2946250">:=</span>&nbsp;<span class="ident" id="2946253">indexFunc</span><span class="op" id="2946262">(</span><span class="ident" id="2946263">s</span><span class="op" id="2946264">,</span>&nbsp;<span class="ident" id="2946266">f</span><span class="op" id="2946267">,</span>&nbsp;<span class="builtintype" id="2946269">false</span><span class="op" id="2946274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946277">if</span>&nbsp;<span class="ident" id="2946280">i</span>&nbsp;<span class="op" id="2946282">==</span>&nbsp;<span class="op" id="2946285">-</span><span class="num" id="2946286">1</span>&nbsp;<span class="op" id="2946288">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946292">return</span>&nbsp;<span class="string" id="2946299">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946306">return</span>&nbsp;<span class="ident" id="2946313">s</span><span class="op" id="2946314">[</span><span class="ident" id="2946315">i</span><span class="op" id="2946316">:</span><span class="op" id="2946317">]</span><br>
<span class="lineno"></span><span class="op" id="2946319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2946322">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2946389">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2946439">func</span>&nbsp;<span class="ident" id="2946444">TrimRightFunc</span><span class="op" id="2946457">(</span><span class="ident" id="2946458">s</span>&nbsp;<span class="builtintype" id="2946460">string</span><span class="op" id="2946466">,</span>&nbsp;<span class="ident" id="2946468">f</span>&nbsp;<span class="keyword" id="2946470">func</span><span class="op" id="2946474">(</span><span class="builtintype" id="2946475">rune</span><span class="op" id="2946479">)</span>&nbsp;<span class="builtintype" id="2946481">bool</span><span class="op" id="2946485">)</span>&nbsp;<span class="builtintype" id="2946487">string</span>&nbsp;<span class="op" id="2946494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946497">i</span>&nbsp;<span class="op" id="2946499">:=</span>&nbsp;<span class="ident" id="2946502">lastIndexFunc</span><span class="op" id="2946515">(</span><span class="ident" id="2946516">s</span><span class="op" id="2946517">,</span>&nbsp;<span class="ident" id="2946519">f</span><span class="op" id="2946520">,</span>&nbsp;<span class="builtintype" id="2946522">false</span><span class="op" id="2946527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946530">if</span>&nbsp;<span class="ident" id="2946533">i</span>&nbsp;<span class="op" id="2946535">&gt;=</span>&nbsp;<span class="num" id="2946538">0</span>&nbsp;<span class="op" id="2946540">&amp;&amp;</span>&nbsp;<span class="ident" id="2946543">s</span><span class="op" id="2946544">[</span><span class="ident" id="2946545">i</span><span class="op" id="2946546">]</span>&nbsp;<span class="op" id="2946548">&gt;=</span>&nbsp;<span class="ident" id="2946551">utf8</span><span class="op" id="2946555">.</span><span class="ident" id="2946556">RuneSelf</span>&nbsp;<span class="op" id="2946565">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946569">_</span><span class="op" id="2946570">,</span>&nbsp;<span class="ident" id="2946572">wid</span>&nbsp;<span class="op" id="2946576">:=</span>&nbsp;<span class="ident" id="2946579">utf8</span><span class="op" id="2946583">.</span><span class="ident" id="2946584">DecodeRuneInString</span><span class="op" id="2946602">(</span><span class="ident" id="2946603">s</span><span class="op" id="2946604">[</span><span class="ident" id="2946605">i</span><span class="op" id="2946606">:</span><span class="op" id="2946607">]</span><span class="op" id="2946608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946612">i</span>&nbsp;<span class="op" id="2946614">+=</span>&nbsp;<span class="ident" id="2946617">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946622">}</span>&nbsp;<span class="keyword" id="2946624">else</span>&nbsp;<span class="op" id="2946629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946633">i</span><span class="op" id="2946634">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946638">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946641">return</span>&nbsp;<span class="ident" id="2946648">s</span><span class="op" id="2946649">[</span><span class="num" id="2946650">0</span><span class="op" id="2946651">:</span><span class="ident" id="2946652">i</span><span class="op" id="2946653">]</span><br>
<span class="lineno"></span><span class="op" id="2946655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2946658">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2946719">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2946782">func</span>&nbsp;<span class="ident" id="2946787">TrimFunc</span><span class="op" id="2946795">(</span><span class="ident" id="2946796">s</span>&nbsp;<span class="builtintype" id="2946798">string</span><span class="op" id="2946804">,</span>&nbsp;<span class="ident" id="2946806">f</span>&nbsp;<span class="keyword" id="2946808">func</span><span class="op" id="2946812">(</span><span class="builtintype" id="2946813">rune</span><span class="op" id="2946817">)</span>&nbsp;<span class="builtintype" id="2946819">bool</span><span class="op" id="2946823">)</span>&nbsp;<span class="builtintype" id="2946825">string</span>&nbsp;<span class="op" id="2946832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946835">return</span>&nbsp;<span class="ident" id="2946842">TrimRightFunc</span><span class="op" id="2946855">(</span><span class="ident" id="2946856">TrimLeftFunc</span><span class="op" id="2946868">(</span><span class="ident" id="2946869">s</span><span class="op" id="2946870">,</span>&nbsp;<span class="ident" id="2946872">f</span><span class="op" id="2946873">)</span><span class="op" id="2946874">,</span>&nbsp;<span class="ident" id="2946876">f</span><span class="op" id="2946877">)</span><br>
<span class="lineno"></span><span class="op" id="2946879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2946882">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2946941">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2946990">func</span>&nbsp;<span class="ident" id="2946995">IndexFunc</span><span class="op" id="2947004">(</span><span class="ident" id="2947005">s</span>&nbsp;<span class="builtintype" id="2947007">string</span><span class="op" id="2947013">,</span>&nbsp;<span class="ident" id="2947015">f</span>&nbsp;<span class="keyword" id="2947017">func</span><span class="op" id="2947021">(</span><span class="builtintype" id="2947022">rune</span><span class="op" id="2947026">)</span>&nbsp;<span class="builtintype" id="2947028">bool</span><span class="op" id="2947032">)</span>&nbsp;<span class="builtintype" id="2947034">int</span>&nbsp;<span class="op" id="2947038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947041">return</span>&nbsp;<span class="ident" id="2947048">indexFunc</span><span class="op" id="2947057">(</span><span class="ident" id="2947058">s</span><span class="op" id="2947059">,</span>&nbsp;<span class="ident" id="2947061">f</span><span class="op" id="2947062">,</span>&nbsp;<span class="builtintype" id="2947064">true</span><span class="op" id="2947068">)</span><br>
<span class="lineno"></span><span class="op" id="2947070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2947073">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2947127">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2947184">func</span>&nbsp;<span class="ident" id="2947189">LastIndexFunc</span><span class="op" id="2947202">(</span><span class="ident" id="2947203">s</span>&nbsp;<span class="builtintype" id="2947205">string</span><span class="op" id="2947211">,</span>&nbsp;<span class="ident" id="2947213">f</span>&nbsp;<span class="keyword" id="2947215">func</span><span class="op" id="2947219">(</span><span class="builtintype" id="2947220">rune</span><span class="op" id="2947224">)</span>&nbsp;<span class="builtintype" id="2947226">bool</span><span class="op" id="2947230">)</span>&nbsp;<span class="builtintype" id="2947232">int</span>&nbsp;<span class="op" id="2947236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947239">return</span>&nbsp;<span class="ident" id="2947246">lastIndexFunc</span><span class="op" id="2947259">(</span><span class="ident" id="2947260">s</span><span class="op" id="2947261">,</span>&nbsp;<span class="ident" id="2947263">f</span><span class="op" id="2947264">,</span>&nbsp;<span class="builtintype" id="2947266">true</span><span class="op" id="2947270">)</span><br>
<span class="lineno"></span><span class="op" id="2947272">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2947275">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2947328">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2947384">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2947397">func</span>&nbsp;<span class="ident" id="2947402">indexFunc</span><span class="op" id="2947411">(</span><span class="ident" id="2947412">s</span>&nbsp;<span class="builtintype" id="2947414">string</span><span class="op" id="2947420">,</span>&nbsp;<span class="ident" id="2947422">f</span>&nbsp;<span class="keyword" id="2947424">func</span><span class="op" id="2947428">(</span><span class="builtintype" id="2947429">rune</span><span class="op" id="2947433">)</span>&nbsp;<span class="builtintype" id="2947435">bool</span><span class="op" id="2947439">,</span>&nbsp;<span class="ident" id="2947441">truth</span>&nbsp;<span class="builtintype" id="2947447">bool</span><span class="op" id="2947451">)</span>&nbsp;<span class="builtintype" id="2947453">int</span>&nbsp;<span class="op" id="2947457">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2947460">start</span>&nbsp;<span class="op" id="2947466">:=</span>&nbsp;<span class="num" id="2947469">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947472">for</span>&nbsp;<span class="ident" id="2947476">start</span>&nbsp;<span class="op" id="2947482">&lt;</span>&nbsp;<span class="builtinfunc" id="2947484">len</span><span class="op" id="2947487">(</span><span class="ident" id="2947488">s</span><span class="op" id="2947489">)</span>&nbsp;<span class="op" id="2947491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2947495">wid</span>&nbsp;<span class="op" id="2947499">:=</span>&nbsp;<span class="num" id="2947502">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2947506">r</span>&nbsp;<span class="op" id="2947508">:=</span>&nbsp;<span class="builtintype" id="2947511">rune</span><span class="op" id="2947515">(</span><span class="ident" id="2947516">s</span><span class="op" id="2947517">[</span><span class="ident" id="2947518">start</span><span class="op" id="2947523">]</span><span class="op" id="2947524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947528">if</span>&nbsp;<span class="ident" id="2947531">r</span>&nbsp;<span class="op" id="2947533">&gt;=</span>&nbsp;<span class="ident" id="2947536">utf8</span><span class="op" id="2947540">.</span><span class="ident" id="2947541">RuneSelf</span>&nbsp;<span class="op" id="2947550">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2947555">r</span><span class="op" id="2947556">,</span>&nbsp;<span class="ident" id="2947558">wid</span>&nbsp;<span class="op" id="2947562">=</span>&nbsp;<span class="ident" id="2947564">utf8</span><span class="op" id="2947568">.</span><span class="ident" id="2947569">DecodeRuneInString</span><span class="op" id="2947587">(</span><span class="ident" id="2947588">s</span><span class="op" id="2947589">[</span><span class="ident" id="2947590">start</span><span class="op" id="2947595">:</span><span class="op" id="2947596">]</span><span class="op" id="2947597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2947601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947605">if</span>&nbsp;<span class="ident" id="2947608">f</span><span class="op" id="2947609">(</span><span class="ident" id="2947610">r</span><span class="op" id="2947611">)</span>&nbsp;<span class="op" id="2947613">==</span>&nbsp;<span class="ident" id="2947616">truth</span>&nbsp;<span class="op" id="2947622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947627">return</span>&nbsp;<span class="ident" id="2947634">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2947642">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2947646">start</span>&nbsp;<span class="op" id="2947652">+=</span>&nbsp;<span class="ident" id="2947655">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2947660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947663">return</span>&nbsp;<span class="op" id="2947670">-</span><span class="num" id="2947671">1</span><br>
<span class="lineno"></span><span class="op" id="2947673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2947676">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2947737">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2947793">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2947806">func</span>&nbsp;<span class="ident" id="2947811">lastIndexFunc</span><span class="op" id="2947824">(</span><span class="ident" id="2947825">s</span>&nbsp;<span class="builtintype" id="2947827">string</span><span class="op" id="2947833">,</span>&nbsp;<span class="ident" id="2947835">f</span>&nbsp;<span class="keyword" id="2947837">func</span><span class="op" id="2947841">(</span><span class="builtintype" id="2947842">rune</span><span class="op" id="2947846">)</span>&nbsp;<span class="builtintype" id="2947848">bool</span><span class="op" id="2947852">,</span>&nbsp;<span class="ident" id="2947854">truth</span>&nbsp;<span class="builtintype" id="2947860">bool</span><span class="op" id="2947864">)</span>&nbsp;<span class="builtintype" id="2947866">int</span>&nbsp;<span class="op" id="2947870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947873">for</span>&nbsp;<span class="ident" id="2947877">i</span>&nbsp;<span class="op" id="2947879">:=</span>&nbsp;<span class="builtinfunc" id="2947882">len</span><span class="op" id="2947885">(</span><span class="ident" id="2947886">s</span><span class="op" id="2947887">)</span><span class="op" id="2947888">;</span>&nbsp;<span class="ident" id="2947890">i</span>&nbsp;<span class="op" id="2947892">&gt;</span>&nbsp;<span class="num" id="2947894">0</span><span class="op" id="2947895">;</span>&nbsp;<span class="op" id="2947897">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2947901">r</span><span class="op" id="2947902">,</span>&nbsp;<span class="ident" id="2947904">size</span>&nbsp;<span class="op" id="2947909">:=</span>&nbsp;<span class="ident" id="2947912">utf8</span><span class="op" id="2947916">.</span><span class="ident" id="2947917">DecodeLastRuneInString</span><span class="op" id="2947939">(</span><span class="ident" id="2947940">s</span><span class="op" id="2947941">[</span><span class="num" id="2947942">0</span><span class="op" id="2947943">:</span><span class="ident" id="2947944">i</span><span class="op" id="2947945">]</span><span class="op" id="2947946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2947950">i</span>&nbsp;<span class="op" id="2947952">-=</span>&nbsp;<span class="ident" id="2947955">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947962">if</span>&nbsp;<span class="ident" id="2947965">f</span><span class="op" id="2947966">(</span><span class="ident" id="2947967">r</span><span class="op" id="2947968">)</span>&nbsp;<span class="op" id="2947970">==</span>&nbsp;<span class="ident" id="2947973">truth</span>&nbsp;<span class="op" id="2947979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947984">return</span>&nbsp;<span class="ident" id="2947991">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2947995">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2947998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948001">return</span>&nbsp;<span class="op" id="2948008">-</span><span class="num" id="2948009">1</span><br>
<span class="lineno"></span><span class="op" id="2948011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2948014">func</span>&nbsp;<span class="ident" id="2948019">makeCutsetFunc</span><span class="op" id="2948033">(</span><span class="ident" id="2948034">cutset</span>&nbsp;<span class="builtintype" id="2948041">string</span><span class="op" id="2948047">)</span>&nbsp;<span class="keyword" id="2948049">func</span><span class="op" id="2948053">(</span><span class="builtintype" id="2948054">rune</span><span class="op" id="2948058">)</span>&nbsp;<span class="builtintype" id="2948060">bool</span>&nbsp;<span class="op" id="2948065">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948068">return</span>&nbsp;<span class="keyword" id="2948075">func</span><span class="op" id="2948079">(</span><span class="ident" id="2948080">r</span>&nbsp;<span class="builtintype" id="2948082">rune</span><span class="op" id="2948086">)</span>&nbsp;<span class="builtintype" id="2948088">bool</span>&nbsp;<span class="op" id="2948093">{</span>&nbsp;<span class="keyword" id="2948095">return</span>&nbsp;<span class="ident" id="2948102">IndexRune</span><span class="op" id="2948111">(</span><span class="ident" id="2948112">cutset</span><span class="op" id="2948118">,</span>&nbsp;<span class="ident" id="2948120">r</span><span class="op" id="2948121">)</span>&nbsp;<span class="op" id="2948123">&gt;=</span>&nbsp;<span class="num" id="2948126">0</span>&nbsp;<span class="op" id="2948128">}</span><br>
<span class="lineno"></span><span class="op" id="2948130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2948133">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2948194">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2948255">func</span>&nbsp;<span class="ident" id="2948260">Trim</span><span class="op" id="2948264">(</span><span class="ident" id="2948265">s</span>&nbsp;<span class="builtintype" id="2948267">string</span><span class="op" id="2948273">,</span>&nbsp;<span class="ident" id="2948275">cutset</span>&nbsp;<span class="builtintype" id="2948282">string</span><span class="op" id="2948288">)</span>&nbsp;<span class="builtintype" id="2948290">string</span>&nbsp;<span class="op" id="2948297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948300">if</span>&nbsp;<span class="ident" id="2948303">s</span>&nbsp;<span class="op" id="2948305">==</span>&nbsp;<span class="string" id="2948308">&#34;&#34;</span>&nbsp;<span class="op" id="2948311">||</span>&nbsp;<span class="ident" id="2948314">cutset</span>&nbsp;<span class="op" id="2948321">==</span>&nbsp;<span class="string" id="2948324">&#34;&#34;</span>&nbsp;<span class="op" id="2948327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948331">return</span>&nbsp;<span class="ident" id="2948338">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948344">return</span>&nbsp;<span class="ident" id="2948351">TrimFunc</span><span class="op" id="2948359">(</span><span class="ident" id="2948360">s</span><span class="op" id="2948361">,</span>&nbsp;<span class="ident" id="2948363">makeCutsetFunc</span><span class="op" id="2948377">(</span><span class="ident" id="2948378">cutset</span><span class="op" id="2948384">)</span><span class="op" id="2948385">)</span><br>
<span class="lineno">625</span><span class="op" id="2948387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2948390">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2948451">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2948503">func</span>&nbsp;<span class="ident" id="2948508">TrimLeft</span><span class="op" id="2948516">(</span><span class="ident" id="2948517">s</span>&nbsp;<span class="builtintype" id="2948519">string</span><span class="op" id="2948525">,</span>&nbsp;<span class="ident" id="2948527">cutset</span>&nbsp;<span class="builtintype" id="2948534">string</span><span class="op" id="2948540">)</span>&nbsp;<span class="builtintype" id="2948542">string</span>&nbsp;<span class="op" id="2948549">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948552">if</span>&nbsp;<span class="ident" id="2948555">s</span>&nbsp;<span class="op" id="2948557">==</span>&nbsp;<span class="string" id="2948560">&#34;&#34;</span>&nbsp;<span class="op" id="2948563">||</span>&nbsp;<span class="ident" id="2948566">cutset</span>&nbsp;<span class="op" id="2948573">==</span>&nbsp;<span class="string" id="2948576">&#34;&#34;</span>&nbsp;<span class="op" id="2948579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948583">return</span>&nbsp;<span class="ident" id="2948590">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948596">return</span>&nbsp;<span class="ident" id="2948603">TrimLeftFunc</span><span class="op" id="2948615">(</span><span class="ident" id="2948616">s</span><span class="op" id="2948617">,</span>&nbsp;<span class="ident" id="2948619">makeCutsetFunc</span><span class="op" id="2948633">(</span><span class="ident" id="2948634">cutset</span><span class="op" id="2948640">)</span><span class="op" id="2948641">)</span><br>
<span class="lineno"></span><span class="op" id="2948643">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2948646">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2948710">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2948762">func</span>&nbsp;<span class="ident" id="2948767">TrimRight</span><span class="op" id="2948776">(</span><span class="ident" id="2948777">s</span>&nbsp;<span class="builtintype" id="2948779">string</span><span class="op" id="2948785">,</span>&nbsp;<span class="ident" id="2948787">cutset</span>&nbsp;<span class="builtintype" id="2948794">string</span><span class="op" id="2948800">)</span>&nbsp;<span class="builtintype" id="2948802">string</span>&nbsp;<span class="op" id="2948809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948812">if</span>&nbsp;<span class="ident" id="2948815">s</span>&nbsp;<span class="op" id="2948817">==</span>&nbsp;<span class="string" id="2948820">&#34;&#34;</span>&nbsp;<span class="op" id="2948823">||</span>&nbsp;<span class="ident" id="2948826">cutset</span>&nbsp;<span class="op" id="2948833">==</span>&nbsp;<span class="string" id="2948836">&#34;&#34;</span>&nbsp;<span class="op" id="2948839">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948843">return</span>&nbsp;<span class="ident" id="2948850">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948856">return</span>&nbsp;<span class="ident" id="2948863">TrimRightFunc</span><span class="op" id="2948876">(</span><span class="ident" id="2948877">s</span><span class="op" id="2948878">,</span>&nbsp;<span class="ident" id="2948880">makeCutsetFunc</span><span class="op" id="2948894">(</span><span class="ident" id="2948895">cutset</span><span class="op" id="2948901">)</span><span class="op" id="2948902">)</span><br>
<span class="lineno"></span><span class="op" id="2948904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2948907">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2948970">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2949030">func</span>&nbsp;<span class="ident" id="2949035">TrimSpace</span><span class="op" id="2949044">(</span><span class="ident" id="2949045">s</span>&nbsp;<span class="builtintype" id="2949047">string</span><span class="op" id="2949053">)</span>&nbsp;<span class="builtintype" id="2949055">string</span>&nbsp;<span class="op" id="2949062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949065">return</span>&nbsp;<span class="ident" id="2949072">TrimFunc</span><span class="op" id="2949080">(</span><span class="ident" id="2949081">s</span><span class="op" id="2949082">,</span>&nbsp;<span class="ident" id="2949084">unicode</span><span class="op" id="2949091">.</span><span class="ident" id="2949092">IsSpace</span><span class="op" id="2949099">)</span><br>
<span class="lineno"></span><span class="op" id="2949101">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2949104">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2949172">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2949232">func</span>&nbsp;<span class="ident" id="2949237">TrimPrefix</span><span class="op" id="2949247">(</span><span class="ident" id="2949248">s</span><span class="op" id="2949249">,</span>&nbsp;<span class="ident" id="2949251">prefix</span>&nbsp;<span class="builtintype" id="2949258">string</span><span class="op" id="2949264">)</span>&nbsp;<span class="builtintype" id="2949266">string</span>&nbsp;<span class="op" id="2949273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949276">if</span>&nbsp;<span class="ident" id="2949279">HasPrefix</span><span class="op" id="2949288">(</span><span class="ident" id="2949289">s</span><span class="op" id="2949290">,</span>&nbsp;<span class="ident" id="2949292">prefix</span><span class="op" id="2949298">)</span>&nbsp;<span class="op" id="2949300">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949304">return</span>&nbsp;<span class="ident" id="2949311">s</span><span class="op" id="2949312">[</span><span class="builtinfunc" id="2949313">len</span><span class="op" id="2949316">(</span><span class="ident" id="2949317">prefix</span><span class="op" id="2949323">)</span><span class="op" id="2949324">:</span><span class="op" id="2949325">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2949328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949331">return</span>&nbsp;<span class="ident" id="2949338">s</span><br>
<span class="lineno"></span><span class="op" id="2949340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2949343">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2949412">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2949470">func</span>&nbsp;<span class="ident" id="2949475">TrimSuffix</span><span class="op" id="2949485">(</span><span class="ident" id="2949486">s</span><span class="op" id="2949487">,</span>&nbsp;<span class="ident" id="2949489">suffix</span>&nbsp;<span class="builtintype" id="2949496">string</span><span class="op" id="2949502">)</span>&nbsp;<span class="builtintype" id="2949504">string</span>&nbsp;<span class="op" id="2949511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949514">if</span>&nbsp;<span class="ident" id="2949517">HasSuffix</span><span class="op" id="2949526">(</span><span class="ident" id="2949527">s</span><span class="op" id="2949528">,</span>&nbsp;<span class="ident" id="2949530">suffix</span><span class="op" id="2949536">)</span>&nbsp;<span class="op" id="2949538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949542">return</span>&nbsp;<span class="ident" id="2949549">s</span><span class="op" id="2949550">[</span><span class="op" id="2949551">:</span><span class="builtinfunc" id="2949552">len</span><span class="op" id="2949555">(</span><span class="ident" id="2949556">s</span><span class="op" id="2949557">)</span><span class="op" id="2949558">-</span><span class="builtinfunc" id="2949559">len</span><span class="op" id="2949562">(</span><span class="ident" id="2949563">suffix</span><span class="op" id="2949569">)</span><span class="op" id="2949570">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2949573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949576">return</span>&nbsp;<span class="ident" id="2949583">s</span><br>
<span class="lineno"></span><span class="op" id="2949585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2949588">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2949647">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2949700">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2949762">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2949828">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2949852">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2949914">func</span>&nbsp;<span class="ident" id="2949919">Replace</span><span class="op" id="2949926">(</span><span class="ident" id="2949927">s</span><span class="op" id="2949928">,</span>&nbsp;<span class="ident" id="2949930">old</span><span class="op" id="2949933">,</span>&nbsp;<span class="builtinfunc" id="2949935">new</span>&nbsp;<span class="builtintype" id="2949939">string</span><span class="op" id="2949945">,</span>&nbsp;<span class="ident" id="2949947">n</span>&nbsp;<span class="builtintype" id="2949949">int</span><span class="op" id="2949952">)</span>&nbsp;<span class="builtintype" id="2949954">string</span>&nbsp;<span class="op" id="2949961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949964">if</span>&nbsp;<span class="ident" id="2949967">old</span>&nbsp;<span class="op" id="2949971">==</span>&nbsp;<span class="builtinfunc" id="2949974">new</span>&nbsp;<span class="op" id="2949978">||</span>&nbsp;<span class="ident" id="2949981">n</span>&nbsp;<span class="op" id="2949983">==</span>&nbsp;<span class="num" id="2949986">0</span>&nbsp;<span class="op" id="2949988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949992">return</span>&nbsp;<span class="ident" id="2949999">s</span>&nbsp;<span class="comment" id="2950001">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2950026">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950062">if</span>&nbsp;<span class="ident" id="2950065">m</span>&nbsp;<span class="op" id="2950067">:=</span>&nbsp;<span class="ident" id="2950070">Count</span><span class="op" id="2950075">(</span><span class="ident" id="2950076">s</span><span class="op" id="2950077">,</span>&nbsp;<span class="ident" id="2950079">old</span><span class="op" id="2950082">)</span><span class="op" id="2950083">;</span>&nbsp;<span class="ident" id="2950085">m</span>&nbsp;<span class="op" id="2950087">==</span>&nbsp;<span class="num" id="2950090">0</span>&nbsp;<span class="op" id="2950092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950096">return</span>&nbsp;<span class="ident" id="2950103">s</span>&nbsp;<span class="comment" id="2950105">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950126">}</span>&nbsp;<span class="keyword" id="2950128">else</span>&nbsp;<span class="keyword" id="2950133">if</span>&nbsp;<span class="ident" id="2950136">n</span>&nbsp;<span class="op" id="2950138">&lt;</span>&nbsp;<span class="num" id="2950140">0</span>&nbsp;<span class="op" id="2950142">||</span>&nbsp;<span class="ident" id="2950145">m</span>&nbsp;<span class="op" id="2950147">&lt;</span>&nbsp;<span class="ident" id="2950149">n</span>&nbsp;<span class="op" id="2950151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950155">n</span>&nbsp;<span class="op" id="2950157">=</span>&nbsp;<span class="ident" id="2950159">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2950166">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950200">t</span>&nbsp;<span class="op" id="2950202">:=</span>&nbsp;<span class="builtinfunc" id="2950205">make</span><span class="op" id="2950209">(</span><span class="op" id="2950210">[</span><span class="op" id="2950211">]</span><span class="builtintype" id="2950212">byte</span><span class="op" id="2950216">,</span>&nbsp;<span class="builtinfunc" id="2950218">len</span><span class="op" id="2950221">(</span><span class="ident" id="2950222">s</span><span class="op" id="2950223">)</span><span class="op" id="2950224">+</span><span class="ident" id="2950225">n</span><span class="op" id="2950226">*</span><span class="op" id="2950227">(</span><span class="builtinfunc" id="2950228">len</span><span class="op" id="2950231">(</span><span class="builtinfunc" id="2950232">new</span><span class="op" id="2950235">)</span><span class="op" id="2950236">-</span><span class="builtinfunc" id="2950237">len</span><span class="op" id="2950240">(</span><span class="ident" id="2950241">old</span><span class="op" id="2950244">)</span><span class="op" id="2950245">)</span><span class="op" id="2950246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950249">w</span>&nbsp;<span class="op" id="2950251">:=</span>&nbsp;<span class="num" id="2950254">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950257">start</span>&nbsp;<span class="op" id="2950263">:=</span>&nbsp;<span class="num" id="2950266">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950269">for</span>&nbsp;<span class="ident" id="2950273">i</span>&nbsp;<span class="op" id="2950275">:=</span>&nbsp;<span class="num" id="2950278">0</span><span class="op" id="2950279">;</span>&nbsp;<span class="ident" id="2950281">i</span>&nbsp;<span class="op" id="2950283">&lt;</span>&nbsp;<span class="ident" id="2950285">n</span><span class="op" id="2950286">;</span>&nbsp;<span class="ident" id="2950288">i</span><span class="op" id="2950289">++</span>&nbsp;<span class="op" id="2950292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950296">j</span>&nbsp;<span class="op" id="2950298">:=</span>&nbsp;<span class="ident" id="2950301">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950309">if</span>&nbsp;<span class="builtinfunc" id="2950312">len</span><span class="op" id="2950315">(</span><span class="ident" id="2950316">old</span><span class="op" id="2950319">)</span>&nbsp;<span class="op" id="2950321">==</span>&nbsp;<span class="num" id="2950324">0</span>&nbsp;<span class="op" id="2950326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950331">if</span>&nbsp;<span class="ident" id="2950334">i</span>&nbsp;<span class="op" id="2950336">&gt;</span>&nbsp;<span class="num" id="2950338">0</span>&nbsp;<span class="op" id="2950340">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950346">_</span><span class="op" id="2950347">,</span>&nbsp;<span class="ident" id="2950349">wid</span>&nbsp;<span class="op" id="2950353">:=</span>&nbsp;<span class="ident" id="2950356">utf8</span><span class="op" id="2950360">.</span><span class="ident" id="2950361">DecodeRuneInString</span><span class="op" id="2950379">(</span><span class="ident" id="2950380">s</span><span class="op" id="2950381">[</span><span class="ident" id="2950382">start</span><span class="op" id="2950387">:</span><span class="op" id="2950388">]</span><span class="op" id="2950389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950395">j</span>&nbsp;<span class="op" id="2950397">+=</span>&nbsp;<span class="ident" id="2950400">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950411">}</span>&nbsp;<span class="keyword" id="2950413">else</span>&nbsp;<span class="op" id="2950418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950423">j</span>&nbsp;<span class="op" id="2950425">+=</span>&nbsp;<span class="ident" id="2950428">Index</span><span class="op" id="2950433">(</span><span class="ident" id="2950434">s</span><span class="op" id="2950435">[</span><span class="ident" id="2950436">start</span><span class="op" id="2950441">:</span><span class="op" id="2950442">]</span><span class="op" id="2950443">,</span>&nbsp;<span class="ident" id="2950445">old</span><span class="op" id="2950448">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950456">w</span>&nbsp;<span class="op" id="2950458">+=</span>&nbsp;<span class="builtinfunc" id="2950461">copy</span><span class="op" id="2950465">(</span><span class="ident" id="2950466">t</span><span class="op" id="2950467">[</span><span class="ident" id="2950468">w</span><span class="op" id="2950469">:</span><span class="op" id="2950470">]</span><span class="op" id="2950471">,</span>&nbsp;<span class="ident" id="2950473">s</span><span class="op" id="2950474">[</span><span class="ident" id="2950475">start</span><span class="op" id="2950480">:</span><span class="ident" id="2950481">j</span><span class="op" id="2950482">]</span><span class="op" id="2950483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950487">w</span>&nbsp;<span class="op" id="2950489">+=</span>&nbsp;<span class="builtinfunc" id="2950492">copy</span><span class="op" id="2950496">(</span><span class="ident" id="2950497">t</span><span class="op" id="2950498">[</span><span class="ident" id="2950499">w</span><span class="op" id="2950500">:</span><span class="op" id="2950501">]</span><span class="op" id="2950502">,</span>&nbsp;<span class="builtinfunc" id="2950504">new</span><span class="op" id="2950507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950511">start</span>&nbsp;<span class="op" id="2950517">=</span>&nbsp;<span class="ident" id="2950519">j</span>&nbsp;<span class="op" id="2950521">+</span>&nbsp;<span class="builtinfunc" id="2950523">len</span><span class="op" id="2950526">(</span><span class="ident" id="2950527">old</span><span class="op" id="2950530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950533">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950536">w</span>&nbsp;<span class="op" id="2950538">+=</span>&nbsp;<span class="builtinfunc" id="2950541">copy</span><span class="op" id="2950545">(</span><span class="ident" id="2950546">t</span><span class="op" id="2950547">[</span><span class="ident" id="2950548">w</span><span class="op" id="2950549">:</span><span class="op" id="2950550">]</span><span class="op" id="2950551">,</span>&nbsp;<span class="ident" id="2950553">s</span><span class="op" id="2950554">[</span><span class="ident" id="2950555">start</span><span class="op" id="2950560">:</span><span class="op" id="2950561">]</span><span class="op" id="2950562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950565">return</span>&nbsp;<span class="builtintype" id="2950572">string</span><span class="op" id="2950578">(</span><span class="ident" id="2950579">t</span><span class="op" id="2950580">[</span><span class="num" id="2950581">0</span><span class="op" id="2950582">:</span><span class="ident" id="2950583">w</span><span class="op" id="2950584">]</span><span class="op" id="2950585">)</span><br>
<span class="lineno"></span><span class="op" id="2950587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2950590">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2950658">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2950699">func</span>&nbsp;<span class="ident" id="2950704">EqualFold</span><span class="op" id="2950713">(</span><span class="ident" id="2950714">s</span><span class="op" id="2950715">,</span>&nbsp;<span class="ident" id="2950717">t</span>&nbsp;<span class="builtintype" id="2950719">string</span><span class="op" id="2950725">)</span>&nbsp;<span class="builtintype" id="2950727">bool</span>&nbsp;<span class="op" id="2950732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950735">for</span>&nbsp;<span class="ident" id="2950739">s</span>&nbsp;<span class="op" id="2950741">!=</span>&nbsp;<span class="string" id="2950744">&#34;&#34;</span>&nbsp;<span class="op" id="2950747">&amp;&amp;</span>&nbsp;<span class="ident" id="2950750">t</span>&nbsp;<span class="op" id="2950752">!=</span>&nbsp;<span class="string" id="2950755">&#34;&#34;</span>&nbsp;<span class="op" id="2950758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2950762">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950804">var</span>&nbsp;<span class="ident" id="2950808">sr</span><span class="op" id="2950810">,</span>&nbsp;<span class="ident" id="2950812">tr</span>&nbsp;<span class="builtintype" id="2950815">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950822">if</span>&nbsp;<span class="ident" id="2950825">s</span><span class="op" id="2950826">[</span><span class="num" id="2950827">0</span><span class="op" id="2950828">]</span>&nbsp;<span class="op" id="2950830">&lt;</span>&nbsp;<span class="ident" id="2950832">utf8</span><span class="op" id="2950836">.</span><span class="ident" id="2950837">RuneSelf</span>&nbsp;<span class="op" id="2950846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950851">sr</span><span class="op" id="2950853">,</span>&nbsp;<span class="ident" id="2950855">s</span>&nbsp;<span class="op" id="2950857">=</span>&nbsp;<span class="builtintype" id="2950859">rune</span><span class="op" id="2950863">(</span><span class="ident" id="2950864">s</span><span class="op" id="2950865">[</span><span class="num" id="2950866">0</span><span class="op" id="2950867">]</span><span class="op" id="2950868">)</span><span class="op" id="2950869">,</span>&nbsp;<span class="ident" id="2950871">s</span><span class="op" id="2950872">[</span><span class="num" id="2950873">1</span><span class="op" id="2950874">:</span><span class="op" id="2950875">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950879">}</span>&nbsp;<span class="keyword" id="2950881">else</span>&nbsp;<span class="op" id="2950886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950891">r</span><span class="op" id="2950892">,</span>&nbsp;<span class="ident" id="2950894">size</span>&nbsp;<span class="op" id="2950899">:=</span>&nbsp;<span class="ident" id="2950902">utf8</span><span class="op" id="2950906">.</span><span class="ident" id="2950907">DecodeRuneInString</span><span class="op" id="2950925">(</span><span class="ident" id="2950926">s</span><span class="op" id="2950927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950932">sr</span><span class="op" id="2950934">,</span>&nbsp;<span class="ident" id="2950936">s</span>&nbsp;<span class="op" id="2950938">=</span>&nbsp;<span class="ident" id="2950940">r</span><span class="op" id="2950941">,</span>&nbsp;<span class="ident" id="2950943">s</span><span class="op" id="2950944">[</span><span class="ident" id="2950945">size</span><span class="op" id="2950949">:</span><span class="op" id="2950950">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950958">if</span>&nbsp;<span class="ident" id="2950961">t</span><span class="op" id="2950962">[</span><span class="num" id="2950963">0</span><span class="op" id="2950964">]</span>&nbsp;<span class="op" id="2950966">&lt;</span>&nbsp;<span class="ident" id="2950968">utf8</span><span class="op" id="2950972">.</span><span class="ident" id="2950973">RuneSelf</span>&nbsp;<span class="op" id="2950982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950987">tr</span><span class="op" id="2950989">,</span>&nbsp;<span class="ident" id="2950991">t</span>&nbsp;<span class="op" id="2950993">=</span>&nbsp;<span class="builtintype" id="2950995">rune</span><span class="op" id="2950999">(</span><span class="ident" id="2951000">t</span><span class="op" id="2951001">[</span><span class="num" id="2951002">0</span><span class="op" id="2951003">]</span><span class="op" id="2951004">)</span><span class="op" id="2951005">,</span>&nbsp;<span class="ident" id="2951007">t</span><span class="op" id="2951008">[</span><span class="num" id="2951009">1</span><span class="op" id="2951010">:</span><span class="op" id="2951011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951015">}</span>&nbsp;<span class="keyword" id="2951017">else</span>&nbsp;<span class="op" id="2951022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951027">r</span><span class="op" id="2951028">,</span>&nbsp;<span class="ident" id="2951030">size</span>&nbsp;<span class="op" id="2951035">:=</span>&nbsp;<span class="ident" id="2951038">utf8</span><span class="op" id="2951042">.</span><span class="ident" id="2951043">DecodeRuneInString</span><span class="op" id="2951061">(</span><span class="ident" id="2951062">t</span><span class="op" id="2951063">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951068">tr</span><span class="op" id="2951070">,</span>&nbsp;<span class="ident" id="2951072">t</span>&nbsp;<span class="op" id="2951074">=</span>&nbsp;<span class="ident" id="2951076">r</span><span class="op" id="2951077">,</span>&nbsp;<span class="ident" id="2951079">t</span><span class="op" id="2951080">[</span><span class="ident" id="2951081">size</span><span class="op" id="2951085">:</span><span class="op" id="2951086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951095">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951150">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951166">if</span>&nbsp;<span class="ident" id="2951169">tr</span>&nbsp;<span class="op" id="2951172">==</span>&nbsp;<span class="ident" id="2951175">sr</span>&nbsp;<span class="op" id="2951178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951183">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951199">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951243">if</span>&nbsp;<span class="ident" id="2951246">tr</span>&nbsp;<span class="op" id="2951249">&lt;</span>&nbsp;<span class="ident" id="2951251">sr</span>&nbsp;<span class="op" id="2951254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951259">tr</span><span class="op" id="2951261">,</span>&nbsp;<span class="ident" id="2951263">sr</span>&nbsp;<span class="op" id="2951266">=</span>&nbsp;<span class="ident" id="2951268">sr</span><span class="op" id="2951270">,</span>&nbsp;<span class="ident" id="2951272">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951281">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951308">if</span>&nbsp;<span class="ident" id="2951311">tr</span>&nbsp;<span class="op" id="2951314">&lt;</span>&nbsp;<span class="ident" id="2951316">utf8</span><span class="op" id="2951320">.</span><span class="ident" id="2951321">RuneSelf</span>&nbsp;<span class="op" id="2951330">&amp;&amp;</span>&nbsp;<span class="string" id="2951333">&#39;A&#39;</span>&nbsp;<span class="op" id="2951337">&lt;=</span>&nbsp;<span class="ident" id="2951340">sr</span>&nbsp;<span class="op" id="2951343">&amp;&amp;</span>&nbsp;<span class="ident" id="2951346">sr</span>&nbsp;<span class="op" id="2951349">&lt;=</span>&nbsp;<span class="string" id="2951352">&#39;Z&#39;</span>&nbsp;<span class="op" id="2951356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951361">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951420">if</span>&nbsp;<span class="ident" id="2951423">tr</span>&nbsp;<span class="op" id="2951426">==</span>&nbsp;<span class="ident" id="2951429">sr</span><span class="op" id="2951431">+</span><span class="string" id="2951432">&#39;a&#39;</span><span class="op" id="2951435">-</span><span class="string" id="2951436">&#39;A&#39;</span>&nbsp;<span class="op" id="2951440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951446">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951458">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951463">return</span>&nbsp;<span class="builtintype" id="2951470">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951483">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951554">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951594">r</span>&nbsp;<span class="op" id="2951596">:=</span>&nbsp;<span class="ident" id="2951599">unicode</span><span class="op" id="2951606">.</span><span class="ident" id="2951607">SimpleFold</span><span class="op" id="2951617">(</span><span class="ident" id="2951618">sr</span><span class="op" id="2951620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951624">for</span>&nbsp;<span class="ident" id="2951628">r</span>&nbsp;<span class="op" id="2951630">!=</span>&nbsp;<span class="ident" id="2951633">sr</span>&nbsp;<span class="op" id="2951636">&amp;&amp;</span>&nbsp;<span class="ident" id="2951639">r</span>&nbsp;<span class="op" id="2951641">&lt;</span>&nbsp;<span class="ident" id="2951643">tr</span>&nbsp;<span class="op" id="2951646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951651">r</span>&nbsp;<span class="op" id="2951653">=</span>&nbsp;<span class="ident" id="2951655">unicode</span><span class="op" id="2951662">.</span><span class="ident" id="2951663">SimpleFold</span><span class="op" id="2951673">(</span><span class="ident" id="2951674">r</span><span class="op" id="2951675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951683">if</span>&nbsp;<span class="ident" id="2951686">r</span>&nbsp;<span class="op" id="2951688">==</span>&nbsp;<span class="ident" id="2951691">tr</span>&nbsp;<span class="op" id="2951694">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951699">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951714">return</span>&nbsp;<span class="builtintype" id="2951721">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2951732">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951768">return</span>&nbsp;<span class="ident" id="2951775">s</span>&nbsp;<span class="op" id="2951777">==</span>&nbsp;<span class="ident" id="2951780">t</span><br>
<span class="lineno"></span><span class="op" id="2951782">}</span>
</div>
</body>
</html>
