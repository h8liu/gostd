<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5430616">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5430671">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5430725">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5430776">package</span>&nbsp;<span class="ident" id="5430784">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430790">import</span>&nbsp;<span class="op" id="5430797">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5430800">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5430809">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5430819">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5430828">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5430843">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5430848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5430851">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="5430895">func</span>&nbsp;<span class="ident" id="5430900">min</span><span class="op" id="5430903">(</span><span class="ident" id="5430904">x</span><span class="op" id="5430905">,</span>&nbsp;<span class="ident" id="5430907">y</span>&nbsp;<span class="builtintype" id="5430909">int</span><span class="op" id="5430912">)</span>&nbsp;<span class="builtintype" id="5430914">int</span>&nbsp;<span class="op" id="5430918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430921">if</span>&nbsp;<span class="ident" id="5430924"><a href="/image/jpeg/writer.go.html#5430904">x</a></span>&nbsp;<span class="op" id="5430926">&lt;</span>&nbsp;<span class="ident" id="5430928"><a href="/image/jpeg/writer.go.html#5430907">y</a></span>&nbsp;<span class="op" id="5430930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430934">return</span>&nbsp;<span class="ident" id="5430941"><a href="/image/jpeg/writer.go.html#5430904">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430944">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430947">return</span>&nbsp;<span class="ident" id="5430954"><a href="/image/jpeg/writer.go.html#5430907">y</a></span><br>
<span class="lineno"></span><span class="op" id="5430956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430959">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="5431038">func</span>&nbsp;<span class="ident" id="5431043">div</span><span class="op" id="5431046">(</span><span class="ident" id="5431047">a</span><span class="op" id="5431048">,</span>&nbsp;<span class="ident" id="5431050">b</span>&nbsp;<span class="builtintype" id="5431052">int32</span><span class="op" id="5431057">)</span>&nbsp;<span class="builtintype" id="5431059">int32</span>&nbsp;<span class="op" id="5431065">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431068">if</span>&nbsp;<span class="ident" id="5431071"><a href="/image/jpeg/writer.go.html#5431047">a</a></span>&nbsp;<span class="op" id="5431073">&gt;=</span>&nbsp;<span class="num" id="5431076">0</span>&nbsp;<span class="op" id="5431078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431082">return</span>&nbsp;<span class="op" id="5431089">(</span><span class="ident" id="5431090"><a href="/image/jpeg/writer.go.html#5431047">a</a></span>&nbsp;<span class="op" id="5431092">+</span>&nbsp;<span class="op" id="5431094">(</span><span class="ident" id="5431095"><a href="/image/jpeg/writer.go.html#5431050">b</a></span>&nbsp;<span class="op" id="5431097">&gt;&gt;</span>&nbsp;<span class="num" id="5431100">1</span><span class="op" id="5431101">)</span><span class="op" id="5431102">)</span>&nbsp;<span class="op" id="5431104">/</span>&nbsp;<span class="ident" id="5431106"><a href="/image/jpeg/writer.go.html#5431050">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431112">return</span>&nbsp;<span class="op" id="5431119">-</span><span class="op" id="5431120">(</span><span class="op" id="5431121">(</span><span class="op" id="5431122">-</span><span class="ident" id="5431123"><a href="/image/jpeg/writer.go.html#5431047">a</a></span>&nbsp;<span class="op" id="5431125">+</span>&nbsp;<span class="op" id="5431127">(</span><span class="ident" id="5431128"><a href="/image/jpeg/writer.go.html#5431050">b</a></span>&nbsp;<span class="op" id="5431130">&gt;&gt;</span>&nbsp;<span class="num" id="5431133">1</span><span class="op" id="5431134">)</span><span class="op" id="5431135">)</span>&nbsp;<span class="op" id="5431137">/</span>&nbsp;<span class="ident" id="5431139"><a href="/image/jpeg/writer.go.html#5431050">b</a></span><span class="op" id="5431140">)</span><br>
<span class="lineno"></span><span class="op" id="5431142">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5431145">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5431210">var</span>&nbsp;<span class="ident" id="5431214">bitCount</span>&nbsp;<span class="op" id="5431223">=</span>&nbsp;<span class="op" id="5431225">[</span><span class="num" id="5431226">256</span><span class="op" id="5431229">]</span><span class="builtintype" id="5431230">byte</span><span class="op" id="5431234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431237">0</span><span class="op" id="5431238">,</span>&nbsp;<span class="num" id="5431240">1</span><span class="op" id="5431241">,</span>&nbsp;<span class="num" id="5431243">2</span><span class="op" id="5431244">,</span>&nbsp;<span class="num" id="5431246">2</span><span class="op" id="5431247">,</span>&nbsp;<span class="num" id="5431249">3</span><span class="op" id="5431250">,</span>&nbsp;<span class="num" id="5431252">3</span><span class="op" id="5431253">,</span>&nbsp;<span class="num" id="5431255">3</span><span class="op" id="5431256">,</span>&nbsp;<span class="num" id="5431258">3</span><span class="op" id="5431259">,</span>&nbsp;<span class="num" id="5431261">4</span><span class="op" id="5431262">,</span>&nbsp;<span class="num" id="5431264">4</span><span class="op" id="5431265">,</span>&nbsp;<span class="num" id="5431267">4</span><span class="op" id="5431268">,</span>&nbsp;<span class="num" id="5431270">4</span><span class="op" id="5431271">,</span>&nbsp;<span class="num" id="5431273">4</span><span class="op" id="5431274">,</span>&nbsp;<span class="num" id="5431276">4</span><span class="op" id="5431277">,</span>&nbsp;<span class="num" id="5431279">4</span><span class="op" id="5431280">,</span>&nbsp;<span class="num" id="5431282">4</span><span class="op" id="5431283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431286">5</span><span class="op" id="5431287">,</span>&nbsp;<span class="num" id="5431289">5</span><span class="op" id="5431290">,</span>&nbsp;<span class="num" id="5431292">5</span><span class="op" id="5431293">,</span>&nbsp;<span class="num" id="5431295">5</span><span class="op" id="5431296">,</span>&nbsp;<span class="num" id="5431298">5</span><span class="op" id="5431299">,</span>&nbsp;<span class="num" id="5431301">5</span><span class="op" id="5431302">,</span>&nbsp;<span class="num" id="5431304">5</span><span class="op" id="5431305">,</span>&nbsp;<span class="num" id="5431307">5</span><span class="op" id="5431308">,</span>&nbsp;<span class="num" id="5431310">5</span><span class="op" id="5431311">,</span>&nbsp;<span class="num" id="5431313">5</span><span class="op" id="5431314">,</span>&nbsp;<span class="num" id="5431316">5</span><span class="op" id="5431317">,</span>&nbsp;<span class="num" id="5431319">5</span><span class="op" id="5431320">,</span>&nbsp;<span class="num" id="5431322">5</span><span class="op" id="5431323">,</span>&nbsp;<span class="num" id="5431325">5</span><span class="op" id="5431326">,</span>&nbsp;<span class="num" id="5431328">5</span><span class="op" id="5431329">,</span>&nbsp;<span class="num" id="5431331">5</span><span class="op" id="5431332">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431335">6</span><span class="op" id="5431336">,</span>&nbsp;<span class="num" id="5431338">6</span><span class="op" id="5431339">,</span>&nbsp;<span class="num" id="5431341">6</span><span class="op" id="5431342">,</span>&nbsp;<span class="num" id="5431344">6</span><span class="op" id="5431345">,</span>&nbsp;<span class="num" id="5431347">6</span><span class="op" id="5431348">,</span>&nbsp;<span class="num" id="5431350">6</span><span class="op" id="5431351">,</span>&nbsp;<span class="num" id="5431353">6</span><span class="op" id="5431354">,</span>&nbsp;<span class="num" id="5431356">6</span><span class="op" id="5431357">,</span>&nbsp;<span class="num" id="5431359">6</span><span class="op" id="5431360">,</span>&nbsp;<span class="num" id="5431362">6</span><span class="op" id="5431363">,</span>&nbsp;<span class="num" id="5431365">6</span><span class="op" id="5431366">,</span>&nbsp;<span class="num" id="5431368">6</span><span class="op" id="5431369">,</span>&nbsp;<span class="num" id="5431371">6</span><span class="op" id="5431372">,</span>&nbsp;<span class="num" id="5431374">6</span><span class="op" id="5431375">,</span>&nbsp;<span class="num" id="5431377">6</span><span class="op" id="5431378">,</span>&nbsp;<span class="num" id="5431380">6</span><span class="op" id="5431381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431384">6</span><span class="op" id="5431385">,</span>&nbsp;<span class="num" id="5431387">6</span><span class="op" id="5431388">,</span>&nbsp;<span class="num" id="5431390">6</span><span class="op" id="5431391">,</span>&nbsp;<span class="num" id="5431393">6</span><span class="op" id="5431394">,</span>&nbsp;<span class="num" id="5431396">6</span><span class="op" id="5431397">,</span>&nbsp;<span class="num" id="5431399">6</span><span class="op" id="5431400">,</span>&nbsp;<span class="num" id="5431402">6</span><span class="op" id="5431403">,</span>&nbsp;<span class="num" id="5431405">6</span><span class="op" id="5431406">,</span>&nbsp;<span class="num" id="5431408">6</span><span class="op" id="5431409">,</span>&nbsp;<span class="num" id="5431411">6</span><span class="op" id="5431412">,</span>&nbsp;<span class="num" id="5431414">6</span><span class="op" id="5431415">,</span>&nbsp;<span class="num" id="5431417">6</span><span class="op" id="5431418">,</span>&nbsp;<span class="num" id="5431420">6</span><span class="op" id="5431421">,</span>&nbsp;<span class="num" id="5431423">6</span><span class="op" id="5431424">,</span>&nbsp;<span class="num" id="5431426">6</span><span class="op" id="5431427">,</span>&nbsp;<span class="num" id="5431429">6</span><span class="op" id="5431430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431433">7</span><span class="op" id="5431434">,</span>&nbsp;<span class="num" id="5431436">7</span><span class="op" id="5431437">,</span>&nbsp;<span class="num" id="5431439">7</span><span class="op" id="5431440">,</span>&nbsp;<span class="num" id="5431442">7</span><span class="op" id="5431443">,</span>&nbsp;<span class="num" id="5431445">7</span><span class="op" id="5431446">,</span>&nbsp;<span class="num" id="5431448">7</span><span class="op" id="5431449">,</span>&nbsp;<span class="num" id="5431451">7</span><span class="op" id="5431452">,</span>&nbsp;<span class="num" id="5431454">7</span><span class="op" id="5431455">,</span>&nbsp;<span class="num" id="5431457">7</span><span class="op" id="5431458">,</span>&nbsp;<span class="num" id="5431460">7</span><span class="op" id="5431461">,</span>&nbsp;<span class="num" id="5431463">7</span><span class="op" id="5431464">,</span>&nbsp;<span class="num" id="5431466">7</span><span class="op" id="5431467">,</span>&nbsp;<span class="num" id="5431469">7</span><span class="op" id="5431470">,</span>&nbsp;<span class="num" id="5431472">7</span><span class="op" id="5431473">,</span>&nbsp;<span class="num" id="5431475">7</span><span class="op" id="5431476">,</span>&nbsp;<span class="num" id="5431478">7</span><span class="op" id="5431479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431482">7</span><span class="op" id="5431483">,</span>&nbsp;<span class="num" id="5431485">7</span><span class="op" id="5431486">,</span>&nbsp;<span class="num" id="5431488">7</span><span class="op" id="5431489">,</span>&nbsp;<span class="num" id="5431491">7</span><span class="op" id="5431492">,</span>&nbsp;<span class="num" id="5431494">7</span><span class="op" id="5431495">,</span>&nbsp;<span class="num" id="5431497">7</span><span class="op" id="5431498">,</span>&nbsp;<span class="num" id="5431500">7</span><span class="op" id="5431501">,</span>&nbsp;<span class="num" id="5431503">7</span><span class="op" id="5431504">,</span>&nbsp;<span class="num" id="5431506">7</span><span class="op" id="5431507">,</span>&nbsp;<span class="num" id="5431509">7</span><span class="op" id="5431510">,</span>&nbsp;<span class="num" id="5431512">7</span><span class="op" id="5431513">,</span>&nbsp;<span class="num" id="5431515">7</span><span class="op" id="5431516">,</span>&nbsp;<span class="num" id="5431518">7</span><span class="op" id="5431519">,</span>&nbsp;<span class="num" id="5431521">7</span><span class="op" id="5431522">,</span>&nbsp;<span class="num" id="5431524">7</span><span class="op" id="5431525">,</span>&nbsp;<span class="num" id="5431527">7</span><span class="op" id="5431528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431531">7</span><span class="op" id="5431532">,</span>&nbsp;<span class="num" id="5431534">7</span><span class="op" id="5431535">,</span>&nbsp;<span class="num" id="5431537">7</span><span class="op" id="5431538">,</span>&nbsp;<span class="num" id="5431540">7</span><span class="op" id="5431541">,</span>&nbsp;<span class="num" id="5431543">7</span><span class="op" id="5431544">,</span>&nbsp;<span class="num" id="5431546">7</span><span class="op" id="5431547">,</span>&nbsp;<span class="num" id="5431549">7</span><span class="op" id="5431550">,</span>&nbsp;<span class="num" id="5431552">7</span><span class="op" id="5431553">,</span>&nbsp;<span class="num" id="5431555">7</span><span class="op" id="5431556">,</span>&nbsp;<span class="num" id="5431558">7</span><span class="op" id="5431559">,</span>&nbsp;<span class="num" id="5431561">7</span><span class="op" id="5431562">,</span>&nbsp;<span class="num" id="5431564">7</span><span class="op" id="5431565">,</span>&nbsp;<span class="num" id="5431567">7</span><span class="op" id="5431568">,</span>&nbsp;<span class="num" id="5431570">7</span><span class="op" id="5431571">,</span>&nbsp;<span class="num" id="5431573">7</span><span class="op" id="5431574">,</span>&nbsp;<span class="num" id="5431576">7</span><span class="op" id="5431577">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431580">7</span><span class="op" id="5431581">,</span>&nbsp;<span class="num" id="5431583">7</span><span class="op" id="5431584">,</span>&nbsp;<span class="num" id="5431586">7</span><span class="op" id="5431587">,</span>&nbsp;<span class="num" id="5431589">7</span><span class="op" id="5431590">,</span>&nbsp;<span class="num" id="5431592">7</span><span class="op" id="5431593">,</span>&nbsp;<span class="num" id="5431595">7</span><span class="op" id="5431596">,</span>&nbsp;<span class="num" id="5431598">7</span><span class="op" id="5431599">,</span>&nbsp;<span class="num" id="5431601">7</span><span class="op" id="5431602">,</span>&nbsp;<span class="num" id="5431604">7</span><span class="op" id="5431605">,</span>&nbsp;<span class="num" id="5431607">7</span><span class="op" id="5431608">,</span>&nbsp;<span class="num" id="5431610">7</span><span class="op" id="5431611">,</span>&nbsp;<span class="num" id="5431613">7</span><span class="op" id="5431614">,</span>&nbsp;<span class="num" id="5431616">7</span><span class="op" id="5431617">,</span>&nbsp;<span class="num" id="5431619">7</span><span class="op" id="5431620">,</span>&nbsp;<span class="num" id="5431622">7</span><span class="op" id="5431623">,</span>&nbsp;<span class="num" id="5431625">7</span><span class="op" id="5431626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431629">8</span><span class="op" id="5431630">,</span>&nbsp;<span class="num" id="5431632">8</span><span class="op" id="5431633">,</span>&nbsp;<span class="num" id="5431635">8</span><span class="op" id="5431636">,</span>&nbsp;<span class="num" id="5431638">8</span><span class="op" id="5431639">,</span>&nbsp;<span class="num" id="5431641">8</span><span class="op" id="5431642">,</span>&nbsp;<span class="num" id="5431644">8</span><span class="op" id="5431645">,</span>&nbsp;<span class="num" id="5431647">8</span><span class="op" id="5431648">,</span>&nbsp;<span class="num" id="5431650">8</span><span class="op" id="5431651">,</span>&nbsp;<span class="num" id="5431653">8</span><span class="op" id="5431654">,</span>&nbsp;<span class="num" id="5431656">8</span><span class="op" id="5431657">,</span>&nbsp;<span class="num" id="5431659">8</span><span class="op" id="5431660">,</span>&nbsp;<span class="num" id="5431662">8</span><span class="op" id="5431663">,</span>&nbsp;<span class="num" id="5431665">8</span><span class="op" id="5431666">,</span>&nbsp;<span class="num" id="5431668">8</span><span class="op" id="5431669">,</span>&nbsp;<span class="num" id="5431671">8</span><span class="op" id="5431672">,</span>&nbsp;<span class="num" id="5431674">8</span><span class="op" id="5431675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431678">8</span><span class="op" id="5431679">,</span>&nbsp;<span class="num" id="5431681">8</span><span class="op" id="5431682">,</span>&nbsp;<span class="num" id="5431684">8</span><span class="op" id="5431685">,</span>&nbsp;<span class="num" id="5431687">8</span><span class="op" id="5431688">,</span>&nbsp;<span class="num" id="5431690">8</span><span class="op" id="5431691">,</span>&nbsp;<span class="num" id="5431693">8</span><span class="op" id="5431694">,</span>&nbsp;<span class="num" id="5431696">8</span><span class="op" id="5431697">,</span>&nbsp;<span class="num" id="5431699">8</span><span class="op" id="5431700">,</span>&nbsp;<span class="num" id="5431702">8</span><span class="op" id="5431703">,</span>&nbsp;<span class="num" id="5431705">8</span><span class="op" id="5431706">,</span>&nbsp;<span class="num" id="5431708">8</span><span class="op" id="5431709">,</span>&nbsp;<span class="num" id="5431711">8</span><span class="op" id="5431712">,</span>&nbsp;<span class="num" id="5431714">8</span><span class="op" id="5431715">,</span>&nbsp;<span class="num" id="5431717">8</span><span class="op" id="5431718">,</span>&nbsp;<span class="num" id="5431720">8</span><span class="op" id="5431721">,</span>&nbsp;<span class="num" id="5431723">8</span><span class="op" id="5431724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431727">8</span><span class="op" id="5431728">,</span>&nbsp;<span class="num" id="5431730">8</span><span class="op" id="5431731">,</span>&nbsp;<span class="num" id="5431733">8</span><span class="op" id="5431734">,</span>&nbsp;<span class="num" id="5431736">8</span><span class="op" id="5431737">,</span>&nbsp;<span class="num" id="5431739">8</span><span class="op" id="5431740">,</span>&nbsp;<span class="num" id="5431742">8</span><span class="op" id="5431743">,</span>&nbsp;<span class="num" id="5431745">8</span><span class="op" id="5431746">,</span>&nbsp;<span class="num" id="5431748">8</span><span class="op" id="5431749">,</span>&nbsp;<span class="num" id="5431751">8</span><span class="op" id="5431752">,</span>&nbsp;<span class="num" id="5431754">8</span><span class="op" id="5431755">,</span>&nbsp;<span class="num" id="5431757">8</span><span class="op" id="5431758">,</span>&nbsp;<span class="num" id="5431760">8</span><span class="op" id="5431761">,</span>&nbsp;<span class="num" id="5431763">8</span><span class="op" id="5431764">,</span>&nbsp;<span class="num" id="5431766">8</span><span class="op" id="5431767">,</span>&nbsp;<span class="num" id="5431769">8</span><span class="op" id="5431770">,</span>&nbsp;<span class="num" id="5431772">8</span><span class="op" id="5431773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431776">8</span><span class="op" id="5431777">,</span>&nbsp;<span class="num" id="5431779">8</span><span class="op" id="5431780">,</span>&nbsp;<span class="num" id="5431782">8</span><span class="op" id="5431783">,</span>&nbsp;<span class="num" id="5431785">8</span><span class="op" id="5431786">,</span>&nbsp;<span class="num" id="5431788">8</span><span class="op" id="5431789">,</span>&nbsp;<span class="num" id="5431791">8</span><span class="op" id="5431792">,</span>&nbsp;<span class="num" id="5431794">8</span><span class="op" id="5431795">,</span>&nbsp;<span class="num" id="5431797">8</span><span class="op" id="5431798">,</span>&nbsp;<span class="num" id="5431800">8</span><span class="op" id="5431801">,</span>&nbsp;<span class="num" id="5431803">8</span><span class="op" id="5431804">,</span>&nbsp;<span class="num" id="5431806">8</span><span class="op" id="5431807">,</span>&nbsp;<span class="num" id="5431809">8</span><span class="op" id="5431810">,</span>&nbsp;<span class="num" id="5431812">8</span><span class="op" id="5431813">,</span>&nbsp;<span class="num" id="5431815">8</span><span class="op" id="5431816">,</span>&nbsp;<span class="num" id="5431818">8</span><span class="op" id="5431819">,</span>&nbsp;<span class="num" id="5431821">8</span><span class="op" id="5431822">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431825">8</span><span class="op" id="5431826">,</span>&nbsp;<span class="num" id="5431828">8</span><span class="op" id="5431829">,</span>&nbsp;<span class="num" id="5431831">8</span><span class="op" id="5431832">,</span>&nbsp;<span class="num" id="5431834">8</span><span class="op" id="5431835">,</span>&nbsp;<span class="num" id="5431837">8</span><span class="op" id="5431838">,</span>&nbsp;<span class="num" id="5431840">8</span><span class="op" id="5431841">,</span>&nbsp;<span class="num" id="5431843">8</span><span class="op" id="5431844">,</span>&nbsp;<span class="num" id="5431846">8</span><span class="op" id="5431847">,</span>&nbsp;<span class="num" id="5431849">8</span><span class="op" id="5431850">,</span>&nbsp;<span class="num" id="5431852">8</span><span class="op" id="5431853">,</span>&nbsp;<span class="num" id="5431855">8</span><span class="op" id="5431856">,</span>&nbsp;<span class="num" id="5431858">8</span><span class="op" id="5431859">,</span>&nbsp;<span class="num" id="5431861">8</span><span class="op" id="5431862">,</span>&nbsp;<span class="num" id="5431864">8</span><span class="op" id="5431865">,</span>&nbsp;<span class="num" id="5431867">8</span><span class="op" id="5431868">,</span>&nbsp;<span class="num" id="5431870">8</span><span class="op" id="5431871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431874">8</span><span class="op" id="5431875">,</span>&nbsp;<span class="num" id="5431877">8</span><span class="op" id="5431878">,</span>&nbsp;<span class="num" id="5431880">8</span><span class="op" id="5431881">,</span>&nbsp;<span class="num" id="5431883">8</span><span class="op" id="5431884">,</span>&nbsp;<span class="num" id="5431886">8</span><span class="op" id="5431887">,</span>&nbsp;<span class="num" id="5431889">8</span><span class="op" id="5431890">,</span>&nbsp;<span class="num" id="5431892">8</span><span class="op" id="5431893">,</span>&nbsp;<span class="num" id="5431895">8</span><span class="op" id="5431896">,</span>&nbsp;<span class="num" id="5431898">8</span><span class="op" id="5431899">,</span>&nbsp;<span class="num" id="5431901">8</span><span class="op" id="5431902">,</span>&nbsp;<span class="num" id="5431904">8</span><span class="op" id="5431905">,</span>&nbsp;<span class="num" id="5431907">8</span><span class="op" id="5431908">,</span>&nbsp;<span class="num" id="5431910">8</span><span class="op" id="5431911">,</span>&nbsp;<span class="num" id="5431913">8</span><span class="op" id="5431914">,</span>&nbsp;<span class="num" id="5431916">8</span><span class="op" id="5431917">,</span>&nbsp;<span class="num" id="5431919">8</span><span class="op" id="5431920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431923">8</span><span class="op" id="5431924">,</span>&nbsp;<span class="num" id="5431926">8</span><span class="op" id="5431927">,</span>&nbsp;<span class="num" id="5431929">8</span><span class="op" id="5431930">,</span>&nbsp;<span class="num" id="5431932">8</span><span class="op" id="5431933">,</span>&nbsp;<span class="num" id="5431935">8</span><span class="op" id="5431936">,</span>&nbsp;<span class="num" id="5431938">8</span><span class="op" id="5431939">,</span>&nbsp;<span class="num" id="5431941">8</span><span class="op" id="5431942">,</span>&nbsp;<span class="num" id="5431944">8</span><span class="op" id="5431945">,</span>&nbsp;<span class="num" id="5431947">8</span><span class="op" id="5431948">,</span>&nbsp;<span class="num" id="5431950">8</span><span class="op" id="5431951">,</span>&nbsp;<span class="num" id="5431953">8</span><span class="op" id="5431954">,</span>&nbsp;<span class="num" id="5431956">8</span><span class="op" id="5431957">,</span>&nbsp;<span class="num" id="5431959">8</span><span class="op" id="5431960">,</span>&nbsp;<span class="num" id="5431962">8</span><span class="op" id="5431963">,</span>&nbsp;<span class="num" id="5431965">8</span><span class="op" id="5431966">,</span>&nbsp;<span class="num" id="5431968">8</span><span class="op" id="5431969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5431972">8</span><span class="op" id="5431973">,</span>&nbsp;<span class="num" id="5431975">8</span><span class="op" id="5431976">,</span>&nbsp;<span class="num" id="5431978">8</span><span class="op" id="5431979">,</span>&nbsp;<span class="num" id="5431981">8</span><span class="op" id="5431982">,</span>&nbsp;<span class="num" id="5431984">8</span><span class="op" id="5431985">,</span>&nbsp;<span class="num" id="5431987">8</span><span class="op" id="5431988">,</span>&nbsp;<span class="num" id="5431990">8</span><span class="op" id="5431991">,</span>&nbsp;<span class="num" id="5431993">8</span><span class="op" id="5431994">,</span>&nbsp;<span class="num" id="5431996">8</span><span class="op" id="5431997">,</span>&nbsp;<span class="num" id="5431999">8</span><span class="op" id="5432000">,</span>&nbsp;<span class="num" id="5432002">8</span><span class="op" id="5432003">,</span>&nbsp;<span class="num" id="5432005">8</span><span class="op" id="5432006">,</span>&nbsp;<span class="num" id="5432008">8</span><span class="op" id="5432009">,</span>&nbsp;<span class="num" id="5432011">8</span><span class="op" id="5432012">,</span>&nbsp;<span class="num" id="5432014">8</span><span class="op" id="5432015">,</span>&nbsp;<span class="num" id="5432017">8</span><span class="op" id="5432018">,</span><br>
<span class="lineno"></span><span class="op" id="5432020">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5432023">type</span>&nbsp;<span class="ident" id="5432028">quantIndex</span>&nbsp;<span class="builtintype" id="5432039">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5432044">const</span>&nbsp;<span class="op" id="5432050">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432053">quantIndexLuminance</span>&nbsp;<span class="ident" id="5432073"><a href="/image/jpeg/writer.go.html#5432028">quantIndex</a></span>&nbsp;<span class="op" id="5432084">=</span>&nbsp;<span class="ident" id="5432086">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432092">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432115">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="5432127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432130">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="5432207">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5432283">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5432359">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5432377">var</span>&nbsp;<span class="ident" id="5432381">unscaledQuant</span>&nbsp;<span class="op" id="5432395">=</span>&nbsp;<span class="op" id="5432397">[</span><span class="ident" id="5432398"><a href="/image/jpeg/writer.go.html#5432115">nQuantIndex</a></span><span class="op" id="5432409">]</span><span class="op" id="5432410">[</span><span class="ident" id="5432411"><a href="/image/jpeg/idct.go.html#5398910">blockSize</a></span><span class="op" id="5432420">]</span><span class="builtintype" id="5432421">byte</span><span class="op" id="5432425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5432428">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432447">16</span><span class="op" id="5432449">,</span>&nbsp;<span class="num" id="5432451">11</span><span class="op" id="5432453">,</span>&nbsp;<span class="num" id="5432455">12</span><span class="op" id="5432457">,</span>&nbsp;<span class="num" id="5432459">14</span><span class="op" id="5432461">,</span>&nbsp;<span class="num" id="5432463">12</span><span class="op" id="5432465">,</span>&nbsp;<span class="num" id="5432467">10</span><span class="op" id="5432469">,</span>&nbsp;<span class="num" id="5432471">16</span><span class="op" id="5432473">,</span>&nbsp;<span class="num" id="5432475">14</span><span class="op" id="5432477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432481">13</span><span class="op" id="5432483">,</span>&nbsp;<span class="num" id="5432485">14</span><span class="op" id="5432487">,</span>&nbsp;<span class="num" id="5432489">18</span><span class="op" id="5432491">,</span>&nbsp;<span class="num" id="5432493">17</span><span class="op" id="5432495">,</span>&nbsp;<span class="num" id="5432497">16</span><span class="op" id="5432499">,</span>&nbsp;<span class="num" id="5432501">19</span><span class="op" id="5432503">,</span>&nbsp;<span class="num" id="5432505">24</span><span class="op" id="5432507">,</span>&nbsp;<span class="num" id="5432509">40</span><span class="op" id="5432511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432515">26</span><span class="op" id="5432517">,</span>&nbsp;<span class="num" id="5432519">24</span><span class="op" id="5432521">,</span>&nbsp;<span class="num" id="5432523">22</span><span class="op" id="5432525">,</span>&nbsp;<span class="num" id="5432527">22</span><span class="op" id="5432529">,</span>&nbsp;<span class="num" id="5432531">24</span><span class="op" id="5432533">,</span>&nbsp;<span class="num" id="5432535">49</span><span class="op" id="5432537">,</span>&nbsp;<span class="num" id="5432539">35</span><span class="op" id="5432541">,</span>&nbsp;<span class="num" id="5432543">37</span><span class="op" id="5432545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432549">29</span><span class="op" id="5432551">,</span>&nbsp;<span class="num" id="5432553">40</span><span class="op" id="5432555">,</span>&nbsp;<span class="num" id="5432557">58</span><span class="op" id="5432559">,</span>&nbsp;<span class="num" id="5432561">51</span><span class="op" id="5432563">,</span>&nbsp;<span class="num" id="5432565">61</span><span class="op" id="5432567">,</span>&nbsp;<span class="num" id="5432569">60</span><span class="op" id="5432571">,</span>&nbsp;<span class="num" id="5432573">57</span><span class="op" id="5432575">,</span>&nbsp;<span class="num" id="5432577">51</span><span class="op" id="5432579">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432583">56</span><span class="op" id="5432585">,</span>&nbsp;<span class="num" id="5432587">55</span><span class="op" id="5432589">,</span>&nbsp;<span class="num" id="5432591">64</span><span class="op" id="5432593">,</span>&nbsp;<span class="num" id="5432595">72</span><span class="op" id="5432597">,</span>&nbsp;<span class="num" id="5432599">92</span><span class="op" id="5432601">,</span>&nbsp;<span class="num" id="5432603">78</span><span class="op" id="5432605">,</span>&nbsp;<span class="num" id="5432607">64</span><span class="op" id="5432609">,</span>&nbsp;<span class="num" id="5432611">68</span><span class="op" id="5432613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432617">87</span><span class="op" id="5432619">,</span>&nbsp;<span class="num" id="5432621">69</span><span class="op" id="5432623">,</span>&nbsp;<span class="num" id="5432625">55</span><span class="op" id="5432627">,</span>&nbsp;<span class="num" id="5432629">56</span><span class="op" id="5432631">,</span>&nbsp;<span class="num" id="5432633">80</span><span class="op" id="5432635">,</span>&nbsp;<span class="num" id="5432637">109</span><span class="op" id="5432640">,</span>&nbsp;<span class="num" id="5432642">81</span><span class="op" id="5432644">,</span>&nbsp;<span class="num" id="5432646">87</span><span class="op" id="5432648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432652">95</span><span class="op" id="5432654">,</span>&nbsp;<span class="num" id="5432656">98</span><span class="op" id="5432658">,</span>&nbsp;<span class="num" id="5432660">103</span><span class="op" id="5432663">,</span>&nbsp;<span class="num" id="5432665">104</span><span class="op" id="5432668">,</span>&nbsp;<span class="num" id="5432670">103</span><span class="op" id="5432673">,</span>&nbsp;<span class="num" id="5432675">62</span><span class="op" id="5432677">,</span>&nbsp;<span class="num" id="5432679">77</span><span class="op" id="5432681">,</span>&nbsp;<span class="num" id="5432683">113</span><span class="op" id="5432686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432690">121</span><span class="op" id="5432693">,</span>&nbsp;<span class="num" id="5432695">112</span><span class="op" id="5432698">,</span>&nbsp;<span class="num" id="5432700">100</span><span class="op" id="5432703">,</span>&nbsp;<span class="num" id="5432705">120</span><span class="op" id="5432708">,</span>&nbsp;<span class="num" id="5432710">92</span><span class="op" id="5432712">,</span>&nbsp;<span class="num" id="5432714">101</span><span class="op" id="5432717">,</span>&nbsp;<span class="num" id="5432719">103</span><span class="op" id="5432722">,</span>&nbsp;<span class="num" id="5432724">99</span><span class="op" id="5432726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432729">}</span><span class="op" id="5432730">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5432733">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432754">17</span><span class="op" id="5432756">,</span>&nbsp;<span class="num" id="5432758">18</span><span class="op" id="5432760">,</span>&nbsp;<span class="num" id="5432762">18</span><span class="op" id="5432764">,</span>&nbsp;<span class="num" id="5432766">24</span><span class="op" id="5432768">,</span>&nbsp;<span class="num" id="5432770">21</span><span class="op" id="5432772">,</span>&nbsp;<span class="num" id="5432774">24</span><span class="op" id="5432776">,</span>&nbsp;<span class="num" id="5432778">47</span><span class="op" id="5432780">,</span>&nbsp;<span class="num" id="5432782">26</span><span class="op" id="5432784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432788">26</span><span class="op" id="5432790">,</span>&nbsp;<span class="num" id="5432792">47</span><span class="op" id="5432794">,</span>&nbsp;<span class="num" id="5432796">99</span><span class="op" id="5432798">,</span>&nbsp;<span class="num" id="5432800">66</span><span class="op" id="5432802">,</span>&nbsp;<span class="num" id="5432804">56</span><span class="op" id="5432806">,</span>&nbsp;<span class="num" id="5432808">66</span><span class="op" id="5432810">,</span>&nbsp;<span class="num" id="5432812">99</span><span class="op" id="5432814">,</span>&nbsp;<span class="num" id="5432816">99</span><span class="op" id="5432818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432822">99</span><span class="op" id="5432824">,</span>&nbsp;<span class="num" id="5432826">99</span><span class="op" id="5432828">,</span>&nbsp;<span class="num" id="5432830">99</span><span class="op" id="5432832">,</span>&nbsp;<span class="num" id="5432834">99</span><span class="op" id="5432836">,</span>&nbsp;<span class="num" id="5432838">99</span><span class="op" id="5432840">,</span>&nbsp;<span class="num" id="5432842">99</span><span class="op" id="5432844">,</span>&nbsp;<span class="num" id="5432846">99</span><span class="op" id="5432848">,</span>&nbsp;<span class="num" id="5432850">99</span><span class="op" id="5432852">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432856">99</span><span class="op" id="5432858">,</span>&nbsp;<span class="num" id="5432860">99</span><span class="op" id="5432862">,</span>&nbsp;<span class="num" id="5432864">99</span><span class="op" id="5432866">,</span>&nbsp;<span class="num" id="5432868">99</span><span class="op" id="5432870">,</span>&nbsp;<span class="num" id="5432872">99</span><span class="op" id="5432874">,</span>&nbsp;<span class="num" id="5432876">99</span><span class="op" id="5432878">,</span>&nbsp;<span class="num" id="5432880">99</span><span class="op" id="5432882">,</span>&nbsp;<span class="num" id="5432884">99</span><span class="op" id="5432886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432890">99</span><span class="op" id="5432892">,</span>&nbsp;<span class="num" id="5432894">99</span><span class="op" id="5432896">,</span>&nbsp;<span class="num" id="5432898">99</span><span class="op" id="5432900">,</span>&nbsp;<span class="num" id="5432902">99</span><span class="op" id="5432904">,</span>&nbsp;<span class="num" id="5432906">99</span><span class="op" id="5432908">,</span>&nbsp;<span class="num" id="5432910">99</span><span class="op" id="5432912">,</span>&nbsp;<span class="num" id="5432914">99</span><span class="op" id="5432916">,</span>&nbsp;<span class="num" id="5432918">99</span><span class="op" id="5432920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432924">99</span><span class="op" id="5432926">,</span>&nbsp;<span class="num" id="5432928">99</span><span class="op" id="5432930">,</span>&nbsp;<span class="num" id="5432932">99</span><span class="op" id="5432934">,</span>&nbsp;<span class="num" id="5432936">99</span><span class="op" id="5432938">,</span>&nbsp;<span class="num" id="5432940">99</span><span class="op" id="5432942">,</span>&nbsp;<span class="num" id="5432944">99</span><span class="op" id="5432946">,</span>&nbsp;<span class="num" id="5432948">99</span><span class="op" id="5432950">,</span>&nbsp;<span class="num" id="5432952">99</span><span class="op" id="5432954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432958">99</span><span class="op" id="5432960">,</span>&nbsp;<span class="num" id="5432962">99</span><span class="op" id="5432964">,</span>&nbsp;<span class="num" id="5432966">99</span><span class="op" id="5432968">,</span>&nbsp;<span class="num" id="5432970">99</span><span class="op" id="5432972">,</span>&nbsp;<span class="num" id="5432974">99</span><span class="op" id="5432976">,</span>&nbsp;<span class="num" id="5432978">99</span><span class="op" id="5432980">,</span>&nbsp;<span class="num" id="5432982">99</span><span class="op" id="5432984">,</span>&nbsp;<span class="num" id="5432986">99</span><span class="op" id="5432988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5432992">99</span><span class="op" id="5432994">,</span>&nbsp;<span class="num" id="5432996">99</span><span class="op" id="5432998">,</span>&nbsp;<span class="num" id="5433000">99</span><span class="op" id="5433002">,</span>&nbsp;<span class="num" id="5433004">99</span><span class="op" id="5433006">,</span>&nbsp;<span class="num" id="5433008">99</span><span class="op" id="5433010">,</span>&nbsp;<span class="num" id="5433012">99</span><span class="op" id="5433014">,</span>&nbsp;<span class="num" id="5433016">99</span><span class="op" id="5433018">,</span>&nbsp;<span class="num" id="5433020">99</span><span class="op" id="5433022">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433025">}</span><span class="op" id="5433026">,</span><br>
<span class="lineno"></span><span class="op" id="5433028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5433031">type</span>&nbsp;<span class="ident" id="5433036">huffIndex</span>&nbsp;<span class="builtintype" id="5433046">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="5433051">const</span>&nbsp;<span class="op" id="5433057">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433060">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="5433081"><a href="/image/jpeg/writer.go.html#5433036">huffIndex</a></span>&nbsp;<span class="op" id="5433091">=</span>&nbsp;<span class="ident" id="5433093">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433099">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433121">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433145">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433169">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="5433180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5433183">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5433228">type</span>&nbsp;<span class="ident" id="5433233">huffmanSpec</span>&nbsp;<span class="keyword" id="5433245">struct</span>&nbsp;<span class="op" id="5433252">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433255">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433309">count</span>&nbsp;<span class="op" id="5433315">[</span><span class="num" id="5433316">16</span><span class="op" id="5433318">]</span><span class="builtintype" id="5433319">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433325">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433381">value</span>&nbsp;<span class="op" id="5433387">[</span><span class="op" id="5433388">]</span><span class="builtintype" id="5433389">byte</span><br>
<span class="lineno"></span><span class="op" id="5433394">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5433397">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="5433455">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5433518">var</span>&nbsp;<span class="ident" id="5433522">theHuffmanSpec</span>&nbsp;<span class="op" id="5433537">=</span>&nbsp;<span class="op" id="5433539">[</span><span class="ident" id="5433540"><a href="/image/jpeg/writer.go.html#5433169">nHuffIndex</a></span><span class="op" id="5433550">]</span><span class="ident" id="5433551"><a href="/image/jpeg/writer.go.html#5433233">huffmanSpec</a></span><span class="op" id="5433562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433565">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433587">[</span><span class="num" id="5433588">16</span><span class="op" id="5433590">]</span><span class="builtintype" id="5433591">byte</span><span class="op" id="5433595">{</span><span class="num" id="5433596">0</span><span class="op" id="5433597">,</span>&nbsp;<span class="num" id="5433599">1</span><span class="op" id="5433600">,</span>&nbsp;<span class="num" id="5433602">5</span><span class="op" id="5433603">,</span>&nbsp;<span class="num" id="5433605">1</span><span class="op" id="5433606">,</span>&nbsp;<span class="num" id="5433608">1</span><span class="op" id="5433609">,</span>&nbsp;<span class="num" id="5433611">1</span><span class="op" id="5433612">,</span>&nbsp;<span class="num" id="5433614">1</span><span class="op" id="5433615">,</span>&nbsp;<span class="num" id="5433617">1</span><span class="op" id="5433618">,</span>&nbsp;<span class="num" id="5433620">1</span><span class="op" id="5433621">,</span>&nbsp;<span class="num" id="5433623">0</span><span class="op" id="5433624">,</span>&nbsp;<span class="num" id="5433626">0</span><span class="op" id="5433627">,</span>&nbsp;<span class="num" id="5433629">0</span><span class="op" id="5433630">,</span>&nbsp;<span class="num" id="5433632">0</span><span class="op" id="5433633">,</span>&nbsp;<span class="num" id="5433635">0</span><span class="op" id="5433636">,</span>&nbsp;<span class="num" id="5433638">0</span><span class="op" id="5433639">,</span>&nbsp;<span class="num" id="5433641">0</span><span class="op" id="5433642">}</span><span class="op" id="5433643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433647">[</span><span class="op" id="5433648">]</span><span class="builtintype" id="5433649">byte</span><span class="op" id="5433653">{</span><span class="num" id="5433654">0</span><span class="op" id="5433655">,</span>&nbsp;<span class="num" id="5433657">1</span><span class="op" id="5433658">,</span>&nbsp;<span class="num" id="5433660">2</span><span class="op" id="5433661">,</span>&nbsp;<span class="num" id="5433663">3</span><span class="op" id="5433664">,</span>&nbsp;<span class="num" id="5433666">4</span><span class="op" id="5433667">,</span>&nbsp;<span class="num" id="5433669">5</span><span class="op" id="5433670">,</span>&nbsp;<span class="num" id="5433672">6</span><span class="op" id="5433673">,</span>&nbsp;<span class="num" id="5433675">7</span><span class="op" id="5433676">,</span>&nbsp;<span class="num" id="5433678">8</span><span class="op" id="5433679">,</span>&nbsp;<span class="num" id="5433681">9</span><span class="op" id="5433682">,</span>&nbsp;<span class="num" id="5433684">10</span><span class="op" id="5433686">,</span>&nbsp;<span class="num" id="5433688">11</span><span class="op" id="5433690">}</span><span class="op" id="5433691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433694">}</span><span class="op" id="5433695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433698">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433720">[</span><span class="num" id="5433721">16</span><span class="op" id="5433723">]</span><span class="builtintype" id="5433724">byte</span><span class="op" id="5433728">{</span><span class="num" id="5433729">0</span><span class="op" id="5433730">,</span>&nbsp;<span class="num" id="5433732">2</span><span class="op" id="5433733">,</span>&nbsp;<span class="num" id="5433735">1</span><span class="op" id="5433736">,</span>&nbsp;<span class="num" id="5433738">3</span><span class="op" id="5433739">,</span>&nbsp;<span class="num" id="5433741">3</span><span class="op" id="5433742">,</span>&nbsp;<span class="num" id="5433744">2</span><span class="op" id="5433745">,</span>&nbsp;<span class="num" id="5433747">4</span><span class="op" id="5433748">,</span>&nbsp;<span class="num" id="5433750">3</span><span class="op" id="5433751">,</span>&nbsp;<span class="num" id="5433753">5</span><span class="op" id="5433754">,</span>&nbsp;<span class="num" id="5433756">5</span><span class="op" id="5433757">,</span>&nbsp;<span class="num" id="5433759">4</span><span class="op" id="5433760">,</span>&nbsp;<span class="num" id="5433762">4</span><span class="op" id="5433763">,</span>&nbsp;<span class="num" id="5433765">0</span><span class="op" id="5433766">,</span>&nbsp;<span class="num" id="5433768">0</span><span class="op" id="5433769">,</span>&nbsp;<span class="num" id="5433771">1</span><span class="op" id="5433772">,</span>&nbsp;<span class="num" id="5433774">125</span><span class="op" id="5433777">}</span><span class="op" id="5433778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433782">[</span><span class="op" id="5433783">]</span><span class="builtintype" id="5433784">byte</span><span class="op" id="5433788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5433793">0x01</span><span class="op" id="5433797">,</span>&nbsp;<span class="num" id="5433799">0x02</span><span class="op" id="5433803">,</span>&nbsp;<span class="num" id="5433805">0x03</span><span class="op" id="5433809">,</span>&nbsp;<span class="num" id="5433811">0x00</span><span class="op" id="5433815">,</span>&nbsp;<span class="num" id="5433817">0x04</span><span class="op" id="5433821">,</span>&nbsp;<span class="num" id="5433823">0x11</span><span class="op" id="5433827">,</span>&nbsp;<span class="num" id="5433829">0x05</span><span class="op" id="5433833">,</span>&nbsp;<span class="num" id="5433835">0x12</span><span class="op" id="5433839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5433844">0x21</span><span class="op" id="5433848">,</span>&nbsp;<span class="num" id="5433850">0x31</span><span class="op" id="5433854">,</span>&nbsp;<span class="num" id="5433856">0x41</span><span class="op" id="5433860">,</span>&nbsp;<span class="num" id="5433862">0x06</span><span class="op" id="5433866">,</span>&nbsp;<span class="num" id="5433868">0x13</span><span class="op" id="5433872">,</span>&nbsp;<span class="num" id="5433874">0x51</span><span class="op" id="5433878">,</span>&nbsp;<span class="num" id="5433880">0x61</span><span class="op" id="5433884">,</span>&nbsp;<span class="num" id="5433886">0x07</span><span class="op" id="5433890">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5433895">0x22</span><span class="op" id="5433899">,</span>&nbsp;<span class="num" id="5433901">0x71</span><span class="op" id="5433905">,</span>&nbsp;<span class="num" id="5433907">0x14</span><span class="op" id="5433911">,</span>&nbsp;<span class="num" id="5433913">0x32</span><span class="op" id="5433917">,</span>&nbsp;<span class="num" id="5433919">0x81</span><span class="op" id="5433923">,</span>&nbsp;<span class="num" id="5433925">0x91</span><span class="op" id="5433929">,</span>&nbsp;<span class="num" id="5433931">0xa1</span><span class="op" id="5433935">,</span>&nbsp;<span class="num" id="5433937">0x08</span><span class="op" id="5433941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5433946">0x23</span><span class="op" id="5433950">,</span>&nbsp;<span class="num" id="5433952">0x42</span><span class="op" id="5433956">,</span>&nbsp;<span class="num" id="5433958">0xb1</span><span class="op" id="5433962">,</span>&nbsp;<span class="num" id="5433964">0xc1</span><span class="op" id="5433968">,</span>&nbsp;<span class="num" id="5433970">0x15</span><span class="op" id="5433974">,</span>&nbsp;<span class="num" id="5433976">0x52</span><span class="op" id="5433980">,</span>&nbsp;<span class="num" id="5433982">0xd1</span><span class="op" id="5433986">,</span>&nbsp;<span class="num" id="5433988">0xf0</span><span class="op" id="5433992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5433997">0x24</span><span class="op" id="5434001">,</span>&nbsp;<span class="num" id="5434003">0x33</span><span class="op" id="5434007">,</span>&nbsp;<span class="num" id="5434009">0x62</span><span class="op" id="5434013">,</span>&nbsp;<span class="num" id="5434015">0x72</span><span class="op" id="5434019">,</span>&nbsp;<span class="num" id="5434021">0x82</span><span class="op" id="5434025">,</span>&nbsp;<span class="num" id="5434027">0x09</span><span class="op" id="5434031">,</span>&nbsp;<span class="num" id="5434033">0x0a</span><span class="op" id="5434037">,</span>&nbsp;<span class="num" id="5434039">0x16</span><span class="op" id="5434043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434048">0x17</span><span class="op" id="5434052">,</span>&nbsp;<span class="num" id="5434054">0x18</span><span class="op" id="5434058">,</span>&nbsp;<span class="num" id="5434060">0x19</span><span class="op" id="5434064">,</span>&nbsp;<span class="num" id="5434066">0x1a</span><span class="op" id="5434070">,</span>&nbsp;<span class="num" id="5434072">0x25</span><span class="op" id="5434076">,</span>&nbsp;<span class="num" id="5434078">0x26</span><span class="op" id="5434082">,</span>&nbsp;<span class="num" id="5434084">0x27</span><span class="op" id="5434088">,</span>&nbsp;<span class="num" id="5434090">0x28</span><span class="op" id="5434094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434099">0x29</span><span class="op" id="5434103">,</span>&nbsp;<span class="num" id="5434105">0x2a</span><span class="op" id="5434109">,</span>&nbsp;<span class="num" id="5434111">0x34</span><span class="op" id="5434115">,</span>&nbsp;<span class="num" id="5434117">0x35</span><span class="op" id="5434121">,</span>&nbsp;<span class="num" id="5434123">0x36</span><span class="op" id="5434127">,</span>&nbsp;<span class="num" id="5434129">0x37</span><span class="op" id="5434133">,</span>&nbsp;<span class="num" id="5434135">0x38</span><span class="op" id="5434139">,</span>&nbsp;<span class="num" id="5434141">0x39</span><span class="op" id="5434145">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434150">0x3a</span><span class="op" id="5434154">,</span>&nbsp;<span class="num" id="5434156">0x43</span><span class="op" id="5434160">,</span>&nbsp;<span class="num" id="5434162">0x44</span><span class="op" id="5434166">,</span>&nbsp;<span class="num" id="5434168">0x45</span><span class="op" id="5434172">,</span>&nbsp;<span class="num" id="5434174">0x46</span><span class="op" id="5434178">,</span>&nbsp;<span class="num" id="5434180">0x47</span><span class="op" id="5434184">,</span>&nbsp;<span class="num" id="5434186">0x48</span><span class="op" id="5434190">,</span>&nbsp;<span class="num" id="5434192">0x49</span><span class="op" id="5434196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434201">0x4a</span><span class="op" id="5434205">,</span>&nbsp;<span class="num" id="5434207">0x53</span><span class="op" id="5434211">,</span>&nbsp;<span class="num" id="5434213">0x54</span><span class="op" id="5434217">,</span>&nbsp;<span class="num" id="5434219">0x55</span><span class="op" id="5434223">,</span>&nbsp;<span class="num" id="5434225">0x56</span><span class="op" id="5434229">,</span>&nbsp;<span class="num" id="5434231">0x57</span><span class="op" id="5434235">,</span>&nbsp;<span class="num" id="5434237">0x58</span><span class="op" id="5434241">,</span>&nbsp;<span class="num" id="5434243">0x59</span><span class="op" id="5434247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434252">0x5a</span><span class="op" id="5434256">,</span>&nbsp;<span class="num" id="5434258">0x63</span><span class="op" id="5434262">,</span>&nbsp;<span class="num" id="5434264">0x64</span><span class="op" id="5434268">,</span>&nbsp;<span class="num" id="5434270">0x65</span><span class="op" id="5434274">,</span>&nbsp;<span class="num" id="5434276">0x66</span><span class="op" id="5434280">,</span>&nbsp;<span class="num" id="5434282">0x67</span><span class="op" id="5434286">,</span>&nbsp;<span class="num" id="5434288">0x68</span><span class="op" id="5434292">,</span>&nbsp;<span class="num" id="5434294">0x69</span><span class="op" id="5434298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434303">0x6a</span><span class="op" id="5434307">,</span>&nbsp;<span class="num" id="5434309">0x73</span><span class="op" id="5434313">,</span>&nbsp;<span class="num" id="5434315">0x74</span><span class="op" id="5434319">,</span>&nbsp;<span class="num" id="5434321">0x75</span><span class="op" id="5434325">,</span>&nbsp;<span class="num" id="5434327">0x76</span><span class="op" id="5434331">,</span>&nbsp;<span class="num" id="5434333">0x77</span><span class="op" id="5434337">,</span>&nbsp;<span class="num" id="5434339">0x78</span><span class="op" id="5434343">,</span>&nbsp;<span class="num" id="5434345">0x79</span><span class="op" id="5434349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434354">0x7a</span><span class="op" id="5434358">,</span>&nbsp;<span class="num" id="5434360">0x83</span><span class="op" id="5434364">,</span>&nbsp;<span class="num" id="5434366">0x84</span><span class="op" id="5434370">,</span>&nbsp;<span class="num" id="5434372">0x85</span><span class="op" id="5434376">,</span>&nbsp;<span class="num" id="5434378">0x86</span><span class="op" id="5434382">,</span>&nbsp;<span class="num" id="5434384">0x87</span><span class="op" id="5434388">,</span>&nbsp;<span class="num" id="5434390">0x88</span><span class="op" id="5434394">,</span>&nbsp;<span class="num" id="5434396">0x89</span><span class="op" id="5434400">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434405">0x8a</span><span class="op" id="5434409">,</span>&nbsp;<span class="num" id="5434411">0x92</span><span class="op" id="5434415">,</span>&nbsp;<span class="num" id="5434417">0x93</span><span class="op" id="5434421">,</span>&nbsp;<span class="num" id="5434423">0x94</span><span class="op" id="5434427">,</span>&nbsp;<span class="num" id="5434429">0x95</span><span class="op" id="5434433">,</span>&nbsp;<span class="num" id="5434435">0x96</span><span class="op" id="5434439">,</span>&nbsp;<span class="num" id="5434441">0x97</span><span class="op" id="5434445">,</span>&nbsp;<span class="num" id="5434447">0x98</span><span class="op" id="5434451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434456">0x99</span><span class="op" id="5434460">,</span>&nbsp;<span class="num" id="5434462">0x9a</span><span class="op" id="5434466">,</span>&nbsp;<span class="num" id="5434468">0xa2</span><span class="op" id="5434472">,</span>&nbsp;<span class="num" id="5434474">0xa3</span><span class="op" id="5434478">,</span>&nbsp;<span class="num" id="5434480">0xa4</span><span class="op" id="5434484">,</span>&nbsp;<span class="num" id="5434486">0xa5</span><span class="op" id="5434490">,</span>&nbsp;<span class="num" id="5434492">0xa6</span><span class="op" id="5434496">,</span>&nbsp;<span class="num" id="5434498">0xa7</span><span class="op" id="5434502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434507">0xa8</span><span class="op" id="5434511">,</span>&nbsp;<span class="num" id="5434513">0xa9</span><span class="op" id="5434517">,</span>&nbsp;<span class="num" id="5434519">0xaa</span><span class="op" id="5434523">,</span>&nbsp;<span class="num" id="5434525">0xb2</span><span class="op" id="5434529">,</span>&nbsp;<span class="num" id="5434531">0xb3</span><span class="op" id="5434535">,</span>&nbsp;<span class="num" id="5434537">0xb4</span><span class="op" id="5434541">,</span>&nbsp;<span class="num" id="5434543">0xb5</span><span class="op" id="5434547">,</span>&nbsp;<span class="num" id="5434549">0xb6</span><span class="op" id="5434553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434558">0xb7</span><span class="op" id="5434562">,</span>&nbsp;<span class="num" id="5434564">0xb8</span><span class="op" id="5434568">,</span>&nbsp;<span class="num" id="5434570">0xb9</span><span class="op" id="5434574">,</span>&nbsp;<span class="num" id="5434576">0xba</span><span class="op" id="5434580">,</span>&nbsp;<span class="num" id="5434582">0xc2</span><span class="op" id="5434586">,</span>&nbsp;<span class="num" id="5434588">0xc3</span><span class="op" id="5434592">,</span>&nbsp;<span class="num" id="5434594">0xc4</span><span class="op" id="5434598">,</span>&nbsp;<span class="num" id="5434600">0xc5</span><span class="op" id="5434604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434609">0xc6</span><span class="op" id="5434613">,</span>&nbsp;<span class="num" id="5434615">0xc7</span><span class="op" id="5434619">,</span>&nbsp;<span class="num" id="5434621">0xc8</span><span class="op" id="5434625">,</span>&nbsp;<span class="num" id="5434627">0xc9</span><span class="op" id="5434631">,</span>&nbsp;<span class="num" id="5434633">0xca</span><span class="op" id="5434637">,</span>&nbsp;<span class="num" id="5434639">0xd2</span><span class="op" id="5434643">,</span>&nbsp;<span class="num" id="5434645">0xd3</span><span class="op" id="5434649">,</span>&nbsp;<span class="num" id="5434651">0xd4</span><span class="op" id="5434655">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434660">0xd5</span><span class="op" id="5434664">,</span>&nbsp;<span class="num" id="5434666">0xd6</span><span class="op" id="5434670">,</span>&nbsp;<span class="num" id="5434672">0xd7</span><span class="op" id="5434676">,</span>&nbsp;<span class="num" id="5434678">0xd8</span><span class="op" id="5434682">,</span>&nbsp;<span class="num" id="5434684">0xd9</span><span class="op" id="5434688">,</span>&nbsp;<span class="num" id="5434690">0xda</span><span class="op" id="5434694">,</span>&nbsp;<span class="num" id="5434696">0xe1</span><span class="op" id="5434700">,</span>&nbsp;<span class="num" id="5434702">0xe2</span><span class="op" id="5434706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434711">0xe3</span><span class="op" id="5434715">,</span>&nbsp;<span class="num" id="5434717">0xe4</span><span class="op" id="5434721">,</span>&nbsp;<span class="num" id="5434723">0xe5</span><span class="op" id="5434727">,</span>&nbsp;<span class="num" id="5434729">0xe6</span><span class="op" id="5434733">,</span>&nbsp;<span class="num" id="5434735">0xe7</span><span class="op" id="5434739">,</span>&nbsp;<span class="num" id="5434741">0xe8</span><span class="op" id="5434745">,</span>&nbsp;<span class="num" id="5434747">0xe9</span><span class="op" id="5434751">,</span>&nbsp;<span class="num" id="5434753">0xea</span><span class="op" id="5434757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434762">0xf1</span><span class="op" id="5434766">,</span>&nbsp;<span class="num" id="5434768">0xf2</span><span class="op" id="5434772">,</span>&nbsp;<span class="num" id="5434774">0xf3</span><span class="op" id="5434778">,</span>&nbsp;<span class="num" id="5434780">0xf4</span><span class="op" id="5434784">,</span>&nbsp;<span class="num" id="5434786">0xf5</span><span class="op" id="5434790">,</span>&nbsp;<span class="num" id="5434792">0xf6</span><span class="op" id="5434796">,</span>&nbsp;<span class="num" id="5434798">0xf7</span><span class="op" id="5434802">,</span>&nbsp;<span class="num" id="5434804">0xf8</span><span class="op" id="5434808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5434813">0xf9</span><span class="op" id="5434817">,</span>&nbsp;<span class="num" id="5434819">0xfa</span><span class="op" id="5434823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434827">}</span><span class="op" id="5434828">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434831">}</span><span class="op" id="5434832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5434835">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434859">[</span><span class="num" id="5434860">16</span><span class="op" id="5434862">]</span><span class="builtintype" id="5434863">byte</span><span class="op" id="5434867">{</span><span class="num" id="5434868">0</span><span class="op" id="5434869">,</span>&nbsp;<span class="num" id="5434871">3</span><span class="op" id="5434872">,</span>&nbsp;<span class="num" id="5434874">1</span><span class="op" id="5434875">,</span>&nbsp;<span class="num" id="5434877">1</span><span class="op" id="5434878">,</span>&nbsp;<span class="num" id="5434880">1</span><span class="op" id="5434881">,</span>&nbsp;<span class="num" id="5434883">1</span><span class="op" id="5434884">,</span>&nbsp;<span class="num" id="5434886">1</span><span class="op" id="5434887">,</span>&nbsp;<span class="num" id="5434889">1</span><span class="op" id="5434890">,</span>&nbsp;<span class="num" id="5434892">1</span><span class="op" id="5434893">,</span>&nbsp;<span class="num" id="5434895">1</span><span class="op" id="5434896">,</span>&nbsp;<span class="num" id="5434898">1</span><span class="op" id="5434899">,</span>&nbsp;<span class="num" id="5434901">0</span><span class="op" id="5434902">,</span>&nbsp;<span class="num" id="5434904">0</span><span class="op" id="5434905">,</span>&nbsp;<span class="num" id="5434907">0</span><span class="op" id="5434908">,</span>&nbsp;<span class="num" id="5434910">0</span><span class="op" id="5434911">,</span>&nbsp;<span class="num" id="5434913">0</span><span class="op" id="5434914">}</span><span class="op" id="5434915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434919">[</span><span class="op" id="5434920">]</span><span class="builtintype" id="5434921">byte</span><span class="op" id="5434925">{</span><span class="num" id="5434926">0</span><span class="op" id="5434927">,</span>&nbsp;<span class="num" id="5434929">1</span><span class="op" id="5434930">,</span>&nbsp;<span class="num" id="5434932">2</span><span class="op" id="5434933">,</span>&nbsp;<span class="num" id="5434935">3</span><span class="op" id="5434936">,</span>&nbsp;<span class="num" id="5434938">4</span><span class="op" id="5434939">,</span>&nbsp;<span class="num" id="5434941">5</span><span class="op" id="5434942">,</span>&nbsp;<span class="num" id="5434944">6</span><span class="op" id="5434945">,</span>&nbsp;<span class="num" id="5434947">7</span><span class="op" id="5434948">,</span>&nbsp;<span class="num" id="5434950">8</span><span class="op" id="5434951">,</span>&nbsp;<span class="num" id="5434953">9</span><span class="op" id="5434954">,</span>&nbsp;<span class="num" id="5434956">10</span><span class="op" id="5434958">,</span>&nbsp;<span class="num" id="5434960">11</span><span class="op" id="5434962">}</span><span class="op" id="5434963">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434966">}</span><span class="op" id="5434967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5434970">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434994">[</span><span class="num" id="5434995">16</span><span class="op" id="5434997">]</span><span class="builtintype" id="5434998">byte</span><span class="op" id="5435002">{</span><span class="num" id="5435003">0</span><span class="op" id="5435004">,</span>&nbsp;<span class="num" id="5435006">2</span><span class="op" id="5435007">,</span>&nbsp;<span class="num" id="5435009">1</span><span class="op" id="5435010">,</span>&nbsp;<span class="num" id="5435012">2</span><span class="op" id="5435013">,</span>&nbsp;<span class="num" id="5435015">4</span><span class="op" id="5435016">,</span>&nbsp;<span class="num" id="5435018">4</span><span class="op" id="5435019">,</span>&nbsp;<span class="num" id="5435021">3</span><span class="op" id="5435022">,</span>&nbsp;<span class="num" id="5435024">4</span><span class="op" id="5435025">,</span>&nbsp;<span class="num" id="5435027">7</span><span class="op" id="5435028">,</span>&nbsp;<span class="num" id="5435030">5</span><span class="op" id="5435031">,</span>&nbsp;<span class="num" id="5435033">4</span><span class="op" id="5435034">,</span>&nbsp;<span class="num" id="5435036">4</span><span class="op" id="5435037">,</span>&nbsp;<span class="num" id="5435039">0</span><span class="op" id="5435040">,</span>&nbsp;<span class="num" id="5435042">1</span><span class="op" id="5435043">,</span>&nbsp;<span class="num" id="5435045">2</span><span class="op" id="5435046">,</span>&nbsp;<span class="num" id="5435048">119</span><span class="op" id="5435051">}</span><span class="op" id="5435052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435056">[</span><span class="op" id="5435057">]</span><span class="builtintype" id="5435058">byte</span><span class="op" id="5435062">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435067">0x00</span><span class="op" id="5435071">,</span>&nbsp;<span class="num" id="5435073">0x01</span><span class="op" id="5435077">,</span>&nbsp;<span class="num" id="5435079">0x02</span><span class="op" id="5435083">,</span>&nbsp;<span class="num" id="5435085">0x03</span><span class="op" id="5435089">,</span>&nbsp;<span class="num" id="5435091">0x11</span><span class="op" id="5435095">,</span>&nbsp;<span class="num" id="5435097">0x04</span><span class="op" id="5435101">,</span>&nbsp;<span class="num" id="5435103">0x05</span><span class="op" id="5435107">,</span>&nbsp;<span class="num" id="5435109">0x21</span><span class="op" id="5435113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435118">0x31</span><span class="op" id="5435122">,</span>&nbsp;<span class="num" id="5435124">0x06</span><span class="op" id="5435128">,</span>&nbsp;<span class="num" id="5435130">0x12</span><span class="op" id="5435134">,</span>&nbsp;<span class="num" id="5435136">0x41</span><span class="op" id="5435140">,</span>&nbsp;<span class="num" id="5435142">0x51</span><span class="op" id="5435146">,</span>&nbsp;<span class="num" id="5435148">0x07</span><span class="op" id="5435152">,</span>&nbsp;<span class="num" id="5435154">0x61</span><span class="op" id="5435158">,</span>&nbsp;<span class="num" id="5435160">0x71</span><span class="op" id="5435164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435169">0x13</span><span class="op" id="5435173">,</span>&nbsp;<span class="num" id="5435175">0x22</span><span class="op" id="5435179">,</span>&nbsp;<span class="num" id="5435181">0x32</span><span class="op" id="5435185">,</span>&nbsp;<span class="num" id="5435187">0x81</span><span class="op" id="5435191">,</span>&nbsp;<span class="num" id="5435193">0x08</span><span class="op" id="5435197">,</span>&nbsp;<span class="num" id="5435199">0x14</span><span class="op" id="5435203">,</span>&nbsp;<span class="num" id="5435205">0x42</span><span class="op" id="5435209">,</span>&nbsp;<span class="num" id="5435211">0x91</span><span class="op" id="5435215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435220">0xa1</span><span class="op" id="5435224">,</span>&nbsp;<span class="num" id="5435226">0xb1</span><span class="op" id="5435230">,</span>&nbsp;<span class="num" id="5435232">0xc1</span><span class="op" id="5435236">,</span>&nbsp;<span class="num" id="5435238">0x09</span><span class="op" id="5435242">,</span>&nbsp;<span class="num" id="5435244">0x23</span><span class="op" id="5435248">,</span>&nbsp;<span class="num" id="5435250">0x33</span><span class="op" id="5435254">,</span>&nbsp;<span class="num" id="5435256">0x52</span><span class="op" id="5435260">,</span>&nbsp;<span class="num" id="5435262">0xf0</span><span class="op" id="5435266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435271">0x15</span><span class="op" id="5435275">,</span>&nbsp;<span class="num" id="5435277">0x62</span><span class="op" id="5435281">,</span>&nbsp;<span class="num" id="5435283">0x72</span><span class="op" id="5435287">,</span>&nbsp;<span class="num" id="5435289">0xd1</span><span class="op" id="5435293">,</span>&nbsp;<span class="num" id="5435295">0x0a</span><span class="op" id="5435299">,</span>&nbsp;<span class="num" id="5435301">0x16</span><span class="op" id="5435305">,</span>&nbsp;<span class="num" id="5435307">0x24</span><span class="op" id="5435311">,</span>&nbsp;<span class="num" id="5435313">0x34</span><span class="op" id="5435317">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435322">0xe1</span><span class="op" id="5435326">,</span>&nbsp;<span class="num" id="5435328">0x25</span><span class="op" id="5435332">,</span>&nbsp;<span class="num" id="5435334">0xf1</span><span class="op" id="5435338">,</span>&nbsp;<span class="num" id="5435340">0x17</span><span class="op" id="5435344">,</span>&nbsp;<span class="num" id="5435346">0x18</span><span class="op" id="5435350">,</span>&nbsp;<span class="num" id="5435352">0x19</span><span class="op" id="5435356">,</span>&nbsp;<span class="num" id="5435358">0x1a</span><span class="op" id="5435362">,</span>&nbsp;<span class="num" id="5435364">0x26</span><span class="op" id="5435368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435373">0x27</span><span class="op" id="5435377">,</span>&nbsp;<span class="num" id="5435379">0x28</span><span class="op" id="5435383">,</span>&nbsp;<span class="num" id="5435385">0x29</span><span class="op" id="5435389">,</span>&nbsp;<span class="num" id="5435391">0x2a</span><span class="op" id="5435395">,</span>&nbsp;<span class="num" id="5435397">0x35</span><span class="op" id="5435401">,</span>&nbsp;<span class="num" id="5435403">0x36</span><span class="op" id="5435407">,</span>&nbsp;<span class="num" id="5435409">0x37</span><span class="op" id="5435413">,</span>&nbsp;<span class="num" id="5435415">0x38</span><span class="op" id="5435419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435424">0x39</span><span class="op" id="5435428">,</span>&nbsp;<span class="num" id="5435430">0x3a</span><span class="op" id="5435434">,</span>&nbsp;<span class="num" id="5435436">0x43</span><span class="op" id="5435440">,</span>&nbsp;<span class="num" id="5435442">0x44</span><span class="op" id="5435446">,</span>&nbsp;<span class="num" id="5435448">0x45</span><span class="op" id="5435452">,</span>&nbsp;<span class="num" id="5435454">0x46</span><span class="op" id="5435458">,</span>&nbsp;<span class="num" id="5435460">0x47</span><span class="op" id="5435464">,</span>&nbsp;<span class="num" id="5435466">0x48</span><span class="op" id="5435470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435475">0x49</span><span class="op" id="5435479">,</span>&nbsp;<span class="num" id="5435481">0x4a</span><span class="op" id="5435485">,</span>&nbsp;<span class="num" id="5435487">0x53</span><span class="op" id="5435491">,</span>&nbsp;<span class="num" id="5435493">0x54</span><span class="op" id="5435497">,</span>&nbsp;<span class="num" id="5435499">0x55</span><span class="op" id="5435503">,</span>&nbsp;<span class="num" id="5435505">0x56</span><span class="op" id="5435509">,</span>&nbsp;<span class="num" id="5435511">0x57</span><span class="op" id="5435515">,</span>&nbsp;<span class="num" id="5435517">0x58</span><span class="op" id="5435521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435526">0x59</span><span class="op" id="5435530">,</span>&nbsp;<span class="num" id="5435532">0x5a</span><span class="op" id="5435536">,</span>&nbsp;<span class="num" id="5435538">0x63</span><span class="op" id="5435542">,</span>&nbsp;<span class="num" id="5435544">0x64</span><span class="op" id="5435548">,</span>&nbsp;<span class="num" id="5435550">0x65</span><span class="op" id="5435554">,</span>&nbsp;<span class="num" id="5435556">0x66</span><span class="op" id="5435560">,</span>&nbsp;<span class="num" id="5435562">0x67</span><span class="op" id="5435566">,</span>&nbsp;<span class="num" id="5435568">0x68</span><span class="op" id="5435572">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435577">0x69</span><span class="op" id="5435581">,</span>&nbsp;<span class="num" id="5435583">0x6a</span><span class="op" id="5435587">,</span>&nbsp;<span class="num" id="5435589">0x73</span><span class="op" id="5435593">,</span>&nbsp;<span class="num" id="5435595">0x74</span><span class="op" id="5435599">,</span>&nbsp;<span class="num" id="5435601">0x75</span><span class="op" id="5435605">,</span>&nbsp;<span class="num" id="5435607">0x76</span><span class="op" id="5435611">,</span>&nbsp;<span class="num" id="5435613">0x77</span><span class="op" id="5435617">,</span>&nbsp;<span class="num" id="5435619">0x78</span><span class="op" id="5435623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435628">0x79</span><span class="op" id="5435632">,</span>&nbsp;<span class="num" id="5435634">0x7a</span><span class="op" id="5435638">,</span>&nbsp;<span class="num" id="5435640">0x82</span><span class="op" id="5435644">,</span>&nbsp;<span class="num" id="5435646">0x83</span><span class="op" id="5435650">,</span>&nbsp;<span class="num" id="5435652">0x84</span><span class="op" id="5435656">,</span>&nbsp;<span class="num" id="5435658">0x85</span><span class="op" id="5435662">,</span>&nbsp;<span class="num" id="5435664">0x86</span><span class="op" id="5435668">,</span>&nbsp;<span class="num" id="5435670">0x87</span><span class="op" id="5435674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435679">0x88</span><span class="op" id="5435683">,</span>&nbsp;<span class="num" id="5435685">0x89</span><span class="op" id="5435689">,</span>&nbsp;<span class="num" id="5435691">0x8a</span><span class="op" id="5435695">,</span>&nbsp;<span class="num" id="5435697">0x92</span><span class="op" id="5435701">,</span>&nbsp;<span class="num" id="5435703">0x93</span><span class="op" id="5435707">,</span>&nbsp;<span class="num" id="5435709">0x94</span><span class="op" id="5435713">,</span>&nbsp;<span class="num" id="5435715">0x95</span><span class="op" id="5435719">,</span>&nbsp;<span class="num" id="5435721">0x96</span><span class="op" id="5435725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435730">0x97</span><span class="op" id="5435734">,</span>&nbsp;<span class="num" id="5435736">0x98</span><span class="op" id="5435740">,</span>&nbsp;<span class="num" id="5435742">0x99</span><span class="op" id="5435746">,</span>&nbsp;<span class="num" id="5435748">0x9a</span><span class="op" id="5435752">,</span>&nbsp;<span class="num" id="5435754">0xa2</span><span class="op" id="5435758">,</span>&nbsp;<span class="num" id="5435760">0xa3</span><span class="op" id="5435764">,</span>&nbsp;<span class="num" id="5435766">0xa4</span><span class="op" id="5435770">,</span>&nbsp;<span class="num" id="5435772">0xa5</span><span class="op" id="5435776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435781">0xa6</span><span class="op" id="5435785">,</span>&nbsp;<span class="num" id="5435787">0xa7</span><span class="op" id="5435791">,</span>&nbsp;<span class="num" id="5435793">0xa8</span><span class="op" id="5435797">,</span>&nbsp;<span class="num" id="5435799">0xa9</span><span class="op" id="5435803">,</span>&nbsp;<span class="num" id="5435805">0xaa</span><span class="op" id="5435809">,</span>&nbsp;<span class="num" id="5435811">0xb2</span><span class="op" id="5435815">,</span>&nbsp;<span class="num" id="5435817">0xb3</span><span class="op" id="5435821">,</span>&nbsp;<span class="num" id="5435823">0xb4</span><span class="op" id="5435827">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435832">0xb5</span><span class="op" id="5435836">,</span>&nbsp;<span class="num" id="5435838">0xb6</span><span class="op" id="5435842">,</span>&nbsp;<span class="num" id="5435844">0xb7</span><span class="op" id="5435848">,</span>&nbsp;<span class="num" id="5435850">0xb8</span><span class="op" id="5435854">,</span>&nbsp;<span class="num" id="5435856">0xb9</span><span class="op" id="5435860">,</span>&nbsp;<span class="num" id="5435862">0xba</span><span class="op" id="5435866">,</span>&nbsp;<span class="num" id="5435868">0xc2</span><span class="op" id="5435872">,</span>&nbsp;<span class="num" id="5435874">0xc3</span><span class="op" id="5435878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435883">0xc4</span><span class="op" id="5435887">,</span>&nbsp;<span class="num" id="5435889">0xc5</span><span class="op" id="5435893">,</span>&nbsp;<span class="num" id="5435895">0xc6</span><span class="op" id="5435899">,</span>&nbsp;<span class="num" id="5435901">0xc7</span><span class="op" id="5435905">,</span>&nbsp;<span class="num" id="5435907">0xc8</span><span class="op" id="5435911">,</span>&nbsp;<span class="num" id="5435913">0xc9</span><span class="op" id="5435917">,</span>&nbsp;<span class="num" id="5435919">0xca</span><span class="op" id="5435923">,</span>&nbsp;<span class="num" id="5435925">0xd2</span><span class="op" id="5435929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435934">0xd3</span><span class="op" id="5435938">,</span>&nbsp;<span class="num" id="5435940">0xd4</span><span class="op" id="5435944">,</span>&nbsp;<span class="num" id="5435946">0xd5</span><span class="op" id="5435950">,</span>&nbsp;<span class="num" id="5435952">0xd6</span><span class="op" id="5435956">,</span>&nbsp;<span class="num" id="5435958">0xd7</span><span class="op" id="5435962">,</span>&nbsp;<span class="num" id="5435964">0xd8</span><span class="op" id="5435968">,</span>&nbsp;<span class="num" id="5435970">0xd9</span><span class="op" id="5435974">,</span>&nbsp;<span class="num" id="5435976">0xda</span><span class="op" id="5435980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5435985">0xe2</span><span class="op" id="5435989">,</span>&nbsp;<span class="num" id="5435991">0xe3</span><span class="op" id="5435995">,</span>&nbsp;<span class="num" id="5435997">0xe4</span><span class="op" id="5436001">,</span>&nbsp;<span class="num" id="5436003">0xe5</span><span class="op" id="5436007">,</span>&nbsp;<span class="num" id="5436009">0xe6</span><span class="op" id="5436013">,</span>&nbsp;<span class="num" id="5436015">0xe7</span><span class="op" id="5436019">,</span>&nbsp;<span class="num" id="5436021">0xe8</span><span class="op" id="5436025">,</span>&nbsp;<span class="num" id="5436027">0xe9</span><span class="op" id="5436031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5436036">0xea</span><span class="op" id="5436040">,</span>&nbsp;<span class="num" id="5436042">0xf2</span><span class="op" id="5436046">,</span>&nbsp;<span class="num" id="5436048">0xf3</span><span class="op" id="5436052">,</span>&nbsp;<span class="num" id="5436054">0xf4</span><span class="op" id="5436058">,</span>&nbsp;<span class="num" id="5436060">0xf5</span><span class="op" id="5436064">,</span>&nbsp;<span class="num" id="5436066">0xf6</span><span class="op" id="5436070">,</span>&nbsp;<span class="num" id="5436072">0xf7</span><span class="op" id="5436076">,</span>&nbsp;<span class="num" id="5436078">0xf8</span><span class="op" id="5436082">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5436087">0xf9</span><span class="op" id="5436091">,</span>&nbsp;<span class="num" id="5436093">0xfa</span><span class="op" id="5436097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436101">}</span><span class="op" id="5436102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436105">}</span><span class="op" id="5436106">,</span><br>
<span class="lineno"></span><span class="op" id="5436108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5436111">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="5436186">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5436263">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="5436341">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5436382">type</span>&nbsp;<span class="ident" id="5436387">huffmanLUT</span>&nbsp;<span class="op" id="5436398">[</span><span class="op" id="5436399">]</span><span class="builtintype" id="5436400">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="5436408">func</span>&nbsp;<span class="op" id="5436413">(</span><span class="ident" id="5436414">h</span>&nbsp;<span class="op" id="5436416">*</span><span class="ident" id="5436417"><a href="/image/jpeg/writer.go.html#5436387">huffmanLUT</a></span><span class="op" id="5436427">)</span>&nbsp;<span class="ident" id="5436429">init</span><span class="op" id="5436433">(</span><span class="ident" id="5436434">s</span>&nbsp;<span class="ident" id="5436436"><a href="/image/jpeg/writer.go.html#5433233">huffmanSpec</a></span><span class="op" id="5436447">)</span>&nbsp;<span class="op" id="5436449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436452">maxValue</span>&nbsp;<span class="op" id="5436461">:=</span>&nbsp;<span class="num" id="5436464">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436467">for</span>&nbsp;<span class="ident" id="5436471">_</span><span class="op" id="5436472">,</span>&nbsp;<span class="ident" id="5436474">v</span>&nbsp;<span class="op" id="5436476">:=</span>&nbsp;<span class="keyword" id="5436479">range</span>&nbsp;<span class="ident" id="5436485"><a href="/image/jpeg/writer.go.html#5436434">s</a></span><span class="op" id="5436486">.</span><span class="ident" id="5436487">value</span>&nbsp;<span class="op" id="5436493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436497">if</span>&nbsp;<span class="builtintype" id="5436500">int</span><span class="op" id="5436503">(</span><span class="ident" id="5436504"><a href="/image/jpeg/writer.go.html#5436474">v</a></span><span class="op" id="5436505">)</span>&nbsp;<span class="op" id="5436507">&gt;</span>&nbsp;<span class="ident" id="5436509"><a href="/image/jpeg/writer.go.html#5436452">maxValue</a></span>&nbsp;<span class="op" id="5436518">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436523"><a href="/image/jpeg/writer.go.html#5436452">maxValue</a></span>&nbsp;<span class="op" id="5436532">=</span>&nbsp;<span class="builtintype" id="5436534">int</span><span class="op" id="5436537">(</span><span class="ident" id="5436538"><a href="/image/jpeg/writer.go.html#5436474">v</a></span><span class="op" id="5436539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436549">*</span><span class="ident" id="5436550"><a href="/image/jpeg/writer.go.html#5436414">h</a></span>&nbsp;<span class="op" id="5436552">=</span>&nbsp;<span class="builtinfunc" id="5436554">make</span><span class="op" id="5436558">(</span><span class="op" id="5436559">[</span><span class="op" id="5436560">]</span><span class="builtintype" id="5436561">uint32</span><span class="op" id="5436567">,</span>&nbsp;<span class="ident" id="5436569"><a href="/image/jpeg/writer.go.html#5436452">maxValue</a></span><span class="op" id="5436577">+</span><span class="num" id="5436578">1</span><span class="op" id="5436579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436582">code</span><span class="op" id="5436586">,</span>&nbsp;<span class="ident" id="5436588">k</span>&nbsp;<span class="op" id="5436590">:=</span>&nbsp;<span class="builtintype" id="5436593">uint32</span><span class="op" id="5436599">(</span><span class="num" id="5436600">0</span><span class="op" id="5436601">)</span><span class="op" id="5436602">,</span>&nbsp;<span class="num" id="5436604">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436607">for</span>&nbsp;<span class="ident" id="5436611">i</span>&nbsp;<span class="op" id="5436613">:=</span>&nbsp;<span class="num" id="5436616">0</span><span class="op" id="5436617">;</span>&nbsp;<span class="ident" id="5436619"><a href="/image/jpeg/writer.go.html#5436611">i</a></span>&nbsp;<span class="op" id="5436621">&lt;</span>&nbsp;<span class="builtinfunc" id="5436623">len</span><span class="op" id="5436626">(</span><span class="ident" id="5436627"><a href="/image/jpeg/writer.go.html#5436434">s</a></span><span class="op" id="5436628">.</span><span class="ident" id="5436629">count</span><span class="op" id="5436634">)</span><span class="op" id="5436635">;</span>&nbsp;<span class="ident" id="5436637"><a href="/image/jpeg/writer.go.html#5436611">i</a></span><span class="op" id="5436638">++</span>&nbsp;<span class="op" id="5436641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436645">nBits</span>&nbsp;<span class="op" id="5436651">:=</span>&nbsp;<span class="builtintype" id="5436654">uint32</span><span class="op" id="5436660">(</span><span class="ident" id="5436661"><a href="/image/jpeg/writer.go.html#5436611">i</a></span><span class="op" id="5436662">+</span><span class="num" id="5436663">1</span><span class="op" id="5436664">)</span>&nbsp;<span class="op" id="5436666">&lt;&lt;</span>&nbsp;<span class="num" id="5436669">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436674">for</span>&nbsp;<span class="ident" id="5436678">j</span>&nbsp;<span class="op" id="5436680">:=</span>&nbsp;<span class="builtintype" id="5436683">uint8</span><span class="op" id="5436688">(</span><span class="num" id="5436689">0</span><span class="op" id="5436690">)</span><span class="op" id="5436691">;</span>&nbsp;<span class="ident" id="5436693"><a href="/image/jpeg/writer.go.html#5436678">j</a></span>&nbsp;<span class="op" id="5436695">&lt;</span>&nbsp;<span class="ident" id="5436697"><a href="/image/jpeg/writer.go.html#5436434">s</a></span><span class="op" id="5436698">.</span><span class="ident" id="5436699">count</span><span class="op" id="5436704">[</span><span class="ident" id="5436705"><a href="/image/jpeg/writer.go.html#5436611">i</a></span><span class="op" id="5436706">]</span><span class="op" id="5436707">;</span>&nbsp;<span class="ident" id="5436709"><a href="/image/jpeg/writer.go.html#5436678">j</a></span><span class="op" id="5436710">++</span>&nbsp;<span class="op" id="5436713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436718">(</span><span class="op" id="5436719">*</span><span class="ident" id="5436720"><a href="/image/jpeg/writer.go.html#5436414">h</a></span><span class="op" id="5436721">)</span><span class="op" id="5436722">[</span><span class="ident" id="5436723"><a href="/image/jpeg/writer.go.html#5436434">s</a></span><span class="op" id="5436724">.</span><span class="ident" id="5436725">value</span><span class="op" id="5436730">[</span><span class="ident" id="5436731"><a href="/image/jpeg/writer.go.html#5436588">k</a></span><span class="op" id="5436732">]</span><span class="op" id="5436733">]</span>&nbsp;<span class="op" id="5436735">=</span>&nbsp;<span class="ident" id="5436737"><a href="/image/jpeg/writer.go.html#5436645">nBits</a></span>&nbsp;<span class="op" id="5436743">|</span>&nbsp;<span class="ident" id="5436745"><a href="/image/jpeg/writer.go.html#5436582">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436753"><a href="/image/jpeg/writer.go.html#5436582">code</a></span><span class="op" id="5436757">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436763"><a href="/image/jpeg/writer.go.html#5436588">k</a></span><span class="op" id="5436764">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436773"><a href="/image/jpeg/writer.go.html#5436582">code</a></span>&nbsp;<span class="op" id="5436778">&lt;&lt;=</span>&nbsp;<span class="num" id="5436782">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436785">}</span><br>
<span class="lineno"></span><span class="op" id="5436787">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5436790">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="5436855">var</span>&nbsp;<span class="ident" id="5436859">theHuffmanLUT</span>&nbsp;<span class="op" id="5436873">[</span><span class="num" id="5436874">4</span><span class="op" id="5436875">]</span><span class="ident" id="5436876"><a href="/image/jpeg/writer.go.html#5436387">huffmanLUT</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5436888">func</span>&nbsp;<span class="ident" id="5436893">init</span><span class="op" id="5436897">(</span><span class="op" id="5436898">)</span>&nbsp;<span class="op" id="5436900">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436903">for</span>&nbsp;<span class="ident" id="5436907">i</span><span class="op" id="5436908">,</span>&nbsp;<span class="ident" id="5436910">s</span>&nbsp;<span class="op" id="5436912">:=</span>&nbsp;<span class="keyword" id="5436915">range</span>&nbsp;<span class="ident" id="5436921"><a href="/image/jpeg/writer.go.html#5433522">theHuffmanSpec</a></span>&nbsp;<span class="op" id="5436936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436940"><a href="/image/jpeg/writer.go.html#5436859">theHuffmanLUT</a></span><span class="op" id="5436953">[</span><span class="ident" id="5436954"><a href="/image/jpeg/writer.go.html#5436907">i</a></span><span class="op" id="5436955">]</span><span class="op" id="5436956">.</span><span class="ident" id="5436957">init</span><span class="op" id="5436961">(</span><span class="ident" id="5436962"><a href="/image/jpeg/writer.go.html#5436910">s</a></span><span class="op" id="5436963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436966">}</span><br>
<span class="lineno"></span><span class="op" id="5436968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="5436971">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5437003">type</span>&nbsp;<span class="ident" id="5437008">writer</span>&nbsp;<span class="keyword" id="5437015">interface</span>&nbsp;<span class="op" id="5437025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437028">Flush</span><span class="op" id="5437033">(</span><span class="op" id="5437034">)</span>&nbsp;<span class="builtintype" id="5437036">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437043"><a href="/image/jpeg/writer.go.html#5430843">io</a></span><span class="op" id="5437045">.</span><span class="ident" id="5437046">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437054"><a href="/image/jpeg/writer.go.html#5430843">io</a></span><span class="op" id="5437056">.</span><span class="ident" id="5437057">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="5437068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437071">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5437119">type</span>&nbsp;<span class="ident" id="5437124">encoder</span>&nbsp;<span class="keyword" id="5437132">struct</span>&nbsp;<span class="op" id="5437139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5437142">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5437217">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437288">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5437292"><a href="/image/jpeg/writer.go.html#5437008">writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437300">err</span>&nbsp;<span class="builtintype" id="5437304">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5437311">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437340">buf</span>&nbsp;<span class="op" id="5437344">[</span><span class="num" id="5437345">16</span><span class="op" id="5437347">]</span><span class="builtintype" id="5437348">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5437354">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437409">bits</span><span class="op" id="5437413">,</span>&nbsp;<span class="ident" id="5437415">nBits</span>&nbsp;<span class="builtintype" id="5437421">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5437429">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437492">quant</span>&nbsp;<span class="op" id="5437498">[</span><span class="ident" id="5437499"><a href="/image/jpeg/writer.go.html#5432115">nQuantIndex</a></span><span class="op" id="5437510">]</span><span class="op" id="5437511">[</span><span class="ident" id="5437512"><a href="/image/jpeg/idct.go.html#5398910">blockSize</a></span><span class="op" id="5437521">]</span><span class="builtintype" id="5437522">byte</span><br>
<span class="lineno"></span><span class="op" id="5437527">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5437530">func</span>&nbsp;<span class="op" id="5437535">(</span><span class="ident" id="5437536">e</span>&nbsp;<span class="op" id="5437538">*</span><span class="ident" id="5437539"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5437546">)</span>&nbsp;<span class="ident" id="5437548">flush</span><span class="op" id="5437553">(</span><span class="op" id="5437554">)</span>&nbsp;<span class="op" id="5437556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437559">if</span>&nbsp;<span class="ident" id="5437562"><a href="/image/jpeg/writer.go.html#5437536">e</a></span><span class="op" id="5437563">.</span><span class="ident" id="5437564">err</span>&nbsp;<span class="op" id="5437568">!=</span>&nbsp;<span class="ident" id="5437571">nil</span>&nbsp;<span class="op" id="5437575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437579">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437587">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437590"><a href="/image/jpeg/writer.go.html#5437536">e</a></span><span class="op" id="5437591">.</span><span class="ident" id="5437592">err</span>&nbsp;<span class="op" id="5437596">=</span>&nbsp;<span class="ident" id="5437598"><a href="/image/jpeg/writer.go.html#5437536">e</a></span><span class="op" id="5437599">.</span><span class="ident" id="5437600">w</span><span class="op" id="5437601">.</span><span class="ident" id="5437602">Flush</span><span class="op" id="5437607">(</span><span class="op" id="5437608">)</span><br>
<span class="lineno"></span><span class="op" id="5437610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5437613">func</span>&nbsp;<span class="op" id="5437618">(</span><span class="ident" id="5437619">e</span>&nbsp;<span class="op" id="5437621">*</span><span class="ident" id="5437622"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5437629">)</span>&nbsp;<span class="ident" id="5437631">write</span><span class="op" id="5437636">(</span><span class="ident" id="5437637">p</span>&nbsp;<span class="op" id="5437639">[</span><span class="op" id="5437640">]</span><span class="builtintype" id="5437641">byte</span><span class="op" id="5437645">)</span>&nbsp;<span class="op" id="5437647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437650">if</span>&nbsp;<span class="ident" id="5437653"><a href="/image/jpeg/writer.go.html#5437619">e</a></span><span class="op" id="5437654">.</span><span class="ident" id="5437655">err</span>&nbsp;<span class="op" id="5437659">!=</span>&nbsp;<span class="ident" id="5437662">nil</span>&nbsp;<span class="op" id="5437666">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437670">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437681">_</span><span class="op" id="5437682">,</span>&nbsp;<span class="ident" id="5437684"><a href="/image/jpeg/writer.go.html#5437619">e</a></span><span class="op" id="5437685">.</span><span class="ident" id="5437686">err</span>&nbsp;<span class="op" id="5437690">=</span>&nbsp;<span class="ident" id="5437692"><a href="/image/jpeg/writer.go.html#5437619">e</a></span><span class="op" id="5437693">.</span><span class="ident" id="5437694">w</span><span class="op" id="5437695">.</span><span class="ident" id="5437696">Write</span><span class="op" id="5437701">(</span><span class="ident" id="5437702"><a href="/image/jpeg/writer.go.html#5437637">p</a></span><span class="op" id="5437703">)</span><br>
<span class="lineno"></span><span class="op" id="5437705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="5437708">func</span>&nbsp;<span class="op" id="5437713">(</span><span class="ident" id="5437714">e</span>&nbsp;<span class="op" id="5437716">*</span><span class="ident" id="5437717"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5437724">)</span>&nbsp;<span class="ident" id="5437726">writeByte</span><span class="op" id="5437735">(</span><span class="ident" id="5437736">b</span>&nbsp;<span class="builtintype" id="5437738">byte</span><span class="op" id="5437742">)</span>&nbsp;<span class="op" id="5437744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437747">if</span>&nbsp;<span class="ident" id="5437750"><a href="/image/jpeg/writer.go.html#5437714">e</a></span><span class="op" id="5437751">.</span><span class="ident" id="5437752">err</span>&nbsp;<span class="op" id="5437756">!=</span>&nbsp;<span class="ident" id="5437759">nil</span>&nbsp;<span class="op" id="5437763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437767">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437778"><a href="/image/jpeg/writer.go.html#5437714">e</a></span><span class="op" id="5437779">.</span><span class="ident" id="5437780">err</span>&nbsp;<span class="op" id="5437784">=</span>&nbsp;<span class="ident" id="5437786"><a href="/image/jpeg/writer.go.html#5437714">e</a></span><span class="op" id="5437787">.</span><span class="ident" id="5437788">w</span><span class="op" id="5437789">.</span><span class="ident" id="5437790">WriteByte</span><span class="op" id="5437799">(</span><span class="ident" id="5437800"><a href="/image/jpeg/writer.go.html#5437736">b</a></span><span class="op" id="5437801">)</span><br>
<span class="lineno">250</span><span class="op" id="5437803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437806">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5437880">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="5437935">func</span>&nbsp;<span class="op" id="5437940">(</span><span class="ident" id="5437941">e</span>&nbsp;<span class="op" id="5437943">*</span><span class="ident" id="5437944"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5437951">)</span>&nbsp;<span class="ident" id="5437953">emit</span><span class="op" id="5437957">(</span><span class="ident" id="5437958">bits</span><span class="op" id="5437962">,</span>&nbsp;<span class="ident" id="5437964">nBits</span>&nbsp;<span class="builtintype" id="5437970">uint32</span><span class="op" id="5437976">)</span>&nbsp;<span class="op" id="5437978">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437981"><a href="/image/jpeg/writer.go.html#5437964">nBits</a></span>&nbsp;<span class="op" id="5437987">+=</span>&nbsp;<span class="ident" id="5437990"><a href="/image/jpeg/writer.go.html#5437941">e</a></span><span class="op" id="5437991">.</span><span class="ident" id="5437992">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437999"><a href="/image/jpeg/writer.go.html#5437958">bits</a></span>&nbsp;<span class="op" id="5438004">&lt;&lt;=</span>&nbsp;<span class="num" id="5438008">32</span>&nbsp;<span class="op" id="5438011">-</span>&nbsp;<span class="ident" id="5438013"><a href="/image/jpeg/writer.go.html#5437964">nBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438020"><a href="/image/jpeg/writer.go.html#5437958">bits</a></span>&nbsp;<span class="op" id="5438025">|=</span>&nbsp;<span class="ident" id="5438028"><a href="/image/jpeg/writer.go.html#5437941">e</a></span><span class="op" id="5438029">.</span><span class="ident" id="5438030">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438036">for</span>&nbsp;<span class="ident" id="5438040"><a href="/image/jpeg/writer.go.html#5437964">nBits</a></span>&nbsp;<span class="op" id="5438046">&gt;=</span>&nbsp;<span class="num" id="5438049">8</span>&nbsp;<span class="op" id="5438051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438055">b</span>&nbsp;<span class="op" id="5438057">:=</span>&nbsp;<span class="builtintype" id="5438060">uint8</span><span class="op" id="5438065">(</span><span class="ident" id="5438066"><a href="/image/jpeg/writer.go.html#5437958">bits</a></span>&nbsp;<span class="op" id="5438071">&gt;&gt;</span>&nbsp;<span class="num" id="5438074">24</span><span class="op" id="5438076">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438080"><a href="/image/jpeg/writer.go.html#5437941">e</a></span><span class="op" id="5438081">.</span><span class="ident" id="5438082">writeByte</span><span class="op" id="5438091">(</span><span class="ident" id="5438092"><a href="/image/jpeg/writer.go.html#5438055">b</a></span><span class="op" id="5438093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438097">if</span>&nbsp;<span class="ident" id="5438100"><a href="/image/jpeg/writer.go.html#5438055">b</a></span>&nbsp;<span class="op" id="5438102">==</span>&nbsp;<span class="num" id="5438105">0xff</span>&nbsp;<span class="op" id="5438110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438115"><a href="/image/jpeg/writer.go.html#5437941">e</a></span><span class="op" id="5438116">.</span><span class="ident" id="5438117">writeByte</span><span class="op" id="5438126">(</span><span class="num" id="5438127">0x00</span><span class="op" id="5438131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438139"><a href="/image/jpeg/writer.go.html#5437958">bits</a></span>&nbsp;<span class="op" id="5438144">&lt;&lt;=</span>&nbsp;<span class="num" id="5438148">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438152"><a href="/image/jpeg/writer.go.html#5437964">nBits</a></span>&nbsp;<span class="op" id="5438158">-=</span>&nbsp;<span class="num" id="5438161">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438167"><a href="/image/jpeg/writer.go.html#5437941">e</a></span><span class="op" id="5438168">.</span><span class="ident" id="5438169">bits</span><span class="op" id="5438173">,</span>&nbsp;<span class="ident" id="5438175"><a href="/image/jpeg/writer.go.html#5437941">e</a></span><span class="op" id="5438176">.</span><span class="ident" id="5438177">nBits</span>&nbsp;<span class="op" id="5438183">=</span>&nbsp;<span class="ident" id="5438185"><a href="/image/jpeg/writer.go.html#5437958">bits</a></span><span class="op" id="5438189">,</span>&nbsp;<span class="ident" id="5438191"><a href="/image/jpeg/writer.go.html#5437964">nBits</a></span><br>
<span class="lineno"></span><span class="op" id="5438197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5438200">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5438266">func</span>&nbsp;<span class="op" id="5438271">(</span><span class="ident" id="5438272">e</span>&nbsp;<span class="op" id="5438274">*</span><span class="ident" id="5438275"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5438282">)</span>&nbsp;<span class="ident" id="5438284">emitHuff</span><span class="op" id="5438292">(</span><span class="ident" id="5438293">h</span>&nbsp;<span class="ident" id="5438295"><a href="/image/jpeg/writer.go.html#5433036">huffIndex</a></span><span class="op" id="5438304">,</span>&nbsp;<span class="ident" id="5438306">value</span>&nbsp;<span class="builtintype" id="5438312">int32</span><span class="op" id="5438317">)</span>&nbsp;<span class="op" id="5438319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438322">x</span>&nbsp;<span class="op" id="5438324">:=</span>&nbsp;<span class="ident" id="5438327"><a href="/image/jpeg/writer.go.html#5436859">theHuffmanLUT</a></span><span class="op" id="5438340">[</span><span class="ident" id="5438341"><a href="/image/jpeg/writer.go.html#5438293">h</a></span><span class="op" id="5438342">]</span><span class="op" id="5438343">[</span><span class="ident" id="5438344"><a href="/image/jpeg/writer.go.html#5438306">value</a></span><span class="op" id="5438349">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438352"><a href="/image/jpeg/writer.go.html#5438272">e</a></span><span class="op" id="5438353">.</span><span class="ident" id="5438354">emit</span><span class="op" id="5438358">(</span><span class="ident" id="5438359"><a href="/image/jpeg/writer.go.html#5438322">x</a></span><span class="op" id="5438360">&amp;</span><span class="op" id="5438361">(</span><span class="num" id="5438362">1</span><span class="op" id="5438363">&lt;&lt;</span><span class="num" id="5438365">24</span><span class="op" id="5438367">-</span><span class="num" id="5438368">1</span><span class="op" id="5438369">)</span><span class="op" id="5438370">,</span>&nbsp;<span class="ident" id="5438372"><a href="/image/jpeg/writer.go.html#5438322">x</a></span><span class="op" id="5438373">&gt;&gt;</span><span class="num" id="5438375">24</span><span class="op" id="5438377">)</span><br>
<span class="lineno"></span><span class="op" id="5438379">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5438382">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5438461">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5438481">func</span>&nbsp;<span class="op" id="5438486">(</span><span class="ident" id="5438487">e</span>&nbsp;<span class="op" id="5438489">*</span><span class="ident" id="5438490"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5438497">)</span>&nbsp;<span class="ident" id="5438499">emitHuffRLE</span><span class="op" id="5438510">(</span><span class="ident" id="5438511">h</span>&nbsp;<span class="ident" id="5438513"><a href="/image/jpeg/writer.go.html#5433036">huffIndex</a></span><span class="op" id="5438522">,</span>&nbsp;<span class="ident" id="5438524">runLength</span><span class="op" id="5438533">,</span>&nbsp;<span class="ident" id="5438535">value</span>&nbsp;<span class="builtintype" id="5438541">int32</span><span class="op" id="5438546">)</span>&nbsp;<span class="op" id="5438548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438551">a</span><span class="op" id="5438552">,</span>&nbsp;<span class="ident" id="5438554">b</span>&nbsp;<span class="op" id="5438556">:=</span>&nbsp;<span class="ident" id="5438559"><a href="/image/jpeg/writer.go.html#5438535">value</a></span><span class="op" id="5438564">,</span>&nbsp;<span class="ident" id="5438566"><a href="/image/jpeg/writer.go.html#5438535">value</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438573">if</span>&nbsp;<span class="ident" id="5438576"><a href="/image/jpeg/writer.go.html#5438551">a</a></span>&nbsp;<span class="op" id="5438578">&lt;</span>&nbsp;<span class="num" id="5438580">0</span>&nbsp;<span class="op" id="5438582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438586"><a href="/image/jpeg/writer.go.html#5438551">a</a></span><span class="op" id="5438587">,</span>&nbsp;<span class="ident" id="5438589"><a href="/image/jpeg/writer.go.html#5438554">b</a></span>&nbsp;<span class="op" id="5438591">=</span>&nbsp;<span class="op" id="5438593">-</span><span class="ident" id="5438594"><a href="/image/jpeg/writer.go.html#5438535">value</a></span><span class="op" id="5438599">,</span>&nbsp;<span class="ident" id="5438601"><a href="/image/jpeg/writer.go.html#5438535">value</a></span><span class="op" id="5438606">-</span><span class="num" id="5438607">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438613">var</span>&nbsp;<span class="ident" id="5438617">nBits</span>&nbsp;<span class="builtintype" id="5438623">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438631">if</span>&nbsp;<span class="ident" id="5438634"><a href="/image/jpeg/writer.go.html#5438551">a</a></span>&nbsp;<span class="op" id="5438636">&lt;</span>&nbsp;<span class="num" id="5438638">0x100</span>&nbsp;<span class="op" id="5438644">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438648"><a href="/image/jpeg/writer.go.html#5438617">nBits</a></span>&nbsp;<span class="op" id="5438654">=</span>&nbsp;<span class="builtintype" id="5438656">uint32</span><span class="op" id="5438662">(</span><span class="ident" id="5438663"><a href="/image/jpeg/writer.go.html#5431214">bitCount</a></span><span class="op" id="5438671">[</span><span class="ident" id="5438672"><a href="/image/jpeg/writer.go.html#5438551">a</a></span><span class="op" id="5438673">]</span><span class="op" id="5438674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438677">}</span>&nbsp;<span class="keyword" id="5438679">else</span>&nbsp;<span class="op" id="5438684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438688"><a href="/image/jpeg/writer.go.html#5438617">nBits</a></span>&nbsp;<span class="op" id="5438694">=</span>&nbsp;<span class="num" id="5438696">8</span>&nbsp;<span class="op" id="5438698">+</span>&nbsp;<span class="builtintype" id="5438700">uint32</span><span class="op" id="5438706">(</span><span class="ident" id="5438707"><a href="/image/jpeg/writer.go.html#5431214">bitCount</a></span><span class="op" id="5438715">[</span><span class="ident" id="5438716"><a href="/image/jpeg/writer.go.html#5438551">a</a></span><span class="op" id="5438717">&gt;&gt;</span><span class="num" id="5438719">8</span><span class="op" id="5438720">]</span><span class="op" id="5438721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438727"><a href="/image/jpeg/writer.go.html#5438487">e</a></span><span class="op" id="5438728">.</span><span class="ident" id="5438729">emitHuff</span><span class="op" id="5438737">(</span><span class="ident" id="5438738"><a href="/image/jpeg/writer.go.html#5438511">h</a></span><span class="op" id="5438739">,</span>&nbsp;<span class="ident" id="5438741"><a href="/image/jpeg/writer.go.html#5438524">runLength</a></span><span class="op" id="5438750">&lt;&lt;</span><span class="num" id="5438752">4</span><span class="op" id="5438753">|</span><span class="builtintype" id="5438754">int32</span><span class="op" id="5438759">(</span><span class="ident" id="5438760"><a href="/image/jpeg/writer.go.html#5438617">nBits</a></span><span class="op" id="5438765">)</span><span class="op" id="5438766">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438769">if</span>&nbsp;<span class="ident" id="5438772"><a href="/image/jpeg/writer.go.html#5438617">nBits</a></span>&nbsp;<span class="op" id="5438778">&gt;</span>&nbsp;<span class="num" id="5438780">0</span>&nbsp;<span class="op" id="5438782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438786"><a href="/image/jpeg/writer.go.html#5438487">e</a></span><span class="op" id="5438787">.</span><span class="ident" id="5438788">emit</span><span class="op" id="5438792">(</span><span class="builtintype" id="5438793">uint32</span><span class="op" id="5438799">(</span><span class="ident" id="5438800"><a href="/image/jpeg/writer.go.html#5438554">b</a></span><span class="op" id="5438801">)</span><span class="op" id="5438802">&amp;</span><span class="op" id="5438803">(</span><span class="num" id="5438804">1</span><span class="op" id="5438805">&lt;&lt;</span><span class="ident" id="5438807"><a href="/image/jpeg/writer.go.html#5438617">nBits</a></span><span class="op" id="5438812">-</span><span class="num" id="5438813">1</span><span class="op" id="5438814">)</span><span class="op" id="5438815">,</span>&nbsp;<span class="ident" id="5438817"><a href="/image/jpeg/writer.go.html#5438617">nBits</a></span><span class="op" id="5438822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438825">}</span><br>
<span class="lineno"></span><span class="op" id="5438827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="5438830">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5438905">func</span>&nbsp;<span class="op" id="5438910">(</span><span class="ident" id="5438911">e</span>&nbsp;<span class="op" id="5438913">*</span><span class="ident" id="5438914"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5438921">)</span>&nbsp;<span class="ident" id="5438923">writeMarkerHeader</span><span class="op" id="5438940">(</span><span class="ident" id="5438941">marker</span>&nbsp;<span class="builtintype" id="5438948">uint8</span><span class="op" id="5438953">,</span>&nbsp;<span class="ident" id="5438955">markerlen</span>&nbsp;<span class="builtintype" id="5438965">int</span><span class="op" id="5438968">)</span>&nbsp;<span class="op" id="5438970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438973"><a href="/image/jpeg/writer.go.html#5438911">e</a></span><span class="op" id="5438974">.</span><span class="ident" id="5438975">buf</span><span class="op" id="5438978">[</span><span class="num" id="5438979">0</span><span class="op" id="5438980">]</span>&nbsp;<span class="op" id="5438982">=</span>&nbsp;<span class="num" id="5438984">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438990"><a href="/image/jpeg/writer.go.html#5438911">e</a></span><span class="op" id="5438991">.</span><span class="ident" id="5438992">buf</span><span class="op" id="5438995">[</span><span class="num" id="5438996">1</span><span class="op" id="5438997">]</span>&nbsp;<span class="op" id="5438999">=</span>&nbsp;<span class="ident" id="5439001"><a href="/image/jpeg/writer.go.html#5438941">marker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439009"><a href="/image/jpeg/writer.go.html#5438911">e</a></span><span class="op" id="5439010">.</span><span class="ident" id="5439011">buf</span><span class="op" id="5439014">[</span><span class="num" id="5439015">2</span><span class="op" id="5439016">]</span>&nbsp;<span class="op" id="5439018">=</span>&nbsp;<span class="builtintype" id="5439020">uint8</span><span class="op" id="5439025">(</span><span class="ident" id="5439026"><a href="/image/jpeg/writer.go.html#5438955">markerlen</a></span>&nbsp;<span class="op" id="5439036">&gt;&gt;</span>&nbsp;<span class="num" id="5439039">8</span><span class="op" id="5439040">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439043"><a href="/image/jpeg/writer.go.html#5438911">e</a></span><span class="op" id="5439044">.</span><span class="ident" id="5439045">buf</span><span class="op" id="5439048">[</span><span class="num" id="5439049">3</span><span class="op" id="5439050">]</span>&nbsp;<span class="op" id="5439052">=</span>&nbsp;<span class="builtintype" id="5439054">uint8</span><span class="op" id="5439059">(</span><span class="ident" id="5439060"><a href="/image/jpeg/writer.go.html#5438955">markerlen</a></span>&nbsp;<span class="op" id="5439070">&amp;</span>&nbsp;<span class="num" id="5439072">0xff</span><span class="op" id="5439076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439079"><a href="/image/jpeg/writer.go.html#5438911">e</a></span><span class="op" id="5439080">.</span><span class="ident" id="5439081">write</span><span class="op" id="5439086">(</span><span class="ident" id="5439087"><a href="/image/jpeg/writer.go.html#5438911">e</a></span><span class="op" id="5439088">.</span><span class="ident" id="5439089">buf</span><span class="op" id="5439092">[</span><span class="op" id="5439093">:</span><span class="num" id="5439094">4</span><span class="op" id="5439095">]</span><span class="op" id="5439096">)</span><br>
<span class="lineno"></span><span class="op" id="5439098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5439101">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="5439158">func</span>&nbsp;<span class="op" id="5439163">(</span><span class="ident" id="5439164">e</span>&nbsp;<span class="op" id="5439166">*</span><span class="ident" id="5439167"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5439174">)</span>&nbsp;<span class="ident" id="5439176">writeDQT</span><span class="op" id="5439184">(</span><span class="op" id="5439185">)</span>&nbsp;<span class="op" id="5439187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439190">const</span>&nbsp;<span class="ident" id="5439196">markerlen</span>&nbsp;<span class="op" id="5439206">=</span>&nbsp;<span class="num" id="5439208">2</span>&nbsp;<span class="op" id="5439210">+</span>&nbsp;<span class="builtintype" id="5439212">int</span><span class="op" id="5439215">(</span><span class="ident" id="5439216"><a href="/image/jpeg/writer.go.html#5432115">nQuantIndex</a></span><span class="op" id="5439227">)</span><span class="op" id="5439228">*</span><span class="op" id="5439229">(</span><span class="num" id="5439230">1</span><span class="op" id="5439231">+</span><span class="ident" id="5439232"><a href="/image/jpeg/idct.go.html#5398910">blockSize</a></span><span class="op" id="5439241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439244"><a href="/image/jpeg/writer.go.html#5439164">e</a></span><span class="op" id="5439245">.</span><span class="ident" id="5439246">writeMarkerHeader</span><span class="op" id="5439263">(</span><span class="ident" id="5439264"><a href="/image/jpeg/reader.go.html#5404237">dqtMarker</a></span><span class="op" id="5439273">,</span>&nbsp;<span class="ident" id="5439275"><a href="/image/jpeg/writer.go.html#5439196">markerlen</a></span><span class="op" id="5439284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439287">for</span>&nbsp;<span class="ident" id="5439291">i</span>&nbsp;<span class="op" id="5439293">:=</span>&nbsp;<span class="keyword" id="5439296">range</span>&nbsp;<span class="ident" id="5439302"><a href="/image/jpeg/writer.go.html#5439164">e</a></span><span class="op" id="5439303">.</span><span class="ident" id="5439304">quant</span>&nbsp;<span class="op" id="5439310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439314"><a href="/image/jpeg/writer.go.html#5439164">e</a></span><span class="op" id="5439315">.</span><span class="ident" id="5439316">writeByte</span><span class="op" id="5439325">(</span><span class="builtintype" id="5439326">uint8</span><span class="op" id="5439331">(</span><span class="ident" id="5439332"><a href="/image/jpeg/writer.go.html#5439291">i</a></span><span class="op" id="5439333">)</span><span class="op" id="5439334">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439338"><a href="/image/jpeg/writer.go.html#5439164">e</a></span><span class="op" id="5439339">.</span><span class="ident" id="5439340">write</span><span class="op" id="5439345">(</span><span class="ident" id="5439346"><a href="/image/jpeg/writer.go.html#5439164">e</a></span><span class="op" id="5439347">.</span><span class="ident" id="5439348">quant</span><span class="op" id="5439353">[</span><span class="ident" id="5439354"><a href="/image/jpeg/writer.go.html#5439291">i</a></span><span class="op" id="5439355">]</span><span class="op" id="5439356">[</span><span class="op" id="5439357">:</span><span class="op" id="5439358">]</span><span class="op" id="5439359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5439362">}</span><br>
<span class="lineno"></span><span class="op" id="5439364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5439367">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="5439425">func</span>&nbsp;<span class="op" id="5439430">(</span><span class="ident" id="5439431">e</span>&nbsp;<span class="op" id="5439433">*</span><span class="ident" id="5439434"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5439441">)</span>&nbsp;<span class="ident" id="5439443">writeSOF0</span><span class="op" id="5439452">(</span><span class="ident" id="5439453">size</span>&nbsp;<span class="ident" id="5439458"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5439463">.</span><span class="ident" id="5439464">Point</span><span class="op" id="5439469">,</span>&nbsp;<span class="ident" id="5439471">nComponent</span>&nbsp;<span class="builtintype" id="5439482">int</span><span class="op" id="5439485">)</span>&nbsp;<span class="op" id="5439487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439490">markerlen</span>&nbsp;<span class="op" id="5439500">:=</span>&nbsp;<span class="num" id="5439503">8</span>&nbsp;<span class="op" id="5439505">+</span>&nbsp;<span class="num" id="5439507">3</span><span class="op" id="5439508">*</span><span class="ident" id="5439509"><a href="/image/jpeg/writer.go.html#5439471">nComponent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439521"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439522">.</span><span class="ident" id="5439523">writeMarkerHeader</span><span class="op" id="5439540">(</span><span class="ident" id="5439541"><a href="/image/jpeg/reader.go.html#5404089">sof0Marker</a></span><span class="op" id="5439551">,</span>&nbsp;<span class="ident" id="5439553"><a href="/image/jpeg/writer.go.html#5439490">markerlen</a></span><span class="op" id="5439562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439565"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439566">.</span><span class="ident" id="5439567">buf</span><span class="op" id="5439570">[</span><span class="num" id="5439571">0</span><span class="op" id="5439572">]</span>&nbsp;<span class="op" id="5439574">=</span>&nbsp;<span class="num" id="5439576">8</span>&nbsp;<span class="comment" id="5439578">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439595"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439596">.</span><span class="ident" id="5439597">buf</span><span class="op" id="5439600">[</span><span class="num" id="5439601">1</span><span class="op" id="5439602">]</span>&nbsp;<span class="op" id="5439604">=</span>&nbsp;<span class="builtintype" id="5439606">uint8</span><span class="op" id="5439611">(</span><span class="ident" id="5439612"><a href="/image/jpeg/writer.go.html#5439453">size</a></span><span class="op" id="5439616">.</span><span class="ident" id="5439617">Y</span>&nbsp;<span class="op" id="5439619">&gt;&gt;</span>&nbsp;<span class="num" id="5439622">8</span><span class="op" id="5439623">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439626"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439627">.</span><span class="ident" id="5439628">buf</span><span class="op" id="5439631">[</span><span class="num" id="5439632">2</span><span class="op" id="5439633">]</span>&nbsp;<span class="op" id="5439635">=</span>&nbsp;<span class="builtintype" id="5439637">uint8</span><span class="op" id="5439642">(</span><span class="ident" id="5439643"><a href="/image/jpeg/writer.go.html#5439453">size</a></span><span class="op" id="5439647">.</span><span class="ident" id="5439648">Y</span>&nbsp;<span class="op" id="5439650">&amp;</span>&nbsp;<span class="num" id="5439652">0xff</span><span class="op" id="5439656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439659"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439660">.</span><span class="ident" id="5439661">buf</span><span class="op" id="5439664">[</span><span class="num" id="5439665">3</span><span class="op" id="5439666">]</span>&nbsp;<span class="op" id="5439668">=</span>&nbsp;<span class="builtintype" id="5439670">uint8</span><span class="op" id="5439675">(</span><span class="ident" id="5439676"><a href="/image/jpeg/writer.go.html#5439453">size</a></span><span class="op" id="5439680">.</span><span class="ident" id="5439681">X</span>&nbsp;<span class="op" id="5439683">&gt;&gt;</span>&nbsp;<span class="num" id="5439686">8</span><span class="op" id="5439687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439690"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439691">.</span><span class="ident" id="5439692">buf</span><span class="op" id="5439695">[</span><span class="num" id="5439696">4</span><span class="op" id="5439697">]</span>&nbsp;<span class="op" id="5439699">=</span>&nbsp;<span class="builtintype" id="5439701">uint8</span><span class="op" id="5439706">(</span><span class="ident" id="5439707"><a href="/image/jpeg/writer.go.html#5439453">size</a></span><span class="op" id="5439711">.</span><span class="ident" id="5439712">X</span>&nbsp;<span class="op" id="5439714">&amp;</span>&nbsp;<span class="num" id="5439716">0xff</span><span class="op" id="5439720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439723"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439724">.</span><span class="ident" id="5439725">buf</span><span class="op" id="5439728">[</span><span class="num" id="5439729">5</span><span class="op" id="5439730">]</span>&nbsp;<span class="op" id="5439732">=</span>&nbsp;<span class="builtintype" id="5439734">uint8</span><span class="op" id="5439739">(</span><span class="ident" id="5439740"><a href="/image/jpeg/writer.go.html#5439471">nComponent</a></span><span class="op" id="5439750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439753">if</span>&nbsp;<span class="ident" id="5439756"><a href="/image/jpeg/writer.go.html#5439471">nComponent</a></span>&nbsp;<span class="op" id="5439767">==</span>&nbsp;<span class="num" id="5439770">1</span>&nbsp;<span class="op" id="5439772">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439776"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439777">.</span><span class="ident" id="5439778">buf</span><span class="op" id="5439781">[</span><span class="num" id="5439782">6</span><span class="op" id="5439783">]</span>&nbsp;<span class="op" id="5439785">=</span>&nbsp;<span class="num" id="5439787">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5439791">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439832"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439833">.</span><span class="ident" id="5439834">buf</span><span class="op" id="5439837">[</span><span class="num" id="5439838">7</span><span class="op" id="5439839">]</span>&nbsp;<span class="op" id="5439841">=</span>&nbsp;<span class="num" id="5439843">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439850"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439851">.</span><span class="ident" id="5439852">buf</span><span class="op" id="5439855">[</span><span class="num" id="5439856">8</span><span class="op" id="5439857">]</span>&nbsp;<span class="op" id="5439859">=</span>&nbsp;<span class="num" id="5439861">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5439867">}</span>&nbsp;<span class="keyword" id="5439869">else</span>&nbsp;<span class="op" id="5439874">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439878">for</span>&nbsp;<span class="ident" id="5439882">i</span>&nbsp;<span class="op" id="5439884">:=</span>&nbsp;<span class="num" id="5439887">0</span><span class="op" id="5439888">;</span>&nbsp;<span class="ident" id="5439890"><a href="/image/jpeg/writer.go.html#5439882">i</a></span>&nbsp;<span class="op" id="5439892">&lt;</span>&nbsp;<span class="ident" id="5439894"><a href="/image/jpeg/writer.go.html#5439471">nComponent</a></span><span class="op" id="5439904">;</span>&nbsp;<span class="ident" id="5439906"><a href="/image/jpeg/writer.go.html#5439882">i</a></span><span class="op" id="5439907">++</span>&nbsp;<span class="op" id="5439910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439915"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439916">.</span><span class="ident" id="5439917">buf</span><span class="op" id="5439920">[</span><span class="num" id="5439921">3</span><span class="op" id="5439922">*</span><span class="ident" id="5439923"><a href="/image/jpeg/writer.go.html#5439882">i</a></span><span class="op" id="5439924">+</span><span class="num" id="5439925">6</span><span class="op" id="5439926">]</span>&nbsp;<span class="op" id="5439928">=</span>&nbsp;<span class="builtintype" id="5439930">uint8</span><span class="op" id="5439935">(</span><span class="ident" id="5439936"><a href="/image/jpeg/writer.go.html#5439882">i</a></span>&nbsp;<span class="op" id="5439938">+</span>&nbsp;<span class="num" id="5439940">1</span><span class="op" id="5439941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5439946">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439985"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5439986">.</span><span class="ident" id="5439987">buf</span><span class="op" id="5439990">[</span><span class="num" id="5439991">3</span><span class="op" id="5439992">*</span><span class="ident" id="5439993"><a href="/image/jpeg/writer.go.html#5439882">i</a></span><span class="op" id="5439994">+</span><span class="num" id="5439995">7</span><span class="op" id="5439996">]</span>&nbsp;<span class="op" id="5439998">=</span>&nbsp;<span class="string" id="5440000">&#34;\x22\x11\x11&#34;</span><span class="op" id="5440014">[</span><span class="ident" id="5440015"><a href="/image/jpeg/writer.go.html#5439882">i</a></span><span class="op" id="5440016">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440021"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5440022">.</span><span class="ident" id="5440023">buf</span><span class="op" id="5440026">[</span><span class="num" id="5440027">3</span><span class="op" id="5440028">*</span><span class="ident" id="5440029"><a href="/image/jpeg/writer.go.html#5439882">i</a></span><span class="op" id="5440030">+</span><span class="num" id="5440031">8</span><span class="op" id="5440032">]</span>&nbsp;<span class="op" id="5440034">=</span>&nbsp;<span class="string" id="5440036">&#34;\x00\x01\x01&#34;</span><span class="op" id="5440050">[</span><span class="ident" id="5440051"><a href="/image/jpeg/writer.go.html#5439882">i</a></span><span class="op" id="5440052">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5440056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5440059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440062"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5440063">.</span><span class="ident" id="5440064">write</span><span class="op" id="5440069">(</span><span class="ident" id="5440070"><a href="/image/jpeg/writer.go.html#5439431">e</a></span><span class="op" id="5440071">.</span><span class="ident" id="5440072">buf</span><span class="op" id="5440075">[</span><span class="op" id="5440076">:</span><span class="num" id="5440077">3</span><span class="op" id="5440078">*</span><span class="op" id="5440079">(</span><span class="ident" id="5440080"><a href="/image/jpeg/writer.go.html#5439471">nComponent</a></span><span class="op" id="5440090">-</span><span class="num" id="5440091">1</span><span class="op" id="5440092">)</span><span class="op" id="5440093">+</span><span class="num" id="5440094">9</span><span class="op" id="5440095">]</span><span class="op" id="5440096">)</span><br>
<span class="lineno"></span><span class="op" id="5440098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="5440101">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="5440153">func</span>&nbsp;<span class="op" id="5440158">(</span><span class="ident" id="5440159">e</span>&nbsp;<span class="op" id="5440161">*</span><span class="ident" id="5440162"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5440169">)</span>&nbsp;<span class="ident" id="5440171">writeDHT</span><span class="op" id="5440179">(</span><span class="ident" id="5440180">nComponent</span>&nbsp;<span class="builtintype" id="5440191">int</span><span class="op" id="5440194">)</span>&nbsp;<span class="op" id="5440196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440199">markerlen</span>&nbsp;<span class="op" id="5440209">:=</span>&nbsp;<span class="num" id="5440212">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440215">specs</span>&nbsp;<span class="op" id="5440221">:=</span>&nbsp;<span class="ident" id="5440224"><a href="/image/jpeg/writer.go.html#5433522">theHuffmanSpec</a></span><span class="op" id="5440238">[</span><span class="op" id="5440239">:</span><span class="op" id="5440240">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440243">if</span>&nbsp;<span class="ident" id="5440246"><a href="/image/jpeg/writer.go.html#5440180">nComponent</a></span>&nbsp;<span class="op" id="5440257">==</span>&nbsp;<span class="num" id="5440260">1</span>&nbsp;<span class="op" id="5440262">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440266">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440300"><a href="/image/jpeg/writer.go.html#5440215">specs</a></span>&nbsp;<span class="op" id="5440306">=</span>&nbsp;<span class="ident" id="5440308"><a href="/image/jpeg/writer.go.html#5440215">specs</a></span><span class="op" id="5440313">[</span><span class="op" id="5440314">:</span><span class="num" id="5440315">2</span><span class="op" id="5440316">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5440319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440322">for</span>&nbsp;<span class="ident" id="5440326">_</span><span class="op" id="5440327">,</span>&nbsp;<span class="ident" id="5440329">s</span>&nbsp;<span class="op" id="5440331">:=</span>&nbsp;<span class="keyword" id="5440334">range</span>&nbsp;<span class="ident" id="5440340"><a href="/image/jpeg/writer.go.html#5440215">specs</a></span>&nbsp;<span class="op" id="5440346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440350"><a href="/image/jpeg/writer.go.html#5440199">markerlen</a></span>&nbsp;<span class="op" id="5440360">+=</span>&nbsp;<span class="num" id="5440363">1</span>&nbsp;<span class="op" id="5440365">+</span>&nbsp;<span class="num" id="5440367">16</span>&nbsp;<span class="op" id="5440370">+</span>&nbsp;<span class="builtinfunc" id="5440372">len</span><span class="op" id="5440375">(</span><span class="ident" id="5440376"><a href="/image/jpeg/writer.go.html#5440329">s</a></span><span class="op" id="5440377">.</span><span class="ident" id="5440378">value</span><span class="op" id="5440383">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5440386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440389"><a href="/image/jpeg/writer.go.html#5440159">e</a></span><span class="op" id="5440390">.</span><span class="ident" id="5440391">writeMarkerHeader</span><span class="op" id="5440408">(</span><span class="ident" id="5440409"><a href="/image/jpeg/reader.go.html#5404192">dhtMarker</a></span><span class="op" id="5440418">,</span>&nbsp;<span class="ident" id="5440420"><a href="/image/jpeg/writer.go.html#5440199">markerlen</a></span><span class="op" id="5440429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440432">for</span>&nbsp;<span class="ident" id="5440436">i</span><span class="op" id="5440437">,</span>&nbsp;<span class="ident" id="5440439">s</span>&nbsp;<span class="op" id="5440441">:=</span>&nbsp;<span class="keyword" id="5440444">range</span>&nbsp;<span class="ident" id="5440450"><a href="/image/jpeg/writer.go.html#5440215">specs</a></span>&nbsp;<span class="op" id="5440456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440460"><a href="/image/jpeg/writer.go.html#5440159">e</a></span><span class="op" id="5440461">.</span><span class="ident" id="5440462">writeByte</span><span class="op" id="5440471">(</span><span class="string" id="5440472">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="5440490">[</span><span class="ident" id="5440491"><a href="/image/jpeg/writer.go.html#5440436">i</a></span><span class="op" id="5440492">]</span><span class="op" id="5440493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440497"><a href="/image/jpeg/writer.go.html#5440159">e</a></span><span class="op" id="5440498">.</span><span class="ident" id="5440499">write</span><span class="op" id="5440504">(</span><span class="ident" id="5440505"><a href="/image/jpeg/writer.go.html#5440439">s</a></span><span class="op" id="5440506">.</span><span class="ident" id="5440507">count</span><span class="op" id="5440512">[</span><span class="op" id="5440513">:</span><span class="op" id="5440514">]</span><span class="op" id="5440515">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440519"><a href="/image/jpeg/writer.go.html#5440159">e</a></span><span class="op" id="5440520">.</span><span class="ident" id="5440521">write</span><span class="op" id="5440526">(</span><span class="ident" id="5440527"><a href="/image/jpeg/writer.go.html#5440439">s</a></span><span class="op" id="5440528">.</span><span class="ident" id="5440529">value</span><span class="op" id="5440534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5440537">}</span><br>
<span class="lineno"></span><span class="op" id="5440539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5440542">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="5440621">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5440700">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5440732">func</span>&nbsp;<span class="op" id="5440737">(</span><span class="ident" id="5440738">e</span>&nbsp;<span class="op" id="5440740">*</span><span class="ident" id="5440741"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5440748">)</span>&nbsp;<span class="ident" id="5440750">writeBlock</span><span class="op" id="5440760">(</span><span class="ident" id="5440761">b</span>&nbsp;<span class="op" id="5440763">*</span><span class="ident" id="5440764"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><span class="op" id="5440769">,</span>&nbsp;<span class="ident" id="5440771">q</span>&nbsp;<span class="ident" id="5440773"><a href="/image/jpeg/writer.go.html#5432028">quantIndex</a></span><span class="op" id="5440783">,</span>&nbsp;<span class="ident" id="5440785">prevDC</span>&nbsp;<span class="builtintype" id="5440792">int32</span><span class="op" id="5440797">)</span>&nbsp;<span class="builtintype" id="5440799">int32</span>&nbsp;<span class="op" id="5440805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440808"><a href="/image/jpeg/fdct.go.html#5387964">fdct</a></span><span class="op" id="5440812">(</span><span class="ident" id="5440813"><a href="/image/jpeg/writer.go.html#5440761">b</a></span><span class="op" id="5440814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440817">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440840">dc</span>&nbsp;<span class="op" id="5440843">:=</span>&nbsp;<span class="ident" id="5440846"><a href="/image/jpeg/writer.go.html#5431043">div</a></span><span class="op" id="5440849">(</span><span class="ident" id="5440850"><a href="/image/jpeg/writer.go.html#5440761">b</a></span><span class="op" id="5440851">[</span><span class="num" id="5440852">0</span><span class="op" id="5440853">]</span><span class="op" id="5440854">,</span>&nbsp;<span class="num" id="5440856">8</span><span class="op" id="5440857">*</span><span class="builtintype" id="5440858">int32</span><span class="op" id="5440863">(</span><span class="ident" id="5440864"><a href="/image/jpeg/writer.go.html#5440738">e</a></span><span class="op" id="5440865">.</span><span class="ident" id="5440866">quant</span><span class="op" id="5440871">[</span><span class="ident" id="5440872"><a href="/image/jpeg/writer.go.html#5440771">q</a></span><span class="op" id="5440873">]</span><span class="op" id="5440874">[</span><span class="num" id="5440875">0</span><span class="op" id="5440876">]</span><span class="op" id="5440877">)</span><span class="op" id="5440878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440881"><a href="/image/jpeg/writer.go.html#5440738">e</a></span><span class="op" id="5440882">.</span><span class="ident" id="5440883">emitHuffRLE</span><span class="op" id="5440894">(</span><span class="ident" id="5440895"><a href="/image/jpeg/writer.go.html#5433036">huffIndex</a></span><span class="op" id="5440904">(</span><span class="num" id="5440905">2</span><span class="op" id="5440906">*</span><span class="ident" id="5440907"><a href="/image/jpeg/writer.go.html#5440771">q</a></span><span class="op" id="5440908">+</span><span class="num" id="5440909">0</span><span class="op" id="5440910">)</span><span class="op" id="5440911">,</span>&nbsp;<span class="num" id="5440913">0</span><span class="op" id="5440914">,</span>&nbsp;<span class="ident" id="5440916"><a href="/image/jpeg/writer.go.html#5440840">dc</a></span><span class="op" id="5440918">-</span><span class="ident" id="5440919"><a href="/image/jpeg/writer.go.html#5440785">prevDC</a></span><span class="op" id="5440925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440928">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440956">h</span><span class="op" id="5440957">,</span>&nbsp;<span class="ident" id="5440959">runLength</span>&nbsp;<span class="op" id="5440969">:=</span>&nbsp;<span class="ident" id="5440972"><a href="/image/jpeg/writer.go.html#5433036">huffIndex</a></span><span class="op" id="5440981">(</span><span class="num" id="5440982">2</span><span class="op" id="5440983">*</span><span class="ident" id="5440984"><a href="/image/jpeg/writer.go.html#5440771">q</a></span><span class="op" id="5440985">+</span><span class="num" id="5440986">1</span><span class="op" id="5440987">)</span><span class="op" id="5440988">,</span>&nbsp;<span class="builtintype" id="5440990">int32</span><span class="op" id="5440995">(</span><span class="num" id="5440996">0</span><span class="op" id="5440997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441000">for</span>&nbsp;<span class="ident" id="5441004">zig</span>&nbsp;<span class="op" id="5441008">:=</span>&nbsp;<span class="num" id="5441011">1</span><span class="op" id="5441012">;</span>&nbsp;<span class="ident" id="5441014"><a href="/image/jpeg/writer.go.html#5441004">zig</a></span>&nbsp;<span class="op" id="5441018">&lt;</span>&nbsp;<span class="ident" id="5441020"><a href="/image/jpeg/idct.go.html#5398910">blockSize</a></span><span class="op" id="5441029">;</span>&nbsp;<span class="ident" id="5441031"><a href="/image/jpeg/writer.go.html#5441004">zig</a></span><span class="op" id="5441034">++</span>&nbsp;<span class="op" id="5441037">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441041">ac</span>&nbsp;<span class="op" id="5441044">:=</span>&nbsp;<span class="ident" id="5441047"><a href="/image/jpeg/writer.go.html#5431043">div</a></span><span class="op" id="5441050">(</span><span class="ident" id="5441051"><a href="/image/jpeg/writer.go.html#5440761">b</a></span><span class="op" id="5441052">[</span><span class="ident" id="5441053"><a href="/image/jpeg/reader.go.html#5404818">unzig</a></span><span class="op" id="5441058">[</span><span class="ident" id="5441059"><a href="/image/jpeg/writer.go.html#5441004">zig</a></span><span class="op" id="5441062">]</span><span class="op" id="5441063">]</span><span class="op" id="5441064">,</span>&nbsp;<span class="num" id="5441066">8</span><span class="op" id="5441067">*</span><span class="builtintype" id="5441068">int32</span><span class="op" id="5441073">(</span><span class="ident" id="5441074"><a href="/image/jpeg/writer.go.html#5440738">e</a></span><span class="op" id="5441075">.</span><span class="ident" id="5441076">quant</span><span class="op" id="5441081">[</span><span class="ident" id="5441082"><a href="/image/jpeg/writer.go.html#5440771">q</a></span><span class="op" id="5441083">]</span><span class="op" id="5441084">[</span><span class="ident" id="5441085"><a href="/image/jpeg/writer.go.html#5441004">zig</a></span><span class="op" id="5441088">]</span><span class="op" id="5441089">)</span><span class="op" id="5441090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441094">if</span>&nbsp;<span class="ident" id="5441097"><a href="/image/jpeg/writer.go.html#5441041">ac</a></span>&nbsp;<span class="op" id="5441100">==</span>&nbsp;<span class="num" id="5441103">0</span>&nbsp;<span class="op" id="5441105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441110"><a href="/image/jpeg/writer.go.html#5440959">runLength</a></span><span class="op" id="5441119">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441124">}</span>&nbsp;<span class="keyword" id="5441126">else</span>&nbsp;<span class="op" id="5441131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441136">for</span>&nbsp;<span class="ident" id="5441140"><a href="/image/jpeg/writer.go.html#5440959">runLength</a></span>&nbsp;<span class="op" id="5441150">&gt;</span>&nbsp;<span class="num" id="5441152">15</span>&nbsp;<span class="op" id="5441155">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441161"><a href="/image/jpeg/writer.go.html#5440738">e</a></span><span class="op" id="5441162">.</span><span class="ident" id="5441163">emitHuff</span><span class="op" id="5441171">(</span><span class="ident" id="5441172"><a href="/image/jpeg/writer.go.html#5440956">h</a></span><span class="op" id="5441173">,</span>&nbsp;<span class="num" id="5441175">0xf0</span><span class="op" id="5441179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441185"><a href="/image/jpeg/writer.go.html#5440959">runLength</a></span>&nbsp;<span class="op" id="5441195">-=</span>&nbsp;<span class="num" id="5441198">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441209"><a href="/image/jpeg/writer.go.html#5440738">e</a></span><span class="op" id="5441210">.</span><span class="ident" id="5441211">emitHuffRLE</span><span class="op" id="5441222">(</span><span class="ident" id="5441223"><a href="/image/jpeg/writer.go.html#5440956">h</a></span><span class="op" id="5441224">,</span>&nbsp;<span class="ident" id="5441226"><a href="/image/jpeg/writer.go.html#5440959">runLength</a></span><span class="op" id="5441235">,</span>&nbsp;<span class="ident" id="5441237"><a href="/image/jpeg/writer.go.html#5441041">ac</a></span><span class="op" id="5441239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441244"><a href="/image/jpeg/writer.go.html#5440959">runLength</a></span>&nbsp;<span class="op" id="5441254">=</span>&nbsp;<span class="num" id="5441256">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441266">if</span>&nbsp;<span class="ident" id="5441269"><a href="/image/jpeg/writer.go.html#5440959">runLength</a></span>&nbsp;<span class="op" id="5441279">&gt;</span>&nbsp;<span class="num" id="5441281">0</span>&nbsp;<span class="op" id="5441283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441287"><a href="/image/jpeg/writer.go.html#5440738">e</a></span><span class="op" id="5441288">.</span><span class="ident" id="5441289">emitHuff</span><span class="op" id="5441297">(</span><span class="ident" id="5441298"><a href="/image/jpeg/writer.go.html#5440956">h</a></span><span class="op" id="5441299">,</span>&nbsp;<span class="num" id="5441301">0x00</span><span class="op" id="5441305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441308">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441311">return</span>&nbsp;<span class="ident" id="5441318"><a href="/image/jpeg/writer.go.html#5440840">dc</a></span><br>
<span class="lineno"></span><span class="op" id="5441321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441324">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5441398">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="5441415">func</span>&nbsp;<span class="ident" id="5441420">toYCbCr</span><span class="op" id="5441427">(</span><span class="ident" id="5441428">m</span>&nbsp;<span class="ident" id="5441430"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5441435">.</span><span class="ident" id="5441436">Image</span><span class="op" id="5441441">,</span>&nbsp;<span class="ident" id="5441443">p</span>&nbsp;<span class="ident" id="5441445"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5441450">.</span><span class="ident" id="5441451">Point</span><span class="op" id="5441456">,</span>&nbsp;<span class="ident" id="5441458">yBlock</span><span class="op" id="5441464">,</span>&nbsp;<span class="ident" id="5441466">cbBlock</span><span class="op" id="5441473">,</span>&nbsp;<span class="ident" id="5441475">crBlock</span>&nbsp;<span class="op" id="5441483">*</span><span class="ident" id="5441484"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><span class="op" id="5441489">)</span>&nbsp;<span class="op" id="5441491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441494">b</span>&nbsp;<span class="op" id="5441496">:=</span>&nbsp;<span class="ident" id="5441499"><a href="/image/jpeg/writer.go.html#5441428">m</a></span><span class="op" id="5441500">.</span><span class="ident" id="5441501">Bounds</span><span class="op" id="5441507">(</span><span class="op" id="5441508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441511">xmax</span>&nbsp;<span class="op" id="5441516">:=</span>&nbsp;<span class="ident" id="5441519"><a href="/image/jpeg/writer.go.html#5441494">b</a></span><span class="op" id="5441520">.</span><span class="ident" id="5441521">Max</span><span class="op" id="5441524">.</span><span class="ident" id="5441525">X</span>&nbsp;<span class="op" id="5441527">-</span>&nbsp;<span class="num" id="5441529">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441532">ymax</span>&nbsp;<span class="op" id="5441537">:=</span>&nbsp;<span class="ident" id="5441540"><a href="/image/jpeg/writer.go.html#5441494">b</a></span><span class="op" id="5441541">.</span><span class="ident" id="5441542">Max</span><span class="op" id="5441545">.</span><span class="ident" id="5441546">Y</span>&nbsp;<span class="op" id="5441548">-</span>&nbsp;<span class="num" id="5441550">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441553">for</span>&nbsp;<span class="ident" id="5441557">j</span>&nbsp;<span class="op" id="5441559">:=</span>&nbsp;<span class="num" id="5441562">0</span><span class="op" id="5441563">;</span>&nbsp;<span class="ident" id="5441565"><a href="/image/jpeg/writer.go.html#5441557">j</a></span>&nbsp;<span class="op" id="5441567">&lt;</span>&nbsp;<span class="num" id="5441569">8</span><span class="op" id="5441570">;</span>&nbsp;<span class="ident" id="5441572"><a href="/image/jpeg/writer.go.html#5441557">j</a></span><span class="op" id="5441573">++</span>&nbsp;<span class="op" id="5441576">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441580">for</span>&nbsp;<span class="ident" id="5441584">i</span>&nbsp;<span class="op" id="5441586">:=</span>&nbsp;<span class="num" id="5441589">0</span><span class="op" id="5441590">;</span>&nbsp;<span class="ident" id="5441592"><a href="/image/jpeg/writer.go.html#5441584">i</a></span>&nbsp;<span class="op" id="5441594">&lt;</span>&nbsp;<span class="num" id="5441596">8</span><span class="op" id="5441597">;</span>&nbsp;<span class="ident" id="5441599"><a href="/image/jpeg/writer.go.html#5441584">i</a></span><span class="op" id="5441600">++</span>&nbsp;<span class="op" id="5441603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441608">r</span><span class="op" id="5441609">,</span>&nbsp;<span class="ident" id="5441611">g</span><span class="op" id="5441612">,</span>&nbsp;<span class="ident" id="5441614">b</span><span class="op" id="5441615">,</span>&nbsp;<span class="ident" id="5441617">_</span>&nbsp;<span class="op" id="5441619">:=</span>&nbsp;<span class="ident" id="5441622"><a href="/image/jpeg/writer.go.html#5441428">m</a></span><span class="op" id="5441623">.</span><span class="ident" id="5441624">At</span><span class="op" id="5441626">(</span><span class="ident" id="5441627"><a href="/image/jpeg/writer.go.html#5430900">min</a></span><span class="op" id="5441630">(</span><span class="ident" id="5441631"><a href="/image/jpeg/writer.go.html#5441443">p</a></span><span class="op" id="5441632">.</span><span class="ident" id="5441633">X</span><span class="op" id="5441634">+</span><span class="ident" id="5441635"><a href="/image/jpeg/writer.go.html#5441584">i</a></span><span class="op" id="5441636">,</span>&nbsp;<span class="ident" id="5441638"><a href="/image/jpeg/writer.go.html#5441511">xmax</a></span><span class="op" id="5441642">)</span><span class="op" id="5441643">,</span>&nbsp;<span class="ident" id="5441645"><a href="/image/jpeg/writer.go.html#5430900">min</a></span><span class="op" id="5441648">(</span><span class="ident" id="5441649"><a href="/image/jpeg/writer.go.html#5441443">p</a></span><span class="op" id="5441650">.</span><span class="ident" id="5441651">Y</span><span class="op" id="5441652">+</span><span class="ident" id="5441653"><a href="/image/jpeg/writer.go.html#5441557">j</a></span><span class="op" id="5441654">,</span>&nbsp;<span class="ident" id="5441656"><a href="/image/jpeg/writer.go.html#5441532">ymax</a></span><span class="op" id="5441660">)</span><span class="op" id="5441661">)</span><span class="op" id="5441662">.</span><span class="ident" id="5441663">RGBA</span><span class="op" id="5441667">(</span><span class="op" id="5441668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441673">yy</span><span class="op" id="5441675">,</span>&nbsp;<span class="ident" id="5441677">cb</span><span class="op" id="5441679">,</span>&nbsp;<span class="ident" id="5441681">cr</span>&nbsp;<span class="op" id="5441684">:=</span>&nbsp;<span class="ident" id="5441687"><a href="/image/jpeg/writer.go.html#5430828">color</a></span><span class="op" id="5441692">.</span><span class="ident" id="5441693">RGBToYCbCr</span><span class="op" id="5441703">(</span><span class="builtintype" id="5441704">uint8</span><span class="op" id="5441709">(</span><span class="ident" id="5441710"><a href="/image/jpeg/writer.go.html#5441608">r</a></span><span class="op" id="5441711">&gt;&gt;</span><span class="num" id="5441713">8</span><span class="op" id="5441714">)</span><span class="op" id="5441715">,</span>&nbsp;<span class="builtintype" id="5441717">uint8</span><span class="op" id="5441722">(</span><span class="ident" id="5441723"><a href="/image/jpeg/writer.go.html#5441611">g</a></span><span class="op" id="5441724">&gt;&gt;</span><span class="num" id="5441726">8</span><span class="op" id="5441727">)</span><span class="op" id="5441728">,</span>&nbsp;<span class="builtintype" id="5441730">uint8</span><span class="op" id="5441735">(</span><span class="ident" id="5441736"><a href="/image/jpeg/writer.go.html#5441614">b</a></span><span class="op" id="5441737">&gt;&gt;</span><span class="num" id="5441739">8</span><span class="op" id="5441740">)</span><span class="op" id="5441741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441746"><a href="/image/jpeg/writer.go.html#5441458">yBlock</a></span><span class="op" id="5441752">[</span><span class="num" id="5441753">8</span><span class="op" id="5441754">*</span><span class="ident" id="5441755"><a href="/image/jpeg/writer.go.html#5441557">j</a></span><span class="op" id="5441756">+</span><span class="ident" id="5441757"><a href="/image/jpeg/writer.go.html#5441584">i</a></span><span class="op" id="5441758">]</span>&nbsp;<span class="op" id="5441760">=</span>&nbsp;<span class="builtintype" id="5441762">int32</span><span class="op" id="5441767">(</span><span class="ident" id="5441768"><a href="/image/jpeg/writer.go.html#5441673">yy</a></span><span class="op" id="5441770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441775"><a href="/image/jpeg/writer.go.html#5441466">cbBlock</a></span><span class="op" id="5441782">[</span><span class="num" id="5441783">8</span><span class="op" id="5441784">*</span><span class="ident" id="5441785"><a href="/image/jpeg/writer.go.html#5441557">j</a></span><span class="op" id="5441786">+</span><span class="ident" id="5441787"><a href="/image/jpeg/writer.go.html#5441584">i</a></span><span class="op" id="5441788">]</span>&nbsp;<span class="op" id="5441790">=</span>&nbsp;<span class="builtintype" id="5441792">int32</span><span class="op" id="5441797">(</span><span class="ident" id="5441798"><a href="/image/jpeg/writer.go.html#5441677">cb</a></span><span class="op" id="5441800">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441805"><a href="/image/jpeg/writer.go.html#5441475">crBlock</a></span><span class="op" id="5441812">[</span><span class="num" id="5441813">8</span><span class="op" id="5441814">*</span><span class="ident" id="5441815"><a href="/image/jpeg/writer.go.html#5441557">j</a></span><span class="op" id="5441816">+</span><span class="ident" id="5441817"><a href="/image/jpeg/writer.go.html#5441584">i</a></span><span class="op" id="5441818">]</span>&nbsp;<span class="op" id="5441820">=</span>&nbsp;<span class="builtintype" id="5441822">int32</span><span class="op" id="5441827">(</span><span class="ident" id="5441828"><a href="/image/jpeg/writer.go.html#5441681">cr</a></span><span class="op" id="5441830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441837">}</span><br>
<span class="lineno"></span><span class="op" id="5441839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5441842">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="5441918">func</span>&nbsp;<span class="ident" id="5441923">grayToY</span><span class="op" id="5441930">(</span><span class="ident" id="5441931">m</span>&nbsp;<span class="op" id="5441933">*</span><span class="ident" id="5441934"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5441939">.</span><span class="ident" id="5441940">Gray</span><span class="op" id="5441944">,</span>&nbsp;<span class="ident" id="5441946">p</span>&nbsp;<span class="ident" id="5441948"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5441953">.</span><span class="ident" id="5441954">Point</span><span class="op" id="5441959">,</span>&nbsp;<span class="ident" id="5441961">yBlock</span>&nbsp;<span class="op" id="5441968">*</span><span class="ident" id="5441969"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><span class="op" id="5441974">)</span>&nbsp;<span class="op" id="5441976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441979">b</span>&nbsp;<span class="op" id="5441981">:=</span>&nbsp;<span class="ident" id="5441984"><a href="/image/jpeg/writer.go.html#5441931">m</a></span><span class="op" id="5441985">.</span><span class="ident" id="5441986">Bounds</span><span class="op" id="5441992">(</span><span class="op" id="5441993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441996">xmax</span>&nbsp;<span class="op" id="5442001">:=</span>&nbsp;<span class="ident" id="5442004"><a href="/image/jpeg/writer.go.html#5441979">b</a></span><span class="op" id="5442005">.</span><span class="ident" id="5442006">Max</span><span class="op" id="5442009">.</span><span class="ident" id="5442010">X</span>&nbsp;<span class="op" id="5442012">-</span>&nbsp;<span class="num" id="5442014">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442017">ymax</span>&nbsp;<span class="op" id="5442022">:=</span>&nbsp;<span class="ident" id="5442025"><a href="/image/jpeg/writer.go.html#5441979">b</a></span><span class="op" id="5442026">.</span><span class="ident" id="5442027">Max</span><span class="op" id="5442030">.</span><span class="ident" id="5442031">Y</span>&nbsp;<span class="op" id="5442033">-</span>&nbsp;<span class="num" id="5442035">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442038">pix</span>&nbsp;<span class="op" id="5442042">:=</span>&nbsp;<span class="ident" id="5442045"><a href="/image/jpeg/writer.go.html#5441931">m</a></span><span class="op" id="5442046">.</span><span class="ident" id="5442047">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442052">for</span>&nbsp;<span class="ident" id="5442056">j</span>&nbsp;<span class="op" id="5442058">:=</span>&nbsp;<span class="num" id="5442061">0</span><span class="op" id="5442062">;</span>&nbsp;<span class="ident" id="5442064"><a href="/image/jpeg/writer.go.html#5442056">j</a></span>&nbsp;<span class="op" id="5442066">&lt;</span>&nbsp;<span class="num" id="5442068">8</span><span class="op" id="5442069">;</span>&nbsp;<span class="ident" id="5442071"><a href="/image/jpeg/writer.go.html#5442056">j</a></span><span class="op" id="5442072">++</span>&nbsp;<span class="op" id="5442075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442079">for</span>&nbsp;<span class="ident" id="5442083">i</span>&nbsp;<span class="op" id="5442085">:=</span>&nbsp;<span class="num" id="5442088">0</span><span class="op" id="5442089">;</span>&nbsp;<span class="ident" id="5442091"><a href="/image/jpeg/writer.go.html#5442083">i</a></span>&nbsp;<span class="op" id="5442093">&lt;</span>&nbsp;<span class="num" id="5442095">8</span><span class="op" id="5442096">;</span>&nbsp;<span class="ident" id="5442098"><a href="/image/jpeg/writer.go.html#5442083">i</a></span><span class="op" id="5442099">++</span>&nbsp;<span class="op" id="5442102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442107">idx</span>&nbsp;<span class="op" id="5442111">:=</span>&nbsp;<span class="ident" id="5442114"><a href="/image/jpeg/writer.go.html#5441931">m</a></span><span class="op" id="5442115">.</span><span class="ident" id="5442116">PixOffset</span><span class="op" id="5442125">(</span><span class="ident" id="5442126"><a href="/image/jpeg/writer.go.html#5430900">min</a></span><span class="op" id="5442129">(</span><span class="ident" id="5442130"><a href="/image/jpeg/writer.go.html#5441946">p</a></span><span class="op" id="5442131">.</span><span class="ident" id="5442132">X</span><span class="op" id="5442133">+</span><span class="ident" id="5442134"><a href="/image/jpeg/writer.go.html#5442083">i</a></span><span class="op" id="5442135">,</span>&nbsp;<span class="ident" id="5442137"><a href="/image/jpeg/writer.go.html#5441996">xmax</a></span><span class="op" id="5442141">)</span><span class="op" id="5442142">,</span>&nbsp;<span class="ident" id="5442144"><a href="/image/jpeg/writer.go.html#5430900">min</a></span><span class="op" id="5442147">(</span><span class="ident" id="5442148"><a href="/image/jpeg/writer.go.html#5441946">p</a></span><span class="op" id="5442149">.</span><span class="ident" id="5442150">Y</span><span class="op" id="5442151">+</span><span class="ident" id="5442152"><a href="/image/jpeg/writer.go.html#5442056">j</a></span><span class="op" id="5442153">,</span>&nbsp;<span class="ident" id="5442155"><a href="/image/jpeg/writer.go.html#5442017">ymax</a></span><span class="op" id="5442159">)</span><span class="op" id="5442160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442165"><a href="/image/jpeg/writer.go.html#5441961">yBlock</a></span><span class="op" id="5442171">[</span><span class="num" id="5442172">8</span><span class="op" id="5442173">*</span><span class="ident" id="5442174"><a href="/image/jpeg/writer.go.html#5442056">j</a></span><span class="op" id="5442175">+</span><span class="ident" id="5442176"><a href="/image/jpeg/writer.go.html#5442083">i</a></span><span class="op" id="5442177">]</span>&nbsp;<span class="op" id="5442179">=</span>&nbsp;<span class="builtintype" id="5442181">int32</span><span class="op" id="5442186">(</span><span class="ident" id="5442187"><a href="/image/jpeg/writer.go.html#5442038">pix</a></span><span class="op" id="5442190">[</span><span class="ident" id="5442191"><a href="/image/jpeg/writer.go.html#5442107">idx</a></span><span class="op" id="5442194">]</span><span class="op" id="5442195">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442202">}</span><br>
<span class="lineno"></span><span class="op" id="5442204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5442207">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="5442281">func</span>&nbsp;<span class="ident" id="5442286">rgbaToYCbCr</span><span class="op" id="5442297">(</span><span class="ident" id="5442298">m</span>&nbsp;<span class="op" id="5442300">*</span><span class="ident" id="5442301"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5442306">.</span><span class="ident" id="5442307">RGBA</span><span class="op" id="5442311">,</span>&nbsp;<span class="ident" id="5442313">p</span>&nbsp;<span class="ident" id="5442315"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5442320">.</span><span class="ident" id="5442321">Point</span><span class="op" id="5442326">,</span>&nbsp;<span class="ident" id="5442328">yBlock</span><span class="op" id="5442334">,</span>&nbsp;<span class="ident" id="5442336">cbBlock</span><span class="op" id="5442343">,</span>&nbsp;<span class="ident" id="5442345">crBlock</span>&nbsp;<span class="op" id="5442353">*</span><span class="ident" id="5442354"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><span class="op" id="5442359">)</span>&nbsp;<span class="op" id="5442361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442364">b</span>&nbsp;<span class="op" id="5442366">:=</span>&nbsp;<span class="ident" id="5442369"><a href="/image/jpeg/writer.go.html#5442298">m</a></span><span class="op" id="5442370">.</span><span class="ident" id="5442371">Bounds</span><span class="op" id="5442377">(</span><span class="op" id="5442378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442381">xmax</span>&nbsp;<span class="op" id="5442386">:=</span>&nbsp;<span class="ident" id="5442389"><a href="/image/jpeg/writer.go.html#5442364">b</a></span><span class="op" id="5442390">.</span><span class="ident" id="5442391">Max</span><span class="op" id="5442394">.</span><span class="ident" id="5442395">X</span>&nbsp;<span class="op" id="5442397">-</span>&nbsp;<span class="num" id="5442399">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442402">ymax</span>&nbsp;<span class="op" id="5442407">:=</span>&nbsp;<span class="ident" id="5442410"><a href="/image/jpeg/writer.go.html#5442364">b</a></span><span class="op" id="5442411">.</span><span class="ident" id="5442412">Max</span><span class="op" id="5442415">.</span><span class="ident" id="5442416">Y</span>&nbsp;<span class="op" id="5442418">-</span>&nbsp;<span class="num" id="5442420">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442423">for</span>&nbsp;<span class="ident" id="5442427">j</span>&nbsp;<span class="op" id="5442429">:=</span>&nbsp;<span class="num" id="5442432">0</span><span class="op" id="5442433">;</span>&nbsp;<span class="ident" id="5442435"><a href="/image/jpeg/writer.go.html#5442427">j</a></span>&nbsp;<span class="op" id="5442437">&lt;</span>&nbsp;<span class="num" id="5442439">8</span><span class="op" id="5442440">;</span>&nbsp;<span class="ident" id="5442442"><a href="/image/jpeg/writer.go.html#5442427">j</a></span><span class="op" id="5442443">++</span>&nbsp;<span class="op" id="5442446">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442450">sj</span>&nbsp;<span class="op" id="5442453">:=</span>&nbsp;<span class="ident" id="5442456"><a href="/image/jpeg/writer.go.html#5442313">p</a></span><span class="op" id="5442457">.</span><span class="ident" id="5442458">Y</span>&nbsp;<span class="op" id="5442460">+</span>&nbsp;<span class="ident" id="5442462"><a href="/image/jpeg/writer.go.html#5442427">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442466">if</span>&nbsp;<span class="ident" id="5442469"><a href="/image/jpeg/writer.go.html#5442450">sj</a></span>&nbsp;<span class="op" id="5442472">&gt;</span>&nbsp;<span class="ident" id="5442474"><a href="/image/jpeg/writer.go.html#5442402">ymax</a></span>&nbsp;<span class="op" id="5442479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442484"><a href="/image/jpeg/writer.go.html#5442450">sj</a></span>&nbsp;<span class="op" id="5442487">=</span>&nbsp;<span class="ident" id="5442489"><a href="/image/jpeg/writer.go.html#5442402">ymax</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442500">offset</span>&nbsp;<span class="op" id="5442507">:=</span>&nbsp;<span class="op" id="5442510">(</span><span class="ident" id="5442511"><a href="/image/jpeg/writer.go.html#5442450">sj</a></span><span class="op" id="5442513">-</span><span class="ident" id="5442514"><a href="/image/jpeg/writer.go.html#5442364">b</a></span><span class="op" id="5442515">.</span><span class="ident" id="5442516">Min</span><span class="op" id="5442519">.</span><span class="ident" id="5442520">Y</span><span class="op" id="5442521">)</span><span class="op" id="5442522">*</span><span class="ident" id="5442523"><a href="/image/jpeg/writer.go.html#5442298">m</a></span><span class="op" id="5442524">.</span><span class="ident" id="5442525">Stride</span>&nbsp;<span class="op" id="5442532">-</span>&nbsp;<span class="ident" id="5442534"><a href="/image/jpeg/writer.go.html#5442364">b</a></span><span class="op" id="5442535">.</span><span class="ident" id="5442536">Min</span><span class="op" id="5442539">.</span><span class="ident" id="5442540">X</span><span class="op" id="5442541">*</span><span class="num" id="5442542">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442546">for</span>&nbsp;<span class="ident" id="5442550">i</span>&nbsp;<span class="op" id="5442552">:=</span>&nbsp;<span class="num" id="5442555">0</span><span class="op" id="5442556">;</span>&nbsp;<span class="ident" id="5442558"><a href="/image/jpeg/writer.go.html#5442550">i</a></span>&nbsp;<span class="op" id="5442560">&lt;</span>&nbsp;<span class="num" id="5442562">8</span><span class="op" id="5442563">;</span>&nbsp;<span class="ident" id="5442565"><a href="/image/jpeg/writer.go.html#5442550">i</a></span><span class="op" id="5442566">++</span>&nbsp;<span class="op" id="5442569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442574">sx</span>&nbsp;<span class="op" id="5442577">:=</span>&nbsp;<span class="ident" id="5442580"><a href="/image/jpeg/writer.go.html#5442313">p</a></span><span class="op" id="5442581">.</span><span class="ident" id="5442582">X</span>&nbsp;<span class="op" id="5442584">+</span>&nbsp;<span class="ident" id="5442586"><a href="/image/jpeg/writer.go.html#5442550">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442591">if</span>&nbsp;<span class="ident" id="5442594"><a href="/image/jpeg/writer.go.html#5442574">sx</a></span>&nbsp;<span class="op" id="5442597">&gt;</span>&nbsp;<span class="ident" id="5442599"><a href="/image/jpeg/writer.go.html#5442381">xmax</a></span>&nbsp;<span class="op" id="5442604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442610"><a href="/image/jpeg/writer.go.html#5442574">sx</a></span>&nbsp;<span class="op" id="5442613">=</span>&nbsp;<span class="ident" id="5442615"><a href="/image/jpeg/writer.go.html#5442381">xmax</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442623">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442628">pix</span>&nbsp;<span class="op" id="5442632">:=</span>&nbsp;<span class="ident" id="5442635"><a href="/image/jpeg/writer.go.html#5442298">m</a></span><span class="op" id="5442636">.</span><span class="ident" id="5442637">Pix</span><span class="op" id="5442640">[</span><span class="ident" id="5442641"><a href="/image/jpeg/writer.go.html#5442500">offset</a></span><span class="op" id="5442647">+</span><span class="ident" id="5442648"><a href="/image/jpeg/writer.go.html#5442574">sx</a></span><span class="op" id="5442650">*</span><span class="num" id="5442651">4</span><span class="op" id="5442652">:</span><span class="op" id="5442653">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442658">yy</span><span class="op" id="5442660">,</span>&nbsp;<span class="ident" id="5442662">cb</span><span class="op" id="5442664">,</span>&nbsp;<span class="ident" id="5442666">cr</span>&nbsp;<span class="op" id="5442669">:=</span>&nbsp;<span class="ident" id="5442672"><a href="/image/jpeg/writer.go.html#5430828">color</a></span><span class="op" id="5442677">.</span><span class="ident" id="5442678">RGBToYCbCr</span><span class="op" id="5442688">(</span><span class="ident" id="5442689"><a href="/image/jpeg/writer.go.html#5442628">pix</a></span><span class="op" id="5442692">[</span><span class="num" id="5442693">0</span><span class="op" id="5442694">]</span><span class="op" id="5442695">,</span>&nbsp;<span class="ident" id="5442697"><a href="/image/jpeg/writer.go.html#5442628">pix</a></span><span class="op" id="5442700">[</span><span class="num" id="5442701">1</span><span class="op" id="5442702">]</span><span class="op" id="5442703">,</span>&nbsp;<span class="ident" id="5442705"><a href="/image/jpeg/writer.go.html#5442628">pix</a></span><span class="op" id="5442708">[</span><span class="num" id="5442709">2</span><span class="op" id="5442710">]</span><span class="op" id="5442711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442716"><a href="/image/jpeg/writer.go.html#5442328">yBlock</a></span><span class="op" id="5442722">[</span><span class="num" id="5442723">8</span><span class="op" id="5442724">*</span><span class="ident" id="5442725"><a href="/image/jpeg/writer.go.html#5442427">j</a></span><span class="op" id="5442726">+</span><span class="ident" id="5442727"><a href="/image/jpeg/writer.go.html#5442550">i</a></span><span class="op" id="5442728">]</span>&nbsp;<span class="op" id="5442730">=</span>&nbsp;<span class="builtintype" id="5442732">int32</span><span class="op" id="5442737">(</span><span class="ident" id="5442738"><a href="/image/jpeg/writer.go.html#5442658">yy</a></span><span class="op" id="5442740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442745"><a href="/image/jpeg/writer.go.html#5442336">cbBlock</a></span><span class="op" id="5442752">[</span><span class="num" id="5442753">8</span><span class="op" id="5442754">*</span><span class="ident" id="5442755"><a href="/image/jpeg/writer.go.html#5442427">j</a></span><span class="op" id="5442756">+</span><span class="ident" id="5442757"><a href="/image/jpeg/writer.go.html#5442550">i</a></span><span class="op" id="5442758">]</span>&nbsp;<span class="op" id="5442760">=</span>&nbsp;<span class="builtintype" id="5442762">int32</span><span class="op" id="5442767">(</span><span class="ident" id="5442768"><a href="/image/jpeg/writer.go.html#5442662">cb</a></span><span class="op" id="5442770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442775"><a href="/image/jpeg/writer.go.html#5442345">crBlock</a></span><span class="op" id="5442782">[</span><span class="num" id="5442783">8</span><span class="op" id="5442784">*</span><span class="ident" id="5442785"><a href="/image/jpeg/writer.go.html#5442427">j</a></span><span class="op" id="5442786">+</span><span class="ident" id="5442787"><a href="/image/jpeg/writer.go.html#5442550">i</a></span><span class="op" id="5442788">]</span>&nbsp;<span class="op" id="5442790">=</span>&nbsp;<span class="builtintype" id="5442792">int32</span><span class="op" id="5442797">(</span><span class="ident" id="5442798"><a href="/image/jpeg/writer.go.html#5442666">cr</a></span><span class="op" id="5442800">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442807">}</span><br>
<span class="lineno"></span><span class="op" id="5442809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5442812">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="5442888">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5442902">func</span>&nbsp;<span class="ident" id="5442907">scale</span><span class="op" id="5442912">(</span><span class="ident" id="5442913">dst</span>&nbsp;<span class="op" id="5442917">*</span><span class="ident" id="5442918"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><span class="op" id="5442923">,</span>&nbsp;<span class="ident" id="5442925">src</span>&nbsp;<span class="op" id="5442929">*</span><span class="op" id="5442930">[</span><span class="num" id="5442931">4</span><span class="op" id="5442932">]</span><span class="ident" id="5442933"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><span class="op" id="5442938">)</span>&nbsp;<span class="op" id="5442940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442943">for</span>&nbsp;<span class="ident" id="5442947">i</span>&nbsp;<span class="op" id="5442949">:=</span>&nbsp;<span class="num" id="5442952">0</span><span class="op" id="5442953">;</span>&nbsp;<span class="ident" id="5442955"><a href="/image/jpeg/writer.go.html#5442947">i</a></span>&nbsp;<span class="op" id="5442957">&lt;</span>&nbsp;<span class="num" id="5442959">4</span><span class="op" id="5442960">;</span>&nbsp;<span class="ident" id="5442962"><a href="/image/jpeg/writer.go.html#5442947">i</a></span><span class="op" id="5442963">++</span>&nbsp;<span class="op" id="5442966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442970">dstOff</span>&nbsp;<span class="op" id="5442977">:=</span>&nbsp;<span class="op" id="5442980">(</span><span class="ident" id="5442981"><a href="/image/jpeg/writer.go.html#5442947">i</a></span><span class="op" id="5442982">&amp;</span><span class="num" id="5442983">2</span><span class="op" id="5442984">)</span><span class="op" id="5442985">&lt;&lt;</span><span class="num" id="5442987">4</span>&nbsp;<span class="op" id="5442989">|</span>&nbsp;<span class="op" id="5442991">(</span><span class="ident" id="5442992"><a href="/image/jpeg/writer.go.html#5442947">i</a></span><span class="op" id="5442993">&amp;</span><span class="num" id="5442994">1</span><span class="op" id="5442995">)</span><span class="op" id="5442996">&lt;&lt;</span><span class="num" id="5442998">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443002">for</span>&nbsp;<span class="ident" id="5443006">y</span>&nbsp;<span class="op" id="5443008">:=</span>&nbsp;<span class="num" id="5443011">0</span><span class="op" id="5443012">;</span>&nbsp;<span class="ident" id="5443014"><a href="/image/jpeg/writer.go.html#5443006">y</a></span>&nbsp;<span class="op" id="5443016">&lt;</span>&nbsp;<span class="num" id="5443018">4</span><span class="op" id="5443019">;</span>&nbsp;<span class="ident" id="5443021"><a href="/image/jpeg/writer.go.html#5443006">y</a></span><span class="op" id="5443022">++</span>&nbsp;<span class="op" id="5443025">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443030">for</span>&nbsp;<span class="ident" id="5443034">x</span>&nbsp;<span class="op" id="5443036">:=</span>&nbsp;<span class="num" id="5443039">0</span><span class="op" id="5443040">;</span>&nbsp;<span class="ident" id="5443042"><a href="/image/jpeg/writer.go.html#5443034">x</a></span>&nbsp;<span class="op" id="5443044">&lt;</span>&nbsp;<span class="num" id="5443046">4</span><span class="op" id="5443047">;</span>&nbsp;<span class="ident" id="5443049"><a href="/image/jpeg/writer.go.html#5443034">x</a></span><span class="op" id="5443050">++</span>&nbsp;<span class="op" id="5443053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443059">j</span>&nbsp;<span class="op" id="5443061">:=</span>&nbsp;<span class="num" id="5443064">16</span><span class="op" id="5443066">*</span><span class="ident" id="5443067"><a href="/image/jpeg/writer.go.html#5443006">y</a></span>&nbsp;<span class="op" id="5443069">+</span>&nbsp;<span class="num" id="5443071">2</span><span class="op" id="5443072">*</span><span class="ident" id="5443073"><a href="/image/jpeg/writer.go.html#5443034">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443079">sum</span>&nbsp;<span class="op" id="5443083">:=</span>&nbsp;<span class="ident" id="5443086"><a href="/image/jpeg/writer.go.html#5442925">src</a></span><span class="op" id="5443089">[</span><span class="ident" id="5443090"><a href="/image/jpeg/writer.go.html#5442947">i</a></span><span class="op" id="5443091">]</span><span class="op" id="5443092">[</span><span class="ident" id="5443093"><a href="/image/jpeg/writer.go.html#5443059">j</a></span><span class="op" id="5443094">]</span>&nbsp;<span class="op" id="5443096">+</span>&nbsp;<span class="ident" id="5443098"><a href="/image/jpeg/writer.go.html#5442925">src</a></span><span class="op" id="5443101">[</span><span class="ident" id="5443102"><a href="/image/jpeg/writer.go.html#5442947">i</a></span><span class="op" id="5443103">]</span><span class="op" id="5443104">[</span><span class="ident" id="5443105"><a href="/image/jpeg/writer.go.html#5443059">j</a></span><span class="op" id="5443106">+</span><span class="num" id="5443107">1</span><span class="op" id="5443108">]</span>&nbsp;<span class="op" id="5443110">+</span>&nbsp;<span class="ident" id="5443112"><a href="/image/jpeg/writer.go.html#5442925">src</a></span><span class="op" id="5443115">[</span><span class="ident" id="5443116"><a href="/image/jpeg/writer.go.html#5442947">i</a></span><span class="op" id="5443117">]</span><span class="op" id="5443118">[</span><span class="ident" id="5443119"><a href="/image/jpeg/writer.go.html#5443059">j</a></span><span class="op" id="5443120">+</span><span class="num" id="5443121">8</span><span class="op" id="5443122">]</span>&nbsp;<span class="op" id="5443124">+</span>&nbsp;<span class="ident" id="5443126"><a href="/image/jpeg/writer.go.html#5442925">src</a></span><span class="op" id="5443129">[</span><span class="ident" id="5443130"><a href="/image/jpeg/writer.go.html#5442947">i</a></span><span class="op" id="5443131">]</span><span class="op" id="5443132">[</span><span class="ident" id="5443133"><a href="/image/jpeg/writer.go.html#5443059">j</a></span><span class="op" id="5443134">+</span><span class="num" id="5443135">9</span><span class="op" id="5443136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443142"><a href="/image/jpeg/writer.go.html#5442913">dst</a></span><span class="op" id="5443145">[</span><span class="num" id="5443146">8</span><span class="op" id="5443147">*</span><span class="ident" id="5443148"><a href="/image/jpeg/writer.go.html#5443006">y</a></span><span class="op" id="5443149">+</span><span class="ident" id="5443150"><a href="/image/jpeg/writer.go.html#5443034">x</a></span><span class="op" id="5443151">+</span><span class="ident" id="5443152"><a href="/image/jpeg/writer.go.html#5442970">dstOff</a></span><span class="op" id="5443158">]</span>&nbsp;<span class="op" id="5443160">=</span>&nbsp;<span class="op" id="5443162">(</span><span class="ident" id="5443163"><a href="/image/jpeg/writer.go.html#5443079">sum</a></span>&nbsp;<span class="op" id="5443167">+</span>&nbsp;<span class="num" id="5443169">2</span><span class="op" id="5443170">)</span>&nbsp;<span class="op" id="5443172">&gt;&gt;</span>&nbsp;<span class="num" id="5443175">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443180">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443187">}</span><br>
<span class="lineno"></span><span class="op" id="5443189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5443192">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="5443256">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5443291">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5443329">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5443389">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5443460">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="5443535">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5443578">var</span>&nbsp;<span class="ident" id="5443582">sosHeaderY</span>&nbsp;<span class="op" id="5443593">=</span>&nbsp;<span class="op" id="5443595">[</span><span class="op" id="5443596">]</span><span class="builtintype" id="5443597">byte</span><span class="op" id="5443601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5443604">0xff</span><span class="op" id="5443608">,</span>&nbsp;<span class="num" id="5443610">0xda</span><span class="op" id="5443614">,</span>&nbsp;<span class="num" id="5443616">0x00</span><span class="op" id="5443620">,</span>&nbsp;<span class="num" id="5443622">0x08</span><span class="op" id="5443626">,</span>&nbsp;<span class="num" id="5443628">0x01</span><span class="op" id="5443632">,</span>&nbsp;<span class="num" id="5443634">0x01</span><span class="op" id="5443638">,</span>&nbsp;<span class="num" id="5443640">0x00</span><span class="op" id="5443644">,</span>&nbsp;<span class="num" id="5443646">0x00</span><span class="op" id="5443650">,</span>&nbsp;<span class="num" id="5443652">0x3f</span><span class="op" id="5443656">,</span>&nbsp;<span class="num" id="5443658">0x00</span><span class="op" id="5443662">,</span><br>
<span class="lineno"></span><span class="op" id="5443664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5443667">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5443736">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5443771">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5443809">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5443869">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="5443929">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5443989">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5444060">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="5444135">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5444178">var</span>&nbsp;<span class="ident" id="5444182">sosHeaderYCbCr</span>&nbsp;<span class="op" id="5444197">=</span>&nbsp;<span class="op" id="5444199">[</span><span class="op" id="5444200">]</span><span class="builtintype" id="5444201">byte</span><span class="op" id="5444205">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5444208">0xff</span><span class="op" id="5444212">,</span>&nbsp;<span class="num" id="5444214">0xda</span><span class="op" id="5444218">,</span>&nbsp;<span class="num" id="5444220">0x00</span><span class="op" id="5444224">,</span>&nbsp;<span class="num" id="5444226">0x0c</span><span class="op" id="5444230">,</span>&nbsp;<span class="num" id="5444232">0x03</span><span class="op" id="5444236">,</span>&nbsp;<span class="num" id="5444238">0x01</span><span class="op" id="5444242">,</span>&nbsp;<span class="num" id="5444244">0x00</span><span class="op" id="5444248">,</span>&nbsp;<span class="num" id="5444250">0x02</span><span class="op" id="5444254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5444257">0x11</span><span class="op" id="5444261">,</span>&nbsp;<span class="num" id="5444263">0x03</span><span class="op" id="5444267">,</span>&nbsp;<span class="num" id="5444269">0x11</span><span class="op" id="5444273">,</span>&nbsp;<span class="num" id="5444275">0x00</span><span class="op" id="5444279">,</span>&nbsp;<span class="num" id="5444281">0x3f</span><span class="op" id="5444285">,</span>&nbsp;<span class="num" id="5444287">0x00</span><span class="op" id="5444291">,</span><br>
<span class="lineno"></span><span class="op" id="5444293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5444296">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="5444339">func</span>&nbsp;<span class="op" id="5444344">(</span><span class="ident" id="5444345">e</span>&nbsp;<span class="op" id="5444347">*</span><span class="ident" id="5444348"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><span class="op" id="5444355">)</span>&nbsp;<span class="ident" id="5444357">writeSOS</span><span class="op" id="5444365">(</span><span class="ident" id="5444366">m</span>&nbsp;<span class="ident" id="5444368"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5444373">.</span><span class="ident" id="5444374">Image</span><span class="op" id="5444379">)</span>&nbsp;<span class="op" id="5444381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444384">switch</span>&nbsp;<span class="ident" id="5444391"><a href="/image/jpeg/writer.go.html#5444366">m</a></span><span class="op" id="5444392">.</span><span class="op" id="5444393">(</span><span class="keyword" id="5444394">type</span><span class="op" id="5444398">)</span>&nbsp;<span class="op" id="5444400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444403">case</span>&nbsp;<span class="op" id="5444408">*</span><span class="ident" id="5444409"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5444414">.</span><span class="ident" id="5444415">Gray</span><span class="op" id="5444419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444423"><a href="/image/jpeg/writer.go.html#5444345">e</a></span><span class="op" id="5444424">.</span><span class="ident" id="5444425">write</span><span class="op" id="5444430">(</span><span class="ident" id="5444431"><a href="/image/jpeg/writer.go.html#5443582">sosHeaderY</a></span><span class="op" id="5444441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444444">default</span><span class="op" id="5444451">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444455"><a href="/image/jpeg/writer.go.html#5444345">e</a></span><span class="op" id="5444456">.</span><span class="ident" id="5444457">write</span><span class="op" id="5444462">(</span><span class="ident" id="5444463"><a href="/image/jpeg/writer.go.html#5444182">sosHeaderYCbCr</a></span><span class="op" id="5444477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444483">var</span>&nbsp;<span class="op" id="5444487">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444491">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444538">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444590">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444597"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444605">cb</span><span class="op" id="5444607">,</span>&nbsp;<span class="ident" id="5444609">cr</span>&nbsp;<span class="op" id="5444612">[</span><span class="num" id="5444613">4</span><span class="op" id="5444614">]</span><span class="ident" id="5444615"><a href="/image/jpeg/idct.go.html#5398954">block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444623">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444661">prevDCY</span><span class="op" id="5444668">,</span>&nbsp;<span class="ident" id="5444670">prevDCCb</span><span class="op" id="5444678">,</span>&nbsp;<span class="ident" id="5444680">prevDCCr</span>&nbsp;<span class="builtintype" id="5444689">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444696">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444699">bounds</span>&nbsp;<span class="op" id="5444706">:=</span>&nbsp;<span class="ident" id="5444709"><a href="/image/jpeg/writer.go.html#5444366">m</a></span><span class="op" id="5444710">.</span><span class="ident" id="5444711">Bounds</span><span class="op" id="5444717">(</span><span class="op" id="5444718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444721">switch</span>&nbsp;<span class="ident" id="5444728">m</span>&nbsp;<span class="op" id="5444730">:=</span>&nbsp;<span class="ident" id="5444733"><a href="/image/jpeg/writer.go.html#5444366">m</a></span><span class="op" id="5444734">.</span><span class="op" id="5444735">(</span><span class="keyword" id="5444736">type</span><span class="op" id="5444740">)</span>&nbsp;<span class="op" id="5444742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444745">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444807">case</span>&nbsp;<span class="op" id="5444812">*</span><span class="ident" id="5444813"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5444818">.</span><span class="ident" id="5444819">Gray</span><span class="op" id="5444823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444827">for</span>&nbsp;<span class="ident" id="5444831">y</span>&nbsp;<span class="op" id="5444833">:=</span>&nbsp;<span class="ident" id="5444836"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5444842">.</span><span class="ident" id="5444843">Min</span><span class="op" id="5444846">.</span><span class="ident" id="5444847">Y</span><span class="op" id="5444848">;</span>&nbsp;<span class="ident" id="5444850"><a href="/image/jpeg/writer.go.html#5444831">y</a></span>&nbsp;<span class="op" id="5444852">&lt;</span>&nbsp;<span class="ident" id="5444854"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5444860">.</span><span class="ident" id="5444861">Max</span><span class="op" id="5444864">.</span><span class="ident" id="5444865">Y</span><span class="op" id="5444866">;</span>&nbsp;<span class="ident" id="5444868"><a href="/image/jpeg/writer.go.html#5444831">y</a></span>&nbsp;<span class="op" id="5444870">+=</span>&nbsp;<span class="num" id="5444873">8</span>&nbsp;<span class="op" id="5444875">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444880">for</span>&nbsp;<span class="ident" id="5444884">x</span>&nbsp;<span class="op" id="5444886">:=</span>&nbsp;<span class="ident" id="5444889"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5444895">.</span><span class="ident" id="5444896">Min</span><span class="op" id="5444899">.</span><span class="ident" id="5444900">X</span><span class="op" id="5444901">;</span>&nbsp;<span class="ident" id="5444903"><a href="/image/jpeg/writer.go.html#5444884">x</a></span>&nbsp;<span class="op" id="5444905">&lt;</span>&nbsp;<span class="ident" id="5444907"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5444913">.</span><span class="ident" id="5444914">Max</span><span class="op" id="5444917">.</span><span class="ident" id="5444918">X</span><span class="op" id="5444919">;</span>&nbsp;<span class="ident" id="5444921"><a href="/image/jpeg/writer.go.html#5444884">x</a></span>&nbsp;<span class="op" id="5444923">+=</span>&nbsp;<span class="num" id="5444926">8</span>&nbsp;<span class="op" id="5444928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444934">p</span>&nbsp;<span class="op" id="5444936">:=</span>&nbsp;<span class="ident" id="5444939"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5444944">.</span><span class="ident" id="5444945">Pt</span><span class="op" id="5444947">(</span><span class="ident" id="5444948"><a href="/image/jpeg/writer.go.html#5444884">x</a></span><span class="op" id="5444949">,</span>&nbsp;<span class="ident" id="5444951"><a href="/image/jpeg/writer.go.html#5444831">y</a></span><span class="op" id="5444952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444958"><a href="/image/jpeg/writer.go.html#5441923">grayToY</a></span><span class="op" id="5444965">(</span><span class="ident" id="5444966"><a href="/image/jpeg/writer.go.html#5444728">m</a></span><span class="op" id="5444967">,</span>&nbsp;<span class="ident" id="5444969"><a href="/image/jpeg/writer.go.html#5444934">p</a></span><span class="op" id="5444970">,</span>&nbsp;<span class="op" id="5444972">&amp;</span><span class="ident" id="5444973"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5444974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444980"><a href="/image/jpeg/writer.go.html#5444661">prevDCY</a></span>&nbsp;<span class="op" id="5444988">=</span>&nbsp;<span class="ident" id="5444990"><a href="/image/jpeg/writer.go.html#5444345">e</a></span><span class="op" id="5444991">.</span><span class="ident" id="5444992">writeBlock</span><span class="op" id="5445002">(</span><span class="op" id="5445003">&amp;</span><span class="ident" id="5445004"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445005">,</span>&nbsp;<span class="num" id="5445007">0</span><span class="op" id="5445008">,</span>&nbsp;<span class="ident" id="5445010"><a href="/image/jpeg/writer.go.html#5444661">prevDCY</a></span><span class="op" id="5445017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445022">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445029">default</span><span class="op" id="5445036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445040">rgba</span><span class="op" id="5445044">,</span>&nbsp;<span class="ident" id="5445046">_</span>&nbsp;<span class="op" id="5445048">:=</span>&nbsp;<span class="ident" id="5445051"><a href="/image/jpeg/writer.go.html#5444728">m</a></span><span class="op" id="5445052">.</span><span class="op" id="5445053">(</span><span class="op" id="5445054">*</span><span class="ident" id="5445055"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5445060">.</span><span class="ident" id="5445061">RGBA</span><span class="op" id="5445065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445069">for</span>&nbsp;<span class="ident" id="5445073">y</span>&nbsp;<span class="op" id="5445075">:=</span>&nbsp;<span class="ident" id="5445078"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5445084">.</span><span class="ident" id="5445085">Min</span><span class="op" id="5445088">.</span><span class="ident" id="5445089">Y</span><span class="op" id="5445090">;</span>&nbsp;<span class="ident" id="5445092"><a href="/image/jpeg/writer.go.html#5445073">y</a></span>&nbsp;<span class="op" id="5445094">&lt;</span>&nbsp;<span class="ident" id="5445096"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5445102">.</span><span class="ident" id="5445103">Max</span><span class="op" id="5445106">.</span><span class="ident" id="5445107">Y</span><span class="op" id="5445108">;</span>&nbsp;<span class="ident" id="5445110"><a href="/image/jpeg/writer.go.html#5445073">y</a></span>&nbsp;<span class="op" id="5445112">+=</span>&nbsp;<span class="num" id="5445115">16</span>&nbsp;<span class="op" id="5445118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445123">for</span>&nbsp;<span class="ident" id="5445127">x</span>&nbsp;<span class="op" id="5445129">:=</span>&nbsp;<span class="ident" id="5445132"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5445138">.</span><span class="ident" id="5445139">Min</span><span class="op" id="5445142">.</span><span class="ident" id="5445143">X</span><span class="op" id="5445144">;</span>&nbsp;<span class="ident" id="5445146"><a href="/image/jpeg/writer.go.html#5445127">x</a></span>&nbsp;<span class="op" id="5445148">&lt;</span>&nbsp;<span class="ident" id="5445150"><a href="/image/jpeg/writer.go.html#5444699">bounds</a></span><span class="op" id="5445156">.</span><span class="ident" id="5445157">Max</span><span class="op" id="5445160">.</span><span class="ident" id="5445161">X</span><span class="op" id="5445162">;</span>&nbsp;<span class="ident" id="5445164"><a href="/image/jpeg/writer.go.html#5445127">x</a></span>&nbsp;<span class="op" id="5445166">+=</span>&nbsp;<span class="num" id="5445169">16</span>&nbsp;<span class="op" id="5445172">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445178">for</span>&nbsp;<span class="ident" id="5445182">i</span>&nbsp;<span class="op" id="5445184">:=</span>&nbsp;<span class="num" id="5445187">0</span><span class="op" id="5445188">;</span>&nbsp;<span class="ident" id="5445190"><a href="/image/jpeg/writer.go.html#5445182">i</a></span>&nbsp;<span class="op" id="5445192">&lt;</span>&nbsp;<span class="num" id="5445194">4</span><span class="op" id="5445195">;</span>&nbsp;<span class="ident" id="5445197"><a href="/image/jpeg/writer.go.html#5445182">i</a></span><span class="op" id="5445198">++</span>&nbsp;<span class="op" id="5445201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445208">xOff</span>&nbsp;<span class="op" id="5445213">:=</span>&nbsp;<span class="op" id="5445216">(</span><span class="ident" id="5445217"><a href="/image/jpeg/writer.go.html#5445182">i</a></span>&nbsp;<span class="op" id="5445219">&amp;</span>&nbsp;<span class="num" id="5445221">1</span><span class="op" id="5445222">)</span>&nbsp;<span class="op" id="5445224">*</span>&nbsp;<span class="num" id="5445226">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445233">yOff</span>&nbsp;<span class="op" id="5445238">:=</span>&nbsp;<span class="op" id="5445241">(</span><span class="ident" id="5445242"><a href="/image/jpeg/writer.go.html#5445182">i</a></span>&nbsp;<span class="op" id="5445244">&amp;</span>&nbsp;<span class="num" id="5445246">2</span><span class="op" id="5445247">)</span>&nbsp;<span class="op" id="5445249">*</span>&nbsp;<span class="num" id="5445251">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445258">p</span>&nbsp;<span class="op" id="5445260">:=</span>&nbsp;<span class="ident" id="5445263"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5445268">.</span><span class="ident" id="5445269">Pt</span><span class="op" id="5445271">(</span><span class="ident" id="5445272"><a href="/image/jpeg/writer.go.html#5445127">x</a></span><span class="op" id="5445273">+</span><span class="ident" id="5445274"><a href="/image/jpeg/writer.go.html#5445208">xOff</a></span><span class="op" id="5445278">,</span>&nbsp;<span class="ident" id="5445280"><a href="/image/jpeg/writer.go.html#5445073">y</a></span><span class="op" id="5445281">+</span><span class="ident" id="5445282"><a href="/image/jpeg/writer.go.html#5445233">yOff</a></span><span class="op" id="5445286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445293">if</span>&nbsp;<span class="ident" id="5445296"><a href="/image/jpeg/writer.go.html#5445040">rgba</a></span>&nbsp;<span class="op" id="5445301">!=</span>&nbsp;<span class="ident" id="5445304">nil</span>&nbsp;<span class="op" id="5445308">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445316"><a href="/image/jpeg/writer.go.html#5442286">rgbaToYCbCr</a></span><span class="op" id="5445327">(</span><span class="ident" id="5445328"><a href="/image/jpeg/writer.go.html#5445040">rgba</a></span><span class="op" id="5445332">,</span>&nbsp;<span class="ident" id="5445334"><a href="/image/jpeg/writer.go.html#5445258">p</a></span><span class="op" id="5445335">,</span>&nbsp;<span class="op" id="5445337">&amp;</span><span class="ident" id="5445338"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445339">,</span>&nbsp;<span class="op" id="5445341">&amp;</span><span class="ident" id="5445342"><a href="/image/jpeg/writer.go.html#5444605">cb</a></span><span class="op" id="5445344">[</span><span class="ident" id="5445345"><a href="/image/jpeg/writer.go.html#5445182">i</a></span><span class="op" id="5445346">]</span><span class="op" id="5445347">,</span>&nbsp;<span class="op" id="5445349">&amp;</span><span class="ident" id="5445350"><a href="/image/jpeg/writer.go.html#5444609">cr</a></span><span class="op" id="5445352">[</span><span class="ident" id="5445353"><a href="/image/jpeg/writer.go.html#5445182">i</a></span><span class="op" id="5445354">]</span><span class="op" id="5445355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445362">}</span>&nbsp;<span class="keyword" id="5445364">else</span>&nbsp;<span class="op" id="5445369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445377"><a href="/image/jpeg/writer.go.html#5441420">toYCbCr</a></span><span class="op" id="5445384">(</span><span class="ident" id="5445385"><a href="/image/jpeg/writer.go.html#5444728">m</a></span><span class="op" id="5445386">,</span>&nbsp;<span class="ident" id="5445388"><a href="/image/jpeg/writer.go.html#5445258">p</a></span><span class="op" id="5445389">,</span>&nbsp;<span class="op" id="5445391">&amp;</span><span class="ident" id="5445392"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445393">,</span>&nbsp;<span class="op" id="5445395">&amp;</span><span class="ident" id="5445396"><a href="/image/jpeg/writer.go.html#5444605">cb</a></span><span class="op" id="5445398">[</span><span class="ident" id="5445399"><a href="/image/jpeg/writer.go.html#5445182">i</a></span><span class="op" id="5445400">]</span><span class="op" id="5445401">,</span>&nbsp;<span class="op" id="5445403">&amp;</span><span class="ident" id="5445404"><a href="/image/jpeg/writer.go.html#5444609">cr</a></span><span class="op" id="5445406">[</span><span class="ident" id="5445407"><a href="/image/jpeg/writer.go.html#5445182">i</a></span><span class="op" id="5445408">]</span><span class="op" id="5445409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445423"><a href="/image/jpeg/writer.go.html#5444661">prevDCY</a></span>&nbsp;<span class="op" id="5445431">=</span>&nbsp;<span class="ident" id="5445433"><a href="/image/jpeg/writer.go.html#5444345">e</a></span><span class="op" id="5445434">.</span><span class="ident" id="5445435">writeBlock</span><span class="op" id="5445445">(</span><span class="op" id="5445446">&amp;</span><span class="ident" id="5445447"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445448">,</span>&nbsp;<span class="num" id="5445450">0</span><span class="op" id="5445451">,</span>&nbsp;<span class="ident" id="5445453"><a href="/image/jpeg/writer.go.html#5444661">prevDCY</a></span><span class="op" id="5445460">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445472"><a href="/image/jpeg/writer.go.html#5442907">scale</a></span><span class="op" id="5445477">(</span><span class="op" id="5445478">&amp;</span><span class="ident" id="5445479"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445480">,</span>&nbsp;<span class="op" id="5445482">&amp;</span><span class="ident" id="5445483"><a href="/image/jpeg/writer.go.html#5444605">cb</a></span><span class="op" id="5445485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445491"><a href="/image/jpeg/writer.go.html#5444670">prevDCCb</a></span>&nbsp;<span class="op" id="5445500">=</span>&nbsp;<span class="ident" id="5445502"><a href="/image/jpeg/writer.go.html#5444345">e</a></span><span class="op" id="5445503">.</span><span class="ident" id="5445504">writeBlock</span><span class="op" id="5445514">(</span><span class="op" id="5445515">&amp;</span><span class="ident" id="5445516"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445517">,</span>&nbsp;<span class="num" id="5445519">1</span><span class="op" id="5445520">,</span>&nbsp;<span class="ident" id="5445522"><a href="/image/jpeg/writer.go.html#5444670">prevDCCb</a></span><span class="op" id="5445530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445536"><a href="/image/jpeg/writer.go.html#5442907">scale</a></span><span class="op" id="5445541">(</span><span class="op" id="5445542">&amp;</span><span class="ident" id="5445543"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445544">,</span>&nbsp;<span class="op" id="5445546">&amp;</span><span class="ident" id="5445547"><a href="/image/jpeg/writer.go.html#5444609">cr</a></span><span class="op" id="5445549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445555"><a href="/image/jpeg/writer.go.html#5444680">prevDCCr</a></span>&nbsp;<span class="op" id="5445564">=</span>&nbsp;<span class="ident" id="5445566"><a href="/image/jpeg/writer.go.html#5444345">e</a></span><span class="op" id="5445567">.</span><span class="ident" id="5445568">writeBlock</span><span class="op" id="5445578">(</span><span class="op" id="5445579">&amp;</span><span class="ident" id="5445580"><a href="/image/jpeg/writer.go.html#5444590">b</a></span><span class="op" id="5445581">,</span>&nbsp;<span class="num" id="5445583">1</span><span class="op" id="5445584">,</span>&nbsp;<span class="ident" id="5445586"><a href="/image/jpeg/writer.go.html#5444680">prevDCCr</a></span><span class="op" id="5445594">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445609">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445641"><a href="/image/jpeg/writer.go.html#5444345">e</a></span><span class="op" id="5445642">.</span><span class="ident" id="5445643">emit</span><span class="op" id="5445647">(</span><span class="num" id="5445648">0x7f</span><span class="op" id="5445652">,</span>&nbsp;<span class="num" id="5445654">7</span><span class="op" id="5445655">)</span><br>
<span class="lineno">535</span><span class="op" id="5445657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5445660">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5445721">const</span>&nbsp;<span class="ident" id="5445727">DefaultQuality</span>&nbsp;<span class="op" id="5445742">=</span>&nbsp;<span class="num" id="5445744">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5445748">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="5445788">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="5445849">type</span>&nbsp;<span class="ident" id="5445854">Options</span>&nbsp;<span class="keyword" id="5445862">struct</span>&nbsp;<span class="op" id="5445869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445872">Quality</span>&nbsp;<span class="builtintype" id="5445880">int</span><br>
<span class="lineno"></span><span class="op" id="5445884">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5445887">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5445966">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="5446035">func</span>&nbsp;<span class="ident" id="5446040">Encode</span><span class="op" id="5446046">(</span><span class="ident" id="5446047">w</span>&nbsp;<span class="ident" id="5446049"><a href="/image/jpeg/writer.go.html#5430843">io</a></span><span class="op" id="5446051">.</span><span class="ident" id="5446052">Writer</span><span class="op" id="5446058">,</span>&nbsp;<span class="ident" id="5446060">m</span>&nbsp;<span class="ident" id="5446062"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5446067">.</span><span class="ident" id="5446068">Image</span><span class="op" id="5446073">,</span>&nbsp;<span class="ident" id="5446075">o</span>&nbsp;<span class="op" id="5446077">*</span><span class="ident" id="5446078"><a href="/image/jpeg/writer.go.html#5445854">Options</a></span><span class="op" id="5446085">)</span>&nbsp;<span class="builtintype" id="5446087">error</span>&nbsp;<span class="op" id="5446093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446096">b</span>&nbsp;<span class="op" id="5446098">:=</span>&nbsp;<span class="ident" id="5446101"><a href="/image/jpeg/writer.go.html#5446060">m</a></span><span class="op" id="5446102">.</span><span class="ident" id="5446103">Bounds</span><span class="op" id="5446109">(</span><span class="op" id="5446110">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446113">if</span>&nbsp;<span class="ident" id="5446116"><a href="/image/jpeg/writer.go.html#5446096">b</a></span><span class="op" id="5446117">.</span><span class="ident" id="5446118">Dx</span><span class="op" id="5446120">(</span><span class="op" id="5446121">)</span>&nbsp;<span class="op" id="5446123">&gt;=</span>&nbsp;<span class="num" id="5446126">1</span><span class="op" id="5446127">&lt;&lt;</span><span class="num" id="5446129">16</span>&nbsp;<span class="op" id="5446132">||</span>&nbsp;<span class="ident" id="5446135"><a href="/image/jpeg/writer.go.html#5446096">b</a></span><span class="op" id="5446136">.</span><span class="ident" id="5446137">Dy</span><span class="op" id="5446139">(</span><span class="op" id="5446140">)</span>&nbsp;<span class="op" id="5446142">&gt;=</span>&nbsp;<span class="num" id="5446145">1</span><span class="op" id="5446146">&lt;&lt;</span><span class="num" id="5446148">16</span>&nbsp;<span class="op" id="5446151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446155">return</span>&nbsp;<span class="ident" id="5446162"><a href="/image/jpeg/writer.go.html#5430809">errors</a></span><span class="op" id="5446168">.</span><span class="ident" id="5446169">New</span><span class="op" id="5446172">(</span><span class="string" id="5446173">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5446209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446215">var</span>&nbsp;<span class="ident" id="5446219">e</span>&nbsp;<span class="ident" id="5446221"><a href="/image/jpeg/writer.go.html#5437124">encoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446230">if</span>&nbsp;<span class="ident" id="5446233">ww</span><span class="op" id="5446235">,</span>&nbsp;<span class="ident" id="5446237">ok</span>&nbsp;<span class="op" id="5446240">:=</span>&nbsp;<span class="ident" id="5446243"><a href="/image/jpeg/writer.go.html#5446047">w</a></span><span class="op" id="5446244">.</span><span class="op" id="5446245">(</span><span class="ident" id="5446246"><a href="/image/jpeg/writer.go.html#5437008">writer</a></span><span class="op" id="5446252">)</span><span class="op" id="5446253">;</span>&nbsp;<span class="ident" id="5446255"><a href="/image/jpeg/writer.go.html#5446237">ok</a></span>&nbsp;<span class="op" id="5446258">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446262"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5446263">.</span><span class="ident" id="5446264">w</span>&nbsp;<span class="op" id="5446266">=</span>&nbsp;<span class="ident" id="5446268"><a href="/image/jpeg/writer.go.html#5446233">ww</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446272">}</span>&nbsp;<span class="keyword" id="5446274">else</span>&nbsp;<span class="op" id="5446279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446283"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5446284">.</span><span class="ident" id="5446285">w</span>&nbsp;<span class="op" id="5446287">=</span>&nbsp;<span class="ident" id="5446289"><a href="/image/jpeg/writer.go.html#5430800">bufio</a></span><span class="op" id="5446294">.</span><span class="ident" id="5446295">NewWriter</span><span class="op" id="5446304">(</span><span class="ident" id="5446305"><a href="/image/jpeg/writer.go.html#5446047">w</a></span><span class="op" id="5446306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446312">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446342">quality</span>&nbsp;<span class="op" id="5446350">:=</span>&nbsp;<span class="ident" id="5446353"><a href="/image/jpeg/writer.go.html#5445727">DefaultQuality</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446369">if</span>&nbsp;<span class="ident" id="5446372"><a href="/image/jpeg/writer.go.html#5446075">o</a></span>&nbsp;<span class="op" id="5446374">!=</span>&nbsp;<span class="ident" id="5446377">nil</span>&nbsp;<span class="op" id="5446381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446385"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span>&nbsp;<span class="op" id="5446393">=</span>&nbsp;<span class="ident" id="5446395"><a href="/image/jpeg/writer.go.html#5446075">o</a></span><span class="op" id="5446396">.</span><span class="ident" id="5446397">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446407">if</span>&nbsp;<span class="ident" id="5446410"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span>&nbsp;<span class="op" id="5446418">&lt;</span>&nbsp;<span class="num" id="5446420">1</span>&nbsp;<span class="op" id="5446422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446427"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span>&nbsp;<span class="op" id="5446435">=</span>&nbsp;<span class="num" id="5446437">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446441">}</span>&nbsp;<span class="keyword" id="5446443">else</span>&nbsp;<span class="keyword" id="5446448">if</span>&nbsp;<span class="ident" id="5446451"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span>&nbsp;<span class="op" id="5446459">&gt;</span>&nbsp;<span class="num" id="5446461">100</span>&nbsp;<span class="op" id="5446465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446470"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span>&nbsp;<span class="op" id="5446478">=</span>&nbsp;<span class="num" id="5446480">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446492">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446547">var</span>&nbsp;<span class="ident" id="5446551">scale</span>&nbsp;<span class="builtintype" id="5446557">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446562">if</span>&nbsp;<span class="ident" id="5446565"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span>&nbsp;<span class="op" id="5446573">&lt;</span>&nbsp;<span class="num" id="5446575">50</span>&nbsp;<span class="op" id="5446578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446582"><a href="/image/jpeg/writer.go.html#5446551">scale</a></span>&nbsp;<span class="op" id="5446588">=</span>&nbsp;<span class="num" id="5446590">5000</span>&nbsp;<span class="op" id="5446595">/</span>&nbsp;<span class="ident" id="5446597"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446606">}</span>&nbsp;<span class="keyword" id="5446608">else</span>&nbsp;<span class="op" id="5446613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446617"><a href="/image/jpeg/writer.go.html#5446551">scale</a></span>&nbsp;<span class="op" id="5446623">=</span>&nbsp;<span class="num" id="5446625">200</span>&nbsp;<span class="op" id="5446629">-</span>&nbsp;<span class="ident" id="5446631"><a href="/image/jpeg/writer.go.html#5446342">quality</a></span><span class="op" id="5446638">*</span><span class="num" id="5446639">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446645">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446685">for</span>&nbsp;<span class="ident" id="5446689">i</span>&nbsp;<span class="op" id="5446691">:=</span>&nbsp;<span class="keyword" id="5446694">range</span>&nbsp;<span class="ident" id="5446700"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5446701">.</span><span class="ident" id="5446702">quant</span>&nbsp;<span class="op" id="5446708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446712">for</span>&nbsp;<span class="ident" id="5446716">j</span>&nbsp;<span class="op" id="5446718">:=</span>&nbsp;<span class="keyword" id="5446721">range</span>&nbsp;<span class="ident" id="5446727"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5446728">.</span><span class="ident" id="5446729">quant</span><span class="op" id="5446734">[</span><span class="ident" id="5446735"><a href="/image/jpeg/writer.go.html#5446689">i</a></span><span class="op" id="5446736">]</span>&nbsp;<span class="op" id="5446738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446743">x</span>&nbsp;<span class="op" id="5446745">:=</span>&nbsp;<span class="builtintype" id="5446748">int</span><span class="op" id="5446751">(</span><span class="ident" id="5446752"><a href="/image/jpeg/writer.go.html#5432381">unscaledQuant</a></span><span class="op" id="5446765">[</span><span class="ident" id="5446766"><a href="/image/jpeg/writer.go.html#5446689">i</a></span><span class="op" id="5446767">]</span><span class="op" id="5446768">[</span><span class="ident" id="5446769"><a href="/image/jpeg/writer.go.html#5446716">j</a></span><span class="op" id="5446770">]</span><span class="op" id="5446771">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446776"><a href="/image/jpeg/writer.go.html#5446743">x</a></span>&nbsp;<span class="op" id="5446778">=</span>&nbsp;<span class="op" id="5446780">(</span><span class="ident" id="5446781"><a href="/image/jpeg/writer.go.html#5446743">x</a></span><span class="op" id="5446782">*</span><span class="ident" id="5446783"><a href="/image/jpeg/writer.go.html#5446551">scale</a></span>&nbsp;<span class="op" id="5446789">+</span>&nbsp;<span class="num" id="5446791">50</span><span class="op" id="5446793">)</span>&nbsp;<span class="op" id="5446795">/</span>&nbsp;<span class="num" id="5446797">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446804">if</span>&nbsp;<span class="ident" id="5446807"><a href="/image/jpeg/writer.go.html#5446743">x</a></span>&nbsp;<span class="op" id="5446809">&lt;</span>&nbsp;<span class="num" id="5446811">1</span>&nbsp;<span class="op" id="5446813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446819"><a href="/image/jpeg/writer.go.html#5446743">x</a></span>&nbsp;<span class="op" id="5446821">=</span>&nbsp;<span class="num" id="5446823">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446828">}</span>&nbsp;<span class="keyword" id="5446830">else</span>&nbsp;<span class="keyword" id="5446835">if</span>&nbsp;<span class="ident" id="5446838"><a href="/image/jpeg/writer.go.html#5446743">x</a></span>&nbsp;<span class="op" id="5446840">&gt;</span>&nbsp;<span class="num" id="5446842">255</span>&nbsp;<span class="op" id="5446846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446852"><a href="/image/jpeg/writer.go.html#5446743">x</a></span>&nbsp;<span class="op" id="5446854">=</span>&nbsp;<span class="num" id="5446856">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446868"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5446869">.</span><span class="ident" id="5446870">quant</span><span class="op" id="5446875">[</span><span class="ident" id="5446876"><a href="/image/jpeg/writer.go.html#5446689">i</a></span><span class="op" id="5446877">]</span><span class="op" id="5446878">[</span><span class="ident" id="5446879"><a href="/image/jpeg/writer.go.html#5446716">j</a></span><span class="op" id="5446880">]</span>&nbsp;<span class="op" id="5446882">=</span>&nbsp;<span class="builtintype" id="5446884">uint8</span><span class="op" id="5446889">(</span><span class="ident" id="5446890"><a href="/image/jpeg/writer.go.html#5446743">x</a></span><span class="op" id="5446891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446901">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446961">nComponent</span>&nbsp;<span class="op" id="5446972">:=</span>&nbsp;<span class="num" id="5446975">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446978">switch</span>&nbsp;<span class="ident" id="5446985"><a href="/image/jpeg/writer.go.html#5446060">m</a></span><span class="op" id="5446986">.</span><span class="op" id="5446987">(</span><span class="keyword" id="5446988">type</span><span class="op" id="5446992">)</span>&nbsp;<span class="op" id="5446994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446997">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447059">case</span>&nbsp;<span class="op" id="5447064">*</span><span class="ident" id="5447065"><a href="/image/jpeg/writer.go.html#5430819">image</a></span><span class="op" id="5447070">.</span><span class="ident" id="5447071">Gray</span><span class="op" id="5447075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447079"><a href="/image/jpeg/writer.go.html#5446961">nComponent</a></span>&nbsp;<span class="op" id="5447090">=</span>&nbsp;<span class="num" id="5447092">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447098">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447135"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447136">.</span><span class="ident" id="5447137">buf</span><span class="op" id="5447140">[</span><span class="num" id="5447141">0</span><span class="op" id="5447142">]</span>&nbsp;<span class="op" id="5447144">=</span>&nbsp;<span class="num" id="5447146">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447152"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447153">.</span><span class="ident" id="5447154">buf</span><span class="op" id="5447157">[</span><span class="num" id="5447158">1</span><span class="op" id="5447159">]</span>&nbsp;<span class="op" id="5447161">=</span>&nbsp;<span class="num" id="5447163">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447169"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447170">.</span><span class="ident" id="5447171">write</span><span class="op" id="5447176">(</span><span class="ident" id="5447177"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447178">.</span><span class="ident" id="5447179">buf</span><span class="op" id="5447182">[</span><span class="op" id="5447183">:</span><span class="num" id="5447184">2</span><span class="op" id="5447185">]</span><span class="op" id="5447186">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447189">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447224"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447225">.</span><span class="ident" id="5447226">writeDQT</span><span class="op" id="5447234">(</span><span class="op" id="5447235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447238">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447270"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447271">.</span><span class="ident" id="5447272">writeSOF0</span><span class="op" id="5447281">(</span><span class="ident" id="5447282"><a href="/image/jpeg/writer.go.html#5446096">b</a></span><span class="op" id="5447283">.</span><span class="ident" id="5447284">Size</span><span class="op" id="5447288">(</span><span class="op" id="5447289">)</span><span class="op" id="5447290">,</span>&nbsp;<span class="ident" id="5447292"><a href="/image/jpeg/writer.go.html#5446961">nComponent</a></span><span class="op" id="5447302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447305">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447335"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447336">.</span><span class="ident" id="5447337">writeDHT</span><span class="op" id="5447345">(</span><span class="ident" id="5447346"><a href="/image/jpeg/writer.go.html#5446961">nComponent</a></span><span class="op" id="5447356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447359">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447385"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447386">.</span><span class="ident" id="5447387">writeSOS</span><span class="op" id="5447395">(</span><span class="ident" id="5447396"><a href="/image/jpeg/writer.go.html#5446060">m</a></span><span class="op" id="5447397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447400">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447435"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447436">.</span><span class="ident" id="5447437">buf</span><span class="op" id="5447440">[</span><span class="num" id="5447441">0</span><span class="op" id="5447442">]</span>&nbsp;<span class="op" id="5447444">=</span>&nbsp;<span class="num" id="5447446">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447452"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447453">.</span><span class="ident" id="5447454">buf</span><span class="op" id="5447457">[</span><span class="num" id="5447458">1</span><span class="op" id="5447459">]</span>&nbsp;<span class="op" id="5447461">=</span>&nbsp;<span class="num" id="5447463">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447469"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447470">.</span><span class="ident" id="5447471">write</span><span class="op" id="5447476">(</span><span class="ident" id="5447477"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447478">.</span><span class="ident" id="5447479">buf</span><span class="op" id="5447482">[</span><span class="op" id="5447483">:</span><span class="num" id="5447484">2</span><span class="op" id="5447485">]</span><span class="op" id="5447486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447489"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447490">.</span><span class="ident" id="5447491">flush</span><span class="op" id="5447496">(</span><span class="op" id="5447497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447500">return</span>&nbsp;<span class="ident" id="5447507"><a href="/image/jpeg/writer.go.html#5446219">e</a></span><span class="op" id="5447508">.</span><span class="ident" id="5447509">err</span><br>
<span class="lineno"></span><span class="op" id="5447513">}</span>
</div>
</body>
</html>
