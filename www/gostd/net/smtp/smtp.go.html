<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html" class="current">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5787189">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5787244">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5787298">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5787349">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="5787434">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="5787482">//&nbsp;&nbsp;&nbsp;&nbsp;8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="5787504">//&nbsp;&nbsp;&nbsp;&nbsp;AUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="5787526">//&nbsp;&nbsp;&nbsp;&nbsp;STARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="5787548">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5787600">package</span>&nbsp;<span class="ident" id="5787608">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5787614">import</span>&nbsp;<span class="op" id="5787621">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5787624">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5787638">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5787657">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5787667">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5787673">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5787680">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5787697">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5787707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5787710">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5787772">type</span>&nbsp;<span class="ident" id="5787777">Client</span>&nbsp;<span class="keyword" id="5787784">struct</span>&nbsp;<span class="op" id="5787791">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5787794">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5787873">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5787904">Text</span>&nbsp;<span class="op" id="5787909">*</span><span class="ident" id="5787910">textproto</span><span class="op" id="5787919">.</span><span class="ident" id="5787920">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5787926">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5787999">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788020">conn</span>&nbsp;<span class="ident" id="5788025">net</span><span class="op" id="5788028">.</span><span class="ident" id="5788029">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5788035">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788071">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5788082">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788088">serverName</span>&nbsp;<span class="builtintype" id="5788099">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5788107">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788139">ext</span>&nbsp;<span class="keyword" id="5788143">map</span><span class="op" id="5788146">[</span><span class="builtintype" id="5788147">string</span><span class="op" id="5788153">]</span><span class="builtintype" id="5788154">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5788162">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788192">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5788203">[</span><span class="op" id="5788204">]</span><span class="builtintype" id="5788205">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788213">localName</span>&nbsp;&nbsp;<span class="builtintype" id="5788224">string</span>&nbsp;<span class="comment" id="5788231">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788264">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5788275">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5788282">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788315">helloError</span>&nbsp;<span class="builtintype" id="5788326">error</span>&nbsp;&nbsp;<span class="comment" id="5788333">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="5788361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5788364">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="5788430">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="5788470">func</span>&nbsp;<span class="ident" id="5788475">Dial</span><span class="op" id="5788479">(</span><span class="ident" id="5788480">addr</span>&nbsp;<span class="builtintype" id="5788485">string</span><span class="op" id="5788491">)</span>&nbsp;<span class="op" id="5788493">(</span><span class="op" id="5788494">*</span><span class="ident" id="5788495">Client</span><span class="op" id="5788501">,</span>&nbsp;<span class="builtintype" id="5788503">error</span><span class="op" id="5788508">)</span>&nbsp;<span class="op" id="5788510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788513">conn</span><span class="op" id="5788517">,</span>&nbsp;<span class="ident" id="5788519">err</span>&nbsp;<span class="op" id="5788523">:=</span>&nbsp;<span class="ident" id="5788526">net</span><span class="op" id="5788529">.</span><span class="ident" id="5788530">Dial</span><span class="op" id="5788534">(</span><span class="string" id="5788535">&#34;tcp&#34;</span><span class="op" id="5788540">,</span>&nbsp;<span class="ident" id="5788542">addr</span><span class="op" id="5788546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5788549">if</span>&nbsp;<span class="ident" id="5788552">err</span>&nbsp;<span class="op" id="5788556">!=</span>&nbsp;<span class="builtintype" id="5788559">nil</span>&nbsp;<span class="op" id="5788563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5788567">return</span>&nbsp;<span class="builtintype" id="5788574">nil</span><span class="op" id="5788577">,</span>&nbsp;<span class="ident" id="5788579">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5788584">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788587">host</span><span class="op" id="5788591">,</span>&nbsp;<span class="ident" id="5788593">_</span><span class="op" id="5788594">,</span>&nbsp;<span class="ident" id="5788596">_</span>&nbsp;<span class="op" id="5788598">:=</span>&nbsp;<span class="ident" id="5788601">net</span><span class="op" id="5788604">.</span><span class="ident" id="5788605">SplitHostPort</span><span class="op" id="5788618">(</span><span class="ident" id="5788619">addr</span><span class="op" id="5788623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5788626">return</span>&nbsp;<span class="ident" id="5788633">NewClient</span><span class="op" id="5788642">(</span><span class="ident" id="5788643">conn</span><span class="op" id="5788647">,</span>&nbsp;<span class="ident" id="5788649">host</span><span class="op" id="5788653">)</span><br>
<span class="lineno"></span><span class="op" id="5788655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5788658">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="5788735">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="5788782">func</span>&nbsp;<span class="ident" id="5788787">NewClient</span><span class="op" id="5788796">(</span><span class="ident" id="5788797">conn</span>&nbsp;<span class="ident" id="5788802">net</span><span class="op" id="5788805">.</span><span class="ident" id="5788806">Conn</span><span class="op" id="5788810">,</span>&nbsp;<span class="ident" id="5788812">host</span>&nbsp;<span class="builtintype" id="5788817">string</span><span class="op" id="5788823">)</span>&nbsp;<span class="op" id="5788825">(</span><span class="op" id="5788826">*</span><span class="ident" id="5788827">Client</span><span class="op" id="5788833">,</span>&nbsp;<span class="builtintype" id="5788835">error</span><span class="op" id="5788840">)</span>&nbsp;<span class="op" id="5788842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788845">text</span>&nbsp;<span class="op" id="5788850">:=</span>&nbsp;<span class="ident" id="5788853">textproto</span><span class="op" id="5788862">.</span><span class="ident" id="5788863">NewConn</span><span class="op" id="5788870">(</span><span class="ident" id="5788871">conn</span><span class="op" id="5788875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788878">_</span><span class="op" id="5788879">,</span>&nbsp;<span class="ident" id="5788881">_</span><span class="op" id="5788882">,</span>&nbsp;<span class="ident" id="5788884">err</span>&nbsp;<span class="op" id="5788888">:=</span>&nbsp;<span class="ident" id="5788891">text</span><span class="op" id="5788895">.</span><span class="ident" id="5788896">ReadResponse</span><span class="op" id="5788908">(</span><span class="num" id="5788909">220</span><span class="op" id="5788912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5788915">if</span>&nbsp;<span class="ident" id="5788918">err</span>&nbsp;<span class="op" id="5788922">!=</span>&nbsp;<span class="builtintype" id="5788925">nil</span>&nbsp;<span class="op" id="5788929">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788933">text</span><span class="op" id="5788937">.</span><span class="ident" id="5788938">Close</span><span class="op" id="5788943">(</span><span class="op" id="5788944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5788948">return</span>&nbsp;<span class="builtintype" id="5788955">nil</span><span class="op" id="5788958">,</span>&nbsp;<span class="ident" id="5788960">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5788965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788968">c</span>&nbsp;<span class="op" id="5788970">:=</span>&nbsp;<span class="op" id="5788973">&amp;</span><span class="ident" id="5788974">Client</span><span class="op" id="5788980">{</span><span class="ident" id="5788981">Text</span><span class="op" id="5788985">:</span>&nbsp;<span class="ident" id="5788987">text</span><span class="op" id="5788991">,</span>&nbsp;<span class="ident" id="5788993">conn</span><span class="op" id="5788997">:</span>&nbsp;<span class="ident" id="5788999">conn</span><span class="op" id="5789003">,</span>&nbsp;<span class="ident" id="5789005">serverName</span><span class="op" id="5789015">:</span>&nbsp;<span class="ident" id="5789017">host</span><span class="op" id="5789021">,</span>&nbsp;<span class="ident" id="5789023">localName</span><span class="op" id="5789032">:</span>&nbsp;<span class="string" id="5789034">&#34;localhost&#34;</span><span class="op" id="5789045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789048">return</span>&nbsp;<span class="ident" id="5789055">c</span><span class="op" id="5789056">,</span>&nbsp;<span class="builtintype" id="5789058">nil</span><br>
<span class="lineno">65</span><span class="op" id="5789062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5789065">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5789097">func</span>&nbsp;<span class="op" id="5789102">(</span><span class="ident" id="5789103">c</span>&nbsp;<span class="op" id="5789105">*</span><span class="ident" id="5789106">Client</span><span class="op" id="5789112">)</span>&nbsp;<span class="ident" id="5789114">Close</span><span class="op" id="5789119">(</span><span class="op" id="5789120">)</span>&nbsp;<span class="builtintype" id="5789122">error</span>&nbsp;<span class="op" id="5789128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789131">return</span>&nbsp;<span class="ident" id="5789138">c</span><span class="op" id="5789139">.</span><span class="ident" id="5789140">Text</span><span class="op" id="5789144">.</span><span class="ident" id="5789145">Close</span><span class="op" id="5789150">(</span><span class="op" id="5789151">)</span><br>
<span class="lineno">70</span><span class="op" id="5789153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5789156">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5789198">func</span>&nbsp;<span class="op" id="5789203">(</span><span class="ident" id="5789204">c</span>&nbsp;<span class="op" id="5789206">*</span><span class="ident" id="5789207">Client</span><span class="op" id="5789213">)</span>&nbsp;<span class="ident" id="5789215">hello</span><span class="op" id="5789220">(</span><span class="op" id="5789221">)</span>&nbsp;<span class="builtintype" id="5789223">error</span>&nbsp;<span class="op" id="5789229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789232">if</span>&nbsp;<span class="op" id="5789235">!</span><span class="ident" id="5789236">c</span><span class="op" id="5789237">.</span><span class="ident" id="5789238">didHello</span>&nbsp;<span class="op" id="5789247">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5789251">c</span><span class="op" id="5789252">.</span><span class="ident" id="5789253">didHello</span>&nbsp;<span class="op" id="5789262">=</span>&nbsp;<span class="builtintype" id="5789264">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5789271">err</span>&nbsp;<span class="op" id="5789275">:=</span>&nbsp;<span class="ident" id="5789278">c</span><span class="op" id="5789279">.</span><span class="ident" id="5789280">ehlo</span><span class="op" id="5789284">(</span><span class="op" id="5789285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789289">if</span>&nbsp;<span class="ident" id="5789292">err</span>&nbsp;<span class="op" id="5789296">!=</span>&nbsp;<span class="builtintype" id="5789299">nil</span>&nbsp;<span class="op" id="5789303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5789308">c</span><span class="op" id="5789309">.</span><span class="ident" id="5789310">helloError</span>&nbsp;<span class="op" id="5789321">=</span>&nbsp;<span class="ident" id="5789323">c</span><span class="op" id="5789324">.</span><span class="ident" id="5789325">helo</span><span class="op" id="5789329">(</span><span class="op" id="5789330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5789334">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5789337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789340">return</span>&nbsp;<span class="ident" id="5789347">c</span><span class="op" id="5789348">.</span><span class="ident" id="5789349">helloError</span><br>
<span class="lineno"></span><span class="op" id="5789360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5789363">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="5789431">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5789500">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5789577">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="5789651">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5789680">func</span>&nbsp;<span class="op" id="5789685">(</span><span class="ident" id="5789686">c</span>&nbsp;<span class="op" id="5789688">*</span><span class="ident" id="5789689">Client</span><span class="op" id="5789695">)</span>&nbsp;<span class="ident" id="5789697">Hello</span><span class="op" id="5789702">(</span><span class="ident" id="5789703">localName</span>&nbsp;<span class="builtintype" id="5789713">string</span><span class="op" id="5789719">)</span>&nbsp;<span class="builtintype" id="5789721">error</span>&nbsp;<span class="op" id="5789727">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789730">if</span>&nbsp;<span class="ident" id="5789733">c</span><span class="op" id="5789734">.</span><span class="ident" id="5789735">didHello</span>&nbsp;<span class="op" id="5789744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789748">return</span>&nbsp;<span class="ident" id="5789755">errors</span><span class="op" id="5789761">.</span><span class="ident" id="5789762">New</span><span class="op" id="5789765">(</span><span class="string" id="5789766">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="5789806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5789809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5789812">c</span><span class="op" id="5789813">.</span><span class="ident" id="5789814">localName</span>&nbsp;<span class="op" id="5789824">=</span>&nbsp;<span class="ident" id="5789826">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5789837">return</span>&nbsp;<span class="ident" id="5789844">c</span><span class="op" id="5789845">.</span><span class="ident" id="5789846">hello</span><span class="op" id="5789851">(</span><span class="op" id="5789852">)</span><br>
<span class="lineno">95</span><span class="op" id="5789854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5789857">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="5789936">func</span>&nbsp;<span class="op" id="5789941">(</span><span class="ident" id="5789942">c</span>&nbsp;<span class="op" id="5789944">*</span><span class="ident" id="5789945">Client</span><span class="op" id="5789951">)</span>&nbsp;<span class="ident" id="5789953">cmd</span><span class="op" id="5789956">(</span><span class="ident" id="5789957">expectCode</span>&nbsp;<span class="builtintype" id="5789968">int</span><span class="op" id="5789971">,</span>&nbsp;<span class="ident" id="5789973">format</span>&nbsp;<span class="builtintype" id="5789980">string</span><span class="op" id="5789986">,</span>&nbsp;<span class="ident" id="5789988">args</span>&nbsp;<span class="op" id="5789993">...</span><span class="keyword" id="5789996">interface</span><span class="op" id="5790005">{</span><span class="op" id="5790006">}</span><span class="op" id="5790007">)</span>&nbsp;<span class="op" id="5790009">(</span><span class="builtintype" id="5790010">int</span><span class="op" id="5790013">,</span>&nbsp;<span class="builtintype" id="5790015">string</span><span class="op" id="5790021">,</span>&nbsp;<span class="builtintype" id="5790023">error</span><span class="op" id="5790028">)</span>&nbsp;<span class="op" id="5790030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790033">id</span><span class="op" id="5790035">,</span>&nbsp;<span class="ident" id="5790037">err</span>&nbsp;<span class="op" id="5790041">:=</span>&nbsp;<span class="ident" id="5790044">c</span><span class="op" id="5790045">.</span><span class="ident" id="5790046">Text</span><span class="op" id="5790050">.</span><span class="ident" id="5790051">Cmd</span><span class="op" id="5790054">(</span><span class="ident" id="5790055">format</span><span class="op" id="5790061">,</span>&nbsp;<span class="ident" id="5790063">args</span><span class="op" id="5790067">...</span><span class="op" id="5790070">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790073">if</span>&nbsp;<span class="ident" id="5790076">err</span>&nbsp;<span class="op" id="5790080">!=</span>&nbsp;<span class="builtintype" id="5790083">nil</span>&nbsp;<span class="op" id="5790087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790091">return</span>&nbsp;<span class="num" id="5790098">0</span><span class="op" id="5790099">,</span>&nbsp;<span class="string" id="5790101">&#34;&#34;</span><span class="op" id="5790103">,</span>&nbsp;<span class="ident" id="5790105">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5790110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790113">c</span><span class="op" id="5790114">.</span><span class="ident" id="5790115">Text</span><span class="op" id="5790119">.</span><span class="ident" id="5790120">StartResponse</span><span class="op" id="5790133">(</span><span class="ident" id="5790134">id</span><span class="op" id="5790136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790139">defer</span>&nbsp;<span class="ident" id="5790145">c</span><span class="op" id="5790146">.</span><span class="ident" id="5790147">Text</span><span class="op" id="5790151">.</span><span class="ident" id="5790152">EndResponse</span><span class="op" id="5790163">(</span><span class="ident" id="5790164">id</span><span class="op" id="5790166">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790169">code</span><span class="op" id="5790173">,</span>&nbsp;<span class="ident" id="5790175">msg</span><span class="op" id="5790178">,</span>&nbsp;<span class="ident" id="5790180">err</span>&nbsp;<span class="op" id="5790184">:=</span>&nbsp;<span class="ident" id="5790187">c</span><span class="op" id="5790188">.</span><span class="ident" id="5790189">Text</span><span class="op" id="5790193">.</span><span class="ident" id="5790194">ReadResponse</span><span class="op" id="5790206">(</span><span class="ident" id="5790207">expectCode</span><span class="op" id="5790217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790220">return</span>&nbsp;<span class="ident" id="5790227">code</span><span class="op" id="5790231">,</span>&nbsp;<span class="ident" id="5790233">msg</span><span class="op" id="5790236">,</span>&nbsp;<span class="ident" id="5790238">err</span><br>
<span class="lineno"></span><span class="op" id="5790242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5790245">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="5790324">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="5790357">func</span>&nbsp;<span class="op" id="5790362">(</span><span class="ident" id="5790363">c</span>&nbsp;<span class="op" id="5790365">*</span><span class="ident" id="5790366">Client</span><span class="op" id="5790372">)</span>&nbsp;<span class="ident" id="5790374">helo</span><span class="op" id="5790378">(</span><span class="op" id="5790379">)</span>&nbsp;<span class="builtintype" id="5790381">error</span>&nbsp;<span class="op" id="5790387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790390">c</span><span class="op" id="5790391">.</span><span class="ident" id="5790392">ext</span>&nbsp;<span class="op" id="5790396">=</span>&nbsp;<span class="builtintype" id="5790398">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790403">_</span><span class="op" id="5790404">,</span>&nbsp;<span class="ident" id="5790406">_</span><span class="op" id="5790407">,</span>&nbsp;<span class="ident" id="5790409">err</span>&nbsp;<span class="op" id="5790413">:=</span>&nbsp;<span class="ident" id="5790416">c</span><span class="op" id="5790417">.</span><span class="ident" id="5790418">cmd</span><span class="op" id="5790421">(</span><span class="num" id="5790422">250</span><span class="op" id="5790425">,</span>&nbsp;<span class="string" id="5790427">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="5790436">,</span>&nbsp;<span class="ident" id="5790438">c</span><span class="op" id="5790439">.</span><span class="ident" id="5790440">localName</span><span class="op" id="5790449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790452">return</span>&nbsp;<span class="ident" id="5790459">err</span><br>
<span class="lineno">115</span><span class="op" id="5790463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5790466">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5790533">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5790598">func</span>&nbsp;<span class="op" id="5790603">(</span><span class="ident" id="5790604">c</span>&nbsp;<span class="op" id="5790606">*</span><span class="ident" id="5790607">Client</span><span class="op" id="5790613">)</span>&nbsp;<span class="ident" id="5790615">ehlo</span><span class="op" id="5790619">(</span><span class="op" id="5790620">)</span>&nbsp;<span class="builtintype" id="5790622">error</span>&nbsp;<span class="op" id="5790628">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790631">_</span><span class="op" id="5790632">,</span>&nbsp;<span class="ident" id="5790634">msg</span><span class="op" id="5790637">,</span>&nbsp;<span class="ident" id="5790639">err</span>&nbsp;<span class="op" id="5790643">:=</span>&nbsp;<span class="ident" id="5790646">c</span><span class="op" id="5790647">.</span><span class="ident" id="5790648">cmd</span><span class="op" id="5790651">(</span><span class="num" id="5790652">250</span><span class="op" id="5790655">,</span>&nbsp;<span class="string" id="5790657">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="5790666">,</span>&nbsp;<span class="ident" id="5790668">c</span><span class="op" id="5790669">.</span><span class="ident" id="5790670">localName</span><span class="op" id="5790679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790682">if</span>&nbsp;<span class="ident" id="5790685">err</span>&nbsp;<span class="op" id="5790689">!=</span>&nbsp;<span class="builtintype" id="5790692">nil</span>&nbsp;<span class="op" id="5790696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790700">return</span>&nbsp;<span class="ident" id="5790707">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5790712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790715">ext</span>&nbsp;<span class="op" id="5790719">:=</span>&nbsp;<span class="builtinfunc" id="5790722">make</span><span class="op" id="5790726">(</span><span class="keyword" id="5790727">map</span><span class="op" id="5790730">[</span><span class="builtintype" id="5790731">string</span><span class="op" id="5790737">]</span><span class="builtintype" id="5790738">string</span><span class="op" id="5790744">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790747">extList</span>&nbsp;<span class="op" id="5790755">:=</span>&nbsp;<span class="ident" id="5790758">strings</span><span class="op" id="5790765">.</span><span class="ident" id="5790766">Split</span><span class="op" id="5790771">(</span><span class="ident" id="5790772">msg</span><span class="op" id="5790775">,</span>&nbsp;<span class="string" id="5790777">&#34;\n&#34;</span><span class="op" id="5790781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790784">if</span>&nbsp;<span class="builtinfunc" id="5790787">len</span><span class="op" id="5790790">(</span><span class="ident" id="5790791">extList</span><span class="op" id="5790798">)</span>&nbsp;<span class="op" id="5790800">&gt;</span>&nbsp;<span class="num" id="5790802">1</span>&nbsp;<span class="op" id="5790804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790808">extList</span>&nbsp;<span class="op" id="5790816">=</span>&nbsp;<span class="ident" id="5790818">extList</span><span class="op" id="5790825">[</span><span class="num" id="5790826">1</span><span class="op" id="5790827">:</span><span class="op" id="5790828">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790832">for</span>&nbsp;<span class="ident" id="5790836">_</span><span class="op" id="5790837">,</span>&nbsp;<span class="ident" id="5790839">line</span>&nbsp;<span class="op" id="5790844">:=</span>&nbsp;<span class="keyword" id="5790847">range</span>&nbsp;<span class="ident" id="5790853">extList</span>&nbsp;<span class="op" id="5790861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790866">args</span>&nbsp;<span class="op" id="5790871">:=</span>&nbsp;<span class="ident" id="5790874">strings</span><span class="op" id="5790881">.</span><span class="ident" id="5790882">SplitN</span><span class="op" id="5790888">(</span><span class="ident" id="5790889">line</span><span class="op" id="5790893">,</span>&nbsp;<span class="string" id="5790895">&#34;&nbsp;&#34;</span><span class="op" id="5790898">,</span>&nbsp;<span class="num" id="5790900">2</span><span class="op" id="5790901">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790906">if</span>&nbsp;<span class="builtinfunc" id="5790909">len</span><span class="op" id="5790912">(</span><span class="ident" id="5790913">args</span><span class="op" id="5790917">)</span>&nbsp;<span class="op" id="5790919">&gt;</span>&nbsp;<span class="num" id="5790921">1</span>&nbsp;<span class="op" id="5790923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790929">ext</span><span class="op" id="5790932">[</span><span class="ident" id="5790933">args</span><span class="op" id="5790937">[</span><span class="num" id="5790938">0</span><span class="op" id="5790939">]</span><span class="op" id="5790940">]</span>&nbsp;<span class="op" id="5790942">=</span>&nbsp;<span class="ident" id="5790944">args</span><span class="op" id="5790948">[</span><span class="num" id="5790949">1</span><span class="op" id="5790950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5790955">}</span>&nbsp;<span class="keyword" id="5790957">else</span>&nbsp;<span class="op" id="5790962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5790968">ext</span><span class="op" id="5790971">[</span><span class="ident" id="5790972">args</span><span class="op" id="5790976">[</span><span class="num" id="5790977">0</span><span class="op" id="5790978">]</span><span class="op" id="5790979">]</span>&nbsp;<span class="op" id="5790981">=</span>&nbsp;<span class="string" id="5790983">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5790989">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5790993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5790996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5790999">if</span>&nbsp;<span class="ident" id="5791002">mechs</span><span class="op" id="5791007">,</span>&nbsp;<span class="ident" id="5791009">ok</span>&nbsp;<span class="op" id="5791012">:=</span>&nbsp;<span class="ident" id="5791015">ext</span><span class="op" id="5791018">[</span><span class="string" id="5791019">&#34;AUTH&#34;</span><span class="op" id="5791025">]</span><span class="op" id="5791026">;</span>&nbsp;<span class="ident" id="5791028">ok</span>&nbsp;<span class="op" id="5791031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5791035">c</span><span class="op" id="5791036">.</span><span class="ident" id="5791037">auth</span>&nbsp;<span class="op" id="5791042">=</span>&nbsp;<span class="ident" id="5791044">strings</span><span class="op" id="5791051">.</span><span class="ident" id="5791052">Split</span><span class="op" id="5791057">(</span><span class="ident" id="5791058">mechs</span><span class="op" id="5791063">,</span>&nbsp;<span class="string" id="5791065">&#34;&nbsp;&#34;</span><span class="op" id="5791068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5791071">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5791074">c</span><span class="op" id="5791075">.</span><span class="ident" id="5791076">ext</span>&nbsp;<span class="op" id="5791080">=</span>&nbsp;<span class="ident" id="5791082">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791087">return</span>&nbsp;<span class="ident" id="5791094">err</span><br>
<span class="lineno"></span><span class="op" id="5791098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5791101">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="5791180">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="5791257">func</span>&nbsp;<span class="op" id="5791262">(</span><span class="ident" id="5791263">c</span>&nbsp;<span class="op" id="5791265">*</span><span class="ident" id="5791266">Client</span><span class="op" id="5791272">)</span>&nbsp;<span class="ident" id="5791274">StartTLS</span><span class="op" id="5791282">(</span><span class="ident" id="5791283">config</span>&nbsp;<span class="op" id="5791290">*</span><span class="ident" id="5791291">tls</span><span class="op" id="5791294">.</span><span class="ident" id="5791295">Config</span><span class="op" id="5791301">)</span>&nbsp;<span class="builtintype" id="5791303">error</span>&nbsp;<span class="op" id="5791309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791312">if</span>&nbsp;<span class="ident" id="5791315">err</span>&nbsp;<span class="op" id="5791319">:=</span>&nbsp;<span class="ident" id="5791322">c</span><span class="op" id="5791323">.</span><span class="ident" id="5791324">hello</span><span class="op" id="5791329">(</span><span class="op" id="5791330">)</span><span class="op" id="5791331">;</span>&nbsp;<span class="ident" id="5791333">err</span>&nbsp;<span class="op" id="5791337">!=</span>&nbsp;<span class="builtintype" id="5791340">nil</span>&nbsp;<span class="op" id="5791344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791348">return</span>&nbsp;<span class="ident" id="5791355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5791360">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5791363">_</span><span class="op" id="5791364">,</span>&nbsp;<span class="ident" id="5791366">_</span><span class="op" id="5791367">,</span>&nbsp;<span class="ident" id="5791369">err</span>&nbsp;<span class="op" id="5791373">:=</span>&nbsp;<span class="ident" id="5791376">c</span><span class="op" id="5791377">.</span><span class="ident" id="5791378">cmd</span><span class="op" id="5791381">(</span><span class="num" id="5791382">220</span><span class="op" id="5791385">,</span>&nbsp;<span class="string" id="5791387">&#34;STARTTLS&#34;</span><span class="op" id="5791397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791400">if</span>&nbsp;<span class="ident" id="5791403">err</span>&nbsp;<span class="op" id="5791407">!=</span>&nbsp;<span class="builtintype" id="5791410">nil</span>&nbsp;<span class="op" id="5791414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791418">return</span>&nbsp;<span class="ident" id="5791425">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5791430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5791433">c</span><span class="op" id="5791434">.</span><span class="ident" id="5791435">conn</span>&nbsp;<span class="op" id="5791440">=</span>&nbsp;<span class="ident" id="5791442">tls</span><span class="op" id="5791445">.</span><span class="ident" id="5791446">Client</span><span class="op" id="5791452">(</span><span class="ident" id="5791453">c</span><span class="op" id="5791454">.</span><span class="ident" id="5791455">conn</span><span class="op" id="5791459">,</span>&nbsp;<span class="ident" id="5791461">config</span><span class="op" id="5791467">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5791470">c</span><span class="op" id="5791471">.</span><span class="ident" id="5791472">Text</span>&nbsp;<span class="op" id="5791477">=</span>&nbsp;<span class="ident" id="5791479">textproto</span><span class="op" id="5791488">.</span><span class="ident" id="5791489">NewConn</span><span class="op" id="5791496">(</span><span class="ident" id="5791497">c</span><span class="op" id="5791498">.</span><span class="ident" id="5791499">conn</span><span class="op" id="5791503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5791506">c</span><span class="op" id="5791507">.</span><span class="ident" id="5791508">tls</span>&nbsp;<span class="op" id="5791512">=</span>&nbsp;<span class="builtintype" id="5791514">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791520">return</span>&nbsp;<span class="ident" id="5791527">c</span><span class="op" id="5791528">.</span><span class="ident" id="5791529">ehlo</span><span class="op" id="5791533">(</span><span class="op" id="5791534">)</span><br>
<span class="lineno"></span><span class="op" id="5791536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5791539">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5791604">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5791669">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="5791735">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="5791786">func</span>&nbsp;<span class="op" id="5791791">(</span><span class="ident" id="5791792">c</span>&nbsp;<span class="op" id="5791794">*</span><span class="ident" id="5791795">Client</span><span class="op" id="5791801">)</span>&nbsp;<span class="ident" id="5791803">Verify</span><span class="op" id="5791809">(</span><span class="ident" id="5791810">addr</span>&nbsp;<span class="builtintype" id="5791815">string</span><span class="op" id="5791821">)</span>&nbsp;<span class="builtintype" id="5791823">error</span>&nbsp;<span class="op" id="5791829">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791832">if</span>&nbsp;<span class="ident" id="5791835">err</span>&nbsp;<span class="op" id="5791839">:=</span>&nbsp;<span class="ident" id="5791842">c</span><span class="op" id="5791843">.</span><span class="ident" id="5791844">hello</span><span class="op" id="5791849">(</span><span class="op" id="5791850">)</span><span class="op" id="5791851">;</span>&nbsp;<span class="ident" id="5791853">err</span>&nbsp;<span class="op" id="5791857">!=</span>&nbsp;<span class="builtintype" id="5791860">nil</span>&nbsp;<span class="op" id="5791864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791868">return</span>&nbsp;<span class="ident" id="5791875">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5791880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5791883">_</span><span class="op" id="5791884">,</span>&nbsp;<span class="ident" id="5791886">_</span><span class="op" id="5791887">,</span>&nbsp;<span class="ident" id="5791889">err</span>&nbsp;<span class="op" id="5791893">:=</span>&nbsp;<span class="ident" id="5791896">c</span><span class="op" id="5791897">.</span><span class="ident" id="5791898">cmd</span><span class="op" id="5791901">(</span><span class="num" id="5791902">250</span><span class="op" id="5791905">,</span>&nbsp;<span class="string" id="5791907">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="5791916">,</span>&nbsp;<span class="ident" id="5791918">addr</span><span class="op" id="5791922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5791925">return</span>&nbsp;<span class="ident" id="5791932">err</span><br>
<span class="lineno">170</span><span class="op" id="5791936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5791939">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="5792015">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5792065">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="5792138">func</span>&nbsp;<span class="op" id="5792143">(</span><span class="ident" id="5792144">c</span>&nbsp;<span class="op" id="5792146">*</span><span class="ident" id="5792147">Client</span><span class="op" id="5792153">)</span>&nbsp;<span class="ident" id="5792155">Auth</span><span class="op" id="5792159">(</span><span class="ident" id="5792160">a</span>&nbsp;<span class="ident" id="5792162">Auth</span><span class="op" id="5792166">)</span>&nbsp;<span class="builtintype" id="5792168">error</span>&nbsp;<span class="op" id="5792174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792177">if</span>&nbsp;<span class="ident" id="5792180">err</span>&nbsp;<span class="op" id="5792184">:=</span>&nbsp;<span class="ident" id="5792187">c</span><span class="op" id="5792188">.</span><span class="ident" id="5792189">hello</span><span class="op" id="5792194">(</span><span class="op" id="5792195">)</span><span class="op" id="5792196">;</span>&nbsp;<span class="ident" id="5792198">err</span>&nbsp;<span class="op" id="5792202">!=</span>&nbsp;<span class="builtintype" id="5792205">nil</span>&nbsp;<span class="op" id="5792209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792213">return</span>&nbsp;<span class="ident" id="5792220">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5792225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792228">encoding</span>&nbsp;<span class="op" id="5792237">:=</span>&nbsp;<span class="ident" id="5792240">base64</span><span class="op" id="5792246">.</span><span class="ident" id="5792247">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792260">mech</span><span class="op" id="5792264">,</span>&nbsp;<span class="ident" id="5792266">resp</span><span class="op" id="5792270">,</span>&nbsp;<span class="ident" id="5792272">err</span>&nbsp;<span class="op" id="5792276">:=</span>&nbsp;<span class="ident" id="5792279">a</span><span class="op" id="5792280">.</span><span class="ident" id="5792281">Start</span><span class="op" id="5792286">(</span><span class="op" id="5792287">&amp;</span><span class="ident" id="5792288">ServerInfo</span><span class="op" id="5792298">{</span><span class="ident" id="5792299">c</span><span class="op" id="5792300">.</span><span class="ident" id="5792301">serverName</span><span class="op" id="5792311">,</span>&nbsp;<span class="ident" id="5792313">c</span><span class="op" id="5792314">.</span><span class="ident" id="5792315">tls</span><span class="op" id="5792318">,</span>&nbsp;<span class="ident" id="5792320">c</span><span class="op" id="5792321">.</span><span class="ident" id="5792322">auth</span><span class="op" id="5792326">}</span><span class="op" id="5792327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792330">if</span>&nbsp;<span class="ident" id="5792333">err</span>&nbsp;<span class="op" id="5792337">!=</span>&nbsp;<span class="builtintype" id="5792340">nil</span>&nbsp;<span class="op" id="5792344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792348">c</span><span class="op" id="5792349">.</span><span class="ident" id="5792350">Quit</span><span class="op" id="5792354">(</span><span class="op" id="5792355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792359">return</span>&nbsp;<span class="ident" id="5792366">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5792371">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792374">resp64</span>&nbsp;<span class="op" id="5792381">:=</span>&nbsp;<span class="builtinfunc" id="5792384">make</span><span class="op" id="5792388">(</span><span class="op" id="5792389">[</span><span class="op" id="5792390">]</span><span class="builtintype" id="5792391">byte</span><span class="op" id="5792395">,</span>&nbsp;<span class="ident" id="5792397">encoding</span><span class="op" id="5792405">.</span><span class="ident" id="5792406">EncodedLen</span><span class="op" id="5792416">(</span><span class="builtinfunc" id="5792417">len</span><span class="op" id="5792420">(</span><span class="ident" id="5792421">resp</span><span class="op" id="5792425">)</span><span class="op" id="5792426">)</span><span class="op" id="5792427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792430">encoding</span><span class="op" id="5792438">.</span><span class="ident" id="5792439">Encode</span><span class="op" id="5792445">(</span><span class="ident" id="5792446">resp64</span><span class="op" id="5792452">,</span>&nbsp;<span class="ident" id="5792454">resp</span><span class="op" id="5792458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792461">code</span><span class="op" id="5792465">,</span>&nbsp;<span class="ident" id="5792467">msg64</span><span class="op" id="5792472">,</span>&nbsp;<span class="ident" id="5792474">err</span>&nbsp;<span class="op" id="5792478">:=</span>&nbsp;<span class="ident" id="5792481">c</span><span class="op" id="5792482">.</span><span class="ident" id="5792483">cmd</span><span class="op" id="5792486">(</span><span class="num" id="5792487">0</span><span class="op" id="5792488">,</span>&nbsp;<span class="string" id="5792490">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="5792502">,</span>&nbsp;<span class="ident" id="5792504">mech</span><span class="op" id="5792508">,</span>&nbsp;<span class="ident" id="5792510">resp64</span><span class="op" id="5792516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792519">for</span>&nbsp;<span class="ident" id="5792523">err</span>&nbsp;<span class="op" id="5792527">==</span>&nbsp;<span class="builtintype" id="5792530">nil</span>&nbsp;<span class="op" id="5792534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792538">var</span>&nbsp;<span class="ident" id="5792542">msg</span>&nbsp;<span class="op" id="5792546">[</span><span class="op" id="5792547">]</span><span class="builtintype" id="5792548">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792555">switch</span>&nbsp;<span class="ident" id="5792562">code</span>&nbsp;<span class="op" id="5792567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792571">case</span>&nbsp;<span class="num" id="5792576">334</span><span class="op" id="5792579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792584">msg</span><span class="op" id="5792587">,</span>&nbsp;<span class="ident" id="5792589">err</span>&nbsp;<span class="op" id="5792593">=</span>&nbsp;<span class="ident" id="5792595">encoding</span><span class="op" id="5792603">.</span><span class="ident" id="5792604">DecodeString</span><span class="op" id="5792616">(</span><span class="ident" id="5792617">msg64</span><span class="op" id="5792622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792626">case</span>&nbsp;<span class="num" id="5792631">235</span><span class="op" id="5792634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5792639">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792704">msg</span>&nbsp;<span class="op" id="5792708">=</span>&nbsp;<span class="op" id="5792710">[</span><span class="op" id="5792711">]</span><span class="builtintype" id="5792712">byte</span><span class="op" id="5792716">(</span><span class="ident" id="5792717">msg64</span><span class="op" id="5792722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792726">default</span><span class="op" id="5792733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792738">err</span>&nbsp;<span class="op" id="5792742">=</span>&nbsp;<span class="op" id="5792744">&amp;</span><span class="ident" id="5792745">textproto</span><span class="op" id="5792754">.</span><span class="ident" id="5792755">Error</span><span class="op" id="5792760">{</span><span class="ident" id="5792761">Code</span><span class="op" id="5792765">:</span>&nbsp;<span class="ident" id="5792767">code</span><span class="op" id="5792771">,</span>&nbsp;<span class="ident" id="5792773">Msg</span><span class="op" id="5792776">:</span>&nbsp;<span class="ident" id="5792778">msg64</span><span class="op" id="5792783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5792787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792791">if</span>&nbsp;<span class="ident" id="5792794">err</span>&nbsp;<span class="op" id="5792798">==</span>&nbsp;<span class="builtintype" id="5792801">nil</span>&nbsp;<span class="op" id="5792805">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792810">resp</span><span class="op" id="5792814">,</span>&nbsp;<span class="ident" id="5792816">err</span>&nbsp;<span class="op" id="5792820">=</span>&nbsp;<span class="ident" id="5792822">a</span><span class="op" id="5792823">.</span><span class="ident" id="5792824">Next</span><span class="op" id="5792828">(</span><span class="ident" id="5792829">msg</span><span class="op" id="5792832">,</span>&nbsp;<span class="ident" id="5792834">code</span>&nbsp;<span class="op" id="5792839">==</span>&nbsp;<span class="num" id="5792842">334</span><span class="op" id="5792845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5792849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792853">if</span>&nbsp;<span class="ident" id="5792856">err</span>&nbsp;<span class="op" id="5792860">!=</span>&nbsp;<span class="builtintype" id="5792863">nil</span>&nbsp;<span class="op" id="5792867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5792872">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792893">c</span><span class="op" id="5792894">.</span><span class="ident" id="5792895">cmd</span><span class="op" id="5792898">(</span><span class="num" id="5792899">501</span><span class="op" id="5792902">,</span>&nbsp;<span class="string" id="5792904">&#34;*&#34;</span><span class="op" id="5792907">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792912">c</span><span class="op" id="5792913">.</span><span class="ident" id="5792914">Quit</span><span class="op" id="5792918">(</span><span class="op" id="5792919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792924">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5792932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792936">if</span>&nbsp;<span class="ident" id="5792939">resp</span>&nbsp;<span class="op" id="5792944">==</span>&nbsp;<span class="builtintype" id="5792947">nil</span>&nbsp;<span class="op" id="5792951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5792956">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5792964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792968">resp64</span>&nbsp;<span class="op" id="5792975">=</span>&nbsp;<span class="builtinfunc" id="5792977">make</span><span class="op" id="5792981">(</span><span class="op" id="5792982">[</span><span class="op" id="5792983">]</span><span class="builtintype" id="5792984">byte</span><span class="op" id="5792988">,</span>&nbsp;<span class="ident" id="5792990">encoding</span><span class="op" id="5792998">.</span><span class="ident" id="5792999">EncodedLen</span><span class="op" id="5793009">(</span><span class="builtinfunc" id="5793010">len</span><span class="op" id="5793013">(</span><span class="ident" id="5793014">resp</span><span class="op" id="5793018">)</span><span class="op" id="5793019">)</span><span class="op" id="5793020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793024">encoding</span><span class="op" id="5793032">.</span><span class="ident" id="5793033">Encode</span><span class="op" id="5793039">(</span><span class="ident" id="5793040">resp64</span><span class="op" id="5793046">,</span>&nbsp;<span class="ident" id="5793048">resp</span><span class="op" id="5793052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793056">code</span><span class="op" id="5793060">,</span>&nbsp;<span class="ident" id="5793062">msg64</span><span class="op" id="5793067">,</span>&nbsp;<span class="ident" id="5793069">err</span>&nbsp;<span class="op" id="5793073">=</span>&nbsp;<span class="ident" id="5793075">c</span><span class="op" id="5793076">.</span><span class="ident" id="5793077">cmd</span><span class="op" id="5793080">(</span><span class="num" id="5793081">0</span><span class="op" id="5793082">,</span>&nbsp;<span class="builtintype" id="5793084">string</span><span class="op" id="5793090">(</span><span class="ident" id="5793091">resp64</span><span class="op" id="5793097">)</span><span class="op" id="5793098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5793101">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5793104">return</span>&nbsp;<span class="ident" id="5793111">err</span><br>
<span class="lineno"></span><span class="op" id="5793115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5793118">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5793196">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="5793274">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5793288">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="5793368">func</span>&nbsp;<span class="op" id="5793373">(</span><span class="ident" id="5793374">c</span>&nbsp;<span class="op" id="5793376">*</span><span class="ident" id="5793377">Client</span><span class="op" id="5793383">)</span>&nbsp;<span class="ident" id="5793385">Mail</span><span class="op" id="5793389">(</span><span class="ident" id="5793390">from</span>&nbsp;<span class="builtintype" id="5793395">string</span><span class="op" id="5793401">)</span>&nbsp;<span class="builtintype" id="5793403">error</span>&nbsp;<span class="op" id="5793409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5793412">if</span>&nbsp;<span class="ident" id="5793415">err</span>&nbsp;<span class="op" id="5793419">:=</span>&nbsp;<span class="ident" id="5793422">c</span><span class="op" id="5793423">.</span><span class="ident" id="5793424">hello</span><span class="op" id="5793429">(</span><span class="op" id="5793430">)</span><span class="op" id="5793431">;</span>&nbsp;<span class="ident" id="5793433">err</span>&nbsp;<span class="op" id="5793437">!=</span>&nbsp;<span class="builtintype" id="5793440">nil</span>&nbsp;<span class="op" id="5793444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5793448">return</span>&nbsp;<span class="ident" id="5793455">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5793460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793463">cmdStr</span>&nbsp;<span class="op" id="5793470">:=</span>&nbsp;<span class="string" id="5793473">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5793491">if</span>&nbsp;<span class="ident" id="5793494">c</span><span class="op" id="5793495">.</span><span class="ident" id="5793496">ext</span>&nbsp;<span class="op" id="5793500">!=</span>&nbsp;<span class="builtintype" id="5793503">nil</span>&nbsp;<span class="op" id="5793507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5793511">if</span>&nbsp;<span class="ident" id="5793514">_</span><span class="op" id="5793515">,</span>&nbsp;<span class="ident" id="5793517">ok</span>&nbsp;<span class="op" id="5793520">:=</span>&nbsp;<span class="ident" id="5793523">c</span><span class="op" id="5793524">.</span><span class="ident" id="5793525">ext</span><span class="op" id="5793528">[</span><span class="string" id="5793529">&#34;8BITMIME&#34;</span><span class="op" id="5793539">]</span><span class="op" id="5793540">;</span>&nbsp;<span class="ident" id="5793542">ok</span>&nbsp;<span class="op" id="5793545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793550">cmdStr</span>&nbsp;<span class="op" id="5793557">+=</span>&nbsp;<span class="string" id="5793560">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5793579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5793582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793585">_</span><span class="op" id="5793586">,</span>&nbsp;<span class="ident" id="5793588">_</span><span class="op" id="5793589">,</span>&nbsp;<span class="ident" id="5793591">err</span>&nbsp;<span class="op" id="5793595">:=</span>&nbsp;<span class="ident" id="5793598">c</span><span class="op" id="5793599">.</span><span class="ident" id="5793600">cmd</span><span class="op" id="5793603">(</span><span class="num" id="5793604">250</span><span class="op" id="5793607">,</span>&nbsp;<span class="ident" id="5793609">cmdStr</span><span class="op" id="5793615">,</span>&nbsp;<span class="ident" id="5793617">from</span><span class="op" id="5793621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5793624">return</span>&nbsp;<span class="ident" id="5793631">err</span><br>
<span class="lineno"></span><span class="op" id="5793635">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5793638">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5793716">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5793792">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="5793829">func</span>&nbsp;<span class="op" id="5793834">(</span><span class="ident" id="5793835">c</span>&nbsp;<span class="op" id="5793837">*</span><span class="ident" id="5793838">Client</span><span class="op" id="5793844">)</span>&nbsp;<span class="ident" id="5793846">Rcpt</span><span class="op" id="5793850">(</span><span class="ident" id="5793851">to</span>&nbsp;<span class="builtintype" id="5793854">string</span><span class="op" id="5793860">)</span>&nbsp;<span class="builtintype" id="5793862">error</span>&nbsp;<span class="op" id="5793868">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793871">_</span><span class="op" id="5793872">,</span>&nbsp;<span class="ident" id="5793874">_</span><span class="op" id="5793875">,</span>&nbsp;<span class="ident" id="5793877">err</span>&nbsp;<span class="op" id="5793881">:=</span>&nbsp;<span class="ident" id="5793884">c</span><span class="op" id="5793885">.</span><span class="ident" id="5793886">cmd</span><span class="op" id="5793889">(</span><span class="num" id="5793890">25</span><span class="op" id="5793892">,</span>&nbsp;<span class="string" id="5793894">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="5793908">,</span>&nbsp;<span class="ident" id="5793910">to</span><span class="op" id="5793912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5793915">return</span>&nbsp;<span class="ident" id="5793922">err</span><br>
<span class="lineno"></span><span class="op" id="5793926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793929">type</span>&nbsp;<span class="ident" id="5793934">dataCloser</span>&nbsp;<span class="keyword" id="5793945">struct</span>&nbsp;<span class="op" id="5793952">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793955">c</span>&nbsp;<span class="op" id="5793957">*</span><span class="ident" id="5793958">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793966">io</span><span class="op" id="5793968">.</span><span class="ident" id="5793969">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="5793981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793984">func</span>&nbsp;<span class="op" id="5793989">(</span><span class="ident" id="5793990">d</span>&nbsp;<span class="op" id="5793992">*</span><span class="ident" id="5793993">dataCloser</span><span class="op" id="5794003">)</span>&nbsp;<span class="ident" id="5794005">Close</span><span class="op" id="5794010">(</span><span class="op" id="5794011">)</span>&nbsp;<span class="builtintype" id="5794013">error</span>&nbsp;<span class="op" id="5794019">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794022">d</span><span class="op" id="5794023">.</span><span class="ident" id="5794024">WriteCloser</span><span class="op" id="5794035">.</span><span class="ident" id="5794036">Close</span><span class="op" id="5794041">(</span><span class="op" id="5794042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794045">_</span><span class="op" id="5794046">,</span>&nbsp;<span class="ident" id="5794048">_</span><span class="op" id="5794049">,</span>&nbsp;<span class="ident" id="5794051">err</span>&nbsp;<span class="op" id="5794055">:=</span>&nbsp;<span class="ident" id="5794058">d</span><span class="op" id="5794059">.</span><span class="ident" id="5794060">c</span><span class="op" id="5794061">.</span><span class="ident" id="5794062">Text</span><span class="op" id="5794066">.</span><span class="ident" id="5794067">ReadResponse</span><span class="op" id="5794079">(</span><span class="num" id="5794080">250</span><span class="op" id="5794083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794086">return</span>&nbsp;<span class="ident" id="5794093">err</span><br>
<span class="lineno"></span><span class="op" id="5794097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5794100">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5794170">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="5794239">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5794280">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="5794345">func</span>&nbsp;<span class="op" id="5794350">(</span><span class="ident" id="5794351">c</span>&nbsp;<span class="op" id="5794353">*</span><span class="ident" id="5794354">Client</span><span class="op" id="5794360">)</span>&nbsp;<span class="ident" id="5794362">Data</span><span class="op" id="5794366">(</span><span class="op" id="5794367">)</span>&nbsp;<span class="op" id="5794369">(</span><span class="ident" id="5794370">io</span><span class="op" id="5794372">.</span><span class="ident" id="5794373">WriteCloser</span><span class="op" id="5794384">,</span>&nbsp;<span class="builtintype" id="5794386">error</span><span class="op" id="5794391">)</span>&nbsp;<span class="op" id="5794393">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794396">_</span><span class="op" id="5794397">,</span>&nbsp;<span class="ident" id="5794399">_</span><span class="op" id="5794400">,</span>&nbsp;<span class="ident" id="5794402">err</span>&nbsp;<span class="op" id="5794406">:=</span>&nbsp;<span class="ident" id="5794409">c</span><span class="op" id="5794410">.</span><span class="ident" id="5794411">cmd</span><span class="op" id="5794414">(</span><span class="num" id="5794415">354</span><span class="op" id="5794418">,</span>&nbsp;<span class="string" id="5794420">&#34;DATA&#34;</span><span class="op" id="5794426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794429">if</span>&nbsp;<span class="ident" id="5794432">err</span>&nbsp;<span class="op" id="5794436">!=</span>&nbsp;<span class="builtintype" id="5794439">nil</span>&nbsp;<span class="op" id="5794443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794447">return</span>&nbsp;<span class="builtintype" id="5794454">nil</span><span class="op" id="5794457">,</span>&nbsp;<span class="ident" id="5794459">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5794464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794467">return</span>&nbsp;<span class="op" id="5794474">&amp;</span><span class="ident" id="5794475">dataCloser</span><span class="op" id="5794485">{</span><span class="ident" id="5794486">c</span><span class="op" id="5794487">,</span>&nbsp;<span class="ident" id="5794489">c</span><span class="op" id="5794490">.</span><span class="ident" id="5794491">Text</span><span class="op" id="5794495">.</span><span class="ident" id="5794496">DotWriter</span><span class="op" id="5794505">(</span><span class="op" id="5794506">)</span><span class="op" id="5794507">}</span><span class="op" id="5794508">,</span>&nbsp;<span class="builtintype" id="5794510">nil</span><br>
<span class="lineno">265</span><span class="op" id="5794514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5794517">var</span>&nbsp;<span class="ident" id="5794521">testHookStartTLS</span>&nbsp;<span class="keyword" id="5794538">func</span><span class="op" id="5794542">(</span><span class="op" id="5794543">*</span><span class="ident" id="5794544">tls</span><span class="op" id="5794547">.</span><span class="ident" id="5794548">Config</span><span class="op" id="5794554">)</span>&nbsp;<span class="comment" id="5794556">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5794582">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="5794645">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="5794715">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5794783">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="5794799">func</span>&nbsp;<span class="ident" id="5794804">SendMail</span><span class="op" id="5794812">(</span><span class="ident" id="5794813">addr</span>&nbsp;<span class="builtintype" id="5794818">string</span><span class="op" id="5794824">,</span>&nbsp;<span class="ident" id="5794826">a</span>&nbsp;<span class="ident" id="5794828">Auth</span><span class="op" id="5794832">,</span>&nbsp;<span class="ident" id="5794834">from</span>&nbsp;<span class="builtintype" id="5794839">string</span><span class="op" id="5794845">,</span>&nbsp;<span class="ident" id="5794847">to</span>&nbsp;<span class="op" id="5794850">[</span><span class="op" id="5794851">]</span><span class="builtintype" id="5794852">string</span><span class="op" id="5794858">,</span>&nbsp;<span class="ident" id="5794860">msg</span>&nbsp;<span class="op" id="5794864">[</span><span class="op" id="5794865">]</span><span class="builtintype" id="5794866">byte</span><span class="op" id="5794870">)</span>&nbsp;<span class="builtintype" id="5794872">error</span>&nbsp;<span class="op" id="5794878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794881">c</span><span class="op" id="5794882">,</span>&nbsp;<span class="ident" id="5794884">err</span>&nbsp;<span class="op" id="5794888">:=</span>&nbsp;<span class="ident" id="5794891">Dial</span><span class="op" id="5794895">(</span><span class="ident" id="5794896">addr</span><span class="op" id="5794900">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794903">if</span>&nbsp;<span class="ident" id="5794906">err</span>&nbsp;<span class="op" id="5794910">!=</span>&nbsp;<span class="builtintype" id="5794913">nil</span>&nbsp;<span class="op" id="5794917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794921">return</span>&nbsp;<span class="ident" id="5794928">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5794933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794936">defer</span>&nbsp;<span class="ident" id="5794942">c</span><span class="op" id="5794943">.</span><span class="ident" id="5794944">Close</span><span class="op" id="5794949">(</span><span class="op" id="5794950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794953">if</span>&nbsp;<span class="ident" id="5794956">err</span>&nbsp;<span class="op" id="5794960">=</span>&nbsp;<span class="ident" id="5794962">c</span><span class="op" id="5794963">.</span><span class="ident" id="5794964">hello</span><span class="op" id="5794969">(</span><span class="op" id="5794970">)</span><span class="op" id="5794971">;</span>&nbsp;<span class="ident" id="5794973">err</span>&nbsp;<span class="op" id="5794977">!=</span>&nbsp;<span class="builtintype" id="5794980">nil</span>&nbsp;<span class="op" id="5794984">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5794988">return</span>&nbsp;<span class="ident" id="5794995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795003">if</span>&nbsp;<span class="ident" id="5795006">ok</span><span class="op" id="5795008">,</span>&nbsp;<span class="ident" id="5795010">_</span>&nbsp;<span class="op" id="5795012">:=</span>&nbsp;<span class="ident" id="5795015">c</span><span class="op" id="5795016">.</span><span class="ident" id="5795017">Extension</span><span class="op" id="5795026">(</span><span class="string" id="5795027">&#34;STARTTLS&#34;</span><span class="op" id="5795037">)</span><span class="op" id="5795038">;</span>&nbsp;<span class="ident" id="5795040">ok</span>&nbsp;<span class="op" id="5795043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5795047">config</span>&nbsp;<span class="op" id="5795054">:=</span>&nbsp;<span class="op" id="5795057">&amp;</span><span class="ident" id="5795058">tls</span><span class="op" id="5795061">.</span><span class="ident" id="5795062">Config</span><span class="op" id="5795068">{</span><span class="ident" id="5795069">ServerName</span><span class="op" id="5795079">:</span>&nbsp;<span class="ident" id="5795081">c</span><span class="op" id="5795082">.</span><span class="ident" id="5795083">serverName</span><span class="op" id="5795093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795097">if</span>&nbsp;<span class="ident" id="5795100">testHookStartTLS</span>&nbsp;<span class="op" id="5795117">!=</span>&nbsp;<span class="builtintype" id="5795120">nil</span>&nbsp;<span class="op" id="5795124">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5795129">testHookStartTLS</span><span class="op" id="5795145">(</span><span class="ident" id="5795146">config</span><span class="op" id="5795152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795160">if</span>&nbsp;<span class="ident" id="5795163">err</span>&nbsp;<span class="op" id="5795167">=</span>&nbsp;<span class="ident" id="5795169">c</span><span class="op" id="5795170">.</span><span class="ident" id="5795171">StartTLS</span><span class="op" id="5795179">(</span><span class="ident" id="5795180">config</span><span class="op" id="5795186">)</span><span class="op" id="5795187">;</span>&nbsp;<span class="ident" id="5795189">err</span>&nbsp;<span class="op" id="5795193">!=</span>&nbsp;<span class="builtintype" id="5795196">nil</span>&nbsp;<span class="op" id="5795200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795205">return</span>&nbsp;<span class="ident" id="5795212">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795218">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795224">if</span>&nbsp;<span class="ident" id="5795227">a</span>&nbsp;<span class="op" id="5795229">!=</span>&nbsp;<span class="builtintype" id="5795232">nil</span>&nbsp;<span class="op" id="5795236">&amp;&amp;</span>&nbsp;<span class="ident" id="5795239">c</span><span class="op" id="5795240">.</span><span class="ident" id="5795241">ext</span>&nbsp;<span class="op" id="5795245">!=</span>&nbsp;<span class="builtintype" id="5795248">nil</span>&nbsp;<span class="op" id="5795252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795256">if</span>&nbsp;<span class="ident" id="5795259">_</span><span class="op" id="5795260">,</span>&nbsp;<span class="ident" id="5795262">ok</span>&nbsp;<span class="op" id="5795265">:=</span>&nbsp;<span class="ident" id="5795268">c</span><span class="op" id="5795269">.</span><span class="ident" id="5795270">ext</span><span class="op" id="5795273">[</span><span class="string" id="5795274">&#34;AUTH&#34;</span><span class="op" id="5795280">]</span><span class="op" id="5795281">;</span>&nbsp;<span class="ident" id="5795283">ok</span>&nbsp;<span class="op" id="5795286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795291">if</span>&nbsp;<span class="ident" id="5795294">err</span>&nbsp;<span class="op" id="5795298">=</span>&nbsp;<span class="ident" id="5795300">c</span><span class="op" id="5795301">.</span><span class="ident" id="5795302">Auth</span><span class="op" id="5795306">(</span><span class="ident" id="5795307">a</span><span class="op" id="5795308">)</span><span class="op" id="5795309">;</span>&nbsp;<span class="ident" id="5795311">err</span>&nbsp;<span class="op" id="5795315">!=</span>&nbsp;<span class="builtintype" id="5795318">nil</span>&nbsp;<span class="op" id="5795322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795328">return</span>&nbsp;<span class="ident" id="5795335">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795352">if</span>&nbsp;<span class="ident" id="5795355">err</span>&nbsp;<span class="op" id="5795359">=</span>&nbsp;<span class="ident" id="5795361">c</span><span class="op" id="5795362">.</span><span class="ident" id="5795363">Mail</span><span class="op" id="5795367">(</span><span class="ident" id="5795368">from</span><span class="op" id="5795372">)</span><span class="op" id="5795373">;</span>&nbsp;<span class="ident" id="5795375">err</span>&nbsp;<span class="op" id="5795379">!=</span>&nbsp;<span class="builtintype" id="5795382">nil</span>&nbsp;<span class="op" id="5795386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795390">return</span>&nbsp;<span class="ident" id="5795397">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795405">for</span>&nbsp;<span class="ident" id="5795409">_</span><span class="op" id="5795410">,</span>&nbsp;<span class="ident" id="5795412">addr</span>&nbsp;<span class="op" id="5795417">:=</span>&nbsp;<span class="keyword" id="5795420">range</span>&nbsp;<span class="ident" id="5795426">to</span>&nbsp;<span class="op" id="5795429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795433">if</span>&nbsp;<span class="ident" id="5795436">err</span>&nbsp;<span class="op" id="5795440">=</span>&nbsp;<span class="ident" id="5795442">c</span><span class="op" id="5795443">.</span><span class="ident" id="5795444">Rcpt</span><span class="op" id="5795448">(</span><span class="ident" id="5795449">addr</span><span class="op" id="5795453">)</span><span class="op" id="5795454">;</span>&nbsp;<span class="ident" id="5795456">err</span>&nbsp;<span class="op" id="5795460">!=</span>&nbsp;<span class="builtintype" id="5795463">nil</span>&nbsp;<span class="op" id="5795467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795472">return</span>&nbsp;<span class="ident" id="5795479">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795485">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5795491">w</span><span class="op" id="5795492">,</span>&nbsp;<span class="ident" id="5795494">err</span>&nbsp;<span class="op" id="5795498">:=</span>&nbsp;<span class="ident" id="5795501">c</span><span class="op" id="5795502">.</span><span class="ident" id="5795503">Data</span><span class="op" id="5795507">(</span><span class="op" id="5795508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795511">if</span>&nbsp;<span class="ident" id="5795514">err</span>&nbsp;<span class="op" id="5795518">!=</span>&nbsp;<span class="builtintype" id="5795521">nil</span>&nbsp;<span class="op" id="5795525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795529">return</span>&nbsp;<span class="ident" id="5795536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795541">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5795544">_</span><span class="op" id="5795545">,</span>&nbsp;<span class="ident" id="5795547">err</span>&nbsp;<span class="op" id="5795551">=</span>&nbsp;<span class="ident" id="5795553">w</span><span class="op" id="5795554">.</span><span class="ident" id="5795555">Write</span><span class="op" id="5795560">(</span><span class="ident" id="5795561">msg</span><span class="op" id="5795564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795567">if</span>&nbsp;<span class="ident" id="5795570">err</span>&nbsp;<span class="op" id="5795574">!=</span>&nbsp;<span class="builtintype" id="5795577">nil</span>&nbsp;<span class="op" id="5795581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795585">return</span>&nbsp;<span class="ident" id="5795592">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5795600">err</span>&nbsp;<span class="op" id="5795604">=</span>&nbsp;<span class="ident" id="5795606">w</span><span class="op" id="5795607">.</span><span class="ident" id="5795608">Close</span><span class="op" id="5795613">(</span><span class="op" id="5795614">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795617">if</span>&nbsp;<span class="ident" id="5795620">err</span>&nbsp;<span class="op" id="5795624">!=</span>&nbsp;<span class="builtintype" id="5795627">nil</span>&nbsp;<span class="op" id="5795631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795635">return</span>&nbsp;<span class="ident" id="5795642">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795650">return</span>&nbsp;<span class="ident" id="5795657">c</span><span class="op" id="5795658">.</span><span class="ident" id="5795659">Quit</span><span class="op" id="5795663">(</span><span class="op" id="5795664">)</span><br>
<span class="lineno"></span><span class="op" id="5795666">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="5795669">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5795737">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="5795811">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5795879">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="5795918">func</span>&nbsp;<span class="op" id="5795923">(</span><span class="ident" id="5795924">c</span>&nbsp;<span class="op" id="5795926">*</span><span class="ident" id="5795927">Client</span><span class="op" id="5795933">)</span>&nbsp;<span class="ident" id="5795935">Extension</span><span class="op" id="5795944">(</span><span class="ident" id="5795945">ext</span>&nbsp;<span class="builtintype" id="5795949">string</span><span class="op" id="5795955">)</span>&nbsp;<span class="op" id="5795957">(</span><span class="builtintype" id="5795958">bool</span><span class="op" id="5795962">,</span>&nbsp;<span class="builtintype" id="5795964">string</span><span class="op" id="5795970">)</span>&nbsp;<span class="op" id="5795972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5795975">if</span>&nbsp;<span class="ident" id="5795978">err</span>&nbsp;<span class="op" id="5795982">:=</span>&nbsp;<span class="ident" id="5795985">c</span><span class="op" id="5795986">.</span><span class="ident" id="5795987">hello</span><span class="op" id="5795992">(</span><span class="op" id="5795993">)</span><span class="op" id="5795994">;</span>&nbsp;<span class="ident" id="5795996">err</span>&nbsp;<span class="op" id="5796000">!=</span>&nbsp;<span class="builtintype" id="5796003">nil</span>&nbsp;<span class="op" id="5796007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796011">return</span>&nbsp;<span class="builtintype" id="5796018">false</span><span class="op" id="5796023">,</span>&nbsp;<span class="string" id="5796025">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5796029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796032">if</span>&nbsp;<span class="ident" id="5796035">c</span><span class="op" id="5796036">.</span><span class="ident" id="5796037">ext</span>&nbsp;<span class="op" id="5796041">==</span>&nbsp;<span class="builtintype" id="5796044">nil</span>&nbsp;<span class="op" id="5796048">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796052">return</span>&nbsp;<span class="builtintype" id="5796059">false</span><span class="op" id="5796064">,</span>&nbsp;<span class="string" id="5796066">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5796070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5796073">ext</span>&nbsp;<span class="op" id="5796077">=</span>&nbsp;<span class="ident" id="5796079">strings</span><span class="op" id="5796086">.</span><span class="ident" id="5796087">ToUpper</span><span class="op" id="5796094">(</span><span class="ident" id="5796095">ext</span><span class="op" id="5796098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5796101">param</span><span class="op" id="5796106">,</span>&nbsp;<span class="ident" id="5796108">ok</span>&nbsp;<span class="op" id="5796111">:=</span>&nbsp;<span class="ident" id="5796114">c</span><span class="op" id="5796115">.</span><span class="ident" id="5796116">ext</span><span class="op" id="5796119">[</span><span class="ident" id="5796120">ext</span><span class="op" id="5796123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796126">return</span>&nbsp;<span class="ident" id="5796133">ok</span><span class="op" id="5796135">,</span>&nbsp;<span class="ident" id="5796137">param</span><br>
<span class="lineno">335</span><span class="op" id="5796143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5796146">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="5796219">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="5796235">func</span>&nbsp;<span class="op" id="5796240">(</span><span class="ident" id="5796241">c</span>&nbsp;<span class="op" id="5796243">*</span><span class="ident" id="5796244">Client</span><span class="op" id="5796250">)</span>&nbsp;<span class="ident" id="5796252">Reset</span><span class="op" id="5796257">(</span><span class="op" id="5796258">)</span>&nbsp;<span class="builtintype" id="5796260">error</span>&nbsp;<span class="op" id="5796266">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796269">if</span>&nbsp;<span class="ident" id="5796272">err</span>&nbsp;<span class="op" id="5796276">:=</span>&nbsp;<span class="ident" id="5796279">c</span><span class="op" id="5796280">.</span><span class="ident" id="5796281">hello</span><span class="op" id="5796286">(</span><span class="op" id="5796287">)</span><span class="op" id="5796288">;</span>&nbsp;<span class="ident" id="5796290">err</span>&nbsp;<span class="op" id="5796294">!=</span>&nbsp;<span class="builtintype" id="5796297">nil</span>&nbsp;<span class="op" id="5796301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796305">return</span>&nbsp;<span class="ident" id="5796312">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5796317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5796320">_</span><span class="op" id="5796321">,</span>&nbsp;<span class="ident" id="5796323">_</span><span class="op" id="5796324">,</span>&nbsp;<span class="ident" id="5796326">err</span>&nbsp;<span class="op" id="5796330">:=</span>&nbsp;<span class="ident" id="5796333">c</span><span class="op" id="5796334">.</span><span class="ident" id="5796335">cmd</span><span class="op" id="5796338">(</span><span class="num" id="5796339">250</span><span class="op" id="5796342">,</span>&nbsp;<span class="string" id="5796344">&#34;RSET&#34;</span><span class="op" id="5796350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796353">return</span>&nbsp;<span class="ident" id="5796360">err</span><br>
<span class="lineno">345</span><span class="op" id="5796364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5796367">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5796439">func</span>&nbsp;<span class="op" id="5796444">(</span><span class="ident" id="5796445">c</span>&nbsp;<span class="op" id="5796447">*</span><span class="ident" id="5796448">Client</span><span class="op" id="5796454">)</span>&nbsp;<span class="ident" id="5796456">Quit</span><span class="op" id="5796460">(</span><span class="op" id="5796461">)</span>&nbsp;<span class="builtintype" id="5796463">error</span>&nbsp;<span class="op" id="5796469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796472">if</span>&nbsp;<span class="ident" id="5796475">err</span>&nbsp;<span class="op" id="5796479">:=</span>&nbsp;<span class="ident" id="5796482">c</span><span class="op" id="5796483">.</span><span class="ident" id="5796484">hello</span><span class="op" id="5796489">(</span><span class="op" id="5796490">)</span><span class="op" id="5796491">;</span>&nbsp;<span class="ident" id="5796493">err</span>&nbsp;<span class="op" id="5796497">!=</span>&nbsp;<span class="builtintype" id="5796500">nil</span>&nbsp;<span class="op" id="5796504">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796508">return</span>&nbsp;<span class="ident" id="5796515">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5796520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5796523">_</span><span class="op" id="5796524">,</span>&nbsp;<span class="ident" id="5796526">_</span><span class="op" id="5796527">,</span>&nbsp;<span class="ident" id="5796529">err</span>&nbsp;<span class="op" id="5796533">:=</span>&nbsp;<span class="ident" id="5796536">c</span><span class="op" id="5796537">.</span><span class="ident" id="5796538">cmd</span><span class="op" id="5796541">(</span><span class="num" id="5796542">221</span><span class="op" id="5796545">,</span>&nbsp;<span class="string" id="5796547">&#34;QUIT&#34;</span><span class="op" id="5796553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796556">if</span>&nbsp;<span class="ident" id="5796559">err</span>&nbsp;<span class="op" id="5796563">!=</span>&nbsp;<span class="builtintype" id="5796566">nil</span>&nbsp;<span class="op" id="5796570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796574">return</span>&nbsp;<span class="ident" id="5796581">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5796586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5796589">return</span>&nbsp;<span class="ident" id="5796596">c</span><span class="op" id="5796597">.</span><span class="ident" id="5796598">Text</span><span class="op" id="5796602">.</span><span class="ident" id="5796603">Close</span><span class="op" id="5796608">(</span><span class="op" id="5796609">)</span><br>
<span class="lineno"></span><span class="op" id="5796611">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
