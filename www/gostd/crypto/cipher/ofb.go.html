<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3541639">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3541694">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3541748">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3541799">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3541831">package</span>&nbsp;<span class="ident" id="3541839">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3541847">type</span>&nbsp;<span class="ident" id="3541852">ofb</span>&nbsp;<span class="keyword" id="3541856">struct</span>&nbsp;<span class="op" id="3541863">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541866">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541874">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541881">cipher</span>&nbsp;&nbsp;<span class="op" id="3541889">[</span><span class="op" id="3541890">]</span><span class="builtintype" id="3541891">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541897">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541905">[</span><span class="op" id="3541906">]</span><span class="builtintype" id="3541907">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541913">outUsed</span>&nbsp;<span class="builtintype" id="3541921">int</span><br>
<span class="lineno"></span><span class="op" id="3541925">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3541928">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="3542006">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="3542086">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3542108">func</span>&nbsp;<span class="ident" id="3542113">NewOFB</span><span class="op" id="3542119">(</span><span class="ident" id="3542120">b</span>&nbsp;<span class="ident" id="3542122">Block</span><span class="op" id="3542127">,</span>&nbsp;<span class="ident" id="3542129">iv</span>&nbsp;<span class="op" id="3542132">[</span><span class="op" id="3542133">]</span><span class="builtintype" id="3542134">byte</span><span class="op" id="3542138">)</span>&nbsp;<span class="ident" id="3542140">Stream</span>&nbsp;<span class="op" id="3542147">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542150">blockSize</span>&nbsp;<span class="op" id="3542160">:=</span>&nbsp;<span class="ident" id="3542163">b</span><span class="op" id="3542164">.</span><span class="ident" id="3542165">BlockSize</span><span class="op" id="3542174">(</span><span class="op" id="3542175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542178">if</span>&nbsp;<span class="builtinfunc" id="3542181">len</span><span class="op" id="3542184">(</span><span class="ident" id="3542185">iv</span><span class="op" id="3542187">)</span>&nbsp;<span class="op" id="3542189">!=</span>&nbsp;<span class="ident" id="3542192">blockSize</span>&nbsp;<span class="op" id="3542202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542206">return</span>&nbsp;<span class="ident" id="3542213">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542221">bufSize</span>&nbsp;<span class="op" id="3542229">:=</span>&nbsp;<span class="ident" id="3542232">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542250">if</span>&nbsp;<span class="ident" id="3542253">bufSize</span>&nbsp;<span class="op" id="3542261">&lt;</span>&nbsp;<span class="ident" id="3542263">blockSize</span>&nbsp;<span class="op" id="3542273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542277">bufSize</span>&nbsp;<span class="op" id="3542285">=</span>&nbsp;<span class="ident" id="3542287">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542301">x</span>&nbsp;<span class="op" id="3542303">:=</span>&nbsp;<span class="op" id="3542306">&amp;</span><span class="ident" id="3542307">ofb</span><span class="op" id="3542310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542314">b</span><span class="op" id="3542315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542323">b</span><span class="op" id="3542324">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542328">cipher</span><span class="op" id="3542334">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3542337">make</span><span class="op" id="3542341">(</span><span class="op" id="3542342">[</span><span class="op" id="3542343">]</span><span class="builtintype" id="3542344">byte</span><span class="op" id="3542348">,</span>&nbsp;<span class="ident" id="3542350">blockSize</span><span class="op" id="3542359">)</span><span class="op" id="3542360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542364">out</span><span class="op" id="3542367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3542373">make</span><span class="op" id="3542377">(</span><span class="op" id="3542378">[</span><span class="op" id="3542379">]</span><span class="builtintype" id="3542380">byte</span><span class="op" id="3542384">,</span>&nbsp;<span class="num" id="3542386">0</span><span class="op" id="3542387">,</span>&nbsp;<span class="ident" id="3542389">bufSize</span><span class="op" id="3542396">)</span><span class="op" id="3542397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542401">outUsed</span><span class="op" id="3542408">:</span>&nbsp;<span class="num" id="3542410">0</span><span class="op" id="3542411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3542418">copy</span><span class="op" id="3542422">(</span><span class="ident" id="3542423">x</span><span class="op" id="3542424">.</span><span class="ident" id="3542425">cipher</span><span class="op" id="3542431">,</span>&nbsp;<span class="ident" id="3542433">iv</span><span class="op" id="3542435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542438">return</span>&nbsp;<span class="ident" id="3542445">x</span><br>
<span class="lineno"></span><span class="op" id="3542447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3542450">func</span>&nbsp;<span class="op" id="3542455">(</span><span class="ident" id="3542456">x</span>&nbsp;<span class="op" id="3542458">*</span><span class="ident" id="3542459">ofb</span><span class="op" id="3542462">)</span>&nbsp;<span class="ident" id="3542464">refill</span><span class="op" id="3542470">(</span><span class="op" id="3542471">)</span>&nbsp;<span class="op" id="3542473">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542476">bs</span>&nbsp;<span class="op" id="3542479">:=</span>&nbsp;<span class="ident" id="3542482">x</span><span class="op" id="3542483">.</span><span class="ident" id="3542484">b</span><span class="op" id="3542485">.</span><span class="ident" id="3542486">BlockSize</span><span class="op" id="3542495">(</span><span class="op" id="3542496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542499">remain</span>&nbsp;<span class="op" id="3542506">:=</span>&nbsp;<span class="builtinfunc" id="3542509">len</span><span class="op" id="3542512">(</span><span class="ident" id="3542513">x</span><span class="op" id="3542514">.</span><span class="ident" id="3542515">out</span><span class="op" id="3542518">)</span>&nbsp;<span class="op" id="3542520">-</span>&nbsp;<span class="ident" id="3542522">x</span><span class="op" id="3542523">.</span><span class="ident" id="3542524">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542533">if</span>&nbsp;<span class="ident" id="3542536">remain</span>&nbsp;<span class="op" id="3542543">&gt;</span>&nbsp;<span class="ident" id="3542545">x</span><span class="op" id="3542546">.</span><span class="ident" id="3542547">outUsed</span>&nbsp;<span class="op" id="3542555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542559">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542567">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3542570">copy</span><span class="op" id="3542574">(</span><span class="ident" id="3542575">x</span><span class="op" id="3542576">.</span><span class="ident" id="3542577">out</span><span class="op" id="3542580">,</span>&nbsp;<span class="ident" id="3542582">x</span><span class="op" id="3542583">.</span><span class="ident" id="3542584">out</span><span class="op" id="3542587">[</span><span class="ident" id="3542588">x</span><span class="op" id="3542589">.</span><span class="ident" id="3542590">outUsed</span><span class="op" id="3542597">:</span><span class="op" id="3542598">]</span><span class="op" id="3542599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542602">x</span><span class="op" id="3542603">.</span><span class="ident" id="3542604">out</span>&nbsp;<span class="op" id="3542608">=</span>&nbsp;<span class="ident" id="3542610">x</span><span class="op" id="3542611">.</span><span class="ident" id="3542612">out</span><span class="op" id="3542615">[</span><span class="op" id="3542616">:</span><span class="builtinfunc" id="3542617">cap</span><span class="op" id="3542620">(</span><span class="ident" id="3542621">x</span><span class="op" id="3542622">.</span><span class="ident" id="3542623">out</span><span class="op" id="3542626">)</span><span class="op" id="3542627">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542630">for</span>&nbsp;<span class="ident" id="3542634">remain</span>&nbsp;<span class="op" id="3542641">&lt;</span>&nbsp;<span class="builtinfunc" id="3542643">len</span><span class="op" id="3542646">(</span><span class="ident" id="3542647">x</span><span class="op" id="3542648">.</span><span class="ident" id="3542649">out</span><span class="op" id="3542652">)</span><span class="op" id="3542653">-</span><span class="ident" id="3542654">bs</span>&nbsp;<span class="op" id="3542657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542661">x</span><span class="op" id="3542662">.</span><span class="ident" id="3542663">b</span><span class="op" id="3542664">.</span><span class="ident" id="3542665">Encrypt</span><span class="op" id="3542672">(</span><span class="ident" id="3542673">x</span><span class="op" id="3542674">.</span><span class="ident" id="3542675">cipher</span><span class="op" id="3542681">,</span>&nbsp;<span class="ident" id="3542683">x</span><span class="op" id="3542684">.</span><span class="ident" id="3542685">cipher</span><span class="op" id="3542691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3542695">copy</span><span class="op" id="3542699">(</span><span class="ident" id="3542700">x</span><span class="op" id="3542701">.</span><span class="ident" id="3542702">out</span><span class="op" id="3542705">[</span><span class="ident" id="3542706">remain</span><span class="op" id="3542712">:</span><span class="op" id="3542713">]</span><span class="op" id="3542714">,</span>&nbsp;<span class="ident" id="3542716">x</span><span class="op" id="3542717">.</span><span class="ident" id="3542718">cipher</span><span class="op" id="3542724">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542728">remain</span>&nbsp;<span class="op" id="3542735">+=</span>&nbsp;<span class="ident" id="3542738">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542745">x</span><span class="op" id="3542746">.</span><span class="ident" id="3542747">out</span>&nbsp;<span class="op" id="3542751">=</span>&nbsp;<span class="ident" id="3542753">x</span><span class="op" id="3542754">.</span><span class="ident" id="3542755">out</span><span class="op" id="3542758">[</span><span class="op" id="3542759">:</span><span class="ident" id="3542760">remain</span><span class="op" id="3542766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542769">x</span><span class="op" id="3542770">.</span><span class="ident" id="3542771">outUsed</span>&nbsp;<span class="op" id="3542779">=</span>&nbsp;<span class="num" id="3542781">0</span><br>
<span class="lineno"></span><span class="op" id="3542783">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3542786">func</span>&nbsp;<span class="op" id="3542791">(</span><span class="ident" id="3542792">x</span>&nbsp;<span class="op" id="3542794">*</span><span class="ident" id="3542795">ofb</span><span class="op" id="3542798">)</span>&nbsp;<span class="ident" id="3542800">XORKeyStream</span><span class="op" id="3542812">(</span><span class="ident" id="3542813">dst</span><span class="op" id="3542816">,</span>&nbsp;<span class="ident" id="3542818">src</span>&nbsp;<span class="op" id="3542822">[</span><span class="op" id="3542823">]</span><span class="builtintype" id="3542824">byte</span><span class="op" id="3542828">)</span>&nbsp;<span class="op" id="3542830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542833">for</span>&nbsp;<span class="builtinfunc" id="3542837">len</span><span class="op" id="3542840">(</span><span class="ident" id="3542841">src</span><span class="op" id="3542844">)</span>&nbsp;<span class="op" id="3542846">&gt;</span>&nbsp;<span class="num" id="3542848">0</span>&nbsp;<span class="op" id="3542850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542854">if</span>&nbsp;<span class="ident" id="3542857">x</span><span class="op" id="3542858">.</span><span class="ident" id="3542859">outUsed</span>&nbsp;<span class="op" id="3542867">&gt;=</span>&nbsp;<span class="builtinfunc" id="3542870">len</span><span class="op" id="3542873">(</span><span class="ident" id="3542874">x</span><span class="op" id="3542875">.</span><span class="ident" id="3542876">out</span><span class="op" id="3542879">)</span><span class="op" id="3542880">-</span><span class="ident" id="3542881">x</span><span class="op" id="3542882">.</span><span class="ident" id="3542883">b</span><span class="op" id="3542884">.</span><span class="ident" id="3542885">BlockSize</span><span class="op" id="3542894">(</span><span class="op" id="3542895">)</span>&nbsp;<span class="op" id="3542897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542902">x</span><span class="op" id="3542903">.</span><span class="ident" id="3542904">refill</span><span class="op" id="3542910">(</span><span class="op" id="3542911">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542919">n</span>&nbsp;<span class="op" id="3542921">:=</span>&nbsp;<span class="ident" id="3542924">xorBytes</span><span class="op" id="3542932">(</span><span class="ident" id="3542933">dst</span><span class="op" id="3542936">,</span>&nbsp;<span class="ident" id="3542938">src</span><span class="op" id="3542941">,</span>&nbsp;<span class="ident" id="3542943">x</span><span class="op" id="3542944">.</span><span class="ident" id="3542945">out</span><span class="op" id="3542948">[</span><span class="ident" id="3542949">x</span><span class="op" id="3542950">.</span><span class="ident" id="3542951">outUsed</span><span class="op" id="3542958">:</span><span class="op" id="3542959">]</span><span class="op" id="3542960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542964">dst</span>&nbsp;<span class="op" id="3542968">=</span>&nbsp;<span class="ident" id="3542970">dst</span><span class="op" id="3542973">[</span><span class="ident" id="3542974">n</span><span class="op" id="3542975">:</span><span class="op" id="3542976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542980">src</span>&nbsp;<span class="op" id="3542984">=</span>&nbsp;<span class="ident" id="3542986">src</span><span class="op" id="3542989">[</span><span class="ident" id="3542990">n</span><span class="op" id="3542991">:</span><span class="op" id="3542992">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542996">x</span><span class="op" id="3542997">.</span><span class="ident" id="3542998">outUsed</span>&nbsp;<span class="op" id="3543006">+=</span>&nbsp;<span class="ident" id="3543009">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3543012">}</span><br>
<span class="lineno"></span><span class="op" id="3543014">}</span>
</div>
</body>
</html>
