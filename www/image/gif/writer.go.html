<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6317531">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6317586">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6317640">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6317691">package</span>&nbsp;<span class="ident" id="6317699">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317704">import</span>&nbsp;<span class="op" id="6317711">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317714">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317723">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317739">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317749">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317758">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317773">&#34;image/color/palette&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317796">&#34;image/draw&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6317810">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6317815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317818">//&nbsp;Graphic&nbsp;control&nbsp;extension&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6317855">const</span>&nbsp;<span class="op" id="6317861">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317864">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317876">=</span>&nbsp;<span class="num" id="6317878">0xF9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317884">gcBlockSize</span>&nbsp;<span class="op" id="6317896">=</span>&nbsp;<span class="num" id="6317898">0x04</span><br>
<span class="lineno"></span><span class="op" id="6317903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317906">var</span>&nbsp;<span class="ident" id="6317910">log2Lookup</span>&nbsp;<span class="op" id="6317921">=</span>&nbsp;<span class="op" id="6317923">[</span><span class="num" id="6317924">8</span><span class="op" id="6317925">]</span><span class="builtintype" id="6317926">int</span><span class="op" id="6317929">{</span><span class="num" id="6317930">2</span><span class="op" id="6317931">,</span>&nbsp;<span class="num" id="6317933">4</span><span class="op" id="6317934">,</span>&nbsp;<span class="num" id="6317936">8</span><span class="op" id="6317937">,</span>&nbsp;<span class="num" id="6317939">16</span><span class="op" id="6317941">,</span>&nbsp;<span class="num" id="6317943">32</span><span class="op" id="6317945">,</span>&nbsp;<span class="num" id="6317947">64</span><span class="op" id="6317949">,</span>&nbsp;<span class="num" id="6317951">128</span><span class="op" id="6317954">,</span>&nbsp;<span class="num" id="6317956">256</span><span class="op" id="6317959">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6317962">func</span>&nbsp;<span class="ident" id="6317967">log2</span><span class="op" id="6317971">(</span><span class="ident" id="6317972">x</span>&nbsp;<span class="builtintype" id="6317974">int</span><span class="op" id="6317977">)</span>&nbsp;<span class="builtintype" id="6317979">int</span>&nbsp;<span class="op" id="6317983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317986">for</span>&nbsp;<span class="ident" id="6317990">i</span><span class="op" id="6317991">,</span>&nbsp;<span class="ident" id="6317993">v</span>&nbsp;<span class="op" id="6317995">:=</span>&nbsp;<span class="keyword" id="6317998">range</span>&nbsp;<span class="ident" id="6318004"><a href="/image/gif/writer.go.html#6317910">log2Lookup</a></span>&nbsp;<span class="op" id="6318015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318019">if</span>&nbsp;<span class="ident" id="6318022"><a href="/image/gif/writer.go.html#6317972">x</a></span>&nbsp;<span class="op" id="6318024">&lt;=</span>&nbsp;<span class="ident" id="6318027"><a href="/image/gif/writer.go.html#6317993">v</a></span>&nbsp;<span class="op" id="6318029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318034">return</span>&nbsp;<span class="ident" id="6318041"><a href="/image/gif/writer.go.html#6317990">i</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318051">return</span>&nbsp;<span class="op" id="6318058">-</span><span class="num" id="6318059">1</span><br>
<span class="lineno"></span><span class="op" id="6318061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6318064">//&nbsp;Little-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="6318082">func</span>&nbsp;<span class="ident" id="6318087">writeUint16</span><span class="op" id="6318098">(</span><span class="ident" id="6318099">b</span>&nbsp;<span class="op" id="6318101">[</span><span class="op" id="6318102">]</span><span class="builtintype" id="6318103">uint8</span><span class="op" id="6318108">,</span>&nbsp;<span class="ident" id="6318110">u</span>&nbsp;<span class="builtintype" id="6318112">uint16</span><span class="op" id="6318118">)</span>&nbsp;<span class="op" id="6318120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318123"><a href="/image/gif/writer.go.html#6318099">b</a></span><span class="op" id="6318124">[</span><span class="num" id="6318125">0</span><span class="op" id="6318126">]</span>&nbsp;<span class="op" id="6318128">=</span>&nbsp;<span class="builtintype" id="6318130">uint8</span><span class="op" id="6318135">(</span><span class="ident" id="6318136"><a href="/image/gif/writer.go.html#6318110">u</a></span><span class="op" id="6318137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318140"><a href="/image/gif/writer.go.html#6318099">b</a></span><span class="op" id="6318141">[</span><span class="num" id="6318142">1</span><span class="op" id="6318143">]</span>&nbsp;<span class="op" id="6318145">=</span>&nbsp;<span class="builtintype" id="6318147">uint8</span><span class="op" id="6318152">(</span><span class="ident" id="6318153"><a href="/image/gif/writer.go.html#6318110">u</a></span>&nbsp;<span class="op" id="6318155">&gt;&gt;</span>&nbsp;<span class="num" id="6318158">8</span><span class="op" id="6318159">)</span><br>
<span class="lineno"></span><span class="op" id="6318161">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="6318164">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6318196">type</span>&nbsp;<span class="ident" id="6318201">writer</span>&nbsp;<span class="keyword" id="6318208">interface</span>&nbsp;<span class="op" id="6318218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318221">Flush</span><span class="op" id="6318226">(</span><span class="op" id="6318227">)</span>&nbsp;<span class="builtintype" id="6318229">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318236"><a href="/image/gif/writer.go.html#6317810">io</a></span><span class="op" id="6318238">.</span><span class="ident" id="6318239">Writer</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318247"><a href="/image/gif/writer.go.html#6317810">io</a></span><span class="op" id="6318249">.</span><span class="ident" id="6318250">ByteWriter</span><br>
<span class="lineno"></span><span class="op" id="6318261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6318264">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6318311">type</span>&nbsp;<span class="ident" id="6318316">encoder</span>&nbsp;<span class="keyword" id="6318324">struct</span>&nbsp;<span class="op" id="6318331">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318334">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318409">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318480">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6318484"><a href="/image/gif/writer.go.html#6318201">writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318492">err</span>&nbsp;<span class="builtintype" id="6318496">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318503">//&nbsp;g&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;data&nbsp;that&nbsp;is&nbsp;being&nbsp;encoded.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318559">g</span>&nbsp;<span class="op" id="6318561">*</span><span class="ident" id="6318562"><a href="/image/gif/reader.go.html#6316534">GIF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318567">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.&nbsp;It&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;write&nbsp;the&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318651">buf</span>&nbsp;<span class="op" id="6318655">[</span><span class="num" id="6318656">1024</span><span class="op" id="6318660">]</span><span class="builtintype" id="6318661">byte</span><br>
<span class="lineno"></span><span class="op" id="6318666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6318669">//&nbsp;blockWriter&nbsp;writes&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6318736">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6318802">//&nbsp;writer&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;encoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6318866">//&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6318879">type</span>&nbsp;<span class="ident" id="6318884">blockWriter</span>&nbsp;<span class="keyword" id="6318896">struct</span>&nbsp;<span class="op" id="6318903">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318906">e</span>&nbsp;<span class="op" id="6318908">*</span><span class="ident" id="6318909"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><br>
<span class="lineno"></span><span class="op" id="6318917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6318920">func</span>&nbsp;<span class="op" id="6318925">(</span><span class="ident" id="6318926">b</span>&nbsp;<span class="ident" id="6318928"><a href="/image/gif/writer.go.html#6318884">blockWriter</a></span><span class="op" id="6318939">)</span>&nbsp;<span class="ident" id="6318941">Write</span><span class="op" id="6318946">(</span><span class="ident" id="6318947">data</span>&nbsp;<span class="op" id="6318952">[</span><span class="op" id="6318953">]</span><span class="builtintype" id="6318954">byte</span><span class="op" id="6318958">)</span>&nbsp;<span class="op" id="6318960">(</span><span class="builtintype" id="6318961">int</span><span class="op" id="6318964">,</span>&nbsp;<span class="builtintype" id="6318966">error</span><span class="op" id="6318971">)</span>&nbsp;<span class="op" id="6318973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318976">if</span>&nbsp;<span class="ident" id="6318979"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6318980">.</span><span class="ident" id="6318981">e</span><span class="op" id="6318982">.</span><span class="ident" id="6318983">err</span>&nbsp;<span class="op" id="6318987">!=</span>&nbsp;<span class="ident" id="6318990">nil</span>&nbsp;<span class="op" id="6318994">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318998">return</span>&nbsp;<span class="num" id="6319005">0</span><span class="op" id="6319006">,</span>&nbsp;<span class="ident" id="6319008"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319009">.</span><span class="ident" id="6319010">e</span><span class="op" id="6319011">.</span><span class="ident" id="6319012">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319020">if</span>&nbsp;<span class="builtinfunc" id="6319023">len</span><span class="op" id="6319026">(</span><span class="ident" id="6319027"><a href="/image/gif/writer.go.html#6318947">data</a></span><span class="op" id="6319031">)</span>&nbsp;<span class="op" id="6319033">==</span>&nbsp;<span class="num" id="6319036">0</span>&nbsp;<span class="op" id="6319038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319042">return</span>&nbsp;<span class="num" id="6319049">0</span><span class="op" id="6319050">,</span>&nbsp;<span class="ident" id="6319052">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319057">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319060">total</span>&nbsp;<span class="op" id="6319066">:=</span>&nbsp;<span class="num" id="6319069">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319072">for</span>&nbsp;<span class="ident" id="6319076"><a href="/image/gif/writer.go.html#6319060">total</a></span>&nbsp;<span class="op" id="6319082">&lt;</span>&nbsp;<span class="builtinfunc" id="6319084">len</span><span class="op" id="6319087">(</span><span class="ident" id="6319088"><a href="/image/gif/writer.go.html#6318947">data</a></span><span class="op" id="6319092">)</span>&nbsp;<span class="op" id="6319094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319098">n</span>&nbsp;<span class="op" id="6319100">:=</span>&nbsp;<span class="builtinfunc" id="6319103">copy</span><span class="op" id="6319107">(</span><span class="ident" id="6319108"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319109">.</span><span class="ident" id="6319110">e</span><span class="op" id="6319111">.</span><span class="ident" id="6319112">buf</span><span class="op" id="6319115">[</span><span class="num" id="6319116">1</span><span class="op" id="6319117">:</span><span class="num" id="6319118">256</span><span class="op" id="6319121">]</span><span class="op" id="6319122">,</span>&nbsp;<span class="ident" id="6319124"><a href="/image/gif/writer.go.html#6318947">data</a></span><span class="op" id="6319128">[</span><span class="ident" id="6319129"><a href="/image/gif/writer.go.html#6319060">total</a></span><span class="op" id="6319134">:</span><span class="op" id="6319135">]</span><span class="op" id="6319136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319140"><a href="/image/gif/writer.go.html#6319060">total</a></span>&nbsp;<span class="op" id="6319146">+=</span>&nbsp;<span class="ident" id="6319149"><a href="/image/gif/writer.go.html#6319098">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319153"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319154">.</span><span class="ident" id="6319155">e</span><span class="op" id="6319156">.</span><span class="ident" id="6319157">buf</span><span class="op" id="6319160">[</span><span class="num" id="6319161">0</span><span class="op" id="6319162">]</span>&nbsp;<span class="op" id="6319164">=</span>&nbsp;<span class="builtintype" id="6319166">uint8</span><span class="op" id="6319171">(</span><span class="ident" id="6319172"><a href="/image/gif/writer.go.html#6319098">n</a></span><span class="op" id="6319173">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319178"><a href="/image/gif/writer.go.html#6319098">n</a></span><span class="op" id="6319179">,</span>&nbsp;<span class="ident" id="6319181"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319182">.</span><span class="ident" id="6319183">e</span><span class="op" id="6319184">.</span><span class="ident" id="6319185">err</span>&nbsp;<span class="op" id="6319189">=</span>&nbsp;<span class="ident" id="6319191"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319192">.</span><span class="ident" id="6319193">e</span><span class="op" id="6319194">.</span><span class="ident" id="6319195">w</span><span class="op" id="6319196">.</span><span class="ident" id="6319197">Write</span><span class="op" id="6319202">(</span><span class="ident" id="6319203"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319204">.</span><span class="ident" id="6319205">e</span><span class="op" id="6319206">.</span><span class="ident" id="6319207">buf</span><span class="op" id="6319210">[</span><span class="op" id="6319211">:</span><span class="ident" id="6319212"><a href="/image/gif/writer.go.html#6319098">n</a></span><span class="op" id="6319213">+</span><span class="num" id="6319214">1</span><span class="op" id="6319215">]</span><span class="op" id="6319216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319220">if</span>&nbsp;<span class="ident" id="6319223"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319224">.</span><span class="ident" id="6319225">e</span><span class="op" id="6319226">.</span><span class="ident" id="6319227">err</span>&nbsp;<span class="op" id="6319231">!=</span>&nbsp;<span class="ident" id="6319234">nil</span>&nbsp;<span class="op" id="6319238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319243">return</span>&nbsp;<span class="num" id="6319250">0</span><span class="op" id="6319251">,</span>&nbsp;<span class="ident" id="6319253"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319254">.</span><span class="ident" id="6319255">e</span><span class="op" id="6319256">.</span><span class="ident" id="6319257">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319263">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319269">return</span>&nbsp;<span class="ident" id="6319276"><a href="/image/gif/writer.go.html#6319060">total</a></span><span class="op" id="6319281">,</span>&nbsp;<span class="ident" id="6319283"><a href="/image/gif/writer.go.html#6318926">b</a></span><span class="op" id="6319284">.</span><span class="ident" id="6319285">e</span><span class="op" id="6319286">.</span><span class="ident" id="6319287">err</span><br>
<span class="lineno"></span><span class="op" id="6319291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6319294">func</span>&nbsp;<span class="op" id="6319299">(</span><span class="ident" id="6319300">e</span>&nbsp;<span class="op" id="6319302">*</span><span class="ident" id="6319303"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><span class="op" id="6319310">)</span>&nbsp;<span class="ident" id="6319312">flush</span><span class="op" id="6319317">(</span><span class="op" id="6319318">)</span>&nbsp;<span class="op" id="6319320">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319323">if</span>&nbsp;<span class="ident" id="6319326"><a href="/image/gif/writer.go.html#6319300">e</a></span><span class="op" id="6319327">.</span><span class="ident" id="6319328">err</span>&nbsp;<span class="op" id="6319332">!=</span>&nbsp;<span class="ident" id="6319335">nil</span>&nbsp;<span class="op" id="6319339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319343">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319354"><a href="/image/gif/writer.go.html#6319300">e</a></span><span class="op" id="6319355">.</span><span class="ident" id="6319356">err</span>&nbsp;<span class="op" id="6319360">=</span>&nbsp;<span class="ident" id="6319362"><a href="/image/gif/writer.go.html#6319300">e</a></span><span class="op" id="6319363">.</span><span class="ident" id="6319364">w</span><span class="op" id="6319365">.</span><span class="ident" id="6319366">Flush</span><span class="op" id="6319371">(</span><span class="op" id="6319372">)</span><br>
<span class="lineno"></span><span class="op" id="6319374">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="6319377">func</span>&nbsp;<span class="op" id="6319382">(</span><span class="ident" id="6319383">e</span>&nbsp;<span class="op" id="6319385">*</span><span class="ident" id="6319386"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><span class="op" id="6319393">)</span>&nbsp;<span class="ident" id="6319395">write</span><span class="op" id="6319400">(</span><span class="ident" id="6319401">p</span>&nbsp;<span class="op" id="6319403">[</span><span class="op" id="6319404">]</span><span class="builtintype" id="6319405">byte</span><span class="op" id="6319409">)</span>&nbsp;<span class="op" id="6319411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319414">if</span>&nbsp;<span class="ident" id="6319417"><a href="/image/gif/writer.go.html#6319383">e</a></span><span class="op" id="6319418">.</span><span class="ident" id="6319419">err</span>&nbsp;<span class="op" id="6319423">!=</span>&nbsp;<span class="ident" id="6319426">nil</span>&nbsp;<span class="op" id="6319430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319434">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319442">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319445">_</span><span class="op" id="6319446">,</span>&nbsp;<span class="ident" id="6319448"><a href="/image/gif/writer.go.html#6319383">e</a></span><span class="op" id="6319449">.</span><span class="ident" id="6319450">err</span>&nbsp;<span class="op" id="6319454">=</span>&nbsp;<span class="ident" id="6319456"><a href="/image/gif/writer.go.html#6319383">e</a></span><span class="op" id="6319457">.</span><span class="ident" id="6319458">w</span><span class="op" id="6319459">.</span><span class="ident" id="6319460">Write</span><span class="op" id="6319465">(</span><span class="ident" id="6319466"><a href="/image/gif/writer.go.html#6319401">p</a></span><span class="op" id="6319467">)</span><br>
<span class="lineno"></span><span class="op" id="6319469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6319472">func</span>&nbsp;<span class="op" id="6319477">(</span><span class="ident" id="6319478">e</span>&nbsp;<span class="op" id="6319480">*</span><span class="ident" id="6319481"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><span class="op" id="6319488">)</span>&nbsp;<span class="ident" id="6319490">writeByte</span><span class="op" id="6319499">(</span><span class="ident" id="6319500">b</span>&nbsp;<span class="builtintype" id="6319502">byte</span><span class="op" id="6319506">)</span>&nbsp;<span class="op" id="6319508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319511">if</span>&nbsp;<span class="ident" id="6319514"><a href="/image/gif/writer.go.html#6319478">e</a></span><span class="op" id="6319515">.</span><span class="ident" id="6319516">err</span>&nbsp;<span class="op" id="6319520">!=</span>&nbsp;<span class="ident" id="6319523">nil</span>&nbsp;<span class="op" id="6319527">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319531">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319542"><a href="/image/gif/writer.go.html#6319478">e</a></span><span class="op" id="6319543">.</span><span class="ident" id="6319544">err</span>&nbsp;<span class="op" id="6319548">=</span>&nbsp;<span class="ident" id="6319550"><a href="/image/gif/writer.go.html#6319478">e</a></span><span class="op" id="6319551">.</span><span class="ident" id="6319552">w</span><span class="op" id="6319553">.</span><span class="ident" id="6319554">WriteByte</span><span class="op" id="6319563">(</span><span class="ident" id="6319564"><a href="/image/gif/writer.go.html#6319500">b</a></span><span class="op" id="6319565">)</span><br>
<span class="lineno"></span><span class="op" id="6319567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6319570">func</span>&nbsp;<span class="op" id="6319575">(</span><span class="ident" id="6319576">e</span>&nbsp;<span class="op" id="6319578">*</span><span class="ident" id="6319579"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><span class="op" id="6319586">)</span>&nbsp;<span class="ident" id="6319588">writeHeader</span><span class="op" id="6319599">(</span><span class="op" id="6319600">)</span>&nbsp;<span class="op" id="6319602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319605">if</span>&nbsp;<span class="ident" id="6319608"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319609">.</span><span class="ident" id="6319610">err</span>&nbsp;<span class="op" id="6319614">!=</span>&nbsp;<span class="ident" id="6319617">nil</span>&nbsp;<span class="op" id="6319621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319625">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319636">_</span><span class="op" id="6319637">,</span>&nbsp;<span class="ident" id="6319639"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319640">.</span><span class="ident" id="6319641">err</span>&nbsp;<span class="op" id="6319645">=</span>&nbsp;<span class="ident" id="6319647"><a href="/image/gif/writer.go.html#6317810">io</a></span><span class="op" id="6319649">.</span><span class="ident" id="6319650">WriteString</span><span class="op" id="6319661">(</span><span class="ident" id="6319662"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319663">.</span><span class="ident" id="6319664">w</span><span class="op" id="6319665">,</span>&nbsp;<span class="string" id="6319667">&#34;GIF89a&#34;</span><span class="op" id="6319675">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319678">if</span>&nbsp;<span class="ident" id="6319681"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319682">.</span><span class="ident" id="6319683">err</span>&nbsp;<span class="op" id="6319687">!=</span>&nbsp;<span class="ident" id="6319690">nil</span>&nbsp;<span class="op" id="6319694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319698">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319710">pm</span>&nbsp;<span class="op" id="6319713">:=</span>&nbsp;<span class="ident" id="6319716"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319717">.</span><span class="ident" id="6319718">g</span><span class="op" id="6319719">.</span><span class="ident" id="6319720">Image</span><span class="op" id="6319725">[</span><span class="num" id="6319726">0</span><span class="op" id="6319727">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319730">//&nbsp;Logical&nbsp;screen&nbsp;width&nbsp;and&nbsp;height.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319767"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6319778">(</span><span class="ident" id="6319779"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319780">.</span><span class="ident" id="6319781">buf</span><span class="op" id="6319784">[</span><span class="num" id="6319785">0</span><span class="op" id="6319786">:</span><span class="num" id="6319787">2</span><span class="op" id="6319788">]</span><span class="op" id="6319789">,</span>&nbsp;<span class="builtintype" id="6319791">uint16</span><span class="op" id="6319797">(</span><span class="ident" id="6319798"><a href="/image/gif/writer.go.html#6319710">pm</a></span><span class="op" id="6319800">.</span><span class="ident" id="6319801">Bounds</span><span class="op" id="6319807">(</span><span class="op" id="6319808">)</span><span class="op" id="6319809">.</span><span class="ident" id="6319810">Dx</span><span class="op" id="6319812">(</span><span class="op" id="6319813">)</span><span class="op" id="6319814">)</span><span class="op" id="6319815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319818"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6319829">(</span><span class="ident" id="6319830"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319831">.</span><span class="ident" id="6319832">buf</span><span class="op" id="6319835">[</span><span class="num" id="6319836">2</span><span class="op" id="6319837">:</span><span class="num" id="6319838">4</span><span class="op" id="6319839">]</span><span class="op" id="6319840">,</span>&nbsp;<span class="builtintype" id="6319842">uint16</span><span class="op" id="6319848">(</span><span class="ident" id="6319849"><a href="/image/gif/writer.go.html#6319710">pm</a></span><span class="op" id="6319851">.</span><span class="ident" id="6319852">Bounds</span><span class="op" id="6319858">(</span><span class="op" id="6319859">)</span><span class="op" id="6319860">.</span><span class="ident" id="6319861">Dy</span><span class="op" id="6319863">(</span><span class="op" id="6319864">)</span><span class="op" id="6319865">)</span><span class="op" id="6319866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319869"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319870">.</span><span class="ident" id="6319871">write</span><span class="op" id="6319876">(</span><span class="ident" id="6319877"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319878">.</span><span class="ident" id="6319879">buf</span><span class="op" id="6319882">[</span><span class="op" id="6319883">:</span><span class="num" id="6319884">4</span><span class="op" id="6319885">]</span><span class="op" id="6319886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319890">//&nbsp;All&nbsp;frames&nbsp;have&nbsp;a&nbsp;local&nbsp;color&nbsp;table,&nbsp;so&nbsp;a&nbsp;global&nbsp;color&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319955">//&nbsp;is&nbsp;not&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319974"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319975">.</span><span class="ident" id="6319976">buf</span><span class="op" id="6319979">[</span><span class="num" id="6319980">0</span><span class="op" id="6319981">]</span>&nbsp;<span class="op" id="6319983">=</span>&nbsp;<span class="num" id="6319985">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319991"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6319992">.</span><span class="ident" id="6319993">buf</span><span class="op" id="6319996">[</span><span class="num" id="6319997">1</span><span class="op" id="6319998">]</span>&nbsp;<span class="op" id="6320000">=</span>&nbsp;<span class="num" id="6320002">0x00</span>&nbsp;<span class="comment" id="6320007">//&nbsp;Background&nbsp;Color&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320035"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320036">.</span><span class="ident" id="6320037">buf</span><span class="op" id="6320040">[</span><span class="num" id="6320041">2</span><span class="op" id="6320042">]</span>&nbsp;<span class="op" id="6320044">=</span>&nbsp;<span class="num" id="6320046">0x00</span>&nbsp;<span class="comment" id="6320051">//&nbsp;Pixel&nbsp;Aspect&nbsp;Ratio.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320075"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320076">.</span><span class="ident" id="6320077">write</span><span class="op" id="6320082">(</span><span class="ident" id="6320083"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320084">.</span><span class="ident" id="6320085">buf</span><span class="op" id="6320088">[</span><span class="op" id="6320089">:</span><span class="num" id="6320090">3</span><span class="op" id="6320091">]</span><span class="op" id="6320092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6320096">//&nbsp;Add&nbsp;animation&nbsp;info&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320133">if</span>&nbsp;<span class="builtinfunc" id="6320136">len</span><span class="op" id="6320139">(</span><span class="ident" id="6320140"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320141">.</span><span class="ident" id="6320142">g</span><span class="op" id="6320143">.</span><span class="ident" id="6320144">Image</span><span class="op" id="6320149">)</span>&nbsp;<span class="op" id="6320151">&gt;</span>&nbsp;<span class="num" id="6320153">1</span>&nbsp;<span class="op" id="6320155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320159"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320160">.</span><span class="ident" id="6320161">buf</span><span class="op" id="6320164">[</span><span class="num" id="6320165">0</span><span class="op" id="6320166">]</span>&nbsp;<span class="op" id="6320168">=</span>&nbsp;<span class="num" id="6320170">0x21</span>&nbsp;<span class="comment" id="6320175">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320202"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320203">.</span><span class="ident" id="6320204">buf</span><span class="op" id="6320207">[</span><span class="num" id="6320208">1</span><span class="op" id="6320209">]</span>&nbsp;<span class="op" id="6320211">=</span>&nbsp;<span class="num" id="6320213">0xff</span>&nbsp;<span class="comment" id="6320218">//&nbsp;Application&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320242"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320243">.</span><span class="ident" id="6320244">buf</span><span class="op" id="6320247">[</span><span class="num" id="6320248">2</span><span class="op" id="6320249">]</span>&nbsp;<span class="op" id="6320251">=</span>&nbsp;<span class="num" id="6320253">0x0b</span>&nbsp;<span class="comment" id="6320258">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320275"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320276">.</span><span class="ident" id="6320277">write</span><span class="op" id="6320282">(</span><span class="ident" id="6320283"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320284">.</span><span class="ident" id="6320285">buf</span><span class="op" id="6320288">[</span><span class="op" id="6320289">:</span><span class="num" id="6320290">3</span><span class="op" id="6320291">]</span><span class="op" id="6320292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320296">_</span><span class="op" id="6320297">,</span>&nbsp;<span class="ident" id="6320299"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320300">.</span><span class="ident" id="6320301">err</span>&nbsp;<span class="op" id="6320305">=</span>&nbsp;<span class="ident" id="6320307"><a href="/image/gif/writer.go.html#6317810">io</a></span><span class="op" id="6320309">.</span><span class="ident" id="6320310">WriteString</span><span class="op" id="6320321">(</span><span class="ident" id="6320322"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320323">.</span><span class="ident" id="6320324">w</span><span class="op" id="6320325">,</span>&nbsp;<span class="string" id="6320327">&#34;NETSCAPE2.0&#34;</span><span class="op" id="6320340">)</span>&nbsp;<span class="comment" id="6320342">//&nbsp;Application&nbsp;Identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320371">if</span>&nbsp;<span class="ident" id="6320374"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320375">.</span><span class="ident" id="6320376">err</span>&nbsp;<span class="op" id="6320380">!=</span>&nbsp;<span class="ident" id="6320383">nil</span>&nbsp;<span class="op" id="6320387">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320392">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320405"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320406">.</span><span class="ident" id="6320407">buf</span><span class="op" id="6320410">[</span><span class="num" id="6320411">0</span><span class="op" id="6320412">]</span>&nbsp;<span class="op" id="6320414">=</span>&nbsp;<span class="num" id="6320416">0x03</span>&nbsp;<span class="comment" id="6320421">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320438"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320439">.</span><span class="ident" id="6320440">buf</span><span class="op" id="6320443">[</span><span class="num" id="6320444">1</span><span class="op" id="6320445">]</span>&nbsp;<span class="op" id="6320447">=</span>&nbsp;<span class="num" id="6320449">0x01</span>&nbsp;<span class="comment" id="6320454">//&nbsp;Sub-block&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320476"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6320487">(</span><span class="ident" id="6320488"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320489">.</span><span class="ident" id="6320490">buf</span><span class="op" id="6320493">[</span><span class="num" id="6320494">2</span><span class="op" id="6320495">:</span><span class="num" id="6320496">4</span><span class="op" id="6320497">]</span><span class="op" id="6320498">,</span>&nbsp;<span class="builtintype" id="6320500">uint16</span><span class="op" id="6320506">(</span><span class="ident" id="6320507"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320508">.</span><span class="ident" id="6320509">g</span><span class="op" id="6320510">.</span><span class="ident" id="6320511">LoopCount</span><span class="op" id="6320520">)</span><span class="op" id="6320521">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320525"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320526">.</span><span class="ident" id="6320527">buf</span><span class="op" id="6320530">[</span><span class="num" id="6320531">4</span><span class="op" id="6320532">]</span>&nbsp;<span class="op" id="6320534">=</span>&nbsp;<span class="num" id="6320536">0x00</span>&nbsp;<span class="comment" id="6320541">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320564"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320565">.</span><span class="ident" id="6320566">write</span><span class="op" id="6320571">(</span><span class="ident" id="6320572"><a href="/image/gif/writer.go.html#6319576">e</a></span><span class="op" id="6320573">.</span><span class="ident" id="6320574">buf</span><span class="op" id="6320577">[</span><span class="op" id="6320578">:</span><span class="num" id="6320579">5</span><span class="op" id="6320580">]</span><span class="op" id="6320581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320584">}</span><br>
<span class="lineno"></span><span class="op" id="6320586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="6320589">func</span>&nbsp;<span class="op" id="6320594">(</span><span class="ident" id="6320595">e</span>&nbsp;<span class="op" id="6320597">*</span><span class="ident" id="6320598"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><span class="op" id="6320605">)</span>&nbsp;<span class="ident" id="6320607">writeColorTable</span><span class="op" id="6320622">(</span><span class="ident" id="6320623">p</span>&nbsp;<span class="ident" id="6320625"><a href="/image/gif/writer.go.html#6317758">color</a></span><span class="op" id="6320630">.</span><span class="ident" id="6320631">Palette</span><span class="op" id="6320638">,</span>&nbsp;<span class="ident" id="6320640">size</span>&nbsp;<span class="builtintype" id="6320645">int</span><span class="op" id="6320648">)</span>&nbsp;<span class="op" id="6320650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320653">if</span>&nbsp;<span class="ident" id="6320656"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320657">.</span><span class="ident" id="6320658">err</span>&nbsp;<span class="op" id="6320662">!=</span>&nbsp;<span class="ident" id="6320665">nil</span>&nbsp;<span class="op" id="6320669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320673">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320685">for</span>&nbsp;<span class="ident" id="6320689">i</span>&nbsp;<span class="op" id="6320691">:=</span>&nbsp;<span class="num" id="6320694">0</span><span class="op" id="6320695">;</span>&nbsp;<span class="ident" id="6320697"><a href="/image/gif/writer.go.html#6320689">i</a></span>&nbsp;<span class="op" id="6320699">&lt;</span>&nbsp;<span class="ident" id="6320701"><a href="/image/gif/writer.go.html#6317910">log2Lookup</a></span><span class="op" id="6320711">[</span><span class="ident" id="6320712"><a href="/image/gif/writer.go.html#6320640">size</a></span><span class="op" id="6320716">]</span><span class="op" id="6320717">;</span>&nbsp;<span class="ident" id="6320719"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320720">++</span>&nbsp;<span class="op" id="6320723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320727">if</span>&nbsp;<span class="ident" id="6320730"><a href="/image/gif/writer.go.html#6320689">i</a></span>&nbsp;<span class="op" id="6320732">&lt;</span>&nbsp;<span class="builtinfunc" id="6320734">len</span><span class="op" id="6320737">(</span><span class="ident" id="6320738"><a href="/image/gif/writer.go.html#6320623">p</a></span><span class="op" id="6320739">)</span>&nbsp;<span class="op" id="6320741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320746">r</span><span class="op" id="6320747">,</span>&nbsp;<span class="ident" id="6320749">g</span><span class="op" id="6320750">,</span>&nbsp;<span class="ident" id="6320752">b</span><span class="op" id="6320753">,</span>&nbsp;<span class="ident" id="6320755">_</span>&nbsp;<span class="op" id="6320757">:=</span>&nbsp;<span class="ident" id="6320760"><a href="/image/gif/writer.go.html#6320623">p</a></span><span class="op" id="6320761">[</span><span class="ident" id="6320762"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320763">]</span><span class="op" id="6320764">.</span><span class="ident" id="6320765">RGBA</span><span class="op" id="6320769">(</span><span class="op" id="6320770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320775"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320776">.</span><span class="ident" id="6320777">buf</span><span class="op" id="6320780">[</span><span class="num" id="6320781">3</span><span class="op" id="6320782">*</span><span class="ident" id="6320783"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320784">+</span><span class="num" id="6320785">0</span><span class="op" id="6320786">]</span>&nbsp;<span class="op" id="6320788">=</span>&nbsp;<span class="builtintype" id="6320790">uint8</span><span class="op" id="6320795">(</span><span class="ident" id="6320796"><a href="/image/gif/writer.go.html#6320746">r</a></span>&nbsp;<span class="op" id="6320798">&gt;&gt;</span>&nbsp;<span class="num" id="6320801">8</span><span class="op" id="6320802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320807"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320808">.</span><span class="ident" id="6320809">buf</span><span class="op" id="6320812">[</span><span class="num" id="6320813">3</span><span class="op" id="6320814">*</span><span class="ident" id="6320815"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320816">+</span><span class="num" id="6320817">1</span><span class="op" id="6320818">]</span>&nbsp;<span class="op" id="6320820">=</span>&nbsp;<span class="builtintype" id="6320822">uint8</span><span class="op" id="6320827">(</span><span class="ident" id="6320828"><a href="/image/gif/writer.go.html#6320749">g</a></span>&nbsp;<span class="op" id="6320830">&gt;&gt;</span>&nbsp;<span class="num" id="6320833">8</span><span class="op" id="6320834">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320839"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320840">.</span><span class="ident" id="6320841">buf</span><span class="op" id="6320844">[</span><span class="num" id="6320845">3</span><span class="op" id="6320846">*</span><span class="ident" id="6320847"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320848">+</span><span class="num" id="6320849">2</span><span class="op" id="6320850">]</span>&nbsp;<span class="op" id="6320852">=</span>&nbsp;<span class="builtintype" id="6320854">uint8</span><span class="op" id="6320859">(</span><span class="ident" id="6320860"><a href="/image/gif/writer.go.html#6320752">b</a></span>&nbsp;<span class="op" id="6320862">&gt;&gt;</span>&nbsp;<span class="num" id="6320865">8</span><span class="op" id="6320866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320870">}</span>&nbsp;<span class="keyword" id="6320872">else</span>&nbsp;<span class="op" id="6320877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6320882">//&nbsp;Pad&nbsp;with&nbsp;black.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320904"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320905">.</span><span class="ident" id="6320906">buf</span><span class="op" id="6320909">[</span><span class="num" id="6320910">3</span><span class="op" id="6320911">*</span><span class="ident" id="6320912"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320913">+</span><span class="num" id="6320914">0</span><span class="op" id="6320915">]</span>&nbsp;<span class="op" id="6320917">=</span>&nbsp;<span class="num" id="6320919">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320927"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320928">.</span><span class="ident" id="6320929">buf</span><span class="op" id="6320932">[</span><span class="num" id="6320933">3</span><span class="op" id="6320934">*</span><span class="ident" id="6320935"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320936">+</span><span class="num" id="6320937">1</span><span class="op" id="6320938">]</span>&nbsp;<span class="op" id="6320940">=</span>&nbsp;<span class="num" id="6320942">0x00</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320950"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320951">.</span><span class="ident" id="6320952">buf</span><span class="op" id="6320955">[</span><span class="num" id="6320956">3</span><span class="op" id="6320957">*</span><span class="ident" id="6320958"><a href="/image/gif/writer.go.html#6320689">i</a></span><span class="op" id="6320959">+</span><span class="num" id="6320960">2</span><span class="op" id="6320961">]</span>&nbsp;<span class="op" id="6320963">=</span>&nbsp;<span class="num" id="6320965">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320978"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320979">.</span><span class="ident" id="6320980">write</span><span class="op" id="6320985">(</span><span class="ident" id="6320986"><a href="/image/gif/writer.go.html#6320595">e</a></span><span class="op" id="6320987">.</span><span class="ident" id="6320988">buf</span><span class="op" id="6320991">[</span><span class="op" id="6320992">:</span><span class="num" id="6320993">3</span><span class="op" id="6320994">*</span><span class="ident" id="6320995"><a href="/image/gif/writer.go.html#6317910">log2Lookup</a></span><span class="op" id="6321005">[</span><span class="ident" id="6321006"><a href="/image/gif/writer.go.html#6320640">size</a></span><span class="op" id="6321010">]</span><span class="op" id="6321011">]</span><span class="op" id="6321012">)</span><br>
<span class="lineno"></span><span class="op" id="6321014">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6321017">func</span>&nbsp;<span class="op" id="6321022">(</span><span class="ident" id="6321023">e</span>&nbsp;<span class="op" id="6321025">*</span><span class="ident" id="6321026"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><span class="op" id="6321033">)</span>&nbsp;<span class="ident" id="6321035">writeImageBlock</span><span class="op" id="6321050">(</span><span class="ident" id="6321051">pm</span>&nbsp;<span class="op" id="6321054">*</span><span class="ident" id="6321055"><a href="/image/gif/writer.go.html#6317749">image</a></span><span class="op" id="6321060">.</span><span class="ident" id="6321061">Paletted</span><span class="op" id="6321069">,</span>&nbsp;<span class="ident" id="6321071">delay</span>&nbsp;<span class="builtintype" id="6321077">int</span><span class="op" id="6321080">)</span>&nbsp;<span class="op" id="6321082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321085">if</span>&nbsp;<span class="ident" id="6321088"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321089">.</span><span class="ident" id="6321090">err</span>&nbsp;<span class="op" id="6321094">!=</span>&nbsp;<span class="ident" id="6321097">nil</span>&nbsp;<span class="op" id="6321101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321105">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321113">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321117">if</span>&nbsp;<span class="builtinfunc" id="6321120">len</span><span class="op" id="6321123">(</span><span class="ident" id="6321124"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6321126">.</span><span class="ident" id="6321127">Palette</span><span class="op" id="6321134">)</span>&nbsp;<span class="op" id="6321136">==</span>&nbsp;<span class="num" id="6321139">0</span>&nbsp;<span class="op" id="6321141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321145"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321146">.</span><span class="ident" id="6321147">err</span>&nbsp;<span class="op" id="6321151">=</span>&nbsp;<span class="ident" id="6321153"><a href="/image/gif/writer.go.html#6317739">errors</a></span><span class="op" id="6321159">.</span><span class="ident" id="6321160">New</span><span class="op" id="6321163">(</span><span class="string" id="6321164">&#34;gif:&nbsp;cannot&nbsp;encode&nbsp;image&nbsp;block&nbsp;with&nbsp;empty&nbsp;palette&#34;</span><span class="op" id="6321215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321219">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321227">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321231">b</span>&nbsp;<span class="op" id="6321233">:=</span>&nbsp;<span class="ident" id="6321236"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6321238">.</span><span class="ident" id="6321239">Bounds</span><span class="op" id="6321245">(</span><span class="op" id="6321246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321249">if</span>&nbsp;<span class="ident" id="6321252"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6321253">.</span><span class="ident" id="6321254">Dx</span><span class="op" id="6321256">(</span><span class="op" id="6321257">)</span>&nbsp;<span class="op" id="6321259">&gt;=</span>&nbsp;<span class="num" id="6321262">1</span><span class="op" id="6321263">&lt;&lt;</span><span class="num" id="6321265">16</span>&nbsp;<span class="op" id="6321268">||</span>&nbsp;<span class="ident" id="6321271"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6321272">.</span><span class="ident" id="6321273">Dy</span><span class="op" id="6321275">(</span><span class="op" id="6321276">)</span>&nbsp;<span class="op" id="6321278">&gt;=</span>&nbsp;<span class="num" id="6321281">1</span><span class="op" id="6321282">&lt;&lt;</span><span class="num" id="6321284">16</span>&nbsp;<span class="op" id="6321287">||</span>&nbsp;<span class="ident" id="6321290"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6321291">.</span><span class="ident" id="6321292">Min</span><span class="op" id="6321295">.</span><span class="ident" id="6321296">X</span>&nbsp;<span class="op" id="6321298">&lt;</span>&nbsp;<span class="num" id="6321300">0</span>&nbsp;<span class="op" id="6321302">||</span>&nbsp;<span class="ident" id="6321305"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6321306">.</span><span class="ident" id="6321307">Min</span><span class="op" id="6321310">.</span><span class="ident" id="6321311">X</span>&nbsp;<span class="op" id="6321313">&gt;=</span>&nbsp;<span class="num" id="6321316">1</span><span class="op" id="6321317">&lt;&lt;</span><span class="num" id="6321319">16</span>&nbsp;<span class="op" id="6321322">||</span>&nbsp;<span class="ident" id="6321325"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6321326">.</span><span class="ident" id="6321327">Min</span><span class="op" id="6321330">.</span><span class="ident" id="6321331">Y</span>&nbsp;<span class="op" id="6321333">&lt;</span>&nbsp;<span class="num" id="6321335">0</span>&nbsp;<span class="op" id="6321337">||</span>&nbsp;<span class="ident" id="6321340"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6321341">.</span><span class="ident" id="6321342">Min</span><span class="op" id="6321345">.</span><span class="ident" id="6321346">Y</span>&nbsp;<span class="op" id="6321348">&gt;=</span>&nbsp;<span class="num" id="6321351">1</span><span class="op" id="6321352">&lt;&lt;</span><span class="num" id="6321354">16</span>&nbsp;<span class="op" id="6321357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321361"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321362">.</span><span class="ident" id="6321363">err</span>&nbsp;<span class="op" id="6321367">=</span>&nbsp;<span class="ident" id="6321369"><a href="/image/gif/writer.go.html#6317739">errors</a></span><span class="op" id="6321375">.</span><span class="ident" id="6321376">New</span><span class="op" id="6321379">(</span><span class="string" id="6321380">&#34;gif:&nbsp;image&nbsp;block&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6321421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321425">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321437">transparentIndex</span>&nbsp;<span class="op" id="6321454">:=</span>&nbsp;<span class="op" id="6321457">-</span><span class="num" id="6321458">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321461">for</span>&nbsp;<span class="ident" id="6321465">i</span><span class="op" id="6321466">,</span>&nbsp;<span class="ident" id="6321468">c</span>&nbsp;<span class="op" id="6321470">:=</span>&nbsp;<span class="keyword" id="6321473">range</span>&nbsp;<span class="ident" id="6321479"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6321481">.</span><span class="ident" id="6321482">Palette</span>&nbsp;<span class="op" id="6321490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321494">if</span>&nbsp;<span class="ident" id="6321497">_</span><span class="op" id="6321498">,</span>&nbsp;<span class="ident" id="6321500">_</span><span class="op" id="6321501">,</span>&nbsp;<span class="ident" id="6321503">_</span><span class="op" id="6321504">,</span>&nbsp;<span class="ident" id="6321506">a</span>&nbsp;<span class="op" id="6321508">:=</span>&nbsp;<span class="ident" id="6321511"><a href="/image/gif/writer.go.html#6321468">c</a></span><span class="op" id="6321512">.</span><span class="ident" id="6321513">RGBA</span><span class="op" id="6321517">(</span><span class="op" id="6321518">)</span><span class="op" id="6321519">;</span>&nbsp;<span class="ident" id="6321521"><a href="/image/gif/writer.go.html#6321506">a</a></span>&nbsp;<span class="op" id="6321523">==</span>&nbsp;<span class="num" id="6321526">0</span>&nbsp;<span class="op" id="6321528">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321533"><a href="/image/gif/writer.go.html#6321437">transparentIndex</a></span>&nbsp;<span class="op" id="6321550">=</span>&nbsp;<span class="ident" id="6321552"><a href="/image/gif/writer.go.html#6321465">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321557">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321572">if</span>&nbsp;<span class="ident" id="6321575"><a href="/image/gif/writer.go.html#6321071">delay</a></span>&nbsp;<span class="op" id="6321581">&gt;</span>&nbsp;<span class="num" id="6321583">0</span>&nbsp;<span class="op" id="6321585">||</span>&nbsp;<span class="ident" id="6321588"><a href="/image/gif/writer.go.html#6321437">transparentIndex</a></span>&nbsp;<span class="op" id="6321605">!=</span>&nbsp;<span class="op" id="6321608">-</span><span class="num" id="6321609">1</span>&nbsp;<span class="op" id="6321611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321615"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321616">.</span><span class="ident" id="6321617">buf</span><span class="op" id="6321620">[</span><span class="num" id="6321621">0</span><span class="op" id="6321622">]</span>&nbsp;<span class="op" id="6321624">=</span>&nbsp;<span class="ident" id="6321626"><a href="/image/gif/reader.go.html#6306898">sExtension</a></span>&nbsp;&nbsp;<span class="comment" id="6321638">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321665"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321666">.</span><span class="ident" id="6321667">buf</span><span class="op" id="6321670">[</span><span class="num" id="6321671">1</span><span class="op" id="6321672">]</span>&nbsp;<span class="op" id="6321674">=</span>&nbsp;<span class="ident" id="6321676"><a href="/image/gif/writer.go.html#6317864">gcLabel</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6321688">//&nbsp;Graphic&nbsp;Control&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321716"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321717">.</span><span class="ident" id="6321718">buf</span><span class="op" id="6321721">[</span><span class="num" id="6321722">2</span><span class="op" id="6321723">]</span>&nbsp;<span class="op" id="6321725">=</span>&nbsp;<span class="ident" id="6321727"><a href="/image/gif/writer.go.html#6317884">gcBlockSize</a></span>&nbsp;<span class="comment" id="6321739">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321756">if</span>&nbsp;<span class="ident" id="6321759"><a href="/image/gif/writer.go.html#6321437">transparentIndex</a></span>&nbsp;<span class="op" id="6321776">!=</span>&nbsp;<span class="op" id="6321779">-</span><span class="num" id="6321780">1</span>&nbsp;<span class="op" id="6321782">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321787"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321788">.</span><span class="ident" id="6321789">buf</span><span class="op" id="6321792">[</span><span class="num" id="6321793">3</span><span class="op" id="6321794">]</span>&nbsp;<span class="op" id="6321796">=</span>&nbsp;<span class="num" id="6321798">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321805">}</span>&nbsp;<span class="keyword" id="6321807">else</span>&nbsp;<span class="op" id="6321812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321817"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321818">.</span><span class="ident" id="6321819">buf</span><span class="op" id="6321822">[</span><span class="num" id="6321823">3</span><span class="op" id="6321824">]</span>&nbsp;<span class="op" id="6321826">=</span>&nbsp;<span class="num" id="6321828">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321839"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6321850">(</span><span class="ident" id="6321851"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321852">.</span><span class="ident" id="6321853">buf</span><span class="op" id="6321856">[</span><span class="num" id="6321857">4</span><span class="op" id="6321858">:</span><span class="num" id="6321859">6</span><span class="op" id="6321860">]</span><span class="op" id="6321861">,</span>&nbsp;<span class="builtintype" id="6321863">uint16</span><span class="op" id="6321869">(</span><span class="ident" id="6321870"><a href="/image/gif/writer.go.html#6321071">delay</a></span><span class="op" id="6321875">)</span><span class="op" id="6321876">)</span>&nbsp;<span class="comment" id="6321878">//&nbsp;Delay&nbsp;Time&nbsp;(1/100ths&nbsp;of&nbsp;a&nbsp;second)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6321918">//&nbsp;Transparent&nbsp;color&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321948">if</span>&nbsp;<span class="ident" id="6321951"><a href="/image/gif/writer.go.html#6321437">transparentIndex</a></span>&nbsp;<span class="op" id="6321968">!=</span>&nbsp;<span class="op" id="6321971">-</span><span class="num" id="6321972">1</span>&nbsp;<span class="op" id="6321974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321979"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6321980">.</span><span class="ident" id="6321981">buf</span><span class="op" id="6321984">[</span><span class="num" id="6321985">6</span><span class="op" id="6321986">]</span>&nbsp;<span class="op" id="6321988">=</span>&nbsp;<span class="builtintype" id="6321990">uint8</span><span class="op" id="6321995">(</span><span class="ident" id="6321996"><a href="/image/gif/writer.go.html#6321437">transparentIndex</a></span><span class="op" id="6322012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322016">}</span>&nbsp;<span class="keyword" id="6322018">else</span>&nbsp;<span class="op" id="6322023">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322028"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322029">.</span><span class="ident" id="6322030">buf</span><span class="op" id="6322033">[</span><span class="num" id="6322034">6</span><span class="op" id="6322035">]</span>&nbsp;<span class="op" id="6322037">=</span>&nbsp;<span class="num" id="6322039">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322050"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322051">.</span><span class="ident" id="6322052">buf</span><span class="op" id="6322055">[</span><span class="num" id="6322056">7</span><span class="op" id="6322057">]</span>&nbsp;<span class="op" id="6322059">=</span>&nbsp;<span class="num" id="6322061">0x00</span>&nbsp;<span class="comment" id="6322066">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322089"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322090">.</span><span class="ident" id="6322091">write</span><span class="op" id="6322096">(</span><span class="ident" id="6322097"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322098">.</span><span class="ident" id="6322099">buf</span><span class="op" id="6322102">[</span><span class="op" id="6322103">:</span><span class="num" id="6322104">8</span><span class="op" id="6322105">]</span><span class="op" id="6322106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322109">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322112"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322113">.</span><span class="ident" id="6322114">buf</span><span class="op" id="6322117">[</span><span class="num" id="6322118">0</span><span class="op" id="6322119">]</span>&nbsp;<span class="op" id="6322121">=</span>&nbsp;<span class="ident" id="6322123"><a href="/image/gif/reader.go.html#6306923">sImageDescriptor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322141"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6322152">(</span><span class="ident" id="6322153"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322154">.</span><span class="ident" id="6322155">buf</span><span class="op" id="6322158">[</span><span class="num" id="6322159">1</span><span class="op" id="6322160">:</span><span class="num" id="6322161">3</span><span class="op" id="6322162">]</span><span class="op" id="6322163">,</span>&nbsp;<span class="builtintype" id="6322165">uint16</span><span class="op" id="6322171">(</span><span class="ident" id="6322172"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6322173">.</span><span class="ident" id="6322174">Min</span><span class="op" id="6322177">.</span><span class="ident" id="6322178">X</span><span class="op" id="6322179">)</span><span class="op" id="6322180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322183"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6322194">(</span><span class="ident" id="6322195"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322196">.</span><span class="ident" id="6322197">buf</span><span class="op" id="6322200">[</span><span class="num" id="6322201">3</span><span class="op" id="6322202">:</span><span class="num" id="6322203">5</span><span class="op" id="6322204">]</span><span class="op" id="6322205">,</span>&nbsp;<span class="builtintype" id="6322207">uint16</span><span class="op" id="6322213">(</span><span class="ident" id="6322214"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6322215">.</span><span class="ident" id="6322216">Min</span><span class="op" id="6322219">.</span><span class="ident" id="6322220">Y</span><span class="op" id="6322221">)</span><span class="op" id="6322222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322225"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6322236">(</span><span class="ident" id="6322237"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322238">.</span><span class="ident" id="6322239">buf</span><span class="op" id="6322242">[</span><span class="num" id="6322243">5</span><span class="op" id="6322244">:</span><span class="num" id="6322245">7</span><span class="op" id="6322246">]</span><span class="op" id="6322247">,</span>&nbsp;<span class="builtintype" id="6322249">uint16</span><span class="op" id="6322255">(</span><span class="ident" id="6322256"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6322257">.</span><span class="ident" id="6322258">Dx</span><span class="op" id="6322260">(</span><span class="op" id="6322261">)</span><span class="op" id="6322262">)</span><span class="op" id="6322263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322266"><a href="/image/gif/writer.go.html#6318087">writeUint16</a></span><span class="op" id="6322277">(</span><span class="ident" id="6322278"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322279">.</span><span class="ident" id="6322280">buf</span><span class="op" id="6322283">[</span><span class="num" id="6322284">7</span><span class="op" id="6322285">:</span><span class="num" id="6322286">9</span><span class="op" id="6322287">]</span><span class="op" id="6322288">,</span>&nbsp;<span class="builtintype" id="6322290">uint16</span><span class="op" id="6322296">(</span><span class="ident" id="6322297"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6322298">.</span><span class="ident" id="6322299">Dy</span><span class="op" id="6322301">(</span><span class="op" id="6322302">)</span><span class="op" id="6322303">)</span><span class="op" id="6322304">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322307"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322308">.</span><span class="ident" id="6322309">write</span><span class="op" id="6322314">(</span><span class="ident" id="6322315"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322316">.</span><span class="ident" id="6322317">buf</span><span class="op" id="6322320">[</span><span class="op" id="6322321">:</span><span class="num" id="6322322">9</span><span class="op" id="6322323">]</span><span class="op" id="6322324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322328">paddedSize</span>&nbsp;<span class="op" id="6322339">:=</span>&nbsp;<span class="ident" id="6322342"><a href="/image/gif/writer.go.html#6317967">log2</a></span><span class="op" id="6322346">(</span><span class="builtinfunc" id="6322347">len</span><span class="op" id="6322350">(</span><span class="ident" id="6322351"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6322353">.</span><span class="ident" id="6322354">Palette</span><span class="op" id="6322361">)</span><span class="op" id="6322362">)</span>&nbsp;<span class="comment" id="6322364">//&nbsp;Size&nbsp;of&nbsp;Local&nbsp;Color&nbsp;Table:&nbsp;2^(1+n).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6322404">//&nbsp;Interlacing&nbsp;is&nbsp;not&nbsp;supported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322438"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322439">.</span><span class="ident" id="6322440">writeByte</span><span class="op" id="6322449">(</span><span class="num" id="6322450">0x80</span>&nbsp;<span class="op" id="6322455">|</span>&nbsp;<span class="builtintype" id="6322457">uint8</span><span class="op" id="6322462">(</span><span class="ident" id="6322463"><a href="/image/gif/writer.go.html#6322328">paddedSize</a></span><span class="op" id="6322473">)</span><span class="op" id="6322474">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6322478">//&nbsp;Local&nbsp;Color&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322501"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322502">.</span><span class="ident" id="6322503">writeColorTable</span><span class="op" id="6322518">(</span><span class="ident" id="6322519"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6322521">.</span><span class="ident" id="6322522">Palette</span><span class="op" id="6322529">,</span>&nbsp;<span class="ident" id="6322531"><a href="/image/gif/writer.go.html#6322328">paddedSize</a></span><span class="op" id="6322541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322545">litWidth</span>&nbsp;<span class="op" id="6322554">:=</span>&nbsp;<span class="ident" id="6322557"><a href="/image/gif/writer.go.html#6322328">paddedSize</a></span>&nbsp;<span class="op" id="6322568">+</span>&nbsp;<span class="num" id="6322570">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322573">if</span>&nbsp;<span class="ident" id="6322576"><a href="/image/gif/writer.go.html#6322545">litWidth</a></span>&nbsp;<span class="op" id="6322585">&lt;</span>&nbsp;<span class="num" id="6322587">2</span>&nbsp;<span class="op" id="6322589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322593"><a href="/image/gif/writer.go.html#6322545">litWidth</a></span>&nbsp;<span class="op" id="6322602">=</span>&nbsp;<span class="num" id="6322604">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322610"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322611">.</span><span class="ident" id="6322612">writeByte</span><span class="op" id="6322621">(</span><span class="builtintype" id="6322622">uint8</span><span class="op" id="6322627">(</span><span class="ident" id="6322628"><a href="/image/gif/writer.go.html#6322545">litWidth</a></span><span class="op" id="6322636">)</span><span class="op" id="6322637">)</span>&nbsp;<span class="comment" id="6322639">//&nbsp;LZW&nbsp;Minimum&nbsp;Code&nbsp;Size.</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322667">lzww</span>&nbsp;<span class="op" id="6322672">:=</span>&nbsp;<span class="ident" id="6322675"><a href="/image/gif/writer.go.html#6317723">lzw</a></span><span class="op" id="6322678">.</span><span class="ident" id="6322679">NewWriter</span><span class="op" id="6322688">(</span><span class="ident" id="6322689"><a href="/image/gif/writer.go.html#6318884">blockWriter</a></span><span class="op" id="6322700">{</span><span class="ident" id="6322701">e</span><span class="op" id="6322702">:</span>&nbsp;<span class="ident" id="6322704"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322705">}</span><span class="op" id="6322706">,</span>&nbsp;<span class="ident" id="6322708"><a href="/image/gif/writer.go.html#6317723">lzw</a></span><span class="op" id="6322711">.</span><span class="ident" id="6322712">LSB</span><span class="op" id="6322715">,</span>&nbsp;<span class="ident" id="6322717"><a href="/image/gif/writer.go.html#6322545">litWidth</a></span><span class="op" id="6322725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322728">if</span>&nbsp;<span class="ident" id="6322731">dx</span>&nbsp;<span class="op" id="6322734">:=</span>&nbsp;<span class="ident" id="6322737"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6322738">.</span><span class="ident" id="6322739">Dx</span><span class="op" id="6322741">(</span><span class="op" id="6322742">)</span><span class="op" id="6322743">;</span>&nbsp;<span class="ident" id="6322745"><a href="/image/gif/writer.go.html#6322731">dx</a></span>&nbsp;<span class="op" id="6322748">==</span>&nbsp;<span class="ident" id="6322751"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6322753">.</span><span class="ident" id="6322754">Stride</span>&nbsp;<span class="op" id="6322761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322765">_</span><span class="op" id="6322766">,</span>&nbsp;<span class="ident" id="6322768"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322769">.</span><span class="ident" id="6322770">err</span>&nbsp;<span class="op" id="6322774">=</span>&nbsp;<span class="ident" id="6322776"><a href="/image/gif/writer.go.html#6322667">lzww</a></span><span class="op" id="6322780">.</span><span class="ident" id="6322781">Write</span><span class="op" id="6322786">(</span><span class="ident" id="6322787"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6322789">.</span><span class="ident" id="6322790">Pix</span><span class="op" id="6322793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322797">if</span>&nbsp;<span class="ident" id="6322800"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322801">.</span><span class="ident" id="6322802">err</span>&nbsp;<span class="op" id="6322806">!=</span>&nbsp;<span class="ident" id="6322809">nil</span>&nbsp;<span class="op" id="6322813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322818"><a href="/image/gif/writer.go.html#6322667">lzww</a></span><span class="op" id="6322822">.</span><span class="ident" id="6322823">Close</span><span class="op" id="6322828">(</span><span class="op" id="6322829">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322834">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322846">}</span>&nbsp;<span class="keyword" id="6322848">else</span>&nbsp;<span class="op" id="6322853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322857">for</span>&nbsp;<span class="ident" id="6322861">i</span><span class="op" id="6322862">,</span>&nbsp;<span class="ident" id="6322864">y</span>&nbsp;<span class="op" id="6322866">:=</span>&nbsp;<span class="num" id="6322869">0</span><span class="op" id="6322870">,</span>&nbsp;<span class="ident" id="6322872"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6322873">.</span><span class="ident" id="6322874">Min</span><span class="op" id="6322877">.</span><span class="ident" id="6322878">Y</span><span class="op" id="6322879">;</span>&nbsp;<span class="ident" id="6322881"><a href="/image/gif/writer.go.html#6322864">y</a></span>&nbsp;<span class="op" id="6322883">&lt;</span>&nbsp;<span class="ident" id="6322885"><a href="/image/gif/writer.go.html#6321231">b</a></span><span class="op" id="6322886">.</span><span class="ident" id="6322887">Max</span><span class="op" id="6322890">.</span><span class="ident" id="6322891">Y</span><span class="op" id="6322892">;</span>&nbsp;<span class="ident" id="6322894"><a href="/image/gif/writer.go.html#6322861">i</a></span><span class="op" id="6322895">,</span>&nbsp;<span class="ident" id="6322897"><a href="/image/gif/writer.go.html#6322864">y</a></span>&nbsp;<span class="op" id="6322899">=</span>&nbsp;<span class="ident" id="6322901"><a href="/image/gif/writer.go.html#6322861">i</a></span><span class="op" id="6322902">+</span><span class="ident" id="6322903"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6322905">.</span><span class="ident" id="6322906">Stride</span><span class="op" id="6322912">,</span>&nbsp;<span class="ident" id="6322914"><a href="/image/gif/writer.go.html#6322864">y</a></span><span class="op" id="6322915">+</span><span class="num" id="6322916">1</span>&nbsp;<span class="op" id="6322918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322923">_</span><span class="op" id="6322924">,</span>&nbsp;<span class="ident" id="6322926"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322927">.</span><span class="ident" id="6322928">err</span>&nbsp;<span class="op" id="6322932">=</span>&nbsp;<span class="ident" id="6322934"><a href="/image/gif/writer.go.html#6322667">lzww</a></span><span class="op" id="6322938">.</span><span class="ident" id="6322939">Write</span><span class="op" id="6322944">(</span><span class="ident" id="6322945"><a href="/image/gif/writer.go.html#6321051">pm</a></span><span class="op" id="6322947">.</span><span class="ident" id="6322948">Pix</span><span class="op" id="6322951">[</span><span class="ident" id="6322952"><a href="/image/gif/writer.go.html#6322861">i</a></span>&nbsp;<span class="op" id="6322954">:</span>&nbsp;<span class="ident" id="6322956"><a href="/image/gif/writer.go.html#6322861">i</a></span><span class="op" id="6322957">+</span><span class="ident" id="6322958"><a href="/image/gif/writer.go.html#6322731">dx</a></span><span class="op" id="6322960">]</span><span class="op" id="6322961">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322966">if</span>&nbsp;<span class="ident" id="6322969"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6322970">.</span><span class="ident" id="6322971">err</span>&nbsp;<span class="op" id="6322975">!=</span>&nbsp;<span class="ident" id="6322978">nil</span>&nbsp;<span class="op" id="6322982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322988"><a href="/image/gif/writer.go.html#6322667">lzww</a></span><span class="op" id="6322992">.</span><span class="ident" id="6322993">Close</span><span class="op" id="6322998">(</span><span class="op" id="6322999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323005">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323019">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323025"><a href="/image/gif/writer.go.html#6322667">lzww</a></span><span class="op" id="6323029">.</span><span class="ident" id="6323030">Close</span><span class="op" id="6323035">(</span><span class="op" id="6323036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323039"><a href="/image/gif/writer.go.html#6321023">e</a></span><span class="op" id="6323040">.</span><span class="ident" id="6323041">writeByte</span><span class="op" id="6323050">(</span><span class="num" id="6323051">0x00</span><span class="op" id="6323055">)</span>&nbsp;<span class="comment" id="6323057">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span><span class="op" id="6323078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6323081">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="6323121">type</span>&nbsp;<span class="ident" id="6323126">Options</span>&nbsp;<span class="keyword" id="6323134">struct</span>&nbsp;<span class="op" id="6323141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323144">//&nbsp;NumColors&nbsp;is&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323209">//&nbsp;It&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;256.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323238">NumColors</span>&nbsp;<span class="builtintype" id="6323248">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323254">//&nbsp;Quantizer&nbsp;is&nbsp;used&nbsp;to&nbsp;produce&nbsp;a&nbsp;palette&nbsp;with&nbsp;size&nbsp;NumColors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323318">//&nbsp;palette.Plan9&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Quantizer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323373">Quantizer</span>&nbsp;<span class="ident" id="6323383"><a href="/image/gif/writer.go.html#6317796">draw</a></span><span class="op" id="6323387">.</span><span class="ident" id="6323388">Quantizer</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323400">//&nbsp;Drawer&nbsp;is&nbsp;used&nbsp;to&nbsp;convert&nbsp;the&nbsp;source&nbsp;image&nbsp;to&nbsp;the&nbsp;desired&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323471">//&nbsp;draw.FloydSteinberg&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Drawer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323529">Drawer</span>&nbsp;<span class="ident" id="6323536"><a href="/image/gif/writer.go.html#6317796">draw</a></span><span class="op" id="6323540">.</span><span class="ident" id="6323541">Drawer</span><br>
<span class="lineno"></span><span class="op" id="6323548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6323551">//&nbsp;EncodeAll&nbsp;writes&nbsp;the&nbsp;images&nbsp;in&nbsp;g&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6323615">//&nbsp;given&nbsp;loop&nbsp;count&nbsp;and&nbsp;delay&nbsp;between&nbsp;frames.</span><br>
<span class="lineno"></span><span class="keyword" id="6323661">func</span>&nbsp;<span class="ident" id="6323666">EncodeAll</span><span class="op" id="6323675">(</span><span class="ident" id="6323676">w</span>&nbsp;<span class="ident" id="6323678"><a href="/image/gif/writer.go.html#6317810">io</a></span><span class="op" id="6323680">.</span><span class="ident" id="6323681">Writer</span><span class="op" id="6323687">,</span>&nbsp;<span class="ident" id="6323689">g</span>&nbsp;<span class="op" id="6323691">*</span><span class="ident" id="6323692"><a href="/image/gif/reader.go.html#6316534">GIF</a></span><span class="op" id="6323695">)</span>&nbsp;<span class="builtintype" id="6323697">error</span>&nbsp;<span class="op" id="6323703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323706">if</span>&nbsp;<span class="builtinfunc" id="6323709">len</span><span class="op" id="6323712">(</span><span class="ident" id="6323713"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6323714">.</span><span class="ident" id="6323715">Image</span><span class="op" id="6323720">)</span>&nbsp;<span class="op" id="6323722">==</span>&nbsp;<span class="num" id="6323725">0</span>&nbsp;<span class="op" id="6323727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323731">return</span>&nbsp;<span class="ident" id="6323738"><a href="/image/gif/writer.go.html#6317739">errors</a></span><span class="op" id="6323744">.</span><span class="ident" id="6323745">New</span><span class="op" id="6323748">(</span><span class="string" id="6323749">&#34;gif:&nbsp;must&nbsp;provide&nbsp;at&nbsp;least&nbsp;one&nbsp;image&#34;</span><span class="op" id="6323787">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323794">if</span>&nbsp;<span class="builtinfunc" id="6323797">len</span><span class="op" id="6323800">(</span><span class="ident" id="6323801"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6323802">.</span><span class="ident" id="6323803">Image</span><span class="op" id="6323808">)</span>&nbsp;<span class="op" id="6323810">!=</span>&nbsp;<span class="builtinfunc" id="6323813">len</span><span class="op" id="6323816">(</span><span class="ident" id="6323817"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6323818">.</span><span class="ident" id="6323819">Delay</span><span class="op" id="6323824">)</span>&nbsp;<span class="op" id="6323826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323830">return</span>&nbsp;<span class="ident" id="6323837"><a href="/image/gif/writer.go.html#6317739">errors</a></span><span class="op" id="6323843">.</span><span class="ident" id="6323844">New</span><span class="op" id="6323847">(</span><span class="string" id="6323848">&#34;gif:&nbsp;mismatched&nbsp;image&nbsp;and&nbsp;delay&nbsp;lengths&#34;</span><span class="op" id="6323889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323892">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323895">if</span>&nbsp;<span class="ident" id="6323898"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6323899">.</span><span class="ident" id="6323900">LoopCount</span>&nbsp;<span class="op" id="6323910">&lt;</span>&nbsp;<span class="num" id="6323912">0</span>&nbsp;<span class="op" id="6323914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323918"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6323919">.</span><span class="ident" id="6323920">LoopCount</span>&nbsp;<span class="op" id="6323930">=</span>&nbsp;<span class="num" id="6323932">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323939">e</span>&nbsp;<span class="op" id="6323941">:=</span>&nbsp;<span class="ident" id="6323944"><a href="/image/gif/writer.go.html#6318316">encoder</a></span><span class="op" id="6323951">{</span><span class="ident" id="6323952">g</span><span class="op" id="6323953">:</span>&nbsp;<span class="ident" id="6323955"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6323956">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323959">if</span>&nbsp;<span class="ident" id="6323962">ww</span><span class="op" id="6323964">,</span>&nbsp;<span class="ident" id="6323966">ok</span>&nbsp;<span class="op" id="6323969">:=</span>&nbsp;<span class="ident" id="6323972"><a href="/image/gif/writer.go.html#6323676">w</a></span><span class="op" id="6323973">.</span><span class="op" id="6323974">(</span><span class="ident" id="6323975"><a href="/image/gif/writer.go.html#6318201">writer</a></span><span class="op" id="6323981">)</span><span class="op" id="6323982">;</span>&nbsp;<span class="ident" id="6323984"><a href="/image/gif/writer.go.html#6323966">ok</a></span>&nbsp;<span class="op" id="6323987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323991"><a href="/image/gif/writer.go.html#6323939">e</a></span><span class="op" id="6323992">.</span><span class="ident" id="6323993">w</span>&nbsp;<span class="op" id="6323995">=</span>&nbsp;<span class="ident" id="6323997"><a href="/image/gif/writer.go.html#6323962">ww</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324001">}</span>&nbsp;<span class="keyword" id="6324003">else</span>&nbsp;<span class="op" id="6324008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324012"><a href="/image/gif/writer.go.html#6323939">e</a></span><span class="op" id="6324013">.</span><span class="ident" id="6324014">w</span>&nbsp;<span class="op" id="6324016">=</span>&nbsp;<span class="ident" id="6324018"><a href="/image/gif/writer.go.html#6317714">bufio</a></span><span class="op" id="6324023">.</span><span class="ident" id="6324024">NewWriter</span><span class="op" id="6324033">(</span><span class="ident" id="6324034"><a href="/image/gif/writer.go.html#6323676">w</a></span><span class="op" id="6324035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324038">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324042"><a href="/image/gif/writer.go.html#6323939">e</a></span><span class="op" id="6324043">.</span><span class="ident" id="6324044">writeHeader</span><span class="op" id="6324055">(</span><span class="op" id="6324056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324059">for</span>&nbsp;<span class="ident" id="6324063">i</span><span class="op" id="6324064">,</span>&nbsp;<span class="ident" id="6324066">pm</span>&nbsp;<span class="op" id="6324069">:=</span>&nbsp;<span class="keyword" id="6324072">range</span>&nbsp;<span class="ident" id="6324078"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6324079">.</span><span class="ident" id="6324080">Image</span>&nbsp;<span class="op" id="6324086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324090"><a href="/image/gif/writer.go.html#6323939">e</a></span><span class="op" id="6324091">.</span><span class="ident" id="6324092">writeImageBlock</span><span class="op" id="6324107">(</span><span class="ident" id="6324108"><a href="/image/gif/writer.go.html#6324066">pm</a></span><span class="op" id="6324110">,</span>&nbsp;<span class="ident" id="6324112"><a href="/image/gif/writer.go.html#6323689">g</a></span><span class="op" id="6324113">.</span><span class="ident" id="6324114">Delay</span><span class="op" id="6324119">[</span><span class="ident" id="6324120"><a href="/image/gif/writer.go.html#6324063">i</a></span><span class="op" id="6324121">]</span><span class="op" id="6324122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324125">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324128"><a href="/image/gif/writer.go.html#6323939">e</a></span><span class="op" id="6324129">.</span><span class="ident" id="6324130">writeByte</span><span class="op" id="6324139">(</span><span class="ident" id="6324140"><a href="/image/gif/reader.go.html#6306948">sTrailer</a></span><span class="op" id="6324148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324151"><a href="/image/gif/writer.go.html#6323939">e</a></span><span class="op" id="6324152">.</span><span class="ident" id="6324153">flush</span><span class="op" id="6324158">(</span><span class="op" id="6324159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324162">return</span>&nbsp;<span class="ident" id="6324169"><a href="/image/gif/writer.go.html#6323939">e</a></span><span class="op" id="6324170">.</span><span class="ident" id="6324171">err</span><br>
<span class="lineno"></span><span class="op" id="6324175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6324178">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6324227">func</span>&nbsp;<span class="ident" id="6324232">Encode</span><span class="op" id="6324238">(</span><span class="ident" id="6324239">w</span>&nbsp;<span class="ident" id="6324241"><a href="/image/gif/writer.go.html#6317810">io</a></span><span class="op" id="6324243">.</span><span class="ident" id="6324244">Writer</span><span class="op" id="6324250">,</span>&nbsp;<span class="ident" id="6324252">m</span>&nbsp;<span class="ident" id="6324254"><a href="/image/gif/writer.go.html#6317749">image</a></span><span class="op" id="6324259">.</span><span class="ident" id="6324260">Image</span><span class="op" id="6324265">,</span>&nbsp;<span class="ident" id="6324267">o</span>&nbsp;<span class="op" id="6324269">*</span><span class="ident" id="6324270"><a href="/image/gif/writer.go.html#6323126">Options</a></span><span class="op" id="6324277">)</span>&nbsp;<span class="builtintype" id="6324279">error</span>&nbsp;<span class="op" id="6324285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6324288">//&nbsp;Check&nbsp;for&nbsp;bounds&nbsp;and&nbsp;size&nbsp;restrictions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324332">b</span>&nbsp;<span class="op" id="6324334">:=</span>&nbsp;<span class="ident" id="6324337"><a href="/image/gif/writer.go.html#6324252">m</a></span><span class="op" id="6324338">.</span><span class="ident" id="6324339">Bounds</span><span class="op" id="6324345">(</span><span class="op" id="6324346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324349">if</span>&nbsp;<span class="ident" id="6324352"><a href="/image/gif/writer.go.html#6324332">b</a></span><span class="op" id="6324353">.</span><span class="ident" id="6324354">Dx</span><span class="op" id="6324356">(</span><span class="op" id="6324357">)</span>&nbsp;<span class="op" id="6324359">&gt;=</span>&nbsp;<span class="num" id="6324362">1</span><span class="op" id="6324363">&lt;&lt;</span><span class="num" id="6324365">16</span>&nbsp;<span class="op" id="6324368">||</span>&nbsp;<span class="ident" id="6324371"><a href="/image/gif/writer.go.html#6324332">b</a></span><span class="op" id="6324372">.</span><span class="ident" id="6324373">Dy</span><span class="op" id="6324375">(</span><span class="op" id="6324376">)</span>&nbsp;<span class="op" id="6324378">&gt;=</span>&nbsp;<span class="num" id="6324381">1</span><span class="op" id="6324382">&lt;&lt;</span><span class="num" id="6324384">16</span>&nbsp;<span class="op" id="6324387">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324391">return</span>&nbsp;<span class="ident" id="6324398"><a href="/image/gif/writer.go.html#6317739">errors</a></span><span class="op" id="6324404">.</span><span class="ident" id="6324405">New</span><span class="op" id="6324408">(</span><span class="string" id="6324409">&#34;gif:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6324444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324451">opts</span>&nbsp;<span class="op" id="6324456">:=</span>&nbsp;<span class="ident" id="6324459"><a href="/image/gif/writer.go.html#6323126">Options</a></span><span class="op" id="6324466">{</span><span class="op" id="6324467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324470">if</span>&nbsp;<span class="ident" id="6324473"><a href="/image/gif/writer.go.html#6324267">o</a></span>&nbsp;<span class="op" id="6324475">!=</span>&nbsp;<span class="ident" id="6324478">nil</span>&nbsp;<span class="op" id="6324482">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324486"><a href="/image/gif/writer.go.html#6324451">opts</a></span>&nbsp;<span class="op" id="6324491">=</span>&nbsp;<span class="op" id="6324493">*</span><span class="ident" id="6324494"><a href="/image/gif/writer.go.html#6324267">o</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324500">if</span>&nbsp;<span class="ident" id="6324503"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324507">.</span><span class="ident" id="6324508">NumColors</span>&nbsp;<span class="op" id="6324518">&lt;</span>&nbsp;<span class="num" id="6324520">1</span>&nbsp;<span class="op" id="6324522">||</span>&nbsp;<span class="num" id="6324525">256</span>&nbsp;<span class="op" id="6324529">&lt;</span>&nbsp;<span class="ident" id="6324531"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324535">.</span><span class="ident" id="6324536">NumColors</span>&nbsp;<span class="op" id="6324546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324550"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324554">.</span><span class="ident" id="6324555">NumColors</span>&nbsp;<span class="op" id="6324565">=</span>&nbsp;<span class="num" id="6324567">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324572">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324575">if</span>&nbsp;<span class="ident" id="6324578"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324582">.</span><span class="ident" id="6324583">Drawer</span>&nbsp;<span class="op" id="6324590">==</span>&nbsp;<span class="ident" id="6324593">nil</span>&nbsp;<span class="op" id="6324597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324601"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324605">.</span><span class="ident" id="6324606">Drawer</span>&nbsp;<span class="op" id="6324613">=</span>&nbsp;<span class="ident" id="6324615"><a href="/image/gif/writer.go.html#6317796">draw</a></span><span class="op" id="6324619">.</span><span class="ident" id="6324620">FloydSteinberg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324640">pm</span><span class="op" id="6324642">,</span>&nbsp;<span class="ident" id="6324644">ok</span>&nbsp;<span class="op" id="6324647">:=</span>&nbsp;<span class="ident" id="6324650"><a href="/image/gif/writer.go.html#6324252">m</a></span><span class="op" id="6324651">.</span><span class="op" id="6324652">(</span><span class="op" id="6324653">*</span><span class="ident" id="6324654"><a href="/image/gif/writer.go.html#6317749">image</a></span><span class="op" id="6324659">.</span><span class="ident" id="6324660">Paletted</span><span class="op" id="6324668">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324671">if</span>&nbsp;<span class="op" id="6324674">!</span><span class="ident" id="6324675"><a href="/image/gif/writer.go.html#6324644">ok</a></span>&nbsp;<span class="op" id="6324678">||</span>&nbsp;<span class="builtinfunc" id="6324681">len</span><span class="op" id="6324684">(</span><span class="ident" id="6324685"><a href="/image/gif/writer.go.html#6324640">pm</a></span><span class="op" id="6324687">.</span><span class="ident" id="6324688">Palette</span><span class="op" id="6324695">)</span>&nbsp;<span class="op" id="6324697">&gt;</span>&nbsp;<span class="ident" id="6324699"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324703">.</span><span class="ident" id="6324704">NumColors</span>&nbsp;<span class="op" id="6324714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6324718">//&nbsp;TODO:&nbsp;Pick&nbsp;a&nbsp;better&nbsp;sub-sample&nbsp;of&nbsp;the&nbsp;Plan&nbsp;9&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324777"><a href="/image/gif/writer.go.html#6324640">pm</a></span>&nbsp;<span class="op" id="6324780">=</span>&nbsp;<span class="ident" id="6324782"><a href="/image/gif/writer.go.html#6317749">image</a></span><span class="op" id="6324787">.</span><span class="ident" id="6324788">NewPaletted</span><span class="op" id="6324799">(</span><span class="ident" id="6324800"><a href="/image/gif/writer.go.html#6324332">b</a></span><span class="op" id="6324801">,</span>&nbsp;<span class="ident" id="6324803"><a href="/image/gif/writer.go.html#6317773">palette</a></span><span class="op" id="6324810">.</span><span class="ident" id="6324811">Plan9</span><span class="op" id="6324816">[</span><span class="op" id="6324817">:</span><span class="ident" id="6324818"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324822">.</span><span class="ident" id="6324823">NumColors</span><span class="op" id="6324832">]</span><span class="op" id="6324833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324837">if</span>&nbsp;<span class="ident" id="6324840"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324844">.</span><span class="ident" id="6324845">Quantizer</span>&nbsp;<span class="op" id="6324855">!=</span>&nbsp;<span class="ident" id="6324858">nil</span>&nbsp;<span class="op" id="6324862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324867"><a href="/image/gif/writer.go.html#6324640">pm</a></span><span class="op" id="6324869">.</span><span class="ident" id="6324870">Palette</span>&nbsp;<span class="op" id="6324878">=</span>&nbsp;<span class="ident" id="6324880"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324884">.</span><span class="ident" id="6324885">Quantizer</span><span class="op" id="6324894">.</span><span class="ident" id="6324895">Quantize</span><span class="op" id="6324903">(</span><span class="builtinfunc" id="6324904">make</span><span class="op" id="6324908">(</span><span class="ident" id="6324909"><a href="/image/gif/writer.go.html#6317758">color</a></span><span class="op" id="6324914">.</span><span class="ident" id="6324915">Palette</span><span class="op" id="6324922">,</span>&nbsp;<span class="num" id="6324924">0</span><span class="op" id="6324925">,</span>&nbsp;<span class="ident" id="6324927"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324931">.</span><span class="ident" id="6324932">NumColors</span><span class="op" id="6324941">)</span><span class="op" id="6324942">,</span>&nbsp;<span class="ident" id="6324944"><a href="/image/gif/writer.go.html#6324252">m</a></span><span class="op" id="6324945">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324953"><a href="/image/gif/writer.go.html#6324451">opts</a></span><span class="op" id="6324957">.</span><span class="ident" id="6324958">Drawer</span><span class="op" id="6324964">.</span><span class="ident" id="6324965">Draw</span><span class="op" id="6324969">(</span><span class="ident" id="6324970"><a href="/image/gif/writer.go.html#6324640">pm</a></span><span class="op" id="6324972">,</span>&nbsp;<span class="ident" id="6324974"><a href="/image/gif/writer.go.html#6324332">b</a></span><span class="op" id="6324975">,</span>&nbsp;<span class="ident" id="6324977"><a href="/image/gif/writer.go.html#6324252">m</a></span><span class="op" id="6324978">,</span>&nbsp;<span class="ident" id="6324980"><a href="/image/gif/writer.go.html#6317749">image</a></span><span class="op" id="6324985">.</span><span class="ident" id="6324986">ZP</span><span class="op" id="6324988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324995">return</span>&nbsp;<span class="ident" id="6325002"><a href="/image/gif/writer.go.html#6323666">EncodeAll</a></span><span class="op" id="6325011">(</span><span class="ident" id="6325012"><a href="/image/gif/writer.go.html#6324239">w</a></span><span class="op" id="6325013">,</span>&nbsp;<span class="op" id="6325015">&amp;</span><span class="ident" id="6325016"><a href="/image/gif/reader.go.html#6316534">GIF</a></span><span class="op" id="6325019">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325023">Image</span><span class="op" id="6325028">:</span>&nbsp;<span class="op" id="6325030">[</span><span class="op" id="6325031">]</span><span class="op" id="6325032">*</span><span class="ident" id="6325033"><a href="/image/gif/writer.go.html#6317749">image</a></span><span class="op" id="6325038">.</span><span class="ident" id="6325039">Paletted</span><span class="op" id="6325047">{</span><span class="ident" id="6325048"><a href="/image/gif/writer.go.html#6324640">pm</a></span><span class="op" id="6325050">}</span><span class="op" id="6325051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325055">Delay</span><span class="op" id="6325060">:</span>&nbsp;<span class="op" id="6325062">[</span><span class="op" id="6325063">]</span><span class="builtintype" id="6325064">int</span><span class="op" id="6325067">{</span><span class="num" id="6325068">0</span><span class="op" id="6325069">}</span><span class="op" id="6325070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325073">}</span><span class="op" id="6325074">)</span><br>
<span class="lineno"></span><span class="op" id="6325076">}</span>
</div>
</body>
</html>
