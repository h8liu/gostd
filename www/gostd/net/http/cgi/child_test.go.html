<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html" class="current">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8506807">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8506862">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8506916">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8506967">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8507017">package</span>&nbsp;<span class="ident" id="8507025">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8507030">import</span>&nbsp;<span class="op" id="8507037">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507040">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8507050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8507053">func</span>&nbsp;<span class="ident" id="8507058">TestRequest</span><span class="op" id="8507069">(</span><span class="ident" id="8507070">t</span>&nbsp;<span class="op" id="8507072">*</span><span class="ident" id="8507073">testing</span><span class="op" id="8507080">.</span><span class="ident" id="8507081">T</span><span class="op" id="8507082">)</span>&nbsp;<span class="op" id="8507084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507087">env</span>&nbsp;<span class="op" id="8507091">:=</span>&nbsp;<span class="keyword" id="8507094">map</span><span class="op" id="8507097">[</span><span class="builtintype" id="8507098">string</span><span class="op" id="8507104">]</span><span class="builtintype" id="8507105">string</span><span class="op" id="8507111">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507115">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8507132">:</span>&nbsp;<span class="string" id="8507134">&#34;HTTP/1.1&#34;</span><span class="op" id="8507144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507148">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8507164">:</span>&nbsp;&nbsp;<span class="string" id="8507167">&#34;GET&#34;</span><span class="op" id="8507172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507176">&#34;HTTP_HOST&#34;</span><span class="op" id="8507187">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8507195">&#34;example.com&#34;</span><span class="op" id="8507208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507212">&#34;HTTP_REFERER&#34;</span><span class="op" id="8507226">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8507231">&#34;elsewhere&#34;</span><span class="op" id="8507242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507246">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="8507263">:</span>&nbsp;<span class="string" id="8507265">&#34;goclient&#34;</span><span class="op" id="8507275">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507279">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="8507293">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8507298">&#34;baz&#34;</span><span class="op" id="8507303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507307">&#34;REQUEST_URI&#34;</span><span class="op" id="8507320">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8507326">&#34;/path?a=b&#34;</span><span class="op" id="8507337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507341">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8507357">:</span>&nbsp;&nbsp;<span class="string" id="8507360">&#34;123&#34;</span><span class="op" id="8507365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507369">&#34;CONTENT_TYPE&#34;</span><span class="op" id="8507383">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8507388">&#34;text/xml&#34;</span><span class="op" id="8507398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8507402">&#34;REMOTE_ADDR&#34;</span><span class="op" id="8507415">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8507421">&#34;5.6.7.8&#34;</span><span class="op" id="8507430">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507436">req</span><span class="op" id="8507439">,</span>&nbsp;<span class="ident" id="8507441">err</span>&nbsp;<span class="op" id="8507445">:=</span>&nbsp;<span class="ident" id="8507448">RequestFromMap</span><span class="op" id="8507462">(</span><span class="ident" id="8507463">env</span><span class="op" id="8507466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507469">if</span>&nbsp;<span class="ident" id="8507472">err</span>&nbsp;<span class="op" id="8507476">!=</span>&nbsp;<span class="ident" id="8507479">nil</span>&nbsp;<span class="op" id="8507483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507487">t</span><span class="op" id="8507488">.</span><span class="ident" id="8507489">Fatalf</span><span class="op" id="8507495">(</span><span class="string" id="8507496">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8507516">,</span>&nbsp;<span class="ident" id="8507518">err</span><span class="op" id="8507521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507524">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507527">if</span>&nbsp;<span class="ident" id="8507530">g</span><span class="op" id="8507531">,</span>&nbsp;<span class="ident" id="8507533">e</span>&nbsp;<span class="op" id="8507535">:=</span>&nbsp;<span class="ident" id="8507538">req</span><span class="op" id="8507541">.</span><span class="ident" id="8507542">UserAgent</span><span class="op" id="8507551">(</span><span class="op" id="8507552">)</span><span class="op" id="8507553">,</span>&nbsp;<span class="string" id="8507555">&#34;goclient&#34;</span><span class="op" id="8507565">;</span>&nbsp;<span class="ident" id="8507567">e</span>&nbsp;<span class="op" id="8507569">!=</span>&nbsp;<span class="ident" id="8507572">g</span>&nbsp;<span class="op" id="8507574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507578">t</span><span class="op" id="8507579">.</span><span class="ident" id="8507580">Errorf</span><span class="op" id="8507586">(</span><span class="string" id="8507587">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8507618">,</span>&nbsp;<span class="ident" id="8507620">e</span><span class="op" id="8507621">,</span>&nbsp;<span class="ident" id="8507623">g</span><span class="op" id="8507624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507630">if</span>&nbsp;<span class="ident" id="8507633">g</span><span class="op" id="8507634">,</span>&nbsp;<span class="ident" id="8507636">e</span>&nbsp;<span class="op" id="8507638">:=</span>&nbsp;<span class="ident" id="8507641">req</span><span class="op" id="8507644">.</span><span class="ident" id="8507645">Method</span><span class="op" id="8507651">,</span>&nbsp;<span class="string" id="8507653">&#34;GET&#34;</span><span class="op" id="8507658">;</span>&nbsp;<span class="ident" id="8507660">e</span>&nbsp;<span class="op" id="8507662">!=</span>&nbsp;<span class="ident" id="8507665">g</span>&nbsp;<span class="op" id="8507667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507671">t</span><span class="op" id="8507672">.</span><span class="ident" id="8507673">Errorf</span><span class="op" id="8507679">(</span><span class="string" id="8507680">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8507708">,</span>&nbsp;<span class="ident" id="8507710">e</span><span class="op" id="8507711">,</span>&nbsp;<span class="ident" id="8507713">g</span><span class="op" id="8507714">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507720">if</span>&nbsp;<span class="ident" id="8507723">g</span><span class="op" id="8507724">,</span>&nbsp;<span class="ident" id="8507726">e</span>&nbsp;<span class="op" id="8507728">:=</span>&nbsp;<span class="ident" id="8507731">req</span><span class="op" id="8507734">.</span><span class="ident" id="8507735">Header</span><span class="op" id="8507741">.</span><span class="ident" id="8507742">Get</span><span class="op" id="8507745">(</span><span class="string" id="8507746">&#34;Content-Type&#34;</span><span class="op" id="8507760">)</span><span class="op" id="8507761">,</span>&nbsp;<span class="string" id="8507763">&#34;text/xml&#34;</span><span class="op" id="8507773">;</span>&nbsp;<span class="ident" id="8507775">e</span>&nbsp;<span class="op" id="8507777">!=</span>&nbsp;<span class="ident" id="8507780">g</span>&nbsp;<span class="op" id="8507782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507786">t</span><span class="op" id="8507787">.</span><span class="ident" id="8507788">Errorf</span><span class="op" id="8507794">(</span><span class="string" id="8507795">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8507829">,</span>&nbsp;<span class="ident" id="8507831">e</span><span class="op" id="8507832">,</span>&nbsp;<span class="ident" id="8507834">g</span><span class="op" id="8507835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507841">if</span>&nbsp;<span class="ident" id="8507844">g</span><span class="op" id="8507845">,</span>&nbsp;<span class="ident" id="8507847">e</span>&nbsp;<span class="op" id="8507849">:=</span>&nbsp;<span class="ident" id="8507852">req</span><span class="op" id="8507855">.</span><span class="ident" id="8507856">ContentLength</span><span class="op" id="8507869">,</span>&nbsp;<span class="ident" id="8507871">int64</span><span class="op" id="8507876">(</span><span class="num" id="8507877">123</span><span class="op" id="8507880">)</span><span class="op" id="8507881">;</span>&nbsp;<span class="ident" id="8507883">e</span>&nbsp;<span class="op" id="8507885">!=</span>&nbsp;<span class="ident" id="8507888">g</span>&nbsp;<span class="op" id="8507890">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507894">t</span><span class="op" id="8507895">.</span><span class="ident" id="8507896">Errorf</span><span class="op" id="8507902">(</span><span class="string" id="8507903">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8507938">,</span>&nbsp;<span class="ident" id="8507940">e</span><span class="op" id="8507941">,</span>&nbsp;<span class="ident" id="8507943">g</span><span class="op" id="8507944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507950">if</span>&nbsp;<span class="ident" id="8507953">g</span><span class="op" id="8507954">,</span>&nbsp;<span class="ident" id="8507956">e</span>&nbsp;<span class="op" id="8507958">:=</span>&nbsp;<span class="ident" id="8507961">req</span><span class="op" id="8507964">.</span><span class="ident" id="8507965">Referer</span><span class="op" id="8507972">(</span><span class="op" id="8507973">)</span><span class="op" id="8507974">,</span>&nbsp;<span class="string" id="8507976">&#34;elsewhere&#34;</span><span class="op" id="8507987">;</span>&nbsp;<span class="ident" id="8507989">e</span>&nbsp;<span class="op" id="8507991">!=</span>&nbsp;<span class="ident" id="8507994">g</span>&nbsp;<span class="op" id="8507996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508000">t</span><span class="op" id="8508001">.</span><span class="ident" id="8508002">Errorf</span><span class="op" id="8508008">(</span><span class="string" id="8508009">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8508038">,</span>&nbsp;<span class="ident" id="8508040">e</span><span class="op" id="8508041">,</span>&nbsp;<span class="ident" id="8508043">g</span><span class="op" id="8508044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508047">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508050">if</span>&nbsp;<span class="ident" id="8508053">req</span><span class="op" id="8508056">.</span><span class="ident" id="8508057">Header</span>&nbsp;<span class="op" id="8508064">==</span>&nbsp;<span class="ident" id="8508067">nil</span>&nbsp;<span class="op" id="8508071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508075">t</span><span class="op" id="8508076">.</span><span class="ident" id="8508077">Fatalf</span><span class="op" id="8508083">(</span><span class="string" id="8508084">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="8508107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508113">if</span>&nbsp;<span class="ident" id="8508116">g</span><span class="op" id="8508117">,</span>&nbsp;<span class="ident" id="8508119">e</span>&nbsp;<span class="op" id="8508121">:=</span>&nbsp;<span class="ident" id="8508124">req</span><span class="op" id="8508127">.</span><span class="ident" id="8508128">Header</span><span class="op" id="8508134">.</span><span class="ident" id="8508135">Get</span><span class="op" id="8508138">(</span><span class="string" id="8508139">&#34;Foo-Bar&#34;</span><span class="op" id="8508148">)</span><span class="op" id="8508149">,</span>&nbsp;<span class="string" id="8508151">&#34;baz&#34;</span><span class="op" id="8508156">;</span>&nbsp;<span class="ident" id="8508158">e</span>&nbsp;<span class="op" id="8508160">!=</span>&nbsp;<span class="ident" id="8508163">g</span>&nbsp;<span class="op" id="8508165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508169">t</span><span class="op" id="8508170">.</span><span class="ident" id="8508171">Errorf</span><span class="op" id="8508177">(</span><span class="string" id="8508178">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8508207">,</span>&nbsp;<span class="ident" id="8508209">e</span><span class="op" id="8508210">,</span>&nbsp;<span class="ident" id="8508212">g</span><span class="op" id="8508213">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508219">if</span>&nbsp;<span class="ident" id="8508222">g</span><span class="op" id="8508223">,</span>&nbsp;<span class="ident" id="8508225">e</span>&nbsp;<span class="op" id="8508227">:=</span>&nbsp;<span class="ident" id="8508230">req</span><span class="op" id="8508233">.</span><span class="ident" id="8508234">URL</span><span class="op" id="8508237">.</span><span class="ident" id="8508238">String</span><span class="op" id="8508244">(</span><span class="op" id="8508245">)</span><span class="op" id="8508246">,</span>&nbsp;<span class="string" id="8508248">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="8508277">;</span>&nbsp;<span class="ident" id="8508279">e</span>&nbsp;<span class="op" id="8508281">!=</span>&nbsp;<span class="ident" id="8508284">g</span>&nbsp;<span class="op" id="8508286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508290">t</span><span class="op" id="8508291">.</span><span class="ident" id="8508292">Errorf</span><span class="op" id="8508298">(</span><span class="string" id="8508299">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8508324">,</span>&nbsp;<span class="ident" id="8508326">e</span><span class="op" id="8508327">,</span>&nbsp;<span class="ident" id="8508329">g</span><span class="op" id="8508330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508336">if</span>&nbsp;<span class="ident" id="8508339">g</span><span class="op" id="8508340">,</span>&nbsp;<span class="ident" id="8508342">e</span>&nbsp;<span class="op" id="8508344">:=</span>&nbsp;<span class="ident" id="8508347">req</span><span class="op" id="8508350">.</span><span class="ident" id="8508351">FormValue</span><span class="op" id="8508360">(</span><span class="string" id="8508361">&#34;a&#34;</span><span class="op" id="8508364">)</span><span class="op" id="8508365">,</span>&nbsp;<span class="string" id="8508367">&#34;b&#34;</span><span class="op" id="8508370">;</span>&nbsp;<span class="ident" id="8508372">e</span>&nbsp;<span class="op" id="8508374">!=</span>&nbsp;<span class="ident" id="8508377">g</span>&nbsp;<span class="op" id="8508379">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508383">t</span><span class="op" id="8508384">.</span><span class="ident" id="8508385">Errorf</span><span class="op" id="8508391">(</span><span class="string" id="8508392">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8508426">,</span>&nbsp;<span class="ident" id="8508428">e</span><span class="op" id="8508429">,</span>&nbsp;<span class="ident" id="8508431">g</span><span class="op" id="8508432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508438">if</span>&nbsp;<span class="ident" id="8508441">req</span><span class="op" id="8508444">.</span><span class="ident" id="8508445">Trailer</span>&nbsp;<span class="op" id="8508453">==</span>&nbsp;<span class="ident" id="8508456">nil</span>&nbsp;<span class="op" id="8508460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508464">t</span><span class="op" id="8508465">.</span><span class="ident" id="8508466">Errorf</span><span class="op" id="8508472">(</span><span class="string" id="8508473">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="8508497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508500">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508503">if</span>&nbsp;<span class="ident" id="8508506">req</span><span class="op" id="8508509">.</span><span class="ident" id="8508510">TLS</span>&nbsp;<span class="op" id="8508514">!=</span>&nbsp;<span class="ident" id="8508517">nil</span>&nbsp;<span class="op" id="8508521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508525">t</span><span class="op" id="8508526">.</span><span class="ident" id="8508527">Errorf</span><span class="op" id="8508533">(</span><span class="string" id="8508534">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="8508552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508558">if</span>&nbsp;<span class="ident" id="8508561">e</span><span class="op" id="8508562">,</span>&nbsp;<span class="ident" id="8508564">g</span>&nbsp;<span class="op" id="8508566">:=</span>&nbsp;<span class="string" id="8508569">&#34;5.6.7.8:0&#34;</span><span class="op" id="8508580">,</span>&nbsp;<span class="ident" id="8508582">req</span><span class="op" id="8508585">.</span><span class="ident" id="8508586">RemoteAddr</span><span class="op" id="8508596">;</span>&nbsp;<span class="ident" id="8508598">e</span>&nbsp;<span class="op" id="8508600">!=</span>&nbsp;<span class="ident" id="8508603">g</span>&nbsp;<span class="op" id="8508605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508609">t</span><span class="op" id="8508610">.</span><span class="ident" id="8508611">Errorf</span><span class="op" id="8508617">(</span><span class="string" id="8508618">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8508647">,</span>&nbsp;<span class="ident" id="8508649">g</span><span class="op" id="8508650">,</span>&nbsp;<span class="ident" id="8508652">e</span><span class="op" id="8508653">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508656">}</span><br>
<span class="lineno"></span><span class="op" id="8508658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8508661">func</span>&nbsp;<span class="ident" id="8508666">TestRequestWithTLS</span><span class="op" id="8508684">(</span><span class="ident" id="8508685">t</span>&nbsp;<span class="op" id="8508687">*</span><span class="ident" id="8508688">testing</span><span class="op" id="8508695">.</span><span class="ident" id="8508696">T</span><span class="op" id="8508697">)</span>&nbsp;<span class="op" id="8508699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508702">env</span>&nbsp;<span class="op" id="8508706">:=</span>&nbsp;<span class="keyword" id="8508709">map</span><span class="op" id="8508712">[</span><span class="builtintype" id="8508713">string</span><span class="op" id="8508719">]</span><span class="builtintype" id="8508720">string</span><span class="op" id="8508726">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508730">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8508747">:</span>&nbsp;<span class="string" id="8508749">&#34;HTTP/1.1&#34;</span><span class="op" id="8508759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508763">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8508779">:</span>&nbsp;&nbsp;<span class="string" id="8508782">&#34;GET&#34;</span><span class="op" id="8508787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508791">&#34;HTTP_HOST&#34;</span><span class="op" id="8508802">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8508810">&#34;example.com&#34;</span><span class="op" id="8508823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508827">&#34;HTTP_REFERER&#34;</span><span class="op" id="8508841">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8508846">&#34;elsewhere&#34;</span><span class="op" id="8508857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508861">&#34;REQUEST_URI&#34;</span><span class="op" id="8508874">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8508880">&#34;/path?a=b&#34;</span><span class="op" id="8508891">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508895">&#34;CONTENT_TYPE&#34;</span><span class="op" id="8508909">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8508914">&#34;text/xml&#34;</span><span class="op" id="8508924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508928">&#34;HTTPS&#34;</span><span class="op" id="8508935">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8508947">&#34;1&#34;</span><span class="op" id="8508950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8508954">&#34;REMOTE_ADDR&#34;</span><span class="op" id="8508967">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8508973">&#34;5.6.7.8&#34;</span><span class="op" id="8508982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508988">req</span><span class="op" id="8508991">,</span>&nbsp;<span class="ident" id="8508993">err</span>&nbsp;<span class="op" id="8508997">:=</span>&nbsp;<span class="ident" id="8509000">RequestFromMap</span><span class="op" id="8509014">(</span><span class="ident" id="8509015">env</span><span class="op" id="8509018">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509021">if</span>&nbsp;<span class="ident" id="8509024">err</span>&nbsp;<span class="op" id="8509028">!=</span>&nbsp;<span class="ident" id="8509031">nil</span>&nbsp;<span class="op" id="8509035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509039">t</span><span class="op" id="8509040">.</span><span class="ident" id="8509041">Fatalf</span><span class="op" id="8509047">(</span><span class="string" id="8509048">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8509068">,</span>&nbsp;<span class="ident" id="8509070">err</span><span class="op" id="8509073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509079">if</span>&nbsp;<span class="ident" id="8509082">g</span><span class="op" id="8509083">,</span>&nbsp;<span class="ident" id="8509085">e</span>&nbsp;<span class="op" id="8509087">:=</span>&nbsp;<span class="ident" id="8509090">req</span><span class="op" id="8509093">.</span><span class="ident" id="8509094">URL</span><span class="op" id="8509097">.</span><span class="ident" id="8509098">String</span><span class="op" id="8509104">(</span><span class="op" id="8509105">)</span><span class="op" id="8509106">,</span>&nbsp;<span class="string" id="8509108">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="8509138">;</span>&nbsp;<span class="ident" id="8509140">e</span>&nbsp;<span class="op" id="8509142">!=</span>&nbsp;<span class="ident" id="8509145">g</span>&nbsp;<span class="op" id="8509147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509151">t</span><span class="op" id="8509152">.</span><span class="ident" id="8509153">Errorf</span><span class="op" id="8509159">(</span><span class="string" id="8509160">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8509185">,</span>&nbsp;<span class="ident" id="8509187">e</span><span class="op" id="8509188">,</span>&nbsp;<span class="ident" id="8509190">g</span><span class="op" id="8509191">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509197">if</span>&nbsp;<span class="ident" id="8509200">req</span><span class="op" id="8509203">.</span><span class="ident" id="8509204">TLS</span>&nbsp;<span class="op" id="8509208">==</span>&nbsp;<span class="ident" id="8509211">nil</span>&nbsp;<span class="op" id="8509215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509219">t</span><span class="op" id="8509220">.</span><span class="ident" id="8509221">Errorf</span><span class="op" id="8509227">(</span><span class="string" id="8509228">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="8509250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509253">}</span><br>
<span class="lineno"></span><span class="op" id="8509255">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8509258">func</span>&nbsp;<span class="ident" id="8509263">TestRequestWithoutHost</span><span class="op" id="8509285">(</span><span class="ident" id="8509286">t</span>&nbsp;<span class="op" id="8509288">*</span><span class="ident" id="8509289">testing</span><span class="op" id="8509296">.</span><span class="ident" id="8509297">T</span><span class="op" id="8509298">)</span>&nbsp;<span class="op" id="8509300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509303">env</span>&nbsp;<span class="op" id="8509307">:=</span>&nbsp;<span class="keyword" id="8509310">map</span><span class="op" id="8509313">[</span><span class="builtintype" id="8509314">string</span><span class="op" id="8509320">]</span><span class="builtintype" id="8509321">string</span><span class="op" id="8509327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509331">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8509348">:</span>&nbsp;<span class="string" id="8509350">&#34;HTTP/1.1&#34;</span><span class="op" id="8509360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509364">&#34;HTTP_HOST&#34;</span><span class="op" id="8509375">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8509383">&#34;&#34;</span><span class="op" id="8509385">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509389">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8509405">:</span>&nbsp;&nbsp;<span class="string" id="8509408">&#34;GET&#34;</span><span class="op" id="8509413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509417">&#34;REQUEST_URI&#34;</span><span class="op" id="8509430">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8509436">&#34;/path?a=b&#34;</span><span class="op" id="8509447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509451">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8509467">:</span>&nbsp;&nbsp;<span class="string" id="8509470">&#34;123&#34;</span><span class="op" id="8509475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509481">req</span><span class="op" id="8509484">,</span>&nbsp;<span class="ident" id="8509486">err</span>&nbsp;<span class="op" id="8509490">:=</span>&nbsp;<span class="ident" id="8509493">RequestFromMap</span><span class="op" id="8509507">(</span><span class="ident" id="8509508">env</span><span class="op" id="8509511">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509514">if</span>&nbsp;<span class="ident" id="8509517">err</span>&nbsp;<span class="op" id="8509521">!=</span>&nbsp;<span class="ident" id="8509524">nil</span>&nbsp;<span class="op" id="8509528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509532">t</span><span class="op" id="8509533">.</span><span class="ident" id="8509534">Fatalf</span><span class="op" id="8509540">(</span><span class="string" id="8509541">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8509561">,</span>&nbsp;<span class="ident" id="8509563">err</span><span class="op" id="8509566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509572">if</span>&nbsp;<span class="ident" id="8509575">req</span><span class="op" id="8509578">.</span><span class="ident" id="8509579">URL</span>&nbsp;<span class="op" id="8509583">==</span>&nbsp;<span class="ident" id="8509586">nil</span>&nbsp;<span class="op" id="8509590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509594">t</span><span class="op" id="8509595">.</span><span class="ident" id="8509596">Fatalf</span><span class="op" id="8509602">(</span><span class="string" id="8509603">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="8509623">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509629">if</span>&nbsp;<span class="ident" id="8509632">g</span><span class="op" id="8509633">,</span>&nbsp;<span class="ident" id="8509635">e</span>&nbsp;<span class="op" id="8509637">:=</span>&nbsp;<span class="ident" id="8509640">req</span><span class="op" id="8509643">.</span><span class="ident" id="8509644">URL</span><span class="op" id="8509647">.</span><span class="ident" id="8509648">String</span><span class="op" id="8509654">(</span><span class="op" id="8509655">)</span><span class="op" id="8509656">,</span>&nbsp;<span class="string" id="8509658">&#34;/path?a=b&#34;</span><span class="op" id="8509669">;</span>&nbsp;<span class="ident" id="8509671">e</span>&nbsp;<span class="op" id="8509673">!=</span>&nbsp;<span class="ident" id="8509676">g</span>&nbsp;<span class="op" id="8509678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509682">t</span><span class="op" id="8509683">.</span><span class="ident" id="8509684">Errorf</span><span class="op" id="8509690">(</span><span class="string" id="8509691">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8509710">,</span>&nbsp;<span class="ident" id="8509712">g</span><span class="op" id="8509713">,</span>&nbsp;<span class="ident" id="8509715">e</span><span class="op" id="8509716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509719">}</span><br>
<span class="lineno"></span><span class="op" id="8509721">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="8509724">func</span>&nbsp;<span class="ident" id="8509729">TestRequestWithoutRequestURI</span><span class="op" id="8509757">(</span><span class="ident" id="8509758">t</span>&nbsp;<span class="op" id="8509760">*</span><span class="ident" id="8509761">testing</span><span class="op" id="8509768">.</span><span class="ident" id="8509769">T</span><span class="op" id="8509770">)</span>&nbsp;<span class="op" id="8509772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509775">env</span>&nbsp;<span class="op" id="8509779">:=</span>&nbsp;<span class="keyword" id="8509782">map</span><span class="op" id="8509785">[</span><span class="builtintype" id="8509786">string</span><span class="op" id="8509792">]</span><span class="builtintype" id="8509793">string</span><span class="op" id="8509799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509803">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8509820">:</span>&nbsp;<span class="string" id="8509822">&#34;HTTP/1.1&#34;</span><span class="op" id="8509832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509836">&#34;HTTP_HOST&#34;</span><span class="op" id="8509847">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8509855">&#34;example.com&#34;</span><span class="op" id="8509868">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509872">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8509888">:</span>&nbsp;&nbsp;<span class="string" id="8509891">&#34;GET&#34;</span><span class="op" id="8509896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509900">&#34;SCRIPT_NAME&#34;</span><span class="op" id="8509913">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8509919">&#34;/dir/scriptname&#34;</span><span class="op" id="8509936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509940">&#34;PATH_INFO&#34;</span><span class="op" id="8509951">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8509959">&#34;/p1/p2&#34;</span><span class="op" id="8509967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8509971">&#34;QUERY_STRING&#34;</span><span class="op" id="8509985">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8509990">&#34;a=1&amp;b=2&#34;</span><span class="op" id="8509999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510003">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8510019">:</span>&nbsp;&nbsp;<span class="string" id="8510022">&#34;123&#34;</span><span class="op" id="8510027">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510033">req</span><span class="op" id="8510036">,</span>&nbsp;<span class="ident" id="8510038">err</span>&nbsp;<span class="op" id="8510042">:=</span>&nbsp;<span class="ident" id="8510045">RequestFromMap</span><span class="op" id="8510059">(</span><span class="ident" id="8510060">env</span><span class="op" id="8510063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510066">if</span>&nbsp;<span class="ident" id="8510069">err</span>&nbsp;<span class="op" id="8510073">!=</span>&nbsp;<span class="ident" id="8510076">nil</span>&nbsp;<span class="op" id="8510080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510084">t</span><span class="op" id="8510085">.</span><span class="ident" id="8510086">Fatalf</span><span class="op" id="8510092">(</span><span class="string" id="8510093">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8510113">,</span>&nbsp;<span class="ident" id="8510115">err</span><span class="op" id="8510118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510121">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510124">if</span>&nbsp;<span class="ident" id="8510127">req</span><span class="op" id="8510130">.</span><span class="ident" id="8510131">URL</span>&nbsp;<span class="op" id="8510135">==</span>&nbsp;<span class="ident" id="8510138">nil</span>&nbsp;<span class="op" id="8510142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510146">t</span><span class="op" id="8510147">.</span><span class="ident" id="8510148">Fatalf</span><span class="op" id="8510154">(</span><span class="string" id="8510155">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="8510175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510181">if</span>&nbsp;<span class="ident" id="8510184">g</span><span class="op" id="8510185">,</span>&nbsp;<span class="ident" id="8510187">e</span>&nbsp;<span class="op" id="8510189">:=</span>&nbsp;<span class="ident" id="8510192">req</span><span class="op" id="8510195">.</span><span class="ident" id="8510196">URL</span><span class="op" id="8510199">.</span><span class="ident" id="8510200">String</span><span class="op" id="8510206">(</span><span class="op" id="8510207">)</span><span class="op" id="8510208">,</span>&nbsp;<span class="string" id="8510210">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="8510259">;</span>&nbsp;<span class="ident" id="8510261">e</span>&nbsp;<span class="op" id="8510263">!=</span>&nbsp;<span class="ident" id="8510266">g</span>&nbsp;<span class="op" id="8510268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510272">t</span><span class="op" id="8510273">.</span><span class="ident" id="8510274">Errorf</span><span class="op" id="8510280">(</span><span class="string" id="8510281">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8510300">,</span>&nbsp;<span class="ident" id="8510302">g</span><span class="op" id="8510303">,</span>&nbsp;<span class="ident" id="8510305">e</span><span class="op" id="8510306">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510309">}</span><br>
<span class="lineno"></span><span class="op" id="8510311">}</span>
</div>
</body>
</html>
