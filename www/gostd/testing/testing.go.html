<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5961714">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5961769">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5961823">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5961874">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="5961948">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="5962034">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5962075">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="5962107">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="5962188">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="5962239">//</span><br>
<span class="lineno"></span><span class="comment" id="5962242">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="5962327">//</span><br>
<span class="lineno"></span><span class="comment" id="5962330">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5962404">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5962482">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5962557">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="5962633">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="5962700">//</span><br>
<span class="lineno">20</span><span class="comment" id="5962703">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5962775">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="5962808">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5962854">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5962886">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="5962940">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5962953">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5962968">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5962977">//</span><br>
<span class="lineno"></span><span class="comment" id="5962980">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="5962994">//</span><br>
<span class="lineno"></span><span class="comment" id="5962997">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5963022">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="5963059">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5963136">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="5963201">//</span><br>
<span class="lineno"></span><span class="comment" id="5963204">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5963251">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="5963314">//</span><br>
<span class="lineno"></span><span class="comment" id="5963317">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="5963365">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5963408">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5963446">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5963482">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5963495">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="5963504">//</span><br>
<span class="lineno"></span><span class="comment" id="5963507">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="5963569">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="5963650">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="5963699">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="5963746">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="5963819">//</span><br>
<span class="lineno"></span><span class="comment" id="5963822">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5963893">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="5963910">//</span><br>
<span class="lineno">55</span><span class="comment" id="5963913">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5963957">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="5963984">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="5964010">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5964048">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="5964073">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5964086">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5964095">//</span><br>
<span class="lineno"></span><span class="comment" id="5964098">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="5964176">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="5964257">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="5964283">//</span><br>
<span class="lineno"></span><span class="comment" id="5964286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5964340">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="5964419">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="5964467">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="5964503">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5964534">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="5964565">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5964613">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="5964630">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="5964644">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5964653">//</span><br>
<span class="lineno"></span><span class="comment" id="5964656">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="5964668">//</span><br>
<span class="lineno">80</span><span class="comment" id="5964671">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5964745">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5964830">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="5964909">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5964983">//</span><br>
<span class="lineno">85</span><span class="comment" id="5964986">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5965015">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5965051">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="5965083">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965092">//</span><br>
<span class="lineno">90</span><span class="comment" id="5965095">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5965130">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5965171">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5965209">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="5965235">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="5965264">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="5965290">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965299">//</span><br>
<span class="lineno"></span><span class="comment" id="5965302">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5965378">//</span><br>
<span class="lineno">100</span><span class="comment" id="5965381">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5965470">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="5965497">//</span><br>
<span class="lineno"></span><span class="comment" id="5965500">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965530">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="5965561">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965592">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965625">//</span><br>
<span class="lineno"></span><span class="comment" id="5965628">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5965712">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="5965785">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="5965807">//</span><br>
<span class="lineno"></span><span class="comment" id="5965810">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965847">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965885">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="5965923">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5965963">//</span><br>
<span class="lineno"></span><span class="comment" id="5965966">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="5966044">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="5966122">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="5966174">//</span><br>
<span class="lineno"></span><span class="comment" id="5966177">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="5966185">//</span><br>
<span class="lineno"></span><span class="comment" id="5966188">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="5966266">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="5966347">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="5966420">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="5966459">//</span><br>
<span class="lineno"></span><span class="comment" id="5966462">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="5966493">//</span><br>
<span class="lineno">130</span><span class="comment" id="5966496">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="5966574">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="5966649">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="5966722">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="5966759">//</span><br>
<span class="lineno">135</span><span class="comment" id="5966762">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="5966808">//</span><br>
<span class="lineno"></span><span class="comment" id="5966811">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5966863">//</span><br>
<span class="lineno"></span><span class="comment" id="5966866">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="5966952">package</span>&nbsp;<span class="ident" id="5966960">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5966969">import</span>&nbsp;<span class="op" id="5966976">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966979">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966988">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966996">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967003">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967009">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967020">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967037">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967048">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967059">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967067">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5967074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="5967077">var</span>&nbsp;<span class="op" id="5967081">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967084">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967163">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967240">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967318">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967395">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967425">short</span>&nbsp;<span class="op" id="5967431">=</span>&nbsp;<span class="ident" id="5967433">flag</span><span class="op" id="5967437">.</span><span class="ident" id="5967438">Bool</span><span class="op" id="5967442">(</span><span class="string" id="5967443">&#34;test.short&#34;</span><span class="op" id="5967455">,</span>&nbsp;<span class="builtintype" id="5967457">false</span><span class="op" id="5967462">,</span>&nbsp;<span class="string" id="5967464">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="5967501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967505">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967584">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967663">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967750">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967784">outputDir</span>&nbsp;<span class="op" id="5967794">=</span>&nbsp;<span class="ident" id="5967796">flag</span><span class="op" id="5967800">.</span><span class="ident" id="5967801">String</span><span class="op" id="5967807">(</span><span class="string" id="5967808">&#34;test.outputdir&#34;</span><span class="op" id="5967824">,</span>&nbsp;<span class="string" id="5967826">&#34;&#34;</span><span class="op" id="5967828">,</span>&nbsp;<span class="string" id="5967830">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="5967868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967872">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967932">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967949">=</span>&nbsp;<span class="ident" id="5967951">flag</span><span class="op" id="5967955">.</span><span class="ident" id="5967956">Bool</span><span class="op" id="5967960">(</span><span class="string" id="5967961">&#34;test.v&#34;</span><span class="op" id="5967969">,</span>&nbsp;<span class="builtintype" id="5967971">false</span><span class="op" id="5967976">,</span>&nbsp;<span class="string" id="5967978">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="5968012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968015">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968032">=</span>&nbsp;<span class="ident" id="5968034">flag</span><span class="op" id="5968038">.</span><span class="ident" id="5968039">String</span><span class="op" id="5968045">(</span><span class="string" id="5968046">&#34;test.coverprofile&#34;</span><span class="op" id="5968065">,</span>&nbsp;<span class="string" id="5968067">&#34;&#34;</span><span class="op" id="5968069">,</span>&nbsp;<span class="string" id="5968071">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5968131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968134">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968151">=</span>&nbsp;<span class="ident" id="5968153">flag</span><span class="op" id="5968157">.</span><span class="ident" id="5968158">String</span><span class="op" id="5968164">(</span><span class="string" id="5968165">&#34;test.run&#34;</span><span class="op" id="5968175">,</span>&nbsp;<span class="string" id="5968177">&#34;&#34;</span><span class="op" id="5968179">,</span>&nbsp;<span class="string" id="5968181">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="5968237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968240">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968257">=</span>&nbsp;<span class="ident" id="5968259">flag</span><span class="op" id="5968263">.</span><span class="ident" id="5968264">String</span><span class="op" id="5968270">(</span><span class="string" id="5968271">&#34;test.memprofile&#34;</span><span class="op" id="5968288">,</span>&nbsp;<span class="string" id="5968290">&#34;&#34;</span><span class="op" id="5968292">,</span>&nbsp;<span class="string" id="5968294">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5968352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968355">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5968372">=</span>&nbsp;<span class="ident" id="5968374">flag</span><span class="op" id="5968378">.</span><span class="ident" id="5968379">Int</span><span class="op" id="5968382">(</span><span class="string" id="5968383">&#34;test.memprofilerate&#34;</span><span class="op" id="5968404">,</span>&nbsp;<span class="num" id="5968406">0</span><span class="op" id="5968407">,</span>&nbsp;<span class="string" id="5968409">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="5968446">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968449">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968466">=</span>&nbsp;<span class="ident" id="5968468">flag</span><span class="op" id="5968472">.</span><span class="ident" id="5968473">String</span><span class="op" id="5968479">(</span><span class="string" id="5968480">&#34;test.cpuprofile&#34;</span><span class="op" id="5968497">,</span>&nbsp;<span class="string" id="5968499">&#34;&#34;</span><span class="op" id="5968501">,</span>&nbsp;<span class="string" id="5968503">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="5968559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968562">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968579">=</span>&nbsp;<span class="ident" id="5968581">flag</span><span class="op" id="5968585">.</span><span class="ident" id="5968586">String</span><span class="op" id="5968592">(</span><span class="string" id="5968593">&#34;test.blockprofile&#34;</span><span class="op" id="5968612">,</span>&nbsp;<span class="string" id="5968614">&#34;&#34;</span><span class="op" id="5968616">,</span>&nbsp;<span class="string" id="5968618">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5968688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968691">blockProfileRate</span>&nbsp;<span class="op" id="5968708">=</span>&nbsp;<span class="ident" id="5968710">flag</span><span class="op" id="5968714">.</span><span class="ident" id="5968715">Int</span><span class="op" id="5968718">(</span><span class="string" id="5968719">&#34;test.blockprofilerate&#34;</span><span class="op" id="5968742">,</span>&nbsp;<span class="num" id="5968744">1</span><span class="op" id="5968745">,</span>&nbsp;<span class="string" id="5968747">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="5968793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968796">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968813">=</span>&nbsp;<span class="ident" id="5968815">flag</span><span class="op" id="5968819">.</span><span class="ident" id="5968820">Duration</span><span class="op" id="5968828">(</span><span class="string" id="5968829">&#34;test.timeout&#34;</span><span class="op" id="5968843">,</span>&nbsp;<span class="num" id="5968845">0</span><span class="op" id="5968846">,</span>&nbsp;<span class="string" id="5968848">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="5968905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968908">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968925">=</span>&nbsp;<span class="ident" id="5968927">flag</span><span class="op" id="5968931">.</span><span class="ident" id="5968932">String</span><span class="op" id="5968938">(</span><span class="string" id="5968939">&#34;test.cpu&#34;</span><span class="op" id="5968949">,</span>&nbsp;<span class="string" id="5968951">&#34;&#34;</span><span class="op" id="5968953">,</span>&nbsp;<span class="string" id="5968955">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="5969016">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969019">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5969036">=</span>&nbsp;<span class="ident" id="5969038">flag</span><span class="op" id="5969042">.</span><span class="ident" id="5969043">Int</span><span class="op" id="5969046">(</span><span class="string" id="5969047">&#34;test.parallel&#34;</span><span class="op" id="5969062">,</span>&nbsp;<span class="ident" id="5969064">runtime</span><span class="op" id="5969071">.</span><span class="ident" id="5969072">GOMAXPROCS</span><span class="op" id="5969082">(</span><span class="num" id="5969083">0</span><span class="op" id="5969084">)</span><span class="op" id="5969085">,</span>&nbsp;<span class="string" id="5969087">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="5969113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969117">haveExamples</span>&nbsp;<span class="builtintype" id="5969130">bool</span>&nbsp;<span class="comment" id="5969135">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969160">cpuList</span>&nbsp;<span class="op" id="5969168">[</span><span class="op" id="5969169">]</span><span class="builtintype" id="5969170">int</span><br>
<span class="lineno">185</span><span class="op" id="5969174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5969177">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5969233">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="5969276">type</span>&nbsp;<span class="ident" id="5969281">common</span>&nbsp;<span class="keyword" id="5969288">struct</span>&nbsp;<span class="op" id="5969295">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969298">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969307">sync</span><span class="op" id="5969311">.</span><span class="ident" id="5969312">RWMutex</span>&nbsp;<span class="comment" id="5969320">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969349">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5969358">[</span><span class="op" id="5969359">]</span><span class="builtintype" id="5969360">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969371">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969414">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5969423">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969436">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969470">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="5969479">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969492">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969532">finished</span>&nbsp;<span class="builtintype" id="5969541">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969548">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969557">time</span><span class="op" id="5969561">.</span><span class="ident" id="5969562">Time</span>&nbsp;<span class="comment" id="5969567">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969602">duration</span>&nbsp;<span class="ident" id="5969611">time</span><span class="op" id="5969615">.</span><span class="ident" id="5969616">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969626">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969635">interface</span><span class="op" id="5969644">{</span><span class="op" id="5969645">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969652">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969696">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969705">chan</span>&nbsp;<span class="keyword" id="5969710">interface</span><span class="op" id="5969719">{</span><span class="op" id="5969720">}</span>&nbsp;<span class="comment" id="5969722">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="5969750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5969753">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5969807">func</span>&nbsp;<span class="ident" id="5969812">Short</span><span class="op" id="5969817">(</span><span class="op" id="5969818">)</span>&nbsp;<span class="builtintype" id="5969820">bool</span>&nbsp;<span class="op" id="5969825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969828">return</span>&nbsp;<span class="op" id="5969835">*</span><span class="ident" id="5969836">short</span><br>
<span class="lineno">205</span><span class="op" id="5969842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5969845">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5969897">func</span>&nbsp;<span class="ident" id="5969902">Verbose</span><span class="op" id="5969909">(</span><span class="op" id="5969910">)</span>&nbsp;<span class="builtintype" id="5969912">bool</span>&nbsp;<span class="op" id="5969917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969920">return</span>&nbsp;<span class="op" id="5969927">*</span><span class="ident" id="5969928">chatty</span><br>
<span class="lineno">210</span><span class="op" id="5969935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5969938">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="5970010">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="5970090">func</span>&nbsp;<span class="ident" id="5970095">decorate</span><span class="op" id="5970103">(</span><span class="ident" id="5970104">s</span>&nbsp;<span class="builtintype" id="5970106">string</span><span class="op" id="5970112">)</span>&nbsp;<span class="builtintype" id="5970114">string</span>&nbsp;<span class="op" id="5970121">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970124">_</span><span class="op" id="5970125">,</span>&nbsp;<span class="ident" id="5970127">file</span><span class="op" id="5970131">,</span>&nbsp;<span class="ident" id="5970133">line</span><span class="op" id="5970137">,</span>&nbsp;<span class="ident" id="5970139">ok</span>&nbsp;<span class="op" id="5970142">:=</span>&nbsp;<span class="ident" id="5970145">runtime</span><span class="op" id="5970152">.</span><span class="ident" id="5970153">Caller</span><span class="op" id="5970159">(</span><span class="num" id="5970160">3</span><span class="op" id="5970161">)</span>&nbsp;<span class="comment" id="5970163">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970201">if</span>&nbsp;<span class="ident" id="5970204">ok</span>&nbsp;<span class="op" id="5970207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970211">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970264">if</span>&nbsp;<span class="ident" id="5970267">index</span>&nbsp;<span class="op" id="5970273">:=</span>&nbsp;<span class="ident" id="5970276">strings</span><span class="op" id="5970283">.</span><span class="ident" id="5970284">LastIndex</span><span class="op" id="5970293">(</span><span class="ident" id="5970294">file</span><span class="op" id="5970298">,</span>&nbsp;<span class="string" id="5970300">&#34;/&#34;</span><span class="op" id="5970303">)</span><span class="op" id="5970304">;</span>&nbsp;<span class="ident" id="5970306">index</span>&nbsp;<span class="op" id="5970312">&gt;=</span>&nbsp;<span class="num" id="5970315">0</span>&nbsp;<span class="op" id="5970317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970322">file</span>&nbsp;<span class="op" id="5970327">=</span>&nbsp;<span class="ident" id="5970329">file</span><span class="op" id="5970333">[</span><span class="ident" id="5970334">index</span><span class="op" id="5970339">+</span><span class="num" id="5970340">1</span><span class="op" id="5970341">:</span><span class="op" id="5970342">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970346">}</span>&nbsp;<span class="keyword" id="5970348">else</span>&nbsp;<span class="keyword" id="5970353">if</span>&nbsp;<span class="ident" id="5970356">index</span>&nbsp;<span class="op" id="5970362">=</span>&nbsp;<span class="ident" id="5970364">strings</span><span class="op" id="5970371">.</span><span class="ident" id="5970372">LastIndex</span><span class="op" id="5970381">(</span><span class="ident" id="5970382">file</span><span class="op" id="5970386">,</span>&nbsp;<span class="string" id="5970388">&#34;\\&#34;</span><span class="op" id="5970392">)</span><span class="op" id="5970393">;</span>&nbsp;<span class="ident" id="5970395">index</span>&nbsp;<span class="op" id="5970401">&gt;=</span>&nbsp;<span class="num" id="5970404">0</span>&nbsp;<span class="op" id="5970406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970411">file</span>&nbsp;<span class="op" id="5970416">=</span>&nbsp;<span class="ident" id="5970418">file</span><span class="op" id="5970422">[</span><span class="ident" id="5970423">index</span><span class="op" id="5970428">+</span><span class="num" id="5970429">1</span><span class="op" id="5970430">:</span><span class="op" id="5970431">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970438">}</span>&nbsp;<span class="keyword" id="5970440">else</span>&nbsp;<span class="op" id="5970445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970449">file</span>&nbsp;<span class="op" id="5970454">=</span>&nbsp;<span class="string" id="5970456">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970464">line</span>&nbsp;<span class="op" id="5970469">=</span>&nbsp;<span class="num" id="5970471">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970477">buf</span>&nbsp;<span class="op" id="5970481">:=</span>&nbsp;<span class="builtinfunc" id="5970484">new</span><span class="op" id="5970487">(</span><span class="ident" id="5970488">bytes</span><span class="op" id="5970493">.</span><span class="ident" id="5970494">Buffer</span><span class="op" id="5970500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970503">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970548">buf</span><span class="op" id="5970551">.</span><span class="ident" id="5970552">WriteByte</span><span class="op" id="5970561">(</span><span class="string" id="5970562">&#39;\t&#39;</span><span class="op" id="5970566">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970569">fmt</span><span class="op" id="5970572">.</span><span class="ident" id="5970573">Fprintf</span><span class="op" id="5970580">(</span><span class="ident" id="5970581">buf</span><span class="op" id="5970584">,</span>&nbsp;<span class="string" id="5970586">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="5970595">,</span>&nbsp;<span class="ident" id="5970597">file</span><span class="op" id="5970601">,</span>&nbsp;<span class="ident" id="5970603">line</span><span class="op" id="5970607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970610">lines</span>&nbsp;<span class="op" id="5970616">:=</span>&nbsp;<span class="ident" id="5970619">strings</span><span class="op" id="5970626">.</span><span class="ident" id="5970627">Split</span><span class="op" id="5970632">(</span><span class="ident" id="5970633">s</span><span class="op" id="5970634">,</span>&nbsp;<span class="string" id="5970636">&#34;\n&#34;</span><span class="op" id="5970640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970643">if</span>&nbsp;<span class="ident" id="5970646">l</span>&nbsp;<span class="op" id="5970648">:=</span>&nbsp;<span class="builtinfunc" id="5970651">len</span><span class="op" id="5970654">(</span><span class="ident" id="5970655">lines</span><span class="op" id="5970660">)</span><span class="op" id="5970661">;</span>&nbsp;<span class="ident" id="5970663">l</span>&nbsp;<span class="op" id="5970665">&gt;</span>&nbsp;<span class="num" id="5970667">1</span>&nbsp;<span class="op" id="5970669">&amp;&amp;</span>&nbsp;<span class="ident" id="5970672">lines</span><span class="op" id="5970677">[</span><span class="ident" id="5970678">l</span><span class="op" id="5970679">-</span><span class="num" id="5970680">1</span><span class="op" id="5970681">]</span>&nbsp;<span class="op" id="5970683">==</span>&nbsp;<span class="string" id="5970686">&#34;&#34;</span>&nbsp;<span class="op" id="5970689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970693">lines</span>&nbsp;<span class="op" id="5970699">=</span>&nbsp;<span class="ident" id="5970701">lines</span><span class="op" id="5970706">[</span><span class="op" id="5970707">:</span><span class="ident" id="5970708">l</span><span class="op" id="5970709">-</span><span class="num" id="5970710">1</span><span class="op" id="5970711">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970714">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970717">for</span>&nbsp;<span class="ident" id="5970721">i</span><span class="op" id="5970722">,</span>&nbsp;<span class="ident" id="5970724">line</span>&nbsp;<span class="op" id="5970729">:=</span>&nbsp;<span class="keyword" id="5970732">range</span>&nbsp;<span class="ident" id="5970738">lines</span>&nbsp;<span class="op" id="5970744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970748">if</span>&nbsp;<span class="ident" id="5970751">i</span>&nbsp;<span class="op" id="5970753">&gt;</span>&nbsp;<span class="num" id="5970755">0</span>&nbsp;<span class="op" id="5970757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970762">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970823">buf</span><span class="op" id="5970826">.</span><span class="ident" id="5970827">WriteString</span><span class="op" id="5970838">(</span><span class="string" id="5970839">&#34;\n\t\t&#34;</span><span class="op" id="5970847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970851">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970855">buf</span><span class="op" id="5970858">.</span><span class="ident" id="5970859">WriteString</span><span class="op" id="5970870">(</span><span class="ident" id="5970871">line</span><span class="op" id="5970875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970881">buf</span><span class="op" id="5970884">.</span><span class="ident" id="5970885">WriteByte</span><span class="op" id="5970894">(</span><span class="string" id="5970895">&#39;\n&#39;</span><span class="op" id="5970899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970902">return</span>&nbsp;<span class="ident" id="5970909">buf</span><span class="op" id="5970912">.</span><span class="ident" id="5970913">String</span><span class="op" id="5970919">(</span><span class="op" id="5970920">)</span><br>
<span class="lineno"></span><span class="op" id="5970922">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="5970925">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5970994">func</span>&nbsp;<span class="ident" id="5970999">fmtDuration</span><span class="op" id="5971010">(</span><span class="ident" id="5971011">d</span>&nbsp;<span class="ident" id="5971013">time</span><span class="op" id="5971017">.</span><span class="ident" id="5971018">Duration</span><span class="op" id="5971026">)</span>&nbsp;<span class="builtintype" id="5971028">string</span>&nbsp;<span class="op" id="5971035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971038">return</span>&nbsp;<span class="ident" id="5971045">fmt</span><span class="op" id="5971048">.</span><span class="ident" id="5971049">Sprintf</span><span class="op" id="5971056">(</span><span class="string" id="5971057">&#34;%.2fs&#34;</span><span class="op" id="5971064">,</span>&nbsp;<span class="ident" id="5971066">d</span><span class="op" id="5971067">.</span><span class="ident" id="5971068">Seconds</span><span class="op" id="5971075">(</span><span class="op" id="5971076">)</span><span class="op" id="5971077">)</span><br>
<span class="lineno"></span><span class="op" id="5971079">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="5971082">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="5971124">type</span>&nbsp;<span class="ident" id="5971129">TB</span>&nbsp;<span class="keyword" id="5971132">interface</span>&nbsp;<span class="op" id="5971142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971145">Error</span><span class="op" id="5971150">(</span><span class="ident" id="5971151">args</span>&nbsp;<span class="op" id="5971156">...</span><span class="keyword" id="5971159">interface</span><span class="op" id="5971168">{</span><span class="op" id="5971169">}</span><span class="op" id="5971170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971173">Errorf</span><span class="op" id="5971179">(</span><span class="ident" id="5971180">format</span>&nbsp;<span class="builtintype" id="5971187">string</span><span class="op" id="5971193">,</span>&nbsp;<span class="ident" id="5971195">args</span>&nbsp;<span class="op" id="5971200">...</span><span class="keyword" id="5971203">interface</span><span class="op" id="5971212">{</span><span class="op" id="5971213">}</span><span class="op" id="5971214">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971217">Fail</span><span class="op" id="5971221">(</span><span class="op" id="5971222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971225">FailNow</span><span class="op" id="5971232">(</span><span class="op" id="5971233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971236">Failed</span><span class="op" id="5971242">(</span><span class="op" id="5971243">)</span>&nbsp;<span class="builtintype" id="5971245">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971251">Fatal</span><span class="op" id="5971256">(</span><span class="ident" id="5971257">args</span>&nbsp;<span class="op" id="5971262">...</span><span class="keyword" id="5971265">interface</span><span class="op" id="5971274">{</span><span class="op" id="5971275">}</span><span class="op" id="5971276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971279">Fatalf</span><span class="op" id="5971285">(</span><span class="ident" id="5971286">format</span>&nbsp;<span class="builtintype" id="5971293">string</span><span class="op" id="5971299">,</span>&nbsp;<span class="ident" id="5971301">args</span>&nbsp;<span class="op" id="5971306">...</span><span class="keyword" id="5971309">interface</span><span class="op" id="5971318">{</span><span class="op" id="5971319">}</span><span class="op" id="5971320">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971323">Log</span><span class="op" id="5971326">(</span><span class="ident" id="5971327">args</span>&nbsp;<span class="op" id="5971332">...</span><span class="keyword" id="5971335">interface</span><span class="op" id="5971344">{</span><span class="op" id="5971345">}</span><span class="op" id="5971346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971349">Logf</span><span class="op" id="5971353">(</span><span class="ident" id="5971354">format</span>&nbsp;<span class="builtintype" id="5971361">string</span><span class="op" id="5971367">,</span>&nbsp;<span class="ident" id="5971369">args</span>&nbsp;<span class="op" id="5971374">...</span><span class="keyword" id="5971377">interface</span><span class="op" id="5971386">{</span><span class="op" id="5971387">}</span><span class="op" id="5971388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971391">Skip</span><span class="op" id="5971395">(</span><span class="ident" id="5971396">args</span>&nbsp;<span class="op" id="5971401">...</span><span class="keyword" id="5971404">interface</span><span class="op" id="5971413">{</span><span class="op" id="5971414">}</span><span class="op" id="5971415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971418">SkipNow</span><span class="op" id="5971425">(</span><span class="op" id="5971426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971429">Skipf</span><span class="op" id="5971434">(</span><span class="ident" id="5971435">format</span>&nbsp;<span class="builtintype" id="5971442">string</span><span class="op" id="5971448">,</span>&nbsp;<span class="ident" id="5971450">args</span>&nbsp;<span class="op" id="5971455">...</span><span class="keyword" id="5971458">interface</span><span class="op" id="5971467">{</span><span class="op" id="5971468">}</span><span class="op" id="5971469">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971472">Skipped</span><span class="op" id="5971479">(</span><span class="op" id="5971480">)</span>&nbsp;<span class="builtintype" id="5971482">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971489">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971544">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971597">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971629">private</span><span class="op" id="5971636">(</span><span class="op" id="5971637">)</span><br>
<span class="lineno"></span><span class="op" id="5971639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5971642">var</span>&nbsp;<span class="ident" id="5971646">_</span>&nbsp;<span class="ident" id="5971648">TB</span>&nbsp;<span class="op" id="5971651">=</span>&nbsp;<span class="op" id="5971653">(</span><span class="op" id="5971654">*</span><span class="ident" id="5971655">T</span><span class="op" id="5971656">)</span><span class="op" id="5971657">(</span><span class="ident" id="5971658">nil</span><span class="op" id="5971661">)</span><br>
<span class="lineno"></span><span class="keyword" id="5971663">var</span>&nbsp;<span class="ident" id="5971667">_</span>&nbsp;<span class="ident" id="5971669">TB</span>&nbsp;<span class="op" id="5971672">=</span>&nbsp;<span class="op" id="5971674">(</span><span class="op" id="5971675">*</span><span class="ident" id="5971676">B</span><span class="op" id="5971677">)</span><span class="op" id="5971678">(</span><span class="ident" id="5971679">nil</span><span class="op" id="5971682">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5971685">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="5971779">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="5971860">type</span>&nbsp;<span class="ident" id="5971865">T</span>&nbsp;<span class="keyword" id="5971867">struct</span>&nbsp;<span class="op" id="5971874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971877">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971885">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5971899">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971909">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971927">startParallel</span>&nbsp;<span class="keyword" id="5971941">chan</span>&nbsp;<span class="builtintype" id="5971946">bool</span>&nbsp;<span class="comment" id="5971951">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="5971988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5971991">func</span>&nbsp;<span class="op" id="5971996">(</span><span class="ident" id="5971997">c</span>&nbsp;<span class="op" id="5971999">*</span><span class="ident" id="5972000">common</span><span class="op" id="5972006">)</span>&nbsp;<span class="ident" id="5972008">private</span><span class="op" id="5972015">(</span><span class="op" id="5972016">)</span>&nbsp;<span class="op" id="5972018">{</span><span class="op" id="5972019">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="5972022">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="5972091">func</span>&nbsp;<span class="op" id="5972096">(</span><span class="ident" id="5972097">c</span>&nbsp;<span class="op" id="5972099">*</span><span class="ident" id="5972100">common</span><span class="op" id="5972106">)</span>&nbsp;<span class="ident" id="5972108">Fail</span><span class="op" id="5972112">(</span><span class="op" id="5972113">)</span>&nbsp;<span class="op" id="5972115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972118">c</span><span class="op" id="5972119">.</span><span class="ident" id="5972120">mu</span><span class="op" id="5972122">.</span><span class="ident" id="5972123">Lock</span><span class="op" id="5972127">(</span><span class="op" id="5972128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972131">defer</span>&nbsp;<span class="ident" id="5972137">c</span><span class="op" id="5972138">.</span><span class="ident" id="5972139">mu</span><span class="op" id="5972141">.</span><span class="ident" id="5972142">Unlock</span><span class="op" id="5972148">(</span><span class="op" id="5972149">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972152">c</span><span class="op" id="5972153">.</span><span class="ident" id="5972154">failed</span>&nbsp;<span class="op" id="5972161">=</span>&nbsp;<span class="builtintype" id="5972163">true</span><br>
<span class="lineno"></span><span class="op" id="5972168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5972171">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="5972222">func</span>&nbsp;<span class="op" id="5972227">(</span><span class="ident" id="5972228">c</span>&nbsp;<span class="op" id="5972230">*</span><span class="ident" id="5972231">common</span><span class="op" id="5972237">)</span>&nbsp;<span class="ident" id="5972239">Failed</span><span class="op" id="5972245">(</span><span class="op" id="5972246">)</span>&nbsp;<span class="builtintype" id="5972248">bool</span>&nbsp;<span class="op" id="5972253">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972256">c</span><span class="op" id="5972257">.</span><span class="ident" id="5972258">mu</span><span class="op" id="5972260">.</span><span class="ident" id="5972261">RLock</span><span class="op" id="5972266">(</span><span class="op" id="5972267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972270">defer</span>&nbsp;<span class="ident" id="5972276">c</span><span class="op" id="5972277">.</span><span class="ident" id="5972278">mu</span><span class="op" id="5972280">.</span><span class="ident" id="5972281">RUnlock</span><span class="op" id="5972288">(</span><span class="op" id="5972289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972292">return</span>&nbsp;<span class="ident" id="5972299">c</span><span class="op" id="5972300">.</span><span class="ident" id="5972301">failed</span><br>
<span class="lineno"></span><span class="op" id="5972308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5972311">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5972383">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="5972441">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5972498">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="5972555">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="5972613">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5972640">func</span>&nbsp;<span class="op" id="5972645">(</span><span class="ident" id="5972646">c</span>&nbsp;<span class="op" id="5972648">*</span><span class="ident" id="5972649">common</span><span class="op" id="5972655">)</span>&nbsp;<span class="ident" id="5972657">FailNow</span><span class="op" id="5972664">(</span><span class="op" id="5972665">)</span>&nbsp;<span class="op" id="5972667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972670">c</span><span class="op" id="5972671">.</span><span class="ident" id="5972672">Fail</span><span class="op" id="5972676">(</span><span class="op" id="5972677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972681">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972739">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972794">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972855">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972918">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972922">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972964">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972968">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972989">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973012">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973033">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973037">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973099">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973161">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973223">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973292">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973361">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973433">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973497">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973561">c</span><span class="op" id="5973562">.</span><span class="ident" id="5973563">finished</span>&nbsp;<span class="op" id="5973572">=</span>&nbsp;<span class="builtintype" id="5973574">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973580">runtime</span><span class="op" id="5973587">.</span><span class="ident" id="5973588">Goexit</span><span class="op" id="5973594">(</span><span class="op" id="5973595">)</span><br>
<span class="lineno">330</span><span class="op" id="5973597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5973600">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5973666">func</span>&nbsp;<span class="op" id="5973671">(</span><span class="ident" id="5973672">c</span>&nbsp;<span class="op" id="5973674">*</span><span class="ident" id="5973675">common</span><span class="op" id="5973681">)</span>&nbsp;<span class="ident" id="5973683">log</span><span class="op" id="5973686">(</span><span class="ident" id="5973687">s</span>&nbsp;<span class="builtintype" id="5973689">string</span><span class="op" id="5973695">)</span>&nbsp;<span class="op" id="5973697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973700">c</span><span class="op" id="5973701">.</span><span class="ident" id="5973702">mu</span><span class="op" id="5973704">.</span><span class="ident" id="5973705">Lock</span><span class="op" id="5973709">(</span><span class="op" id="5973710">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973713">defer</span>&nbsp;<span class="ident" id="5973719">c</span><span class="op" id="5973720">.</span><span class="ident" id="5973721">mu</span><span class="op" id="5973723">.</span><span class="ident" id="5973724">Unlock</span><span class="op" id="5973730">(</span><span class="op" id="5973731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973734">c</span><span class="op" id="5973735">.</span><span class="ident" id="5973736">output</span>&nbsp;<span class="op" id="5973743">=</span>&nbsp;<span class="builtinfunc" id="5973745">append</span><span class="op" id="5973751">(</span><span class="ident" id="5973752">c</span><span class="op" id="5973753">.</span><span class="ident" id="5973754">output</span><span class="op" id="5973760">,</span>&nbsp;<span class="ident" id="5973762">decorate</span><span class="op" id="5973770">(</span><span class="ident" id="5973771">s</span><span class="op" id="5973772">)</span><span class="op" id="5973773">...</span><span class="op" id="5973776">)</span><br>
<span class="lineno"></span><span class="op" id="5973778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5973781">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="5973858">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5973933">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5973979">func</span>&nbsp;<span class="op" id="5973984">(</span><span class="ident" id="5973985">c</span>&nbsp;<span class="op" id="5973987">*</span><span class="ident" id="5973988">common</span><span class="op" id="5973994">)</span>&nbsp;<span class="ident" id="5973996">Log</span><span class="op" id="5973999">(</span><span class="ident" id="5974000">args</span>&nbsp;<span class="op" id="5974005">...</span><span class="keyword" id="5974008">interface</span><span class="op" id="5974017">{</span><span class="op" id="5974018">}</span><span class="op" id="5974019">)</span>&nbsp;<span class="op" id="5974021">{</span>&nbsp;<span class="ident" id="5974023">c</span><span class="op" id="5974024">.</span><span class="ident" id="5974025">log</span><span class="op" id="5974028">(</span><span class="ident" id="5974029">fmt</span><span class="op" id="5974032">.</span><span class="ident" id="5974033">Sprintln</span><span class="op" id="5974041">(</span><span class="ident" id="5974042">args</span><span class="op" id="5974046">...</span><span class="op" id="5974049">)</span><span class="op" id="5974050">)</span>&nbsp;<span class="op" id="5974052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5974055">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="5974131">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5974206">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5974252">func</span>&nbsp;<span class="op" id="5974257">(</span><span class="ident" id="5974258">c</span>&nbsp;<span class="op" id="5974260">*</span><span class="ident" id="5974261">common</span><span class="op" id="5974267">)</span>&nbsp;<span class="ident" id="5974269">Logf</span><span class="op" id="5974273">(</span><span class="ident" id="5974274">format</span>&nbsp;<span class="builtintype" id="5974281">string</span><span class="op" id="5974287">,</span>&nbsp;<span class="ident" id="5974289">args</span>&nbsp;<span class="op" id="5974294">...</span><span class="keyword" id="5974297">interface</span><span class="op" id="5974306">{</span><span class="op" id="5974307">}</span><span class="op" id="5974308">)</span>&nbsp;<span class="op" id="5974310">{</span>&nbsp;<span class="ident" id="5974312">c</span><span class="op" id="5974313">.</span><span class="ident" id="5974314">log</span><span class="op" id="5974317">(</span><span class="ident" id="5974318">fmt</span><span class="op" id="5974321">.</span><span class="ident" id="5974322">Sprintf</span><span class="op" id="5974329">(</span><span class="ident" id="5974330">format</span><span class="op" id="5974336">,</span>&nbsp;<span class="ident" id="5974338">args</span><span class="op" id="5974342">...</span><span class="op" id="5974345">)</span><span class="op" id="5974346">)</span>&nbsp;<span class="op" id="5974348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5974351">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="5974399">func</span>&nbsp;<span class="op" id="5974404">(</span><span class="ident" id="5974405">c</span>&nbsp;<span class="op" id="5974407">*</span><span class="ident" id="5974408">common</span><span class="op" id="5974414">)</span>&nbsp;<span class="ident" id="5974416">Error</span><span class="op" id="5974421">(</span><span class="ident" id="5974422">args</span>&nbsp;<span class="op" id="5974427">...</span><span class="keyword" id="5974430">interface</span><span class="op" id="5974439">{</span><span class="op" id="5974440">}</span><span class="op" id="5974441">)</span>&nbsp;<span class="op" id="5974443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974446">c</span><span class="op" id="5974447">.</span><span class="ident" id="5974448">log</span><span class="op" id="5974451">(</span><span class="ident" id="5974452">fmt</span><span class="op" id="5974455">.</span><span class="ident" id="5974456">Sprintln</span><span class="op" id="5974464">(</span><span class="ident" id="5974465">args</span><span class="op" id="5974469">...</span><span class="op" id="5974472">)</span><span class="op" id="5974473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974476">c</span><span class="op" id="5974477">.</span><span class="ident" id="5974478">Fail</span><span class="op" id="5974482">(</span><span class="op" id="5974483">)</span><br>
<span class="lineno"></span><span class="op" id="5974485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5974488">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="5974538">func</span>&nbsp;<span class="op" id="5974543">(</span><span class="ident" id="5974544">c</span>&nbsp;<span class="op" id="5974546">*</span><span class="ident" id="5974547">common</span><span class="op" id="5974553">)</span>&nbsp;<span class="ident" id="5974555">Errorf</span><span class="op" id="5974561">(</span><span class="ident" id="5974562">format</span>&nbsp;<span class="builtintype" id="5974569">string</span><span class="op" id="5974575">,</span>&nbsp;<span class="ident" id="5974577">args</span>&nbsp;<span class="op" id="5974582">...</span><span class="keyword" id="5974585">interface</span><span class="op" id="5974594">{</span><span class="op" id="5974595">}</span><span class="op" id="5974596">)</span>&nbsp;<span class="op" id="5974598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974601">c</span><span class="op" id="5974602">.</span><span class="ident" id="5974603">log</span><span class="op" id="5974606">(</span><span class="ident" id="5974607">fmt</span><span class="op" id="5974610">.</span><span class="ident" id="5974611">Sprintf</span><span class="op" id="5974618">(</span><span class="ident" id="5974619">format</span><span class="op" id="5974625">,</span>&nbsp;<span class="ident" id="5974627">args</span><span class="op" id="5974631">...</span><span class="op" id="5974634">)</span><span class="op" id="5974635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974638">c</span><span class="op" id="5974639">.</span><span class="ident" id="5974640">Fail</span><span class="op" id="5974644">(</span><span class="op" id="5974645">)</span><br>
<span class="lineno"></span><span class="op" id="5974647">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5974650">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5974701">func</span>&nbsp;<span class="op" id="5974706">(</span><span class="ident" id="5974707">c</span>&nbsp;<span class="op" id="5974709">*</span><span class="ident" id="5974710">common</span><span class="op" id="5974716">)</span>&nbsp;<span class="ident" id="5974718">Fatal</span><span class="op" id="5974723">(</span><span class="ident" id="5974724">args</span>&nbsp;<span class="op" id="5974729">...</span><span class="keyword" id="5974732">interface</span><span class="op" id="5974741">{</span><span class="op" id="5974742">}</span><span class="op" id="5974743">)</span>&nbsp;<span class="op" id="5974745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974748">c</span><span class="op" id="5974749">.</span><span class="ident" id="5974750">log</span><span class="op" id="5974753">(</span><span class="ident" id="5974754">fmt</span><span class="op" id="5974757">.</span><span class="ident" id="5974758">Sprintln</span><span class="op" id="5974766">(</span><span class="ident" id="5974767">args</span><span class="op" id="5974771">...</span><span class="op" id="5974774">)</span><span class="op" id="5974775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974778">c</span><span class="op" id="5974779">.</span><span class="ident" id="5974780">FailNow</span><span class="op" id="5974787">(</span><span class="op" id="5974788">)</span><br>
<span class="lineno">365</span><span class="op" id="5974790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5974793">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5974846">func</span>&nbsp;<span class="op" id="5974851">(</span><span class="ident" id="5974852">c</span>&nbsp;<span class="op" id="5974854">*</span><span class="ident" id="5974855">common</span><span class="op" id="5974861">)</span>&nbsp;<span class="ident" id="5974863">Fatalf</span><span class="op" id="5974869">(</span><span class="ident" id="5974870">format</span>&nbsp;<span class="builtintype" id="5974877">string</span><span class="op" id="5974883">,</span>&nbsp;<span class="ident" id="5974885">args</span>&nbsp;<span class="op" id="5974890">...</span><span class="keyword" id="5974893">interface</span><span class="op" id="5974902">{</span><span class="op" id="5974903">}</span><span class="op" id="5974904">)</span>&nbsp;<span class="op" id="5974906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974909">c</span><span class="op" id="5974910">.</span><span class="ident" id="5974911">log</span><span class="op" id="5974914">(</span><span class="ident" id="5974915">fmt</span><span class="op" id="5974918">.</span><span class="ident" id="5974919">Sprintf</span><span class="op" id="5974926">(</span><span class="ident" id="5974927">format</span><span class="op" id="5974933">,</span>&nbsp;<span class="ident" id="5974935">args</span><span class="op" id="5974939">...</span><span class="op" id="5974942">)</span><span class="op" id="5974943">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974946">c</span><span class="op" id="5974947">.</span><span class="ident" id="5974948">FailNow</span><span class="op" id="5974955">(</span><span class="op" id="5974956">)</span><br>
<span class="lineno"></span><span class="op" id="5974958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5974961">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5975011">func</span>&nbsp;<span class="op" id="5975016">(</span><span class="ident" id="5975017">c</span>&nbsp;<span class="op" id="5975019">*</span><span class="ident" id="5975020">common</span><span class="op" id="5975026">)</span>&nbsp;<span class="ident" id="5975028">Skip</span><span class="op" id="5975032">(</span><span class="ident" id="5975033">args</span>&nbsp;<span class="op" id="5975038">...</span><span class="keyword" id="5975041">interface</span><span class="op" id="5975050">{</span><span class="op" id="5975051">}</span><span class="op" id="5975052">)</span>&nbsp;<span class="op" id="5975054">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975057">c</span><span class="op" id="5975058">.</span><span class="ident" id="5975059">log</span><span class="op" id="5975062">(</span><span class="ident" id="5975063">fmt</span><span class="op" id="5975066">.</span><span class="ident" id="5975067">Sprintln</span><span class="op" id="5975075">(</span><span class="ident" id="5975076">args</span><span class="op" id="5975080">...</span><span class="op" id="5975083">)</span><span class="op" id="5975084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975087">c</span><span class="op" id="5975088">.</span><span class="ident" id="5975089">SkipNow</span><span class="op" id="5975096">(</span><span class="op" id="5975097">)</span><br>
<span class="lineno"></span><span class="op" id="5975099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5975102">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="5975154">func</span>&nbsp;<span class="op" id="5975159">(</span><span class="ident" id="5975160">c</span>&nbsp;<span class="op" id="5975162">*</span><span class="ident" id="5975163">common</span><span class="op" id="5975169">)</span>&nbsp;<span class="ident" id="5975171">Skipf</span><span class="op" id="5975176">(</span><span class="ident" id="5975177">format</span>&nbsp;<span class="builtintype" id="5975184">string</span><span class="op" id="5975190">,</span>&nbsp;<span class="ident" id="5975192">args</span>&nbsp;<span class="op" id="5975197">...</span><span class="keyword" id="5975200">interface</span><span class="op" id="5975209">{</span><span class="op" id="5975210">}</span><span class="op" id="5975211">)</span>&nbsp;<span class="op" id="5975213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975216">c</span><span class="op" id="5975217">.</span><span class="ident" id="5975218">log</span><span class="op" id="5975221">(</span><span class="ident" id="5975222">fmt</span><span class="op" id="5975225">.</span><span class="ident" id="5975226">Sprintf</span><span class="op" id="5975233">(</span><span class="ident" id="5975234">format</span><span class="op" id="5975240">,</span>&nbsp;<span class="ident" id="5975242">args</span><span class="op" id="5975246">...</span><span class="op" id="5975249">)</span><span class="op" id="5975250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975253">c</span><span class="op" id="5975254">.</span><span class="ident" id="5975255">SkipNow</span><span class="op" id="5975262">(</span><span class="op" id="5975263">)</span><br>
<span class="lineno"></span><span class="op" id="5975265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5975268">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5975342">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="5975418">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5975490">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="5975565">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="5975592">func</span>&nbsp;<span class="op" id="5975597">(</span><span class="ident" id="5975598">c</span>&nbsp;<span class="op" id="5975600">*</span><span class="ident" id="5975601">common</span><span class="op" id="5975607">)</span>&nbsp;<span class="ident" id="5975609">SkipNow</span><span class="op" id="5975616">(</span><span class="op" id="5975617">)</span>&nbsp;<span class="op" id="5975619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975622">c</span><span class="op" id="5975623">.</span><span class="ident" id="5975624">skip</span><span class="op" id="5975628">(</span><span class="op" id="5975629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975632">c</span><span class="op" id="5975633">.</span><span class="ident" id="5975634">finished</span>&nbsp;<span class="op" id="5975643">=</span>&nbsp;<span class="builtintype" id="5975645">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975651">runtime</span><span class="op" id="5975658">.</span><span class="ident" id="5975659">Goexit</span><span class="op" id="5975665">(</span><span class="op" id="5975666">)</span><br>
<span class="lineno"></span><span class="op" id="5975668">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5975671">func</span>&nbsp;<span class="op" id="5975676">(</span><span class="ident" id="5975677">c</span>&nbsp;<span class="op" id="5975679">*</span><span class="ident" id="5975680">common</span><span class="op" id="5975686">)</span>&nbsp;<span class="ident" id="5975688">skip</span><span class="op" id="5975692">(</span><span class="op" id="5975693">)</span>&nbsp;<span class="op" id="5975695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975698">c</span><span class="op" id="5975699">.</span><span class="ident" id="5975700">mu</span><span class="op" id="5975702">.</span><span class="ident" id="5975703">Lock</span><span class="op" id="5975707">(</span><span class="op" id="5975708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975711">defer</span>&nbsp;<span class="ident" id="5975717">c</span><span class="op" id="5975718">.</span><span class="ident" id="5975719">mu</span><span class="op" id="5975721">.</span><span class="ident" id="5975722">Unlock</span><span class="op" id="5975728">(</span><span class="op" id="5975729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975732">c</span><span class="op" id="5975733">.</span><span class="ident" id="5975734">skipped</span>&nbsp;<span class="op" id="5975742">=</span>&nbsp;<span class="builtintype" id="5975744">true</span><br>
<span class="lineno">400</span><span class="op" id="5975749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5975752">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="5975801">func</span>&nbsp;<span class="op" id="5975806">(</span><span class="ident" id="5975807">c</span>&nbsp;<span class="op" id="5975809">*</span><span class="ident" id="5975810">common</span><span class="op" id="5975816">)</span>&nbsp;<span class="ident" id="5975818">Skipped</span><span class="op" id="5975825">(</span><span class="op" id="5975826">)</span>&nbsp;<span class="builtintype" id="5975828">bool</span>&nbsp;<span class="op" id="5975833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975836">c</span><span class="op" id="5975837">.</span><span class="ident" id="5975838">mu</span><span class="op" id="5975840">.</span><span class="ident" id="5975841">RLock</span><span class="op" id="5975846">(</span><span class="op" id="5975847">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975850">defer</span>&nbsp;<span class="ident" id="5975856">c</span><span class="op" id="5975857">.</span><span class="ident" id="5975858">mu</span><span class="op" id="5975860">.</span><span class="ident" id="5975861">RUnlock</span><span class="op" id="5975868">(</span><span class="op" id="5975869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975872">return</span>&nbsp;<span class="ident" id="5975879">c</span><span class="op" id="5975880">.</span><span class="ident" id="5975881">skipped</span><br>
<span class="lineno"></span><span class="op" id="5975889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5975892">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="5975973">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="5975998">func</span>&nbsp;<span class="op" id="5976003">(</span><span class="ident" id="5976004">t</span>&nbsp;<span class="op" id="5976006">*</span><span class="ident" id="5976007">T</span><span class="op" id="5976008">)</span>&nbsp;<span class="ident" id="5976010">Parallel</span><span class="op" id="5976018">(</span><span class="op" id="5976019">)</span>&nbsp;<span class="op" id="5976021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976024">t</span><span class="op" id="5976025">.</span><span class="ident" id="5976026">signal</span>&nbsp;<span class="op" id="5976033">&lt;-</span>&nbsp;<span class="op" id="5976036">(</span><span class="op" id="5976037">*</span><span class="ident" id="5976038">T</span><span class="op" id="5976039">)</span><span class="op" id="5976040">(</span><span class="ident" id="5976041">nil</span><span class="op" id="5976044">)</span>&nbsp;<span class="comment" id="5976046">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976076">&lt;-</span><span class="ident" id="5976078">t</span><span class="op" id="5976079">.</span><span class="ident" id="5976080">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5976098">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976134">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976209">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976284">t</span><span class="op" id="5976285">.</span><span class="ident" id="5976286">start</span>&nbsp;<span class="op" id="5976292">=</span>&nbsp;<span class="ident" id="5976294">time</span><span class="op" id="5976298">.</span><span class="ident" id="5976299">Now</span><span class="op" id="5976302">(</span><span class="op" id="5976303">)</span><br>
<span class="lineno"></span><span class="op" id="5976305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5976308">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="5976397">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5976426">type</span>&nbsp;<span class="ident" id="5976431">InternalTest</span>&nbsp;<span class="keyword" id="5976444">struct</span>&nbsp;<span class="op" id="5976451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976454">Name</span>&nbsp;<span class="builtintype" id="5976459">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976467">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5976472">func</span><span class="op" id="5976476">(</span><span class="op" id="5976477">*</span><span class="ident" id="5976478">T</span><span class="op" id="5976479">)</span><br>
<span class="lineno"></span><span class="op" id="5976481">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="5976484">func</span>&nbsp;<span class="ident" id="5976489">tRunner</span><span class="op" id="5976496">(</span><span class="ident" id="5976497">t</span>&nbsp;<span class="op" id="5976499">*</span><span class="ident" id="5976500">T</span><span class="op" id="5976501">,</span>&nbsp;<span class="ident" id="5976503">test</span>&nbsp;<span class="op" id="5976508">*</span><span class="ident" id="5976509">InternalTest</span><span class="op" id="5976521">)</span>&nbsp;<span class="op" id="5976523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976526">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976584">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976642">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976701">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976744">defer</span>&nbsp;<span class="keyword" id="5976750">func</span><span class="op" id="5976754">(</span><span class="op" id="5976755">)</span>&nbsp;<span class="op" id="5976757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976761">t</span><span class="op" id="5976762">.</span><span class="ident" id="5976763">duration</span>&nbsp;<span class="op" id="5976772">=</span>&nbsp;<span class="ident" id="5976774">time</span><span class="op" id="5976778">.</span><span class="ident" id="5976779">Now</span><span class="op" id="5976782">(</span><span class="op" id="5976783">)</span><span class="op" id="5976784">.</span><span class="ident" id="5976785">Sub</span><span class="op" id="5976788">(</span><span class="ident" id="5976789">t</span><span class="op" id="5976790">.</span><span class="ident" id="5976791">start</span><span class="op" id="5976796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976800">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976863">err</span>&nbsp;<span class="op" id="5976867">:=</span>&nbsp;<span class="builtinfunc" id="5976870">recover</span><span class="op" id="5976877">(</span><span class="op" id="5976878">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976882">if</span>&nbsp;<span class="op" id="5976885">!</span><span class="ident" id="5976886">t</span><span class="op" id="5976887">.</span><span class="ident" id="5976888">finished</span>&nbsp;<span class="op" id="5976897">&amp;&amp;</span>&nbsp;<span class="ident" id="5976900">err</span>&nbsp;<span class="op" id="5976904">==</span>&nbsp;<span class="ident" id="5976907">nil</span>&nbsp;<span class="op" id="5976911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976916">err</span>&nbsp;<span class="op" id="5976920">=</span>&nbsp;<span class="ident" id="5976922">fmt</span><span class="op" id="5976925">.</span><span class="ident" id="5976926">Errorf</span><span class="op" id="5976932">(</span><span class="string" id="5976933">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="5976977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976985">if</span>&nbsp;<span class="ident" id="5976988">err</span>&nbsp;<span class="op" id="5976992">!=</span>&nbsp;<span class="ident" id="5976995">nil</span>&nbsp;<span class="op" id="5976999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977004">t</span><span class="op" id="5977005">.</span><span class="ident" id="5977006">Fail</span><span class="op" id="5977010">(</span><span class="op" id="5977011">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977016">t</span><span class="op" id="5977017">.</span><span class="ident" id="5977018">report</span><span class="op" id="5977024">(</span><span class="op" id="5977025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5977030">panic</span><span class="op" id="5977035">(</span><span class="ident" id="5977036">err</span><span class="op" id="5977039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977047">t</span><span class="op" id="5977048">.</span><span class="ident" id="5977049">signal</span>&nbsp;<span class="op" id="5977056">&lt;-</span>&nbsp;<span class="ident" id="5977059">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977062">}</span><span class="op" id="5977063">(</span><span class="op" id="5977064">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977068">t</span><span class="op" id="5977069">.</span><span class="ident" id="5977070">start</span>&nbsp;<span class="op" id="5977076">=</span>&nbsp;<span class="ident" id="5977078">time</span><span class="op" id="5977082">.</span><span class="ident" id="5977083">Now</span><span class="op" id="5977086">(</span><span class="op" id="5977087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977090">test</span><span class="op" id="5977094">.</span><span class="ident" id="5977095">F</span><span class="op" id="5977096">(</span><span class="ident" id="5977097">t</span><span class="op" id="5977098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977101">t</span><span class="op" id="5977102">.</span><span class="ident" id="5977103">finished</span>&nbsp;<span class="op" id="5977112">=</span>&nbsp;<span class="builtintype" id="5977114">true</span><br>
<span class="lineno"></span><span class="op" id="5977119">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="5977122">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5977215">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5977244">func</span>&nbsp;<span class="ident" id="5977249">Main</span><span class="op" id="5977253">(</span><span class="ident" id="5977254">matchString</span>&nbsp;<span class="keyword" id="5977266">func</span><span class="op" id="5977270">(</span><span class="ident" id="5977271">pat</span><span class="op" id="5977274">,</span>&nbsp;<span class="ident" id="5977276">str</span>&nbsp;<span class="builtintype" id="5977280">string</span><span class="op" id="5977286">)</span>&nbsp;<span class="op" id="5977288">(</span><span class="builtintype" id="5977289">bool</span><span class="op" id="5977293">,</span>&nbsp;<span class="builtintype" id="5977295">error</span><span class="op" id="5977300">)</span><span class="op" id="5977301">,</span>&nbsp;<span class="ident" id="5977303">tests</span>&nbsp;<span class="op" id="5977309">[</span><span class="op" id="5977310">]</span><span class="ident" id="5977311">InternalTest</span><span class="op" id="5977323">,</span>&nbsp;<span class="ident" id="5977325">benchmarks</span>&nbsp;<span class="op" id="5977336">[</span><span class="op" id="5977337">]</span><span class="ident" id="5977338">InternalBenchmark</span><span class="op" id="5977355">,</span>&nbsp;<span class="ident" id="5977357">examples</span>&nbsp;<span class="op" id="5977366">[</span><span class="op" id="5977367">]</span><span class="ident" id="5977368">InternalExample</span><span class="op" id="5977383">)</span>&nbsp;<span class="op" id="5977385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977388">os</span><span class="op" id="5977390">.</span><span class="ident" id="5977391">Exit</span><span class="op" id="5977395">(</span><span class="ident" id="5977396">MainStart</span><span class="op" id="5977405">(</span><span class="ident" id="5977406">matchString</span><span class="op" id="5977417">,</span>&nbsp;<span class="ident" id="5977419">tests</span><span class="op" id="5977424">,</span>&nbsp;<span class="ident" id="5977426">benchmarks</span><span class="op" id="5977436">,</span>&nbsp;<span class="ident" id="5977438">examples</span><span class="op" id="5977446">)</span><span class="op" id="5977447">.</span><span class="ident" id="5977448">Run</span><span class="op" id="5977451">(</span><span class="op" id="5977452">)</span><span class="op" id="5977453">)</span><br>
<span class="lineno">455</span><span class="op" id="5977455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5977458">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="5977528">type</span>&nbsp;<span class="ident" id="5977533">M</span>&nbsp;<span class="keyword" id="5977535">struct</span>&nbsp;<span class="op" id="5977542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977545">matchString</span>&nbsp;<span class="keyword" id="5977557">func</span><span class="op" id="5977561">(</span><span class="ident" id="5977562">pat</span><span class="op" id="5977565">,</span>&nbsp;<span class="ident" id="5977567">str</span>&nbsp;<span class="builtintype" id="5977571">string</span><span class="op" id="5977577">)</span>&nbsp;<span class="op" id="5977579">(</span><span class="builtintype" id="5977580">bool</span><span class="op" id="5977584">,</span>&nbsp;<span class="builtintype" id="5977586">error</span><span class="op" id="5977591">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977594">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977606">[</span><span class="op" id="5977607">]</span><span class="ident" id="5977608">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977622">benchmarks</span>&nbsp;&nbsp;<span class="op" id="5977634">[</span><span class="op" id="5977635">]</span><span class="ident" id="5977636">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977655">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977667">[</span><span class="op" id="5977668">]</span><span class="ident" id="5977669">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="5977685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="5977688">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="5977751">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="5977847">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="5977899">func</span>&nbsp;<span class="ident" id="5977904">MainStart</span><span class="op" id="5977913">(</span><span class="ident" id="5977914">matchString</span>&nbsp;<span class="keyword" id="5977926">func</span><span class="op" id="5977930">(</span><span class="ident" id="5977931">pat</span><span class="op" id="5977934">,</span>&nbsp;<span class="ident" id="5977936">str</span>&nbsp;<span class="builtintype" id="5977940">string</span><span class="op" id="5977946">)</span>&nbsp;<span class="op" id="5977948">(</span><span class="builtintype" id="5977949">bool</span><span class="op" id="5977953">,</span>&nbsp;<span class="builtintype" id="5977955">error</span><span class="op" id="5977960">)</span><span class="op" id="5977961">,</span>&nbsp;<span class="ident" id="5977963">tests</span>&nbsp;<span class="op" id="5977969">[</span><span class="op" id="5977970">]</span><span class="ident" id="5977971">InternalTest</span><span class="op" id="5977983">,</span>&nbsp;<span class="ident" id="5977985">benchmarks</span>&nbsp;<span class="op" id="5977996">[</span><span class="op" id="5977997">]</span><span class="ident" id="5977998">InternalBenchmark</span><span class="op" id="5978015">,</span>&nbsp;<span class="ident" id="5978017">examples</span>&nbsp;<span class="op" id="5978026">[</span><span class="op" id="5978027">]</span><span class="ident" id="5978028">InternalExample</span><span class="op" id="5978043">)</span>&nbsp;<span class="op" id="5978045">*</span><span class="ident" id="5978046">M</span>&nbsp;<span class="op" id="5978048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978051">return</span>&nbsp;<span class="op" id="5978058">&amp;</span><span class="ident" id="5978059">M</span><span class="op" id="5978060">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978064">matchString</span><span class="op" id="5978075">:</span>&nbsp;<span class="ident" id="5978077">matchString</span><span class="op" id="5978088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978092">tests</span><span class="op" id="5978097">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978105">tests</span><span class="op" id="5978110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978114">benchmarks</span><span class="op" id="5978124">:</span>&nbsp;&nbsp;<span class="ident" id="5978127">benchmarks</span><span class="op" id="5978137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978141">examples</span><span class="op" id="5978149">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978154">examples</span><span class="op" id="5978162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978165">}</span><br>
<span class="lineno">475</span><span class="op" id="5978167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5978170">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="5978237">func</span>&nbsp;<span class="op" id="5978242">(</span><span class="ident" id="5978243">m</span>&nbsp;<span class="op" id="5978245">*</span><span class="ident" id="5978246">M</span><span class="op" id="5978247">)</span>&nbsp;<span class="ident" id="5978249">Run</span><span class="op" id="5978252">(</span><span class="op" id="5978253">)</span>&nbsp;<span class="builtintype" id="5978255">int</span>&nbsp;<span class="op" id="5978259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978262">flag</span><span class="op" id="5978266">.</span><span class="ident" id="5978267">Parse</span><span class="op" id="5978272">(</span><span class="op" id="5978273">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978276">parseCpuList</span><span class="op" id="5978288">(</span><span class="op" id="5978289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978293">before</span><span class="op" id="5978299">(</span><span class="op" id="5978300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978303">startAlarm</span><span class="op" id="5978313">(</span><span class="op" id="5978314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978317">haveExamples</span>&nbsp;<span class="op" id="5978330">=</span>&nbsp;<span class="builtinfunc" id="5978332">len</span><span class="op" id="5978335">(</span><span class="ident" id="5978336">m</span><span class="op" id="5978337">.</span><span class="ident" id="5978338">examples</span><span class="op" id="5978346">)</span>&nbsp;<span class="op" id="5978348">&gt;</span>&nbsp;<span class="num" id="5978350">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978353">testOk</span>&nbsp;<span class="op" id="5978360">:=</span>&nbsp;<span class="ident" id="5978363">RunTests</span><span class="op" id="5978371">(</span><span class="ident" id="5978372">m</span><span class="op" id="5978373">.</span><span class="ident" id="5978374">matchString</span><span class="op" id="5978385">,</span>&nbsp;<span class="ident" id="5978387">m</span><span class="op" id="5978388">.</span><span class="ident" id="5978389">tests</span><span class="op" id="5978394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978397">exampleOk</span>&nbsp;<span class="op" id="5978407">:=</span>&nbsp;<span class="ident" id="5978410">RunExamples</span><span class="op" id="5978421">(</span><span class="ident" id="5978422">m</span><span class="op" id="5978423">.</span><span class="ident" id="5978424">matchString</span><span class="op" id="5978435">,</span>&nbsp;<span class="ident" id="5978437">m</span><span class="op" id="5978438">.</span><span class="ident" id="5978439">examples</span><span class="op" id="5978447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978450">stopAlarm</span><span class="op" id="5978459">(</span><span class="op" id="5978460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978463">if</span>&nbsp;<span class="op" id="5978466">!</span><span class="ident" id="5978467">testOk</span>&nbsp;<span class="op" id="5978474">||</span>&nbsp;<span class="op" id="5978477">!</span><span class="ident" id="5978478">exampleOk</span>&nbsp;<span class="op" id="5978488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978492">fmt</span><span class="op" id="5978495">.</span><span class="ident" id="5978496">Println</span><span class="op" id="5978503">(</span><span class="string" id="5978504">&#34;FAIL&#34;</span><span class="op" id="5978510">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978514">after</span><span class="op" id="5978519">(</span><span class="op" id="5978520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978524">return</span>&nbsp;<span class="num" id="5978531">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978537">fmt</span><span class="op" id="5978540">.</span><span class="ident" id="5978541">Println</span><span class="op" id="5978548">(</span><span class="string" id="5978549">&#34;PASS&#34;</span><span class="op" id="5978555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978558">RunBenchmarks</span><span class="op" id="5978571">(</span><span class="ident" id="5978572">m</span><span class="op" id="5978573">.</span><span class="ident" id="5978574">matchString</span><span class="op" id="5978585">,</span>&nbsp;<span class="ident" id="5978587">m</span><span class="op" id="5978588">.</span><span class="ident" id="5978589">benchmarks</span><span class="op" id="5978599">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978602">after</span><span class="op" id="5978607">(</span><span class="op" id="5978608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978611">return</span>&nbsp;<span class="num" id="5978618">0</span><br>
<span class="lineno"></span><span class="op" id="5978620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5978623">func</span>&nbsp;<span class="op" id="5978628">(</span><span class="ident" id="5978629">t</span>&nbsp;<span class="op" id="5978631">*</span><span class="ident" id="5978632">T</span><span class="op" id="5978633">)</span>&nbsp;<span class="ident" id="5978635">report</span><span class="op" id="5978641">(</span><span class="op" id="5978642">)</span>&nbsp;<span class="op" id="5978644">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978647">dstr</span>&nbsp;<span class="op" id="5978652">:=</span>&nbsp;<span class="ident" id="5978655">fmtDuration</span><span class="op" id="5978666">(</span><span class="ident" id="5978667">t</span><span class="op" id="5978668">.</span><span class="ident" id="5978669">duration</span><span class="op" id="5978677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978680">format</span>&nbsp;<span class="op" id="5978687">:=</span>&nbsp;<span class="string" id="5978690">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978713">if</span>&nbsp;<span class="ident" id="5978716">t</span><span class="op" id="5978717">.</span><span class="ident" id="5978718">Failed</span><span class="op" id="5978724">(</span><span class="op" id="5978725">)</span>&nbsp;<span class="op" id="5978727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978731">fmt</span><span class="op" id="5978734">.</span><span class="ident" id="5978735">Printf</span><span class="op" id="5978741">(</span><span class="ident" id="5978742">format</span><span class="op" id="5978748">,</span>&nbsp;<span class="string" id="5978750">&#34;FAIL&#34;</span><span class="op" id="5978756">,</span>&nbsp;<span class="ident" id="5978758">t</span><span class="op" id="5978759">.</span><span class="ident" id="5978760">name</span><span class="op" id="5978764">,</span>&nbsp;<span class="ident" id="5978766">dstr</span><span class="op" id="5978770">,</span>&nbsp;<span class="ident" id="5978772">t</span><span class="op" id="5978773">.</span><span class="ident" id="5978774">output</span><span class="op" id="5978780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978783">}</span>&nbsp;<span class="keyword" id="5978785">else</span>&nbsp;<span class="keyword" id="5978790">if</span>&nbsp;<span class="op" id="5978793">*</span><span class="ident" id="5978794">chatty</span>&nbsp;<span class="op" id="5978801">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978805">if</span>&nbsp;<span class="ident" id="5978808">t</span><span class="op" id="5978809">.</span><span class="ident" id="5978810">Skipped</span><span class="op" id="5978817">(</span><span class="op" id="5978818">)</span>&nbsp;<span class="op" id="5978820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978825">fmt</span><span class="op" id="5978828">.</span><span class="ident" id="5978829">Printf</span><span class="op" id="5978835">(</span><span class="ident" id="5978836">format</span><span class="op" id="5978842">,</span>&nbsp;<span class="string" id="5978844">&#34;SKIP&#34;</span><span class="op" id="5978850">,</span>&nbsp;<span class="ident" id="5978852">t</span><span class="op" id="5978853">.</span><span class="ident" id="5978854">name</span><span class="op" id="5978858">,</span>&nbsp;<span class="ident" id="5978860">dstr</span><span class="op" id="5978864">,</span>&nbsp;<span class="ident" id="5978866">t</span><span class="op" id="5978867">.</span><span class="ident" id="5978868">output</span><span class="op" id="5978874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978878">}</span>&nbsp;<span class="keyword" id="5978880">else</span>&nbsp;<span class="op" id="5978885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978890">fmt</span><span class="op" id="5978893">.</span><span class="ident" id="5978894">Printf</span><span class="op" id="5978900">(</span><span class="ident" id="5978901">format</span><span class="op" id="5978907">,</span>&nbsp;<span class="string" id="5978909">&#34;PASS&#34;</span><span class="op" id="5978915">,</span>&nbsp;<span class="ident" id="5978917">t</span><span class="op" id="5978918">.</span><span class="ident" id="5978919">name</span><span class="op" id="5978923">,</span>&nbsp;<span class="ident" id="5978925">dstr</span><span class="op" id="5978929">,</span>&nbsp;<span class="ident" id="5978931">t</span><span class="op" id="5978932">.</span><span class="ident" id="5978933">output</span><span class="op" id="5978939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978943">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978946">}</span><br>
<span class="lineno"></span><span class="op" id="5978948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5978951">func</span>&nbsp;<span class="ident" id="5978956">RunTests</span><span class="op" id="5978964">(</span><span class="ident" id="5978965">matchString</span>&nbsp;<span class="keyword" id="5978977">func</span><span class="op" id="5978981">(</span><span class="ident" id="5978982">pat</span><span class="op" id="5978985">,</span>&nbsp;<span class="ident" id="5978987">str</span>&nbsp;<span class="builtintype" id="5978991">string</span><span class="op" id="5978997">)</span>&nbsp;<span class="op" id="5978999">(</span><span class="builtintype" id="5979000">bool</span><span class="op" id="5979004">,</span>&nbsp;<span class="builtintype" id="5979006">error</span><span class="op" id="5979011">)</span><span class="op" id="5979012">,</span>&nbsp;<span class="ident" id="5979014">tests</span>&nbsp;<span class="op" id="5979020">[</span><span class="op" id="5979021">]</span><span class="ident" id="5979022">InternalTest</span><span class="op" id="5979034">)</span>&nbsp;<span class="op" id="5979036">(</span><span class="ident" id="5979037">ok</span>&nbsp;<span class="builtintype" id="5979040">bool</span><span class="op" id="5979044">)</span>&nbsp;<span class="op" id="5979046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979049">ok</span>&nbsp;<span class="op" id="5979052">=</span>&nbsp;<span class="builtintype" id="5979054">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979060">if</span>&nbsp;<span class="builtinfunc" id="5979063">len</span><span class="op" id="5979066">(</span><span class="ident" id="5979067">tests</span><span class="op" id="5979072">)</span>&nbsp;<span class="op" id="5979074">==</span>&nbsp;<span class="num" id="5979077">0</span>&nbsp;<span class="op" id="5979079">&amp;&amp;</span>&nbsp;<span class="op" id="5979082">!</span><span class="ident" id="5979083">haveExamples</span>&nbsp;<span class="op" id="5979096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979100">fmt</span><span class="op" id="5979103">.</span><span class="ident" id="5979104">Fprintln</span><span class="op" id="5979112">(</span><span class="ident" id="5979113">os</span><span class="op" id="5979115">.</span><span class="ident" id="5979116">Stderr</span><span class="op" id="5979122">,</span>&nbsp;<span class="string" id="5979124">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="5979159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979163">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979174">for</span>&nbsp;<span class="ident" id="5979178">_</span><span class="op" id="5979179">,</span>&nbsp;<span class="ident" id="5979181">procs</span>&nbsp;<span class="op" id="5979187">:=</span>&nbsp;<span class="keyword" id="5979190">range</span>&nbsp;<span class="ident" id="5979196">cpuList</span>&nbsp;<span class="op" id="5979204">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979208">runtime</span><span class="op" id="5979215">.</span><span class="ident" id="5979216">GOMAXPROCS</span><span class="op" id="5979226">(</span><span class="ident" id="5979227">procs</span><span class="op" id="5979232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979236">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979295">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979378">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979451">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979539">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979570">var</span>&nbsp;<span class="ident" id="5979574">collector</span>&nbsp;<span class="op" id="5979584">=</span>&nbsp;<span class="builtinfunc" id="5979586">make</span><span class="op" id="5979590">(</span><span class="keyword" id="5979591">chan</span>&nbsp;<span class="keyword" id="5979596">interface</span><span class="op" id="5979605">{</span><span class="op" id="5979606">}</span><span class="op" id="5979607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979612">numParallel</span>&nbsp;<span class="op" id="5979624">:=</span>&nbsp;<span class="num" id="5979627">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979631">startParallel</span>&nbsp;<span class="op" id="5979645">:=</span>&nbsp;<span class="builtinfunc" id="5979648">make</span><span class="op" id="5979652">(</span><span class="keyword" id="5979653">chan</span>&nbsp;<span class="builtintype" id="5979658">bool</span><span class="op" id="5979662">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979667">for</span>&nbsp;<span class="ident" id="5979671">i</span>&nbsp;<span class="op" id="5979673">:=</span>&nbsp;<span class="num" id="5979676">0</span><span class="op" id="5979677">;</span>&nbsp;<span class="ident" id="5979679">i</span>&nbsp;<span class="op" id="5979681">&lt;</span>&nbsp;<span class="builtinfunc" id="5979683">len</span><span class="op" id="5979686">(</span><span class="ident" id="5979687">tests</span><span class="op" id="5979692">)</span><span class="op" id="5979693">;</span>&nbsp;<span class="ident" id="5979695">i</span><span class="op" id="5979696">++</span>&nbsp;<span class="op" id="5979699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979704">matched</span><span class="op" id="5979711">,</span>&nbsp;<span class="ident" id="5979713">err</span>&nbsp;<span class="op" id="5979717">:=</span>&nbsp;<span class="ident" id="5979720">matchString</span><span class="op" id="5979731">(</span><span class="op" id="5979732">*</span><span class="ident" id="5979733">match</span><span class="op" id="5979738">,</span>&nbsp;<span class="ident" id="5979740">tests</span><span class="op" id="5979745">[</span><span class="ident" id="5979746">i</span><span class="op" id="5979747">]</span><span class="op" id="5979748">.</span><span class="ident" id="5979749">Name</span><span class="op" id="5979753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979758">if</span>&nbsp;<span class="ident" id="5979761">err</span>&nbsp;<span class="op" id="5979765">!=</span>&nbsp;<span class="ident" id="5979768">nil</span>&nbsp;<span class="op" id="5979772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979778">fmt</span><span class="op" id="5979781">.</span><span class="ident" id="5979782">Fprintf</span><span class="op" id="5979789">(</span><span class="ident" id="5979790">os</span><span class="op" id="5979792">.</span><span class="ident" id="5979793">Stderr</span><span class="op" id="5979799">,</span>&nbsp;<span class="string" id="5979801">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="5979846">,</span>&nbsp;<span class="ident" id="5979848">err</span><span class="op" id="5979851">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979857">os</span><span class="op" id="5979859">.</span><span class="ident" id="5979860">Exit</span><span class="op" id="5979864">(</span><span class="num" id="5979865">1</span><span class="op" id="5979866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979876">if</span>&nbsp;<span class="op" id="5979879">!</span><span class="ident" id="5979880">matched</span>&nbsp;<span class="op" id="5979888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979894">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979906">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979911">testName</span>&nbsp;<span class="op" id="5979920">:=</span>&nbsp;<span class="ident" id="5979923">tests</span><span class="op" id="5979928">[</span><span class="ident" id="5979929">i</span><span class="op" id="5979930">]</span><span class="op" id="5979931">.</span><span class="ident" id="5979932">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979940">if</span>&nbsp;<span class="ident" id="5979943">procs</span>&nbsp;<span class="op" id="5979949">!=</span>&nbsp;<span class="num" id="5979952">1</span>&nbsp;<span class="op" id="5979954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979960">testName</span>&nbsp;<span class="op" id="5979969">=</span>&nbsp;<span class="ident" id="5979971">fmt</span><span class="op" id="5979974">.</span><span class="ident" id="5979975">Sprintf</span><span class="op" id="5979982">(</span><span class="string" id="5979983">&#34;%s-%d&#34;</span><span class="op" id="5979990">,</span>&nbsp;<span class="ident" id="5979992">tests</span><span class="op" id="5979997">[</span><span class="ident" id="5979998">i</span><span class="op" id="5979999">]</span><span class="op" id="5980000">.</span><span class="ident" id="5980001">Name</span><span class="op" id="5980005">,</span>&nbsp;<span class="ident" id="5980007">procs</span><span class="op" id="5980012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980022">t</span>&nbsp;<span class="op" id="5980024">:=</span>&nbsp;<span class="op" id="5980027">&amp;</span><span class="ident" id="5980028">T</span><span class="op" id="5980029">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980035">common</span><span class="op" id="5980041">:</span>&nbsp;<span class="ident" id="5980043">common</span><span class="op" id="5980049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980056">signal</span><span class="op" id="5980062">:</span>&nbsp;<span class="builtinfunc" id="5980064">make</span><span class="op" id="5980068">(</span><span class="keyword" id="5980069">chan</span>&nbsp;<span class="keyword" id="5980074">interface</span><span class="op" id="5980083">{</span><span class="op" id="5980084">}</span><span class="op" id="5980085">)</span><span class="op" id="5980086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980092">}</span><span class="op" id="5980093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980099">name</span><span class="op" id="5980103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980114">testName</span><span class="op" id="5980122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980128">startParallel</span><span class="op" id="5980141">:</span>&nbsp;<span class="ident" id="5980143">startParallel</span><span class="op" id="5980156">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980166">t</span><span class="op" id="5980167">.</span><span class="ident" id="5980168">self</span>&nbsp;<span class="op" id="5980173">=</span>&nbsp;<span class="ident" id="5980175">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980180">if</span>&nbsp;<span class="op" id="5980183">*</span><span class="ident" id="5980184">chatty</span>&nbsp;<span class="op" id="5980191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980197">fmt</span><span class="op" id="5980200">.</span><span class="ident" id="5980201">Printf</span><span class="op" id="5980207">(</span><span class="string" id="5980208">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="5980222">,</span>&nbsp;<span class="ident" id="5980224">t</span><span class="op" id="5980225">.</span><span class="ident" id="5980226">name</span><span class="op" id="5980230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980235">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980240">go</span>&nbsp;<span class="ident" id="5980243">tRunner</span><span class="op" id="5980250">(</span><span class="ident" id="5980251">t</span><span class="op" id="5980252">,</span>&nbsp;<span class="op" id="5980254">&amp;</span><span class="ident" id="5980255">tests</span><span class="op" id="5980260">[</span><span class="ident" id="5980261">i</span><span class="op" id="5980262">]</span><span class="op" id="5980263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980268">out</span>&nbsp;<span class="op" id="5980272">:=</span>&nbsp;<span class="op" id="5980275">(</span><span class="op" id="5980276">&lt;-</span><span class="ident" id="5980278">t</span><span class="op" id="5980279">.</span><span class="ident" id="5980280">signal</span><span class="op" id="5980286">)</span><span class="op" id="5980287">.</span><span class="op" id="5980288">(</span><span class="op" id="5980289">*</span><span class="ident" id="5980290">T</span><span class="op" id="5980291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980296">if</span>&nbsp;<span class="ident" id="5980299">out</span>&nbsp;<span class="op" id="5980303">==</span>&nbsp;<span class="ident" id="5980306">nil</span>&nbsp;<span class="op" id="5980310">{</span>&nbsp;<span class="comment" id="5980312">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980333">go</span>&nbsp;<span class="keyword" id="5980336">func</span><span class="op" id="5980340">(</span><span class="op" id="5980341">)</span>&nbsp;<span class="op" id="5980343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980350">collector</span>&nbsp;<span class="op" id="5980360">&lt;-</span>&nbsp;<span class="op" id="5980363">&lt;-</span><span class="ident" id="5980365">t</span><span class="op" id="5980366">.</span><span class="ident" id="5980367">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980378">}</span><span class="op" id="5980379">(</span><span class="op" id="5980380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980386">numParallel</span><span class="op" id="5980397">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980404">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980421">t</span><span class="op" id="5980422">.</span><span class="ident" id="5980423">report</span><span class="op" id="5980429">(</span><span class="op" id="5980430">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980435">ok</span>&nbsp;<span class="op" id="5980438">=</span>&nbsp;<span class="ident" id="5980440">ok</span>&nbsp;<span class="op" id="5980443">&amp;&amp;</span>&nbsp;<span class="op" id="5980446">!</span><span class="ident" id="5980447">out</span><span class="op" id="5980450">.</span><span class="ident" id="5980451">Failed</span><span class="op" id="5980457">(</span><span class="op" id="5980458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980467">running</span>&nbsp;<span class="op" id="5980475">:=</span>&nbsp;<span class="num" id="5980478">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980482">for</span>&nbsp;<span class="ident" id="5980486">numParallel</span><span class="op" id="5980497">+</span><span class="ident" id="5980498">running</span>&nbsp;<span class="op" id="5980506">&gt;</span>&nbsp;<span class="num" id="5980508">0</span>&nbsp;<span class="op" id="5980510">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980515">if</span>&nbsp;<span class="ident" id="5980518">running</span>&nbsp;<span class="op" id="5980526">&lt;</span>&nbsp;<span class="op" id="5980528">*</span><span class="ident" id="5980529">parallel</span>&nbsp;<span class="op" id="5980538">&amp;&amp;</span>&nbsp;<span class="ident" id="5980541">numParallel</span>&nbsp;<span class="op" id="5980553">&gt;</span>&nbsp;<span class="num" id="5980555">0</span>&nbsp;<span class="op" id="5980557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980563">startParallel</span>&nbsp;<span class="op" id="5980577">&lt;-</span>&nbsp;<span class="builtintype" id="5980580">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980589">running</span><span class="op" id="5980596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980603">numParallel</span><span class="op" id="5980614">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980621">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980638">t</span>&nbsp;<span class="op" id="5980640">:=</span>&nbsp;<span class="op" id="5980643">(</span><span class="op" id="5980644">&lt;-</span><span class="ident" id="5980646">collector</span><span class="op" id="5980655">)</span><span class="op" id="5980656">.</span><span class="op" id="5980657">(</span><span class="op" id="5980658">*</span><span class="ident" id="5980659">T</span><span class="op" id="5980660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980665">t</span><span class="op" id="5980666">.</span><span class="ident" id="5980667">report</span><span class="op" id="5980673">(</span><span class="op" id="5980674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980679">ok</span>&nbsp;<span class="op" id="5980682">=</span>&nbsp;<span class="ident" id="5980684">ok</span>&nbsp;<span class="op" id="5980687">&amp;&amp;</span>&nbsp;<span class="op" id="5980690">!</span><span class="ident" id="5980691">t</span><span class="op" id="5980692">.</span><span class="ident" id="5980693">Failed</span><span class="op" id="5980699">(</span><span class="op" id="5980700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980705">running</span><span class="op" id="5980712">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980723">return</span><br>
<span class="lineno"></span><span class="op" id="5980730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="5980733">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5980768">func</span>&nbsp;<span class="ident" id="5980773">before</span><span class="op" id="5980779">(</span><span class="op" id="5980780">)</span>&nbsp;<span class="op" id="5980782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980785">if</span>&nbsp;<span class="op" id="5980788">*</span><span class="ident" id="5980789">memProfileRate</span>&nbsp;<span class="op" id="5980804">&gt;</span>&nbsp;<span class="num" id="5980806">0</span>&nbsp;<span class="op" id="5980808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980812">runtime</span><span class="op" id="5980819">.</span><span class="ident" id="5980820">MemProfileRate</span>&nbsp;<span class="op" id="5980835">=</span>&nbsp;<span class="op" id="5980837">*</span><span class="ident" id="5980838">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980854">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980857">if</span>&nbsp;<span class="op" id="5980860">*</span><span class="ident" id="5980861">cpuProfile</span>&nbsp;<span class="op" id="5980872">!=</span>&nbsp;<span class="string" id="5980875">&#34;&#34;</span>&nbsp;<span class="op" id="5980878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980882">f</span><span class="op" id="5980883">,</span>&nbsp;<span class="ident" id="5980885">err</span>&nbsp;<span class="op" id="5980889">:=</span>&nbsp;<span class="ident" id="5980892">os</span><span class="op" id="5980894">.</span><span class="ident" id="5980895">Create</span><span class="op" id="5980901">(</span><span class="ident" id="5980902">toOutputDir</span><span class="op" id="5980913">(</span><span class="op" id="5980914">*</span><span class="ident" id="5980915">cpuProfile</span><span class="op" id="5980925">)</span><span class="op" id="5980926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980930">if</span>&nbsp;<span class="ident" id="5980933">err</span>&nbsp;<span class="op" id="5980937">!=</span>&nbsp;<span class="ident" id="5980940">nil</span>&nbsp;<span class="op" id="5980944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980949">fmt</span><span class="op" id="5980952">.</span><span class="ident" id="5980953">Fprintf</span><span class="op" id="5980960">(</span><span class="ident" id="5980961">os</span><span class="op" id="5980963">.</span><span class="ident" id="5980964">Stderr</span><span class="op" id="5980970">,</span>&nbsp;<span class="string" id="5980972">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="5980985">,</span>&nbsp;<span class="ident" id="5980987">err</span><span class="op" id="5980990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980995">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981008">if</span>&nbsp;<span class="ident" id="5981011">err</span>&nbsp;<span class="op" id="5981015">:=</span>&nbsp;<span class="ident" id="5981018">pprof</span><span class="op" id="5981023">.</span><span class="ident" id="5981024">StartCPUProfile</span><span class="op" id="5981039">(</span><span class="ident" id="5981040">f</span><span class="op" id="5981041">)</span><span class="op" id="5981042">;</span>&nbsp;<span class="ident" id="5981044">err</span>&nbsp;<span class="op" id="5981048">!=</span>&nbsp;<span class="ident" id="5981051">nil</span>&nbsp;<span class="op" id="5981055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981060">fmt</span><span class="op" id="5981063">.</span><span class="ident" id="5981064">Fprintf</span><span class="op" id="5981071">(</span><span class="ident" id="5981072">os</span><span class="op" id="5981074">.</span><span class="ident" id="5981075">Stderr</span><span class="op" id="5981081">,</span>&nbsp;<span class="string" id="5981083">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="5981121">,</span>&nbsp;<span class="ident" id="5981123">err</span><span class="op" id="5981126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981131">f</span><span class="op" id="5981132">.</span><span class="ident" id="5981133">Close</span><span class="op" id="5981138">(</span><span class="op" id="5981139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981144">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981157">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981226">if</span>&nbsp;<span class="op" id="5981229">*</span><span class="ident" id="5981230">blockProfile</span>&nbsp;<span class="op" id="5981243">!=</span>&nbsp;<span class="string" id="5981246">&#34;&#34;</span>&nbsp;<span class="op" id="5981249">&amp;&amp;</span>&nbsp;<span class="op" id="5981252">*</span><span class="ident" id="5981253">blockProfileRate</span>&nbsp;<span class="op" id="5981270">&gt;=</span>&nbsp;<span class="num" id="5981273">0</span>&nbsp;<span class="op" id="5981275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981279">runtime</span><span class="op" id="5981286">.</span><span class="ident" id="5981287">SetBlockProfileRate</span><span class="op" id="5981306">(</span><span class="op" id="5981307">*</span><span class="ident" id="5981308">blockProfileRate</span><span class="op" id="5981324">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981330">if</span>&nbsp;<span class="op" id="5981333">*</span><span class="ident" id="5981334">coverProfile</span>&nbsp;<span class="op" id="5981347">!=</span>&nbsp;<span class="string" id="5981350">&#34;&#34;</span>&nbsp;<span class="op" id="5981353">&amp;&amp;</span>&nbsp;<span class="ident" id="5981356">cover</span><span class="op" id="5981361">.</span><span class="ident" id="5981362">Mode</span>&nbsp;<span class="op" id="5981367">==</span>&nbsp;<span class="string" id="5981370">&#34;&#34;</span>&nbsp;<span class="op" id="5981373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981377">fmt</span><span class="op" id="5981380">.</span><span class="ident" id="5981381">Fprintf</span><span class="op" id="5981388">(</span><span class="ident" id="5981389">os</span><span class="op" id="5981391">.</span><span class="ident" id="5981392">Stderr</span><span class="op" id="5981398">,</span>&nbsp;<span class="string" id="5981400">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="5981498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981502">os</span><span class="op" id="5981504">.</span><span class="ident" id="5981505">Exit</span><span class="op" id="5981509">(</span><span class="num" id="5981510">2</span><span class="op" id="5981511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981514">}</span><br>
<span class="lineno">610</span><span class="op" id="5981516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5981519">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5981552">func</span>&nbsp;<span class="ident" id="5981557">after</span><span class="op" id="5981562">(</span><span class="op" id="5981563">)</span>&nbsp;<span class="op" id="5981565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981568">if</span>&nbsp;<span class="op" id="5981571">*</span><span class="ident" id="5981572">cpuProfile</span>&nbsp;<span class="op" id="5981583">!=</span>&nbsp;<span class="string" id="5981586">&#34;&#34;</span>&nbsp;<span class="op" id="5981589">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981593">pprof</span><span class="op" id="5981598">.</span><span class="ident" id="5981599">StopCPUProfile</span><span class="op" id="5981613">(</span><span class="op" id="5981614">)</span>&nbsp;<span class="comment" id="5981616">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981647">if</span>&nbsp;<span class="op" id="5981650">*</span><span class="ident" id="5981651">memProfile</span>&nbsp;<span class="op" id="5981662">!=</span>&nbsp;<span class="string" id="5981665">&#34;&#34;</span>&nbsp;<span class="op" id="5981668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981672">f</span><span class="op" id="5981673">,</span>&nbsp;<span class="ident" id="5981675">err</span>&nbsp;<span class="op" id="5981679">:=</span>&nbsp;<span class="ident" id="5981682">os</span><span class="op" id="5981684">.</span><span class="ident" id="5981685">Create</span><span class="op" id="5981691">(</span><span class="ident" id="5981692">toOutputDir</span><span class="op" id="5981703">(</span><span class="op" id="5981704">*</span><span class="ident" id="5981705">memProfile</span><span class="op" id="5981715">)</span><span class="op" id="5981716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981720">if</span>&nbsp;<span class="ident" id="5981723">err</span>&nbsp;<span class="op" id="5981727">!=</span>&nbsp;<span class="ident" id="5981730">nil</span>&nbsp;<span class="op" id="5981734">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981739">fmt</span><span class="op" id="5981742">.</span><span class="ident" id="5981743">Fprintf</span><span class="op" id="5981750">(</span><span class="ident" id="5981751">os</span><span class="op" id="5981753">.</span><span class="ident" id="5981754">Stderr</span><span class="op" id="5981760">,</span>&nbsp;<span class="string" id="5981762">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="5981777">,</span>&nbsp;<span class="ident" id="5981779">err</span><span class="op" id="5981782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981787">os</span><span class="op" id="5981789">.</span><span class="ident" id="5981790">Exit</span><span class="op" id="5981794">(</span><span class="num" id="5981795">2</span><span class="op" id="5981796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981804">runtime</span><span class="op" id="5981811">.</span><span class="ident" id="5981812">GC</span><span class="op" id="5981814">(</span><span class="op" id="5981815">)</span>&nbsp;<span class="comment" id="5981817">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981849">if</span>&nbsp;<span class="ident" id="5981852">err</span>&nbsp;<span class="op" id="5981856">=</span>&nbsp;<span class="ident" id="5981858">pprof</span><span class="op" id="5981863">.</span><span class="ident" id="5981864">WriteHeapProfile</span><span class="op" id="5981880">(</span><span class="ident" id="5981881">f</span><span class="op" id="5981882">)</span><span class="op" id="5981883">;</span>&nbsp;<span class="ident" id="5981885">err</span>&nbsp;<span class="op" id="5981889">!=</span>&nbsp;<span class="ident" id="5981892">nil</span>&nbsp;<span class="op" id="5981896">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981901">fmt</span><span class="op" id="5981904">.</span><span class="ident" id="5981905">Fprintf</span><span class="op" id="5981912">(</span><span class="ident" id="5981913">os</span><span class="op" id="5981915">.</span><span class="ident" id="5981916">Stderr</span><span class="op" id="5981922">,</span>&nbsp;<span class="string" id="5981924">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="5981955">,</span>&nbsp;<span class="op" id="5981957">*</span><span class="ident" id="5981958">memProfile</span><span class="op" id="5981968">,</span>&nbsp;<span class="ident" id="5981970">err</span><span class="op" id="5981973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981978">os</span><span class="op" id="5981980">.</span><span class="ident" id="5981981">Exit</span><span class="op" id="5981985">(</span><span class="num" id="5981986">2</span><span class="op" id="5981987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981995">f</span><span class="op" id="5981996">.</span><span class="ident" id="5981997">Close</span><span class="op" id="5982002">(</span><span class="op" id="5982003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982006">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982009">if</span>&nbsp;<span class="op" id="5982012">*</span><span class="ident" id="5982013">blockProfile</span>&nbsp;<span class="op" id="5982026">!=</span>&nbsp;<span class="string" id="5982029">&#34;&#34;</span>&nbsp;<span class="op" id="5982032">&amp;&amp;</span>&nbsp;<span class="op" id="5982035">*</span><span class="ident" id="5982036">blockProfileRate</span>&nbsp;<span class="op" id="5982053">&gt;=</span>&nbsp;<span class="num" id="5982056">0</span>&nbsp;<span class="op" id="5982058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982062">f</span><span class="op" id="5982063">,</span>&nbsp;<span class="ident" id="5982065">err</span>&nbsp;<span class="op" id="5982069">:=</span>&nbsp;<span class="ident" id="5982072">os</span><span class="op" id="5982074">.</span><span class="ident" id="5982075">Create</span><span class="op" id="5982081">(</span><span class="ident" id="5982082">toOutputDir</span><span class="op" id="5982093">(</span><span class="op" id="5982094">*</span><span class="ident" id="5982095">blockProfile</span><span class="op" id="5982107">)</span><span class="op" id="5982108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982112">if</span>&nbsp;<span class="ident" id="5982115">err</span>&nbsp;<span class="op" id="5982119">!=</span>&nbsp;<span class="ident" id="5982122">nil</span>&nbsp;<span class="op" id="5982126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982131">fmt</span><span class="op" id="5982134">.</span><span class="ident" id="5982135">Fprintf</span><span class="op" id="5982142">(</span><span class="ident" id="5982143">os</span><span class="op" id="5982145">.</span><span class="ident" id="5982146">Stderr</span><span class="op" id="5982152">,</span>&nbsp;<span class="string" id="5982154">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="5982169">,</span>&nbsp;<span class="ident" id="5982171">err</span><span class="op" id="5982174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982179">os</span><span class="op" id="5982181">.</span><span class="ident" id="5982182">Exit</span><span class="op" id="5982186">(</span><span class="num" id="5982187">2</span><span class="op" id="5982188">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982196">if</span>&nbsp;<span class="ident" id="5982199">err</span>&nbsp;<span class="op" id="5982203">=</span>&nbsp;<span class="ident" id="5982205">pprof</span><span class="op" id="5982210">.</span><span class="ident" id="5982211">Lookup</span><span class="op" id="5982217">(</span><span class="string" id="5982218">&#34;block&#34;</span><span class="op" id="5982225">)</span><span class="op" id="5982226">.</span><span class="ident" id="5982227">WriteTo</span><span class="op" id="5982234">(</span><span class="ident" id="5982235">f</span><span class="op" id="5982236">,</span>&nbsp;<span class="num" id="5982238">0</span><span class="op" id="5982239">)</span><span class="op" id="5982240">;</span>&nbsp;<span class="ident" id="5982242">err</span>&nbsp;<span class="op" id="5982246">!=</span>&nbsp;<span class="ident" id="5982249">nil</span>&nbsp;<span class="op" id="5982253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982258">fmt</span><span class="op" id="5982261">.</span><span class="ident" id="5982262">Fprintf</span><span class="op" id="5982269">(</span><span class="ident" id="5982270">os</span><span class="op" id="5982272">.</span><span class="ident" id="5982273">Stderr</span><span class="op" id="5982279">,</span>&nbsp;<span class="string" id="5982281">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="5982312">,</span>&nbsp;<span class="op" id="5982314">*</span><span class="ident" id="5982315">blockProfile</span><span class="op" id="5982327">,</span>&nbsp;<span class="ident" id="5982329">err</span><span class="op" id="5982332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982337">os</span><span class="op" id="5982339">.</span><span class="ident" id="5982340">Exit</span><span class="op" id="5982344">(</span><span class="num" id="5982345">2</span><span class="op" id="5982346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982350">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982354">f</span><span class="op" id="5982355">.</span><span class="ident" id="5982356">Close</span><span class="op" id="5982361">(</span><span class="op" id="5982362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982368">if</span>&nbsp;<span class="ident" id="5982371">cover</span><span class="op" id="5982376">.</span><span class="ident" id="5982377">Mode</span>&nbsp;<span class="op" id="5982382">!=</span>&nbsp;<span class="string" id="5982385">&#34;&#34;</span>&nbsp;<span class="op" id="5982388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982392">coverReport</span><span class="op" id="5982403">(</span><span class="op" id="5982404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982407">}</span><br>
<span class="lineno">645</span><span class="op" id="5982409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982412">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="5982487">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="5982547">func</span>&nbsp;<span class="ident" id="5982552">toOutputDir</span><span class="op" id="5982563">(</span><span class="ident" id="5982564">path</span>&nbsp;<span class="builtintype" id="5982569">string</span><span class="op" id="5982575">)</span>&nbsp;<span class="builtintype" id="5982577">string</span>&nbsp;<span class="op" id="5982584">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982587">if</span>&nbsp;<span class="op" id="5982590">*</span><span class="ident" id="5982591">outputDir</span>&nbsp;<span class="op" id="5982601">==</span>&nbsp;<span class="string" id="5982604">&#34;&#34;</span>&nbsp;<span class="op" id="5982607">||</span>&nbsp;<span class="ident" id="5982610">path</span>&nbsp;<span class="op" id="5982615">==</span>&nbsp;<span class="string" id="5982618">&#34;&#34;</span>&nbsp;<span class="op" id="5982621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982625">return</span>&nbsp;<span class="ident" id="5982632">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982641">if</span>&nbsp;<span class="ident" id="5982644">runtime</span><span class="op" id="5982651">.</span><span class="ident" id="5982652">GOOS</span>&nbsp;<span class="op" id="5982657">==</span>&nbsp;<span class="string" id="5982660">&#34;windows&#34;</span>&nbsp;<span class="op" id="5982670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982674">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982740">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982793">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982856">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982925">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982984">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5983053">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983091">if</span>&nbsp;<span class="builtinfunc" id="5983094">len</span><span class="op" id="5983097">(</span><span class="ident" id="5983098">path</span><span class="op" id="5983102">)</span>&nbsp;<span class="op" id="5983104">&gt;=</span>&nbsp;<span class="num" id="5983107">2</span>&nbsp;<span class="op" id="5983109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983114">letter</span><span class="op" id="5983120">,</span>&nbsp;<span class="ident" id="5983122">colon</span>&nbsp;<span class="op" id="5983128">:=</span>&nbsp;<span class="ident" id="5983131">path</span><span class="op" id="5983135">[</span><span class="num" id="5983136">0</span><span class="op" id="5983137">]</span><span class="op" id="5983138">,</span>&nbsp;<span class="ident" id="5983140">path</span><span class="op" id="5983144">[</span><span class="num" id="5983145">1</span><span class="op" id="5983146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983151">if</span>&nbsp;<span class="op" id="5983154">(</span><span class="string" id="5983155">&#39;a&#39;</span>&nbsp;<span class="op" id="5983159">&lt;=</span>&nbsp;<span class="ident" id="5983162">letter</span>&nbsp;<span class="op" id="5983169">&amp;&amp;</span>&nbsp;<span class="ident" id="5983172">letter</span>&nbsp;<span class="op" id="5983179">&lt;=</span>&nbsp;<span class="string" id="5983182">&#39;z&#39;</span>&nbsp;<span class="op" id="5983186">||</span>&nbsp;<span class="string" id="5983189">&#39;A&#39;</span>&nbsp;<span class="op" id="5983193">&lt;=</span>&nbsp;<span class="ident" id="5983196">letter</span>&nbsp;<span class="op" id="5983203">&amp;&amp;</span>&nbsp;<span class="ident" id="5983206">letter</span>&nbsp;<span class="op" id="5983213">&lt;=</span>&nbsp;<span class="string" id="5983216">&#39;Z&#39;</span><span class="op" id="5983219">)</span>&nbsp;<span class="op" id="5983221">&amp;&amp;</span>&nbsp;<span class="ident" id="5983224">colon</span>&nbsp;<span class="op" id="5983230">==</span>&nbsp;<span class="string" id="5983233">&#39;:&#39;</span>&nbsp;<span class="op" id="5983237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5983243">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983317">return</span>&nbsp;<span class="ident" id="5983324">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983342">if</span>&nbsp;<span class="ident" id="5983345">os</span><span class="op" id="5983347">.</span><span class="ident" id="5983348">IsPathSeparator</span><span class="op" id="5983363">(</span><span class="ident" id="5983364">path</span><span class="op" id="5983368">[</span><span class="num" id="5983369">0</span><span class="op" id="5983370">]</span><span class="op" id="5983371">)</span>&nbsp;<span class="op" id="5983373">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983377">return</span>&nbsp;<span class="ident" id="5983384">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983393">return</span>&nbsp;<span class="ident" id="5983400">fmt</span><span class="op" id="5983403">.</span><span class="ident" id="5983404">Sprintf</span><span class="op" id="5983411">(</span><span class="string" id="5983412">&#34;%s%c%s&#34;</span><span class="op" id="5983420">,</span>&nbsp;<span class="op" id="5983422">*</span><span class="ident" id="5983423">outputDir</span><span class="op" id="5983432">,</span>&nbsp;<span class="ident" id="5983434">os</span><span class="op" id="5983436">.</span><span class="ident" id="5983437">PathSeparator</span><span class="op" id="5983450">,</span>&nbsp;<span class="ident" id="5983452">path</span><span class="op" id="5983456">)</span><br>
<span class="lineno"></span><span class="op" id="5983458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="5983461">var</span>&nbsp;<span class="ident" id="5983465">timer</span>&nbsp;<span class="op" id="5983471">*</span><span class="ident" id="5983472">time</span><span class="op" id="5983476">.</span><span class="ident" id="5983477">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5983484">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5983528">func</span>&nbsp;<span class="ident" id="5983533">startAlarm</span><span class="op" id="5983543">(</span><span class="op" id="5983544">)</span>&nbsp;<span class="op" id="5983546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983549">if</span>&nbsp;<span class="op" id="5983552">*</span><span class="ident" id="5983553">timeout</span>&nbsp;<span class="op" id="5983561">&gt;</span>&nbsp;<span class="num" id="5983563">0</span>&nbsp;<span class="op" id="5983565">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983569">timer</span>&nbsp;<span class="op" id="5983575">=</span>&nbsp;<span class="ident" id="5983577">time</span><span class="op" id="5983581">.</span><span class="ident" id="5983582">AfterFunc</span><span class="op" id="5983591">(</span><span class="op" id="5983592">*</span><span class="ident" id="5983593">timeout</span><span class="op" id="5983600">,</span>&nbsp;<span class="keyword" id="5983602">func</span><span class="op" id="5983606">(</span><span class="op" id="5983607">)</span>&nbsp;<span class="op" id="5983609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5983614">panic</span><span class="op" id="5983619">(</span><span class="ident" id="5983620">fmt</span><span class="op" id="5983623">.</span><span class="ident" id="5983624">Sprintf</span><span class="op" id="5983631">(</span><span class="string" id="5983632">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="5983657">,</span>&nbsp;<span class="op" id="5983659">*</span><span class="ident" id="5983660">timeout</span><span class="op" id="5983667">)</span><span class="op" id="5983668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983672">}</span><span class="op" id="5983673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983676">}</span><br>
<span class="lineno"></span><span class="op" id="5983678">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="5983681">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="5983715">func</span>&nbsp;<span class="ident" id="5983720">stopAlarm</span><span class="op" id="5983729">(</span><span class="op" id="5983730">)</span>&nbsp;<span class="op" id="5983732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983735">if</span>&nbsp;<span class="op" id="5983738">*</span><span class="ident" id="5983739">timeout</span>&nbsp;<span class="op" id="5983747">&gt;</span>&nbsp;<span class="num" id="5983749">0</span>&nbsp;<span class="op" id="5983751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983755">timer</span><span class="op" id="5983760">.</span><span class="ident" id="5983761">Stop</span><span class="op" id="5983765">(</span><span class="op" id="5983766">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983769">}</span><br>
<span class="lineno"></span><span class="op" id="5983771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5983774">func</span>&nbsp;<span class="ident" id="5983779">parseCpuList</span><span class="op" id="5983791">(</span><span class="op" id="5983792">)</span>&nbsp;<span class="op" id="5983794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983797">for</span>&nbsp;<span class="ident" id="5983801">_</span><span class="op" id="5983802">,</span>&nbsp;<span class="ident" id="5983804">val</span>&nbsp;<span class="op" id="5983808">:=</span>&nbsp;<span class="keyword" id="5983811">range</span>&nbsp;<span class="ident" id="5983817">strings</span><span class="op" id="5983824">.</span><span class="ident" id="5983825">Split</span><span class="op" id="5983830">(</span><span class="op" id="5983831">*</span><span class="ident" id="5983832">cpuListStr</span><span class="op" id="5983842">,</span>&nbsp;<span class="string" id="5983844">&#34;,&#34;</span><span class="op" id="5983847">)</span>&nbsp;<span class="op" id="5983849">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983853">val</span>&nbsp;<span class="op" id="5983857">=</span>&nbsp;<span class="ident" id="5983859">strings</span><span class="op" id="5983866">.</span><span class="ident" id="5983867">TrimSpace</span><span class="op" id="5983876">(</span><span class="ident" id="5983877">val</span><span class="op" id="5983880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983884">if</span>&nbsp;<span class="ident" id="5983887">val</span>&nbsp;<span class="op" id="5983891">==</span>&nbsp;<span class="string" id="5983894">&#34;&#34;</span>&nbsp;<span class="op" id="5983897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983902">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983917">cpu</span><span class="op" id="5983920">,</span>&nbsp;<span class="ident" id="5983922">err</span>&nbsp;<span class="op" id="5983926">:=</span>&nbsp;<span class="ident" id="5983929">strconv</span><span class="op" id="5983936">.</span><span class="ident" id="5983937">Atoi</span><span class="op" id="5983941">(</span><span class="ident" id="5983942">val</span><span class="op" id="5983945">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983949">if</span>&nbsp;<span class="ident" id="5983952">err</span>&nbsp;<span class="op" id="5983956">!=</span>&nbsp;<span class="ident" id="5983959">nil</span>&nbsp;<span class="op" id="5983963">||</span>&nbsp;<span class="ident" id="5983966">cpu</span>&nbsp;<span class="op" id="5983970">&lt;=</span>&nbsp;<span class="num" id="5983973">0</span>&nbsp;<span class="op" id="5983975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983980">fmt</span><span class="op" id="5983983">.</span><span class="ident" id="5983984">Fprintf</span><span class="op" id="5983991">(</span><span class="ident" id="5983992">os</span><span class="op" id="5983994">.</span><span class="ident" id="5983995">Stderr</span><span class="op" id="5984001">,</span>&nbsp;<span class="string" id="5984003">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="5984046">,</span>&nbsp;<span class="ident" id="5984048">val</span><span class="op" id="5984051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984056">os</span><span class="op" id="5984058">.</span><span class="ident" id="5984059">Exit</span><span class="op" id="5984063">(</span><span class="num" id="5984064">1</span><span class="op" id="5984065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984073">cpuList</span>&nbsp;<span class="op" id="5984081">=</span>&nbsp;<span class="builtinfunc" id="5984083">append</span><span class="op" id="5984089">(</span><span class="ident" id="5984090">cpuList</span><span class="op" id="5984097">,</span>&nbsp;<span class="ident" id="5984099">cpu</span><span class="op" id="5984102">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984108">if</span>&nbsp;<span class="ident" id="5984111">cpuList</span>&nbsp;<span class="op" id="5984119">==</span>&nbsp;<span class="ident" id="5984122">nil</span>&nbsp;<span class="op" id="5984126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984130">cpuList</span>&nbsp;<span class="op" id="5984138">=</span>&nbsp;<span class="builtinfunc" id="5984140">append</span><span class="op" id="5984146">(</span><span class="ident" id="5984147">cpuList</span><span class="op" id="5984154">,</span>&nbsp;<span class="ident" id="5984156">runtime</span><span class="op" id="5984163">.</span><span class="ident" id="5984164">GOMAXPROCS</span><span class="op" id="5984174">(</span><span class="op" id="5984175">-</span><span class="num" id="5984176">1</span><span class="op" id="5984177">)</span><span class="op" id="5984178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984181">}</span><br>
<span class="lineno"></span><span class="op" id="5984183">}</span>
</div>
</body>
</html>
