<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8221261">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8221316">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8221370">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8221421">package</span>&nbsp;<span class="ident" id="8221429">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8221434">import</span>&nbsp;<span class="op" id="8221441">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8221444">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8221457">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8221468">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8221479">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8221486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8221489">func</span>&nbsp;<span class="ident" id="8221494">TestMutexLock</span><span class="op" id="8221507">(</span><span class="ident" id="8221508">t</span>&nbsp;<span class="op" id="8221510">*</span><span class="ident" id="8221511">testing</span><span class="op" id="8221518">.</span><span class="ident" id="8221519">T</span><span class="op" id="8221520">)</span>&nbsp;<span class="op" id="8221522">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221525">var</span>&nbsp;<span class="ident" id="8221529">mu</span>&nbsp;<span class="ident" id="8221532">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221542">if</span>&nbsp;<span class="op" id="8221545">!</span><span class="ident" id="8221546">mu</span><span class="op" id="8221548">.</span><span class="ident" id="8221549">Incref</span><span class="op" id="8221555">(</span><span class="op" id="8221556">)</span>&nbsp;<span class="op" id="8221558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221562">t</span><span class="op" id="8221563">.</span><span class="ident" id="8221564">Fatal</span><span class="op" id="8221569">(</span><span class="string" id="8221570">&#34;broken&#34;</span><span class="op" id="8221578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221581">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221584">if</span>&nbsp;<span class="ident" id="8221587">mu</span><span class="op" id="8221589">.</span><span class="ident" id="8221590">Decref</span><span class="op" id="8221596">(</span><span class="op" id="8221597">)</span>&nbsp;<span class="op" id="8221599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221603">t</span><span class="op" id="8221604">.</span><span class="ident" id="8221605">Fatal</span><span class="op" id="8221610">(</span><span class="string" id="8221611">&#34;broken&#34;</span><span class="op" id="8221619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221626">if</span>&nbsp;<span class="op" id="8221629">!</span><span class="ident" id="8221630">mu</span><span class="op" id="8221632">.</span><span class="ident" id="8221633">RWLock</span><span class="op" id="8221639">(</span><span class="builtintype" id="8221640">true</span><span class="op" id="8221644">)</span>&nbsp;<span class="op" id="8221646">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221650">t</span><span class="op" id="8221651">.</span><span class="ident" id="8221652">Fatal</span><span class="op" id="8221657">(</span><span class="string" id="8221658">&#34;broken&#34;</span><span class="op" id="8221666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221672">if</span>&nbsp;<span class="ident" id="8221675">mu</span><span class="op" id="8221677">.</span><span class="ident" id="8221678">RWUnlock</span><span class="op" id="8221686">(</span><span class="builtintype" id="8221687">true</span><span class="op" id="8221691">)</span>&nbsp;<span class="op" id="8221693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221697">t</span><span class="op" id="8221698">.</span><span class="ident" id="8221699">Fatal</span><span class="op" id="8221704">(</span><span class="string" id="8221705">&#34;broken&#34;</span><span class="op" id="8221713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221716">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221720">if</span>&nbsp;<span class="op" id="8221723">!</span><span class="ident" id="8221724">mu</span><span class="op" id="8221726">.</span><span class="ident" id="8221727">RWLock</span><span class="op" id="8221733">(</span><span class="builtintype" id="8221734">false</span><span class="op" id="8221739">)</span>&nbsp;<span class="op" id="8221741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221745">t</span><span class="op" id="8221746">.</span><span class="ident" id="8221747">Fatal</span><span class="op" id="8221752">(</span><span class="string" id="8221753">&#34;broken&#34;</span><span class="op" id="8221761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221767">if</span>&nbsp;<span class="ident" id="8221770">mu</span><span class="op" id="8221772">.</span><span class="ident" id="8221773">RWUnlock</span><span class="op" id="8221781">(</span><span class="builtintype" id="8221782">false</span><span class="op" id="8221787">)</span>&nbsp;<span class="op" id="8221789">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221793">t</span><span class="op" id="8221794">.</span><span class="ident" id="8221795">Fatal</span><span class="op" id="8221800">(</span><span class="string" id="8221801">&#34;broken&#34;</span><span class="op" id="8221809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221812">}</span><br>
<span class="lineno"></span><span class="op" id="8221814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8221817">func</span>&nbsp;<span class="ident" id="8221822">TestMutexClose</span><span class="op" id="8221836">(</span><span class="ident" id="8221837">t</span>&nbsp;<span class="op" id="8221839">*</span><span class="ident" id="8221840">testing</span><span class="op" id="8221847">.</span><span class="ident" id="8221848">T</span><span class="op" id="8221849">)</span>&nbsp;<span class="op" id="8221851">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221854">var</span>&nbsp;<span class="ident" id="8221858">mu</span>&nbsp;<span class="ident" id="8221861">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221870">if</span>&nbsp;<span class="op" id="8221873">!</span><span class="ident" id="8221874">mu</span><span class="op" id="8221876">.</span><span class="ident" id="8221877">IncrefAndClose</span><span class="op" id="8221891">(</span><span class="op" id="8221892">)</span>&nbsp;<span class="op" id="8221894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221898">t</span><span class="op" id="8221899">.</span><span class="ident" id="8221900">Fatal</span><span class="op" id="8221905">(</span><span class="string" id="8221906">&#34;broken&#34;</span><span class="op" id="8221914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221921">if</span>&nbsp;<span class="ident" id="8221924">mu</span><span class="op" id="8221926">.</span><span class="ident" id="8221927">Incref</span><span class="op" id="8221933">(</span><span class="op" id="8221934">)</span>&nbsp;<span class="op" id="8221936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221940">t</span><span class="op" id="8221941">.</span><span class="ident" id="8221942">Fatal</span><span class="op" id="8221947">(</span><span class="string" id="8221948">&#34;broken&#34;</span><span class="op" id="8221956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8221959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8221962">if</span>&nbsp;<span class="ident" id="8221965">mu</span><span class="op" id="8221967">.</span><span class="ident" id="8221968">RWLock</span><span class="op" id="8221974">(</span><span class="builtintype" id="8221975">true</span><span class="op" id="8221979">)</span>&nbsp;<span class="op" id="8221981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8221985">t</span><span class="op" id="8221986">.</span><span class="ident" id="8221987">Fatal</span><span class="op" id="8221992">(</span><span class="string" id="8221993">&#34;broken&#34;</span><span class="op" id="8222001">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222007">if</span>&nbsp;<span class="ident" id="8222010">mu</span><span class="op" id="8222012">.</span><span class="ident" id="8222013">RWLock</span><span class="op" id="8222019">(</span><span class="builtintype" id="8222020">false</span><span class="op" id="8222025">)</span>&nbsp;<span class="op" id="8222027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222031">t</span><span class="op" id="8222032">.</span><span class="ident" id="8222033">Fatal</span><span class="op" id="8222038">(</span><span class="string" id="8222039">&#34;broken&#34;</span><span class="op" id="8222047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222053">if</span>&nbsp;<span class="ident" id="8222056">mu</span><span class="op" id="8222058">.</span><span class="ident" id="8222059">IncrefAndClose</span><span class="op" id="8222073">(</span><span class="op" id="8222074">)</span>&nbsp;<span class="op" id="8222076">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222080">t</span><span class="op" id="8222081">.</span><span class="ident" id="8222082">Fatal</span><span class="op" id="8222087">(</span><span class="string" id="8222088">&#34;broken&#34;</span><span class="op" id="8222096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222099">}</span><br>
<span class="lineno"></span><span class="op" id="8222101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8222104">func</span>&nbsp;<span class="ident" id="8222109">TestMutexCloseUnblock</span><span class="op" id="8222130">(</span><span class="ident" id="8222131">t</span>&nbsp;<span class="op" id="8222133">*</span><span class="ident" id="8222134">testing</span><span class="op" id="8222141">.</span><span class="ident" id="8222142">T</span><span class="op" id="8222143">)</span>&nbsp;<span class="op" id="8222145">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222148">c</span>&nbsp;<span class="op" id="8222150">:=</span>&nbsp;<span class="builtinfunc" id="8222153">make</span><span class="op" id="8222157">(</span><span class="keyword" id="8222158">chan</span>&nbsp;<span class="builtintype" id="8222163">bool</span><span class="op" id="8222167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222170">var</span>&nbsp;<span class="ident" id="8222174">mu</span>&nbsp;<span class="ident" id="8222177">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222186">mu</span><span class="op" id="8222188">.</span><span class="ident" id="8222189">RWLock</span><span class="op" id="8222195">(</span><span class="builtintype" id="8222196">true</span><span class="op" id="8222200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222203">for</span>&nbsp;<span class="ident" id="8222207">i</span>&nbsp;<span class="op" id="8222209">:=</span>&nbsp;<span class="num" id="8222212">0</span><span class="op" id="8222213">;</span>&nbsp;<span class="ident" id="8222215">i</span>&nbsp;<span class="op" id="8222217">&lt;</span>&nbsp;<span class="num" id="8222219">4</span><span class="op" id="8222220">;</span>&nbsp;<span class="ident" id="8222222">i</span><span class="op" id="8222223">++</span>&nbsp;<span class="op" id="8222226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222230">go</span>&nbsp;<span class="keyword" id="8222233">func</span><span class="op" id="8222237">(</span><span class="op" id="8222238">)</span>&nbsp;<span class="op" id="8222240">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222245">if</span>&nbsp;<span class="ident" id="8222248">mu</span><span class="op" id="8222250">.</span><span class="ident" id="8222251">RWLock</span><span class="op" id="8222257">(</span><span class="builtintype" id="8222258">true</span><span class="op" id="8222262">)</span>&nbsp;<span class="op" id="8222264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222270">t</span><span class="op" id="8222271">.</span><span class="ident" id="8222272">Error</span><span class="op" id="8222277">(</span><span class="string" id="8222278">&#34;broken&#34;</span><span class="op" id="8222286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222292">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222307">c</span>&nbsp;<span class="op" id="8222309">&lt;-</span>&nbsp;<span class="builtintype" id="8222312">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222319">}</span><span class="op" id="8222320">(</span><span class="op" id="8222321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8222327">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222394">time</span><span class="op" id="8222398">.</span><span class="ident" id="8222399">Sleep</span><span class="op" id="8222404">(</span><span class="ident" id="8222405">time</span><span class="op" id="8222409">.</span><span class="ident" id="8222410">Millisecond</span><span class="op" id="8222421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222424">select</span>&nbsp;<span class="op" id="8222431">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222434">case</span>&nbsp;<span class="op" id="8222439">&lt;-</span><span class="ident" id="8222441">c</span><span class="op" id="8222442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222446">t</span><span class="op" id="8222447">.</span><span class="ident" id="8222448">Fatal</span><span class="op" id="8222453">(</span><span class="string" id="8222454">&#34;broken&#34;</span><span class="op" id="8222462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222465">default</span><span class="op" id="8222472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222478">mu</span><span class="op" id="8222480">.</span><span class="ident" id="8222481">IncrefAndClose</span><span class="op" id="8222495">(</span><span class="op" id="8222496">)</span>&nbsp;<span class="comment" id="8222498">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222528">for</span>&nbsp;<span class="ident" id="8222532">i</span>&nbsp;<span class="op" id="8222534">:=</span>&nbsp;<span class="num" id="8222537">0</span><span class="op" id="8222538">;</span>&nbsp;<span class="ident" id="8222540">i</span>&nbsp;<span class="op" id="8222542">&lt;</span>&nbsp;<span class="num" id="8222544">4</span><span class="op" id="8222545">;</span>&nbsp;<span class="ident" id="8222547">i</span><span class="op" id="8222548">++</span>&nbsp;<span class="op" id="8222551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222555">select</span>&nbsp;<span class="op" id="8222562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222566">case</span>&nbsp;<span class="op" id="8222571">&lt;-</span><span class="ident" id="8222573">c</span><span class="op" id="8222574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222578">case</span>&nbsp;<span class="op" id="8222583">&lt;-</span><span class="ident" id="8222585">time</span><span class="op" id="8222589">.</span><span class="ident" id="8222590">After</span><span class="op" id="8222595">(</span><span class="num" id="8222596">10</span>&nbsp;<span class="op" id="8222599">*</span>&nbsp;<span class="ident" id="8222601">time</span><span class="op" id="8222605">.</span><span class="ident" id="8222606">Second</span><span class="op" id="8222612">)</span><span class="op" id="8222613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222618">t</span><span class="op" id="8222619">.</span><span class="ident" id="8222620">Fatal</span><span class="op" id="8222625">(</span><span class="string" id="8222626">&#34;broken&#34;</span><span class="op" id="8222634">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222644">if</span>&nbsp;<span class="ident" id="8222647">mu</span><span class="op" id="8222649">.</span><span class="ident" id="8222650">Decref</span><span class="op" id="8222656">(</span><span class="op" id="8222657">)</span>&nbsp;<span class="op" id="8222659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222663">t</span><span class="op" id="8222664">.</span><span class="ident" id="8222665">Fatal</span><span class="op" id="8222670">(</span><span class="string" id="8222671">&#34;broken&#34;</span><span class="op" id="8222679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222682">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222685">if</span>&nbsp;<span class="op" id="8222688">!</span><span class="ident" id="8222689">mu</span><span class="op" id="8222691">.</span><span class="ident" id="8222692">RWUnlock</span><span class="op" id="8222700">(</span><span class="builtintype" id="8222701">true</span><span class="op" id="8222705">)</span>&nbsp;<span class="op" id="8222707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222711">t</span><span class="op" id="8222712">.</span><span class="ident" id="8222713">Fatal</span><span class="op" id="8222718">(</span><span class="string" id="8222719">&#34;broken&#34;</span><span class="op" id="8222727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222730">}</span><br>
<span class="lineno"></span><span class="op" id="8222732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8222735">func</span>&nbsp;<span class="ident" id="8222740">TestMutexPanic</span><span class="op" id="8222754">(</span><span class="ident" id="8222755">t</span>&nbsp;<span class="op" id="8222757">*</span><span class="ident" id="8222758">testing</span><span class="op" id="8222765">.</span><span class="ident" id="8222766">T</span><span class="op" id="8222767">)</span>&nbsp;<span class="op" id="8222769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222772">ensurePanics</span>&nbsp;<span class="op" id="8222785">:=</span>&nbsp;<span class="keyword" id="8222788">func</span><span class="op" id="8222792">(</span><span class="ident" id="8222793">f</span>&nbsp;<span class="keyword" id="8222795">func</span><span class="op" id="8222799">(</span><span class="op" id="8222800">)</span><span class="op" id="8222801">)</span>&nbsp;<span class="op" id="8222803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222807">defer</span>&nbsp;<span class="keyword" id="8222813">func</span><span class="op" id="8222817">(</span><span class="op" id="8222818">)</span>&nbsp;<span class="op" id="8222820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222825">if</span>&nbsp;<span class="builtinfunc" id="8222828">recover</span><span class="op" id="8222835">(</span><span class="op" id="8222836">)</span>&nbsp;<span class="op" id="8222838">==</span>&nbsp;<span class="ident" id="8222841">nil</span>&nbsp;<span class="op" id="8222845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222851">t</span><span class="op" id="8222852">.</span><span class="ident" id="8222853">Fatal</span><span class="op" id="8222858">(</span><span class="string" id="8222859">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="8222875">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222884">}</span><span class="op" id="8222885">(</span><span class="op" id="8222886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222890">f</span><span class="op" id="8222891">(</span><span class="op" id="8222892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8222895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8222899">var</span>&nbsp;<span class="ident" id="8222903">mu</span>&nbsp;<span class="ident" id="8222906">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222915">ensurePanics</span><span class="op" id="8222927">(</span><span class="keyword" id="8222928">func</span><span class="op" id="8222932">(</span><span class="op" id="8222933">)</span>&nbsp;<span class="op" id="8222935">{</span>&nbsp;<span class="ident" id="8222937">mu</span><span class="op" id="8222939">.</span><span class="ident" id="8222940">Decref</span><span class="op" id="8222946">(</span><span class="op" id="8222947">)</span>&nbsp;<span class="op" id="8222949">}</span><span class="op" id="8222950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222953">ensurePanics</span><span class="op" id="8222965">(</span><span class="keyword" id="8222966">func</span><span class="op" id="8222970">(</span><span class="op" id="8222971">)</span>&nbsp;<span class="op" id="8222973">{</span>&nbsp;<span class="ident" id="8222975">mu</span><span class="op" id="8222977">.</span><span class="ident" id="8222978">RWUnlock</span><span class="op" id="8222986">(</span><span class="builtintype" id="8222987">true</span><span class="op" id="8222991">)</span>&nbsp;<span class="op" id="8222993">}</span><span class="op" id="8222994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8222997">ensurePanics</span><span class="op" id="8223009">(</span><span class="keyword" id="8223010">func</span><span class="op" id="8223014">(</span><span class="op" id="8223015">)</span>&nbsp;<span class="op" id="8223017">{</span>&nbsp;<span class="ident" id="8223019">mu</span><span class="op" id="8223021">.</span><span class="ident" id="8223022">RWUnlock</span><span class="op" id="8223030">(</span><span class="builtintype" id="8223031">false</span><span class="op" id="8223036">)</span>&nbsp;<span class="op" id="8223038">}</span><span class="op" id="8223039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223043">ensurePanics</span><span class="op" id="8223055">(</span><span class="keyword" id="8223056">func</span><span class="op" id="8223060">(</span><span class="op" id="8223061">)</span>&nbsp;<span class="op" id="8223063">{</span>&nbsp;<span class="ident" id="8223065">mu</span><span class="op" id="8223067">.</span><span class="ident" id="8223068">Incref</span><span class="op" id="8223074">(</span><span class="op" id="8223075">)</span><span class="op" id="8223076">;</span>&nbsp;<span class="ident" id="8223078">mu</span><span class="op" id="8223080">.</span><span class="ident" id="8223081">Decref</span><span class="op" id="8223087">(</span><span class="op" id="8223088">)</span><span class="op" id="8223089">;</span>&nbsp;<span class="ident" id="8223091">mu</span><span class="op" id="8223093">.</span><span class="ident" id="8223094">Decref</span><span class="op" id="8223100">(</span><span class="op" id="8223101">)</span>&nbsp;<span class="op" id="8223103">}</span><span class="op" id="8223104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223107">ensurePanics</span><span class="op" id="8223119">(</span><span class="keyword" id="8223120">func</span><span class="op" id="8223124">(</span><span class="op" id="8223125">)</span>&nbsp;<span class="op" id="8223127">{</span>&nbsp;<span class="ident" id="8223129">mu</span><span class="op" id="8223131">.</span><span class="ident" id="8223132">RWLock</span><span class="op" id="8223138">(</span><span class="builtintype" id="8223139">true</span><span class="op" id="8223143">)</span><span class="op" id="8223144">;</span>&nbsp;<span class="ident" id="8223146">mu</span><span class="op" id="8223148">.</span><span class="ident" id="8223149">RWUnlock</span><span class="op" id="8223157">(</span><span class="builtintype" id="8223158">true</span><span class="op" id="8223162">)</span><span class="op" id="8223163">;</span>&nbsp;<span class="ident" id="8223165">mu</span><span class="op" id="8223167">.</span><span class="ident" id="8223168">RWUnlock</span><span class="op" id="8223176">(</span><span class="builtintype" id="8223177">true</span><span class="op" id="8223181">)</span>&nbsp;<span class="op" id="8223183">}</span><span class="op" id="8223184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223187">ensurePanics</span><span class="op" id="8223199">(</span><span class="keyword" id="8223200">func</span><span class="op" id="8223204">(</span><span class="op" id="8223205">)</span>&nbsp;<span class="op" id="8223207">{</span>&nbsp;<span class="ident" id="8223209">mu</span><span class="op" id="8223211">.</span><span class="ident" id="8223212">RWLock</span><span class="op" id="8223218">(</span><span class="builtintype" id="8223219">false</span><span class="op" id="8223224">)</span><span class="op" id="8223225">;</span>&nbsp;<span class="ident" id="8223227">mu</span><span class="op" id="8223229">.</span><span class="ident" id="8223230">RWUnlock</span><span class="op" id="8223238">(</span><span class="builtintype" id="8223239">false</span><span class="op" id="8223244">)</span><span class="op" id="8223245">;</span>&nbsp;<span class="ident" id="8223247">mu</span><span class="op" id="8223249">.</span><span class="ident" id="8223250">RWUnlock</span><span class="op" id="8223258">(</span><span class="builtintype" id="8223259">false</span><span class="op" id="8223264">)</span>&nbsp;<span class="op" id="8223266">}</span><span class="op" id="8223267">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8223271">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223309">mu</span><span class="op" id="8223311">.</span><span class="ident" id="8223312">Incref</span><span class="op" id="8223318">(</span><span class="op" id="8223319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223322">mu</span><span class="op" id="8223324">.</span><span class="ident" id="8223325">Decref</span><span class="op" id="8223331">(</span><span class="op" id="8223332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223335">mu</span><span class="op" id="8223337">.</span><span class="ident" id="8223338">RWLock</span><span class="op" id="8223344">(</span><span class="builtintype" id="8223345">true</span><span class="op" id="8223349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223352">mu</span><span class="op" id="8223354">.</span><span class="ident" id="8223355">RWUnlock</span><span class="op" id="8223363">(</span><span class="builtintype" id="8223364">true</span><span class="op" id="8223368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223371">mu</span><span class="op" id="8223373">.</span><span class="ident" id="8223374">RWLock</span><span class="op" id="8223380">(</span><span class="builtintype" id="8223381">false</span><span class="op" id="8223386">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223389">mu</span><span class="op" id="8223391">.</span><span class="ident" id="8223392">RWUnlock</span><span class="op" id="8223400">(</span><span class="builtintype" id="8223401">false</span><span class="op" id="8223406">)</span><br>
<span class="lineno"></span><span class="op" id="8223408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8223411">func</span>&nbsp;<span class="ident" id="8223416">TestMutexStress</span><span class="op" id="8223431">(</span><span class="ident" id="8223432">t</span>&nbsp;<span class="op" id="8223434">*</span><span class="ident" id="8223435">testing</span><span class="op" id="8223442">.</span><span class="ident" id="8223443">T</span><span class="op" id="8223444">)</span>&nbsp;<span class="op" id="8223446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223449">P</span>&nbsp;<span class="op" id="8223451">:=</span>&nbsp;<span class="num" id="8223454">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223457">N</span>&nbsp;<span class="op" id="8223459">:=</span>&nbsp;<span class="builtintype" id="8223462">int</span><span class="op" id="8223465">(</span><span class="num" id="8223466">1e6</span><span class="op" id="8223469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223472">if</span>&nbsp;<span class="ident" id="8223475">testing</span><span class="op" id="8223482">.</span><span class="ident" id="8223483">Short</span><span class="op" id="8223488">(</span><span class="op" id="8223489">)</span>&nbsp;<span class="op" id="8223491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223495">P</span>&nbsp;<span class="op" id="8223497">=</span>&nbsp;<span class="num" id="8223499">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223503">N</span>&nbsp;<span class="op" id="8223505">=</span>&nbsp;<span class="num" id="8223507">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8223512">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223515">defer</span>&nbsp;<span class="ident" id="8223521">runtime</span><span class="op" id="8223528">.</span><span class="ident" id="8223529">GOMAXPROCS</span><span class="op" id="8223539">(</span><span class="ident" id="8223540">runtime</span><span class="op" id="8223547">.</span><span class="ident" id="8223548">GOMAXPROCS</span><span class="op" id="8223558">(</span><span class="ident" id="8223559">P</span><span class="op" id="8223560">)</span><span class="op" id="8223561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223564">done</span>&nbsp;<span class="op" id="8223569">:=</span>&nbsp;<span class="builtinfunc" id="8223572">make</span><span class="op" id="8223576">(</span><span class="keyword" id="8223577">chan</span>&nbsp;<span class="builtintype" id="8223582">bool</span><span class="op" id="8223586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223589">var</span>&nbsp;<span class="ident" id="8223593">mu</span>&nbsp;<span class="ident" id="8223596">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223605">var</span>&nbsp;<span class="ident" id="8223609">readState</span>&nbsp;<span class="op" id="8223619">[</span><span class="num" id="8223620">2</span><span class="op" id="8223621">]</span><span class="ident" id="8223622">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223630">var</span>&nbsp;<span class="ident" id="8223634">writeState</span>&nbsp;<span class="op" id="8223645">[</span><span class="num" id="8223646">2</span><span class="op" id="8223647">]</span><span class="ident" id="8223648">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223656">for</span>&nbsp;<span class="ident" id="8223660">p</span>&nbsp;<span class="op" id="8223662">:=</span>&nbsp;<span class="num" id="8223665">0</span><span class="op" id="8223666">;</span>&nbsp;<span class="ident" id="8223668">p</span>&nbsp;<span class="op" id="8223670">&lt;</span>&nbsp;<span class="ident" id="8223672">P</span><span class="op" id="8223673">;</span>&nbsp;<span class="ident" id="8223675">p</span><span class="op" id="8223676">++</span>&nbsp;<span class="op" id="8223679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223683">go</span>&nbsp;<span class="keyword" id="8223686">func</span><span class="op" id="8223690">(</span><span class="op" id="8223691">)</span>&nbsp;<span class="op" id="8223693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223698">r</span>&nbsp;<span class="op" id="8223700">:=</span>&nbsp;<span class="ident" id="8223703">rand</span><span class="op" id="8223707">.</span><span class="ident" id="8223708">New</span><span class="op" id="8223711">(</span><span class="ident" id="8223712">rand</span><span class="op" id="8223716">.</span><span class="ident" id="8223717">NewSource</span><span class="op" id="8223726">(</span><span class="ident" id="8223727">rand</span><span class="op" id="8223731">.</span><span class="ident" id="8223732">Int63</span><span class="op" id="8223737">(</span><span class="op" id="8223738">)</span><span class="op" id="8223739">)</span><span class="op" id="8223740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223745">for</span>&nbsp;<span class="ident" id="8223749">i</span>&nbsp;<span class="op" id="8223751">:=</span>&nbsp;<span class="num" id="8223754">0</span><span class="op" id="8223755">;</span>&nbsp;<span class="ident" id="8223757">i</span>&nbsp;<span class="op" id="8223759">&lt;</span>&nbsp;<span class="ident" id="8223761">N</span><span class="op" id="8223762">;</span>&nbsp;<span class="ident" id="8223764">i</span><span class="op" id="8223765">++</span>&nbsp;<span class="op" id="8223768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223774">switch</span>&nbsp;<span class="ident" id="8223781">r</span><span class="op" id="8223782">.</span><span class="ident" id="8223783">Intn</span><span class="op" id="8223787">(</span><span class="num" id="8223788">3</span><span class="op" id="8223789">)</span>&nbsp;<span class="op" id="8223791">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223797">case</span>&nbsp;<span class="num" id="8223802">0</span><span class="op" id="8223803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223810">if</span>&nbsp;<span class="op" id="8223813">!</span><span class="ident" id="8223814">mu</span><span class="op" id="8223816">.</span><span class="ident" id="8223817">Incref</span><span class="op" id="8223823">(</span><span class="op" id="8223824">)</span>&nbsp;<span class="op" id="8223826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223834">t</span><span class="op" id="8223835">.</span><span class="ident" id="8223836">Error</span><span class="op" id="8223841">(</span><span class="string" id="8223842">&#34;broken&#34;</span><span class="op" id="8223850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223858">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8223870">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223877">if</span>&nbsp;<span class="ident" id="8223880">mu</span><span class="op" id="8223882">.</span><span class="ident" id="8223883">Decref</span><span class="op" id="8223889">(</span><span class="op" id="8223890">)</span>&nbsp;<span class="op" id="8223892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223900">t</span><span class="op" id="8223901">.</span><span class="ident" id="8223902">Error</span><span class="op" id="8223907">(</span><span class="string" id="8223908">&#34;broken&#34;</span><span class="op" id="8223916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223924">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8223936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223942">case</span>&nbsp;<span class="num" id="8223947">1</span><span class="op" id="8223948">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223955">if</span>&nbsp;<span class="op" id="8223958">!</span><span class="ident" id="8223959">mu</span><span class="op" id="8223961">.</span><span class="ident" id="8223962">RWLock</span><span class="op" id="8223968">(</span><span class="builtintype" id="8223969">true</span><span class="op" id="8223973">)</span>&nbsp;<span class="op" id="8223975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223983">t</span><span class="op" id="8223984">.</span><span class="ident" id="8223985">Error</span><span class="op" id="8223990">(</span><span class="string" id="8223991">&#34;broken&#34;</span><span class="op" id="8223999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224007">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8224026">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224088">if</span>&nbsp;<span class="ident" id="8224091">readState</span><span class="op" id="8224100">[</span><span class="num" id="8224101">0</span><span class="op" id="8224102">]</span>&nbsp;<span class="op" id="8224104">!=</span>&nbsp;<span class="ident" id="8224107">readState</span><span class="op" id="8224116">[</span><span class="num" id="8224117">1</span><span class="op" id="8224118">]</span>&nbsp;<span class="op" id="8224120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224128">t</span><span class="op" id="8224129">.</span><span class="ident" id="8224130">Error</span><span class="op" id="8224135">(</span><span class="string" id="8224136">&#34;broken&#34;</span><span class="op" id="8224144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224152">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224171">readState</span><span class="op" id="8224180">[</span><span class="num" id="8224181">0</span><span class="op" id="8224182">]</span><span class="op" id="8224183">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224191">readState</span><span class="op" id="8224200">[</span><span class="num" id="8224201">1</span><span class="op" id="8224202">]</span><span class="op" id="8224203">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224211">if</span>&nbsp;<span class="ident" id="8224214">mu</span><span class="op" id="8224216">.</span><span class="ident" id="8224217">RWUnlock</span><span class="op" id="8224225">(</span><span class="builtintype" id="8224226">true</span><span class="op" id="8224230">)</span>&nbsp;<span class="op" id="8224232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224240">t</span><span class="op" id="8224241">.</span><span class="ident" id="8224242">Error</span><span class="op" id="8224247">(</span><span class="string" id="8224248">&#34;broken&#34;</span><span class="op" id="8224256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224264">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224276">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224282">case</span>&nbsp;<span class="num" id="8224287">2</span><span class="op" id="8224288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224295">if</span>&nbsp;<span class="op" id="8224298">!</span><span class="ident" id="8224299">mu</span><span class="op" id="8224301">.</span><span class="ident" id="8224302">RWLock</span><span class="op" id="8224308">(</span><span class="builtintype" id="8224309">false</span><span class="op" id="8224314">)</span>&nbsp;<span class="op" id="8224316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224324">t</span><span class="op" id="8224325">.</span><span class="ident" id="8224326">Error</span><span class="op" id="8224331">(</span><span class="string" id="8224332">&#34;broken&#34;</span><span class="op" id="8224340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224348">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224360">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8224367">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224429">if</span>&nbsp;<span class="ident" id="8224432">writeState</span><span class="op" id="8224442">[</span><span class="num" id="8224443">0</span><span class="op" id="8224444">]</span>&nbsp;<span class="op" id="8224446">!=</span>&nbsp;<span class="ident" id="8224449">writeState</span><span class="op" id="8224459">[</span><span class="num" id="8224460">1</span><span class="op" id="8224461">]</span>&nbsp;<span class="op" id="8224463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224471">t</span><span class="op" id="8224472">.</span><span class="ident" id="8224473">Error</span><span class="op" id="8224478">(</span><span class="string" id="8224479">&#34;broken&#34;</span><span class="op" id="8224487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224495">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224507">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224514">writeState</span><span class="op" id="8224524">[</span><span class="num" id="8224525">0</span><span class="op" id="8224526">]</span><span class="op" id="8224527">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224535">writeState</span><span class="op" id="8224545">[</span><span class="num" id="8224546">1</span><span class="op" id="8224547">]</span><span class="op" id="8224548">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224556">if</span>&nbsp;<span class="ident" id="8224559">mu</span><span class="op" id="8224561">.</span><span class="ident" id="8224562">RWUnlock</span><span class="op" id="8224570">(</span><span class="builtintype" id="8224571">false</span><span class="op" id="8224576">)</span>&nbsp;<span class="op" id="8224578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224586">t</span><span class="op" id="8224587">.</span><span class="ident" id="8224588">Error</span><span class="op" id="8224593">(</span><span class="string" id="8224594">&#34;broken&#34;</span><span class="op" id="8224602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224610">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224638">done</span>&nbsp;<span class="op" id="8224643">&lt;-</span>&nbsp;<span class="builtintype" id="8224646">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224653">}</span><span class="op" id="8224654">(</span><span class="op" id="8224655">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224661">for</span>&nbsp;<span class="ident" id="8224665">p</span>&nbsp;<span class="op" id="8224667">:=</span>&nbsp;<span class="num" id="8224670">0</span><span class="op" id="8224671">;</span>&nbsp;<span class="ident" id="8224673">p</span>&nbsp;<span class="op" id="8224675">&lt;</span>&nbsp;<span class="ident" id="8224677">P</span><span class="op" id="8224678">;</span>&nbsp;<span class="ident" id="8224680">p</span><span class="op" id="8224681">++</span>&nbsp;<span class="op" id="8224684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224688">&lt;-</span><span class="ident" id="8224690">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224699">if</span>&nbsp;<span class="op" id="8224702">!</span><span class="ident" id="8224703">mu</span><span class="op" id="8224705">.</span><span class="ident" id="8224706">IncrefAndClose</span><span class="op" id="8224720">(</span><span class="op" id="8224721">)</span>&nbsp;<span class="op" id="8224723">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224727">t</span><span class="op" id="8224728">.</span><span class="ident" id="8224729">Fatal</span><span class="op" id="8224734">(</span><span class="string" id="8224735">&#34;broken&#34;</span><span class="op" id="8224743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224749">if</span>&nbsp;<span class="op" id="8224752">!</span><span class="ident" id="8224753">mu</span><span class="op" id="8224755">.</span><span class="ident" id="8224756">Decref</span><span class="op" id="8224762">(</span><span class="op" id="8224763">)</span>&nbsp;<span class="op" id="8224765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224769">t</span><span class="op" id="8224770">.</span><span class="ident" id="8224771">Fatal</span><span class="op" id="8224776">(</span><span class="string" id="8224777">&#34;broken&#34;</span><span class="op" id="8224785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224788">}</span><br>
<span class="lineno">195</span><span class="op" id="8224790">}</span>
</div>
</body>
</html>
