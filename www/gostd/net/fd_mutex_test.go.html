<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html" class="current">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6603168">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6603223">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6603277">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6603328">package</span>&nbsp;<span class="ident" id="6603336">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6603341">import</span>&nbsp;<span class="op" id="6603348">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6603351">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6603364">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6603375">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6603386">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6603393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6603396">func</span>&nbsp;<span class="ident" id="6603401">TestMutexLock</span><span class="op" id="6603414">(</span><span class="ident" id="6603415">t</span>&nbsp;<span class="op" id="6603417">*</span><span class="ident" id="6603418">testing</span><span class="op" id="6603425">.</span><span class="ident" id="6603426">T</span><span class="op" id="6603427">)</span>&nbsp;<span class="op" id="6603429">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603432">var</span>&nbsp;<span class="ident" id="6603436">mu</span>&nbsp;<span class="ident" id="6603439">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603449">if</span>&nbsp;<span class="op" id="6603452">!</span><span class="ident" id="6603453">mu</span><span class="op" id="6603455">.</span><span class="ident" id="6603456">Incref</span><span class="op" id="6603462">(</span><span class="op" id="6603463">)</span>&nbsp;<span class="op" id="6603465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603469">t</span><span class="op" id="6603470">.</span><span class="ident" id="6603471">Fatal</span><span class="op" id="6603476">(</span><span class="string" id="6603477">&#34;broken&#34;</span><span class="op" id="6603485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603488">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603491">if</span>&nbsp;<span class="ident" id="6603494">mu</span><span class="op" id="6603496">.</span><span class="ident" id="6603497">Decref</span><span class="op" id="6603503">(</span><span class="op" id="6603504">)</span>&nbsp;<span class="op" id="6603506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603510">t</span><span class="op" id="6603511">.</span><span class="ident" id="6603512">Fatal</span><span class="op" id="6603517">(</span><span class="string" id="6603518">&#34;broken&#34;</span><span class="op" id="6603526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603533">if</span>&nbsp;<span class="op" id="6603536">!</span><span class="ident" id="6603537">mu</span><span class="op" id="6603539">.</span><span class="ident" id="6603540">RWLock</span><span class="op" id="6603546">(</span><span class="builtintype" id="6603547">true</span><span class="op" id="6603551">)</span>&nbsp;<span class="op" id="6603553">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603557">t</span><span class="op" id="6603558">.</span><span class="ident" id="6603559">Fatal</span><span class="op" id="6603564">(</span><span class="string" id="6603565">&#34;broken&#34;</span><span class="op" id="6603573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603579">if</span>&nbsp;<span class="ident" id="6603582">mu</span><span class="op" id="6603584">.</span><span class="ident" id="6603585">RWUnlock</span><span class="op" id="6603593">(</span><span class="builtintype" id="6603594">true</span><span class="op" id="6603598">)</span>&nbsp;<span class="op" id="6603600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603604">t</span><span class="op" id="6603605">.</span><span class="ident" id="6603606">Fatal</span><span class="op" id="6603611">(</span><span class="string" id="6603612">&#34;broken&#34;</span><span class="op" id="6603620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603623">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603627">if</span>&nbsp;<span class="op" id="6603630">!</span><span class="ident" id="6603631">mu</span><span class="op" id="6603633">.</span><span class="ident" id="6603634">RWLock</span><span class="op" id="6603640">(</span><span class="builtintype" id="6603641">false</span><span class="op" id="6603646">)</span>&nbsp;<span class="op" id="6603648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603652">t</span><span class="op" id="6603653">.</span><span class="ident" id="6603654">Fatal</span><span class="op" id="6603659">(</span><span class="string" id="6603660">&#34;broken&#34;</span><span class="op" id="6603668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603674">if</span>&nbsp;<span class="ident" id="6603677">mu</span><span class="op" id="6603679">.</span><span class="ident" id="6603680">RWUnlock</span><span class="op" id="6603688">(</span><span class="builtintype" id="6603689">false</span><span class="op" id="6603694">)</span>&nbsp;<span class="op" id="6603696">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603700">t</span><span class="op" id="6603701">.</span><span class="ident" id="6603702">Fatal</span><span class="op" id="6603707">(</span><span class="string" id="6603708">&#34;broken&#34;</span><span class="op" id="6603716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603719">}</span><br>
<span class="lineno"></span><span class="op" id="6603721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6603724">func</span>&nbsp;<span class="ident" id="6603729">TestMutexClose</span><span class="op" id="6603743">(</span><span class="ident" id="6603744">t</span>&nbsp;<span class="op" id="6603746">*</span><span class="ident" id="6603747">testing</span><span class="op" id="6603754">.</span><span class="ident" id="6603755">T</span><span class="op" id="6603756">)</span>&nbsp;<span class="op" id="6603758">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603761">var</span>&nbsp;<span class="ident" id="6603765">mu</span>&nbsp;<span class="ident" id="6603768">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603777">if</span>&nbsp;<span class="op" id="6603780">!</span><span class="ident" id="6603781">mu</span><span class="op" id="6603783">.</span><span class="ident" id="6603784">IncrefAndClose</span><span class="op" id="6603798">(</span><span class="op" id="6603799">)</span>&nbsp;<span class="op" id="6603801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603805">t</span><span class="op" id="6603806">.</span><span class="ident" id="6603807">Fatal</span><span class="op" id="6603812">(</span><span class="string" id="6603813">&#34;broken&#34;</span><span class="op" id="6603821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603828">if</span>&nbsp;<span class="ident" id="6603831">mu</span><span class="op" id="6603833">.</span><span class="ident" id="6603834">Incref</span><span class="op" id="6603840">(</span><span class="op" id="6603841">)</span>&nbsp;<span class="op" id="6603843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603847">t</span><span class="op" id="6603848">.</span><span class="ident" id="6603849">Fatal</span><span class="op" id="6603854">(</span><span class="string" id="6603855">&#34;broken&#34;</span><span class="op" id="6603863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603869">if</span>&nbsp;<span class="ident" id="6603872">mu</span><span class="op" id="6603874">.</span><span class="ident" id="6603875">RWLock</span><span class="op" id="6603881">(</span><span class="builtintype" id="6603882">true</span><span class="op" id="6603886">)</span>&nbsp;<span class="op" id="6603888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603892">t</span><span class="op" id="6603893">.</span><span class="ident" id="6603894">Fatal</span><span class="op" id="6603899">(</span><span class="string" id="6603900">&#34;broken&#34;</span><span class="op" id="6603908">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603914">if</span>&nbsp;<span class="ident" id="6603917">mu</span><span class="op" id="6603919">.</span><span class="ident" id="6603920">RWLock</span><span class="op" id="6603926">(</span><span class="builtintype" id="6603927">false</span><span class="op" id="6603932">)</span>&nbsp;<span class="op" id="6603934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603938">t</span><span class="op" id="6603939">.</span><span class="ident" id="6603940">Fatal</span><span class="op" id="6603945">(</span><span class="string" id="6603946">&#34;broken&#34;</span><span class="op" id="6603954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603960">if</span>&nbsp;<span class="ident" id="6603963">mu</span><span class="op" id="6603965">.</span><span class="ident" id="6603966">IncrefAndClose</span><span class="op" id="6603980">(</span><span class="op" id="6603981">)</span>&nbsp;<span class="op" id="6603983">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603987">t</span><span class="op" id="6603988">.</span><span class="ident" id="6603989">Fatal</span><span class="op" id="6603994">(</span><span class="string" id="6603995">&#34;broken&#34;</span><span class="op" id="6604003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604006">}</span><br>
<span class="lineno"></span><span class="op" id="6604008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6604011">func</span>&nbsp;<span class="ident" id="6604016">TestMutexCloseUnblock</span><span class="op" id="6604037">(</span><span class="ident" id="6604038">t</span>&nbsp;<span class="op" id="6604040">*</span><span class="ident" id="6604041">testing</span><span class="op" id="6604048">.</span><span class="ident" id="6604049">T</span><span class="op" id="6604050">)</span>&nbsp;<span class="op" id="6604052">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604055">c</span>&nbsp;<span class="op" id="6604057">:=</span>&nbsp;<span class="builtinfunc" id="6604060">make</span><span class="op" id="6604064">(</span><span class="keyword" id="6604065">chan</span>&nbsp;<span class="builtintype" id="6604070">bool</span><span class="op" id="6604074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604077">var</span>&nbsp;<span class="ident" id="6604081">mu</span>&nbsp;<span class="ident" id="6604084">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604093">mu</span><span class="op" id="6604095">.</span><span class="ident" id="6604096">RWLock</span><span class="op" id="6604102">(</span><span class="builtintype" id="6604103">true</span><span class="op" id="6604107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604110">for</span>&nbsp;<span class="ident" id="6604114">i</span>&nbsp;<span class="op" id="6604116">:=</span>&nbsp;<span class="num" id="6604119">0</span><span class="op" id="6604120">;</span>&nbsp;<span class="ident" id="6604122">i</span>&nbsp;<span class="op" id="6604124">&lt;</span>&nbsp;<span class="num" id="6604126">4</span><span class="op" id="6604127">;</span>&nbsp;<span class="ident" id="6604129">i</span><span class="op" id="6604130">++</span>&nbsp;<span class="op" id="6604133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604137">go</span>&nbsp;<span class="keyword" id="6604140">func</span><span class="op" id="6604144">(</span><span class="op" id="6604145">)</span>&nbsp;<span class="op" id="6604147">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604152">if</span>&nbsp;<span class="ident" id="6604155">mu</span><span class="op" id="6604157">.</span><span class="ident" id="6604158">RWLock</span><span class="op" id="6604164">(</span><span class="builtintype" id="6604165">true</span><span class="op" id="6604169">)</span>&nbsp;<span class="op" id="6604171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604177">t</span><span class="op" id="6604178">.</span><span class="ident" id="6604179">Error</span><span class="op" id="6604184">(</span><span class="string" id="6604185">&#34;broken&#34;</span><span class="op" id="6604193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604199">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604214">c</span>&nbsp;<span class="op" id="6604216">&lt;-</span>&nbsp;<span class="builtintype" id="6604219">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604226">}</span><span class="op" id="6604227">(</span><span class="op" id="6604228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6604234">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604301">time</span><span class="op" id="6604305">.</span><span class="ident" id="6604306">Sleep</span><span class="op" id="6604311">(</span><span class="ident" id="6604312">time</span><span class="op" id="6604316">.</span><span class="ident" id="6604317">Millisecond</span><span class="op" id="6604328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604331">select</span>&nbsp;<span class="op" id="6604338">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604341">case</span>&nbsp;<span class="op" id="6604346">&lt;-</span><span class="ident" id="6604348">c</span><span class="op" id="6604349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604353">t</span><span class="op" id="6604354">.</span><span class="ident" id="6604355">Fatal</span><span class="op" id="6604360">(</span><span class="string" id="6604361">&#34;broken&#34;</span><span class="op" id="6604369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604372">default</span><span class="op" id="6604379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604385">mu</span><span class="op" id="6604387">.</span><span class="ident" id="6604388">IncrefAndClose</span><span class="op" id="6604402">(</span><span class="op" id="6604403">)</span>&nbsp;<span class="comment" id="6604405">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604435">for</span>&nbsp;<span class="ident" id="6604439">i</span>&nbsp;<span class="op" id="6604441">:=</span>&nbsp;<span class="num" id="6604444">0</span><span class="op" id="6604445">;</span>&nbsp;<span class="ident" id="6604447">i</span>&nbsp;<span class="op" id="6604449">&lt;</span>&nbsp;<span class="num" id="6604451">4</span><span class="op" id="6604452">;</span>&nbsp;<span class="ident" id="6604454">i</span><span class="op" id="6604455">++</span>&nbsp;<span class="op" id="6604458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604462">select</span>&nbsp;<span class="op" id="6604469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604473">case</span>&nbsp;<span class="op" id="6604478">&lt;-</span><span class="ident" id="6604480">c</span><span class="op" id="6604481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604485">case</span>&nbsp;<span class="op" id="6604490">&lt;-</span><span class="ident" id="6604492">time</span><span class="op" id="6604496">.</span><span class="ident" id="6604497">After</span><span class="op" id="6604502">(</span><span class="num" id="6604503">10</span>&nbsp;<span class="op" id="6604506">*</span>&nbsp;<span class="ident" id="6604508">time</span><span class="op" id="6604512">.</span><span class="ident" id="6604513">Second</span><span class="op" id="6604519">)</span><span class="op" id="6604520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604525">t</span><span class="op" id="6604526">.</span><span class="ident" id="6604527">Fatal</span><span class="op" id="6604532">(</span><span class="string" id="6604533">&#34;broken&#34;</span><span class="op" id="6604541">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604551">if</span>&nbsp;<span class="ident" id="6604554">mu</span><span class="op" id="6604556">.</span><span class="ident" id="6604557">Decref</span><span class="op" id="6604563">(</span><span class="op" id="6604564">)</span>&nbsp;<span class="op" id="6604566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604570">t</span><span class="op" id="6604571">.</span><span class="ident" id="6604572">Fatal</span><span class="op" id="6604577">(</span><span class="string" id="6604578">&#34;broken&#34;</span><span class="op" id="6604586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604589">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604592">if</span>&nbsp;<span class="op" id="6604595">!</span><span class="ident" id="6604596">mu</span><span class="op" id="6604598">.</span><span class="ident" id="6604599">RWUnlock</span><span class="op" id="6604607">(</span><span class="builtintype" id="6604608">true</span><span class="op" id="6604612">)</span>&nbsp;<span class="op" id="6604614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604618">t</span><span class="op" id="6604619">.</span><span class="ident" id="6604620">Fatal</span><span class="op" id="6604625">(</span><span class="string" id="6604626">&#34;broken&#34;</span><span class="op" id="6604634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604637">}</span><br>
<span class="lineno"></span><span class="op" id="6604639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6604642">func</span>&nbsp;<span class="ident" id="6604647">TestMutexPanic</span><span class="op" id="6604661">(</span><span class="ident" id="6604662">t</span>&nbsp;<span class="op" id="6604664">*</span><span class="ident" id="6604665">testing</span><span class="op" id="6604672">.</span><span class="ident" id="6604673">T</span><span class="op" id="6604674">)</span>&nbsp;<span class="op" id="6604676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604679">ensurePanics</span>&nbsp;<span class="op" id="6604692">:=</span>&nbsp;<span class="keyword" id="6604695">func</span><span class="op" id="6604699">(</span><span class="ident" id="6604700">f</span>&nbsp;<span class="keyword" id="6604702">func</span><span class="op" id="6604706">(</span><span class="op" id="6604707">)</span><span class="op" id="6604708">)</span>&nbsp;<span class="op" id="6604710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604714">defer</span>&nbsp;<span class="keyword" id="6604720">func</span><span class="op" id="6604724">(</span><span class="op" id="6604725">)</span>&nbsp;<span class="op" id="6604727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604732">if</span>&nbsp;<span class="builtinfunc" id="6604735">recover</span><span class="op" id="6604742">(</span><span class="op" id="6604743">)</span>&nbsp;<span class="op" id="6604745">==</span>&nbsp;<span class="ident" id="6604748">nil</span>&nbsp;<span class="op" id="6604752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604758">t</span><span class="op" id="6604759">.</span><span class="ident" id="6604760">Fatal</span><span class="op" id="6604765">(</span><span class="string" id="6604766">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6604782">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604791">}</span><span class="op" id="6604792">(</span><span class="op" id="6604793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604797">f</span><span class="op" id="6604798">(</span><span class="op" id="6604799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604806">var</span>&nbsp;<span class="ident" id="6604810">mu</span>&nbsp;<span class="ident" id="6604813">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604822">ensurePanics</span><span class="op" id="6604834">(</span><span class="keyword" id="6604835">func</span><span class="op" id="6604839">(</span><span class="op" id="6604840">)</span>&nbsp;<span class="op" id="6604842">{</span>&nbsp;<span class="ident" id="6604844">mu</span><span class="op" id="6604846">.</span><span class="ident" id="6604847">Decref</span><span class="op" id="6604853">(</span><span class="op" id="6604854">)</span>&nbsp;<span class="op" id="6604856">}</span><span class="op" id="6604857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604860">ensurePanics</span><span class="op" id="6604872">(</span><span class="keyword" id="6604873">func</span><span class="op" id="6604877">(</span><span class="op" id="6604878">)</span>&nbsp;<span class="op" id="6604880">{</span>&nbsp;<span class="ident" id="6604882">mu</span><span class="op" id="6604884">.</span><span class="ident" id="6604885">RWUnlock</span><span class="op" id="6604893">(</span><span class="builtintype" id="6604894">true</span><span class="op" id="6604898">)</span>&nbsp;<span class="op" id="6604900">}</span><span class="op" id="6604901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604904">ensurePanics</span><span class="op" id="6604916">(</span><span class="keyword" id="6604917">func</span><span class="op" id="6604921">(</span><span class="op" id="6604922">)</span>&nbsp;<span class="op" id="6604924">{</span>&nbsp;<span class="ident" id="6604926">mu</span><span class="op" id="6604928">.</span><span class="ident" id="6604929">RWUnlock</span><span class="op" id="6604937">(</span><span class="builtintype" id="6604938">false</span><span class="op" id="6604943">)</span>&nbsp;<span class="op" id="6604945">}</span><span class="op" id="6604946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604950">ensurePanics</span><span class="op" id="6604962">(</span><span class="keyword" id="6604963">func</span><span class="op" id="6604967">(</span><span class="op" id="6604968">)</span>&nbsp;<span class="op" id="6604970">{</span>&nbsp;<span class="ident" id="6604972">mu</span><span class="op" id="6604974">.</span><span class="ident" id="6604975">Incref</span><span class="op" id="6604981">(</span><span class="op" id="6604982">)</span><span class="op" id="6604983">;</span>&nbsp;<span class="ident" id="6604985">mu</span><span class="op" id="6604987">.</span><span class="ident" id="6604988">Decref</span><span class="op" id="6604994">(</span><span class="op" id="6604995">)</span><span class="op" id="6604996">;</span>&nbsp;<span class="ident" id="6604998">mu</span><span class="op" id="6605000">.</span><span class="ident" id="6605001">Decref</span><span class="op" id="6605007">(</span><span class="op" id="6605008">)</span>&nbsp;<span class="op" id="6605010">}</span><span class="op" id="6605011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605014">ensurePanics</span><span class="op" id="6605026">(</span><span class="keyword" id="6605027">func</span><span class="op" id="6605031">(</span><span class="op" id="6605032">)</span>&nbsp;<span class="op" id="6605034">{</span>&nbsp;<span class="ident" id="6605036">mu</span><span class="op" id="6605038">.</span><span class="ident" id="6605039">RWLock</span><span class="op" id="6605045">(</span><span class="builtintype" id="6605046">true</span><span class="op" id="6605050">)</span><span class="op" id="6605051">;</span>&nbsp;<span class="ident" id="6605053">mu</span><span class="op" id="6605055">.</span><span class="ident" id="6605056">RWUnlock</span><span class="op" id="6605064">(</span><span class="builtintype" id="6605065">true</span><span class="op" id="6605069">)</span><span class="op" id="6605070">;</span>&nbsp;<span class="ident" id="6605072">mu</span><span class="op" id="6605074">.</span><span class="ident" id="6605075">RWUnlock</span><span class="op" id="6605083">(</span><span class="builtintype" id="6605084">true</span><span class="op" id="6605088">)</span>&nbsp;<span class="op" id="6605090">}</span><span class="op" id="6605091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605094">ensurePanics</span><span class="op" id="6605106">(</span><span class="keyword" id="6605107">func</span><span class="op" id="6605111">(</span><span class="op" id="6605112">)</span>&nbsp;<span class="op" id="6605114">{</span>&nbsp;<span class="ident" id="6605116">mu</span><span class="op" id="6605118">.</span><span class="ident" id="6605119">RWLock</span><span class="op" id="6605125">(</span><span class="builtintype" id="6605126">false</span><span class="op" id="6605131">)</span><span class="op" id="6605132">;</span>&nbsp;<span class="ident" id="6605134">mu</span><span class="op" id="6605136">.</span><span class="ident" id="6605137">RWUnlock</span><span class="op" id="6605145">(</span><span class="builtintype" id="6605146">false</span><span class="op" id="6605151">)</span><span class="op" id="6605152">;</span>&nbsp;<span class="ident" id="6605154">mu</span><span class="op" id="6605156">.</span><span class="ident" id="6605157">RWUnlock</span><span class="op" id="6605165">(</span><span class="builtintype" id="6605166">false</span><span class="op" id="6605171">)</span>&nbsp;<span class="op" id="6605173">}</span><span class="op" id="6605174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6605178">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605216">mu</span><span class="op" id="6605218">.</span><span class="ident" id="6605219">Incref</span><span class="op" id="6605225">(</span><span class="op" id="6605226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605229">mu</span><span class="op" id="6605231">.</span><span class="ident" id="6605232">Decref</span><span class="op" id="6605238">(</span><span class="op" id="6605239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605242">mu</span><span class="op" id="6605244">.</span><span class="ident" id="6605245">RWLock</span><span class="op" id="6605251">(</span><span class="builtintype" id="6605252">true</span><span class="op" id="6605256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605259">mu</span><span class="op" id="6605261">.</span><span class="ident" id="6605262">RWUnlock</span><span class="op" id="6605270">(</span><span class="builtintype" id="6605271">true</span><span class="op" id="6605275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605278">mu</span><span class="op" id="6605280">.</span><span class="ident" id="6605281">RWLock</span><span class="op" id="6605287">(</span><span class="builtintype" id="6605288">false</span><span class="op" id="6605293">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605296">mu</span><span class="op" id="6605298">.</span><span class="ident" id="6605299">RWUnlock</span><span class="op" id="6605307">(</span><span class="builtintype" id="6605308">false</span><span class="op" id="6605313">)</span><br>
<span class="lineno"></span><span class="op" id="6605315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6605318">func</span>&nbsp;<span class="ident" id="6605323">TestMutexStress</span><span class="op" id="6605338">(</span><span class="ident" id="6605339">t</span>&nbsp;<span class="op" id="6605341">*</span><span class="ident" id="6605342">testing</span><span class="op" id="6605349">.</span><span class="ident" id="6605350">T</span><span class="op" id="6605351">)</span>&nbsp;<span class="op" id="6605353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605356">P</span>&nbsp;<span class="op" id="6605358">:=</span>&nbsp;<span class="num" id="6605361">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605364">N</span>&nbsp;<span class="op" id="6605366">:=</span>&nbsp;<span class="builtintype" id="6605369">int</span><span class="op" id="6605372">(</span><span class="num" id="6605373">1e6</span><span class="op" id="6605376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605379">if</span>&nbsp;<span class="ident" id="6605382">testing</span><span class="op" id="6605389">.</span><span class="ident" id="6605390">Short</span><span class="op" id="6605395">(</span><span class="op" id="6605396">)</span>&nbsp;<span class="op" id="6605398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605402">P</span>&nbsp;<span class="op" id="6605404">=</span>&nbsp;<span class="num" id="6605406">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605410">N</span>&nbsp;<span class="op" id="6605412">=</span>&nbsp;<span class="num" id="6605414">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605419">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605422">defer</span>&nbsp;<span class="ident" id="6605428">runtime</span><span class="op" id="6605435">.</span><span class="ident" id="6605436">GOMAXPROCS</span><span class="op" id="6605446">(</span><span class="ident" id="6605447">runtime</span><span class="op" id="6605454">.</span><span class="ident" id="6605455">GOMAXPROCS</span><span class="op" id="6605465">(</span><span class="ident" id="6605466">P</span><span class="op" id="6605467">)</span><span class="op" id="6605468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605471">done</span>&nbsp;<span class="op" id="6605476">:=</span>&nbsp;<span class="builtinfunc" id="6605479">make</span><span class="op" id="6605483">(</span><span class="keyword" id="6605484">chan</span>&nbsp;<span class="builtintype" id="6605489">bool</span><span class="op" id="6605493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605496">var</span>&nbsp;<span class="ident" id="6605500">mu</span>&nbsp;<span class="ident" id="6605503">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605512">var</span>&nbsp;<span class="ident" id="6605516">readState</span>&nbsp;<span class="op" id="6605526">[</span><span class="num" id="6605527">2</span><span class="op" id="6605528">]</span><span class="ident" id="6605529">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605537">var</span>&nbsp;<span class="ident" id="6605541">writeState</span>&nbsp;<span class="op" id="6605552">[</span><span class="num" id="6605553">2</span><span class="op" id="6605554">]</span><span class="ident" id="6605555">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605563">for</span>&nbsp;<span class="ident" id="6605567">p</span>&nbsp;<span class="op" id="6605569">:=</span>&nbsp;<span class="num" id="6605572">0</span><span class="op" id="6605573">;</span>&nbsp;<span class="ident" id="6605575">p</span>&nbsp;<span class="op" id="6605577">&lt;</span>&nbsp;<span class="ident" id="6605579">P</span><span class="op" id="6605580">;</span>&nbsp;<span class="ident" id="6605582">p</span><span class="op" id="6605583">++</span>&nbsp;<span class="op" id="6605586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605590">go</span>&nbsp;<span class="keyword" id="6605593">func</span><span class="op" id="6605597">(</span><span class="op" id="6605598">)</span>&nbsp;<span class="op" id="6605600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605605">r</span>&nbsp;<span class="op" id="6605607">:=</span>&nbsp;<span class="ident" id="6605610">rand</span><span class="op" id="6605614">.</span><span class="ident" id="6605615">New</span><span class="op" id="6605618">(</span><span class="ident" id="6605619">rand</span><span class="op" id="6605623">.</span><span class="ident" id="6605624">NewSource</span><span class="op" id="6605633">(</span><span class="ident" id="6605634">rand</span><span class="op" id="6605638">.</span><span class="ident" id="6605639">Int63</span><span class="op" id="6605644">(</span><span class="op" id="6605645">)</span><span class="op" id="6605646">)</span><span class="op" id="6605647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605652">for</span>&nbsp;<span class="ident" id="6605656">i</span>&nbsp;<span class="op" id="6605658">:=</span>&nbsp;<span class="num" id="6605661">0</span><span class="op" id="6605662">;</span>&nbsp;<span class="ident" id="6605664">i</span>&nbsp;<span class="op" id="6605666">&lt;</span>&nbsp;<span class="ident" id="6605668">N</span><span class="op" id="6605669">;</span>&nbsp;<span class="ident" id="6605671">i</span><span class="op" id="6605672">++</span>&nbsp;<span class="op" id="6605675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605681">switch</span>&nbsp;<span class="ident" id="6605688">r</span><span class="op" id="6605689">.</span><span class="ident" id="6605690">Intn</span><span class="op" id="6605694">(</span><span class="num" id="6605695">3</span><span class="op" id="6605696">)</span>&nbsp;<span class="op" id="6605698">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605704">case</span>&nbsp;<span class="num" id="6605709">0</span><span class="op" id="6605710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605717">if</span>&nbsp;<span class="op" id="6605720">!</span><span class="ident" id="6605721">mu</span><span class="op" id="6605723">.</span><span class="ident" id="6605724">Incref</span><span class="op" id="6605730">(</span><span class="op" id="6605731">)</span>&nbsp;<span class="op" id="6605733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605741">t</span><span class="op" id="6605742">.</span><span class="ident" id="6605743">Error</span><span class="op" id="6605748">(</span><span class="string" id="6605749">&#34;broken&#34;</span><span class="op" id="6605757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605765">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605777">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605784">if</span>&nbsp;<span class="ident" id="6605787">mu</span><span class="op" id="6605789">.</span><span class="ident" id="6605790">Decref</span><span class="op" id="6605796">(</span><span class="op" id="6605797">)</span>&nbsp;<span class="op" id="6605799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605807">t</span><span class="op" id="6605808">.</span><span class="ident" id="6605809">Error</span><span class="op" id="6605814">(</span><span class="string" id="6605815">&#34;broken&#34;</span><span class="op" id="6605823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605831">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605849">case</span>&nbsp;<span class="num" id="6605854">1</span><span class="op" id="6605855">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605862">if</span>&nbsp;<span class="op" id="6605865">!</span><span class="ident" id="6605866">mu</span><span class="op" id="6605868">.</span><span class="ident" id="6605869">RWLock</span><span class="op" id="6605875">(</span><span class="builtintype" id="6605876">true</span><span class="op" id="6605880">)</span>&nbsp;<span class="op" id="6605882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605890">t</span><span class="op" id="6605891">.</span><span class="ident" id="6605892">Error</span><span class="op" id="6605897">(</span><span class="string" id="6605898">&#34;broken&#34;</span><span class="op" id="6605906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605914">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6605933">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605995">if</span>&nbsp;<span class="ident" id="6605998">readState</span><span class="op" id="6606007">[</span><span class="num" id="6606008">0</span><span class="op" id="6606009">]</span>&nbsp;<span class="op" id="6606011">!=</span>&nbsp;<span class="ident" id="6606014">readState</span><span class="op" id="6606023">[</span><span class="num" id="6606024">1</span><span class="op" id="6606025">]</span>&nbsp;<span class="op" id="6606027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606035">t</span><span class="op" id="6606036">.</span><span class="ident" id="6606037">Error</span><span class="op" id="6606042">(</span><span class="string" id="6606043">&#34;broken&#34;</span><span class="op" id="6606051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606059">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606078">readState</span><span class="op" id="6606087">[</span><span class="num" id="6606088">0</span><span class="op" id="6606089">]</span><span class="op" id="6606090">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606098">readState</span><span class="op" id="6606107">[</span><span class="num" id="6606108">1</span><span class="op" id="6606109">]</span><span class="op" id="6606110">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606118">if</span>&nbsp;<span class="ident" id="6606121">mu</span><span class="op" id="6606123">.</span><span class="ident" id="6606124">RWUnlock</span><span class="op" id="6606132">(</span><span class="builtintype" id="6606133">true</span><span class="op" id="6606137">)</span>&nbsp;<span class="op" id="6606139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606147">t</span><span class="op" id="6606148">.</span><span class="ident" id="6606149">Error</span><span class="op" id="6606154">(</span><span class="string" id="6606155">&#34;broken&#34;</span><span class="op" id="6606163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606171">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606183">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606189">case</span>&nbsp;<span class="num" id="6606194">2</span><span class="op" id="6606195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606202">if</span>&nbsp;<span class="op" id="6606205">!</span><span class="ident" id="6606206">mu</span><span class="op" id="6606208">.</span><span class="ident" id="6606209">RWLock</span><span class="op" id="6606215">(</span><span class="builtintype" id="6606216">false</span><span class="op" id="6606221">)</span>&nbsp;<span class="op" id="6606223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606231">t</span><span class="op" id="6606232">.</span><span class="ident" id="6606233">Error</span><span class="op" id="6606238">(</span><span class="string" id="6606239">&#34;broken&#34;</span><span class="op" id="6606247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606255">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606267">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6606274">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606336">if</span>&nbsp;<span class="ident" id="6606339">writeState</span><span class="op" id="6606349">[</span><span class="num" id="6606350">0</span><span class="op" id="6606351">]</span>&nbsp;<span class="op" id="6606353">!=</span>&nbsp;<span class="ident" id="6606356">writeState</span><span class="op" id="6606366">[</span><span class="num" id="6606367">1</span><span class="op" id="6606368">]</span>&nbsp;<span class="op" id="6606370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606378">t</span><span class="op" id="6606379">.</span><span class="ident" id="6606380">Error</span><span class="op" id="6606385">(</span><span class="string" id="6606386">&#34;broken&#34;</span><span class="op" id="6606394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606402">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606414">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606421">writeState</span><span class="op" id="6606431">[</span><span class="num" id="6606432">0</span><span class="op" id="6606433">]</span><span class="op" id="6606434">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606442">writeState</span><span class="op" id="6606452">[</span><span class="num" id="6606453">1</span><span class="op" id="6606454">]</span><span class="op" id="6606455">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606463">if</span>&nbsp;<span class="ident" id="6606466">mu</span><span class="op" id="6606468">.</span><span class="ident" id="6606469">RWUnlock</span><span class="op" id="6606477">(</span><span class="builtintype" id="6606478">false</span><span class="op" id="6606483">)</span>&nbsp;<span class="op" id="6606485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606493">t</span><span class="op" id="6606494">.</span><span class="ident" id="6606495">Error</span><span class="op" id="6606500">(</span><span class="string" id="6606501">&#34;broken&#34;</span><span class="op" id="6606509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606517">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606545">done</span>&nbsp;<span class="op" id="6606550">&lt;-</span>&nbsp;<span class="builtintype" id="6606553">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606560">}</span><span class="op" id="6606561">(</span><span class="op" id="6606562">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606568">for</span>&nbsp;<span class="ident" id="6606572">p</span>&nbsp;<span class="op" id="6606574">:=</span>&nbsp;<span class="num" id="6606577">0</span><span class="op" id="6606578">;</span>&nbsp;<span class="ident" id="6606580">p</span>&nbsp;<span class="op" id="6606582">&lt;</span>&nbsp;<span class="ident" id="6606584">P</span><span class="op" id="6606585">;</span>&nbsp;<span class="ident" id="6606587">p</span><span class="op" id="6606588">++</span>&nbsp;<span class="op" id="6606591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606595">&lt;-</span><span class="ident" id="6606597">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606606">if</span>&nbsp;<span class="op" id="6606609">!</span><span class="ident" id="6606610">mu</span><span class="op" id="6606612">.</span><span class="ident" id="6606613">IncrefAndClose</span><span class="op" id="6606627">(</span><span class="op" id="6606628">)</span>&nbsp;<span class="op" id="6606630">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606634">t</span><span class="op" id="6606635">.</span><span class="ident" id="6606636">Fatal</span><span class="op" id="6606641">(</span><span class="string" id="6606642">&#34;broken&#34;</span><span class="op" id="6606650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606656">if</span>&nbsp;<span class="op" id="6606659">!</span><span class="ident" id="6606660">mu</span><span class="op" id="6606662">.</span><span class="ident" id="6606663">Decref</span><span class="op" id="6606669">(</span><span class="op" id="6606670">)</span>&nbsp;<span class="op" id="6606672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606676">t</span><span class="op" id="6606677">.</span><span class="ident" id="6606678">Fatal</span><span class="op" id="6606683">(</span><span class="string" id="6606684">&#34;broken&#34;</span><span class="op" id="6606692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606695">}</span><br>
<span class="lineno">195</span><span class="op" id="6606697">}</span>
</div>
</body>
</html>
