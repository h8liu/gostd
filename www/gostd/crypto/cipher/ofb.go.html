<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html" class="current">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3491578">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3491633">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3491687">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3491738">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3491770">package</span>&nbsp;<span class="ident" id="3491778">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3491786">type</span>&nbsp;<span class="ident" id="3491791">ofb</span>&nbsp;<span class="keyword" id="3491795">struct</span>&nbsp;<span class="op" id="3491802">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491805">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491813">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491820">cipher</span>&nbsp;&nbsp;<span class="op" id="3491828">[</span><span class="op" id="3491829">]</span><span class="builtintype" id="3491830">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491836">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491844">[</span><span class="op" id="3491845">]</span><span class="builtintype" id="3491846">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491852">outUsed</span>&nbsp;<span class="builtintype" id="3491860">int</span><br>
<span class="lineno"></span><span class="op" id="3491864">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3491867">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="3491945">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="3492025">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3492047">func</span>&nbsp;<span class="ident" id="3492052">NewOFB</span><span class="op" id="3492058">(</span><span class="ident" id="3492059">b</span>&nbsp;<span class="ident" id="3492061">Block</span><span class="op" id="3492066">,</span>&nbsp;<span class="ident" id="3492068">iv</span>&nbsp;<span class="op" id="3492071">[</span><span class="op" id="3492072">]</span><span class="builtintype" id="3492073">byte</span><span class="op" id="3492077">)</span>&nbsp;<span class="ident" id="3492079">Stream</span>&nbsp;<span class="op" id="3492086">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492089">blockSize</span>&nbsp;<span class="op" id="3492099">:=</span>&nbsp;<span class="ident" id="3492102">b</span><span class="op" id="3492103">.</span><span class="ident" id="3492104">BlockSize</span><span class="op" id="3492113">(</span><span class="op" id="3492114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492117">if</span>&nbsp;<span class="builtinfunc" id="3492120">len</span><span class="op" id="3492123">(</span><span class="ident" id="3492124">iv</span><span class="op" id="3492126">)</span>&nbsp;<span class="op" id="3492128">!=</span>&nbsp;<span class="ident" id="3492131">blockSize</span>&nbsp;<span class="op" id="3492141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492145">return</span>&nbsp;<span class="ident" id="3492152">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492160">bufSize</span>&nbsp;<span class="op" id="3492168">:=</span>&nbsp;<span class="ident" id="3492171">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492189">if</span>&nbsp;<span class="ident" id="3492192">bufSize</span>&nbsp;<span class="op" id="3492200">&lt;</span>&nbsp;<span class="ident" id="3492202">blockSize</span>&nbsp;<span class="op" id="3492212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492216">bufSize</span>&nbsp;<span class="op" id="3492224">=</span>&nbsp;<span class="ident" id="3492226">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492240">x</span>&nbsp;<span class="op" id="3492242">:=</span>&nbsp;<span class="op" id="3492245">&amp;</span><span class="ident" id="3492246">ofb</span><span class="op" id="3492249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492253">b</span><span class="op" id="3492254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492262">b</span><span class="op" id="3492263">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492267">cipher</span><span class="op" id="3492273">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3492276">make</span><span class="op" id="3492280">(</span><span class="op" id="3492281">[</span><span class="op" id="3492282">]</span><span class="builtintype" id="3492283">byte</span><span class="op" id="3492287">,</span>&nbsp;<span class="ident" id="3492289">blockSize</span><span class="op" id="3492298">)</span><span class="op" id="3492299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492303">out</span><span class="op" id="3492306">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3492312">make</span><span class="op" id="3492316">(</span><span class="op" id="3492317">[</span><span class="op" id="3492318">]</span><span class="builtintype" id="3492319">byte</span><span class="op" id="3492323">,</span>&nbsp;<span class="num" id="3492325">0</span><span class="op" id="3492326">,</span>&nbsp;<span class="ident" id="3492328">bufSize</span><span class="op" id="3492335">)</span><span class="op" id="3492336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492340">outUsed</span><span class="op" id="3492347">:</span>&nbsp;<span class="num" id="3492349">0</span><span class="op" id="3492350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3492357">copy</span><span class="op" id="3492361">(</span><span class="ident" id="3492362">x</span><span class="op" id="3492363">.</span><span class="ident" id="3492364">cipher</span><span class="op" id="3492370">,</span>&nbsp;<span class="ident" id="3492372">iv</span><span class="op" id="3492374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492377">return</span>&nbsp;<span class="ident" id="3492384">x</span><br>
<span class="lineno"></span><span class="op" id="3492386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3492389">func</span>&nbsp;<span class="op" id="3492394">(</span><span class="ident" id="3492395">x</span>&nbsp;<span class="op" id="3492397">*</span><span class="ident" id="3492398">ofb</span><span class="op" id="3492401">)</span>&nbsp;<span class="ident" id="3492403">refill</span><span class="op" id="3492409">(</span><span class="op" id="3492410">)</span>&nbsp;<span class="op" id="3492412">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492415">bs</span>&nbsp;<span class="op" id="3492418">:=</span>&nbsp;<span class="ident" id="3492421">x</span><span class="op" id="3492422">.</span><span class="ident" id="3492423">b</span><span class="op" id="3492424">.</span><span class="ident" id="3492425">BlockSize</span><span class="op" id="3492434">(</span><span class="op" id="3492435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492438">remain</span>&nbsp;<span class="op" id="3492445">:=</span>&nbsp;<span class="builtinfunc" id="3492448">len</span><span class="op" id="3492451">(</span><span class="ident" id="3492452">x</span><span class="op" id="3492453">.</span><span class="ident" id="3492454">out</span><span class="op" id="3492457">)</span>&nbsp;<span class="op" id="3492459">-</span>&nbsp;<span class="ident" id="3492461">x</span><span class="op" id="3492462">.</span><span class="ident" id="3492463">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492472">if</span>&nbsp;<span class="ident" id="3492475">remain</span>&nbsp;<span class="op" id="3492482">&gt;</span>&nbsp;<span class="ident" id="3492484">x</span><span class="op" id="3492485">.</span><span class="ident" id="3492486">outUsed</span>&nbsp;<span class="op" id="3492494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492498">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492506">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3492509">copy</span><span class="op" id="3492513">(</span><span class="ident" id="3492514">x</span><span class="op" id="3492515">.</span><span class="ident" id="3492516">out</span><span class="op" id="3492519">,</span>&nbsp;<span class="ident" id="3492521">x</span><span class="op" id="3492522">.</span><span class="ident" id="3492523">out</span><span class="op" id="3492526">[</span><span class="ident" id="3492527">x</span><span class="op" id="3492528">.</span><span class="ident" id="3492529">outUsed</span><span class="op" id="3492536">:</span><span class="op" id="3492537">]</span><span class="op" id="3492538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492541">x</span><span class="op" id="3492542">.</span><span class="ident" id="3492543">out</span>&nbsp;<span class="op" id="3492547">=</span>&nbsp;<span class="ident" id="3492549">x</span><span class="op" id="3492550">.</span><span class="ident" id="3492551">out</span><span class="op" id="3492554">[</span><span class="op" id="3492555">:</span><span class="builtinfunc" id="3492556">cap</span><span class="op" id="3492559">(</span><span class="ident" id="3492560">x</span><span class="op" id="3492561">.</span><span class="ident" id="3492562">out</span><span class="op" id="3492565">)</span><span class="op" id="3492566">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492569">for</span>&nbsp;<span class="ident" id="3492573">remain</span>&nbsp;<span class="op" id="3492580">&lt;</span>&nbsp;<span class="builtinfunc" id="3492582">len</span><span class="op" id="3492585">(</span><span class="ident" id="3492586">x</span><span class="op" id="3492587">.</span><span class="ident" id="3492588">out</span><span class="op" id="3492591">)</span><span class="op" id="3492592">-</span><span class="ident" id="3492593">bs</span>&nbsp;<span class="op" id="3492596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492600">x</span><span class="op" id="3492601">.</span><span class="ident" id="3492602">b</span><span class="op" id="3492603">.</span><span class="ident" id="3492604">Encrypt</span><span class="op" id="3492611">(</span><span class="ident" id="3492612">x</span><span class="op" id="3492613">.</span><span class="ident" id="3492614">cipher</span><span class="op" id="3492620">,</span>&nbsp;<span class="ident" id="3492622">x</span><span class="op" id="3492623">.</span><span class="ident" id="3492624">cipher</span><span class="op" id="3492630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3492634">copy</span><span class="op" id="3492638">(</span><span class="ident" id="3492639">x</span><span class="op" id="3492640">.</span><span class="ident" id="3492641">out</span><span class="op" id="3492644">[</span><span class="ident" id="3492645">remain</span><span class="op" id="3492651">:</span><span class="op" id="3492652">]</span><span class="op" id="3492653">,</span>&nbsp;<span class="ident" id="3492655">x</span><span class="op" id="3492656">.</span><span class="ident" id="3492657">cipher</span><span class="op" id="3492663">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492667">remain</span>&nbsp;<span class="op" id="3492674">+=</span>&nbsp;<span class="ident" id="3492677">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492684">x</span><span class="op" id="3492685">.</span><span class="ident" id="3492686">out</span>&nbsp;<span class="op" id="3492690">=</span>&nbsp;<span class="ident" id="3492692">x</span><span class="op" id="3492693">.</span><span class="ident" id="3492694">out</span><span class="op" id="3492697">[</span><span class="op" id="3492698">:</span><span class="ident" id="3492699">remain</span><span class="op" id="3492705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492708">x</span><span class="op" id="3492709">.</span><span class="ident" id="3492710">outUsed</span>&nbsp;<span class="op" id="3492718">=</span>&nbsp;<span class="num" id="3492720">0</span><br>
<span class="lineno"></span><span class="op" id="3492722">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3492725">func</span>&nbsp;<span class="op" id="3492730">(</span><span class="ident" id="3492731">x</span>&nbsp;<span class="op" id="3492733">*</span><span class="ident" id="3492734">ofb</span><span class="op" id="3492737">)</span>&nbsp;<span class="ident" id="3492739">XORKeyStream</span><span class="op" id="3492751">(</span><span class="ident" id="3492752">dst</span><span class="op" id="3492755">,</span>&nbsp;<span class="ident" id="3492757">src</span>&nbsp;<span class="op" id="3492761">[</span><span class="op" id="3492762">]</span><span class="builtintype" id="3492763">byte</span><span class="op" id="3492767">)</span>&nbsp;<span class="op" id="3492769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492772">for</span>&nbsp;<span class="builtinfunc" id="3492776">len</span><span class="op" id="3492779">(</span><span class="ident" id="3492780">src</span><span class="op" id="3492783">)</span>&nbsp;<span class="op" id="3492785">&gt;</span>&nbsp;<span class="num" id="3492787">0</span>&nbsp;<span class="op" id="3492789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492793">if</span>&nbsp;<span class="ident" id="3492796">x</span><span class="op" id="3492797">.</span><span class="ident" id="3492798">outUsed</span>&nbsp;<span class="op" id="3492806">&gt;=</span>&nbsp;<span class="builtinfunc" id="3492809">len</span><span class="op" id="3492812">(</span><span class="ident" id="3492813">x</span><span class="op" id="3492814">.</span><span class="ident" id="3492815">out</span><span class="op" id="3492818">)</span><span class="op" id="3492819">-</span><span class="ident" id="3492820">x</span><span class="op" id="3492821">.</span><span class="ident" id="3492822">b</span><span class="op" id="3492823">.</span><span class="ident" id="3492824">BlockSize</span><span class="op" id="3492833">(</span><span class="op" id="3492834">)</span>&nbsp;<span class="op" id="3492836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492841">x</span><span class="op" id="3492842">.</span><span class="ident" id="3492843">refill</span><span class="op" id="3492849">(</span><span class="op" id="3492850">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492858">n</span>&nbsp;<span class="op" id="3492860">:=</span>&nbsp;<span class="ident" id="3492863">xorBytes</span><span class="op" id="3492871">(</span><span class="ident" id="3492872">dst</span><span class="op" id="3492875">,</span>&nbsp;<span class="ident" id="3492877">src</span><span class="op" id="3492880">,</span>&nbsp;<span class="ident" id="3492882">x</span><span class="op" id="3492883">.</span><span class="ident" id="3492884">out</span><span class="op" id="3492887">[</span><span class="ident" id="3492888">x</span><span class="op" id="3492889">.</span><span class="ident" id="3492890">outUsed</span><span class="op" id="3492897">:</span><span class="op" id="3492898">]</span><span class="op" id="3492899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492903">dst</span>&nbsp;<span class="op" id="3492907">=</span>&nbsp;<span class="ident" id="3492909">dst</span><span class="op" id="3492912">[</span><span class="ident" id="3492913">n</span><span class="op" id="3492914">:</span><span class="op" id="3492915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492919">src</span>&nbsp;<span class="op" id="3492923">=</span>&nbsp;<span class="ident" id="3492925">src</span><span class="op" id="3492928">[</span><span class="ident" id="3492929">n</span><span class="op" id="3492930">:</span><span class="op" id="3492931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492935">x</span><span class="op" id="3492936">.</span><span class="ident" id="3492937">outUsed</span>&nbsp;<span class="op" id="3492945">+=</span>&nbsp;<span class="ident" id="3492948">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492951">}</span><br>
<span class="lineno"></span><span class="op" id="3492953">}</span>
</div>
</body>
</html>
