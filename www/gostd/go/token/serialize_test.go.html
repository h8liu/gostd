<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7483385">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7483440">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7483494">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7483545">package</span>&nbsp;<span class="ident" id="7483553">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7483560">import</span>&nbsp;<span class="op" id="7483567">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483570">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483579">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483595">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483602">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7483612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7483615">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7483675">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7483736">func</span>&nbsp;<span class="ident" id="7483741">equal</span><span class="op" id="7483746">(</span><span class="ident" id="7483747">p</span><span class="op" id="7483748">,</span>&nbsp;<span class="ident" id="7483750">q</span>&nbsp;<span class="op" id="7483752">*</span><span class="ident" id="7483753">FileSet</span><span class="op" id="7483760">)</span>&nbsp;<span class="builtintype" id="7483762">error</span>&nbsp;<span class="op" id="7483768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483771">if</span>&nbsp;<span class="ident" id="7483774">p</span>&nbsp;<span class="op" id="7483776">==</span>&nbsp;<span class="ident" id="7483779">q</span>&nbsp;<span class="op" id="7483781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7483785">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483815">return</span>&nbsp;<span class="ident" id="7483822">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7483831">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483868">p</span><span class="op" id="7483869">.</span><span class="ident" id="7483870">mutex</span><span class="op" id="7483875">.</span><span class="ident" id="7483876">Lock</span><span class="op" id="7483880">(</span><span class="op" id="7483881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483884">q</span><span class="op" id="7483885">.</span><span class="ident" id="7483886">mutex</span><span class="op" id="7483891">.</span><span class="ident" id="7483892">Lock</span><span class="op" id="7483896">(</span><span class="op" id="7483897">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483900">defer</span>&nbsp;<span class="ident" id="7483906">q</span><span class="op" id="7483907">.</span><span class="ident" id="7483908">mutex</span><span class="op" id="7483913">.</span><span class="ident" id="7483914">Unlock</span><span class="op" id="7483920">(</span><span class="op" id="7483921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483924">defer</span>&nbsp;<span class="ident" id="7483930">p</span><span class="op" id="7483931">.</span><span class="ident" id="7483932">mutex</span><span class="op" id="7483937">.</span><span class="ident" id="7483938">Unlock</span><span class="op" id="7483944">(</span><span class="op" id="7483945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483949">if</span>&nbsp;<span class="ident" id="7483952">p</span><span class="op" id="7483953">.</span><span class="ident" id="7483954">base</span>&nbsp;<span class="op" id="7483959">!=</span>&nbsp;<span class="ident" id="7483962">q</span><span class="op" id="7483963">.</span><span class="ident" id="7483964">base</span>&nbsp;<span class="op" id="7483969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483973">return</span>&nbsp;<span class="ident" id="7483980">fmt</span><span class="op" id="7483983">.</span><span class="ident" id="7483984">Errorf</span><span class="op" id="7483990">(</span><span class="string" id="7483991">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7484018">,</span>&nbsp;<span class="ident" id="7484020">p</span><span class="op" id="7484021">.</span><span class="ident" id="7484022">base</span><span class="op" id="7484026">,</span>&nbsp;<span class="ident" id="7484028">q</span><span class="op" id="7484029">.</span><span class="ident" id="7484030">base</span><span class="op" id="7484034">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484041">if</span>&nbsp;<span class="builtinfunc" id="7484044">len</span><span class="op" id="7484047">(</span><span class="ident" id="7484048">p</span><span class="op" id="7484049">.</span><span class="ident" id="7484050">files</span><span class="op" id="7484055">)</span>&nbsp;<span class="op" id="7484057">!=</span>&nbsp;<span class="builtinfunc" id="7484060">len</span><span class="op" id="7484063">(</span><span class="ident" id="7484064">q</span><span class="op" id="7484065">.</span><span class="ident" id="7484066">files</span><span class="op" id="7484071">)</span>&nbsp;<span class="op" id="7484073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484077">return</span>&nbsp;<span class="ident" id="7484084">fmt</span><span class="op" id="7484087">.</span><span class="ident" id="7484088">Errorf</span><span class="op" id="7484094">(</span><span class="string" id="7484095">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7484132">,</span>&nbsp;<span class="builtinfunc" id="7484134">len</span><span class="op" id="7484137">(</span><span class="ident" id="7484138">p</span><span class="op" id="7484139">.</span><span class="ident" id="7484140">files</span><span class="op" id="7484145">)</span><span class="op" id="7484146">,</span>&nbsp;<span class="builtinfunc" id="7484148">len</span><span class="op" id="7484151">(</span><span class="ident" id="7484152">q</span><span class="op" id="7484153">.</span><span class="ident" id="7484154">files</span><span class="op" id="7484159">)</span><span class="op" id="7484160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484163">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484167">for</span>&nbsp;<span class="ident" id="7484171">i</span><span class="op" id="7484172">,</span>&nbsp;<span class="ident" id="7484174">f</span>&nbsp;<span class="op" id="7484176">:=</span>&nbsp;<span class="keyword" id="7484179">range</span>&nbsp;<span class="ident" id="7484185">p</span><span class="op" id="7484186">.</span><span class="ident" id="7484187">files</span>&nbsp;<span class="op" id="7484193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484197">g</span>&nbsp;<span class="op" id="7484199">:=</span>&nbsp;<span class="ident" id="7484202">q</span><span class="op" id="7484203">.</span><span class="ident" id="7484204">files</span><span class="op" id="7484209">[</span><span class="ident" id="7484210">i</span><span class="op" id="7484211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484215">if</span>&nbsp;<span class="ident" id="7484218">f</span><span class="op" id="7484219">.</span><span class="ident" id="7484220">set</span>&nbsp;<span class="op" id="7484224">!=</span>&nbsp;<span class="ident" id="7484227">p</span>&nbsp;<span class="op" id="7484229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484234">return</span>&nbsp;<span class="ident" id="7484241">fmt</span><span class="op" id="7484244">.</span><span class="ident" id="7484245">Errorf</span><span class="op" id="7484251">(</span><span class="string" id="7484252">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7484274">,</span>&nbsp;<span class="ident" id="7484276">f</span><span class="op" id="7484277">.</span><span class="ident" id="7484278">name</span><span class="op" id="7484282">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484290">if</span>&nbsp;<span class="ident" id="7484293">g</span><span class="op" id="7484294">.</span><span class="ident" id="7484295">set</span>&nbsp;<span class="op" id="7484299">!=</span>&nbsp;<span class="ident" id="7484302">q</span>&nbsp;<span class="op" id="7484304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484309">return</span>&nbsp;<span class="ident" id="7484316">fmt</span><span class="op" id="7484319">.</span><span class="ident" id="7484320">Errorf</span><span class="op" id="7484326">(</span><span class="string" id="7484327">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7484349">,</span>&nbsp;<span class="ident" id="7484351">g</span><span class="op" id="7484352">.</span><span class="ident" id="7484353">name</span><span class="op" id="7484357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484365">if</span>&nbsp;<span class="ident" id="7484368">f</span><span class="op" id="7484369">.</span><span class="ident" id="7484370">name</span>&nbsp;<span class="op" id="7484375">!=</span>&nbsp;<span class="ident" id="7484378">g</span><span class="op" id="7484379">.</span><span class="ident" id="7484380">name</span>&nbsp;<span class="op" id="7484385">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484390">return</span>&nbsp;<span class="ident" id="7484397">fmt</span><span class="op" id="7484400">.</span><span class="ident" id="7484401">Errorf</span><span class="op" id="7484407">(</span><span class="string" id="7484408">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7484439">,</span>&nbsp;<span class="ident" id="7484441">f</span><span class="op" id="7484442">.</span><span class="ident" id="7484443">name</span><span class="op" id="7484447">,</span>&nbsp;<span class="ident" id="7484449">g</span><span class="op" id="7484450">.</span><span class="ident" id="7484451">name</span><span class="op" id="7484455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484463">if</span>&nbsp;<span class="ident" id="7484466">f</span><span class="op" id="7484467">.</span><span class="ident" id="7484468">base</span>&nbsp;<span class="op" id="7484473">!=</span>&nbsp;<span class="ident" id="7484476">g</span><span class="op" id="7484477">.</span><span class="ident" id="7484478">base</span>&nbsp;<span class="op" id="7484483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484488">return</span>&nbsp;<span class="ident" id="7484495">fmt</span><span class="op" id="7484498">.</span><span class="ident" id="7484499">Errorf</span><span class="op" id="7484505">(</span><span class="string" id="7484506">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7484539">,</span>&nbsp;<span class="ident" id="7484541">f</span><span class="op" id="7484542">.</span><span class="ident" id="7484543">name</span><span class="op" id="7484547">,</span>&nbsp;<span class="ident" id="7484549">f</span><span class="op" id="7484550">.</span><span class="ident" id="7484551">base</span><span class="op" id="7484555">,</span>&nbsp;<span class="ident" id="7484557">g</span><span class="op" id="7484558">.</span><span class="ident" id="7484559">base</span><span class="op" id="7484563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484567">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484571">if</span>&nbsp;<span class="ident" id="7484574">f</span><span class="op" id="7484575">.</span><span class="ident" id="7484576">size</span>&nbsp;<span class="op" id="7484581">!=</span>&nbsp;<span class="ident" id="7484584">g</span><span class="op" id="7484585">.</span><span class="ident" id="7484586">size</span>&nbsp;<span class="op" id="7484591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484596">return</span>&nbsp;<span class="ident" id="7484603">fmt</span><span class="op" id="7484606">.</span><span class="ident" id="7484607">Errorf</span><span class="op" id="7484613">(</span><span class="string" id="7484614">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7484647">,</span>&nbsp;<span class="ident" id="7484649">f</span><span class="op" id="7484650">.</span><span class="ident" id="7484651">name</span><span class="op" id="7484655">,</span>&nbsp;<span class="ident" id="7484657">f</span><span class="op" id="7484658">.</span><span class="ident" id="7484659">size</span><span class="op" id="7484663">,</span>&nbsp;<span class="ident" id="7484665">g</span><span class="op" id="7484666">.</span><span class="ident" id="7484667">size</span><span class="op" id="7484671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484679">for</span>&nbsp;<span class="ident" id="7484683">j</span><span class="op" id="7484684">,</span>&nbsp;<span class="ident" id="7484686">l</span>&nbsp;<span class="op" id="7484688">:=</span>&nbsp;<span class="keyword" id="7484691">range</span>&nbsp;<span class="ident" id="7484697">f</span><span class="op" id="7484698">.</span><span class="ident" id="7484699">lines</span>&nbsp;<span class="op" id="7484705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484710">m</span>&nbsp;<span class="op" id="7484712">:=</span>&nbsp;<span class="ident" id="7484715">g</span><span class="op" id="7484716">.</span><span class="ident" id="7484717">lines</span><span class="op" id="7484722">[</span><span class="ident" id="7484723">j</span><span class="op" id="7484724">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484729">if</span>&nbsp;<span class="ident" id="7484732">l</span>&nbsp;<span class="op" id="7484734">!=</span>&nbsp;<span class="ident" id="7484737">m</span>&nbsp;<span class="op" id="7484739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484745">return</span>&nbsp;<span class="ident" id="7484752">fmt</span><span class="op" id="7484755">.</span><span class="ident" id="7484756">Errorf</span><span class="op" id="7484762">(</span><span class="string" id="7484763">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7484789">,</span>&nbsp;<span class="ident" id="7484791">f</span><span class="op" id="7484792">.</span><span class="ident" id="7484793">name</span><span class="op" id="7484797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484810">for</span>&nbsp;<span class="ident" id="7484814">j</span><span class="op" id="7484815">,</span>&nbsp;<span class="ident" id="7484817">l</span>&nbsp;<span class="op" id="7484819">:=</span>&nbsp;<span class="keyword" id="7484822">range</span>&nbsp;<span class="ident" id="7484828">f</span><span class="op" id="7484829">.</span><span class="ident" id="7484830">infos</span>&nbsp;<span class="op" id="7484836">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484841">m</span>&nbsp;<span class="op" id="7484843">:=</span>&nbsp;<span class="ident" id="7484846">g</span><span class="op" id="7484847">.</span><span class="ident" id="7484848">infos</span><span class="op" id="7484853">[</span><span class="ident" id="7484854">j</span><span class="op" id="7484855">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484860">if</span>&nbsp;<span class="ident" id="7484863">l</span><span class="op" id="7484864">.</span><span class="ident" id="7484865">Offset</span>&nbsp;<span class="op" id="7484872">!=</span>&nbsp;<span class="ident" id="7484875">m</span><span class="op" id="7484876">.</span><span class="ident" id="7484877">Offset</span>&nbsp;<span class="op" id="7484884">||</span>&nbsp;<span class="ident" id="7484887">l</span><span class="op" id="7484888">.</span><span class="ident" id="7484889">Filename</span>&nbsp;<span class="op" id="7484898">!=</span>&nbsp;<span class="ident" id="7484901">m</span><span class="op" id="7484902">.</span><span class="ident" id="7484903">Filename</span>&nbsp;<span class="op" id="7484912">||</span>&nbsp;<span class="ident" id="7484915">l</span><span class="op" id="7484916">.</span><span class="ident" id="7484917">Line</span>&nbsp;<span class="op" id="7484922">!=</span>&nbsp;<span class="ident" id="7484925">m</span><span class="op" id="7484926">.</span><span class="ident" id="7484927">Line</span>&nbsp;<span class="op" id="7484932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484938">return</span>&nbsp;<span class="ident" id="7484945">fmt</span><span class="op" id="7484948">.</span><span class="ident" id="7484949">Errorf</span><span class="op" id="7484955">(</span><span class="string" id="7484956">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7484980">,</span>&nbsp;<span class="ident" id="7484982">f</span><span class="op" id="7484983">.</span><span class="ident" id="7484984">name</span><span class="op" id="7484988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484997">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7485004">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485054">return</span>&nbsp;<span class="ident" id="7485061">nil</span><br>
<span class="lineno"></span><span class="op" id="7485065">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7485068">func</span>&nbsp;<span class="ident" id="7485073">checkSerialize</span><span class="op" id="7485087">(</span><span class="ident" id="7485088">t</span>&nbsp;<span class="op" id="7485090">*</span><span class="ident" id="7485091">testing</span><span class="op" id="7485098">.</span><span class="ident" id="7485099">T</span><span class="op" id="7485100">,</span>&nbsp;<span class="ident" id="7485102">p</span>&nbsp;<span class="op" id="7485104">*</span><span class="ident" id="7485105">FileSet</span><span class="op" id="7485112">)</span>&nbsp;<span class="op" id="7485114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485117">var</span>&nbsp;<span class="ident" id="7485121">buf</span>&nbsp;<span class="ident" id="7485125">bytes</span><span class="op" id="7485130">.</span><span class="ident" id="7485131">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485139">encode</span>&nbsp;<span class="op" id="7485146">:=</span>&nbsp;<span class="keyword" id="7485149">func</span><span class="op" id="7485153">(</span><span class="ident" id="7485154">x</span>&nbsp;<span class="keyword" id="7485156">interface</span><span class="op" id="7485165">{</span><span class="op" id="7485166">}</span><span class="op" id="7485167">)</span>&nbsp;<span class="builtintype" id="7485169">error</span>&nbsp;<span class="op" id="7485175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485179">return</span>&nbsp;<span class="ident" id="7485186">gob</span><span class="op" id="7485189">.</span><span class="ident" id="7485190">NewEncoder</span><span class="op" id="7485200">(</span><span class="op" id="7485201">&amp;</span><span class="ident" id="7485202">buf</span><span class="op" id="7485205">)</span><span class="op" id="7485206">.</span><span class="ident" id="7485207">Encode</span><span class="op" id="7485213">(</span><span class="ident" id="7485214">x</span><span class="op" id="7485215">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485221">if</span>&nbsp;<span class="ident" id="7485224">err</span>&nbsp;<span class="op" id="7485228">:=</span>&nbsp;<span class="ident" id="7485231">p</span><span class="op" id="7485232">.</span><span class="ident" id="7485233">Write</span><span class="op" id="7485238">(</span><span class="ident" id="7485239">encode</span><span class="op" id="7485245">)</span><span class="op" id="7485246">;</span>&nbsp;<span class="ident" id="7485248">err</span>&nbsp;<span class="op" id="7485252">!=</span>&nbsp;<span class="ident" id="7485255">nil</span>&nbsp;<span class="op" id="7485259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485263">t</span><span class="op" id="7485264">.</span><span class="ident" id="7485265">Errorf</span><span class="op" id="7485271">(</span><span class="string" id="7485272">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7485300">,</span>&nbsp;<span class="ident" id="7485302">err</span><span class="op" id="7485305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485309">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485317">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485320">q</span>&nbsp;<span class="op" id="7485322">:=</span>&nbsp;<span class="ident" id="7485325">NewFileSet</span><span class="op" id="7485335">(</span><span class="op" id="7485336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485339">decode</span>&nbsp;<span class="op" id="7485346">:=</span>&nbsp;<span class="keyword" id="7485349">func</span><span class="op" id="7485353">(</span><span class="ident" id="7485354">x</span>&nbsp;<span class="keyword" id="7485356">interface</span><span class="op" id="7485365">{</span><span class="op" id="7485366">}</span><span class="op" id="7485367">)</span>&nbsp;<span class="builtintype" id="7485369">error</span>&nbsp;<span class="op" id="7485375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485379">return</span>&nbsp;<span class="ident" id="7485386">gob</span><span class="op" id="7485389">.</span><span class="ident" id="7485390">NewDecoder</span><span class="op" id="7485400">(</span><span class="op" id="7485401">&amp;</span><span class="ident" id="7485402">buf</span><span class="op" id="7485405">)</span><span class="op" id="7485406">.</span><span class="ident" id="7485407">Decode</span><span class="op" id="7485413">(</span><span class="ident" id="7485414">x</span><span class="op" id="7485415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485421">if</span>&nbsp;<span class="ident" id="7485424">err</span>&nbsp;<span class="op" id="7485428">:=</span>&nbsp;<span class="ident" id="7485431">q</span><span class="op" id="7485432">.</span><span class="ident" id="7485433">Read</span><span class="op" id="7485437">(</span><span class="ident" id="7485438">decode</span><span class="op" id="7485444">)</span><span class="op" id="7485445">;</span>&nbsp;<span class="ident" id="7485447">err</span>&nbsp;<span class="op" id="7485451">!=</span>&nbsp;<span class="ident" id="7485454">nil</span>&nbsp;<span class="op" id="7485458">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485462">t</span><span class="op" id="7485463">.</span><span class="ident" id="7485464">Errorf</span><span class="op" id="7485470">(</span><span class="string" id="7485471">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7485499">,</span>&nbsp;<span class="ident" id="7485501">err</span><span class="op" id="7485504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485508">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485519">if</span>&nbsp;<span class="ident" id="7485522">err</span>&nbsp;<span class="op" id="7485526">:=</span>&nbsp;<span class="ident" id="7485529">equal</span><span class="op" id="7485534">(</span><span class="ident" id="7485535">p</span><span class="op" id="7485536">,</span>&nbsp;<span class="ident" id="7485538">q</span><span class="op" id="7485539">)</span><span class="op" id="7485540">;</span>&nbsp;<span class="ident" id="7485542">err</span>&nbsp;<span class="op" id="7485546">!=</span>&nbsp;<span class="ident" id="7485549">nil</span>&nbsp;<span class="op" id="7485553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485557">t</span><span class="op" id="7485558">.</span><span class="ident" id="7485559">Errorf</span><span class="op" id="7485565">(</span><span class="string" id="7485566">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7485594">,</span>&nbsp;<span class="ident" id="7485596">err</span><span class="op" id="7485599">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485602">}</span><br>
<span class="lineno"></span><span class="op" id="7485604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7485607">func</span>&nbsp;<span class="ident" id="7485612">TestSerialization</span><span class="op" id="7485629">(</span><span class="ident" id="7485630">t</span>&nbsp;<span class="op" id="7485632">*</span><span class="ident" id="7485633">testing</span><span class="op" id="7485640">.</span><span class="ident" id="7485641">T</span><span class="op" id="7485642">)</span>&nbsp;<span class="op" id="7485644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485647">p</span>&nbsp;<span class="op" id="7485649">:=</span>&nbsp;<span class="ident" id="7485652">NewFileSet</span><span class="op" id="7485662">(</span><span class="op" id="7485663">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485666">checkSerialize</span><span class="op" id="7485680">(</span><span class="ident" id="7485681">t</span><span class="op" id="7485682">,</span>&nbsp;<span class="ident" id="7485684">p</span><span class="op" id="7485685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7485688">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485707">for</span>&nbsp;<span class="ident" id="7485711">i</span>&nbsp;<span class="op" id="7485713">:=</span>&nbsp;<span class="num" id="7485716">0</span><span class="op" id="7485717">;</span>&nbsp;<span class="ident" id="7485719">i</span>&nbsp;<span class="op" id="7485721">&lt;</span>&nbsp;<span class="num" id="7485723">10</span><span class="op" id="7485725">;</span>&nbsp;<span class="ident" id="7485727">i</span><span class="op" id="7485728">++</span>&nbsp;<span class="op" id="7485731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485735">f</span>&nbsp;<span class="op" id="7485737">:=</span>&nbsp;<span class="ident" id="7485740">p</span><span class="op" id="7485741">.</span><span class="ident" id="7485742">AddFile</span><span class="op" id="7485749">(</span><span class="ident" id="7485750">fmt</span><span class="op" id="7485753">.</span><span class="ident" id="7485754">Sprintf</span><span class="op" id="7485761">(</span><span class="string" id="7485762">&#34;file%d&#34;</span><span class="op" id="7485770">,</span>&nbsp;<span class="ident" id="7485772">i</span><span class="op" id="7485773">)</span><span class="op" id="7485774">,</span>&nbsp;<span class="ident" id="7485776">p</span><span class="op" id="7485777">.</span><span class="ident" id="7485778">Base</span><span class="op" id="7485782">(</span><span class="op" id="7485783">)</span><span class="op" id="7485784">+</span><span class="ident" id="7485785">i</span><span class="op" id="7485786">,</span>&nbsp;<span class="ident" id="7485788">i</span><span class="op" id="7485789">*</span><span class="num" id="7485790">100</span><span class="op" id="7485793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485797">checkSerialize</span><span class="op" id="7485811">(</span><span class="ident" id="7485812">t</span><span class="op" id="7485813">,</span>&nbsp;<span class="ident" id="7485815">p</span><span class="op" id="7485816">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7485820">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485867">line</span>&nbsp;<span class="op" id="7485872">:=</span>&nbsp;<span class="num" id="7485875">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485882">for</span>&nbsp;<span class="ident" id="7485886">offs</span>&nbsp;<span class="op" id="7485891">:=</span>&nbsp;<span class="num" id="7485894">0</span><span class="op" id="7485895">;</span>&nbsp;<span class="ident" id="7485897">offs</span>&nbsp;<span class="op" id="7485902">&lt;</span>&nbsp;<span class="ident" id="7485904">f</span><span class="op" id="7485905">.</span><span class="ident" id="7485906">Size</span><span class="op" id="7485910">(</span><span class="op" id="7485911">)</span><span class="op" id="7485912">;</span>&nbsp;<span class="ident" id="7485914">offs</span>&nbsp;<span class="op" id="7485919">+=</span>&nbsp;<span class="num" id="7485922">40</span>&nbsp;<span class="op" id="7485925">+</span>&nbsp;<span class="ident" id="7485927">i</span>&nbsp;<span class="op" id="7485929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485934">f</span><span class="op" id="7485935">.</span><span class="ident" id="7485936">AddLine</span><span class="op" id="7485943">(</span><span class="ident" id="7485944">offs</span><span class="op" id="7485948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485953">if</span>&nbsp;<span class="ident" id="7485956">offs</span><span class="op" id="7485960">%</span><span class="num" id="7485961">7</span>&nbsp;<span class="op" id="7485963">==</span>&nbsp;<span class="num" id="7485966">0</span>&nbsp;<span class="op" id="7485968">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485974">f</span><span class="op" id="7485975">.</span><span class="ident" id="7485976">AddLineInfo</span><span class="op" id="7485987">(</span><span class="ident" id="7485988">offs</span><span class="op" id="7485992">,</span>&nbsp;<span class="ident" id="7485994">fmt</span><span class="op" id="7485997">.</span><span class="ident" id="7485998">Sprintf</span><span class="op" id="7486005">(</span><span class="string" id="7486006">&#34;file%d&#34;</span><span class="op" id="7486014">,</span>&nbsp;<span class="ident" id="7486016">offs</span><span class="op" id="7486020">)</span><span class="op" id="7486021">,</span>&nbsp;<span class="ident" id="7486023">line</span><span class="op" id="7486027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486033">line</span>&nbsp;<span class="op" id="7486038">+=</span>&nbsp;<span class="num" id="7486041">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486055">checkSerialize</span><span class="op" id="7486069">(</span><span class="ident" id="7486070">t</span><span class="op" id="7486071">,</span>&nbsp;<span class="ident" id="7486073">p</span><span class="op" id="7486074">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486077">}</span><br>
<span class="lineno"></span><span class="op" id="7486079">}</span>
</div>
</body>
</html>
