<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4290543">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4290599">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4290653">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4290704">package</span>&nbsp;<span class="ident" id="4290712">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4290723">import</span>&nbsp;<span class="op" id="4290730">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4290733">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4290742">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4290751">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4290757">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4290770">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4290781">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4290791">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4290794">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="4290859">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4290924">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4290974">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="4291038">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4291095">type</span>&nbsp;<span class="ident" id="4291100">Reader</span>&nbsp;<span class="keyword" id="4291107">struct</span>&nbsp;<span class="op" id="4291114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291117">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4291121">*</span><span class="ident" id="4291122">bufio</span><span class="op" id="4291127">.</span><span class="ident" id="4291128">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291136">dot</span>&nbsp;<span class="op" id="4291140">*</span><span class="ident" id="4291141">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291152">buf</span>&nbsp;<span class="op" id="4291156">[</span><span class="op" id="4291157">]</span><span class="builtintype" id="4291158">byte</span>&nbsp;<span class="comment" id="4291163">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="4291212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4291215">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4291265">func</span>&nbsp;<span class="ident" id="4291270">NewReader</span><span class="op" id="4291279">(</span><span class="ident" id="4291280">r</span>&nbsp;<span class="op" id="4291282">*</span><span class="ident" id="4291283">bufio</span><span class="op" id="4291288">.</span><span class="ident" id="4291289">Reader</span><span class="op" id="4291295">)</span>&nbsp;<span class="op" id="4291297">*</span><span class="ident" id="4291298">Reader</span>&nbsp;<span class="op" id="4291305">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291308">return</span>&nbsp;<span class="op" id="4291315">&amp;</span><span class="ident" id="4291316">Reader</span><span class="op" id="4291322">{</span><span class="ident" id="4291323">R</span><span class="op" id="4291324">:</span>&nbsp;<span class="ident" id="4291326">r</span><span class="op" id="4291327">}</span><br>
<span class="lineno"></span><span class="op" id="4291329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4291332">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="4291372">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="4291430">func</span>&nbsp;<span class="op" id="4291435">(</span><span class="ident" id="4291436">r</span>&nbsp;<span class="op" id="4291438">*</span><span class="ident" id="4291439">Reader</span><span class="op" id="4291445">)</span>&nbsp;<span class="ident" id="4291447">ReadLine</span><span class="op" id="4291455">(</span><span class="op" id="4291456">)</span>&nbsp;<span class="op" id="4291458">(</span><span class="builtintype" id="4291459">string</span><span class="op" id="4291465">,</span>&nbsp;<span class="builtintype" id="4291467">error</span><span class="op" id="4291472">)</span>&nbsp;<span class="op" id="4291474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291477">line</span><span class="op" id="4291481">,</span>&nbsp;<span class="ident" id="4291483">err</span>&nbsp;<span class="op" id="4291487">:=</span>&nbsp;<span class="ident" id="4291490">r</span><span class="op" id="4291491">.</span><span class="ident" id="4291492">readLineSlice</span><span class="op" id="4291505">(</span><span class="op" id="4291506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291509">return</span>&nbsp;<span class="builtintype" id="4291516">string</span><span class="op" id="4291522">(</span><span class="ident" id="4291523">line</span><span class="op" id="4291527">)</span><span class="op" id="4291528">,</span>&nbsp;<span class="ident" id="4291530">err</span><br>
<span class="lineno"></span><span class="op" id="4291534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4291537">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4291613">func</span>&nbsp;<span class="op" id="4291618">(</span><span class="ident" id="4291619">r</span>&nbsp;<span class="op" id="4291621">*</span><span class="ident" id="4291622">Reader</span><span class="op" id="4291628">)</span>&nbsp;<span class="ident" id="4291630">ReadLineBytes</span><span class="op" id="4291643">(</span><span class="op" id="4291644">)</span>&nbsp;<span class="op" id="4291646">(</span><span class="op" id="4291647">[</span><span class="op" id="4291648">]</span><span class="builtintype" id="4291649">byte</span><span class="op" id="4291653">,</span>&nbsp;<span class="builtintype" id="4291655">error</span><span class="op" id="4291660">)</span>&nbsp;<span class="op" id="4291662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291665">line</span><span class="op" id="4291669">,</span>&nbsp;<span class="ident" id="4291671">err</span>&nbsp;<span class="op" id="4291675">:=</span>&nbsp;<span class="ident" id="4291678">r</span><span class="op" id="4291679">.</span><span class="ident" id="4291680">readLineSlice</span><span class="op" id="4291693">(</span><span class="op" id="4291694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291697">if</span>&nbsp;<span class="ident" id="4291700">line</span>&nbsp;<span class="op" id="4291705">!=</span>&nbsp;<span class="ident" id="4291708">nil</span>&nbsp;<span class="op" id="4291712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291716">buf</span>&nbsp;<span class="op" id="4291720">:=</span>&nbsp;<span class="builtinfunc" id="4291723">make</span><span class="op" id="4291727">(</span><span class="op" id="4291728">[</span><span class="op" id="4291729">]</span><span class="builtintype" id="4291730">byte</span><span class="op" id="4291734">,</span>&nbsp;<span class="builtinfunc" id="4291736">len</span><span class="op" id="4291739">(</span><span class="ident" id="4291740">line</span><span class="op" id="4291744">)</span><span class="op" id="4291745">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4291749">copy</span><span class="op" id="4291753">(</span><span class="ident" id="4291754">buf</span><span class="op" id="4291757">,</span>&nbsp;<span class="ident" id="4291759">line</span><span class="op" id="4291763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291767">line</span>&nbsp;<span class="op" id="4291772">=</span>&nbsp;<span class="ident" id="4291774">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291782">return</span>&nbsp;<span class="ident" id="4291789">line</span><span class="op" id="4291793">,</span>&nbsp;<span class="ident" id="4291795">err</span><br>
<span class="lineno"></span><span class="op" id="4291799">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4291802">func</span>&nbsp;<span class="op" id="4291807">(</span><span class="ident" id="4291808">r</span>&nbsp;<span class="op" id="4291810">*</span><span class="ident" id="4291811">Reader</span><span class="op" id="4291817">)</span>&nbsp;<span class="ident" id="4291819">readLineSlice</span><span class="op" id="4291832">(</span><span class="op" id="4291833">)</span>&nbsp;<span class="op" id="4291835">(</span><span class="op" id="4291836">[</span><span class="op" id="4291837">]</span><span class="builtintype" id="4291838">byte</span><span class="op" id="4291842">,</span>&nbsp;<span class="builtintype" id="4291844">error</span><span class="op" id="4291849">)</span>&nbsp;<span class="op" id="4291851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291854">r</span><span class="op" id="4291855">.</span><span class="ident" id="4291856">closeDot</span><span class="op" id="4291864">(</span><span class="op" id="4291865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291868">var</span>&nbsp;<span class="ident" id="4291872">line</span>&nbsp;<span class="op" id="4291877">[</span><span class="op" id="4291878">]</span><span class="builtintype" id="4291879">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291885">for</span>&nbsp;<span class="op" id="4291889">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291893">l</span><span class="op" id="4291894">,</span>&nbsp;<span class="ident" id="4291896">more</span><span class="op" id="4291900">,</span>&nbsp;<span class="ident" id="4291902">err</span>&nbsp;<span class="op" id="4291906">:=</span>&nbsp;<span class="ident" id="4291909">r</span><span class="op" id="4291910">.</span><span class="ident" id="4291911">R</span><span class="op" id="4291912">.</span><span class="ident" id="4291913">ReadLine</span><span class="op" id="4291921">(</span><span class="op" id="4291922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291926">if</span>&nbsp;<span class="ident" id="4291929">err</span>&nbsp;<span class="op" id="4291933">!=</span>&nbsp;<span class="ident" id="4291936">nil</span>&nbsp;<span class="op" id="4291940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291945">return</span>&nbsp;<span class="ident" id="4291952">nil</span><span class="op" id="4291955">,</span>&nbsp;<span class="ident" id="4291957">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291967">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292027">if</span>&nbsp;<span class="ident" id="4292030">line</span>&nbsp;<span class="op" id="4292035">==</span>&nbsp;<span class="ident" id="4292038">nil</span>&nbsp;<span class="op" id="4292042">&amp;&amp;</span>&nbsp;<span class="op" id="4292045">!</span><span class="ident" id="4292046">more</span>&nbsp;<span class="op" id="4292051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292056">return</span>&nbsp;<span class="ident" id="4292063">l</span><span class="op" id="4292064">,</span>&nbsp;<span class="ident" id="4292066">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292076">line</span>&nbsp;<span class="op" id="4292081">=</span>&nbsp;<span class="builtinfunc" id="4292083">append</span><span class="op" id="4292089">(</span><span class="ident" id="4292090">line</span><span class="op" id="4292094">,</span>&nbsp;<span class="ident" id="4292096">l</span><span class="op" id="4292097">...</span><span class="op" id="4292100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292104">if</span>&nbsp;<span class="op" id="4292107">!</span><span class="ident" id="4292108">more</span>&nbsp;<span class="op" id="4292113">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292118">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292132">return</span>&nbsp;<span class="ident" id="4292139">line</span><span class="op" id="4292143">,</span>&nbsp;<span class="ident" id="4292145">nil</span><br>
<span class="lineno"></span><span class="op" id="4292149">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4292152">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="4292213">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="4292262">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4292324">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="4292387">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4292446">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="4292509">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4292525">//</span><br>
<span class="lineno"></span><span class="comment" id="4292528">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="4292565">//</span><br>
<span class="lineno"></span><span class="comment" id="4292568">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4292578">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="4292596">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4292606">//</span><br>
<span class="lineno">85</span><span class="comment" id="4292609">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4292682">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4292722">//</span><br>
<span class="lineno"></span><span class="comment" id="4292725">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="4292786">//</span><br>
<span class="lineno">90</span><span class="keyword" id="4292789">func</span>&nbsp;<span class="op" id="4292794">(</span><span class="ident" id="4292795">r</span>&nbsp;<span class="op" id="4292797">*</span><span class="ident" id="4292798">Reader</span><span class="op" id="4292804">)</span>&nbsp;<span class="ident" id="4292806">ReadContinuedLine</span><span class="op" id="4292823">(</span><span class="op" id="4292824">)</span>&nbsp;<span class="op" id="4292826">(</span><span class="builtintype" id="4292827">string</span><span class="op" id="4292833">,</span>&nbsp;<span class="builtintype" id="4292835">error</span><span class="op" id="4292840">)</span>&nbsp;<span class="op" id="4292842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292845">line</span><span class="op" id="4292849">,</span>&nbsp;<span class="ident" id="4292851">err</span>&nbsp;<span class="op" id="4292855">:=</span>&nbsp;<span class="ident" id="4292858">r</span><span class="op" id="4292859">.</span><span class="ident" id="4292860">readContinuedLineSlice</span><span class="op" id="4292882">(</span><span class="op" id="4292883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292886">return</span>&nbsp;<span class="builtintype" id="4292893">string</span><span class="op" id="4292899">(</span><span class="ident" id="4292900">line</span><span class="op" id="4292904">)</span><span class="op" id="4292905">,</span>&nbsp;<span class="ident" id="4292907">err</span><br>
<span class="lineno"></span><span class="op" id="4292911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4292914">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4292983">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="4293023">func</span>&nbsp;<span class="ident" id="4293028">trim</span><span class="op" id="4293032">(</span><span class="ident" id="4293033">s</span>&nbsp;<span class="op" id="4293035">[</span><span class="op" id="4293036">]</span><span class="builtintype" id="4293037">byte</span><span class="op" id="4293041">)</span>&nbsp;<span class="op" id="4293043">[</span><span class="op" id="4293044">]</span><span class="builtintype" id="4293045">byte</span>&nbsp;<span class="op" id="4293050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293053">i</span>&nbsp;<span class="op" id="4293055">:=</span>&nbsp;<span class="num" id="4293058">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293061">for</span>&nbsp;<span class="ident" id="4293065">i</span>&nbsp;<span class="op" id="4293067">&lt;</span>&nbsp;<span class="builtinfunc" id="4293069">len</span><span class="op" id="4293072">(</span><span class="ident" id="4293073">s</span><span class="op" id="4293074">)</span>&nbsp;<span class="op" id="4293076">&amp;&amp;</span>&nbsp;<span class="op" id="4293079">(</span><span class="ident" id="4293080">s</span><span class="op" id="4293081">[</span><span class="ident" id="4293082">i</span><span class="op" id="4293083">]</span>&nbsp;<span class="op" id="4293085">==</span>&nbsp;<span class="string" id="4293088">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4293092">||</span>&nbsp;<span class="ident" id="4293095">s</span><span class="op" id="4293096">[</span><span class="ident" id="4293097">i</span><span class="op" id="4293098">]</span>&nbsp;<span class="op" id="4293100">==</span>&nbsp;<span class="string" id="4293103">&#39;\t&#39;</span><span class="op" id="4293107">)</span>&nbsp;<span class="op" id="4293109">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293113">i</span><span class="op" id="4293114">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293121">n</span>&nbsp;<span class="op" id="4293123">:=</span>&nbsp;<span class="builtinfunc" id="4293126">len</span><span class="op" id="4293129">(</span><span class="ident" id="4293130">s</span><span class="op" id="4293131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293134">for</span>&nbsp;<span class="ident" id="4293138">n</span>&nbsp;<span class="op" id="4293140">&gt;</span>&nbsp;<span class="ident" id="4293142">i</span>&nbsp;<span class="op" id="4293144">&amp;&amp;</span>&nbsp;<span class="op" id="4293147">(</span><span class="ident" id="4293148">s</span><span class="op" id="4293149">[</span><span class="ident" id="4293150">n</span><span class="op" id="4293151">-</span><span class="num" id="4293152">1</span><span class="op" id="4293153">]</span>&nbsp;<span class="op" id="4293155">==</span>&nbsp;<span class="string" id="4293158">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4293162">||</span>&nbsp;<span class="ident" id="4293165">s</span><span class="op" id="4293166">[</span><span class="ident" id="4293167">n</span><span class="op" id="4293168">-</span><span class="num" id="4293169">1</span><span class="op" id="4293170">]</span>&nbsp;<span class="op" id="4293172">==</span>&nbsp;<span class="string" id="4293175">&#39;\t&#39;</span><span class="op" id="4293179">)</span>&nbsp;<span class="op" id="4293181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293185">n</span><span class="op" id="4293186">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293193">return</span>&nbsp;<span class="ident" id="4293200">s</span><span class="op" id="4293201">[</span><span class="ident" id="4293202">i</span><span class="op" id="4293203">:</span><span class="ident" id="4293204">n</span><span class="op" id="4293205">]</span><br>
<span class="lineno"></span><span class="op" id="4293207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4293210">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="4293266">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4293307">func</span>&nbsp;<span class="op" id="4293312">(</span><span class="ident" id="4293313">r</span>&nbsp;<span class="op" id="4293315">*</span><span class="ident" id="4293316">Reader</span><span class="op" id="4293322">)</span>&nbsp;<span class="ident" id="4293324">ReadContinuedLineBytes</span><span class="op" id="4293346">(</span><span class="op" id="4293347">)</span>&nbsp;<span class="op" id="4293349">(</span><span class="op" id="4293350">[</span><span class="op" id="4293351">]</span><span class="builtintype" id="4293352">byte</span><span class="op" id="4293356">,</span>&nbsp;<span class="builtintype" id="4293358">error</span><span class="op" id="4293363">)</span>&nbsp;<span class="op" id="4293365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293368">line</span><span class="op" id="4293372">,</span>&nbsp;<span class="ident" id="4293374">err</span>&nbsp;<span class="op" id="4293378">:=</span>&nbsp;<span class="ident" id="4293381">r</span><span class="op" id="4293382">.</span><span class="ident" id="4293383">readContinuedLineSlice</span><span class="op" id="4293405">(</span><span class="op" id="4293406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293409">if</span>&nbsp;<span class="ident" id="4293412">line</span>&nbsp;<span class="op" id="4293417">!=</span>&nbsp;<span class="ident" id="4293420">nil</span>&nbsp;<span class="op" id="4293424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293428">buf</span>&nbsp;<span class="op" id="4293432">:=</span>&nbsp;<span class="builtinfunc" id="4293435">make</span><span class="op" id="4293439">(</span><span class="op" id="4293440">[</span><span class="op" id="4293441">]</span><span class="builtintype" id="4293442">byte</span><span class="op" id="4293446">,</span>&nbsp;<span class="builtinfunc" id="4293448">len</span><span class="op" id="4293451">(</span><span class="ident" id="4293452">line</span><span class="op" id="4293456">)</span><span class="op" id="4293457">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4293461">copy</span><span class="op" id="4293465">(</span><span class="ident" id="4293466">buf</span><span class="op" id="4293469">,</span>&nbsp;<span class="ident" id="4293471">line</span><span class="op" id="4293475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293479">line</span>&nbsp;<span class="op" id="4293484">=</span>&nbsp;<span class="ident" id="4293486">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293494">return</span>&nbsp;<span class="ident" id="4293501">line</span><span class="op" id="4293505">,</span>&nbsp;<span class="ident" id="4293507">err</span><br>
<span class="lineno"></span><span class="op" id="4293511">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4293514">func</span>&nbsp;<span class="op" id="4293519">(</span><span class="ident" id="4293520">r</span>&nbsp;<span class="op" id="4293522">*</span><span class="ident" id="4293523">Reader</span><span class="op" id="4293529">)</span>&nbsp;<span class="ident" id="4293531">readContinuedLineSlice</span><span class="op" id="4293553">(</span><span class="op" id="4293554">)</span>&nbsp;<span class="op" id="4293556">(</span><span class="op" id="4293557">[</span><span class="op" id="4293558">]</span><span class="builtintype" id="4293559">byte</span><span class="op" id="4293563">,</span>&nbsp;<span class="builtintype" id="4293565">error</span><span class="op" id="4293570">)</span>&nbsp;<span class="op" id="4293572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293575">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293600">line</span><span class="op" id="4293604">,</span>&nbsp;<span class="ident" id="4293606">err</span>&nbsp;<span class="op" id="4293610">:=</span>&nbsp;<span class="ident" id="4293613">r</span><span class="op" id="4293614">.</span><span class="ident" id="4293615">readLineSlice</span><span class="op" id="4293628">(</span><span class="op" id="4293629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293632">if</span>&nbsp;<span class="ident" id="4293635">err</span>&nbsp;<span class="op" id="4293639">!=</span>&nbsp;<span class="ident" id="4293642">nil</span>&nbsp;<span class="op" id="4293646">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293650">return</span>&nbsp;<span class="ident" id="4293657">nil</span><span class="op" id="4293660">,</span>&nbsp;<span class="ident" id="4293662">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293670">if</span>&nbsp;<span class="builtinfunc" id="4293673">len</span><span class="op" id="4293676">(</span><span class="ident" id="4293677">line</span><span class="op" id="4293681">)</span>&nbsp;<span class="op" id="4293683">==</span>&nbsp;<span class="num" id="4293686">0</span>&nbsp;<span class="op" id="4293688">{</span>&nbsp;<span class="comment" id="4293690">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293724">return</span>&nbsp;<span class="ident" id="4293731">line</span><span class="op" id="4293735">,</span>&nbsp;<span class="ident" id="4293737">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293742">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293746">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293817">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293889">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293961">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293990">if</span>&nbsp;<span class="ident" id="4293993">r</span><span class="op" id="4293994">.</span><span class="ident" id="4293995">R</span><span class="op" id="4293996">.</span><span class="ident" id="4293997">Buffered</span><span class="op" id="4294005">(</span><span class="op" id="4294006">)</span>&nbsp;<span class="op" id="4294008">&gt;</span>&nbsp;<span class="num" id="4294010">1</span>&nbsp;<span class="op" id="4294012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294016">peek</span><span class="op" id="4294020">,</span>&nbsp;<span class="ident" id="4294022">err</span>&nbsp;<span class="op" id="4294026">:=</span>&nbsp;<span class="ident" id="4294029">r</span><span class="op" id="4294030">.</span><span class="ident" id="4294031">R</span><span class="op" id="4294032">.</span><span class="ident" id="4294033">Peek</span><span class="op" id="4294037">(</span><span class="num" id="4294038">1</span><span class="op" id="4294039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294043">if</span>&nbsp;<span class="ident" id="4294046">err</span>&nbsp;<span class="op" id="4294050">==</span>&nbsp;<span class="ident" id="4294053">nil</span>&nbsp;<span class="op" id="4294057">&amp;&amp;</span>&nbsp;<span class="ident" id="4294060">isASCIILetter</span><span class="op" id="4294073">(</span><span class="ident" id="4294074">peek</span><span class="op" id="4294078">[</span><span class="num" id="4294079">0</span><span class="op" id="4294080">]</span><span class="op" id="4294081">)</span>&nbsp;<span class="op" id="4294083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294088">return</span>&nbsp;<span class="ident" id="4294095">trim</span><span class="op" id="4294099">(</span><span class="ident" id="4294100">line</span><span class="op" id="4294104">)</span><span class="op" id="4294105">,</span>&nbsp;<span class="ident" id="4294107">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294113">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294120">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294187">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294216">r</span><span class="op" id="4294217">.</span><span class="ident" id="4294218">buf</span>&nbsp;<span class="op" id="4294222">=</span>&nbsp;<span class="builtinfunc" id="4294224">append</span><span class="op" id="4294230">(</span><span class="ident" id="4294231">r</span><span class="op" id="4294232">.</span><span class="ident" id="4294233">buf</span><span class="op" id="4294236">[</span><span class="op" id="4294237">:</span><span class="num" id="4294238">0</span><span class="op" id="4294239">]</span><span class="op" id="4294240">,</span>&nbsp;<span class="ident" id="4294242">trim</span><span class="op" id="4294246">(</span><span class="ident" id="4294247">line</span><span class="op" id="4294251">)</span><span class="op" id="4294252">...</span><span class="op" id="4294255">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294259">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294288">for</span>&nbsp;<span class="ident" id="4294292">r</span><span class="op" id="4294293">.</span><span class="ident" id="4294294">skipSpace</span><span class="op" id="4294303">(</span><span class="op" id="4294304">)</span>&nbsp;<span class="op" id="4294306">&gt;</span>&nbsp;<span class="num" id="4294308">0</span>&nbsp;<span class="op" id="4294310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294314">line</span><span class="op" id="4294318">,</span>&nbsp;<span class="ident" id="4294320">err</span>&nbsp;<span class="op" id="4294324">:=</span>&nbsp;<span class="ident" id="4294327">r</span><span class="op" id="4294328">.</span><span class="ident" id="4294329">readLineSlice</span><span class="op" id="4294342">(</span><span class="op" id="4294343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294347">if</span>&nbsp;<span class="ident" id="4294350">err</span>&nbsp;<span class="op" id="4294354">!=</span>&nbsp;<span class="ident" id="4294357">nil</span>&nbsp;<span class="op" id="4294361">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294366">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294378">r</span><span class="op" id="4294379">.</span><span class="ident" id="4294380">buf</span>&nbsp;<span class="op" id="4294384">=</span>&nbsp;<span class="builtinfunc" id="4294386">append</span><span class="op" id="4294392">(</span><span class="ident" id="4294393">r</span><span class="op" id="4294394">.</span><span class="ident" id="4294395">buf</span><span class="op" id="4294398">,</span>&nbsp;<span class="string" id="4294400">&#39;&nbsp;&#39;</span><span class="op" id="4294403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294407">r</span><span class="op" id="4294408">.</span><span class="ident" id="4294409">buf</span>&nbsp;<span class="op" id="4294413">=</span>&nbsp;<span class="builtinfunc" id="4294415">append</span><span class="op" id="4294421">(</span><span class="ident" id="4294422">r</span><span class="op" id="4294423">.</span><span class="ident" id="4294424">buf</span><span class="op" id="4294427">,</span>&nbsp;<span class="ident" id="4294429">line</span><span class="op" id="4294433">...</span><span class="op" id="4294436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294439">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294442">return</span>&nbsp;<span class="ident" id="4294449">r</span><span class="op" id="4294450">.</span><span class="ident" id="4294451">buf</span><span class="op" id="4294454">,</span>&nbsp;<span class="ident" id="4294456">nil</span><br>
<span class="lineno"></span><span class="op" id="4294460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294463">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="4294541">func</span>&nbsp;<span class="op" id="4294546">(</span><span class="ident" id="4294547">r</span>&nbsp;<span class="op" id="4294549">*</span><span class="ident" id="4294550">Reader</span><span class="op" id="4294556">)</span>&nbsp;<span class="ident" id="4294558">skipSpace</span><span class="op" id="4294567">(</span><span class="op" id="4294568">)</span>&nbsp;<span class="builtintype" id="4294570">int</span>&nbsp;<span class="op" id="4294574">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294577">n</span>&nbsp;<span class="op" id="4294579">:=</span>&nbsp;<span class="num" id="4294582">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294585">for</span>&nbsp;<span class="op" id="4294589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294593">c</span><span class="op" id="4294594">,</span>&nbsp;<span class="ident" id="4294596">err</span>&nbsp;<span class="op" id="4294600">:=</span>&nbsp;<span class="ident" id="4294603">r</span><span class="op" id="4294604">.</span><span class="ident" id="4294605">R</span><span class="op" id="4294606">.</span><span class="ident" id="4294607">ReadByte</span><span class="op" id="4294615">(</span><span class="op" id="4294616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294620">if</span>&nbsp;<span class="ident" id="4294623">err</span>&nbsp;<span class="op" id="4294627">!=</span>&nbsp;<span class="ident" id="4294630">nil</span>&nbsp;<span class="op" id="4294634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294639">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294682">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294694">if</span>&nbsp;<span class="ident" id="4294697">c</span>&nbsp;<span class="op" id="4294699">!=</span>&nbsp;<span class="string" id="4294702">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4294706">&amp;&amp;</span>&nbsp;<span class="ident" id="4294709">c</span>&nbsp;<span class="op" id="4294711">!=</span>&nbsp;<span class="string" id="4294714">&#39;\t&#39;</span>&nbsp;<span class="op" id="4294719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294724">r</span><span class="op" id="4294725">.</span><span class="ident" id="4294726">R</span><span class="op" id="4294727">.</span><span class="ident" id="4294728">UnreadByte</span><span class="op" id="4294738">(</span><span class="op" id="4294739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294744">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294756">n</span><span class="op" id="4294757">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294764">return</span>&nbsp;<span class="ident" id="4294771">n</span><br>
<span class="lineno"></span><span class="op" id="4294773">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="4294776">func</span>&nbsp;<span class="op" id="4294781">(</span><span class="ident" id="4294782">r</span>&nbsp;<span class="op" id="4294784">*</span><span class="ident" id="4294785">Reader</span><span class="op" id="4294791">)</span>&nbsp;<span class="ident" id="4294793">readCodeLine</span><span class="op" id="4294805">(</span><span class="ident" id="4294806">expectCode</span>&nbsp;<span class="builtintype" id="4294817">int</span><span class="op" id="4294820">)</span>&nbsp;<span class="op" id="4294822">(</span><span class="ident" id="4294823">code</span>&nbsp;<span class="builtintype" id="4294828">int</span><span class="op" id="4294831">,</span>&nbsp;<span class="ident" id="4294833">continued</span>&nbsp;<span class="builtintype" id="4294843">bool</span><span class="op" id="4294847">,</span>&nbsp;<span class="ident" id="4294849">message</span>&nbsp;<span class="builtintype" id="4294857">string</span><span class="op" id="4294863">,</span>&nbsp;<span class="ident" id="4294865">err</span>&nbsp;<span class="builtintype" id="4294869">error</span><span class="op" id="4294874">)</span>&nbsp;<span class="op" id="4294876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294879">line</span><span class="op" id="4294883">,</span>&nbsp;<span class="ident" id="4294885">err</span>&nbsp;<span class="op" id="4294889">:=</span>&nbsp;<span class="ident" id="4294892">r</span><span class="op" id="4294893">.</span><span class="ident" id="4294894">ReadLine</span><span class="op" id="4294902">(</span><span class="op" id="4294903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294906">if</span>&nbsp;<span class="ident" id="4294909">err</span>&nbsp;<span class="op" id="4294913">!=</span>&nbsp;<span class="ident" id="4294916">nil</span>&nbsp;<span class="op" id="4294920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294924">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294935">return</span>&nbsp;<span class="ident" id="4294942">parseCodeLine</span><span class="op" id="4294955">(</span><span class="ident" id="4294956">line</span><span class="op" id="4294960">,</span>&nbsp;<span class="ident" id="4294962">expectCode</span><span class="op" id="4294972">)</span><br>
<span class="lineno"></span><span class="op" id="4294974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4294977">func</span>&nbsp;<span class="ident" id="4294982">parseCodeLine</span><span class="op" id="4294995">(</span><span class="ident" id="4294996">line</span>&nbsp;<span class="builtintype" id="4295001">string</span><span class="op" id="4295007">,</span>&nbsp;<span class="ident" id="4295009">expectCode</span>&nbsp;<span class="builtintype" id="4295020">int</span><span class="op" id="4295023">)</span>&nbsp;<span class="op" id="4295025">(</span><span class="ident" id="4295026">code</span>&nbsp;<span class="builtintype" id="4295031">int</span><span class="op" id="4295034">,</span>&nbsp;<span class="ident" id="4295036">continued</span>&nbsp;<span class="builtintype" id="4295046">bool</span><span class="op" id="4295050">,</span>&nbsp;<span class="ident" id="4295052">message</span>&nbsp;<span class="builtintype" id="4295060">string</span><span class="op" id="4295066">,</span>&nbsp;<span class="ident" id="4295068">err</span>&nbsp;<span class="builtintype" id="4295072">error</span><span class="op" id="4295077">)</span>&nbsp;<span class="op" id="4295079">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295082">if</span>&nbsp;<span class="builtinfunc" id="4295085">len</span><span class="op" id="4295088">(</span><span class="ident" id="4295089">line</span><span class="op" id="4295093">)</span>&nbsp;<span class="op" id="4295095">&lt;</span>&nbsp;<span class="num" id="4295097">4</span>&nbsp;<span class="op" id="4295099">||</span>&nbsp;<span class="ident" id="4295102">line</span><span class="op" id="4295106">[</span><span class="num" id="4295107">3</span><span class="op" id="4295108">]</span>&nbsp;<span class="op" id="4295110">!=</span>&nbsp;<span class="string" id="4295113">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4295117">&amp;&amp;</span>&nbsp;<span class="ident" id="4295120">line</span><span class="op" id="4295124">[</span><span class="num" id="4295125">3</span><span class="op" id="4295126">]</span>&nbsp;<span class="op" id="4295128">!=</span>&nbsp;<span class="string" id="4295131">&#39;-&#39;</span>&nbsp;<span class="op" id="4295135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295139">err</span>&nbsp;<span class="op" id="4295143">=</span>&nbsp;<span class="ident" id="4295145">ProtocolError</span><span class="op" id="4295158">(</span><span class="string" id="4295159">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4295178">+</span>&nbsp;<span class="ident" id="4295180">line</span><span class="op" id="4295184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295199">continued</span>&nbsp;<span class="op" id="4295209">=</span>&nbsp;<span class="ident" id="4295211">line</span><span class="op" id="4295215">[</span><span class="num" id="4295216">3</span><span class="op" id="4295217">]</span>&nbsp;<span class="op" id="4295219">==</span>&nbsp;<span class="string" id="4295222">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295227">code</span><span class="op" id="4295231">,</span>&nbsp;<span class="ident" id="4295233">err</span>&nbsp;<span class="op" id="4295237">=</span>&nbsp;<span class="ident" id="4295239">strconv</span><span class="op" id="4295246">.</span><span class="ident" id="4295247">Atoi</span><span class="op" id="4295251">(</span><span class="ident" id="4295252">line</span><span class="op" id="4295256">[</span><span class="num" id="4295257">0</span><span class="op" id="4295258">:</span><span class="num" id="4295259">3</span><span class="op" id="4295260">]</span><span class="op" id="4295261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295264">if</span>&nbsp;<span class="ident" id="4295267">err</span>&nbsp;<span class="op" id="4295271">!=</span>&nbsp;<span class="ident" id="4295274">nil</span>&nbsp;<span class="op" id="4295278">||</span>&nbsp;<span class="ident" id="4295281">code</span>&nbsp;<span class="op" id="4295286">&lt;</span>&nbsp;<span class="num" id="4295288">100</span>&nbsp;<span class="op" id="4295292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295296">err</span>&nbsp;<span class="op" id="4295300">=</span>&nbsp;<span class="ident" id="4295302">ProtocolError</span><span class="op" id="4295315">(</span><span class="string" id="4295316">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="4295342">+</span>&nbsp;<span class="ident" id="4295344">line</span><span class="op" id="4295348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295352">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295360">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295363">message</span>&nbsp;<span class="op" id="4295371">=</span>&nbsp;<span class="ident" id="4295373">line</span><span class="op" id="4295377">[</span><span class="num" id="4295378">4</span><span class="op" id="4295379">:</span><span class="op" id="4295380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295383">if</span>&nbsp;<span class="num" id="4295386">1</span>&nbsp;<span class="op" id="4295388">&lt;=</span>&nbsp;<span class="ident" id="4295391">expectCode</span>&nbsp;<span class="op" id="4295402">&amp;&amp;</span>&nbsp;<span class="ident" id="4295405">expectCode</span>&nbsp;<span class="op" id="4295416">&lt;</span>&nbsp;<span class="num" id="4295418">10</span>&nbsp;<span class="op" id="4295421">&amp;&amp;</span>&nbsp;<span class="ident" id="4295424">code</span><span class="op" id="4295428">/</span><span class="num" id="4295429">100</span>&nbsp;<span class="op" id="4295433">!=</span>&nbsp;<span class="ident" id="4295436">expectCode</span>&nbsp;<span class="op" id="4295447">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4295452">10</span>&nbsp;<span class="op" id="4295455">&lt;=</span>&nbsp;<span class="ident" id="4295458">expectCode</span>&nbsp;<span class="op" id="4295469">&amp;&amp;</span>&nbsp;<span class="ident" id="4295472">expectCode</span>&nbsp;<span class="op" id="4295483">&lt;</span>&nbsp;<span class="num" id="4295485">100</span>&nbsp;<span class="op" id="4295489">&amp;&amp;</span>&nbsp;<span class="ident" id="4295492">code</span><span class="op" id="4295496">/</span><span class="num" id="4295497">10</span>&nbsp;<span class="op" id="4295500">!=</span>&nbsp;<span class="ident" id="4295503">expectCode</span>&nbsp;<span class="op" id="4295514">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4295519">100</span>&nbsp;<span class="op" id="4295523">&lt;=</span>&nbsp;<span class="ident" id="4295526">expectCode</span>&nbsp;<span class="op" id="4295537">&amp;&amp;</span>&nbsp;<span class="ident" id="4295540">expectCode</span>&nbsp;<span class="op" id="4295551">&lt;</span>&nbsp;<span class="num" id="4295553">1000</span>&nbsp;<span class="op" id="4295558">&amp;&amp;</span>&nbsp;<span class="ident" id="4295561">code</span>&nbsp;<span class="op" id="4295566">!=</span>&nbsp;<span class="ident" id="4295569">expectCode</span>&nbsp;<span class="op" id="4295580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295584">err</span>&nbsp;<span class="op" id="4295588">=</span>&nbsp;<span class="op" id="4295590">&amp;</span><span class="ident" id="4295591">Error</span><span class="op" id="4295596">{</span><span class="ident" id="4295597">code</span><span class="op" id="4295601">,</span>&nbsp;<span class="ident" id="4295603">message</span><span class="op" id="4295610">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295616">return</span><br>
<span class="lineno"></span><span class="op" id="4295623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295626">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="4295681">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4295697">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4295756">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="4295823">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="4295856">//</span><br>
<span class="lineno">210</span><span class="comment" id="4295859">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="4295931">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="4295994">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4296060">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="4296105">//</span><br>
<span class="lineno">215</span><span class="comment" id="4296108">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4296173">//</span><br>
<span class="lineno"></span><span class="comment" id="4296176">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4296237">//</span><br>
<span class="lineno"></span><span class="keyword" id="4296240">func</span>&nbsp;<span class="op" id="4296245">(</span><span class="ident" id="4296246">r</span>&nbsp;<span class="op" id="4296248">*</span><span class="ident" id="4296249">Reader</span><span class="op" id="4296255">)</span>&nbsp;<span class="ident" id="4296257">ReadCodeLine</span><span class="op" id="4296269">(</span><span class="ident" id="4296270">expectCode</span>&nbsp;<span class="builtintype" id="4296281">int</span><span class="op" id="4296284">)</span>&nbsp;<span class="op" id="4296286">(</span><span class="ident" id="4296287">code</span>&nbsp;<span class="builtintype" id="4296292">int</span><span class="op" id="4296295">,</span>&nbsp;<span class="ident" id="4296297">message</span>&nbsp;<span class="builtintype" id="4296305">string</span><span class="op" id="4296311">,</span>&nbsp;<span class="ident" id="4296313">err</span>&nbsp;<span class="builtintype" id="4296317">error</span><span class="op" id="4296322">)</span>&nbsp;<span class="op" id="4296324">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296327">code</span><span class="op" id="4296331">,</span>&nbsp;<span class="ident" id="4296333">continued</span><span class="op" id="4296342">,</span>&nbsp;<span class="ident" id="4296344">message</span><span class="op" id="4296351">,</span>&nbsp;<span class="ident" id="4296353">err</span>&nbsp;<span class="op" id="4296357">:=</span>&nbsp;<span class="ident" id="4296360">r</span><span class="op" id="4296361">.</span><span class="ident" id="4296362">readCodeLine</span><span class="op" id="4296374">(</span><span class="ident" id="4296375">expectCode</span><span class="op" id="4296385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296388">if</span>&nbsp;<span class="ident" id="4296391">err</span>&nbsp;<span class="op" id="4296395">==</span>&nbsp;<span class="ident" id="4296398">nil</span>&nbsp;<span class="op" id="4296402">&amp;&amp;</span>&nbsp;<span class="ident" id="4296405">continued</span>&nbsp;<span class="op" id="4296415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296419">err</span>&nbsp;<span class="op" id="4296423">=</span>&nbsp;<span class="ident" id="4296425">ProtocolError</span><span class="op" id="4296438">(</span><span class="string" id="4296439">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4296474">+</span>&nbsp;<span class="ident" id="4296476">message</span><span class="op" id="4296483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296489">return</span><br>
<span class="lineno">225</span><span class="op" id="4296496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4296499">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="4296556">//</span><br>
<span class="lineno"></span><span class="comment" id="4296559">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="4296582">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4296605">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="4296612">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4296635">//</span><br>
<span class="lineno"></span><span class="comment" id="4296638">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="4296713">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="4296784">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4296851">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="4296883">//</span><br>
<span class="lineno"></span><span class="comment" id="4296886">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="4296953">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="4296965">//</span><br>
<span class="lineno"></span><span class="comment" id="4296968">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="4297040">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="4297103">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="4297169">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="4297214">//</span><br>
<span class="lineno"></span><span class="comment" id="4297217">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4297278">//</span><br>
<span class="lineno"></span><span class="keyword" id="4297281">func</span>&nbsp;<span class="op" id="4297286">(</span><span class="ident" id="4297287">r</span>&nbsp;<span class="op" id="4297289">*</span><span class="ident" id="4297290">Reader</span><span class="op" id="4297296">)</span>&nbsp;<span class="ident" id="4297298">ReadResponse</span><span class="op" id="4297310">(</span><span class="ident" id="4297311">expectCode</span>&nbsp;<span class="builtintype" id="4297322">int</span><span class="op" id="4297325">)</span>&nbsp;<span class="op" id="4297327">(</span><span class="ident" id="4297328">code</span>&nbsp;<span class="builtintype" id="4297333">int</span><span class="op" id="4297336">,</span>&nbsp;<span class="ident" id="4297338">message</span>&nbsp;<span class="builtintype" id="4297346">string</span><span class="op" id="4297352">,</span>&nbsp;<span class="ident" id="4297354">err</span>&nbsp;<span class="builtintype" id="4297358">error</span><span class="op" id="4297363">)</span>&nbsp;<span class="op" id="4297365">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297368">code</span><span class="op" id="4297372">,</span>&nbsp;<span class="ident" id="4297374">continued</span><span class="op" id="4297383">,</span>&nbsp;<span class="ident" id="4297385">message</span><span class="op" id="4297392">,</span>&nbsp;<span class="ident" id="4297394">err</span>&nbsp;<span class="op" id="4297398">:=</span>&nbsp;<span class="ident" id="4297401">r</span><span class="op" id="4297402">.</span><span class="ident" id="4297403">readCodeLine</span><span class="op" id="4297415">(</span><span class="ident" id="4297416">expectCode</span><span class="op" id="4297426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297429">for</span>&nbsp;<span class="ident" id="4297433">err</span>&nbsp;<span class="op" id="4297437">==</span>&nbsp;<span class="ident" id="4297440">nil</span>&nbsp;<span class="op" id="4297444">&amp;&amp;</span>&nbsp;<span class="ident" id="4297447">continued</span>&nbsp;<span class="op" id="4297457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297461">line</span><span class="op" id="4297465">,</span>&nbsp;<span class="ident" id="4297467">err</span>&nbsp;<span class="op" id="4297471">:=</span>&nbsp;<span class="ident" id="4297474">r</span><span class="op" id="4297475">.</span><span class="ident" id="4297476">ReadLine</span><span class="op" id="4297484">(</span><span class="op" id="4297485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297489">if</span>&nbsp;<span class="ident" id="4297492">err</span>&nbsp;<span class="op" id="4297496">!=</span>&nbsp;<span class="ident" id="4297499">nil</span>&nbsp;<span class="op" id="4297503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297508">return</span>&nbsp;<span class="num" id="4297515">0</span><span class="op" id="4297516">,</span>&nbsp;<span class="string" id="4297518">&#34;&#34;</span><span class="op" id="4297520">,</span>&nbsp;<span class="ident" id="4297522">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297533">var</span>&nbsp;<span class="ident" id="4297537">code2</span>&nbsp;<span class="builtintype" id="4297543">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297549">var</span>&nbsp;<span class="ident" id="4297553">moreMessage</span>&nbsp;<span class="builtintype" id="4297565">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297574">code2</span><span class="op" id="4297579">,</span>&nbsp;<span class="ident" id="4297581">continued</span><span class="op" id="4297590">,</span>&nbsp;<span class="ident" id="4297592">moreMessage</span><span class="op" id="4297603">,</span>&nbsp;<span class="ident" id="4297605">err</span>&nbsp;<span class="op" id="4297609">=</span>&nbsp;<span class="ident" id="4297611">parseCodeLine</span><span class="op" id="4297624">(</span><span class="ident" id="4297625">line</span><span class="op" id="4297629">,</span>&nbsp;<span class="ident" id="4297631">expectCode</span><span class="op" id="4297641">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297645">if</span>&nbsp;<span class="ident" id="4297648">err</span>&nbsp;<span class="op" id="4297652">!=</span>&nbsp;<span class="ident" id="4297655">nil</span>&nbsp;<span class="op" id="4297659">||</span>&nbsp;<span class="ident" id="4297662">code2</span>&nbsp;<span class="op" id="4297668">!=</span>&nbsp;<span class="ident" id="4297671">code</span>&nbsp;<span class="op" id="4297676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297681">message</span>&nbsp;<span class="op" id="4297689">+=</span>&nbsp;<span class="string" id="4297692">&#34;\n&#34;</span>&nbsp;<span class="op" id="4297697">+</span>&nbsp;<span class="ident" id="4297699">strings</span><span class="op" id="4297706">.</span><span class="ident" id="4297707">TrimRight</span><span class="op" id="4297716">(</span><span class="ident" id="4297717">line</span><span class="op" id="4297721">,</span>&nbsp;<span class="string" id="4297723">&#34;\r\n&#34;</span><span class="op" id="4297729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297734">continued</span>&nbsp;<span class="op" id="4297744">=</span>&nbsp;<span class="builtintype" id="4297746">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297754">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297765">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297769">message</span>&nbsp;<span class="op" id="4297777">+=</span>&nbsp;<span class="string" id="4297780">&#34;\n&#34;</span>&nbsp;<span class="op" id="4297785">+</span>&nbsp;<span class="ident" id="4297787">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297803">return</span><br>
<span class="lineno"></span><span class="op" id="4297810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4297813">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4297878">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4297930">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4297987">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4298008">//</span><br>
<span class="lineno">275</span><span class="comment" id="4298011">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="4298068">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4298136">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="4298200">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="4298267">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="4298325">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4298366">//</span><br>
<span class="lineno"></span><span class="comment" id="4298369">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="4298426">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4298485">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="4298556">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="4298618">func</span>&nbsp;<span class="op" id="4298623">(</span><span class="ident" id="4298624">r</span>&nbsp;<span class="op" id="4298626">*</span><span class="ident" id="4298627">Reader</span><span class="op" id="4298633">)</span>&nbsp;<span class="ident" id="4298635">DotReader</span><span class="op" id="4298644">(</span><span class="op" id="4298645">)</span>&nbsp;<span class="ident" id="4298647">io</span><span class="op" id="4298649">.</span><span class="ident" id="4298650">Reader</span>&nbsp;<span class="op" id="4298657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298660">r</span><span class="op" id="4298661">.</span><span class="ident" id="4298662">closeDot</span><span class="op" id="4298670">(</span><span class="op" id="4298671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298674">r</span><span class="op" id="4298675">.</span><span class="ident" id="4298676">dot</span>&nbsp;<span class="op" id="4298680">=</span>&nbsp;<span class="op" id="4298682">&amp;</span><span class="ident" id="4298683">dotReader</span><span class="op" id="4298692">{</span><span class="ident" id="4298693">r</span><span class="op" id="4298694">:</span>&nbsp;<span class="ident" id="4298696">r</span><span class="op" id="4298697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298700">return</span>&nbsp;<span class="ident" id="4298707">r</span><span class="op" id="4298708">.</span><span class="ident" id="4298709">dot</span><br>
<span class="lineno">290</span><span class="op" id="4298713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4298716">type</span>&nbsp;<span class="ident" id="4298721">dotReader</span>&nbsp;<span class="keyword" id="4298731">struct</span>&nbsp;<span class="op" id="4298738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298741">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4298747">*</span><span class="ident" id="4298748">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298756">state</span>&nbsp;<span class="builtintype" id="4298762">int</span><br>
<span class="lineno">295</span><span class="op" id="4298766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4298769">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="4298837">func</span>&nbsp;<span class="op" id="4298842">(</span><span class="ident" id="4298843">d</span>&nbsp;<span class="op" id="4298845">*</span><span class="ident" id="4298846">dotReader</span><span class="op" id="4298855">)</span>&nbsp;<span class="ident" id="4298857">Read</span><span class="op" id="4298861">(</span><span class="ident" id="4298862">b</span>&nbsp;<span class="op" id="4298864">[</span><span class="op" id="4298865">]</span><span class="builtintype" id="4298866">byte</span><span class="op" id="4298870">)</span>&nbsp;<span class="op" id="4298872">(</span><span class="ident" id="4298873">n</span>&nbsp;<span class="builtintype" id="4298875">int</span><span class="op" id="4298878">,</span>&nbsp;<span class="ident" id="4298880">err</span>&nbsp;<span class="builtintype" id="4298884">error</span><span class="op" id="4298889">)</span>&nbsp;<span class="op" id="4298891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298894">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298941">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298996">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299030">const</span>&nbsp;<span class="op" id="4299036">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299040">stateBeginLine</span>&nbsp;<span class="op" id="4299055">=</span>&nbsp;<span class="ident" id="4299057">iota</span>&nbsp;<span class="comment" id="4299062">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299114">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299136">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299169">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299191">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299226">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299248">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299287">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299309">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299345">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299367">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299401">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299404">br</span>&nbsp;<span class="op" id="4299407">:=</span>&nbsp;<span class="ident" id="4299410">d</span><span class="op" id="4299411">.</span><span class="ident" id="4299412">r</span><span class="op" id="4299413">.</span><span class="ident" id="4299414">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299417">for</span>&nbsp;<span class="ident" id="4299421">n</span>&nbsp;<span class="op" id="4299423">&lt;</span>&nbsp;<span class="builtinfunc" id="4299425">len</span><span class="op" id="4299428">(</span><span class="ident" id="4299429">b</span><span class="op" id="4299430">)</span>&nbsp;<span class="op" id="4299432">&amp;&amp;</span>&nbsp;<span class="ident" id="4299435">d</span><span class="op" id="4299436">.</span><span class="ident" id="4299437">state</span>&nbsp;<span class="op" id="4299443">!=</span>&nbsp;<span class="ident" id="4299446">stateEOF</span>&nbsp;<span class="op" id="4299455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299459">var</span>&nbsp;<span class="ident" id="4299463">c</span>&nbsp;<span class="builtintype" id="4299465">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299472">c</span><span class="op" id="4299473">,</span>&nbsp;<span class="ident" id="4299475">err</span>&nbsp;<span class="op" id="4299479">=</span>&nbsp;<span class="ident" id="4299481">br</span><span class="op" id="4299483">.</span><span class="ident" id="4299484">ReadByte</span><span class="op" id="4299492">(</span><span class="op" id="4299493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299497">if</span>&nbsp;<span class="ident" id="4299500">err</span>&nbsp;<span class="op" id="4299504">!=</span>&nbsp;<span class="ident" id="4299507">nil</span>&nbsp;<span class="op" id="4299511">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299516">if</span>&nbsp;<span class="ident" id="4299519">err</span>&nbsp;<span class="op" id="4299523">==</span>&nbsp;<span class="ident" id="4299526">io</span><span class="op" id="4299528">.</span><span class="ident" id="4299529">EOF</span>&nbsp;<span class="op" id="4299533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299539">err</span>&nbsp;<span class="op" id="4299543">=</span>&nbsp;<span class="ident" id="4299545">io</span><span class="op" id="4299547">.</span><span class="ident" id="4299548">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299573">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299581">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299585">switch</span>&nbsp;<span class="ident" id="4299592">d</span><span class="op" id="4299593">.</span><span class="ident" id="4299594">state</span>&nbsp;<span class="op" id="4299600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299604">case</span>&nbsp;<span class="ident" id="4299609">stateBeginLine</span><span class="op" id="4299623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299628">if</span>&nbsp;<span class="ident" id="4299631">c</span>&nbsp;<span class="op" id="4299633">==</span>&nbsp;<span class="string" id="4299636">&#39;.&#39;</span>&nbsp;<span class="op" id="4299640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299646">d</span><span class="op" id="4299647">.</span><span class="ident" id="4299648">state</span>&nbsp;<span class="op" id="4299654">=</span>&nbsp;<span class="ident" id="4299656">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299669">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299686">if</span>&nbsp;<span class="ident" id="4299689">c</span>&nbsp;<span class="op" id="4299691">==</span>&nbsp;<span class="string" id="4299694">&#39;\r&#39;</span>&nbsp;<span class="op" id="4299699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299705">d</span><span class="op" id="4299706">.</span><span class="ident" id="4299707">state</span>&nbsp;<span class="op" id="4299713">=</span>&nbsp;<span class="ident" id="4299715">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299727">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299739">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299744">d</span><span class="op" id="4299745">.</span><span class="ident" id="4299746">state</span>&nbsp;<span class="op" id="4299752">=</span>&nbsp;<span class="ident" id="4299754">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299767">case</span>&nbsp;<span class="ident" id="4299772">stateDot</span><span class="op" id="4299780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299785">if</span>&nbsp;<span class="ident" id="4299788">c</span>&nbsp;<span class="op" id="4299790">==</span>&nbsp;<span class="string" id="4299793">&#39;\r&#39;</span>&nbsp;<span class="op" id="4299798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299804">d</span><span class="op" id="4299805">.</span><span class="ident" id="4299806">state</span>&nbsp;<span class="op" id="4299812">=</span>&nbsp;<span class="ident" id="4299814">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299829">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299846">if</span>&nbsp;<span class="ident" id="4299849">c</span>&nbsp;<span class="op" id="4299851">==</span>&nbsp;<span class="string" id="4299854">&#39;\n&#39;</span>&nbsp;<span class="op" id="4299859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299865">d</span><span class="op" id="4299866">.</span><span class="ident" id="4299867">state</span>&nbsp;<span class="op" id="4299873">=</span>&nbsp;<span class="ident" id="4299875">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299888">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299905">d</span><span class="op" id="4299906">.</span><span class="ident" id="4299907">state</span>&nbsp;<span class="op" id="4299913">=</span>&nbsp;<span class="ident" id="4299915">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299928">case</span>&nbsp;<span class="ident" id="4299933">stateDotCR</span><span class="op" id="4299943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299948">if</span>&nbsp;<span class="ident" id="4299951">c</span>&nbsp;<span class="op" id="4299953">==</span>&nbsp;<span class="string" id="4299956">&#39;\n&#39;</span>&nbsp;<span class="op" id="4299961">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299967">d</span><span class="op" id="4299968">.</span><span class="ident" id="4299969">state</span>&nbsp;<span class="op" id="4299975">=</span>&nbsp;<span class="ident" id="4299977">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299990">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300007">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300032">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300077">br</span><span class="op" id="4300079">.</span><span class="ident" id="4300080">UnreadByte</span><span class="op" id="4300090">(</span><span class="op" id="4300091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300096">c</span>&nbsp;<span class="op" id="4300098">=</span>&nbsp;<span class="string" id="4300100">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300108">d</span><span class="op" id="4300109">.</span><span class="ident" id="4300110">state</span>&nbsp;<span class="op" id="4300116">=</span>&nbsp;<span class="ident" id="4300118">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300131">case</span>&nbsp;<span class="ident" id="4300136">stateCR</span><span class="op" id="4300143">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300148">if</span>&nbsp;<span class="ident" id="4300151">c</span>&nbsp;<span class="op" id="4300153">==</span>&nbsp;<span class="string" id="4300156">&#39;\n&#39;</span>&nbsp;<span class="op" id="4300161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300167">d</span><span class="op" id="4300168">.</span><span class="ident" id="4300169">state</span>&nbsp;<span class="op" id="4300175">=</span>&nbsp;<span class="ident" id="4300177">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300196">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300210">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300249">br</span><span class="op" id="4300251">.</span><span class="ident" id="4300252">UnreadByte</span><span class="op" id="4300262">(</span><span class="op" id="4300263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300268">c</span>&nbsp;<span class="op" id="4300270">=</span>&nbsp;<span class="string" id="4300272">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300280">d</span><span class="op" id="4300281">.</span><span class="ident" id="4300282">state</span>&nbsp;<span class="op" id="4300288">=</span>&nbsp;<span class="ident" id="4300290">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300303">case</span>&nbsp;<span class="ident" id="4300308">stateData</span><span class="op" id="4300317">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300322">if</span>&nbsp;<span class="ident" id="4300325">c</span>&nbsp;<span class="op" id="4300327">==</span>&nbsp;<span class="string" id="4300330">&#39;\r&#39;</span>&nbsp;<span class="op" id="4300335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300341">d</span><span class="op" id="4300342">.</span><span class="ident" id="4300343">state</span>&nbsp;<span class="op" id="4300349">=</span>&nbsp;<span class="ident" id="4300351">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300363">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300380">if</span>&nbsp;<span class="ident" id="4300383">c</span>&nbsp;<span class="op" id="4300385">==</span>&nbsp;<span class="string" id="4300388">&#39;\n&#39;</span>&nbsp;<span class="op" id="4300393">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300399">d</span><span class="op" id="4300400">.</span><span class="ident" id="4300401">state</span>&nbsp;<span class="op" id="4300407">=</span>&nbsp;<span class="ident" id="4300409">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300435">b</span><span class="op" id="4300436">[</span><span class="ident" id="4300437">n</span><span class="op" id="4300438">]</span>&nbsp;<span class="op" id="4300440">=</span>&nbsp;<span class="ident" id="4300442">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300446">n</span><span class="op" id="4300447">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300454">if</span>&nbsp;<span class="ident" id="4300457">err</span>&nbsp;<span class="op" id="4300461">==</span>&nbsp;<span class="ident" id="4300464">nil</span>&nbsp;<span class="op" id="4300468">&amp;&amp;</span>&nbsp;<span class="ident" id="4300471">d</span><span class="op" id="4300472">.</span><span class="ident" id="4300473">state</span>&nbsp;<span class="op" id="4300479">==</span>&nbsp;<span class="ident" id="4300482">stateEOF</span>&nbsp;<span class="op" id="4300491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300495">err</span>&nbsp;<span class="op" id="4300499">=</span>&nbsp;<span class="ident" id="4300501">io</span><span class="op" id="4300503">.</span><span class="ident" id="4300504">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300512">if</span>&nbsp;<span class="ident" id="4300515">err</span>&nbsp;<span class="op" id="4300519">!=</span>&nbsp;<span class="ident" id="4300522">nil</span>&nbsp;<span class="op" id="4300526">&amp;&amp;</span>&nbsp;<span class="ident" id="4300529">d</span><span class="op" id="4300530">.</span><span class="ident" id="4300531">r</span><span class="op" id="4300532">.</span><span class="ident" id="4300533">dot</span>&nbsp;<span class="op" id="4300537">==</span>&nbsp;<span class="ident" id="4300540">d</span>&nbsp;<span class="op" id="4300542">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300546">d</span><span class="op" id="4300547">.</span><span class="ident" id="4300548">r</span><span class="op" id="4300549">.</span><span class="ident" id="4300550">dot</span>&nbsp;<span class="op" id="4300554">=</span>&nbsp;<span class="ident" id="4300556">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300564">return</span><br>
<span class="lineno"></span><span class="op" id="4300571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4300574">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="4300623">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="4300679">func</span>&nbsp;<span class="op" id="4300684">(</span><span class="ident" id="4300685">r</span>&nbsp;<span class="op" id="4300687">*</span><span class="ident" id="4300688">Reader</span><span class="op" id="4300694">)</span>&nbsp;<span class="ident" id="4300696">closeDot</span><span class="op" id="4300704">(</span><span class="op" id="4300705">)</span>&nbsp;<span class="op" id="4300707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300710">if</span>&nbsp;<span class="ident" id="4300713">r</span><span class="op" id="4300714">.</span><span class="ident" id="4300715">dot</span>&nbsp;<span class="op" id="4300719">==</span>&nbsp;<span class="ident" id="4300722">nil</span>&nbsp;<span class="op" id="4300726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300730">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300741">buf</span>&nbsp;<span class="op" id="4300745">:=</span>&nbsp;<span class="builtinfunc" id="4300748">make</span><span class="op" id="4300752">(</span><span class="op" id="4300753">[</span><span class="op" id="4300754">]</span><span class="builtintype" id="4300755">byte</span><span class="op" id="4300759">,</span>&nbsp;<span class="num" id="4300761">128</span><span class="op" id="4300764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300767">for</span>&nbsp;<span class="ident" id="4300771">r</span><span class="op" id="4300772">.</span><span class="ident" id="4300773">dot</span>&nbsp;<span class="op" id="4300777">!=</span>&nbsp;<span class="ident" id="4300780">nil</span>&nbsp;<span class="op" id="4300784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300788">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300828">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300859">r</span><span class="op" id="4300860">.</span><span class="ident" id="4300861">dot</span><span class="op" id="4300864">.</span><span class="ident" id="4300865">Read</span><span class="op" id="4300869">(</span><span class="ident" id="4300870">buf</span><span class="op" id="4300873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300876">}</span><br>
<span class="lineno"></span><span class="op" id="4300878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4300881">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="4300948">//</span><br>
<span class="lineno"></span><span class="comment" id="4300951">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4301033">func</span>&nbsp;<span class="op" id="4301038">(</span><span class="ident" id="4301039">r</span>&nbsp;<span class="op" id="4301041">*</span><span class="ident" id="4301042">Reader</span><span class="op" id="4301048">)</span>&nbsp;<span class="ident" id="4301050">ReadDotBytes</span><span class="op" id="4301062">(</span><span class="op" id="4301063">)</span>&nbsp;<span class="op" id="4301065">(</span><span class="op" id="4301066">[</span><span class="op" id="4301067">]</span><span class="builtintype" id="4301068">byte</span><span class="op" id="4301072">,</span>&nbsp;<span class="builtintype" id="4301074">error</span><span class="op" id="4301079">)</span>&nbsp;<span class="op" id="4301081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301084">return</span>&nbsp;<span class="ident" id="4301091">ioutil</span><span class="op" id="4301097">.</span><span class="ident" id="4301098">ReadAll</span><span class="op" id="4301105">(</span><span class="ident" id="4301106">r</span><span class="op" id="4301107">.</span><span class="ident" id="4301108">DotReader</span><span class="op" id="4301117">(</span><span class="op" id="4301118">)</span><span class="op" id="4301119">)</span><br>
<span class="lineno"></span><span class="op" id="4301121">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4301124">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4301181">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="4301258">//</span><br>
<span class="lineno"></span><span class="comment" id="4301261">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="4301343">func</span>&nbsp;<span class="op" id="4301348">(</span><span class="ident" id="4301349">r</span>&nbsp;<span class="op" id="4301351">*</span><span class="ident" id="4301352">Reader</span><span class="op" id="4301358">)</span>&nbsp;<span class="ident" id="4301360">ReadDotLines</span><span class="op" id="4301372">(</span><span class="op" id="4301373">)</span>&nbsp;<span class="op" id="4301375">(</span><span class="op" id="4301376">[</span><span class="op" id="4301377">]</span><span class="builtintype" id="4301378">string</span><span class="op" id="4301384">,</span>&nbsp;<span class="builtintype" id="4301386">error</span><span class="op" id="4301391">)</span>&nbsp;<span class="op" id="4301393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301396">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301445">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301495">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301548">var</span>&nbsp;<span class="ident" id="4301552">v</span>&nbsp;<span class="op" id="4301554">[</span><span class="op" id="4301555">]</span><span class="builtintype" id="4301556">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301564">var</span>&nbsp;<span class="ident" id="4301568">err</span>&nbsp;<span class="builtintype" id="4301572">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301579">for</span>&nbsp;<span class="op" id="4301583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301587">var</span>&nbsp;<span class="ident" id="4301591">line</span>&nbsp;<span class="builtintype" id="4301596">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301605">line</span><span class="op" id="4301609">,</span>&nbsp;<span class="ident" id="4301611">err</span>&nbsp;<span class="op" id="4301615">=</span>&nbsp;<span class="ident" id="4301617">r</span><span class="op" id="4301618">.</span><span class="ident" id="4301619">ReadLine</span><span class="op" id="4301627">(</span><span class="op" id="4301628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301632">if</span>&nbsp;<span class="ident" id="4301635">err</span>&nbsp;<span class="op" id="4301639">!=</span>&nbsp;<span class="ident" id="4301642">nil</span>&nbsp;<span class="op" id="4301646">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301651">if</span>&nbsp;<span class="ident" id="4301654">err</span>&nbsp;<span class="op" id="4301658">==</span>&nbsp;<span class="ident" id="4301661">io</span><span class="op" id="4301663">.</span><span class="ident" id="4301664">EOF</span>&nbsp;<span class="op" id="4301668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301674">err</span>&nbsp;<span class="op" id="4301678">=</span>&nbsp;<span class="ident" id="4301680">io</span><span class="op" id="4301682">.</span><span class="ident" id="4301683">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301708">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301716">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301721">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301774">if</span>&nbsp;<span class="builtinfunc" id="4301777">len</span><span class="op" id="4301780">(</span><span class="ident" id="4301781">line</span><span class="op" id="4301785">)</span>&nbsp;<span class="op" id="4301787">&gt;</span>&nbsp;<span class="num" id="4301789">0</span>&nbsp;<span class="op" id="4301791">&amp;&amp;</span>&nbsp;<span class="ident" id="4301794">line</span><span class="op" id="4301798">[</span><span class="num" id="4301799">0</span><span class="op" id="4301800">]</span>&nbsp;<span class="op" id="4301802">==</span>&nbsp;<span class="string" id="4301805">&#39;.&#39;</span>&nbsp;<span class="op" id="4301809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301814">if</span>&nbsp;<span class="builtinfunc" id="4301817">len</span><span class="op" id="4301820">(</span><span class="ident" id="4301821">line</span><span class="op" id="4301825">)</span>&nbsp;<span class="op" id="4301827">==</span>&nbsp;<span class="num" id="4301830">1</span>&nbsp;<span class="op" id="4301832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301838">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301852">line</span>&nbsp;<span class="op" id="4301857">=</span>&nbsp;<span class="ident" id="4301859">line</span><span class="op" id="4301863">[</span><span class="num" id="4301864">1</span><span class="op" id="4301865">:</span><span class="op" id="4301866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301874">v</span>&nbsp;<span class="op" id="4301876">=</span>&nbsp;<span class="builtinfunc" id="4301878">append</span><span class="op" id="4301884">(</span><span class="ident" id="4301885">v</span><span class="op" id="4301886">,</span>&nbsp;<span class="ident" id="4301888">line</span><span class="op" id="4301892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301895">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301898">return</span>&nbsp;<span class="ident" id="4301905">v</span><span class="op" id="4301906">,</span>&nbsp;<span class="ident" id="4301908">err</span><br>
<span class="lineno"></span><span class="op" id="4301912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4301915">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4301967">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="4302034">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4302061">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4302121">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="4302187">//</span><br>
<span class="lineno"></span><span class="comment" id="4302190">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="4302227">//</span><br>
<span class="lineno"></span><span class="comment" id="4302230">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4302249">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="4302267">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="4302290">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="4302309">//</span><br>
<span class="lineno"></span><span class="comment" id="4302312">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="4302365">//</span><br>
<span class="lineno"></span><span class="comment" id="4302368">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="4302392">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="4302430">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="4302469">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="4302474">//</span><br>
<span class="lineno"></span><span class="keyword" id="4302477">func</span>&nbsp;<span class="op" id="4302482">(</span><span class="ident" id="4302483">r</span>&nbsp;<span class="op" id="4302485">*</span><span class="ident" id="4302486">Reader</span><span class="op" id="4302492">)</span>&nbsp;<span class="ident" id="4302494">ReadMIMEHeader</span><span class="op" id="4302508">(</span><span class="op" id="4302509">)</span>&nbsp;<span class="op" id="4302511">(</span><span class="ident" id="4302512">MIMEHeader</span><span class="op" id="4302522">,</span>&nbsp;<span class="builtintype" id="4302524">error</span><span class="op" id="4302529">)</span>&nbsp;<span class="op" id="4302531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302534">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302600">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302660">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302728">var</span>&nbsp;<span class="ident" id="4302732">strs</span>&nbsp;<span class="op" id="4302737">[</span><span class="op" id="4302738">]</span><span class="builtintype" id="4302739">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302747">hint</span>&nbsp;<span class="op" id="4302752">:=</span>&nbsp;<span class="ident" id="4302755">r</span><span class="op" id="4302756">.</span><span class="ident" id="4302757">upcomingHeaderNewlines</span><span class="op" id="4302779">(</span><span class="op" id="4302780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302783">if</span>&nbsp;<span class="ident" id="4302786">hint</span>&nbsp;<span class="op" id="4302791">&gt;</span>&nbsp;<span class="num" id="4302793">0</span>&nbsp;<span class="op" id="4302795">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302799">strs</span>&nbsp;<span class="op" id="4302804">=</span>&nbsp;<span class="builtinfunc" id="4302806">make</span><span class="op" id="4302810">(</span><span class="op" id="4302811">[</span><span class="op" id="4302812">]</span><span class="builtintype" id="4302813">string</span><span class="op" id="4302819">,</span>&nbsp;<span class="ident" id="4302821">hint</span><span class="op" id="4302825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302832">m</span>&nbsp;<span class="op" id="4302834">:=</span>&nbsp;<span class="builtinfunc" id="4302837">make</span><span class="op" id="4302841">(</span><span class="ident" id="4302842">MIMEHeader</span><span class="op" id="4302852">,</span>&nbsp;<span class="ident" id="4302854">hint</span><span class="op" id="4302858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302861">for</span>&nbsp;<span class="op" id="4302865">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302869">kv</span><span class="op" id="4302871">,</span>&nbsp;<span class="ident" id="4302873">err</span>&nbsp;<span class="op" id="4302877">:=</span>&nbsp;<span class="ident" id="4302880">r</span><span class="op" id="4302881">.</span><span class="ident" id="4302882">readContinuedLineSlice</span><span class="op" id="4302904">(</span><span class="op" id="4302905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302909">if</span>&nbsp;<span class="builtinfunc" id="4302912">len</span><span class="op" id="4302915">(</span><span class="ident" id="4302916">kv</span><span class="op" id="4302918">)</span>&nbsp;<span class="op" id="4302920">==</span>&nbsp;<span class="num" id="4302923">0</span>&nbsp;<span class="op" id="4302925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302930">return</span>&nbsp;<span class="ident" id="4302937">m</span><span class="op" id="4302938">,</span>&nbsp;<span class="ident" id="4302940">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302951">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4303008">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4303061">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303090">i</span>&nbsp;<span class="op" id="4303092">:=</span>&nbsp;<span class="ident" id="4303095">bytes</span><span class="op" id="4303100">.</span><span class="ident" id="4303101">IndexByte</span><span class="op" id="4303110">(</span><span class="ident" id="4303111">kv</span><span class="op" id="4303113">,</span>&nbsp;<span class="string" id="4303115">&#39;:&#39;</span><span class="op" id="4303118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303122">if</span>&nbsp;<span class="ident" id="4303125">i</span>&nbsp;<span class="op" id="4303127">&lt;</span>&nbsp;<span class="num" id="4303129">0</span>&nbsp;<span class="op" id="4303131">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303136">return</span>&nbsp;<span class="ident" id="4303143">m</span><span class="op" id="4303144">,</span>&nbsp;<span class="ident" id="4303146">ProtocolError</span><span class="op" id="4303159">(</span><span class="string" id="4303160">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="4303191">+</span>&nbsp;<span class="builtintype" id="4303193">string</span><span class="op" id="4303199">(</span><span class="ident" id="4303200">kv</span><span class="op" id="4303202">)</span><span class="op" id="4303203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303211">endKey</span>&nbsp;<span class="op" id="4303218">:=</span>&nbsp;<span class="ident" id="4303221">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303225">for</span>&nbsp;<span class="ident" id="4303229">endKey</span>&nbsp;<span class="op" id="4303236">&gt;</span>&nbsp;<span class="num" id="4303238">0</span>&nbsp;<span class="op" id="4303240">&amp;&amp;</span>&nbsp;<span class="ident" id="4303243">kv</span><span class="op" id="4303245">[</span><span class="ident" id="4303246">endKey</span><span class="op" id="4303252">-</span><span class="num" id="4303253">1</span><span class="op" id="4303254">]</span>&nbsp;<span class="op" id="4303256">==</span>&nbsp;<span class="string" id="4303259">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4303263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303268">endKey</span><span class="op" id="4303274">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303283">key</span>&nbsp;<span class="op" id="4303287">:=</span>&nbsp;<span class="ident" id="4303290">canonicalMIMEHeaderKey</span><span class="op" id="4303312">(</span><span class="ident" id="4303313">kv</span><span class="op" id="4303315">[</span><span class="op" id="4303316">:</span><span class="ident" id="4303317">endKey</span><span class="op" id="4303323">]</span><span class="op" id="4303324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4303329">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303364">i</span><span class="op" id="4303365">++</span>&nbsp;<span class="comment" id="4303368">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303384">for</span>&nbsp;<span class="ident" id="4303388">i</span>&nbsp;<span class="op" id="4303390">&lt;</span>&nbsp;<span class="builtinfunc" id="4303392">len</span><span class="op" id="4303395">(</span><span class="ident" id="4303396">kv</span><span class="op" id="4303398">)</span>&nbsp;<span class="op" id="4303400">&amp;&amp;</span>&nbsp;<span class="op" id="4303403">(</span><span class="ident" id="4303404">kv</span><span class="op" id="4303406">[</span><span class="ident" id="4303407">i</span><span class="op" id="4303408">]</span>&nbsp;<span class="op" id="4303410">==</span>&nbsp;<span class="string" id="4303413">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4303417">||</span>&nbsp;<span class="ident" id="4303420">kv</span><span class="op" id="4303422">[</span><span class="ident" id="4303423">i</span><span class="op" id="4303424">]</span>&nbsp;<span class="op" id="4303426">==</span>&nbsp;<span class="string" id="4303429">&#39;\t&#39;</span><span class="op" id="4303433">)</span>&nbsp;<span class="op" id="4303435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303440">i</span><span class="op" id="4303441">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303450">value</span>&nbsp;<span class="op" id="4303456">:=</span>&nbsp;<span class="builtintype" id="4303459">string</span><span class="op" id="4303465">(</span><span class="ident" id="4303466">kv</span><span class="op" id="4303468">[</span><span class="ident" id="4303469">i</span><span class="op" id="4303470">:</span><span class="op" id="4303471">]</span><span class="op" id="4303472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303477">vv</span>&nbsp;<span class="op" id="4303480">:=</span>&nbsp;<span class="ident" id="4303483">m</span><span class="op" id="4303484">[</span><span class="ident" id="4303485">key</span><span class="op" id="4303488">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303492">if</span>&nbsp;<span class="ident" id="4303495">vv</span>&nbsp;<span class="op" id="4303498">==</span>&nbsp;<span class="ident" id="4303501">nil</span>&nbsp;<span class="op" id="4303505">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4303508">len</span><span class="op" id="4303511">(</span><span class="ident" id="4303512">strs</span><span class="op" id="4303516">)</span>&nbsp;<span class="op" id="4303518">&gt;</span>&nbsp;<span class="num" id="4303520">0</span>&nbsp;<span class="op" id="4303522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4303527">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4303585">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4303625">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4303686">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303739">vv</span><span class="op" id="4303741">,</span>&nbsp;<span class="ident" id="4303743">strs</span>&nbsp;<span class="op" id="4303748">=</span>&nbsp;<span class="ident" id="4303750">strs</span><span class="op" id="4303754">[</span><span class="op" id="4303755">:</span><span class="num" id="4303756">1</span><span class="op" id="4303757">:</span><span class="num" id="4303758">1</span><span class="op" id="4303759">]</span><span class="op" id="4303760">,</span>&nbsp;<span class="ident" id="4303762">strs</span><span class="op" id="4303766">[</span><span class="num" id="4303767">1</span><span class="op" id="4303768">:</span><span class="op" id="4303769">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303774">vv</span><span class="op" id="4303776">[</span><span class="num" id="4303777">0</span><span class="op" id="4303778">]</span>&nbsp;<span class="op" id="4303780">=</span>&nbsp;<span class="ident" id="4303782">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303791">m</span><span class="op" id="4303792">[</span><span class="ident" id="4303793">key</span><span class="op" id="4303796">]</span>&nbsp;<span class="op" id="4303798">=</span>&nbsp;<span class="ident" id="4303800">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303805">}</span>&nbsp;<span class="keyword" id="4303807">else</span>&nbsp;<span class="op" id="4303812">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303817">m</span><span class="op" id="4303818">[</span><span class="ident" id="4303819">key</span><span class="op" id="4303822">]</span>&nbsp;<span class="op" id="4303824">=</span>&nbsp;<span class="builtinfunc" id="4303826">append</span><span class="op" id="4303832">(</span><span class="ident" id="4303833">vv</span><span class="op" id="4303835">,</span>&nbsp;<span class="ident" id="4303837">value</span><span class="op" id="4303842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303851">if</span>&nbsp;<span class="ident" id="4303854">err</span>&nbsp;<span class="op" id="4303858">!=</span>&nbsp;<span class="ident" id="4303861">nil</span>&nbsp;<span class="op" id="4303865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303870">return</span>&nbsp;<span class="ident" id="4303877">m</span><span class="op" id="4303878">,</span>&nbsp;<span class="ident" id="4303880">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303889">}</span><br>
<span class="lineno"></span><span class="op" id="4303891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4303894">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="4303971">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4304038">func</span>&nbsp;<span class="op" id="4304043">(</span><span class="ident" id="4304044">r</span>&nbsp;<span class="op" id="4304046">*</span><span class="ident" id="4304047">Reader</span><span class="op" id="4304053">)</span>&nbsp;<span class="ident" id="4304055">upcomingHeaderNewlines</span><span class="op" id="4304077">(</span><span class="op" id="4304078">)</span>&nbsp;<span class="op" id="4304080">(</span><span class="ident" id="4304081">n</span>&nbsp;<span class="builtintype" id="4304083">int</span><span class="op" id="4304086">)</span>&nbsp;<span class="op" id="4304088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4304091">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304129">r</span><span class="op" id="4304130">.</span><span class="ident" id="4304131">R</span><span class="op" id="4304132">.</span><span class="ident" id="4304133">Peek</span><span class="op" id="4304137">(</span><span class="num" id="4304138">1</span><span class="op" id="4304139">)</span>&nbsp;<span class="comment" id="4304141">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304174">s</span>&nbsp;<span class="op" id="4304176">:=</span>&nbsp;<span class="ident" id="4304179">r</span><span class="op" id="4304180">.</span><span class="ident" id="4304181">R</span><span class="op" id="4304182">.</span><span class="ident" id="4304183">Buffered</span><span class="op" id="4304191">(</span><span class="op" id="4304192">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304195">if</span>&nbsp;<span class="ident" id="4304198">s</span>&nbsp;<span class="op" id="4304200">==</span>&nbsp;<span class="num" id="4304203">0</span>&nbsp;<span class="op" id="4304205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304220">peek</span><span class="op" id="4304224">,</span>&nbsp;<span class="ident" id="4304226">_</span>&nbsp;<span class="op" id="4304228">:=</span>&nbsp;<span class="ident" id="4304231">r</span><span class="op" id="4304232">.</span><span class="ident" id="4304233">R</span><span class="op" id="4304234">.</span><span class="ident" id="4304235">Peek</span><span class="op" id="4304239">(</span><span class="ident" id="4304240">s</span><span class="op" id="4304241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304244">for</span>&nbsp;<span class="builtinfunc" id="4304248">len</span><span class="op" id="4304251">(</span><span class="ident" id="4304252">peek</span><span class="op" id="4304256">)</span>&nbsp;<span class="op" id="4304258">&gt;</span>&nbsp;<span class="num" id="4304260">0</span>&nbsp;<span class="op" id="4304262">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304266">i</span>&nbsp;<span class="op" id="4304268">:=</span>&nbsp;<span class="ident" id="4304271">bytes</span><span class="op" id="4304276">.</span><span class="ident" id="4304277">IndexByte</span><span class="op" id="4304286">(</span><span class="ident" id="4304287">peek</span><span class="op" id="4304291">,</span>&nbsp;<span class="string" id="4304293">&#39;\n&#39;</span><span class="op" id="4304297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304301">if</span>&nbsp;<span class="ident" id="4304304">i</span>&nbsp;<span class="op" id="4304306">&lt;</span>&nbsp;<span class="num" id="4304308">3</span>&nbsp;<span class="op" id="4304310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4304315">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4304374">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304429">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304442">n</span><span class="op" id="4304443">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304448">peek</span>&nbsp;<span class="op" id="4304453">=</span>&nbsp;<span class="ident" id="4304455">peek</span><span class="op" id="4304459">[</span><span class="ident" id="4304460">i</span><span class="op" id="4304461">+</span><span class="num" id="4304462">1</span><span class="op" id="4304463">:</span><span class="op" id="4304464">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304470">return</span><br>
<span class="lineno">535</span><span class="op" id="4304477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4304480">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4304542">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4304605">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="4304664">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4304722">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4304783">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="4304833">func</span>&nbsp;<span class="ident" id="4304838">CanonicalMIMEHeaderKey</span><span class="op" id="4304860">(</span><span class="ident" id="4304861">s</span>&nbsp;<span class="builtintype" id="4304863">string</span><span class="op" id="4304869">)</span>&nbsp;<span class="builtintype" id="4304871">string</span>&nbsp;<span class="op" id="4304878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4304881">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304921">upper</span>&nbsp;<span class="op" id="4304927">:=</span>&nbsp;<span class="builtintype" id="4304930">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304936">for</span>&nbsp;<span class="ident" id="4304940">i</span>&nbsp;<span class="op" id="4304942">:=</span>&nbsp;<span class="num" id="4304945">0</span><span class="op" id="4304946">;</span>&nbsp;<span class="ident" id="4304948">i</span>&nbsp;<span class="op" id="4304950">&lt;</span>&nbsp;<span class="builtinfunc" id="4304952">len</span><span class="op" id="4304955">(</span><span class="ident" id="4304956">s</span><span class="op" id="4304957">)</span><span class="op" id="4304958">;</span>&nbsp;<span class="ident" id="4304960">i</span><span class="op" id="4304961">++</span>&nbsp;<span class="op" id="4304964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304968">c</span>&nbsp;<span class="op" id="4304970">:=</span>&nbsp;<span class="ident" id="4304973">s</span><span class="op" id="4304974">[</span><span class="ident" id="4304975">i</span><span class="op" id="4304976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304980">if</span>&nbsp;<span class="ident" id="4304983">upper</span>&nbsp;<span class="op" id="4304989">&amp;&amp;</span>&nbsp;<span class="string" id="4304992">&#39;a&#39;</span>&nbsp;<span class="op" id="4304996">&lt;=</span>&nbsp;<span class="ident" id="4304999">c</span>&nbsp;<span class="op" id="4305001">&amp;&amp;</span>&nbsp;<span class="ident" id="4305004">c</span>&nbsp;<span class="op" id="4305006">&lt;=</span>&nbsp;<span class="string" id="4305009">&#39;z&#39;</span>&nbsp;<span class="op" id="4305013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305018">return</span>&nbsp;<span class="ident" id="4305025">canonicalMIMEHeaderKey</span><span class="op" id="4305047">(</span><span class="op" id="4305048">[</span><span class="op" id="4305049">]</span><span class="builtintype" id="4305050">byte</span><span class="op" id="4305054">(</span><span class="ident" id="4305055">s</span><span class="op" id="4305056">)</span><span class="op" id="4305057">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305065">if</span>&nbsp;<span class="op" id="4305068">!</span><span class="ident" id="4305069">upper</span>&nbsp;<span class="op" id="4305075">&amp;&amp;</span>&nbsp;<span class="string" id="4305078">&#39;A&#39;</span>&nbsp;<span class="op" id="4305082">&lt;=</span>&nbsp;<span class="ident" id="4305085">c</span>&nbsp;<span class="op" id="4305087">&amp;&amp;</span>&nbsp;<span class="ident" id="4305090">c</span>&nbsp;<span class="op" id="4305092">&lt;=</span>&nbsp;<span class="string" id="4305095">&#39;Z&#39;</span>&nbsp;<span class="op" id="4305099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305104">return</span>&nbsp;<span class="ident" id="4305111">canonicalMIMEHeaderKey</span><span class="op" id="4305133">(</span><span class="op" id="4305134">[</span><span class="op" id="4305135">]</span><span class="builtintype" id="4305136">byte</span><span class="op" id="4305140">(</span><span class="ident" id="4305141">s</span><span class="op" id="4305142">)</span><span class="op" id="4305143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305151">upper</span>&nbsp;<span class="op" id="4305157">=</span>&nbsp;<span class="ident" id="4305159">c</span>&nbsp;<span class="op" id="4305161">==</span>&nbsp;<span class="string" id="4305164">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305172">return</span>&nbsp;<span class="ident" id="4305179">s</span><br>
<span class="lineno"></span><span class="op" id="4305181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4305184">const</span>&nbsp;<span class="ident" id="4305190">toLower</span>&nbsp;<span class="op" id="4305198">=</span>&nbsp;<span class="string" id="4305200">&#39;a&#39;</span>&nbsp;<span class="op" id="4305204">-</span>&nbsp;<span class="string" id="4305206">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="4305211">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4305275">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4305341">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4305352">func</span>&nbsp;<span class="ident" id="4305357">canonicalMIMEHeaderKey</span><span class="op" id="4305379">(</span><span class="ident" id="4305380">a</span>&nbsp;<span class="op" id="4305382">[</span><span class="op" id="4305383">]</span><span class="builtintype" id="4305384">byte</span><span class="op" id="4305388">)</span>&nbsp;<span class="builtintype" id="4305390">string</span>&nbsp;<span class="op" id="4305397">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305400">upper</span>&nbsp;<span class="op" id="4305406">:=</span>&nbsp;<span class="builtintype" id="4305409">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305415">for</span>&nbsp;<span class="ident" id="4305419">i</span><span class="op" id="4305420">,</span>&nbsp;<span class="ident" id="4305422">c</span>&nbsp;<span class="op" id="4305424">:=</span>&nbsp;<span class="keyword" id="4305427">range</span>&nbsp;<span class="ident" id="4305433">a</span>&nbsp;<span class="op" id="4305435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305439">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305482">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305519">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305563">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305619">if</span>&nbsp;<span class="ident" id="4305622">c</span>&nbsp;<span class="op" id="4305624">==</span>&nbsp;<span class="string" id="4305627">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4305631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305636">c</span>&nbsp;<span class="op" id="4305638">=</span>&nbsp;<span class="string" id="4305640">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305646">}</span>&nbsp;<span class="keyword" id="4305648">else</span>&nbsp;<span class="keyword" id="4305653">if</span>&nbsp;<span class="ident" id="4305656">upper</span>&nbsp;<span class="op" id="4305662">&amp;&amp;</span>&nbsp;<span class="string" id="4305665">&#39;a&#39;</span>&nbsp;<span class="op" id="4305669">&lt;=</span>&nbsp;<span class="ident" id="4305672">c</span>&nbsp;<span class="op" id="4305674">&amp;&amp;</span>&nbsp;<span class="ident" id="4305677">c</span>&nbsp;<span class="op" id="4305679">&lt;=</span>&nbsp;<span class="string" id="4305682">&#39;z&#39;</span>&nbsp;<span class="op" id="4305686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305691">c</span>&nbsp;<span class="op" id="4305693">-=</span>&nbsp;<span class="ident" id="4305696">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305706">}</span>&nbsp;<span class="keyword" id="4305708">else</span>&nbsp;<span class="keyword" id="4305713">if</span>&nbsp;<span class="op" id="4305716">!</span><span class="ident" id="4305717">upper</span>&nbsp;<span class="op" id="4305723">&amp;&amp;</span>&nbsp;<span class="string" id="4305726">&#39;A&#39;</span>&nbsp;<span class="op" id="4305730">&lt;=</span>&nbsp;<span class="ident" id="4305733">c</span>&nbsp;<span class="op" id="4305735">&amp;&amp;</span>&nbsp;<span class="ident" id="4305738">c</span>&nbsp;<span class="op" id="4305740">&lt;=</span>&nbsp;<span class="string" id="4305743">&#39;Z&#39;</span>&nbsp;<span class="op" id="4305747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305752">c</span>&nbsp;<span class="op" id="4305754">+=</span>&nbsp;<span class="ident" id="4305757">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305771">a</span><span class="op" id="4305772">[</span><span class="ident" id="4305773">i</span><span class="op" id="4305774">]</span>&nbsp;<span class="op" id="4305776">=</span>&nbsp;<span class="ident" id="4305778">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305782">upper</span>&nbsp;<span class="op" id="4305788">=</span>&nbsp;<span class="ident" id="4305790">c</span>&nbsp;<span class="op" id="4305792">==</span>&nbsp;<span class="string" id="4305795">&#39;-&#39;</span>&nbsp;<span class="comment" id="4305799">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305820">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305882">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305942">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305973">if</span>&nbsp;<span class="ident" id="4305976">v</span>&nbsp;<span class="op" id="4305978">:=</span>&nbsp;<span class="ident" id="4305981">commonHeader</span><span class="op" id="4305993">[</span><span class="builtintype" id="4305994">string</span><span class="op" id="4306000">(</span><span class="ident" id="4306001">a</span><span class="op" id="4306002">)</span><span class="op" id="4306003">]</span><span class="op" id="4306004">;</span>&nbsp;<span class="ident" id="4306006">v</span>&nbsp;<span class="op" id="4306008">!=</span>&nbsp;<span class="string" id="4306011">&#34;&#34;</span>&nbsp;<span class="op" id="4306014">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306018">return</span>&nbsp;<span class="ident" id="4306025">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306031">return</span>&nbsp;<span class="builtintype" id="4306038">string</span><span class="op" id="4306044">(</span><span class="ident" id="4306045">a</span><span class="op" id="4306046">)</span><br>
<span class="lineno"></span><span class="op" id="4306048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4306051">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="4306098">var</span>&nbsp;<span class="ident" id="4306102">commonHeader</span>&nbsp;<span class="op" id="4306115">=</span>&nbsp;<span class="builtinfunc" id="4306117">make</span><span class="op" id="4306121">(</span><span class="keyword" id="4306122">map</span><span class="op" id="4306125">[</span><span class="builtintype" id="4306126">string</span><span class="op" id="4306132">]</span><span class="builtintype" id="4306133">string</span><span class="op" id="4306139">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4306142">func</span>&nbsp;<span class="ident" id="4306147">init</span><span class="op" id="4306151">(</span><span class="op" id="4306152">)</span>&nbsp;<span class="op" id="4306154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306157">for</span>&nbsp;<span class="ident" id="4306161">_</span><span class="op" id="4306162">,</span>&nbsp;<span class="ident" id="4306164">v</span>&nbsp;<span class="op" id="4306166">:=</span>&nbsp;<span class="keyword" id="4306169">range</span>&nbsp;<span class="op" id="4306175">[</span><span class="op" id="4306176">]</span><span class="builtintype" id="4306177">string</span><span class="op" id="4306183">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306187">&#34;Accept&#34;</span><span class="op" id="4306195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306199">&#34;Accept-Charset&#34;</span><span class="op" id="4306215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306219">&#34;Accept-Encoding&#34;</span><span class="op" id="4306236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306240">&#34;Accept-Language&#34;</span><span class="op" id="4306257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306261">&#34;Accept-Ranges&#34;</span><span class="op" id="4306276">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306280">&#34;Cache-Control&#34;</span><span class="op" id="4306295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306299">&#34;Cc&#34;</span><span class="op" id="4306303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306307">&#34;Connection&#34;</span><span class="op" id="4306319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306323">&#34;Content-Id&#34;</span><span class="op" id="4306335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306339">&#34;Content-Language&#34;</span><span class="op" id="4306357">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306361">&#34;Content-Length&#34;</span><span class="op" id="4306377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306381">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="4306408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306412">&#34;Content-Type&#34;</span><span class="op" id="4306426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306430">&#34;Cookie&#34;</span><span class="op" id="4306438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306442">&#34;Date&#34;</span><span class="op" id="4306448">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306452">&#34;Dkim-Signature&#34;</span><span class="op" id="4306468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306472">&#34;Etag&#34;</span><span class="op" id="4306478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306482">&#34;Expires&#34;</span><span class="op" id="4306491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306495">&#34;From&#34;</span><span class="op" id="4306501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306505">&#34;Host&#34;</span><span class="op" id="4306511">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306515">&#34;If-Modified-Since&#34;</span><span class="op" id="4306534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306538">&#34;If-None-Match&#34;</span><span class="op" id="4306553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306557">&#34;In-Reply-To&#34;</span><span class="op" id="4306570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306574">&#34;Last-Modified&#34;</span><span class="op" id="4306589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306593">&#34;Location&#34;</span><span class="op" id="4306603">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306607">&#34;Message-Id&#34;</span><span class="op" id="4306619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306623">&#34;Mime-Version&#34;</span><span class="op" id="4306637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306641">&#34;Pragma&#34;</span><span class="op" id="4306649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306653">&#34;Received&#34;</span><span class="op" id="4306663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306667">&#34;Return-Path&#34;</span><span class="op" id="4306680">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306684">&#34;Server&#34;</span><span class="op" id="4306692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306696">&#34;Set-Cookie&#34;</span><span class="op" id="4306708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306712">&#34;Subject&#34;</span><span class="op" id="4306721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306725">&#34;To&#34;</span><span class="op" id="4306729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306733">&#34;User-Agent&#34;</span><span class="op" id="4306745">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306749">&#34;Via&#34;</span><span class="op" id="4306754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306758">&#34;X-Forwarded-For&#34;</span><span class="op" id="4306775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306779">&#34;X-Imforwards&#34;</span><span class="op" id="4306793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306797">&#34;X-Powered-By&#34;</span><span class="op" id="4306811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306814">}</span>&nbsp;<span class="op" id="4306816">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306820">commonHeader</span><span class="op" id="4306832">[</span><span class="ident" id="4306833">v</span><span class="op" id="4306834">]</span>&nbsp;<span class="op" id="4306836">=</span>&nbsp;<span class="ident" id="4306838">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306841">}</span><br>
<span class="lineno"></span><span class="op" id="4306843">}</span>
</div>
</body>
</html>
