<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6241073">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6241128">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6241182">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6241233">package</span>&nbsp;<span class="ident" id="6241241">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6241248">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6241321">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6241398">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="6241477">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6241556">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="6241634">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="6241713">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="6241787">type</span>&nbsp;<span class="ident" id="6241792">moveToFrontDecoder</span>&nbsp;<span class="op" id="6241811">[</span><span class="op" id="6241812">]</span><span class="builtintype" id="6241813">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6241819">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="6241898">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6241913">func</span>&nbsp;<span class="ident" id="6241918">newMTFDecoder</span><span class="op" id="6241931">(</span><span class="ident" id="6241932">symbols</span>&nbsp;<span class="op" id="6241940">[</span><span class="op" id="6241941">]</span><span class="builtintype" id="6241942">byte</span><span class="op" id="6241946">)</span>&nbsp;<span class="ident" id="6241948">moveToFrontDecoder</span>&nbsp;<span class="op" id="6241967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241970">if</span>&nbsp;<span class="builtinfunc" id="6241973">len</span><span class="op" id="6241976">(</span><span class="ident" id="6241977">symbols</span><span class="op" id="6241984">)</span>&nbsp;<span class="op" id="6241986">&gt;</span>&nbsp;<span class="num" id="6241988">256</span>&nbsp;<span class="op" id="6241992">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6241996">panic</span><span class="op" id="6242001">(</span><span class="string" id="6242002">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="6242020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242026">return</span>&nbsp;<span class="ident" id="6242033">moveToFrontDecoder</span><span class="op" id="6242051">(</span><span class="ident" id="6242052">symbols</span><span class="op" id="6242059">)</span><br>
<span class="lineno"></span><span class="op" id="6242061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6242064">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="6242138">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="6242165">func</span>&nbsp;<span class="ident" id="6242170">newMTFDecoderWithRange</span><span class="op" id="6242192">(</span><span class="ident" id="6242193">n</span>&nbsp;<span class="builtintype" id="6242195">int</span><span class="op" id="6242198">)</span>&nbsp;<span class="ident" id="6242200">moveToFrontDecoder</span>&nbsp;<span class="op" id="6242219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242222">if</span>&nbsp;<span class="ident" id="6242225">n</span>&nbsp;<span class="op" id="6242227">&gt;</span>&nbsp;<span class="num" id="6242229">256</span>&nbsp;<span class="op" id="6242233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6242237">panic</span><span class="op" id="6242242">(</span><span class="string" id="6242243">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="6242294">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242301">m</span>&nbsp;<span class="op" id="6242303">:=</span>&nbsp;<span class="builtinfunc" id="6242306">make</span><span class="op" id="6242310">(</span><span class="op" id="6242311">[</span><span class="op" id="6242312">]</span><span class="builtintype" id="6242313">byte</span><span class="op" id="6242317">,</span>&nbsp;<span class="ident" id="6242319">n</span><span class="op" id="6242320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242323">for</span>&nbsp;<span class="ident" id="6242327">i</span>&nbsp;<span class="op" id="6242329">:=</span>&nbsp;<span class="num" id="6242332">0</span><span class="op" id="6242333">;</span>&nbsp;<span class="ident" id="6242335">i</span>&nbsp;<span class="op" id="6242337">&lt;</span>&nbsp;<span class="ident" id="6242339">n</span><span class="op" id="6242340">;</span>&nbsp;<span class="ident" id="6242342">i</span><span class="op" id="6242343">++</span>&nbsp;<span class="op" id="6242346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242350">m</span><span class="op" id="6242351">[</span><span class="ident" id="6242352">i</span><span class="op" id="6242353">]</span>&nbsp;<span class="op" id="6242355">=</span>&nbsp;<span class="builtintype" id="6242357">byte</span><span class="op" id="6242361">(</span><span class="ident" id="6242362">i</span><span class="op" id="6242363">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242369">return</span>&nbsp;<span class="ident" id="6242376">moveToFrontDecoder</span><span class="op" id="6242394">(</span><span class="ident" id="6242395">m</span><span class="op" id="6242396">)</span><br>
<span class="lineno"></span><span class="op" id="6242398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6242401">func</span>&nbsp;<span class="op" id="6242406">(</span><span class="ident" id="6242407">m</span>&nbsp;<span class="ident" id="6242409">moveToFrontDecoder</span><span class="op" id="6242427">)</span>&nbsp;<span class="ident" id="6242429">Decode</span><span class="op" id="6242435">(</span><span class="ident" id="6242436">n</span>&nbsp;<span class="builtintype" id="6242438">int</span><span class="op" id="6242441">)</span>&nbsp;<span class="op" id="6242443">(</span><span class="ident" id="6242444">b</span>&nbsp;<span class="builtintype" id="6242446">byte</span><span class="op" id="6242450">)</span>&nbsp;<span class="op" id="6242452">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242455">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242517">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242583">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242641">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242708">b</span>&nbsp;<span class="op" id="6242710">=</span>&nbsp;<span class="ident" id="6242712">m</span><span class="op" id="6242713">[</span><span class="ident" id="6242714">n</span><span class="op" id="6242715">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6242718">copy</span><span class="op" id="6242722">(</span><span class="ident" id="6242723">m</span><span class="op" id="6242724">[</span><span class="num" id="6242725">1</span><span class="op" id="6242726">:</span><span class="op" id="6242727">]</span><span class="op" id="6242728">,</span>&nbsp;<span class="ident" id="6242730">m</span><span class="op" id="6242731">[</span><span class="op" id="6242732">:</span><span class="ident" id="6242733">n</span><span class="op" id="6242734">]</span><span class="op" id="6242735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242738">m</span><span class="op" id="6242739">[</span><span class="num" id="6242740">0</span><span class="op" id="6242741">]</span>&nbsp;<span class="op" id="6242743">=</span>&nbsp;<span class="ident" id="6242745">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242748">return</span><br>
<span class="lineno"></span><span class="op" id="6242755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6242758">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6242812">func</span>&nbsp;<span class="op" id="6242817">(</span><span class="ident" id="6242818">m</span>&nbsp;<span class="ident" id="6242820">moveToFrontDecoder</span><span class="op" id="6242838">)</span>&nbsp;<span class="ident" id="6242840">First</span><span class="op" id="6242845">(</span><span class="op" id="6242846">)</span>&nbsp;<span class="builtintype" id="6242848">byte</span>&nbsp;<span class="op" id="6242853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242856">return</span>&nbsp;<span class="ident" id="6242863">m</span><span class="op" id="6242864">[</span><span class="num" id="6242865">0</span><span class="op" id="6242866">]</span><br>
<span class="lineno"></span><span class="op" id="6242868">}</span>
</div>
</body>
</html>
