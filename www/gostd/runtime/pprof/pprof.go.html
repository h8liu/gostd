<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/pprof</h2>
<ul>
<li><a href="/gostd/runtime/pprof/mprof_test.go.html">mprof_test.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof.go.html" class="current">pprof.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof_test.go.html">pprof_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4624156">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4624212">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4624266">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4624317">//&nbsp;Package&nbsp;pprof&nbsp;writes&nbsp;runtime&nbsp;profiling&nbsp;data&nbsp;in&nbsp;the&nbsp;format&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="4624387">//&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="4624423">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="4624464">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="keyword" id="4624511">package</span>&nbsp;<span class="ident" id="4624519">pprof</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4624526">import</span>&nbsp;<span class="op" id="4624533">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624536">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624545">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624554">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624561">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624567">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624578">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624586">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624597">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624605">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span><span class="op" id="4624622">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4624625">//&nbsp;BUG(rsc):&nbsp;Profiles&nbsp;are&nbsp;incomplete&nbsp;and&nbsp;inaccurate&nbsp;on&nbsp;NetBSD&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span><span class="comment" id="4624697">//&nbsp;See&nbsp;http://golang.org/issue/6047&nbsp;for&nbsp;details.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4624747">//&nbsp;A&nbsp;Profile&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;stack&nbsp;traces&nbsp;showing&nbsp;the&nbsp;call&nbsp;sequences</span><br>
<span class="lineno"></span><span class="comment" id="4624819">//&nbsp;that&nbsp;led&nbsp;to&nbsp;instances&nbsp;of&nbsp;a&nbsp;particular&nbsp;event,&nbsp;such&nbsp;as&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="4624887">//&nbsp;Packages&nbsp;can&nbsp;create&nbsp;and&nbsp;maintain&nbsp;their&nbsp;own&nbsp;profiles;&nbsp;the&nbsp;most&nbsp;common</span><br>
<span class="lineno"></span><span class="comment" id="4624959">//&nbsp;use&nbsp;is&nbsp;for&nbsp;tracking&nbsp;resources&nbsp;that&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;closed,&nbsp;such&nbsp;as&nbsp;files</span><br>
<span class="lineno">30</span><span class="comment" id="4625038">//&nbsp;or&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="comment" id="4625065">//</span><br>
<span class="lineno"></span><span class="comment" id="4625068">//&nbsp;A&nbsp;Profile&#39;s&nbsp;methods&nbsp;can&nbsp;be&nbsp;called&nbsp;from&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment" id="4625146">//</span><br>
<span class="lineno"></span><span class="comment" id="4625149">//&nbsp;Each&nbsp;Profile&nbsp;has&nbsp;a&nbsp;unique&nbsp;name.&nbsp;&nbsp;A&nbsp;few&nbsp;profiles&nbsp;are&nbsp;predefined:</span><br>
<span class="lineno">35</span><span class="comment" id="4625216">//</span><br>
<span class="lineno"></span><span class="comment" id="4625219">//&nbsp;&nbsp;&nbsp;&nbsp;goroutine&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;current&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="4625276">//&nbsp;&nbsp;&nbsp;&nbsp;heap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;sampling&nbsp;of&nbsp;all&nbsp;heap&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="4625329">//&nbsp;&nbsp;&nbsp;&nbsp;threadcreate&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;the&nbsp;creation&nbsp;of&nbsp;new&nbsp;OS&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="4625403">//&nbsp;&nbsp;&nbsp;&nbsp;block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;blocking&nbsp;on&nbsp;synchronization&nbsp;primitives</span><br>
<span class="lineno">40</span><span class="comment" id="4625485">//</span><br>
<span class="lineno"></span><span class="comment" id="4625488">//&nbsp;These&nbsp;predefined&nbsp;profiles&nbsp;maintain&nbsp;themselves&nbsp;and&nbsp;panic&nbsp;on&nbsp;an&nbsp;explicit</span><br>
<span class="lineno"></span><span class="comment" id="4625562">//&nbsp;Add&nbsp;or&nbsp;Remove&nbsp;method&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="4625592">//</span><br>
<span class="lineno"></span><span class="comment" id="4625595">//&nbsp;The&nbsp;CPU&nbsp;profile&nbsp;is&nbsp;not&nbsp;available&nbsp;as&nbsp;a&nbsp;Profile.&nbsp;&nbsp;It&nbsp;has&nbsp;a&nbsp;special&nbsp;API,</span><br>
<span class="lineno">45</span><span class="comment" id="4625668">//&nbsp;the&nbsp;StartCPUProfile&nbsp;and&nbsp;StopCPUProfile&nbsp;functions,&nbsp;because&nbsp;it&nbsp;streams</span><br>
<span class="lineno"></span><span class="comment" id="4625740">//&nbsp;output&nbsp;to&nbsp;a&nbsp;writer&nbsp;during&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="4625780">//</span><br>
<span class="lineno"></span><span class="keyword" id="4625783">type</span>&nbsp;<span class="ident" id="4625788">Profile</span>&nbsp;<span class="keyword" id="4625796">struct</span>&nbsp;<span class="op" id="4625803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625806">name</span>&nbsp;&nbsp;<span class="builtintype" id="4625812">string</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625820">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625826">sync</span><span class="op" id="4625830">.</span><span class="ident" id="4625831">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625838">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625844">map</span><span class="op" id="4625847">[</span><span class="keyword" id="4625848">interface</span><span class="op" id="4625857">{</span><span class="op" id="4625858">}</span><span class="op" id="4625859">]</span><span class="op" id="4625860">[</span><span class="op" id="4625861">]</span><span class="builtintype" id="4625862">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625871">count</span>&nbsp;<span class="keyword" id="4625877">func</span><span class="op" id="4625881">(</span><span class="op" id="4625882">)</span>&nbsp;<span class="builtintype" id="4625884">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625889">write</span>&nbsp;<span class="keyword" id="4625895">func</span><span class="op" id="4625899">(</span><span class="ident" id="4625900">io</span><span class="op" id="4625902">.</span><span class="ident" id="4625903">Writer</span><span class="op" id="4625909">,</span>&nbsp;<span class="builtintype" id="4625911">int</span><span class="op" id="4625914">)</span>&nbsp;<span class="builtintype" id="4625916">error</span><br>
<span class="lineno"></span><span class="op" id="4625922">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4625925">//&nbsp;profiles&nbsp;records&nbsp;all&nbsp;registered&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="4625970">var</span>&nbsp;<span class="ident" id="4625974">profiles</span>&nbsp;<span class="keyword" id="4625983">struct</span>&nbsp;<span class="op" id="4625990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625993">mu</span>&nbsp;<span class="ident" id="4625996">sync</span><span class="op" id="4626000">.</span><span class="ident" id="4626001">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626008">m</span>&nbsp;&nbsp;<span class="keyword" id="4626011">map</span><span class="op" id="4626014">[</span><span class="builtintype" id="4626015">string</span><span class="op" id="4626021">]</span><span class="op" id="4626022">*</span><span class="ident" id="4626023">Profile</span><br>
<span class="lineno">60</span><span class="op" id="4626031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626034">var</span>&nbsp;<span class="ident" id="4626038">goroutineProfile</span>&nbsp;<span class="op" id="4626055">=</span>&nbsp;<span class="op" id="4626057">&amp;</span><span class="ident" id="4626058">Profile</span><span class="op" id="4626065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626068">name</span><span class="op" id="4626072">:</span>&nbsp;&nbsp;<span class="string" id="4626075">&#34;goroutine&#34;</span><span class="op" id="4626086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626089">count</span><span class="op" id="4626094">:</span>&nbsp;<span class="ident" id="4626096">countGoroutine</span><span class="op" id="4626110">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626113">write</span><span class="op" id="4626118">:</span>&nbsp;<span class="ident" id="4626120">writeGoroutine</span><span class="op" id="4626134">,</span><br>
<span class="lineno"></span><span class="op" id="4626136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626139">var</span>&nbsp;<span class="ident" id="4626143">threadcreateProfile</span>&nbsp;<span class="op" id="4626163">=</span>&nbsp;<span class="op" id="4626165">&amp;</span><span class="ident" id="4626166">Profile</span><span class="op" id="4626173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626176">name</span><span class="op" id="4626180">:</span>&nbsp;&nbsp;<span class="string" id="4626183">&#34;threadcreate&#34;</span><span class="op" id="4626197">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626200">count</span><span class="op" id="4626205">:</span>&nbsp;<span class="ident" id="4626207">countThreadCreate</span><span class="op" id="4626224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626227">write</span><span class="op" id="4626232">:</span>&nbsp;<span class="ident" id="4626234">writeThreadCreate</span><span class="op" id="4626251">,</span><br>
<span class="lineno"></span><span class="op" id="4626253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626256">var</span>&nbsp;<span class="ident" id="4626260">heapProfile</span>&nbsp;<span class="op" id="4626272">=</span>&nbsp;<span class="op" id="4626274">&amp;</span><span class="ident" id="4626275">Profile</span><span class="op" id="4626282">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626285">name</span><span class="op" id="4626289">:</span>&nbsp;&nbsp;<span class="string" id="4626292">&#34;heap&#34;</span><span class="op" id="4626298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626301">count</span><span class="op" id="4626306">:</span>&nbsp;<span class="ident" id="4626308">countHeap</span><span class="op" id="4626317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626320">write</span><span class="op" id="4626325">:</span>&nbsp;<span class="ident" id="4626327">writeHeap</span><span class="op" id="4626336">,</span><br>
<span class="lineno"></span><span class="op" id="4626338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4626341">var</span>&nbsp;<span class="ident" id="4626345">blockProfile</span>&nbsp;<span class="op" id="4626358">=</span>&nbsp;<span class="op" id="4626360">&amp;</span><span class="ident" id="4626361">Profile</span><span class="op" id="4626368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626371">name</span><span class="op" id="4626375">:</span>&nbsp;&nbsp;<span class="string" id="4626378">&#34;block&#34;</span><span class="op" id="4626385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626388">count</span><span class="op" id="4626393">:</span>&nbsp;<span class="ident" id="4626395">countBlock</span><span class="op" id="4626405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626408">write</span><span class="op" id="4626413">:</span>&nbsp;<span class="ident" id="4626415">writeBlock</span><span class="op" id="4626425">,</span><br>
<span class="lineno"></span><span class="op" id="4626427">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4626430">func</span>&nbsp;<span class="ident" id="4626435">lockProfiles</span><span class="op" id="4626447">(</span><span class="op" id="4626448">)</span>&nbsp;<span class="op" id="4626450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626453">profiles</span><span class="op" id="4626461">.</span><span class="ident" id="4626462">mu</span><span class="op" id="4626464">.</span><span class="ident" id="4626465">Lock</span><span class="op" id="4626469">(</span><span class="op" id="4626470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4626473">if</span>&nbsp;<span class="ident" id="4626476">profiles</span><span class="op" id="4626484">.</span><span class="ident" id="4626485">m</span>&nbsp;<span class="op" id="4626487">==</span>&nbsp;<span class="builtintype" id="4626490">nil</span>&nbsp;<span class="op" id="4626494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4626498">//&nbsp;Initial&nbsp;built-in&nbsp;profiles.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626530">profiles</span><span class="op" id="4626538">.</span><span class="ident" id="4626539">m</span>&nbsp;<span class="op" id="4626541">=</span>&nbsp;<span class="keyword" id="4626543">map</span><span class="op" id="4626546">[</span><span class="builtintype" id="4626547">string</span><span class="op" id="4626553">]</span><span class="op" id="4626554">*</span><span class="ident" id="4626555">Profile</span><span class="op" id="4626562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4626567">&#34;goroutine&#34;</span><span class="op" id="4626578">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626583">goroutineProfile</span><span class="op" id="4626599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4626604">&#34;threadcreate&#34;</span><span class="op" id="4626618">:</span>&nbsp;<span class="ident" id="4626620">threadcreateProfile</span><span class="op" id="4626639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4626644">&#34;heap&#34;</span><span class="op" id="4626650">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626660">heapProfile</span><span class="op" id="4626671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4626676">&#34;block&#34;</span><span class="op" id="4626683">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626692">blockProfile</span><span class="op" id="4626704">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4626708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4626711">}</span><br>
<span class="lineno"></span><span class="op" id="4626713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626716">func</span>&nbsp;<span class="ident" id="4626721">unlockProfiles</span><span class="op" id="4626735">(</span><span class="op" id="4626736">)</span>&nbsp;<span class="op" id="4626738">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626741">profiles</span><span class="op" id="4626749">.</span><span class="ident" id="4626750">mu</span><span class="op" id="4626752">.</span><span class="ident" id="4626753">Unlock</span><span class="op" id="4626759">(</span><span class="op" id="4626760">)</span><br>
<span class="lineno"></span><span class="op" id="4626762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4626765">//&nbsp;NewProfile&nbsp;creates&nbsp;a&nbsp;new&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4626822">//&nbsp;If&nbsp;a&nbsp;profile&nbsp;with&nbsp;that&nbsp;name&nbsp;already&nbsp;exists,&nbsp;NewProfile&nbsp;panics.</span><br>
<span class="lineno">105</span><span class="comment" id="4626888">//&nbsp;The&nbsp;convention&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;&#39;import/path.&#39;&nbsp;prefix&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="4626950">//&nbsp;separate&nbsp;name&nbsp;spaces&nbsp;for&nbsp;each&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4626992">func</span>&nbsp;<span class="ident" id="4626997">NewProfile</span><span class="op" id="4627007">(</span><span class="ident" id="4627008">name</span>&nbsp;<span class="builtintype" id="4627013">string</span><span class="op" id="4627019">)</span>&nbsp;<span class="op" id="4627021">*</span><span class="ident" id="4627022">Profile</span>&nbsp;<span class="op" id="4627030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627033">lockProfiles</span><span class="op" id="4627045">(</span><span class="op" id="4627046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627049">defer</span>&nbsp;<span class="ident" id="4627055">unlockProfiles</span><span class="op" id="4627069">(</span><span class="op" id="4627070">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627073">if</span>&nbsp;<span class="ident" id="4627076">name</span>&nbsp;<span class="op" id="4627081">==</span>&nbsp;<span class="string" id="4627084">&#34;&#34;</span>&nbsp;<span class="op" id="4627087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4627091">panic</span><span class="op" id="4627096">(</span><span class="string" id="4627097">&#34;pprof:&nbsp;NewProfile&nbsp;with&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4627132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4627135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627138">if</span>&nbsp;<span class="ident" id="4627141">profiles</span><span class="op" id="4627149">.</span><span class="ident" id="4627150">m</span><span class="op" id="4627151">[</span><span class="ident" id="4627152">name</span><span class="op" id="4627156">]</span>&nbsp;<span class="op" id="4627158">!=</span>&nbsp;<span class="builtintype" id="4627161">nil</span>&nbsp;<span class="op" id="4627165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4627169">panic</span><span class="op" id="4627174">(</span><span class="string" id="4627175">&#34;pprof:&nbsp;NewProfile&nbsp;name&nbsp;already&nbsp;in&nbsp;use:&nbsp;&#34;</span>&nbsp;<span class="op" id="4627217">+</span>&nbsp;<span class="ident" id="4627219">name</span><span class="op" id="4627223">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4627226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627229">p</span>&nbsp;<span class="op" id="4627231">:=</span>&nbsp;<span class="op" id="4627234">&amp;</span><span class="ident" id="4627235">Profile</span><span class="op" id="4627242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627246">name</span><span class="op" id="4627250">:</span>&nbsp;<span class="ident" id="4627252">name</span><span class="op" id="4627256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627260">m</span><span class="op" id="4627261">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627266">map</span><span class="op" id="4627269">[</span><span class="keyword" id="4627270">interface</span><span class="op" id="4627279">{</span><span class="op" id="4627280">}</span><span class="op" id="4627281">]</span><span class="op" id="4627282">[</span><span class="op" id="4627283">]</span><span class="builtintype" id="4627284">uintptr</span><span class="op" id="4627291">{</span><span class="op" id="4627292">}</span><span class="op" id="4627293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4627296">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627299">profiles</span><span class="op" id="4627307">.</span><span class="ident" id="4627308">m</span><span class="op" id="4627309">[</span><span class="ident" id="4627310">name</span><span class="op" id="4627314">]</span>&nbsp;<span class="op" id="4627316">=</span>&nbsp;<span class="ident" id="4627318">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627321">return</span>&nbsp;<span class="ident" id="4627328">p</span><br>
<span class="lineno"></span><span class="op" id="4627330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4627333">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name,&nbsp;or&nbsp;nil&nbsp;if&nbsp;no&nbsp;such&nbsp;profile&nbsp;exists.</span><br>
<span class="lineno">125</span><span class="keyword" id="4627418">func</span>&nbsp;<span class="ident" id="4627423">Lookup</span><span class="op" id="4627429">(</span><span class="ident" id="4627430">name</span>&nbsp;<span class="builtintype" id="4627435">string</span><span class="op" id="4627441">)</span>&nbsp;<span class="op" id="4627443">*</span><span class="ident" id="4627444">Profile</span>&nbsp;<span class="op" id="4627452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627455">lockProfiles</span><span class="op" id="4627467">(</span><span class="op" id="4627468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627471">defer</span>&nbsp;<span class="ident" id="4627477">unlockProfiles</span><span class="op" id="4627491">(</span><span class="op" id="4627492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627495">return</span>&nbsp;<span class="ident" id="4627502">profiles</span><span class="op" id="4627510">.</span><span class="ident" id="4627511">m</span><span class="op" id="4627512">[</span><span class="ident" id="4627513">name</span><span class="op" id="4627517">]</span><br>
<span class="lineno"></span><span class="op" id="4627519">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4627522">//&nbsp;Profiles&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;the&nbsp;known&nbsp;profiles,&nbsp;sorted&nbsp;by&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4627593">func</span>&nbsp;<span class="ident" id="4627598">Profiles</span><span class="op" id="4627606">(</span><span class="op" id="4627607">)</span>&nbsp;<span class="op" id="4627609">[</span><span class="op" id="4627610">]</span><span class="op" id="4627611">*</span><span class="ident" id="4627612">Profile</span>&nbsp;<span class="op" id="4627620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627623">lockProfiles</span><span class="op" id="4627635">(</span><span class="op" id="4627636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627639">defer</span>&nbsp;<span class="ident" id="4627645">unlockProfiles</span><span class="op" id="4627659">(</span><span class="op" id="4627660">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627664">var</span>&nbsp;<span class="ident" id="4627668">all</span>&nbsp;<span class="op" id="4627672">[</span><span class="op" id="4627673">]</span><span class="op" id="4627674">*</span><span class="ident" id="4627675">Profile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627684">for</span>&nbsp;<span class="ident" id="4627688">_</span><span class="op" id="4627689">,</span>&nbsp;<span class="ident" id="4627691">p</span>&nbsp;<span class="op" id="4627693">:=</span>&nbsp;<span class="keyword" id="4627696">range</span>&nbsp;<span class="ident" id="4627702">profiles</span><span class="op" id="4627710">.</span><span class="ident" id="4627711">m</span>&nbsp;<span class="op" id="4627713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627717">all</span>&nbsp;<span class="op" id="4627721">=</span>&nbsp;<span class="builtinfunc" id="4627723">append</span><span class="op" id="4627729">(</span><span class="ident" id="4627730">all</span><span class="op" id="4627733">,</span>&nbsp;<span class="ident" id="4627735">p</span><span class="op" id="4627736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4627739">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627743">sort</span><span class="op" id="4627747">.</span><span class="ident" id="4627748">Sort</span><span class="op" id="4627752">(</span><span class="ident" id="4627753">byName</span><span class="op" id="4627759">(</span><span class="ident" id="4627760">all</span><span class="op" id="4627763">)</span><span class="op" id="4627764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4627767">return</span>&nbsp;<span class="ident" id="4627774">all</span><br>
<span class="lineno"></span><span class="op" id="4627778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="4627781">type</span>&nbsp;<span class="ident" id="4627786">byName</span>&nbsp;<span class="op" id="4627793">[</span><span class="op" id="4627794">]</span><span class="op" id="4627795">*</span><span class="ident" id="4627796">Profile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4627805">func</span>&nbsp;<span class="op" id="4627810">(</span><span class="ident" id="4627811">x</span>&nbsp;<span class="ident" id="4627813">byName</span><span class="op" id="4627819">)</span>&nbsp;<span class="ident" id="4627821">Len</span><span class="op" id="4627824">(</span><span class="op" id="4627825">)</span>&nbsp;<span class="builtintype" id="4627827">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4627841">{</span>&nbsp;<span class="keyword" id="4627843">return</span>&nbsp;<span class="builtinfunc" id="4627850">len</span><span class="op" id="4627853">(</span><span class="ident" id="4627854">x</span><span class="op" id="4627855">)</span>&nbsp;<span class="op" id="4627857">}</span><br>
<span class="lineno"></span><span class="keyword" id="4627859">func</span>&nbsp;<span class="op" id="4627864">(</span><span class="ident" id="4627865">x</span>&nbsp;<span class="ident" id="4627867">byName</span><span class="op" id="4627873">)</span>&nbsp;<span class="ident" id="4627875">Swap</span><span class="op" id="4627879">(</span><span class="ident" id="4627880">i</span><span class="op" id="4627881">,</span>&nbsp;<span class="ident" id="4627883">j</span>&nbsp;<span class="builtintype" id="4627885">int</span><span class="op" id="4627888">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4627895">{</span>&nbsp;<span class="ident" id="4627897">x</span><span class="op" id="4627898">[</span><span class="ident" id="4627899">i</span><span class="op" id="4627900">]</span><span class="op" id="4627901">,</span>&nbsp;<span class="ident" id="4627903">x</span><span class="op" id="4627904">[</span><span class="ident" id="4627905">j</span><span class="op" id="4627906">]</span>&nbsp;<span class="op" id="4627908">=</span>&nbsp;<span class="ident" id="4627910">x</span><span class="op" id="4627911">[</span><span class="ident" id="4627912">j</span><span class="op" id="4627913">]</span><span class="op" id="4627914">,</span>&nbsp;<span class="ident" id="4627916">x</span><span class="op" id="4627917">[</span><span class="ident" id="4627918">i</span><span class="op" id="4627919">]</span>&nbsp;<span class="op" id="4627921">}</span><br>
<span class="lineno"></span><span class="keyword" id="4627923">func</span>&nbsp;<span class="op" id="4627928">(</span><span class="ident" id="4627929">x</span>&nbsp;<span class="ident" id="4627931">byName</span><span class="op" id="4627937">)</span>&nbsp;<span class="ident" id="4627939">Less</span><span class="op" id="4627943">(</span><span class="ident" id="4627944">i</span><span class="op" id="4627945">,</span>&nbsp;<span class="ident" id="4627947">j</span>&nbsp;<span class="builtintype" id="4627949">int</span><span class="op" id="4627952">)</span>&nbsp;<span class="builtintype" id="4627954">bool</span>&nbsp;<span class="op" id="4627959">{</span>&nbsp;<span class="keyword" id="4627961">return</span>&nbsp;<span class="ident" id="4627968">x</span><span class="op" id="4627969">[</span><span class="ident" id="4627970">i</span><span class="op" id="4627971">]</span><span class="op" id="4627972">.</span><span class="ident" id="4627973">name</span>&nbsp;<span class="op" id="4627978">&lt;</span>&nbsp;<span class="ident" id="4627980">x</span><span class="op" id="4627981">[</span><span class="ident" id="4627982">j</span><span class="op" id="4627983">]</span><span class="op" id="4627984">.</span><span class="ident" id="4627985">name</span>&nbsp;<span class="op" id="4627990">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4627993">//&nbsp;Name&nbsp;returns&nbsp;this&nbsp;profile&#39;s&nbsp;name,&nbsp;which&nbsp;can&nbsp;be&nbsp;passed&nbsp;to&nbsp;Lookup&nbsp;to&nbsp;reobtain&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4628085">func</span>&nbsp;<span class="op" id="4628090">(</span><span class="ident" id="4628091">p</span>&nbsp;<span class="op" id="4628093">*</span><span class="ident" id="4628094">Profile</span><span class="op" id="4628101">)</span>&nbsp;<span class="ident" id="4628103">Name</span><span class="op" id="4628107">(</span><span class="op" id="4628108">)</span>&nbsp;<span class="builtintype" id="4628110">string</span>&nbsp;<span class="op" id="4628117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628120">return</span>&nbsp;<span class="ident" id="4628127">p</span><span class="op" id="4628128">.</span><span class="ident" id="4628129">name</span><br>
<span class="lineno"></span><span class="op" id="4628134">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4628137">//&nbsp;Count&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;execution&nbsp;stacks&nbsp;currently&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4628211">func</span>&nbsp;<span class="op" id="4628216">(</span><span class="ident" id="4628217">p</span>&nbsp;<span class="op" id="4628219">*</span><span class="ident" id="4628220">Profile</span><span class="op" id="4628227">)</span>&nbsp;<span class="ident" id="4628229">Count</span><span class="op" id="4628234">(</span><span class="op" id="4628235">)</span>&nbsp;<span class="builtintype" id="4628237">int</span>&nbsp;<span class="op" id="4628241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628244">p</span><span class="op" id="4628245">.</span><span class="ident" id="4628246">mu</span><span class="op" id="4628248">.</span><span class="ident" id="4628249">Lock</span><span class="op" id="4628253">(</span><span class="op" id="4628254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628257">defer</span>&nbsp;<span class="ident" id="4628263">p</span><span class="op" id="4628264">.</span><span class="ident" id="4628265">mu</span><span class="op" id="4628267">.</span><span class="ident" id="4628268">Unlock</span><span class="op" id="4628274">(</span><span class="op" id="4628275">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628278">if</span>&nbsp;<span class="ident" id="4628281">p</span><span class="op" id="4628282">.</span><span class="ident" id="4628283">count</span>&nbsp;<span class="op" id="4628289">!=</span>&nbsp;<span class="builtintype" id="4628292">nil</span>&nbsp;<span class="op" id="4628296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628300">return</span>&nbsp;<span class="ident" id="4628307">p</span><span class="op" id="4628308">.</span><span class="ident" id="4628309">count</span><span class="op" id="4628314">(</span><span class="op" id="4628315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4628318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628321">return</span>&nbsp;<span class="builtinfunc" id="4628328">len</span><span class="op" id="4628331">(</span><span class="ident" id="4628332">p</span><span class="op" id="4628333">.</span><span class="ident" id="4628334">m</span><span class="op" id="4628335">)</span><br>
<span class="lineno"></span><span class="op" id="4628337">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4628340">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;current&nbsp;execution&nbsp;stack&nbsp;to&nbsp;the&nbsp;profile,&nbsp;associated&nbsp;with&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4628419">//&nbsp;Add&nbsp;stores&nbsp;value&nbsp;in&nbsp;an&nbsp;internal&nbsp;map,&nbsp;so&nbsp;value&nbsp;must&nbsp;be&nbsp;suitable&nbsp;for&nbsp;use&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4628496">//&nbsp;a&nbsp;map&nbsp;key&nbsp;and&nbsp;will&nbsp;not&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;until&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="4628567">//&nbsp;call&nbsp;to&nbsp;Remove.&nbsp;&nbsp;Add&nbsp;panics&nbsp;if&nbsp;the&nbsp;profile&nbsp;already&nbsp;contains&nbsp;a&nbsp;stack&nbsp;for&nbsp;value.</span><br>
<span class="lineno">170</span><span class="comment" id="4628649">//</span><br>
<span class="lineno"></span><span class="comment" id="4628652">//&nbsp;The&nbsp;skip&nbsp;parameter&nbsp;has&nbsp;the&nbsp;same&nbsp;meaning&nbsp;as&nbsp;runtime.Caller&#39;s&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4628720">//&nbsp;and&nbsp;controls&nbsp;where&nbsp;the&nbsp;stack&nbsp;trace&nbsp;begins.&nbsp;&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4628793">//&nbsp;trace&nbsp;in&nbsp;the&nbsp;function&nbsp;calling&nbsp;Add.&nbsp;&nbsp;For&nbsp;example,&nbsp;given&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4628856">//&nbsp;execution&nbsp;stack:</span><br>
<span class="lineno">175</span><span class="comment" id="4628876">//</span><br>
<span class="lineno"></span><span class="comment" id="4628879">//&nbsp;&nbsp;&nbsp;&nbsp;Add</span><br>
<span class="lineno"></span><span class="comment" id="4628886">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;rpc.NewClient</span><br>
<span class="lineno"></span><span class="comment" id="4628915">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;mypkg.Run</span><br>
<span class="lineno"></span><span class="comment" id="4628940">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;main.main</span><br>
<span class="lineno">180</span><span class="comment" id="4628965">//</span><br>
<span class="lineno"></span><span class="comment" id="4628968">//&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;Add&nbsp;inside&nbsp;rpc.NewClient.</span><br>
<span class="lineno"></span><span class="comment" id="4629050">//&nbsp;Passing&nbsp;skip=1&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;NewClient&nbsp;inside&nbsp;mypkg.Run.</span><br>
<span class="lineno"></span><span class="comment" id="4629134">//</span><br>
<span class="lineno"></span><span class="keyword" id="4629137">func</span>&nbsp;<span class="op" id="4629142">(</span><span class="ident" id="4629143">p</span>&nbsp;<span class="op" id="4629145">*</span><span class="ident" id="4629146">Profile</span><span class="op" id="4629153">)</span>&nbsp;<span class="ident" id="4629155">Add</span><span class="op" id="4629158">(</span><span class="ident" id="4629159">value</span>&nbsp;<span class="keyword" id="4629165">interface</span><span class="op" id="4629174">{</span><span class="op" id="4629175">}</span><span class="op" id="4629176">,</span>&nbsp;<span class="ident" id="4629178">skip</span>&nbsp;<span class="builtintype" id="4629183">int</span><span class="op" id="4629186">)</span>&nbsp;<span class="op" id="4629188">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4629191">if</span>&nbsp;<span class="ident" id="4629194">p</span><span class="op" id="4629195">.</span><span class="ident" id="4629196">name</span>&nbsp;<span class="op" id="4629201">==</span>&nbsp;<span class="string" id="4629204">&#34;&#34;</span>&nbsp;<span class="op" id="4629207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4629211">panic</span><span class="op" id="4629216">(</span><span class="string" id="4629217">&#34;pprof:&nbsp;use&nbsp;of&nbsp;uninitialized&nbsp;Profile&#34;</span><span class="op" id="4629254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4629257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4629260">if</span>&nbsp;<span class="ident" id="4629263">p</span><span class="op" id="4629264">.</span><span class="ident" id="4629265">write</span>&nbsp;<span class="op" id="4629271">!=</span>&nbsp;<span class="builtintype" id="4629274">nil</span>&nbsp;<span class="op" id="4629278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4629282">panic</span><span class="op" id="4629287">(</span><span class="string" id="4629288">&#34;pprof:&nbsp;Add&nbsp;called&nbsp;on&nbsp;built-in&nbsp;Profile&nbsp;&#34;</span>&nbsp;<span class="op" id="4629329">+</span>&nbsp;<span class="ident" id="4629331">p</span><span class="op" id="4629332">.</span><span class="ident" id="4629333">name</span><span class="op" id="4629337">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4629340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4629344">stk</span>&nbsp;<span class="op" id="4629348">:=</span>&nbsp;<span class="builtinfunc" id="4629351">make</span><span class="op" id="4629355">(</span><span class="op" id="4629356">[</span><span class="op" id="4629357">]</span><span class="builtintype" id="4629358">uintptr</span><span class="op" id="4629365">,</span>&nbsp;<span class="num" id="4629367">32</span><span class="op" id="4629369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4629372">n</span>&nbsp;<span class="op" id="4629374">:=</span>&nbsp;<span class="ident" id="4629377">runtime</span><span class="op" id="4629384">.</span><span class="ident" id="4629385">Callers</span><span class="op" id="4629392">(</span><span class="ident" id="4629393">skip</span><span class="op" id="4629397">+</span><span class="num" id="4629398">1</span><span class="op" id="4629399">,</span>&nbsp;<span class="ident" id="4629401">stk</span><span class="op" id="4629404">[</span><span class="op" id="4629405">:</span><span class="op" id="4629406">]</span><span class="op" id="4629407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4629411">p</span><span class="op" id="4629412">.</span><span class="ident" id="4629413">mu</span><span class="op" id="4629415">.</span><span class="ident" id="4629416">Lock</span><span class="op" id="4629420">(</span><span class="op" id="4629421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4629424">defer</span>&nbsp;<span class="ident" id="4629430">p</span><span class="op" id="4629431">.</span><span class="ident" id="4629432">mu</span><span class="op" id="4629434">.</span><span class="ident" id="4629435">Unlock</span><span class="op" id="4629441">(</span><span class="op" id="4629442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4629445">if</span>&nbsp;<span class="ident" id="4629448">p</span><span class="op" id="4629449">.</span><span class="ident" id="4629450">m</span><span class="op" id="4629451">[</span><span class="ident" id="4629452">value</span><span class="op" id="4629457">]</span>&nbsp;<span class="op" id="4629459">!=</span>&nbsp;<span class="builtintype" id="4629462">nil</span>&nbsp;<span class="op" id="4629466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4629470">panic</span><span class="op" id="4629475">(</span><span class="string" id="4629476">&#34;pprof:&nbsp;Profile.Add&nbsp;of&nbsp;duplicate&nbsp;value&#34;</span><span class="op" id="4629515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4629518">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4629521">p</span><span class="op" id="4629522">.</span><span class="ident" id="4629523">m</span><span class="op" id="4629524">[</span><span class="ident" id="4629525">value</span><span class="op" id="4629530">]</span>&nbsp;<span class="op" id="4629532">=</span>&nbsp;<span class="ident" id="4629534">stk</span><span class="op" id="4629537">[</span><span class="op" id="4629538">:</span><span class="ident" id="4629539">n</span><span class="op" id="4629540">]</span><br>
<span class="lineno"></span><span class="op" id="4629542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4629545">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;execution&nbsp;stack&nbsp;associated&nbsp;with&nbsp;value&nbsp;from&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="4629623">//&nbsp;It&nbsp;is&nbsp;a&nbsp;no-op&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno">205</span><span class="keyword" id="4629676">func</span>&nbsp;<span class="op" id="4629681">(</span><span class="ident" id="4629682">p</span>&nbsp;<span class="op" id="4629684">*</span><span class="ident" id="4629685">Profile</span><span class="op" id="4629692">)</span>&nbsp;<span class="ident" id="4629694">Remove</span><span class="op" id="4629700">(</span><span class="ident" id="4629701">value</span>&nbsp;<span class="keyword" id="4629707">interface</span><span class="op" id="4629716">{</span><span class="op" id="4629717">}</span><span class="op" id="4629718">)</span>&nbsp;<span class="op" id="4629720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4629723">p</span><span class="op" id="4629724">.</span><span class="ident" id="4629725">mu</span><span class="op" id="4629727">.</span><span class="ident" id="4629728">Lock</span><span class="op" id="4629732">(</span><span class="op" id="4629733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4629736">defer</span>&nbsp;<span class="ident" id="4629742">p</span><span class="op" id="4629743">.</span><span class="ident" id="4629744">mu</span><span class="op" id="4629746">.</span><span class="ident" id="4629747">Unlock</span><span class="op" id="4629753">(</span><span class="op" id="4629754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4629757">delete</span><span class="op" id="4629763">(</span><span class="ident" id="4629764">p</span><span class="op" id="4629765">.</span><span class="ident" id="4629766">m</span><span class="op" id="4629767">,</span>&nbsp;<span class="ident" id="4629769">value</span><span class="op" id="4629774">)</span><br>
<span class="lineno"></span><span class="op" id="4629776">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="comment" id="4629779">//&nbsp;WriteTo&nbsp;writes&nbsp;a&nbsp;pprof-formatted&nbsp;snapshot&nbsp;of&nbsp;the&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4629845">//&nbsp;If&nbsp;a&nbsp;write&nbsp;to&nbsp;w&nbsp;returns&nbsp;an&nbsp;error,&nbsp;WriteTo&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4629910">//&nbsp;Otherwise,&nbsp;WriteTo&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4629945">//</span><br>
<span class="lineno">215</span><span class="comment" id="4629948">//&nbsp;The&nbsp;debug&nbsp;parameter&nbsp;enables&nbsp;additional&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4629998">//&nbsp;Passing&nbsp;debug=0&nbsp;prints&nbsp;only&nbsp;the&nbsp;hexadecimal&nbsp;addresses&nbsp;that&nbsp;pprof&nbsp;needs.</span><br>
<span class="lineno"></span><span class="comment" id="4630073">//&nbsp;Passing&nbsp;debug=1&nbsp;adds&nbsp;comments&nbsp;translating&nbsp;addresses&nbsp;to&nbsp;function&nbsp;names</span><br>
<span class="lineno"></span><span class="comment" id="4630146">//&nbsp;and&nbsp;line&nbsp;numbers,&nbsp;so&nbsp;that&nbsp;a&nbsp;programmer&nbsp;can&nbsp;read&nbsp;the&nbsp;profile&nbsp;without&nbsp;tools.</span><br>
<span class="lineno"></span><span class="comment" id="4630224">//</span><br>
<span class="lineno">220</span><span class="comment" id="4630227">//&nbsp;The&nbsp;predefined&nbsp;profiles&nbsp;may&nbsp;assign&nbsp;meaning&nbsp;to&nbsp;other&nbsp;debug&nbsp;values;</span><br>
<span class="lineno"></span><span class="comment" id="4630296">//&nbsp;for&nbsp;example,&nbsp;when&nbsp;printing&nbsp;the&nbsp;&#34;goroutine&#34;&nbsp;profile,&nbsp;debug=2&nbsp;means&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4630368">//&nbsp;print&nbsp;the&nbsp;goroutine&nbsp;stacks&nbsp;in&nbsp;the&nbsp;same&nbsp;form&nbsp;that&nbsp;a&nbsp;Go&nbsp;program&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="4630438">//&nbsp;when&nbsp;dying&nbsp;due&nbsp;to&nbsp;an&nbsp;unrecovered&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4630481">func</span>&nbsp;<span class="op" id="4630486">(</span><span class="ident" id="4630487">p</span>&nbsp;<span class="op" id="4630489">*</span><span class="ident" id="4630490">Profile</span><span class="op" id="4630497">)</span>&nbsp;<span class="ident" id="4630499">WriteTo</span><span class="op" id="4630506">(</span><span class="ident" id="4630507">w</span>&nbsp;<span class="ident" id="4630509">io</span><span class="op" id="4630511">.</span><span class="ident" id="4630512">Writer</span><span class="op" id="4630518">,</span>&nbsp;<span class="ident" id="4630520">debug</span>&nbsp;<span class="builtintype" id="4630526">int</span><span class="op" id="4630529">)</span>&nbsp;<span class="builtintype" id="4630531">error</span>&nbsp;<span class="op" id="4630537">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4630540">if</span>&nbsp;<span class="ident" id="4630543">p</span><span class="op" id="4630544">.</span><span class="ident" id="4630545">name</span>&nbsp;<span class="op" id="4630550">==</span>&nbsp;<span class="string" id="4630553">&#34;&#34;</span>&nbsp;<span class="op" id="4630556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4630560">panic</span><span class="op" id="4630565">(</span><span class="string" id="4630566">&#34;pprof:&nbsp;use&nbsp;of&nbsp;zero&nbsp;Profile&#34;</span><span class="op" id="4630594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4630597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4630600">if</span>&nbsp;<span class="ident" id="4630603">p</span><span class="op" id="4630604">.</span><span class="ident" id="4630605">write</span>&nbsp;<span class="op" id="4630611">!=</span>&nbsp;<span class="builtintype" id="4630614">nil</span>&nbsp;<span class="op" id="4630618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4630622">return</span>&nbsp;<span class="ident" id="4630629">p</span><span class="op" id="4630630">.</span><span class="ident" id="4630631">write</span><span class="op" id="4630636">(</span><span class="ident" id="4630637">w</span><span class="op" id="4630638">,</span>&nbsp;<span class="ident" id="4630640">debug</span><span class="op" id="4630645">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4630648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4630652">//&nbsp;Obtain&nbsp;consistent&nbsp;snapshot&nbsp;under&nbsp;lock;&nbsp;then&nbsp;process&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4630722">var</span>&nbsp;<span class="ident" id="4630726">all</span>&nbsp;<span class="op" id="4630730">[</span><span class="op" id="4630731">]</span><span class="op" id="4630732">[</span><span class="op" id="4630733">]</span><span class="builtintype" id="4630734">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4630743">p</span><span class="op" id="4630744">.</span><span class="ident" id="4630745">mu</span><span class="op" id="4630747">.</span><span class="ident" id="4630748">Lock</span><span class="op" id="4630752">(</span><span class="op" id="4630753">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4630756">for</span>&nbsp;<span class="ident" id="4630760">_</span><span class="op" id="4630761">,</span>&nbsp;<span class="ident" id="4630763">stk</span>&nbsp;<span class="op" id="4630767">:=</span>&nbsp;<span class="keyword" id="4630770">range</span>&nbsp;<span class="ident" id="4630776">p</span><span class="op" id="4630777">.</span><span class="ident" id="4630778">m</span>&nbsp;<span class="op" id="4630780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4630784">all</span>&nbsp;<span class="op" id="4630788">=</span>&nbsp;<span class="builtinfunc" id="4630790">append</span><span class="op" id="4630796">(</span><span class="ident" id="4630797">all</span><span class="op" id="4630800">,</span>&nbsp;<span class="ident" id="4630802">stk</span><span class="op" id="4630805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4630808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4630811">p</span><span class="op" id="4630812">.</span><span class="ident" id="4630813">mu</span><span class="op" id="4630815">.</span><span class="ident" id="4630816">Unlock</span><span class="op" id="4630822">(</span><span class="op" id="4630823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4630827">//&nbsp;Map&nbsp;order&nbsp;is&nbsp;non-deterministic;&nbsp;make&nbsp;output&nbsp;deterministic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4630890">sort</span><span class="op" id="4630894">.</span><span class="ident" id="4630895">Sort</span><span class="op" id="4630899">(</span><span class="ident" id="4630900">stackProfile</span><span class="op" id="4630912">(</span><span class="ident" id="4630913">all</span><span class="op" id="4630916">)</span><span class="op" id="4630917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4630921">return</span>&nbsp;<span class="ident" id="4630928">printCountProfile</span><span class="op" id="4630945">(</span><span class="ident" id="4630946">w</span><span class="op" id="4630947">,</span>&nbsp;<span class="ident" id="4630949">debug</span><span class="op" id="4630954">,</span>&nbsp;<span class="ident" id="4630956">p</span><span class="op" id="4630957">.</span><span class="ident" id="4630958">name</span><span class="op" id="4630962">,</span>&nbsp;<span class="ident" id="4630964">stackProfile</span><span class="op" id="4630976">(</span><span class="ident" id="4630977">all</span><span class="op" id="4630980">)</span><span class="op" id="4630981">)</span><br>
<span class="lineno"></span><span class="op" id="4630983">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4630986">type</span>&nbsp;<span class="ident" id="4630991">stackProfile</span>&nbsp;<span class="op" id="4631004">[</span><span class="op" id="4631005">]</span><span class="op" id="4631006">[</span><span class="op" id="4631007">]</span><span class="builtintype" id="4631008">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4631017">func</span>&nbsp;<span class="op" id="4631022">(</span><span class="ident" id="4631023">x</span>&nbsp;<span class="ident" id="4631025">stackProfile</span><span class="op" id="4631037">)</span>&nbsp;<span class="ident" id="4631039">Len</span><span class="op" id="4631042">(</span><span class="op" id="4631043">)</span>&nbsp;<span class="builtintype" id="4631045">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4631062">{</span>&nbsp;<span class="keyword" id="4631064">return</span>&nbsp;<span class="builtinfunc" id="4631071">len</span><span class="op" id="4631074">(</span><span class="ident" id="4631075">x</span><span class="op" id="4631076">)</span>&nbsp;<span class="op" id="4631078">}</span><br>
<span class="lineno"></span><span class="keyword" id="4631080">func</span>&nbsp;<span class="op" id="4631085">(</span><span class="ident" id="4631086">x</span>&nbsp;<span class="ident" id="4631088">stackProfile</span><span class="op" id="4631100">)</span>&nbsp;<span class="ident" id="4631102">Stack</span><span class="op" id="4631107">(</span><span class="ident" id="4631108">i</span>&nbsp;<span class="builtintype" id="4631110">int</span><span class="op" id="4631113">)</span>&nbsp;<span class="op" id="4631115">[</span><span class="op" id="4631116">]</span><span class="builtintype" id="4631117">uintptr</span>&nbsp;<span class="op" id="4631125">{</span>&nbsp;<span class="keyword" id="4631127">return</span>&nbsp;<span class="ident" id="4631134">x</span><span class="op" id="4631135">[</span><span class="ident" id="4631136">i</span><span class="op" id="4631137">]</span>&nbsp;<span class="op" id="4631139">}</span><br>
<span class="lineno">250</span><span class="keyword" id="4631141">func</span>&nbsp;<span class="op" id="4631146">(</span><span class="ident" id="4631147">x</span>&nbsp;<span class="ident" id="4631149">stackProfile</span><span class="op" id="4631161">)</span>&nbsp;<span class="ident" id="4631163">Swap</span><span class="op" id="4631167">(</span><span class="ident" id="4631168">i</span><span class="op" id="4631169">,</span>&nbsp;<span class="ident" id="4631171">j</span>&nbsp;<span class="builtintype" id="4631173">int</span><span class="op" id="4631176">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4631186">{</span>&nbsp;<span class="ident" id="4631188">x</span><span class="op" id="4631189">[</span><span class="ident" id="4631190">i</span><span class="op" id="4631191">]</span><span class="op" id="4631192">,</span>&nbsp;<span class="ident" id="4631194">x</span><span class="op" id="4631195">[</span><span class="ident" id="4631196">j</span><span class="op" id="4631197">]</span>&nbsp;<span class="op" id="4631199">=</span>&nbsp;<span class="ident" id="4631201">x</span><span class="op" id="4631202">[</span><span class="ident" id="4631203">j</span><span class="op" id="4631204">]</span><span class="op" id="4631205">,</span>&nbsp;<span class="ident" id="4631207">x</span><span class="op" id="4631208">[</span><span class="ident" id="4631209">i</span><span class="op" id="4631210">]</span>&nbsp;<span class="op" id="4631212">}</span><br>
<span class="lineno"></span><span class="keyword" id="4631214">func</span>&nbsp;<span class="op" id="4631219">(</span><span class="ident" id="4631220">x</span>&nbsp;<span class="ident" id="4631222">stackProfile</span><span class="op" id="4631234">)</span>&nbsp;<span class="ident" id="4631236">Less</span><span class="op" id="4631240">(</span><span class="ident" id="4631241">i</span><span class="op" id="4631242">,</span>&nbsp;<span class="ident" id="4631244">j</span>&nbsp;<span class="builtintype" id="4631246">int</span><span class="op" id="4631249">)</span>&nbsp;<span class="builtintype" id="4631251">bool</span>&nbsp;<span class="op" id="4631256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631259">t</span><span class="op" id="4631260">,</span>&nbsp;<span class="ident" id="4631262">u</span>&nbsp;<span class="op" id="4631264">:=</span>&nbsp;<span class="ident" id="4631267">x</span><span class="op" id="4631268">[</span><span class="ident" id="4631269">i</span><span class="op" id="4631270">]</span><span class="op" id="4631271">,</span>&nbsp;<span class="ident" id="4631273">x</span><span class="op" id="4631274">[</span><span class="ident" id="4631275">j</span><span class="op" id="4631276">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4631279">for</span>&nbsp;<span class="ident" id="4631283">k</span>&nbsp;<span class="op" id="4631285">:=</span>&nbsp;<span class="num" id="4631288">0</span><span class="op" id="4631289">;</span>&nbsp;<span class="ident" id="4631291">k</span>&nbsp;<span class="op" id="4631293">&lt;</span>&nbsp;<span class="builtinfunc" id="4631295">len</span><span class="op" id="4631298">(</span><span class="ident" id="4631299">t</span><span class="op" id="4631300">)</span>&nbsp;<span class="op" id="4631302">&amp;&amp;</span>&nbsp;<span class="ident" id="4631305">k</span>&nbsp;<span class="op" id="4631307">&lt;</span>&nbsp;<span class="builtinfunc" id="4631309">len</span><span class="op" id="4631312">(</span><span class="ident" id="4631313">u</span><span class="op" id="4631314">)</span><span class="op" id="4631315">;</span>&nbsp;<span class="ident" id="4631317">k</span><span class="op" id="4631318">++</span>&nbsp;<span class="op" id="4631321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4631325">if</span>&nbsp;<span class="ident" id="4631328">t</span><span class="op" id="4631329">[</span><span class="ident" id="4631330">k</span><span class="op" id="4631331">]</span>&nbsp;<span class="op" id="4631333">!=</span>&nbsp;<span class="ident" id="4631336">u</span><span class="op" id="4631337">[</span><span class="ident" id="4631338">k</span><span class="op" id="4631339">]</span>&nbsp;<span class="op" id="4631341">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4631346">return</span>&nbsp;<span class="ident" id="4631353">t</span><span class="op" id="4631354">[</span><span class="ident" id="4631355">k</span><span class="op" id="4631356">]</span>&nbsp;<span class="op" id="4631358">&lt;</span>&nbsp;<span class="ident" id="4631360">u</span><span class="op" id="4631361">[</span><span class="ident" id="4631362">k</span><span class="op" id="4631363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4631367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4631370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4631373">return</span>&nbsp;<span class="builtinfunc" id="4631380">len</span><span class="op" id="4631383">(</span><span class="ident" id="4631384">t</span><span class="op" id="4631385">)</span>&nbsp;<span class="op" id="4631387">&lt;</span>&nbsp;<span class="builtinfunc" id="4631389">len</span><span class="op" id="4631392">(</span><span class="ident" id="4631393">u</span><span class="op" id="4631394">)</span><br>
<span class="lineno"></span><span class="op" id="4631396">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4631399">//&nbsp;A&nbsp;countProfile&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;stack&nbsp;traces&nbsp;to&nbsp;be&nbsp;printed&nbsp;as&nbsp;counts</span><br>
<span class="lineno"></span><span class="comment" id="4631466">//&nbsp;grouped&nbsp;by&nbsp;stack&nbsp;trace.&nbsp;&nbsp;There&nbsp;are&nbsp;multiple&nbsp;implementations:</span><br>
<span class="lineno"></span><span class="comment" id="4631530">//&nbsp;all&nbsp;that&nbsp;matters&nbsp;is&nbsp;that&nbsp;we&nbsp;can&nbsp;find&nbsp;out&nbsp;how&nbsp;many&nbsp;traces&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4631600">//&nbsp;and&nbsp;obtain&nbsp;each&nbsp;trace&nbsp;in&nbsp;turn.</span><br>
<span class="lineno">265</span><span class="keyword" id="4631634">type</span>&nbsp;<span class="ident" id="4631639">countProfile</span>&nbsp;<span class="keyword" id="4631652">interface</span>&nbsp;<span class="op" id="4631662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631665">Len</span><span class="op" id="4631668">(</span><span class="op" id="4631669">)</span>&nbsp;<span class="builtintype" id="4631671">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631676">Stack</span><span class="op" id="4631681">(</span><span class="ident" id="4631682">i</span>&nbsp;<span class="builtintype" id="4631684">int</span><span class="op" id="4631687">)</span>&nbsp;<span class="op" id="4631689">[</span><span class="op" id="4631690">]</span><span class="builtintype" id="4631691">uintptr</span><br>
<span class="lineno"></span><span class="op" id="4631699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4631702">//&nbsp;printCountProfile&nbsp;prints&nbsp;a&nbsp;countProfile&nbsp;at&nbsp;the&nbsp;specified&nbsp;debug&nbsp;level.</span><br>
<span class="lineno"></span><span class="keyword" id="4631775">func</span>&nbsp;<span class="ident" id="4631780">printCountProfile</span><span class="op" id="4631797">(</span><span class="ident" id="4631798">w</span>&nbsp;<span class="ident" id="4631800">io</span><span class="op" id="4631802">.</span><span class="ident" id="4631803">Writer</span><span class="op" id="4631809">,</span>&nbsp;<span class="ident" id="4631811">debug</span>&nbsp;<span class="builtintype" id="4631817">int</span><span class="op" id="4631820">,</span>&nbsp;<span class="ident" id="4631822">name</span>&nbsp;<span class="builtintype" id="4631827">string</span><span class="op" id="4631833">,</span>&nbsp;<span class="ident" id="4631835">p</span>&nbsp;<span class="ident" id="4631837">countProfile</span><span class="op" id="4631849">)</span>&nbsp;<span class="builtintype" id="4631851">error</span>&nbsp;<span class="op" id="4631857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631860">b</span>&nbsp;<span class="op" id="4631862">:=</span>&nbsp;<span class="ident" id="4631865">bufio</span><span class="op" id="4631870">.</span><span class="ident" id="4631871">NewWriter</span><span class="op" id="4631880">(</span><span class="ident" id="4631881">w</span><span class="op" id="4631882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4631885">var</span>&nbsp;<span class="ident" id="4631889">tw</span>&nbsp;<span class="op" id="4631892">*</span><span class="ident" id="4631893">tabwriter</span><span class="op" id="4631902">.</span><span class="ident" id="4631903">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631911">w</span>&nbsp;<span class="op" id="4631913">=</span>&nbsp;<span class="ident" id="4631915">b</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4631918">if</span>&nbsp;<span class="ident" id="4631921">debug</span>&nbsp;<span class="op" id="4631927">&gt;</span>&nbsp;<span class="num" id="4631929">0</span>&nbsp;<span class="op" id="4631931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631935">tw</span>&nbsp;<span class="op" id="4631938">=</span>&nbsp;<span class="ident" id="4631940">tabwriter</span><span class="op" id="4631949">.</span><span class="ident" id="4631950">NewWriter</span><span class="op" id="4631959">(</span><span class="ident" id="4631960">w</span><span class="op" id="4631961">,</span>&nbsp;<span class="num" id="4631963">1</span><span class="op" id="4631964">,</span>&nbsp;<span class="num" id="4631966">8</span><span class="op" id="4631967">,</span>&nbsp;<span class="num" id="4631969">1</span><span class="op" id="4631970">,</span>&nbsp;<span class="string" id="4631972">&#39;\t&#39;</span><span class="op" id="4631976">,</span>&nbsp;<span class="num" id="4631978">0</span><span class="op" id="4631979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631983">w</span>&nbsp;<span class="op" id="4631985">=</span>&nbsp;<span class="ident" id="4631987">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4631991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4631995">fmt</span><span class="op" id="4631998">.</span><span class="ident" id="4631999">Fprintf</span><span class="op" id="4632006">(</span><span class="ident" id="4632007">w</span><span class="op" id="4632008">,</span>&nbsp;<span class="string" id="4632010">&#34;%s&nbsp;profile:&nbsp;total&nbsp;%d\n&#34;</span><span class="op" id="4632034">,</span>&nbsp;<span class="ident" id="4632036">name</span><span class="op" id="4632040">,</span>&nbsp;<span class="ident" id="4632042">p</span><span class="op" id="4632043">.</span><span class="ident" id="4632044">Len</span><span class="op" id="4632047">(</span><span class="op" id="4632048">)</span><span class="op" id="4632049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4632053">//&nbsp;Build&nbsp;count&nbsp;of&nbsp;each&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632084">var</span>&nbsp;<span class="ident" id="4632088">buf</span>&nbsp;<span class="ident" id="4632092">bytes</span><span class="op" id="4632097">.</span><span class="ident" id="4632098">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632106">key</span>&nbsp;<span class="op" id="4632110">:=</span>&nbsp;<span class="keyword" id="4632113">func</span><span class="op" id="4632117">(</span><span class="ident" id="4632118">stk</span>&nbsp;<span class="op" id="4632122">[</span><span class="op" id="4632123">]</span><span class="builtintype" id="4632124">uintptr</span><span class="op" id="4632131">)</span>&nbsp;<span class="builtintype" id="4632133">string</span>&nbsp;<span class="op" id="4632140">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632144">buf</span><span class="op" id="4632147">.</span><span class="ident" id="4632148">Reset</span><span class="op" id="4632153">(</span><span class="op" id="4632154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632158">fmt</span><span class="op" id="4632161">.</span><span class="ident" id="4632162">Fprintf</span><span class="op" id="4632169">(</span><span class="op" id="4632170">&amp;</span><span class="ident" id="4632171">buf</span><span class="op" id="4632174">,</span>&nbsp;<span class="string" id="4632176">&#34;@&#34;</span><span class="op" id="4632179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632183">for</span>&nbsp;<span class="ident" id="4632187">_</span><span class="op" id="4632188">,</span>&nbsp;<span class="ident" id="4632190">pc</span>&nbsp;<span class="op" id="4632193">:=</span>&nbsp;<span class="keyword" id="4632196">range</span>&nbsp;<span class="ident" id="4632202">stk</span>&nbsp;<span class="op" id="4632206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632211">fmt</span><span class="op" id="4632214">.</span><span class="ident" id="4632215">Fprintf</span><span class="op" id="4632222">(</span><span class="op" id="4632223">&amp;</span><span class="ident" id="4632224">buf</span><span class="op" id="4632227">,</span>&nbsp;<span class="string" id="4632229">&#34;&nbsp;%#x&#34;</span><span class="op" id="4632235">,</span>&nbsp;<span class="ident" id="4632237">pc</span><span class="op" id="4632239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4632243">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632247">return</span>&nbsp;<span class="ident" id="4632254">buf</span><span class="op" id="4632257">.</span><span class="ident" id="4632258">String</span><span class="op" id="4632264">(</span><span class="op" id="4632265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4632268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632271">m</span>&nbsp;<span class="op" id="4632273">:=</span>&nbsp;<span class="keyword" id="4632276">map</span><span class="op" id="4632279">[</span><span class="builtintype" id="4632280">string</span><span class="op" id="4632286">]</span><span class="builtintype" id="4632287">int</span><span class="op" id="4632290">{</span><span class="op" id="4632291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632294">n</span>&nbsp;<span class="op" id="4632296">:=</span>&nbsp;<span class="ident" id="4632299">p</span><span class="op" id="4632300">.</span><span class="ident" id="4632301">Len</span><span class="op" id="4632304">(</span><span class="op" id="4632305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632308">for</span>&nbsp;<span class="ident" id="4632312">i</span>&nbsp;<span class="op" id="4632314">:=</span>&nbsp;<span class="num" id="4632317">0</span><span class="op" id="4632318">;</span>&nbsp;<span class="ident" id="4632320">i</span>&nbsp;<span class="op" id="4632322">&lt;</span>&nbsp;<span class="ident" id="4632324">n</span><span class="op" id="4632325">;</span>&nbsp;<span class="ident" id="4632327">i</span><span class="op" id="4632328">++</span>&nbsp;<span class="op" id="4632331">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632335">m</span><span class="op" id="4632336">[</span><span class="ident" id="4632337">key</span><span class="op" id="4632340">(</span><span class="ident" id="4632341">p</span><span class="op" id="4632342">.</span><span class="ident" id="4632343">Stack</span><span class="op" id="4632348">(</span><span class="ident" id="4632349">i</span><span class="op" id="4632350">)</span><span class="op" id="4632351">)</span><span class="op" id="4632352">]</span><span class="op" id="4632353">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4632357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4632361">//&nbsp;Print&nbsp;stacks,&nbsp;listing&nbsp;count&nbsp;on&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;a&nbsp;unique&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632432">for</span>&nbsp;<span class="ident" id="4632436">i</span>&nbsp;<span class="op" id="4632438">:=</span>&nbsp;<span class="num" id="4632441">0</span><span class="op" id="4632442">;</span>&nbsp;<span class="ident" id="4632444">i</span>&nbsp;<span class="op" id="4632446">&lt;</span>&nbsp;<span class="ident" id="4632448">n</span><span class="op" id="4632449">;</span>&nbsp;<span class="ident" id="4632451">i</span><span class="op" id="4632452">++</span>&nbsp;<span class="op" id="4632455">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632459">stk</span>&nbsp;<span class="op" id="4632463">:=</span>&nbsp;<span class="ident" id="4632466">p</span><span class="op" id="4632467">.</span><span class="ident" id="4632468">Stack</span><span class="op" id="4632473">(</span><span class="ident" id="4632474">i</span><span class="op" id="4632475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632479">s</span>&nbsp;<span class="op" id="4632481">:=</span>&nbsp;<span class="ident" id="4632484">key</span><span class="op" id="4632487">(</span><span class="ident" id="4632488">stk</span><span class="op" id="4632491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632495">if</span>&nbsp;<span class="ident" id="4632498">count</span>&nbsp;<span class="op" id="4632504">:=</span>&nbsp;<span class="ident" id="4632507">m</span><span class="op" id="4632508">[</span><span class="ident" id="4632509">s</span><span class="op" id="4632510">]</span><span class="op" id="4632511">;</span>&nbsp;<span class="ident" id="4632513">count</span>&nbsp;<span class="op" id="4632519">!=</span>&nbsp;<span class="num" id="4632522">0</span>&nbsp;<span class="op" id="4632524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632529">fmt</span><span class="op" id="4632532">.</span><span class="ident" id="4632533">Fprintf</span><span class="op" id="4632540">(</span><span class="ident" id="4632541">w</span><span class="op" id="4632542">,</span>&nbsp;<span class="string" id="4632544">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="4632553">,</span>&nbsp;<span class="ident" id="4632555">count</span><span class="op" id="4632560">,</span>&nbsp;<span class="ident" id="4632562">s</span><span class="op" id="4632563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632568">if</span>&nbsp;<span class="ident" id="4632571">debug</span>&nbsp;<span class="op" id="4632577">&gt;</span>&nbsp;<span class="num" id="4632579">0</span>&nbsp;<span class="op" id="4632581">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632587">printStackRecord</span><span class="op" id="4632603">(</span><span class="ident" id="4632604">w</span><span class="op" id="4632605">,</span>&nbsp;<span class="ident" id="4632607">stk</span><span class="op" id="4632610">,</span>&nbsp;<span class="builtintype" id="4632612">false</span><span class="op" id="4632617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4632622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4632627">delete</span><span class="op" id="4632633">(</span><span class="ident" id="4632634">m</span><span class="op" id="4632635">,</span>&nbsp;<span class="ident" id="4632637">s</span><span class="op" id="4632638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4632642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4632645">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632649">if</span>&nbsp;<span class="ident" id="4632652">tw</span>&nbsp;<span class="op" id="4632655">!=</span>&nbsp;<span class="builtintype" id="4632658">nil</span>&nbsp;<span class="op" id="4632662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632666">tw</span><span class="op" id="4632668">.</span><span class="ident" id="4632669">Flush</span><span class="op" id="4632674">(</span><span class="op" id="4632675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4632678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632681">return</span>&nbsp;<span class="ident" id="4632688">b</span><span class="op" id="4632689">.</span><span class="ident" id="4632690">Flush</span><span class="op" id="4632695">(</span><span class="op" id="4632696">)</span><br>
<span class="lineno">315</span><span class="op" id="4632698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4632701">//&nbsp;printStackRecord&nbsp;prints&nbsp;the&nbsp;function&nbsp;+&nbsp;source&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4632767">//&nbsp;for&nbsp;a&nbsp;single&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span><span class="keyword" id="4632796">func</span>&nbsp;<span class="ident" id="4632801">printStackRecord</span><span class="op" id="4632817">(</span><span class="ident" id="4632818">w</span>&nbsp;<span class="ident" id="4632820">io</span><span class="op" id="4632822">.</span><span class="ident" id="4632823">Writer</span><span class="op" id="4632829">,</span>&nbsp;<span class="ident" id="4632831">stk</span>&nbsp;<span class="op" id="4632835">[</span><span class="op" id="4632836">]</span><span class="builtintype" id="4632837">uintptr</span><span class="op" id="4632844">,</span>&nbsp;<span class="ident" id="4632846">allFrames</span>&nbsp;<span class="builtintype" id="4632856">bool</span><span class="op" id="4632860">)</span>&nbsp;<span class="op" id="4632862">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632865">show</span>&nbsp;<span class="op" id="4632870">:=</span>&nbsp;<span class="ident" id="4632873">allFrames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632884">wasPanic</span>&nbsp;<span class="op" id="4632893">:=</span>&nbsp;<span class="builtintype" id="4632896">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632903">for</span>&nbsp;<span class="ident" id="4632907">i</span><span class="op" id="4632908">,</span>&nbsp;<span class="ident" id="4632910">pc</span>&nbsp;<span class="op" id="4632913">:=</span>&nbsp;<span class="keyword" id="4632916">range</span>&nbsp;<span class="ident" id="4632922">stk</span>&nbsp;<span class="op" id="4632926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632930">f</span>&nbsp;<span class="op" id="4632932">:=</span>&nbsp;<span class="ident" id="4632935">runtime</span><span class="op" id="4632942">.</span><span class="ident" id="4632943">FuncForPC</span><span class="op" id="4632952">(</span><span class="ident" id="4632953">pc</span><span class="op" id="4632955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4632959">if</span>&nbsp;<span class="ident" id="4632962">f</span>&nbsp;<span class="op" id="4632964">==</span>&nbsp;<span class="builtintype" id="4632967">nil</span>&nbsp;<span class="op" id="4632971">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632976">show</span>&nbsp;<span class="op" id="4632981">=</span>&nbsp;<span class="builtintype" id="4632983">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4632991">fmt</span><span class="op" id="4632994">.</span><span class="ident" id="4632995">Fprintf</span><span class="op" id="4633002">(</span><span class="ident" id="4633003">w</span><span class="op" id="4633004">,</span>&nbsp;<span class="string" id="4633006">&#34;#\t%#x\n&#34;</span><span class="op" id="4633016">,</span>&nbsp;<span class="ident" id="4633018">pc</span><span class="op" id="4633020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633025">wasPanic</span>&nbsp;<span class="op" id="4633034">=</span>&nbsp;<span class="builtintype" id="4633036">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633044">}</span>&nbsp;<span class="keyword" id="4633046">else</span>&nbsp;<span class="op" id="4633051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633056">tracepc</span>&nbsp;<span class="op" id="4633064">:=</span>&nbsp;<span class="ident" id="4633067">pc</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4633073">//&nbsp;Back&nbsp;up&nbsp;to&nbsp;call&nbsp;instruction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4633108">if</span>&nbsp;<span class="ident" id="4633111">i</span>&nbsp;<span class="op" id="4633113">&gt;</span>&nbsp;<span class="num" id="4633115">0</span>&nbsp;<span class="op" id="4633117">&amp;&amp;</span>&nbsp;<span class="ident" id="4633120">pc</span>&nbsp;<span class="op" id="4633123">&gt;</span>&nbsp;<span class="ident" id="4633125">f</span><span class="op" id="4633126">.</span><span class="ident" id="4633127">Entry</span><span class="op" id="4633132">(</span><span class="op" id="4633133">)</span>&nbsp;<span class="op" id="4633135">&amp;&amp;</span>&nbsp;<span class="op" id="4633138">!</span><span class="ident" id="4633139">wasPanic</span>&nbsp;<span class="op" id="4633148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4633154">if</span>&nbsp;<span class="ident" id="4633157">runtime</span><span class="op" id="4633164">.</span><span class="ident" id="4633165">GOARCH</span>&nbsp;<span class="op" id="4633172">==</span>&nbsp;<span class="string" id="4633175">&#34;386&#34;</span>&nbsp;<span class="op" id="4633181">||</span>&nbsp;<span class="ident" id="4633184">runtime</span><span class="op" id="4633191">.</span><span class="ident" id="4633192">GOARCH</span>&nbsp;<span class="op" id="4633199">==</span>&nbsp;<span class="string" id="4633202">&#34;amd64&#34;</span>&nbsp;<span class="op" id="4633210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633217">tracepc</span><span class="op" id="4633224">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633231">}</span>&nbsp;<span class="keyword" id="4633233">else</span>&nbsp;<span class="op" id="4633238">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633245">tracepc</span>&nbsp;<span class="op" id="4633253">-=</span>&nbsp;<span class="num" id="4633256">4</span>&nbsp;<span class="comment" id="4633258">//&nbsp;arm,&nbsp;etc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633284">file</span><span class="op" id="4633288">,</span>&nbsp;<span class="ident" id="4633290">line</span>&nbsp;<span class="op" id="4633295">:=</span>&nbsp;<span class="ident" id="4633298">f</span><span class="op" id="4633299">.</span><span class="ident" id="4633300">FileLine</span><span class="op" id="4633308">(</span><span class="ident" id="4633309">tracepc</span><span class="op" id="4633316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633321">name</span>&nbsp;<span class="op" id="4633326">:=</span>&nbsp;<span class="ident" id="4633329">f</span><span class="op" id="4633330">.</span><span class="ident" id="4633331">Name</span><span class="op" id="4633335">(</span><span class="op" id="4633336">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4633341">//&nbsp;Hide&nbsp;runtime.goexit&nbsp;and&nbsp;any&nbsp;runtime&nbsp;functions&nbsp;at&nbsp;the&nbsp;beginning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4633411">//&nbsp;This&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;allocation&nbsp;traces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633462">wasPanic</span>&nbsp;<span class="op" id="4633471">=</span>&nbsp;<span class="ident" id="4633473">name</span>&nbsp;<span class="op" id="4633478">==</span>&nbsp;<span class="string" id="4633481">&#34;runtime.panic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4633500">if</span>&nbsp;<span class="ident" id="4633503">name</span>&nbsp;<span class="op" id="4633508">==</span>&nbsp;<span class="string" id="4633511">&#34;runtime.goexit&#34;</span>&nbsp;<span class="op" id="4633528">||</span>&nbsp;<span class="op" id="4633531">!</span><span class="ident" id="4633532">show</span>&nbsp;<span class="op" id="4633537">&amp;&amp;</span>&nbsp;<span class="ident" id="4633540">strings</span><span class="op" id="4633547">.</span><span class="ident" id="4633548">HasPrefix</span><span class="op" id="4633557">(</span><span class="ident" id="4633558">name</span><span class="op" id="4633562">,</span>&nbsp;<span class="string" id="4633564">&#34;runtime.&#34;</span><span class="op" id="4633574">)</span>&nbsp;<span class="op" id="4633576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4633582">continue</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633599">show</span>&nbsp;<span class="op" id="4633604">=</span>&nbsp;<span class="builtintype" id="4633606">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633614">fmt</span><span class="op" id="4633617">.</span><span class="ident" id="4633618">Fprintf</span><span class="op" id="4633625">(</span><span class="ident" id="4633626">w</span><span class="op" id="4633627">,</span>&nbsp;<span class="string" id="4633629">&#34;#\t%#x\t%s+%#x\t%s:%d\n&#34;</span><span class="op" id="4633654">,</span>&nbsp;<span class="ident" id="4633656">pc</span><span class="op" id="4633658">,</span>&nbsp;<span class="ident" id="4633660">name</span><span class="op" id="4633664">,</span>&nbsp;<span class="ident" id="4633666">pc</span><span class="op" id="4633668">-</span><span class="ident" id="4633669">f</span><span class="op" id="4633670">.</span><span class="ident" id="4633671">Entry</span><span class="op" id="4633676">(</span><span class="op" id="4633677">)</span><span class="op" id="4633678">,</span>&nbsp;<span class="ident" id="4633680">file</span><span class="op" id="4633684">,</span>&nbsp;<span class="ident" id="4633686">line</span><span class="op" id="4633690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633697">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4633700">if</span>&nbsp;<span class="op" id="4633703">!</span><span class="ident" id="4633704">show</span>&nbsp;<span class="op" id="4633709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4633713">//&nbsp;We&nbsp;didn&#39;t&nbsp;print&nbsp;anything;&nbsp;do&nbsp;it&nbsp;again,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4633757">//&nbsp;and&nbsp;this&nbsp;time&nbsp;include&nbsp;runtime&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633803">printStackRecord</span><span class="op" id="4633819">(</span><span class="ident" id="4633820">w</span><span class="op" id="4633821">,</span>&nbsp;<span class="ident" id="4633823">stk</span><span class="op" id="4633826">,</span>&nbsp;<span class="builtintype" id="4633828">true</span><span class="op" id="4633832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4633836">return</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4633847">fmt</span><span class="op" id="4633850">.</span><span class="ident" id="4633851">Fprintf</span><span class="op" id="4633858">(</span><span class="ident" id="4633859">w</span><span class="op" id="4633860">,</span>&nbsp;<span class="string" id="4633862">&#34;\n&#34;</span><span class="op" id="4633866">)</span><br>
<span class="lineno"></span><span class="op" id="4633868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4633871">//&nbsp;Interface&nbsp;to&nbsp;system&nbsp;profiles.</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="4633905">type</span>&nbsp;<span class="ident" id="4633910">byInUseBytes</span>&nbsp;<span class="op" id="4633923">[</span><span class="op" id="4633924">]</span><span class="ident" id="4633925">runtime</span><span class="op" id="4633932">.</span><span class="ident" id="4633933">MemProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4633951">func</span>&nbsp;<span class="op" id="4633956">(</span><span class="ident" id="4633957">x</span>&nbsp;<span class="ident" id="4633959">byInUseBytes</span><span class="op" id="4633971">)</span>&nbsp;<span class="ident" id="4633973">Len</span><span class="op" id="4633976">(</span><span class="op" id="4633977">)</span>&nbsp;<span class="builtintype" id="4633979">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4633993">{</span>&nbsp;<span class="keyword" id="4633995">return</span>&nbsp;<span class="builtinfunc" id="4634002">len</span><span class="op" id="4634005">(</span><span class="ident" id="4634006">x</span><span class="op" id="4634007">)</span>&nbsp;<span class="op" id="4634009">}</span><br>
<span class="lineno"></span><span class="keyword" id="4634011">func</span>&nbsp;<span class="op" id="4634016">(</span><span class="ident" id="4634017">x</span>&nbsp;<span class="ident" id="4634019">byInUseBytes</span><span class="op" id="4634031">)</span>&nbsp;<span class="ident" id="4634033">Swap</span><span class="op" id="4634037">(</span><span class="ident" id="4634038">i</span><span class="op" id="4634039">,</span>&nbsp;<span class="ident" id="4634041">j</span>&nbsp;<span class="builtintype" id="4634043">int</span><span class="op" id="4634046">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4634053">{</span>&nbsp;<span class="ident" id="4634055">x</span><span class="op" id="4634056">[</span><span class="ident" id="4634057">i</span><span class="op" id="4634058">]</span><span class="op" id="4634059">,</span>&nbsp;<span class="ident" id="4634061">x</span><span class="op" id="4634062">[</span><span class="ident" id="4634063">j</span><span class="op" id="4634064">]</span>&nbsp;<span class="op" id="4634066">=</span>&nbsp;<span class="ident" id="4634068">x</span><span class="op" id="4634069">[</span><span class="ident" id="4634070">j</span><span class="op" id="4634071">]</span><span class="op" id="4634072">,</span>&nbsp;<span class="ident" id="4634074">x</span><span class="op" id="4634075">[</span><span class="ident" id="4634076">i</span><span class="op" id="4634077">]</span>&nbsp;<span class="op" id="4634079">}</span><br>
<span class="lineno">365</span><span class="keyword" id="4634081">func</span>&nbsp;<span class="op" id="4634086">(</span><span class="ident" id="4634087">x</span>&nbsp;<span class="ident" id="4634089">byInUseBytes</span><span class="op" id="4634101">)</span>&nbsp;<span class="ident" id="4634103">Less</span><span class="op" id="4634107">(</span><span class="ident" id="4634108">i</span><span class="op" id="4634109">,</span>&nbsp;<span class="ident" id="4634111">j</span>&nbsp;<span class="builtintype" id="4634113">int</span><span class="op" id="4634116">)</span>&nbsp;<span class="builtintype" id="4634118">bool</span>&nbsp;<span class="op" id="4634123">{</span>&nbsp;<span class="keyword" id="4634125">return</span>&nbsp;<span class="ident" id="4634132">x</span><span class="op" id="4634133">[</span><span class="ident" id="4634134">i</span><span class="op" id="4634135">]</span><span class="op" id="4634136">.</span><span class="ident" id="4634137">InUseBytes</span><span class="op" id="4634147">(</span><span class="op" id="4634148">)</span>&nbsp;<span class="op" id="4634150">&gt;</span>&nbsp;<span class="ident" id="4634152">x</span><span class="op" id="4634153">[</span><span class="ident" id="4634154">j</span><span class="op" id="4634155">]</span><span class="op" id="4634156">.</span><span class="ident" id="4634157">InUseBytes</span><span class="op" id="4634167">(</span><span class="op" id="4634168">)</span>&nbsp;<span class="op" id="4634170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4634173">//&nbsp;WriteHeapProfile&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Lookup(&#34;heap&#34;).WriteTo(w,&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="4634240">//&nbsp;It&nbsp;is&nbsp;preserved&nbsp;for&nbsp;backwards&nbsp;compatibility.</span><br>
<span class="lineno"></span><span class="keyword" id="4634288">func</span>&nbsp;<span class="ident" id="4634293">WriteHeapProfile</span><span class="op" id="4634309">(</span><span class="ident" id="4634310">w</span>&nbsp;<span class="ident" id="4634312">io</span><span class="op" id="4634314">.</span><span class="ident" id="4634315">Writer</span><span class="op" id="4634321">)</span>&nbsp;<span class="builtintype" id="4634323">error</span>&nbsp;<span class="op" id="4634329">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4634332">return</span>&nbsp;<span class="ident" id="4634339">writeHeap</span><span class="op" id="4634348">(</span><span class="ident" id="4634349">w</span><span class="op" id="4634350">,</span>&nbsp;<span class="num" id="4634352">0</span><span class="op" id="4634353">)</span><br>
<span class="lineno"></span><span class="op" id="4634355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4634358">//&nbsp;countHeap&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;heap&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4634422">func</span>&nbsp;<span class="ident" id="4634427">countHeap</span><span class="op" id="4634436">(</span><span class="op" id="4634437">)</span>&nbsp;<span class="builtintype" id="4634439">int</span>&nbsp;<span class="op" id="4634443">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4634446">n</span><span class="op" id="4634447">,</span>&nbsp;<span class="ident" id="4634449">_</span>&nbsp;<span class="op" id="4634451">:=</span>&nbsp;<span class="ident" id="4634454">runtime</span><span class="op" id="4634461">.</span><span class="ident" id="4634462">MemProfile</span><span class="op" id="4634472">(</span><span class="builtintype" id="4634473">nil</span><span class="op" id="4634476">,</span>&nbsp;<span class="builtintype" id="4634478">true</span><span class="op" id="4634482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4634485">return</span>&nbsp;<span class="ident" id="4634492">n</span><br>
<span class="lineno"></span><span class="op" id="4634494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4634497">//&nbsp;writeHeap&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;heap&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno">380</span><span class="keyword" id="4634556">func</span>&nbsp;<span class="ident" id="4634561">writeHeap</span><span class="op" id="4634570">(</span><span class="ident" id="4634571">w</span>&nbsp;<span class="ident" id="4634573">io</span><span class="op" id="4634575">.</span><span class="ident" id="4634576">Writer</span><span class="op" id="4634582">,</span>&nbsp;<span class="ident" id="4634584">debug</span>&nbsp;<span class="builtintype" id="4634590">int</span><span class="op" id="4634593">)</span>&nbsp;<span class="builtintype" id="4634595">error</span>&nbsp;<span class="op" id="4634601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4634604">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(MemProfile(nil,&nbsp;true)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4634669">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4634719">//&nbsp;There&#39;s&nbsp;a&nbsp;racemore&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4634776">//&nbsp;the&nbsp;two&nbsp;callsso&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4634839">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4634885">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4634952">var</span>&nbsp;<span class="ident" id="4634956">p</span>&nbsp;<span class="op" id="4634958">[</span><span class="op" id="4634959">]</span><span class="ident" id="4634960">runtime</span><span class="op" id="4634967">.</span><span class="ident" id="4634968">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4634986">n</span><span class="op" id="4634987">,</span>&nbsp;<span class="ident" id="4634989">ok</span>&nbsp;<span class="op" id="4634992">:=</span>&nbsp;<span class="ident" id="4634995">runtime</span><span class="op" id="4635002">.</span><span class="ident" id="4635003">MemProfile</span><span class="op" id="4635013">(</span><span class="builtintype" id="4635014">nil</span><span class="op" id="4635017">,</span>&nbsp;<span class="builtintype" id="4635019">true</span><span class="op" id="4635023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4635026">for</span>&nbsp;<span class="op" id="4635030">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4635034">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4635084">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4635132">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;MemProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635167">p</span>&nbsp;<span class="op" id="4635169">=</span>&nbsp;<span class="builtinfunc" id="4635171">make</span><span class="op" id="4635175">(</span><span class="op" id="4635176">[</span><span class="op" id="4635177">]</span><span class="ident" id="4635178">runtime</span><span class="op" id="4635185">.</span><span class="ident" id="4635186">MemProfileRecord</span><span class="op" id="4635202">,</span>&nbsp;<span class="ident" id="4635204">n</span><span class="op" id="4635205">+</span><span class="num" id="4635206">50</span><span class="op" id="4635208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635212">n</span><span class="op" id="4635213">,</span>&nbsp;<span class="ident" id="4635215">ok</span>&nbsp;<span class="op" id="4635218">=</span>&nbsp;<span class="ident" id="4635220">runtime</span><span class="op" id="4635227">.</span><span class="ident" id="4635228">MemProfile</span><span class="op" id="4635238">(</span><span class="ident" id="4635239">p</span><span class="op" id="4635240">,</span>&nbsp;<span class="builtintype" id="4635242">true</span><span class="op" id="4635246">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4635250">if</span>&nbsp;<span class="ident" id="4635253">ok</span>&nbsp;<span class="op" id="4635256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635261">p</span>&nbsp;<span class="op" id="4635263">=</span>&nbsp;<span class="ident" id="4635265">p</span><span class="op" id="4635266">[</span><span class="num" id="4635267">0</span><span class="op" id="4635268">:</span><span class="ident" id="4635269">n</span><span class="op" id="4635270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4635275">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4635283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4635287">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4635316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635320">sort</span><span class="op" id="4635324">.</span><span class="ident" id="4635325">Sort</span><span class="op" id="4635329">(</span><span class="ident" id="4635330">byInUseBytes</span><span class="op" id="4635342">(</span><span class="ident" id="4635343">p</span><span class="op" id="4635344">)</span><span class="op" id="4635345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635349">b</span>&nbsp;<span class="op" id="4635351">:=</span>&nbsp;<span class="ident" id="4635354">bufio</span><span class="op" id="4635359">.</span><span class="ident" id="4635360">NewWriter</span><span class="op" id="4635369">(</span><span class="ident" id="4635370">w</span><span class="op" id="4635371">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4635374">var</span>&nbsp;<span class="ident" id="4635378">tw</span>&nbsp;<span class="op" id="4635381">*</span><span class="ident" id="4635382">tabwriter</span><span class="op" id="4635391">.</span><span class="ident" id="4635392">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635400">w</span>&nbsp;<span class="op" id="4635402">=</span>&nbsp;<span class="ident" id="4635404">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4635407">if</span>&nbsp;<span class="ident" id="4635410">debug</span>&nbsp;<span class="op" id="4635416">&gt;</span>&nbsp;<span class="num" id="4635418">0</span>&nbsp;<span class="op" id="4635420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635424">tw</span>&nbsp;<span class="op" id="4635427">=</span>&nbsp;<span class="ident" id="4635429">tabwriter</span><span class="op" id="4635438">.</span><span class="ident" id="4635439">NewWriter</span><span class="op" id="4635448">(</span><span class="ident" id="4635449">w</span><span class="op" id="4635450">,</span>&nbsp;<span class="num" id="4635452">1</span><span class="op" id="4635453">,</span>&nbsp;<span class="num" id="4635455">8</span><span class="op" id="4635456">,</span>&nbsp;<span class="num" id="4635458">1</span><span class="op" id="4635459">,</span>&nbsp;<span class="string" id="4635461">&#39;\t&#39;</span><span class="op" id="4635465">,</span>&nbsp;<span class="num" id="4635467">0</span><span class="op" id="4635468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635472">w</span>&nbsp;<span class="op" id="4635474">=</span>&nbsp;<span class="ident" id="4635476">tw</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4635480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4635484">var</span>&nbsp;<span class="ident" id="4635488">total</span>&nbsp;<span class="ident" id="4635494">runtime</span><span class="op" id="4635501">.</span><span class="ident" id="4635502">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4635520">for</span>&nbsp;<span class="ident" id="4635524">i</span>&nbsp;<span class="op" id="4635526">:=</span>&nbsp;<span class="keyword" id="4635529">range</span>&nbsp;<span class="ident" id="4635535">p</span>&nbsp;<span class="op" id="4635537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635541">r</span>&nbsp;<span class="op" id="4635543">:=</span>&nbsp;<span class="op" id="4635546">&amp;</span><span class="ident" id="4635547">p</span><span class="op" id="4635548">[</span><span class="ident" id="4635549">i</span><span class="op" id="4635550">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635554">total</span><span class="op" id="4635559">.</span><span class="ident" id="4635560">AllocBytes</span>&nbsp;<span class="op" id="4635571">+=</span>&nbsp;<span class="ident" id="4635574">r</span><span class="op" id="4635575">.</span><span class="ident" id="4635576">AllocBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635589">total</span><span class="op" id="4635594">.</span><span class="ident" id="4635595">AllocObjects</span>&nbsp;<span class="op" id="4635608">+=</span>&nbsp;<span class="ident" id="4635611">r</span><span class="op" id="4635612">.</span><span class="ident" id="4635613">AllocObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635628">total</span><span class="op" id="4635633">.</span><span class="ident" id="4635634">FreeBytes</span>&nbsp;<span class="op" id="4635644">+=</span>&nbsp;<span class="ident" id="4635647">r</span><span class="op" id="4635648">.</span><span class="ident" id="4635649">FreeBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635661">total</span><span class="op" id="4635666">.</span><span class="ident" id="4635667">FreeObjects</span>&nbsp;<span class="op" id="4635679">+=</span>&nbsp;<span class="ident" id="4635682">r</span><span class="op" id="4635683">.</span><span class="ident" id="4635684">FreeObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4635697">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4635701">//&nbsp;Technically&nbsp;the&nbsp;rate&nbsp;is&nbsp;MemProfileRate&nbsp;not&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4635766">//&nbsp;but&nbsp;early&nbsp;versions&nbsp;of&nbsp;the&nbsp;C++&nbsp;heap&nbsp;profiler&nbsp;reported&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4635841">//&nbsp;so&nbsp;that&#39;s&nbsp;what&nbsp;pprof&nbsp;has&nbsp;come&nbsp;to&nbsp;expect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635886">fmt</span><span class="op" id="4635889">.</span><span class="ident" id="4635890">Fprintf</span><span class="op" id="4635897">(</span><span class="ident" id="4635898">w</span><span class="op" id="4635899">,</span>&nbsp;<span class="string" id="4635901">&#34;heap&nbsp;profile:&nbsp;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&nbsp;heap/%d\n&#34;</span><span class="op" id="4635944">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635948">total</span><span class="op" id="4635953">.</span><span class="ident" id="4635954">InUseObjects</span><span class="op" id="4635966">(</span><span class="op" id="4635967">)</span><span class="op" id="4635968">,</span>&nbsp;<span class="ident" id="4635970">total</span><span class="op" id="4635975">.</span><span class="ident" id="4635976">InUseBytes</span><span class="op" id="4635986">(</span><span class="op" id="4635987">)</span><span class="op" id="4635988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635992">total</span><span class="op" id="4635997">.</span><span class="ident" id="4635998">AllocObjects</span><span class="op" id="4636010">,</span>&nbsp;<span class="ident" id="4636012">total</span><span class="op" id="4636017">.</span><span class="ident" id="4636018">AllocBytes</span><span class="op" id="4636028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4636032">2</span><span class="op" id="4636033">*</span><span class="ident" id="4636034">runtime</span><span class="op" id="4636041">.</span><span class="ident" id="4636042">MemProfileRate</span><span class="op" id="4636056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4636060">for</span>&nbsp;<span class="ident" id="4636064">i</span>&nbsp;<span class="op" id="4636066">:=</span>&nbsp;<span class="keyword" id="4636069">range</span>&nbsp;<span class="ident" id="4636075">p</span>&nbsp;<span class="op" id="4636077">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636081">r</span>&nbsp;<span class="op" id="4636083">:=</span>&nbsp;<span class="op" id="4636086">&amp;</span><span class="ident" id="4636087">p</span><span class="op" id="4636088">[</span><span class="ident" id="4636089">i</span><span class="op" id="4636090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636094">fmt</span><span class="op" id="4636097">.</span><span class="ident" id="4636098">Fprintf</span><span class="op" id="4636105">(</span><span class="ident" id="4636106">w</span><span class="op" id="4636107">,</span>&nbsp;<span class="string" id="4636109">&#34;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&#34;</span><span class="op" id="4636128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636133">r</span><span class="op" id="4636134">.</span><span class="ident" id="4636135">InUseObjects</span><span class="op" id="4636147">(</span><span class="op" id="4636148">)</span><span class="op" id="4636149">,</span>&nbsp;<span class="ident" id="4636151">r</span><span class="op" id="4636152">.</span><span class="ident" id="4636153">InUseBytes</span><span class="op" id="4636163">(</span><span class="op" id="4636164">)</span><span class="op" id="4636165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636170">r</span><span class="op" id="4636171">.</span><span class="ident" id="4636172">AllocObjects</span><span class="op" id="4636184">,</span>&nbsp;<span class="ident" id="4636186">r</span><span class="op" id="4636187">.</span><span class="ident" id="4636188">AllocBytes</span><span class="op" id="4636198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4636202">for</span>&nbsp;<span class="ident" id="4636206">_</span><span class="op" id="4636207">,</span>&nbsp;<span class="ident" id="4636209">pc</span>&nbsp;<span class="op" id="4636212">:=</span>&nbsp;<span class="keyword" id="4636215">range</span>&nbsp;<span class="ident" id="4636221">r</span><span class="op" id="4636222">.</span><span class="ident" id="4636223">Stack</span><span class="op" id="4636228">(</span><span class="op" id="4636229">)</span>&nbsp;<span class="op" id="4636231">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636236">fmt</span><span class="op" id="4636239">.</span><span class="ident" id="4636240">Fprintf</span><span class="op" id="4636247">(</span><span class="ident" id="4636248">w</span><span class="op" id="4636249">,</span>&nbsp;<span class="string" id="4636251">&#34;&nbsp;%#x&#34;</span><span class="op" id="4636257">,</span>&nbsp;<span class="ident" id="4636259">pc</span><span class="op" id="4636261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4636265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636269">fmt</span><span class="op" id="4636272">.</span><span class="ident" id="4636273">Fprintf</span><span class="op" id="4636280">(</span><span class="ident" id="4636281">w</span><span class="op" id="4636282">,</span>&nbsp;<span class="string" id="4636284">&#34;\n&#34;</span><span class="op" id="4636288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4636292">if</span>&nbsp;<span class="ident" id="4636295">debug</span>&nbsp;<span class="op" id="4636301">&gt;</span>&nbsp;<span class="num" id="4636303">0</span>&nbsp;<span class="op" id="4636305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636310">printStackRecord</span><span class="op" id="4636326">(</span><span class="ident" id="4636327">w</span><span class="op" id="4636328">,</span>&nbsp;<span class="ident" id="4636330">r</span><span class="op" id="4636331">.</span><span class="ident" id="4636332">Stack</span><span class="op" id="4636337">(</span><span class="op" id="4636338">)</span><span class="op" id="4636339">,</span>&nbsp;<span class="builtintype" id="4636341">false</span><span class="op" id="4636346">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4636350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4636353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4636357">//&nbsp;Print&nbsp;memstats&nbsp;information&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4636393">//&nbsp;Pprof&nbsp;will&nbsp;ignore,&nbsp;but&nbsp;useful&nbsp;for&nbsp;people</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4636438">if</span>&nbsp;<span class="ident" id="4636441">debug</span>&nbsp;<span class="op" id="4636447">&gt;</span>&nbsp;<span class="num" id="4636449">0</span>&nbsp;<span class="op" id="4636451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636455">s</span>&nbsp;<span class="op" id="4636457">:=</span>&nbsp;<span class="builtinfunc" id="4636460">new</span><span class="op" id="4636463">(</span><span class="ident" id="4636464">runtime</span><span class="op" id="4636471">.</span><span class="ident" id="4636472">MemStats</span><span class="op" id="4636480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636484">runtime</span><span class="op" id="4636491">.</span><span class="ident" id="4636492">ReadMemStats</span><span class="op" id="4636504">(</span><span class="ident" id="4636505">s</span><span class="op" id="4636506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636510">fmt</span><span class="op" id="4636513">.</span><span class="ident" id="4636514">Fprintf</span><span class="op" id="4636521">(</span><span class="ident" id="4636522">w</span><span class="op" id="4636523">,</span>&nbsp;<span class="string" id="4636525">&#34;\n#&nbsp;runtime.MemStats\n&#34;</span><span class="op" id="4636549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636553">fmt</span><span class="op" id="4636556">.</span><span class="ident" id="4636557">Fprintf</span><span class="op" id="4636564">(</span><span class="ident" id="4636565">w</span><span class="op" id="4636566">,</span>&nbsp;<span class="string" id="4636568">&#34;#&nbsp;Alloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636584">,</span>&nbsp;<span class="ident" id="4636586">s</span><span class="op" id="4636587">.</span><span class="ident" id="4636588">Alloc</span><span class="op" id="4636593">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636597">fmt</span><span class="op" id="4636600">.</span><span class="ident" id="4636601">Fprintf</span><span class="op" id="4636608">(</span><span class="ident" id="4636609">w</span><span class="op" id="4636610">,</span>&nbsp;<span class="string" id="4636612">&#34;#&nbsp;TotalAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636633">,</span>&nbsp;<span class="ident" id="4636635">s</span><span class="op" id="4636636">.</span><span class="ident" id="4636637">TotalAlloc</span><span class="op" id="4636647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636651">fmt</span><span class="op" id="4636654">.</span><span class="ident" id="4636655">Fprintf</span><span class="op" id="4636662">(</span><span class="ident" id="4636663">w</span><span class="op" id="4636664">,</span>&nbsp;<span class="string" id="4636666">&#34;#&nbsp;Sys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636680">,</span>&nbsp;<span class="ident" id="4636682">s</span><span class="op" id="4636683">.</span><span class="ident" id="4636684">Sys</span><span class="op" id="4636687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636691">fmt</span><span class="op" id="4636694">.</span><span class="ident" id="4636695">Fprintf</span><span class="op" id="4636702">(</span><span class="ident" id="4636703">w</span><span class="op" id="4636704">,</span>&nbsp;<span class="string" id="4636706">&#34;#&nbsp;Lookups&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636724">,</span>&nbsp;<span class="ident" id="4636726">s</span><span class="op" id="4636727">.</span><span class="ident" id="4636728">Lookups</span><span class="op" id="4636735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636739">fmt</span><span class="op" id="4636742">.</span><span class="ident" id="4636743">Fprintf</span><span class="op" id="4636750">(</span><span class="ident" id="4636751">w</span><span class="op" id="4636752">,</span>&nbsp;<span class="string" id="4636754">&#34;#&nbsp;Mallocs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636772">,</span>&nbsp;<span class="ident" id="4636774">s</span><span class="op" id="4636775">.</span><span class="ident" id="4636776">Mallocs</span><span class="op" id="4636783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636787">fmt</span><span class="op" id="4636790">.</span><span class="ident" id="4636791">Fprintf</span><span class="op" id="4636798">(</span><span class="ident" id="4636799">w</span><span class="op" id="4636800">,</span>&nbsp;<span class="string" id="4636802">&#34;#&nbsp;Frees&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636818">,</span>&nbsp;<span class="ident" id="4636820">s</span><span class="op" id="4636821">.</span><span class="ident" id="4636822">Frees</span><span class="op" id="4636827">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636832">fmt</span><span class="op" id="4636835">.</span><span class="ident" id="4636836">Fprintf</span><span class="op" id="4636843">(</span><span class="ident" id="4636844">w</span><span class="op" id="4636845">,</span>&nbsp;<span class="string" id="4636847">&#34;#&nbsp;HeapAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636867">,</span>&nbsp;<span class="ident" id="4636869">s</span><span class="op" id="4636870">.</span><span class="ident" id="4636871">HeapAlloc</span><span class="op" id="4636880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636884">fmt</span><span class="op" id="4636887">.</span><span class="ident" id="4636888">Fprintf</span><span class="op" id="4636895">(</span><span class="ident" id="4636896">w</span><span class="op" id="4636897">,</span>&nbsp;<span class="string" id="4636899">&#34;#&nbsp;HeapSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636917">,</span>&nbsp;<span class="ident" id="4636919">s</span><span class="op" id="4636920">.</span><span class="ident" id="4636921">HeapSys</span><span class="op" id="4636928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636932">fmt</span><span class="op" id="4636935">.</span><span class="ident" id="4636936">Fprintf</span><span class="op" id="4636943">(</span><span class="ident" id="4636944">w</span><span class="op" id="4636945">,</span>&nbsp;<span class="string" id="4636947">&#34;#&nbsp;HeapIdle&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4636966">,</span>&nbsp;<span class="ident" id="4636968">s</span><span class="op" id="4636969">.</span><span class="ident" id="4636970">HeapIdle</span><span class="op" id="4636978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4636982">fmt</span><span class="op" id="4636985">.</span><span class="ident" id="4636986">Fprintf</span><span class="op" id="4636993">(</span><span class="ident" id="4636994">w</span><span class="op" id="4636995">,</span>&nbsp;<span class="string" id="4636997">&#34;#&nbsp;HeapInuse&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4637017">,</span>&nbsp;<span class="ident" id="4637019">s</span><span class="op" id="4637020">.</span><span class="ident" id="4637021">HeapInuse</span><span class="op" id="4637030">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637034">fmt</span><span class="op" id="4637037">.</span><span class="ident" id="4637038">Fprintf</span><span class="op" id="4637045">(</span><span class="ident" id="4637046">w</span><span class="op" id="4637047">,</span>&nbsp;<span class="string" id="4637049">&#34;#&nbsp;HeapReleased&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4637072">,</span>&nbsp;<span class="ident" id="4637074">s</span><span class="op" id="4637075">.</span><span class="ident" id="4637076">HeapReleased</span><span class="op" id="4637088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637092">fmt</span><span class="op" id="4637095">.</span><span class="ident" id="4637096">Fprintf</span><span class="op" id="4637103">(</span><span class="ident" id="4637104">w</span><span class="op" id="4637105">,</span>&nbsp;<span class="string" id="4637107">&#34;#&nbsp;HeapObjects&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4637129">,</span>&nbsp;<span class="ident" id="4637131">s</span><span class="op" id="4637132">.</span><span class="ident" id="4637133">HeapObjects</span><span class="op" id="4637144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637149">fmt</span><span class="op" id="4637152">.</span><span class="ident" id="4637153">Fprintf</span><span class="op" id="4637160">(</span><span class="ident" id="4637161">w</span><span class="op" id="4637162">,</span>&nbsp;<span class="string" id="4637164">&#34;#&nbsp;Stack&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4637185">,</span>&nbsp;<span class="ident" id="4637187">s</span><span class="op" id="4637188">.</span><span class="ident" id="4637189">StackInuse</span><span class="op" id="4637199">,</span>&nbsp;<span class="ident" id="4637201">s</span><span class="op" id="4637202">.</span><span class="ident" id="4637203">StackSys</span><span class="op" id="4637211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637215">fmt</span><span class="op" id="4637218">.</span><span class="ident" id="4637219">Fprintf</span><span class="op" id="4637226">(</span><span class="ident" id="4637227">w</span><span class="op" id="4637228">,</span>&nbsp;<span class="string" id="4637230">&#34;#&nbsp;MSpan&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4637251">,</span>&nbsp;<span class="ident" id="4637253">s</span><span class="op" id="4637254">.</span><span class="ident" id="4637255">MSpanInuse</span><span class="op" id="4637265">,</span>&nbsp;<span class="ident" id="4637267">s</span><span class="op" id="4637268">.</span><span class="ident" id="4637269">MSpanSys</span><span class="op" id="4637277">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637281">fmt</span><span class="op" id="4637284">.</span><span class="ident" id="4637285">Fprintf</span><span class="op" id="4637292">(</span><span class="ident" id="4637293">w</span><span class="op" id="4637294">,</span>&nbsp;<span class="string" id="4637296">&#34;#&nbsp;MCache&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4637318">,</span>&nbsp;<span class="ident" id="4637320">s</span><span class="op" id="4637321">.</span><span class="ident" id="4637322">MCacheInuse</span><span class="op" id="4637333">,</span>&nbsp;<span class="ident" id="4637335">s</span><span class="op" id="4637336">.</span><span class="ident" id="4637337">MCacheSys</span><span class="op" id="4637346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637350">fmt</span><span class="op" id="4637353">.</span><span class="ident" id="4637354">Fprintf</span><span class="op" id="4637361">(</span><span class="ident" id="4637362">w</span><span class="op" id="4637363">,</span>&nbsp;<span class="string" id="4637365">&#34;#&nbsp;BuckHashSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4637387">,</span>&nbsp;<span class="ident" id="4637389">s</span><span class="op" id="4637390">.</span><span class="ident" id="4637391">BuckHashSys</span><span class="op" id="4637402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637407">fmt</span><span class="op" id="4637410">.</span><span class="ident" id="4637411">Fprintf</span><span class="op" id="4637418">(</span><span class="ident" id="4637419">w</span><span class="op" id="4637420">,</span>&nbsp;<span class="string" id="4637422">&#34;#&nbsp;NextGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4637439">,</span>&nbsp;<span class="ident" id="4637441">s</span><span class="op" id="4637442">.</span><span class="ident" id="4637443">NextGC</span><span class="op" id="4637449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637453">fmt</span><span class="op" id="4637456">.</span><span class="ident" id="4637457">Fprintf</span><span class="op" id="4637464">(</span><span class="ident" id="4637465">w</span><span class="op" id="4637466">,</span>&nbsp;<span class="string" id="4637468">&#34;#&nbsp;PauseNs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4637486">,</span>&nbsp;<span class="ident" id="4637488">s</span><span class="op" id="4637489">.</span><span class="ident" id="4637490">PauseNs</span><span class="op" id="4637497">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637501">fmt</span><span class="op" id="4637504">.</span><span class="ident" id="4637505">Fprintf</span><span class="op" id="4637512">(</span><span class="ident" id="4637513">w</span><span class="op" id="4637514">,</span>&nbsp;<span class="string" id="4637516">&#34;#&nbsp;NumGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4637532">,</span>&nbsp;<span class="ident" id="4637534">s</span><span class="op" id="4637535">.</span><span class="ident" id="4637536">NumGC</span><span class="op" id="4637541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637545">fmt</span><span class="op" id="4637548">.</span><span class="ident" id="4637549">Fprintf</span><span class="op" id="4637556">(</span><span class="ident" id="4637557">w</span><span class="op" id="4637558">,</span>&nbsp;<span class="string" id="4637560">&#34;#&nbsp;EnableGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4637579">,</span>&nbsp;<span class="ident" id="4637581">s</span><span class="op" id="4637582">.</span><span class="ident" id="4637583">EnableGC</span><span class="op" id="4637591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637595">fmt</span><span class="op" id="4637598">.</span><span class="ident" id="4637599">Fprintf</span><span class="op" id="4637606">(</span><span class="ident" id="4637607">w</span><span class="op" id="4637608">,</span>&nbsp;<span class="string" id="4637610">&#34;#&nbsp;DebugGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4637628">,</span>&nbsp;<span class="ident" id="4637630">s</span><span class="op" id="4637631">.</span><span class="ident" id="4637632">DebugGC</span><span class="op" id="4637639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4637642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4637646">if</span>&nbsp;<span class="ident" id="4637649">tw</span>&nbsp;<span class="op" id="4637652">!=</span>&nbsp;<span class="builtintype" id="4637655">nil</span>&nbsp;<span class="op" id="4637659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637663">tw</span><span class="op" id="4637665">.</span><span class="ident" id="4637666">Flush</span><span class="op" id="4637671">(</span><span class="op" id="4637672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4637675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4637678">return</span>&nbsp;<span class="ident" id="4637685">b</span><span class="op" id="4637686">.</span><span class="ident" id="4637687">Flush</span><span class="op" id="4637692">(</span><span class="op" id="4637693">)</span><br>
<span class="lineno"></span><span class="op" id="4637695">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4637698">//&nbsp;countThreadCreate&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;current&nbsp;ThreadCreateProfile.</span><br>
<span class="lineno"></span><span class="keyword" id="4637772">func</span>&nbsp;<span class="ident" id="4637777">countThreadCreate</span><span class="op" id="4637794">(</span><span class="op" id="4637795">)</span>&nbsp;<span class="builtintype" id="4637797">int</span>&nbsp;<span class="op" id="4637801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4637804">n</span><span class="op" id="4637805">,</span>&nbsp;<span class="ident" id="4637807">_</span>&nbsp;<span class="op" id="4637809">:=</span>&nbsp;<span class="ident" id="4637812">runtime</span><span class="op" id="4637819">.</span><span class="ident" id="4637820">ThreadCreateProfile</span><span class="op" id="4637839">(</span><span class="builtintype" id="4637840">nil</span><span class="op" id="4637843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4637846">return</span>&nbsp;<span class="ident" id="4637853">n</span><br>
<span class="lineno">485</span><span class="op" id="4637855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4637858">//&nbsp;writeThreadCreate&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;ThreadCreateProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4637932">func</span>&nbsp;<span class="ident" id="4637937">writeThreadCreate</span><span class="op" id="4637954">(</span><span class="ident" id="4637955">w</span>&nbsp;<span class="ident" id="4637957">io</span><span class="op" id="4637959">.</span><span class="ident" id="4637960">Writer</span><span class="op" id="4637966">,</span>&nbsp;<span class="ident" id="4637968">debug</span>&nbsp;<span class="builtintype" id="4637974">int</span><span class="op" id="4637977">)</span>&nbsp;<span class="builtintype" id="4637979">error</span>&nbsp;<span class="op" id="4637985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4637988">return</span>&nbsp;<span class="ident" id="4637995">writeRuntimeProfile</span><span class="op" id="4638014">(</span><span class="ident" id="4638015">w</span><span class="op" id="4638016">,</span>&nbsp;<span class="ident" id="4638018">debug</span><span class="op" id="4638023">,</span>&nbsp;<span class="string" id="4638025">&#34;threadcreate&#34;</span><span class="op" id="4638039">,</span>&nbsp;<span class="ident" id="4638041">runtime</span><span class="op" id="4638048">.</span><span class="ident" id="4638049">ThreadCreateProfile</span><span class="op" id="4638068">)</span><br>
<span class="lineno">490</span><span class="op" id="4638070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4638073">//&nbsp;countGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4638125">func</span>&nbsp;<span class="ident" id="4638130">countGoroutine</span><span class="op" id="4638144">(</span><span class="op" id="4638145">)</span>&nbsp;<span class="builtintype" id="4638147">int</span>&nbsp;<span class="op" id="4638151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638154">return</span>&nbsp;<span class="ident" id="4638161">runtime</span><span class="op" id="4638168">.</span><span class="ident" id="4638169">NumGoroutine</span><span class="op" id="4638181">(</span><span class="op" id="4638182">)</span><br>
<span class="lineno">495</span><span class="op" id="4638184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4638187">//&nbsp;writeGoroutine&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;GoroutineProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4638255">func</span>&nbsp;<span class="ident" id="4638260">writeGoroutine</span><span class="op" id="4638274">(</span><span class="ident" id="4638275">w</span>&nbsp;<span class="ident" id="4638277">io</span><span class="op" id="4638279">.</span><span class="ident" id="4638280">Writer</span><span class="op" id="4638286">,</span>&nbsp;<span class="ident" id="4638288">debug</span>&nbsp;<span class="builtintype" id="4638294">int</span><span class="op" id="4638297">)</span>&nbsp;<span class="builtintype" id="4638299">error</span>&nbsp;<span class="op" id="4638305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638308">if</span>&nbsp;<span class="ident" id="4638311">debug</span>&nbsp;<span class="op" id="4638317">&gt;=</span>&nbsp;<span class="num" id="4638320">2</span>&nbsp;<span class="op" id="4638322">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638326">return</span>&nbsp;<span class="ident" id="4638333">writeGoroutineStacks</span><span class="op" id="4638353">(</span><span class="ident" id="4638354">w</span><span class="op" id="4638355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4638358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638361">return</span>&nbsp;<span class="ident" id="4638368">writeRuntimeProfile</span><span class="op" id="4638387">(</span><span class="ident" id="4638388">w</span><span class="op" id="4638389">,</span>&nbsp;<span class="ident" id="4638391">debug</span><span class="op" id="4638396">,</span>&nbsp;<span class="string" id="4638398">&#34;goroutine&#34;</span><span class="op" id="4638409">,</span>&nbsp;<span class="ident" id="4638411">runtime</span><span class="op" id="4638418">.</span><span class="ident" id="4638419">GoroutineProfile</span><span class="op" id="4638435">)</span><br>
<span class="lineno"></span><span class="op" id="4638437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="4638440">func</span>&nbsp;<span class="ident" id="4638445">writeGoroutineStacks</span><span class="op" id="4638465">(</span><span class="ident" id="4638466">w</span>&nbsp;<span class="ident" id="4638468">io</span><span class="op" id="4638470">.</span><span class="ident" id="4638471">Writer</span><span class="op" id="4638477">)</span>&nbsp;<span class="builtintype" id="4638479">error</span>&nbsp;<span class="op" id="4638485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4638488">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;big&nbsp;the&nbsp;buffer&nbsp;needs&nbsp;to&nbsp;be&nbsp;to&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4638548">//&nbsp;all&nbsp;the&nbsp;goroutines.&nbsp;&nbsp;Start&nbsp;with&nbsp;1&nbsp;MB&nbsp;and&nbsp;try&nbsp;a&nbsp;few&nbsp;times,&nbsp;doubling&nbsp;each&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4638630">//&nbsp;Give&nbsp;up&nbsp;and&nbsp;use&nbsp;a&nbsp;truncated&nbsp;trace&nbsp;if&nbsp;64&nbsp;MB&nbsp;is&nbsp;not&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4638692">buf</span>&nbsp;<span class="op" id="4638696">:=</span>&nbsp;<span class="builtinfunc" id="4638699">make</span><span class="op" id="4638703">(</span><span class="op" id="4638704">[</span><span class="op" id="4638705">]</span><span class="builtintype" id="4638706">byte</span><span class="op" id="4638710">,</span>&nbsp;<span class="num" id="4638712">1</span><span class="op" id="4638713">&lt;&lt;</span><span class="num" id="4638715">20</span><span class="op" id="4638717">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638720">for</span>&nbsp;<span class="ident" id="4638724">i</span>&nbsp;<span class="op" id="4638726">:=</span>&nbsp;<span class="num" id="4638729">0</span><span class="op" id="4638730">;</span>&nbsp;<span class="op" id="4638732">;</span>&nbsp;<span class="ident" id="4638734">i</span><span class="op" id="4638735">++</span>&nbsp;<span class="op" id="4638738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4638742">n</span>&nbsp;<span class="op" id="4638744">:=</span>&nbsp;<span class="ident" id="4638747">runtime</span><span class="op" id="4638754">.</span><span class="ident" id="4638755">Stack</span><span class="op" id="4638760">(</span><span class="ident" id="4638761">buf</span><span class="op" id="4638764">,</span>&nbsp;<span class="builtintype" id="4638766">true</span><span class="op" id="4638770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638774">if</span>&nbsp;<span class="ident" id="4638777">n</span>&nbsp;<span class="op" id="4638779">&lt;</span>&nbsp;<span class="builtinfunc" id="4638781">len</span><span class="op" id="4638784">(</span><span class="ident" id="4638785">buf</span><span class="op" id="4638788">)</span>&nbsp;<span class="op" id="4638790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4638795">buf</span>&nbsp;<span class="op" id="4638799">=</span>&nbsp;<span class="ident" id="4638801">buf</span><span class="op" id="4638804">[</span><span class="op" id="4638805">:</span><span class="ident" id="4638806">n</span><span class="op" id="4638807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638812">break</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4638820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638824">if</span>&nbsp;<span class="builtinfunc" id="4638827">len</span><span class="op" id="4638830">(</span><span class="ident" id="4638831">buf</span><span class="op" id="4638834">)</span>&nbsp;<span class="op" id="4638836">&gt;=</span>&nbsp;<span class="num" id="4638839">64</span><span class="op" id="4638841">&lt;&lt;</span><span class="num" id="4638843">20</span>&nbsp;<span class="op" id="4638846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4638851">//&nbsp;Filled&nbsp;64&nbsp;MB&nbsp;-&nbsp;stop&nbsp;there.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638884">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4638892">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4638896">buf</span>&nbsp;<span class="op" id="4638900">=</span>&nbsp;<span class="builtinfunc" id="4638902">make</span><span class="op" id="4638906">(</span><span class="op" id="4638907">[</span><span class="op" id="4638908">]</span><span class="builtintype" id="4638909">byte</span><span class="op" id="4638913">,</span>&nbsp;<span class="num" id="4638915">2</span><span class="op" id="4638916">*</span><span class="builtinfunc" id="4638917">len</span><span class="op" id="4638920">(</span><span class="ident" id="4638921">buf</span><span class="op" id="4638924">)</span><span class="op" id="4638925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4638928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4638931">_</span><span class="op" id="4638932">,</span>&nbsp;<span class="ident" id="4638934">err</span>&nbsp;<span class="op" id="4638938">:=</span>&nbsp;<span class="ident" id="4638941">w</span><span class="op" id="4638942">.</span><span class="ident" id="4638943">Write</span><span class="op" id="4638948">(</span><span class="ident" id="4638949">buf</span><span class="op" id="4638952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4638955">return</span>&nbsp;<span class="ident" id="4638962">err</span><br>
<span class="lineno"></span><span class="op" id="4638966">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="keyword" id="4638969">func</span>&nbsp;<span class="ident" id="4638974">writeRuntimeProfile</span><span class="op" id="4638993">(</span><span class="ident" id="4638994">w</span>&nbsp;<span class="ident" id="4638996">io</span><span class="op" id="4638998">.</span><span class="ident" id="4638999">Writer</span><span class="op" id="4639005">,</span>&nbsp;<span class="ident" id="4639007">debug</span>&nbsp;<span class="builtintype" id="4639013">int</span><span class="op" id="4639016">,</span>&nbsp;<span class="ident" id="4639018">name</span>&nbsp;<span class="builtintype" id="4639023">string</span><span class="op" id="4639029">,</span>&nbsp;<span class="ident" id="4639031">fetch</span>&nbsp;<span class="keyword" id="4639037">func</span><span class="op" id="4639041">(</span><span class="op" id="4639042">[</span><span class="op" id="4639043">]</span><span class="ident" id="4639044">runtime</span><span class="op" id="4639051">.</span><span class="ident" id="4639052">StackRecord</span><span class="op" id="4639063">)</span>&nbsp;<span class="op" id="4639065">(</span><span class="builtintype" id="4639066">int</span><span class="op" id="4639069">,</span>&nbsp;<span class="builtintype" id="4639071">bool</span><span class="op" id="4639075">)</span><span class="op" id="4639076">)</span>&nbsp;<span class="builtintype" id="4639078">error</span>&nbsp;<span class="op" id="4639084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639087">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(fetch(nil)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639141">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639191">//&nbsp;There&#39;s&nbsp;a&nbsp;racemore&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639248">//&nbsp;the&nbsp;two&nbsp;callsso&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639311">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639357">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4639424">var</span>&nbsp;<span class="ident" id="4639428">p</span>&nbsp;<span class="op" id="4639430">[</span><span class="op" id="4639431">]</span><span class="ident" id="4639432">runtime</span><span class="op" id="4639439">.</span><span class="ident" id="4639440">StackRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639453">n</span><span class="op" id="4639454">,</span>&nbsp;<span class="ident" id="4639456">ok</span>&nbsp;<span class="op" id="4639459">:=</span>&nbsp;<span class="ident" id="4639462">fetch</span><span class="op" id="4639467">(</span><span class="builtintype" id="4639468">nil</span><span class="op" id="4639471">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4639474">for</span>&nbsp;<span class="op" id="4639478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639482">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639532">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639580">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;ThreadProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639618">p</span>&nbsp;<span class="op" id="4639620">=</span>&nbsp;<span class="builtinfunc" id="4639622">make</span><span class="op" id="4639626">(</span><span class="op" id="4639627">[</span><span class="op" id="4639628">]</span><span class="ident" id="4639629">runtime</span><span class="op" id="4639636">.</span><span class="ident" id="4639637">StackRecord</span><span class="op" id="4639648">,</span>&nbsp;<span class="ident" id="4639650">n</span><span class="op" id="4639651">+</span><span class="num" id="4639652">10</span><span class="op" id="4639654">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639658">n</span><span class="op" id="4639659">,</span>&nbsp;<span class="ident" id="4639661">ok</span>&nbsp;<span class="op" id="4639664">=</span>&nbsp;<span class="ident" id="4639666">fetch</span><span class="op" id="4639671">(</span><span class="ident" id="4639672">p</span><span class="op" id="4639673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4639677">if</span>&nbsp;<span class="ident" id="4639680">ok</span>&nbsp;<span class="op" id="4639683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639688">p</span>&nbsp;<span class="op" id="4639690">=</span>&nbsp;<span class="ident" id="4639692">p</span><span class="op" id="4639693">[</span><span class="num" id="4639694">0</span><span class="op" id="4639695">:</span><span class="ident" id="4639696">n</span><span class="op" id="4639697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4639702">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4639710">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639714">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4639743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4639747">return</span>&nbsp;<span class="ident" id="4639754">printCountProfile</span><span class="op" id="4639771">(</span><span class="ident" id="4639772">w</span><span class="op" id="4639773">,</span>&nbsp;<span class="ident" id="4639775">debug</span><span class="op" id="4639780">,</span>&nbsp;<span class="ident" id="4639782">name</span><span class="op" id="4639786">,</span>&nbsp;<span class="ident" id="4639788">runtimeProfile</span><span class="op" id="4639802">(</span><span class="ident" id="4639803">p</span><span class="op" id="4639804">)</span><span class="op" id="4639805">)</span><br>
<span class="lineno"></span><span class="op" id="4639807">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="4639810">type</span>&nbsp;<span class="ident" id="4639815">runtimeProfile</span>&nbsp;<span class="op" id="4639830">[</span><span class="op" id="4639831">]</span><span class="ident" id="4639832">runtime</span><span class="op" id="4639839">.</span><span class="ident" id="4639840">StackRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4639853">func</span>&nbsp;<span class="op" id="4639858">(</span><span class="ident" id="4639859">p</span>&nbsp;<span class="ident" id="4639861">runtimeProfile</span><span class="op" id="4639875">)</span>&nbsp;<span class="ident" id="4639877">Len</span><span class="op" id="4639880">(</span><span class="op" id="4639881">)</span>&nbsp;<span class="builtintype" id="4639883">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4639900">{</span>&nbsp;<span class="keyword" id="4639902">return</span>&nbsp;<span class="builtinfunc" id="4639909">len</span><span class="op" id="4639912">(</span><span class="ident" id="4639913">p</span><span class="op" id="4639914">)</span>&nbsp;<span class="op" id="4639916">}</span><br>
<span class="lineno"></span><span class="keyword" id="4639918">func</span>&nbsp;<span class="op" id="4639923">(</span><span class="ident" id="4639924">p</span>&nbsp;<span class="ident" id="4639926">runtimeProfile</span><span class="op" id="4639940">)</span>&nbsp;<span class="ident" id="4639942">Stack</span><span class="op" id="4639947">(</span><span class="ident" id="4639948">i</span>&nbsp;<span class="builtintype" id="4639950">int</span><span class="op" id="4639953">)</span>&nbsp;<span class="op" id="4639955">[</span><span class="op" id="4639956">]</span><span class="builtintype" id="4639957">uintptr</span>&nbsp;<span class="op" id="4639965">{</span>&nbsp;<span class="keyword" id="4639967">return</span>&nbsp;<span class="ident" id="4639974">p</span><span class="op" id="4639975">[</span><span class="ident" id="4639976">i</span><span class="op" id="4639977">]</span><span class="op" id="4639978">.</span><span class="ident" id="4639979">Stack</span><span class="op" id="4639984">(</span><span class="op" id="4639985">)</span>&nbsp;<span class="op" id="4639987">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="4639990">var</span>&nbsp;<span class="ident" id="4639994">cpu</span>&nbsp;<span class="keyword" id="4639998">struct</span>&nbsp;<span class="op" id="4640005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4640008">sync</span><span class="op" id="4640012">.</span><span class="ident" id="4640013">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4640020">profiling</span>&nbsp;<span class="builtintype" id="4640030">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4640036">done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4640046">chan</span>&nbsp;<span class="builtintype" id="4640051">bool</span><br>
<span class="lineno">560</span><span class="op" id="4640056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4640059">//&nbsp;StartCPUProfile&nbsp;enables&nbsp;CPU&nbsp;profiling&nbsp;for&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="4640125">//&nbsp;While&nbsp;profiling,&nbsp;the&nbsp;profile&nbsp;will&nbsp;be&nbsp;buffered&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4640192">//&nbsp;StartCPUProfile&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;profiling&nbsp;is&nbsp;already&nbsp;enabled.</span><br>
<span class="lineno">565</span><span class="keyword" id="4640261">func</span>&nbsp;<span class="ident" id="4640266">StartCPUProfile</span><span class="op" id="4640281">(</span><span class="ident" id="4640282">w</span>&nbsp;<span class="ident" id="4640284">io</span><span class="op" id="4640286">.</span><span class="ident" id="4640287">Writer</span><span class="op" id="4640293">)</span>&nbsp;<span class="builtintype" id="4640295">error</span>&nbsp;<span class="op" id="4640301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640304">//&nbsp;The&nbsp;runtime&nbsp;routines&nbsp;allow&nbsp;a&nbsp;variable&nbsp;profiling&nbsp;rate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640362">//&nbsp;but&nbsp;in&nbsp;practice&nbsp;operating&nbsp;systems&nbsp;cannot&nbsp;trigger&nbsp;signals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640423">//&nbsp;at&nbsp;more&nbsp;than&nbsp;about&nbsp;500&nbsp;Hz,&nbsp;and&nbsp;our&nbsp;processing&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640480">//&nbsp;signal&nbsp;is&nbsp;not&nbsp;cheap&nbsp;(mostly&nbsp;getting&nbsp;the&nbsp;stack&nbsp;trace).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640538">//&nbsp;100&nbsp;Hz&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;choice:&nbsp;it&nbsp;is&nbsp;frequent&nbsp;enough&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640598">//&nbsp;produce&nbsp;useful&nbsp;data,&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bog&nbsp;down&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640655">//&nbsp;system,&nbsp;and&nbsp;a&nbsp;nice&nbsp;round&nbsp;number&nbsp;to&nbsp;make&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640710">//&nbsp;convert&nbsp;sample&nbsp;counts&nbsp;to&nbsp;seconds.&nbsp;&nbsp;Instead&nbsp;of&nbsp;requiring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640770">//&nbsp;each&nbsp;client&nbsp;to&nbsp;specify&nbsp;the&nbsp;frequency,&nbsp;we&nbsp;hard&nbsp;code&nbsp;it.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4640829">const</span>&nbsp;<span class="ident" id="4640835">hz</span>&nbsp;<span class="op" id="4640838">=</span>&nbsp;<span class="num" id="4640840">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4640846">cpu</span><span class="op" id="4640849">.</span><span class="ident" id="4640850">Lock</span><span class="op" id="4640854">(</span><span class="op" id="4640855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4640858">defer</span>&nbsp;<span class="ident" id="4640864">cpu</span><span class="op" id="4640867">.</span><span class="ident" id="4640868">Unlock</span><span class="op" id="4640874">(</span><span class="op" id="4640875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4640878">if</span>&nbsp;<span class="ident" id="4640881">cpu</span><span class="op" id="4640884">.</span><span class="ident" id="4640885">done</span>&nbsp;<span class="op" id="4640890">==</span>&nbsp;<span class="builtintype" id="4640893">nil</span>&nbsp;<span class="op" id="4640897">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4640901">cpu</span><span class="op" id="4640904">.</span><span class="ident" id="4640905">done</span>&nbsp;<span class="op" id="4640910">=</span>&nbsp;<span class="builtinfunc" id="4640912">make</span><span class="op" id="4640916">(</span><span class="keyword" id="4640917">chan</span>&nbsp;<span class="builtintype" id="4640922">bool</span><span class="op" id="4640926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4640929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640932">//&nbsp;Double-check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4640950">if</span>&nbsp;<span class="ident" id="4640953">cpu</span><span class="op" id="4640956">.</span><span class="ident" id="4640957">profiling</span>&nbsp;<span class="op" id="4640967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4640971">return</span>&nbsp;<span class="ident" id="4640978">fmt</span><span class="op" id="4640981">.</span><span class="ident" id="4640982">Errorf</span><span class="op" id="4640988">(</span><span class="string" id="4640989">&#34;cpu&nbsp;profiling&nbsp;already&nbsp;in&nbsp;use&#34;</span><span class="op" id="4641019">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4641022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641025">cpu</span><span class="op" id="4641028">.</span><span class="ident" id="4641029">profiling</span>&nbsp;<span class="op" id="4641039">=</span>&nbsp;<span class="builtintype" id="4641041">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641047">runtime</span><span class="op" id="4641054">.</span><span class="ident" id="4641055">SetCPUProfileRate</span><span class="op" id="4641072">(</span><span class="ident" id="4641073">hz</span><span class="op" id="4641075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641078">go</span>&nbsp;<span class="ident" id="4641081">profileWriter</span><span class="op" id="4641094">(</span><span class="ident" id="4641095">w</span><span class="op" id="4641096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641099">return</span>&nbsp;<span class="builtintype" id="4641106">nil</span><br>
<span class="lineno">590</span><span class="op" id="4641110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4641113">func</span>&nbsp;<span class="ident" id="4641118">profileWriter</span><span class="op" id="4641131">(</span><span class="ident" id="4641132">w</span>&nbsp;<span class="ident" id="4641134">io</span><span class="op" id="4641136">.</span><span class="ident" id="4641137">Writer</span><span class="op" id="4641143">)</span>&nbsp;<span class="op" id="4641145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641148">for</span>&nbsp;<span class="op" id="4641152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641156">data</span>&nbsp;<span class="op" id="4641161">:=</span>&nbsp;<span class="ident" id="4641164">runtime</span><span class="op" id="4641171">.</span><span class="ident" id="4641172">CPUProfile</span><span class="op" id="4641182">(</span><span class="op" id="4641183">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641187">if</span>&nbsp;<span class="ident" id="4641190">data</span>&nbsp;<span class="op" id="4641195">==</span>&nbsp;<span class="builtintype" id="4641198">nil</span>&nbsp;<span class="op" id="4641202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641207">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4641215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641219">w</span><span class="op" id="4641220">.</span><span class="ident" id="4641221">Write</span><span class="op" id="4641226">(</span><span class="ident" id="4641227">data</span><span class="op" id="4641231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4641234">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641237">cpu</span><span class="op" id="4641240">.</span><span class="ident" id="4641241">done</span>&nbsp;<span class="op" id="4641246">&lt;-</span>&nbsp;<span class="builtintype" id="4641249">true</span><br>
<span class="lineno"></span><span class="op" id="4641254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641257">//&nbsp;StopCPUProfile&nbsp;stops&nbsp;the&nbsp;current&nbsp;CPU&nbsp;profile,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4641314">//&nbsp;StopCPUProfile&nbsp;only&nbsp;returns&nbsp;after&nbsp;all&nbsp;the&nbsp;writes&nbsp;for&nbsp;the</span><br>
<span class="lineno">605</span><span class="comment" id="4641374">//&nbsp;profile&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="4641401">func</span>&nbsp;<span class="ident" id="4641406">StopCPUProfile</span><span class="op" id="4641420">(</span><span class="op" id="4641421">)</span>&nbsp;<span class="op" id="4641423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641426">cpu</span><span class="op" id="4641429">.</span><span class="ident" id="4641430">Lock</span><span class="op" id="4641434">(</span><span class="op" id="4641435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641438">defer</span>&nbsp;<span class="ident" id="4641444">cpu</span><span class="op" id="4641447">.</span><span class="ident" id="4641448">Unlock</span><span class="op" id="4641454">(</span><span class="op" id="4641455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641459">if</span>&nbsp;<span class="op" id="4641462">!</span><span class="ident" id="4641463">cpu</span><span class="op" id="4641466">.</span><span class="ident" id="4641467">profiling</span>&nbsp;<span class="op" id="4641477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641481">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4641489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641492">cpu</span><span class="op" id="4641495">.</span><span class="ident" id="4641496">profiling</span>&nbsp;<span class="op" id="4641506">=</span>&nbsp;<span class="builtintype" id="4641508">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641515">runtime</span><span class="op" id="4641522">.</span><span class="ident" id="4641523">SetCPUProfileRate</span><span class="op" id="4641540">(</span><span class="num" id="4641541">0</span><span class="op" id="4641542">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4641545">&lt;-</span><span class="ident" id="4641547">cpu</span><span class="op" id="4641550">.</span><span class="ident" id="4641551">done</span><br>
<span class="lineno"></span><span class="op" id="4641556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4641559">type</span>&nbsp;<span class="ident" id="4641564">byCycles</span>&nbsp;<span class="op" id="4641573">[</span><span class="op" id="4641574">]</span><span class="ident" id="4641575">runtime</span><span class="op" id="4641582">.</span><span class="ident" id="4641583">BlockProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="4641603">func</span>&nbsp;<span class="op" id="4641608">(</span><span class="ident" id="4641609">x</span>&nbsp;<span class="ident" id="4641611">byCycles</span><span class="op" id="4641619">)</span>&nbsp;<span class="ident" id="4641621">Len</span><span class="op" id="4641624">(</span><span class="op" id="4641625">)</span>&nbsp;<span class="builtintype" id="4641627">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4641641">{</span>&nbsp;<span class="keyword" id="4641643">return</span>&nbsp;<span class="builtinfunc" id="4641650">len</span><span class="op" id="4641653">(</span><span class="ident" id="4641654">x</span><span class="op" id="4641655">)</span>&nbsp;<span class="op" id="4641657">}</span><br>
<span class="lineno"></span><span class="keyword" id="4641659">func</span>&nbsp;<span class="op" id="4641664">(</span><span class="ident" id="4641665">x</span>&nbsp;<span class="ident" id="4641667">byCycles</span><span class="op" id="4641675">)</span>&nbsp;<span class="ident" id="4641677">Swap</span><span class="op" id="4641681">(</span><span class="ident" id="4641682">i</span><span class="op" id="4641683">,</span>&nbsp;<span class="ident" id="4641685">j</span>&nbsp;<span class="builtintype" id="4641687">int</span><span class="op" id="4641690">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4641697">{</span>&nbsp;<span class="ident" id="4641699">x</span><span class="op" id="4641700">[</span><span class="ident" id="4641701">i</span><span class="op" id="4641702">]</span><span class="op" id="4641703">,</span>&nbsp;<span class="ident" id="4641705">x</span><span class="op" id="4641706">[</span><span class="ident" id="4641707">j</span><span class="op" id="4641708">]</span>&nbsp;<span class="op" id="4641710">=</span>&nbsp;<span class="ident" id="4641712">x</span><span class="op" id="4641713">[</span><span class="ident" id="4641714">j</span><span class="op" id="4641715">]</span><span class="op" id="4641716">,</span>&nbsp;<span class="ident" id="4641718">x</span><span class="op" id="4641719">[</span><span class="ident" id="4641720">i</span><span class="op" id="4641721">]</span>&nbsp;<span class="op" id="4641723">}</span><br>
<span class="lineno"></span><span class="keyword" id="4641725">func</span>&nbsp;<span class="op" id="4641730">(</span><span class="ident" id="4641731">x</span>&nbsp;<span class="ident" id="4641733">byCycles</span><span class="op" id="4641741">)</span>&nbsp;<span class="ident" id="4641743">Less</span><span class="op" id="4641747">(</span><span class="ident" id="4641748">i</span><span class="op" id="4641749">,</span>&nbsp;<span class="ident" id="4641751">j</span>&nbsp;<span class="builtintype" id="4641753">int</span><span class="op" id="4641756">)</span>&nbsp;<span class="builtintype" id="4641758">bool</span>&nbsp;<span class="op" id="4641763">{</span>&nbsp;<span class="keyword" id="4641765">return</span>&nbsp;<span class="ident" id="4641772">x</span><span class="op" id="4641773">[</span><span class="ident" id="4641774">i</span><span class="op" id="4641775">]</span><span class="op" id="4641776">.</span><span class="ident" id="4641777">Cycles</span>&nbsp;<span class="op" id="4641784">&gt;</span>&nbsp;<span class="ident" id="4641786">x</span><span class="op" id="4641787">[</span><span class="ident" id="4641788">j</span><span class="op" id="4641789">]</span><span class="op" id="4641790">.</span><span class="ident" id="4641791">Cycles</span>&nbsp;<span class="op" id="4641798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641801">//&nbsp;countBlock&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno">625</span><span class="keyword" id="4641870">func</span>&nbsp;<span class="ident" id="4641875">countBlock</span><span class="op" id="4641885">(</span><span class="op" id="4641886">)</span>&nbsp;<span class="builtintype" id="4641888">int</span>&nbsp;<span class="op" id="4641892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4641895">n</span><span class="op" id="4641896">,</span>&nbsp;<span class="ident" id="4641898">_</span>&nbsp;<span class="op" id="4641900">:=</span>&nbsp;<span class="ident" id="4641903">runtime</span><span class="op" id="4641910">.</span><span class="ident" id="4641911">BlockProfile</span><span class="op" id="4641923">(</span><span class="builtintype" id="4641924">nil</span><span class="op" id="4641927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4641930">return</span>&nbsp;<span class="ident" id="4641937">n</span><br>
<span class="lineno"></span><span class="op" id="4641939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="comment" id="4641942">//&nbsp;writeBlock&nbsp;writes&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4641998">func</span>&nbsp;<span class="ident" id="4642003">writeBlock</span><span class="op" id="4642013">(</span><span class="ident" id="4642014">w</span>&nbsp;<span class="ident" id="4642016">io</span><span class="op" id="4642018">.</span><span class="ident" id="4642019">Writer</span><span class="op" id="4642025">,</span>&nbsp;<span class="ident" id="4642027">debug</span>&nbsp;<span class="builtintype" id="4642033">int</span><span class="op" id="4642036">)</span>&nbsp;<span class="builtintype" id="4642038">error</span>&nbsp;<span class="op" id="4642044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642047">var</span>&nbsp;<span class="ident" id="4642051">p</span>&nbsp;<span class="op" id="4642053">[</span><span class="op" id="4642054">]</span><span class="ident" id="4642055">runtime</span><span class="op" id="4642062">.</span><span class="ident" id="4642063">BlockProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642083">n</span><span class="op" id="4642084">,</span>&nbsp;<span class="ident" id="4642086">ok</span>&nbsp;<span class="op" id="4642089">:=</span>&nbsp;<span class="ident" id="4642092">runtime</span><span class="op" id="4642099">.</span><span class="ident" id="4642100">BlockProfile</span><span class="op" id="4642112">(</span><span class="builtintype" id="4642113">nil</span><span class="op" id="4642116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642119">for</span>&nbsp;<span class="op" id="4642123">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642127">p</span>&nbsp;<span class="op" id="4642129">=</span>&nbsp;<span class="builtinfunc" id="4642131">make</span><span class="op" id="4642135">(</span><span class="op" id="4642136">[</span><span class="op" id="4642137">]</span><span class="ident" id="4642138">runtime</span><span class="op" id="4642145">.</span><span class="ident" id="4642146">BlockProfileRecord</span><span class="op" id="4642164">,</span>&nbsp;<span class="ident" id="4642166">n</span><span class="op" id="4642167">+</span><span class="num" id="4642168">50</span><span class="op" id="4642170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642174">n</span><span class="op" id="4642175">,</span>&nbsp;<span class="ident" id="4642177">ok</span>&nbsp;<span class="op" id="4642180">=</span>&nbsp;<span class="ident" id="4642182">runtime</span><span class="op" id="4642189">.</span><span class="ident" id="4642190">BlockProfile</span><span class="op" id="4642202">(</span><span class="ident" id="4642203">p</span><span class="op" id="4642204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642208">if</span>&nbsp;<span class="ident" id="4642211">ok</span>&nbsp;<span class="op" id="4642214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642219">p</span>&nbsp;<span class="op" id="4642221">=</span>&nbsp;<span class="ident" id="4642223">p</span><span class="op" id="4642224">[</span><span class="op" id="4642225">:</span><span class="ident" id="4642226">n</span><span class="op" id="4642227">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642232">break</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4642240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4642243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642247">sort</span><span class="op" id="4642251">.</span><span class="ident" id="4642252">Sort</span><span class="op" id="4642256">(</span><span class="ident" id="4642257">byCycles</span><span class="op" id="4642265">(</span><span class="ident" id="4642266">p</span><span class="op" id="4642267">)</span><span class="op" id="4642268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642272">b</span>&nbsp;<span class="op" id="4642274">:=</span>&nbsp;<span class="ident" id="4642277">bufio</span><span class="op" id="4642282">.</span><span class="ident" id="4642283">NewWriter</span><span class="op" id="4642292">(</span><span class="ident" id="4642293">w</span><span class="op" id="4642294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642297">var</span>&nbsp;<span class="ident" id="4642301">tw</span>&nbsp;<span class="op" id="4642304">*</span><span class="ident" id="4642305">tabwriter</span><span class="op" id="4642314">.</span><span class="ident" id="4642315">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642323">w</span>&nbsp;<span class="op" id="4642325">=</span>&nbsp;<span class="ident" id="4642327">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642330">if</span>&nbsp;<span class="ident" id="4642333">debug</span>&nbsp;<span class="op" id="4642339">&gt;</span>&nbsp;<span class="num" id="4642341">0</span>&nbsp;<span class="op" id="4642343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642347">tw</span>&nbsp;<span class="op" id="4642350">=</span>&nbsp;<span class="ident" id="4642352">tabwriter</span><span class="op" id="4642361">.</span><span class="ident" id="4642362">NewWriter</span><span class="op" id="4642371">(</span><span class="ident" id="4642372">w</span><span class="op" id="4642373">,</span>&nbsp;<span class="num" id="4642375">1</span><span class="op" id="4642376">,</span>&nbsp;<span class="num" id="4642378">8</span><span class="op" id="4642379">,</span>&nbsp;<span class="num" id="4642381">1</span><span class="op" id="4642382">,</span>&nbsp;<span class="string" id="4642384">&#39;\t&#39;</span><span class="op" id="4642388">,</span>&nbsp;<span class="num" id="4642390">0</span><span class="op" id="4642391">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642395">w</span>&nbsp;<span class="op" id="4642397">=</span>&nbsp;<span class="ident" id="4642399">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4642403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642407">fmt</span><span class="op" id="4642410">.</span><span class="ident" id="4642411">Fprintf</span><span class="op" id="4642418">(</span><span class="ident" id="4642419">w</span><span class="op" id="4642420">,</span>&nbsp;<span class="string" id="4642422">&#34;---&nbsp;contention:\n&#34;</span><span class="op" id="4642441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642444">fmt</span><span class="op" id="4642447">.</span><span class="ident" id="4642448">Fprintf</span><span class="op" id="4642455">(</span><span class="ident" id="4642456">w</span><span class="op" id="4642457">,</span>&nbsp;<span class="string" id="4642459">&#34;cycles/second=%v\n&#34;</span><span class="op" id="4642479">,</span>&nbsp;<span class="ident" id="4642481">runtime_cyclesPerSecond</span><span class="op" id="4642504">(</span><span class="op" id="4642505">)</span><span class="op" id="4642506">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642509">for</span>&nbsp;<span class="ident" id="4642513">i</span>&nbsp;<span class="op" id="4642515">:=</span>&nbsp;<span class="keyword" id="4642518">range</span>&nbsp;<span class="ident" id="4642524">p</span>&nbsp;<span class="op" id="4642526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642530">r</span>&nbsp;<span class="op" id="4642532">:=</span>&nbsp;<span class="op" id="4642535">&amp;</span><span class="ident" id="4642536">p</span><span class="op" id="4642537">[</span><span class="ident" id="4642538">i</span><span class="op" id="4642539">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642543">fmt</span><span class="op" id="4642546">.</span><span class="ident" id="4642547">Fprintf</span><span class="op" id="4642554">(</span><span class="ident" id="4642555">w</span><span class="op" id="4642556">,</span>&nbsp;<span class="string" id="4642558">&#34;%v&nbsp;%v&nbsp;@&#34;</span><span class="op" id="4642567">,</span>&nbsp;<span class="ident" id="4642569">r</span><span class="op" id="4642570">.</span><span class="ident" id="4642571">Cycles</span><span class="op" id="4642577">,</span>&nbsp;<span class="ident" id="4642579">r</span><span class="op" id="4642580">.</span><span class="ident" id="4642581">Count</span><span class="op" id="4642586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642590">for</span>&nbsp;<span class="ident" id="4642594">_</span><span class="op" id="4642595">,</span>&nbsp;<span class="ident" id="4642597">pc</span>&nbsp;<span class="op" id="4642600">:=</span>&nbsp;<span class="keyword" id="4642603">range</span>&nbsp;<span class="ident" id="4642609">r</span><span class="op" id="4642610">.</span><span class="ident" id="4642611">Stack</span><span class="op" id="4642616">(</span><span class="op" id="4642617">)</span>&nbsp;<span class="op" id="4642619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642624">fmt</span><span class="op" id="4642627">.</span><span class="ident" id="4642628">Fprintf</span><span class="op" id="4642635">(</span><span class="ident" id="4642636">w</span><span class="op" id="4642637">,</span>&nbsp;<span class="string" id="4642639">&#34;&nbsp;%#x&#34;</span><span class="op" id="4642645">,</span>&nbsp;<span class="ident" id="4642647">pc</span><span class="op" id="4642649">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4642653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642657">fmt</span><span class="op" id="4642660">.</span><span class="ident" id="4642661">Fprint</span><span class="op" id="4642667">(</span><span class="ident" id="4642668">w</span><span class="op" id="4642669">,</span>&nbsp;<span class="string" id="4642671">&#34;\n&#34;</span><span class="op" id="4642675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642679">if</span>&nbsp;<span class="ident" id="4642682">debug</span>&nbsp;<span class="op" id="4642688">&gt;</span>&nbsp;<span class="num" id="4642690">0</span>&nbsp;<span class="op" id="4642692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642697">printStackRecord</span><span class="op" id="4642713">(</span><span class="ident" id="4642714">w</span><span class="op" id="4642715">,</span>&nbsp;<span class="ident" id="4642717">r</span><span class="op" id="4642718">.</span><span class="ident" id="4642719">Stack</span><span class="op" id="4642724">(</span><span class="op" id="4642725">)</span><span class="op" id="4642726">,</span>&nbsp;<span class="builtintype" id="4642728">true</span><span class="op" id="4642732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4642736">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4642739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642743">if</span>&nbsp;<span class="ident" id="4642746">tw</span>&nbsp;<span class="op" id="4642749">!=</span>&nbsp;<span class="builtintype" id="4642752">nil</span>&nbsp;<span class="op" id="4642756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4642760">tw</span><span class="op" id="4642762">.</span><span class="ident" id="4642763">Flush</span><span class="op" id="4642768">(</span><span class="op" id="4642769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4642772">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4642775">return</span>&nbsp;<span class="ident" id="4642782">b</span><span class="op" id="4642783">.</span><span class="ident" id="4642784">Flush</span><span class="op" id="4642789">(</span><span class="op" id="4642790">)</span><br>
<span class="lineno"></span><span class="op" id="4642792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4642795">func</span>&nbsp;<span class="ident" id="4642800">runtime_cyclesPerSecond</span><span class="op" id="4642823">(</span><span class="op" id="4642824">)</span>&nbsp;<span class="ident" id="4642826">int64</span>
</div>
</body>
</html>
