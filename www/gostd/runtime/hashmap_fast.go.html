<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html" class="current">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1527669">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1527724">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1527778">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1527829">package</span>&nbsp;<span class="ident" id="1527837">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1527846">import</span>&nbsp;<span class="op" id="1527853">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1527856">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1527865">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1527868">func</span>&nbsp;<span class="ident" id="1527873">mapaccess1_fast32</span><span class="op" id="1527890">(</span><span class="ident" id="1527891">t</span>&nbsp;<span class="op" id="1527893">*</span><span class="ident" id="1527894">maptype</span><span class="op" id="1527901">,</span>&nbsp;<span class="ident" id="1527903">h</span>&nbsp;<span class="op" id="1527905">*</span><span class="ident" id="1527906">hmap</span><span class="op" id="1527910">,</span>&nbsp;<span class="ident" id="1527912">key</span>&nbsp;<span class="builtintype" id="1527916">uint32</span><span class="op" id="1527922">)</span>&nbsp;<span class="ident" id="1527924">unsafe</span><span class="op" id="1527930">.</span><span class="ident" id="1527931">Pointer</span>&nbsp;<span class="op" id="1527939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1527942">if</span>&nbsp;<span class="ident" id="1527945">raceenabled</span>&nbsp;<span class="op" id="1527957">&amp;&amp;</span>&nbsp;<span class="ident" id="1527960">h</span>&nbsp;<span class="op" id="1527962">!=</span>&nbsp;<span class="builtintype" id="1527965">nil</span>&nbsp;<span class="op" id="1527969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1527973">callerpc</span>&nbsp;<span class="op" id="1527982">:=</span>&nbsp;<span class="ident" id="1527985">getcallerpc</span><span class="op" id="1527996">(</span><span class="ident" id="1527997">unsafe</span><span class="op" id="1528003">.</span><span class="ident" id="1528004">Pointer</span><span class="op" id="1528011">(</span><span class="op" id="1528012">&amp;</span><span class="ident" id="1528013">t</span><span class="op" id="1528014">)</span><span class="op" id="1528015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528019">racereadpc</span><span class="op" id="1528029">(</span><span class="ident" id="1528030">unsafe</span><span class="op" id="1528036">.</span><span class="ident" id="1528037">Pointer</span><span class="op" id="1528044">(</span><span class="ident" id="1528045">h</span><span class="op" id="1528046">)</span><span class="op" id="1528047">,</span>&nbsp;<span class="ident" id="1528049">callerpc</span><span class="op" id="1528057">,</span>&nbsp;<span class="ident" id="1528059">funcPC</span><span class="op" id="1528065">(</span><span class="ident" id="1528066">mapaccess1_fast32</span><span class="op" id="1528083">)</span><span class="op" id="1528084">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528090">if</span>&nbsp;<span class="ident" id="1528093">h</span>&nbsp;<span class="op" id="1528095">==</span>&nbsp;<span class="builtintype" id="1528098">nil</span>&nbsp;<span class="op" id="1528102">||</span>&nbsp;<span class="ident" id="1528105">h</span><span class="op" id="1528106">.</span><span class="ident" id="1528107">count</span>&nbsp;<span class="op" id="1528113">==</span>&nbsp;<span class="num" id="1528116">0</span>&nbsp;<span class="op" id="1528118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528122">return</span>&nbsp;<span class="ident" id="1528129">unsafe</span><span class="op" id="1528135">.</span><span class="ident" id="1528136">Pointer</span><span class="op" id="1528143">(</span><span class="ident" id="1528144">t</span><span class="op" id="1528145">.</span><span class="ident" id="1528146">elem</span><span class="op" id="1528150">.</span><span class="ident" id="1528151">zero</span><span class="op" id="1528155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528161">var</span>&nbsp;<span class="ident" id="1528165">b</span>&nbsp;<span class="op" id="1528167">*</span><span class="ident" id="1528168">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528174">if</span>&nbsp;<span class="ident" id="1528177">h</span><span class="op" id="1528178">.</span><span class="ident" id="1528179">B</span>&nbsp;<span class="op" id="1528181">==</span>&nbsp;<span class="num" id="1528184">0</span>&nbsp;<span class="op" id="1528186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1528190">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528231">b</span>&nbsp;<span class="op" id="1528233">=</span>&nbsp;<span class="op" id="1528235">(</span><span class="op" id="1528236">*</span><span class="ident" id="1528237">bmap</span><span class="op" id="1528241">)</span><span class="op" id="1528242">(</span><span class="ident" id="1528243">h</span><span class="op" id="1528244">.</span><span class="ident" id="1528245">buckets</span><span class="op" id="1528252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528255">}</span>&nbsp;<span class="keyword" id="1528257">else</span>&nbsp;<span class="op" id="1528262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528266">hash</span>&nbsp;<span class="op" id="1528271">:=</span>&nbsp;<span class="ident" id="1528274">goalg</span><span class="op" id="1528279">(</span><span class="ident" id="1528280">t</span><span class="op" id="1528281">.</span><span class="ident" id="1528282">key</span><span class="op" id="1528285">.</span><span class="ident" id="1528286">alg</span><span class="op" id="1528289">)</span><span class="op" id="1528290">.</span><span class="ident" id="1528291">hash</span><span class="op" id="1528295">(</span><span class="ident" id="1528296">noescape</span><span class="op" id="1528304">(</span><span class="ident" id="1528305">unsafe</span><span class="op" id="1528311">.</span><span class="ident" id="1528312">Pointer</span><span class="op" id="1528319">(</span><span class="op" id="1528320">&amp;</span><span class="ident" id="1528321">key</span><span class="op" id="1528324">)</span><span class="op" id="1528325">)</span><span class="op" id="1528326">,</span>&nbsp;<span class="num" id="1528328">4</span><span class="op" id="1528329">,</span>&nbsp;<span class="builtintype" id="1528331">uintptr</span><span class="op" id="1528338">(</span><span class="ident" id="1528339">h</span><span class="op" id="1528340">.</span><span class="ident" id="1528341">hash0</span><span class="op" id="1528346">)</span><span class="op" id="1528347">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528351">m</span>&nbsp;<span class="op" id="1528353">:=</span>&nbsp;<span class="builtintype" id="1528356">uintptr</span><span class="op" id="1528363">(</span><span class="num" id="1528364">1</span><span class="op" id="1528365">)</span><span class="op" id="1528366">&lt;&lt;</span><span class="ident" id="1528368">h</span><span class="op" id="1528369">.</span><span class="ident" id="1528370">B</span>&nbsp;<span class="op" id="1528372">-</span>&nbsp;<span class="num" id="1528374">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528378">b</span>&nbsp;<span class="op" id="1528380">=</span>&nbsp;<span class="op" id="1528382">(</span><span class="op" id="1528383">*</span><span class="ident" id="1528384">bmap</span><span class="op" id="1528388">)</span><span class="op" id="1528389">(</span><span class="ident" id="1528390">add</span><span class="op" id="1528393">(</span><span class="ident" id="1528394">h</span><span class="op" id="1528395">.</span><span class="ident" id="1528396">buckets</span><span class="op" id="1528403">,</span>&nbsp;<span class="op" id="1528405">(</span><span class="ident" id="1528406">hash</span><span class="op" id="1528410">&amp;</span><span class="ident" id="1528411">m</span><span class="op" id="1528412">)</span><span class="op" id="1528413">*</span><span class="builtintype" id="1528414">uintptr</span><span class="op" id="1528421">(</span><span class="ident" id="1528422">t</span><span class="op" id="1528423">.</span><span class="ident" id="1528424">bucketsize</span><span class="op" id="1528434">)</span><span class="op" id="1528435">)</span><span class="op" id="1528436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528440">if</span>&nbsp;<span class="ident" id="1528443">c</span>&nbsp;<span class="op" id="1528445">:=</span>&nbsp;<span class="ident" id="1528448">h</span><span class="op" id="1528449">.</span><span class="ident" id="1528450">oldbuckets</span><span class="op" id="1528460">;</span>&nbsp;<span class="ident" id="1528462">c</span>&nbsp;<span class="op" id="1528464">!=</span>&nbsp;<span class="builtintype" id="1528467">nil</span>&nbsp;<span class="op" id="1528471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528476">oldb</span>&nbsp;<span class="op" id="1528481">:=</span>&nbsp;<span class="op" id="1528484">(</span><span class="op" id="1528485">*</span><span class="ident" id="1528486">bmap</span><span class="op" id="1528490">)</span><span class="op" id="1528491">(</span><span class="ident" id="1528492">add</span><span class="op" id="1528495">(</span><span class="ident" id="1528496">c</span><span class="op" id="1528497">,</span>&nbsp;<span class="op" id="1528499">(</span><span class="ident" id="1528500">hash</span><span class="op" id="1528504">&amp;</span><span class="op" id="1528505">(</span><span class="ident" id="1528506">m</span><span class="op" id="1528507">&gt;&gt;</span><span class="num" id="1528509">1</span><span class="op" id="1528510">)</span><span class="op" id="1528511">)</span><span class="op" id="1528512">*</span><span class="builtintype" id="1528513">uintptr</span><span class="op" id="1528520">(</span><span class="ident" id="1528521">t</span><span class="op" id="1528522">.</span><span class="ident" id="1528523">bucketsize</span><span class="op" id="1528533">)</span><span class="op" id="1528534">)</span><span class="op" id="1528535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528540">if</span>&nbsp;<span class="op" id="1528543">!</span><span class="ident" id="1528544">evacuated</span><span class="op" id="1528553">(</span><span class="ident" id="1528554">oldb</span><span class="op" id="1528558">)</span>&nbsp;<span class="op" id="1528560">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528566">b</span>&nbsp;<span class="op" id="1528568">=</span>&nbsp;<span class="ident" id="1528570">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528588">for</span>&nbsp;<span class="op" id="1528592">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528596">for</span>&nbsp;<span class="ident" id="1528600">i</span>&nbsp;<span class="op" id="1528602">:=</span>&nbsp;<span class="builtintype" id="1528605">uintptr</span><span class="op" id="1528612">(</span><span class="num" id="1528613">0</span><span class="op" id="1528614">)</span><span class="op" id="1528615">;</span>&nbsp;<span class="ident" id="1528617">i</span>&nbsp;<span class="op" id="1528619">&lt;</span>&nbsp;<span class="ident" id="1528621">bucketCnt</span><span class="op" id="1528630">;</span>&nbsp;<span class="ident" id="1528632">i</span><span class="op" id="1528633">++</span>&nbsp;<span class="op" id="1528636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528641">k</span>&nbsp;<span class="op" id="1528643">:=</span>&nbsp;<span class="op" id="1528646">*</span><span class="op" id="1528647">(</span><span class="op" id="1528648">(</span><span class="op" id="1528649">*</span><span class="builtintype" id="1528650">uint32</span><span class="op" id="1528656">)</span><span class="op" id="1528657">(</span><span class="ident" id="1528658">add</span><span class="op" id="1528661">(</span><span class="ident" id="1528662">unsafe</span><span class="op" id="1528668">.</span><span class="ident" id="1528669">Pointer</span><span class="op" id="1528676">(</span><span class="ident" id="1528677">b</span><span class="op" id="1528678">)</span><span class="op" id="1528679">,</span>&nbsp;<span class="ident" id="1528681">dataOffset</span><span class="op" id="1528691">+</span><span class="ident" id="1528692">i</span><span class="op" id="1528693">*</span><span class="num" id="1528694">4</span><span class="op" id="1528695">)</span><span class="op" id="1528696">)</span><span class="op" id="1528697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528702">if</span>&nbsp;<span class="ident" id="1528705">k</span>&nbsp;<span class="op" id="1528707">!=</span>&nbsp;<span class="ident" id="1528710">key</span>&nbsp;<span class="op" id="1528714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528720">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528732">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528737">x</span>&nbsp;<span class="op" id="1528739">:=</span>&nbsp;<span class="op" id="1528742">*</span><span class="op" id="1528743">(</span><span class="op" id="1528744">(</span><span class="op" id="1528745">*</span><span class="builtintype" id="1528746">uint8</span><span class="op" id="1528751">)</span><span class="op" id="1528752">(</span><span class="ident" id="1528753">add</span><span class="op" id="1528756">(</span><span class="ident" id="1528757">unsafe</span><span class="op" id="1528763">.</span><span class="ident" id="1528764">Pointer</span><span class="op" id="1528771">(</span><span class="ident" id="1528772">b</span><span class="op" id="1528773">)</span><span class="op" id="1528774">,</span>&nbsp;<span class="ident" id="1528776">i</span><span class="op" id="1528777">)</span><span class="op" id="1528778">)</span><span class="op" id="1528779">)</span>&nbsp;<span class="comment" id="1528781">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528825">if</span>&nbsp;<span class="ident" id="1528828">x</span>&nbsp;<span class="op" id="1528830">==</span>&nbsp;<span class="ident" id="1528833">empty</span>&nbsp;<span class="op" id="1528839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528845">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528862">return</span>&nbsp;<span class="ident" id="1528869">add</span><span class="op" id="1528872">(</span><span class="ident" id="1528873">unsafe</span><span class="op" id="1528879">.</span><span class="ident" id="1528880">Pointer</span><span class="op" id="1528887">(</span><span class="ident" id="1528888">b</span><span class="op" id="1528889">)</span><span class="op" id="1528890">,</span>&nbsp;<span class="ident" id="1528892">dataOffset</span><span class="op" id="1528902">+</span><span class="ident" id="1528903">bucketCnt</span><span class="op" id="1528912">*</span><span class="num" id="1528913">4</span><span class="op" id="1528914">+</span><span class="ident" id="1528915">i</span><span class="op" id="1528916">*</span><span class="builtintype" id="1528917">uintptr</span><span class="op" id="1528924">(</span><span class="ident" id="1528925">t</span><span class="op" id="1528926">.</span><span class="ident" id="1528927">valuesize</span><span class="op" id="1528936">)</span><span class="op" id="1528937">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1528941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1528945">b</span>&nbsp;<span class="op" id="1528947">=</span>&nbsp;<span class="ident" id="1528949">b</span><span class="op" id="1528950">.</span><span class="ident" id="1528951">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528962">if</span>&nbsp;<span class="ident" id="1528965">b</span>&nbsp;<span class="op" id="1528967">==</span>&nbsp;<span class="builtintype" id="1528970">nil</span>&nbsp;<span class="op" id="1528974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1528979">return</span>&nbsp;<span class="ident" id="1528986">unsafe</span><span class="op" id="1528992">.</span><span class="ident" id="1528993">Pointer</span><span class="op" id="1529000">(</span><span class="ident" id="1529001">t</span><span class="op" id="1529002">.</span><span class="ident" id="1529003">elem</span><span class="op" id="1529007">.</span><span class="ident" id="1529008">zero</span><span class="op" id="1529012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529016">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529019">}</span><br>
<span class="lineno"></span><span class="op" id="1529021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1529024">func</span>&nbsp;<span class="ident" id="1529029">mapaccess2_fast32</span><span class="op" id="1529046">(</span><span class="ident" id="1529047">t</span>&nbsp;<span class="op" id="1529049">*</span><span class="ident" id="1529050">maptype</span><span class="op" id="1529057">,</span>&nbsp;<span class="ident" id="1529059">h</span>&nbsp;<span class="op" id="1529061">*</span><span class="ident" id="1529062">hmap</span><span class="op" id="1529066">,</span>&nbsp;<span class="ident" id="1529068">key</span>&nbsp;<span class="builtintype" id="1529072">uint32</span><span class="op" id="1529078">)</span>&nbsp;<span class="op" id="1529080">(</span><span class="ident" id="1529081">unsafe</span><span class="op" id="1529087">.</span><span class="ident" id="1529088">Pointer</span><span class="op" id="1529095">,</span>&nbsp;<span class="builtintype" id="1529097">bool</span><span class="op" id="1529101">)</span>&nbsp;<span class="op" id="1529103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529106">if</span>&nbsp;<span class="ident" id="1529109">raceenabled</span>&nbsp;<span class="op" id="1529121">&amp;&amp;</span>&nbsp;<span class="ident" id="1529124">h</span>&nbsp;<span class="op" id="1529126">!=</span>&nbsp;<span class="builtintype" id="1529129">nil</span>&nbsp;<span class="op" id="1529133">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529137">callerpc</span>&nbsp;<span class="op" id="1529146">:=</span>&nbsp;<span class="ident" id="1529149">getcallerpc</span><span class="op" id="1529160">(</span><span class="ident" id="1529161">unsafe</span><span class="op" id="1529167">.</span><span class="ident" id="1529168">Pointer</span><span class="op" id="1529175">(</span><span class="op" id="1529176">&amp;</span><span class="ident" id="1529177">t</span><span class="op" id="1529178">)</span><span class="op" id="1529179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529183">racereadpc</span><span class="op" id="1529193">(</span><span class="ident" id="1529194">unsafe</span><span class="op" id="1529200">.</span><span class="ident" id="1529201">Pointer</span><span class="op" id="1529208">(</span><span class="ident" id="1529209">h</span><span class="op" id="1529210">)</span><span class="op" id="1529211">,</span>&nbsp;<span class="ident" id="1529213">callerpc</span><span class="op" id="1529221">,</span>&nbsp;<span class="ident" id="1529223">funcPC</span><span class="op" id="1529229">(</span><span class="ident" id="1529230">mapaccess2_fast32</span><span class="op" id="1529247">)</span><span class="op" id="1529248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529254">if</span>&nbsp;<span class="ident" id="1529257">h</span>&nbsp;<span class="op" id="1529259">==</span>&nbsp;<span class="builtintype" id="1529262">nil</span>&nbsp;<span class="op" id="1529266">||</span>&nbsp;<span class="ident" id="1529269">h</span><span class="op" id="1529270">.</span><span class="ident" id="1529271">count</span>&nbsp;<span class="op" id="1529277">==</span>&nbsp;<span class="num" id="1529280">0</span>&nbsp;<span class="op" id="1529282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529286">return</span>&nbsp;<span class="ident" id="1529293">unsafe</span><span class="op" id="1529299">.</span><span class="ident" id="1529300">Pointer</span><span class="op" id="1529307">(</span><span class="ident" id="1529308">t</span><span class="op" id="1529309">.</span><span class="ident" id="1529310">elem</span><span class="op" id="1529314">.</span><span class="ident" id="1529315">zero</span><span class="op" id="1529319">)</span><span class="op" id="1529320">,</span>&nbsp;<span class="builtintype" id="1529322">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529332">var</span>&nbsp;<span class="ident" id="1529336">b</span>&nbsp;<span class="op" id="1529338">*</span><span class="ident" id="1529339">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529345">if</span>&nbsp;<span class="ident" id="1529348">h</span><span class="op" id="1529349">.</span><span class="ident" id="1529350">B</span>&nbsp;<span class="op" id="1529352">==</span>&nbsp;<span class="num" id="1529355">0</span>&nbsp;<span class="op" id="1529357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1529361">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529402">b</span>&nbsp;<span class="op" id="1529404">=</span>&nbsp;<span class="op" id="1529406">(</span><span class="op" id="1529407">*</span><span class="ident" id="1529408">bmap</span><span class="op" id="1529412">)</span><span class="op" id="1529413">(</span><span class="ident" id="1529414">h</span><span class="op" id="1529415">.</span><span class="ident" id="1529416">buckets</span><span class="op" id="1529423">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529426">}</span>&nbsp;<span class="keyword" id="1529428">else</span>&nbsp;<span class="op" id="1529433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529437">hash</span>&nbsp;<span class="op" id="1529442">:=</span>&nbsp;<span class="ident" id="1529445">goalg</span><span class="op" id="1529450">(</span><span class="ident" id="1529451">t</span><span class="op" id="1529452">.</span><span class="ident" id="1529453">key</span><span class="op" id="1529456">.</span><span class="ident" id="1529457">alg</span><span class="op" id="1529460">)</span><span class="op" id="1529461">.</span><span class="ident" id="1529462">hash</span><span class="op" id="1529466">(</span><span class="ident" id="1529467">noescape</span><span class="op" id="1529475">(</span><span class="ident" id="1529476">unsafe</span><span class="op" id="1529482">.</span><span class="ident" id="1529483">Pointer</span><span class="op" id="1529490">(</span><span class="op" id="1529491">&amp;</span><span class="ident" id="1529492">key</span><span class="op" id="1529495">)</span><span class="op" id="1529496">)</span><span class="op" id="1529497">,</span>&nbsp;<span class="num" id="1529499">4</span><span class="op" id="1529500">,</span>&nbsp;<span class="builtintype" id="1529502">uintptr</span><span class="op" id="1529509">(</span><span class="ident" id="1529510">h</span><span class="op" id="1529511">.</span><span class="ident" id="1529512">hash0</span><span class="op" id="1529517">)</span><span class="op" id="1529518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529522">m</span>&nbsp;<span class="op" id="1529524">:=</span>&nbsp;<span class="builtintype" id="1529527">uintptr</span><span class="op" id="1529534">(</span><span class="num" id="1529535">1</span><span class="op" id="1529536">)</span><span class="op" id="1529537">&lt;&lt;</span><span class="ident" id="1529539">h</span><span class="op" id="1529540">.</span><span class="ident" id="1529541">B</span>&nbsp;<span class="op" id="1529543">-</span>&nbsp;<span class="num" id="1529545">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529549">b</span>&nbsp;<span class="op" id="1529551">=</span>&nbsp;<span class="op" id="1529553">(</span><span class="op" id="1529554">*</span><span class="ident" id="1529555">bmap</span><span class="op" id="1529559">)</span><span class="op" id="1529560">(</span><span class="ident" id="1529561">add</span><span class="op" id="1529564">(</span><span class="ident" id="1529565">h</span><span class="op" id="1529566">.</span><span class="ident" id="1529567">buckets</span><span class="op" id="1529574">,</span>&nbsp;<span class="op" id="1529576">(</span><span class="ident" id="1529577">hash</span><span class="op" id="1529581">&amp;</span><span class="ident" id="1529582">m</span><span class="op" id="1529583">)</span><span class="op" id="1529584">*</span><span class="builtintype" id="1529585">uintptr</span><span class="op" id="1529592">(</span><span class="ident" id="1529593">t</span><span class="op" id="1529594">.</span><span class="ident" id="1529595">bucketsize</span><span class="op" id="1529605">)</span><span class="op" id="1529606">)</span><span class="op" id="1529607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529611">if</span>&nbsp;<span class="ident" id="1529614">c</span>&nbsp;<span class="op" id="1529616">:=</span>&nbsp;<span class="ident" id="1529619">h</span><span class="op" id="1529620">.</span><span class="ident" id="1529621">oldbuckets</span><span class="op" id="1529631">;</span>&nbsp;<span class="ident" id="1529633">c</span>&nbsp;<span class="op" id="1529635">!=</span>&nbsp;<span class="builtintype" id="1529638">nil</span>&nbsp;<span class="op" id="1529642">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529647">oldb</span>&nbsp;<span class="op" id="1529652">:=</span>&nbsp;<span class="op" id="1529655">(</span><span class="op" id="1529656">*</span><span class="ident" id="1529657">bmap</span><span class="op" id="1529661">)</span><span class="op" id="1529662">(</span><span class="ident" id="1529663">add</span><span class="op" id="1529666">(</span><span class="ident" id="1529667">c</span><span class="op" id="1529668">,</span>&nbsp;<span class="op" id="1529670">(</span><span class="ident" id="1529671">hash</span><span class="op" id="1529675">&amp;</span><span class="op" id="1529676">(</span><span class="ident" id="1529677">m</span><span class="op" id="1529678">&gt;&gt;</span><span class="num" id="1529680">1</span><span class="op" id="1529681">)</span><span class="op" id="1529682">)</span><span class="op" id="1529683">*</span><span class="builtintype" id="1529684">uintptr</span><span class="op" id="1529691">(</span><span class="ident" id="1529692">t</span><span class="op" id="1529693">.</span><span class="ident" id="1529694">bucketsize</span><span class="op" id="1529704">)</span><span class="op" id="1529705">)</span><span class="op" id="1529706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529711">if</span>&nbsp;<span class="op" id="1529714">!</span><span class="ident" id="1529715">evacuated</span><span class="op" id="1529724">(</span><span class="ident" id="1529725">oldb</span><span class="op" id="1529729">)</span>&nbsp;<span class="op" id="1529731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529737">b</span>&nbsp;<span class="op" id="1529739">=</span>&nbsp;<span class="ident" id="1529741">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529753">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529759">for</span>&nbsp;<span class="op" id="1529763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529767">for</span>&nbsp;<span class="ident" id="1529771">i</span>&nbsp;<span class="op" id="1529773">:=</span>&nbsp;<span class="builtintype" id="1529776">uintptr</span><span class="op" id="1529783">(</span><span class="num" id="1529784">0</span><span class="op" id="1529785">)</span><span class="op" id="1529786">;</span>&nbsp;<span class="ident" id="1529788">i</span>&nbsp;<span class="op" id="1529790">&lt;</span>&nbsp;<span class="ident" id="1529792">bucketCnt</span><span class="op" id="1529801">;</span>&nbsp;<span class="ident" id="1529803">i</span><span class="op" id="1529804">++</span>&nbsp;<span class="op" id="1529807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529812">k</span>&nbsp;<span class="op" id="1529814">:=</span>&nbsp;<span class="op" id="1529817">*</span><span class="op" id="1529818">(</span><span class="op" id="1529819">(</span><span class="op" id="1529820">*</span><span class="builtintype" id="1529821">uint32</span><span class="op" id="1529827">)</span><span class="op" id="1529828">(</span><span class="ident" id="1529829">add</span><span class="op" id="1529832">(</span><span class="ident" id="1529833">unsafe</span><span class="op" id="1529839">.</span><span class="ident" id="1529840">Pointer</span><span class="op" id="1529847">(</span><span class="ident" id="1529848">b</span><span class="op" id="1529849">)</span><span class="op" id="1529850">,</span>&nbsp;<span class="ident" id="1529852">dataOffset</span><span class="op" id="1529862">+</span><span class="ident" id="1529863">i</span><span class="op" id="1529864">*</span><span class="num" id="1529865">4</span><span class="op" id="1529866">)</span><span class="op" id="1529867">)</span><span class="op" id="1529868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529873">if</span>&nbsp;<span class="ident" id="1529876">k</span>&nbsp;<span class="op" id="1529878">!=</span>&nbsp;<span class="ident" id="1529881">key</span>&nbsp;<span class="op" id="1529885">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529891">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1529903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1529908">x</span>&nbsp;<span class="op" id="1529910">:=</span>&nbsp;<span class="op" id="1529913">*</span><span class="op" id="1529914">(</span><span class="op" id="1529915">(</span><span class="op" id="1529916">*</span><span class="builtintype" id="1529917">uint8</span><span class="op" id="1529922">)</span><span class="op" id="1529923">(</span><span class="ident" id="1529924">add</span><span class="op" id="1529927">(</span><span class="ident" id="1529928">unsafe</span><span class="op" id="1529934">.</span><span class="ident" id="1529935">Pointer</span><span class="op" id="1529942">(</span><span class="ident" id="1529943">b</span><span class="op" id="1529944">)</span><span class="op" id="1529945">,</span>&nbsp;<span class="ident" id="1529947">i</span><span class="op" id="1529948">)</span><span class="op" id="1529949">)</span><span class="op" id="1529950">)</span>&nbsp;<span class="comment" id="1529952">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1529996">if</span>&nbsp;<span class="ident" id="1529999">x</span>&nbsp;<span class="op" id="1530001">==</span>&nbsp;<span class="ident" id="1530004">empty</span>&nbsp;<span class="op" id="1530010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530016">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530033">return</span>&nbsp;<span class="ident" id="1530040">add</span><span class="op" id="1530043">(</span><span class="ident" id="1530044">unsafe</span><span class="op" id="1530050">.</span><span class="ident" id="1530051">Pointer</span><span class="op" id="1530058">(</span><span class="ident" id="1530059">b</span><span class="op" id="1530060">)</span><span class="op" id="1530061">,</span>&nbsp;<span class="ident" id="1530063">dataOffset</span><span class="op" id="1530073">+</span><span class="ident" id="1530074">bucketCnt</span><span class="op" id="1530083">*</span><span class="num" id="1530084">4</span><span class="op" id="1530085">+</span><span class="ident" id="1530086">i</span><span class="op" id="1530087">*</span><span class="builtintype" id="1530088">uintptr</span><span class="op" id="1530095">(</span><span class="ident" id="1530096">t</span><span class="op" id="1530097">.</span><span class="ident" id="1530098">valuesize</span><span class="op" id="1530107">)</span><span class="op" id="1530108">)</span><span class="op" id="1530109">,</span>&nbsp;<span class="builtintype" id="1530111">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530122">b</span>&nbsp;<span class="op" id="1530124">=</span>&nbsp;<span class="ident" id="1530126">b</span><span class="op" id="1530127">.</span><span class="ident" id="1530128">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530139">if</span>&nbsp;<span class="ident" id="1530142">b</span>&nbsp;<span class="op" id="1530144">==</span>&nbsp;<span class="builtintype" id="1530147">nil</span>&nbsp;<span class="op" id="1530151">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530156">return</span>&nbsp;<span class="ident" id="1530163">unsafe</span><span class="op" id="1530169">.</span><span class="ident" id="1530170">Pointer</span><span class="op" id="1530177">(</span><span class="ident" id="1530178">t</span><span class="op" id="1530179">.</span><span class="ident" id="1530180">elem</span><span class="op" id="1530184">.</span><span class="ident" id="1530185">zero</span><span class="op" id="1530189">)</span><span class="op" id="1530190">,</span>&nbsp;<span class="builtintype" id="1530192">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530203">}</span><br>
<span class="lineno"></span><span class="op" id="1530205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1530208">func</span>&nbsp;<span class="ident" id="1530213">mapaccess1_fast64</span><span class="op" id="1530230">(</span><span class="ident" id="1530231">t</span>&nbsp;<span class="op" id="1530233">*</span><span class="ident" id="1530234">maptype</span><span class="op" id="1530241">,</span>&nbsp;<span class="ident" id="1530243">h</span>&nbsp;<span class="op" id="1530245">*</span><span class="ident" id="1530246">hmap</span><span class="op" id="1530250">,</span>&nbsp;<span class="ident" id="1530252">key</span>&nbsp;<span class="ident" id="1530256">uint64</span><span class="op" id="1530262">)</span>&nbsp;<span class="ident" id="1530264">unsafe</span><span class="op" id="1530270">.</span><span class="ident" id="1530271">Pointer</span>&nbsp;<span class="op" id="1530279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530282">if</span>&nbsp;<span class="ident" id="1530285">raceenabled</span>&nbsp;<span class="op" id="1530297">&amp;&amp;</span>&nbsp;<span class="ident" id="1530300">h</span>&nbsp;<span class="op" id="1530302">!=</span>&nbsp;<span class="builtintype" id="1530305">nil</span>&nbsp;<span class="op" id="1530309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530313">callerpc</span>&nbsp;<span class="op" id="1530322">:=</span>&nbsp;<span class="ident" id="1530325">getcallerpc</span><span class="op" id="1530336">(</span><span class="ident" id="1530337">unsafe</span><span class="op" id="1530343">.</span><span class="ident" id="1530344">Pointer</span><span class="op" id="1530351">(</span><span class="op" id="1530352">&amp;</span><span class="ident" id="1530353">t</span><span class="op" id="1530354">)</span><span class="op" id="1530355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530359">racereadpc</span><span class="op" id="1530369">(</span><span class="ident" id="1530370">unsafe</span><span class="op" id="1530376">.</span><span class="ident" id="1530377">Pointer</span><span class="op" id="1530384">(</span><span class="ident" id="1530385">h</span><span class="op" id="1530386">)</span><span class="op" id="1530387">,</span>&nbsp;<span class="ident" id="1530389">callerpc</span><span class="op" id="1530397">,</span>&nbsp;<span class="ident" id="1530399">funcPC</span><span class="op" id="1530405">(</span><span class="ident" id="1530406">mapaccess1_fast64</span><span class="op" id="1530423">)</span><span class="op" id="1530424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530427">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530430">if</span>&nbsp;<span class="ident" id="1530433">h</span>&nbsp;<span class="op" id="1530435">==</span>&nbsp;<span class="builtintype" id="1530438">nil</span>&nbsp;<span class="op" id="1530442">||</span>&nbsp;<span class="ident" id="1530445">h</span><span class="op" id="1530446">.</span><span class="ident" id="1530447">count</span>&nbsp;<span class="op" id="1530453">==</span>&nbsp;<span class="num" id="1530456">0</span>&nbsp;<span class="op" id="1530458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530462">return</span>&nbsp;<span class="ident" id="1530469">unsafe</span><span class="op" id="1530475">.</span><span class="ident" id="1530476">Pointer</span><span class="op" id="1530483">(</span><span class="ident" id="1530484">t</span><span class="op" id="1530485">.</span><span class="ident" id="1530486">elem</span><span class="op" id="1530490">.</span><span class="ident" id="1530491">zero</span><span class="op" id="1530495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530501">var</span>&nbsp;<span class="ident" id="1530505">b</span>&nbsp;<span class="op" id="1530507">*</span><span class="ident" id="1530508">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530514">if</span>&nbsp;<span class="ident" id="1530517">h</span><span class="op" id="1530518">.</span><span class="ident" id="1530519">B</span>&nbsp;<span class="op" id="1530521">==</span>&nbsp;<span class="num" id="1530524">0</span>&nbsp;<span class="op" id="1530526">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1530530">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530571">b</span>&nbsp;<span class="op" id="1530573">=</span>&nbsp;<span class="op" id="1530575">(</span><span class="op" id="1530576">*</span><span class="ident" id="1530577">bmap</span><span class="op" id="1530581">)</span><span class="op" id="1530582">(</span><span class="ident" id="1530583">h</span><span class="op" id="1530584">.</span><span class="ident" id="1530585">buckets</span><span class="op" id="1530592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530595">}</span>&nbsp;<span class="keyword" id="1530597">else</span>&nbsp;<span class="op" id="1530602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530606">hash</span>&nbsp;<span class="op" id="1530611">:=</span>&nbsp;<span class="ident" id="1530614">goalg</span><span class="op" id="1530619">(</span><span class="ident" id="1530620">t</span><span class="op" id="1530621">.</span><span class="ident" id="1530622">key</span><span class="op" id="1530625">.</span><span class="ident" id="1530626">alg</span><span class="op" id="1530629">)</span><span class="op" id="1530630">.</span><span class="ident" id="1530631">hash</span><span class="op" id="1530635">(</span><span class="ident" id="1530636">noescape</span><span class="op" id="1530644">(</span><span class="ident" id="1530645">unsafe</span><span class="op" id="1530651">.</span><span class="ident" id="1530652">Pointer</span><span class="op" id="1530659">(</span><span class="op" id="1530660">&amp;</span><span class="ident" id="1530661">key</span><span class="op" id="1530664">)</span><span class="op" id="1530665">)</span><span class="op" id="1530666">,</span>&nbsp;<span class="num" id="1530668">8</span><span class="op" id="1530669">,</span>&nbsp;<span class="builtintype" id="1530671">uintptr</span><span class="op" id="1530678">(</span><span class="ident" id="1530679">h</span><span class="op" id="1530680">.</span><span class="ident" id="1530681">hash0</span><span class="op" id="1530686">)</span><span class="op" id="1530687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530691">m</span>&nbsp;<span class="op" id="1530693">:=</span>&nbsp;<span class="builtintype" id="1530696">uintptr</span><span class="op" id="1530703">(</span><span class="num" id="1530704">1</span><span class="op" id="1530705">)</span><span class="op" id="1530706">&lt;&lt;</span><span class="ident" id="1530708">h</span><span class="op" id="1530709">.</span><span class="ident" id="1530710">B</span>&nbsp;<span class="op" id="1530712">-</span>&nbsp;<span class="num" id="1530714">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530718">b</span>&nbsp;<span class="op" id="1530720">=</span>&nbsp;<span class="op" id="1530722">(</span><span class="op" id="1530723">*</span><span class="ident" id="1530724">bmap</span><span class="op" id="1530728">)</span><span class="op" id="1530729">(</span><span class="ident" id="1530730">add</span><span class="op" id="1530733">(</span><span class="ident" id="1530734">h</span><span class="op" id="1530735">.</span><span class="ident" id="1530736">buckets</span><span class="op" id="1530743">,</span>&nbsp;<span class="op" id="1530745">(</span><span class="ident" id="1530746">hash</span><span class="op" id="1530750">&amp;</span><span class="ident" id="1530751">m</span><span class="op" id="1530752">)</span><span class="op" id="1530753">*</span><span class="builtintype" id="1530754">uintptr</span><span class="op" id="1530761">(</span><span class="ident" id="1530762">t</span><span class="op" id="1530763">.</span><span class="ident" id="1530764">bucketsize</span><span class="op" id="1530774">)</span><span class="op" id="1530775">)</span><span class="op" id="1530776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530780">if</span>&nbsp;<span class="ident" id="1530783">c</span>&nbsp;<span class="op" id="1530785">:=</span>&nbsp;<span class="ident" id="1530788">h</span><span class="op" id="1530789">.</span><span class="ident" id="1530790">oldbuckets</span><span class="op" id="1530800">;</span>&nbsp;<span class="ident" id="1530802">c</span>&nbsp;<span class="op" id="1530804">!=</span>&nbsp;<span class="builtintype" id="1530807">nil</span>&nbsp;<span class="op" id="1530811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530816">oldb</span>&nbsp;<span class="op" id="1530821">:=</span>&nbsp;<span class="op" id="1530824">(</span><span class="op" id="1530825">*</span><span class="ident" id="1530826">bmap</span><span class="op" id="1530830">)</span><span class="op" id="1530831">(</span><span class="ident" id="1530832">add</span><span class="op" id="1530835">(</span><span class="ident" id="1530836">c</span><span class="op" id="1530837">,</span>&nbsp;<span class="op" id="1530839">(</span><span class="ident" id="1530840">hash</span><span class="op" id="1530844">&amp;</span><span class="op" id="1530845">(</span><span class="ident" id="1530846">m</span><span class="op" id="1530847">&gt;&gt;</span><span class="num" id="1530849">1</span><span class="op" id="1530850">)</span><span class="op" id="1530851">)</span><span class="op" id="1530852">*</span><span class="builtintype" id="1530853">uintptr</span><span class="op" id="1530860">(</span><span class="ident" id="1530861">t</span><span class="op" id="1530862">.</span><span class="ident" id="1530863">bucketsize</span><span class="op" id="1530873">)</span><span class="op" id="1530874">)</span><span class="op" id="1530875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530880">if</span>&nbsp;<span class="op" id="1530883">!</span><span class="ident" id="1530884">evacuated</span><span class="op" id="1530893">(</span><span class="ident" id="1530894">oldb</span><span class="op" id="1530898">)</span>&nbsp;<span class="op" id="1530900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530906">b</span>&nbsp;<span class="op" id="1530908">=</span>&nbsp;<span class="ident" id="1530910">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1530925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530928">for</span>&nbsp;<span class="op" id="1530932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1530936">for</span>&nbsp;<span class="ident" id="1530940">i</span>&nbsp;<span class="op" id="1530942">:=</span>&nbsp;<span class="builtintype" id="1530945">uintptr</span><span class="op" id="1530952">(</span><span class="num" id="1530953">0</span><span class="op" id="1530954">)</span><span class="op" id="1530955">;</span>&nbsp;<span class="ident" id="1530957">i</span>&nbsp;<span class="op" id="1530959">&lt;</span>&nbsp;<span class="ident" id="1530961">bucketCnt</span><span class="op" id="1530970">;</span>&nbsp;<span class="ident" id="1530972">i</span><span class="op" id="1530973">++</span>&nbsp;<span class="op" id="1530976">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1530981">k</span>&nbsp;<span class="op" id="1530983">:=</span>&nbsp;<span class="op" id="1530986">*</span><span class="op" id="1530987">(</span><span class="op" id="1530988">(</span><span class="op" id="1530989">*</span><span class="ident" id="1530990">uint64</span><span class="op" id="1530996">)</span><span class="op" id="1530997">(</span><span class="ident" id="1530998">add</span><span class="op" id="1531001">(</span><span class="ident" id="1531002">unsafe</span><span class="op" id="1531008">.</span><span class="ident" id="1531009">Pointer</span><span class="op" id="1531016">(</span><span class="ident" id="1531017">b</span><span class="op" id="1531018">)</span><span class="op" id="1531019">,</span>&nbsp;<span class="ident" id="1531021">dataOffset</span><span class="op" id="1531031">+</span><span class="ident" id="1531032">i</span><span class="op" id="1531033">*</span><span class="num" id="1531034">8</span><span class="op" id="1531035">)</span><span class="op" id="1531036">)</span><span class="op" id="1531037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531042">if</span>&nbsp;<span class="ident" id="1531045">k</span>&nbsp;<span class="op" id="1531047">!=</span>&nbsp;<span class="ident" id="1531050">key</span>&nbsp;<span class="op" id="1531054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531060">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531077">x</span>&nbsp;<span class="op" id="1531079">:=</span>&nbsp;<span class="op" id="1531082">*</span><span class="op" id="1531083">(</span><span class="op" id="1531084">(</span><span class="op" id="1531085">*</span><span class="builtintype" id="1531086">uint8</span><span class="op" id="1531091">)</span><span class="op" id="1531092">(</span><span class="ident" id="1531093">add</span><span class="op" id="1531096">(</span><span class="ident" id="1531097">unsafe</span><span class="op" id="1531103">.</span><span class="ident" id="1531104">Pointer</span><span class="op" id="1531111">(</span><span class="ident" id="1531112">b</span><span class="op" id="1531113">)</span><span class="op" id="1531114">,</span>&nbsp;<span class="ident" id="1531116">i</span><span class="op" id="1531117">)</span><span class="op" id="1531118">)</span><span class="op" id="1531119">)</span>&nbsp;<span class="comment" id="1531121">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531165">if</span>&nbsp;<span class="ident" id="1531168">x</span>&nbsp;<span class="op" id="1531170">==</span>&nbsp;<span class="ident" id="1531173">empty</span>&nbsp;<span class="op" id="1531179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531185">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531202">return</span>&nbsp;<span class="ident" id="1531209">add</span><span class="op" id="1531212">(</span><span class="ident" id="1531213">unsafe</span><span class="op" id="1531219">.</span><span class="ident" id="1531220">Pointer</span><span class="op" id="1531227">(</span><span class="ident" id="1531228">b</span><span class="op" id="1531229">)</span><span class="op" id="1531230">,</span>&nbsp;<span class="ident" id="1531232">dataOffset</span><span class="op" id="1531242">+</span><span class="ident" id="1531243">bucketCnt</span><span class="op" id="1531252">*</span><span class="num" id="1531253">8</span><span class="op" id="1531254">+</span><span class="ident" id="1531255">i</span><span class="op" id="1531256">*</span><span class="builtintype" id="1531257">uintptr</span><span class="op" id="1531264">(</span><span class="ident" id="1531265">t</span><span class="op" id="1531266">.</span><span class="ident" id="1531267">valuesize</span><span class="op" id="1531276">)</span><span class="op" id="1531277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531281">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531285">b</span>&nbsp;<span class="op" id="1531287">=</span>&nbsp;<span class="ident" id="1531289">b</span><span class="op" id="1531290">.</span><span class="ident" id="1531291">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531302">if</span>&nbsp;<span class="ident" id="1531305">b</span>&nbsp;<span class="op" id="1531307">==</span>&nbsp;<span class="builtintype" id="1531310">nil</span>&nbsp;<span class="op" id="1531314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531319">return</span>&nbsp;<span class="ident" id="1531326">unsafe</span><span class="op" id="1531332">.</span><span class="ident" id="1531333">Pointer</span><span class="op" id="1531340">(</span><span class="ident" id="1531341">t</span><span class="op" id="1531342">.</span><span class="ident" id="1531343">elem</span><span class="op" id="1531347">.</span><span class="ident" id="1531348">zero</span><span class="op" id="1531352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531359">}</span><br>
<span class="lineno">135</span><span class="op" id="1531361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1531364">func</span>&nbsp;<span class="ident" id="1531369">mapaccess2_fast64</span><span class="op" id="1531386">(</span><span class="ident" id="1531387">t</span>&nbsp;<span class="op" id="1531389">*</span><span class="ident" id="1531390">maptype</span><span class="op" id="1531397">,</span>&nbsp;<span class="ident" id="1531399">h</span>&nbsp;<span class="op" id="1531401">*</span><span class="ident" id="1531402">hmap</span><span class="op" id="1531406">,</span>&nbsp;<span class="ident" id="1531408">key</span>&nbsp;<span class="ident" id="1531412">uint64</span><span class="op" id="1531418">)</span>&nbsp;<span class="op" id="1531420">(</span><span class="ident" id="1531421">unsafe</span><span class="op" id="1531427">.</span><span class="ident" id="1531428">Pointer</span><span class="op" id="1531435">,</span>&nbsp;<span class="builtintype" id="1531437">bool</span><span class="op" id="1531441">)</span>&nbsp;<span class="op" id="1531443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531446">if</span>&nbsp;<span class="ident" id="1531449">raceenabled</span>&nbsp;<span class="op" id="1531461">&amp;&amp;</span>&nbsp;<span class="ident" id="1531464">h</span>&nbsp;<span class="op" id="1531466">!=</span>&nbsp;<span class="builtintype" id="1531469">nil</span>&nbsp;<span class="op" id="1531473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531477">callerpc</span>&nbsp;<span class="op" id="1531486">:=</span>&nbsp;<span class="ident" id="1531489">getcallerpc</span><span class="op" id="1531500">(</span><span class="ident" id="1531501">unsafe</span><span class="op" id="1531507">.</span><span class="ident" id="1531508">Pointer</span><span class="op" id="1531515">(</span><span class="op" id="1531516">&amp;</span><span class="ident" id="1531517">t</span><span class="op" id="1531518">)</span><span class="op" id="1531519">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531523">racereadpc</span><span class="op" id="1531533">(</span><span class="ident" id="1531534">unsafe</span><span class="op" id="1531540">.</span><span class="ident" id="1531541">Pointer</span><span class="op" id="1531548">(</span><span class="ident" id="1531549">h</span><span class="op" id="1531550">)</span><span class="op" id="1531551">,</span>&nbsp;<span class="ident" id="1531553">callerpc</span><span class="op" id="1531561">,</span>&nbsp;<span class="ident" id="1531563">funcPC</span><span class="op" id="1531569">(</span><span class="ident" id="1531570">mapaccess2_fast64</span><span class="op" id="1531587">)</span><span class="op" id="1531588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531594">if</span>&nbsp;<span class="ident" id="1531597">h</span>&nbsp;<span class="op" id="1531599">==</span>&nbsp;<span class="builtintype" id="1531602">nil</span>&nbsp;<span class="op" id="1531606">||</span>&nbsp;<span class="ident" id="1531609">h</span><span class="op" id="1531610">.</span><span class="ident" id="1531611">count</span>&nbsp;<span class="op" id="1531617">==</span>&nbsp;<span class="num" id="1531620">0</span>&nbsp;<span class="op" id="1531622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531626">return</span>&nbsp;<span class="ident" id="1531633">unsafe</span><span class="op" id="1531639">.</span><span class="ident" id="1531640">Pointer</span><span class="op" id="1531647">(</span><span class="ident" id="1531648">t</span><span class="op" id="1531649">.</span><span class="ident" id="1531650">elem</span><span class="op" id="1531654">.</span><span class="ident" id="1531655">zero</span><span class="op" id="1531659">)</span><span class="op" id="1531660">,</span>&nbsp;<span class="builtintype" id="1531662">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531669">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531672">var</span>&nbsp;<span class="ident" id="1531676">b</span>&nbsp;<span class="op" id="1531678">*</span><span class="ident" id="1531679">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531685">if</span>&nbsp;<span class="ident" id="1531688">h</span><span class="op" id="1531689">.</span><span class="ident" id="1531690">B</span>&nbsp;<span class="op" id="1531692">==</span>&nbsp;<span class="num" id="1531695">0</span>&nbsp;<span class="op" id="1531697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1531701">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531742">b</span>&nbsp;<span class="op" id="1531744">=</span>&nbsp;<span class="op" id="1531746">(</span><span class="op" id="1531747">*</span><span class="ident" id="1531748">bmap</span><span class="op" id="1531752">)</span><span class="op" id="1531753">(</span><span class="ident" id="1531754">h</span><span class="op" id="1531755">.</span><span class="ident" id="1531756">buckets</span><span class="op" id="1531763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1531766">}</span>&nbsp;<span class="keyword" id="1531768">else</span>&nbsp;<span class="op" id="1531773">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531777">hash</span>&nbsp;<span class="op" id="1531782">:=</span>&nbsp;<span class="ident" id="1531785">goalg</span><span class="op" id="1531790">(</span><span class="ident" id="1531791">t</span><span class="op" id="1531792">.</span><span class="ident" id="1531793">key</span><span class="op" id="1531796">.</span><span class="ident" id="1531797">alg</span><span class="op" id="1531800">)</span><span class="op" id="1531801">.</span><span class="ident" id="1531802">hash</span><span class="op" id="1531806">(</span><span class="ident" id="1531807">noescape</span><span class="op" id="1531815">(</span><span class="ident" id="1531816">unsafe</span><span class="op" id="1531822">.</span><span class="ident" id="1531823">Pointer</span><span class="op" id="1531830">(</span><span class="op" id="1531831">&amp;</span><span class="ident" id="1531832">key</span><span class="op" id="1531835">)</span><span class="op" id="1531836">)</span><span class="op" id="1531837">,</span>&nbsp;<span class="num" id="1531839">8</span><span class="op" id="1531840">,</span>&nbsp;<span class="builtintype" id="1531842">uintptr</span><span class="op" id="1531849">(</span><span class="ident" id="1531850">h</span><span class="op" id="1531851">.</span><span class="ident" id="1531852">hash0</span><span class="op" id="1531857">)</span><span class="op" id="1531858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531862">m</span>&nbsp;<span class="op" id="1531864">:=</span>&nbsp;<span class="builtintype" id="1531867">uintptr</span><span class="op" id="1531874">(</span><span class="num" id="1531875">1</span><span class="op" id="1531876">)</span><span class="op" id="1531877">&lt;&lt;</span><span class="ident" id="1531879">h</span><span class="op" id="1531880">.</span><span class="ident" id="1531881">B</span>&nbsp;<span class="op" id="1531883">-</span>&nbsp;<span class="num" id="1531885">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531889">b</span>&nbsp;<span class="op" id="1531891">=</span>&nbsp;<span class="op" id="1531893">(</span><span class="op" id="1531894">*</span><span class="ident" id="1531895">bmap</span><span class="op" id="1531899">)</span><span class="op" id="1531900">(</span><span class="ident" id="1531901">add</span><span class="op" id="1531904">(</span><span class="ident" id="1531905">h</span><span class="op" id="1531906">.</span><span class="ident" id="1531907">buckets</span><span class="op" id="1531914">,</span>&nbsp;<span class="op" id="1531916">(</span><span class="ident" id="1531917">hash</span><span class="op" id="1531921">&amp;</span><span class="ident" id="1531922">m</span><span class="op" id="1531923">)</span><span class="op" id="1531924">*</span><span class="builtintype" id="1531925">uintptr</span><span class="op" id="1531932">(</span><span class="ident" id="1531933">t</span><span class="op" id="1531934">.</span><span class="ident" id="1531935">bucketsize</span><span class="op" id="1531945">)</span><span class="op" id="1531946">)</span><span class="op" id="1531947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1531951">if</span>&nbsp;<span class="ident" id="1531954">c</span>&nbsp;<span class="op" id="1531956">:=</span>&nbsp;<span class="ident" id="1531959">h</span><span class="op" id="1531960">.</span><span class="ident" id="1531961">oldbuckets</span><span class="op" id="1531971">;</span>&nbsp;<span class="ident" id="1531973">c</span>&nbsp;<span class="op" id="1531975">!=</span>&nbsp;<span class="builtintype" id="1531978">nil</span>&nbsp;<span class="op" id="1531982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1531987">oldb</span>&nbsp;<span class="op" id="1531992">:=</span>&nbsp;<span class="op" id="1531995">(</span><span class="op" id="1531996">*</span><span class="ident" id="1531997">bmap</span><span class="op" id="1532001">)</span><span class="op" id="1532002">(</span><span class="ident" id="1532003">add</span><span class="op" id="1532006">(</span><span class="ident" id="1532007">c</span><span class="op" id="1532008">,</span>&nbsp;<span class="op" id="1532010">(</span><span class="ident" id="1532011">hash</span><span class="op" id="1532015">&amp;</span><span class="op" id="1532016">(</span><span class="ident" id="1532017">m</span><span class="op" id="1532018">&gt;&gt;</span><span class="num" id="1532020">1</span><span class="op" id="1532021">)</span><span class="op" id="1532022">)</span><span class="op" id="1532023">*</span><span class="builtintype" id="1532024">uintptr</span><span class="op" id="1532031">(</span><span class="ident" id="1532032">t</span><span class="op" id="1532033">.</span><span class="ident" id="1532034">bucketsize</span><span class="op" id="1532044">)</span><span class="op" id="1532045">)</span><span class="op" id="1532046">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532051">if</span>&nbsp;<span class="op" id="1532054">!</span><span class="ident" id="1532055">evacuated</span><span class="op" id="1532064">(</span><span class="ident" id="1532065">oldb</span><span class="op" id="1532069">)</span>&nbsp;<span class="op" id="1532071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532077">b</span>&nbsp;<span class="op" id="1532079">=</span>&nbsp;<span class="ident" id="1532081">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532096">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532099">for</span>&nbsp;<span class="op" id="1532103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532107">for</span>&nbsp;<span class="ident" id="1532111">i</span>&nbsp;<span class="op" id="1532113">:=</span>&nbsp;<span class="builtintype" id="1532116">uintptr</span><span class="op" id="1532123">(</span><span class="num" id="1532124">0</span><span class="op" id="1532125">)</span><span class="op" id="1532126">;</span>&nbsp;<span class="ident" id="1532128">i</span>&nbsp;<span class="op" id="1532130">&lt;</span>&nbsp;<span class="ident" id="1532132">bucketCnt</span><span class="op" id="1532141">;</span>&nbsp;<span class="ident" id="1532143">i</span><span class="op" id="1532144">++</span>&nbsp;<span class="op" id="1532147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532152">k</span>&nbsp;<span class="op" id="1532154">:=</span>&nbsp;<span class="op" id="1532157">*</span><span class="op" id="1532158">(</span><span class="op" id="1532159">(</span><span class="op" id="1532160">*</span><span class="ident" id="1532161">uint64</span><span class="op" id="1532167">)</span><span class="op" id="1532168">(</span><span class="ident" id="1532169">add</span><span class="op" id="1532172">(</span><span class="ident" id="1532173">unsafe</span><span class="op" id="1532179">.</span><span class="ident" id="1532180">Pointer</span><span class="op" id="1532187">(</span><span class="ident" id="1532188">b</span><span class="op" id="1532189">)</span><span class="op" id="1532190">,</span>&nbsp;<span class="ident" id="1532192">dataOffset</span><span class="op" id="1532202">+</span><span class="ident" id="1532203">i</span><span class="op" id="1532204">*</span><span class="num" id="1532205">8</span><span class="op" id="1532206">)</span><span class="op" id="1532207">)</span><span class="op" id="1532208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532213">if</span>&nbsp;<span class="ident" id="1532216">k</span>&nbsp;<span class="op" id="1532218">!=</span>&nbsp;<span class="ident" id="1532221">key</span>&nbsp;<span class="op" id="1532225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532231">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532248">x</span>&nbsp;<span class="op" id="1532250">:=</span>&nbsp;<span class="op" id="1532253">*</span><span class="op" id="1532254">(</span><span class="op" id="1532255">(</span><span class="op" id="1532256">*</span><span class="builtintype" id="1532257">uint8</span><span class="op" id="1532262">)</span><span class="op" id="1532263">(</span><span class="ident" id="1532264">add</span><span class="op" id="1532267">(</span><span class="ident" id="1532268">unsafe</span><span class="op" id="1532274">.</span><span class="ident" id="1532275">Pointer</span><span class="op" id="1532282">(</span><span class="ident" id="1532283">b</span><span class="op" id="1532284">)</span><span class="op" id="1532285">,</span>&nbsp;<span class="ident" id="1532287">i</span><span class="op" id="1532288">)</span><span class="op" id="1532289">)</span><span class="op" id="1532290">)</span>&nbsp;<span class="comment" id="1532292">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532336">if</span>&nbsp;<span class="ident" id="1532339">x</span>&nbsp;<span class="op" id="1532341">==</span>&nbsp;<span class="ident" id="1532344">empty</span>&nbsp;<span class="op" id="1532350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532356">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532368">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532373">return</span>&nbsp;<span class="ident" id="1532380">add</span><span class="op" id="1532383">(</span><span class="ident" id="1532384">unsafe</span><span class="op" id="1532390">.</span><span class="ident" id="1532391">Pointer</span><span class="op" id="1532398">(</span><span class="ident" id="1532399">b</span><span class="op" id="1532400">)</span><span class="op" id="1532401">,</span>&nbsp;<span class="ident" id="1532403">dataOffset</span><span class="op" id="1532413">+</span><span class="ident" id="1532414">bucketCnt</span><span class="op" id="1532423">*</span><span class="num" id="1532424">8</span><span class="op" id="1532425">+</span><span class="ident" id="1532426">i</span><span class="op" id="1532427">*</span><span class="builtintype" id="1532428">uintptr</span><span class="op" id="1532435">(</span><span class="ident" id="1532436">t</span><span class="op" id="1532437">.</span><span class="ident" id="1532438">valuesize</span><span class="op" id="1532447">)</span><span class="op" id="1532448">)</span><span class="op" id="1532449">,</span>&nbsp;<span class="builtintype" id="1532451">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532462">b</span>&nbsp;<span class="op" id="1532464">=</span>&nbsp;<span class="ident" id="1532466">b</span><span class="op" id="1532467">.</span><span class="ident" id="1532468">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532479">if</span>&nbsp;<span class="ident" id="1532482">b</span>&nbsp;<span class="op" id="1532484">==</span>&nbsp;<span class="builtintype" id="1532487">nil</span>&nbsp;<span class="op" id="1532491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532496">return</span>&nbsp;<span class="ident" id="1532503">unsafe</span><span class="op" id="1532509">.</span><span class="ident" id="1532510">Pointer</span><span class="op" id="1532517">(</span><span class="ident" id="1532518">t</span><span class="op" id="1532519">.</span><span class="ident" id="1532520">elem</span><span class="op" id="1532524">.</span><span class="ident" id="1532525">zero</span><span class="op" id="1532529">)</span><span class="op" id="1532530">,</span>&nbsp;<span class="builtintype" id="1532532">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532543">}</span><br>
<span class="lineno"></span><span class="op" id="1532545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1532548">func</span>&nbsp;<span class="ident" id="1532553">mapaccess1_faststr</span><span class="op" id="1532571">(</span><span class="ident" id="1532572">t</span>&nbsp;<span class="op" id="1532574">*</span><span class="ident" id="1532575">maptype</span><span class="op" id="1532582">,</span>&nbsp;<span class="ident" id="1532584">h</span>&nbsp;<span class="op" id="1532586">*</span><span class="ident" id="1532587">hmap</span><span class="op" id="1532591">,</span>&nbsp;<span class="ident" id="1532593">ky</span>&nbsp;<span class="builtintype" id="1532596">string</span><span class="op" id="1532602">)</span>&nbsp;<span class="ident" id="1532604">unsafe</span><span class="op" id="1532610">.</span><span class="ident" id="1532611">Pointer</span>&nbsp;<span class="op" id="1532619">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532622">if</span>&nbsp;<span class="ident" id="1532625">raceenabled</span>&nbsp;<span class="op" id="1532637">&amp;&amp;</span>&nbsp;<span class="ident" id="1532640">h</span>&nbsp;<span class="op" id="1532642">!=</span>&nbsp;<span class="builtintype" id="1532645">nil</span>&nbsp;<span class="op" id="1532649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532653">callerpc</span>&nbsp;<span class="op" id="1532662">:=</span>&nbsp;<span class="ident" id="1532665">getcallerpc</span><span class="op" id="1532676">(</span><span class="ident" id="1532677">unsafe</span><span class="op" id="1532683">.</span><span class="ident" id="1532684">Pointer</span><span class="op" id="1532691">(</span><span class="op" id="1532692">&amp;</span><span class="ident" id="1532693">t</span><span class="op" id="1532694">)</span><span class="op" id="1532695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532699">racereadpc</span><span class="op" id="1532709">(</span><span class="ident" id="1532710">unsafe</span><span class="op" id="1532716">.</span><span class="ident" id="1532717">Pointer</span><span class="op" id="1532724">(</span><span class="ident" id="1532725">h</span><span class="op" id="1532726">)</span><span class="op" id="1532727">,</span>&nbsp;<span class="ident" id="1532729">callerpc</span><span class="op" id="1532737">,</span>&nbsp;<span class="ident" id="1532739">funcPC</span><span class="op" id="1532745">(</span><span class="ident" id="1532746">mapaccess1_faststr</span><span class="op" id="1532764">)</span><span class="op" id="1532765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532771">if</span>&nbsp;<span class="ident" id="1532774">h</span>&nbsp;<span class="op" id="1532776">==</span>&nbsp;<span class="builtintype" id="1532779">nil</span>&nbsp;<span class="op" id="1532783">||</span>&nbsp;<span class="ident" id="1532786">h</span><span class="op" id="1532787">.</span><span class="ident" id="1532788">count</span>&nbsp;<span class="op" id="1532794">==</span>&nbsp;<span class="num" id="1532797">0</span>&nbsp;<span class="op" id="1532799">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532803">return</span>&nbsp;<span class="ident" id="1532810">unsafe</span><span class="op" id="1532816">.</span><span class="ident" id="1532817">Pointer</span><span class="op" id="1532824">(</span><span class="ident" id="1532825">t</span><span class="op" id="1532826">.</span><span class="ident" id="1532827">elem</span><span class="op" id="1532831">.</span><span class="ident" id="1532832">zero</span><span class="op" id="1532836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1532839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532842">key</span>&nbsp;<span class="op" id="1532846">:=</span>&nbsp;<span class="op" id="1532849">(</span><span class="op" id="1532850">*</span><span class="ident" id="1532851">stringStruct</span><span class="op" id="1532863">)</span><span class="op" id="1532864">(</span><span class="ident" id="1532865">unsafe</span><span class="op" id="1532871">.</span><span class="ident" id="1532872">Pointer</span><span class="op" id="1532879">(</span><span class="op" id="1532880">&amp;</span><span class="ident" id="1532881">ky</span><span class="op" id="1532883">)</span><span class="op" id="1532884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532887">if</span>&nbsp;<span class="ident" id="1532890">h</span><span class="op" id="1532891">.</span><span class="ident" id="1532892">B</span>&nbsp;<span class="op" id="1532894">==</span>&nbsp;<span class="num" id="1532897">0</span>&nbsp;<span class="op" id="1532899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1532903">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1532926">b</span>&nbsp;<span class="op" id="1532928">:=</span>&nbsp;<span class="op" id="1532931">(</span><span class="op" id="1532932">*</span><span class="ident" id="1532933">bmap</span><span class="op" id="1532937">)</span><span class="op" id="1532938">(</span><span class="ident" id="1532939">h</span><span class="op" id="1532940">.</span><span class="ident" id="1532941">buckets</span><span class="op" id="1532948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1532952">if</span>&nbsp;<span class="ident" id="1532955">key</span><span class="op" id="1532958">.</span><span class="builtinfunc" id="1532959">len</span>&nbsp;<span class="op" id="1532963">&lt;</span>&nbsp;<span class="num" id="1532965">32</span>&nbsp;<span class="op" id="1532968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1532973">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533022">for</span>&nbsp;<span class="ident" id="1533026">i</span>&nbsp;<span class="op" id="1533028">:=</span>&nbsp;<span class="builtintype" id="1533031">uintptr</span><span class="op" id="1533038">(</span><span class="num" id="1533039">0</span><span class="op" id="1533040">)</span><span class="op" id="1533041">;</span>&nbsp;<span class="ident" id="1533043">i</span>&nbsp;<span class="op" id="1533045">&lt;</span>&nbsp;<span class="ident" id="1533047">bucketCnt</span><span class="op" id="1533056">;</span>&nbsp;<span class="ident" id="1533058">i</span><span class="op" id="1533059">++</span>&nbsp;<span class="op" id="1533062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1533068">x</span>&nbsp;<span class="op" id="1533070">:=</span>&nbsp;<span class="op" id="1533073">*</span><span class="op" id="1533074">(</span><span class="op" id="1533075">(</span><span class="op" id="1533076">*</span><span class="builtintype" id="1533077">uint8</span><span class="op" id="1533082">)</span><span class="op" id="1533083">(</span><span class="ident" id="1533084">add</span><span class="op" id="1533087">(</span><span class="ident" id="1533088">unsafe</span><span class="op" id="1533094">.</span><span class="ident" id="1533095">Pointer</span><span class="op" id="1533102">(</span><span class="ident" id="1533103">b</span><span class="op" id="1533104">)</span><span class="op" id="1533105">,</span>&nbsp;<span class="ident" id="1533107">i</span><span class="op" id="1533108">)</span><span class="op" id="1533109">)</span><span class="op" id="1533110">)</span>&nbsp;<span class="comment" id="1533112">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533157">if</span>&nbsp;<span class="ident" id="1533160">x</span>&nbsp;<span class="op" id="1533162">==</span>&nbsp;<span class="ident" id="1533165">empty</span>&nbsp;<span class="op" id="1533171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533178">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1533197">k</span>&nbsp;<span class="op" id="1533199">:=</span>&nbsp;<span class="op" id="1533202">(</span><span class="op" id="1533203">*</span><span class="ident" id="1533204">stringStruct</span><span class="op" id="1533216">)</span><span class="op" id="1533217">(</span><span class="ident" id="1533218">add</span><span class="op" id="1533221">(</span><span class="ident" id="1533222">unsafe</span><span class="op" id="1533228">.</span><span class="ident" id="1533229">Pointer</span><span class="op" id="1533236">(</span><span class="ident" id="1533237">b</span><span class="op" id="1533238">)</span><span class="op" id="1533239">,</span>&nbsp;<span class="ident" id="1533241">dataOffset</span><span class="op" id="1533251">+</span><span class="ident" id="1533252">i</span><span class="op" id="1533253">*</span><span class="num" id="1533254">2</span><span class="op" id="1533255">*</span><span class="ident" id="1533256">ptrSize</span><span class="op" id="1533263">)</span><span class="op" id="1533264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533270">if</span>&nbsp;<span class="ident" id="1533273">k</span><span class="op" id="1533274">.</span><span class="builtinfunc" id="1533275">len</span>&nbsp;<span class="op" id="1533279">!=</span>&nbsp;<span class="ident" id="1533282">key</span><span class="op" id="1533285">.</span><span class="builtinfunc" id="1533286">len</span>&nbsp;<span class="op" id="1533290">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533297">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533316">if</span>&nbsp;<span class="ident" id="1533319">k</span><span class="op" id="1533320">.</span><span class="ident" id="1533321">str</span>&nbsp;<span class="op" id="1533325">==</span>&nbsp;<span class="ident" id="1533328">key</span><span class="op" id="1533331">.</span><span class="ident" id="1533332">str</span>&nbsp;<span class="op" id="1533336">||</span>&nbsp;<span class="ident" id="1533339">memeq</span><span class="op" id="1533344">(</span><span class="ident" id="1533345">k</span><span class="op" id="1533346">.</span><span class="ident" id="1533347">str</span><span class="op" id="1533350">,</span>&nbsp;<span class="ident" id="1533352">key</span><span class="op" id="1533355">.</span><span class="ident" id="1533356">str</span><span class="op" id="1533359">,</span>&nbsp;<span class="builtintype" id="1533361">uintptr</span><span class="op" id="1533368">(</span><span class="ident" id="1533369">key</span><span class="op" id="1533372">.</span><span class="builtinfunc" id="1533373">len</span><span class="op" id="1533376">)</span><span class="op" id="1533377">)</span>&nbsp;<span class="op" id="1533379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533386">return</span>&nbsp;<span class="ident" id="1533393">add</span><span class="op" id="1533396">(</span><span class="ident" id="1533397">unsafe</span><span class="op" id="1533403">.</span><span class="ident" id="1533404">Pointer</span><span class="op" id="1533411">(</span><span class="ident" id="1533412">b</span><span class="op" id="1533413">)</span><span class="op" id="1533414">,</span>&nbsp;<span class="ident" id="1533416">dataOffset</span><span class="op" id="1533426">+</span><span class="ident" id="1533427">bucketCnt</span><span class="op" id="1533436">*</span><span class="num" id="1533437">2</span><span class="op" id="1533438">*</span><span class="ident" id="1533439">ptrSize</span><span class="op" id="1533446">+</span><span class="ident" id="1533447">i</span><span class="op" id="1533448">*</span><span class="builtintype" id="1533449">uintptr</span><span class="op" id="1533456">(</span><span class="ident" id="1533457">t</span><span class="op" id="1533458">.</span><span class="ident" id="1533459">valuesize</span><span class="op" id="1533468">)</span><span class="op" id="1533469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533475">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533485">return</span>&nbsp;<span class="ident" id="1533492">unsafe</span><span class="op" id="1533498">.</span><span class="ident" id="1533499">Pointer</span><span class="op" id="1533506">(</span><span class="ident" id="1533507">t</span><span class="op" id="1533508">.</span><span class="ident" id="1533509">elem</span><span class="op" id="1533513">.</span><span class="ident" id="1533514">zero</span><span class="op" id="1533518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1533526">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1533587">keymaybe</span>&nbsp;<span class="op" id="1533596">:=</span>&nbsp;<span class="builtintype" id="1533599">uintptr</span><span class="op" id="1533606">(</span><span class="ident" id="1533607">bucketCnt</span><span class="op" id="1533616">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533620">for</span>&nbsp;<span class="ident" id="1533624">i</span>&nbsp;<span class="op" id="1533626">:=</span>&nbsp;<span class="builtintype" id="1533629">uintptr</span><span class="op" id="1533636">(</span><span class="num" id="1533637">0</span><span class="op" id="1533638">)</span><span class="op" id="1533639">;</span>&nbsp;<span class="ident" id="1533641">i</span>&nbsp;<span class="op" id="1533643">&lt;</span>&nbsp;<span class="ident" id="1533645">bucketCnt</span><span class="op" id="1533654">;</span>&nbsp;<span class="ident" id="1533656">i</span><span class="op" id="1533657">++</span>&nbsp;<span class="op" id="1533660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1533665">x</span>&nbsp;<span class="op" id="1533667">:=</span>&nbsp;<span class="op" id="1533670">*</span><span class="op" id="1533671">(</span><span class="op" id="1533672">(</span><span class="op" id="1533673">*</span><span class="builtintype" id="1533674">uint8</span><span class="op" id="1533679">)</span><span class="op" id="1533680">(</span><span class="ident" id="1533681">add</span><span class="op" id="1533684">(</span><span class="ident" id="1533685">unsafe</span><span class="op" id="1533691">.</span><span class="ident" id="1533692">Pointer</span><span class="op" id="1533699">(</span><span class="ident" id="1533700">b</span><span class="op" id="1533701">)</span><span class="op" id="1533702">,</span>&nbsp;<span class="ident" id="1533704">i</span><span class="op" id="1533705">)</span><span class="op" id="1533706">)</span><span class="op" id="1533707">)</span>&nbsp;<span class="comment" id="1533709">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533753">if</span>&nbsp;<span class="ident" id="1533756">x</span>&nbsp;<span class="op" id="1533758">==</span>&nbsp;<span class="ident" id="1533761">empty</span>&nbsp;<span class="op" id="1533767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533773">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533785">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1533790">k</span>&nbsp;<span class="op" id="1533792">:=</span>&nbsp;<span class="op" id="1533795">(</span><span class="op" id="1533796">*</span><span class="ident" id="1533797">stringStruct</span><span class="op" id="1533809">)</span><span class="op" id="1533810">(</span><span class="ident" id="1533811">add</span><span class="op" id="1533814">(</span><span class="ident" id="1533815">unsafe</span><span class="op" id="1533821">.</span><span class="ident" id="1533822">Pointer</span><span class="op" id="1533829">(</span><span class="ident" id="1533830">b</span><span class="op" id="1533831">)</span><span class="op" id="1533832">,</span>&nbsp;<span class="ident" id="1533834">dataOffset</span><span class="op" id="1533844">+</span><span class="ident" id="1533845">i</span><span class="op" id="1533846">*</span><span class="num" id="1533847">2</span><span class="op" id="1533848">*</span><span class="ident" id="1533849">ptrSize</span><span class="op" id="1533856">)</span><span class="op" id="1533857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533862">if</span>&nbsp;<span class="ident" id="1533865">k</span><span class="op" id="1533866">.</span><span class="builtinfunc" id="1533867">len</span>&nbsp;<span class="op" id="1533871">!=</span>&nbsp;<span class="ident" id="1533874">key</span><span class="op" id="1533877">.</span><span class="builtinfunc" id="1533878">len</span>&nbsp;<span class="op" id="1533882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533888">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1533900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533905">if</span>&nbsp;<span class="ident" id="1533908">k</span><span class="op" id="1533909">.</span><span class="ident" id="1533910">str</span>&nbsp;<span class="op" id="1533914">==</span>&nbsp;<span class="ident" id="1533917">key</span><span class="op" id="1533920">.</span><span class="ident" id="1533921">str</span>&nbsp;<span class="op" id="1533925">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1533931">return</span>&nbsp;<span class="ident" id="1533938">add</span><span class="op" id="1533941">(</span><span class="ident" id="1533942">unsafe</span><span class="op" id="1533948">.</span><span class="ident" id="1533949">Pointer</span><span class="op" id="1533956">(</span><span class="ident" id="1533957">b</span><span class="op" id="1533958">)</span><span class="op" id="1533959">,</span>&nbsp;<span class="ident" id="1533961">dataOffset</span><span class="op" id="1533971">+</span><span class="ident" id="1533972">bucketCnt</span><span class="op" id="1533981">*</span><span class="num" id="1533982">2</span><span class="op" id="1533983">*</span><span class="ident" id="1533984">ptrSize</span><span class="op" id="1533991">+</span><span class="ident" id="1533992">i</span><span class="op" id="1533993">*</span><span class="builtintype" id="1533994">uintptr</span><span class="op" id="1534001">(</span><span class="ident" id="1534002">t</span><span class="op" id="1534003">.</span><span class="ident" id="1534004">valuesize</span><span class="op" id="1534013">)</span><span class="op" id="1534014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1534024">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1534050">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1534139">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534170">if</span>&nbsp;<span class="op" id="1534173">*</span><span class="op" id="1534174">(</span><span class="op" id="1534175">(</span><span class="op" id="1534176">*</span><span class="op" id="1534177">[</span><span class="num" id="1534178">4</span><span class="op" id="1534179">]</span><span class="builtintype" id="1534180">byte</span><span class="op" id="1534184">)</span><span class="op" id="1534185">(</span><span class="ident" id="1534186">key</span><span class="op" id="1534189">.</span><span class="ident" id="1534190">str</span><span class="op" id="1534193">)</span><span class="op" id="1534194">)</span>&nbsp;<span class="op" id="1534196">!=</span>&nbsp;<span class="op" id="1534199">*</span><span class="op" id="1534200">(</span><span class="op" id="1534201">(</span><span class="op" id="1534202">*</span><span class="op" id="1534203">[</span><span class="num" id="1534204">4</span><span class="op" id="1534205">]</span><span class="builtintype" id="1534206">byte</span><span class="op" id="1534210">)</span><span class="op" id="1534211">(</span><span class="ident" id="1534212">k</span><span class="op" id="1534213">.</span><span class="ident" id="1534214">str</span><span class="op" id="1534217">)</span><span class="op" id="1534218">)</span>&nbsp;<span class="op" id="1534220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534226">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1534243">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534268">if</span>&nbsp;<span class="op" id="1534271">*</span><span class="op" id="1534272">(</span><span class="op" id="1534273">(</span><span class="op" id="1534274">*</span><span class="op" id="1534275">[</span><span class="num" id="1534276">4</span><span class="op" id="1534277">]</span><span class="builtintype" id="1534278">byte</span><span class="op" id="1534282">)</span><span class="op" id="1534283">(</span><span class="ident" id="1534284">add</span><span class="op" id="1534287">(</span><span class="ident" id="1534288">key</span><span class="op" id="1534291">.</span><span class="ident" id="1534292">str</span><span class="op" id="1534295">,</span>&nbsp;<span class="builtintype" id="1534297">uintptr</span><span class="op" id="1534304">(</span><span class="ident" id="1534305">key</span><span class="op" id="1534308">.</span><span class="builtinfunc" id="1534309">len</span><span class="op" id="1534312">)</span><span class="op" id="1534313">-</span><span class="num" id="1534314">4</span><span class="op" id="1534315">)</span><span class="op" id="1534316">)</span><span class="op" id="1534317">)</span>&nbsp;<span class="op" id="1534319">!=</span>&nbsp;<span class="op" id="1534322">*</span><span class="op" id="1534323">(</span><span class="op" id="1534324">(</span><span class="op" id="1534325">*</span><span class="op" id="1534326">[</span><span class="num" id="1534327">4</span><span class="op" id="1534328">]</span><span class="builtintype" id="1534329">byte</span><span class="op" id="1534333">)</span><span class="op" id="1534334">(</span><span class="ident" id="1534335">add</span><span class="op" id="1534338">(</span><span class="ident" id="1534339">k</span><span class="op" id="1534340">.</span><span class="ident" id="1534341">str</span><span class="op" id="1534344">,</span>&nbsp;<span class="builtintype" id="1534346">uintptr</span><span class="op" id="1534353">(</span><span class="ident" id="1534354">key</span><span class="op" id="1534357">.</span><span class="builtinfunc" id="1534358">len</span><span class="op" id="1534361">)</span><span class="op" id="1534362">-</span><span class="num" id="1534363">4</span><span class="op" id="1534364">)</span><span class="op" id="1534365">)</span><span class="op" id="1534366">)</span>&nbsp;<span class="op" id="1534368">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534374">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534391">if</span>&nbsp;<span class="ident" id="1534394">keymaybe</span>&nbsp;<span class="op" id="1534403">!=</span>&nbsp;<span class="ident" id="1534406">bucketCnt</span>&nbsp;<span class="op" id="1534416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1534422">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534492">goto</span>&nbsp;<span class="ident" id="1534497">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1534512">keymaybe</span>&nbsp;<span class="op" id="1534521">=</span>&nbsp;<span class="ident" id="1534523">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534531">if</span>&nbsp;<span class="ident" id="1534534">keymaybe</span>&nbsp;<span class="op" id="1534543">!=</span>&nbsp;<span class="ident" id="1534546">bucketCnt</span>&nbsp;<span class="op" id="1534556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1534561">k</span>&nbsp;<span class="op" id="1534563">:=</span>&nbsp;<span class="op" id="1534566">(</span><span class="op" id="1534567">*</span><span class="ident" id="1534568">stringStruct</span><span class="op" id="1534580">)</span><span class="op" id="1534581">(</span><span class="ident" id="1534582">add</span><span class="op" id="1534585">(</span><span class="ident" id="1534586">unsafe</span><span class="op" id="1534592">.</span><span class="ident" id="1534593">Pointer</span><span class="op" id="1534600">(</span><span class="ident" id="1534601">b</span><span class="op" id="1534602">)</span><span class="op" id="1534603">,</span>&nbsp;<span class="ident" id="1534605">dataOffset</span><span class="op" id="1534615">+</span><span class="ident" id="1534616">keymaybe</span><span class="op" id="1534624">*</span><span class="num" id="1534625">2</span><span class="op" id="1534626">*</span><span class="ident" id="1534627">ptrSize</span><span class="op" id="1534634">)</span><span class="op" id="1534635">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534640">if</span>&nbsp;<span class="ident" id="1534643">memeq</span><span class="op" id="1534648">(</span><span class="ident" id="1534649">k</span><span class="op" id="1534650">.</span><span class="ident" id="1534651">str</span><span class="op" id="1534654">,</span>&nbsp;<span class="ident" id="1534656">key</span><span class="op" id="1534659">.</span><span class="ident" id="1534660">str</span><span class="op" id="1534663">,</span>&nbsp;<span class="builtintype" id="1534665">uintptr</span><span class="op" id="1534672">(</span><span class="ident" id="1534673">key</span><span class="op" id="1534676">.</span><span class="builtinfunc" id="1534677">len</span><span class="op" id="1534680">)</span><span class="op" id="1534681">)</span>&nbsp;<span class="op" id="1534683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534689">return</span>&nbsp;<span class="ident" id="1534696">add</span><span class="op" id="1534699">(</span><span class="ident" id="1534700">unsafe</span><span class="op" id="1534706">.</span><span class="ident" id="1534707">Pointer</span><span class="op" id="1534714">(</span><span class="ident" id="1534715">b</span><span class="op" id="1534716">)</span><span class="op" id="1534717">,</span>&nbsp;<span class="ident" id="1534719">dataOffset</span><span class="op" id="1534729">+</span><span class="ident" id="1534730">bucketCnt</span><span class="op" id="1534739">*</span><span class="num" id="1534740">2</span><span class="op" id="1534741">*</span><span class="ident" id="1534742">ptrSize</span><span class="op" id="1534749">+</span><span class="ident" id="1534750">keymaybe</span><span class="op" id="1534758">*</span><span class="builtintype" id="1534759">uintptr</span><span class="op" id="1534766">(</span><span class="ident" id="1534767">t</span><span class="op" id="1534768">.</span><span class="ident" id="1534769">valuesize</span><span class="op" id="1534778">)</span><span class="op" id="1534779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1534792">return</span>&nbsp;<span class="ident" id="1534799">unsafe</span><span class="op" id="1534805">.</span><span class="ident" id="1534806">Pointer</span><span class="op" id="1534813">(</span><span class="ident" id="1534814">t</span><span class="op" id="1534815">.</span><span class="ident" id="1534816">elem</span><span class="op" id="1534820">.</span><span class="ident" id="1534821">zero</span><span class="op" id="1534825">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1534828">}</span><br>
<span class="lineno"></span><span class="ident" id="1534830">dohash</span><span class="op" id="1534836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1534839">hash</span>&nbsp;<span class="op" id="1534844">:=</span>&nbsp;<span class="ident" id="1534847">goalg</span><span class="op" id="1534852">(</span><span class="ident" id="1534853">t</span><span class="op" id="1534854">.</span><span class="ident" id="1534855">key</span><span class="op" id="1534858">.</span><span class="ident" id="1534859">alg</span><span class="op" id="1534862">)</span><span class="op" id="1534863">.</span><span class="ident" id="1534864">hash</span><span class="op" id="1534868">(</span><span class="ident" id="1534869">noescape</span><span class="op" id="1534877">(</span><span class="ident" id="1534878">unsafe</span><span class="op" id="1534884">.</span><span class="ident" id="1534885">Pointer</span><span class="op" id="1534892">(</span><span class="op" id="1534893">&amp;</span><span class="ident" id="1534894">ky</span><span class="op" id="1534896">)</span><span class="op" id="1534897">)</span><span class="op" id="1534898">,</span>&nbsp;<span class="num" id="1534900">2</span><span class="op" id="1534901">*</span><span class="ident" id="1534902">ptrSize</span><span class="op" id="1534909">,</span>&nbsp;<span class="builtintype" id="1534911">uintptr</span><span class="op" id="1534918">(</span><span class="ident" id="1534919">h</span><span class="op" id="1534920">.</span><span class="ident" id="1534921">hash0</span><span class="op" id="1534926">)</span><span class="op" id="1534927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1534930">m</span>&nbsp;<span class="op" id="1534932">:=</span>&nbsp;<span class="builtintype" id="1534935">uintptr</span><span class="op" id="1534942">(</span><span class="num" id="1534943">1</span><span class="op" id="1534944">)</span><span class="op" id="1534945">&lt;&lt;</span><span class="ident" id="1534947">h</span><span class="op" id="1534948">.</span><span class="ident" id="1534949">B</span>&nbsp;<span class="op" id="1534951">-</span>&nbsp;<span class="num" id="1534953">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1534956">b</span>&nbsp;<span class="op" id="1534958">:=</span>&nbsp;<span class="op" id="1534961">(</span><span class="op" id="1534962">*</span><span class="ident" id="1534963">bmap</span><span class="op" id="1534967">)</span><span class="op" id="1534968">(</span><span class="ident" id="1534969">add</span><span class="op" id="1534972">(</span><span class="ident" id="1534973">h</span><span class="op" id="1534974">.</span><span class="ident" id="1534975">buckets</span><span class="op" id="1534982">,</span>&nbsp;<span class="op" id="1534984">(</span><span class="ident" id="1534985">hash</span><span class="op" id="1534989">&amp;</span><span class="ident" id="1534990">m</span><span class="op" id="1534991">)</span><span class="op" id="1534992">*</span><span class="builtintype" id="1534993">uintptr</span><span class="op" id="1535000">(</span><span class="ident" id="1535001">t</span><span class="op" id="1535002">.</span><span class="ident" id="1535003">bucketsize</span><span class="op" id="1535013">)</span><span class="op" id="1535014">)</span><span class="op" id="1535015">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535018">if</span>&nbsp;<span class="ident" id="1535021">c</span>&nbsp;<span class="op" id="1535023">:=</span>&nbsp;<span class="ident" id="1535026">h</span><span class="op" id="1535027">.</span><span class="ident" id="1535028">oldbuckets</span><span class="op" id="1535038">;</span>&nbsp;<span class="ident" id="1535040">c</span>&nbsp;<span class="op" id="1535042">!=</span>&nbsp;<span class="builtintype" id="1535045">nil</span>&nbsp;<span class="op" id="1535049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535053">oldb</span>&nbsp;<span class="op" id="1535058">:=</span>&nbsp;<span class="op" id="1535061">(</span><span class="op" id="1535062">*</span><span class="ident" id="1535063">bmap</span><span class="op" id="1535067">)</span><span class="op" id="1535068">(</span><span class="ident" id="1535069">add</span><span class="op" id="1535072">(</span><span class="ident" id="1535073">c</span><span class="op" id="1535074">,</span>&nbsp;<span class="op" id="1535076">(</span><span class="ident" id="1535077">hash</span><span class="op" id="1535081">&amp;</span><span class="op" id="1535082">(</span><span class="ident" id="1535083">m</span><span class="op" id="1535084">&gt;&gt;</span><span class="num" id="1535086">1</span><span class="op" id="1535087">)</span><span class="op" id="1535088">)</span><span class="op" id="1535089">*</span><span class="builtintype" id="1535090">uintptr</span><span class="op" id="1535097">(</span><span class="ident" id="1535098">t</span><span class="op" id="1535099">.</span><span class="ident" id="1535100">bucketsize</span><span class="op" id="1535110">)</span><span class="op" id="1535111">)</span><span class="op" id="1535112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535116">if</span>&nbsp;<span class="op" id="1535119">!</span><span class="ident" id="1535120">evacuated</span><span class="op" id="1535129">(</span><span class="ident" id="1535130">oldb</span><span class="op" id="1535134">)</span>&nbsp;<span class="op" id="1535136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535141">b</span>&nbsp;<span class="op" id="1535143">=</span>&nbsp;<span class="ident" id="1535145">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535152">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535158">top</span>&nbsp;<span class="op" id="1535162">:=</span>&nbsp;<span class="builtintype" id="1535165">uint8</span><span class="op" id="1535170">(</span><span class="ident" id="1535171">hash</span>&nbsp;<span class="op" id="1535176">&gt;&gt;</span>&nbsp;<span class="op" id="1535179">(</span><span class="ident" id="1535180">ptrSize</span><span class="op" id="1535187">*</span><span class="num" id="1535188">8</span>&nbsp;<span class="op" id="1535190">-</span>&nbsp;<span class="num" id="1535192">8</span><span class="op" id="1535193">)</span><span class="op" id="1535194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535197">if</span>&nbsp;<span class="ident" id="1535200">top</span>&nbsp;<span class="op" id="1535204">&lt;</span>&nbsp;<span class="ident" id="1535206">minTopHash</span>&nbsp;<span class="op" id="1535217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535221">top</span>&nbsp;<span class="op" id="1535225">+=</span>&nbsp;<span class="ident" id="1535228">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535240">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535243">for</span>&nbsp;<span class="op" id="1535247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535251">for</span>&nbsp;<span class="ident" id="1535255">i</span>&nbsp;<span class="op" id="1535257">:=</span>&nbsp;<span class="builtintype" id="1535260">uintptr</span><span class="op" id="1535267">(</span><span class="num" id="1535268">0</span><span class="op" id="1535269">)</span><span class="op" id="1535270">;</span>&nbsp;<span class="ident" id="1535272">i</span>&nbsp;<span class="op" id="1535274">&lt;</span>&nbsp;<span class="ident" id="1535276">bucketCnt</span><span class="op" id="1535285">;</span>&nbsp;<span class="ident" id="1535287">i</span><span class="op" id="1535288">++</span>&nbsp;<span class="op" id="1535291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535296">x</span>&nbsp;<span class="op" id="1535298">:=</span>&nbsp;<span class="op" id="1535301">*</span><span class="op" id="1535302">(</span><span class="op" id="1535303">(</span><span class="op" id="1535304">*</span><span class="builtintype" id="1535305">uint8</span><span class="op" id="1535310">)</span><span class="op" id="1535311">(</span><span class="ident" id="1535312">add</span><span class="op" id="1535315">(</span><span class="ident" id="1535316">unsafe</span><span class="op" id="1535322">.</span><span class="ident" id="1535323">Pointer</span><span class="op" id="1535330">(</span><span class="ident" id="1535331">b</span><span class="op" id="1535332">)</span><span class="op" id="1535333">,</span>&nbsp;<span class="ident" id="1535335">i</span><span class="op" id="1535336">)</span><span class="op" id="1535337">)</span><span class="op" id="1535338">)</span>&nbsp;<span class="comment" id="1535340">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535384">if</span>&nbsp;<span class="ident" id="1535387">x</span>&nbsp;<span class="op" id="1535389">!=</span>&nbsp;<span class="ident" id="1535392">top</span>&nbsp;<span class="op" id="1535396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535402">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535419">k</span>&nbsp;<span class="op" id="1535421">:=</span>&nbsp;<span class="op" id="1535424">(</span><span class="op" id="1535425">*</span><span class="ident" id="1535426">stringStruct</span><span class="op" id="1535438">)</span><span class="op" id="1535439">(</span><span class="ident" id="1535440">add</span><span class="op" id="1535443">(</span><span class="ident" id="1535444">unsafe</span><span class="op" id="1535450">.</span><span class="ident" id="1535451">Pointer</span><span class="op" id="1535458">(</span><span class="ident" id="1535459">b</span><span class="op" id="1535460">)</span><span class="op" id="1535461">,</span>&nbsp;<span class="ident" id="1535463">dataOffset</span><span class="op" id="1535473">+</span><span class="ident" id="1535474">i</span><span class="op" id="1535475">*</span><span class="num" id="1535476">2</span><span class="op" id="1535477">*</span><span class="ident" id="1535478">ptrSize</span><span class="op" id="1535485">)</span><span class="op" id="1535486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535491">if</span>&nbsp;<span class="ident" id="1535494">k</span><span class="op" id="1535495">.</span><span class="builtinfunc" id="1535496">len</span>&nbsp;<span class="op" id="1535500">!=</span>&nbsp;<span class="ident" id="1535503">key</span><span class="op" id="1535506">.</span><span class="builtinfunc" id="1535507">len</span>&nbsp;<span class="op" id="1535511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535517">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535529">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535534">if</span>&nbsp;<span class="ident" id="1535537">k</span><span class="op" id="1535538">.</span><span class="ident" id="1535539">str</span>&nbsp;<span class="op" id="1535543">==</span>&nbsp;<span class="ident" id="1535546">key</span><span class="op" id="1535549">.</span><span class="ident" id="1535550">str</span>&nbsp;<span class="op" id="1535554">||</span>&nbsp;<span class="ident" id="1535557">memeq</span><span class="op" id="1535562">(</span><span class="ident" id="1535563">k</span><span class="op" id="1535564">.</span><span class="ident" id="1535565">str</span><span class="op" id="1535568">,</span>&nbsp;<span class="ident" id="1535570">key</span><span class="op" id="1535573">.</span><span class="ident" id="1535574">str</span><span class="op" id="1535577">,</span>&nbsp;<span class="builtintype" id="1535579">uintptr</span><span class="op" id="1535586">(</span><span class="ident" id="1535587">key</span><span class="op" id="1535590">.</span><span class="builtinfunc" id="1535591">len</span><span class="op" id="1535594">)</span><span class="op" id="1535595">)</span>&nbsp;<span class="op" id="1535597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535603">return</span>&nbsp;<span class="ident" id="1535610">add</span><span class="op" id="1535613">(</span><span class="ident" id="1535614">unsafe</span><span class="op" id="1535620">.</span><span class="ident" id="1535621">Pointer</span><span class="op" id="1535628">(</span><span class="ident" id="1535629">b</span><span class="op" id="1535630">)</span><span class="op" id="1535631">,</span>&nbsp;<span class="ident" id="1535633">dataOffset</span><span class="op" id="1535643">+</span><span class="ident" id="1535644">bucketCnt</span><span class="op" id="1535653">*</span><span class="num" id="1535654">2</span><span class="op" id="1535655">*</span><span class="ident" id="1535656">ptrSize</span><span class="op" id="1535663">+</span><span class="ident" id="1535664">i</span><span class="op" id="1535665">*</span><span class="builtintype" id="1535666">uintptr</span><span class="op" id="1535673">(</span><span class="ident" id="1535674">t</span><span class="op" id="1535675">.</span><span class="ident" id="1535676">valuesize</span><span class="op" id="1535685">)</span><span class="op" id="1535686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535699">b</span>&nbsp;<span class="op" id="1535701">=</span>&nbsp;<span class="ident" id="1535703">b</span><span class="op" id="1535704">.</span><span class="ident" id="1535705">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535716">if</span>&nbsp;<span class="ident" id="1535719">b</span>&nbsp;<span class="op" id="1535721">==</span>&nbsp;<span class="builtintype" id="1535724">nil</span>&nbsp;<span class="op" id="1535728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535733">return</span>&nbsp;<span class="ident" id="1535740">unsafe</span><span class="op" id="1535746">.</span><span class="ident" id="1535747">Pointer</span><span class="op" id="1535754">(</span><span class="ident" id="1535755">t</span><span class="op" id="1535756">.</span><span class="ident" id="1535757">elem</span><span class="op" id="1535761">.</span><span class="ident" id="1535762">zero</span><span class="op" id="1535766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1535773">}</span><br>
<span class="lineno"></span><span class="op" id="1535775">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1535778">func</span>&nbsp;<span class="ident" id="1535783">mapaccess2_faststr</span><span class="op" id="1535801">(</span><span class="ident" id="1535802">t</span>&nbsp;<span class="op" id="1535804">*</span><span class="ident" id="1535805">maptype</span><span class="op" id="1535812">,</span>&nbsp;<span class="ident" id="1535814">h</span>&nbsp;<span class="op" id="1535816">*</span><span class="ident" id="1535817">hmap</span><span class="op" id="1535821">,</span>&nbsp;<span class="ident" id="1535823">ky</span>&nbsp;<span class="builtintype" id="1535826">string</span><span class="op" id="1535832">)</span>&nbsp;<span class="op" id="1535834">(</span><span class="ident" id="1535835">unsafe</span><span class="op" id="1535841">.</span><span class="ident" id="1535842">Pointer</span><span class="op" id="1535849">,</span>&nbsp;<span class="builtintype" id="1535851">bool</span><span class="op" id="1535855">)</span>&nbsp;<span class="op" id="1535857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1535860">if</span>&nbsp;<span class="ident" id="1535863">raceenabled</span>&nbsp;<span class="op" id="1535875">&amp;&amp;</span>&nbsp;<span class="ident" id="1535878">h</span>&nbsp;<span class="op" id="1535880">!=</span>&nbsp;<span class="builtintype" id="1535883">nil</span>&nbsp;<span class="op" id="1535887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535891">callerpc</span>&nbsp;<span class="op" id="1535900">:=</span>&nbsp;<span class="ident" id="1535903">getcallerpc</span><span class="op" id="1535914">(</span><span class="ident" id="1535915">unsafe</span><span class="op" id="1535921">.</span><span class="ident" id="1535922">Pointer</span><span class="op" id="1535929">(</span><span class="op" id="1535930">&amp;</span><span class="ident" id="1535931">t</span><span class="op" id="1535932">)</span><span class="op" id="1535933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1535937">racereadpc</span><span class="op" id="1535947">(</span><span class="ident" id="1535948">unsafe</span><span class="op" id="1535954">.</span><span class="ident" id="1535955">Pointer</span><span class="op" id="1535962">(</span><span class="ident" id="1535963">h</span><span class="op" id="1535964">)</span><span class="op" id="1535965">,</span>&nbsp;<span class="ident" id="1535967">callerpc</span><span class="op" id="1535975">,</span>&nbsp;<span class="ident" id="1535977">funcPC</span><span class="op" id="1535983">(</span><span class="ident" id="1535984">mapaccess2_faststr</span><span class="op" id="1536002">)</span><span class="op" id="1536003">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1536006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536009">if</span>&nbsp;<span class="ident" id="1536012">h</span>&nbsp;<span class="op" id="1536014">==</span>&nbsp;<span class="builtintype" id="1536017">nil</span>&nbsp;<span class="op" id="1536021">||</span>&nbsp;<span class="ident" id="1536024">h</span><span class="op" id="1536025">.</span><span class="ident" id="1536026">count</span>&nbsp;<span class="op" id="1536032">==</span>&nbsp;<span class="num" id="1536035">0</span>&nbsp;<span class="op" id="1536037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536041">return</span>&nbsp;<span class="ident" id="1536048">unsafe</span><span class="op" id="1536054">.</span><span class="ident" id="1536055">Pointer</span><span class="op" id="1536062">(</span><span class="ident" id="1536063">t</span><span class="op" id="1536064">.</span><span class="ident" id="1536065">elem</span><span class="op" id="1536069">.</span><span class="ident" id="1536070">zero</span><span class="op" id="1536074">)</span><span class="op" id="1536075">,</span>&nbsp;<span class="builtintype" id="1536077">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1536084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1536087">key</span>&nbsp;<span class="op" id="1536091">:=</span>&nbsp;<span class="op" id="1536094">(</span><span class="op" id="1536095">*</span><span class="ident" id="1536096">stringStruct</span><span class="op" id="1536108">)</span><span class="op" id="1536109">(</span><span class="ident" id="1536110">unsafe</span><span class="op" id="1536116">.</span><span class="ident" id="1536117">Pointer</span><span class="op" id="1536124">(</span><span class="op" id="1536125">&amp;</span><span class="ident" id="1536126">ky</span><span class="op" id="1536128">)</span><span class="op" id="1536129">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536132">if</span>&nbsp;<span class="ident" id="1536135">h</span><span class="op" id="1536136">.</span><span class="ident" id="1536137">B</span>&nbsp;<span class="op" id="1536139">==</span>&nbsp;<span class="num" id="1536142">0</span>&nbsp;<span class="op" id="1536144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1536148">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1536171">b</span>&nbsp;<span class="op" id="1536173">:=</span>&nbsp;<span class="op" id="1536176">(</span><span class="op" id="1536177">*</span><span class="ident" id="1536178">bmap</span><span class="op" id="1536182">)</span><span class="op" id="1536183">(</span><span class="ident" id="1536184">h</span><span class="op" id="1536185">.</span><span class="ident" id="1536186">buckets</span><span class="op" id="1536193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536197">if</span>&nbsp;<span class="ident" id="1536200">key</span><span class="op" id="1536203">.</span><span class="builtinfunc" id="1536204">len</span>&nbsp;<span class="op" id="1536208">&lt;</span>&nbsp;<span class="num" id="1536210">32</span>&nbsp;<span class="op" id="1536213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1536218">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536267">for</span>&nbsp;<span class="ident" id="1536271">i</span>&nbsp;<span class="op" id="1536273">:=</span>&nbsp;<span class="builtintype" id="1536276">uintptr</span><span class="op" id="1536283">(</span><span class="num" id="1536284">0</span><span class="op" id="1536285">)</span><span class="op" id="1536286">;</span>&nbsp;<span class="ident" id="1536288">i</span>&nbsp;<span class="op" id="1536290">&lt;</span>&nbsp;<span class="ident" id="1536292">bucketCnt</span><span class="op" id="1536301">;</span>&nbsp;<span class="ident" id="1536303">i</span><span class="op" id="1536304">++</span>&nbsp;<span class="op" id="1536307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1536313">x</span>&nbsp;<span class="op" id="1536315">:=</span>&nbsp;<span class="op" id="1536318">*</span><span class="op" id="1536319">(</span><span class="op" id="1536320">(</span><span class="op" id="1536321">*</span><span class="builtintype" id="1536322">uint8</span><span class="op" id="1536327">)</span><span class="op" id="1536328">(</span><span class="ident" id="1536329">add</span><span class="op" id="1536332">(</span><span class="ident" id="1536333">unsafe</span><span class="op" id="1536339">.</span><span class="ident" id="1536340">Pointer</span><span class="op" id="1536347">(</span><span class="ident" id="1536348">b</span><span class="op" id="1536349">)</span><span class="op" id="1536350">,</span>&nbsp;<span class="ident" id="1536352">i</span><span class="op" id="1536353">)</span><span class="op" id="1536354">)</span><span class="op" id="1536355">)</span>&nbsp;<span class="comment" id="1536357">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536402">if</span>&nbsp;<span class="ident" id="1536405">x</span>&nbsp;<span class="op" id="1536407">==</span>&nbsp;<span class="ident" id="1536410">empty</span>&nbsp;<span class="op" id="1536416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536423">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1536436">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1536442">k</span>&nbsp;<span class="op" id="1536444">:=</span>&nbsp;<span class="op" id="1536447">(</span><span class="op" id="1536448">*</span><span class="ident" id="1536449">stringStruct</span><span class="op" id="1536461">)</span><span class="op" id="1536462">(</span><span class="ident" id="1536463">add</span><span class="op" id="1536466">(</span><span class="ident" id="1536467">unsafe</span><span class="op" id="1536473">.</span><span class="ident" id="1536474">Pointer</span><span class="op" id="1536481">(</span><span class="ident" id="1536482">b</span><span class="op" id="1536483">)</span><span class="op" id="1536484">,</span>&nbsp;<span class="ident" id="1536486">dataOffset</span><span class="op" id="1536496">+</span><span class="ident" id="1536497">i</span><span class="op" id="1536498">*</span><span class="num" id="1536499">2</span><span class="op" id="1536500">*</span><span class="ident" id="1536501">ptrSize</span><span class="op" id="1536508">)</span><span class="op" id="1536509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536515">if</span>&nbsp;<span class="ident" id="1536518">k</span><span class="op" id="1536519">.</span><span class="builtinfunc" id="1536520">len</span>&nbsp;<span class="op" id="1536524">!=</span>&nbsp;<span class="ident" id="1536527">key</span><span class="op" id="1536530">.</span><span class="builtinfunc" id="1536531">len</span>&nbsp;<span class="op" id="1536535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536542">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1536555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536561">if</span>&nbsp;<span class="ident" id="1536564">k</span><span class="op" id="1536565">.</span><span class="ident" id="1536566">str</span>&nbsp;<span class="op" id="1536570">==</span>&nbsp;<span class="ident" id="1536573">key</span><span class="op" id="1536576">.</span><span class="ident" id="1536577">str</span>&nbsp;<span class="op" id="1536581">||</span>&nbsp;<span class="ident" id="1536584">memeq</span><span class="op" id="1536589">(</span><span class="ident" id="1536590">k</span><span class="op" id="1536591">.</span><span class="ident" id="1536592">str</span><span class="op" id="1536595">,</span>&nbsp;<span class="ident" id="1536597">key</span><span class="op" id="1536600">.</span><span class="ident" id="1536601">str</span><span class="op" id="1536604">,</span>&nbsp;<span class="builtintype" id="1536606">uintptr</span><span class="op" id="1536613">(</span><span class="ident" id="1536614">key</span><span class="op" id="1536617">.</span><span class="builtinfunc" id="1536618">len</span><span class="op" id="1536621">)</span><span class="op" id="1536622">)</span>&nbsp;<span class="op" id="1536624">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536631">return</span>&nbsp;<span class="ident" id="1536638">add</span><span class="op" id="1536641">(</span><span class="ident" id="1536642">unsafe</span><span class="op" id="1536648">.</span><span class="ident" id="1536649">Pointer</span><span class="op" id="1536656">(</span><span class="ident" id="1536657">b</span><span class="op" id="1536658">)</span><span class="op" id="1536659">,</span>&nbsp;<span class="ident" id="1536661">dataOffset</span><span class="op" id="1536671">+</span><span class="ident" id="1536672">bucketCnt</span><span class="op" id="1536681">*</span><span class="num" id="1536682">2</span><span class="op" id="1536683">*</span><span class="ident" id="1536684">ptrSize</span><span class="op" id="1536691">+</span><span class="ident" id="1536692">i</span><span class="op" id="1536693">*</span><span class="builtintype" id="1536694">uintptr</span><span class="op" id="1536701">(</span><span class="ident" id="1536702">t</span><span class="op" id="1536703">.</span><span class="ident" id="1536704">valuesize</span><span class="op" id="1536713">)</span><span class="op" id="1536714">)</span><span class="op" id="1536715">,</span>&nbsp;<span class="builtintype" id="1536717">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1536726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1536731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536736">return</span>&nbsp;<span class="ident" id="1536743">unsafe</span><span class="op" id="1536749">.</span><span class="ident" id="1536750">Pointer</span><span class="op" id="1536757">(</span><span class="ident" id="1536758">t</span><span class="op" id="1536759">.</span><span class="ident" id="1536760">elem</span><span class="op" id="1536764">.</span><span class="ident" id="1536765">zero</span><span class="op" id="1536769">)</span><span class="op" id="1536770">,</span>&nbsp;<span class="builtintype" id="1536772">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1536780">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1536784">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1536845">keymaybe</span>&nbsp;<span class="op" id="1536854">:=</span>&nbsp;<span class="builtintype" id="1536857">uintptr</span><span class="op" id="1536864">(</span><span class="ident" id="1536865">bucketCnt</span><span class="op" id="1536874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1536878">for</span>&nbsp;<span class="ident" id="1536882">i</span>&nbsp;<span class="op" id="1536884">:=</span>&nbsp;<span class="builtintype" id="1536887">uintptr</span><span class="op" id="1536894">(</span><span class="num" id="1536895">0</span><span class="op" id="1536896">)</span><span class="op" id="1536897">;</span>&nbsp;<span class="ident" id="1536899">i</span>&nbsp;<span class="op" id="1536901">&lt;</span>&nbsp;<span class="ident" id="1536903">bucketCnt</span><span class="op" id="1536912">;</span>&nbsp;<span class="ident" id="1536914">i</span><span class="op" id="1536915">++</span>&nbsp;<span class="op" id="1536918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1536923">x</span>&nbsp;<span class="op" id="1536925">:=</span>&nbsp;<span class="op" id="1536928">*</span><span class="op" id="1536929">(</span><span class="op" id="1536930">(</span><span class="op" id="1536931">*</span><span class="builtintype" id="1536932">uint8</span><span class="op" id="1536937">)</span><span class="op" id="1536938">(</span><span class="ident" id="1536939">add</span><span class="op" id="1536942">(</span><span class="ident" id="1536943">unsafe</span><span class="op" id="1536949">.</span><span class="ident" id="1536950">Pointer</span><span class="op" id="1536957">(</span><span class="ident" id="1536958">b</span><span class="op" id="1536959">)</span><span class="op" id="1536960">,</span>&nbsp;<span class="ident" id="1536962">i</span><span class="op" id="1536963">)</span><span class="op" id="1536964">)</span><span class="op" id="1536965">)</span>&nbsp;<span class="comment" id="1536967">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537011">if</span>&nbsp;<span class="ident" id="1537014">x</span>&nbsp;<span class="op" id="1537016">==</span>&nbsp;<span class="ident" id="1537019">empty</span>&nbsp;<span class="op" id="1537025">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537031">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1537048">k</span>&nbsp;<span class="op" id="1537050">:=</span>&nbsp;<span class="op" id="1537053">(</span><span class="op" id="1537054">*</span><span class="ident" id="1537055">stringStruct</span><span class="op" id="1537067">)</span><span class="op" id="1537068">(</span><span class="ident" id="1537069">add</span><span class="op" id="1537072">(</span><span class="ident" id="1537073">unsafe</span><span class="op" id="1537079">.</span><span class="ident" id="1537080">Pointer</span><span class="op" id="1537087">(</span><span class="ident" id="1537088">b</span><span class="op" id="1537089">)</span><span class="op" id="1537090">,</span>&nbsp;<span class="ident" id="1537092">dataOffset</span><span class="op" id="1537102">+</span><span class="ident" id="1537103">i</span><span class="op" id="1537104">*</span><span class="num" id="1537105">2</span><span class="op" id="1537106">*</span><span class="ident" id="1537107">ptrSize</span><span class="op" id="1537114">)</span><span class="op" id="1537115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537120">if</span>&nbsp;<span class="ident" id="1537123">k</span><span class="op" id="1537124">.</span><span class="builtinfunc" id="1537125">len</span>&nbsp;<span class="op" id="1537129">!=</span>&nbsp;<span class="ident" id="1537132">key</span><span class="op" id="1537135">.</span><span class="builtinfunc" id="1537136">len</span>&nbsp;<span class="op" id="1537140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537146">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537163">if</span>&nbsp;<span class="ident" id="1537166">k</span><span class="op" id="1537167">.</span><span class="ident" id="1537168">str</span>&nbsp;<span class="op" id="1537172">==</span>&nbsp;<span class="ident" id="1537175">key</span><span class="op" id="1537178">.</span><span class="ident" id="1537179">str</span>&nbsp;<span class="op" id="1537183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537189">return</span>&nbsp;<span class="ident" id="1537196">add</span><span class="op" id="1537199">(</span><span class="ident" id="1537200">unsafe</span><span class="op" id="1537206">.</span><span class="ident" id="1537207">Pointer</span><span class="op" id="1537214">(</span><span class="ident" id="1537215">b</span><span class="op" id="1537216">)</span><span class="op" id="1537217">,</span>&nbsp;<span class="ident" id="1537219">dataOffset</span><span class="op" id="1537229">+</span><span class="ident" id="1537230">bucketCnt</span><span class="op" id="1537239">*</span><span class="num" id="1537240">2</span><span class="op" id="1537241">*</span><span class="ident" id="1537242">ptrSize</span><span class="op" id="1537249">+</span><span class="ident" id="1537250">i</span><span class="op" id="1537251">*</span><span class="builtintype" id="1537252">uintptr</span><span class="op" id="1537259">(</span><span class="ident" id="1537260">t</span><span class="op" id="1537261">.</span><span class="ident" id="1537262">valuesize</span><span class="op" id="1537271">)</span><span class="op" id="1537272">)</span><span class="op" id="1537273">,</span>&nbsp;<span class="builtintype" id="1537275">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1537288">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537314">if</span>&nbsp;<span class="op" id="1537317">*</span><span class="op" id="1537318">(</span><span class="op" id="1537319">(</span><span class="op" id="1537320">*</span><span class="op" id="1537321">[</span><span class="num" id="1537322">4</span><span class="op" id="1537323">]</span><span class="builtintype" id="1537324">byte</span><span class="op" id="1537328">)</span><span class="op" id="1537329">(</span><span class="ident" id="1537330">key</span><span class="op" id="1537333">.</span><span class="ident" id="1537334">str</span><span class="op" id="1537337">)</span><span class="op" id="1537338">)</span>&nbsp;<span class="op" id="1537340">!=</span>&nbsp;<span class="op" id="1537343">*</span><span class="op" id="1537344">(</span><span class="op" id="1537345">(</span><span class="op" id="1537346">*</span><span class="op" id="1537347">[</span><span class="num" id="1537348">4</span><span class="op" id="1537349">]</span><span class="builtintype" id="1537350">byte</span><span class="op" id="1537354">)</span><span class="op" id="1537355">(</span><span class="ident" id="1537356">k</span><span class="op" id="1537357">.</span><span class="ident" id="1537358">str</span><span class="op" id="1537361">)</span><span class="op" id="1537362">)</span>&nbsp;<span class="op" id="1537364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537370">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1537387">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537412">if</span>&nbsp;<span class="op" id="1537415">*</span><span class="op" id="1537416">(</span><span class="op" id="1537417">(</span><span class="op" id="1537418">*</span><span class="op" id="1537419">[</span><span class="num" id="1537420">4</span><span class="op" id="1537421">]</span><span class="builtintype" id="1537422">byte</span><span class="op" id="1537426">)</span><span class="op" id="1537427">(</span><span class="ident" id="1537428">add</span><span class="op" id="1537431">(</span><span class="ident" id="1537432">key</span><span class="op" id="1537435">.</span><span class="ident" id="1537436">str</span><span class="op" id="1537439">,</span>&nbsp;<span class="builtintype" id="1537441">uintptr</span><span class="op" id="1537448">(</span><span class="ident" id="1537449">key</span><span class="op" id="1537452">.</span><span class="builtinfunc" id="1537453">len</span><span class="op" id="1537456">)</span><span class="op" id="1537457">-</span><span class="num" id="1537458">4</span><span class="op" id="1537459">)</span><span class="op" id="1537460">)</span><span class="op" id="1537461">)</span>&nbsp;<span class="op" id="1537463">!=</span>&nbsp;<span class="op" id="1537466">*</span><span class="op" id="1537467">(</span><span class="op" id="1537468">(</span><span class="op" id="1537469">*</span><span class="op" id="1537470">[</span><span class="num" id="1537471">4</span><span class="op" id="1537472">]</span><span class="builtintype" id="1537473">byte</span><span class="op" id="1537477">)</span><span class="op" id="1537478">(</span><span class="ident" id="1537479">add</span><span class="op" id="1537482">(</span><span class="ident" id="1537483">k</span><span class="op" id="1537484">.</span><span class="ident" id="1537485">str</span><span class="op" id="1537488">,</span>&nbsp;<span class="builtintype" id="1537490">uintptr</span><span class="op" id="1537497">(</span><span class="ident" id="1537498">key</span><span class="op" id="1537501">.</span><span class="builtinfunc" id="1537502">len</span><span class="op" id="1537505">)</span><span class="op" id="1537506">-</span><span class="num" id="1537507">4</span><span class="op" id="1537508">)</span><span class="op" id="1537509">)</span><span class="op" id="1537510">)</span>&nbsp;<span class="op" id="1537512">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537518">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537535">if</span>&nbsp;<span class="ident" id="1537538">keymaybe</span>&nbsp;<span class="op" id="1537547">!=</span>&nbsp;<span class="ident" id="1537550">bucketCnt</span>&nbsp;<span class="op" id="1537560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1537566">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537636">goto</span>&nbsp;<span class="ident" id="1537641">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1537656">keymaybe</span>&nbsp;<span class="op" id="1537665">=</span>&nbsp;<span class="ident" id="1537667">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537675">if</span>&nbsp;<span class="ident" id="1537678">keymaybe</span>&nbsp;<span class="op" id="1537687">!=</span>&nbsp;<span class="ident" id="1537690">bucketCnt</span>&nbsp;<span class="op" id="1537700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1537705">k</span>&nbsp;<span class="op" id="1537707">:=</span>&nbsp;<span class="op" id="1537710">(</span><span class="op" id="1537711">*</span><span class="ident" id="1537712">stringStruct</span><span class="op" id="1537724">)</span><span class="op" id="1537725">(</span><span class="ident" id="1537726">add</span><span class="op" id="1537729">(</span><span class="ident" id="1537730">unsafe</span><span class="op" id="1537736">.</span><span class="ident" id="1537737">Pointer</span><span class="op" id="1537744">(</span><span class="ident" id="1537745">b</span><span class="op" id="1537746">)</span><span class="op" id="1537747">,</span>&nbsp;<span class="ident" id="1537749">dataOffset</span><span class="op" id="1537759">+</span><span class="ident" id="1537760">keymaybe</span><span class="op" id="1537768">*</span><span class="num" id="1537769">2</span><span class="op" id="1537770">*</span><span class="ident" id="1537771">ptrSize</span><span class="op" id="1537778">)</span><span class="op" id="1537779">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537784">if</span>&nbsp;<span class="ident" id="1537787">memeq</span><span class="op" id="1537792">(</span><span class="ident" id="1537793">k</span><span class="op" id="1537794">.</span><span class="ident" id="1537795">str</span><span class="op" id="1537798">,</span>&nbsp;<span class="ident" id="1537800">key</span><span class="op" id="1537803">.</span><span class="ident" id="1537804">str</span><span class="op" id="1537807">,</span>&nbsp;<span class="builtintype" id="1537809">uintptr</span><span class="op" id="1537816">(</span><span class="ident" id="1537817">key</span><span class="op" id="1537820">.</span><span class="builtinfunc" id="1537821">len</span><span class="op" id="1537824">)</span><span class="op" id="1537825">)</span>&nbsp;<span class="op" id="1537827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537833">return</span>&nbsp;<span class="ident" id="1537840">add</span><span class="op" id="1537843">(</span><span class="ident" id="1537844">unsafe</span><span class="op" id="1537850">.</span><span class="ident" id="1537851">Pointer</span><span class="op" id="1537858">(</span><span class="ident" id="1537859">b</span><span class="op" id="1537860">)</span><span class="op" id="1537861">,</span>&nbsp;<span class="ident" id="1537863">dataOffset</span><span class="op" id="1537873">+</span><span class="ident" id="1537874">bucketCnt</span><span class="op" id="1537883">*</span><span class="num" id="1537884">2</span><span class="op" id="1537885">*</span><span class="ident" id="1537886">ptrSize</span><span class="op" id="1537893">+</span><span class="ident" id="1537894">keymaybe</span><span class="op" id="1537902">*</span><span class="builtintype" id="1537903">uintptr</span><span class="op" id="1537910">(</span><span class="ident" id="1537911">t</span><span class="op" id="1537912">.</span><span class="ident" id="1537913">valuesize</span><span class="op" id="1537922">)</span><span class="op" id="1537923">)</span><span class="op" id="1537924">,</span>&nbsp;<span class="builtintype" id="1537926">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1537942">return</span>&nbsp;<span class="ident" id="1537949">unsafe</span><span class="op" id="1537955">.</span><span class="ident" id="1537956">Pointer</span><span class="op" id="1537963">(</span><span class="ident" id="1537964">t</span><span class="op" id="1537965">.</span><span class="ident" id="1537966">elem</span><span class="op" id="1537970">.</span><span class="ident" id="1537971">zero</span><span class="op" id="1537975">)</span><span class="op" id="1537976">,</span>&nbsp;<span class="builtintype" id="1537978">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1537985">}</span><br>
<span class="lineno"></span><span class="ident" id="1537987">dohash</span><span class="op" id="1537993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1537996">hash</span>&nbsp;<span class="op" id="1538001">:=</span>&nbsp;<span class="ident" id="1538004">goalg</span><span class="op" id="1538009">(</span><span class="ident" id="1538010">t</span><span class="op" id="1538011">.</span><span class="ident" id="1538012">key</span><span class="op" id="1538015">.</span><span class="ident" id="1538016">alg</span><span class="op" id="1538019">)</span><span class="op" id="1538020">.</span><span class="ident" id="1538021">hash</span><span class="op" id="1538025">(</span><span class="ident" id="1538026">noescape</span><span class="op" id="1538034">(</span><span class="ident" id="1538035">unsafe</span><span class="op" id="1538041">.</span><span class="ident" id="1538042">Pointer</span><span class="op" id="1538049">(</span><span class="op" id="1538050">&amp;</span><span class="ident" id="1538051">ky</span><span class="op" id="1538053">)</span><span class="op" id="1538054">)</span><span class="op" id="1538055">,</span>&nbsp;<span class="num" id="1538057">2</span><span class="op" id="1538058">*</span><span class="ident" id="1538059">ptrSize</span><span class="op" id="1538066">,</span>&nbsp;<span class="builtintype" id="1538068">uintptr</span><span class="op" id="1538075">(</span><span class="ident" id="1538076">h</span><span class="op" id="1538077">.</span><span class="ident" id="1538078">hash0</span><span class="op" id="1538083">)</span><span class="op" id="1538084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538087">m</span>&nbsp;<span class="op" id="1538089">:=</span>&nbsp;<span class="builtintype" id="1538092">uintptr</span><span class="op" id="1538099">(</span><span class="num" id="1538100">1</span><span class="op" id="1538101">)</span><span class="op" id="1538102">&lt;&lt;</span><span class="ident" id="1538104">h</span><span class="op" id="1538105">.</span><span class="ident" id="1538106">B</span>&nbsp;<span class="op" id="1538108">-</span>&nbsp;<span class="num" id="1538110">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538113">b</span>&nbsp;<span class="op" id="1538115">:=</span>&nbsp;<span class="op" id="1538118">(</span><span class="op" id="1538119">*</span><span class="ident" id="1538120">bmap</span><span class="op" id="1538124">)</span><span class="op" id="1538125">(</span><span class="ident" id="1538126">add</span><span class="op" id="1538129">(</span><span class="ident" id="1538130">h</span><span class="op" id="1538131">.</span><span class="ident" id="1538132">buckets</span><span class="op" id="1538139">,</span>&nbsp;<span class="op" id="1538141">(</span><span class="ident" id="1538142">hash</span><span class="op" id="1538146">&amp;</span><span class="ident" id="1538147">m</span><span class="op" id="1538148">)</span><span class="op" id="1538149">*</span><span class="builtintype" id="1538150">uintptr</span><span class="op" id="1538157">(</span><span class="ident" id="1538158">t</span><span class="op" id="1538159">.</span><span class="ident" id="1538160">bucketsize</span><span class="op" id="1538170">)</span><span class="op" id="1538171">)</span><span class="op" id="1538172">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538175">if</span>&nbsp;<span class="ident" id="1538178">c</span>&nbsp;<span class="op" id="1538180">:=</span>&nbsp;<span class="ident" id="1538183">h</span><span class="op" id="1538184">.</span><span class="ident" id="1538185">oldbuckets</span><span class="op" id="1538195">;</span>&nbsp;<span class="ident" id="1538197">c</span>&nbsp;<span class="op" id="1538199">!=</span>&nbsp;<span class="builtintype" id="1538202">nil</span>&nbsp;<span class="op" id="1538206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538210">oldb</span>&nbsp;<span class="op" id="1538215">:=</span>&nbsp;<span class="op" id="1538218">(</span><span class="op" id="1538219">*</span><span class="ident" id="1538220">bmap</span><span class="op" id="1538224">)</span><span class="op" id="1538225">(</span><span class="ident" id="1538226">add</span><span class="op" id="1538229">(</span><span class="ident" id="1538230">c</span><span class="op" id="1538231">,</span>&nbsp;<span class="op" id="1538233">(</span><span class="ident" id="1538234">hash</span><span class="op" id="1538238">&amp;</span><span class="op" id="1538239">(</span><span class="ident" id="1538240">m</span><span class="op" id="1538241">&gt;&gt;</span><span class="num" id="1538243">1</span><span class="op" id="1538244">)</span><span class="op" id="1538245">)</span><span class="op" id="1538246">*</span><span class="builtintype" id="1538247">uintptr</span><span class="op" id="1538254">(</span><span class="ident" id="1538255">t</span><span class="op" id="1538256">.</span><span class="ident" id="1538257">bucketsize</span><span class="op" id="1538267">)</span><span class="op" id="1538268">)</span><span class="op" id="1538269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538273">if</span>&nbsp;<span class="op" id="1538276">!</span><span class="ident" id="1538277">evacuated</span><span class="op" id="1538286">(</span><span class="ident" id="1538287">oldb</span><span class="op" id="1538291">)</span>&nbsp;<span class="op" id="1538293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538298">b</span>&nbsp;<span class="op" id="1538300">=</span>&nbsp;<span class="ident" id="1538302">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538309">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538315">top</span>&nbsp;<span class="op" id="1538319">:=</span>&nbsp;<span class="builtintype" id="1538322">uint8</span><span class="op" id="1538327">(</span><span class="ident" id="1538328">hash</span>&nbsp;<span class="op" id="1538333">&gt;&gt;</span>&nbsp;<span class="op" id="1538336">(</span><span class="ident" id="1538337">ptrSize</span><span class="op" id="1538344">*</span><span class="num" id="1538345">8</span>&nbsp;<span class="op" id="1538347">-</span>&nbsp;<span class="num" id="1538349">8</span><span class="op" id="1538350">)</span><span class="op" id="1538351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538354">if</span>&nbsp;<span class="ident" id="1538357">top</span>&nbsp;<span class="op" id="1538361">&lt;</span>&nbsp;<span class="ident" id="1538363">minTopHash</span>&nbsp;<span class="op" id="1538374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538378">top</span>&nbsp;<span class="op" id="1538382">+=</span>&nbsp;<span class="ident" id="1538385">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538397">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538400">for</span>&nbsp;<span class="op" id="1538404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538408">for</span>&nbsp;<span class="ident" id="1538412">i</span>&nbsp;<span class="op" id="1538414">:=</span>&nbsp;<span class="builtintype" id="1538417">uintptr</span><span class="op" id="1538424">(</span><span class="num" id="1538425">0</span><span class="op" id="1538426">)</span><span class="op" id="1538427">;</span>&nbsp;<span class="ident" id="1538429">i</span>&nbsp;<span class="op" id="1538431">&lt;</span>&nbsp;<span class="ident" id="1538433">bucketCnt</span><span class="op" id="1538442">;</span>&nbsp;<span class="ident" id="1538444">i</span><span class="op" id="1538445">++</span>&nbsp;<span class="op" id="1538448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538453">x</span>&nbsp;<span class="op" id="1538455">:=</span>&nbsp;<span class="op" id="1538458">*</span><span class="op" id="1538459">(</span><span class="op" id="1538460">(</span><span class="op" id="1538461">*</span><span class="builtintype" id="1538462">uint8</span><span class="op" id="1538467">)</span><span class="op" id="1538468">(</span><span class="ident" id="1538469">add</span><span class="op" id="1538472">(</span><span class="ident" id="1538473">unsafe</span><span class="op" id="1538479">.</span><span class="ident" id="1538480">Pointer</span><span class="op" id="1538487">(</span><span class="ident" id="1538488">b</span><span class="op" id="1538489">)</span><span class="op" id="1538490">,</span>&nbsp;<span class="ident" id="1538492">i</span><span class="op" id="1538493">)</span><span class="op" id="1538494">)</span><span class="op" id="1538495">)</span>&nbsp;<span class="comment" id="1538497">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538541">if</span>&nbsp;<span class="ident" id="1538544">x</span>&nbsp;<span class="op" id="1538546">!=</span>&nbsp;<span class="ident" id="1538549">top</span>&nbsp;<span class="op" id="1538553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538559">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538576">k</span>&nbsp;<span class="op" id="1538578">:=</span>&nbsp;<span class="op" id="1538581">(</span><span class="op" id="1538582">*</span><span class="ident" id="1538583">stringStruct</span><span class="op" id="1538595">)</span><span class="op" id="1538596">(</span><span class="ident" id="1538597">add</span><span class="op" id="1538600">(</span><span class="ident" id="1538601">unsafe</span><span class="op" id="1538607">.</span><span class="ident" id="1538608">Pointer</span><span class="op" id="1538615">(</span><span class="ident" id="1538616">b</span><span class="op" id="1538617">)</span><span class="op" id="1538618">,</span>&nbsp;<span class="ident" id="1538620">dataOffset</span><span class="op" id="1538630">+</span><span class="ident" id="1538631">i</span><span class="op" id="1538632">*</span><span class="num" id="1538633">2</span><span class="op" id="1538634">*</span><span class="ident" id="1538635">ptrSize</span><span class="op" id="1538642">)</span><span class="op" id="1538643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538648">if</span>&nbsp;<span class="ident" id="1538651">k</span><span class="op" id="1538652">.</span><span class="builtinfunc" id="1538653">len</span>&nbsp;<span class="op" id="1538657">!=</span>&nbsp;<span class="ident" id="1538660">key</span><span class="op" id="1538663">.</span><span class="builtinfunc" id="1538664">len</span>&nbsp;<span class="op" id="1538668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538674">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538686">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538691">if</span>&nbsp;<span class="ident" id="1538694">k</span><span class="op" id="1538695">.</span><span class="ident" id="1538696">str</span>&nbsp;<span class="op" id="1538700">==</span>&nbsp;<span class="ident" id="1538703">key</span><span class="op" id="1538706">.</span><span class="ident" id="1538707">str</span>&nbsp;<span class="op" id="1538711">||</span>&nbsp;<span class="ident" id="1538714">memeq</span><span class="op" id="1538719">(</span><span class="ident" id="1538720">k</span><span class="op" id="1538721">.</span><span class="ident" id="1538722">str</span><span class="op" id="1538725">,</span>&nbsp;<span class="ident" id="1538727">key</span><span class="op" id="1538730">.</span><span class="ident" id="1538731">str</span><span class="op" id="1538734">,</span>&nbsp;<span class="builtintype" id="1538736">uintptr</span><span class="op" id="1538743">(</span><span class="ident" id="1538744">key</span><span class="op" id="1538747">.</span><span class="builtinfunc" id="1538748">len</span><span class="op" id="1538751">)</span><span class="op" id="1538752">)</span>&nbsp;<span class="op" id="1538754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538760">return</span>&nbsp;<span class="ident" id="1538767">add</span><span class="op" id="1538770">(</span><span class="ident" id="1538771">unsafe</span><span class="op" id="1538777">.</span><span class="ident" id="1538778">Pointer</span><span class="op" id="1538785">(</span><span class="ident" id="1538786">b</span><span class="op" id="1538787">)</span><span class="op" id="1538788">,</span>&nbsp;<span class="ident" id="1538790">dataOffset</span><span class="op" id="1538800">+</span><span class="ident" id="1538801">bucketCnt</span><span class="op" id="1538810">*</span><span class="num" id="1538811">2</span><span class="op" id="1538812">*</span><span class="ident" id="1538813">ptrSize</span><span class="op" id="1538820">+</span><span class="ident" id="1538821">i</span><span class="op" id="1538822">*</span><span class="builtintype" id="1538823">uintptr</span><span class="op" id="1538830">(</span><span class="ident" id="1538831">t</span><span class="op" id="1538832">.</span><span class="ident" id="1538833">valuesize</span><span class="op" id="1538842">)</span><span class="op" id="1538843">)</span><span class="op" id="1538844">,</span>&nbsp;<span class="builtintype" id="1538846">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1538862">b</span>&nbsp;<span class="op" id="1538864">=</span>&nbsp;<span class="ident" id="1538866">b</span><span class="op" id="1538867">.</span><span class="ident" id="1538868">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538879">if</span>&nbsp;<span class="ident" id="1538882">b</span>&nbsp;<span class="op" id="1538884">==</span>&nbsp;<span class="builtintype" id="1538887">nil</span>&nbsp;<span class="op" id="1538891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1538896">return</span>&nbsp;<span class="ident" id="1538903">unsafe</span><span class="op" id="1538909">.</span><span class="ident" id="1538910">Pointer</span><span class="op" id="1538917">(</span><span class="ident" id="1538918">t</span><span class="op" id="1538919">.</span><span class="ident" id="1538920">elem</span><span class="op" id="1538924">.</span><span class="ident" id="1538925">zero</span><span class="op" id="1538929">)</span><span class="op" id="1538930">,</span>&nbsp;<span class="builtintype" id="1538932">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1538943">}</span><br>
<span class="lineno"></span><span class="op" id="1538945">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
