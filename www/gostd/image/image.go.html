<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html" class="current">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5492135">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5492190">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5492244">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5492295">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5492350">//</span><br>
<span class="lineno"></span><span class="comment" id="5492353">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5492431">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5492476">//</span><br>
<span class="lineno">10</span><span class="comment" id="5492479">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5492557">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5492636">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5492712">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5492783">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5492860">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5492932">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5492956">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5493035">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5493067">//</span><br>
<span class="lineno">20</span><span class="comment" id="5493070">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5493118">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5493171">package</span>&nbsp;<span class="ident" id="5493179">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5493186">import</span>&nbsp;<span class="op" id="5493193">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5493196">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5493210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5493213">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5493268">type</span>&nbsp;<span class="ident" id="5493273">Config</span>&nbsp;<span class="keyword" id="5493280">struct</span>&nbsp;<span class="op" id="5493287">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493290">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493304">color</span><span class="op" id="5493309">.</span><span class="ident" id="5493310">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493317">Width</span><span class="op" id="5493322">,</span>&nbsp;<span class="ident" id="5493324">Height</span>&nbsp;<span class="builtintype" id="5493331">int</span><br>
<span class="lineno"></span><span class="op" id="5493335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5493338">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5493417">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5493427">type</span>&nbsp;<span class="ident" id="5493432">Image</span>&nbsp;<span class="keyword" id="5493438">interface</span>&nbsp;<span class="op" id="5493448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493451">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493499">ColorModel</span><span class="op" id="5493509">(</span><span class="op" id="5493510">)</span>&nbsp;<span class="ident" id="5493512">color</span><span class="op" id="5493517">.</span><span class="ident" id="5493518">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493525">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493595">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493655">Bounds</span><span class="op" id="5493661">(</span><span class="op" id="5493662">)</span>&nbsp;<span class="ident" id="5493664">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493675">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493724">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493805">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493877">At</span><span class="op" id="5493879">(</span><span class="ident" id="5493880">x</span><span class="op" id="5493881">,</span>&nbsp;<span class="ident" id="5493883">y</span>&nbsp;<span class="builtintype" id="5493885">int</span><span class="op" id="5493888">)</span>&nbsp;<span class="ident" id="5493890">color</span><span class="op" id="5493895">.</span><span class="ident" id="5493896">Color</span><br>
<span class="lineno"></span><span class="op" id="5493902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5493905">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5493980">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5494058">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5494133">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5494209">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5494223">type</span>&nbsp;<span class="ident" id="5494228">PalettedImage</span>&nbsp;<span class="keyword" id="5494242">interface</span>&nbsp;<span class="op" id="5494252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494255">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494322">ColorIndexAt</span><span class="op" id="5494334">(</span><span class="ident" id="5494335">x</span><span class="op" id="5494336">,</span>&nbsp;<span class="ident" id="5494338">y</span>&nbsp;<span class="builtintype" id="5494340">int</span><span class="op" id="5494343">)</span>&nbsp;<span class="builtintype" id="5494345">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494352">Image</span><br>
<span class="lineno"></span><span class="op" id="5494358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5494361">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5494434">type</span>&nbsp;<span class="ident" id="5494439">RGBA</span>&nbsp;<span class="keyword" id="5494444">struct</span>&nbsp;<span class="op" id="5494451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494454">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494522">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494590">Pix</span>&nbsp;<span class="op" id="5494594">[</span><span class="op" id="5494595">]</span><span class="builtintype" id="5494596">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494603">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494679">Stride</span>&nbsp;<span class="builtintype" id="5494686">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494691">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494723">Rect</span>&nbsp;<span class="ident" id="5494728">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5494738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5494741">func</span>&nbsp;<span class="op" id="5494746">(</span><span class="ident" id="5494747">p</span>&nbsp;<span class="op" id="5494749">*</span><span class="ident" id="5494750">RGBA</span><span class="op" id="5494754">)</span>&nbsp;<span class="ident" id="5494756">ColorModel</span><span class="op" id="5494766">(</span><span class="op" id="5494767">)</span>&nbsp;<span class="ident" id="5494769">color</span><span class="op" id="5494774">.</span><span class="ident" id="5494775">Model</span>&nbsp;<span class="op" id="5494781">{</span>&nbsp;<span class="keyword" id="5494783">return</span>&nbsp;<span class="ident" id="5494790">color</span><span class="op" id="5494795">.</span><span class="ident" id="5494796">RGBAModel</span>&nbsp;<span class="op" id="5494806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5494809">func</span>&nbsp;<span class="op" id="5494814">(</span><span class="ident" id="5494815">p</span>&nbsp;<span class="op" id="5494817">*</span><span class="ident" id="5494818">RGBA</span><span class="op" id="5494822">)</span>&nbsp;<span class="ident" id="5494824">Bounds</span><span class="op" id="5494830">(</span><span class="op" id="5494831">)</span>&nbsp;<span class="ident" id="5494833">Rectangle</span>&nbsp;<span class="op" id="5494843">{</span>&nbsp;<span class="keyword" id="5494845">return</span>&nbsp;<span class="ident" id="5494852">p</span><span class="op" id="5494853">.</span><span class="ident" id="5494854">Rect</span>&nbsp;<span class="op" id="5494859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5494862">func</span>&nbsp;<span class="op" id="5494867">(</span><span class="ident" id="5494868">p</span>&nbsp;<span class="op" id="5494870">*</span><span class="ident" id="5494871">RGBA</span><span class="op" id="5494875">)</span>&nbsp;<span class="ident" id="5494877">At</span><span class="op" id="5494879">(</span><span class="ident" id="5494880">x</span><span class="op" id="5494881">,</span>&nbsp;<span class="ident" id="5494883">y</span>&nbsp;<span class="builtintype" id="5494885">int</span><span class="op" id="5494888">)</span>&nbsp;<span class="ident" id="5494890">color</span><span class="op" id="5494895">.</span><span class="ident" id="5494896">Color</span>&nbsp;<span class="op" id="5494902">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494905">return</span>&nbsp;<span class="ident" id="5494912">p</span><span class="op" id="5494913">.</span><span class="ident" id="5494914">RGBAAt</span><span class="op" id="5494920">(</span><span class="ident" id="5494921">x</span><span class="op" id="5494922">,</span>&nbsp;<span class="ident" id="5494924">y</span><span class="op" id="5494925">)</span><br>
<span class="lineno"></span><span class="op" id="5494927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5494930">func</span>&nbsp;<span class="op" id="5494935">(</span><span class="ident" id="5494936">p</span>&nbsp;<span class="op" id="5494938">*</span><span class="ident" id="5494939">RGBA</span><span class="op" id="5494943">)</span>&nbsp;<span class="ident" id="5494945">RGBAAt</span><span class="op" id="5494951">(</span><span class="ident" id="5494952">x</span><span class="op" id="5494953">,</span>&nbsp;<span class="ident" id="5494955">y</span>&nbsp;<span class="builtintype" id="5494957">int</span><span class="op" id="5494960">)</span>&nbsp;<span class="ident" id="5494962">color</span><span class="op" id="5494967">.</span><span class="ident" id="5494968">RGBA</span>&nbsp;<span class="op" id="5494973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494976">if</span>&nbsp;<span class="op" id="5494979">!</span><span class="op" id="5494980">(</span><span class="ident" id="5494981">Point</span><span class="op" id="5494986">{</span><span class="ident" id="5494987">x</span><span class="op" id="5494988">,</span>&nbsp;<span class="ident" id="5494990">y</span><span class="op" id="5494991">}</span><span class="op" id="5494992">.</span><span class="ident" id="5494993">In</span><span class="op" id="5494995">(</span><span class="ident" id="5494996">p</span><span class="op" id="5494997">.</span><span class="ident" id="5494998">Rect</span><span class="op" id="5495002">)</span><span class="op" id="5495003">)</span>&nbsp;<span class="op" id="5495005">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495009">return</span>&nbsp;<span class="ident" id="5495016">color</span><span class="op" id="5495021">.</span><span class="ident" id="5495022">RGBA</span><span class="op" id="5495026">{</span><span class="op" id="5495027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495033">i</span>&nbsp;<span class="op" id="5495035">:=</span>&nbsp;<span class="ident" id="5495038">p</span><span class="op" id="5495039">.</span><span class="ident" id="5495040">PixOffset</span><span class="op" id="5495049">(</span><span class="ident" id="5495050">x</span><span class="op" id="5495051">,</span>&nbsp;<span class="ident" id="5495053">y</span><span class="op" id="5495054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495057">return</span>&nbsp;<span class="ident" id="5495064">color</span><span class="op" id="5495069">.</span><span class="ident" id="5495070">RGBA</span><span class="op" id="5495074">{</span><span class="ident" id="5495075">p</span><span class="op" id="5495076">.</span><span class="ident" id="5495077">Pix</span><span class="op" id="5495080">[</span><span class="ident" id="5495081">i</span><span class="op" id="5495082">+</span><span class="num" id="5495083">0</span><span class="op" id="5495084">]</span><span class="op" id="5495085">,</span>&nbsp;<span class="ident" id="5495087">p</span><span class="op" id="5495088">.</span><span class="ident" id="5495089">Pix</span><span class="op" id="5495092">[</span><span class="ident" id="5495093">i</span><span class="op" id="5495094">+</span><span class="num" id="5495095">1</span><span class="op" id="5495096">]</span><span class="op" id="5495097">,</span>&nbsp;<span class="ident" id="5495099">p</span><span class="op" id="5495100">.</span><span class="ident" id="5495101">Pix</span><span class="op" id="5495104">[</span><span class="ident" id="5495105">i</span><span class="op" id="5495106">+</span><span class="num" id="5495107">2</span><span class="op" id="5495108">]</span><span class="op" id="5495109">,</span>&nbsp;<span class="ident" id="5495111">p</span><span class="op" id="5495112">.</span><span class="ident" id="5495113">Pix</span><span class="op" id="5495116">[</span><span class="ident" id="5495117">i</span><span class="op" id="5495118">+</span><span class="num" id="5495119">3</span><span class="op" id="5495120">]</span><span class="op" id="5495121">}</span><br>
<span class="lineno"></span><span class="op" id="5495123">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5495126">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5495205">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5495229">func</span>&nbsp;<span class="op" id="5495234">(</span><span class="ident" id="5495235">p</span>&nbsp;<span class="op" id="5495237">*</span><span class="ident" id="5495238">RGBA</span><span class="op" id="5495242">)</span>&nbsp;<span class="ident" id="5495244">PixOffset</span><span class="op" id="5495253">(</span><span class="ident" id="5495254">x</span><span class="op" id="5495255">,</span>&nbsp;<span class="ident" id="5495257">y</span>&nbsp;<span class="builtintype" id="5495259">int</span><span class="op" id="5495262">)</span>&nbsp;<span class="builtintype" id="5495264">int</span>&nbsp;<span class="op" id="5495268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495271">return</span>&nbsp;<span class="op" id="5495278">(</span><span class="ident" id="5495279">y</span><span class="op" id="5495280">-</span><span class="ident" id="5495281">p</span><span class="op" id="5495282">.</span><span class="ident" id="5495283">Rect</span><span class="op" id="5495287">.</span><span class="ident" id="5495288">Min</span><span class="op" id="5495291">.</span><span class="ident" id="5495292">Y</span><span class="op" id="5495293">)</span><span class="op" id="5495294">*</span><span class="ident" id="5495295">p</span><span class="op" id="5495296">.</span><span class="ident" id="5495297">Stride</span>&nbsp;<span class="op" id="5495304">+</span>&nbsp;<span class="op" id="5495306">(</span><span class="ident" id="5495307">x</span><span class="op" id="5495308">-</span><span class="ident" id="5495309">p</span><span class="op" id="5495310">.</span><span class="ident" id="5495311">Rect</span><span class="op" id="5495315">.</span><span class="ident" id="5495316">Min</span><span class="op" id="5495319">.</span><span class="ident" id="5495320">X</span><span class="op" id="5495321">)</span><span class="op" id="5495322">*</span><span class="num" id="5495323">4</span><br>
<span class="lineno">90</span><span class="op" id="5495325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5495328">func</span>&nbsp;<span class="op" id="5495333">(</span><span class="ident" id="5495334">p</span>&nbsp;<span class="op" id="5495336">*</span><span class="ident" id="5495337">RGBA</span><span class="op" id="5495341">)</span>&nbsp;<span class="ident" id="5495343">Set</span><span class="op" id="5495346">(</span><span class="ident" id="5495347">x</span><span class="op" id="5495348">,</span>&nbsp;<span class="ident" id="5495350">y</span>&nbsp;<span class="builtintype" id="5495352">int</span><span class="op" id="5495355">,</span>&nbsp;<span class="ident" id="5495357">c</span>&nbsp;<span class="ident" id="5495359">color</span><span class="op" id="5495364">.</span><span class="ident" id="5495365">Color</span><span class="op" id="5495370">)</span>&nbsp;<span class="op" id="5495372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495375">if</span>&nbsp;<span class="op" id="5495378">!</span><span class="op" id="5495379">(</span><span class="ident" id="5495380">Point</span><span class="op" id="5495385">{</span><span class="ident" id="5495386">x</span><span class="op" id="5495387">,</span>&nbsp;<span class="ident" id="5495389">y</span><span class="op" id="5495390">}</span><span class="op" id="5495391">.</span><span class="ident" id="5495392">In</span><span class="op" id="5495394">(</span><span class="ident" id="5495395">p</span><span class="op" id="5495396">.</span><span class="ident" id="5495397">Rect</span><span class="op" id="5495401">)</span><span class="op" id="5495402">)</span>&nbsp;<span class="op" id="5495404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495408">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495419">i</span>&nbsp;<span class="op" id="5495421">:=</span>&nbsp;<span class="ident" id="5495424">p</span><span class="op" id="5495425">.</span><span class="ident" id="5495426">PixOffset</span><span class="op" id="5495435">(</span><span class="ident" id="5495436">x</span><span class="op" id="5495437">,</span>&nbsp;<span class="ident" id="5495439">y</span><span class="op" id="5495440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495443">c1</span>&nbsp;<span class="op" id="5495446">:=</span>&nbsp;<span class="ident" id="5495449">color</span><span class="op" id="5495454">.</span><span class="ident" id="5495455">RGBAModel</span><span class="op" id="5495464">.</span><span class="ident" id="5495465">Convert</span><span class="op" id="5495472">(</span><span class="ident" id="5495473">c</span><span class="op" id="5495474">)</span><span class="op" id="5495475">.</span><span class="op" id="5495476">(</span><span class="ident" id="5495477">color</span><span class="op" id="5495482">.</span><span class="ident" id="5495483">RGBA</span><span class="op" id="5495487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495490">p</span><span class="op" id="5495491">.</span><span class="ident" id="5495492">Pix</span><span class="op" id="5495495">[</span><span class="ident" id="5495496">i</span><span class="op" id="5495497">+</span><span class="num" id="5495498">0</span><span class="op" id="5495499">]</span>&nbsp;<span class="op" id="5495501">=</span>&nbsp;<span class="ident" id="5495503">c1</span><span class="op" id="5495505">.</span><span class="ident" id="5495506">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495509">p</span><span class="op" id="5495510">.</span><span class="ident" id="5495511">Pix</span><span class="op" id="5495514">[</span><span class="ident" id="5495515">i</span><span class="op" id="5495516">+</span><span class="num" id="5495517">1</span><span class="op" id="5495518">]</span>&nbsp;<span class="op" id="5495520">=</span>&nbsp;<span class="ident" id="5495522">c1</span><span class="op" id="5495524">.</span><span class="ident" id="5495525">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495528">p</span><span class="op" id="5495529">.</span><span class="ident" id="5495530">Pix</span><span class="op" id="5495533">[</span><span class="ident" id="5495534">i</span><span class="op" id="5495535">+</span><span class="num" id="5495536">2</span><span class="op" id="5495537">]</span>&nbsp;<span class="op" id="5495539">=</span>&nbsp;<span class="ident" id="5495541">c1</span><span class="op" id="5495543">.</span><span class="ident" id="5495544">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495547">p</span><span class="op" id="5495548">.</span><span class="ident" id="5495549">Pix</span><span class="op" id="5495552">[</span><span class="ident" id="5495553">i</span><span class="op" id="5495554">+</span><span class="num" id="5495555">3</span><span class="op" id="5495556">]</span>&nbsp;<span class="op" id="5495558">=</span>&nbsp;<span class="ident" id="5495560">c1</span><span class="op" id="5495562">.</span><span class="ident" id="5495563">A</span><br>
<span class="lineno"></span><span class="op" id="5495565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5495568">func</span>&nbsp;<span class="op" id="5495573">(</span><span class="ident" id="5495574">p</span>&nbsp;<span class="op" id="5495576">*</span><span class="ident" id="5495577">RGBA</span><span class="op" id="5495581">)</span>&nbsp;<span class="ident" id="5495583">SetRGBA</span><span class="op" id="5495590">(</span><span class="ident" id="5495591">x</span><span class="op" id="5495592">,</span>&nbsp;<span class="ident" id="5495594">y</span>&nbsp;<span class="builtintype" id="5495596">int</span><span class="op" id="5495599">,</span>&nbsp;<span class="ident" id="5495601">c</span>&nbsp;<span class="ident" id="5495603">color</span><span class="op" id="5495608">.</span><span class="ident" id="5495609">RGBA</span><span class="op" id="5495613">)</span>&nbsp;<span class="op" id="5495615">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495618">if</span>&nbsp;<span class="op" id="5495621">!</span><span class="op" id="5495622">(</span><span class="ident" id="5495623">Point</span><span class="op" id="5495628">{</span><span class="ident" id="5495629">x</span><span class="op" id="5495630">,</span>&nbsp;<span class="ident" id="5495632">y</span><span class="op" id="5495633">}</span><span class="op" id="5495634">.</span><span class="ident" id="5495635">In</span><span class="op" id="5495637">(</span><span class="ident" id="5495638">p</span><span class="op" id="5495639">.</span><span class="ident" id="5495640">Rect</span><span class="op" id="5495644">)</span><span class="op" id="5495645">)</span>&nbsp;<span class="op" id="5495647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495651">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495662">i</span>&nbsp;<span class="op" id="5495664">:=</span>&nbsp;<span class="ident" id="5495667">p</span><span class="op" id="5495668">.</span><span class="ident" id="5495669">PixOffset</span><span class="op" id="5495678">(</span><span class="ident" id="5495679">x</span><span class="op" id="5495680">,</span>&nbsp;<span class="ident" id="5495682">y</span><span class="op" id="5495683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495686">p</span><span class="op" id="5495687">.</span><span class="ident" id="5495688">Pix</span><span class="op" id="5495691">[</span><span class="ident" id="5495692">i</span><span class="op" id="5495693">+</span><span class="num" id="5495694">0</span><span class="op" id="5495695">]</span>&nbsp;<span class="op" id="5495697">=</span>&nbsp;<span class="ident" id="5495699">c</span><span class="op" id="5495700">.</span><span class="ident" id="5495701">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495704">p</span><span class="op" id="5495705">.</span><span class="ident" id="5495706">Pix</span><span class="op" id="5495709">[</span><span class="ident" id="5495710">i</span><span class="op" id="5495711">+</span><span class="num" id="5495712">1</span><span class="op" id="5495713">]</span>&nbsp;<span class="op" id="5495715">=</span>&nbsp;<span class="ident" id="5495717">c</span><span class="op" id="5495718">.</span><span class="ident" id="5495719">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495722">p</span><span class="op" id="5495723">.</span><span class="ident" id="5495724">Pix</span><span class="op" id="5495727">[</span><span class="ident" id="5495728">i</span><span class="op" id="5495729">+</span><span class="num" id="5495730">2</span><span class="op" id="5495731">]</span>&nbsp;<span class="op" id="5495733">=</span>&nbsp;<span class="ident" id="5495735">c</span><span class="op" id="5495736">.</span><span class="ident" id="5495737">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495740">p</span><span class="op" id="5495741">.</span><span class="ident" id="5495742">Pix</span><span class="op" id="5495745">[</span><span class="ident" id="5495746">i</span><span class="op" id="5495747">+</span><span class="num" id="5495748">3</span><span class="op" id="5495749">]</span>&nbsp;<span class="op" id="5495751">=</span>&nbsp;<span class="ident" id="5495753">c</span><span class="op" id="5495754">.</span><span class="ident" id="5495755">A</span><br>
<span class="lineno"></span><span class="op" id="5495757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5495760">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5495837">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5495909">func</span>&nbsp;<span class="op" id="5495914">(</span><span class="ident" id="5495915">p</span>&nbsp;<span class="op" id="5495917">*</span><span class="ident" id="5495918">RGBA</span><span class="op" id="5495922">)</span>&nbsp;<span class="ident" id="5495924">SubImage</span><span class="op" id="5495932">(</span><span class="ident" id="5495933">r</span>&nbsp;<span class="ident" id="5495935">Rectangle</span><span class="op" id="5495944">)</span>&nbsp;<span class="ident" id="5495946">Image</span>&nbsp;<span class="op" id="5495952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495955">r</span>&nbsp;<span class="op" id="5495957">=</span>&nbsp;<span class="ident" id="5495959">r</span><span class="op" id="5495960">.</span><span class="ident" id="5495961">Intersect</span><span class="op" id="5495970">(</span><span class="ident" id="5495971">p</span><span class="op" id="5495972">.</span><span class="ident" id="5495973">Rect</span><span class="op" id="5495977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5495980">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5496061">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5496143">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496193">if</span>&nbsp;<span class="ident" id="5496196">r</span><span class="op" id="5496197">.</span><span class="ident" id="5496198">Empty</span><span class="op" id="5496203">(</span><span class="op" id="5496204">)</span>&nbsp;<span class="op" id="5496206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496210">return</span>&nbsp;<span class="op" id="5496217">&amp;</span><span class="ident" id="5496218">RGBA</span><span class="op" id="5496222">{</span><span class="op" id="5496223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496226">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496229">i</span>&nbsp;<span class="op" id="5496231">:=</span>&nbsp;<span class="ident" id="5496234">p</span><span class="op" id="5496235">.</span><span class="ident" id="5496236">PixOffset</span><span class="op" id="5496245">(</span><span class="ident" id="5496246">r</span><span class="op" id="5496247">.</span><span class="ident" id="5496248">Min</span><span class="op" id="5496251">.</span><span class="ident" id="5496252">X</span><span class="op" id="5496253">,</span>&nbsp;<span class="ident" id="5496255">r</span><span class="op" id="5496256">.</span><span class="ident" id="5496257">Min</span><span class="op" id="5496260">.</span><span class="ident" id="5496261">Y</span><span class="op" id="5496262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496265">return</span>&nbsp;<span class="op" id="5496272">&amp;</span><span class="ident" id="5496273">RGBA</span><span class="op" id="5496277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496281">Pix</span><span class="op" id="5496284">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496289">p</span><span class="op" id="5496290">.</span><span class="ident" id="5496291">Pix</span><span class="op" id="5496294">[</span><span class="ident" id="5496295">i</span><span class="op" id="5496296">:</span><span class="op" id="5496297">]</span><span class="op" id="5496298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496302">Stride</span><span class="op" id="5496308">:</span>&nbsp;<span class="ident" id="5496310">p</span><span class="op" id="5496311">.</span><span class="ident" id="5496312">Stride</span><span class="op" id="5496318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496322">Rect</span><span class="op" id="5496326">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5496330">r</span><span class="op" id="5496331">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496334">}</span><br>
<span class="lineno"></span><span class="op" id="5496336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5496339">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5496412">func</span>&nbsp;<span class="op" id="5496417">(</span><span class="ident" id="5496418">p</span>&nbsp;<span class="op" id="5496420">*</span><span class="ident" id="5496421">RGBA</span><span class="op" id="5496425">)</span>&nbsp;<span class="ident" id="5496427">Opaque</span><span class="op" id="5496433">(</span><span class="op" id="5496434">)</span>&nbsp;<span class="builtintype" id="5496436">bool</span>&nbsp;<span class="op" id="5496441">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496444">if</span>&nbsp;<span class="ident" id="5496447">p</span><span class="op" id="5496448">.</span><span class="ident" id="5496449">Rect</span><span class="op" id="5496453">.</span><span class="ident" id="5496454">Empty</span><span class="op" id="5496459">(</span><span class="op" id="5496460">)</span>&nbsp;<span class="op" id="5496462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496466">return</span>&nbsp;<span class="builtintype" id="5496473">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496482">i0</span><span class="op" id="5496484">,</span>&nbsp;<span class="ident" id="5496486">i1</span>&nbsp;<span class="op" id="5496489">:=</span>&nbsp;<span class="num" id="5496492">3</span><span class="op" id="5496493">,</span>&nbsp;<span class="ident" id="5496495">p</span><span class="op" id="5496496">.</span><span class="ident" id="5496497">Rect</span><span class="op" id="5496501">.</span><span class="ident" id="5496502">Dx</span><span class="op" id="5496504">(</span><span class="op" id="5496505">)</span><span class="op" id="5496506">*</span><span class="num" id="5496507">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496510">for</span>&nbsp;<span class="ident" id="5496514">y</span>&nbsp;<span class="op" id="5496516">:=</span>&nbsp;<span class="ident" id="5496519">p</span><span class="op" id="5496520">.</span><span class="ident" id="5496521">Rect</span><span class="op" id="5496525">.</span><span class="ident" id="5496526">Min</span><span class="op" id="5496529">.</span><span class="ident" id="5496530">Y</span><span class="op" id="5496531">;</span>&nbsp;<span class="ident" id="5496533">y</span>&nbsp;<span class="op" id="5496535">&lt;</span>&nbsp;<span class="ident" id="5496537">p</span><span class="op" id="5496538">.</span><span class="ident" id="5496539">Rect</span><span class="op" id="5496543">.</span><span class="ident" id="5496544">Max</span><span class="op" id="5496547">.</span><span class="ident" id="5496548">Y</span><span class="op" id="5496549">;</span>&nbsp;<span class="ident" id="5496551">y</span><span class="op" id="5496552">++</span>&nbsp;<span class="op" id="5496555">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496559">for</span>&nbsp;<span class="ident" id="5496563">i</span>&nbsp;<span class="op" id="5496565">:=</span>&nbsp;<span class="ident" id="5496568">i0</span><span class="op" id="5496570">;</span>&nbsp;<span class="ident" id="5496572">i</span>&nbsp;<span class="op" id="5496574">&lt;</span>&nbsp;<span class="ident" id="5496576">i1</span><span class="op" id="5496578">;</span>&nbsp;<span class="ident" id="5496580">i</span>&nbsp;<span class="op" id="5496582">+=</span>&nbsp;<span class="num" id="5496585">4</span>&nbsp;<span class="op" id="5496587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496592">if</span>&nbsp;<span class="ident" id="5496595">p</span><span class="op" id="5496596">.</span><span class="ident" id="5496597">Pix</span><span class="op" id="5496600">[</span><span class="ident" id="5496601">i</span><span class="op" id="5496602">]</span>&nbsp;<span class="op" id="5496604">!=</span>&nbsp;<span class="num" id="5496607">0xff</span>&nbsp;<span class="op" id="5496612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496618">return</span>&nbsp;<span class="builtintype" id="5496625">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496638">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496642">i0</span>&nbsp;<span class="op" id="5496645">+=</span>&nbsp;<span class="ident" id="5496648">p</span><span class="op" id="5496649">.</span><span class="ident" id="5496650">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496659">i1</span>&nbsp;<span class="op" id="5496662">+=</span>&nbsp;<span class="ident" id="5496665">p</span><span class="op" id="5496666">.</span><span class="ident" id="5496667">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496678">return</span>&nbsp;<span class="builtintype" id="5496685">true</span><br>
<span class="lineno"></span><span class="op" id="5496690">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5496693">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5496746">func</span>&nbsp;<span class="ident" id="5496751">NewRGBA</span><span class="op" id="5496758">(</span><span class="ident" id="5496759">r</span>&nbsp;<span class="ident" id="5496761">Rectangle</span><span class="op" id="5496770">)</span>&nbsp;<span class="op" id="5496772">*</span><span class="ident" id="5496773">RGBA</span>&nbsp;<span class="op" id="5496778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496781">w</span><span class="op" id="5496782">,</span>&nbsp;<span class="ident" id="5496784">h</span>&nbsp;<span class="op" id="5496786">:=</span>&nbsp;<span class="ident" id="5496789">r</span><span class="op" id="5496790">.</span><span class="ident" id="5496791">Dx</span><span class="op" id="5496793">(</span><span class="op" id="5496794">)</span><span class="op" id="5496795">,</span>&nbsp;<span class="ident" id="5496797">r</span><span class="op" id="5496798">.</span><span class="ident" id="5496799">Dy</span><span class="op" id="5496801">(</span><span class="op" id="5496802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496805">buf</span>&nbsp;<span class="op" id="5496809">:=</span>&nbsp;<span class="builtinfunc" id="5496812">make</span><span class="op" id="5496816">(</span><span class="op" id="5496817">[</span><span class="op" id="5496818">]</span><span class="builtintype" id="5496819">uint8</span><span class="op" id="5496824">,</span>&nbsp;<span class="num" id="5496826">4</span><span class="op" id="5496827">*</span><span class="ident" id="5496828">w</span><span class="op" id="5496829">*</span><span class="ident" id="5496830">h</span><span class="op" id="5496831">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496834">return</span>&nbsp;<span class="op" id="5496841">&amp;</span><span class="ident" id="5496842">RGBA</span><span class="op" id="5496846">{</span><span class="ident" id="5496847">buf</span><span class="op" id="5496850">,</span>&nbsp;<span class="num" id="5496852">4</span>&nbsp;<span class="op" id="5496854">*</span>&nbsp;<span class="ident" id="5496856">w</span><span class="op" id="5496857">,</span>&nbsp;<span class="ident" id="5496859">r</span><span class="op" id="5496860">}</span><br>
<span class="lineno"></span><span class="op" id="5496862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5496865">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5496942">type</span>&nbsp;<span class="ident" id="5496947">RGBA64</span>&nbsp;<span class="keyword" id="5496954">struct</span>&nbsp;<span class="op" id="5496961">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5496964">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497054">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497122">Pix</span>&nbsp;<span class="op" id="5497126">[</span><span class="op" id="5497127">]</span><span class="builtintype" id="5497128">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497135">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497211">Stride</span>&nbsp;<span class="builtintype" id="5497218">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497223">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497255">Rect</span>&nbsp;<span class="ident" id="5497260">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5497270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5497273">func</span>&nbsp;<span class="op" id="5497278">(</span><span class="ident" id="5497279">p</span>&nbsp;<span class="op" id="5497281">*</span><span class="ident" id="5497282">RGBA64</span><span class="op" id="5497288">)</span>&nbsp;<span class="ident" id="5497290">ColorModel</span><span class="op" id="5497300">(</span><span class="op" id="5497301">)</span>&nbsp;<span class="ident" id="5497303">color</span><span class="op" id="5497308">.</span><span class="ident" id="5497309">Model</span>&nbsp;<span class="op" id="5497315">{</span>&nbsp;<span class="keyword" id="5497317">return</span>&nbsp;<span class="ident" id="5497324">color</span><span class="op" id="5497329">.</span><span class="ident" id="5497330">RGBA64Model</span>&nbsp;<span class="op" id="5497342">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5497345">func</span>&nbsp;<span class="op" id="5497350">(</span><span class="ident" id="5497351">p</span>&nbsp;<span class="op" id="5497353">*</span><span class="ident" id="5497354">RGBA64</span><span class="op" id="5497360">)</span>&nbsp;<span class="ident" id="5497362">Bounds</span><span class="op" id="5497368">(</span><span class="op" id="5497369">)</span>&nbsp;<span class="ident" id="5497371">Rectangle</span>&nbsp;<span class="op" id="5497381">{</span>&nbsp;<span class="keyword" id="5497383">return</span>&nbsp;<span class="ident" id="5497390">p</span><span class="op" id="5497391">.</span><span class="ident" id="5497392">Rect</span>&nbsp;<span class="op" id="5497397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5497400">func</span>&nbsp;<span class="op" id="5497405">(</span><span class="ident" id="5497406">p</span>&nbsp;<span class="op" id="5497408">*</span><span class="ident" id="5497409">RGBA64</span><span class="op" id="5497415">)</span>&nbsp;<span class="ident" id="5497417">At</span><span class="op" id="5497419">(</span><span class="ident" id="5497420">x</span><span class="op" id="5497421">,</span>&nbsp;<span class="ident" id="5497423">y</span>&nbsp;<span class="builtintype" id="5497425">int</span><span class="op" id="5497428">)</span>&nbsp;<span class="ident" id="5497430">color</span><span class="op" id="5497435">.</span><span class="ident" id="5497436">Color</span>&nbsp;<span class="op" id="5497442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497445">return</span>&nbsp;<span class="ident" id="5497452">p</span><span class="op" id="5497453">.</span><span class="ident" id="5497454">RGBA64At</span><span class="op" id="5497462">(</span><span class="ident" id="5497463">x</span><span class="op" id="5497464">,</span>&nbsp;<span class="ident" id="5497466">y</span><span class="op" id="5497467">)</span><br>
<span class="lineno">175</span><span class="op" id="5497469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5497472">func</span>&nbsp;<span class="op" id="5497477">(</span><span class="ident" id="5497478">p</span>&nbsp;<span class="op" id="5497480">*</span><span class="ident" id="5497481">RGBA64</span><span class="op" id="5497487">)</span>&nbsp;<span class="ident" id="5497489">RGBA64At</span><span class="op" id="5497497">(</span><span class="ident" id="5497498">x</span><span class="op" id="5497499">,</span>&nbsp;<span class="ident" id="5497501">y</span>&nbsp;<span class="builtintype" id="5497503">int</span><span class="op" id="5497506">)</span>&nbsp;<span class="ident" id="5497508">color</span><span class="op" id="5497513">.</span><span class="ident" id="5497514">RGBA64</span>&nbsp;<span class="op" id="5497521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497524">if</span>&nbsp;<span class="op" id="5497527">!</span><span class="op" id="5497528">(</span><span class="ident" id="5497529">Point</span><span class="op" id="5497534">{</span><span class="ident" id="5497535">x</span><span class="op" id="5497536">,</span>&nbsp;<span class="ident" id="5497538">y</span><span class="op" id="5497539">}</span><span class="op" id="5497540">.</span><span class="ident" id="5497541">In</span><span class="op" id="5497543">(</span><span class="ident" id="5497544">p</span><span class="op" id="5497545">.</span><span class="ident" id="5497546">Rect</span><span class="op" id="5497550">)</span><span class="op" id="5497551">)</span>&nbsp;<span class="op" id="5497553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497557">return</span>&nbsp;<span class="ident" id="5497564">color</span><span class="op" id="5497569">.</span><span class="ident" id="5497570">RGBA64</span><span class="op" id="5497576">{</span><span class="op" id="5497577">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497583">i</span>&nbsp;<span class="op" id="5497585">:=</span>&nbsp;<span class="ident" id="5497588">p</span><span class="op" id="5497589">.</span><span class="ident" id="5497590">PixOffset</span><span class="op" id="5497599">(</span><span class="ident" id="5497600">x</span><span class="op" id="5497601">,</span>&nbsp;<span class="ident" id="5497603">y</span><span class="op" id="5497604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497607">return</span>&nbsp;<span class="ident" id="5497614">color</span><span class="op" id="5497619">.</span><span class="ident" id="5497620">RGBA64</span><span class="op" id="5497626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5497630">uint16</span><span class="op" id="5497636">(</span><span class="ident" id="5497637">p</span><span class="op" id="5497638">.</span><span class="ident" id="5497639">Pix</span><span class="op" id="5497642">[</span><span class="ident" id="5497643">i</span><span class="op" id="5497644">+</span><span class="num" id="5497645">0</span><span class="op" id="5497646">]</span><span class="op" id="5497647">)</span><span class="op" id="5497648">&lt;&lt;</span><span class="num" id="5497650">8</span>&nbsp;<span class="op" id="5497652">|</span>&nbsp;<span class="builtintype" id="5497654">uint16</span><span class="op" id="5497660">(</span><span class="ident" id="5497661">p</span><span class="op" id="5497662">.</span><span class="ident" id="5497663">Pix</span><span class="op" id="5497666">[</span><span class="ident" id="5497667">i</span><span class="op" id="5497668">+</span><span class="num" id="5497669">1</span><span class="op" id="5497670">]</span><span class="op" id="5497671">)</span><span class="op" id="5497672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5497676">uint16</span><span class="op" id="5497682">(</span><span class="ident" id="5497683">p</span><span class="op" id="5497684">.</span><span class="ident" id="5497685">Pix</span><span class="op" id="5497688">[</span><span class="ident" id="5497689">i</span><span class="op" id="5497690">+</span><span class="num" id="5497691">2</span><span class="op" id="5497692">]</span><span class="op" id="5497693">)</span><span class="op" id="5497694">&lt;&lt;</span><span class="num" id="5497696">8</span>&nbsp;<span class="op" id="5497698">|</span>&nbsp;<span class="builtintype" id="5497700">uint16</span><span class="op" id="5497706">(</span><span class="ident" id="5497707">p</span><span class="op" id="5497708">.</span><span class="ident" id="5497709">Pix</span><span class="op" id="5497712">[</span><span class="ident" id="5497713">i</span><span class="op" id="5497714">+</span><span class="num" id="5497715">3</span><span class="op" id="5497716">]</span><span class="op" id="5497717">)</span><span class="op" id="5497718">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5497722">uint16</span><span class="op" id="5497728">(</span><span class="ident" id="5497729">p</span><span class="op" id="5497730">.</span><span class="ident" id="5497731">Pix</span><span class="op" id="5497734">[</span><span class="ident" id="5497735">i</span><span class="op" id="5497736">+</span><span class="num" id="5497737">4</span><span class="op" id="5497738">]</span><span class="op" id="5497739">)</span><span class="op" id="5497740">&lt;&lt;</span><span class="num" id="5497742">8</span>&nbsp;<span class="op" id="5497744">|</span>&nbsp;<span class="builtintype" id="5497746">uint16</span><span class="op" id="5497752">(</span><span class="ident" id="5497753">p</span><span class="op" id="5497754">.</span><span class="ident" id="5497755">Pix</span><span class="op" id="5497758">[</span><span class="ident" id="5497759">i</span><span class="op" id="5497760">+</span><span class="num" id="5497761">5</span><span class="op" id="5497762">]</span><span class="op" id="5497763">)</span><span class="op" id="5497764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5497768">uint16</span><span class="op" id="5497774">(</span><span class="ident" id="5497775">p</span><span class="op" id="5497776">.</span><span class="ident" id="5497777">Pix</span><span class="op" id="5497780">[</span><span class="ident" id="5497781">i</span><span class="op" id="5497782">+</span><span class="num" id="5497783">6</span><span class="op" id="5497784">]</span><span class="op" id="5497785">)</span><span class="op" id="5497786">&lt;&lt;</span><span class="num" id="5497788">8</span>&nbsp;<span class="op" id="5497790">|</span>&nbsp;<span class="builtintype" id="5497792">uint16</span><span class="op" id="5497798">(</span><span class="ident" id="5497799">p</span><span class="op" id="5497800">.</span><span class="ident" id="5497801">Pix</span><span class="op" id="5497804">[</span><span class="ident" id="5497805">i</span><span class="op" id="5497806">+</span><span class="num" id="5497807">7</span><span class="op" id="5497808">]</span><span class="op" id="5497809">)</span><span class="op" id="5497810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497813">}</span><br>
<span class="lineno"></span><span class="op" id="5497815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5497818">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5497897">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5497921">func</span>&nbsp;<span class="op" id="5497926">(</span><span class="ident" id="5497927">p</span>&nbsp;<span class="op" id="5497929">*</span><span class="ident" id="5497930">RGBA64</span><span class="op" id="5497936">)</span>&nbsp;<span class="ident" id="5497938">PixOffset</span><span class="op" id="5497947">(</span><span class="ident" id="5497948">x</span><span class="op" id="5497949">,</span>&nbsp;<span class="ident" id="5497951">y</span>&nbsp;<span class="builtintype" id="5497953">int</span><span class="op" id="5497956">)</span>&nbsp;<span class="builtintype" id="5497958">int</span>&nbsp;<span class="op" id="5497962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497965">return</span>&nbsp;<span class="op" id="5497972">(</span><span class="ident" id="5497973">y</span><span class="op" id="5497974">-</span><span class="ident" id="5497975">p</span><span class="op" id="5497976">.</span><span class="ident" id="5497977">Rect</span><span class="op" id="5497981">.</span><span class="ident" id="5497982">Min</span><span class="op" id="5497985">.</span><span class="ident" id="5497986">Y</span><span class="op" id="5497987">)</span><span class="op" id="5497988">*</span><span class="ident" id="5497989">p</span><span class="op" id="5497990">.</span><span class="ident" id="5497991">Stride</span>&nbsp;<span class="op" id="5497998">+</span>&nbsp;<span class="op" id="5498000">(</span><span class="ident" id="5498001">x</span><span class="op" id="5498002">-</span><span class="ident" id="5498003">p</span><span class="op" id="5498004">.</span><span class="ident" id="5498005">Rect</span><span class="op" id="5498009">.</span><span class="ident" id="5498010">Min</span><span class="op" id="5498013">.</span><span class="ident" id="5498014">X</span><span class="op" id="5498015">)</span><span class="op" id="5498016">*</span><span class="num" id="5498017">8</span><br>
<span class="lineno"></span><span class="op" id="5498019">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5498022">func</span>&nbsp;<span class="op" id="5498027">(</span><span class="ident" id="5498028">p</span>&nbsp;<span class="op" id="5498030">*</span><span class="ident" id="5498031">RGBA64</span><span class="op" id="5498037">)</span>&nbsp;<span class="ident" id="5498039">Set</span><span class="op" id="5498042">(</span><span class="ident" id="5498043">x</span><span class="op" id="5498044">,</span>&nbsp;<span class="ident" id="5498046">y</span>&nbsp;<span class="builtintype" id="5498048">int</span><span class="op" id="5498051">,</span>&nbsp;<span class="ident" id="5498053">c</span>&nbsp;<span class="ident" id="5498055">color</span><span class="op" id="5498060">.</span><span class="ident" id="5498061">Color</span><span class="op" id="5498066">)</span>&nbsp;<span class="op" id="5498068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498071">if</span>&nbsp;<span class="op" id="5498074">!</span><span class="op" id="5498075">(</span><span class="ident" id="5498076">Point</span><span class="op" id="5498081">{</span><span class="ident" id="5498082">x</span><span class="op" id="5498083">,</span>&nbsp;<span class="ident" id="5498085">y</span><span class="op" id="5498086">}</span><span class="op" id="5498087">.</span><span class="ident" id="5498088">In</span><span class="op" id="5498090">(</span><span class="ident" id="5498091">p</span><span class="op" id="5498092">.</span><span class="ident" id="5498093">Rect</span><span class="op" id="5498097">)</span><span class="op" id="5498098">)</span>&nbsp;<span class="op" id="5498100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498104">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498112">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498115">i</span>&nbsp;<span class="op" id="5498117">:=</span>&nbsp;<span class="ident" id="5498120">p</span><span class="op" id="5498121">.</span><span class="ident" id="5498122">PixOffset</span><span class="op" id="5498131">(</span><span class="ident" id="5498132">x</span><span class="op" id="5498133">,</span>&nbsp;<span class="ident" id="5498135">y</span><span class="op" id="5498136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498139">c1</span>&nbsp;<span class="op" id="5498142">:=</span>&nbsp;<span class="ident" id="5498145">color</span><span class="op" id="5498150">.</span><span class="ident" id="5498151">RGBA64Model</span><span class="op" id="5498162">.</span><span class="ident" id="5498163">Convert</span><span class="op" id="5498170">(</span><span class="ident" id="5498171">c</span><span class="op" id="5498172">)</span><span class="op" id="5498173">.</span><span class="op" id="5498174">(</span><span class="ident" id="5498175">color</span><span class="op" id="5498180">.</span><span class="ident" id="5498181">RGBA64</span><span class="op" id="5498187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498190">p</span><span class="op" id="5498191">.</span><span class="ident" id="5498192">Pix</span><span class="op" id="5498195">[</span><span class="ident" id="5498196">i</span><span class="op" id="5498197">+</span><span class="num" id="5498198">0</span><span class="op" id="5498199">]</span>&nbsp;<span class="op" id="5498201">=</span>&nbsp;<span class="builtintype" id="5498203">uint8</span><span class="op" id="5498208">(</span><span class="ident" id="5498209">c1</span><span class="op" id="5498211">.</span><span class="ident" id="5498212">R</span>&nbsp;<span class="op" id="5498214">&gt;&gt;</span>&nbsp;<span class="num" id="5498217">8</span><span class="op" id="5498218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498221">p</span><span class="op" id="5498222">.</span><span class="ident" id="5498223">Pix</span><span class="op" id="5498226">[</span><span class="ident" id="5498227">i</span><span class="op" id="5498228">+</span><span class="num" id="5498229">1</span><span class="op" id="5498230">]</span>&nbsp;<span class="op" id="5498232">=</span>&nbsp;<span class="builtintype" id="5498234">uint8</span><span class="op" id="5498239">(</span><span class="ident" id="5498240">c1</span><span class="op" id="5498242">.</span><span class="ident" id="5498243">R</span><span class="op" id="5498244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498247">p</span><span class="op" id="5498248">.</span><span class="ident" id="5498249">Pix</span><span class="op" id="5498252">[</span><span class="ident" id="5498253">i</span><span class="op" id="5498254">+</span><span class="num" id="5498255">2</span><span class="op" id="5498256">]</span>&nbsp;<span class="op" id="5498258">=</span>&nbsp;<span class="builtintype" id="5498260">uint8</span><span class="op" id="5498265">(</span><span class="ident" id="5498266">c1</span><span class="op" id="5498268">.</span><span class="ident" id="5498269">G</span>&nbsp;<span class="op" id="5498271">&gt;&gt;</span>&nbsp;<span class="num" id="5498274">8</span><span class="op" id="5498275">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498278">p</span><span class="op" id="5498279">.</span><span class="ident" id="5498280">Pix</span><span class="op" id="5498283">[</span><span class="ident" id="5498284">i</span><span class="op" id="5498285">+</span><span class="num" id="5498286">3</span><span class="op" id="5498287">]</span>&nbsp;<span class="op" id="5498289">=</span>&nbsp;<span class="builtintype" id="5498291">uint8</span><span class="op" id="5498296">(</span><span class="ident" id="5498297">c1</span><span class="op" id="5498299">.</span><span class="ident" id="5498300">G</span><span class="op" id="5498301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498304">p</span><span class="op" id="5498305">.</span><span class="ident" id="5498306">Pix</span><span class="op" id="5498309">[</span><span class="ident" id="5498310">i</span><span class="op" id="5498311">+</span><span class="num" id="5498312">4</span><span class="op" id="5498313">]</span>&nbsp;<span class="op" id="5498315">=</span>&nbsp;<span class="builtintype" id="5498317">uint8</span><span class="op" id="5498322">(</span><span class="ident" id="5498323">c1</span><span class="op" id="5498325">.</span><span class="ident" id="5498326">B</span>&nbsp;<span class="op" id="5498328">&gt;&gt;</span>&nbsp;<span class="num" id="5498331">8</span><span class="op" id="5498332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498335">p</span><span class="op" id="5498336">.</span><span class="ident" id="5498337">Pix</span><span class="op" id="5498340">[</span><span class="ident" id="5498341">i</span><span class="op" id="5498342">+</span><span class="num" id="5498343">5</span><span class="op" id="5498344">]</span>&nbsp;<span class="op" id="5498346">=</span>&nbsp;<span class="builtintype" id="5498348">uint8</span><span class="op" id="5498353">(</span><span class="ident" id="5498354">c1</span><span class="op" id="5498356">.</span><span class="ident" id="5498357">B</span><span class="op" id="5498358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498361">p</span><span class="op" id="5498362">.</span><span class="ident" id="5498363">Pix</span><span class="op" id="5498366">[</span><span class="ident" id="5498367">i</span><span class="op" id="5498368">+</span><span class="num" id="5498369">6</span><span class="op" id="5498370">]</span>&nbsp;<span class="op" id="5498372">=</span>&nbsp;<span class="builtintype" id="5498374">uint8</span><span class="op" id="5498379">(</span><span class="ident" id="5498380">c1</span><span class="op" id="5498382">.</span><span class="ident" id="5498383">A</span>&nbsp;<span class="op" id="5498385">&gt;&gt;</span>&nbsp;<span class="num" id="5498388">8</span><span class="op" id="5498389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498392">p</span><span class="op" id="5498393">.</span><span class="ident" id="5498394">Pix</span><span class="op" id="5498397">[</span><span class="ident" id="5498398">i</span><span class="op" id="5498399">+</span><span class="num" id="5498400">7</span><span class="op" id="5498401">]</span>&nbsp;<span class="op" id="5498403">=</span>&nbsp;<span class="builtintype" id="5498405">uint8</span><span class="op" id="5498410">(</span><span class="ident" id="5498411">c1</span><span class="op" id="5498413">.</span><span class="ident" id="5498414">A</span><span class="op" id="5498415">)</span><br>
<span class="lineno">210</span><span class="op" id="5498417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5498420">func</span>&nbsp;<span class="op" id="5498425">(</span><span class="ident" id="5498426">p</span>&nbsp;<span class="op" id="5498428">*</span><span class="ident" id="5498429">RGBA64</span><span class="op" id="5498435">)</span>&nbsp;<span class="ident" id="5498437">SetRGBA64</span><span class="op" id="5498446">(</span><span class="ident" id="5498447">x</span><span class="op" id="5498448">,</span>&nbsp;<span class="ident" id="5498450">y</span>&nbsp;<span class="builtintype" id="5498452">int</span><span class="op" id="5498455">,</span>&nbsp;<span class="ident" id="5498457">c</span>&nbsp;<span class="ident" id="5498459">color</span><span class="op" id="5498464">.</span><span class="ident" id="5498465">RGBA64</span><span class="op" id="5498471">)</span>&nbsp;<span class="op" id="5498473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498476">if</span>&nbsp;<span class="op" id="5498479">!</span><span class="op" id="5498480">(</span><span class="ident" id="5498481">Point</span><span class="op" id="5498486">{</span><span class="ident" id="5498487">x</span><span class="op" id="5498488">,</span>&nbsp;<span class="ident" id="5498490">y</span><span class="op" id="5498491">}</span><span class="op" id="5498492">.</span><span class="ident" id="5498493">In</span><span class="op" id="5498495">(</span><span class="ident" id="5498496">p</span><span class="op" id="5498497">.</span><span class="ident" id="5498498">Rect</span><span class="op" id="5498502">)</span><span class="op" id="5498503">)</span>&nbsp;<span class="op" id="5498505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498509">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498520">i</span>&nbsp;<span class="op" id="5498522">:=</span>&nbsp;<span class="ident" id="5498525">p</span><span class="op" id="5498526">.</span><span class="ident" id="5498527">PixOffset</span><span class="op" id="5498536">(</span><span class="ident" id="5498537">x</span><span class="op" id="5498538">,</span>&nbsp;<span class="ident" id="5498540">y</span><span class="op" id="5498541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498544">p</span><span class="op" id="5498545">.</span><span class="ident" id="5498546">Pix</span><span class="op" id="5498549">[</span><span class="ident" id="5498550">i</span><span class="op" id="5498551">+</span><span class="num" id="5498552">0</span><span class="op" id="5498553">]</span>&nbsp;<span class="op" id="5498555">=</span>&nbsp;<span class="builtintype" id="5498557">uint8</span><span class="op" id="5498562">(</span><span class="ident" id="5498563">c</span><span class="op" id="5498564">.</span><span class="ident" id="5498565">R</span>&nbsp;<span class="op" id="5498567">&gt;&gt;</span>&nbsp;<span class="num" id="5498570">8</span><span class="op" id="5498571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498574">p</span><span class="op" id="5498575">.</span><span class="ident" id="5498576">Pix</span><span class="op" id="5498579">[</span><span class="ident" id="5498580">i</span><span class="op" id="5498581">+</span><span class="num" id="5498582">1</span><span class="op" id="5498583">]</span>&nbsp;<span class="op" id="5498585">=</span>&nbsp;<span class="builtintype" id="5498587">uint8</span><span class="op" id="5498592">(</span><span class="ident" id="5498593">c</span><span class="op" id="5498594">.</span><span class="ident" id="5498595">R</span><span class="op" id="5498596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498599">p</span><span class="op" id="5498600">.</span><span class="ident" id="5498601">Pix</span><span class="op" id="5498604">[</span><span class="ident" id="5498605">i</span><span class="op" id="5498606">+</span><span class="num" id="5498607">2</span><span class="op" id="5498608">]</span>&nbsp;<span class="op" id="5498610">=</span>&nbsp;<span class="builtintype" id="5498612">uint8</span><span class="op" id="5498617">(</span><span class="ident" id="5498618">c</span><span class="op" id="5498619">.</span><span class="ident" id="5498620">G</span>&nbsp;<span class="op" id="5498622">&gt;&gt;</span>&nbsp;<span class="num" id="5498625">8</span><span class="op" id="5498626">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498629">p</span><span class="op" id="5498630">.</span><span class="ident" id="5498631">Pix</span><span class="op" id="5498634">[</span><span class="ident" id="5498635">i</span><span class="op" id="5498636">+</span><span class="num" id="5498637">3</span><span class="op" id="5498638">]</span>&nbsp;<span class="op" id="5498640">=</span>&nbsp;<span class="builtintype" id="5498642">uint8</span><span class="op" id="5498647">(</span><span class="ident" id="5498648">c</span><span class="op" id="5498649">.</span><span class="ident" id="5498650">G</span><span class="op" id="5498651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498654">p</span><span class="op" id="5498655">.</span><span class="ident" id="5498656">Pix</span><span class="op" id="5498659">[</span><span class="ident" id="5498660">i</span><span class="op" id="5498661">+</span><span class="num" id="5498662">4</span><span class="op" id="5498663">]</span>&nbsp;<span class="op" id="5498665">=</span>&nbsp;<span class="builtintype" id="5498667">uint8</span><span class="op" id="5498672">(</span><span class="ident" id="5498673">c</span><span class="op" id="5498674">.</span><span class="ident" id="5498675">B</span>&nbsp;<span class="op" id="5498677">&gt;&gt;</span>&nbsp;<span class="num" id="5498680">8</span><span class="op" id="5498681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498684">p</span><span class="op" id="5498685">.</span><span class="ident" id="5498686">Pix</span><span class="op" id="5498689">[</span><span class="ident" id="5498690">i</span><span class="op" id="5498691">+</span><span class="num" id="5498692">5</span><span class="op" id="5498693">]</span>&nbsp;<span class="op" id="5498695">=</span>&nbsp;<span class="builtintype" id="5498697">uint8</span><span class="op" id="5498702">(</span><span class="ident" id="5498703">c</span><span class="op" id="5498704">.</span><span class="ident" id="5498705">B</span><span class="op" id="5498706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498709">p</span><span class="op" id="5498710">.</span><span class="ident" id="5498711">Pix</span><span class="op" id="5498714">[</span><span class="ident" id="5498715">i</span><span class="op" id="5498716">+</span><span class="num" id="5498717">6</span><span class="op" id="5498718">]</span>&nbsp;<span class="op" id="5498720">=</span>&nbsp;<span class="builtintype" id="5498722">uint8</span><span class="op" id="5498727">(</span><span class="ident" id="5498728">c</span><span class="op" id="5498729">.</span><span class="ident" id="5498730">A</span>&nbsp;<span class="op" id="5498732">&gt;&gt;</span>&nbsp;<span class="num" id="5498735">8</span><span class="op" id="5498736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498739">p</span><span class="op" id="5498740">.</span><span class="ident" id="5498741">Pix</span><span class="op" id="5498744">[</span><span class="ident" id="5498745">i</span><span class="op" id="5498746">+</span><span class="num" id="5498747">7</span><span class="op" id="5498748">]</span>&nbsp;<span class="op" id="5498750">=</span>&nbsp;<span class="builtintype" id="5498752">uint8</span><span class="op" id="5498757">(</span><span class="ident" id="5498758">c</span><span class="op" id="5498759">.</span><span class="ident" id="5498760">A</span><span class="op" id="5498761">)</span><br>
<span class="lineno">225</span><span class="op" id="5498763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5498766">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5498843">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5498915">func</span>&nbsp;<span class="op" id="5498920">(</span><span class="ident" id="5498921">p</span>&nbsp;<span class="op" id="5498923">*</span><span class="ident" id="5498924">RGBA64</span><span class="op" id="5498930">)</span>&nbsp;<span class="ident" id="5498932">SubImage</span><span class="op" id="5498940">(</span><span class="ident" id="5498941">r</span>&nbsp;<span class="ident" id="5498943">Rectangle</span><span class="op" id="5498952">)</span>&nbsp;<span class="ident" id="5498954">Image</span>&nbsp;<span class="op" id="5498960">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498963">r</span>&nbsp;<span class="op" id="5498965">=</span>&nbsp;<span class="ident" id="5498967">r</span><span class="op" id="5498968">.</span><span class="ident" id="5498969">Intersect</span><span class="op" id="5498978">(</span><span class="ident" id="5498979">p</span><span class="op" id="5498980">.</span><span class="ident" id="5498981">Rect</span><span class="op" id="5498985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498988">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499069">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499151">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499201">if</span>&nbsp;<span class="ident" id="5499204">r</span><span class="op" id="5499205">.</span><span class="ident" id="5499206">Empty</span><span class="op" id="5499211">(</span><span class="op" id="5499212">)</span>&nbsp;<span class="op" id="5499214">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499218">return</span>&nbsp;<span class="op" id="5499225">&amp;</span><span class="ident" id="5499226">RGBA64</span><span class="op" id="5499232">{</span><span class="op" id="5499233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499239">i</span>&nbsp;<span class="op" id="5499241">:=</span>&nbsp;<span class="ident" id="5499244">p</span><span class="op" id="5499245">.</span><span class="ident" id="5499246">PixOffset</span><span class="op" id="5499255">(</span><span class="ident" id="5499256">r</span><span class="op" id="5499257">.</span><span class="ident" id="5499258">Min</span><span class="op" id="5499261">.</span><span class="ident" id="5499262">X</span><span class="op" id="5499263">,</span>&nbsp;<span class="ident" id="5499265">r</span><span class="op" id="5499266">.</span><span class="ident" id="5499267">Min</span><span class="op" id="5499270">.</span><span class="ident" id="5499271">Y</span><span class="op" id="5499272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499275">return</span>&nbsp;<span class="op" id="5499282">&amp;</span><span class="ident" id="5499283">RGBA64</span><span class="op" id="5499289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499293">Pix</span><span class="op" id="5499296">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499301">p</span><span class="op" id="5499302">.</span><span class="ident" id="5499303">Pix</span><span class="op" id="5499306">[</span><span class="ident" id="5499307">i</span><span class="op" id="5499308">:</span><span class="op" id="5499309">]</span><span class="op" id="5499310">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499314">Stride</span><span class="op" id="5499320">:</span>&nbsp;<span class="ident" id="5499322">p</span><span class="op" id="5499323">.</span><span class="ident" id="5499324">Stride</span><span class="op" id="5499330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499334">Rect</span><span class="op" id="5499338">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5499342">r</span><span class="op" id="5499343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499346">}</span><br>
<span class="lineno"></span><span class="op" id="5499348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5499351">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5499424">func</span>&nbsp;<span class="op" id="5499429">(</span><span class="ident" id="5499430">p</span>&nbsp;<span class="op" id="5499432">*</span><span class="ident" id="5499433">RGBA64</span><span class="op" id="5499439">)</span>&nbsp;<span class="ident" id="5499441">Opaque</span><span class="op" id="5499447">(</span><span class="op" id="5499448">)</span>&nbsp;<span class="builtintype" id="5499450">bool</span>&nbsp;<span class="op" id="5499455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499458">if</span>&nbsp;<span class="ident" id="5499461">p</span><span class="op" id="5499462">.</span><span class="ident" id="5499463">Rect</span><span class="op" id="5499467">.</span><span class="ident" id="5499468">Empty</span><span class="op" id="5499473">(</span><span class="op" id="5499474">)</span>&nbsp;<span class="op" id="5499476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499480">return</span>&nbsp;<span class="builtintype" id="5499487">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499493">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499496">i0</span><span class="op" id="5499498">,</span>&nbsp;<span class="ident" id="5499500">i1</span>&nbsp;<span class="op" id="5499503">:=</span>&nbsp;<span class="num" id="5499506">6</span><span class="op" id="5499507">,</span>&nbsp;<span class="ident" id="5499509">p</span><span class="op" id="5499510">.</span><span class="ident" id="5499511">Rect</span><span class="op" id="5499515">.</span><span class="ident" id="5499516">Dx</span><span class="op" id="5499518">(</span><span class="op" id="5499519">)</span><span class="op" id="5499520">*</span><span class="num" id="5499521">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499524">for</span>&nbsp;<span class="ident" id="5499528">y</span>&nbsp;<span class="op" id="5499530">:=</span>&nbsp;<span class="ident" id="5499533">p</span><span class="op" id="5499534">.</span><span class="ident" id="5499535">Rect</span><span class="op" id="5499539">.</span><span class="ident" id="5499540">Min</span><span class="op" id="5499543">.</span><span class="ident" id="5499544">Y</span><span class="op" id="5499545">;</span>&nbsp;<span class="ident" id="5499547">y</span>&nbsp;<span class="op" id="5499549">&lt;</span>&nbsp;<span class="ident" id="5499551">p</span><span class="op" id="5499552">.</span><span class="ident" id="5499553">Rect</span><span class="op" id="5499557">.</span><span class="ident" id="5499558">Max</span><span class="op" id="5499561">.</span><span class="ident" id="5499562">Y</span><span class="op" id="5499563">;</span>&nbsp;<span class="ident" id="5499565">y</span><span class="op" id="5499566">++</span>&nbsp;<span class="op" id="5499569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499573">for</span>&nbsp;<span class="ident" id="5499577">i</span>&nbsp;<span class="op" id="5499579">:=</span>&nbsp;<span class="ident" id="5499582">i0</span><span class="op" id="5499584">;</span>&nbsp;<span class="ident" id="5499586">i</span>&nbsp;<span class="op" id="5499588">&lt;</span>&nbsp;<span class="ident" id="5499590">i1</span><span class="op" id="5499592">;</span>&nbsp;<span class="ident" id="5499594">i</span>&nbsp;<span class="op" id="5499596">+=</span>&nbsp;<span class="num" id="5499599">8</span>&nbsp;<span class="op" id="5499601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499606">if</span>&nbsp;<span class="ident" id="5499609">p</span><span class="op" id="5499610">.</span><span class="ident" id="5499611">Pix</span><span class="op" id="5499614">[</span><span class="ident" id="5499615">i</span><span class="op" id="5499616">+</span><span class="num" id="5499617">0</span><span class="op" id="5499618">]</span>&nbsp;<span class="op" id="5499620">!=</span>&nbsp;<span class="num" id="5499623">0xff</span>&nbsp;<span class="op" id="5499628">||</span>&nbsp;<span class="ident" id="5499631">p</span><span class="op" id="5499632">.</span><span class="ident" id="5499633">Pix</span><span class="op" id="5499636">[</span><span class="ident" id="5499637">i</span><span class="op" id="5499638">+</span><span class="num" id="5499639">1</span><span class="op" id="5499640">]</span>&nbsp;<span class="op" id="5499642">!=</span>&nbsp;<span class="num" id="5499645">0xff</span>&nbsp;<span class="op" id="5499650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499656">return</span>&nbsp;<span class="builtintype" id="5499663">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499680">i0</span>&nbsp;<span class="op" id="5499683">+=</span>&nbsp;<span class="ident" id="5499686">p</span><span class="op" id="5499687">.</span><span class="ident" id="5499688">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499697">i1</span>&nbsp;<span class="op" id="5499700">+=</span>&nbsp;<span class="ident" id="5499703">p</span><span class="op" id="5499704">.</span><span class="ident" id="5499705">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499713">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499716">return</span>&nbsp;<span class="builtintype" id="5499723">true</span><br>
<span class="lineno"></span><span class="op" id="5499728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5499731">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5499788">func</span>&nbsp;<span class="ident" id="5499793">NewRGBA64</span><span class="op" id="5499802">(</span><span class="ident" id="5499803">r</span>&nbsp;<span class="ident" id="5499805">Rectangle</span><span class="op" id="5499814">)</span>&nbsp;<span class="op" id="5499816">*</span><span class="ident" id="5499817">RGBA64</span>&nbsp;<span class="op" id="5499824">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499827">w</span><span class="op" id="5499828">,</span>&nbsp;<span class="ident" id="5499830">h</span>&nbsp;<span class="op" id="5499832">:=</span>&nbsp;<span class="ident" id="5499835">r</span><span class="op" id="5499836">.</span><span class="ident" id="5499837">Dx</span><span class="op" id="5499839">(</span><span class="op" id="5499840">)</span><span class="op" id="5499841">,</span>&nbsp;<span class="ident" id="5499843">r</span><span class="op" id="5499844">.</span><span class="ident" id="5499845">Dy</span><span class="op" id="5499847">(</span><span class="op" id="5499848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499851">pix</span>&nbsp;<span class="op" id="5499855">:=</span>&nbsp;<span class="builtinfunc" id="5499858">make</span><span class="op" id="5499862">(</span><span class="op" id="5499863">[</span><span class="op" id="5499864">]</span><span class="builtintype" id="5499865">uint8</span><span class="op" id="5499870">,</span>&nbsp;<span class="num" id="5499872">8</span><span class="op" id="5499873">*</span><span class="ident" id="5499874">w</span><span class="op" id="5499875">*</span><span class="ident" id="5499876">h</span><span class="op" id="5499877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499880">return</span>&nbsp;<span class="op" id="5499887">&amp;</span><span class="ident" id="5499888">RGBA64</span><span class="op" id="5499894">{</span><span class="ident" id="5499895">pix</span><span class="op" id="5499898">,</span>&nbsp;<span class="num" id="5499900">8</span>&nbsp;<span class="op" id="5499902">*</span>&nbsp;<span class="ident" id="5499904">w</span><span class="op" id="5499905">,</span>&nbsp;<span class="ident" id="5499907">r</span><span class="op" id="5499908">}</span><br>
<span class="lineno"></span><span class="op" id="5499910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5499913">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5499988">type</span>&nbsp;<span class="ident" id="5499993">NRGBA</span>&nbsp;<span class="keyword" id="5499999">struct</span>&nbsp;<span class="op" id="5500006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500009">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500077">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500145">Pix</span>&nbsp;<span class="op" id="5500149">[</span><span class="op" id="5500150">]</span><span class="builtintype" id="5500151">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500158">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500234">Stride</span>&nbsp;<span class="builtintype" id="5500241">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500246">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500278">Rect</span>&nbsp;<span class="ident" id="5500283">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5500293">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5500296">func</span>&nbsp;<span class="op" id="5500301">(</span><span class="ident" id="5500302">p</span>&nbsp;<span class="op" id="5500304">*</span><span class="ident" id="5500305">NRGBA</span><span class="op" id="5500310">)</span>&nbsp;<span class="ident" id="5500312">ColorModel</span><span class="op" id="5500322">(</span><span class="op" id="5500323">)</span>&nbsp;<span class="ident" id="5500325">color</span><span class="op" id="5500330">.</span><span class="ident" id="5500331">Model</span>&nbsp;<span class="op" id="5500337">{</span>&nbsp;<span class="keyword" id="5500339">return</span>&nbsp;<span class="ident" id="5500346">color</span><span class="op" id="5500351">.</span><span class="ident" id="5500352">NRGBAModel</span>&nbsp;<span class="op" id="5500363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5500366">func</span>&nbsp;<span class="op" id="5500371">(</span><span class="ident" id="5500372">p</span>&nbsp;<span class="op" id="5500374">*</span><span class="ident" id="5500375">NRGBA</span><span class="op" id="5500380">)</span>&nbsp;<span class="ident" id="5500382">Bounds</span><span class="op" id="5500388">(</span><span class="op" id="5500389">)</span>&nbsp;<span class="ident" id="5500391">Rectangle</span>&nbsp;<span class="op" id="5500401">{</span>&nbsp;<span class="keyword" id="5500403">return</span>&nbsp;<span class="ident" id="5500410">p</span><span class="op" id="5500411">.</span><span class="ident" id="5500412">Rect</span>&nbsp;<span class="op" id="5500417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5500420">func</span>&nbsp;<span class="op" id="5500425">(</span><span class="ident" id="5500426">p</span>&nbsp;<span class="op" id="5500428">*</span><span class="ident" id="5500429">NRGBA</span><span class="op" id="5500434">)</span>&nbsp;<span class="ident" id="5500436">At</span><span class="op" id="5500438">(</span><span class="ident" id="5500439">x</span><span class="op" id="5500440">,</span>&nbsp;<span class="ident" id="5500442">y</span>&nbsp;<span class="builtintype" id="5500444">int</span><span class="op" id="5500447">)</span>&nbsp;<span class="ident" id="5500449">color</span><span class="op" id="5500454">.</span><span class="ident" id="5500455">Color</span>&nbsp;<span class="op" id="5500461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500464">return</span>&nbsp;<span class="ident" id="5500471">p</span><span class="op" id="5500472">.</span><span class="ident" id="5500473">NRGBAAt</span><span class="op" id="5500480">(</span><span class="ident" id="5500481">x</span><span class="op" id="5500482">,</span>&nbsp;<span class="ident" id="5500484">y</span><span class="op" id="5500485">)</span><br>
<span class="lineno"></span><span class="op" id="5500487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5500490">func</span>&nbsp;<span class="op" id="5500495">(</span><span class="ident" id="5500496">p</span>&nbsp;<span class="op" id="5500498">*</span><span class="ident" id="5500499">NRGBA</span><span class="op" id="5500504">)</span>&nbsp;<span class="ident" id="5500506">NRGBAAt</span><span class="op" id="5500513">(</span><span class="ident" id="5500514">x</span><span class="op" id="5500515">,</span>&nbsp;<span class="ident" id="5500517">y</span>&nbsp;<span class="builtintype" id="5500519">int</span><span class="op" id="5500522">)</span>&nbsp;<span class="ident" id="5500524">color</span><span class="op" id="5500529">.</span><span class="ident" id="5500530">NRGBA</span>&nbsp;<span class="op" id="5500536">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500539">if</span>&nbsp;<span class="op" id="5500542">!</span><span class="op" id="5500543">(</span><span class="ident" id="5500544">Point</span><span class="op" id="5500549">{</span><span class="ident" id="5500550">x</span><span class="op" id="5500551">,</span>&nbsp;<span class="ident" id="5500553">y</span><span class="op" id="5500554">}</span><span class="op" id="5500555">.</span><span class="ident" id="5500556">In</span><span class="op" id="5500558">(</span><span class="ident" id="5500559">p</span><span class="op" id="5500560">.</span><span class="ident" id="5500561">Rect</span><span class="op" id="5500565">)</span><span class="op" id="5500566">)</span>&nbsp;<span class="op" id="5500568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500572">return</span>&nbsp;<span class="ident" id="5500579">color</span><span class="op" id="5500584">.</span><span class="ident" id="5500585">NRGBA</span><span class="op" id="5500590">{</span><span class="op" id="5500591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500597">i</span>&nbsp;<span class="op" id="5500599">:=</span>&nbsp;<span class="ident" id="5500602">p</span><span class="op" id="5500603">.</span><span class="ident" id="5500604">PixOffset</span><span class="op" id="5500613">(</span><span class="ident" id="5500614">x</span><span class="op" id="5500615">,</span>&nbsp;<span class="ident" id="5500617">y</span><span class="op" id="5500618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500621">return</span>&nbsp;<span class="ident" id="5500628">color</span><span class="op" id="5500633">.</span><span class="ident" id="5500634">NRGBA</span><span class="op" id="5500639">{</span><span class="ident" id="5500640">p</span><span class="op" id="5500641">.</span><span class="ident" id="5500642">Pix</span><span class="op" id="5500645">[</span><span class="ident" id="5500646">i</span><span class="op" id="5500647">+</span><span class="num" id="5500648">0</span><span class="op" id="5500649">]</span><span class="op" id="5500650">,</span>&nbsp;<span class="ident" id="5500652">p</span><span class="op" id="5500653">.</span><span class="ident" id="5500654">Pix</span><span class="op" id="5500657">[</span><span class="ident" id="5500658">i</span><span class="op" id="5500659">+</span><span class="num" id="5500660">1</span><span class="op" id="5500661">]</span><span class="op" id="5500662">,</span>&nbsp;<span class="ident" id="5500664">p</span><span class="op" id="5500665">.</span><span class="ident" id="5500666">Pix</span><span class="op" id="5500669">[</span><span class="ident" id="5500670">i</span><span class="op" id="5500671">+</span><span class="num" id="5500672">2</span><span class="op" id="5500673">]</span><span class="op" id="5500674">,</span>&nbsp;<span class="ident" id="5500676">p</span><span class="op" id="5500677">.</span><span class="ident" id="5500678">Pix</span><span class="op" id="5500681">[</span><span class="ident" id="5500682">i</span><span class="op" id="5500683">+</span><span class="num" id="5500684">3</span><span class="op" id="5500685">]</span><span class="op" id="5500686">}</span><br>
<span class="lineno">295</span><span class="op" id="5500688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5500691">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5500770">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5500794">func</span>&nbsp;<span class="op" id="5500799">(</span><span class="ident" id="5500800">p</span>&nbsp;<span class="op" id="5500802">*</span><span class="ident" id="5500803">NRGBA</span><span class="op" id="5500808">)</span>&nbsp;<span class="ident" id="5500810">PixOffset</span><span class="op" id="5500819">(</span><span class="ident" id="5500820">x</span><span class="op" id="5500821">,</span>&nbsp;<span class="ident" id="5500823">y</span>&nbsp;<span class="builtintype" id="5500825">int</span><span class="op" id="5500828">)</span>&nbsp;<span class="builtintype" id="5500830">int</span>&nbsp;<span class="op" id="5500834">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500837">return</span>&nbsp;<span class="op" id="5500844">(</span><span class="ident" id="5500845">y</span><span class="op" id="5500846">-</span><span class="ident" id="5500847">p</span><span class="op" id="5500848">.</span><span class="ident" id="5500849">Rect</span><span class="op" id="5500853">.</span><span class="ident" id="5500854">Min</span><span class="op" id="5500857">.</span><span class="ident" id="5500858">Y</span><span class="op" id="5500859">)</span><span class="op" id="5500860">*</span><span class="ident" id="5500861">p</span><span class="op" id="5500862">.</span><span class="ident" id="5500863">Stride</span>&nbsp;<span class="op" id="5500870">+</span>&nbsp;<span class="op" id="5500872">(</span><span class="ident" id="5500873">x</span><span class="op" id="5500874">-</span><span class="ident" id="5500875">p</span><span class="op" id="5500876">.</span><span class="ident" id="5500877">Rect</span><span class="op" id="5500881">.</span><span class="ident" id="5500882">Min</span><span class="op" id="5500885">.</span><span class="ident" id="5500886">X</span><span class="op" id="5500887">)</span><span class="op" id="5500888">*</span><span class="num" id="5500889">4</span><br>
<span class="lineno"></span><span class="op" id="5500891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5500894">func</span>&nbsp;<span class="op" id="5500899">(</span><span class="ident" id="5500900">p</span>&nbsp;<span class="op" id="5500902">*</span><span class="ident" id="5500903">NRGBA</span><span class="op" id="5500908">)</span>&nbsp;<span class="ident" id="5500910">Set</span><span class="op" id="5500913">(</span><span class="ident" id="5500914">x</span><span class="op" id="5500915">,</span>&nbsp;<span class="ident" id="5500917">y</span>&nbsp;<span class="builtintype" id="5500919">int</span><span class="op" id="5500922">,</span>&nbsp;<span class="ident" id="5500924">c</span>&nbsp;<span class="ident" id="5500926">color</span><span class="op" id="5500931">.</span><span class="ident" id="5500932">Color</span><span class="op" id="5500937">)</span>&nbsp;<span class="op" id="5500939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500942">if</span>&nbsp;<span class="op" id="5500945">!</span><span class="op" id="5500946">(</span><span class="ident" id="5500947">Point</span><span class="op" id="5500952">{</span><span class="ident" id="5500953">x</span><span class="op" id="5500954">,</span>&nbsp;<span class="ident" id="5500956">y</span><span class="op" id="5500957">}</span><span class="op" id="5500958">.</span><span class="ident" id="5500959">In</span><span class="op" id="5500961">(</span><span class="ident" id="5500962">p</span><span class="op" id="5500963">.</span><span class="ident" id="5500964">Rect</span><span class="op" id="5500968">)</span><span class="op" id="5500969">)</span>&nbsp;<span class="op" id="5500971">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500975">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500986">i</span>&nbsp;<span class="op" id="5500988">:=</span>&nbsp;<span class="ident" id="5500991">p</span><span class="op" id="5500992">.</span><span class="ident" id="5500993">PixOffset</span><span class="op" id="5501002">(</span><span class="ident" id="5501003">x</span><span class="op" id="5501004">,</span>&nbsp;<span class="ident" id="5501006">y</span><span class="op" id="5501007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501010">c1</span>&nbsp;<span class="op" id="5501013">:=</span>&nbsp;<span class="ident" id="5501016">color</span><span class="op" id="5501021">.</span><span class="ident" id="5501022">NRGBAModel</span><span class="op" id="5501032">.</span><span class="ident" id="5501033">Convert</span><span class="op" id="5501040">(</span><span class="ident" id="5501041">c</span><span class="op" id="5501042">)</span><span class="op" id="5501043">.</span><span class="op" id="5501044">(</span><span class="ident" id="5501045">color</span><span class="op" id="5501050">.</span><span class="ident" id="5501051">NRGBA</span><span class="op" id="5501056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501059">p</span><span class="op" id="5501060">.</span><span class="ident" id="5501061">Pix</span><span class="op" id="5501064">[</span><span class="ident" id="5501065">i</span><span class="op" id="5501066">+</span><span class="num" id="5501067">0</span><span class="op" id="5501068">]</span>&nbsp;<span class="op" id="5501070">=</span>&nbsp;<span class="ident" id="5501072">c1</span><span class="op" id="5501074">.</span><span class="ident" id="5501075">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501078">p</span><span class="op" id="5501079">.</span><span class="ident" id="5501080">Pix</span><span class="op" id="5501083">[</span><span class="ident" id="5501084">i</span><span class="op" id="5501085">+</span><span class="num" id="5501086">1</span><span class="op" id="5501087">]</span>&nbsp;<span class="op" id="5501089">=</span>&nbsp;<span class="ident" id="5501091">c1</span><span class="op" id="5501093">.</span><span class="ident" id="5501094">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501097">p</span><span class="op" id="5501098">.</span><span class="ident" id="5501099">Pix</span><span class="op" id="5501102">[</span><span class="ident" id="5501103">i</span><span class="op" id="5501104">+</span><span class="num" id="5501105">2</span><span class="op" id="5501106">]</span>&nbsp;<span class="op" id="5501108">=</span>&nbsp;<span class="ident" id="5501110">c1</span><span class="op" id="5501112">.</span><span class="ident" id="5501113">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501116">p</span><span class="op" id="5501117">.</span><span class="ident" id="5501118">Pix</span><span class="op" id="5501121">[</span><span class="ident" id="5501122">i</span><span class="op" id="5501123">+</span><span class="num" id="5501124">3</span><span class="op" id="5501125">]</span>&nbsp;<span class="op" id="5501127">=</span>&nbsp;<span class="ident" id="5501129">c1</span><span class="op" id="5501131">.</span><span class="ident" id="5501132">A</span><br>
<span class="lineno"></span><span class="op" id="5501134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5501137">func</span>&nbsp;<span class="op" id="5501142">(</span><span class="ident" id="5501143">p</span>&nbsp;<span class="op" id="5501145">*</span><span class="ident" id="5501146">NRGBA</span><span class="op" id="5501151">)</span>&nbsp;<span class="ident" id="5501153">SetNRGBA</span><span class="op" id="5501161">(</span><span class="ident" id="5501162">x</span><span class="op" id="5501163">,</span>&nbsp;<span class="ident" id="5501165">y</span>&nbsp;<span class="builtintype" id="5501167">int</span><span class="op" id="5501170">,</span>&nbsp;<span class="ident" id="5501172">c</span>&nbsp;<span class="ident" id="5501174">color</span><span class="op" id="5501179">.</span><span class="ident" id="5501180">NRGBA</span><span class="op" id="5501185">)</span>&nbsp;<span class="op" id="5501187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501190">if</span>&nbsp;<span class="op" id="5501193">!</span><span class="op" id="5501194">(</span><span class="ident" id="5501195">Point</span><span class="op" id="5501200">{</span><span class="ident" id="5501201">x</span><span class="op" id="5501202">,</span>&nbsp;<span class="ident" id="5501204">y</span><span class="op" id="5501205">}</span><span class="op" id="5501206">.</span><span class="ident" id="5501207">In</span><span class="op" id="5501209">(</span><span class="ident" id="5501210">p</span><span class="op" id="5501211">.</span><span class="ident" id="5501212">Rect</span><span class="op" id="5501216">)</span><span class="op" id="5501217">)</span>&nbsp;<span class="op" id="5501219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501223">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501234">i</span>&nbsp;<span class="op" id="5501236">:=</span>&nbsp;<span class="ident" id="5501239">p</span><span class="op" id="5501240">.</span><span class="ident" id="5501241">PixOffset</span><span class="op" id="5501250">(</span><span class="ident" id="5501251">x</span><span class="op" id="5501252">,</span>&nbsp;<span class="ident" id="5501254">y</span><span class="op" id="5501255">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501258">p</span><span class="op" id="5501259">.</span><span class="ident" id="5501260">Pix</span><span class="op" id="5501263">[</span><span class="ident" id="5501264">i</span><span class="op" id="5501265">+</span><span class="num" id="5501266">0</span><span class="op" id="5501267">]</span>&nbsp;<span class="op" id="5501269">=</span>&nbsp;<span class="ident" id="5501271">c</span><span class="op" id="5501272">.</span><span class="ident" id="5501273">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501276">p</span><span class="op" id="5501277">.</span><span class="ident" id="5501278">Pix</span><span class="op" id="5501281">[</span><span class="ident" id="5501282">i</span><span class="op" id="5501283">+</span><span class="num" id="5501284">1</span><span class="op" id="5501285">]</span>&nbsp;<span class="op" id="5501287">=</span>&nbsp;<span class="ident" id="5501289">c</span><span class="op" id="5501290">.</span><span class="ident" id="5501291">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501294">p</span><span class="op" id="5501295">.</span><span class="ident" id="5501296">Pix</span><span class="op" id="5501299">[</span><span class="ident" id="5501300">i</span><span class="op" id="5501301">+</span><span class="num" id="5501302">2</span><span class="op" id="5501303">]</span>&nbsp;<span class="op" id="5501305">=</span>&nbsp;<span class="ident" id="5501307">c</span><span class="op" id="5501308">.</span><span class="ident" id="5501309">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501312">p</span><span class="op" id="5501313">.</span><span class="ident" id="5501314">Pix</span><span class="op" id="5501317">[</span><span class="ident" id="5501318">i</span><span class="op" id="5501319">+</span><span class="num" id="5501320">3</span><span class="op" id="5501321">]</span>&nbsp;<span class="op" id="5501323">=</span>&nbsp;<span class="ident" id="5501325">c</span><span class="op" id="5501326">.</span><span class="ident" id="5501327">A</span><br>
<span class="lineno"></span><span class="op" id="5501329">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5501332">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5501409">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5501481">func</span>&nbsp;<span class="op" id="5501486">(</span><span class="ident" id="5501487">p</span>&nbsp;<span class="op" id="5501489">*</span><span class="ident" id="5501490">NRGBA</span><span class="op" id="5501495">)</span>&nbsp;<span class="ident" id="5501497">SubImage</span><span class="op" id="5501505">(</span><span class="ident" id="5501506">r</span>&nbsp;<span class="ident" id="5501508">Rectangle</span><span class="op" id="5501517">)</span>&nbsp;<span class="ident" id="5501519">Image</span>&nbsp;<span class="op" id="5501525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501528">r</span>&nbsp;<span class="op" id="5501530">=</span>&nbsp;<span class="ident" id="5501532">r</span><span class="op" id="5501533">.</span><span class="ident" id="5501534">Intersect</span><span class="op" id="5501543">(</span><span class="ident" id="5501544">p</span><span class="op" id="5501545">.</span><span class="ident" id="5501546">Rect</span><span class="op" id="5501550">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501553">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501634">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501716">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501766">if</span>&nbsp;<span class="ident" id="5501769">r</span><span class="op" id="5501770">.</span><span class="ident" id="5501771">Empty</span><span class="op" id="5501776">(</span><span class="op" id="5501777">)</span>&nbsp;<span class="op" id="5501779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501783">return</span>&nbsp;<span class="op" id="5501790">&amp;</span><span class="ident" id="5501791">NRGBA</span><span class="op" id="5501796">{</span><span class="op" id="5501797">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501803">i</span>&nbsp;<span class="op" id="5501805">:=</span>&nbsp;<span class="ident" id="5501808">p</span><span class="op" id="5501809">.</span><span class="ident" id="5501810">PixOffset</span><span class="op" id="5501819">(</span><span class="ident" id="5501820">r</span><span class="op" id="5501821">.</span><span class="ident" id="5501822">Min</span><span class="op" id="5501825">.</span><span class="ident" id="5501826">X</span><span class="op" id="5501827">,</span>&nbsp;<span class="ident" id="5501829">r</span><span class="op" id="5501830">.</span><span class="ident" id="5501831">Min</span><span class="op" id="5501834">.</span><span class="ident" id="5501835">Y</span><span class="op" id="5501836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501839">return</span>&nbsp;<span class="op" id="5501846">&amp;</span><span class="ident" id="5501847">NRGBA</span><span class="op" id="5501852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501856">Pix</span><span class="op" id="5501859">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501864">p</span><span class="op" id="5501865">.</span><span class="ident" id="5501866">Pix</span><span class="op" id="5501869">[</span><span class="ident" id="5501870">i</span><span class="op" id="5501871">:</span><span class="op" id="5501872">]</span><span class="op" id="5501873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501877">Stride</span><span class="op" id="5501883">:</span>&nbsp;<span class="ident" id="5501885">p</span><span class="op" id="5501886">.</span><span class="ident" id="5501887">Stride</span><span class="op" id="5501893">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501897">Rect</span><span class="op" id="5501901">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5501905">r</span><span class="op" id="5501906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501909">}</span><br>
<span class="lineno"></span><span class="op" id="5501911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5501914">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5501987">func</span>&nbsp;<span class="op" id="5501992">(</span><span class="ident" id="5501993">p</span>&nbsp;<span class="op" id="5501995">*</span><span class="ident" id="5501996">NRGBA</span><span class="op" id="5502001">)</span>&nbsp;<span class="ident" id="5502003">Opaque</span><span class="op" id="5502009">(</span><span class="op" id="5502010">)</span>&nbsp;<span class="builtintype" id="5502012">bool</span>&nbsp;<span class="op" id="5502017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502020">if</span>&nbsp;<span class="ident" id="5502023">p</span><span class="op" id="5502024">.</span><span class="ident" id="5502025">Rect</span><span class="op" id="5502029">.</span><span class="ident" id="5502030">Empty</span><span class="op" id="5502035">(</span><span class="op" id="5502036">)</span>&nbsp;<span class="op" id="5502038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502042">return</span>&nbsp;<span class="builtintype" id="5502049">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502058">i0</span><span class="op" id="5502060">,</span>&nbsp;<span class="ident" id="5502062">i1</span>&nbsp;<span class="op" id="5502065">:=</span>&nbsp;<span class="num" id="5502068">3</span><span class="op" id="5502069">,</span>&nbsp;<span class="ident" id="5502071">p</span><span class="op" id="5502072">.</span><span class="ident" id="5502073">Rect</span><span class="op" id="5502077">.</span><span class="ident" id="5502078">Dx</span><span class="op" id="5502080">(</span><span class="op" id="5502081">)</span><span class="op" id="5502082">*</span><span class="num" id="5502083">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502086">for</span>&nbsp;<span class="ident" id="5502090">y</span>&nbsp;<span class="op" id="5502092">:=</span>&nbsp;<span class="ident" id="5502095">p</span><span class="op" id="5502096">.</span><span class="ident" id="5502097">Rect</span><span class="op" id="5502101">.</span><span class="ident" id="5502102">Min</span><span class="op" id="5502105">.</span><span class="ident" id="5502106">Y</span><span class="op" id="5502107">;</span>&nbsp;<span class="ident" id="5502109">y</span>&nbsp;<span class="op" id="5502111">&lt;</span>&nbsp;<span class="ident" id="5502113">p</span><span class="op" id="5502114">.</span><span class="ident" id="5502115">Rect</span><span class="op" id="5502119">.</span><span class="ident" id="5502120">Max</span><span class="op" id="5502123">.</span><span class="ident" id="5502124">Y</span><span class="op" id="5502125">;</span>&nbsp;<span class="ident" id="5502127">y</span><span class="op" id="5502128">++</span>&nbsp;<span class="op" id="5502131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502135">for</span>&nbsp;<span class="ident" id="5502139">i</span>&nbsp;<span class="op" id="5502141">:=</span>&nbsp;<span class="ident" id="5502144">i0</span><span class="op" id="5502146">;</span>&nbsp;<span class="ident" id="5502148">i</span>&nbsp;<span class="op" id="5502150">&lt;</span>&nbsp;<span class="ident" id="5502152">i1</span><span class="op" id="5502154">;</span>&nbsp;<span class="ident" id="5502156">i</span>&nbsp;<span class="op" id="5502158">+=</span>&nbsp;<span class="num" id="5502161">4</span>&nbsp;<span class="op" id="5502163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502168">if</span>&nbsp;<span class="ident" id="5502171">p</span><span class="op" id="5502172">.</span><span class="ident" id="5502173">Pix</span><span class="op" id="5502176">[</span><span class="ident" id="5502177">i</span><span class="op" id="5502178">]</span>&nbsp;<span class="op" id="5502180">!=</span>&nbsp;<span class="num" id="5502183">0xff</span>&nbsp;<span class="op" id="5502188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502194">return</span>&nbsp;<span class="builtintype" id="5502201">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502210">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502218">i0</span>&nbsp;<span class="op" id="5502221">+=</span>&nbsp;<span class="ident" id="5502224">p</span><span class="op" id="5502225">.</span><span class="ident" id="5502226">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502235">i1</span>&nbsp;<span class="op" id="5502238">+=</span>&nbsp;<span class="ident" id="5502241">p</span><span class="op" id="5502242">.</span><span class="ident" id="5502243">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502254">return</span>&nbsp;<span class="builtintype" id="5502261">true</span><br>
<span class="lineno">360</span><span class="op" id="5502266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5502269">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5502324">func</span>&nbsp;<span class="ident" id="5502329">NewNRGBA</span><span class="op" id="5502337">(</span><span class="ident" id="5502338">r</span>&nbsp;<span class="ident" id="5502340">Rectangle</span><span class="op" id="5502349">)</span>&nbsp;<span class="op" id="5502351">*</span><span class="ident" id="5502352">NRGBA</span>&nbsp;<span class="op" id="5502358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502361">w</span><span class="op" id="5502362">,</span>&nbsp;<span class="ident" id="5502364">h</span>&nbsp;<span class="op" id="5502366">:=</span>&nbsp;<span class="ident" id="5502369">r</span><span class="op" id="5502370">.</span><span class="ident" id="5502371">Dx</span><span class="op" id="5502373">(</span><span class="op" id="5502374">)</span><span class="op" id="5502375">,</span>&nbsp;<span class="ident" id="5502377">r</span><span class="op" id="5502378">.</span><span class="ident" id="5502379">Dy</span><span class="op" id="5502381">(</span><span class="op" id="5502382">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502385">pix</span>&nbsp;<span class="op" id="5502389">:=</span>&nbsp;<span class="builtinfunc" id="5502392">make</span><span class="op" id="5502396">(</span><span class="op" id="5502397">[</span><span class="op" id="5502398">]</span><span class="builtintype" id="5502399">uint8</span><span class="op" id="5502404">,</span>&nbsp;<span class="num" id="5502406">4</span><span class="op" id="5502407">*</span><span class="ident" id="5502408">w</span><span class="op" id="5502409">*</span><span class="ident" id="5502410">h</span><span class="op" id="5502411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502414">return</span>&nbsp;<span class="op" id="5502421">&amp;</span><span class="ident" id="5502422">NRGBA</span><span class="op" id="5502427">{</span><span class="ident" id="5502428">pix</span><span class="op" id="5502431">,</span>&nbsp;<span class="num" id="5502433">4</span>&nbsp;<span class="op" id="5502435">*</span>&nbsp;<span class="ident" id="5502437">w</span><span class="op" id="5502438">,</span>&nbsp;<span class="ident" id="5502440">r</span><span class="op" id="5502441">}</span><br>
<span class="lineno"></span><span class="op" id="5502443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5502446">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5502525">type</span>&nbsp;<span class="ident" id="5502530">NRGBA64</span>&nbsp;<span class="keyword" id="5502538">struct</span>&nbsp;<span class="op" id="5502545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502548">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502638">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502706">Pix</span>&nbsp;<span class="op" id="5502710">[</span><span class="op" id="5502711">]</span><span class="builtintype" id="5502712">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502719">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502795">Stride</span>&nbsp;<span class="builtintype" id="5502802">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502807">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502839">Rect</span>&nbsp;<span class="ident" id="5502844">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5502854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5502857">func</span>&nbsp;<span class="op" id="5502862">(</span><span class="ident" id="5502863">p</span>&nbsp;<span class="op" id="5502865">*</span><span class="ident" id="5502866">NRGBA64</span><span class="op" id="5502873">)</span>&nbsp;<span class="ident" id="5502875">ColorModel</span><span class="op" id="5502885">(</span><span class="op" id="5502886">)</span>&nbsp;<span class="ident" id="5502888">color</span><span class="op" id="5502893">.</span><span class="ident" id="5502894">Model</span>&nbsp;<span class="op" id="5502900">{</span>&nbsp;<span class="keyword" id="5502902">return</span>&nbsp;<span class="ident" id="5502909">color</span><span class="op" id="5502914">.</span><span class="ident" id="5502915">NRGBA64Model</span>&nbsp;<span class="op" id="5502928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5502931">func</span>&nbsp;<span class="op" id="5502936">(</span><span class="ident" id="5502937">p</span>&nbsp;<span class="op" id="5502939">*</span><span class="ident" id="5502940">NRGBA64</span><span class="op" id="5502947">)</span>&nbsp;<span class="ident" id="5502949">Bounds</span><span class="op" id="5502955">(</span><span class="op" id="5502956">)</span>&nbsp;<span class="ident" id="5502958">Rectangle</span>&nbsp;<span class="op" id="5502968">{</span>&nbsp;<span class="keyword" id="5502970">return</span>&nbsp;<span class="ident" id="5502977">p</span><span class="op" id="5502978">.</span><span class="ident" id="5502979">Rect</span>&nbsp;<span class="op" id="5502984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5502987">func</span>&nbsp;<span class="op" id="5502992">(</span><span class="ident" id="5502993">p</span>&nbsp;<span class="op" id="5502995">*</span><span class="ident" id="5502996">NRGBA64</span><span class="op" id="5503003">)</span>&nbsp;<span class="ident" id="5503005">At</span><span class="op" id="5503007">(</span><span class="ident" id="5503008">x</span><span class="op" id="5503009">,</span>&nbsp;<span class="ident" id="5503011">y</span>&nbsp;<span class="builtintype" id="5503013">int</span><span class="op" id="5503016">)</span>&nbsp;<span class="ident" id="5503018">color</span><span class="op" id="5503023">.</span><span class="ident" id="5503024">Color</span>&nbsp;<span class="op" id="5503030">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503033">return</span>&nbsp;<span class="ident" id="5503040">p</span><span class="op" id="5503041">.</span><span class="ident" id="5503042">NRGBA64At</span><span class="op" id="5503051">(</span><span class="ident" id="5503052">x</span><span class="op" id="5503053">,</span>&nbsp;<span class="ident" id="5503055">y</span><span class="op" id="5503056">)</span><br>
<span class="lineno"></span><span class="op" id="5503058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5503061">func</span>&nbsp;<span class="op" id="5503066">(</span><span class="ident" id="5503067">p</span>&nbsp;<span class="op" id="5503069">*</span><span class="ident" id="5503070">NRGBA64</span><span class="op" id="5503077">)</span>&nbsp;<span class="ident" id="5503079">NRGBA64At</span><span class="op" id="5503088">(</span><span class="ident" id="5503089">x</span><span class="op" id="5503090">,</span>&nbsp;<span class="ident" id="5503092">y</span>&nbsp;<span class="builtintype" id="5503094">int</span><span class="op" id="5503097">)</span>&nbsp;<span class="ident" id="5503099">color</span><span class="op" id="5503104">.</span><span class="ident" id="5503105">NRGBA64</span>&nbsp;<span class="op" id="5503113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503116">if</span>&nbsp;<span class="op" id="5503119">!</span><span class="op" id="5503120">(</span><span class="ident" id="5503121">Point</span><span class="op" id="5503126">{</span><span class="ident" id="5503127">x</span><span class="op" id="5503128">,</span>&nbsp;<span class="ident" id="5503130">y</span><span class="op" id="5503131">}</span><span class="op" id="5503132">.</span><span class="ident" id="5503133">In</span><span class="op" id="5503135">(</span><span class="ident" id="5503136">p</span><span class="op" id="5503137">.</span><span class="ident" id="5503138">Rect</span><span class="op" id="5503142">)</span><span class="op" id="5503143">)</span>&nbsp;<span class="op" id="5503145">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503149">return</span>&nbsp;<span class="ident" id="5503156">color</span><span class="op" id="5503161">.</span><span class="ident" id="5503162">NRGBA64</span><span class="op" id="5503169">{</span><span class="op" id="5503170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503176">i</span>&nbsp;<span class="op" id="5503178">:=</span>&nbsp;<span class="ident" id="5503181">p</span><span class="op" id="5503182">.</span><span class="ident" id="5503183">PixOffset</span><span class="op" id="5503192">(</span><span class="ident" id="5503193">x</span><span class="op" id="5503194">,</span>&nbsp;<span class="ident" id="5503196">y</span><span class="op" id="5503197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503200">return</span>&nbsp;<span class="ident" id="5503207">color</span><span class="op" id="5503212">.</span><span class="ident" id="5503213">NRGBA64</span><span class="op" id="5503220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5503224">uint16</span><span class="op" id="5503230">(</span><span class="ident" id="5503231">p</span><span class="op" id="5503232">.</span><span class="ident" id="5503233">Pix</span><span class="op" id="5503236">[</span><span class="ident" id="5503237">i</span><span class="op" id="5503238">+</span><span class="num" id="5503239">0</span><span class="op" id="5503240">]</span><span class="op" id="5503241">)</span><span class="op" id="5503242">&lt;&lt;</span><span class="num" id="5503244">8</span>&nbsp;<span class="op" id="5503246">|</span>&nbsp;<span class="builtintype" id="5503248">uint16</span><span class="op" id="5503254">(</span><span class="ident" id="5503255">p</span><span class="op" id="5503256">.</span><span class="ident" id="5503257">Pix</span><span class="op" id="5503260">[</span><span class="ident" id="5503261">i</span><span class="op" id="5503262">+</span><span class="num" id="5503263">1</span><span class="op" id="5503264">]</span><span class="op" id="5503265">)</span><span class="op" id="5503266">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5503270">uint16</span><span class="op" id="5503276">(</span><span class="ident" id="5503277">p</span><span class="op" id="5503278">.</span><span class="ident" id="5503279">Pix</span><span class="op" id="5503282">[</span><span class="ident" id="5503283">i</span><span class="op" id="5503284">+</span><span class="num" id="5503285">2</span><span class="op" id="5503286">]</span><span class="op" id="5503287">)</span><span class="op" id="5503288">&lt;&lt;</span><span class="num" id="5503290">8</span>&nbsp;<span class="op" id="5503292">|</span>&nbsp;<span class="builtintype" id="5503294">uint16</span><span class="op" id="5503300">(</span><span class="ident" id="5503301">p</span><span class="op" id="5503302">.</span><span class="ident" id="5503303">Pix</span><span class="op" id="5503306">[</span><span class="ident" id="5503307">i</span><span class="op" id="5503308">+</span><span class="num" id="5503309">3</span><span class="op" id="5503310">]</span><span class="op" id="5503311">)</span><span class="op" id="5503312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5503316">uint16</span><span class="op" id="5503322">(</span><span class="ident" id="5503323">p</span><span class="op" id="5503324">.</span><span class="ident" id="5503325">Pix</span><span class="op" id="5503328">[</span><span class="ident" id="5503329">i</span><span class="op" id="5503330">+</span><span class="num" id="5503331">4</span><span class="op" id="5503332">]</span><span class="op" id="5503333">)</span><span class="op" id="5503334">&lt;&lt;</span><span class="num" id="5503336">8</span>&nbsp;<span class="op" id="5503338">|</span>&nbsp;<span class="builtintype" id="5503340">uint16</span><span class="op" id="5503346">(</span><span class="ident" id="5503347">p</span><span class="op" id="5503348">.</span><span class="ident" id="5503349">Pix</span><span class="op" id="5503352">[</span><span class="ident" id="5503353">i</span><span class="op" id="5503354">+</span><span class="num" id="5503355">5</span><span class="op" id="5503356">]</span><span class="op" id="5503357">)</span><span class="op" id="5503358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5503362">uint16</span><span class="op" id="5503368">(</span><span class="ident" id="5503369">p</span><span class="op" id="5503370">.</span><span class="ident" id="5503371">Pix</span><span class="op" id="5503374">[</span><span class="ident" id="5503375">i</span><span class="op" id="5503376">+</span><span class="num" id="5503377">6</span><span class="op" id="5503378">]</span><span class="op" id="5503379">)</span><span class="op" id="5503380">&lt;&lt;</span><span class="num" id="5503382">8</span>&nbsp;<span class="op" id="5503384">|</span>&nbsp;<span class="builtintype" id="5503386">uint16</span><span class="op" id="5503392">(</span><span class="ident" id="5503393">p</span><span class="op" id="5503394">.</span><span class="ident" id="5503395">Pix</span><span class="op" id="5503398">[</span><span class="ident" id="5503399">i</span><span class="op" id="5503400">+</span><span class="num" id="5503401">7</span><span class="op" id="5503402">]</span><span class="op" id="5503403">)</span><span class="op" id="5503404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503407">}</span><br>
<span class="lineno"></span><span class="op" id="5503409">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5503412">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5503491">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5503515">func</span>&nbsp;<span class="op" id="5503520">(</span><span class="ident" id="5503521">p</span>&nbsp;<span class="op" id="5503523">*</span><span class="ident" id="5503524">NRGBA64</span><span class="op" id="5503531">)</span>&nbsp;<span class="ident" id="5503533">PixOffset</span><span class="op" id="5503542">(</span><span class="ident" id="5503543">x</span><span class="op" id="5503544">,</span>&nbsp;<span class="ident" id="5503546">y</span>&nbsp;<span class="builtintype" id="5503548">int</span><span class="op" id="5503551">)</span>&nbsp;<span class="builtintype" id="5503553">int</span>&nbsp;<span class="op" id="5503557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503560">return</span>&nbsp;<span class="op" id="5503567">(</span><span class="ident" id="5503568">y</span><span class="op" id="5503569">-</span><span class="ident" id="5503570">p</span><span class="op" id="5503571">.</span><span class="ident" id="5503572">Rect</span><span class="op" id="5503576">.</span><span class="ident" id="5503577">Min</span><span class="op" id="5503580">.</span><span class="ident" id="5503581">Y</span><span class="op" id="5503582">)</span><span class="op" id="5503583">*</span><span class="ident" id="5503584">p</span><span class="op" id="5503585">.</span><span class="ident" id="5503586">Stride</span>&nbsp;<span class="op" id="5503593">+</span>&nbsp;<span class="op" id="5503595">(</span><span class="ident" id="5503596">x</span><span class="op" id="5503597">-</span><span class="ident" id="5503598">p</span><span class="op" id="5503599">.</span><span class="ident" id="5503600">Rect</span><span class="op" id="5503604">.</span><span class="ident" id="5503605">Min</span><span class="op" id="5503608">.</span><span class="ident" id="5503609">X</span><span class="op" id="5503610">)</span><span class="op" id="5503611">*</span><span class="num" id="5503612">8</span><br>
<span class="lineno">405</span><span class="op" id="5503614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5503617">func</span>&nbsp;<span class="op" id="5503622">(</span><span class="ident" id="5503623">p</span>&nbsp;<span class="op" id="5503625">*</span><span class="ident" id="5503626">NRGBA64</span><span class="op" id="5503633">)</span>&nbsp;<span class="ident" id="5503635">Set</span><span class="op" id="5503638">(</span><span class="ident" id="5503639">x</span><span class="op" id="5503640">,</span>&nbsp;<span class="ident" id="5503642">y</span>&nbsp;<span class="builtintype" id="5503644">int</span><span class="op" id="5503647">,</span>&nbsp;<span class="ident" id="5503649">c</span>&nbsp;<span class="ident" id="5503651">color</span><span class="op" id="5503656">.</span><span class="ident" id="5503657">Color</span><span class="op" id="5503662">)</span>&nbsp;<span class="op" id="5503664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503667">if</span>&nbsp;<span class="op" id="5503670">!</span><span class="op" id="5503671">(</span><span class="ident" id="5503672">Point</span><span class="op" id="5503677">{</span><span class="ident" id="5503678">x</span><span class="op" id="5503679">,</span>&nbsp;<span class="ident" id="5503681">y</span><span class="op" id="5503682">}</span><span class="op" id="5503683">.</span><span class="ident" id="5503684">In</span><span class="op" id="5503686">(</span><span class="ident" id="5503687">p</span><span class="op" id="5503688">.</span><span class="ident" id="5503689">Rect</span><span class="op" id="5503693">)</span><span class="op" id="5503694">)</span>&nbsp;<span class="op" id="5503696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503700">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503711">i</span>&nbsp;<span class="op" id="5503713">:=</span>&nbsp;<span class="ident" id="5503716">p</span><span class="op" id="5503717">.</span><span class="ident" id="5503718">PixOffset</span><span class="op" id="5503727">(</span><span class="ident" id="5503728">x</span><span class="op" id="5503729">,</span>&nbsp;<span class="ident" id="5503731">y</span><span class="op" id="5503732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503735">c1</span>&nbsp;<span class="op" id="5503738">:=</span>&nbsp;<span class="ident" id="5503741">color</span><span class="op" id="5503746">.</span><span class="ident" id="5503747">NRGBA64Model</span><span class="op" id="5503759">.</span><span class="ident" id="5503760">Convert</span><span class="op" id="5503767">(</span><span class="ident" id="5503768">c</span><span class="op" id="5503769">)</span><span class="op" id="5503770">.</span><span class="op" id="5503771">(</span><span class="ident" id="5503772">color</span><span class="op" id="5503777">.</span><span class="ident" id="5503778">NRGBA64</span><span class="op" id="5503785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503788">p</span><span class="op" id="5503789">.</span><span class="ident" id="5503790">Pix</span><span class="op" id="5503793">[</span><span class="ident" id="5503794">i</span><span class="op" id="5503795">+</span><span class="num" id="5503796">0</span><span class="op" id="5503797">]</span>&nbsp;<span class="op" id="5503799">=</span>&nbsp;<span class="builtintype" id="5503801">uint8</span><span class="op" id="5503806">(</span><span class="ident" id="5503807">c1</span><span class="op" id="5503809">.</span><span class="ident" id="5503810">R</span>&nbsp;<span class="op" id="5503812">&gt;&gt;</span>&nbsp;<span class="num" id="5503815">8</span><span class="op" id="5503816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503819">p</span><span class="op" id="5503820">.</span><span class="ident" id="5503821">Pix</span><span class="op" id="5503824">[</span><span class="ident" id="5503825">i</span><span class="op" id="5503826">+</span><span class="num" id="5503827">1</span><span class="op" id="5503828">]</span>&nbsp;<span class="op" id="5503830">=</span>&nbsp;<span class="builtintype" id="5503832">uint8</span><span class="op" id="5503837">(</span><span class="ident" id="5503838">c1</span><span class="op" id="5503840">.</span><span class="ident" id="5503841">R</span><span class="op" id="5503842">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503845">p</span><span class="op" id="5503846">.</span><span class="ident" id="5503847">Pix</span><span class="op" id="5503850">[</span><span class="ident" id="5503851">i</span><span class="op" id="5503852">+</span><span class="num" id="5503853">2</span><span class="op" id="5503854">]</span>&nbsp;<span class="op" id="5503856">=</span>&nbsp;<span class="builtintype" id="5503858">uint8</span><span class="op" id="5503863">(</span><span class="ident" id="5503864">c1</span><span class="op" id="5503866">.</span><span class="ident" id="5503867">G</span>&nbsp;<span class="op" id="5503869">&gt;&gt;</span>&nbsp;<span class="num" id="5503872">8</span><span class="op" id="5503873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503876">p</span><span class="op" id="5503877">.</span><span class="ident" id="5503878">Pix</span><span class="op" id="5503881">[</span><span class="ident" id="5503882">i</span><span class="op" id="5503883">+</span><span class="num" id="5503884">3</span><span class="op" id="5503885">]</span>&nbsp;<span class="op" id="5503887">=</span>&nbsp;<span class="builtintype" id="5503889">uint8</span><span class="op" id="5503894">(</span><span class="ident" id="5503895">c1</span><span class="op" id="5503897">.</span><span class="ident" id="5503898">G</span><span class="op" id="5503899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503902">p</span><span class="op" id="5503903">.</span><span class="ident" id="5503904">Pix</span><span class="op" id="5503907">[</span><span class="ident" id="5503908">i</span><span class="op" id="5503909">+</span><span class="num" id="5503910">4</span><span class="op" id="5503911">]</span>&nbsp;<span class="op" id="5503913">=</span>&nbsp;<span class="builtintype" id="5503915">uint8</span><span class="op" id="5503920">(</span><span class="ident" id="5503921">c1</span><span class="op" id="5503923">.</span><span class="ident" id="5503924">B</span>&nbsp;<span class="op" id="5503926">&gt;&gt;</span>&nbsp;<span class="num" id="5503929">8</span><span class="op" id="5503930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503933">p</span><span class="op" id="5503934">.</span><span class="ident" id="5503935">Pix</span><span class="op" id="5503938">[</span><span class="ident" id="5503939">i</span><span class="op" id="5503940">+</span><span class="num" id="5503941">5</span><span class="op" id="5503942">]</span>&nbsp;<span class="op" id="5503944">=</span>&nbsp;<span class="builtintype" id="5503946">uint8</span><span class="op" id="5503951">(</span><span class="ident" id="5503952">c1</span><span class="op" id="5503954">.</span><span class="ident" id="5503955">B</span><span class="op" id="5503956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503959">p</span><span class="op" id="5503960">.</span><span class="ident" id="5503961">Pix</span><span class="op" id="5503964">[</span><span class="ident" id="5503965">i</span><span class="op" id="5503966">+</span><span class="num" id="5503967">6</span><span class="op" id="5503968">]</span>&nbsp;<span class="op" id="5503970">=</span>&nbsp;<span class="builtintype" id="5503972">uint8</span><span class="op" id="5503977">(</span><span class="ident" id="5503978">c1</span><span class="op" id="5503980">.</span><span class="ident" id="5503981">A</span>&nbsp;<span class="op" id="5503983">&gt;&gt;</span>&nbsp;<span class="num" id="5503986">8</span><span class="op" id="5503987">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503990">p</span><span class="op" id="5503991">.</span><span class="ident" id="5503992">Pix</span><span class="op" id="5503995">[</span><span class="ident" id="5503996">i</span><span class="op" id="5503997">+</span><span class="num" id="5503998">7</span><span class="op" id="5503999">]</span>&nbsp;<span class="op" id="5504001">=</span>&nbsp;<span class="builtintype" id="5504003">uint8</span><span class="op" id="5504008">(</span><span class="ident" id="5504009">c1</span><span class="op" id="5504011">.</span><span class="ident" id="5504012">A</span><span class="op" id="5504013">)</span><br>
<span class="lineno"></span><span class="op" id="5504015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5504018">func</span>&nbsp;<span class="op" id="5504023">(</span><span class="ident" id="5504024">p</span>&nbsp;<span class="op" id="5504026">*</span><span class="ident" id="5504027">NRGBA64</span><span class="op" id="5504034">)</span>&nbsp;<span class="ident" id="5504036">SetNRGBA64</span><span class="op" id="5504046">(</span><span class="ident" id="5504047">x</span><span class="op" id="5504048">,</span>&nbsp;<span class="ident" id="5504050">y</span>&nbsp;<span class="builtintype" id="5504052">int</span><span class="op" id="5504055">,</span>&nbsp;<span class="ident" id="5504057">c</span>&nbsp;<span class="ident" id="5504059">color</span><span class="op" id="5504064">.</span><span class="ident" id="5504065">NRGBA64</span><span class="op" id="5504072">)</span>&nbsp;<span class="op" id="5504074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504077">if</span>&nbsp;<span class="op" id="5504080">!</span><span class="op" id="5504081">(</span><span class="ident" id="5504082">Point</span><span class="op" id="5504087">{</span><span class="ident" id="5504088">x</span><span class="op" id="5504089">,</span>&nbsp;<span class="ident" id="5504091">y</span><span class="op" id="5504092">}</span><span class="op" id="5504093">.</span><span class="ident" id="5504094">In</span><span class="op" id="5504096">(</span><span class="ident" id="5504097">p</span><span class="op" id="5504098">.</span><span class="ident" id="5504099">Rect</span><span class="op" id="5504103">)</span><span class="op" id="5504104">)</span>&nbsp;<span class="op" id="5504106">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504110">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5504118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504121">i</span>&nbsp;<span class="op" id="5504123">:=</span>&nbsp;<span class="ident" id="5504126">p</span><span class="op" id="5504127">.</span><span class="ident" id="5504128">PixOffset</span><span class="op" id="5504137">(</span><span class="ident" id="5504138">x</span><span class="op" id="5504139">,</span>&nbsp;<span class="ident" id="5504141">y</span><span class="op" id="5504142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504145">p</span><span class="op" id="5504146">.</span><span class="ident" id="5504147">Pix</span><span class="op" id="5504150">[</span><span class="ident" id="5504151">i</span><span class="op" id="5504152">+</span><span class="num" id="5504153">0</span><span class="op" id="5504154">]</span>&nbsp;<span class="op" id="5504156">=</span>&nbsp;<span class="builtintype" id="5504158">uint8</span><span class="op" id="5504163">(</span><span class="ident" id="5504164">c</span><span class="op" id="5504165">.</span><span class="ident" id="5504166">R</span>&nbsp;<span class="op" id="5504168">&gt;&gt;</span>&nbsp;<span class="num" id="5504171">8</span><span class="op" id="5504172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504175">p</span><span class="op" id="5504176">.</span><span class="ident" id="5504177">Pix</span><span class="op" id="5504180">[</span><span class="ident" id="5504181">i</span><span class="op" id="5504182">+</span><span class="num" id="5504183">1</span><span class="op" id="5504184">]</span>&nbsp;<span class="op" id="5504186">=</span>&nbsp;<span class="builtintype" id="5504188">uint8</span><span class="op" id="5504193">(</span><span class="ident" id="5504194">c</span><span class="op" id="5504195">.</span><span class="ident" id="5504196">R</span><span class="op" id="5504197">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504200">p</span><span class="op" id="5504201">.</span><span class="ident" id="5504202">Pix</span><span class="op" id="5504205">[</span><span class="ident" id="5504206">i</span><span class="op" id="5504207">+</span><span class="num" id="5504208">2</span><span class="op" id="5504209">]</span>&nbsp;<span class="op" id="5504211">=</span>&nbsp;<span class="builtintype" id="5504213">uint8</span><span class="op" id="5504218">(</span><span class="ident" id="5504219">c</span><span class="op" id="5504220">.</span><span class="ident" id="5504221">G</span>&nbsp;<span class="op" id="5504223">&gt;&gt;</span>&nbsp;<span class="num" id="5504226">8</span><span class="op" id="5504227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504230">p</span><span class="op" id="5504231">.</span><span class="ident" id="5504232">Pix</span><span class="op" id="5504235">[</span><span class="ident" id="5504236">i</span><span class="op" id="5504237">+</span><span class="num" id="5504238">3</span><span class="op" id="5504239">]</span>&nbsp;<span class="op" id="5504241">=</span>&nbsp;<span class="builtintype" id="5504243">uint8</span><span class="op" id="5504248">(</span><span class="ident" id="5504249">c</span><span class="op" id="5504250">.</span><span class="ident" id="5504251">G</span><span class="op" id="5504252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504255">p</span><span class="op" id="5504256">.</span><span class="ident" id="5504257">Pix</span><span class="op" id="5504260">[</span><span class="ident" id="5504261">i</span><span class="op" id="5504262">+</span><span class="num" id="5504263">4</span><span class="op" id="5504264">]</span>&nbsp;<span class="op" id="5504266">=</span>&nbsp;<span class="builtintype" id="5504268">uint8</span><span class="op" id="5504273">(</span><span class="ident" id="5504274">c</span><span class="op" id="5504275">.</span><span class="ident" id="5504276">B</span>&nbsp;<span class="op" id="5504278">&gt;&gt;</span>&nbsp;<span class="num" id="5504281">8</span><span class="op" id="5504282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504285">p</span><span class="op" id="5504286">.</span><span class="ident" id="5504287">Pix</span><span class="op" id="5504290">[</span><span class="ident" id="5504291">i</span><span class="op" id="5504292">+</span><span class="num" id="5504293">5</span><span class="op" id="5504294">]</span>&nbsp;<span class="op" id="5504296">=</span>&nbsp;<span class="builtintype" id="5504298">uint8</span><span class="op" id="5504303">(</span><span class="ident" id="5504304">c</span><span class="op" id="5504305">.</span><span class="ident" id="5504306">B</span><span class="op" id="5504307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504310">p</span><span class="op" id="5504311">.</span><span class="ident" id="5504312">Pix</span><span class="op" id="5504315">[</span><span class="ident" id="5504316">i</span><span class="op" id="5504317">+</span><span class="num" id="5504318">6</span><span class="op" id="5504319">]</span>&nbsp;<span class="op" id="5504321">=</span>&nbsp;<span class="builtintype" id="5504323">uint8</span><span class="op" id="5504328">(</span><span class="ident" id="5504329">c</span><span class="op" id="5504330">.</span><span class="ident" id="5504331">A</span>&nbsp;<span class="op" id="5504333">&gt;&gt;</span>&nbsp;<span class="num" id="5504336">8</span><span class="op" id="5504337">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504340">p</span><span class="op" id="5504341">.</span><span class="ident" id="5504342">Pix</span><span class="op" id="5504345">[</span><span class="ident" id="5504346">i</span><span class="op" id="5504347">+</span><span class="num" id="5504348">7</span><span class="op" id="5504349">]</span>&nbsp;<span class="op" id="5504351">=</span>&nbsp;<span class="builtintype" id="5504353">uint8</span><span class="op" id="5504358">(</span><span class="ident" id="5504359">c</span><span class="op" id="5504360">.</span><span class="ident" id="5504361">A</span><span class="op" id="5504362">)</span><br>
<span class="lineno"></span><span class="op" id="5504364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5504367">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5504444">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5504516">func</span>&nbsp;<span class="op" id="5504521">(</span><span class="ident" id="5504522">p</span>&nbsp;<span class="op" id="5504524">*</span><span class="ident" id="5504525">NRGBA64</span><span class="op" id="5504532">)</span>&nbsp;<span class="ident" id="5504534">SubImage</span><span class="op" id="5504542">(</span><span class="ident" id="5504543">r</span>&nbsp;<span class="ident" id="5504545">Rectangle</span><span class="op" id="5504554">)</span>&nbsp;<span class="ident" id="5504556">Image</span>&nbsp;<span class="op" id="5504562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504565">r</span>&nbsp;<span class="op" id="5504567">=</span>&nbsp;<span class="ident" id="5504569">r</span><span class="op" id="5504570">.</span><span class="ident" id="5504571">Intersect</span><span class="op" id="5504580">(</span><span class="ident" id="5504581">p</span><span class="op" id="5504582">.</span><span class="ident" id="5504583">Rect</span><span class="op" id="5504587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504590">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504671">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504753">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504803">if</span>&nbsp;<span class="ident" id="5504806">r</span><span class="op" id="5504807">.</span><span class="ident" id="5504808">Empty</span><span class="op" id="5504813">(</span><span class="op" id="5504814">)</span>&nbsp;<span class="op" id="5504816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504820">return</span>&nbsp;<span class="op" id="5504827">&amp;</span><span class="ident" id="5504828">NRGBA64</span><span class="op" id="5504835">{</span><span class="op" id="5504836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5504839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504842">i</span>&nbsp;<span class="op" id="5504844">:=</span>&nbsp;<span class="ident" id="5504847">p</span><span class="op" id="5504848">.</span><span class="ident" id="5504849">PixOffset</span><span class="op" id="5504858">(</span><span class="ident" id="5504859">r</span><span class="op" id="5504860">.</span><span class="ident" id="5504861">Min</span><span class="op" id="5504864">.</span><span class="ident" id="5504865">X</span><span class="op" id="5504866">,</span>&nbsp;<span class="ident" id="5504868">r</span><span class="op" id="5504869">.</span><span class="ident" id="5504870">Min</span><span class="op" id="5504873">.</span><span class="ident" id="5504874">Y</span><span class="op" id="5504875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504878">return</span>&nbsp;<span class="op" id="5504885">&amp;</span><span class="ident" id="5504886">NRGBA64</span><span class="op" id="5504893">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504897">Pix</span><span class="op" id="5504900">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504905">p</span><span class="op" id="5504906">.</span><span class="ident" id="5504907">Pix</span><span class="op" id="5504910">[</span><span class="ident" id="5504911">i</span><span class="op" id="5504912">:</span><span class="op" id="5504913">]</span><span class="op" id="5504914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504918">Stride</span><span class="op" id="5504924">:</span>&nbsp;<span class="ident" id="5504926">p</span><span class="op" id="5504927">.</span><span class="ident" id="5504928">Stride</span><span class="op" id="5504934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504938">Rect</span><span class="op" id="5504942">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5504946">r</span><span class="op" id="5504947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5504950">}</span><br>
<span class="lineno"></span><span class="op" id="5504952">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5504955">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5505028">func</span>&nbsp;<span class="op" id="5505033">(</span><span class="ident" id="5505034">p</span>&nbsp;<span class="op" id="5505036">*</span><span class="ident" id="5505037">NRGBA64</span><span class="op" id="5505044">)</span>&nbsp;<span class="ident" id="5505046">Opaque</span><span class="op" id="5505052">(</span><span class="op" id="5505053">)</span>&nbsp;<span class="builtintype" id="5505055">bool</span>&nbsp;<span class="op" id="5505060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505063">if</span>&nbsp;<span class="ident" id="5505066">p</span><span class="op" id="5505067">.</span><span class="ident" id="5505068">Rect</span><span class="op" id="5505072">.</span><span class="ident" id="5505073">Empty</span><span class="op" id="5505078">(</span><span class="op" id="5505079">)</span>&nbsp;<span class="op" id="5505081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505085">return</span>&nbsp;<span class="builtintype" id="5505092">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5505098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505101">i0</span><span class="op" id="5505103">,</span>&nbsp;<span class="ident" id="5505105">i1</span>&nbsp;<span class="op" id="5505108">:=</span>&nbsp;<span class="num" id="5505111">6</span><span class="op" id="5505112">,</span>&nbsp;<span class="ident" id="5505114">p</span><span class="op" id="5505115">.</span><span class="ident" id="5505116">Rect</span><span class="op" id="5505120">.</span><span class="ident" id="5505121">Dx</span><span class="op" id="5505123">(</span><span class="op" id="5505124">)</span><span class="op" id="5505125">*</span><span class="num" id="5505126">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505129">for</span>&nbsp;<span class="ident" id="5505133">y</span>&nbsp;<span class="op" id="5505135">:=</span>&nbsp;<span class="ident" id="5505138">p</span><span class="op" id="5505139">.</span><span class="ident" id="5505140">Rect</span><span class="op" id="5505144">.</span><span class="ident" id="5505145">Min</span><span class="op" id="5505148">.</span><span class="ident" id="5505149">Y</span><span class="op" id="5505150">;</span>&nbsp;<span class="ident" id="5505152">y</span>&nbsp;<span class="op" id="5505154">&lt;</span>&nbsp;<span class="ident" id="5505156">p</span><span class="op" id="5505157">.</span><span class="ident" id="5505158">Rect</span><span class="op" id="5505162">.</span><span class="ident" id="5505163">Max</span><span class="op" id="5505166">.</span><span class="ident" id="5505167">Y</span><span class="op" id="5505168">;</span>&nbsp;<span class="ident" id="5505170">y</span><span class="op" id="5505171">++</span>&nbsp;<span class="op" id="5505174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505178">for</span>&nbsp;<span class="ident" id="5505182">i</span>&nbsp;<span class="op" id="5505184">:=</span>&nbsp;<span class="ident" id="5505187">i0</span><span class="op" id="5505189">;</span>&nbsp;<span class="ident" id="5505191">i</span>&nbsp;<span class="op" id="5505193">&lt;</span>&nbsp;<span class="ident" id="5505195">i1</span><span class="op" id="5505197">;</span>&nbsp;<span class="ident" id="5505199">i</span>&nbsp;<span class="op" id="5505201">+=</span>&nbsp;<span class="num" id="5505204">8</span>&nbsp;<span class="op" id="5505206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505211">if</span>&nbsp;<span class="ident" id="5505214">p</span><span class="op" id="5505215">.</span><span class="ident" id="5505216">Pix</span><span class="op" id="5505219">[</span><span class="ident" id="5505220">i</span><span class="op" id="5505221">+</span><span class="num" id="5505222">0</span><span class="op" id="5505223">]</span>&nbsp;<span class="op" id="5505225">!=</span>&nbsp;<span class="num" id="5505228">0xff</span>&nbsp;<span class="op" id="5505233">||</span>&nbsp;<span class="ident" id="5505236">p</span><span class="op" id="5505237">.</span><span class="ident" id="5505238">Pix</span><span class="op" id="5505241">[</span><span class="ident" id="5505242">i</span><span class="op" id="5505243">+</span><span class="num" id="5505244">1</span><span class="op" id="5505245">]</span>&nbsp;<span class="op" id="5505247">!=</span>&nbsp;<span class="num" id="5505250">0xff</span>&nbsp;<span class="op" id="5505255">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505261">return</span>&nbsp;<span class="builtintype" id="5505268">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5505277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5505281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505285">i0</span>&nbsp;<span class="op" id="5505288">+=</span>&nbsp;<span class="ident" id="5505291">p</span><span class="op" id="5505292">.</span><span class="ident" id="5505293">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505302">i1</span>&nbsp;<span class="op" id="5505305">+=</span>&nbsp;<span class="ident" id="5505308">p</span><span class="op" id="5505309">.</span><span class="ident" id="5505310">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5505318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505321">return</span>&nbsp;<span class="builtintype" id="5505328">true</span><br>
<span class="lineno"></span><span class="op" id="5505333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5505336">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5505395">func</span>&nbsp;<span class="ident" id="5505400">NewNRGBA64</span><span class="op" id="5505410">(</span><span class="ident" id="5505411">r</span>&nbsp;<span class="ident" id="5505413">Rectangle</span><span class="op" id="5505422">)</span>&nbsp;<span class="op" id="5505424">*</span><span class="ident" id="5505425">NRGBA64</span>&nbsp;<span class="op" id="5505433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505436">w</span><span class="op" id="5505437">,</span>&nbsp;<span class="ident" id="5505439">h</span>&nbsp;<span class="op" id="5505441">:=</span>&nbsp;<span class="ident" id="5505444">r</span><span class="op" id="5505445">.</span><span class="ident" id="5505446">Dx</span><span class="op" id="5505448">(</span><span class="op" id="5505449">)</span><span class="op" id="5505450">,</span>&nbsp;<span class="ident" id="5505452">r</span><span class="op" id="5505453">.</span><span class="ident" id="5505454">Dy</span><span class="op" id="5505456">(</span><span class="op" id="5505457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505460">pix</span>&nbsp;<span class="op" id="5505464">:=</span>&nbsp;<span class="builtinfunc" id="5505467">make</span><span class="op" id="5505471">(</span><span class="op" id="5505472">[</span><span class="op" id="5505473">]</span><span class="builtintype" id="5505474">uint8</span><span class="op" id="5505479">,</span>&nbsp;<span class="num" id="5505481">8</span><span class="op" id="5505482">*</span><span class="ident" id="5505483">w</span><span class="op" id="5505484">*</span><span class="ident" id="5505485">h</span><span class="op" id="5505486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505489">return</span>&nbsp;<span class="op" id="5505496">&amp;</span><span class="ident" id="5505497">NRGBA64</span><span class="op" id="5505504">{</span><span class="ident" id="5505505">pix</span><span class="op" id="5505508">,</span>&nbsp;<span class="num" id="5505510">8</span>&nbsp;<span class="op" id="5505512">*</span>&nbsp;<span class="ident" id="5505514">w</span><span class="op" id="5505515">,</span>&nbsp;<span class="ident" id="5505517">r</span><span class="op" id="5505518">}</span><br>
<span class="lineno"></span><span class="op" id="5505520">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5505523">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5505598">type</span>&nbsp;<span class="ident" id="5505603">Alpha</span>&nbsp;<span class="keyword" id="5505609">struct</span>&nbsp;<span class="op" id="5505616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505619">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505683">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505751">Pix</span>&nbsp;<span class="op" id="5505755">[</span><span class="op" id="5505756">]</span><span class="builtintype" id="5505757">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505764">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505840">Stride</span>&nbsp;<span class="builtintype" id="5505847">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505852">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5505884">Rect</span>&nbsp;<span class="ident" id="5505889">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5505899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5505902">func</span>&nbsp;<span class="op" id="5505907">(</span><span class="ident" id="5505908">p</span>&nbsp;<span class="op" id="5505910">*</span><span class="ident" id="5505911">Alpha</span><span class="op" id="5505916">)</span>&nbsp;<span class="ident" id="5505918">ColorModel</span><span class="op" id="5505928">(</span><span class="op" id="5505929">)</span>&nbsp;<span class="ident" id="5505931">color</span><span class="op" id="5505936">.</span><span class="ident" id="5505937">Model</span>&nbsp;<span class="op" id="5505943">{</span>&nbsp;<span class="keyword" id="5505945">return</span>&nbsp;<span class="ident" id="5505952">color</span><span class="op" id="5505957">.</span><span class="ident" id="5505958">AlphaModel</span>&nbsp;<span class="op" id="5505969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5505972">func</span>&nbsp;<span class="op" id="5505977">(</span><span class="ident" id="5505978">p</span>&nbsp;<span class="op" id="5505980">*</span><span class="ident" id="5505981">Alpha</span><span class="op" id="5505986">)</span>&nbsp;<span class="ident" id="5505988">Bounds</span><span class="op" id="5505994">(</span><span class="op" id="5505995">)</span>&nbsp;<span class="ident" id="5505997">Rectangle</span>&nbsp;<span class="op" id="5506007">{</span>&nbsp;<span class="keyword" id="5506009">return</span>&nbsp;<span class="ident" id="5506016">p</span><span class="op" id="5506017">.</span><span class="ident" id="5506018">Rect</span>&nbsp;<span class="op" id="5506023">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5506026">func</span>&nbsp;<span class="op" id="5506031">(</span><span class="ident" id="5506032">p</span>&nbsp;<span class="op" id="5506034">*</span><span class="ident" id="5506035">Alpha</span><span class="op" id="5506040">)</span>&nbsp;<span class="ident" id="5506042">At</span><span class="op" id="5506044">(</span><span class="ident" id="5506045">x</span><span class="op" id="5506046">,</span>&nbsp;<span class="ident" id="5506048">y</span>&nbsp;<span class="builtintype" id="5506050">int</span><span class="op" id="5506053">)</span>&nbsp;<span class="ident" id="5506055">color</span><span class="op" id="5506060">.</span><span class="ident" id="5506061">Color</span>&nbsp;<span class="op" id="5506067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506070">return</span>&nbsp;<span class="ident" id="5506077">p</span><span class="op" id="5506078">.</span><span class="ident" id="5506079">AlphaAt</span><span class="op" id="5506086">(</span><span class="ident" id="5506087">x</span><span class="op" id="5506088">,</span>&nbsp;<span class="ident" id="5506090">y</span><span class="op" id="5506091">)</span><br>
<span class="lineno"></span><span class="op" id="5506093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5506096">func</span>&nbsp;<span class="op" id="5506101">(</span><span class="ident" id="5506102">p</span>&nbsp;<span class="op" id="5506104">*</span><span class="ident" id="5506105">Alpha</span><span class="op" id="5506110">)</span>&nbsp;<span class="ident" id="5506112">AlphaAt</span><span class="op" id="5506119">(</span><span class="ident" id="5506120">x</span><span class="op" id="5506121">,</span>&nbsp;<span class="ident" id="5506123">y</span>&nbsp;<span class="builtintype" id="5506125">int</span><span class="op" id="5506128">)</span>&nbsp;<span class="ident" id="5506130">color</span><span class="op" id="5506135">.</span><span class="ident" id="5506136">Alpha</span>&nbsp;<span class="op" id="5506142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506145">if</span>&nbsp;<span class="op" id="5506148">!</span><span class="op" id="5506149">(</span><span class="ident" id="5506150">Point</span><span class="op" id="5506155">{</span><span class="ident" id="5506156">x</span><span class="op" id="5506157">,</span>&nbsp;<span class="ident" id="5506159">y</span><span class="op" id="5506160">}</span><span class="op" id="5506161">.</span><span class="ident" id="5506162">In</span><span class="op" id="5506164">(</span><span class="ident" id="5506165">p</span><span class="op" id="5506166">.</span><span class="ident" id="5506167">Rect</span><span class="op" id="5506171">)</span><span class="op" id="5506172">)</span>&nbsp;<span class="op" id="5506174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506178">return</span>&nbsp;<span class="ident" id="5506185">color</span><span class="op" id="5506190">.</span><span class="ident" id="5506191">Alpha</span><span class="op" id="5506196">{</span><span class="op" id="5506197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5506200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506203">i</span>&nbsp;<span class="op" id="5506205">:=</span>&nbsp;<span class="ident" id="5506208">p</span><span class="op" id="5506209">.</span><span class="ident" id="5506210">PixOffset</span><span class="op" id="5506219">(</span><span class="ident" id="5506220">x</span><span class="op" id="5506221">,</span>&nbsp;<span class="ident" id="5506223">y</span><span class="op" id="5506224">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506227">return</span>&nbsp;<span class="ident" id="5506234">color</span><span class="op" id="5506239">.</span><span class="ident" id="5506240">Alpha</span><span class="op" id="5506245">{</span><span class="ident" id="5506246">p</span><span class="op" id="5506247">.</span><span class="ident" id="5506248">Pix</span><span class="op" id="5506251">[</span><span class="ident" id="5506252">i</span><span class="op" id="5506253">]</span><span class="op" id="5506254">}</span><br>
<span class="lineno"></span><span class="op" id="5506256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5506259">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5506338">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5506362">func</span>&nbsp;<span class="op" id="5506367">(</span><span class="ident" id="5506368">p</span>&nbsp;<span class="op" id="5506370">*</span><span class="ident" id="5506371">Alpha</span><span class="op" id="5506376">)</span>&nbsp;<span class="ident" id="5506378">PixOffset</span><span class="op" id="5506387">(</span><span class="ident" id="5506388">x</span><span class="op" id="5506389">,</span>&nbsp;<span class="ident" id="5506391">y</span>&nbsp;<span class="builtintype" id="5506393">int</span><span class="op" id="5506396">)</span>&nbsp;<span class="builtintype" id="5506398">int</span>&nbsp;<span class="op" id="5506402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506405">return</span>&nbsp;<span class="op" id="5506412">(</span><span class="ident" id="5506413">y</span><span class="op" id="5506414">-</span><span class="ident" id="5506415">p</span><span class="op" id="5506416">.</span><span class="ident" id="5506417">Rect</span><span class="op" id="5506421">.</span><span class="ident" id="5506422">Min</span><span class="op" id="5506425">.</span><span class="ident" id="5506426">Y</span><span class="op" id="5506427">)</span><span class="op" id="5506428">*</span><span class="ident" id="5506429">p</span><span class="op" id="5506430">.</span><span class="ident" id="5506431">Stride</span>&nbsp;<span class="op" id="5506438">+</span>&nbsp;<span class="op" id="5506440">(</span><span class="ident" id="5506441">x</span><span class="op" id="5506442">-</span><span class="ident" id="5506443">p</span><span class="op" id="5506444">.</span><span class="ident" id="5506445">Rect</span><span class="op" id="5506449">.</span><span class="ident" id="5506450">Min</span><span class="op" id="5506453">.</span><span class="ident" id="5506454">X</span><span class="op" id="5506455">)</span><span class="op" id="5506456">*</span><span class="num" id="5506457">1</span><br>
<span class="lineno"></span><span class="op" id="5506459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5506462">func</span>&nbsp;<span class="op" id="5506467">(</span><span class="ident" id="5506468">p</span>&nbsp;<span class="op" id="5506470">*</span><span class="ident" id="5506471">Alpha</span><span class="op" id="5506476">)</span>&nbsp;<span class="ident" id="5506478">Set</span><span class="op" id="5506481">(</span><span class="ident" id="5506482">x</span><span class="op" id="5506483">,</span>&nbsp;<span class="ident" id="5506485">y</span>&nbsp;<span class="builtintype" id="5506487">int</span><span class="op" id="5506490">,</span>&nbsp;<span class="ident" id="5506492">c</span>&nbsp;<span class="ident" id="5506494">color</span><span class="op" id="5506499">.</span><span class="ident" id="5506500">Color</span><span class="op" id="5506505">)</span>&nbsp;<span class="op" id="5506507">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506510">if</span>&nbsp;<span class="op" id="5506513">!</span><span class="op" id="5506514">(</span><span class="ident" id="5506515">Point</span><span class="op" id="5506520">{</span><span class="ident" id="5506521">x</span><span class="op" id="5506522">,</span>&nbsp;<span class="ident" id="5506524">y</span><span class="op" id="5506525">}</span><span class="op" id="5506526">.</span><span class="ident" id="5506527">In</span><span class="op" id="5506529">(</span><span class="ident" id="5506530">p</span><span class="op" id="5506531">.</span><span class="ident" id="5506532">Rect</span><span class="op" id="5506536">)</span><span class="op" id="5506537">)</span>&nbsp;<span class="op" id="5506539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506543">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5506551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506554">i</span>&nbsp;<span class="op" id="5506556">:=</span>&nbsp;<span class="ident" id="5506559">p</span><span class="op" id="5506560">.</span><span class="ident" id="5506561">PixOffset</span><span class="op" id="5506570">(</span><span class="ident" id="5506571">x</span><span class="op" id="5506572">,</span>&nbsp;<span class="ident" id="5506574">y</span><span class="op" id="5506575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506578">p</span><span class="op" id="5506579">.</span><span class="ident" id="5506580">Pix</span><span class="op" id="5506583">[</span><span class="ident" id="5506584">i</span><span class="op" id="5506585">]</span>&nbsp;<span class="op" id="5506587">=</span>&nbsp;<span class="ident" id="5506589">color</span><span class="op" id="5506594">.</span><span class="ident" id="5506595">AlphaModel</span><span class="op" id="5506605">.</span><span class="ident" id="5506606">Convert</span><span class="op" id="5506613">(</span><span class="ident" id="5506614">c</span><span class="op" id="5506615">)</span><span class="op" id="5506616">.</span><span class="op" id="5506617">(</span><span class="ident" id="5506618">color</span><span class="op" id="5506623">.</span><span class="ident" id="5506624">Alpha</span><span class="op" id="5506629">)</span><span class="op" id="5506630">.</span><span class="ident" id="5506631">A</span><br>
<span class="lineno">520</span><span class="op" id="5506633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5506636">func</span>&nbsp;<span class="op" id="5506641">(</span><span class="ident" id="5506642">p</span>&nbsp;<span class="op" id="5506644">*</span><span class="ident" id="5506645">Alpha</span><span class="op" id="5506650">)</span>&nbsp;<span class="ident" id="5506652">SetAlpha</span><span class="op" id="5506660">(</span><span class="ident" id="5506661">x</span><span class="op" id="5506662">,</span>&nbsp;<span class="ident" id="5506664">y</span>&nbsp;<span class="builtintype" id="5506666">int</span><span class="op" id="5506669">,</span>&nbsp;<span class="ident" id="5506671">c</span>&nbsp;<span class="ident" id="5506673">color</span><span class="op" id="5506678">.</span><span class="ident" id="5506679">Alpha</span><span class="op" id="5506684">)</span>&nbsp;<span class="op" id="5506686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506689">if</span>&nbsp;<span class="op" id="5506692">!</span><span class="op" id="5506693">(</span><span class="ident" id="5506694">Point</span><span class="op" id="5506699">{</span><span class="ident" id="5506700">x</span><span class="op" id="5506701">,</span>&nbsp;<span class="ident" id="5506703">y</span><span class="op" id="5506704">}</span><span class="op" id="5506705">.</span><span class="ident" id="5506706">In</span><span class="op" id="5506708">(</span><span class="ident" id="5506709">p</span><span class="op" id="5506710">.</span><span class="ident" id="5506711">Rect</span><span class="op" id="5506715">)</span><span class="op" id="5506716">)</span>&nbsp;<span class="op" id="5506718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506722">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5506730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506733">i</span>&nbsp;<span class="op" id="5506735">:=</span>&nbsp;<span class="ident" id="5506738">p</span><span class="op" id="5506739">.</span><span class="ident" id="5506740">PixOffset</span><span class="op" id="5506749">(</span><span class="ident" id="5506750">x</span><span class="op" id="5506751">,</span>&nbsp;<span class="ident" id="5506753">y</span><span class="op" id="5506754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506757">p</span><span class="op" id="5506758">.</span><span class="ident" id="5506759">Pix</span><span class="op" id="5506762">[</span><span class="ident" id="5506763">i</span><span class="op" id="5506764">]</span>&nbsp;<span class="op" id="5506766">=</span>&nbsp;<span class="ident" id="5506768">c</span><span class="op" id="5506769">.</span><span class="ident" id="5506770">A</span><br>
<span class="lineno"></span><span class="op" id="5506772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5506775">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5506852">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5506924">func</span>&nbsp;<span class="op" id="5506929">(</span><span class="ident" id="5506930">p</span>&nbsp;<span class="op" id="5506932">*</span><span class="ident" id="5506933">Alpha</span><span class="op" id="5506938">)</span>&nbsp;<span class="ident" id="5506940">SubImage</span><span class="op" id="5506948">(</span><span class="ident" id="5506949">r</span>&nbsp;<span class="ident" id="5506951">Rectangle</span><span class="op" id="5506960">)</span>&nbsp;<span class="ident" id="5506962">Image</span>&nbsp;<span class="op" id="5506968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506971">r</span>&nbsp;<span class="op" id="5506973">=</span>&nbsp;<span class="ident" id="5506975">r</span><span class="op" id="5506976">.</span><span class="ident" id="5506977">Intersect</span><span class="op" id="5506986">(</span><span class="ident" id="5506987">p</span><span class="op" id="5506988">.</span><span class="ident" id="5506989">Rect</span><span class="op" id="5506993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506996">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5507077">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5507159">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507209">if</span>&nbsp;<span class="ident" id="5507212">r</span><span class="op" id="5507213">.</span><span class="ident" id="5507214">Empty</span><span class="op" id="5507219">(</span><span class="op" id="5507220">)</span>&nbsp;<span class="op" id="5507222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507226">return</span>&nbsp;<span class="op" id="5507233">&amp;</span><span class="ident" id="5507234">Alpha</span><span class="op" id="5507239">{</span><span class="op" id="5507240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507243">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507246">i</span>&nbsp;<span class="op" id="5507248">:=</span>&nbsp;<span class="ident" id="5507251">p</span><span class="op" id="5507252">.</span><span class="ident" id="5507253">PixOffset</span><span class="op" id="5507262">(</span><span class="ident" id="5507263">r</span><span class="op" id="5507264">.</span><span class="ident" id="5507265">Min</span><span class="op" id="5507268">.</span><span class="ident" id="5507269">X</span><span class="op" id="5507270">,</span>&nbsp;<span class="ident" id="5507272">r</span><span class="op" id="5507273">.</span><span class="ident" id="5507274">Min</span><span class="op" id="5507277">.</span><span class="ident" id="5507278">Y</span><span class="op" id="5507279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507282">return</span>&nbsp;<span class="op" id="5507289">&amp;</span><span class="ident" id="5507290">Alpha</span><span class="op" id="5507295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507299">Pix</span><span class="op" id="5507302">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507307">p</span><span class="op" id="5507308">.</span><span class="ident" id="5507309">Pix</span><span class="op" id="5507312">[</span><span class="ident" id="5507313">i</span><span class="op" id="5507314">:</span><span class="op" id="5507315">]</span><span class="op" id="5507316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507320">Stride</span><span class="op" id="5507326">:</span>&nbsp;<span class="ident" id="5507328">p</span><span class="op" id="5507329">.</span><span class="ident" id="5507330">Stride</span><span class="op" id="5507336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507340">Rect</span><span class="op" id="5507344">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5507348">r</span><span class="op" id="5507349">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507352">}</span><br>
<span class="lineno"></span><span class="op" id="5507354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5507357">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5507430">func</span>&nbsp;<span class="op" id="5507435">(</span><span class="ident" id="5507436">p</span>&nbsp;<span class="op" id="5507438">*</span><span class="ident" id="5507439">Alpha</span><span class="op" id="5507444">)</span>&nbsp;<span class="ident" id="5507446">Opaque</span><span class="op" id="5507452">(</span><span class="op" id="5507453">)</span>&nbsp;<span class="builtintype" id="5507455">bool</span>&nbsp;<span class="op" id="5507460">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507463">if</span>&nbsp;<span class="ident" id="5507466">p</span><span class="op" id="5507467">.</span><span class="ident" id="5507468">Rect</span><span class="op" id="5507472">.</span><span class="ident" id="5507473">Empty</span><span class="op" id="5507478">(</span><span class="op" id="5507479">)</span>&nbsp;<span class="op" id="5507481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507485">return</span>&nbsp;<span class="builtintype" id="5507492">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507501">i0</span><span class="op" id="5507503">,</span>&nbsp;<span class="ident" id="5507505">i1</span>&nbsp;<span class="op" id="5507508">:=</span>&nbsp;<span class="num" id="5507511">0</span><span class="op" id="5507512">,</span>&nbsp;<span class="ident" id="5507514">p</span><span class="op" id="5507515">.</span><span class="ident" id="5507516">Rect</span><span class="op" id="5507520">.</span><span class="ident" id="5507521">Dx</span><span class="op" id="5507523">(</span><span class="op" id="5507524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507527">for</span>&nbsp;<span class="ident" id="5507531">y</span>&nbsp;<span class="op" id="5507533">:=</span>&nbsp;<span class="ident" id="5507536">p</span><span class="op" id="5507537">.</span><span class="ident" id="5507538">Rect</span><span class="op" id="5507542">.</span><span class="ident" id="5507543">Min</span><span class="op" id="5507546">.</span><span class="ident" id="5507547">Y</span><span class="op" id="5507548">;</span>&nbsp;<span class="ident" id="5507550">y</span>&nbsp;<span class="op" id="5507552">&lt;</span>&nbsp;<span class="ident" id="5507554">p</span><span class="op" id="5507555">.</span><span class="ident" id="5507556">Rect</span><span class="op" id="5507560">.</span><span class="ident" id="5507561">Max</span><span class="op" id="5507564">.</span><span class="ident" id="5507565">Y</span><span class="op" id="5507566">;</span>&nbsp;<span class="ident" id="5507568">y</span><span class="op" id="5507569">++</span>&nbsp;<span class="op" id="5507572">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507576">for</span>&nbsp;<span class="ident" id="5507580">i</span>&nbsp;<span class="op" id="5507582">:=</span>&nbsp;<span class="ident" id="5507585">i0</span><span class="op" id="5507587">;</span>&nbsp;<span class="ident" id="5507589">i</span>&nbsp;<span class="op" id="5507591">&lt;</span>&nbsp;<span class="ident" id="5507593">i1</span><span class="op" id="5507595">;</span>&nbsp;<span class="ident" id="5507597">i</span><span class="op" id="5507598">++</span>&nbsp;<span class="op" id="5507601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507606">if</span>&nbsp;<span class="ident" id="5507609">p</span><span class="op" id="5507610">.</span><span class="ident" id="5507611">Pix</span><span class="op" id="5507614">[</span><span class="ident" id="5507615">i</span><span class="op" id="5507616">]</span>&nbsp;<span class="op" id="5507618">!=</span>&nbsp;<span class="num" id="5507621">0xff</span>&nbsp;<span class="op" id="5507626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507632">return</span>&nbsp;<span class="builtintype" id="5507639">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507652">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507656">i0</span>&nbsp;<span class="op" id="5507659">+=</span>&nbsp;<span class="ident" id="5507662">p</span><span class="op" id="5507663">.</span><span class="ident" id="5507664">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507673">i1</span>&nbsp;<span class="op" id="5507676">+=</span>&nbsp;<span class="ident" id="5507679">p</span><span class="op" id="5507680">.</span><span class="ident" id="5507681">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507692">return</span>&nbsp;<span class="builtintype" id="5507699">true</span><br>
<span class="lineno"></span><span class="op" id="5507704">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5507707">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5507762">func</span>&nbsp;<span class="ident" id="5507767">NewAlpha</span><span class="op" id="5507775">(</span><span class="ident" id="5507776">r</span>&nbsp;<span class="ident" id="5507778">Rectangle</span><span class="op" id="5507787">)</span>&nbsp;<span class="op" id="5507789">*</span><span class="ident" id="5507790">Alpha</span>&nbsp;<span class="op" id="5507796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507799">w</span><span class="op" id="5507800">,</span>&nbsp;<span class="ident" id="5507802">h</span>&nbsp;<span class="op" id="5507804">:=</span>&nbsp;<span class="ident" id="5507807">r</span><span class="op" id="5507808">.</span><span class="ident" id="5507809">Dx</span><span class="op" id="5507811">(</span><span class="op" id="5507812">)</span><span class="op" id="5507813">,</span>&nbsp;<span class="ident" id="5507815">r</span><span class="op" id="5507816">.</span><span class="ident" id="5507817">Dy</span><span class="op" id="5507819">(</span><span class="op" id="5507820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507823">pix</span>&nbsp;<span class="op" id="5507827">:=</span>&nbsp;<span class="builtinfunc" id="5507830">make</span><span class="op" id="5507834">(</span><span class="op" id="5507835">[</span><span class="op" id="5507836">]</span><span class="builtintype" id="5507837">uint8</span><span class="op" id="5507842">,</span>&nbsp;<span class="num" id="5507844">1</span><span class="op" id="5507845">*</span><span class="ident" id="5507846">w</span><span class="op" id="5507847">*</span><span class="ident" id="5507848">h</span><span class="op" id="5507849">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507852">return</span>&nbsp;<span class="op" id="5507859">&amp;</span><span class="ident" id="5507860">Alpha</span><span class="op" id="5507865">{</span><span class="ident" id="5507866">pix</span><span class="op" id="5507869">,</span>&nbsp;<span class="num" id="5507871">1</span>&nbsp;<span class="op" id="5507873">*</span>&nbsp;<span class="ident" id="5507875">w</span><span class="op" id="5507876">,</span>&nbsp;<span class="ident" id="5507878">r</span><span class="op" id="5507879">}</span><br>
<span class="lineno"></span><span class="op" id="5507881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5507884">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5507963">type</span>&nbsp;<span class="ident" id="5507968">Alpha16</span>&nbsp;<span class="keyword" id="5507976">struct</span>&nbsp;<span class="op" id="5507983">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5507986">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5508071">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508139">Pix</span>&nbsp;<span class="op" id="5508143">[</span><span class="op" id="5508144">]</span><span class="builtintype" id="5508145">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5508152">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508228">Stride</span>&nbsp;<span class="builtintype" id="5508235">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5508240">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508272">Rect</span>&nbsp;<span class="ident" id="5508277">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5508287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5508290">func</span>&nbsp;<span class="op" id="5508295">(</span><span class="ident" id="5508296">p</span>&nbsp;<span class="op" id="5508298">*</span><span class="ident" id="5508299">Alpha16</span><span class="op" id="5508306">)</span>&nbsp;<span class="ident" id="5508308">ColorModel</span><span class="op" id="5508318">(</span><span class="op" id="5508319">)</span>&nbsp;<span class="ident" id="5508321">color</span><span class="op" id="5508326">.</span><span class="ident" id="5508327">Model</span>&nbsp;<span class="op" id="5508333">{</span>&nbsp;<span class="keyword" id="5508335">return</span>&nbsp;<span class="ident" id="5508342">color</span><span class="op" id="5508347">.</span><span class="ident" id="5508348">Alpha16Model</span>&nbsp;<span class="op" id="5508361">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5508364">func</span>&nbsp;<span class="op" id="5508369">(</span><span class="ident" id="5508370">p</span>&nbsp;<span class="op" id="5508372">*</span><span class="ident" id="5508373">Alpha16</span><span class="op" id="5508380">)</span>&nbsp;<span class="ident" id="5508382">Bounds</span><span class="op" id="5508388">(</span><span class="op" id="5508389">)</span>&nbsp;<span class="ident" id="5508391">Rectangle</span>&nbsp;<span class="op" id="5508401">{</span>&nbsp;<span class="keyword" id="5508403">return</span>&nbsp;<span class="ident" id="5508410">p</span><span class="op" id="5508411">.</span><span class="ident" id="5508412">Rect</span>&nbsp;<span class="op" id="5508417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5508420">func</span>&nbsp;<span class="op" id="5508425">(</span><span class="ident" id="5508426">p</span>&nbsp;<span class="op" id="5508428">*</span><span class="ident" id="5508429">Alpha16</span><span class="op" id="5508436">)</span>&nbsp;<span class="ident" id="5508438">At</span><span class="op" id="5508440">(</span><span class="ident" id="5508441">x</span><span class="op" id="5508442">,</span>&nbsp;<span class="ident" id="5508444">y</span>&nbsp;<span class="builtintype" id="5508446">int</span><span class="op" id="5508449">)</span>&nbsp;<span class="ident" id="5508451">color</span><span class="op" id="5508456">.</span><span class="ident" id="5508457">Color</span>&nbsp;<span class="op" id="5508463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508466">return</span>&nbsp;<span class="ident" id="5508473">p</span><span class="op" id="5508474">.</span><span class="ident" id="5508475">Alpha16At</span><span class="op" id="5508484">(</span><span class="ident" id="5508485">x</span><span class="op" id="5508486">,</span>&nbsp;<span class="ident" id="5508488">y</span><span class="op" id="5508489">)</span><br>
<span class="lineno">590</span><span class="op" id="5508491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5508494">func</span>&nbsp;<span class="op" id="5508499">(</span><span class="ident" id="5508500">p</span>&nbsp;<span class="op" id="5508502">*</span><span class="ident" id="5508503">Alpha16</span><span class="op" id="5508510">)</span>&nbsp;<span class="ident" id="5508512">Alpha16At</span><span class="op" id="5508521">(</span><span class="ident" id="5508522">x</span><span class="op" id="5508523">,</span>&nbsp;<span class="ident" id="5508525">y</span>&nbsp;<span class="builtintype" id="5508527">int</span><span class="op" id="5508530">)</span>&nbsp;<span class="ident" id="5508532">color</span><span class="op" id="5508537">.</span><span class="ident" id="5508538">Alpha16</span>&nbsp;<span class="op" id="5508546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508549">if</span>&nbsp;<span class="op" id="5508552">!</span><span class="op" id="5508553">(</span><span class="ident" id="5508554">Point</span><span class="op" id="5508559">{</span><span class="ident" id="5508560">x</span><span class="op" id="5508561">,</span>&nbsp;<span class="ident" id="5508563">y</span><span class="op" id="5508564">}</span><span class="op" id="5508565">.</span><span class="ident" id="5508566">In</span><span class="op" id="5508568">(</span><span class="ident" id="5508569">p</span><span class="op" id="5508570">.</span><span class="ident" id="5508571">Rect</span><span class="op" id="5508575">)</span><span class="op" id="5508576">)</span>&nbsp;<span class="op" id="5508578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508582">return</span>&nbsp;<span class="ident" id="5508589">color</span><span class="op" id="5508594">.</span><span class="ident" id="5508595">Alpha16</span><span class="op" id="5508602">{</span><span class="op" id="5508603">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5508606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508609">i</span>&nbsp;<span class="op" id="5508611">:=</span>&nbsp;<span class="ident" id="5508614">p</span><span class="op" id="5508615">.</span><span class="ident" id="5508616">PixOffset</span><span class="op" id="5508625">(</span><span class="ident" id="5508626">x</span><span class="op" id="5508627">,</span>&nbsp;<span class="ident" id="5508629">y</span><span class="op" id="5508630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508633">return</span>&nbsp;<span class="ident" id="5508640">color</span><span class="op" id="5508645">.</span><span class="ident" id="5508646">Alpha16</span><span class="op" id="5508653">{</span><span class="builtintype" id="5508654">uint16</span><span class="op" id="5508660">(</span><span class="ident" id="5508661">p</span><span class="op" id="5508662">.</span><span class="ident" id="5508663">Pix</span><span class="op" id="5508666">[</span><span class="ident" id="5508667">i</span><span class="op" id="5508668">+</span><span class="num" id="5508669">0</span><span class="op" id="5508670">]</span><span class="op" id="5508671">)</span><span class="op" id="5508672">&lt;&lt;</span><span class="num" id="5508674">8</span>&nbsp;<span class="op" id="5508676">|</span>&nbsp;<span class="builtintype" id="5508678">uint16</span><span class="op" id="5508684">(</span><span class="ident" id="5508685">p</span><span class="op" id="5508686">.</span><span class="ident" id="5508687">Pix</span><span class="op" id="5508690">[</span><span class="ident" id="5508691">i</span><span class="op" id="5508692">+</span><span class="num" id="5508693">1</span><span class="op" id="5508694">]</span><span class="op" id="5508695">)</span><span class="op" id="5508696">}</span><br>
<span class="lineno"></span><span class="op" id="5508698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5508701">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5508780">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5508804">func</span>&nbsp;<span class="op" id="5508809">(</span><span class="ident" id="5508810">p</span>&nbsp;<span class="op" id="5508812">*</span><span class="ident" id="5508813">Alpha16</span><span class="op" id="5508820">)</span>&nbsp;<span class="ident" id="5508822">PixOffset</span><span class="op" id="5508831">(</span><span class="ident" id="5508832">x</span><span class="op" id="5508833">,</span>&nbsp;<span class="ident" id="5508835">y</span>&nbsp;<span class="builtintype" id="5508837">int</span><span class="op" id="5508840">)</span>&nbsp;<span class="builtintype" id="5508842">int</span>&nbsp;<span class="op" id="5508846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508849">return</span>&nbsp;<span class="op" id="5508856">(</span><span class="ident" id="5508857">y</span><span class="op" id="5508858">-</span><span class="ident" id="5508859">p</span><span class="op" id="5508860">.</span><span class="ident" id="5508861">Rect</span><span class="op" id="5508865">.</span><span class="ident" id="5508866">Min</span><span class="op" id="5508869">.</span><span class="ident" id="5508870">Y</span><span class="op" id="5508871">)</span><span class="op" id="5508872">*</span><span class="ident" id="5508873">p</span><span class="op" id="5508874">.</span><span class="ident" id="5508875">Stride</span>&nbsp;<span class="op" id="5508882">+</span>&nbsp;<span class="op" id="5508884">(</span><span class="ident" id="5508885">x</span><span class="op" id="5508886">-</span><span class="ident" id="5508887">p</span><span class="op" id="5508888">.</span><span class="ident" id="5508889">Rect</span><span class="op" id="5508893">.</span><span class="ident" id="5508894">Min</span><span class="op" id="5508897">.</span><span class="ident" id="5508898">X</span><span class="op" id="5508899">)</span><span class="op" id="5508900">*</span><span class="num" id="5508901">2</span><br>
<span class="lineno"></span><span class="op" id="5508903">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5508906">func</span>&nbsp;<span class="op" id="5508911">(</span><span class="ident" id="5508912">p</span>&nbsp;<span class="op" id="5508914">*</span><span class="ident" id="5508915">Alpha16</span><span class="op" id="5508922">)</span>&nbsp;<span class="ident" id="5508924">Set</span><span class="op" id="5508927">(</span><span class="ident" id="5508928">x</span><span class="op" id="5508929">,</span>&nbsp;<span class="ident" id="5508931">y</span>&nbsp;<span class="builtintype" id="5508933">int</span><span class="op" id="5508936">,</span>&nbsp;<span class="ident" id="5508938">c</span>&nbsp;<span class="ident" id="5508940">color</span><span class="op" id="5508945">.</span><span class="ident" id="5508946">Color</span><span class="op" id="5508951">)</span>&nbsp;<span class="op" id="5508953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508956">if</span>&nbsp;<span class="op" id="5508959">!</span><span class="op" id="5508960">(</span><span class="ident" id="5508961">Point</span><span class="op" id="5508966">{</span><span class="ident" id="5508967">x</span><span class="op" id="5508968">,</span>&nbsp;<span class="ident" id="5508970">y</span><span class="op" id="5508971">}</span><span class="op" id="5508972">.</span><span class="ident" id="5508973">In</span><span class="op" id="5508975">(</span><span class="ident" id="5508976">p</span><span class="op" id="5508977">.</span><span class="ident" id="5508978">Rect</span><span class="op" id="5508982">)</span><span class="op" id="5508983">)</span>&nbsp;<span class="op" id="5508985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5508997">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509000">i</span>&nbsp;<span class="op" id="5509002">:=</span>&nbsp;<span class="ident" id="5509005">p</span><span class="op" id="5509006">.</span><span class="ident" id="5509007">PixOffset</span><span class="op" id="5509016">(</span><span class="ident" id="5509017">x</span><span class="op" id="5509018">,</span>&nbsp;<span class="ident" id="5509020">y</span><span class="op" id="5509021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509024">c1</span>&nbsp;<span class="op" id="5509027">:=</span>&nbsp;<span class="ident" id="5509030">color</span><span class="op" id="5509035">.</span><span class="ident" id="5509036">Alpha16Model</span><span class="op" id="5509048">.</span><span class="ident" id="5509049">Convert</span><span class="op" id="5509056">(</span><span class="ident" id="5509057">c</span><span class="op" id="5509058">)</span><span class="op" id="5509059">.</span><span class="op" id="5509060">(</span><span class="ident" id="5509061">color</span><span class="op" id="5509066">.</span><span class="ident" id="5509067">Alpha16</span><span class="op" id="5509074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509077">p</span><span class="op" id="5509078">.</span><span class="ident" id="5509079">Pix</span><span class="op" id="5509082">[</span><span class="ident" id="5509083">i</span><span class="op" id="5509084">+</span><span class="num" id="5509085">0</span><span class="op" id="5509086">]</span>&nbsp;<span class="op" id="5509088">=</span>&nbsp;<span class="builtintype" id="5509090">uint8</span><span class="op" id="5509095">(</span><span class="ident" id="5509096">c1</span><span class="op" id="5509098">.</span><span class="ident" id="5509099">A</span>&nbsp;<span class="op" id="5509101">&gt;&gt;</span>&nbsp;<span class="num" id="5509104">8</span><span class="op" id="5509105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509108">p</span><span class="op" id="5509109">.</span><span class="ident" id="5509110">Pix</span><span class="op" id="5509113">[</span><span class="ident" id="5509114">i</span><span class="op" id="5509115">+</span><span class="num" id="5509116">1</span><span class="op" id="5509117">]</span>&nbsp;<span class="op" id="5509119">=</span>&nbsp;<span class="builtintype" id="5509121">uint8</span><span class="op" id="5509126">(</span><span class="ident" id="5509127">c1</span><span class="op" id="5509129">.</span><span class="ident" id="5509130">A</span><span class="op" id="5509131">)</span><br>
<span class="lineno"></span><span class="op" id="5509133">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5509136">func</span>&nbsp;<span class="op" id="5509141">(</span><span class="ident" id="5509142">p</span>&nbsp;<span class="op" id="5509144">*</span><span class="ident" id="5509145">Alpha16</span><span class="op" id="5509152">)</span>&nbsp;<span class="ident" id="5509154">SetAlpha16</span><span class="op" id="5509164">(</span><span class="ident" id="5509165">x</span><span class="op" id="5509166">,</span>&nbsp;<span class="ident" id="5509168">y</span>&nbsp;<span class="builtintype" id="5509170">int</span><span class="op" id="5509173">,</span>&nbsp;<span class="ident" id="5509175">c</span>&nbsp;<span class="ident" id="5509177">color</span><span class="op" id="5509182">.</span><span class="ident" id="5509183">Alpha16</span><span class="op" id="5509190">)</span>&nbsp;<span class="op" id="5509192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509195">if</span>&nbsp;<span class="op" id="5509198">!</span><span class="op" id="5509199">(</span><span class="ident" id="5509200">Point</span><span class="op" id="5509205">{</span><span class="ident" id="5509206">x</span><span class="op" id="5509207">,</span>&nbsp;<span class="ident" id="5509209">y</span><span class="op" id="5509210">}</span><span class="op" id="5509211">.</span><span class="ident" id="5509212">In</span><span class="op" id="5509214">(</span><span class="ident" id="5509215">p</span><span class="op" id="5509216">.</span><span class="ident" id="5509217">Rect</span><span class="op" id="5509221">)</span><span class="op" id="5509222">)</span>&nbsp;<span class="op" id="5509224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509228">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5509236">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509239">i</span>&nbsp;<span class="op" id="5509241">:=</span>&nbsp;<span class="ident" id="5509244">p</span><span class="op" id="5509245">.</span><span class="ident" id="5509246">PixOffset</span><span class="op" id="5509255">(</span><span class="ident" id="5509256">x</span><span class="op" id="5509257">,</span>&nbsp;<span class="ident" id="5509259">y</span><span class="op" id="5509260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509263">p</span><span class="op" id="5509264">.</span><span class="ident" id="5509265">Pix</span><span class="op" id="5509268">[</span><span class="ident" id="5509269">i</span><span class="op" id="5509270">+</span><span class="num" id="5509271">0</span><span class="op" id="5509272">]</span>&nbsp;<span class="op" id="5509274">=</span>&nbsp;<span class="builtintype" id="5509276">uint8</span><span class="op" id="5509281">(</span><span class="ident" id="5509282">c</span><span class="op" id="5509283">.</span><span class="ident" id="5509284">A</span>&nbsp;<span class="op" id="5509286">&gt;&gt;</span>&nbsp;<span class="num" id="5509289">8</span><span class="op" id="5509290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509293">p</span><span class="op" id="5509294">.</span><span class="ident" id="5509295">Pix</span><span class="op" id="5509298">[</span><span class="ident" id="5509299">i</span><span class="op" id="5509300">+</span><span class="num" id="5509301">1</span><span class="op" id="5509302">]</span>&nbsp;<span class="op" id="5509304">=</span>&nbsp;<span class="builtintype" id="5509306">uint8</span><span class="op" id="5509311">(</span><span class="ident" id="5509312">c</span><span class="op" id="5509313">.</span><span class="ident" id="5509314">A</span><span class="op" id="5509315">)</span><br>
<span class="lineno"></span><span class="op" id="5509317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5509320">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5509397">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5509469">func</span>&nbsp;<span class="op" id="5509474">(</span><span class="ident" id="5509475">p</span>&nbsp;<span class="op" id="5509477">*</span><span class="ident" id="5509478">Alpha16</span><span class="op" id="5509485">)</span>&nbsp;<span class="ident" id="5509487">SubImage</span><span class="op" id="5509495">(</span><span class="ident" id="5509496">r</span>&nbsp;<span class="ident" id="5509498">Rectangle</span><span class="op" id="5509507">)</span>&nbsp;<span class="ident" id="5509509">Image</span>&nbsp;<span class="op" id="5509515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509518">r</span>&nbsp;<span class="op" id="5509520">=</span>&nbsp;<span class="ident" id="5509522">r</span><span class="op" id="5509523">.</span><span class="ident" id="5509524">Intersect</span><span class="op" id="5509533">(</span><span class="ident" id="5509534">p</span><span class="op" id="5509535">.</span><span class="ident" id="5509536">Rect</span><span class="op" id="5509540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5509543">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5509624">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5509706">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509756">if</span>&nbsp;<span class="ident" id="5509759">r</span><span class="op" id="5509760">.</span><span class="ident" id="5509761">Empty</span><span class="op" id="5509766">(</span><span class="op" id="5509767">)</span>&nbsp;<span class="op" id="5509769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509773">return</span>&nbsp;<span class="op" id="5509780">&amp;</span><span class="ident" id="5509781">Alpha16</span><span class="op" id="5509788">{</span><span class="op" id="5509789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5509792">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509795">i</span>&nbsp;<span class="op" id="5509797">:=</span>&nbsp;<span class="ident" id="5509800">p</span><span class="op" id="5509801">.</span><span class="ident" id="5509802">PixOffset</span><span class="op" id="5509811">(</span><span class="ident" id="5509812">r</span><span class="op" id="5509813">.</span><span class="ident" id="5509814">Min</span><span class="op" id="5509817">.</span><span class="ident" id="5509818">X</span><span class="op" id="5509819">,</span>&nbsp;<span class="ident" id="5509821">r</span><span class="op" id="5509822">.</span><span class="ident" id="5509823">Min</span><span class="op" id="5509826">.</span><span class="ident" id="5509827">Y</span><span class="op" id="5509828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509831">return</span>&nbsp;<span class="op" id="5509838">&amp;</span><span class="ident" id="5509839">Alpha16</span><span class="op" id="5509846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509850">Pix</span><span class="op" id="5509853">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509858">p</span><span class="op" id="5509859">.</span><span class="ident" id="5509860">Pix</span><span class="op" id="5509863">[</span><span class="ident" id="5509864">i</span><span class="op" id="5509865">:</span><span class="op" id="5509866">]</span><span class="op" id="5509867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509871">Stride</span><span class="op" id="5509877">:</span>&nbsp;<span class="ident" id="5509879">p</span><span class="op" id="5509880">.</span><span class="ident" id="5509881">Stride</span><span class="op" id="5509887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509891">Rect</span><span class="op" id="5509895">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5509899">r</span><span class="op" id="5509900">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5509903">}</span><br>
<span class="lineno"></span><span class="op" id="5509905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5509908">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5509981">func</span>&nbsp;<span class="op" id="5509986">(</span><span class="ident" id="5509987">p</span>&nbsp;<span class="op" id="5509989">*</span><span class="ident" id="5509990">Alpha16</span><span class="op" id="5509997">)</span>&nbsp;<span class="ident" id="5509999">Opaque</span><span class="op" id="5510005">(</span><span class="op" id="5510006">)</span>&nbsp;<span class="builtintype" id="5510008">bool</span>&nbsp;<span class="op" id="5510013">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510016">if</span>&nbsp;<span class="ident" id="5510019">p</span><span class="op" id="5510020">.</span><span class="ident" id="5510021">Rect</span><span class="op" id="5510025">.</span><span class="ident" id="5510026">Empty</span><span class="op" id="5510031">(</span><span class="op" id="5510032">)</span>&nbsp;<span class="op" id="5510034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510038">return</span>&nbsp;<span class="builtintype" id="5510045">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510054">i0</span><span class="op" id="5510056">,</span>&nbsp;<span class="ident" id="5510058">i1</span>&nbsp;<span class="op" id="5510061">:=</span>&nbsp;<span class="num" id="5510064">0</span><span class="op" id="5510065">,</span>&nbsp;<span class="ident" id="5510067">p</span><span class="op" id="5510068">.</span><span class="ident" id="5510069">Rect</span><span class="op" id="5510073">.</span><span class="ident" id="5510074">Dx</span><span class="op" id="5510076">(</span><span class="op" id="5510077">)</span><span class="op" id="5510078">*</span><span class="num" id="5510079">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510082">for</span>&nbsp;<span class="ident" id="5510086">y</span>&nbsp;<span class="op" id="5510088">:=</span>&nbsp;<span class="ident" id="5510091">p</span><span class="op" id="5510092">.</span><span class="ident" id="5510093">Rect</span><span class="op" id="5510097">.</span><span class="ident" id="5510098">Min</span><span class="op" id="5510101">.</span><span class="ident" id="5510102">Y</span><span class="op" id="5510103">;</span>&nbsp;<span class="ident" id="5510105">y</span>&nbsp;<span class="op" id="5510107">&lt;</span>&nbsp;<span class="ident" id="5510109">p</span><span class="op" id="5510110">.</span><span class="ident" id="5510111">Rect</span><span class="op" id="5510115">.</span><span class="ident" id="5510116">Max</span><span class="op" id="5510119">.</span><span class="ident" id="5510120">Y</span><span class="op" id="5510121">;</span>&nbsp;<span class="ident" id="5510123">y</span><span class="op" id="5510124">++</span>&nbsp;<span class="op" id="5510127">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510131">for</span>&nbsp;<span class="ident" id="5510135">i</span>&nbsp;<span class="op" id="5510137">:=</span>&nbsp;<span class="ident" id="5510140">i0</span><span class="op" id="5510142">;</span>&nbsp;<span class="ident" id="5510144">i</span>&nbsp;<span class="op" id="5510146">&lt;</span>&nbsp;<span class="ident" id="5510148">i1</span><span class="op" id="5510150">;</span>&nbsp;<span class="ident" id="5510152">i</span>&nbsp;<span class="op" id="5510154">+=</span>&nbsp;<span class="num" id="5510157">2</span>&nbsp;<span class="op" id="5510159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510164">if</span>&nbsp;<span class="ident" id="5510167">p</span><span class="op" id="5510168">.</span><span class="ident" id="5510169">Pix</span><span class="op" id="5510172">[</span><span class="ident" id="5510173">i</span><span class="op" id="5510174">+</span><span class="num" id="5510175">0</span><span class="op" id="5510176">]</span>&nbsp;<span class="op" id="5510178">!=</span>&nbsp;<span class="num" id="5510181">0xff</span>&nbsp;<span class="op" id="5510186">||</span>&nbsp;<span class="ident" id="5510189">p</span><span class="op" id="5510190">.</span><span class="ident" id="5510191">Pix</span><span class="op" id="5510194">[</span><span class="ident" id="5510195">i</span><span class="op" id="5510196">+</span><span class="num" id="5510197">1</span><span class="op" id="5510198">]</span>&nbsp;<span class="op" id="5510200">!=</span>&nbsp;<span class="num" id="5510203">0xff</span>&nbsp;<span class="op" id="5510208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510214">return</span>&nbsp;<span class="builtintype" id="5510221">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510234">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510238">i0</span>&nbsp;<span class="op" id="5510241">+=</span>&nbsp;<span class="ident" id="5510244">p</span><span class="op" id="5510245">.</span><span class="ident" id="5510246">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510255">i1</span>&nbsp;<span class="op" id="5510258">+=</span>&nbsp;<span class="ident" id="5510261">p</span><span class="op" id="5510262">.</span><span class="ident" id="5510263">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510274">return</span>&nbsp;<span class="builtintype" id="5510281">true</span><br>
<span class="lineno"></span><span class="op" id="5510286">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5510289">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5510348">func</span>&nbsp;<span class="ident" id="5510353">NewAlpha16</span><span class="op" id="5510363">(</span><span class="ident" id="5510364">r</span>&nbsp;<span class="ident" id="5510366">Rectangle</span><span class="op" id="5510375">)</span>&nbsp;<span class="op" id="5510377">*</span><span class="ident" id="5510378">Alpha16</span>&nbsp;<span class="op" id="5510386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510389">w</span><span class="op" id="5510390">,</span>&nbsp;<span class="ident" id="5510392">h</span>&nbsp;<span class="op" id="5510394">:=</span>&nbsp;<span class="ident" id="5510397">r</span><span class="op" id="5510398">.</span><span class="ident" id="5510399">Dx</span><span class="op" id="5510401">(</span><span class="op" id="5510402">)</span><span class="op" id="5510403">,</span>&nbsp;<span class="ident" id="5510405">r</span><span class="op" id="5510406">.</span><span class="ident" id="5510407">Dy</span><span class="op" id="5510409">(</span><span class="op" id="5510410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510413">pix</span>&nbsp;<span class="op" id="5510417">:=</span>&nbsp;<span class="builtinfunc" id="5510420">make</span><span class="op" id="5510424">(</span><span class="op" id="5510425">[</span><span class="op" id="5510426">]</span><span class="builtintype" id="5510427">uint8</span><span class="op" id="5510432">,</span>&nbsp;<span class="num" id="5510434">2</span><span class="op" id="5510435">*</span><span class="ident" id="5510436">w</span><span class="op" id="5510437">*</span><span class="ident" id="5510438">h</span><span class="op" id="5510439">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510442">return</span>&nbsp;<span class="op" id="5510449">&amp;</span><span class="ident" id="5510450">Alpha16</span><span class="op" id="5510457">{</span><span class="ident" id="5510458">pix</span><span class="op" id="5510461">,</span>&nbsp;<span class="num" id="5510463">2</span>&nbsp;<span class="op" id="5510465">*</span>&nbsp;<span class="ident" id="5510467">w</span><span class="op" id="5510468">,</span>&nbsp;<span class="ident" id="5510470">r</span><span class="op" id="5510471">}</span><br>
<span class="lineno"></span><span class="op" id="5510473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5510476">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5510549">type</span>&nbsp;<span class="ident" id="5510554">Gray</span>&nbsp;<span class="keyword" id="5510559">struct</span>&nbsp;<span class="op" id="5510566">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5510569">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5510632">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510700">Pix</span>&nbsp;<span class="op" id="5510704">[</span><span class="op" id="5510705">]</span><span class="builtintype" id="5510706">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5510713">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510789">Stride</span>&nbsp;<span class="builtintype" id="5510796">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5510801">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510833">Rect</span>&nbsp;<span class="ident" id="5510838">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5510848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5510851">func</span>&nbsp;<span class="op" id="5510856">(</span><span class="ident" id="5510857">p</span>&nbsp;<span class="op" id="5510859">*</span><span class="ident" id="5510860">Gray</span><span class="op" id="5510864">)</span>&nbsp;<span class="ident" id="5510866">ColorModel</span><span class="op" id="5510876">(</span><span class="op" id="5510877">)</span>&nbsp;<span class="ident" id="5510879">color</span><span class="op" id="5510884">.</span><span class="ident" id="5510885">Model</span>&nbsp;<span class="op" id="5510891">{</span>&nbsp;<span class="keyword" id="5510893">return</span>&nbsp;<span class="ident" id="5510900">color</span><span class="op" id="5510905">.</span><span class="ident" id="5510906">GrayModel</span>&nbsp;<span class="op" id="5510916">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5510919">func</span>&nbsp;<span class="op" id="5510924">(</span><span class="ident" id="5510925">p</span>&nbsp;<span class="op" id="5510927">*</span><span class="ident" id="5510928">Gray</span><span class="op" id="5510932">)</span>&nbsp;<span class="ident" id="5510934">Bounds</span><span class="op" id="5510940">(</span><span class="op" id="5510941">)</span>&nbsp;<span class="ident" id="5510943">Rectangle</span>&nbsp;<span class="op" id="5510953">{</span>&nbsp;<span class="keyword" id="5510955">return</span>&nbsp;<span class="ident" id="5510962">p</span><span class="op" id="5510963">.</span><span class="ident" id="5510964">Rect</span>&nbsp;<span class="op" id="5510969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5510972">func</span>&nbsp;<span class="op" id="5510977">(</span><span class="ident" id="5510978">p</span>&nbsp;<span class="op" id="5510980">*</span><span class="ident" id="5510981">Gray</span><span class="op" id="5510985">)</span>&nbsp;<span class="ident" id="5510987">At</span><span class="op" id="5510989">(</span><span class="ident" id="5510990">x</span><span class="op" id="5510991">,</span>&nbsp;<span class="ident" id="5510993">y</span>&nbsp;<span class="builtintype" id="5510995">int</span><span class="op" id="5510998">)</span>&nbsp;<span class="ident" id="5511000">color</span><span class="op" id="5511005">.</span><span class="ident" id="5511006">Color</span>&nbsp;<span class="op" id="5511012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511015">return</span>&nbsp;<span class="ident" id="5511022">p</span><span class="op" id="5511023">.</span><span class="ident" id="5511024">GrayAt</span><span class="op" id="5511030">(</span><span class="ident" id="5511031">x</span><span class="op" id="5511032">,</span>&nbsp;<span class="ident" id="5511034">y</span><span class="op" id="5511035">)</span><br>
<span class="lineno">685</span><span class="op" id="5511037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5511040">func</span>&nbsp;<span class="op" id="5511045">(</span><span class="ident" id="5511046">p</span>&nbsp;<span class="op" id="5511048">*</span><span class="ident" id="5511049">Gray</span><span class="op" id="5511053">)</span>&nbsp;<span class="ident" id="5511055">GrayAt</span><span class="op" id="5511061">(</span><span class="ident" id="5511062">x</span><span class="op" id="5511063">,</span>&nbsp;<span class="ident" id="5511065">y</span>&nbsp;<span class="builtintype" id="5511067">int</span><span class="op" id="5511070">)</span>&nbsp;<span class="ident" id="5511072">color</span><span class="op" id="5511077">.</span><span class="ident" id="5511078">Gray</span>&nbsp;<span class="op" id="5511083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511086">if</span>&nbsp;<span class="op" id="5511089">!</span><span class="op" id="5511090">(</span><span class="ident" id="5511091">Point</span><span class="op" id="5511096">{</span><span class="ident" id="5511097">x</span><span class="op" id="5511098">,</span>&nbsp;<span class="ident" id="5511100">y</span><span class="op" id="5511101">}</span><span class="op" id="5511102">.</span><span class="ident" id="5511103">In</span><span class="op" id="5511105">(</span><span class="ident" id="5511106">p</span><span class="op" id="5511107">.</span><span class="ident" id="5511108">Rect</span><span class="op" id="5511112">)</span><span class="op" id="5511113">)</span>&nbsp;<span class="op" id="5511115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511119">return</span>&nbsp;<span class="ident" id="5511126">color</span><span class="op" id="5511131">.</span><span class="ident" id="5511132">Gray</span><span class="op" id="5511136">{</span><span class="op" id="5511137">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5511140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5511143">i</span>&nbsp;<span class="op" id="5511145">:=</span>&nbsp;<span class="ident" id="5511148">p</span><span class="op" id="5511149">.</span><span class="ident" id="5511150">PixOffset</span><span class="op" id="5511159">(</span><span class="ident" id="5511160">x</span><span class="op" id="5511161">,</span>&nbsp;<span class="ident" id="5511163">y</span><span class="op" id="5511164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511167">return</span>&nbsp;<span class="ident" id="5511174">color</span><span class="op" id="5511179">.</span><span class="ident" id="5511180">Gray</span><span class="op" id="5511184">{</span><span class="ident" id="5511185">p</span><span class="op" id="5511186">.</span><span class="ident" id="5511187">Pix</span><span class="op" id="5511190">[</span><span class="ident" id="5511191">i</span><span class="op" id="5511192">]</span><span class="op" id="5511193">}</span><br>
<span class="lineno"></span><span class="op" id="5511195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5511198">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5511277">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5511301">func</span>&nbsp;<span class="op" id="5511306">(</span><span class="ident" id="5511307">p</span>&nbsp;<span class="op" id="5511309">*</span><span class="ident" id="5511310">Gray</span><span class="op" id="5511314">)</span>&nbsp;<span class="ident" id="5511316">PixOffset</span><span class="op" id="5511325">(</span><span class="ident" id="5511326">x</span><span class="op" id="5511327">,</span>&nbsp;<span class="ident" id="5511329">y</span>&nbsp;<span class="builtintype" id="5511331">int</span><span class="op" id="5511334">)</span>&nbsp;<span class="builtintype" id="5511336">int</span>&nbsp;<span class="op" id="5511340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511343">return</span>&nbsp;<span class="op" id="5511350">(</span><span class="ident" id="5511351">y</span><span class="op" id="5511352">-</span><span class="ident" id="5511353">p</span><span class="op" id="5511354">.</span><span class="ident" id="5511355">Rect</span><span class="op" id="5511359">.</span><span class="ident" id="5511360">Min</span><span class="op" id="5511363">.</span><span class="ident" id="5511364">Y</span><span class="op" id="5511365">)</span><span class="op" id="5511366">*</span><span class="ident" id="5511367">p</span><span class="op" id="5511368">.</span><span class="ident" id="5511369">Stride</span>&nbsp;<span class="op" id="5511376">+</span>&nbsp;<span class="op" id="5511378">(</span><span class="ident" id="5511379">x</span><span class="op" id="5511380">-</span><span class="ident" id="5511381">p</span><span class="op" id="5511382">.</span><span class="ident" id="5511383">Rect</span><span class="op" id="5511387">.</span><span class="ident" id="5511388">Min</span><span class="op" id="5511391">.</span><span class="ident" id="5511392">X</span><span class="op" id="5511393">)</span><span class="op" id="5511394">*</span><span class="num" id="5511395">1</span><br>
<span class="lineno"></span><span class="op" id="5511397">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5511400">func</span>&nbsp;<span class="op" id="5511405">(</span><span class="ident" id="5511406">p</span>&nbsp;<span class="op" id="5511408">*</span><span class="ident" id="5511409">Gray</span><span class="op" id="5511413">)</span>&nbsp;<span class="ident" id="5511415">Set</span><span class="op" id="5511418">(</span><span class="ident" id="5511419">x</span><span class="op" id="5511420">,</span>&nbsp;<span class="ident" id="5511422">y</span>&nbsp;<span class="builtintype" id="5511424">int</span><span class="op" id="5511427">,</span>&nbsp;<span class="ident" id="5511429">c</span>&nbsp;<span class="ident" id="5511431">color</span><span class="op" id="5511436">.</span><span class="ident" id="5511437">Color</span><span class="op" id="5511442">)</span>&nbsp;<span class="op" id="5511444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511447">if</span>&nbsp;<span class="op" id="5511450">!</span><span class="op" id="5511451">(</span><span class="ident" id="5511452">Point</span><span class="op" id="5511457">{</span><span class="ident" id="5511458">x</span><span class="op" id="5511459">,</span>&nbsp;<span class="ident" id="5511461">y</span><span class="op" id="5511462">}</span><span class="op" id="5511463">.</span><span class="ident" id="5511464">In</span><span class="op" id="5511466">(</span><span class="ident" id="5511467">p</span><span class="op" id="5511468">.</span><span class="ident" id="5511469">Rect</span><span class="op" id="5511473">)</span><span class="op" id="5511474">)</span>&nbsp;<span class="op" id="5511476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511480">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5511488">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5511491">i</span>&nbsp;<span class="op" id="5511493">:=</span>&nbsp;<span class="ident" id="5511496">p</span><span class="op" id="5511497">.</span><span class="ident" id="5511498">PixOffset</span><span class="op" id="5511507">(</span><span class="ident" id="5511508">x</span><span class="op" id="5511509">,</span>&nbsp;<span class="ident" id="5511511">y</span><span class="op" id="5511512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5511515">p</span><span class="op" id="5511516">.</span><span class="ident" id="5511517">Pix</span><span class="op" id="5511520">[</span><span class="ident" id="5511521">i</span><span class="op" id="5511522">]</span>&nbsp;<span class="op" id="5511524">=</span>&nbsp;<span class="ident" id="5511526">color</span><span class="op" id="5511531">.</span><span class="ident" id="5511532">GrayModel</span><span class="op" id="5511541">.</span><span class="ident" id="5511542">Convert</span><span class="op" id="5511549">(</span><span class="ident" id="5511550">c</span><span class="op" id="5511551">)</span><span class="op" id="5511552">.</span><span class="op" id="5511553">(</span><span class="ident" id="5511554">color</span><span class="op" id="5511559">.</span><span class="ident" id="5511560">Gray</span><span class="op" id="5511564">)</span><span class="op" id="5511565">.</span><span class="ident" id="5511566">Y</span><br>
<span class="lineno"></span><span class="op" id="5511568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5511571">func</span>&nbsp;<span class="op" id="5511576">(</span><span class="ident" id="5511577">p</span>&nbsp;<span class="op" id="5511579">*</span><span class="ident" id="5511580">Gray</span><span class="op" id="5511584">)</span>&nbsp;<span class="ident" id="5511586">SetGray</span><span class="op" id="5511593">(</span><span class="ident" id="5511594">x</span><span class="op" id="5511595">,</span>&nbsp;<span class="ident" id="5511597">y</span>&nbsp;<span class="builtintype" id="5511599">int</span><span class="op" id="5511602">,</span>&nbsp;<span class="ident" id="5511604">c</span>&nbsp;<span class="ident" id="5511606">color</span><span class="op" id="5511611">.</span><span class="ident" id="5511612">Gray</span><span class="op" id="5511616">)</span>&nbsp;<span class="op" id="5511618">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511621">if</span>&nbsp;<span class="op" id="5511624">!</span><span class="op" id="5511625">(</span><span class="ident" id="5511626">Point</span><span class="op" id="5511631">{</span><span class="ident" id="5511632">x</span><span class="op" id="5511633">,</span>&nbsp;<span class="ident" id="5511635">y</span><span class="op" id="5511636">}</span><span class="op" id="5511637">.</span><span class="ident" id="5511638">In</span><span class="op" id="5511640">(</span><span class="ident" id="5511641">p</span><span class="op" id="5511642">.</span><span class="ident" id="5511643">Rect</span><span class="op" id="5511647">)</span><span class="op" id="5511648">)</span>&nbsp;<span class="op" id="5511650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5511654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5511662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5511665">i</span>&nbsp;<span class="op" id="5511667">:=</span>&nbsp;<span class="ident" id="5511670">p</span><span class="op" id="5511671">.</span><span class="ident" id="5511672">PixOffset</span><span class="op" id="5511681">(</span><span class="ident" id="5511682">x</span><span class="op" id="5511683">,</span>&nbsp;<span class="ident" id="5511685">y</span><span class="op" id="5511686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5511689">p</span><span class="op" id="5511690">.</span><span class="ident" id="5511691">Pix</span><span class="op" id="5511694">[</span><span class="ident" id="5511695">i</span><span class="op" id="5511696">]</span>&nbsp;<span class="op" id="5511698">=</span>&nbsp;<span class="ident" id="5511700">c</span><span class="op" id="5511701">.</span><span class="ident" id="5511702">Y</span><br>
<span class="lineno">715</span><span class="op" id="5511704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5511707">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5511784">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5511856">func</span>&nbsp;<span class="op" id="5511861">(</span><span class="ident" id="5511862">p</span>&nbsp;<span class="op" id="5511864">*</span><span class="ident" id="5511865">Gray</span><span class="op" id="5511869">)</span>&nbsp;<span class="ident" id="5511871">SubImage</span><span class="op" id="5511879">(</span><span class="ident" id="5511880">r</span>&nbsp;<span class="ident" id="5511882">Rectangle</span><span class="op" id="5511891">)</span>&nbsp;<span class="ident" id="5511893">Image</span>&nbsp;<span class="op" id="5511899">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5511902">r</span>&nbsp;<span class="op" id="5511904">=</span>&nbsp;<span class="ident" id="5511906">r</span><span class="op" id="5511907">.</span><span class="ident" id="5511908">Intersect</span><span class="op" id="5511917">(</span><span class="ident" id="5511918">p</span><span class="op" id="5511919">.</span><span class="ident" id="5511920">Rect</span><span class="op" id="5511924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5511927">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5512008">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5512090">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5512140">if</span>&nbsp;<span class="ident" id="5512143">r</span><span class="op" id="5512144">.</span><span class="ident" id="5512145">Empty</span><span class="op" id="5512150">(</span><span class="op" id="5512151">)</span>&nbsp;<span class="op" id="5512153">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5512157">return</span>&nbsp;<span class="op" id="5512164">&amp;</span><span class="ident" id="5512165">Gray</span><span class="op" id="5512169">{</span><span class="op" id="5512170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5512173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512176">i</span>&nbsp;<span class="op" id="5512178">:=</span>&nbsp;<span class="ident" id="5512181">p</span><span class="op" id="5512182">.</span><span class="ident" id="5512183">PixOffset</span><span class="op" id="5512192">(</span><span class="ident" id="5512193">r</span><span class="op" id="5512194">.</span><span class="ident" id="5512195">Min</span><span class="op" id="5512198">.</span><span class="ident" id="5512199">X</span><span class="op" id="5512200">,</span>&nbsp;<span class="ident" id="5512202">r</span><span class="op" id="5512203">.</span><span class="ident" id="5512204">Min</span><span class="op" id="5512207">.</span><span class="ident" id="5512208">Y</span><span class="op" id="5512209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5512212">return</span>&nbsp;<span class="op" id="5512219">&amp;</span><span class="ident" id="5512220">Gray</span><span class="op" id="5512224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512228">Pix</span><span class="op" id="5512231">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512236">p</span><span class="op" id="5512237">.</span><span class="ident" id="5512238">Pix</span><span class="op" id="5512241">[</span><span class="ident" id="5512242">i</span><span class="op" id="5512243">:</span><span class="op" id="5512244">]</span><span class="op" id="5512245">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512249">Stride</span><span class="op" id="5512255">:</span>&nbsp;<span class="ident" id="5512257">p</span><span class="op" id="5512258">.</span><span class="ident" id="5512259">Stride</span><span class="op" id="5512265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512269">Rect</span><span class="op" id="5512273">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5512277">r</span><span class="op" id="5512278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5512281">}</span><br>
<span class="lineno"></span><span class="op" id="5512283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5512286">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5512359">func</span>&nbsp;<span class="op" id="5512364">(</span><span class="ident" id="5512365">p</span>&nbsp;<span class="op" id="5512367">*</span><span class="ident" id="5512368">Gray</span><span class="op" id="5512372">)</span>&nbsp;<span class="ident" id="5512374">Opaque</span><span class="op" id="5512380">(</span><span class="op" id="5512381">)</span>&nbsp;<span class="builtintype" id="5512383">bool</span>&nbsp;<span class="op" id="5512388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5512391">return</span>&nbsp;<span class="builtintype" id="5512398">true</span><br>
<span class="lineno"></span><span class="op" id="5512403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5512406">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5512459">func</span>&nbsp;<span class="ident" id="5512464">NewGray</span><span class="op" id="5512471">(</span><span class="ident" id="5512472">r</span>&nbsp;<span class="ident" id="5512474">Rectangle</span><span class="op" id="5512483">)</span>&nbsp;<span class="op" id="5512485">*</span><span class="ident" id="5512486">Gray</span>&nbsp;<span class="op" id="5512491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512494">w</span><span class="op" id="5512495">,</span>&nbsp;<span class="ident" id="5512497">h</span>&nbsp;<span class="op" id="5512499">:=</span>&nbsp;<span class="ident" id="5512502">r</span><span class="op" id="5512503">.</span><span class="ident" id="5512504">Dx</span><span class="op" id="5512506">(</span><span class="op" id="5512507">)</span><span class="op" id="5512508">,</span>&nbsp;<span class="ident" id="5512510">r</span><span class="op" id="5512511">.</span><span class="ident" id="5512512">Dy</span><span class="op" id="5512514">(</span><span class="op" id="5512515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512518">pix</span>&nbsp;<span class="op" id="5512522">:=</span>&nbsp;<span class="builtinfunc" id="5512525">make</span><span class="op" id="5512529">(</span><span class="op" id="5512530">[</span><span class="op" id="5512531">]</span><span class="builtintype" id="5512532">uint8</span><span class="op" id="5512537">,</span>&nbsp;<span class="num" id="5512539">1</span><span class="op" id="5512540">*</span><span class="ident" id="5512541">w</span><span class="op" id="5512542">*</span><span class="ident" id="5512543">h</span><span class="op" id="5512544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5512547">return</span>&nbsp;<span class="op" id="5512554">&amp;</span><span class="ident" id="5512555">Gray</span><span class="op" id="5512559">{</span><span class="ident" id="5512560">pix</span><span class="op" id="5512563">,</span>&nbsp;<span class="num" id="5512565">1</span>&nbsp;<span class="op" id="5512567">*</span>&nbsp;<span class="ident" id="5512569">w</span><span class="op" id="5512570">,</span>&nbsp;<span class="ident" id="5512572">r</span><span class="op" id="5512573">}</span><br>
<span class="lineno">745</span><span class="op" id="5512575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5512578">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5512655">type</span>&nbsp;<span class="ident" id="5512660">Gray16</span>&nbsp;<span class="keyword" id="5512667">struct</span>&nbsp;<span class="op" id="5512674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5512677">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5512761">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512829">Pix</span>&nbsp;<span class="op" id="5512833">[</span><span class="op" id="5512834">]</span><span class="builtintype" id="5512835">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5512842">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512918">Stride</span>&nbsp;<span class="builtintype" id="5512925">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5512930">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5512962">Rect</span>&nbsp;<span class="ident" id="5512967">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5512977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5512980">func</span>&nbsp;<span class="op" id="5512985">(</span><span class="ident" id="5512986">p</span>&nbsp;<span class="op" id="5512988">*</span><span class="ident" id="5512989">Gray16</span><span class="op" id="5512995">)</span>&nbsp;<span class="ident" id="5512997">ColorModel</span><span class="op" id="5513007">(</span><span class="op" id="5513008">)</span>&nbsp;<span class="ident" id="5513010">color</span><span class="op" id="5513015">.</span><span class="ident" id="5513016">Model</span>&nbsp;<span class="op" id="5513022">{</span>&nbsp;<span class="keyword" id="5513024">return</span>&nbsp;<span class="ident" id="5513031">color</span><span class="op" id="5513036">.</span><span class="ident" id="5513037">Gray16Model</span>&nbsp;<span class="op" id="5513049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5513052">func</span>&nbsp;<span class="op" id="5513057">(</span><span class="ident" id="5513058">p</span>&nbsp;<span class="op" id="5513060">*</span><span class="ident" id="5513061">Gray16</span><span class="op" id="5513067">)</span>&nbsp;<span class="ident" id="5513069">Bounds</span><span class="op" id="5513075">(</span><span class="op" id="5513076">)</span>&nbsp;<span class="ident" id="5513078">Rectangle</span>&nbsp;<span class="op" id="5513088">{</span>&nbsp;<span class="keyword" id="5513090">return</span>&nbsp;<span class="ident" id="5513097">p</span><span class="op" id="5513098">.</span><span class="ident" id="5513099">Rect</span>&nbsp;<span class="op" id="5513104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5513107">func</span>&nbsp;<span class="op" id="5513112">(</span><span class="ident" id="5513113">p</span>&nbsp;<span class="op" id="5513115">*</span><span class="ident" id="5513116">Gray16</span><span class="op" id="5513122">)</span>&nbsp;<span class="ident" id="5513124">At</span><span class="op" id="5513126">(</span><span class="ident" id="5513127">x</span><span class="op" id="5513128">,</span>&nbsp;<span class="ident" id="5513130">y</span>&nbsp;<span class="builtintype" id="5513132">int</span><span class="op" id="5513135">)</span>&nbsp;<span class="ident" id="5513137">color</span><span class="op" id="5513142">.</span><span class="ident" id="5513143">Color</span>&nbsp;<span class="op" id="5513149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513152">return</span>&nbsp;<span class="ident" id="5513159">p</span><span class="op" id="5513160">.</span><span class="ident" id="5513161">Gray16At</span><span class="op" id="5513169">(</span><span class="ident" id="5513170">x</span><span class="op" id="5513171">,</span>&nbsp;<span class="ident" id="5513173">y</span><span class="op" id="5513174">)</span><br>
<span class="lineno"></span><span class="op" id="5513176">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5513179">func</span>&nbsp;<span class="op" id="5513184">(</span><span class="ident" id="5513185">p</span>&nbsp;<span class="op" id="5513187">*</span><span class="ident" id="5513188">Gray16</span><span class="op" id="5513194">)</span>&nbsp;<span class="ident" id="5513196">Gray16At</span><span class="op" id="5513204">(</span><span class="ident" id="5513205">x</span><span class="op" id="5513206">,</span>&nbsp;<span class="ident" id="5513208">y</span>&nbsp;<span class="builtintype" id="5513210">int</span><span class="op" id="5513213">)</span>&nbsp;<span class="ident" id="5513215">color</span><span class="op" id="5513220">.</span><span class="ident" id="5513221">Gray16</span>&nbsp;<span class="op" id="5513228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513231">if</span>&nbsp;<span class="op" id="5513234">!</span><span class="op" id="5513235">(</span><span class="ident" id="5513236">Point</span><span class="op" id="5513241">{</span><span class="ident" id="5513242">x</span><span class="op" id="5513243">,</span>&nbsp;<span class="ident" id="5513245">y</span><span class="op" id="5513246">}</span><span class="op" id="5513247">.</span><span class="ident" id="5513248">In</span><span class="op" id="5513250">(</span><span class="ident" id="5513251">p</span><span class="op" id="5513252">.</span><span class="ident" id="5513253">Rect</span><span class="op" id="5513257">)</span><span class="op" id="5513258">)</span>&nbsp;<span class="op" id="5513260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513264">return</span>&nbsp;<span class="ident" id="5513271">color</span><span class="op" id="5513276">.</span><span class="ident" id="5513277">Gray16</span><span class="op" id="5513283">{</span><span class="op" id="5513284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5513287">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513290">i</span>&nbsp;<span class="op" id="5513292">:=</span>&nbsp;<span class="ident" id="5513295">p</span><span class="op" id="5513296">.</span><span class="ident" id="5513297">PixOffset</span><span class="op" id="5513306">(</span><span class="ident" id="5513307">x</span><span class="op" id="5513308">,</span>&nbsp;<span class="ident" id="5513310">y</span><span class="op" id="5513311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513314">return</span>&nbsp;<span class="ident" id="5513321">color</span><span class="op" id="5513326">.</span><span class="ident" id="5513327">Gray16</span><span class="op" id="5513333">{</span><span class="builtintype" id="5513334">uint16</span><span class="op" id="5513340">(</span><span class="ident" id="5513341">p</span><span class="op" id="5513342">.</span><span class="ident" id="5513343">Pix</span><span class="op" id="5513346">[</span><span class="ident" id="5513347">i</span><span class="op" id="5513348">+</span><span class="num" id="5513349">0</span><span class="op" id="5513350">]</span><span class="op" id="5513351">)</span><span class="op" id="5513352">&lt;&lt;</span><span class="num" id="5513354">8</span>&nbsp;<span class="op" id="5513356">|</span>&nbsp;<span class="builtintype" id="5513358">uint16</span><span class="op" id="5513364">(</span><span class="ident" id="5513365">p</span><span class="op" id="5513366">.</span><span class="ident" id="5513367">Pix</span><span class="op" id="5513370">[</span><span class="ident" id="5513371">i</span><span class="op" id="5513372">+</span><span class="num" id="5513373">1</span><span class="op" id="5513374">]</span><span class="op" id="5513375">)</span><span class="op" id="5513376">}</span><br>
<span class="lineno"></span><span class="op" id="5513378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5513381">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5513460">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5513484">func</span>&nbsp;<span class="op" id="5513489">(</span><span class="ident" id="5513490">p</span>&nbsp;<span class="op" id="5513492">*</span><span class="ident" id="5513493">Gray16</span><span class="op" id="5513499">)</span>&nbsp;<span class="ident" id="5513501">PixOffset</span><span class="op" id="5513510">(</span><span class="ident" id="5513511">x</span><span class="op" id="5513512">,</span>&nbsp;<span class="ident" id="5513514">y</span>&nbsp;<span class="builtintype" id="5513516">int</span><span class="op" id="5513519">)</span>&nbsp;<span class="builtintype" id="5513521">int</span>&nbsp;<span class="op" id="5513525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513528">return</span>&nbsp;<span class="op" id="5513535">(</span><span class="ident" id="5513536">y</span><span class="op" id="5513537">-</span><span class="ident" id="5513538">p</span><span class="op" id="5513539">.</span><span class="ident" id="5513540">Rect</span><span class="op" id="5513544">.</span><span class="ident" id="5513545">Min</span><span class="op" id="5513548">.</span><span class="ident" id="5513549">Y</span><span class="op" id="5513550">)</span><span class="op" id="5513551">*</span><span class="ident" id="5513552">p</span><span class="op" id="5513553">.</span><span class="ident" id="5513554">Stride</span>&nbsp;<span class="op" id="5513561">+</span>&nbsp;<span class="op" id="5513563">(</span><span class="ident" id="5513564">x</span><span class="op" id="5513565">-</span><span class="ident" id="5513566">p</span><span class="op" id="5513567">.</span><span class="ident" id="5513568">Rect</span><span class="op" id="5513572">.</span><span class="ident" id="5513573">Min</span><span class="op" id="5513576">.</span><span class="ident" id="5513577">X</span><span class="op" id="5513578">)</span><span class="op" id="5513579">*</span><span class="num" id="5513580">2</span><br>
<span class="lineno"></span><span class="op" id="5513582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5513585">func</span>&nbsp;<span class="op" id="5513590">(</span><span class="ident" id="5513591">p</span>&nbsp;<span class="op" id="5513593">*</span><span class="ident" id="5513594">Gray16</span><span class="op" id="5513600">)</span>&nbsp;<span class="ident" id="5513602">Set</span><span class="op" id="5513605">(</span><span class="ident" id="5513606">x</span><span class="op" id="5513607">,</span>&nbsp;<span class="ident" id="5513609">y</span>&nbsp;<span class="builtintype" id="5513611">int</span><span class="op" id="5513614">,</span>&nbsp;<span class="ident" id="5513616">c</span>&nbsp;<span class="ident" id="5513618">color</span><span class="op" id="5513623">.</span><span class="ident" id="5513624">Color</span><span class="op" id="5513629">)</span>&nbsp;<span class="op" id="5513631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513634">if</span>&nbsp;<span class="op" id="5513637">!</span><span class="op" id="5513638">(</span><span class="ident" id="5513639">Point</span><span class="op" id="5513644">{</span><span class="ident" id="5513645">x</span><span class="op" id="5513646">,</span>&nbsp;<span class="ident" id="5513648">y</span><span class="op" id="5513649">}</span><span class="op" id="5513650">.</span><span class="ident" id="5513651">In</span><span class="op" id="5513653">(</span><span class="ident" id="5513654">p</span><span class="op" id="5513655">.</span><span class="ident" id="5513656">Rect</span><span class="op" id="5513660">)</span><span class="op" id="5513661">)</span>&nbsp;<span class="op" id="5513663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513667">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5513675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513678">i</span>&nbsp;<span class="op" id="5513680">:=</span>&nbsp;<span class="ident" id="5513683">p</span><span class="op" id="5513684">.</span><span class="ident" id="5513685">PixOffset</span><span class="op" id="5513694">(</span><span class="ident" id="5513695">x</span><span class="op" id="5513696">,</span>&nbsp;<span class="ident" id="5513698">y</span><span class="op" id="5513699">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513702">c1</span>&nbsp;<span class="op" id="5513705">:=</span>&nbsp;<span class="ident" id="5513708">color</span><span class="op" id="5513713">.</span><span class="ident" id="5513714">Gray16Model</span><span class="op" id="5513725">.</span><span class="ident" id="5513726">Convert</span><span class="op" id="5513733">(</span><span class="ident" id="5513734">c</span><span class="op" id="5513735">)</span><span class="op" id="5513736">.</span><span class="op" id="5513737">(</span><span class="ident" id="5513738">color</span><span class="op" id="5513743">.</span><span class="ident" id="5513744">Gray16</span><span class="op" id="5513750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513753">p</span><span class="op" id="5513754">.</span><span class="ident" id="5513755">Pix</span><span class="op" id="5513758">[</span><span class="ident" id="5513759">i</span><span class="op" id="5513760">+</span><span class="num" id="5513761">0</span><span class="op" id="5513762">]</span>&nbsp;<span class="op" id="5513764">=</span>&nbsp;<span class="builtintype" id="5513766">uint8</span><span class="op" id="5513771">(</span><span class="ident" id="5513772">c1</span><span class="op" id="5513774">.</span><span class="ident" id="5513775">Y</span>&nbsp;<span class="op" id="5513777">&gt;&gt;</span>&nbsp;<span class="num" id="5513780">8</span><span class="op" id="5513781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513784">p</span><span class="op" id="5513785">.</span><span class="ident" id="5513786">Pix</span><span class="op" id="5513789">[</span><span class="ident" id="5513790">i</span><span class="op" id="5513791">+</span><span class="num" id="5513792">1</span><span class="op" id="5513793">]</span>&nbsp;<span class="op" id="5513795">=</span>&nbsp;<span class="builtintype" id="5513797">uint8</span><span class="op" id="5513802">(</span><span class="ident" id="5513803">c1</span><span class="op" id="5513805">.</span><span class="ident" id="5513806">Y</span><span class="op" id="5513807">)</span><br>
<span class="lineno"></span><span class="op" id="5513809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5513812">func</span>&nbsp;<span class="op" id="5513817">(</span><span class="ident" id="5513818">p</span>&nbsp;<span class="op" id="5513820">*</span><span class="ident" id="5513821">Gray16</span><span class="op" id="5513827">)</span>&nbsp;<span class="ident" id="5513829">SetGray16</span><span class="op" id="5513838">(</span><span class="ident" id="5513839">x</span><span class="op" id="5513840">,</span>&nbsp;<span class="ident" id="5513842">y</span>&nbsp;<span class="builtintype" id="5513844">int</span><span class="op" id="5513847">,</span>&nbsp;<span class="ident" id="5513849">c</span>&nbsp;<span class="ident" id="5513851">color</span><span class="op" id="5513856">.</span><span class="ident" id="5513857">Gray16</span><span class="op" id="5513863">)</span>&nbsp;<span class="op" id="5513865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513868">if</span>&nbsp;<span class="op" id="5513871">!</span><span class="op" id="5513872">(</span><span class="ident" id="5513873">Point</span><span class="op" id="5513878">{</span><span class="ident" id="5513879">x</span><span class="op" id="5513880">,</span>&nbsp;<span class="ident" id="5513882">y</span><span class="op" id="5513883">}</span><span class="op" id="5513884">.</span><span class="ident" id="5513885">In</span><span class="op" id="5513887">(</span><span class="ident" id="5513888">p</span><span class="op" id="5513889">.</span><span class="ident" id="5513890">Rect</span><span class="op" id="5513894">)</span><span class="op" id="5513895">)</span>&nbsp;<span class="op" id="5513897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5513901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5513909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513912">i</span>&nbsp;<span class="op" id="5513914">:=</span>&nbsp;<span class="ident" id="5513917">p</span><span class="op" id="5513918">.</span><span class="ident" id="5513919">PixOffset</span><span class="op" id="5513928">(</span><span class="ident" id="5513929">x</span><span class="op" id="5513930">,</span>&nbsp;<span class="ident" id="5513932">y</span><span class="op" id="5513933">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513936">p</span><span class="op" id="5513937">.</span><span class="ident" id="5513938">Pix</span><span class="op" id="5513941">[</span><span class="ident" id="5513942">i</span><span class="op" id="5513943">+</span><span class="num" id="5513944">0</span><span class="op" id="5513945">]</span>&nbsp;<span class="op" id="5513947">=</span>&nbsp;<span class="builtintype" id="5513949">uint8</span><span class="op" id="5513954">(</span><span class="ident" id="5513955">c</span><span class="op" id="5513956">.</span><span class="ident" id="5513957">Y</span>&nbsp;<span class="op" id="5513959">&gt;&gt;</span>&nbsp;<span class="num" id="5513962">8</span><span class="op" id="5513963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513966">p</span><span class="op" id="5513967">.</span><span class="ident" id="5513968">Pix</span><span class="op" id="5513971">[</span><span class="ident" id="5513972">i</span><span class="op" id="5513973">+</span><span class="num" id="5513974">1</span><span class="op" id="5513975">]</span>&nbsp;<span class="op" id="5513977">=</span>&nbsp;<span class="builtintype" id="5513979">uint8</span><span class="op" id="5513984">(</span><span class="ident" id="5513985">c</span><span class="op" id="5513986">.</span><span class="ident" id="5513987">Y</span><span class="op" id="5513988">)</span><br>
<span class="lineno"></span><span class="op" id="5513990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5513993">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5514070">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5514142">func</span>&nbsp;<span class="op" id="5514147">(</span><span class="ident" id="5514148">p</span>&nbsp;<span class="op" id="5514150">*</span><span class="ident" id="5514151">Gray16</span><span class="op" id="5514157">)</span>&nbsp;<span class="ident" id="5514159">SubImage</span><span class="op" id="5514167">(</span><span class="ident" id="5514168">r</span>&nbsp;<span class="ident" id="5514170">Rectangle</span><span class="op" id="5514179">)</span>&nbsp;<span class="ident" id="5514181">Image</span>&nbsp;<span class="op" id="5514187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514190">r</span>&nbsp;<span class="op" id="5514192">=</span>&nbsp;<span class="ident" id="5514194">r</span><span class="op" id="5514195">.</span><span class="ident" id="5514196">Intersect</span><span class="op" id="5514205">(</span><span class="ident" id="5514206">p</span><span class="op" id="5514207">.</span><span class="ident" id="5514208">Rect</span><span class="op" id="5514212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514215">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514296">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514378">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514428">if</span>&nbsp;<span class="ident" id="5514431">r</span><span class="op" id="5514432">.</span><span class="ident" id="5514433">Empty</span><span class="op" id="5514438">(</span><span class="op" id="5514439">)</span>&nbsp;<span class="op" id="5514441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514445">return</span>&nbsp;<span class="op" id="5514452">&amp;</span><span class="ident" id="5514453">Gray16</span><span class="op" id="5514459">{</span><span class="op" id="5514460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5514463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514466">i</span>&nbsp;<span class="op" id="5514468">:=</span>&nbsp;<span class="ident" id="5514471">p</span><span class="op" id="5514472">.</span><span class="ident" id="5514473">PixOffset</span><span class="op" id="5514482">(</span><span class="ident" id="5514483">r</span><span class="op" id="5514484">.</span><span class="ident" id="5514485">Min</span><span class="op" id="5514488">.</span><span class="ident" id="5514489">X</span><span class="op" id="5514490">,</span>&nbsp;<span class="ident" id="5514492">r</span><span class="op" id="5514493">.</span><span class="ident" id="5514494">Min</span><span class="op" id="5514497">.</span><span class="ident" id="5514498">Y</span><span class="op" id="5514499">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514502">return</span>&nbsp;<span class="op" id="5514509">&amp;</span><span class="ident" id="5514510">Gray16</span><span class="op" id="5514516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514520">Pix</span><span class="op" id="5514523">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514528">p</span><span class="op" id="5514529">.</span><span class="ident" id="5514530">Pix</span><span class="op" id="5514533">[</span><span class="ident" id="5514534">i</span><span class="op" id="5514535">:</span><span class="op" id="5514536">]</span><span class="op" id="5514537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514541">Stride</span><span class="op" id="5514547">:</span>&nbsp;<span class="ident" id="5514549">p</span><span class="op" id="5514550">.</span><span class="ident" id="5514551">Stride</span><span class="op" id="5514557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514561">Rect</span><span class="op" id="5514565">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5514569">r</span><span class="op" id="5514570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5514573">}</span><br>
<span class="lineno">815</span><span class="op" id="5514575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5514578">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5514651">func</span>&nbsp;<span class="op" id="5514656">(</span><span class="ident" id="5514657">p</span>&nbsp;<span class="op" id="5514659">*</span><span class="ident" id="5514660">Gray16</span><span class="op" id="5514666">)</span>&nbsp;<span class="ident" id="5514668">Opaque</span><span class="op" id="5514674">(</span><span class="op" id="5514675">)</span>&nbsp;<span class="builtintype" id="5514677">bool</span>&nbsp;<span class="op" id="5514682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514685">return</span>&nbsp;<span class="builtintype" id="5514692">true</span><br>
<span class="lineno">820</span><span class="op" id="5514697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5514700">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5514757">func</span>&nbsp;<span class="ident" id="5514762">NewGray16</span><span class="op" id="5514771">(</span><span class="ident" id="5514772">r</span>&nbsp;<span class="ident" id="5514774">Rectangle</span><span class="op" id="5514783">)</span>&nbsp;<span class="op" id="5514785">*</span><span class="ident" id="5514786">Gray16</span>&nbsp;<span class="op" id="5514793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514796">w</span><span class="op" id="5514797">,</span>&nbsp;<span class="ident" id="5514799">h</span>&nbsp;<span class="op" id="5514801">:=</span>&nbsp;<span class="ident" id="5514804">r</span><span class="op" id="5514805">.</span><span class="ident" id="5514806">Dx</span><span class="op" id="5514808">(</span><span class="op" id="5514809">)</span><span class="op" id="5514810">,</span>&nbsp;<span class="ident" id="5514812">r</span><span class="op" id="5514813">.</span><span class="ident" id="5514814">Dy</span><span class="op" id="5514816">(</span><span class="op" id="5514817">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514820">pix</span>&nbsp;<span class="op" id="5514824">:=</span>&nbsp;<span class="builtinfunc" id="5514827">make</span><span class="op" id="5514831">(</span><span class="op" id="5514832">[</span><span class="op" id="5514833">]</span><span class="builtintype" id="5514834">uint8</span><span class="op" id="5514839">,</span>&nbsp;<span class="num" id="5514841">2</span><span class="op" id="5514842">*</span><span class="ident" id="5514843">w</span><span class="op" id="5514844">*</span><span class="ident" id="5514845">h</span><span class="op" id="5514846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514849">return</span>&nbsp;<span class="op" id="5514856">&amp;</span><span class="ident" id="5514857">Gray16</span><span class="op" id="5514863">{</span><span class="ident" id="5514864">pix</span><span class="op" id="5514867">,</span>&nbsp;<span class="num" id="5514869">2</span>&nbsp;<span class="op" id="5514871">*</span>&nbsp;<span class="ident" id="5514873">w</span><span class="op" id="5514874">,</span>&nbsp;<span class="ident" id="5514876">r</span><span class="op" id="5514877">}</span><br>
<span class="lineno"></span><span class="op" id="5514879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5514882">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5514955">type</span>&nbsp;<span class="ident" id="5514960">Paletted</span>&nbsp;<span class="keyword" id="5514969">struct</span>&nbsp;<span class="op" id="5514976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514979">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515046">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515114">Pix</span>&nbsp;<span class="op" id="5515118">[</span><span class="op" id="5515119">]</span><span class="builtintype" id="5515120">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515127">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515203">Stride</span>&nbsp;<span class="builtintype" id="5515210">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515215">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515247">Rect</span>&nbsp;<span class="ident" id="5515252">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515263">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515299">Palette</span>&nbsp;<span class="ident" id="5515307">color</span><span class="op" id="5515312">.</span><span class="ident" id="5515313">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5515321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5515324">func</span>&nbsp;<span class="op" id="5515329">(</span><span class="ident" id="5515330">p</span>&nbsp;<span class="op" id="5515332">*</span><span class="ident" id="5515333">Paletted</span><span class="op" id="5515341">)</span>&nbsp;<span class="ident" id="5515343">ColorModel</span><span class="op" id="5515353">(</span><span class="op" id="5515354">)</span>&nbsp;<span class="ident" id="5515356">color</span><span class="op" id="5515361">.</span><span class="ident" id="5515362">Model</span>&nbsp;<span class="op" id="5515368">{</span>&nbsp;<span class="keyword" id="5515370">return</span>&nbsp;<span class="ident" id="5515377">p</span><span class="op" id="5515378">.</span><span class="ident" id="5515379">Palette</span>&nbsp;<span class="op" id="5515387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5515390">func</span>&nbsp;<span class="op" id="5515395">(</span><span class="ident" id="5515396">p</span>&nbsp;<span class="op" id="5515398">*</span><span class="ident" id="5515399">Paletted</span><span class="op" id="5515407">)</span>&nbsp;<span class="ident" id="5515409">Bounds</span><span class="op" id="5515415">(</span><span class="op" id="5515416">)</span>&nbsp;<span class="ident" id="5515418">Rectangle</span>&nbsp;<span class="op" id="5515428">{</span>&nbsp;<span class="keyword" id="5515430">return</span>&nbsp;<span class="ident" id="5515437">p</span><span class="op" id="5515438">.</span><span class="ident" id="5515439">Rect</span>&nbsp;<span class="op" id="5515444">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5515447">func</span>&nbsp;<span class="op" id="5515452">(</span><span class="ident" id="5515453">p</span>&nbsp;<span class="op" id="5515455">*</span><span class="ident" id="5515456">Paletted</span><span class="op" id="5515464">)</span>&nbsp;<span class="ident" id="5515466">At</span><span class="op" id="5515468">(</span><span class="ident" id="5515469">x</span><span class="op" id="5515470">,</span>&nbsp;<span class="ident" id="5515472">y</span>&nbsp;<span class="builtintype" id="5515474">int</span><span class="op" id="5515477">)</span>&nbsp;<span class="ident" id="5515479">color</span><span class="op" id="5515484">.</span><span class="ident" id="5515485">Color</span>&nbsp;<span class="op" id="5515491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515494">if</span>&nbsp;<span class="builtinfunc" id="5515497">len</span><span class="op" id="5515500">(</span><span class="ident" id="5515501">p</span><span class="op" id="5515502">.</span><span class="ident" id="5515503">Palette</span><span class="op" id="5515510">)</span>&nbsp;<span class="op" id="5515512">==</span>&nbsp;<span class="num" id="5515515">0</span>&nbsp;<span class="op" id="5515517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515521">return</span>&nbsp;<span class="ident" id="5515528">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5515533">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515536">if</span>&nbsp;<span class="op" id="5515539">!</span><span class="op" id="5515540">(</span><span class="ident" id="5515541">Point</span><span class="op" id="5515546">{</span><span class="ident" id="5515547">x</span><span class="op" id="5515548">,</span>&nbsp;<span class="ident" id="5515550">y</span><span class="op" id="5515551">}</span><span class="op" id="5515552">.</span><span class="ident" id="5515553">In</span><span class="op" id="5515555">(</span><span class="ident" id="5515556">p</span><span class="op" id="5515557">.</span><span class="ident" id="5515558">Rect</span><span class="op" id="5515562">)</span><span class="op" id="5515563">)</span>&nbsp;<span class="op" id="5515565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515569">return</span>&nbsp;<span class="ident" id="5515576">p</span><span class="op" id="5515577">.</span><span class="ident" id="5515578">Palette</span><span class="op" id="5515585">[</span><span class="num" id="5515586">0</span><span class="op" id="5515587">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5515590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515593">i</span>&nbsp;<span class="op" id="5515595">:=</span>&nbsp;<span class="ident" id="5515598">p</span><span class="op" id="5515599">.</span><span class="ident" id="5515600">PixOffset</span><span class="op" id="5515609">(</span><span class="ident" id="5515610">x</span><span class="op" id="5515611">,</span>&nbsp;<span class="ident" id="5515613">y</span><span class="op" id="5515614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515617">return</span>&nbsp;<span class="ident" id="5515624">p</span><span class="op" id="5515625">.</span><span class="ident" id="5515626">Palette</span><span class="op" id="5515633">[</span><span class="ident" id="5515634">p</span><span class="op" id="5515635">.</span><span class="ident" id="5515636">Pix</span><span class="op" id="5515639">[</span><span class="ident" id="5515640">i</span><span class="op" id="5515641">]</span><span class="op" id="5515642">]</span><br>
<span class="lineno">855</span><span class="op" id="5515644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5515647">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5515726">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5515750">func</span>&nbsp;<span class="op" id="5515755">(</span><span class="ident" id="5515756">p</span>&nbsp;<span class="op" id="5515758">*</span><span class="ident" id="5515759">Paletted</span><span class="op" id="5515767">)</span>&nbsp;<span class="ident" id="5515769">PixOffset</span><span class="op" id="5515778">(</span><span class="ident" id="5515779">x</span><span class="op" id="5515780">,</span>&nbsp;<span class="ident" id="5515782">y</span>&nbsp;<span class="builtintype" id="5515784">int</span><span class="op" id="5515787">)</span>&nbsp;<span class="builtintype" id="5515789">int</span>&nbsp;<span class="op" id="5515793">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515796">return</span>&nbsp;<span class="op" id="5515803">(</span><span class="ident" id="5515804">y</span><span class="op" id="5515805">-</span><span class="ident" id="5515806">p</span><span class="op" id="5515807">.</span><span class="ident" id="5515808">Rect</span><span class="op" id="5515812">.</span><span class="ident" id="5515813">Min</span><span class="op" id="5515816">.</span><span class="ident" id="5515817">Y</span><span class="op" id="5515818">)</span><span class="op" id="5515819">*</span><span class="ident" id="5515820">p</span><span class="op" id="5515821">.</span><span class="ident" id="5515822">Stride</span>&nbsp;<span class="op" id="5515829">+</span>&nbsp;<span class="op" id="5515831">(</span><span class="ident" id="5515832">x</span><span class="op" id="5515833">-</span><span class="ident" id="5515834">p</span><span class="op" id="5515835">.</span><span class="ident" id="5515836">Rect</span><span class="op" id="5515840">.</span><span class="ident" id="5515841">Min</span><span class="op" id="5515844">.</span><span class="ident" id="5515845">X</span><span class="op" id="5515846">)</span><span class="op" id="5515847">*</span><span class="num" id="5515848">1</span><br>
<span class="lineno"></span><span class="op" id="5515850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5515853">func</span>&nbsp;<span class="op" id="5515858">(</span><span class="ident" id="5515859">p</span>&nbsp;<span class="op" id="5515861">*</span><span class="ident" id="5515862">Paletted</span><span class="op" id="5515870">)</span>&nbsp;<span class="ident" id="5515872">Set</span><span class="op" id="5515875">(</span><span class="ident" id="5515876">x</span><span class="op" id="5515877">,</span>&nbsp;<span class="ident" id="5515879">y</span>&nbsp;<span class="builtintype" id="5515881">int</span><span class="op" id="5515884">,</span>&nbsp;<span class="ident" id="5515886">c</span>&nbsp;<span class="ident" id="5515888">color</span><span class="op" id="5515893">.</span><span class="ident" id="5515894">Color</span><span class="op" id="5515899">)</span>&nbsp;<span class="op" id="5515901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515904">if</span>&nbsp;<span class="op" id="5515907">!</span><span class="op" id="5515908">(</span><span class="ident" id="5515909">Point</span><span class="op" id="5515914">{</span><span class="ident" id="5515915">x</span><span class="op" id="5515916">,</span>&nbsp;<span class="ident" id="5515918">y</span><span class="op" id="5515919">}</span><span class="op" id="5515920">.</span><span class="ident" id="5515921">In</span><span class="op" id="5515923">(</span><span class="ident" id="5515924">p</span><span class="op" id="5515925">.</span><span class="ident" id="5515926">Rect</span><span class="op" id="5515930">)</span><span class="op" id="5515931">)</span>&nbsp;<span class="op" id="5515933">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515937">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5515945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515948">i</span>&nbsp;<span class="op" id="5515950">:=</span>&nbsp;<span class="ident" id="5515953">p</span><span class="op" id="5515954">.</span><span class="ident" id="5515955">PixOffset</span><span class="op" id="5515964">(</span><span class="ident" id="5515965">x</span><span class="op" id="5515966">,</span>&nbsp;<span class="ident" id="5515968">y</span><span class="op" id="5515969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515972">p</span><span class="op" id="5515973">.</span><span class="ident" id="5515974">Pix</span><span class="op" id="5515977">[</span><span class="ident" id="5515978">i</span><span class="op" id="5515979">]</span>&nbsp;<span class="op" id="5515981">=</span>&nbsp;<span class="builtintype" id="5515983">uint8</span><span class="op" id="5515988">(</span><span class="ident" id="5515989">p</span><span class="op" id="5515990">.</span><span class="ident" id="5515991">Palette</span><span class="op" id="5515998">.</span><span class="ident" id="5515999">Index</span><span class="op" id="5516004">(</span><span class="ident" id="5516005">c</span><span class="op" id="5516006">)</span><span class="op" id="5516007">)</span><br>
<span class="lineno"></span><span class="op" id="5516009">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5516012">func</span>&nbsp;<span class="op" id="5516017">(</span><span class="ident" id="5516018">p</span>&nbsp;<span class="op" id="5516020">*</span><span class="ident" id="5516021">Paletted</span><span class="op" id="5516029">)</span>&nbsp;<span class="ident" id="5516031">ColorIndexAt</span><span class="op" id="5516043">(</span><span class="ident" id="5516044">x</span><span class="op" id="5516045">,</span>&nbsp;<span class="ident" id="5516047">y</span>&nbsp;<span class="builtintype" id="5516049">int</span><span class="op" id="5516052">)</span>&nbsp;<span class="builtintype" id="5516054">uint8</span>&nbsp;<span class="op" id="5516060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516063">if</span>&nbsp;<span class="op" id="5516066">!</span><span class="op" id="5516067">(</span><span class="ident" id="5516068">Point</span><span class="op" id="5516073">{</span><span class="ident" id="5516074">x</span><span class="op" id="5516075">,</span>&nbsp;<span class="ident" id="5516077">y</span><span class="op" id="5516078">}</span><span class="op" id="5516079">.</span><span class="ident" id="5516080">In</span><span class="op" id="5516082">(</span><span class="ident" id="5516083">p</span><span class="op" id="5516084">.</span><span class="ident" id="5516085">Rect</span><span class="op" id="5516089">)</span><span class="op" id="5516090">)</span>&nbsp;<span class="op" id="5516092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516096">return</span>&nbsp;<span class="num" id="5516103">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516106">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516109">i</span>&nbsp;<span class="op" id="5516111">:=</span>&nbsp;<span class="ident" id="5516114">p</span><span class="op" id="5516115">.</span><span class="ident" id="5516116">PixOffset</span><span class="op" id="5516125">(</span><span class="ident" id="5516126">x</span><span class="op" id="5516127">,</span>&nbsp;<span class="ident" id="5516129">y</span><span class="op" id="5516130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516133">return</span>&nbsp;<span class="ident" id="5516140">p</span><span class="op" id="5516141">.</span><span class="ident" id="5516142">Pix</span><span class="op" id="5516145">[</span><span class="ident" id="5516146">i</span><span class="op" id="5516147">]</span><br>
<span class="lineno"></span><span class="op" id="5516149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5516152">func</span>&nbsp;<span class="op" id="5516157">(</span><span class="ident" id="5516158">p</span>&nbsp;<span class="op" id="5516160">*</span><span class="ident" id="5516161">Paletted</span><span class="op" id="5516169">)</span>&nbsp;<span class="ident" id="5516171">SetColorIndex</span><span class="op" id="5516184">(</span><span class="ident" id="5516185">x</span><span class="op" id="5516186">,</span>&nbsp;<span class="ident" id="5516188">y</span>&nbsp;<span class="builtintype" id="5516190">int</span><span class="op" id="5516193">,</span>&nbsp;<span class="ident" id="5516195">index</span>&nbsp;<span class="builtintype" id="5516201">uint8</span><span class="op" id="5516206">)</span>&nbsp;<span class="op" id="5516208">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516211">if</span>&nbsp;<span class="op" id="5516214">!</span><span class="op" id="5516215">(</span><span class="ident" id="5516216">Point</span><span class="op" id="5516221">{</span><span class="ident" id="5516222">x</span><span class="op" id="5516223">,</span>&nbsp;<span class="ident" id="5516225">y</span><span class="op" id="5516226">}</span><span class="op" id="5516227">.</span><span class="ident" id="5516228">In</span><span class="op" id="5516230">(</span><span class="ident" id="5516231">p</span><span class="op" id="5516232">.</span><span class="ident" id="5516233">Rect</span><span class="op" id="5516237">)</span><span class="op" id="5516238">)</span>&nbsp;<span class="op" id="5516240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516244">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516255">i</span>&nbsp;<span class="op" id="5516257">:=</span>&nbsp;<span class="ident" id="5516260">p</span><span class="op" id="5516261">.</span><span class="ident" id="5516262">PixOffset</span><span class="op" id="5516271">(</span><span class="ident" id="5516272">x</span><span class="op" id="5516273">,</span>&nbsp;<span class="ident" id="5516275">y</span><span class="op" id="5516276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516279">p</span><span class="op" id="5516280">.</span><span class="ident" id="5516281">Pix</span><span class="op" id="5516284">[</span><span class="ident" id="5516285">i</span><span class="op" id="5516286">]</span>&nbsp;<span class="op" id="5516288">=</span>&nbsp;<span class="ident" id="5516290">index</span><br>
<span class="lineno">885</span><span class="op" id="5516296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516299">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5516376">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5516448">func</span>&nbsp;<span class="op" id="5516453">(</span><span class="ident" id="5516454">p</span>&nbsp;<span class="op" id="5516456">*</span><span class="ident" id="5516457">Paletted</span><span class="op" id="5516465">)</span>&nbsp;<span class="ident" id="5516467">SubImage</span><span class="op" id="5516475">(</span><span class="ident" id="5516476">r</span>&nbsp;<span class="ident" id="5516478">Rectangle</span><span class="op" id="5516487">)</span>&nbsp;<span class="ident" id="5516489">Image</span>&nbsp;<span class="op" id="5516495">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516498">r</span>&nbsp;<span class="op" id="5516500">=</span>&nbsp;<span class="ident" id="5516502">r</span><span class="op" id="5516503">.</span><span class="ident" id="5516504">Intersect</span><span class="op" id="5516513">(</span><span class="ident" id="5516514">p</span><span class="op" id="5516515">.</span><span class="ident" id="5516516">Rect</span><span class="op" id="5516520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516523">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516604">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516686">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516736">if</span>&nbsp;<span class="ident" id="5516739">r</span><span class="op" id="5516740">.</span><span class="ident" id="5516741">Empty</span><span class="op" id="5516746">(</span><span class="op" id="5516747">)</span>&nbsp;<span class="op" id="5516749">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516753">return</span>&nbsp;<span class="op" id="5516760">&amp;</span><span class="ident" id="5516761">Paletted</span><span class="op" id="5516769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516774">Palette</span><span class="op" id="5516781">:</span>&nbsp;<span class="ident" id="5516783">p</span><span class="op" id="5516784">.</span><span class="ident" id="5516785">Palette</span><span class="op" id="5516792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516802">i</span>&nbsp;<span class="op" id="5516804">:=</span>&nbsp;<span class="ident" id="5516807">p</span><span class="op" id="5516808">.</span><span class="ident" id="5516809">PixOffset</span><span class="op" id="5516818">(</span><span class="ident" id="5516819">r</span><span class="op" id="5516820">.</span><span class="ident" id="5516821">Min</span><span class="op" id="5516824">.</span><span class="ident" id="5516825">X</span><span class="op" id="5516826">,</span>&nbsp;<span class="ident" id="5516828">r</span><span class="op" id="5516829">.</span><span class="ident" id="5516830">Min</span><span class="op" id="5516833">.</span><span class="ident" id="5516834">Y</span><span class="op" id="5516835">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516838">return</span>&nbsp;<span class="op" id="5516845">&amp;</span><span class="ident" id="5516846">Paletted</span><span class="op" id="5516854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516858">Pix</span><span class="op" id="5516861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516867">p</span><span class="op" id="5516868">.</span><span class="ident" id="5516869">Pix</span><span class="op" id="5516872">[</span><span class="ident" id="5516873">i</span><span class="op" id="5516874">:</span><span class="op" id="5516875">]</span><span class="op" id="5516876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516880">Stride</span><span class="op" id="5516886">:</span>&nbsp;&nbsp;<span class="ident" id="5516889">p</span><span class="op" id="5516890">.</span><span class="ident" id="5516891">Stride</span><span class="op" id="5516897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516901">Rect</span><span class="op" id="5516905">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516910">p</span><span class="op" id="5516911">.</span><span class="ident" id="5516912">Rect</span><span class="op" id="5516916">.</span><span class="ident" id="5516917">Intersect</span><span class="op" id="5516926">(</span><span class="ident" id="5516927">r</span><span class="op" id="5516928">)</span><span class="op" id="5516929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516933">Palette</span><span class="op" id="5516940">:</span>&nbsp;<span class="ident" id="5516942">p</span><span class="op" id="5516943">.</span><span class="ident" id="5516944">Palette</span><span class="op" id="5516951">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516954">}</span><br>
<span class="lineno"></span><span class="op" id="5516956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516959">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5517032">func</span>&nbsp;<span class="op" id="5517037">(</span><span class="ident" id="5517038">p</span>&nbsp;<span class="op" id="5517040">*</span><span class="ident" id="5517041">Paletted</span><span class="op" id="5517049">)</span>&nbsp;<span class="ident" id="5517051">Opaque</span><span class="op" id="5517057">(</span><span class="op" id="5517058">)</span>&nbsp;<span class="builtintype" id="5517060">bool</span>&nbsp;<span class="op" id="5517065">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517068">var</span>&nbsp;<span class="ident" id="5517072">present</span>&nbsp;<span class="op" id="5517080">[</span><span class="num" id="5517081">256</span><span class="op" id="5517084">]</span><span class="builtintype" id="5517085">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517091">i0</span><span class="op" id="5517093">,</span>&nbsp;<span class="ident" id="5517095">i1</span>&nbsp;<span class="op" id="5517098">:=</span>&nbsp;<span class="num" id="5517101">0</span><span class="op" id="5517102">,</span>&nbsp;<span class="ident" id="5517104">p</span><span class="op" id="5517105">.</span><span class="ident" id="5517106">Rect</span><span class="op" id="5517110">.</span><span class="ident" id="5517111">Dx</span><span class="op" id="5517113">(</span><span class="op" id="5517114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517117">for</span>&nbsp;<span class="ident" id="5517121">y</span>&nbsp;<span class="op" id="5517123">:=</span>&nbsp;<span class="ident" id="5517126">p</span><span class="op" id="5517127">.</span><span class="ident" id="5517128">Rect</span><span class="op" id="5517132">.</span><span class="ident" id="5517133">Min</span><span class="op" id="5517136">.</span><span class="ident" id="5517137">Y</span><span class="op" id="5517138">;</span>&nbsp;<span class="ident" id="5517140">y</span>&nbsp;<span class="op" id="5517142">&lt;</span>&nbsp;<span class="ident" id="5517144">p</span><span class="op" id="5517145">.</span><span class="ident" id="5517146">Rect</span><span class="op" id="5517150">.</span><span class="ident" id="5517151">Max</span><span class="op" id="5517154">.</span><span class="ident" id="5517155">Y</span><span class="op" id="5517156">;</span>&nbsp;<span class="ident" id="5517158">y</span><span class="op" id="5517159">++</span>&nbsp;<span class="op" id="5517162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517166">for</span>&nbsp;<span class="ident" id="5517170">_</span><span class="op" id="5517171">,</span>&nbsp;<span class="ident" id="5517173">c</span>&nbsp;<span class="op" id="5517175">:=</span>&nbsp;<span class="keyword" id="5517178">range</span>&nbsp;<span class="ident" id="5517184">p</span><span class="op" id="5517185">.</span><span class="ident" id="5517186">Pix</span><span class="op" id="5517189">[</span><span class="ident" id="5517190">i0</span><span class="op" id="5517192">:</span><span class="ident" id="5517193">i1</span><span class="op" id="5517195">]</span>&nbsp;<span class="op" id="5517197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517202">present</span><span class="op" id="5517209">[</span><span class="ident" id="5517210">c</span><span class="op" id="5517211">]</span>&nbsp;<span class="op" id="5517213">=</span>&nbsp;<span class="builtintype" id="5517215">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517226">i0</span>&nbsp;<span class="op" id="5517229">+=</span>&nbsp;<span class="ident" id="5517232">p</span><span class="op" id="5517233">.</span><span class="ident" id="5517234">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517243">i1</span>&nbsp;<span class="op" id="5517246">+=</span>&nbsp;<span class="ident" id="5517249">p</span><span class="op" id="5517250">.</span><span class="ident" id="5517251">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517262">for</span>&nbsp;<span class="ident" id="5517266">i</span><span class="op" id="5517267">,</span>&nbsp;<span class="ident" id="5517269">c</span>&nbsp;<span class="op" id="5517271">:=</span>&nbsp;<span class="keyword" id="5517274">range</span>&nbsp;<span class="ident" id="5517280">p</span><span class="op" id="5517281">.</span><span class="ident" id="5517282">Palette</span>&nbsp;<span class="op" id="5517290">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517294">if</span>&nbsp;<span class="op" id="5517297">!</span><span class="ident" id="5517298">present</span><span class="op" id="5517305">[</span><span class="ident" id="5517306">i</span><span class="op" id="5517307">]</span>&nbsp;<span class="op" id="5517309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517314">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517329">_</span><span class="op" id="5517330">,</span>&nbsp;<span class="ident" id="5517332">_</span><span class="op" id="5517333">,</span>&nbsp;<span class="ident" id="5517335">_</span><span class="op" id="5517336">,</span>&nbsp;<span class="ident" id="5517338">a</span>&nbsp;<span class="op" id="5517340">:=</span>&nbsp;<span class="ident" id="5517343">c</span><span class="op" id="5517344">.</span><span class="ident" id="5517345">RGBA</span><span class="op" id="5517349">(</span><span class="op" id="5517350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517354">if</span>&nbsp;<span class="ident" id="5517357">a</span>&nbsp;<span class="op" id="5517359">!=</span>&nbsp;<span class="num" id="5517362">0xffff</span>&nbsp;<span class="op" id="5517369">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517374">return</span>&nbsp;<span class="builtintype" id="5517381">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517395">return</span>&nbsp;<span class="builtintype" id="5517402">true</span><br>
<span class="lineno"></span><span class="op" id="5517407">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5517410">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5517490">func</span>&nbsp;<span class="ident" id="5517495">NewPaletted</span><span class="op" id="5517506">(</span><span class="ident" id="5517507">r</span>&nbsp;<span class="ident" id="5517509">Rectangle</span><span class="op" id="5517518">,</span>&nbsp;<span class="ident" id="5517520">p</span>&nbsp;<span class="ident" id="5517522">color</span><span class="op" id="5517527">.</span><span class="ident" id="5517528">Palette</span><span class="op" id="5517535">)</span>&nbsp;<span class="op" id="5517537">*</span><span class="ident" id="5517538">Paletted</span>&nbsp;<span class="op" id="5517547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517550">w</span><span class="op" id="5517551">,</span>&nbsp;<span class="ident" id="5517553">h</span>&nbsp;<span class="op" id="5517555">:=</span>&nbsp;<span class="ident" id="5517558">r</span><span class="op" id="5517559">.</span><span class="ident" id="5517560">Dx</span><span class="op" id="5517562">(</span><span class="op" id="5517563">)</span><span class="op" id="5517564">,</span>&nbsp;<span class="ident" id="5517566">r</span><span class="op" id="5517567">.</span><span class="ident" id="5517568">Dy</span><span class="op" id="5517570">(</span><span class="op" id="5517571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517574">pix</span>&nbsp;<span class="op" id="5517578">:=</span>&nbsp;<span class="builtinfunc" id="5517581">make</span><span class="op" id="5517585">(</span><span class="op" id="5517586">[</span><span class="op" id="5517587">]</span><span class="builtintype" id="5517588">uint8</span><span class="op" id="5517593">,</span>&nbsp;<span class="num" id="5517595">1</span><span class="op" id="5517596">*</span><span class="ident" id="5517597">w</span><span class="op" id="5517598">*</span><span class="ident" id="5517599">h</span><span class="op" id="5517600">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517603">return</span>&nbsp;<span class="op" id="5517610">&amp;</span><span class="ident" id="5517611">Paletted</span><span class="op" id="5517619">{</span><span class="ident" id="5517620">pix</span><span class="op" id="5517623">,</span>&nbsp;<span class="num" id="5517625">1</span>&nbsp;<span class="op" id="5517627">*</span>&nbsp;<span class="ident" id="5517629">w</span><span class="op" id="5517630">,</span>&nbsp;<span class="ident" id="5517632">r</span><span class="op" id="5517633">,</span>&nbsp;<span class="ident" id="5517635">p</span><span class="op" id="5517636">}</span><br>
<span class="lineno"></span><span class="op" id="5517638">}</span>
</div>
</body>
</html>
