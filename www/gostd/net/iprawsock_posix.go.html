<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3046423">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3046479">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3046533">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3046584">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3046662">package</span>&nbsp;<span class="ident" id="3046670">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3046675">import</span>&nbsp;<span class="op" id="3046682">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3046685">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3046696">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3046703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3046706">//&nbsp;BUG(mikio):&nbsp;On&nbsp;every&nbsp;POSIX&nbsp;platform,&nbsp;reads&nbsp;from&nbsp;the&nbsp;&#34;ip4&#34;&nbsp;network</span><br>
<span class="lineno">15</span><span class="comment" id="3046775">//&nbsp;using&nbsp;the&nbsp;ReadFrom&nbsp;or&nbsp;ReadFromIP&nbsp;method&nbsp;might&nbsp;not&nbsp;return&nbsp;a&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="3046846">//&nbsp;IPv4&nbsp;packet,&nbsp;including&nbsp;its&nbsp;header,&nbsp;even&nbsp;if&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3046907">//&nbsp;available.&nbsp;This&nbsp;can&nbsp;occur&nbsp;even&nbsp;in&nbsp;cases&nbsp;where&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3046974">//&nbsp;could&nbsp;return&nbsp;a&nbsp;complete&nbsp;packet.&nbsp;For&nbsp;this&nbsp;reason,&nbsp;it&nbsp;is&nbsp;recommended</span><br>
<span class="lineno"></span><span class="comment" id="3047044">//&nbsp;that&nbsp;you&nbsp;do&nbsp;not&nbsp;uses&nbsp;these&nbsp;methods&nbsp;if&nbsp;it&nbsp;is&nbsp;important&nbsp;to&nbsp;receive&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3047114">//&nbsp;full&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3047130">//</span><br>
<span class="lineno"></span><span class="comment" id="3047133">//&nbsp;The&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines&nbsp;make&nbsp;it&nbsp;impossible&nbsp;for&nbsp;us&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3047199">//&nbsp;change&nbsp;the&nbsp;behavior&nbsp;of&nbsp;these&nbsp;methods;&nbsp;use&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3047262">//&nbsp;instead.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3047275">func</span>&nbsp;<span class="ident" id="3047280">sockaddrToIP</span><span class="op" id="3047292">(</span><span class="ident" id="3047293">sa</span>&nbsp;<span class="ident" id="3047296">syscall</span><span class="op" id="3047303">.</span><span class="ident" id="3047304">Sockaddr</span><span class="op" id="3047312">)</span>&nbsp;<span class="ident" id="3047314">Addr</span>&nbsp;<span class="op" id="3047319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047322">switch</span>&nbsp;<span class="ident" id="3047329">sa</span>&nbsp;<span class="op" id="3047332">:=</span>&nbsp;<span class="ident" id="3047335">sa</span><span class="op" id="3047337">.</span><span class="op" id="3047338">(</span><span class="keyword" id="3047339">type</span><span class="op" id="3047343">)</span>&nbsp;<span class="op" id="3047345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047348">case</span>&nbsp;<span class="op" id="3047353">*</span><span class="ident" id="3047354">syscall</span><span class="op" id="3047361">.</span><span class="ident" id="3047362">SockaddrInet4</span><span class="op" id="3047375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047379">return</span>&nbsp;<span class="op" id="3047386">&amp;</span><span class="ident" id="3047387">IPAddr</span><span class="op" id="3047393">{</span><span class="ident" id="3047394">IP</span><span class="op" id="3047396">:</span>&nbsp;<span class="ident" id="3047398">sa</span><span class="op" id="3047400">.</span><span class="ident" id="3047401">Addr</span><span class="op" id="3047405">[</span><span class="num" id="3047406">0</span><span class="op" id="3047407">:</span><span class="op" id="3047408">]</span><span class="op" id="3047409">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047412">case</span>&nbsp;<span class="op" id="3047417">*</span><span class="ident" id="3047418">syscall</span><span class="op" id="3047425">.</span><span class="ident" id="3047426">SockaddrInet6</span><span class="op" id="3047439">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047443">return</span>&nbsp;<span class="op" id="3047450">&amp;</span><span class="ident" id="3047451">IPAddr</span><span class="op" id="3047457">{</span><span class="ident" id="3047458">IP</span><span class="op" id="3047460">:</span>&nbsp;<span class="ident" id="3047462">sa</span><span class="op" id="3047464">.</span><span class="ident" id="3047465">Addr</span><span class="op" id="3047469">[</span><span class="num" id="3047470">0</span><span class="op" id="3047471">:</span><span class="op" id="3047472">]</span><span class="op" id="3047473">,</span>&nbsp;<span class="ident" id="3047475">Zone</span><span class="op" id="3047479">:</span>&nbsp;<span class="ident" id="3047481">zoneToString</span><span class="op" id="3047493">(</span><span class="builtintype" id="3047494">int</span><span class="op" id="3047497">(</span><span class="ident" id="3047498">sa</span><span class="op" id="3047500">.</span><span class="ident" id="3047501">ZoneId</span><span class="op" id="3047507">)</span><span class="op" id="3047508">)</span><span class="op" id="3047509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047515">return</span>&nbsp;<span class="ident" id="3047522">nil</span><br>
<span class="lineno"></span><span class="op" id="3047526">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3047529">func</span>&nbsp;<span class="op" id="3047534">(</span><span class="ident" id="3047535">a</span>&nbsp;<span class="op" id="3047537">*</span><span class="ident" id="3047538">IPAddr</span><span class="op" id="3047544">)</span>&nbsp;<span class="ident" id="3047546">family</span><span class="op" id="3047552">(</span><span class="op" id="3047553">)</span>&nbsp;<span class="builtintype" id="3047555">int</span>&nbsp;<span class="op" id="3047559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047562">if</span>&nbsp;<span class="ident" id="3047565">a</span>&nbsp;<span class="op" id="3047567">==</span>&nbsp;<span class="ident" id="3047570">nil</span>&nbsp;<span class="op" id="3047574">||</span>&nbsp;<span class="builtinfunc" id="3047577">len</span><span class="op" id="3047580">(</span><span class="ident" id="3047581">a</span><span class="op" id="3047582">.</span><span class="ident" id="3047583">IP</span><span class="op" id="3047585">)</span>&nbsp;<span class="op" id="3047587">&lt;=</span>&nbsp;<span class="ident" id="3047590">IPv4len</span>&nbsp;<span class="op" id="3047598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047602">return</span>&nbsp;<span class="ident" id="3047609">syscall</span><span class="op" id="3047616">.</span><span class="ident" id="3047617">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047626">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047629">if</span>&nbsp;<span class="ident" id="3047632">a</span><span class="op" id="3047633">.</span><span class="ident" id="3047634">IP</span><span class="op" id="3047636">.</span><span class="ident" id="3047637">To4</span><span class="op" id="3047640">(</span><span class="op" id="3047641">)</span>&nbsp;<span class="op" id="3047643">!=</span>&nbsp;<span class="ident" id="3047646">nil</span>&nbsp;<span class="op" id="3047650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047654">return</span>&nbsp;<span class="ident" id="3047661">syscall</span><span class="op" id="3047668">.</span><span class="ident" id="3047669">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047681">return</span>&nbsp;<span class="ident" id="3047688">syscall</span><span class="op" id="3047695">.</span><span class="ident" id="3047696">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3047705">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3047708">func</span>&nbsp;<span class="op" id="3047713">(</span><span class="ident" id="3047714">a</span>&nbsp;<span class="op" id="3047716">*</span><span class="ident" id="3047717">IPAddr</span><span class="op" id="3047723">)</span>&nbsp;<span class="ident" id="3047725">isWildcard</span><span class="op" id="3047735">(</span><span class="op" id="3047736">)</span>&nbsp;<span class="builtintype" id="3047738">bool</span>&nbsp;<span class="op" id="3047743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047746">if</span>&nbsp;<span class="ident" id="3047749">a</span>&nbsp;<span class="op" id="3047751">==</span>&nbsp;<span class="ident" id="3047754">nil</span>&nbsp;<span class="op" id="3047758">||</span>&nbsp;<span class="ident" id="3047761">a</span><span class="op" id="3047762">.</span><span class="ident" id="3047763">IP</span>&nbsp;<span class="op" id="3047766">==</span>&nbsp;<span class="ident" id="3047769">nil</span>&nbsp;<span class="op" id="3047773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047777">return</span>&nbsp;<span class="builtintype" id="3047784">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047790">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047793">return</span>&nbsp;<span class="ident" id="3047800">a</span><span class="op" id="3047801">.</span><span class="ident" id="3047802">IP</span><span class="op" id="3047804">.</span><span class="ident" id="3047805">IsUnspecified</span><span class="op" id="3047818">(</span><span class="op" id="3047819">)</span><br>
<span class="lineno"></span><span class="op" id="3047821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3047824">func</span>&nbsp;<span class="op" id="3047829">(</span><span class="ident" id="3047830">a</span>&nbsp;<span class="op" id="3047832">*</span><span class="ident" id="3047833">IPAddr</span><span class="op" id="3047839">)</span>&nbsp;<span class="ident" id="3047841">sockaddr</span><span class="op" id="3047849">(</span><span class="ident" id="3047850">family</span>&nbsp;<span class="builtintype" id="3047857">int</span><span class="op" id="3047860">)</span>&nbsp;<span class="op" id="3047862">(</span><span class="ident" id="3047863">syscall</span><span class="op" id="3047870">.</span><span class="ident" id="3047871">Sockaddr</span><span class="op" id="3047879">,</span>&nbsp;<span class="builtintype" id="3047881">error</span><span class="op" id="3047886">)</span>&nbsp;<span class="op" id="3047888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047891">if</span>&nbsp;<span class="ident" id="3047894">a</span>&nbsp;<span class="op" id="3047896">==</span>&nbsp;<span class="ident" id="3047899">nil</span>&nbsp;<span class="op" id="3047903">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047907">return</span>&nbsp;<span class="ident" id="3047914">nil</span><span class="op" id="3047917">,</span>&nbsp;<span class="ident" id="3047919">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047927">return</span>&nbsp;<span class="ident" id="3047934">ipToSockaddr</span><span class="op" id="3047946">(</span><span class="ident" id="3047947">family</span><span class="op" id="3047953">,</span>&nbsp;<span class="ident" id="3047955">a</span><span class="op" id="3047956">.</span><span class="ident" id="3047957">IP</span><span class="op" id="3047959">,</span>&nbsp;<span class="num" id="3047961">0</span><span class="op" id="3047962">,</span>&nbsp;<span class="ident" id="3047964">a</span><span class="op" id="3047965">.</span><span class="ident" id="3047966">Zone</span><span class="op" id="3047970">)</span><br>
<span class="lineno"></span><span class="op" id="3047972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3047975">//&nbsp;IPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3048045">//&nbsp;for&nbsp;IP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="3048076">type</span>&nbsp;<span class="ident" id="3048081">IPConn</span>&nbsp;<span class="keyword" id="3048088">struct</span>&nbsp;<span class="op" id="3048095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048098">conn</span><br>
<span class="lineno"></span><span class="op" id="3048103">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3048106">func</span>&nbsp;<span class="ident" id="3048111">newIPConn</span><span class="op" id="3048120">(</span><span class="ident" id="3048121">fd</span>&nbsp;<span class="op" id="3048124">*</span><span class="ident" id="3048125">netFD</span><span class="op" id="3048130">)</span>&nbsp;<span class="op" id="3048132">*</span><span class="ident" id="3048133">IPConn</span>&nbsp;<span class="op" id="3048140">{</span>&nbsp;<span class="keyword" id="3048142">return</span>&nbsp;<span class="op" id="3048149">&amp;</span><span class="ident" id="3048150">IPConn</span><span class="op" id="3048156">{</span><span class="ident" id="3048157">conn</span><span class="op" id="3048161">{</span><span class="ident" id="3048162">fd</span><span class="op" id="3048164">}</span><span class="op" id="3048165">}</span>&nbsp;<span class="op" id="3048167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3048170">//&nbsp;ReadFromIP&nbsp;reads&nbsp;an&nbsp;IP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3048239">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno">70</span><span class="comment" id="3048310">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3048337">//</span><br>
<span class="lineno"></span><span class="comment" id="3048340">//&nbsp;ReadFromIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3048403">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3048470">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno">75</span><span class="keyword" id="3048490">func</span>&nbsp;<span class="op" id="3048495">(</span><span class="ident" id="3048496">c</span>&nbsp;<span class="op" id="3048498">*</span><span class="ident" id="3048499">IPConn</span><span class="op" id="3048505">)</span>&nbsp;<span class="ident" id="3048507">ReadFromIP</span><span class="op" id="3048517">(</span><span class="ident" id="3048518">b</span>&nbsp;<span class="op" id="3048520">[</span><span class="op" id="3048521">]</span><span class="builtintype" id="3048522">byte</span><span class="op" id="3048526">)</span>&nbsp;<span class="op" id="3048528">(</span><span class="builtintype" id="3048529">int</span><span class="op" id="3048532">,</span>&nbsp;<span class="op" id="3048534">*</span><span class="ident" id="3048535">IPAddr</span><span class="op" id="3048541">,</span>&nbsp;<span class="builtintype" id="3048543">error</span><span class="op" id="3048548">)</span>&nbsp;<span class="op" id="3048550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048553">if</span>&nbsp;<span class="op" id="3048556">!</span><span class="ident" id="3048557">c</span><span class="op" id="3048558">.</span><span class="ident" id="3048559">ok</span><span class="op" id="3048561">(</span><span class="op" id="3048562">)</span>&nbsp;<span class="op" id="3048564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048568">return</span>&nbsp;<span class="num" id="3048575">0</span><span class="op" id="3048576">,</span>&nbsp;<span class="ident" id="3048578">nil</span><span class="op" id="3048581">,</span>&nbsp;<span class="ident" id="3048583">syscall</span><span class="op" id="3048590">.</span><span class="ident" id="3048591">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048602">//&nbsp;TODO(cw,rsc):&nbsp;consider&nbsp;using&nbsp;readv&nbsp;if&nbsp;we&nbsp;know&nbsp;the&nbsp;family</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048663">//&nbsp;type&nbsp;to&nbsp;avoid&nbsp;the&nbsp;header&nbsp;trim/copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048702">var</span>&nbsp;<span class="ident" id="3048706">addr</span>&nbsp;<span class="op" id="3048711">*</span><span class="ident" id="3048712">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048720">n</span><span class="op" id="3048721">,</span>&nbsp;<span class="ident" id="3048723">sa</span><span class="op" id="3048725">,</span>&nbsp;<span class="ident" id="3048727">err</span>&nbsp;<span class="op" id="3048731">:=</span>&nbsp;<span class="ident" id="3048734">c</span><span class="op" id="3048735">.</span><span class="ident" id="3048736">fd</span><span class="op" id="3048738">.</span><span class="ident" id="3048739">readFrom</span><span class="op" id="3048747">(</span><span class="ident" id="3048748">b</span><span class="op" id="3048749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048752">switch</span>&nbsp;<span class="ident" id="3048759">sa</span>&nbsp;<span class="op" id="3048762">:=</span>&nbsp;<span class="ident" id="3048765">sa</span><span class="op" id="3048767">.</span><span class="op" id="3048768">(</span><span class="keyword" id="3048769">type</span><span class="op" id="3048773">)</span>&nbsp;<span class="op" id="3048775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048778">case</span>&nbsp;<span class="op" id="3048783">*</span><span class="ident" id="3048784">syscall</span><span class="op" id="3048791">.</span><span class="ident" id="3048792">SockaddrInet4</span><span class="op" id="3048805">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048809">addr</span>&nbsp;<span class="op" id="3048814">=</span>&nbsp;<span class="op" id="3048816">&amp;</span><span class="ident" id="3048817">IPAddr</span><span class="op" id="3048823">{</span><span class="ident" id="3048824">IP</span><span class="op" id="3048826">:</span>&nbsp;<span class="ident" id="3048828">sa</span><span class="op" id="3048830">.</span><span class="ident" id="3048831">Addr</span><span class="op" id="3048835">[</span><span class="num" id="3048836">0</span><span class="op" id="3048837">:</span><span class="op" id="3048838">]</span><span class="op" id="3048839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048843">if</span>&nbsp;<span class="builtinfunc" id="3048846">len</span><span class="op" id="3048849">(</span><span class="ident" id="3048850">b</span><span class="op" id="3048851">)</span>&nbsp;<span class="op" id="3048853">&gt;=</span>&nbsp;<span class="ident" id="3048856">IPv4len</span>&nbsp;<span class="op" id="3048864">{</span>&nbsp;<span class="comment" id="3048866">//&nbsp;discard&nbsp;ipv4&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048892">hsize</span>&nbsp;<span class="op" id="3048898">:=</span>&nbsp;<span class="op" id="3048901">(</span><span class="builtintype" id="3048902">int</span><span class="op" id="3048905">(</span><span class="ident" id="3048906">b</span><span class="op" id="3048907">[</span><span class="num" id="3048908">0</span><span class="op" id="3048909">]</span><span class="op" id="3048910">)</span>&nbsp;<span class="op" id="3048912">&amp;</span>&nbsp;<span class="num" id="3048914">0xf</span><span class="op" id="3048917">)</span>&nbsp;<span class="op" id="3048919">*</span>&nbsp;<span class="num" id="3048921">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3048926">copy</span><span class="op" id="3048930">(</span><span class="ident" id="3048931">b</span><span class="op" id="3048932">,</span>&nbsp;<span class="ident" id="3048934">b</span><span class="op" id="3048935">[</span><span class="ident" id="3048936">hsize</span><span class="op" id="3048941">:</span><span class="op" id="3048942">]</span><span class="op" id="3048943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048948">n</span>&nbsp;<span class="op" id="3048950">-=</span>&nbsp;<span class="ident" id="3048953">hsize</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048964">case</span>&nbsp;<span class="op" id="3048969">*</span><span class="ident" id="3048970">syscall</span><span class="op" id="3048977">.</span><span class="ident" id="3048978">SockaddrInet6</span><span class="op" id="3048991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048995">addr</span>&nbsp;<span class="op" id="3049000">=</span>&nbsp;<span class="op" id="3049002">&amp;</span><span class="ident" id="3049003">IPAddr</span><span class="op" id="3049009">{</span><span class="ident" id="3049010">IP</span><span class="op" id="3049012">:</span>&nbsp;<span class="ident" id="3049014">sa</span><span class="op" id="3049016">.</span><span class="ident" id="3049017">Addr</span><span class="op" id="3049021">[</span><span class="num" id="3049022">0</span><span class="op" id="3049023">:</span><span class="op" id="3049024">]</span><span class="op" id="3049025">,</span>&nbsp;<span class="ident" id="3049027">Zone</span><span class="op" id="3049031">:</span>&nbsp;<span class="ident" id="3049033">zoneToString</span><span class="op" id="3049045">(</span><span class="builtintype" id="3049046">int</span><span class="op" id="3049049">(</span><span class="ident" id="3049050">sa</span><span class="op" id="3049052">.</span><span class="ident" id="3049053">ZoneId</span><span class="op" id="3049059">)</span><span class="op" id="3049060">)</span><span class="op" id="3049061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049067">return</span>&nbsp;<span class="ident" id="3049074">n</span><span class="op" id="3049075">,</span>&nbsp;<span class="ident" id="3049077">addr</span><span class="op" id="3049081">,</span>&nbsp;<span class="ident" id="3049083">err</span><br>
<span class="lineno">95</span><span class="op" id="3049087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3049090">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3049145">func</span>&nbsp;<span class="op" id="3049150">(</span><span class="ident" id="3049151">c</span>&nbsp;<span class="op" id="3049153">*</span><span class="ident" id="3049154">IPConn</span><span class="op" id="3049160">)</span>&nbsp;<span class="ident" id="3049162">ReadFrom</span><span class="op" id="3049170">(</span><span class="ident" id="3049171">b</span>&nbsp;<span class="op" id="3049173">[</span><span class="op" id="3049174">]</span><span class="builtintype" id="3049175">byte</span><span class="op" id="3049179">)</span>&nbsp;<span class="op" id="3049181">(</span><span class="builtintype" id="3049182">int</span><span class="op" id="3049185">,</span>&nbsp;<span class="ident" id="3049187">Addr</span><span class="op" id="3049191">,</span>&nbsp;<span class="builtintype" id="3049193">error</span><span class="op" id="3049198">)</span>&nbsp;<span class="op" id="3049200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049203">if</span>&nbsp;<span class="op" id="3049206">!</span><span class="ident" id="3049207">c</span><span class="op" id="3049208">.</span><span class="ident" id="3049209">ok</span><span class="op" id="3049211">(</span><span class="op" id="3049212">)</span>&nbsp;<span class="op" id="3049214">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049218">return</span>&nbsp;<span class="num" id="3049225">0</span><span class="op" id="3049226">,</span>&nbsp;<span class="ident" id="3049228">nil</span><span class="op" id="3049231">,</span>&nbsp;<span class="ident" id="3049233">syscall</span><span class="op" id="3049240">.</span><span class="ident" id="3049241">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049252">n</span><span class="op" id="3049253">,</span>&nbsp;<span class="ident" id="3049255">addr</span><span class="op" id="3049259">,</span>&nbsp;<span class="ident" id="3049261">err</span>&nbsp;<span class="op" id="3049265">:=</span>&nbsp;<span class="ident" id="3049268">c</span><span class="op" id="3049269">.</span><span class="ident" id="3049270">ReadFromIP</span><span class="op" id="3049280">(</span><span class="ident" id="3049281">b</span><span class="op" id="3049282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049285">return</span>&nbsp;<span class="ident" id="3049292">n</span><span class="op" id="3049293">,</span>&nbsp;<span class="ident" id="3049295">addr</span><span class="op" id="3049299">.</span><span class="ident" id="3049300">toAddr</span><span class="op" id="3049306">(</span><span class="op" id="3049307">)</span><span class="op" id="3049308">,</span>&nbsp;<span class="ident" id="3049310">err</span><br>
<span class="lineno"></span><span class="op" id="3049314">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3049317">//&nbsp;ReadMsgIP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3049388">//&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3049455">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3049526">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno">110</span><span class="keyword" id="3049595">func</span>&nbsp;<span class="op" id="3049600">(</span><span class="ident" id="3049601">c</span>&nbsp;<span class="op" id="3049603">*</span><span class="ident" id="3049604">IPConn</span><span class="op" id="3049610">)</span>&nbsp;<span class="ident" id="3049612">ReadMsgIP</span><span class="op" id="3049621">(</span><span class="ident" id="3049622">b</span><span class="op" id="3049623">,</span>&nbsp;<span class="ident" id="3049625">oob</span>&nbsp;<span class="op" id="3049629">[</span><span class="op" id="3049630">]</span><span class="builtintype" id="3049631">byte</span><span class="op" id="3049635">)</span>&nbsp;<span class="op" id="3049637">(</span><span class="ident" id="3049638">n</span><span class="op" id="3049639">,</span>&nbsp;<span class="ident" id="3049641">oobn</span><span class="op" id="3049645">,</span>&nbsp;<span class="ident" id="3049647">flags</span>&nbsp;<span class="builtintype" id="3049653">int</span><span class="op" id="3049656">,</span>&nbsp;<span class="ident" id="3049658">addr</span>&nbsp;<span class="op" id="3049663">*</span><span class="ident" id="3049664">IPAddr</span><span class="op" id="3049670">,</span>&nbsp;<span class="ident" id="3049672">err</span>&nbsp;<span class="builtintype" id="3049676">error</span><span class="op" id="3049681">)</span>&nbsp;<span class="op" id="3049683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049686">if</span>&nbsp;<span class="op" id="3049689">!</span><span class="ident" id="3049690">c</span><span class="op" id="3049691">.</span><span class="ident" id="3049692">ok</span><span class="op" id="3049694">(</span><span class="op" id="3049695">)</span>&nbsp;<span class="op" id="3049697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049701">return</span>&nbsp;<span class="num" id="3049708">0</span><span class="op" id="3049709">,</span>&nbsp;<span class="num" id="3049711">0</span><span class="op" id="3049712">,</span>&nbsp;<span class="num" id="3049714">0</span><span class="op" id="3049715">,</span>&nbsp;<span class="ident" id="3049717">nil</span><span class="op" id="3049720">,</span>&nbsp;<span class="ident" id="3049722">syscall</span><span class="op" id="3049729">.</span><span class="ident" id="3049730">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049741">var</span>&nbsp;<span class="ident" id="3049745">sa</span>&nbsp;<span class="ident" id="3049748">syscall</span><span class="op" id="3049755">.</span><span class="ident" id="3049756">Sockaddr</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049766">n</span><span class="op" id="3049767">,</span>&nbsp;<span class="ident" id="3049769">oobn</span><span class="op" id="3049773">,</span>&nbsp;<span class="ident" id="3049775">flags</span><span class="op" id="3049780">,</span>&nbsp;<span class="ident" id="3049782">sa</span><span class="op" id="3049784">,</span>&nbsp;<span class="ident" id="3049786">err</span>&nbsp;<span class="op" id="3049790">=</span>&nbsp;<span class="ident" id="3049792">c</span><span class="op" id="3049793">.</span><span class="ident" id="3049794">fd</span><span class="op" id="3049796">.</span><span class="ident" id="3049797">readMsg</span><span class="op" id="3049804">(</span><span class="ident" id="3049805">b</span><span class="op" id="3049806">,</span>&nbsp;<span class="ident" id="3049808">oob</span><span class="op" id="3049811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049814">switch</span>&nbsp;<span class="ident" id="3049821">sa</span>&nbsp;<span class="op" id="3049824">:=</span>&nbsp;<span class="ident" id="3049827">sa</span><span class="op" id="3049829">.</span><span class="op" id="3049830">(</span><span class="keyword" id="3049831">type</span><span class="op" id="3049835">)</span>&nbsp;<span class="op" id="3049837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049840">case</span>&nbsp;<span class="op" id="3049845">*</span><span class="ident" id="3049846">syscall</span><span class="op" id="3049853">.</span><span class="ident" id="3049854">SockaddrInet4</span><span class="op" id="3049867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049871">addr</span>&nbsp;<span class="op" id="3049876">=</span>&nbsp;<span class="op" id="3049878">&amp;</span><span class="ident" id="3049879">IPAddr</span><span class="op" id="3049885">{</span><span class="ident" id="3049886">IP</span><span class="op" id="3049888">:</span>&nbsp;<span class="ident" id="3049890">sa</span><span class="op" id="3049892">.</span><span class="ident" id="3049893">Addr</span><span class="op" id="3049897">[</span><span class="num" id="3049898">0</span><span class="op" id="3049899">:</span><span class="op" id="3049900">]</span><span class="op" id="3049901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049904">case</span>&nbsp;<span class="op" id="3049909">*</span><span class="ident" id="3049910">syscall</span><span class="op" id="3049917">.</span><span class="ident" id="3049918">SockaddrInet6</span><span class="op" id="3049931">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049935">addr</span>&nbsp;<span class="op" id="3049940">=</span>&nbsp;<span class="op" id="3049942">&amp;</span><span class="ident" id="3049943">IPAddr</span><span class="op" id="3049949">{</span><span class="ident" id="3049950">IP</span><span class="op" id="3049952">:</span>&nbsp;<span class="ident" id="3049954">sa</span><span class="op" id="3049956">.</span><span class="ident" id="3049957">Addr</span><span class="op" id="3049961">[</span><span class="num" id="3049962">0</span><span class="op" id="3049963">:</span><span class="op" id="3049964">]</span><span class="op" id="3049965">,</span>&nbsp;<span class="ident" id="3049967">Zone</span><span class="op" id="3049971">:</span>&nbsp;<span class="ident" id="3049973">zoneToString</span><span class="op" id="3049985">(</span><span class="builtintype" id="3049986">int</span><span class="op" id="3049989">(</span><span class="ident" id="3049990">sa</span><span class="op" id="3049992">.</span><span class="ident" id="3049993">ZoneId</span><span class="op" id="3049999">)</span><span class="op" id="3050000">)</span><span class="op" id="3050001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050007">return</span><br>
<span class="lineno"></span><span class="op" id="3050014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3050017">//&nbsp;WriteToIP&nbsp;writes&nbsp;an&nbsp;IP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3050085">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3050096">//</span><br>
<span class="lineno"></span><span class="comment" id="3050099">//&nbsp;WriteToIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3050161">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">130</span><span class="comment" id="3050228">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3050297">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3050310">func</span>&nbsp;<span class="op" id="3050315">(</span><span class="ident" id="3050316">c</span>&nbsp;<span class="op" id="3050318">*</span><span class="ident" id="3050319">IPConn</span><span class="op" id="3050325">)</span>&nbsp;<span class="ident" id="3050327">WriteToIP</span><span class="op" id="3050336">(</span><span class="ident" id="3050337">b</span>&nbsp;<span class="op" id="3050339">[</span><span class="op" id="3050340">]</span><span class="builtintype" id="3050341">byte</span><span class="op" id="3050345">,</span>&nbsp;<span class="ident" id="3050347">addr</span>&nbsp;<span class="op" id="3050352">*</span><span class="ident" id="3050353">IPAddr</span><span class="op" id="3050359">)</span>&nbsp;<span class="op" id="3050361">(</span><span class="builtintype" id="3050362">int</span><span class="op" id="3050365">,</span>&nbsp;<span class="builtintype" id="3050367">error</span><span class="op" id="3050372">)</span>&nbsp;<span class="op" id="3050374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050377">if</span>&nbsp;<span class="op" id="3050380">!</span><span class="ident" id="3050381">c</span><span class="op" id="3050382">.</span><span class="ident" id="3050383">ok</span><span class="op" id="3050385">(</span><span class="op" id="3050386">)</span>&nbsp;<span class="op" id="3050388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050392">return</span>&nbsp;<span class="num" id="3050399">0</span><span class="op" id="3050400">,</span>&nbsp;<span class="ident" id="3050402">syscall</span><span class="op" id="3050409">.</span><span class="ident" id="3050410">EINVAL</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050421">if</span>&nbsp;<span class="ident" id="3050424">c</span><span class="op" id="3050425">.</span><span class="ident" id="3050426">fd</span><span class="op" id="3050428">.</span><span class="ident" id="3050429">isConnected</span>&nbsp;<span class="op" id="3050441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050445">return</span>&nbsp;<span class="num" id="3050452">0</span><span class="op" id="3050453">,</span>&nbsp;<span class="op" id="3050455">&amp;</span><span class="ident" id="3050456">OpError</span><span class="op" id="3050463">{</span><span class="ident" id="3050464">Op</span><span class="op" id="3050466">:</span>&nbsp;<span class="string" id="3050468">&#34;write&#34;</span><span class="op" id="3050475">,</span>&nbsp;<span class="ident" id="3050477">Net</span><span class="op" id="3050480">:</span>&nbsp;<span class="ident" id="3050482">c</span><span class="op" id="3050483">.</span><span class="ident" id="3050484">fd</span><span class="op" id="3050486">.</span><span class="ident" id="3050487">net</span><span class="op" id="3050490">,</span>&nbsp;<span class="ident" id="3050492">Addr</span><span class="op" id="3050496">:</span>&nbsp;<span class="ident" id="3050498">addr</span><span class="op" id="3050502">,</span>&nbsp;<span class="ident" id="3050504">Err</span><span class="op" id="3050507">:</span>&nbsp;<span class="ident" id="3050509">ErrWriteToConnected</span><span class="op" id="3050528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050534">if</span>&nbsp;<span class="ident" id="3050537">addr</span>&nbsp;<span class="op" id="3050542">==</span>&nbsp;<span class="ident" id="3050545">nil</span>&nbsp;<span class="op" id="3050549">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050553">return</span>&nbsp;<span class="num" id="3050560">0</span><span class="op" id="3050561">,</span>&nbsp;<span class="op" id="3050563">&amp;</span><span class="ident" id="3050564">OpError</span><span class="op" id="3050571">{</span><span class="ident" id="3050572">Op</span><span class="op" id="3050574">:</span>&nbsp;<span class="string" id="3050576">&#34;write&#34;</span><span class="op" id="3050583">,</span>&nbsp;<span class="ident" id="3050585">Net</span><span class="op" id="3050588">:</span>&nbsp;<span class="ident" id="3050590">c</span><span class="op" id="3050591">.</span><span class="ident" id="3050592">fd</span><span class="op" id="3050594">.</span><span class="ident" id="3050595">net</span><span class="op" id="3050598">,</span>&nbsp;<span class="ident" id="3050600">Addr</span><span class="op" id="3050604">:</span>&nbsp;<span class="ident" id="3050606">nil</span><span class="op" id="3050609">,</span>&nbsp;<span class="ident" id="3050611">Err</span><span class="op" id="3050614">:</span>&nbsp;<span class="ident" id="3050616">errMissingAddress</span><span class="op" id="3050633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050639">sa</span><span class="op" id="3050641">,</span>&nbsp;<span class="ident" id="3050643">err</span>&nbsp;<span class="op" id="3050647">:=</span>&nbsp;<span class="ident" id="3050650">addr</span><span class="op" id="3050654">.</span><span class="ident" id="3050655">sockaddr</span><span class="op" id="3050663">(</span><span class="ident" id="3050664">c</span><span class="op" id="3050665">.</span><span class="ident" id="3050666">fd</span><span class="op" id="3050668">.</span><span class="ident" id="3050669">family</span><span class="op" id="3050675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050678">if</span>&nbsp;<span class="ident" id="3050681">err</span>&nbsp;<span class="op" id="3050685">!=</span>&nbsp;<span class="ident" id="3050688">nil</span>&nbsp;<span class="op" id="3050692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050696">return</span>&nbsp;<span class="num" id="3050703">0</span><span class="op" id="3050704">,</span>&nbsp;<span class="op" id="3050706">&amp;</span><span class="ident" id="3050707">OpError</span><span class="op" id="3050714">{</span><span class="string" id="3050715">&#34;write&#34;</span><span class="op" id="3050722">,</span>&nbsp;<span class="ident" id="3050724">c</span><span class="op" id="3050725">.</span><span class="ident" id="3050726">fd</span><span class="op" id="3050728">.</span><span class="ident" id="3050729">net</span><span class="op" id="3050732">,</span>&nbsp;<span class="ident" id="3050734">addr</span><span class="op" id="3050738">,</span>&nbsp;<span class="ident" id="3050740">err</span><span class="op" id="3050743">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050749">return</span>&nbsp;<span class="ident" id="3050756">c</span><span class="op" id="3050757">.</span><span class="ident" id="3050758">fd</span><span class="op" id="3050760">.</span><span class="ident" id="3050761">writeTo</span><span class="op" id="3050768">(</span><span class="ident" id="3050769">b</span><span class="op" id="3050770">,</span>&nbsp;<span class="ident" id="3050772">sa</span><span class="op" id="3050774">)</span><br>
<span class="lineno"></span><span class="op" id="3050776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3050779">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno">150</span><span class="keyword" id="3050832">func</span>&nbsp;<span class="op" id="3050837">(</span><span class="ident" id="3050838">c</span>&nbsp;<span class="op" id="3050840">*</span><span class="ident" id="3050841">IPConn</span><span class="op" id="3050847">)</span>&nbsp;<span class="ident" id="3050849">WriteTo</span><span class="op" id="3050856">(</span><span class="ident" id="3050857">b</span>&nbsp;<span class="op" id="3050859">[</span><span class="op" id="3050860">]</span><span class="builtintype" id="3050861">byte</span><span class="op" id="3050865">,</span>&nbsp;<span class="ident" id="3050867">addr</span>&nbsp;<span class="ident" id="3050872">Addr</span><span class="op" id="3050876">)</span>&nbsp;<span class="op" id="3050878">(</span><span class="builtintype" id="3050879">int</span><span class="op" id="3050882">,</span>&nbsp;<span class="builtintype" id="3050884">error</span><span class="op" id="3050889">)</span>&nbsp;<span class="op" id="3050891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050894">if</span>&nbsp;<span class="op" id="3050897">!</span><span class="ident" id="3050898">c</span><span class="op" id="3050899">.</span><span class="ident" id="3050900">ok</span><span class="op" id="3050902">(</span><span class="op" id="3050903">)</span>&nbsp;<span class="op" id="3050905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050909">return</span>&nbsp;<span class="num" id="3050916">0</span><span class="op" id="3050917">,</span>&nbsp;<span class="ident" id="3050919">syscall</span><span class="op" id="3050926">.</span><span class="ident" id="3050927">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050938">a</span><span class="op" id="3050939">,</span>&nbsp;<span class="ident" id="3050941">ok</span>&nbsp;<span class="op" id="3050944">:=</span>&nbsp;<span class="ident" id="3050947">addr</span><span class="op" id="3050951">.</span><span class="op" id="3050952">(</span><span class="op" id="3050953">*</span><span class="ident" id="3050954">IPAddr</span><span class="op" id="3050960">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050963">if</span>&nbsp;<span class="op" id="3050966">!</span><span class="ident" id="3050967">ok</span>&nbsp;<span class="op" id="3050970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050974">return</span>&nbsp;<span class="num" id="3050981">0</span><span class="op" id="3050982">,</span>&nbsp;<span class="op" id="3050984">&amp;</span><span class="ident" id="3050985">OpError</span><span class="op" id="3050992">{</span><span class="string" id="3050993">&#34;write&#34;</span><span class="op" id="3051000">,</span>&nbsp;<span class="ident" id="3051002">c</span><span class="op" id="3051003">.</span><span class="ident" id="3051004">fd</span><span class="op" id="3051006">.</span><span class="ident" id="3051007">net</span><span class="op" id="3051010">,</span>&nbsp;<span class="ident" id="3051012">addr</span><span class="op" id="3051016">,</span>&nbsp;<span class="ident" id="3051018">syscall</span><span class="op" id="3051025">.</span><span class="ident" id="3051026">EINVAL</span><span class="op" id="3051032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051038">return</span>&nbsp;<span class="ident" id="3051045">c</span><span class="op" id="3051046">.</span><span class="ident" id="3051047">WriteToIP</span><span class="op" id="3051056">(</span><span class="ident" id="3051057">b</span><span class="op" id="3051058">,</span>&nbsp;<span class="ident" id="3051060">a</span><span class="op" id="3051061">)</span><br>
<span class="lineno"></span><span class="op" id="3051063">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3051066">//&nbsp;WriteMsgIP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3051136">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3051203">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="3051255">func</span>&nbsp;<span class="op" id="3051260">(</span><span class="ident" id="3051261">c</span>&nbsp;<span class="op" id="3051263">*</span><span class="ident" id="3051264">IPConn</span><span class="op" id="3051270">)</span>&nbsp;<span class="ident" id="3051272">WriteMsgIP</span><span class="op" id="3051282">(</span><span class="ident" id="3051283">b</span><span class="op" id="3051284">,</span>&nbsp;<span class="ident" id="3051286">oob</span>&nbsp;<span class="op" id="3051290">[</span><span class="op" id="3051291">]</span><span class="builtintype" id="3051292">byte</span><span class="op" id="3051296">,</span>&nbsp;<span class="ident" id="3051298">addr</span>&nbsp;<span class="op" id="3051303">*</span><span class="ident" id="3051304">IPAddr</span><span class="op" id="3051310">)</span>&nbsp;<span class="op" id="3051312">(</span><span class="ident" id="3051313">n</span><span class="op" id="3051314">,</span>&nbsp;<span class="ident" id="3051316">oobn</span>&nbsp;<span class="builtintype" id="3051321">int</span><span class="op" id="3051324">,</span>&nbsp;<span class="ident" id="3051326">err</span>&nbsp;<span class="builtintype" id="3051330">error</span><span class="op" id="3051335">)</span>&nbsp;<span class="op" id="3051337">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051340">if</span>&nbsp;<span class="op" id="3051343">!</span><span class="ident" id="3051344">c</span><span class="op" id="3051345">.</span><span class="ident" id="3051346">ok</span><span class="op" id="3051348">(</span><span class="op" id="3051349">)</span>&nbsp;<span class="op" id="3051351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051355">return</span>&nbsp;<span class="num" id="3051362">0</span><span class="op" id="3051363">,</span>&nbsp;<span class="num" id="3051365">0</span><span class="op" id="3051366">,</span>&nbsp;<span class="ident" id="3051368">syscall</span><span class="op" id="3051375">.</span><span class="ident" id="3051376">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051387">if</span>&nbsp;<span class="ident" id="3051390">c</span><span class="op" id="3051391">.</span><span class="ident" id="3051392">fd</span><span class="op" id="3051394">.</span><span class="ident" id="3051395">isConnected</span>&nbsp;<span class="op" id="3051407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051411">return</span>&nbsp;<span class="num" id="3051418">0</span><span class="op" id="3051419">,</span>&nbsp;<span class="num" id="3051421">0</span><span class="op" id="3051422">,</span>&nbsp;<span class="op" id="3051424">&amp;</span><span class="ident" id="3051425">OpError</span><span class="op" id="3051432">{</span><span class="ident" id="3051433">Op</span><span class="op" id="3051435">:</span>&nbsp;<span class="string" id="3051437">&#34;write&#34;</span><span class="op" id="3051444">,</span>&nbsp;<span class="ident" id="3051446">Net</span><span class="op" id="3051449">:</span>&nbsp;<span class="ident" id="3051451">c</span><span class="op" id="3051452">.</span><span class="ident" id="3051453">fd</span><span class="op" id="3051455">.</span><span class="ident" id="3051456">net</span><span class="op" id="3051459">,</span>&nbsp;<span class="ident" id="3051461">Addr</span><span class="op" id="3051465">:</span>&nbsp;<span class="ident" id="3051467">addr</span><span class="op" id="3051471">,</span>&nbsp;<span class="ident" id="3051473">Err</span><span class="op" id="3051476">:</span>&nbsp;<span class="ident" id="3051478">ErrWriteToConnected</span><span class="op" id="3051497">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051503">if</span>&nbsp;<span class="ident" id="3051506">addr</span>&nbsp;<span class="op" id="3051511">==</span>&nbsp;<span class="ident" id="3051514">nil</span>&nbsp;<span class="op" id="3051518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051522">return</span>&nbsp;<span class="num" id="3051529">0</span><span class="op" id="3051530">,</span>&nbsp;<span class="num" id="3051532">0</span><span class="op" id="3051533">,</span>&nbsp;<span class="op" id="3051535">&amp;</span><span class="ident" id="3051536">OpError</span><span class="op" id="3051543">{</span><span class="ident" id="3051544">Op</span><span class="op" id="3051546">:</span>&nbsp;<span class="string" id="3051548">&#34;write&#34;</span><span class="op" id="3051555">,</span>&nbsp;<span class="ident" id="3051557">Net</span><span class="op" id="3051560">:</span>&nbsp;<span class="ident" id="3051562">c</span><span class="op" id="3051563">.</span><span class="ident" id="3051564">fd</span><span class="op" id="3051566">.</span><span class="ident" id="3051567">net</span><span class="op" id="3051570">,</span>&nbsp;<span class="ident" id="3051572">Addr</span><span class="op" id="3051576">:</span>&nbsp;<span class="ident" id="3051578">nil</span><span class="op" id="3051581">,</span>&nbsp;<span class="ident" id="3051583">Err</span><span class="op" id="3051586">:</span>&nbsp;<span class="ident" id="3051588">errMissingAddress</span><span class="op" id="3051605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051611">sa</span><span class="op" id="3051613">,</span>&nbsp;<span class="ident" id="3051615">err</span>&nbsp;<span class="op" id="3051619">:=</span>&nbsp;<span class="ident" id="3051622">addr</span><span class="op" id="3051626">.</span><span class="ident" id="3051627">sockaddr</span><span class="op" id="3051635">(</span><span class="ident" id="3051636">c</span><span class="op" id="3051637">.</span><span class="ident" id="3051638">fd</span><span class="op" id="3051640">.</span><span class="ident" id="3051641">family</span><span class="op" id="3051647">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051650">if</span>&nbsp;<span class="ident" id="3051653">err</span>&nbsp;<span class="op" id="3051657">!=</span>&nbsp;<span class="ident" id="3051660">nil</span>&nbsp;<span class="op" id="3051664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051668">return</span>&nbsp;<span class="num" id="3051675">0</span><span class="op" id="3051676">,</span>&nbsp;<span class="num" id="3051678">0</span><span class="op" id="3051679">,</span>&nbsp;<span class="op" id="3051681">&amp;</span><span class="ident" id="3051682">OpError</span><span class="op" id="3051689">{</span><span class="string" id="3051690">&#34;write&#34;</span><span class="op" id="3051697">,</span>&nbsp;<span class="ident" id="3051699">c</span><span class="op" id="3051700">.</span><span class="ident" id="3051701">fd</span><span class="op" id="3051703">.</span><span class="ident" id="3051704">net</span><span class="op" id="3051707">,</span>&nbsp;<span class="ident" id="3051709">addr</span><span class="op" id="3051713">,</span>&nbsp;<span class="ident" id="3051715">err</span><span class="op" id="3051718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051724">return</span>&nbsp;<span class="ident" id="3051731">c</span><span class="op" id="3051732">.</span><span class="ident" id="3051733">fd</span><span class="op" id="3051735">.</span><span class="ident" id="3051736">writeMsg</span><span class="op" id="3051744">(</span><span class="ident" id="3051745">b</span><span class="op" id="3051746">,</span>&nbsp;<span class="ident" id="3051748">oob</span><span class="op" id="3051751">,</span>&nbsp;<span class="ident" id="3051753">sa</span><span class="op" id="3051755">)</span><br>
<span class="lineno"></span><span class="op" id="3051757">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="3051760">//&nbsp;DialIP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;protocol</span><br>
<span class="lineno"></span><span class="comment" id="3051831">//&nbsp;netProto,&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon</span><br>
<span class="lineno"></span><span class="comment" id="3051900">//&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3051934">func</span>&nbsp;<span class="ident" id="3051939">DialIP</span><span class="op" id="3051945">(</span><span class="ident" id="3051946">netProto</span>&nbsp;<span class="builtintype" id="3051955">string</span><span class="op" id="3051961">,</span>&nbsp;<span class="ident" id="3051963">laddr</span><span class="op" id="3051968">,</span>&nbsp;<span class="ident" id="3051970">raddr</span>&nbsp;<span class="op" id="3051976">*</span><span class="ident" id="3051977">IPAddr</span><span class="op" id="3051983">)</span>&nbsp;<span class="op" id="3051985">(</span><span class="op" id="3051986">*</span><span class="ident" id="3051987">IPConn</span><span class="op" id="3051993">,</span>&nbsp;<span class="builtintype" id="3051995">error</span><span class="op" id="3052000">)</span>&nbsp;<span class="op" id="3052002">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052005">return</span>&nbsp;<span class="ident" id="3052012">dialIP</span><span class="op" id="3052018">(</span><span class="ident" id="3052019">netProto</span><span class="op" id="3052027">,</span>&nbsp;<span class="ident" id="3052029">laddr</span><span class="op" id="3052034">,</span>&nbsp;<span class="ident" id="3052036">raddr</span><span class="op" id="3052041">,</span>&nbsp;<span class="ident" id="3052043">noDeadline</span><span class="op" id="3052053">)</span><br>
<span class="lineno"></span><span class="op" id="3052055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3052058">func</span>&nbsp;<span class="ident" id="3052063">dialIP</span><span class="op" id="3052069">(</span><span class="ident" id="3052070">netProto</span>&nbsp;<span class="builtintype" id="3052079">string</span><span class="op" id="3052085">,</span>&nbsp;<span class="ident" id="3052087">laddr</span><span class="op" id="3052092">,</span>&nbsp;<span class="ident" id="3052094">raddr</span>&nbsp;<span class="op" id="3052100">*</span><span class="ident" id="3052101">IPAddr</span><span class="op" id="3052107">,</span>&nbsp;<span class="ident" id="3052109">deadline</span>&nbsp;<span class="ident" id="3052118">time</span><span class="op" id="3052122">.</span><span class="ident" id="3052123">Time</span><span class="op" id="3052127">)</span>&nbsp;<span class="op" id="3052129">(</span><span class="op" id="3052130">*</span><span class="ident" id="3052131">IPConn</span><span class="op" id="3052137">,</span>&nbsp;<span class="builtintype" id="3052139">error</span><span class="op" id="3052144">)</span>&nbsp;<span class="op" id="3052146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052149">net</span><span class="op" id="3052152">,</span>&nbsp;<span class="ident" id="3052154">proto</span><span class="op" id="3052159">,</span>&nbsp;<span class="ident" id="3052161">err</span>&nbsp;<span class="op" id="3052165">:=</span>&nbsp;<span class="ident" id="3052168">parseNetwork</span><span class="op" id="3052180">(</span><span class="ident" id="3052181">netProto</span><span class="op" id="3052189">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052192">if</span>&nbsp;<span class="ident" id="3052195">err</span>&nbsp;<span class="op" id="3052199">!=</span>&nbsp;<span class="ident" id="3052202">nil</span>&nbsp;<span class="op" id="3052206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052210">return</span>&nbsp;<span class="ident" id="3052217">nil</span><span class="op" id="3052220">,</span>&nbsp;<span class="op" id="3052222">&amp;</span><span class="ident" id="3052223">OpError</span><span class="op" id="3052230">{</span><span class="ident" id="3052231">Op</span><span class="op" id="3052233">:</span>&nbsp;<span class="string" id="3052235">&#34;dial&#34;</span><span class="op" id="3052241">,</span>&nbsp;<span class="ident" id="3052243">Net</span><span class="op" id="3052246">:</span>&nbsp;<span class="ident" id="3052248">netProto</span><span class="op" id="3052256">,</span>&nbsp;<span class="ident" id="3052258">Addr</span><span class="op" id="3052262">:</span>&nbsp;<span class="ident" id="3052264">raddr</span><span class="op" id="3052269">,</span>&nbsp;<span class="ident" id="3052271">Err</span><span class="op" id="3052274">:</span>&nbsp;<span class="ident" id="3052276">err</span><span class="op" id="3052279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052285">switch</span>&nbsp;<span class="ident" id="3052292">net</span>&nbsp;<span class="op" id="3052296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052299">case</span>&nbsp;<span class="string" id="3052304">&#34;ip&#34;</span><span class="op" id="3052308">,</span>&nbsp;<span class="string" id="3052310">&#34;ip4&#34;</span><span class="op" id="3052315">,</span>&nbsp;<span class="string" id="3052317">&#34;ip6&#34;</span><span class="op" id="3052322">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052325">default</span><span class="op" id="3052332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052336">return</span>&nbsp;<span class="ident" id="3052343">nil</span><span class="op" id="3052346">,</span>&nbsp;<span class="op" id="3052348">&amp;</span><span class="ident" id="3052349">OpError</span><span class="op" id="3052356">{</span><span class="ident" id="3052357">Op</span><span class="op" id="3052359">:</span>&nbsp;<span class="string" id="3052361">&#34;dial&#34;</span><span class="op" id="3052367">,</span>&nbsp;<span class="ident" id="3052369">Net</span><span class="op" id="3052372">:</span>&nbsp;<span class="ident" id="3052374">netProto</span><span class="op" id="3052382">,</span>&nbsp;<span class="ident" id="3052384">Addr</span><span class="op" id="3052388">:</span>&nbsp;<span class="ident" id="3052390">raddr</span><span class="op" id="3052395">,</span>&nbsp;<span class="ident" id="3052397">Err</span><span class="op" id="3052400">:</span>&nbsp;<span class="ident" id="3052402">UnknownNetworkError</span><span class="op" id="3052421">(</span><span class="ident" id="3052422">netProto</span><span class="op" id="3052430">)</span><span class="op" id="3052431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052437">if</span>&nbsp;<span class="ident" id="3052440">raddr</span>&nbsp;<span class="op" id="3052446">==</span>&nbsp;<span class="ident" id="3052449">nil</span>&nbsp;<span class="op" id="3052453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052457">return</span>&nbsp;<span class="ident" id="3052464">nil</span><span class="op" id="3052467">,</span>&nbsp;<span class="op" id="3052469">&amp;</span><span class="ident" id="3052470">OpError</span><span class="op" id="3052477">{</span><span class="ident" id="3052478">Op</span><span class="op" id="3052480">:</span>&nbsp;<span class="string" id="3052482">&#34;dial&#34;</span><span class="op" id="3052488">,</span>&nbsp;<span class="ident" id="3052490">Net</span><span class="op" id="3052493">:</span>&nbsp;<span class="ident" id="3052495">netProto</span><span class="op" id="3052503">,</span>&nbsp;<span class="ident" id="3052505">Addr</span><span class="op" id="3052509">:</span>&nbsp;<span class="ident" id="3052511">nil</span><span class="op" id="3052514">,</span>&nbsp;<span class="ident" id="3052516">Err</span><span class="op" id="3052519">:</span>&nbsp;<span class="ident" id="3052521">errMissingAddress</span><span class="op" id="3052538">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052544">fd</span><span class="op" id="3052546">,</span>&nbsp;<span class="ident" id="3052548">err</span>&nbsp;<span class="op" id="3052552">:=</span>&nbsp;<span class="ident" id="3052555">internetSocket</span><span class="op" id="3052569">(</span><span class="ident" id="3052570">net</span><span class="op" id="3052573">,</span>&nbsp;<span class="ident" id="3052575">laddr</span><span class="op" id="3052580">,</span>&nbsp;<span class="ident" id="3052582">raddr</span><span class="op" id="3052587">,</span>&nbsp;<span class="ident" id="3052589">deadline</span><span class="op" id="3052597">,</span>&nbsp;<span class="ident" id="3052599">syscall</span><span class="op" id="3052606">.</span><span class="ident" id="3052607">SOCK_RAW</span><span class="op" id="3052615">,</span>&nbsp;<span class="ident" id="3052617">proto</span><span class="op" id="3052622">,</span>&nbsp;<span class="string" id="3052624">&#34;dial&#34;</span><span class="op" id="3052630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052633">if</span>&nbsp;<span class="ident" id="3052636">err</span>&nbsp;<span class="op" id="3052640">!=</span>&nbsp;<span class="ident" id="3052643">nil</span>&nbsp;<span class="op" id="3052647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052651">return</span>&nbsp;<span class="ident" id="3052658">nil</span><span class="op" id="3052661">,</span>&nbsp;<span class="op" id="3052663">&amp;</span><span class="ident" id="3052664">OpError</span><span class="op" id="3052671">{</span><span class="ident" id="3052672">Op</span><span class="op" id="3052674">:</span>&nbsp;<span class="string" id="3052676">&#34;dial&#34;</span><span class="op" id="3052682">,</span>&nbsp;<span class="ident" id="3052684">Net</span><span class="op" id="3052687">:</span>&nbsp;<span class="ident" id="3052689">netProto</span><span class="op" id="3052697">,</span>&nbsp;<span class="ident" id="3052699">Addr</span><span class="op" id="3052703">:</span>&nbsp;<span class="ident" id="3052705">raddr</span><span class="op" id="3052710">,</span>&nbsp;<span class="ident" id="3052712">Err</span><span class="op" id="3052715">:</span>&nbsp;<span class="ident" id="3052717">err</span><span class="op" id="3052720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052723">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052726">return</span>&nbsp;<span class="ident" id="3052733">newIPConn</span><span class="op" id="3052742">(</span><span class="ident" id="3052743">fd</span><span class="op" id="3052745">)</span><span class="op" id="3052746">,</span>&nbsp;<span class="ident" id="3052748">nil</span><br>
<span class="lineno"></span><span class="op" id="3052752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3052755">//&nbsp;ListenIP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;IP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3052822">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">210</span><span class="comment" id="3052888">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;IP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3052958">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3052973">func</span>&nbsp;<span class="ident" id="3052978">ListenIP</span><span class="op" id="3052986">(</span><span class="ident" id="3052987">netProto</span>&nbsp;<span class="builtintype" id="3052996">string</span><span class="op" id="3053002">,</span>&nbsp;<span class="ident" id="3053004">laddr</span>&nbsp;<span class="op" id="3053010">*</span><span class="ident" id="3053011">IPAddr</span><span class="op" id="3053017">)</span>&nbsp;<span class="op" id="3053019">(</span><span class="op" id="3053020">*</span><span class="ident" id="3053021">IPConn</span><span class="op" id="3053027">,</span>&nbsp;<span class="builtintype" id="3053029">error</span><span class="op" id="3053034">)</span>&nbsp;<span class="op" id="3053036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053039">net</span><span class="op" id="3053042">,</span>&nbsp;<span class="ident" id="3053044">proto</span><span class="op" id="3053049">,</span>&nbsp;<span class="ident" id="3053051">err</span>&nbsp;<span class="op" id="3053055">:=</span>&nbsp;<span class="ident" id="3053058">parseNetwork</span><span class="op" id="3053070">(</span><span class="ident" id="3053071">netProto</span><span class="op" id="3053079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053082">if</span>&nbsp;<span class="ident" id="3053085">err</span>&nbsp;<span class="op" id="3053089">!=</span>&nbsp;<span class="ident" id="3053092">nil</span>&nbsp;<span class="op" id="3053096">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053100">return</span>&nbsp;<span class="ident" id="3053107">nil</span><span class="op" id="3053110">,</span>&nbsp;<span class="op" id="3053112">&amp;</span><span class="ident" id="3053113">OpError</span><span class="op" id="3053120">{</span><span class="ident" id="3053121">Op</span><span class="op" id="3053123">:</span>&nbsp;<span class="string" id="3053125">&#34;dial&#34;</span><span class="op" id="3053131">,</span>&nbsp;<span class="ident" id="3053133">Net</span><span class="op" id="3053136">:</span>&nbsp;<span class="ident" id="3053138">netProto</span><span class="op" id="3053146">,</span>&nbsp;<span class="ident" id="3053148">Addr</span><span class="op" id="3053152">:</span>&nbsp;<span class="ident" id="3053154">laddr</span><span class="op" id="3053159">,</span>&nbsp;<span class="ident" id="3053161">Err</span><span class="op" id="3053164">:</span>&nbsp;<span class="ident" id="3053166">err</span><span class="op" id="3053169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053175">switch</span>&nbsp;<span class="ident" id="3053182">net</span>&nbsp;<span class="op" id="3053186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053189">case</span>&nbsp;<span class="string" id="3053194">&#34;ip&#34;</span><span class="op" id="3053198">,</span>&nbsp;<span class="string" id="3053200">&#34;ip4&#34;</span><span class="op" id="3053205">,</span>&nbsp;<span class="string" id="3053207">&#34;ip6&#34;</span><span class="op" id="3053212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053215">default</span><span class="op" id="3053222">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053226">return</span>&nbsp;<span class="ident" id="3053233">nil</span><span class="op" id="3053236">,</span>&nbsp;<span class="op" id="3053238">&amp;</span><span class="ident" id="3053239">OpError</span><span class="op" id="3053246">{</span><span class="ident" id="3053247">Op</span><span class="op" id="3053249">:</span>&nbsp;<span class="string" id="3053251">&#34;listen&#34;</span><span class="op" id="3053259">,</span>&nbsp;<span class="ident" id="3053261">Net</span><span class="op" id="3053264">:</span>&nbsp;<span class="ident" id="3053266">netProto</span><span class="op" id="3053274">,</span>&nbsp;<span class="ident" id="3053276">Addr</span><span class="op" id="3053280">:</span>&nbsp;<span class="ident" id="3053282">laddr</span><span class="op" id="3053287">,</span>&nbsp;<span class="ident" id="3053289">Err</span><span class="op" id="3053292">:</span>&nbsp;<span class="ident" id="3053294">UnknownNetworkError</span><span class="op" id="3053313">(</span><span class="ident" id="3053314">netProto</span><span class="op" id="3053322">)</span><span class="op" id="3053323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053329">fd</span><span class="op" id="3053331">,</span>&nbsp;<span class="ident" id="3053333">err</span>&nbsp;<span class="op" id="3053337">:=</span>&nbsp;<span class="ident" id="3053340">internetSocket</span><span class="op" id="3053354">(</span><span class="ident" id="3053355">net</span><span class="op" id="3053358">,</span>&nbsp;<span class="ident" id="3053360">laddr</span><span class="op" id="3053365">,</span>&nbsp;<span class="ident" id="3053367">nil</span><span class="op" id="3053370">,</span>&nbsp;<span class="ident" id="3053372">noDeadline</span><span class="op" id="3053382">,</span>&nbsp;<span class="ident" id="3053384">syscall</span><span class="op" id="3053391">.</span><span class="ident" id="3053392">SOCK_RAW</span><span class="op" id="3053400">,</span>&nbsp;<span class="ident" id="3053402">proto</span><span class="op" id="3053407">,</span>&nbsp;<span class="string" id="3053409">&#34;listen&#34;</span><span class="op" id="3053417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053420">if</span>&nbsp;<span class="ident" id="3053423">err</span>&nbsp;<span class="op" id="3053427">!=</span>&nbsp;<span class="ident" id="3053430">nil</span>&nbsp;<span class="op" id="3053434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053438">return</span>&nbsp;<span class="ident" id="3053445">nil</span><span class="op" id="3053448">,</span>&nbsp;<span class="op" id="3053450">&amp;</span><span class="ident" id="3053451">OpError</span><span class="op" id="3053458">{</span><span class="ident" id="3053459">Op</span><span class="op" id="3053461">:</span>&nbsp;<span class="string" id="3053463">&#34;listen&#34;</span><span class="op" id="3053471">,</span>&nbsp;<span class="ident" id="3053473">Net</span><span class="op" id="3053476">:</span>&nbsp;<span class="ident" id="3053478">netProto</span><span class="op" id="3053486">,</span>&nbsp;<span class="ident" id="3053488">Addr</span><span class="op" id="3053492">:</span>&nbsp;<span class="ident" id="3053494">laddr</span><span class="op" id="3053499">,</span>&nbsp;<span class="ident" id="3053501">Err</span><span class="op" id="3053504">:</span>&nbsp;<span class="ident" id="3053506">err</span><span class="op" id="3053509">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053515">return</span>&nbsp;<span class="ident" id="3053522">newIPConn</span><span class="op" id="3053531">(</span><span class="ident" id="3053532">fd</span><span class="op" id="3053534">)</span><span class="op" id="3053535">,</span>&nbsp;<span class="ident" id="3053537">nil</span><br>
<span class="lineno"></span><span class="op" id="3053541">}</span>
</div>
</body>
</html>
