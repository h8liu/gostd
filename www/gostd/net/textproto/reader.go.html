<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2982190">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2982246">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2982300">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2982351">package</span>&nbsp;<span class="ident" id="2982359">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2982370">import</span>&nbsp;<span class="op" id="2982377">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2982380">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2982389">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2982398">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2982404">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2982417">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2982428">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="2982438">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2982441">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="2982506">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2982571">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2982621">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="2982685">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="2982742">type</span>&nbsp;<span class="ident" id="2982747">Reader</span>&nbsp;<span class="keyword" id="2982754">struct</span>&nbsp;<span class="op" id="2982761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2982764">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2982768">*</span><span class="ident" id="2982769">bufio</span><span class="op" id="2982774">.</span><span class="ident" id="2982775">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2982783">dot</span>&nbsp;<span class="op" id="2982787">*</span><span class="ident" id="2982788">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2982799">buf</span>&nbsp;<span class="op" id="2982803">[</span><span class="op" id="2982804">]</span><span class="builtintype" id="2982805">byte</span>&nbsp;<span class="comment" id="2982810">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="2982859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2982862">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2982912">func</span>&nbsp;<span class="ident" id="2982917">NewReader</span><span class="op" id="2982926">(</span><span class="ident" id="2982927">r</span>&nbsp;<span class="op" id="2982929">*</span><span class="ident" id="2982930">bufio</span><span class="op" id="2982935">.</span><span class="ident" id="2982936">Reader</span><span class="op" id="2982942">)</span>&nbsp;<span class="op" id="2982944">*</span><span class="ident" id="2982945">Reader</span>&nbsp;<span class="op" id="2982952">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2982955">return</span>&nbsp;<span class="op" id="2982962">&amp;</span><span class="ident" id="2982963">Reader</span><span class="op" id="2982969">{</span><span class="ident" id="2982970">R</span><span class="op" id="2982971">:</span>&nbsp;<span class="ident" id="2982973">r</span><span class="op" id="2982974">}</span><br>
<span class="lineno"></span><span class="op" id="2982976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2982979">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="2983019">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="2983077">func</span>&nbsp;<span class="op" id="2983082">(</span><span class="ident" id="2983083">r</span>&nbsp;<span class="op" id="2983085">*</span><span class="ident" id="2983086">Reader</span><span class="op" id="2983092">)</span>&nbsp;<span class="ident" id="2983094">ReadLine</span><span class="op" id="2983102">(</span><span class="op" id="2983103">)</span>&nbsp;<span class="op" id="2983105">(</span><span class="builtintype" id="2983106">string</span><span class="op" id="2983112">,</span>&nbsp;<span class="builtintype" id="2983114">error</span><span class="op" id="2983119">)</span>&nbsp;<span class="op" id="2983121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983124">line</span><span class="op" id="2983128">,</span>&nbsp;<span class="ident" id="2983130">err</span>&nbsp;<span class="op" id="2983134">:=</span>&nbsp;<span class="ident" id="2983137">r</span><span class="op" id="2983138">.</span><span class="ident" id="2983139">readLineSlice</span><span class="op" id="2983152">(</span><span class="op" id="2983153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983156">return</span>&nbsp;<span class="builtintype" id="2983163">string</span><span class="op" id="2983169">(</span><span class="ident" id="2983170">line</span><span class="op" id="2983174">)</span><span class="op" id="2983175">,</span>&nbsp;<span class="ident" id="2983177">err</span><br>
<span class="lineno"></span><span class="op" id="2983181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2983184">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2983260">func</span>&nbsp;<span class="op" id="2983265">(</span><span class="ident" id="2983266">r</span>&nbsp;<span class="op" id="2983268">*</span><span class="ident" id="2983269">Reader</span><span class="op" id="2983275">)</span>&nbsp;<span class="ident" id="2983277">ReadLineBytes</span><span class="op" id="2983290">(</span><span class="op" id="2983291">)</span>&nbsp;<span class="op" id="2983293">(</span><span class="op" id="2983294">[</span><span class="op" id="2983295">]</span><span class="builtintype" id="2983296">byte</span><span class="op" id="2983300">,</span>&nbsp;<span class="builtintype" id="2983302">error</span><span class="op" id="2983307">)</span>&nbsp;<span class="op" id="2983309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983312">line</span><span class="op" id="2983316">,</span>&nbsp;<span class="ident" id="2983318">err</span>&nbsp;<span class="op" id="2983322">:=</span>&nbsp;<span class="ident" id="2983325">r</span><span class="op" id="2983326">.</span><span class="ident" id="2983327">readLineSlice</span><span class="op" id="2983340">(</span><span class="op" id="2983341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983344">if</span>&nbsp;<span class="ident" id="2983347">line</span>&nbsp;<span class="op" id="2983352">!=</span>&nbsp;<span class="ident" id="2983355">nil</span>&nbsp;<span class="op" id="2983359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983363">buf</span>&nbsp;<span class="op" id="2983367">:=</span>&nbsp;<span class="builtinfunc" id="2983370">make</span><span class="op" id="2983374">(</span><span class="op" id="2983375">[</span><span class="op" id="2983376">]</span><span class="builtintype" id="2983377">byte</span><span class="op" id="2983381">,</span>&nbsp;<span class="builtinfunc" id="2983383">len</span><span class="op" id="2983386">(</span><span class="ident" id="2983387">line</span><span class="op" id="2983391">)</span><span class="op" id="2983392">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2983396">copy</span><span class="op" id="2983400">(</span><span class="ident" id="2983401">buf</span><span class="op" id="2983404">,</span>&nbsp;<span class="ident" id="2983406">line</span><span class="op" id="2983410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983414">line</span>&nbsp;<span class="op" id="2983419">=</span>&nbsp;<span class="ident" id="2983421">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2983426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983429">return</span>&nbsp;<span class="ident" id="2983436">line</span><span class="op" id="2983440">,</span>&nbsp;<span class="ident" id="2983442">err</span><br>
<span class="lineno"></span><span class="op" id="2983446">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="2983449">func</span>&nbsp;<span class="op" id="2983454">(</span><span class="ident" id="2983455">r</span>&nbsp;<span class="op" id="2983457">*</span><span class="ident" id="2983458">Reader</span><span class="op" id="2983464">)</span>&nbsp;<span class="ident" id="2983466">readLineSlice</span><span class="op" id="2983479">(</span><span class="op" id="2983480">)</span>&nbsp;<span class="op" id="2983482">(</span><span class="op" id="2983483">[</span><span class="op" id="2983484">]</span><span class="builtintype" id="2983485">byte</span><span class="op" id="2983489">,</span>&nbsp;<span class="builtintype" id="2983491">error</span><span class="op" id="2983496">)</span>&nbsp;<span class="op" id="2983498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983501">r</span><span class="op" id="2983502">.</span><span class="ident" id="2983503">closeDot</span><span class="op" id="2983511">(</span><span class="op" id="2983512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983515">var</span>&nbsp;<span class="ident" id="2983519">line</span>&nbsp;<span class="op" id="2983524">[</span><span class="op" id="2983525">]</span><span class="builtintype" id="2983526">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983532">for</span>&nbsp;<span class="op" id="2983536">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983540">l</span><span class="op" id="2983541">,</span>&nbsp;<span class="ident" id="2983543">more</span><span class="op" id="2983547">,</span>&nbsp;<span class="ident" id="2983549">err</span>&nbsp;<span class="op" id="2983553">:=</span>&nbsp;<span class="ident" id="2983556">r</span><span class="op" id="2983557">.</span><span class="ident" id="2983558">R</span><span class="op" id="2983559">.</span><span class="ident" id="2983560">ReadLine</span><span class="op" id="2983568">(</span><span class="op" id="2983569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983573">if</span>&nbsp;<span class="ident" id="2983576">err</span>&nbsp;<span class="op" id="2983580">!=</span>&nbsp;<span class="ident" id="2983583">nil</span>&nbsp;<span class="op" id="2983587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983592">return</span>&nbsp;<span class="ident" id="2983599">nil</span><span class="op" id="2983602">,</span>&nbsp;<span class="ident" id="2983604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2983610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983614">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983674">if</span>&nbsp;<span class="ident" id="2983677">line</span>&nbsp;<span class="op" id="2983682">==</span>&nbsp;<span class="ident" id="2983685">nil</span>&nbsp;<span class="op" id="2983689">&amp;&amp;</span>&nbsp;<span class="op" id="2983692">!</span><span class="ident" id="2983693">more</span>&nbsp;<span class="op" id="2983698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983703">return</span>&nbsp;<span class="ident" id="2983710">l</span><span class="op" id="2983711">,</span>&nbsp;<span class="ident" id="2983713">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2983719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983723">line</span>&nbsp;<span class="op" id="2983728">=</span>&nbsp;<span class="builtinfunc" id="2983730">append</span><span class="op" id="2983736">(</span><span class="ident" id="2983737">line</span><span class="op" id="2983741">,</span>&nbsp;<span class="ident" id="2983743">l</span><span class="op" id="2983744">...</span><span class="op" id="2983747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983751">if</span>&nbsp;<span class="op" id="2983754">!</span><span class="ident" id="2983755">more</span>&nbsp;<span class="op" id="2983760">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983765">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2983773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2983776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2983779">return</span>&nbsp;<span class="ident" id="2983786">line</span><span class="op" id="2983790">,</span>&nbsp;<span class="ident" id="2983792">nil</span><br>
<span class="lineno"></span><span class="op" id="2983796">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2983799">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="2983860">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="2983909">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="2983971">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="2984034">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="2984093">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2984156">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="2984172">//</span><br>
<span class="lineno"></span><span class="comment" id="2984175">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="2984212">//</span><br>
<span class="lineno"></span><span class="comment" id="2984215">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2984225">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="2984243">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2984253">//</span><br>
<span class="lineno">85</span><span class="comment" id="2984256">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2984329">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2984369">//</span><br>
<span class="lineno"></span><span class="comment" id="2984372">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="2984433">//</span><br>
<span class="lineno">90</span><span class="keyword" id="2984436">func</span>&nbsp;<span class="op" id="2984441">(</span><span class="ident" id="2984442">r</span>&nbsp;<span class="op" id="2984444">*</span><span class="ident" id="2984445">Reader</span><span class="op" id="2984451">)</span>&nbsp;<span class="ident" id="2984453">ReadContinuedLine</span><span class="op" id="2984470">(</span><span class="op" id="2984471">)</span>&nbsp;<span class="op" id="2984473">(</span><span class="builtintype" id="2984474">string</span><span class="op" id="2984480">,</span>&nbsp;<span class="builtintype" id="2984482">error</span><span class="op" id="2984487">)</span>&nbsp;<span class="op" id="2984489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2984492">line</span><span class="op" id="2984496">,</span>&nbsp;<span class="ident" id="2984498">err</span>&nbsp;<span class="op" id="2984502">:=</span>&nbsp;<span class="ident" id="2984505">r</span><span class="op" id="2984506">.</span><span class="ident" id="2984507">readContinuedLineSlice</span><span class="op" id="2984529">(</span><span class="op" id="2984530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2984533">return</span>&nbsp;<span class="builtintype" id="2984540">string</span><span class="op" id="2984546">(</span><span class="ident" id="2984547">line</span><span class="op" id="2984551">)</span><span class="op" id="2984552">,</span>&nbsp;<span class="ident" id="2984554">err</span><br>
<span class="lineno"></span><span class="op" id="2984558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="2984561">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="2984630">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="2984670">func</span>&nbsp;<span class="ident" id="2984675">trim</span><span class="op" id="2984679">(</span><span class="ident" id="2984680">s</span>&nbsp;<span class="op" id="2984682">[</span><span class="op" id="2984683">]</span><span class="builtintype" id="2984684">byte</span><span class="op" id="2984688">)</span>&nbsp;<span class="op" id="2984690">[</span><span class="op" id="2984691">]</span><span class="builtintype" id="2984692">byte</span>&nbsp;<span class="op" id="2984697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2984700">i</span>&nbsp;<span class="op" id="2984702">:=</span>&nbsp;<span class="num" id="2984705">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2984708">for</span>&nbsp;<span class="ident" id="2984712">i</span>&nbsp;<span class="op" id="2984714">&lt;</span>&nbsp;<span class="builtinfunc" id="2984716">len</span><span class="op" id="2984719">(</span><span class="ident" id="2984720">s</span><span class="op" id="2984721">)</span>&nbsp;<span class="op" id="2984723">&amp;&amp;</span>&nbsp;<span class="op" id="2984726">(</span><span class="ident" id="2984727">s</span><span class="op" id="2984728">[</span><span class="ident" id="2984729">i</span><span class="op" id="2984730">]</span>&nbsp;<span class="op" id="2984732">==</span>&nbsp;<span class="string" id="2984735">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2984739">||</span>&nbsp;<span class="ident" id="2984742">s</span><span class="op" id="2984743">[</span><span class="ident" id="2984744">i</span><span class="op" id="2984745">]</span>&nbsp;<span class="op" id="2984747">==</span>&nbsp;<span class="string" id="2984750">&#39;\t&#39;</span><span class="op" id="2984754">)</span>&nbsp;<span class="op" id="2984756">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2984760">i</span><span class="op" id="2984761">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2984765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2984768">n</span>&nbsp;<span class="op" id="2984770">:=</span>&nbsp;<span class="builtinfunc" id="2984773">len</span><span class="op" id="2984776">(</span><span class="ident" id="2984777">s</span><span class="op" id="2984778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2984781">for</span>&nbsp;<span class="ident" id="2984785">n</span>&nbsp;<span class="op" id="2984787">&gt;</span>&nbsp;<span class="ident" id="2984789">i</span>&nbsp;<span class="op" id="2984791">&amp;&amp;</span>&nbsp;<span class="op" id="2984794">(</span><span class="ident" id="2984795">s</span><span class="op" id="2984796">[</span><span class="ident" id="2984797">n</span><span class="op" id="2984798">-</span><span class="num" id="2984799">1</span><span class="op" id="2984800">]</span>&nbsp;<span class="op" id="2984802">==</span>&nbsp;<span class="string" id="2984805">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2984809">||</span>&nbsp;<span class="ident" id="2984812">s</span><span class="op" id="2984813">[</span><span class="ident" id="2984814">n</span><span class="op" id="2984815">-</span><span class="num" id="2984816">1</span><span class="op" id="2984817">]</span>&nbsp;<span class="op" id="2984819">==</span>&nbsp;<span class="string" id="2984822">&#39;\t&#39;</span><span class="op" id="2984826">)</span>&nbsp;<span class="op" id="2984828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2984832">n</span><span class="op" id="2984833">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2984837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2984840">return</span>&nbsp;<span class="ident" id="2984847">s</span><span class="op" id="2984848">[</span><span class="ident" id="2984849">i</span><span class="op" id="2984850">:</span><span class="ident" id="2984851">n</span><span class="op" id="2984852">]</span><br>
<span class="lineno"></span><span class="op" id="2984854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2984857">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="2984913">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2984954">func</span>&nbsp;<span class="op" id="2984959">(</span><span class="ident" id="2984960">r</span>&nbsp;<span class="op" id="2984962">*</span><span class="ident" id="2984963">Reader</span><span class="op" id="2984969">)</span>&nbsp;<span class="ident" id="2984971">ReadContinuedLineBytes</span><span class="op" id="2984993">(</span><span class="op" id="2984994">)</span>&nbsp;<span class="op" id="2984996">(</span><span class="op" id="2984997">[</span><span class="op" id="2984998">]</span><span class="builtintype" id="2984999">byte</span><span class="op" id="2985003">,</span>&nbsp;<span class="builtintype" id="2985005">error</span><span class="op" id="2985010">)</span>&nbsp;<span class="op" id="2985012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985015">line</span><span class="op" id="2985019">,</span>&nbsp;<span class="ident" id="2985021">err</span>&nbsp;<span class="op" id="2985025">:=</span>&nbsp;<span class="ident" id="2985028">r</span><span class="op" id="2985029">.</span><span class="ident" id="2985030">readContinuedLineSlice</span><span class="op" id="2985052">(</span><span class="op" id="2985053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985056">if</span>&nbsp;<span class="ident" id="2985059">line</span>&nbsp;<span class="op" id="2985064">!=</span>&nbsp;<span class="ident" id="2985067">nil</span>&nbsp;<span class="op" id="2985071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985075">buf</span>&nbsp;<span class="op" id="2985079">:=</span>&nbsp;<span class="builtinfunc" id="2985082">make</span><span class="op" id="2985086">(</span><span class="op" id="2985087">[</span><span class="op" id="2985088">]</span><span class="builtintype" id="2985089">byte</span><span class="op" id="2985093">,</span>&nbsp;<span class="builtinfunc" id="2985095">len</span><span class="op" id="2985098">(</span><span class="ident" id="2985099">line</span><span class="op" id="2985103">)</span><span class="op" id="2985104">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2985108">copy</span><span class="op" id="2985112">(</span><span class="ident" id="2985113">buf</span><span class="op" id="2985116">,</span>&nbsp;<span class="ident" id="2985118">line</span><span class="op" id="2985122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985126">line</span>&nbsp;<span class="op" id="2985131">=</span>&nbsp;<span class="ident" id="2985133">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2985138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985141">return</span>&nbsp;<span class="ident" id="2985148">line</span><span class="op" id="2985152">,</span>&nbsp;<span class="ident" id="2985154">err</span><br>
<span class="lineno"></span><span class="op" id="2985158">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="2985161">func</span>&nbsp;<span class="op" id="2985166">(</span><span class="ident" id="2985167">r</span>&nbsp;<span class="op" id="2985169">*</span><span class="ident" id="2985170">Reader</span><span class="op" id="2985176">)</span>&nbsp;<span class="ident" id="2985178">readContinuedLineSlice</span><span class="op" id="2985200">(</span><span class="op" id="2985201">)</span>&nbsp;<span class="op" id="2985203">(</span><span class="op" id="2985204">[</span><span class="op" id="2985205">]</span><span class="builtintype" id="2985206">byte</span><span class="op" id="2985210">,</span>&nbsp;<span class="builtintype" id="2985212">error</span><span class="op" id="2985217">)</span>&nbsp;<span class="op" id="2985219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985222">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985247">line</span><span class="op" id="2985251">,</span>&nbsp;<span class="ident" id="2985253">err</span>&nbsp;<span class="op" id="2985257">:=</span>&nbsp;<span class="ident" id="2985260">r</span><span class="op" id="2985261">.</span><span class="ident" id="2985262">readLineSlice</span><span class="op" id="2985275">(</span><span class="op" id="2985276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985279">if</span>&nbsp;<span class="ident" id="2985282">err</span>&nbsp;<span class="op" id="2985286">!=</span>&nbsp;<span class="ident" id="2985289">nil</span>&nbsp;<span class="op" id="2985293">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985297">return</span>&nbsp;<span class="ident" id="2985304">nil</span><span class="op" id="2985307">,</span>&nbsp;<span class="ident" id="2985309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2985314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985317">if</span>&nbsp;<span class="builtinfunc" id="2985320">len</span><span class="op" id="2985323">(</span><span class="ident" id="2985324">line</span><span class="op" id="2985328">)</span>&nbsp;<span class="op" id="2985330">==</span>&nbsp;<span class="num" id="2985333">0</span>&nbsp;<span class="op" id="2985335">{</span>&nbsp;<span class="comment" id="2985337">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985371">return</span>&nbsp;<span class="ident" id="2985378">line</span><span class="op" id="2985382">,</span>&nbsp;<span class="ident" id="2985384">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2985389">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985393">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985464">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985536">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985608">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985637">if</span>&nbsp;<span class="ident" id="2985640">r</span><span class="op" id="2985641">.</span><span class="ident" id="2985642">R</span><span class="op" id="2985643">.</span><span class="ident" id="2985644">Buffered</span><span class="op" id="2985652">(</span><span class="op" id="2985653">)</span>&nbsp;<span class="op" id="2985655">&gt;</span>&nbsp;<span class="num" id="2985657">1</span>&nbsp;<span class="op" id="2985659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985663">peek</span><span class="op" id="2985667">,</span>&nbsp;<span class="ident" id="2985669">err</span>&nbsp;<span class="op" id="2985673">:=</span>&nbsp;<span class="ident" id="2985676">r</span><span class="op" id="2985677">.</span><span class="ident" id="2985678">R</span><span class="op" id="2985679">.</span><span class="ident" id="2985680">Peek</span><span class="op" id="2985684">(</span><span class="num" id="2985685">1</span><span class="op" id="2985686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985690">if</span>&nbsp;<span class="ident" id="2985693">err</span>&nbsp;<span class="op" id="2985697">==</span>&nbsp;<span class="ident" id="2985700">nil</span>&nbsp;<span class="op" id="2985704">&amp;&amp;</span>&nbsp;<span class="ident" id="2985707">isASCIILetter</span><span class="op" id="2985720">(</span><span class="ident" id="2985721">peek</span><span class="op" id="2985725">[</span><span class="num" id="2985726">0</span><span class="op" id="2985727">]</span><span class="op" id="2985728">)</span>&nbsp;<span class="op" id="2985730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985735">return</span>&nbsp;<span class="ident" id="2985742">trim</span><span class="op" id="2985746">(</span><span class="ident" id="2985747">line</span><span class="op" id="2985751">)</span><span class="op" id="2985752">,</span>&nbsp;<span class="ident" id="2985754">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2985760">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2985763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985767">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985834">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985863">r</span><span class="op" id="2985864">.</span><span class="ident" id="2985865">buf</span>&nbsp;<span class="op" id="2985869">=</span>&nbsp;<span class="builtinfunc" id="2985871">append</span><span class="op" id="2985877">(</span><span class="ident" id="2985878">r</span><span class="op" id="2985879">.</span><span class="ident" id="2985880">buf</span><span class="op" id="2985883">[</span><span class="op" id="2985884">:</span><span class="num" id="2985885">0</span><span class="op" id="2985886">]</span><span class="op" id="2985887">,</span>&nbsp;<span class="ident" id="2985889">trim</span><span class="op" id="2985893">(</span><span class="ident" id="2985894">line</span><span class="op" id="2985898">)</span><span class="op" id="2985899">...</span><span class="op" id="2985902">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985906">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985935">for</span>&nbsp;<span class="ident" id="2985939">r</span><span class="op" id="2985940">.</span><span class="ident" id="2985941">skipSpace</span><span class="op" id="2985950">(</span><span class="op" id="2985951">)</span>&nbsp;<span class="op" id="2985953">&gt;</span>&nbsp;<span class="num" id="2985955">0</span>&nbsp;<span class="op" id="2985957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985961">line</span><span class="op" id="2985965">,</span>&nbsp;<span class="ident" id="2985967">err</span>&nbsp;<span class="op" id="2985971">:=</span>&nbsp;<span class="ident" id="2985974">r</span><span class="op" id="2985975">.</span><span class="ident" id="2985976">readLineSlice</span><span class="op" id="2985989">(</span><span class="op" id="2985990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2985994">if</span>&nbsp;<span class="ident" id="2985997">err</span>&nbsp;<span class="op" id="2986001">!=</span>&nbsp;<span class="ident" id="2986004">nil</span>&nbsp;<span class="op" id="2986008">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986013">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986025">r</span><span class="op" id="2986026">.</span><span class="ident" id="2986027">buf</span>&nbsp;<span class="op" id="2986031">=</span>&nbsp;<span class="builtinfunc" id="2986033">append</span><span class="op" id="2986039">(</span><span class="ident" id="2986040">r</span><span class="op" id="2986041">.</span><span class="ident" id="2986042">buf</span><span class="op" id="2986045">,</span>&nbsp;<span class="string" id="2986047">&#39;&nbsp;&#39;</span><span class="op" id="2986050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986054">r</span><span class="op" id="2986055">.</span><span class="ident" id="2986056">buf</span>&nbsp;<span class="op" id="2986060">=</span>&nbsp;<span class="builtinfunc" id="2986062">append</span><span class="op" id="2986068">(</span><span class="ident" id="2986069">r</span><span class="op" id="2986070">.</span><span class="ident" id="2986071">buf</span><span class="op" id="2986074">,</span>&nbsp;<span class="ident" id="2986076">line</span><span class="op" id="2986080">...</span><span class="op" id="2986083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986086">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986089">return</span>&nbsp;<span class="ident" id="2986096">r</span><span class="op" id="2986097">.</span><span class="ident" id="2986098">buf</span><span class="op" id="2986101">,</span>&nbsp;<span class="ident" id="2986103">nil</span><br>
<span class="lineno"></span><span class="op" id="2986107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986110">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="2986188">func</span>&nbsp;<span class="op" id="2986193">(</span><span class="ident" id="2986194">r</span>&nbsp;<span class="op" id="2986196">*</span><span class="ident" id="2986197">Reader</span><span class="op" id="2986203">)</span>&nbsp;<span class="ident" id="2986205">skipSpace</span><span class="op" id="2986214">(</span><span class="op" id="2986215">)</span>&nbsp;<span class="builtintype" id="2986217">int</span>&nbsp;<span class="op" id="2986221">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986224">n</span>&nbsp;<span class="op" id="2986226">:=</span>&nbsp;<span class="num" id="2986229">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986232">for</span>&nbsp;<span class="op" id="2986236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986240">c</span><span class="op" id="2986241">,</span>&nbsp;<span class="ident" id="2986243">err</span>&nbsp;<span class="op" id="2986247">:=</span>&nbsp;<span class="ident" id="2986250">r</span><span class="op" id="2986251">.</span><span class="ident" id="2986252">R</span><span class="op" id="2986253">.</span><span class="ident" id="2986254">ReadByte</span><span class="op" id="2986262">(</span><span class="op" id="2986263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986267">if</span>&nbsp;<span class="ident" id="2986270">err</span>&nbsp;<span class="op" id="2986274">!=</span>&nbsp;<span class="ident" id="2986277">nil</span>&nbsp;<span class="op" id="2986281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2986286">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986329">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986341">if</span>&nbsp;<span class="ident" id="2986344">c</span>&nbsp;<span class="op" id="2986346">!=</span>&nbsp;<span class="string" id="2986349">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2986353">&amp;&amp;</span>&nbsp;<span class="ident" id="2986356">c</span>&nbsp;<span class="op" id="2986358">!=</span>&nbsp;<span class="string" id="2986361">&#39;\t&#39;</span>&nbsp;<span class="op" id="2986366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986371">r</span><span class="op" id="2986372">.</span><span class="ident" id="2986373">R</span><span class="op" id="2986374">.</span><span class="ident" id="2986375">UnreadByte</span><span class="op" id="2986385">(</span><span class="op" id="2986386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986391">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986403">n</span><span class="op" id="2986404">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986411">return</span>&nbsp;<span class="ident" id="2986418">n</span><br>
<span class="lineno"></span><span class="op" id="2986420">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="2986423">func</span>&nbsp;<span class="op" id="2986428">(</span><span class="ident" id="2986429">r</span>&nbsp;<span class="op" id="2986431">*</span><span class="ident" id="2986432">Reader</span><span class="op" id="2986438">)</span>&nbsp;<span class="ident" id="2986440">readCodeLine</span><span class="op" id="2986452">(</span><span class="ident" id="2986453">expectCode</span>&nbsp;<span class="builtintype" id="2986464">int</span><span class="op" id="2986467">)</span>&nbsp;<span class="op" id="2986469">(</span><span class="ident" id="2986470">code</span>&nbsp;<span class="builtintype" id="2986475">int</span><span class="op" id="2986478">,</span>&nbsp;<span class="ident" id="2986480">continued</span>&nbsp;<span class="builtintype" id="2986490">bool</span><span class="op" id="2986494">,</span>&nbsp;<span class="ident" id="2986496">message</span>&nbsp;<span class="builtintype" id="2986504">string</span><span class="op" id="2986510">,</span>&nbsp;<span class="ident" id="2986512">err</span>&nbsp;<span class="builtintype" id="2986516">error</span><span class="op" id="2986521">)</span>&nbsp;<span class="op" id="2986523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986526">line</span><span class="op" id="2986530">,</span>&nbsp;<span class="ident" id="2986532">err</span>&nbsp;<span class="op" id="2986536">:=</span>&nbsp;<span class="ident" id="2986539">r</span><span class="op" id="2986540">.</span><span class="ident" id="2986541">ReadLine</span><span class="op" id="2986549">(</span><span class="op" id="2986550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986553">if</span>&nbsp;<span class="ident" id="2986556">err</span>&nbsp;<span class="op" id="2986560">!=</span>&nbsp;<span class="ident" id="2986563">nil</span>&nbsp;<span class="op" id="2986567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986571">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986582">return</span>&nbsp;<span class="ident" id="2986589">parseCodeLine</span><span class="op" id="2986602">(</span><span class="ident" id="2986603">line</span><span class="op" id="2986607">,</span>&nbsp;<span class="ident" id="2986609">expectCode</span><span class="op" id="2986619">)</span><br>
<span class="lineno"></span><span class="op" id="2986621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2986624">func</span>&nbsp;<span class="ident" id="2986629">parseCodeLine</span><span class="op" id="2986642">(</span><span class="ident" id="2986643">line</span>&nbsp;<span class="builtintype" id="2986648">string</span><span class="op" id="2986654">,</span>&nbsp;<span class="ident" id="2986656">expectCode</span>&nbsp;<span class="builtintype" id="2986667">int</span><span class="op" id="2986670">)</span>&nbsp;<span class="op" id="2986672">(</span><span class="ident" id="2986673">code</span>&nbsp;<span class="builtintype" id="2986678">int</span><span class="op" id="2986681">,</span>&nbsp;<span class="ident" id="2986683">continued</span>&nbsp;<span class="builtintype" id="2986693">bool</span><span class="op" id="2986697">,</span>&nbsp;<span class="ident" id="2986699">message</span>&nbsp;<span class="builtintype" id="2986707">string</span><span class="op" id="2986713">,</span>&nbsp;<span class="ident" id="2986715">err</span>&nbsp;<span class="builtintype" id="2986719">error</span><span class="op" id="2986724">)</span>&nbsp;<span class="op" id="2986726">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986729">if</span>&nbsp;<span class="builtinfunc" id="2986732">len</span><span class="op" id="2986735">(</span><span class="ident" id="2986736">line</span><span class="op" id="2986740">)</span>&nbsp;<span class="op" id="2986742">&lt;</span>&nbsp;<span class="num" id="2986744">4</span>&nbsp;<span class="op" id="2986746">||</span>&nbsp;<span class="ident" id="2986749">line</span><span class="op" id="2986753">[</span><span class="num" id="2986754">3</span><span class="op" id="2986755">]</span>&nbsp;<span class="op" id="2986757">!=</span>&nbsp;<span class="string" id="2986760">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2986764">&amp;&amp;</span>&nbsp;<span class="ident" id="2986767">line</span><span class="op" id="2986771">[</span><span class="num" id="2986772">3</span><span class="op" id="2986773">]</span>&nbsp;<span class="op" id="2986775">!=</span>&nbsp;<span class="string" id="2986778">&#39;-&#39;</span>&nbsp;<span class="op" id="2986782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986786">err</span>&nbsp;<span class="op" id="2986790">=</span>&nbsp;<span class="ident" id="2986792">ProtocolError</span><span class="op" id="2986805">(</span><span class="string" id="2986806">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="2986825">+</span>&nbsp;<span class="ident" id="2986827">line</span><span class="op" id="2986831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986835">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986846">continued</span>&nbsp;<span class="op" id="2986856">=</span>&nbsp;<span class="ident" id="2986858">line</span><span class="op" id="2986862">[</span><span class="num" id="2986863">3</span><span class="op" id="2986864">]</span>&nbsp;<span class="op" id="2986866">==</span>&nbsp;<span class="string" id="2986869">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986874">code</span><span class="op" id="2986878">,</span>&nbsp;<span class="ident" id="2986880">err</span>&nbsp;<span class="op" id="2986884">=</span>&nbsp;<span class="ident" id="2986886">strconv</span><span class="op" id="2986893">.</span><span class="ident" id="2986894">Atoi</span><span class="op" id="2986898">(</span><span class="ident" id="2986899">line</span><span class="op" id="2986903">[</span><span class="num" id="2986904">0</span><span class="op" id="2986905">:</span><span class="num" id="2986906">3</span><span class="op" id="2986907">]</span><span class="op" id="2986908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986911">if</span>&nbsp;<span class="ident" id="2986914">err</span>&nbsp;<span class="op" id="2986918">!=</span>&nbsp;<span class="ident" id="2986921">nil</span>&nbsp;<span class="op" id="2986925">||</span>&nbsp;<span class="ident" id="2986928">code</span>&nbsp;<span class="op" id="2986933">&lt;</span>&nbsp;<span class="num" id="2986935">100</span>&nbsp;<span class="op" id="2986939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986943">err</span>&nbsp;<span class="op" id="2986947">=</span>&nbsp;<span class="ident" id="2986949">ProtocolError</span><span class="op" id="2986962">(</span><span class="string" id="2986963">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="2986989">+</span>&nbsp;<span class="ident" id="2986991">line</span><span class="op" id="2986995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986999">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2987007">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2987010">message</span>&nbsp;<span class="op" id="2987018">=</span>&nbsp;<span class="ident" id="2987020">line</span><span class="op" id="2987024">[</span><span class="num" id="2987025">4</span><span class="op" id="2987026">:</span><span class="op" id="2987027">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2987030">if</span>&nbsp;<span class="num" id="2987033">1</span>&nbsp;<span class="op" id="2987035">&lt;=</span>&nbsp;<span class="ident" id="2987038">expectCode</span>&nbsp;<span class="op" id="2987049">&amp;&amp;</span>&nbsp;<span class="ident" id="2987052">expectCode</span>&nbsp;<span class="op" id="2987063">&lt;</span>&nbsp;<span class="num" id="2987065">10</span>&nbsp;<span class="op" id="2987068">&amp;&amp;</span>&nbsp;<span class="ident" id="2987071">code</span><span class="op" id="2987075">/</span><span class="num" id="2987076">100</span>&nbsp;<span class="op" id="2987080">!=</span>&nbsp;<span class="ident" id="2987083">expectCode</span>&nbsp;<span class="op" id="2987094">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="2987099">10</span>&nbsp;<span class="op" id="2987102">&lt;=</span>&nbsp;<span class="ident" id="2987105">expectCode</span>&nbsp;<span class="op" id="2987116">&amp;&amp;</span>&nbsp;<span class="ident" id="2987119">expectCode</span>&nbsp;<span class="op" id="2987130">&lt;</span>&nbsp;<span class="num" id="2987132">100</span>&nbsp;<span class="op" id="2987136">&amp;&amp;</span>&nbsp;<span class="ident" id="2987139">code</span><span class="op" id="2987143">/</span><span class="num" id="2987144">10</span>&nbsp;<span class="op" id="2987147">!=</span>&nbsp;<span class="ident" id="2987150">expectCode</span>&nbsp;<span class="op" id="2987161">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="2987166">100</span>&nbsp;<span class="op" id="2987170">&lt;=</span>&nbsp;<span class="ident" id="2987173">expectCode</span>&nbsp;<span class="op" id="2987184">&amp;&amp;</span>&nbsp;<span class="ident" id="2987187">expectCode</span>&nbsp;<span class="op" id="2987198">&lt;</span>&nbsp;<span class="num" id="2987200">1000</span>&nbsp;<span class="op" id="2987205">&amp;&amp;</span>&nbsp;<span class="ident" id="2987208">code</span>&nbsp;<span class="op" id="2987213">!=</span>&nbsp;<span class="ident" id="2987216">expectCode</span>&nbsp;<span class="op" id="2987227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2987231">err</span>&nbsp;<span class="op" id="2987235">=</span>&nbsp;<span class="op" id="2987237">&amp;</span><span class="ident" id="2987238">Error</span><span class="op" id="2987243">{</span><span class="ident" id="2987244">code</span><span class="op" id="2987248">,</span>&nbsp;<span class="ident" id="2987250">message</span><span class="op" id="2987257">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2987260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2987263">return</span><br>
<span class="lineno"></span><span class="op" id="2987270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2987273">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="2987328">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2987344">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2987403">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="2987470">//&nbsp;&nbsp;&nbsp;&nbsp;220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="2987503">//</span><br>
<span class="lineno">210</span><span class="comment" id="2987506">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="2987578">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="2987641">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2987707">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="2987752">//</span><br>
<span class="lineno">215</span><span class="comment" id="2987755">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2987820">//</span><br>
<span class="lineno"></span><span class="comment" id="2987823">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="2987884">//</span><br>
<span class="lineno"></span><span class="keyword" id="2987887">func</span>&nbsp;<span class="op" id="2987892">(</span><span class="ident" id="2987893">r</span>&nbsp;<span class="op" id="2987895">*</span><span class="ident" id="2987896">Reader</span><span class="op" id="2987902">)</span>&nbsp;<span class="ident" id="2987904">ReadCodeLine</span><span class="op" id="2987916">(</span><span class="ident" id="2987917">expectCode</span>&nbsp;<span class="builtintype" id="2987928">int</span><span class="op" id="2987931">)</span>&nbsp;<span class="op" id="2987933">(</span><span class="ident" id="2987934">code</span>&nbsp;<span class="builtintype" id="2987939">int</span><span class="op" id="2987942">,</span>&nbsp;<span class="ident" id="2987944">message</span>&nbsp;<span class="builtintype" id="2987952">string</span><span class="op" id="2987958">,</span>&nbsp;<span class="ident" id="2987960">err</span>&nbsp;<span class="builtintype" id="2987964">error</span><span class="op" id="2987969">)</span>&nbsp;<span class="op" id="2987971">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2987974">code</span><span class="op" id="2987978">,</span>&nbsp;<span class="ident" id="2987980">continued</span><span class="op" id="2987989">,</span>&nbsp;<span class="ident" id="2987991">message</span><span class="op" id="2987998">,</span>&nbsp;<span class="ident" id="2988000">err</span>&nbsp;<span class="op" id="2988004">:=</span>&nbsp;<span class="ident" id="2988007">r</span><span class="op" id="2988008">.</span><span class="ident" id="2988009">readCodeLine</span><span class="op" id="2988021">(</span><span class="ident" id="2988022">expectCode</span><span class="op" id="2988032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988035">if</span>&nbsp;<span class="ident" id="2988038">err</span>&nbsp;<span class="op" id="2988042">==</span>&nbsp;<span class="ident" id="2988045">nil</span>&nbsp;<span class="op" id="2988049">&amp;&amp;</span>&nbsp;<span class="ident" id="2988052">continued</span>&nbsp;<span class="op" id="2988062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2988066">err</span>&nbsp;<span class="op" id="2988070">=</span>&nbsp;<span class="ident" id="2988072">ProtocolError</span><span class="op" id="2988085">(</span><span class="string" id="2988086">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="2988121">+</span>&nbsp;<span class="ident" id="2988123">message</span><span class="op" id="2988130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2988133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988136">return</span><br>
<span class="lineno">225</span><span class="op" id="2988143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2988146">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="2988203">//</span><br>
<span class="lineno"></span><span class="comment" id="2988206">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="2988229">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2988252">//&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2988259">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="2988282">//</span><br>
<span class="lineno"></span><span class="comment" id="2988285">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="2988360">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="2988431">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2988498">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="2988530">//</span><br>
<span class="lineno"></span><span class="comment" id="2988533">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="2988600">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="2988612">//</span><br>
<span class="lineno"></span><span class="comment" id="2988615">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="2988687">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="2988750">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="2988816">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="2988861">//</span><br>
<span class="lineno"></span><span class="comment" id="2988864">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="2988925">//</span><br>
<span class="lineno"></span><span class="keyword" id="2988928">func</span>&nbsp;<span class="op" id="2988933">(</span><span class="ident" id="2988934">r</span>&nbsp;<span class="op" id="2988936">*</span><span class="ident" id="2988937">Reader</span><span class="op" id="2988943">)</span>&nbsp;<span class="ident" id="2988945">ReadResponse</span><span class="op" id="2988957">(</span><span class="ident" id="2988958">expectCode</span>&nbsp;<span class="builtintype" id="2988969">int</span><span class="op" id="2988972">)</span>&nbsp;<span class="op" id="2988974">(</span><span class="ident" id="2988975">code</span>&nbsp;<span class="builtintype" id="2988980">int</span><span class="op" id="2988983">,</span>&nbsp;<span class="ident" id="2988985">message</span>&nbsp;<span class="builtintype" id="2988993">string</span><span class="op" id="2988999">,</span>&nbsp;<span class="ident" id="2989001">err</span>&nbsp;<span class="builtintype" id="2989005">error</span><span class="op" id="2989010">)</span>&nbsp;<span class="op" id="2989012">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2989015">code</span><span class="op" id="2989019">,</span>&nbsp;<span class="ident" id="2989021">continued</span><span class="op" id="2989030">,</span>&nbsp;<span class="ident" id="2989032">message</span><span class="op" id="2989039">,</span>&nbsp;<span class="ident" id="2989041">err</span>&nbsp;<span class="op" id="2989045">:=</span>&nbsp;<span class="ident" id="2989048">r</span><span class="op" id="2989049">.</span><span class="ident" id="2989050">readCodeLine</span><span class="op" id="2989062">(</span><span class="ident" id="2989063">expectCode</span><span class="op" id="2989073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989076">for</span>&nbsp;<span class="ident" id="2989080">err</span>&nbsp;<span class="op" id="2989084">==</span>&nbsp;<span class="ident" id="2989087">nil</span>&nbsp;<span class="op" id="2989091">&amp;&amp;</span>&nbsp;<span class="ident" id="2989094">continued</span>&nbsp;<span class="op" id="2989104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2989108">line</span><span class="op" id="2989112">,</span>&nbsp;<span class="ident" id="2989114">err</span>&nbsp;<span class="op" id="2989118">:=</span>&nbsp;<span class="ident" id="2989121">r</span><span class="op" id="2989122">.</span><span class="ident" id="2989123">ReadLine</span><span class="op" id="2989131">(</span><span class="op" id="2989132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989136">if</span>&nbsp;<span class="ident" id="2989139">err</span>&nbsp;<span class="op" id="2989143">!=</span>&nbsp;<span class="ident" id="2989146">nil</span>&nbsp;<span class="op" id="2989150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989155">return</span>&nbsp;<span class="num" id="2989162">0</span><span class="op" id="2989163">,</span>&nbsp;<span class="string" id="2989165">&#34;&#34;</span><span class="op" id="2989167">,</span>&nbsp;<span class="ident" id="2989169">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2989175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989180">var</span>&nbsp;<span class="ident" id="2989184">code2</span>&nbsp;<span class="builtintype" id="2989190">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989196">var</span>&nbsp;<span class="ident" id="2989200">moreMessage</span>&nbsp;<span class="builtintype" id="2989212">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2989221">code2</span><span class="op" id="2989226">,</span>&nbsp;<span class="ident" id="2989228">continued</span><span class="op" id="2989237">,</span>&nbsp;<span class="ident" id="2989239">moreMessage</span><span class="op" id="2989250">,</span>&nbsp;<span class="ident" id="2989252">err</span>&nbsp;<span class="op" id="2989256">=</span>&nbsp;<span class="ident" id="2989258">parseCodeLine</span><span class="op" id="2989271">(</span><span class="ident" id="2989272">line</span><span class="op" id="2989276">,</span>&nbsp;<span class="ident" id="2989278">expectCode</span><span class="op" id="2989288">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989292">if</span>&nbsp;<span class="ident" id="2989295">err</span>&nbsp;<span class="op" id="2989299">!=</span>&nbsp;<span class="ident" id="2989302">nil</span>&nbsp;<span class="op" id="2989306">||</span>&nbsp;<span class="ident" id="2989309">code2</span>&nbsp;<span class="op" id="2989315">!=</span>&nbsp;<span class="ident" id="2989318">code</span>&nbsp;<span class="op" id="2989323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2989328">message</span>&nbsp;<span class="op" id="2989336">+=</span>&nbsp;<span class="string" id="2989339">&#34;\n&#34;</span>&nbsp;<span class="op" id="2989344">+</span>&nbsp;<span class="ident" id="2989346">strings</span><span class="op" id="2989353">.</span><span class="ident" id="2989354">TrimRight</span><span class="op" id="2989363">(</span><span class="ident" id="2989364">line</span><span class="op" id="2989368">,</span>&nbsp;<span class="string" id="2989370">&#34;\r\n&#34;</span><span class="op" id="2989376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2989381">continued</span>&nbsp;<span class="op" id="2989391">=</span>&nbsp;<span class="builtintype" id="2989393">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989401">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2989412">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2989416">message</span>&nbsp;<span class="op" id="2989424">+=</span>&nbsp;<span class="string" id="2989427">&#34;\n&#34;</span>&nbsp;<span class="op" id="2989432">+</span>&nbsp;<span class="ident" id="2989434">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2989447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989450">return</span><br>
<span class="lineno"></span><span class="op" id="2989457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="2989460">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2989525">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="2989577">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="2989634">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="2989655">//</span><br>
<span class="lineno">275</span><span class="comment" id="2989658">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="2989715">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="2989783">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2989847">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="2989914">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="2989972">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2990013">//</span><br>
<span class="lineno"></span><span class="comment" id="2990016">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="2990073">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2990132">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="2990203">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="2990265">func</span>&nbsp;<span class="op" id="2990270">(</span><span class="ident" id="2990271">r</span>&nbsp;<span class="op" id="2990273">*</span><span class="ident" id="2990274">Reader</span><span class="op" id="2990280">)</span>&nbsp;<span class="ident" id="2990282">DotReader</span><span class="op" id="2990291">(</span><span class="op" id="2990292">)</span>&nbsp;<span class="ident" id="2990294">io</span><span class="op" id="2990296">.</span><span class="ident" id="2990297">Reader</span>&nbsp;<span class="op" id="2990304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990307">r</span><span class="op" id="2990308">.</span><span class="ident" id="2990309">closeDot</span><span class="op" id="2990317">(</span><span class="op" id="2990318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990321">r</span><span class="op" id="2990322">.</span><span class="ident" id="2990323">dot</span>&nbsp;<span class="op" id="2990327">=</span>&nbsp;<span class="op" id="2990329">&amp;</span><span class="ident" id="2990330">dotReader</span><span class="op" id="2990339">{</span><span class="ident" id="2990340">r</span><span class="op" id="2990341">:</span>&nbsp;<span class="ident" id="2990343">r</span><span class="op" id="2990344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990347">return</span>&nbsp;<span class="ident" id="2990354">r</span><span class="op" id="2990355">.</span><span class="ident" id="2990356">dot</span><br>
<span class="lineno">290</span><span class="op" id="2990360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2990363">type</span>&nbsp;<span class="ident" id="2990368">dotReader</span>&nbsp;<span class="keyword" id="2990378">struct</span>&nbsp;<span class="op" id="2990385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990388">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2990394">*</span><span class="ident" id="2990395">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990403">state</span>&nbsp;<span class="builtintype" id="2990409">int</span><br>
<span class="lineno">295</span><span class="op" id="2990413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2990416">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="2990484">func</span>&nbsp;<span class="op" id="2990489">(</span><span class="ident" id="2990490">d</span>&nbsp;<span class="op" id="2990492">*</span><span class="ident" id="2990493">dotReader</span><span class="op" id="2990502">)</span>&nbsp;<span class="ident" id="2990504">Read</span><span class="op" id="2990508">(</span><span class="ident" id="2990509">b</span>&nbsp;<span class="op" id="2990511">[</span><span class="op" id="2990512">]</span><span class="builtintype" id="2990513">byte</span><span class="op" id="2990517">)</span>&nbsp;<span class="op" id="2990519">(</span><span class="ident" id="2990520">n</span>&nbsp;<span class="builtintype" id="2990522">int</span><span class="op" id="2990525">,</span>&nbsp;<span class="ident" id="2990527">err</span>&nbsp;<span class="builtintype" id="2990531">error</span><span class="op" id="2990536">)</span>&nbsp;<span class="op" id="2990538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2990541">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2990588">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2990643">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990677">const</span>&nbsp;<span class="op" id="2990683">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990687">stateBeginLine</span>&nbsp;<span class="op" id="2990702">=</span>&nbsp;<span class="ident" id="2990704">iota</span>&nbsp;<span class="comment" id="2990709">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990761">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2990783">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990816">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2990838">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990873">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2990895">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990934">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2990956">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990992">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991014">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991048">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991051">br</span>&nbsp;<span class="op" id="2991054">:=</span>&nbsp;<span class="ident" id="2991057">d</span><span class="op" id="2991058">.</span><span class="ident" id="2991059">r</span><span class="op" id="2991060">.</span><span class="ident" id="2991061">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991064">for</span>&nbsp;<span class="ident" id="2991068">n</span>&nbsp;<span class="op" id="2991070">&lt;</span>&nbsp;<span class="builtinfunc" id="2991072">len</span><span class="op" id="2991075">(</span><span class="ident" id="2991076">b</span><span class="op" id="2991077">)</span>&nbsp;<span class="op" id="2991079">&amp;&amp;</span>&nbsp;<span class="ident" id="2991082">d</span><span class="op" id="2991083">.</span><span class="ident" id="2991084">state</span>&nbsp;<span class="op" id="2991090">!=</span>&nbsp;<span class="ident" id="2991093">stateEOF</span>&nbsp;<span class="op" id="2991102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991106">var</span>&nbsp;<span class="ident" id="2991110">c</span>&nbsp;<span class="builtintype" id="2991112">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991119">c</span><span class="op" id="2991120">,</span>&nbsp;<span class="ident" id="2991122">err</span>&nbsp;<span class="op" id="2991126">=</span>&nbsp;<span class="ident" id="2991128">br</span><span class="op" id="2991130">.</span><span class="ident" id="2991131">ReadByte</span><span class="op" id="2991139">(</span><span class="op" id="2991140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991144">if</span>&nbsp;<span class="ident" id="2991147">err</span>&nbsp;<span class="op" id="2991151">!=</span>&nbsp;<span class="ident" id="2991154">nil</span>&nbsp;<span class="op" id="2991158">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991163">if</span>&nbsp;<span class="ident" id="2991166">err</span>&nbsp;<span class="op" id="2991170">==</span>&nbsp;<span class="ident" id="2991173">io</span><span class="op" id="2991175">.</span><span class="ident" id="2991176">EOF</span>&nbsp;<span class="op" id="2991180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991186">err</span>&nbsp;<span class="op" id="2991190">=</span>&nbsp;<span class="ident" id="2991192">io</span><span class="op" id="2991194">.</span><span class="ident" id="2991195">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991220">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991228">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991232">switch</span>&nbsp;<span class="ident" id="2991239">d</span><span class="op" id="2991240">.</span><span class="ident" id="2991241">state</span>&nbsp;<span class="op" id="2991247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991251">case</span>&nbsp;<span class="ident" id="2991256">stateBeginLine</span><span class="op" id="2991270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991275">if</span>&nbsp;<span class="ident" id="2991278">c</span>&nbsp;<span class="op" id="2991280">==</span>&nbsp;<span class="string" id="2991283">&#39;.&#39;</span>&nbsp;<span class="op" id="2991287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991293">d</span><span class="op" id="2991294">.</span><span class="ident" id="2991295">state</span>&nbsp;<span class="op" id="2991301">=</span>&nbsp;<span class="ident" id="2991303">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991316">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991333">if</span>&nbsp;<span class="ident" id="2991336">c</span>&nbsp;<span class="op" id="2991338">==</span>&nbsp;<span class="string" id="2991341">&#39;\r&#39;</span>&nbsp;<span class="op" id="2991346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991352">d</span><span class="op" id="2991353">.</span><span class="ident" id="2991354">state</span>&nbsp;<span class="op" id="2991360">=</span>&nbsp;<span class="ident" id="2991362">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991374">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991386">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991391">d</span><span class="op" id="2991392">.</span><span class="ident" id="2991393">state</span>&nbsp;<span class="op" id="2991399">=</span>&nbsp;<span class="ident" id="2991401">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991414">case</span>&nbsp;<span class="ident" id="2991419">stateDot</span><span class="op" id="2991427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991432">if</span>&nbsp;<span class="ident" id="2991435">c</span>&nbsp;<span class="op" id="2991437">==</span>&nbsp;<span class="string" id="2991440">&#39;\r&#39;</span>&nbsp;<span class="op" id="2991445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991451">d</span><span class="op" id="2991452">.</span><span class="ident" id="2991453">state</span>&nbsp;<span class="op" id="2991459">=</span>&nbsp;<span class="ident" id="2991461">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991476">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991493">if</span>&nbsp;<span class="ident" id="2991496">c</span>&nbsp;<span class="op" id="2991498">==</span>&nbsp;<span class="string" id="2991501">&#39;\n&#39;</span>&nbsp;<span class="op" id="2991506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991512">d</span><span class="op" id="2991513">.</span><span class="ident" id="2991514">state</span>&nbsp;<span class="op" id="2991520">=</span>&nbsp;<span class="ident" id="2991522">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991535">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991552">d</span><span class="op" id="2991553">.</span><span class="ident" id="2991554">state</span>&nbsp;<span class="op" id="2991560">=</span>&nbsp;<span class="ident" id="2991562">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991575">case</span>&nbsp;<span class="ident" id="2991580">stateDotCR</span><span class="op" id="2991590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991595">if</span>&nbsp;<span class="ident" id="2991598">c</span>&nbsp;<span class="op" id="2991600">==</span>&nbsp;<span class="string" id="2991603">&#39;\n&#39;</span>&nbsp;<span class="op" id="2991608">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991614">d</span><span class="op" id="2991615">.</span><span class="ident" id="2991616">state</span>&nbsp;<span class="op" id="2991622">=</span>&nbsp;<span class="ident" id="2991624">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991654">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991679">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991724">br</span><span class="op" id="2991726">.</span><span class="ident" id="2991727">UnreadByte</span><span class="op" id="2991737">(</span><span class="op" id="2991738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991743">c</span>&nbsp;<span class="op" id="2991745">=</span>&nbsp;<span class="string" id="2991747">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991755">d</span><span class="op" id="2991756">.</span><span class="ident" id="2991757">state</span>&nbsp;<span class="op" id="2991763">=</span>&nbsp;<span class="ident" id="2991765">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991778">case</span>&nbsp;<span class="ident" id="2991783">stateCR</span><span class="op" id="2991790">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991795">if</span>&nbsp;<span class="ident" id="2991798">c</span>&nbsp;<span class="op" id="2991800">==</span>&nbsp;<span class="string" id="2991803">&#39;\n&#39;</span>&nbsp;<span class="op" id="2991808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991814">d</span><span class="op" id="2991815">.</span><span class="ident" id="2991816">state</span>&nbsp;<span class="op" id="2991822">=</span>&nbsp;<span class="ident" id="2991824">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991843">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991857">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991896">br</span><span class="op" id="2991898">.</span><span class="ident" id="2991899">UnreadByte</span><span class="op" id="2991909">(</span><span class="op" id="2991910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991915">c</span>&nbsp;<span class="op" id="2991917">=</span>&nbsp;<span class="string" id="2991919">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991927">d</span><span class="op" id="2991928">.</span><span class="ident" id="2991929">state</span>&nbsp;<span class="op" id="2991935">=</span>&nbsp;<span class="ident" id="2991937">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991950">case</span>&nbsp;<span class="ident" id="2991955">stateData</span><span class="op" id="2991964">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991969">if</span>&nbsp;<span class="ident" id="2991972">c</span>&nbsp;<span class="op" id="2991974">==</span>&nbsp;<span class="string" id="2991977">&#39;\r&#39;</span>&nbsp;<span class="op" id="2991982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991988">d</span><span class="op" id="2991989">.</span><span class="ident" id="2991990">state</span>&nbsp;<span class="op" id="2991996">=</span>&nbsp;<span class="ident" id="2991998">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992010">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992027">if</span>&nbsp;<span class="ident" id="2992030">c</span>&nbsp;<span class="op" id="2992032">==</span>&nbsp;<span class="string" id="2992035">&#39;\n&#39;</span>&nbsp;<span class="op" id="2992040">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992046">d</span><span class="op" id="2992047">.</span><span class="ident" id="2992048">state</span>&nbsp;<span class="op" id="2992054">=</span>&nbsp;<span class="ident" id="2992056">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992082">b</span><span class="op" id="2992083">[</span><span class="ident" id="2992084">n</span><span class="op" id="2992085">]</span>&nbsp;<span class="op" id="2992087">=</span>&nbsp;<span class="ident" id="2992089">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992093">n</span><span class="op" id="2992094">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992101">if</span>&nbsp;<span class="ident" id="2992104">err</span>&nbsp;<span class="op" id="2992108">==</span>&nbsp;<span class="ident" id="2992111">nil</span>&nbsp;<span class="op" id="2992115">&amp;&amp;</span>&nbsp;<span class="ident" id="2992118">d</span><span class="op" id="2992119">.</span><span class="ident" id="2992120">state</span>&nbsp;<span class="op" id="2992126">==</span>&nbsp;<span class="ident" id="2992129">stateEOF</span>&nbsp;<span class="op" id="2992138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992142">err</span>&nbsp;<span class="op" id="2992146">=</span>&nbsp;<span class="ident" id="2992148">io</span><span class="op" id="2992150">.</span><span class="ident" id="2992151">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992159">if</span>&nbsp;<span class="ident" id="2992162">err</span>&nbsp;<span class="op" id="2992166">!=</span>&nbsp;<span class="ident" id="2992169">nil</span>&nbsp;<span class="op" id="2992173">&amp;&amp;</span>&nbsp;<span class="ident" id="2992176">d</span><span class="op" id="2992177">.</span><span class="ident" id="2992178">r</span><span class="op" id="2992179">.</span><span class="ident" id="2992180">dot</span>&nbsp;<span class="op" id="2992184">==</span>&nbsp;<span class="ident" id="2992187">d</span>&nbsp;<span class="op" id="2992189">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992193">d</span><span class="op" id="2992194">.</span><span class="ident" id="2992195">r</span><span class="op" id="2992196">.</span><span class="ident" id="2992197">dot</span>&nbsp;<span class="op" id="2992201">=</span>&nbsp;<span class="ident" id="2992203">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992211">return</span><br>
<span class="lineno"></span><span class="op" id="2992218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="2992221">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="2992270">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="2992326">func</span>&nbsp;<span class="op" id="2992331">(</span><span class="ident" id="2992332">r</span>&nbsp;<span class="op" id="2992334">*</span><span class="ident" id="2992335">Reader</span><span class="op" id="2992341">)</span>&nbsp;<span class="ident" id="2992343">closeDot</span><span class="op" id="2992351">(</span><span class="op" id="2992352">)</span>&nbsp;<span class="op" id="2992354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992357">if</span>&nbsp;<span class="ident" id="2992360">r</span><span class="op" id="2992361">.</span><span class="ident" id="2992362">dot</span>&nbsp;<span class="op" id="2992366">==</span>&nbsp;<span class="ident" id="2992369">nil</span>&nbsp;<span class="op" id="2992373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992377">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992388">buf</span>&nbsp;<span class="op" id="2992392">:=</span>&nbsp;<span class="builtinfunc" id="2992395">make</span><span class="op" id="2992399">(</span><span class="op" id="2992400">[</span><span class="op" id="2992401">]</span><span class="builtintype" id="2992402">byte</span><span class="op" id="2992406">,</span>&nbsp;<span class="num" id="2992408">128</span><span class="op" id="2992411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992414">for</span>&nbsp;<span class="ident" id="2992418">r</span><span class="op" id="2992419">.</span><span class="ident" id="2992420">dot</span>&nbsp;<span class="op" id="2992424">!=</span>&nbsp;<span class="ident" id="2992427">nil</span>&nbsp;<span class="op" id="2992431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2992435">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2992475">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992506">r</span><span class="op" id="2992507">.</span><span class="ident" id="2992508">dot</span><span class="op" id="2992511">.</span><span class="ident" id="2992512">Read</span><span class="op" id="2992516">(</span><span class="ident" id="2992517">buf</span><span class="op" id="2992520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992523">}</span><br>
<span class="lineno"></span><span class="op" id="2992525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992528">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="2992595">//</span><br>
<span class="lineno"></span><span class="comment" id="2992598">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="2992680">func</span>&nbsp;<span class="op" id="2992685">(</span><span class="ident" id="2992686">r</span>&nbsp;<span class="op" id="2992688">*</span><span class="ident" id="2992689">Reader</span><span class="op" id="2992695">)</span>&nbsp;<span class="ident" id="2992697">ReadDotBytes</span><span class="op" id="2992709">(</span><span class="op" id="2992710">)</span>&nbsp;<span class="op" id="2992712">(</span><span class="op" id="2992713">[</span><span class="op" id="2992714">]</span><span class="builtintype" id="2992715">byte</span><span class="op" id="2992719">,</span>&nbsp;<span class="builtintype" id="2992721">error</span><span class="op" id="2992726">)</span>&nbsp;<span class="op" id="2992728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992731">return</span>&nbsp;<span class="ident" id="2992738">ioutil</span><span class="op" id="2992744">.</span><span class="ident" id="2992745">ReadAll</span><span class="op" id="2992752">(</span><span class="ident" id="2992753">r</span><span class="op" id="2992754">.</span><span class="ident" id="2992755">DotReader</span><span class="op" id="2992764">(</span><span class="op" id="2992765">)</span><span class="op" id="2992766">)</span><br>
<span class="lineno"></span><span class="op" id="2992768">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="2992771">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2992828">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="2992905">//</span><br>
<span class="lineno"></span><span class="comment" id="2992908">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="2992990">func</span>&nbsp;<span class="op" id="2992995">(</span><span class="ident" id="2992996">r</span>&nbsp;<span class="op" id="2992998">*</span><span class="ident" id="2992999">Reader</span><span class="op" id="2993005">)</span>&nbsp;<span class="ident" id="2993007">ReadDotLines</span><span class="op" id="2993019">(</span><span class="op" id="2993020">)</span>&nbsp;<span class="op" id="2993022">(</span><span class="op" id="2993023">[</span><span class="op" id="2993024">]</span><span class="builtintype" id="2993025">string</span><span class="op" id="2993031">,</span>&nbsp;<span class="builtintype" id="2993033">error</span><span class="op" id="2993038">)</span>&nbsp;<span class="op" id="2993040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2993043">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2993092">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2993142">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993195">var</span>&nbsp;<span class="ident" id="2993199">v</span>&nbsp;<span class="op" id="2993201">[</span><span class="op" id="2993202">]</span><span class="builtintype" id="2993203">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993211">var</span>&nbsp;<span class="ident" id="2993215">err</span>&nbsp;<span class="builtintype" id="2993219">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993226">for</span>&nbsp;<span class="op" id="2993230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993234">var</span>&nbsp;<span class="ident" id="2993238">line</span>&nbsp;<span class="builtintype" id="2993243">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993252">line</span><span class="op" id="2993256">,</span>&nbsp;<span class="ident" id="2993258">err</span>&nbsp;<span class="op" id="2993262">=</span>&nbsp;<span class="ident" id="2993264">r</span><span class="op" id="2993265">.</span><span class="ident" id="2993266">ReadLine</span><span class="op" id="2993274">(</span><span class="op" id="2993275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993279">if</span>&nbsp;<span class="ident" id="2993282">err</span>&nbsp;<span class="op" id="2993286">!=</span>&nbsp;<span class="ident" id="2993289">nil</span>&nbsp;<span class="op" id="2993293">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993298">if</span>&nbsp;<span class="ident" id="2993301">err</span>&nbsp;<span class="op" id="2993305">==</span>&nbsp;<span class="ident" id="2993308">io</span><span class="op" id="2993310">.</span><span class="ident" id="2993311">EOF</span>&nbsp;<span class="op" id="2993315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993321">err</span>&nbsp;<span class="op" id="2993325">=</span>&nbsp;<span class="ident" id="2993327">io</span><span class="op" id="2993329">.</span><span class="ident" id="2993330">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993355">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993363">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2993368">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993421">if</span>&nbsp;<span class="builtinfunc" id="2993424">len</span><span class="op" id="2993427">(</span><span class="ident" id="2993428">line</span><span class="op" id="2993432">)</span>&nbsp;<span class="op" id="2993434">&gt;</span>&nbsp;<span class="num" id="2993436">0</span>&nbsp;<span class="op" id="2993438">&amp;&amp;</span>&nbsp;<span class="ident" id="2993441">line</span><span class="op" id="2993445">[</span><span class="num" id="2993446">0</span><span class="op" id="2993447">]</span>&nbsp;<span class="op" id="2993449">==</span>&nbsp;<span class="string" id="2993452">&#39;.&#39;</span>&nbsp;<span class="op" id="2993456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993461">if</span>&nbsp;<span class="builtinfunc" id="2993464">len</span><span class="op" id="2993467">(</span><span class="ident" id="2993468">line</span><span class="op" id="2993472">)</span>&nbsp;<span class="op" id="2993474">==</span>&nbsp;<span class="num" id="2993477">1</span>&nbsp;<span class="op" id="2993479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993485">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993499">line</span>&nbsp;<span class="op" id="2993504">=</span>&nbsp;<span class="ident" id="2993506">line</span><span class="op" id="2993510">[</span><span class="num" id="2993511">1</span><span class="op" id="2993512">:</span><span class="op" id="2993513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993521">v</span>&nbsp;<span class="op" id="2993523">=</span>&nbsp;<span class="builtinfunc" id="2993525">append</span><span class="op" id="2993531">(</span><span class="ident" id="2993532">v</span><span class="op" id="2993533">,</span>&nbsp;<span class="ident" id="2993535">line</span><span class="op" id="2993539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993542">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993545">return</span>&nbsp;<span class="ident" id="2993552">v</span><span class="op" id="2993553">,</span>&nbsp;<span class="ident" id="2993555">err</span><br>
<span class="lineno"></span><span class="op" id="2993559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2993562">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="2993614">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="2993681">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="2993708">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2993768">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="2993834">//</span><br>
<span class="lineno"></span><span class="comment" id="2993837">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="2993874">//</span><br>
<span class="lineno"></span><span class="comment" id="2993877">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2993896">//&nbsp;&nbsp;&nbsp;&nbsp;Long-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="2993914">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="2993937">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="2993956">//</span><br>
<span class="lineno"></span><span class="comment" id="2993959">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="2994012">//</span><br>
<span class="lineno"></span><span class="comment" id="2994015">//&nbsp;&nbsp;&nbsp;&nbsp;map[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="2994039">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="2994077">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="2994116">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="2994121">//</span><br>
<span class="lineno"></span><span class="keyword" id="2994124">func</span>&nbsp;<span class="op" id="2994129">(</span><span class="ident" id="2994130">r</span>&nbsp;<span class="op" id="2994132">*</span><span class="ident" id="2994133">Reader</span><span class="op" id="2994139">)</span>&nbsp;<span class="ident" id="2994141">ReadMIMEHeader</span><span class="op" id="2994155">(</span><span class="op" id="2994156">)</span>&nbsp;<span class="op" id="2994158">(</span><span class="ident" id="2994159">MIMEHeader</span><span class="op" id="2994169">,</span>&nbsp;<span class="builtintype" id="2994171">error</span><span class="op" id="2994176">)</span>&nbsp;<span class="op" id="2994178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2994181">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2994247">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2994307">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994375">var</span>&nbsp;<span class="ident" id="2994379">strs</span>&nbsp;<span class="op" id="2994384">[</span><span class="op" id="2994385">]</span><span class="builtintype" id="2994386">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994394">hint</span>&nbsp;<span class="op" id="2994399">:=</span>&nbsp;<span class="ident" id="2994402">r</span><span class="op" id="2994403">.</span><span class="ident" id="2994404">upcomingHeaderNewlines</span><span class="op" id="2994426">(</span><span class="op" id="2994427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994430">if</span>&nbsp;<span class="ident" id="2994433">hint</span>&nbsp;<span class="op" id="2994438">&gt;</span>&nbsp;<span class="num" id="2994440">0</span>&nbsp;<span class="op" id="2994442">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994446">strs</span>&nbsp;<span class="op" id="2994451">=</span>&nbsp;<span class="builtinfunc" id="2994453">make</span><span class="op" id="2994457">(</span><span class="op" id="2994458">[</span><span class="op" id="2994459">]</span><span class="builtintype" id="2994460">string</span><span class="op" id="2994466">,</span>&nbsp;<span class="ident" id="2994468">hint</span><span class="op" id="2994472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994479">m</span>&nbsp;<span class="op" id="2994481">:=</span>&nbsp;<span class="builtinfunc" id="2994484">make</span><span class="op" id="2994488">(</span><span class="ident" id="2994489">MIMEHeader</span><span class="op" id="2994499">,</span>&nbsp;<span class="ident" id="2994501">hint</span><span class="op" id="2994505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994508">for</span>&nbsp;<span class="op" id="2994512">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994516">kv</span><span class="op" id="2994518">,</span>&nbsp;<span class="ident" id="2994520">err</span>&nbsp;<span class="op" id="2994524">:=</span>&nbsp;<span class="ident" id="2994527">r</span><span class="op" id="2994528">.</span><span class="ident" id="2994529">readContinuedLineSlice</span><span class="op" id="2994551">(</span><span class="op" id="2994552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994556">if</span>&nbsp;<span class="builtinfunc" id="2994559">len</span><span class="op" id="2994562">(</span><span class="ident" id="2994563">kv</span><span class="op" id="2994565">)</span>&nbsp;<span class="op" id="2994567">==</span>&nbsp;<span class="num" id="2994570">0</span>&nbsp;<span class="op" id="2994572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994577">return</span>&nbsp;<span class="ident" id="2994584">m</span><span class="op" id="2994585">,</span>&nbsp;<span class="ident" id="2994587">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2994598">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2994655">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2994708">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994737">i</span>&nbsp;<span class="op" id="2994739">:=</span>&nbsp;<span class="ident" id="2994742">bytes</span><span class="op" id="2994747">.</span><span class="ident" id="2994748">IndexByte</span><span class="op" id="2994757">(</span><span class="ident" id="2994758">kv</span><span class="op" id="2994760">,</span>&nbsp;<span class="string" id="2994762">&#39;:&#39;</span><span class="op" id="2994765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994769">if</span>&nbsp;<span class="ident" id="2994772">i</span>&nbsp;<span class="op" id="2994774">&lt;</span>&nbsp;<span class="num" id="2994776">0</span>&nbsp;<span class="op" id="2994778">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994783">return</span>&nbsp;<span class="ident" id="2994790">m</span><span class="op" id="2994791">,</span>&nbsp;<span class="ident" id="2994793">ProtocolError</span><span class="op" id="2994806">(</span><span class="string" id="2994807">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="2994838">+</span>&nbsp;<span class="builtintype" id="2994840">string</span><span class="op" id="2994846">(</span><span class="ident" id="2994847">kv</span><span class="op" id="2994849">)</span><span class="op" id="2994850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994858">endKey</span>&nbsp;<span class="op" id="2994865">:=</span>&nbsp;<span class="ident" id="2994868">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994872">for</span>&nbsp;<span class="ident" id="2994876">endKey</span>&nbsp;<span class="op" id="2994883">&gt;</span>&nbsp;<span class="num" id="2994885">0</span>&nbsp;<span class="op" id="2994887">&amp;&amp;</span>&nbsp;<span class="ident" id="2994890">kv</span><span class="op" id="2994892">[</span><span class="ident" id="2994893">endKey</span><span class="op" id="2994899">-</span><span class="num" id="2994900">1</span><span class="op" id="2994901">]</span>&nbsp;<span class="op" id="2994903">==</span>&nbsp;<span class="string" id="2994906">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2994910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994915">endKey</span><span class="op" id="2994921">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994930">key</span>&nbsp;<span class="op" id="2994934">:=</span>&nbsp;<span class="ident" id="2994937">canonicalMIMEHeaderKey</span><span class="op" id="2994959">(</span><span class="ident" id="2994960">kv</span><span class="op" id="2994962">[</span><span class="op" id="2994963">:</span><span class="ident" id="2994964">endKey</span><span class="op" id="2994970">]</span><span class="op" id="2994971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2994976">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995011">i</span><span class="op" id="2995012">++</span>&nbsp;<span class="comment" id="2995015">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995031">for</span>&nbsp;<span class="ident" id="2995035">i</span>&nbsp;<span class="op" id="2995037">&lt;</span>&nbsp;<span class="builtinfunc" id="2995039">len</span><span class="op" id="2995042">(</span><span class="ident" id="2995043">kv</span><span class="op" id="2995045">)</span>&nbsp;<span class="op" id="2995047">&amp;&amp;</span>&nbsp;<span class="op" id="2995050">(</span><span class="ident" id="2995051">kv</span><span class="op" id="2995053">[</span><span class="ident" id="2995054">i</span><span class="op" id="2995055">]</span>&nbsp;<span class="op" id="2995057">==</span>&nbsp;<span class="string" id="2995060">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2995064">||</span>&nbsp;<span class="ident" id="2995067">kv</span><span class="op" id="2995069">[</span><span class="ident" id="2995070">i</span><span class="op" id="2995071">]</span>&nbsp;<span class="op" id="2995073">==</span>&nbsp;<span class="string" id="2995076">&#39;\t&#39;</span><span class="op" id="2995080">)</span>&nbsp;<span class="op" id="2995082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995087">i</span><span class="op" id="2995088">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995097">value</span>&nbsp;<span class="op" id="2995103">:=</span>&nbsp;<span class="builtintype" id="2995106">string</span><span class="op" id="2995112">(</span><span class="ident" id="2995113">kv</span><span class="op" id="2995115">[</span><span class="ident" id="2995116">i</span><span class="op" id="2995117">:</span><span class="op" id="2995118">]</span><span class="op" id="2995119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995124">vv</span>&nbsp;<span class="op" id="2995127">:=</span>&nbsp;<span class="ident" id="2995130">m</span><span class="op" id="2995131">[</span><span class="ident" id="2995132">key</span><span class="op" id="2995135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995139">if</span>&nbsp;<span class="ident" id="2995142">vv</span>&nbsp;<span class="op" id="2995145">==</span>&nbsp;<span class="ident" id="2995148">nil</span>&nbsp;<span class="op" id="2995152">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2995155">len</span><span class="op" id="2995158">(</span><span class="ident" id="2995159">strs</span><span class="op" id="2995163">)</span>&nbsp;<span class="op" id="2995165">&gt;</span>&nbsp;<span class="num" id="2995167">0</span>&nbsp;<span class="op" id="2995169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995174">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995232">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995272">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995333">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995386">vv</span><span class="op" id="2995388">,</span>&nbsp;<span class="ident" id="2995390">strs</span>&nbsp;<span class="op" id="2995395">=</span>&nbsp;<span class="ident" id="2995397">strs</span><span class="op" id="2995401">[</span><span class="op" id="2995402">:</span><span class="num" id="2995403">1</span><span class="op" id="2995404">:</span><span class="num" id="2995405">1</span><span class="op" id="2995406">]</span><span class="op" id="2995407">,</span>&nbsp;<span class="ident" id="2995409">strs</span><span class="op" id="2995413">[</span><span class="num" id="2995414">1</span><span class="op" id="2995415">:</span><span class="op" id="2995416">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995421">vv</span><span class="op" id="2995423">[</span><span class="num" id="2995424">0</span><span class="op" id="2995425">]</span>&nbsp;<span class="op" id="2995427">=</span>&nbsp;<span class="ident" id="2995429">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995438">m</span><span class="op" id="2995439">[</span><span class="ident" id="2995440">key</span><span class="op" id="2995443">]</span>&nbsp;<span class="op" id="2995445">=</span>&nbsp;<span class="ident" id="2995447">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995452">}</span>&nbsp;<span class="keyword" id="2995454">else</span>&nbsp;<span class="op" id="2995459">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995464">m</span><span class="op" id="2995465">[</span><span class="ident" id="2995466">key</span><span class="op" id="2995469">]</span>&nbsp;<span class="op" id="2995471">=</span>&nbsp;<span class="builtinfunc" id="2995473">append</span><span class="op" id="2995479">(</span><span class="ident" id="2995480">vv</span><span class="op" id="2995482">,</span>&nbsp;<span class="ident" id="2995484">value</span><span class="op" id="2995489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995498">if</span>&nbsp;<span class="ident" id="2995501">err</span>&nbsp;<span class="op" id="2995505">!=</span>&nbsp;<span class="ident" id="2995508">nil</span>&nbsp;<span class="op" id="2995512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995517">return</span>&nbsp;<span class="ident" id="2995524">m</span><span class="op" id="2995525">,</span>&nbsp;<span class="ident" id="2995527">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995536">}</span><br>
<span class="lineno"></span><span class="op" id="2995538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2995541">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="2995618">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="2995685">func</span>&nbsp;<span class="op" id="2995690">(</span><span class="ident" id="2995691">r</span>&nbsp;<span class="op" id="2995693">*</span><span class="ident" id="2995694">Reader</span><span class="op" id="2995700">)</span>&nbsp;<span class="ident" id="2995702">upcomingHeaderNewlines</span><span class="op" id="2995724">(</span><span class="op" id="2995725">)</span>&nbsp;<span class="op" id="2995727">(</span><span class="ident" id="2995728">n</span>&nbsp;<span class="builtintype" id="2995730">int</span><span class="op" id="2995733">)</span>&nbsp;<span class="op" id="2995735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995738">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995776">r</span><span class="op" id="2995777">.</span><span class="ident" id="2995778">R</span><span class="op" id="2995779">.</span><span class="ident" id="2995780">Peek</span><span class="op" id="2995784">(</span><span class="num" id="2995785">1</span><span class="op" id="2995786">)</span>&nbsp;<span class="comment" id="2995788">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995821">s</span>&nbsp;<span class="op" id="2995823">:=</span>&nbsp;<span class="ident" id="2995826">r</span><span class="op" id="2995827">.</span><span class="ident" id="2995828">R</span><span class="op" id="2995829">.</span><span class="ident" id="2995830">Buffered</span><span class="op" id="2995838">(</span><span class="op" id="2995839">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995842">if</span>&nbsp;<span class="ident" id="2995845">s</span>&nbsp;<span class="op" id="2995847">==</span>&nbsp;<span class="num" id="2995850">0</span>&nbsp;<span class="op" id="2995852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995856">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995867">peek</span><span class="op" id="2995871">,</span>&nbsp;<span class="ident" id="2995873">_</span>&nbsp;<span class="op" id="2995875">:=</span>&nbsp;<span class="ident" id="2995878">r</span><span class="op" id="2995879">.</span><span class="ident" id="2995880">R</span><span class="op" id="2995881">.</span><span class="ident" id="2995882">Peek</span><span class="op" id="2995886">(</span><span class="ident" id="2995887">s</span><span class="op" id="2995888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995891">for</span>&nbsp;<span class="builtinfunc" id="2995895">len</span><span class="op" id="2995898">(</span><span class="ident" id="2995899">peek</span><span class="op" id="2995903">)</span>&nbsp;<span class="op" id="2995905">&gt;</span>&nbsp;<span class="num" id="2995907">0</span>&nbsp;<span class="op" id="2995909">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995913">i</span>&nbsp;<span class="op" id="2995915">:=</span>&nbsp;<span class="ident" id="2995918">bytes</span><span class="op" id="2995923">.</span><span class="ident" id="2995924">IndexByte</span><span class="op" id="2995933">(</span><span class="ident" id="2995934">peek</span><span class="op" id="2995938">,</span>&nbsp;<span class="string" id="2995940">&#39;\n&#39;</span><span class="op" id="2995944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995948">if</span>&nbsp;<span class="ident" id="2995951">i</span>&nbsp;<span class="op" id="2995953">&lt;</span>&nbsp;<span class="num" id="2995955">3</span>&nbsp;<span class="op" id="2995957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995962">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996021">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996076">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996089">n</span><span class="op" id="2996090">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996095">peek</span>&nbsp;<span class="op" id="2996100">=</span>&nbsp;<span class="ident" id="2996102">peek</span><span class="op" id="2996106">[</span><span class="ident" id="2996107">i</span><span class="op" id="2996108">+</span><span class="num" id="2996109">1</span><span class="op" id="2996110">:</span><span class="op" id="2996111">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996117">return</span><br>
<span class="lineno">535</span><span class="op" id="2996124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2996127">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2996189">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="2996252">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="2996311">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2996369">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2996430">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="2996480">func</span>&nbsp;<span class="ident" id="2996485">CanonicalMIMEHeaderKey</span><span class="op" id="2996507">(</span><span class="ident" id="2996508">s</span>&nbsp;<span class="builtintype" id="2996510">string</span><span class="op" id="2996516">)</span>&nbsp;<span class="builtintype" id="2996518">string</span>&nbsp;<span class="op" id="2996525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996528">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996568">upper</span>&nbsp;<span class="op" id="2996574">:=</span>&nbsp;<span class="builtintype" id="2996577">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996583">for</span>&nbsp;<span class="ident" id="2996587">i</span>&nbsp;<span class="op" id="2996589">:=</span>&nbsp;<span class="num" id="2996592">0</span><span class="op" id="2996593">;</span>&nbsp;<span class="ident" id="2996595">i</span>&nbsp;<span class="op" id="2996597">&lt;</span>&nbsp;<span class="builtinfunc" id="2996599">len</span><span class="op" id="2996602">(</span><span class="ident" id="2996603">s</span><span class="op" id="2996604">)</span><span class="op" id="2996605">;</span>&nbsp;<span class="ident" id="2996607">i</span><span class="op" id="2996608">++</span>&nbsp;<span class="op" id="2996611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996615">c</span>&nbsp;<span class="op" id="2996617">:=</span>&nbsp;<span class="ident" id="2996620">s</span><span class="op" id="2996621">[</span><span class="ident" id="2996622">i</span><span class="op" id="2996623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996627">if</span>&nbsp;<span class="ident" id="2996630">upper</span>&nbsp;<span class="op" id="2996636">&amp;&amp;</span>&nbsp;<span class="string" id="2996639">&#39;a&#39;</span>&nbsp;<span class="op" id="2996643">&lt;=</span>&nbsp;<span class="ident" id="2996646">c</span>&nbsp;<span class="op" id="2996648">&amp;&amp;</span>&nbsp;<span class="ident" id="2996651">c</span>&nbsp;<span class="op" id="2996653">&lt;=</span>&nbsp;<span class="string" id="2996656">&#39;z&#39;</span>&nbsp;<span class="op" id="2996660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996665">return</span>&nbsp;<span class="ident" id="2996672">canonicalMIMEHeaderKey</span><span class="op" id="2996694">(</span><span class="op" id="2996695">[</span><span class="op" id="2996696">]</span><span class="builtintype" id="2996697">byte</span><span class="op" id="2996701">(</span><span class="ident" id="2996702">s</span><span class="op" id="2996703">)</span><span class="op" id="2996704">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996712">if</span>&nbsp;<span class="op" id="2996715">!</span><span class="ident" id="2996716">upper</span>&nbsp;<span class="op" id="2996722">&amp;&amp;</span>&nbsp;<span class="string" id="2996725">&#39;A&#39;</span>&nbsp;<span class="op" id="2996729">&lt;=</span>&nbsp;<span class="ident" id="2996732">c</span>&nbsp;<span class="op" id="2996734">&amp;&amp;</span>&nbsp;<span class="ident" id="2996737">c</span>&nbsp;<span class="op" id="2996739">&lt;=</span>&nbsp;<span class="string" id="2996742">&#39;Z&#39;</span>&nbsp;<span class="op" id="2996746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996751">return</span>&nbsp;<span class="ident" id="2996758">canonicalMIMEHeaderKey</span><span class="op" id="2996780">(</span><span class="op" id="2996781">[</span><span class="op" id="2996782">]</span><span class="builtintype" id="2996783">byte</span><span class="op" id="2996787">(</span><span class="ident" id="2996788">s</span><span class="op" id="2996789">)</span><span class="op" id="2996790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996798">upper</span>&nbsp;<span class="op" id="2996804">=</span>&nbsp;<span class="ident" id="2996806">c</span>&nbsp;<span class="op" id="2996808">==</span>&nbsp;<span class="string" id="2996811">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996819">return</span>&nbsp;<span class="ident" id="2996826">s</span><br>
<span class="lineno"></span><span class="op" id="2996828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2996831">const</span>&nbsp;<span class="ident" id="2996837">toLower</span>&nbsp;<span class="op" id="2996845">=</span>&nbsp;<span class="string" id="2996847">&#39;a&#39;</span>&nbsp;<span class="op" id="2996851">-</span>&nbsp;<span class="string" id="2996853">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="2996858">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2996922">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2996988">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2996999">func</span>&nbsp;<span class="ident" id="2997004">canonicalMIMEHeaderKey</span><span class="op" id="2997026">(</span><span class="ident" id="2997027">a</span>&nbsp;<span class="op" id="2997029">[</span><span class="op" id="2997030">]</span><span class="builtintype" id="2997031">byte</span><span class="op" id="2997035">)</span>&nbsp;<span class="builtintype" id="2997037">string</span>&nbsp;<span class="op" id="2997044">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997047">upper</span>&nbsp;<span class="op" id="2997053">:=</span>&nbsp;<span class="builtintype" id="2997056">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997062">for</span>&nbsp;<span class="ident" id="2997066">i</span><span class="op" id="2997067">,</span>&nbsp;<span class="ident" id="2997069">c</span>&nbsp;<span class="op" id="2997071">:=</span>&nbsp;<span class="keyword" id="2997074">range</span>&nbsp;<span class="ident" id="2997080">a</span>&nbsp;<span class="op" id="2997082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997086">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997129">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997166">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997210">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997266">if</span>&nbsp;<span class="ident" id="2997269">c</span>&nbsp;<span class="op" id="2997271">==</span>&nbsp;<span class="string" id="2997274">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2997278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997283">c</span>&nbsp;<span class="op" id="2997285">=</span>&nbsp;<span class="string" id="2997287">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997293">}</span>&nbsp;<span class="keyword" id="2997295">else</span>&nbsp;<span class="keyword" id="2997300">if</span>&nbsp;<span class="ident" id="2997303">upper</span>&nbsp;<span class="op" id="2997309">&amp;&amp;</span>&nbsp;<span class="string" id="2997312">&#39;a&#39;</span>&nbsp;<span class="op" id="2997316">&lt;=</span>&nbsp;<span class="ident" id="2997319">c</span>&nbsp;<span class="op" id="2997321">&amp;&amp;</span>&nbsp;<span class="ident" id="2997324">c</span>&nbsp;<span class="op" id="2997326">&lt;=</span>&nbsp;<span class="string" id="2997329">&#39;z&#39;</span>&nbsp;<span class="op" id="2997333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997338">c</span>&nbsp;<span class="op" id="2997340">-=</span>&nbsp;<span class="ident" id="2997343">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997353">}</span>&nbsp;<span class="keyword" id="2997355">else</span>&nbsp;<span class="keyword" id="2997360">if</span>&nbsp;<span class="op" id="2997363">!</span><span class="ident" id="2997364">upper</span>&nbsp;<span class="op" id="2997370">&amp;&amp;</span>&nbsp;<span class="string" id="2997373">&#39;A&#39;</span>&nbsp;<span class="op" id="2997377">&lt;=</span>&nbsp;<span class="ident" id="2997380">c</span>&nbsp;<span class="op" id="2997382">&amp;&amp;</span>&nbsp;<span class="ident" id="2997385">c</span>&nbsp;<span class="op" id="2997387">&lt;=</span>&nbsp;<span class="string" id="2997390">&#39;Z&#39;</span>&nbsp;<span class="op" id="2997394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997399">c</span>&nbsp;<span class="op" id="2997401">+=</span>&nbsp;<span class="ident" id="2997404">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997418">a</span><span class="op" id="2997419">[</span><span class="ident" id="2997420">i</span><span class="op" id="2997421">]</span>&nbsp;<span class="op" id="2997423">=</span>&nbsp;<span class="ident" id="2997425">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997429">upper</span>&nbsp;<span class="op" id="2997435">=</span>&nbsp;<span class="ident" id="2997437">c</span>&nbsp;<span class="op" id="2997439">==</span>&nbsp;<span class="string" id="2997442">&#39;-&#39;</span>&nbsp;<span class="comment" id="2997446">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997467">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997529">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997589">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997620">if</span>&nbsp;<span class="ident" id="2997623">v</span>&nbsp;<span class="op" id="2997625">:=</span>&nbsp;<span class="ident" id="2997628">commonHeader</span><span class="op" id="2997640">[</span><span class="builtintype" id="2997641">string</span><span class="op" id="2997647">(</span><span class="ident" id="2997648">a</span><span class="op" id="2997649">)</span><span class="op" id="2997650">]</span><span class="op" id="2997651">;</span>&nbsp;<span class="ident" id="2997653">v</span>&nbsp;<span class="op" id="2997655">!=</span>&nbsp;<span class="string" id="2997658">&#34;&#34;</span>&nbsp;<span class="op" id="2997661">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997665">return</span>&nbsp;<span class="ident" id="2997672">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997678">return</span>&nbsp;<span class="builtintype" id="2997685">string</span><span class="op" id="2997691">(</span><span class="ident" id="2997692">a</span><span class="op" id="2997693">)</span><br>
<span class="lineno"></span><span class="op" id="2997695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="2997698">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2997745">var</span>&nbsp;<span class="ident" id="2997749">commonHeader</span>&nbsp;<span class="op" id="2997762">=</span>&nbsp;<span class="builtinfunc" id="2997764">make</span><span class="op" id="2997768">(</span><span class="keyword" id="2997769">map</span><span class="op" id="2997772">[</span><span class="builtintype" id="2997773">string</span><span class="op" id="2997779">]</span><span class="builtintype" id="2997780">string</span><span class="op" id="2997786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2997789">func</span>&nbsp;<span class="ident" id="2997794">init</span><span class="op" id="2997798">(</span><span class="op" id="2997799">)</span>&nbsp;<span class="op" id="2997801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997804">for</span>&nbsp;<span class="ident" id="2997808">_</span><span class="op" id="2997809">,</span>&nbsp;<span class="ident" id="2997811">v</span>&nbsp;<span class="op" id="2997813">:=</span>&nbsp;<span class="keyword" id="2997816">range</span>&nbsp;<span class="op" id="2997822">[</span><span class="op" id="2997823">]</span><span class="builtintype" id="2997824">string</span><span class="op" id="2997830">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997834">&#34;Accept&#34;</span><span class="op" id="2997842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997846">&#34;Accept-Charset&#34;</span><span class="op" id="2997862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997866">&#34;Accept-Encoding&#34;</span><span class="op" id="2997883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997887">&#34;Accept-Language&#34;</span><span class="op" id="2997904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997908">&#34;Accept-Ranges&#34;</span><span class="op" id="2997923">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997927">&#34;Cache-Control&#34;</span><span class="op" id="2997942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997946">&#34;Cc&#34;</span><span class="op" id="2997950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997954">&#34;Connection&#34;</span><span class="op" id="2997966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997970">&#34;Content-Id&#34;</span><span class="op" id="2997982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2997986">&#34;Content-Language&#34;</span><span class="op" id="2998004">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998008">&#34;Content-Length&#34;</span><span class="op" id="2998024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998028">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="2998055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998059">&#34;Content-Type&#34;</span><span class="op" id="2998073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998077">&#34;Cookie&#34;</span><span class="op" id="2998085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998089">&#34;Date&#34;</span><span class="op" id="2998095">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998099">&#34;Dkim-Signature&#34;</span><span class="op" id="2998115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998119">&#34;Etag&#34;</span><span class="op" id="2998125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998129">&#34;Expires&#34;</span><span class="op" id="2998138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998142">&#34;From&#34;</span><span class="op" id="2998148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998152">&#34;Host&#34;</span><span class="op" id="2998158">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998162">&#34;If-Modified-Since&#34;</span><span class="op" id="2998181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998185">&#34;If-None-Match&#34;</span><span class="op" id="2998200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998204">&#34;In-Reply-To&#34;</span><span class="op" id="2998217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998221">&#34;Last-Modified&#34;</span><span class="op" id="2998236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998240">&#34;Location&#34;</span><span class="op" id="2998250">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998254">&#34;Message-Id&#34;</span><span class="op" id="2998266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998270">&#34;Mime-Version&#34;</span><span class="op" id="2998284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998288">&#34;Pragma&#34;</span><span class="op" id="2998296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998300">&#34;Received&#34;</span><span class="op" id="2998310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998314">&#34;Return-Path&#34;</span><span class="op" id="2998327">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998331">&#34;Server&#34;</span><span class="op" id="2998339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998343">&#34;Set-Cookie&#34;</span><span class="op" id="2998355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998359">&#34;Subject&#34;</span><span class="op" id="2998368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998372">&#34;To&#34;</span><span class="op" id="2998376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998380">&#34;User-Agent&#34;</span><span class="op" id="2998392">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998396">&#34;Via&#34;</span><span class="op" id="2998401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998405">&#34;X-Forwarded-For&#34;</span><span class="op" id="2998422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998426">&#34;X-Imforwards&#34;</span><span class="op" id="2998440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2998444">&#34;X-Powered-By&#34;</span><span class="op" id="2998458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998461">}</span>&nbsp;<span class="op" id="2998463">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998467">commonHeader</span><span class="op" id="2998479">[</span><span class="ident" id="2998480">v</span><span class="op" id="2998481">]</span>&nbsp;<span class="op" id="2998483">=</span>&nbsp;<span class="ident" id="2998485">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998488">}</span><br>
<span class="lineno"></span><span class="op" id="2998490">}</span>
</div>
</body>
</html>
