<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html" class="current">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7234274">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7234329">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7234383">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7234434">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7234467">package</span>&nbsp;<span class="ident" id="7234475">syslog</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7234483">import</span>&nbsp;<span class="op" id="7234490">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234493">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234502">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234509">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234515">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234528">&#34;log&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234535">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234542">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234548">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234556">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7234567">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="7234574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7234577">func</span>&nbsp;<span class="ident" id="7234582">runPktSyslog</span><span class="op" id="7234594">(</span><span class="ident" id="7234595">c</span>&nbsp;<span class="ident" id="7234597">net</span><span class="op" id="7234600">.</span><span class="ident" id="7234601">PacketConn</span><span class="op" id="7234611">,</span>&nbsp;<span class="ident" id="7234613">done</span>&nbsp;<span class="keyword" id="7234618">chan</span><span class="op" id="7234622">&lt;-</span>&nbsp;<span class="builtintype" id="7234625">string</span><span class="op" id="7234631">)</span>&nbsp;<span class="op" id="7234633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234636">var</span>&nbsp;<span class="ident" id="7234640">buf</span>&nbsp;<span class="op" id="7234644">[</span><span class="num" id="7234645">4096</span><span class="op" id="7234649">]</span><span class="builtintype" id="7234650">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234656">var</span>&nbsp;<span class="ident" id="7234660">rcvd</span>&nbsp;<span class="builtintype" id="7234665">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7234673">ct</span>&nbsp;<span class="op" id="7234676">:=</span>&nbsp;<span class="num" id="7234679">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234682">for</span>&nbsp;<span class="op" id="7234686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234690">var</span>&nbsp;<span class="ident" id="7234694">n</span>&nbsp;<span class="builtintype" id="7234696">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234702">var</span>&nbsp;<span class="ident" id="7234706">err</span>&nbsp;<span class="builtintype" id="7234710">error</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7234719">c</span><span class="op" id="7234720">.</span><span class="ident" id="7234721">SetReadDeadline</span><span class="op" id="7234736">(</span><span class="ident" id="7234737">time</span><span class="op" id="7234741">.</span><span class="ident" id="7234742">Now</span><span class="op" id="7234745">(</span><span class="op" id="7234746">)</span><span class="op" id="7234747">.</span><span class="ident" id="7234748">Add</span><span class="op" id="7234751">(</span><span class="num" id="7234752">100</span>&nbsp;<span class="op" id="7234756">*</span>&nbsp;<span class="ident" id="7234758">time</span><span class="op" id="7234762">.</span><span class="ident" id="7234763">Millisecond</span><span class="op" id="7234774">)</span><span class="op" id="7234775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7234779">n</span><span class="op" id="7234780">,</span>&nbsp;<span class="ident" id="7234782">_</span><span class="op" id="7234783">,</span>&nbsp;<span class="ident" id="7234785">err</span>&nbsp;<span class="op" id="7234789">=</span>&nbsp;<span class="ident" id="7234791">c</span><span class="op" id="7234792">.</span><span class="ident" id="7234793">ReadFrom</span><span class="op" id="7234801">(</span><span class="ident" id="7234802">buf</span><span class="op" id="7234805">[</span><span class="op" id="7234806">:</span><span class="op" id="7234807">]</span><span class="op" id="7234808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7234812">rcvd</span>&nbsp;<span class="op" id="7234817">+=</span>&nbsp;<span class="builtintype" id="7234820">string</span><span class="op" id="7234826">(</span><span class="ident" id="7234827">buf</span><span class="op" id="7234830">[</span><span class="op" id="7234831">:</span><span class="ident" id="7234832">n</span><span class="op" id="7234833">]</span><span class="op" id="7234834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234838">if</span>&nbsp;<span class="ident" id="7234841">err</span>&nbsp;<span class="op" id="7234845">!=</span>&nbsp;<span class="builtintype" id="7234848">nil</span>&nbsp;<span class="op" id="7234852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234857">if</span>&nbsp;<span class="ident" id="7234860">oe</span><span class="op" id="7234862">,</span>&nbsp;<span class="ident" id="7234864">ok</span>&nbsp;<span class="op" id="7234867">:=</span>&nbsp;<span class="ident" id="7234870">err</span><span class="op" id="7234873">.</span><span class="op" id="7234874">(</span><span class="op" id="7234875">*</span><span class="ident" id="7234876">net</span><span class="op" id="7234879">.</span><span class="ident" id="7234880">OpError</span><span class="op" id="7234887">)</span><span class="op" id="7234888">;</span>&nbsp;<span class="ident" id="7234890">ok</span>&nbsp;<span class="op" id="7234893">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234899">if</span>&nbsp;<span class="ident" id="7234902">ct</span>&nbsp;<span class="op" id="7234905">&lt;</span>&nbsp;<span class="num" id="7234907">3</span>&nbsp;<span class="op" id="7234909">&amp;&amp;</span>&nbsp;<span class="ident" id="7234912">oe</span><span class="op" id="7234914">.</span><span class="ident" id="7234915">Temporary</span><span class="op" id="7234924">(</span><span class="op" id="7234925">)</span>&nbsp;<span class="op" id="7234927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7234934">ct</span><span class="op" id="7234936">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234944">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7234957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7234962">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7234967">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7234975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7234978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7234981">c</span><span class="op" id="7234982">.</span><span class="ident" id="7234983">Close</span><span class="op" id="7234988">(</span><span class="op" id="7234989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7234992">done</span>&nbsp;<span class="op" id="7234997">&lt;-</span>&nbsp;<span class="ident" id="7235000">rcvd</span><br>
<span class="lineno">45</span><span class="op" id="7235005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7235008">var</span>&nbsp;<span class="ident" id="7235012">crashy</span>&nbsp;<span class="op" id="7235019">=</span>&nbsp;<span class="builtintype" id="7235021">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7235028">func</span>&nbsp;<span class="ident" id="7235033">runStreamSyslog</span><span class="op" id="7235048">(</span><span class="ident" id="7235049">l</span>&nbsp;<span class="ident" id="7235051">net</span><span class="op" id="7235054">.</span><span class="ident" id="7235055">Listener</span><span class="op" id="7235063">,</span>&nbsp;<span class="ident" id="7235065">done</span>&nbsp;<span class="keyword" id="7235070">chan</span><span class="op" id="7235074">&lt;-</span>&nbsp;<span class="builtintype" id="7235077">string</span><span class="op" id="7235083">,</span>&nbsp;<span class="ident" id="7235085">wg</span>&nbsp;<span class="op" id="7235088">*</span><span class="ident" id="7235089">sync</span><span class="op" id="7235093">.</span><span class="ident" id="7235094">WaitGroup</span><span class="op" id="7235103">)</span>&nbsp;<span class="op" id="7235105">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235108">for</span>&nbsp;<span class="op" id="7235112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235116">var</span>&nbsp;<span class="ident" id="7235120">c</span>&nbsp;<span class="ident" id="7235122">net</span><span class="op" id="7235125">.</span><span class="ident" id="7235126">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235133">var</span>&nbsp;<span class="ident" id="7235137">err</span>&nbsp;<span class="builtintype" id="7235141">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235149">if</span>&nbsp;<span class="ident" id="7235152">c</span><span class="op" id="7235153">,</span>&nbsp;<span class="ident" id="7235155">err</span>&nbsp;<span class="op" id="7235159">=</span>&nbsp;<span class="ident" id="7235161">l</span><span class="op" id="7235162">.</span><span class="ident" id="7235163">Accept</span><span class="op" id="7235169">(</span><span class="op" id="7235170">)</span><span class="op" id="7235171">;</span>&nbsp;<span class="ident" id="7235173">err</span>&nbsp;<span class="op" id="7235177">!=</span>&nbsp;<span class="builtintype" id="7235180">nil</span>&nbsp;<span class="op" id="7235184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235189">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235202">wg</span><span class="op" id="7235204">.</span><span class="ident" id="7235205">Add</span><span class="op" id="7235208">(</span><span class="num" id="7235209">1</span><span class="op" id="7235210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235214">go</span>&nbsp;<span class="keyword" id="7235217">func</span><span class="op" id="7235221">(</span><span class="ident" id="7235222">c</span>&nbsp;<span class="ident" id="7235224">net</span><span class="op" id="7235227">.</span><span class="ident" id="7235228">Conn</span><span class="op" id="7235232">)</span>&nbsp;<span class="op" id="7235234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235239">defer</span>&nbsp;<span class="ident" id="7235245">wg</span><span class="op" id="7235247">.</span><span class="ident" id="7235248">Done</span><span class="op" id="7235252">(</span><span class="op" id="7235253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235258">c</span><span class="op" id="7235259">.</span><span class="ident" id="7235260">SetReadDeadline</span><span class="op" id="7235275">(</span><span class="ident" id="7235276">time</span><span class="op" id="7235280">.</span><span class="ident" id="7235281">Now</span><span class="op" id="7235284">(</span><span class="op" id="7235285">)</span><span class="op" id="7235286">.</span><span class="ident" id="7235287">Add</span><span class="op" id="7235290">(</span><span class="num" id="7235291">5</span>&nbsp;<span class="op" id="7235293">*</span>&nbsp;<span class="ident" id="7235295">time</span><span class="op" id="7235299">.</span><span class="ident" id="7235300">Second</span><span class="op" id="7235306">)</span><span class="op" id="7235307">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235312">b</span>&nbsp;<span class="op" id="7235314">:=</span>&nbsp;<span class="ident" id="7235317">bufio</span><span class="op" id="7235322">.</span><span class="ident" id="7235323">NewReader</span><span class="op" id="7235332">(</span><span class="ident" id="7235333">c</span><span class="op" id="7235334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235339">for</span>&nbsp;<span class="ident" id="7235343">ct</span>&nbsp;<span class="op" id="7235346">:=</span>&nbsp;<span class="num" id="7235349">1</span><span class="op" id="7235350">;</span>&nbsp;<span class="op" id="7235352">!</span><span class="ident" id="7235353">crashy</span>&nbsp;<span class="op" id="7235360">||</span>&nbsp;<span class="ident" id="7235363">ct</span><span class="op" id="7235365">&amp;</span><span class="num" id="7235366">7</span>&nbsp;<span class="op" id="7235368">!=</span>&nbsp;<span class="num" id="7235371">0</span><span class="op" id="7235372">;</span>&nbsp;<span class="ident" id="7235374">ct</span><span class="op" id="7235376">++</span>&nbsp;<span class="op" id="7235379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235385">s</span><span class="op" id="7235386">,</span>&nbsp;<span class="ident" id="7235388">err</span>&nbsp;<span class="op" id="7235392">:=</span>&nbsp;<span class="ident" id="7235395">b</span><span class="op" id="7235396">.</span><span class="ident" id="7235397">ReadString</span><span class="op" id="7235407">(</span><span class="string" id="7235408">&#39;\n&#39;</span><span class="op" id="7235412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235418">if</span>&nbsp;<span class="ident" id="7235421">err</span>&nbsp;<span class="op" id="7235425">!=</span>&nbsp;<span class="builtintype" id="7235428">nil</span>&nbsp;<span class="op" id="7235432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235439">break</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235455">done</span>&nbsp;<span class="op" id="7235460">&lt;-</span>&nbsp;<span class="ident" id="7235463">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235473">c</span><span class="op" id="7235474">.</span><span class="ident" id="7235475">Close</span><span class="op" id="7235480">(</span><span class="op" id="7235481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235485">}</span><span class="op" id="7235486">(</span><span class="ident" id="7235487">c</span><span class="op" id="7235488">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235491">}</span><br>
<span class="lineno"></span><span class="op" id="7235493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7235496">func</span>&nbsp;<span class="ident" id="7235501">startServer</span><span class="op" id="7235512">(</span><span class="ident" id="7235513">n</span><span class="op" id="7235514">,</span>&nbsp;<span class="ident" id="7235516">la</span>&nbsp;<span class="builtintype" id="7235519">string</span><span class="op" id="7235525">,</span>&nbsp;<span class="ident" id="7235527">done</span>&nbsp;<span class="keyword" id="7235532">chan</span><span class="op" id="7235536">&lt;-</span>&nbsp;<span class="builtintype" id="7235539">string</span><span class="op" id="7235545">)</span>&nbsp;<span class="op" id="7235547">(</span><span class="ident" id="7235548">addr</span>&nbsp;<span class="builtintype" id="7235553">string</span><span class="op" id="7235559">,</span>&nbsp;<span class="ident" id="7235561">sock</span>&nbsp;<span class="ident" id="7235566">io</span><span class="op" id="7235568">.</span><span class="ident" id="7235569">Closer</span><span class="op" id="7235575">,</span>&nbsp;<span class="ident" id="7235577">wg</span>&nbsp;<span class="op" id="7235580">*</span><span class="ident" id="7235581">sync</span><span class="op" id="7235585">.</span><span class="ident" id="7235586">WaitGroup</span><span class="op" id="7235595">)</span>&nbsp;<span class="op" id="7235597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235600">if</span>&nbsp;<span class="ident" id="7235603">n</span>&nbsp;<span class="op" id="7235605">==</span>&nbsp;<span class="string" id="7235608">&#34;udp&#34;</span>&nbsp;<span class="op" id="7235614">||</span>&nbsp;<span class="ident" id="7235617">n</span>&nbsp;<span class="op" id="7235619">==</span>&nbsp;<span class="string" id="7235622">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7235628">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235632">la</span>&nbsp;<span class="op" id="7235635">=</span>&nbsp;<span class="string" id="7235637">&#34;127.0.0.1:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235652">}</span>&nbsp;<span class="keyword" id="7235654">else</span>&nbsp;<span class="op" id="7235659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7235663">//&nbsp;unix&nbsp;and&nbsp;unixgram:&nbsp;choose&nbsp;an&nbsp;address&nbsp;if&nbsp;none&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235719">if</span>&nbsp;<span class="ident" id="7235722">la</span>&nbsp;<span class="op" id="7235725">==</span>&nbsp;<span class="string" id="7235728">&#34;&#34;</span>&nbsp;<span class="op" id="7235731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7235736">//&nbsp;use&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235791">f</span><span class="op" id="7235792">,</span>&nbsp;<span class="ident" id="7235794">err</span>&nbsp;<span class="op" id="7235798">:=</span>&nbsp;<span class="ident" id="7235801">ioutil</span><span class="op" id="7235807">.</span><span class="ident" id="7235808">TempFile</span><span class="op" id="7235816">(</span><span class="string" id="7235817">&#34;&#34;</span><span class="op" id="7235819">,</span>&nbsp;<span class="string" id="7235821">&#34;syslogtest&#34;</span><span class="op" id="7235833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235838">if</span>&nbsp;<span class="ident" id="7235841">err</span>&nbsp;<span class="op" id="7235845">!=</span>&nbsp;<span class="builtintype" id="7235848">nil</span>&nbsp;<span class="op" id="7235852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235858">log</span><span class="op" id="7235861">.</span><span class="ident" id="7235862">Fatal</span><span class="op" id="7235867">(</span><span class="string" id="7235868">&#34;TempFile:&nbsp;&#34;</span><span class="op" id="7235880">,</span>&nbsp;<span class="ident" id="7235882">err</span><span class="op" id="7235885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235895">f</span><span class="op" id="7235896">.</span><span class="ident" id="7235897">Close</span><span class="op" id="7235902">(</span><span class="op" id="7235903">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235908">la</span>&nbsp;<span class="op" id="7235911">=</span>&nbsp;<span class="ident" id="7235913">f</span><span class="op" id="7235914">.</span><span class="ident" id="7235915">Name</span><span class="op" id="7235919">(</span><span class="op" id="7235920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235928">os</span><span class="op" id="7235930">.</span><span class="ident" id="7235931">Remove</span><span class="op" id="7235937">(</span><span class="ident" id="7235938">la</span><span class="op" id="7235940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7235943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7235947">wg</span>&nbsp;<span class="op" id="7235950">=</span>&nbsp;<span class="builtinfunc" id="7235952">new</span><span class="op" id="7235955">(</span><span class="ident" id="7235956">sync</span><span class="op" id="7235960">.</span><span class="ident" id="7235961">WaitGroup</span><span class="op" id="7235970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7235973">if</span>&nbsp;<span class="ident" id="7235976">n</span>&nbsp;<span class="op" id="7235978">==</span>&nbsp;<span class="string" id="7235981">&#34;udp&#34;</span>&nbsp;<span class="op" id="7235987">||</span>&nbsp;<span class="ident" id="7235990">n</span>&nbsp;<span class="op" id="7235992">==</span>&nbsp;<span class="string" id="7235995">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="7236006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236010">l</span><span class="op" id="7236011">,</span>&nbsp;<span class="ident" id="7236013">e</span>&nbsp;<span class="op" id="7236015">:=</span>&nbsp;<span class="ident" id="7236018">net</span><span class="op" id="7236021">.</span><span class="ident" id="7236022">ListenPacket</span><span class="op" id="7236034">(</span><span class="ident" id="7236035">n</span><span class="op" id="7236036">,</span>&nbsp;<span class="ident" id="7236038">la</span><span class="op" id="7236040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236044">if</span>&nbsp;<span class="ident" id="7236047">e</span>&nbsp;<span class="op" id="7236049">!=</span>&nbsp;<span class="builtintype" id="7236052">nil</span>&nbsp;<span class="op" id="7236056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236061">log</span><span class="op" id="7236064">.</span><span class="ident" id="7236065">Fatalf</span><span class="op" id="7236071">(</span><span class="string" id="7236072">&#34;startServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7236096">,</span>&nbsp;<span class="ident" id="7236098">e</span><span class="op" id="7236099">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236107">addr</span>&nbsp;<span class="op" id="7236112">=</span>&nbsp;<span class="ident" id="7236114">l</span><span class="op" id="7236115">.</span><span class="ident" id="7236116">LocalAddr</span><span class="op" id="7236125">(</span><span class="op" id="7236126">)</span><span class="op" id="7236127">.</span><span class="ident" id="7236128">String</span><span class="op" id="7236134">(</span><span class="op" id="7236135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236139">sock</span>&nbsp;<span class="op" id="7236144">=</span>&nbsp;<span class="ident" id="7236146">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236150">wg</span><span class="op" id="7236152">.</span><span class="ident" id="7236153">Add</span><span class="op" id="7236156">(</span><span class="num" id="7236157">1</span><span class="op" id="7236158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236162">go</span>&nbsp;<span class="keyword" id="7236165">func</span><span class="op" id="7236169">(</span><span class="op" id="7236170">)</span>&nbsp;<span class="op" id="7236172">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236177">defer</span>&nbsp;<span class="ident" id="7236183">wg</span><span class="op" id="7236185">.</span><span class="ident" id="7236186">Done</span><span class="op" id="7236190">(</span><span class="op" id="7236191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236196">runPktSyslog</span><span class="op" id="7236208">(</span><span class="ident" id="7236209">l</span><span class="op" id="7236210">,</span>&nbsp;<span class="ident" id="7236212">done</span><span class="op" id="7236216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236220">}</span><span class="op" id="7236221">(</span><span class="op" id="7236222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236225">}</span>&nbsp;<span class="keyword" id="7236227">else</span>&nbsp;<span class="op" id="7236232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236236">l</span><span class="op" id="7236237">,</span>&nbsp;<span class="ident" id="7236239">e</span>&nbsp;<span class="op" id="7236241">:=</span>&nbsp;<span class="ident" id="7236244">net</span><span class="op" id="7236247">.</span><span class="ident" id="7236248">Listen</span><span class="op" id="7236254">(</span><span class="ident" id="7236255">n</span><span class="op" id="7236256">,</span>&nbsp;<span class="ident" id="7236258">la</span><span class="op" id="7236260">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236264">if</span>&nbsp;<span class="ident" id="7236267">e</span>&nbsp;<span class="op" id="7236269">!=</span>&nbsp;<span class="builtintype" id="7236272">nil</span>&nbsp;<span class="op" id="7236276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236281">log</span><span class="op" id="7236284">.</span><span class="ident" id="7236285">Fatalf</span><span class="op" id="7236291">(</span><span class="string" id="7236292">&#34;startServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7236316">,</span>&nbsp;<span class="ident" id="7236318">e</span><span class="op" id="7236319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236327">addr</span>&nbsp;<span class="op" id="7236332">=</span>&nbsp;<span class="ident" id="7236334">l</span><span class="op" id="7236335">.</span><span class="ident" id="7236336">Addr</span><span class="op" id="7236340">(</span><span class="op" id="7236341">)</span><span class="op" id="7236342">.</span><span class="ident" id="7236343">String</span><span class="op" id="7236349">(</span><span class="op" id="7236350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236354">sock</span>&nbsp;<span class="op" id="7236359">=</span>&nbsp;<span class="ident" id="7236361">l</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236365">wg</span><span class="op" id="7236367">.</span><span class="ident" id="7236368">Add</span><span class="op" id="7236371">(</span><span class="num" id="7236372">1</span><span class="op" id="7236373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236377">go</span>&nbsp;<span class="keyword" id="7236380">func</span><span class="op" id="7236384">(</span><span class="op" id="7236385">)</span>&nbsp;<span class="op" id="7236387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236392">defer</span>&nbsp;<span class="ident" id="7236398">wg</span><span class="op" id="7236400">.</span><span class="ident" id="7236401">Done</span><span class="op" id="7236405">(</span><span class="op" id="7236406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236411">runStreamSyslog</span><span class="op" id="7236426">(</span><span class="ident" id="7236427">l</span><span class="op" id="7236428">,</span>&nbsp;<span class="ident" id="7236430">done</span><span class="op" id="7236434">,</span>&nbsp;<span class="ident" id="7236436">wg</span><span class="op" id="7236438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236442">}</span><span class="op" id="7236443">(</span><span class="op" id="7236444">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236450">return</span><br>
<span class="lineno"></span><span class="op" id="7236457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7236460">func</span>&nbsp;<span class="ident" id="7236465">TestWithSimulated</span><span class="op" id="7236482">(</span><span class="ident" id="7236483">t</span>&nbsp;<span class="op" id="7236485">*</span><span class="ident" id="7236486">testing</span><span class="op" id="7236493">.</span><span class="ident" id="7236494">T</span><span class="op" id="7236495">)</span>&nbsp;<span class="op" id="7236497">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236500">msg</span>&nbsp;<span class="op" id="7236504">:=</span>&nbsp;<span class="string" id="7236507">&#34;Test&nbsp;123&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236519">transport</span>&nbsp;<span class="op" id="7236529">:=</span>&nbsp;<span class="op" id="7236532">[</span><span class="op" id="7236533">]</span><span class="builtintype" id="7236534">string</span><span class="op" id="7236540">{</span><span class="string" id="7236541">&#34;unix&#34;</span><span class="op" id="7236547">,</span>&nbsp;<span class="string" id="7236549">&#34;unixgram&#34;</span><span class="op" id="7236559">,</span>&nbsp;<span class="string" id="7236561">&#34;udp&#34;</span><span class="op" id="7236566">,</span>&nbsp;<span class="string" id="7236568">&#34;tcp&#34;</span><span class="op" id="7236573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236577">for</span>&nbsp;<span class="ident" id="7236581">_</span><span class="op" id="7236582">,</span>&nbsp;<span class="ident" id="7236584">tr</span>&nbsp;<span class="op" id="7236587">:=</span>&nbsp;<span class="keyword" id="7236590">range</span>&nbsp;<span class="ident" id="7236596">transport</span>&nbsp;<span class="op" id="7236606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236610">done</span>&nbsp;<span class="op" id="7236615">:=</span>&nbsp;<span class="builtinfunc" id="7236618">make</span><span class="op" id="7236622">(</span><span class="keyword" id="7236623">chan</span>&nbsp;<span class="builtintype" id="7236628">string</span><span class="op" id="7236634">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236638">addr</span><span class="op" id="7236642">,</span>&nbsp;<span class="ident" id="7236644">sock</span><span class="op" id="7236648">,</span>&nbsp;<span class="ident" id="7236650">srvWG</span>&nbsp;<span class="op" id="7236656">:=</span>&nbsp;<span class="ident" id="7236659">startServer</span><span class="op" id="7236670">(</span><span class="ident" id="7236671">tr</span><span class="op" id="7236673">,</span>&nbsp;<span class="string" id="7236675">&#34;&#34;</span><span class="op" id="7236677">,</span>&nbsp;<span class="ident" id="7236679">done</span><span class="op" id="7236683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236687">defer</span>&nbsp;<span class="ident" id="7236693">srvWG</span><span class="op" id="7236698">.</span><span class="ident" id="7236699">Wait</span><span class="op" id="7236703">(</span><span class="op" id="7236704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236708">defer</span>&nbsp;<span class="ident" id="7236714">sock</span><span class="op" id="7236718">.</span><span class="ident" id="7236719">Close</span><span class="op" id="7236724">(</span><span class="op" id="7236725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236729">if</span>&nbsp;<span class="ident" id="7236732">tr</span>&nbsp;<span class="op" id="7236735">==</span>&nbsp;<span class="string" id="7236738">&#34;unix&#34;</span>&nbsp;<span class="op" id="7236745">||</span>&nbsp;<span class="ident" id="7236748">tr</span>&nbsp;<span class="op" id="7236751">==</span>&nbsp;<span class="string" id="7236754">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="7236765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236770">defer</span>&nbsp;<span class="ident" id="7236776">os</span><span class="op" id="7236778">.</span><span class="ident" id="7236779">Remove</span><span class="op" id="7236785">(</span><span class="ident" id="7236786">addr</span><span class="op" id="7236790">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236798">s</span><span class="op" id="7236799">,</span>&nbsp;<span class="ident" id="7236801">err</span>&nbsp;<span class="op" id="7236805">:=</span>&nbsp;<span class="ident" id="7236808">Dial</span><span class="op" id="7236812">(</span><span class="ident" id="7236813">tr</span><span class="op" id="7236815">,</span>&nbsp;<span class="ident" id="7236817">addr</span><span class="op" id="7236821">,</span>&nbsp;<span class="ident" id="7236823">LOG_INFO</span><span class="op" id="7236831">|</span><span class="ident" id="7236832">LOG_USER</span><span class="op" id="7236840">,</span>&nbsp;<span class="string" id="7236842">&#34;syslog_test&#34;</span><span class="op" id="7236855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236859">if</span>&nbsp;<span class="ident" id="7236862">err</span>&nbsp;<span class="op" id="7236866">!=</span>&nbsp;<span class="builtintype" id="7236869">nil</span>&nbsp;<span class="op" id="7236873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236878">t</span><span class="op" id="7236879">.</span><span class="ident" id="7236880">Fatalf</span><span class="op" id="7236886">(</span><span class="string" id="7236887">&#34;Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7236906">,</span>&nbsp;<span class="ident" id="7236908">err</span><span class="op" id="7236911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236915">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236919">err</span>&nbsp;<span class="op" id="7236923">=</span>&nbsp;<span class="ident" id="7236925">s</span><span class="op" id="7236926">.</span><span class="ident" id="7236927">Info</span><span class="op" id="7236931">(</span><span class="ident" id="7236932">msg</span><span class="op" id="7236935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7236939">if</span>&nbsp;<span class="ident" id="7236942">err</span>&nbsp;<span class="op" id="7236946">!=</span>&nbsp;<span class="builtintype" id="7236949">nil</span>&nbsp;<span class="op" id="7236953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236958">t</span><span class="op" id="7236959">.</span><span class="ident" id="7236960">Fatalf</span><span class="op" id="7236966">(</span><span class="string" id="7236967">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7236983">,</span>&nbsp;<span class="ident" id="7236985">err</span><span class="op" id="7236988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7236992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7236996">check</span><span class="op" id="7237001">(</span><span class="ident" id="7237002">t</span><span class="op" id="7237003">,</span>&nbsp;<span class="ident" id="7237005">msg</span><span class="op" id="7237008">,</span>&nbsp;<span class="op" id="7237010">&lt;-</span><span class="ident" id="7237012">done</span><span class="op" id="7237016">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237020">s</span><span class="op" id="7237021">.</span><span class="ident" id="7237022">Close</span><span class="op" id="7237027">(</span><span class="op" id="7237028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7237031">}</span><br>
<span class="lineno"></span><span class="op" id="7237033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7237036">func</span>&nbsp;<span class="ident" id="7237041">TestFlap</span><span class="op" id="7237049">(</span><span class="ident" id="7237050">t</span>&nbsp;<span class="op" id="7237052">*</span><span class="ident" id="7237053">testing</span><span class="op" id="7237060">.</span><span class="ident" id="7237061">T</span><span class="op" id="7237062">)</span>&nbsp;<span class="op" id="7237064">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237067">net</span>&nbsp;<span class="op" id="7237071">:=</span>&nbsp;<span class="string" id="7237074">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237082">done</span>&nbsp;<span class="op" id="7237087">:=</span>&nbsp;<span class="builtinfunc" id="7237090">make</span><span class="op" id="7237094">(</span><span class="keyword" id="7237095">chan</span>&nbsp;<span class="builtintype" id="7237100">string</span><span class="op" id="7237106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237109">addr</span><span class="op" id="7237113">,</span>&nbsp;<span class="ident" id="7237115">sock</span><span class="op" id="7237119">,</span>&nbsp;<span class="ident" id="7237121">srvWG</span>&nbsp;<span class="op" id="7237127">:=</span>&nbsp;<span class="ident" id="7237130">startServer</span><span class="op" id="7237141">(</span><span class="ident" id="7237142">net</span><span class="op" id="7237145">,</span>&nbsp;<span class="string" id="7237147">&#34;&#34;</span><span class="op" id="7237149">,</span>&nbsp;<span class="ident" id="7237151">done</span><span class="op" id="7237155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237158">defer</span>&nbsp;<span class="ident" id="7237164">srvWG</span><span class="op" id="7237169">.</span><span class="ident" id="7237170">Wait</span><span class="op" id="7237174">(</span><span class="op" id="7237175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237178">defer</span>&nbsp;<span class="ident" id="7237184">os</span><span class="op" id="7237186">.</span><span class="ident" id="7237187">Remove</span><span class="op" id="7237193">(</span><span class="ident" id="7237194">addr</span><span class="op" id="7237198">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237201">defer</span>&nbsp;<span class="ident" id="7237207">sock</span><span class="op" id="7237211">.</span><span class="ident" id="7237212">Close</span><span class="op" id="7237217">(</span><span class="op" id="7237218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237222">s</span><span class="op" id="7237223">,</span>&nbsp;<span class="ident" id="7237225">err</span>&nbsp;<span class="op" id="7237229">:=</span>&nbsp;<span class="ident" id="7237232">Dial</span><span class="op" id="7237236">(</span><span class="ident" id="7237237">net</span><span class="op" id="7237240">,</span>&nbsp;<span class="ident" id="7237242">addr</span><span class="op" id="7237246">,</span>&nbsp;<span class="ident" id="7237248">LOG_INFO</span><span class="op" id="7237256">|</span><span class="ident" id="7237257">LOG_USER</span><span class="op" id="7237265">,</span>&nbsp;<span class="string" id="7237267">&#34;syslog_test&#34;</span><span class="op" id="7237280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237283">if</span>&nbsp;<span class="ident" id="7237286">err</span>&nbsp;<span class="op" id="7237290">!=</span>&nbsp;<span class="builtintype" id="7237293">nil</span>&nbsp;<span class="op" id="7237297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237301">t</span><span class="op" id="7237302">.</span><span class="ident" id="7237303">Fatalf</span><span class="op" id="7237309">(</span><span class="string" id="7237310">&#34;Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7237329">,</span>&nbsp;<span class="ident" id="7237331">err</span><span class="op" id="7237334">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7237337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237340">msg</span>&nbsp;<span class="op" id="7237344">:=</span>&nbsp;<span class="string" id="7237347">&#34;Moo&nbsp;2&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237356">err</span>&nbsp;<span class="op" id="7237360">=</span>&nbsp;<span class="ident" id="7237362">s</span><span class="op" id="7237363">.</span><span class="ident" id="7237364">Info</span><span class="op" id="7237368">(</span><span class="ident" id="7237369">msg</span><span class="op" id="7237372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237375">if</span>&nbsp;<span class="ident" id="7237378">err</span>&nbsp;<span class="op" id="7237382">!=</span>&nbsp;<span class="builtintype" id="7237385">nil</span>&nbsp;<span class="op" id="7237389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237393">t</span><span class="op" id="7237394">.</span><span class="ident" id="7237395">Fatalf</span><span class="op" id="7237401">(</span><span class="string" id="7237402">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7237418">,</span>&nbsp;<span class="ident" id="7237420">err</span><span class="op" id="7237423">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7237426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237429">check</span><span class="op" id="7237434">(</span><span class="ident" id="7237435">t</span><span class="op" id="7237436">,</span>&nbsp;<span class="ident" id="7237438">msg</span><span class="op" id="7237441">,</span>&nbsp;<span class="op" id="7237443">&lt;-</span><span class="ident" id="7237445">done</span><span class="op" id="7237449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7237453">//&nbsp;restart&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237476">_</span><span class="op" id="7237477">,</span>&nbsp;<span class="ident" id="7237479">sock2</span><span class="op" id="7237484">,</span>&nbsp;<span class="ident" id="7237486">srvWG2</span>&nbsp;<span class="op" id="7237493">:=</span>&nbsp;<span class="ident" id="7237496">startServer</span><span class="op" id="7237507">(</span><span class="ident" id="7237508">net</span><span class="op" id="7237511">,</span>&nbsp;<span class="ident" id="7237513">addr</span><span class="op" id="7237517">,</span>&nbsp;<span class="ident" id="7237519">done</span><span class="op" id="7237523">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237526">defer</span>&nbsp;<span class="ident" id="7237532">srvWG2</span><span class="op" id="7237538">.</span><span class="ident" id="7237539">Wait</span><span class="op" id="7237543">(</span><span class="op" id="7237544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237547">defer</span>&nbsp;<span class="ident" id="7237553">sock2</span><span class="op" id="7237558">.</span><span class="ident" id="7237559">Close</span><span class="op" id="7237564">(</span><span class="op" id="7237565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7237569">//&nbsp;and&nbsp;try&nbsp;retransmitting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237596">msg</span>&nbsp;<span class="op" id="7237600">=</span>&nbsp;<span class="string" id="7237602">&#34;Moo&nbsp;3&#34;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237611">err</span>&nbsp;<span class="op" id="7237615">=</span>&nbsp;<span class="ident" id="7237617">s</span><span class="op" id="7237618">.</span><span class="ident" id="7237619">Info</span><span class="op" id="7237623">(</span><span class="ident" id="7237624">msg</span><span class="op" id="7237627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237630">if</span>&nbsp;<span class="ident" id="7237633">err</span>&nbsp;<span class="op" id="7237637">!=</span>&nbsp;<span class="builtintype" id="7237640">nil</span>&nbsp;<span class="op" id="7237644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237648">t</span><span class="op" id="7237649">.</span><span class="ident" id="7237650">Fatalf</span><span class="op" id="7237656">(</span><span class="string" id="7237657">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7237673">,</span>&nbsp;<span class="ident" id="7237675">err</span><span class="op" id="7237678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7237681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237684">check</span><span class="op" id="7237689">(</span><span class="ident" id="7237690">t</span><span class="op" id="7237691">,</span>&nbsp;<span class="ident" id="7237693">msg</span><span class="op" id="7237696">,</span>&nbsp;<span class="op" id="7237698">&lt;-</span><span class="ident" id="7237700">done</span><span class="op" id="7237704">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237708">s</span><span class="op" id="7237709">.</span><span class="ident" id="7237710">Close</span><span class="op" id="7237715">(</span><span class="op" id="7237716">)</span><br>
<span class="lineno"></span><span class="op" id="7237718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7237721">func</span>&nbsp;<span class="ident" id="7237726">TestNew</span><span class="op" id="7237733">(</span><span class="ident" id="7237734">t</span>&nbsp;<span class="op" id="7237736">*</span><span class="ident" id="7237737">testing</span><span class="op" id="7237744">.</span><span class="ident" id="7237745">T</span><span class="op" id="7237746">)</span>&nbsp;<span class="op" id="7237748">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237751">if</span>&nbsp;<span class="ident" id="7237754">LOG_LOCAL7</span>&nbsp;<span class="op" id="7237765">!=</span>&nbsp;<span class="num" id="7237768">23</span><span class="op" id="7237770">&lt;&lt;</span><span class="num" id="7237772">3</span>&nbsp;<span class="op" id="7237774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237778">t</span><span class="op" id="7237779">.</span><span class="ident" id="7237780">Fatalf</span><span class="op" id="7237786">(</span><span class="string" id="7237787">&#34;LOG_LOCAL7&nbsp;has&nbsp;wrong&nbsp;value&#34;</span><span class="op" id="7237815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7237818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7237821">if</span>&nbsp;<span class="ident" id="7237824">testing</span><span class="op" id="7237831">.</span><span class="ident" id="7237832">Short</span><span class="op" id="7237837">(</span><span class="op" id="7237838">)</span>&nbsp;<span class="op" id="7237840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7237844">//&nbsp;Depends&nbsp;on&nbsp;syslog&nbsp;daemon&nbsp;running,&nbsp;and&nbsp;sometimes&nbsp;it&#39;s&nbsp;not.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237907">t</span><span class="op" id="7237908">.</span><span class="ident" id="7237909">Skip</span><span class="op" id="7237913">(</span><span class="string" id="7237914">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="7237950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7237953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7237957">s</span><span class="op" id="7237958">,</span>&nbsp;<span class="ident" id="7237960">err</span>&nbsp;<span class="op" id="7237964">:=</span>&nbsp;<span class="ident" id="7237967">New</span><span class="op" id="7237970">(</span><span class="ident" id="7237971">LOG_INFO</span><span class="op" id="7237979">|</span><span class="ident" id="7237980">LOG_USER</span><span class="op" id="7237988">,</span>&nbsp;<span class="string" id="7237990">&#34;the_tag&#34;</span><span class="op" id="7237999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238002">if</span>&nbsp;<span class="ident" id="7238005">err</span>&nbsp;<span class="op" id="7238009">!=</span>&nbsp;<span class="builtintype" id="7238012">nil</span>&nbsp;<span class="op" id="7238016">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238020">t</span><span class="op" id="7238021">.</span><span class="ident" id="7238022">Fatalf</span><span class="op" id="7238028">(</span><span class="string" id="7238029">&#34;New()&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7238047">,</span>&nbsp;<span class="ident" id="7238049">err</span><span class="op" id="7238052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7238058">//&nbsp;Don&#39;t&nbsp;send&nbsp;any&nbsp;messages.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238087">s</span><span class="op" id="7238088">.</span><span class="ident" id="7238089">Close</span><span class="op" id="7238094">(</span><span class="op" id="7238095">)</span><br>
<span class="lineno"></span><span class="op" id="7238097">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="7238100">func</span>&nbsp;<span class="ident" id="7238105">TestNewLogger</span><span class="op" id="7238118">(</span><span class="ident" id="7238119">t</span>&nbsp;<span class="op" id="7238121">*</span><span class="ident" id="7238122">testing</span><span class="op" id="7238129">.</span><span class="ident" id="7238130">T</span><span class="op" id="7238131">)</span>&nbsp;<span class="op" id="7238133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238136">if</span>&nbsp;<span class="ident" id="7238139">testing</span><span class="op" id="7238146">.</span><span class="ident" id="7238147">Short</span><span class="op" id="7238152">(</span><span class="op" id="7238153">)</span>&nbsp;<span class="op" id="7238155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238159">t</span><span class="op" id="7238160">.</span><span class="ident" id="7238161">Skip</span><span class="op" id="7238165">(</span><span class="string" id="7238166">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="7238202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238205">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238208">f</span><span class="op" id="7238209">,</span>&nbsp;<span class="ident" id="7238211">err</span>&nbsp;<span class="op" id="7238215">:=</span>&nbsp;<span class="ident" id="7238218">NewLogger</span><span class="op" id="7238227">(</span><span class="ident" id="7238228">LOG_USER</span><span class="op" id="7238236">|</span><span class="ident" id="7238237">LOG_INFO</span><span class="op" id="7238245">,</span>&nbsp;<span class="num" id="7238247">0</span><span class="op" id="7238248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238251">if</span>&nbsp;<span class="ident" id="7238254">f</span>&nbsp;<span class="op" id="7238256">==</span>&nbsp;<span class="builtintype" id="7238259">nil</span>&nbsp;<span class="op" id="7238263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238267">t</span><span class="op" id="7238268">.</span><span class="ident" id="7238269">Error</span><span class="op" id="7238274">(</span><span class="ident" id="7238275">err</span><span class="op" id="7238278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238281">}</span><br>
<span class="lineno"></span><span class="op" id="7238283">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="7238286">func</span>&nbsp;<span class="ident" id="7238291">TestDial</span><span class="op" id="7238299">(</span><span class="ident" id="7238300">t</span>&nbsp;<span class="op" id="7238302">*</span><span class="ident" id="7238303">testing</span><span class="op" id="7238310">.</span><span class="ident" id="7238311">T</span><span class="op" id="7238312">)</span>&nbsp;<span class="op" id="7238314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238317">if</span>&nbsp;<span class="ident" id="7238320">testing</span><span class="op" id="7238327">.</span><span class="ident" id="7238328">Short</span><span class="op" id="7238333">(</span><span class="op" id="7238334">)</span>&nbsp;<span class="op" id="7238336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238340">t</span><span class="op" id="7238341">.</span><span class="ident" id="7238342">Skip</span><span class="op" id="7238346">(</span><span class="string" id="7238347">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="7238383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238386">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238389">f</span><span class="op" id="7238390">,</span>&nbsp;<span class="ident" id="7238392">err</span>&nbsp;<span class="op" id="7238396">:=</span>&nbsp;<span class="ident" id="7238399">Dial</span><span class="op" id="7238403">(</span><span class="string" id="7238404">&#34;&#34;</span><span class="op" id="7238406">,</span>&nbsp;<span class="string" id="7238408">&#34;&#34;</span><span class="op" id="7238410">,</span>&nbsp;<span class="op" id="7238412">(</span><span class="ident" id="7238413">LOG_LOCAL7</span><span class="op" id="7238423">|</span><span class="ident" id="7238424">LOG_DEBUG</span><span class="op" id="7238433">)</span><span class="op" id="7238434">+</span><span class="num" id="7238435">1</span><span class="op" id="7238436">,</span>&nbsp;<span class="string" id="7238438">&#34;syslog_test&#34;</span><span class="op" id="7238451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238454">if</span>&nbsp;<span class="ident" id="7238457">f</span>&nbsp;<span class="op" id="7238459">!=</span>&nbsp;<span class="builtintype" id="7238462">nil</span>&nbsp;<span class="op" id="7238466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238470">t</span><span class="op" id="7238471">.</span><span class="ident" id="7238472">Fatalf</span><span class="op" id="7238478">(</span><span class="string" id="7238479">&#34;Should&nbsp;have&nbsp;trapped&nbsp;bad&nbsp;priority&#34;</span><span class="op" id="7238513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238519">f</span><span class="op" id="7238520">,</span>&nbsp;<span class="ident" id="7238522">err</span>&nbsp;<span class="op" id="7238526">=</span>&nbsp;<span class="ident" id="7238528">Dial</span><span class="op" id="7238532">(</span><span class="string" id="7238533">&#34;&#34;</span><span class="op" id="7238535">,</span>&nbsp;<span class="string" id="7238537">&#34;&#34;</span><span class="op" id="7238539">,</span>&nbsp;<span class="op" id="7238541">-</span><span class="num" id="7238542">1</span><span class="op" id="7238543">,</span>&nbsp;<span class="string" id="7238545">&#34;syslog_test&#34;</span><span class="op" id="7238558">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238561">if</span>&nbsp;<span class="ident" id="7238564">f</span>&nbsp;<span class="op" id="7238566">!=</span>&nbsp;<span class="builtintype" id="7238569">nil</span>&nbsp;<span class="op" id="7238573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238577">t</span><span class="op" id="7238578">.</span><span class="ident" id="7238579">Fatalf</span><span class="op" id="7238585">(</span><span class="string" id="7238586">&#34;Should&nbsp;have&nbsp;trapped&nbsp;bad&nbsp;priority&#34;</span><span class="op" id="7238620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238626">l</span><span class="op" id="7238627">,</span>&nbsp;<span class="ident" id="7238629">err</span>&nbsp;<span class="op" id="7238633">:=</span>&nbsp;<span class="ident" id="7238636">Dial</span><span class="op" id="7238640">(</span><span class="string" id="7238641">&#34;&#34;</span><span class="op" id="7238643">,</span>&nbsp;<span class="string" id="7238645">&#34;&#34;</span><span class="op" id="7238647">,</span>&nbsp;<span class="ident" id="7238649">LOG_USER</span><span class="op" id="7238657">|</span><span class="ident" id="7238658">LOG_ERR</span><span class="op" id="7238665">,</span>&nbsp;<span class="string" id="7238667">&#34;syslog_test&#34;</span><span class="op" id="7238680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238683">if</span>&nbsp;<span class="ident" id="7238686">err</span>&nbsp;<span class="op" id="7238690">!=</span>&nbsp;<span class="builtintype" id="7238693">nil</span>&nbsp;<span class="op" id="7238697">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238701">t</span><span class="op" id="7238702">.</span><span class="ident" id="7238703">Fatalf</span><span class="op" id="7238709">(</span><span class="string" id="7238710">&#34;Dial()&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7238729">,</span>&nbsp;<span class="ident" id="7238731">err</span><span class="op" id="7238734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238740">l</span><span class="op" id="7238741">.</span><span class="ident" id="7238742">Close</span><span class="op" id="7238747">(</span><span class="op" id="7238748">)</span><br>
<span class="lineno"></span><span class="op" id="7238750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="7238753">func</span>&nbsp;<span class="ident" id="7238758">check</span><span class="op" id="7238763">(</span><span class="ident" id="7238764">t</span>&nbsp;<span class="op" id="7238766">*</span><span class="ident" id="7238767">testing</span><span class="op" id="7238774">.</span><span class="ident" id="7238775">T</span><span class="op" id="7238776">,</span>&nbsp;<span class="ident" id="7238778">in</span><span class="op" id="7238780">,</span>&nbsp;<span class="ident" id="7238782">out</span>&nbsp;<span class="builtintype" id="7238786">string</span><span class="op" id="7238792">)</span>&nbsp;<span class="op" id="7238794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238797">tmpl</span>&nbsp;<span class="op" id="7238802">:=</span>&nbsp;<span class="ident" id="7238805">fmt</span><span class="op" id="7238808">.</span><span class="ident" id="7238809">Sprintf</span><span class="op" id="7238816">(</span><span class="string" id="7238817">&#34;&lt;%d&gt;%%s&nbsp;%%s&nbsp;syslog_test[%%d]:&nbsp;%s\n&#34;</span><span class="op" id="7238853">,</span>&nbsp;<span class="ident" id="7238855">LOG_USER</span><span class="op" id="7238863">+</span><span class="ident" id="7238864">LOG_INFO</span><span class="op" id="7238872">,</span>&nbsp;<span class="ident" id="7238874">in</span><span class="op" id="7238876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238879">if</span>&nbsp;<span class="ident" id="7238882">hostname</span><span class="op" id="7238890">,</span>&nbsp;<span class="ident" id="7238892">err</span>&nbsp;<span class="op" id="7238896">:=</span>&nbsp;<span class="ident" id="7238899">os</span><span class="op" id="7238901">.</span><span class="ident" id="7238902">Hostname</span><span class="op" id="7238910">(</span><span class="op" id="7238911">)</span><span class="op" id="7238912">;</span>&nbsp;<span class="ident" id="7238914">err</span>&nbsp;<span class="op" id="7238918">!=</span>&nbsp;<span class="builtintype" id="7238921">nil</span>&nbsp;<span class="op" id="7238925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7238929">t</span><span class="op" id="7238930">.</span><span class="ident" id="7238931">Error</span><span class="op" id="7238936">(</span><span class="string" id="7238937">&#34;Error&nbsp;retrieving&nbsp;hostname&#34;</span><span class="op" id="7238964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7238967">}</span>&nbsp;<span class="keyword" id="7238969">else</span>&nbsp;<span class="op" id="7238974">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7238978">var</span>&nbsp;<span class="ident" id="7238982">parsedHostname</span><span class="op" id="7238996">,</span>&nbsp;<span class="ident" id="7238998">timestamp</span>&nbsp;<span class="builtintype" id="7239008">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7239017">var</span>&nbsp;<span class="ident" id="7239021">pid</span>&nbsp;<span class="builtintype" id="7239025">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7239031">if</span>&nbsp;<span class="ident" id="7239034">n</span><span class="op" id="7239035">,</span>&nbsp;<span class="ident" id="7239037">err</span>&nbsp;<span class="op" id="7239041">:=</span>&nbsp;<span class="ident" id="7239044">fmt</span><span class="op" id="7239047">.</span><span class="ident" id="7239048">Sscanf</span><span class="op" id="7239054">(</span><span class="ident" id="7239055">out</span><span class="op" id="7239058">,</span>&nbsp;<span class="ident" id="7239060">tmpl</span><span class="op" id="7239064">,</span>&nbsp;<span class="op" id="7239066">&amp;</span><span class="ident" id="7239067">timestamp</span><span class="op" id="7239076">,</span>&nbsp;<span class="op" id="7239078">&amp;</span><span class="ident" id="7239079">parsedHostname</span><span class="op" id="7239093">,</span>&nbsp;<span class="op" id="7239095">&amp;</span><span class="ident" id="7239096">pid</span><span class="op" id="7239099">)</span><span class="op" id="7239100">;</span>&nbsp;<span class="ident" id="7239102">n</span>&nbsp;<span class="op" id="7239104">!=</span>&nbsp;<span class="num" id="7239107">3</span>&nbsp;<span class="op" id="7239109">||</span>&nbsp;<span class="ident" id="7239112">err</span>&nbsp;<span class="op" id="7239116">!=</span>&nbsp;<span class="builtintype" id="7239119">nil</span>&nbsp;<span class="op" id="7239123">||</span>&nbsp;<span class="ident" id="7239126">hostname</span>&nbsp;<span class="op" id="7239135">!=</span>&nbsp;<span class="ident" id="7239138">parsedHostname</span>&nbsp;<span class="op" id="7239153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239158">t</span><span class="op" id="7239159">.</span><span class="ident" id="7239160">Errorf</span><span class="op" id="7239166">(</span><span class="string" id="7239167">&#34;Got&nbsp;%q,&nbsp;does&nbsp;not&nbsp;match&nbsp;template&nbsp;%q&nbsp;(%d&nbsp;%s)&#34;</span><span class="op" id="7239211">,</span>&nbsp;<span class="ident" id="7239213">out</span><span class="op" id="7239216">,</span>&nbsp;<span class="ident" id="7239218">tmpl</span><span class="op" id="7239222">,</span>&nbsp;<span class="ident" id="7239224">n</span><span class="op" id="7239225">,</span>&nbsp;<span class="ident" id="7239227">err</span><span class="op" id="7239230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239234">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239237">}</span><br>
<span class="lineno"></span><span class="op" id="7239239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7239242">func</span>&nbsp;<span class="ident" id="7239247">TestWrite</span><span class="op" id="7239256">(</span><span class="ident" id="7239257">t</span>&nbsp;<span class="op" id="7239259">*</span><span class="ident" id="7239260">testing</span><span class="op" id="7239267">.</span><span class="ident" id="7239268">T</span><span class="op" id="7239269">)</span>&nbsp;<span class="op" id="7239271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239274">tests</span>&nbsp;<span class="op" id="7239280">:=</span>&nbsp;<span class="op" id="7239283">[</span><span class="op" id="7239284">]</span><span class="keyword" id="7239285">struct</span>&nbsp;<span class="op" id="7239292">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239296">pri</span>&nbsp;<span class="ident" id="7239300">Priority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239311">pre</span>&nbsp;<span class="builtintype" id="7239315">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239324">msg</span>&nbsp;<span class="builtintype" id="7239328">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239337">exp</span>&nbsp;<span class="builtintype" id="7239341">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239349">}</span><span class="op" id="7239350">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239354">{</span><span class="ident" id="7239355">LOG_USER</span>&nbsp;<span class="op" id="7239364">|</span>&nbsp;<span class="ident" id="7239366">LOG_ERR</span><span class="op" id="7239373">,</span>&nbsp;<span class="string" id="7239375">&#34;syslog_test&#34;</span><span class="op" id="7239388">,</span>&nbsp;<span class="string" id="7239390">&#34;&#34;</span><span class="op" id="7239392">,</span>&nbsp;<span class="string" id="7239394">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;\n&#34;</span><span class="op" id="7239421">}</span><span class="op" id="7239422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239426">{</span><span class="ident" id="7239427">LOG_USER</span>&nbsp;<span class="op" id="7239436">|</span>&nbsp;<span class="ident" id="7239438">LOG_ERR</span><span class="op" id="7239445">,</span>&nbsp;<span class="string" id="7239447">&#34;syslog_test&#34;</span><span class="op" id="7239460">,</span>&nbsp;<span class="string" id="7239462">&#34;write&nbsp;test&#34;</span><span class="op" id="7239474">,</span>&nbsp;<span class="string" id="7239476">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;write&nbsp;test\n&#34;</span><span class="op" id="7239513">}</span><span class="op" id="7239514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7239518">//&nbsp;Write&nbsp;should&nbsp;not&nbsp;add&nbsp;\n&nbsp;if&nbsp;there&nbsp;already&nbsp;is&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239571">{</span><span class="ident" id="7239572">LOG_USER</span>&nbsp;<span class="op" id="7239581">|</span>&nbsp;<span class="ident" id="7239583">LOG_ERR</span><span class="op" id="7239590">,</span>&nbsp;<span class="string" id="7239592">&#34;syslog_test&#34;</span><span class="op" id="7239605">,</span>&nbsp;<span class="string" id="7239607">&#34;write&nbsp;test&nbsp;2\n&#34;</span><span class="op" id="7239623">,</span>&nbsp;<span class="string" id="7239625">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;write&nbsp;test&nbsp;2\n&#34;</span><span class="op" id="7239664">}</span><span class="op" id="7239665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239668">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7239672">if</span>&nbsp;<span class="ident" id="7239675">hostname</span><span class="op" id="7239683">,</span>&nbsp;<span class="ident" id="7239685">err</span>&nbsp;<span class="op" id="7239689">:=</span>&nbsp;<span class="ident" id="7239692">os</span><span class="op" id="7239694">.</span><span class="ident" id="7239695">Hostname</span><span class="op" id="7239703">(</span><span class="op" id="7239704">)</span><span class="op" id="7239705">;</span>&nbsp;<span class="ident" id="7239707">err</span>&nbsp;<span class="op" id="7239711">!=</span>&nbsp;<span class="builtintype" id="7239714">nil</span>&nbsp;<span class="op" id="7239718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239722">t</span><span class="op" id="7239723">.</span><span class="ident" id="7239724">Fatalf</span><span class="op" id="7239730">(</span><span class="string" id="7239731">&#34;Error&nbsp;retrieving&nbsp;hostname&#34;</span><span class="op" id="7239758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7239761">}</span>&nbsp;<span class="keyword" id="7239763">else</span>&nbsp;<span class="op" id="7239768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7239772">for</span>&nbsp;<span class="ident" id="7239776">_</span><span class="op" id="7239777">,</span>&nbsp;<span class="ident" id="7239779">test</span>&nbsp;<span class="op" id="7239784">:=</span>&nbsp;<span class="keyword" id="7239787">range</span>&nbsp;<span class="ident" id="7239793">tests</span>&nbsp;<span class="op" id="7239799">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239804">done</span>&nbsp;<span class="op" id="7239809">:=</span>&nbsp;<span class="builtinfunc" id="7239812">make</span><span class="op" id="7239816">(</span><span class="keyword" id="7239817">chan</span>&nbsp;<span class="builtintype" id="7239822">string</span><span class="op" id="7239828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239833">addr</span><span class="op" id="7239837">,</span>&nbsp;<span class="ident" id="7239839">sock</span><span class="op" id="7239843">,</span>&nbsp;<span class="ident" id="7239845">srvWG</span>&nbsp;<span class="op" id="7239851">:=</span>&nbsp;<span class="ident" id="7239854">startServer</span><span class="op" id="7239865">(</span><span class="string" id="7239866">&#34;udp&#34;</span><span class="op" id="7239871">,</span>&nbsp;<span class="string" id="7239873">&#34;&#34;</span><span class="op" id="7239875">,</span>&nbsp;<span class="ident" id="7239877">done</span><span class="op" id="7239881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7239886">defer</span>&nbsp;<span class="ident" id="7239892">srvWG</span><span class="op" id="7239897">.</span><span class="ident" id="7239898">Wait</span><span class="op" id="7239902">(</span><span class="op" id="7239903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7239908">defer</span>&nbsp;<span class="ident" id="7239914">sock</span><span class="op" id="7239918">.</span><span class="ident" id="7239919">Close</span><span class="op" id="7239924">(</span><span class="op" id="7239925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7239930">l</span><span class="op" id="7239931">,</span>&nbsp;<span class="ident" id="7239933">err</span>&nbsp;<span class="op" id="7239937">:=</span>&nbsp;<span class="ident" id="7239940">Dial</span><span class="op" id="7239944">(</span><span class="string" id="7239945">&#34;udp&#34;</span><span class="op" id="7239950">,</span>&nbsp;<span class="ident" id="7239952">addr</span><span class="op" id="7239956">,</span>&nbsp;<span class="ident" id="7239958">test</span><span class="op" id="7239962">.</span><span class="ident" id="7239963">pri</span><span class="op" id="7239966">,</span>&nbsp;<span class="ident" id="7239968">test</span><span class="op" id="7239972">.</span><span class="ident" id="7239973">pre</span><span class="op" id="7239976">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7239981">if</span>&nbsp;<span class="ident" id="7239984">err</span>&nbsp;<span class="op" id="7239988">!=</span>&nbsp;<span class="builtintype" id="7239991">nil</span>&nbsp;<span class="op" id="7239995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240001">t</span><span class="op" id="7240002">.</span><span class="ident" id="7240003">Fatalf</span><span class="op" id="7240009">(</span><span class="string" id="7240010">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7240036">,</span>&nbsp;<span class="ident" id="7240038">err</span><span class="op" id="7240041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7240046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240051">defer</span>&nbsp;<span class="ident" id="7240057">l</span><span class="op" id="7240058">.</span><span class="ident" id="7240059">Close</span><span class="op" id="7240064">(</span><span class="op" id="7240065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240070">_</span><span class="op" id="7240071">,</span>&nbsp;<span class="ident" id="7240073">err</span>&nbsp;<span class="op" id="7240077">=</span>&nbsp;<span class="ident" id="7240079">io</span><span class="op" id="7240081">.</span><span class="ident" id="7240082">WriteString</span><span class="op" id="7240093">(</span><span class="ident" id="7240094">l</span><span class="op" id="7240095">,</span>&nbsp;<span class="ident" id="7240097">test</span><span class="op" id="7240101">.</span><span class="ident" id="7240102">msg</span><span class="op" id="7240105">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240110">if</span>&nbsp;<span class="ident" id="7240113">err</span>&nbsp;<span class="op" id="7240117">!=</span>&nbsp;<span class="builtintype" id="7240120">nil</span>&nbsp;<span class="op" id="7240124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240130">t</span><span class="op" id="7240131">.</span><span class="ident" id="7240132">Fatalf</span><span class="op" id="7240138">(</span><span class="string" id="7240139">&#34;WriteString()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7240165">,</span>&nbsp;<span class="ident" id="7240167">err</span><span class="op" id="7240170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7240175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240180">rcvd</span>&nbsp;<span class="op" id="7240185">:=</span>&nbsp;<span class="op" id="7240188">&lt;-</span><span class="ident" id="7240190">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240198">test</span><span class="op" id="7240202">.</span><span class="ident" id="7240203">exp</span>&nbsp;<span class="op" id="7240207">=</span>&nbsp;<span class="ident" id="7240209">fmt</span><span class="op" id="7240212">.</span><span class="ident" id="7240213">Sprintf</span><span class="op" id="7240220">(</span><span class="string" id="7240221">&#34;&lt;%d&gt;&#34;</span><span class="op" id="7240227">,</span>&nbsp;<span class="ident" id="7240229">test</span><span class="op" id="7240233">.</span><span class="ident" id="7240234">pri</span><span class="op" id="7240237">)</span>&nbsp;<span class="op" id="7240239">+</span>&nbsp;<span class="ident" id="7240241">test</span><span class="op" id="7240245">.</span><span class="ident" id="7240246">exp</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240253">var</span>&nbsp;<span class="ident" id="7240257">parsedHostname</span><span class="op" id="7240271">,</span>&nbsp;<span class="ident" id="7240273">timestamp</span>&nbsp;<span class="builtintype" id="7240283">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240293">var</span>&nbsp;<span class="ident" id="7240297">pid</span>&nbsp;<span class="builtintype" id="7240301">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240308">if</span>&nbsp;<span class="ident" id="7240311">n</span><span class="op" id="7240312">,</span>&nbsp;<span class="ident" id="7240314">err</span>&nbsp;<span class="op" id="7240318">:=</span>&nbsp;<span class="ident" id="7240321">fmt</span><span class="op" id="7240324">.</span><span class="ident" id="7240325">Sscanf</span><span class="op" id="7240331">(</span><span class="ident" id="7240332">rcvd</span><span class="op" id="7240336">,</span>&nbsp;<span class="ident" id="7240338">test</span><span class="op" id="7240342">.</span><span class="ident" id="7240343">exp</span><span class="op" id="7240346">,</span>&nbsp;<span class="op" id="7240348">&amp;</span><span class="ident" id="7240349">timestamp</span><span class="op" id="7240358">,</span>&nbsp;<span class="op" id="7240360">&amp;</span><span class="ident" id="7240361">parsedHostname</span><span class="op" id="7240375">,</span>&nbsp;<span class="op" id="7240377">&amp;</span><span class="ident" id="7240378">pid</span><span class="op" id="7240381">)</span><span class="op" id="7240382">;</span>&nbsp;<span class="ident" id="7240384">n</span>&nbsp;<span class="op" id="7240386">!=</span>&nbsp;<span class="num" id="7240389">3</span>&nbsp;<span class="op" id="7240391">||</span>&nbsp;<span class="ident" id="7240394">err</span>&nbsp;<span class="op" id="7240398">!=</span>&nbsp;<span class="builtintype" id="7240401">nil</span>&nbsp;<span class="op" id="7240405">||</span>&nbsp;<span class="ident" id="7240408">hostname</span>&nbsp;<span class="op" id="7240417">!=</span>&nbsp;<span class="ident" id="7240420">parsedHostname</span>&nbsp;<span class="op" id="7240435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240441">t</span><span class="op" id="7240442">.</span><span class="ident" id="7240443">Errorf</span><span class="op" id="7240449">(</span><span class="string" id="7240450">&#34;s.Info()&nbsp;=&nbsp;&#39;%q&#39;,&nbsp;didn&#39;t&nbsp;match&nbsp;&#39;%q&#39;&nbsp;(%d&nbsp;%s)&#34;</span><span class="op" id="7240494">,</span>&nbsp;<span class="ident" id="7240496">rcvd</span><span class="op" id="7240500">,</span>&nbsp;<span class="ident" id="7240502">test</span><span class="op" id="7240506">.</span><span class="ident" id="7240507">exp</span><span class="op" id="7240510">,</span>&nbsp;<span class="ident" id="7240512">n</span><span class="op" id="7240513">,</span>&nbsp;<span class="ident" id="7240515">err</span><span class="op" id="7240518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7240523">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7240527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7240530">}</span><br>
<span class="lineno"></span><span class="op" id="7240532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7240535">func</span>&nbsp;<span class="ident" id="7240540">TestConcurrentWrite</span><span class="op" id="7240559">(</span><span class="ident" id="7240560">t</span>&nbsp;<span class="op" id="7240562">*</span><span class="ident" id="7240563">testing</span><span class="op" id="7240570">.</span><span class="ident" id="7240571">T</span><span class="op" id="7240572">)</span>&nbsp;<span class="op" id="7240574">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240577">addr</span><span class="op" id="7240581">,</span>&nbsp;<span class="ident" id="7240583">sock</span><span class="op" id="7240587">,</span>&nbsp;<span class="ident" id="7240589">srvWG</span>&nbsp;<span class="op" id="7240595">:=</span>&nbsp;<span class="ident" id="7240598">startServer</span><span class="op" id="7240609">(</span><span class="string" id="7240610">&#34;udp&#34;</span><span class="op" id="7240615">,</span>&nbsp;<span class="string" id="7240617">&#34;&#34;</span><span class="op" id="7240619">,</span>&nbsp;<span class="builtinfunc" id="7240621">make</span><span class="op" id="7240625">(</span><span class="keyword" id="7240626">chan</span>&nbsp;<span class="builtintype" id="7240631">string</span><span class="op" id="7240637">,</span>&nbsp;<span class="num" id="7240639">1</span><span class="op" id="7240640">)</span><span class="op" id="7240641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240644">defer</span>&nbsp;<span class="ident" id="7240650">srvWG</span><span class="op" id="7240655">.</span><span class="ident" id="7240656">Wait</span><span class="op" id="7240660">(</span><span class="op" id="7240661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240664">defer</span>&nbsp;<span class="ident" id="7240670">sock</span><span class="op" id="7240674">.</span><span class="ident" id="7240675">Close</span><span class="op" id="7240680">(</span><span class="op" id="7240681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240684">w</span><span class="op" id="7240685">,</span>&nbsp;<span class="ident" id="7240687">err</span>&nbsp;<span class="op" id="7240691">:=</span>&nbsp;<span class="ident" id="7240694">Dial</span><span class="op" id="7240698">(</span><span class="string" id="7240699">&#34;udp&#34;</span><span class="op" id="7240704">,</span>&nbsp;<span class="ident" id="7240706">addr</span><span class="op" id="7240710">,</span>&nbsp;<span class="ident" id="7240712">LOG_USER</span><span class="op" id="7240720">|</span><span class="ident" id="7240721">LOG_ERR</span><span class="op" id="7240728">,</span>&nbsp;<span class="string" id="7240730">&#34;how&#39;s&nbsp;it&nbsp;going?&#34;</span><span class="op" id="7240747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240750">if</span>&nbsp;<span class="ident" id="7240753">err</span>&nbsp;<span class="op" id="7240757">!=</span>&nbsp;<span class="builtintype" id="7240760">nil</span>&nbsp;<span class="op" id="7240764">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240768">t</span><span class="op" id="7240769">.</span><span class="ident" id="7240770">Fatalf</span><span class="op" id="7240776">(</span><span class="string" id="7240777">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7240803">,</span>&nbsp;<span class="ident" id="7240805">err</span><span class="op" id="7240808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7240811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240814">var</span>&nbsp;<span class="ident" id="7240818">wg</span>&nbsp;<span class="ident" id="7240821">sync</span><span class="op" id="7240825">.</span><span class="ident" id="7240826">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240837">for</span>&nbsp;<span class="ident" id="7240841">i</span>&nbsp;<span class="op" id="7240843">:=</span>&nbsp;<span class="num" id="7240846">0</span><span class="op" id="7240847">;</span>&nbsp;<span class="ident" id="7240849">i</span>&nbsp;<span class="op" id="7240851">&lt;</span>&nbsp;<span class="num" id="7240853">10</span><span class="op" id="7240855">;</span>&nbsp;<span class="ident" id="7240857">i</span><span class="op" id="7240858">++</span>&nbsp;<span class="op" id="7240861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240865">wg</span><span class="op" id="7240867">.</span><span class="ident" id="7240868">Add</span><span class="op" id="7240871">(</span><span class="num" id="7240872">1</span><span class="op" id="7240873">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240877">go</span>&nbsp;<span class="keyword" id="7240880">func</span><span class="op" id="7240884">(</span><span class="op" id="7240885">)</span>&nbsp;<span class="op" id="7240887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240892">defer</span>&nbsp;<span class="ident" id="7240898">wg</span><span class="op" id="7240900">.</span><span class="ident" id="7240901">Done</span><span class="op" id="7240905">(</span><span class="op" id="7240906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240911">err</span>&nbsp;<span class="op" id="7240915">:=</span>&nbsp;<span class="ident" id="7240918">w</span><span class="op" id="7240919">.</span><span class="ident" id="7240920">Info</span><span class="op" id="7240924">(</span><span class="string" id="7240925">&#34;test&#34;</span><span class="op" id="7240931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240936">if</span>&nbsp;<span class="ident" id="7240939">err</span>&nbsp;<span class="op" id="7240943">!=</span>&nbsp;<span class="builtintype" id="7240946">nil</span>&nbsp;<span class="op" id="7240950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7240956">t</span><span class="op" id="7240957">.</span><span class="ident" id="7240958">Errorf</span><span class="op" id="7240964">(</span><span class="string" id="7240965">&#34;Info()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7240984">,</span>&nbsp;<span class="ident" id="7240986">err</span><span class="op" id="7240989">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7240995">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241009">}</span><span class="op" id="7241010">(</span><span class="op" id="7241011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241017">wg</span><span class="op" id="7241019">.</span><span class="ident" id="7241020">Wait</span><span class="op" id="7241024">(</span><span class="op" id="7241025">)</span><br>
<span class="lineno">300</span><span class="op" id="7241027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7241030">func</span>&nbsp;<span class="ident" id="7241035">TestConcurrentReconnect</span><span class="op" id="7241058">(</span><span class="ident" id="7241059">t</span>&nbsp;<span class="op" id="7241061">*</span><span class="ident" id="7241062">testing</span><span class="op" id="7241069">.</span><span class="ident" id="7241070">T</span><span class="op" id="7241071">)</span>&nbsp;<span class="op" id="7241073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241076">crashy</span>&nbsp;<span class="op" id="7241083">=</span>&nbsp;<span class="builtintype" id="7241085">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241091">defer</span>&nbsp;<span class="keyword" id="7241097">func</span><span class="op" id="7241101">(</span><span class="op" id="7241102">)</span>&nbsp;<span class="op" id="7241104">{</span>&nbsp;<span class="ident" id="7241106">crashy</span>&nbsp;<span class="op" id="7241113">=</span>&nbsp;<span class="builtintype" id="7241115">false</span>&nbsp;<span class="op" id="7241121">}</span><span class="op" id="7241122">(</span><span class="op" id="7241123">)</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241127">const</span>&nbsp;<span class="ident" id="7241133">N</span>&nbsp;<span class="op" id="7241135">=</span>&nbsp;<span class="num" id="7241137">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241141">const</span>&nbsp;<span class="ident" id="7241147">M</span>&nbsp;<span class="op" id="7241149">=</span>&nbsp;<span class="num" id="7241151">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241156">net</span>&nbsp;<span class="op" id="7241160">:=</span>&nbsp;<span class="string" id="7241163">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241171">done</span>&nbsp;<span class="op" id="7241176">:=</span>&nbsp;<span class="builtinfunc" id="7241179">make</span><span class="op" id="7241183">(</span><span class="keyword" id="7241184">chan</span>&nbsp;<span class="builtintype" id="7241189">string</span><span class="op" id="7241195">,</span>&nbsp;<span class="ident" id="7241197">N</span><span class="op" id="7241198">*</span><span class="ident" id="7241199">M</span><span class="op" id="7241200">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241203">addr</span><span class="op" id="7241207">,</span>&nbsp;<span class="ident" id="7241209">sock</span><span class="op" id="7241213">,</span>&nbsp;<span class="ident" id="7241215">srvWG</span>&nbsp;<span class="op" id="7241221">:=</span>&nbsp;<span class="ident" id="7241224">startServer</span><span class="op" id="7241235">(</span><span class="ident" id="7241236">net</span><span class="op" id="7241239">,</span>&nbsp;<span class="string" id="7241241">&#34;&#34;</span><span class="op" id="7241243">,</span>&nbsp;<span class="ident" id="7241245">done</span><span class="op" id="7241249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241252">defer</span>&nbsp;<span class="ident" id="7241258">os</span><span class="op" id="7241260">.</span><span class="ident" id="7241261">Remove</span><span class="op" id="7241267">(</span><span class="ident" id="7241268">addr</span><span class="op" id="7241272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7241276">//&nbsp;count&nbsp;all&nbsp;the&nbsp;messages&nbsp;arriving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241312">count</span>&nbsp;<span class="op" id="7241318">:=</span>&nbsp;<span class="builtinfunc" id="7241321">make</span><span class="op" id="7241325">(</span><span class="keyword" id="7241326">chan</span>&nbsp;<span class="builtintype" id="7241331">int</span><span class="op" id="7241334">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241337">go</span>&nbsp;<span class="keyword" id="7241340">func</span><span class="op" id="7241344">(</span><span class="op" id="7241345">)</span>&nbsp;<span class="op" id="7241347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241351">ct</span>&nbsp;<span class="op" id="7241354">:=</span>&nbsp;<span class="num" id="7241357">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241361">for</span>&nbsp;<span class="keyword" id="7241365">range</span>&nbsp;<span class="ident" id="7241371">done</span>&nbsp;<span class="op" id="7241376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241381">ct</span><span class="op" id="7241383">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7241389">//&nbsp;we&nbsp;are&nbsp;looking&nbsp;for&nbsp;500&nbsp;out&nbsp;of&nbsp;1000&nbsp;events</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7241437">//&nbsp;here&nbsp;because&nbsp;lots&nbsp;of&nbsp;log&nbsp;messages&nbsp;are&nbsp;lost</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7241486">//&nbsp;in&nbsp;buffers&nbsp;(kernel&nbsp;and/or&nbsp;bufio)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241525">if</span>&nbsp;<span class="ident" id="7241528">ct</span>&nbsp;<span class="op" id="7241531">&gt;</span>&nbsp;<span class="ident" id="7241533">N</span><span class="op" id="7241534">*</span><span class="ident" id="7241535">M</span><span class="op" id="7241536">/</span><span class="num" id="7241537">2</span>&nbsp;<span class="op" id="7241539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241545">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241554">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241562">count</span>&nbsp;<span class="op" id="7241568">&lt;-</span>&nbsp;<span class="ident" id="7241571">ct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241575">}</span><span class="op" id="7241576">(</span><span class="op" id="7241577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241581">var</span>&nbsp;<span class="ident" id="7241585">wg</span>&nbsp;<span class="ident" id="7241588">sync</span><span class="op" id="7241592">.</span><span class="ident" id="7241593">WaitGroup</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241604">wg</span><span class="op" id="7241606">.</span><span class="ident" id="7241607">Add</span><span class="op" id="7241610">(</span><span class="ident" id="7241611">N</span><span class="op" id="7241612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241615">for</span>&nbsp;<span class="ident" id="7241619">i</span>&nbsp;<span class="op" id="7241621">:=</span>&nbsp;<span class="num" id="7241624">0</span><span class="op" id="7241625">;</span>&nbsp;<span class="ident" id="7241627">i</span>&nbsp;<span class="op" id="7241629">&lt;</span>&nbsp;<span class="ident" id="7241631">N</span><span class="op" id="7241632">;</span>&nbsp;<span class="ident" id="7241634">i</span><span class="op" id="7241635">++</span>&nbsp;<span class="op" id="7241638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241642">go</span>&nbsp;<span class="keyword" id="7241645">func</span><span class="op" id="7241649">(</span><span class="op" id="7241650">)</span>&nbsp;<span class="op" id="7241652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241657">defer</span>&nbsp;<span class="ident" id="7241663">wg</span><span class="op" id="7241665">.</span><span class="ident" id="7241666">Done</span><span class="op" id="7241670">(</span><span class="op" id="7241671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241676">w</span><span class="op" id="7241677">,</span>&nbsp;<span class="ident" id="7241679">err</span>&nbsp;<span class="op" id="7241683">:=</span>&nbsp;<span class="ident" id="7241686">Dial</span><span class="op" id="7241690">(</span><span class="ident" id="7241691">net</span><span class="op" id="7241694">,</span>&nbsp;<span class="ident" id="7241696">addr</span><span class="op" id="7241700">,</span>&nbsp;<span class="ident" id="7241702">LOG_USER</span><span class="op" id="7241710">|</span><span class="ident" id="7241711">LOG_ERR</span><span class="op" id="7241718">,</span>&nbsp;<span class="string" id="7241720">&#34;tag&#34;</span><span class="op" id="7241725">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241730">if</span>&nbsp;<span class="ident" id="7241733">err</span>&nbsp;<span class="op" id="7241737">!=</span>&nbsp;<span class="builtintype" id="7241740">nil</span>&nbsp;<span class="op" id="7241744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241750">t</span><span class="op" id="7241751">.</span><span class="ident" id="7241752">Fatalf</span><span class="op" id="7241758">(</span><span class="string" id="7241759">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7241785">,</span>&nbsp;<span class="ident" id="7241787">err</span><span class="op" id="7241790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241800">defer</span>&nbsp;<span class="ident" id="7241806">w</span><span class="op" id="7241807">.</span><span class="ident" id="7241808">Close</span><span class="op" id="7241813">(</span><span class="op" id="7241814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241819">for</span>&nbsp;<span class="ident" id="7241823">i</span>&nbsp;<span class="op" id="7241825">:=</span>&nbsp;<span class="num" id="7241828">0</span><span class="op" id="7241829">;</span>&nbsp;<span class="ident" id="7241831">i</span>&nbsp;<span class="op" id="7241833">&lt;</span>&nbsp;<span class="ident" id="7241835">M</span><span class="op" id="7241836">;</span>&nbsp;<span class="ident" id="7241838">i</span><span class="op" id="7241839">++</span>&nbsp;<span class="op" id="7241842">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241848">err</span>&nbsp;<span class="op" id="7241852">:=</span>&nbsp;<span class="ident" id="7241855">w</span><span class="op" id="7241856">.</span><span class="ident" id="7241857">Info</span><span class="op" id="7241861">(</span><span class="string" id="7241862">&#34;test&#34;</span><span class="op" id="7241868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241874">if</span>&nbsp;<span class="ident" id="7241877">err</span>&nbsp;<span class="op" id="7241881">!=</span>&nbsp;<span class="builtintype" id="7241884">nil</span>&nbsp;<span class="op" id="7241888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241895">t</span><span class="op" id="7241896">.</span><span class="ident" id="7241897">Errorf</span><span class="op" id="7241903">(</span><span class="string" id="7241904">&#34;Info()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7241923">,</span>&nbsp;<span class="ident" id="7241925">err</span><span class="op" id="7241928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7241935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241946">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241955">}</span><span class="op" id="7241956">(</span><span class="op" id="7241957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7241960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241963">wg</span><span class="op" id="7241965">.</span><span class="ident" id="7241966">Wait</span><span class="op" id="7241970">(</span><span class="op" id="7241971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241974">sock</span><span class="op" id="7241978">.</span><span class="ident" id="7241979">Close</span><span class="op" id="7241984">(</span><span class="op" id="7241985">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7241988">srvWG</span><span class="op" id="7241993">.</span><span class="ident" id="7241994">Wait</span><span class="op" id="7241998">(</span><span class="op" id="7241999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7242002">close</span><span class="op" id="7242007">(</span><span class="ident" id="7242008">done</span><span class="op" id="7242012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7242016">select</span>&nbsp;<span class="op" id="7242023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7242026">case</span>&nbsp;<span class="op" id="7242031">&lt;-</span><span class="ident" id="7242033">count</span><span class="op" id="7242038">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7242041">case</span>&nbsp;<span class="op" id="7242046">&lt;-</span><span class="ident" id="7242048">time</span><span class="op" id="7242052">.</span><span class="ident" id="7242053">After</span><span class="op" id="7242058">(</span><span class="num" id="7242059">100</span>&nbsp;<span class="op" id="7242063">*</span>&nbsp;<span class="ident" id="7242065">time</span><span class="op" id="7242069">.</span><span class="ident" id="7242070">Millisecond</span><span class="op" id="7242081">)</span><span class="op" id="7242082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242086">t</span><span class="op" id="7242087">.</span><span class="ident" id="7242088">Error</span><span class="op" id="7242093">(</span><span class="string" id="7242094">&#34;timeout&nbsp;in&nbsp;concurrent&nbsp;reconnect&#34;</span><span class="op" id="7242127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242130">}</span><br>
<span class="lineno"></span><span class="op" id="7242132">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
