<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5760030">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5760085">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5760139">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5760190">package</span>&nbsp;<span class="ident" id="5760198">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5760203">import</span>&nbsp;<span class="op" id="5760210">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760213">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760222">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760238">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760248">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760254">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760261">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760268">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5760280">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5760287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760290">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5760353">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="5760395">type</span>&nbsp;<span class="ident" id="5760400">ServerError</span>&nbsp;<span class="builtintype" id="5760412">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5760420">func</span>&nbsp;<span class="op" id="5760425">(</span><span class="ident" id="5760426">e</span>&nbsp;<span class="ident" id="5760428">ServerError</span><span class="op" id="5760439">)</span>&nbsp;<span class="ident" id="5760441">Error</span><span class="op" id="5760446">(</span><span class="op" id="5760447">)</span>&nbsp;<span class="builtintype" id="5760449">string</span>&nbsp;<span class="op" id="5760456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760459">return</span>&nbsp;<span class="builtintype" id="5760466">string</span><span class="op" id="5760472">(</span><span class="ident" id="5760473">e</span><span class="op" id="5760474">)</span><br>
<span class="lineno"></span><span class="op" id="5760476">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5760479">var</span>&nbsp;<span class="ident" id="5760483">ErrShutdown</span>&nbsp;<span class="op" id="5760495">=</span>&nbsp;<span class="ident" id="5760497">errors</span><span class="op" id="5760503">.</span><span class="ident" id="5760504">New</span><span class="op" id="5760507">(</span><span class="string" id="5760508">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="5760533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760536">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="5760570">type</span>&nbsp;<span class="ident" id="5760575">Call</span>&nbsp;<span class="keyword" id="5760580">struct</span>&nbsp;<span class="op" id="5760587">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760590">ServiceMethod</span>&nbsp;<span class="builtintype" id="5760604">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760616">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760664">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760678">interface</span><span class="op" id="5760687">{</span><span class="op" id="5760688">}</span>&nbsp;<span class="comment" id="5760690">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760734">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760748">interface</span><span class="op" id="5760757">{</span><span class="op" id="5760758">}</span>&nbsp;<span class="comment" id="5760760">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760803">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5760817">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760829">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760869">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760883">chan</span>&nbsp;<span class="op" id="5760888">*</span><span class="ident" id="5760889">Call</span>&nbsp;&nbsp;<span class="comment" id="5760895">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="5760929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760932">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="5760968">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5761022">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="5761075">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="5761114">type</span>&nbsp;<span class="ident" id="5761119">Client</span>&nbsp;<span class="keyword" id="5761126">struct</span>&nbsp;<span class="op" id="5761133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761136">codec</span>&nbsp;<span class="ident" id="5761142">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761156">reqMutex</span>&nbsp;<span class="ident" id="5761165">sync</span><span class="op" id="5761169">.</span><span class="ident" id="5761170">Mutex</span>&nbsp;<span class="comment" id="5761176">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761199">request</span>&nbsp;&nbsp;<span class="ident" id="5761208">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761218">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761227">sync</span><span class="op" id="5761231">.</span><span class="ident" id="5761232">Mutex</span>&nbsp;<span class="comment" id="5761238">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761261">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761270">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761278">pending</span>&nbsp;&nbsp;<span class="keyword" id="5761287">map</span><span class="op" id="5761290">[</span><span class="ident" id="5761291">uint64</span><span class="op" id="5761297">]</span><span class="op" id="5761298">*</span><span class="ident" id="5761299">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761305">closing</span>&nbsp;&nbsp;<span class="builtintype" id="5761314">bool</span>&nbsp;<span class="comment" id="5761319">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761345">shutdown</span>&nbsp;<span class="builtintype" id="5761354">bool</span>&nbsp;<span class="comment" id="5761359">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="5761389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5761392">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="5761448">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5761515">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5761585">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5761647">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5761716">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="5761773">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5761839">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5761853">type</span>&nbsp;<span class="ident" id="5761858">ClientCodec</span>&nbsp;<span class="keyword" id="5761870">interface</span>&nbsp;<span class="op" id="5761880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761883">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761956">WriteRequest</span><span class="op" id="5761968">(</span><span class="op" id="5761969">*</span><span class="ident" id="5761970">Request</span><span class="op" id="5761977">,</span>&nbsp;<span class="keyword" id="5761979">interface</span><span class="op" id="5761988">{</span><span class="op" id="5761989">}</span><span class="op" id="5761990">)</span>&nbsp;<span class="builtintype" id="5761992">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761999">ReadResponseHeader</span><span class="op" id="5762017">(</span><span class="op" id="5762018">*</span><span class="ident" id="5762019">Response</span><span class="op" id="5762027">)</span>&nbsp;<span class="builtintype" id="5762029">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762036">ReadResponseBody</span><span class="op" id="5762052">(</span><span class="keyword" id="5762053">interface</span><span class="op" id="5762062">{</span><span class="op" id="5762063">}</span><span class="op" id="5762064">)</span>&nbsp;<span class="builtintype" id="5762066">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762074">Close</span><span class="op" id="5762079">(</span><span class="op" id="5762080">)</span>&nbsp;<span class="builtintype" id="5762082">error</span><br>
<span class="lineno"></span><span class="op" id="5762088">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5762091">func</span>&nbsp;<span class="op" id="5762096">(</span><span class="ident" id="5762097">client</span>&nbsp;<span class="op" id="5762104">*</span><span class="ident" id="5762105">Client</span><span class="op" id="5762111">)</span>&nbsp;<span class="ident" id="5762113">send</span><span class="op" id="5762117">(</span><span class="ident" id="5762118">call</span>&nbsp;<span class="op" id="5762123">*</span><span class="ident" id="5762124">Call</span><span class="op" id="5762128">)</span>&nbsp;<span class="op" id="5762130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762133">client</span><span class="op" id="5762139">.</span><span class="ident" id="5762140">reqMutex</span><span class="op" id="5762148">.</span><span class="ident" id="5762149">Lock</span><span class="op" id="5762153">(</span><span class="op" id="5762154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762157">defer</span>&nbsp;<span class="ident" id="5762163">client</span><span class="op" id="5762169">.</span><span class="ident" id="5762170">reqMutex</span><span class="op" id="5762178">.</span><span class="ident" id="5762179">Unlock</span><span class="op" id="5762185">(</span><span class="op" id="5762186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762190">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762214">client</span><span class="op" id="5762220">.</span><span class="ident" id="5762221">mutex</span><span class="op" id="5762226">.</span><span class="ident" id="5762227">Lock</span><span class="op" id="5762231">(</span><span class="op" id="5762232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762235">if</span>&nbsp;<span class="ident" id="5762238">client</span><span class="op" id="5762244">.</span><span class="ident" id="5762245">shutdown</span>&nbsp;<span class="op" id="5762254">||</span>&nbsp;<span class="ident" id="5762257">client</span><span class="op" id="5762263">.</span><span class="ident" id="5762264">closing</span>&nbsp;<span class="op" id="5762272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762276">call</span><span class="op" id="5762280">.</span><span class="ident" id="5762281">Error</span>&nbsp;<span class="op" id="5762287">=</span>&nbsp;<span class="ident" id="5762289">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762303">client</span><span class="op" id="5762309">.</span><span class="ident" id="5762310">mutex</span><span class="op" id="5762315">.</span><span class="ident" id="5762316">Unlock</span><span class="op" id="5762322">(</span><span class="op" id="5762323">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762327">call</span><span class="op" id="5762331">.</span><span class="ident" id="5762332">done</span><span class="op" id="5762336">(</span><span class="op" id="5762337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762341">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762352">seq</span>&nbsp;<span class="op" id="5762356">:=</span>&nbsp;<span class="ident" id="5762359">client</span><span class="op" id="5762365">.</span><span class="ident" id="5762366">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762371">client</span><span class="op" id="5762377">.</span><span class="ident" id="5762378">seq</span><span class="op" id="5762381">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762385">client</span><span class="op" id="5762391">.</span><span class="ident" id="5762392">pending</span><span class="op" id="5762399">[</span><span class="ident" id="5762400">seq</span><span class="op" id="5762403">]</span>&nbsp;<span class="op" id="5762405">=</span>&nbsp;<span class="ident" id="5762407">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762413">client</span><span class="op" id="5762419">.</span><span class="ident" id="5762420">mutex</span><span class="op" id="5762425">.</span><span class="ident" id="5762426">Unlock</span><span class="op" id="5762432">(</span><span class="op" id="5762433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762437">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762470">client</span><span class="op" id="5762476">.</span><span class="ident" id="5762477">request</span><span class="op" id="5762484">.</span><span class="ident" id="5762485">Seq</span>&nbsp;<span class="op" id="5762489">=</span>&nbsp;<span class="ident" id="5762491">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762496">client</span><span class="op" id="5762502">.</span><span class="ident" id="5762503">request</span><span class="op" id="5762510">.</span><span class="ident" id="5762511">ServiceMethod</span>&nbsp;<span class="op" id="5762525">=</span>&nbsp;<span class="ident" id="5762527">call</span><span class="op" id="5762531">.</span><span class="ident" id="5762532">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762547">err</span>&nbsp;<span class="op" id="5762551">:=</span>&nbsp;<span class="ident" id="5762554">client</span><span class="op" id="5762560">.</span><span class="ident" id="5762561">codec</span><span class="op" id="5762566">.</span><span class="ident" id="5762567">WriteRequest</span><span class="op" id="5762579">(</span><span class="op" id="5762580">&amp;</span><span class="ident" id="5762581">client</span><span class="op" id="5762587">.</span><span class="ident" id="5762588">request</span><span class="op" id="5762595">,</span>&nbsp;<span class="ident" id="5762597">call</span><span class="op" id="5762601">.</span><span class="ident" id="5762602">Args</span><span class="op" id="5762606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762609">if</span>&nbsp;<span class="ident" id="5762612">err</span>&nbsp;<span class="op" id="5762616">!=</span>&nbsp;<span class="ident" id="5762619">nil</span>&nbsp;<span class="op" id="5762623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762627">client</span><span class="op" id="5762633">.</span><span class="ident" id="5762634">mutex</span><span class="op" id="5762639">.</span><span class="ident" id="5762640">Lock</span><span class="op" id="5762644">(</span><span class="op" id="5762645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762649">call</span>&nbsp;<span class="op" id="5762654">=</span>&nbsp;<span class="ident" id="5762656">client</span><span class="op" id="5762662">.</span><span class="ident" id="5762663">pending</span><span class="op" id="5762670">[</span><span class="ident" id="5762671">seq</span><span class="op" id="5762674">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5762678">delete</span><span class="op" id="5762684">(</span><span class="ident" id="5762685">client</span><span class="op" id="5762691">.</span><span class="ident" id="5762692">pending</span><span class="op" id="5762699">,</span>&nbsp;<span class="ident" id="5762701">seq</span><span class="op" id="5762704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762708">client</span><span class="op" id="5762714">.</span><span class="ident" id="5762715">mutex</span><span class="op" id="5762720">.</span><span class="ident" id="5762721">Unlock</span><span class="op" id="5762727">(</span><span class="op" id="5762728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762732">if</span>&nbsp;<span class="ident" id="5762735">call</span>&nbsp;<span class="op" id="5762740">!=</span>&nbsp;<span class="ident" id="5762743">nil</span>&nbsp;<span class="op" id="5762747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762752">call</span><span class="op" id="5762756">.</span><span class="ident" id="5762757">Error</span>&nbsp;<span class="op" id="5762763">=</span>&nbsp;<span class="ident" id="5762765">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762772">call</span><span class="op" id="5762776">.</span><span class="ident" id="5762777">done</span><span class="op" id="5762781">(</span><span class="op" id="5762782">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762789">}</span><br>
<span class="lineno"></span><span class="op" id="5762791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5762794">func</span>&nbsp;<span class="op" id="5762799">(</span><span class="ident" id="5762800">client</span>&nbsp;<span class="op" id="5762807">*</span><span class="ident" id="5762808">Client</span><span class="op" id="5762814">)</span>&nbsp;<span class="ident" id="5762816">input</span><span class="op" id="5762821">(</span><span class="op" id="5762822">)</span>&nbsp;<span class="op" id="5762824">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762827">var</span>&nbsp;<span class="ident" id="5762831">err</span>&nbsp;<span class="builtintype" id="5762835">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762842">var</span>&nbsp;<span class="ident" id="5762846">response</span>&nbsp;<span class="ident" id="5762855">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762865">for</span>&nbsp;<span class="ident" id="5762869">err</span>&nbsp;<span class="op" id="5762873">==</span>&nbsp;<span class="ident" id="5762876">nil</span>&nbsp;<span class="op" id="5762880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762884">response</span>&nbsp;<span class="op" id="5762893">=</span>&nbsp;<span class="ident" id="5762895">Response</span><span class="op" id="5762903">{</span><span class="op" id="5762904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762908">err</span>&nbsp;<span class="op" id="5762912">=</span>&nbsp;<span class="ident" id="5762914">client</span><span class="op" id="5762920">.</span><span class="ident" id="5762921">codec</span><span class="op" id="5762926">.</span><span class="ident" id="5762927">ReadResponseHeader</span><span class="op" id="5762945">(</span><span class="op" id="5762946">&amp;</span><span class="ident" id="5762947">response</span><span class="op" id="5762955">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762959">if</span>&nbsp;<span class="ident" id="5762962">err</span>&nbsp;<span class="op" id="5762966">!=</span>&nbsp;<span class="ident" id="5762969">nil</span>&nbsp;<span class="op" id="5762973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762978">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762990">seq</span>&nbsp;<span class="op" id="5762994">:=</span>&nbsp;<span class="ident" id="5762997">response</span><span class="op" id="5763005">.</span><span class="ident" id="5763006">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763012">client</span><span class="op" id="5763018">.</span><span class="ident" id="5763019">mutex</span><span class="op" id="5763024">.</span><span class="ident" id="5763025">Lock</span><span class="op" id="5763029">(</span><span class="op" id="5763030">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763034">call</span>&nbsp;<span class="op" id="5763039">:=</span>&nbsp;<span class="ident" id="5763042">client</span><span class="op" id="5763048">.</span><span class="ident" id="5763049">pending</span><span class="op" id="5763056">[</span><span class="ident" id="5763057">seq</span><span class="op" id="5763060">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5763064">delete</span><span class="op" id="5763070">(</span><span class="ident" id="5763071">client</span><span class="op" id="5763077">.</span><span class="ident" id="5763078">pending</span><span class="op" id="5763085">,</span>&nbsp;<span class="ident" id="5763087">seq</span><span class="op" id="5763090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763094">client</span><span class="op" id="5763100">.</span><span class="ident" id="5763101">mutex</span><span class="op" id="5763106">.</span><span class="ident" id="5763107">Unlock</span><span class="op" id="5763113">(</span><span class="op" id="5763114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763119">switch</span>&nbsp;<span class="op" id="5763126">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763130">case</span>&nbsp;<span class="ident" id="5763135">call</span>&nbsp;<span class="op" id="5763140">==</span>&nbsp;<span class="ident" id="5763143">nil</span><span class="op" id="5763146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763151">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763208">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763266">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763322">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763380">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763440">err</span>&nbsp;<span class="op" id="5763444">=</span>&nbsp;<span class="ident" id="5763446">client</span><span class="op" id="5763452">.</span><span class="ident" id="5763453">codec</span><span class="op" id="5763458">.</span><span class="ident" id="5763459">ReadResponseBody</span><span class="op" id="5763475">(</span><span class="ident" id="5763476">nil</span><span class="op" id="5763479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763484">if</span>&nbsp;<span class="ident" id="5763487">err</span>&nbsp;<span class="op" id="5763491">!=</span>&nbsp;<span class="ident" id="5763494">nil</span>&nbsp;<span class="op" id="5763498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763504">err</span>&nbsp;<span class="op" id="5763508">=</span>&nbsp;<span class="ident" id="5763510">errors</span><span class="op" id="5763516">.</span><span class="ident" id="5763517">New</span><span class="op" id="5763520">(</span><span class="string" id="5763521">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5763544">+</span>&nbsp;<span class="ident" id="5763546">err</span><span class="op" id="5763549">.</span><span class="ident" id="5763550">Error</span><span class="op" id="5763555">(</span><span class="op" id="5763556">)</span><span class="op" id="5763557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763562">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763566">case</span>&nbsp;<span class="ident" id="5763571">response</span><span class="op" id="5763579">.</span><span class="ident" id="5763580">Error</span>&nbsp;<span class="op" id="5763586">!=</span>&nbsp;<span class="string" id="5763589">&#34;&#34;</span><span class="op" id="5763591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763596">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763657">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763717">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763746">call</span><span class="op" id="5763750">.</span><span class="ident" id="5763751">Error</span>&nbsp;<span class="op" id="5763757">=</span>&nbsp;<span class="ident" id="5763759">ServerError</span><span class="op" id="5763770">(</span><span class="ident" id="5763771">response</span><span class="op" id="5763779">.</span><span class="ident" id="5763780">Error</span><span class="op" id="5763785">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763790">err</span>&nbsp;<span class="op" id="5763794">=</span>&nbsp;<span class="ident" id="5763796">client</span><span class="op" id="5763802">.</span><span class="ident" id="5763803">codec</span><span class="op" id="5763808">.</span><span class="ident" id="5763809">ReadResponseBody</span><span class="op" id="5763825">(</span><span class="ident" id="5763826">nil</span><span class="op" id="5763829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763834">if</span>&nbsp;<span class="ident" id="5763837">err</span>&nbsp;<span class="op" id="5763841">!=</span>&nbsp;<span class="ident" id="5763844">nil</span>&nbsp;<span class="op" id="5763848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763854">err</span>&nbsp;<span class="op" id="5763858">=</span>&nbsp;<span class="ident" id="5763860">errors</span><span class="op" id="5763866">.</span><span class="ident" id="5763867">New</span><span class="op" id="5763870">(</span><span class="string" id="5763871">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5763894">+</span>&nbsp;<span class="ident" id="5763896">err</span><span class="op" id="5763899">.</span><span class="ident" id="5763900">Error</span><span class="op" id="5763905">(</span><span class="op" id="5763906">)</span><span class="op" id="5763907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763917">call</span><span class="op" id="5763921">.</span><span class="ident" id="5763922">done</span><span class="op" id="5763926">(</span><span class="op" id="5763927">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763931">default</span><span class="op" id="5763938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763943">err</span>&nbsp;<span class="op" id="5763947">=</span>&nbsp;<span class="ident" id="5763949">client</span><span class="op" id="5763955">.</span><span class="ident" id="5763956">codec</span><span class="op" id="5763961">.</span><span class="ident" id="5763962">ReadResponseBody</span><span class="op" id="5763978">(</span><span class="ident" id="5763979">call</span><span class="op" id="5763983">.</span><span class="ident" id="5763984">Reply</span><span class="op" id="5763989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763994">if</span>&nbsp;<span class="ident" id="5763997">err</span>&nbsp;<span class="op" id="5764001">!=</span>&nbsp;<span class="ident" id="5764004">nil</span>&nbsp;<span class="op" id="5764008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764014">call</span><span class="op" id="5764018">.</span><span class="ident" id="5764019">Error</span>&nbsp;<span class="op" id="5764025">=</span>&nbsp;<span class="ident" id="5764027">errors</span><span class="op" id="5764033">.</span><span class="ident" id="5764034">New</span><span class="op" id="5764037">(</span><span class="string" id="5764038">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="5764054">+</span>&nbsp;<span class="ident" id="5764056">err</span><span class="op" id="5764059">.</span><span class="ident" id="5764060">Error</span><span class="op" id="5764065">(</span><span class="op" id="5764066">)</span><span class="op" id="5764067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764072">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764077">call</span><span class="op" id="5764081">.</span><span class="ident" id="5764082">done</span><span class="op" id="5764086">(</span><span class="op" id="5764087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764097">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764126">client</span><span class="op" id="5764132">.</span><span class="ident" id="5764133">reqMutex</span><span class="op" id="5764141">.</span><span class="ident" id="5764142">Lock</span><span class="op" id="5764146">(</span><span class="op" id="5764147">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764150">client</span><span class="op" id="5764156">.</span><span class="ident" id="5764157">mutex</span><span class="op" id="5764162">.</span><span class="ident" id="5764163">Lock</span><span class="op" id="5764167">(</span><span class="op" id="5764168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764171">client</span><span class="op" id="5764177">.</span><span class="ident" id="5764178">shutdown</span>&nbsp;<span class="op" id="5764187">=</span>&nbsp;<span class="builtintype" id="5764189">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764195">closing</span>&nbsp;<span class="op" id="5764203">:=</span>&nbsp;<span class="ident" id="5764206">client</span><span class="op" id="5764212">.</span><span class="ident" id="5764213">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764222">if</span>&nbsp;<span class="ident" id="5764225">err</span>&nbsp;<span class="op" id="5764229">==</span>&nbsp;<span class="ident" id="5764232">io</span><span class="op" id="5764234">.</span><span class="ident" id="5764235">EOF</span>&nbsp;<span class="op" id="5764239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764243">if</span>&nbsp;<span class="ident" id="5764246">closing</span>&nbsp;<span class="op" id="5764254">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764259">err</span>&nbsp;<span class="op" id="5764263">=</span>&nbsp;<span class="ident" id="5764265">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764279">}</span>&nbsp;<span class="keyword" id="5764281">else</span>&nbsp;<span class="op" id="5764286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764291">err</span>&nbsp;<span class="op" id="5764295">=</span>&nbsp;<span class="ident" id="5764297">io</span><span class="op" id="5764299">.</span><span class="ident" id="5764300">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764322">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764325">for</span>&nbsp;<span class="ident" id="5764329">_</span><span class="op" id="5764330">,</span>&nbsp;<span class="ident" id="5764332">call</span>&nbsp;<span class="op" id="5764337">:=</span>&nbsp;<span class="keyword" id="5764340">range</span>&nbsp;<span class="ident" id="5764346">client</span><span class="op" id="5764352">.</span><span class="ident" id="5764353">pending</span>&nbsp;<span class="op" id="5764361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764365">call</span><span class="op" id="5764369">.</span><span class="ident" id="5764370">Error</span>&nbsp;<span class="op" id="5764376">=</span>&nbsp;<span class="ident" id="5764378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764384">call</span><span class="op" id="5764388">.</span><span class="ident" id="5764389">done</span><span class="op" id="5764393">(</span><span class="op" id="5764394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764400">client</span><span class="op" id="5764406">.</span><span class="ident" id="5764407">mutex</span><span class="op" id="5764412">.</span><span class="ident" id="5764413">Unlock</span><span class="op" id="5764419">(</span><span class="op" id="5764420">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764423">client</span><span class="op" id="5764429">.</span><span class="ident" id="5764430">reqMutex</span><span class="op" id="5764438">.</span><span class="ident" id="5764439">Unlock</span><span class="op" id="5764445">(</span><span class="op" id="5764446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764449">if</span>&nbsp;<span class="ident" id="5764452">debugLog</span>&nbsp;<span class="op" id="5764461">&amp;&amp;</span>&nbsp;<span class="ident" id="5764464">err</span>&nbsp;<span class="op" id="5764468">!=</span>&nbsp;<span class="ident" id="5764471">io</span><span class="op" id="5764473">.</span><span class="ident" id="5764474">EOF</span>&nbsp;<span class="op" id="5764478">&amp;&amp;</span>&nbsp;<span class="op" id="5764481">!</span><span class="ident" id="5764482">closing</span>&nbsp;<span class="op" id="5764490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764494">log</span><span class="op" id="5764497">.</span><span class="ident" id="5764498">Println</span><span class="op" id="5764505">(</span><span class="string" id="5764506">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="5764535">,</span>&nbsp;<span class="ident" id="5764537">err</span><span class="op" id="5764540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764543">}</span><br>
<span class="lineno"></span><span class="op" id="5764545">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5764548">func</span>&nbsp;<span class="op" id="5764553">(</span><span class="ident" id="5764554">call</span>&nbsp;<span class="op" id="5764559">*</span><span class="ident" id="5764560">Call</span><span class="op" id="5764564">)</span>&nbsp;<span class="ident" id="5764566">done</span><span class="op" id="5764570">(</span><span class="op" id="5764571">)</span>&nbsp;<span class="op" id="5764573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764576">select</span>&nbsp;<span class="op" id="5764583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764586">case</span>&nbsp;<span class="ident" id="5764591">call</span><span class="op" id="5764595">.</span><span class="ident" id="5764596">Done</span>&nbsp;<span class="op" id="5764601">&lt;-</span>&nbsp;<span class="ident" id="5764604">call</span><span class="op" id="5764608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764612">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764619">default</span><span class="op" id="5764626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764630">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764707">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764775">if</span>&nbsp;<span class="ident" id="5764778">debugLog</span>&nbsp;<span class="op" id="5764787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764792">log</span><span class="op" id="5764795">.</span><span class="ident" id="5764796">Println</span><span class="op" id="5764803">(</span><span class="string" id="5764804">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="5764871">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764878">}</span><br>
<span class="lineno"></span><span class="op" id="5764880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5764883">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="5764943">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5764998">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5765057">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5765103">func</span>&nbsp;<span class="ident" id="5765108">NewClient</span><span class="op" id="5765117">(</span><span class="ident" id="5765118">conn</span>&nbsp;<span class="ident" id="5765123">io</span><span class="op" id="5765125">.</span><span class="ident" id="5765126">ReadWriteCloser</span><span class="op" id="5765141">)</span>&nbsp;<span class="op" id="5765143">*</span><span class="ident" id="5765144">Client</span>&nbsp;<span class="op" id="5765151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765154">encBuf</span>&nbsp;<span class="op" id="5765161">:=</span>&nbsp;<span class="ident" id="5765164">bufio</span><span class="op" id="5765169">.</span><span class="ident" id="5765170">NewWriter</span><span class="op" id="5765179">(</span><span class="ident" id="5765180">conn</span><span class="op" id="5765184">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765187">client</span>&nbsp;<span class="op" id="5765194">:=</span>&nbsp;<span class="op" id="5765197">&amp;</span><span class="ident" id="5765198">gobClientCodec</span><span class="op" id="5765212">{</span><span class="ident" id="5765213">conn</span><span class="op" id="5765217">,</span>&nbsp;<span class="ident" id="5765219">gob</span><span class="op" id="5765222">.</span><span class="ident" id="5765223">NewDecoder</span><span class="op" id="5765233">(</span><span class="ident" id="5765234">conn</span><span class="op" id="5765238">)</span><span class="op" id="5765239">,</span>&nbsp;<span class="ident" id="5765241">gob</span><span class="op" id="5765244">.</span><span class="ident" id="5765245">NewEncoder</span><span class="op" id="5765255">(</span><span class="ident" id="5765256">encBuf</span><span class="op" id="5765262">)</span><span class="op" id="5765263">,</span>&nbsp;<span class="ident" id="5765265">encBuf</span><span class="op" id="5765271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765274">return</span>&nbsp;<span class="ident" id="5765281">NewClientWithCodec</span><span class="op" id="5765299">(</span><span class="ident" id="5765300">client</span><span class="op" id="5765306">)</span><br>
<span class="lineno"></span><span class="op" id="5765308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5765311">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="5765374">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5765424">func</span>&nbsp;<span class="ident" id="5765429">NewClientWithCodec</span><span class="op" id="5765447">(</span><span class="ident" id="5765448">codec</span>&nbsp;<span class="ident" id="5765454">ClientCodec</span><span class="op" id="5765465">)</span>&nbsp;<span class="op" id="5765467">*</span><span class="ident" id="5765468">Client</span>&nbsp;<span class="op" id="5765475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765478">client</span>&nbsp;<span class="op" id="5765485">:=</span>&nbsp;<span class="op" id="5765488">&amp;</span><span class="ident" id="5765489">Client</span><span class="op" id="5765495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765499">codec</span><span class="op" id="5765504">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5765508">codec</span><span class="op" id="5765513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765517">pending</span><span class="op" id="5765524">:</span>&nbsp;<span class="builtinfunc" id="5765526">make</span><span class="op" id="5765530">(</span><span class="keyword" id="5765531">map</span><span class="op" id="5765534">[</span><span class="ident" id="5765535">uint64</span><span class="op" id="5765541">]</span><span class="op" id="5765542">*</span><span class="ident" id="5765543">Call</span><span class="op" id="5765547">)</span><span class="op" id="5765548">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765554">go</span>&nbsp;<span class="ident" id="5765557">client</span><span class="op" id="5765563">.</span><span class="ident" id="5765564">input</span><span class="op" id="5765569">(</span><span class="op" id="5765570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765573">return</span>&nbsp;<span class="ident" id="5765580">client</span><br>
<span class="lineno"></span><span class="op" id="5765587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5765590">type</span>&nbsp;<span class="ident" id="5765595">gobClientCodec</span>&nbsp;<span class="keyword" id="5765610">struct</span>&nbsp;<span class="op" id="5765617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765620">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5765627">io</span><span class="op" id="5765629">.</span><span class="ident" id="5765630">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765647">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5765654">*</span><span class="ident" id="5765655">gob</span><span class="op" id="5765658">.</span><span class="ident" id="5765659">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765668">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5765675">*</span><span class="ident" id="5765676">gob</span><span class="op" id="5765679">.</span><span class="ident" id="5765680">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765689">encBuf</span>&nbsp;<span class="op" id="5765696">*</span><span class="ident" id="5765697">bufio</span><span class="op" id="5765702">.</span><span class="ident" id="5765703">Writer</span><br>
<span class="lineno">210</span><span class="op" id="5765710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5765713">func</span>&nbsp;<span class="op" id="5765718">(</span><span class="ident" id="5765719">c</span>&nbsp;<span class="op" id="5765721">*</span><span class="ident" id="5765722">gobClientCodec</span><span class="op" id="5765736">)</span>&nbsp;<span class="ident" id="5765738">WriteRequest</span><span class="op" id="5765750">(</span><span class="ident" id="5765751">r</span>&nbsp;<span class="op" id="5765753">*</span><span class="ident" id="5765754">Request</span><span class="op" id="5765761">,</span>&nbsp;<span class="ident" id="5765763">body</span>&nbsp;<span class="keyword" id="5765768">interface</span><span class="op" id="5765777">{</span><span class="op" id="5765778">}</span><span class="op" id="5765779">)</span>&nbsp;<span class="op" id="5765781">(</span><span class="ident" id="5765782">err</span>&nbsp;<span class="builtintype" id="5765786">error</span><span class="op" id="5765791">)</span>&nbsp;<span class="op" id="5765793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765796">if</span>&nbsp;<span class="ident" id="5765799">err</span>&nbsp;<span class="op" id="5765803">=</span>&nbsp;<span class="ident" id="5765805">c</span><span class="op" id="5765806">.</span><span class="ident" id="5765807">enc</span><span class="op" id="5765810">.</span><span class="ident" id="5765811">Encode</span><span class="op" id="5765817">(</span><span class="ident" id="5765818">r</span><span class="op" id="5765819">)</span><span class="op" id="5765820">;</span>&nbsp;<span class="ident" id="5765822">err</span>&nbsp;<span class="op" id="5765826">!=</span>&nbsp;<span class="ident" id="5765829">nil</span>&nbsp;<span class="op" id="5765833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765837">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765848">if</span>&nbsp;<span class="ident" id="5765851">err</span>&nbsp;<span class="op" id="5765855">=</span>&nbsp;<span class="ident" id="5765857">c</span><span class="op" id="5765858">.</span><span class="ident" id="5765859">enc</span><span class="op" id="5765862">.</span><span class="ident" id="5765863">Encode</span><span class="op" id="5765869">(</span><span class="ident" id="5765870">body</span><span class="op" id="5765874">)</span><span class="op" id="5765875">;</span>&nbsp;<span class="ident" id="5765877">err</span>&nbsp;<span class="op" id="5765881">!=</span>&nbsp;<span class="ident" id="5765884">nil</span>&nbsp;<span class="op" id="5765888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765892">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765903">return</span>&nbsp;<span class="ident" id="5765910">c</span><span class="op" id="5765911">.</span><span class="ident" id="5765912">encBuf</span><span class="op" id="5765918">.</span><span class="ident" id="5765919">Flush</span><span class="op" id="5765924">(</span><span class="op" id="5765925">)</span><br>
<span class="lineno">220</span><span class="op" id="5765927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5765930">func</span>&nbsp;<span class="op" id="5765935">(</span><span class="ident" id="5765936">c</span>&nbsp;<span class="op" id="5765938">*</span><span class="ident" id="5765939">gobClientCodec</span><span class="op" id="5765953">)</span>&nbsp;<span class="ident" id="5765955">ReadResponseHeader</span><span class="op" id="5765973">(</span><span class="ident" id="5765974">r</span>&nbsp;<span class="op" id="5765976">*</span><span class="ident" id="5765977">Response</span><span class="op" id="5765985">)</span>&nbsp;<span class="builtintype" id="5765987">error</span>&nbsp;<span class="op" id="5765993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765996">return</span>&nbsp;<span class="ident" id="5766003">c</span><span class="op" id="5766004">.</span><span class="ident" id="5766005">dec</span><span class="op" id="5766008">.</span><span class="ident" id="5766009">Decode</span><span class="op" id="5766015">(</span><span class="ident" id="5766016">r</span><span class="op" id="5766017">)</span><br>
<span class="lineno"></span><span class="op" id="5766019">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5766022">func</span>&nbsp;<span class="op" id="5766027">(</span><span class="ident" id="5766028">c</span>&nbsp;<span class="op" id="5766030">*</span><span class="ident" id="5766031">gobClientCodec</span><span class="op" id="5766045">)</span>&nbsp;<span class="ident" id="5766047">ReadResponseBody</span><span class="op" id="5766063">(</span><span class="ident" id="5766064">body</span>&nbsp;<span class="keyword" id="5766069">interface</span><span class="op" id="5766078">{</span><span class="op" id="5766079">}</span><span class="op" id="5766080">)</span>&nbsp;<span class="builtintype" id="5766082">error</span>&nbsp;<span class="op" id="5766088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766091">return</span>&nbsp;<span class="ident" id="5766098">c</span><span class="op" id="5766099">.</span><span class="ident" id="5766100">dec</span><span class="op" id="5766103">.</span><span class="ident" id="5766104">Decode</span><span class="op" id="5766110">(</span><span class="ident" id="5766111">body</span><span class="op" id="5766115">)</span><br>
<span class="lineno"></span><span class="op" id="5766117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5766120">func</span>&nbsp;<span class="op" id="5766125">(</span><span class="ident" id="5766126">c</span>&nbsp;<span class="op" id="5766128">*</span><span class="ident" id="5766129">gobClientCodec</span><span class="op" id="5766143">)</span>&nbsp;<span class="ident" id="5766145">Close</span><span class="op" id="5766150">(</span><span class="op" id="5766151">)</span>&nbsp;<span class="builtintype" id="5766153">error</span>&nbsp;<span class="op" id="5766159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766162">return</span>&nbsp;<span class="ident" id="5766169">c</span><span class="op" id="5766170">.</span><span class="ident" id="5766171">rwc</span><span class="op" id="5766174">.</span><span class="ident" id="5766175">Close</span><span class="op" id="5766180">(</span><span class="op" id="5766181">)</span><br>
<span class="lineno"></span><span class="op" id="5766183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5766186">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="5766262">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5766305">func</span>&nbsp;<span class="ident" id="5766310">DialHTTP</span><span class="op" id="5766318">(</span><span class="ident" id="5766319">network</span><span class="op" id="5766326">,</span>&nbsp;<span class="ident" id="5766328">address</span>&nbsp;<span class="builtintype" id="5766336">string</span><span class="op" id="5766342">)</span>&nbsp;<span class="op" id="5766344">(</span><span class="op" id="5766345">*</span><span class="ident" id="5766346">Client</span><span class="op" id="5766352">,</span>&nbsp;<span class="builtintype" id="5766354">error</span><span class="op" id="5766359">)</span>&nbsp;<span class="op" id="5766361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766364">return</span>&nbsp;<span class="ident" id="5766371">DialHTTPPath</span><span class="op" id="5766383">(</span><span class="ident" id="5766384">network</span><span class="op" id="5766391">,</span>&nbsp;<span class="ident" id="5766393">address</span><span class="op" id="5766400">,</span>&nbsp;<span class="ident" id="5766402">DefaultRPCPath</span><span class="op" id="5766416">)</span><br>
<span class="lineno"></span><span class="op" id="5766418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="5766421">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5766468">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5766514">func</span>&nbsp;<span class="ident" id="5766519">DialHTTPPath</span><span class="op" id="5766531">(</span><span class="ident" id="5766532">network</span><span class="op" id="5766539">,</span>&nbsp;<span class="ident" id="5766541">address</span><span class="op" id="5766548">,</span>&nbsp;<span class="ident" id="5766550">path</span>&nbsp;<span class="builtintype" id="5766555">string</span><span class="op" id="5766561">)</span>&nbsp;<span class="op" id="5766563">(</span><span class="op" id="5766564">*</span><span class="ident" id="5766565">Client</span><span class="op" id="5766571">,</span>&nbsp;<span class="builtintype" id="5766573">error</span><span class="op" id="5766578">)</span>&nbsp;<span class="op" id="5766580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766583">var</span>&nbsp;<span class="ident" id="5766587">err</span>&nbsp;<span class="builtintype" id="5766591">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766598">conn</span><span class="op" id="5766602">,</span>&nbsp;<span class="ident" id="5766604">err</span>&nbsp;<span class="op" id="5766608">:=</span>&nbsp;<span class="ident" id="5766611">net</span><span class="op" id="5766614">.</span><span class="ident" id="5766615">Dial</span><span class="op" id="5766619">(</span><span class="ident" id="5766620">network</span><span class="op" id="5766627">,</span>&nbsp;<span class="ident" id="5766629">address</span><span class="op" id="5766636">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766639">if</span>&nbsp;<span class="ident" id="5766642">err</span>&nbsp;<span class="op" id="5766646">!=</span>&nbsp;<span class="ident" id="5766649">nil</span>&nbsp;<span class="op" id="5766653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766657">return</span>&nbsp;<span class="ident" id="5766664">nil</span><span class="op" id="5766667">,</span>&nbsp;<span class="ident" id="5766669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766677">io</span><span class="op" id="5766679">.</span><span class="ident" id="5766680">WriteString</span><span class="op" id="5766691">(</span><span class="ident" id="5766692">conn</span><span class="op" id="5766696">,</span>&nbsp;<span class="string" id="5766698">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="5766708">+</span><span class="ident" id="5766709">path</span><span class="op" id="5766713">+</span><span class="string" id="5766714">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="5766729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766733">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766770">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766808">resp</span><span class="op" id="5766812">,</span>&nbsp;<span class="ident" id="5766814">err</span>&nbsp;<span class="op" id="5766818">:=</span>&nbsp;<span class="ident" id="5766821">http</span><span class="op" id="5766825">.</span><span class="ident" id="5766826">ReadResponse</span><span class="op" id="5766838">(</span><span class="ident" id="5766839">bufio</span><span class="op" id="5766844">.</span><span class="ident" id="5766845">NewReader</span><span class="op" id="5766854">(</span><span class="ident" id="5766855">conn</span><span class="op" id="5766859">)</span><span class="op" id="5766860">,</span>&nbsp;<span class="op" id="5766862">&amp;</span><span class="ident" id="5766863">http</span><span class="op" id="5766867">.</span><span class="ident" id="5766868">Request</span><span class="op" id="5766875">{</span><span class="ident" id="5766876">Method</span><span class="op" id="5766882">:</span>&nbsp;<span class="string" id="5766884">&#34;CONNECT&#34;</span><span class="op" id="5766893">}</span><span class="op" id="5766894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766897">if</span>&nbsp;<span class="ident" id="5766900">err</span>&nbsp;<span class="op" id="5766904">==</span>&nbsp;<span class="ident" id="5766907">nil</span>&nbsp;<span class="op" id="5766911">&amp;&amp;</span>&nbsp;<span class="ident" id="5766914">resp</span><span class="op" id="5766918">.</span><span class="ident" id="5766919">Status</span>&nbsp;<span class="op" id="5766926">==</span>&nbsp;<span class="ident" id="5766929">connected</span>&nbsp;<span class="op" id="5766939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766943">return</span>&nbsp;<span class="ident" id="5766950">NewClient</span><span class="op" id="5766959">(</span><span class="ident" id="5766960">conn</span><span class="op" id="5766964">)</span><span class="op" id="5766965">,</span>&nbsp;<span class="ident" id="5766967">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766975">if</span>&nbsp;<span class="ident" id="5766978">err</span>&nbsp;<span class="op" id="5766982">==</span>&nbsp;<span class="ident" id="5766985">nil</span>&nbsp;<span class="op" id="5766989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766993">err</span>&nbsp;<span class="op" id="5766997">=</span>&nbsp;<span class="ident" id="5766999">errors</span><span class="op" id="5767005">.</span><span class="ident" id="5767006">New</span><span class="op" id="5767009">(</span><span class="string" id="5767010">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5767039">+</span>&nbsp;<span class="ident" id="5767041">resp</span><span class="op" id="5767045">.</span><span class="ident" id="5767046">Status</span><span class="op" id="5767052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767058">conn</span><span class="op" id="5767062">.</span><span class="ident" id="5767063">Close</span><span class="op" id="5767068">(</span><span class="op" id="5767069">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767072">return</span>&nbsp;<span class="ident" id="5767079">nil</span><span class="op" id="5767082">,</span>&nbsp;<span class="op" id="5767084">&amp;</span><span class="ident" id="5767085">net</span><span class="op" id="5767088">.</span><span class="ident" id="5767089">OpError</span><span class="op" id="5767096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767100">Op</span><span class="op" id="5767102">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5767106">&#34;dial-http&#34;</span><span class="op" id="5767117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767121">Net</span><span class="op" id="5767124">:</span>&nbsp;&nbsp;<span class="ident" id="5767127">network</span>&nbsp;<span class="op" id="5767135">+</span>&nbsp;<span class="string" id="5767137">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5767141">+</span>&nbsp;<span class="ident" id="5767143">address</span><span class="op" id="5767150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767154">Addr</span><span class="op" id="5767158">:</span>&nbsp;<span class="ident" id="5767160">nil</span><span class="op" id="5767163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767167">Err</span><span class="op" id="5767170">:</span>&nbsp;&nbsp;<span class="ident" id="5767173">err</span><span class="op" id="5767176">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767179">}</span><br>
<span class="lineno"></span><span class="op" id="5767181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5767184">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5767252">func</span>&nbsp;<span class="ident" id="5767257">Dial</span><span class="op" id="5767261">(</span><span class="ident" id="5767262">network</span><span class="op" id="5767269">,</span>&nbsp;<span class="ident" id="5767271">address</span>&nbsp;<span class="builtintype" id="5767279">string</span><span class="op" id="5767285">)</span>&nbsp;<span class="op" id="5767287">(</span><span class="op" id="5767288">*</span><span class="ident" id="5767289">Client</span><span class="op" id="5767295">,</span>&nbsp;<span class="builtintype" id="5767297">error</span><span class="op" id="5767302">)</span>&nbsp;<span class="op" id="5767304">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767307">conn</span><span class="op" id="5767311">,</span>&nbsp;<span class="ident" id="5767313">err</span>&nbsp;<span class="op" id="5767317">:=</span>&nbsp;<span class="ident" id="5767320">net</span><span class="op" id="5767323">.</span><span class="ident" id="5767324">Dial</span><span class="op" id="5767328">(</span><span class="ident" id="5767329">network</span><span class="op" id="5767336">,</span>&nbsp;<span class="ident" id="5767338">address</span><span class="op" id="5767345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767348">if</span>&nbsp;<span class="ident" id="5767351">err</span>&nbsp;<span class="op" id="5767355">!=</span>&nbsp;<span class="ident" id="5767358">nil</span>&nbsp;<span class="op" id="5767362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767366">return</span>&nbsp;<span class="ident" id="5767373">nil</span><span class="op" id="5767376">,</span>&nbsp;<span class="ident" id="5767378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767386">return</span>&nbsp;<span class="ident" id="5767393">NewClient</span><span class="op" id="5767402">(</span><span class="ident" id="5767403">conn</span><span class="op" id="5767407">)</span><span class="op" id="5767408">,</span>&nbsp;<span class="ident" id="5767410">nil</span><br>
<span class="lineno">275</span><span class="op" id="5767414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5767417">func</span>&nbsp;<span class="op" id="5767422">(</span><span class="ident" id="5767423">client</span>&nbsp;<span class="op" id="5767430">*</span><span class="ident" id="5767431">Client</span><span class="op" id="5767437">)</span>&nbsp;<span class="ident" id="5767439">Close</span><span class="op" id="5767444">(</span><span class="op" id="5767445">)</span>&nbsp;<span class="builtintype" id="5767447">error</span>&nbsp;<span class="op" id="5767453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767456">client</span><span class="op" id="5767462">.</span><span class="ident" id="5767463">mutex</span><span class="op" id="5767468">.</span><span class="ident" id="5767469">Lock</span><span class="op" id="5767473">(</span><span class="op" id="5767474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767477">if</span>&nbsp;<span class="ident" id="5767480">client</span><span class="op" id="5767486">.</span><span class="ident" id="5767487">closing</span>&nbsp;<span class="op" id="5767495">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767499">client</span><span class="op" id="5767505">.</span><span class="ident" id="5767506">mutex</span><span class="op" id="5767511">.</span><span class="ident" id="5767512">Unlock</span><span class="op" id="5767518">(</span><span class="op" id="5767519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767523">return</span>&nbsp;<span class="ident" id="5767530">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767546">client</span><span class="op" id="5767552">.</span><span class="ident" id="5767553">closing</span>&nbsp;<span class="op" id="5767561">=</span>&nbsp;<span class="builtintype" id="5767563">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767569">client</span><span class="op" id="5767575">.</span><span class="ident" id="5767576">mutex</span><span class="op" id="5767581">.</span><span class="ident" id="5767582">Unlock</span><span class="op" id="5767588">(</span><span class="op" id="5767589">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767592">return</span>&nbsp;<span class="ident" id="5767599">client</span><span class="op" id="5767605">.</span><span class="ident" id="5767606">codec</span><span class="op" id="5767611">.</span><span class="ident" id="5767612">Close</span><span class="op" id="5767617">(</span><span class="op" id="5767618">)</span><br>
<span class="lineno"></span><span class="op" id="5767620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5767623">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="5767710">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="5767798">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5767872">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="5767940">func</span>&nbsp;<span class="op" id="5767945">(</span><span class="ident" id="5767946">client</span>&nbsp;<span class="op" id="5767953">*</span><span class="ident" id="5767954">Client</span><span class="op" id="5767960">)</span>&nbsp;<span class="ident" id="5767962">Go</span><span class="op" id="5767964">(</span><span class="ident" id="5767965">serviceMethod</span>&nbsp;<span class="builtintype" id="5767979">string</span><span class="op" id="5767985">,</span>&nbsp;<span class="ident" id="5767987">args</span>&nbsp;<span class="keyword" id="5767992">interface</span><span class="op" id="5768001">{</span><span class="op" id="5768002">}</span><span class="op" id="5768003">,</span>&nbsp;<span class="ident" id="5768005">reply</span>&nbsp;<span class="keyword" id="5768011">interface</span><span class="op" id="5768020">{</span><span class="op" id="5768021">}</span><span class="op" id="5768022">,</span>&nbsp;<span class="ident" id="5768024">done</span>&nbsp;<span class="keyword" id="5768029">chan</span>&nbsp;<span class="op" id="5768034">*</span><span class="ident" id="5768035">Call</span><span class="op" id="5768039">)</span>&nbsp;<span class="op" id="5768041">*</span><span class="ident" id="5768042">Call</span>&nbsp;<span class="op" id="5768047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768050">call</span>&nbsp;<span class="op" id="5768055">:=</span>&nbsp;<span class="builtinfunc" id="5768058">new</span><span class="op" id="5768061">(</span><span class="ident" id="5768062">Call</span><span class="op" id="5768066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768069">call</span><span class="op" id="5768073">.</span><span class="ident" id="5768074">ServiceMethod</span>&nbsp;<span class="op" id="5768088">=</span>&nbsp;<span class="ident" id="5768090">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768105">call</span><span class="op" id="5768109">.</span><span class="ident" id="5768110">Args</span>&nbsp;<span class="op" id="5768115">=</span>&nbsp;<span class="ident" id="5768117">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768123">call</span><span class="op" id="5768127">.</span><span class="ident" id="5768128">Reply</span>&nbsp;<span class="op" id="5768134">=</span>&nbsp;<span class="ident" id="5768136">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768143">if</span>&nbsp;<span class="ident" id="5768146">done</span>&nbsp;<span class="op" id="5768151">==</span>&nbsp;<span class="ident" id="5768154">nil</span>&nbsp;<span class="op" id="5768158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768162">done</span>&nbsp;<span class="op" id="5768167">=</span>&nbsp;<span class="builtinfunc" id="5768169">make</span><span class="op" id="5768173">(</span><span class="keyword" id="5768174">chan</span>&nbsp;<span class="op" id="5768179">*</span><span class="ident" id="5768180">Call</span><span class="op" id="5768184">,</span>&nbsp;<span class="num" id="5768186">10</span><span class="op" id="5768188">)</span>&nbsp;<span class="comment" id="5768190">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768204">}</span>&nbsp;<span class="keyword" id="5768206">else</span>&nbsp;<span class="op" id="5768211">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768215">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768271">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768330">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768389">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768446">if</span>&nbsp;<span class="builtinfunc" id="5768449">cap</span><span class="op" id="5768452">(</span><span class="ident" id="5768453">done</span><span class="op" id="5768457">)</span>&nbsp;<span class="op" id="5768459">==</span>&nbsp;<span class="num" id="5768462">0</span>&nbsp;<span class="op" id="5768464">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768469">log</span><span class="op" id="5768472">.</span><span class="ident" id="5768473">Panic</span><span class="op" id="5768478">(</span><span class="string" id="5768479">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5768512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768522">call</span><span class="op" id="5768526">.</span><span class="ident" id="5768527">Done</span>&nbsp;<span class="op" id="5768532">=</span>&nbsp;<span class="ident" id="5768534">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768540">client</span><span class="op" id="5768546">.</span><span class="ident" id="5768547">send</span><span class="op" id="5768551">(</span><span class="ident" id="5768552">call</span><span class="op" id="5768556">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768559">return</span>&nbsp;<span class="ident" id="5768566">call</span><br>
<span class="lineno"></span><span class="op" id="5768571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5768574">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5768666">func</span>&nbsp;<span class="op" id="5768671">(</span><span class="ident" id="5768672">client</span>&nbsp;<span class="op" id="5768679">*</span><span class="ident" id="5768680">Client</span><span class="op" id="5768686">)</span>&nbsp;<span class="ident" id="5768688">Call</span><span class="op" id="5768692">(</span><span class="ident" id="5768693">serviceMethod</span>&nbsp;<span class="builtintype" id="5768707">string</span><span class="op" id="5768713">,</span>&nbsp;<span class="ident" id="5768715">args</span>&nbsp;<span class="keyword" id="5768720">interface</span><span class="op" id="5768729">{</span><span class="op" id="5768730">}</span><span class="op" id="5768731">,</span>&nbsp;<span class="ident" id="5768733">reply</span>&nbsp;<span class="keyword" id="5768739">interface</span><span class="op" id="5768748">{</span><span class="op" id="5768749">}</span><span class="op" id="5768750">)</span>&nbsp;<span class="builtintype" id="5768752">error</span>&nbsp;<span class="op" id="5768758">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768761">call</span>&nbsp;<span class="op" id="5768766">:=</span>&nbsp;<span class="op" id="5768769">&lt;-</span><span class="ident" id="5768771">client</span><span class="op" id="5768777">.</span><span class="ident" id="5768778">Go</span><span class="op" id="5768780">(</span><span class="ident" id="5768781">serviceMethod</span><span class="op" id="5768794">,</span>&nbsp;<span class="ident" id="5768796">args</span><span class="op" id="5768800">,</span>&nbsp;<span class="ident" id="5768802">reply</span><span class="op" id="5768807">,</span>&nbsp;<span class="builtinfunc" id="5768809">make</span><span class="op" id="5768813">(</span><span class="keyword" id="5768814">chan</span>&nbsp;<span class="op" id="5768819">*</span><span class="ident" id="5768820">Call</span><span class="op" id="5768824">,</span>&nbsp;<span class="num" id="5768826">1</span><span class="op" id="5768827">)</span><span class="op" id="5768828">)</span><span class="op" id="5768829">.</span><span class="ident" id="5768830">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768836">return</span>&nbsp;<span class="ident" id="5768843">call</span><span class="op" id="5768847">.</span><span class="ident" id="5768848">Error</span><br>
<span class="lineno"></span><span class="op" id="5768854">}</span>
</div>
</body>
</html>
