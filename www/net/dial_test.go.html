<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7827142">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7827197">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7827251">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7827302">package</span>&nbsp;<span class="ident" id="7827310">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7827315">import</span>&nbsp;<span class="op" id="7827322">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827325">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827334">&#34;flag&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827342">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827349">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827355">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827361">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827372">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827383">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827393">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827404">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827415">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827423">&#34;testing&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827434">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7827441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7827444">func</span>&nbsp;<span class="ident" id="7827449">newLocalListener</span><span class="op" id="7827465">(</span><span class="ident" id="7827466">t</span>&nbsp;<span class="op" id="7827468">*</span><span class="ident" id="7827469"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7827476">.</span><span class="ident" id="7827477">T</span><span class="op" id="7827478">)</span>&nbsp;<span class="ident" id="7827480"><a href="/net/net.go.html#1471621">Listener</a></span>&nbsp;<span class="op" id="7827489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827492">ln</span><span class="op" id="7827494">,</span>&nbsp;<span class="ident" id="7827496">err</span>&nbsp;<span class="op" id="7827500">:=</span>&nbsp;<span class="ident" id="7827503"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7827509">(</span><span class="string" id="7827510">&#34;tcp&#34;</span><span class="op" id="7827515">,</span>&nbsp;<span class="string" id="7827517">&#34;127.0.0.1:0&#34;</span><span class="op" id="7827530">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827533">if</span>&nbsp;<span class="ident" id="7827536"><a href="/net/dial_test.go.html#7827496">err</a></span>&nbsp;<span class="op" id="7827540">!=</span>&nbsp;<span class="ident" id="7827543">nil</span>&nbsp;<span class="op" id="7827547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827551"><a href="/net/dial_test.go.html#7827492">ln</a></span><span class="op" id="7827553">,</span>&nbsp;<span class="ident" id="7827555"><a href="/net/dial_test.go.html#7827496">err</a></span>&nbsp;<span class="op" id="7827559">=</span>&nbsp;<span class="ident" id="7827561"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7827567">(</span><span class="string" id="7827568">&#34;tcp6&#34;</span><span class="op" id="7827574">,</span>&nbsp;<span class="string" id="7827576">&#34;[::1]:0&#34;</span><span class="op" id="7827585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827591">if</span>&nbsp;<span class="ident" id="7827594"><a href="/net/dial_test.go.html#7827496">err</a></span>&nbsp;<span class="op" id="7827598">!=</span>&nbsp;<span class="ident" id="7827601">nil</span>&nbsp;<span class="op" id="7827605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827609"><a href="/net/dial_test.go.html#7827466">t</a></span><span class="op" id="7827610">.</span><span class="ident" id="7827611">Fatal</span><span class="op" id="7827616">(</span><span class="ident" id="7827617"><a href="/net/dial_test.go.html#7827496">err</a></span><span class="op" id="7827620">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827626">return</span>&nbsp;<span class="ident" id="7827633"><a href="/net/dial_test.go.html#7827492">ln</a></span><br>
<span class="lineno"></span><span class="op" id="7827636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7827639">func</span>&nbsp;<span class="ident" id="7827644">TestDialTimeout</span><span class="op" id="7827659">(</span><span class="ident" id="7827660">t</span>&nbsp;<span class="op" id="7827662">*</span><span class="ident" id="7827663"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7827670">.</span><span class="ident" id="7827671">T</span><span class="op" id="7827672">)</span>&nbsp;<span class="op" id="7827674">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827677">origBacklog</span>&nbsp;<span class="op" id="7827689">:=</span>&nbsp;<span class="ident" id="7827692"><a href="/net/net.go.html#1471426">listenerBacklog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827709">defer</span>&nbsp;<span class="keyword" id="7827715">func</span><span class="op" id="7827719">(</span><span class="op" id="7827720">)</span>&nbsp;<span class="op" id="7827722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827726"><a href="/net/net.go.html#1471426">listenerBacklog</a></span>&nbsp;<span class="op" id="7827742">=</span>&nbsp;<span class="ident" id="7827744"><a href="/net/dial_test.go.html#7827677">origBacklog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827757">}</span><span class="op" id="7827758">(</span><span class="op" id="7827759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827762"><a href="/net/net.go.html#1471426">listenerBacklog</a></span>&nbsp;<span class="op" id="7827778">=</span>&nbsp;<span class="num" id="7827780">1</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827784">ln</span>&nbsp;<span class="op" id="7827787">:=</span>&nbsp;<span class="ident" id="7827790"><a href="/net/dial_test.go.html#7827449">newLocalListener</a></span><span class="op" id="7827806">(</span><span class="ident" id="7827807"><a href="/net/dial_test.go.html#7827660">t</a></span><span class="op" id="7827808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827811">defer</span>&nbsp;<span class="ident" id="7827817"><a href="/net/dial_test.go.html#7827784">ln</a></span><span class="op" id="7827819">.</span><span class="ident" id="7827820">Close</span><span class="op" id="7827825">(</span><span class="op" id="7827826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827830">errc</span>&nbsp;<span class="op" id="7827835">:=</span>&nbsp;<span class="builtinfunc" id="7827838">make</span><span class="op" id="7827842">(</span><span class="keyword" id="7827843">chan</span>&nbsp;<span class="builtintype" id="7827848">error</span><span class="op" id="7827853">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827857">numConns</span>&nbsp;<span class="op" id="7827866">:=</span>&nbsp;<span class="ident" id="7827869"><a href="/net/net.go.html#1471426">listenerBacklog</a></span>&nbsp;<span class="op" id="7827885">+</span>&nbsp;<span class="num" id="7827887">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7827893">//&nbsp;TODO(bradfitz):&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;test&nbsp;this&nbsp;in&nbsp;a&nbsp;portable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7827950">//&nbsp;way.&nbsp;This&nbsp;is&nbsp;unfortunate,&nbsp;but&nbsp;works&nbsp;for&nbsp;now.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827999">switch</span>&nbsp;<span class="ident" id="7828006"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7828013">.</span><span class="ident" id="7828014">GOOS</span>&nbsp;<span class="op" id="7828019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7828022">case</span>&nbsp;<span class="string" id="7828027">&#34;linux&#34;</span><span class="op" id="7828034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828038">//&nbsp;The&nbsp;kernel&nbsp;will&nbsp;start&nbsp;accepting&nbsp;TCP&nbsp;connections&nbsp;before&nbsp;userspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828108">//&nbsp;gets&nbsp;a&nbsp;chance&nbsp;to&nbsp;not&nbsp;accept&nbsp;them,&nbsp;so&nbsp;fire&nbsp;off&nbsp;a&nbsp;bunch&nbsp;to&nbsp;fill&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828178">//&nbsp;the&nbsp;kernel&#39;s&nbsp;backlog.&nbsp;&nbsp;Then&nbsp;we&nbsp;test&nbsp;we&nbsp;get&nbsp;a&nbsp;failure&nbsp;after&nbsp;that.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7828248">for</span>&nbsp;<span class="ident" id="7828252">i</span>&nbsp;<span class="op" id="7828254">:=</span>&nbsp;<span class="num" id="7828257">0</span><span class="op" id="7828258">;</span>&nbsp;<span class="ident" id="7828260"><a href="/net/dial_test.go.html#7828252">i</a></span>&nbsp;<span class="op" id="7828262">&lt;</span>&nbsp;<span class="ident" id="7828264"><a href="/net/dial_test.go.html#7827857">numConns</a></span><span class="op" id="7828272">;</span>&nbsp;<span class="ident" id="7828274"><a href="/net/dial_test.go.html#7828252">i</a></span><span class="op" id="7828275">++</span>&nbsp;<span class="op" id="7828278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7828283">go</span>&nbsp;<span class="keyword" id="7828286">func</span><span class="op" id="7828290">(</span><span class="op" id="7828291">)</span>&nbsp;<span class="op" id="7828293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828299">_</span><span class="op" id="7828300">,</span>&nbsp;<span class="ident" id="7828302">err</span>&nbsp;<span class="op" id="7828306">:=</span>&nbsp;<span class="ident" id="7828309"><a href="/net/dial.go.html#1334583">DialTimeout</a></span><span class="op" id="7828320">(</span><span class="string" id="7828321">&#34;tcp&#34;</span><span class="op" id="7828326">,</span>&nbsp;<span class="ident" id="7828328"><a href="/net/dial_test.go.html#7827784">ln</a></span><span class="op" id="7828330">.</span><span class="ident" id="7828331">Addr</span><span class="op" id="7828335">(</span><span class="op" id="7828336">)</span><span class="op" id="7828337">.</span><span class="ident" id="7828338">String</span><span class="op" id="7828344">(</span><span class="op" id="7828345">)</span><span class="op" id="7828346">,</span>&nbsp;<span class="num" id="7828348">200</span><span class="op" id="7828351">*</span><span class="ident" id="7828352"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7828356">.</span><span class="ident" id="7828357">Millisecond</span><span class="op" id="7828368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828374"><a href="/net/dial_test.go.html#7827830">errc</a></span>&nbsp;<span class="op" id="7828379">&lt;-</span>&nbsp;<span class="ident" id="7828382"><a href="/net/dial_test.go.html#7828302">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7828389">}</span><span class="op" id="7828390">(</span><span class="op" id="7828391">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7828395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7828398">case</span>&nbsp;<span class="string" id="7828403">&#34;darwin&#34;</span><span class="op" id="7828411">,</span>&nbsp;<span class="string" id="7828413">&#34;plan9&#34;</span><span class="op" id="7828420">,</span>&nbsp;<span class="string" id="7828422">&#34;windows&#34;</span><span class="op" id="7828431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828435">//&nbsp;At&nbsp;least&nbsp;OS&nbsp;X&nbsp;10.7&nbsp;seems&nbsp;to&nbsp;accept&nbsp;any&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828489">//&nbsp;connections,&nbsp;ignoring&nbsp;listen&#39;s&nbsp;backlog,&nbsp;so&nbsp;resort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828544">//&nbsp;to&nbsp;connecting&nbsp;to&nbsp;a&nbsp;hopefully-dead&nbsp;127/8&nbsp;address.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828598">//&nbsp;Same&nbsp;for&nbsp;windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828621">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828626">//&nbsp;Use&nbsp;an&nbsp;IANA&nbsp;reserved&nbsp;port&nbsp;(49151)&nbsp;instead&nbsp;of&nbsp;80,&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828688">//&nbsp;on&nbsp;our&nbsp;386&nbsp;builder,&nbsp;this&nbsp;Dial&nbsp;succeeds,&nbsp;connecting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828744">//&nbsp;to&nbsp;an&nbsp;IIS&nbsp;web&nbsp;server&nbsp;somewhere.&nbsp;&nbsp;The&nbsp;data&nbsp;center</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828798">//&nbsp;or&nbsp;VM&nbsp;or&nbsp;firewall&nbsp;must&nbsp;be&nbsp;stealing&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828858">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828863">//&nbsp;IANA&nbsp;Service&nbsp;Name&nbsp;and&nbsp;Transport&nbsp;Protocol&nbsp;Port&nbsp;Number&nbsp;Registry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828930">//&nbsp;&lt;http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xml&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829027">go</span>&nbsp;<span class="keyword" id="7829030">func</span><span class="op" id="7829034">(</span><span class="op" id="7829035">)</span>&nbsp;<span class="op" id="7829037">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829042">c</span><span class="op" id="7829043">,</span>&nbsp;<span class="ident" id="7829045">err</span>&nbsp;<span class="op" id="7829049">:=</span>&nbsp;<span class="ident" id="7829052"><a href="/net/dial.go.html#1334583">DialTimeout</a></span><span class="op" id="7829063">(</span><span class="string" id="7829064">&#34;tcp&#34;</span><span class="op" id="7829069">,</span>&nbsp;<span class="string" id="7829071">&#34;127.0.71.111:49151&#34;</span><span class="op" id="7829091">,</span>&nbsp;<span class="num" id="7829093">200</span><span class="op" id="7829096">*</span><span class="ident" id="7829097"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7829101">.</span><span class="ident" id="7829102">Millisecond</span><span class="op" id="7829113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829118">if</span>&nbsp;<span class="ident" id="7829121"><a href="/net/dial_test.go.html#7829045">err</a></span>&nbsp;<span class="op" id="7829125">==</span>&nbsp;<span class="ident" id="7829128">nil</span>&nbsp;<span class="op" id="7829132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829138"><a href="/net/dial_test.go.html#7829045">err</a></span>&nbsp;<span class="op" id="7829142">=</span>&nbsp;<span class="ident" id="7829144"><a href="/net/dial_test.go.html#7827342">fmt</a></span><span class="op" id="7829147">.</span><span class="ident" id="7829148">Errorf</span><span class="op" id="7829154">(</span><span class="string" id="7829155">&#34;unexpected:&nbsp;connected&nbsp;to&nbsp;%s!&#34;</span><span class="op" id="7829185">,</span>&nbsp;<span class="ident" id="7829187"><a href="/net/dial_test.go.html#7829042">c</a></span><span class="op" id="7829188">.</span><span class="ident" id="7829189">RemoteAddr</span><span class="op" id="7829199">(</span><span class="op" id="7829200">)</span><span class="op" id="7829201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829207"><a href="/net/dial_test.go.html#7829042">c</a></span><span class="op" id="7829208">.</span><span class="ident" id="7829209">Close</span><span class="op" id="7829214">(</span><span class="op" id="7829215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829220">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829225"><a href="/net/dial_test.go.html#7827830">errc</a></span>&nbsp;<span class="op" id="7829230">&lt;-</span>&nbsp;<span class="ident" id="7829233"><a href="/net/dial_test.go.html#7829045">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829239">}</span><span class="op" id="7829240">(</span><span class="op" id="7829241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829244">default</span><span class="op" id="7829251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7829255">//&nbsp;TODO(bradfitz):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7829276">//&nbsp;OpenBSD&nbsp;may&nbsp;have&nbsp;a&nbsp;reject&nbsp;route&nbsp;to&nbsp;127/8&nbsp;except&nbsp;127.0.0.1/32</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7829342">//&nbsp;by&nbsp;default.&nbsp;FreeBSD&nbsp;likely&nbsp;works,&nbsp;but&nbsp;is&nbsp;untested.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7829398">//&nbsp;TODO(rsc):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7829414">//&nbsp;The&nbsp;timeout&nbsp;never&nbsp;happens&nbsp;on&nbsp;Windows.&nbsp;&nbsp;Why?&nbsp;&nbsp;Issue&nbsp;3016.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829476"><a href="/net/dial_test.go.html#7827660">t</a></span><span class="op" id="7829477">.</span><span class="ident" id="7829478">Skipf</span><span class="op" id="7829483">(</span><span class="string" id="7829484">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q;&nbsp;untested.&#34;</span><span class="op" id="7829516">,</span>&nbsp;<span class="ident" id="7829518"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7829525">.</span><span class="ident" id="7829526">GOOS</span><span class="op" id="7829530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829533">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829537">connected</span>&nbsp;<span class="op" id="7829547">:=</span>&nbsp;<span class="num" id="7829550">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829553">for</span>&nbsp;<span class="op" id="7829557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829561">select</span>&nbsp;<span class="op" id="7829568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829572">case</span>&nbsp;<span class="op" id="7829577">&lt;-</span><span class="ident" id="7829579"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7829583">.</span><span class="ident" id="7829584">After</span><span class="op" id="7829589">(</span><span class="num" id="7829590">15</span>&nbsp;<span class="op" id="7829593">*</span>&nbsp;<span class="ident" id="7829595"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7829599">.</span><span class="ident" id="7829600">Second</span><span class="op" id="7829606">)</span><span class="op" id="7829607">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829612"><a href="/net/dial_test.go.html#7827660">t</a></span><span class="op" id="7829613">.</span><span class="ident" id="7829614">Fatal</span><span class="op" id="7829619">(</span><span class="string" id="7829620">&#34;too&nbsp;slow&#34;</span><span class="op" id="7829630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829634">case</span>&nbsp;<span class="ident" id="7829639">err</span>&nbsp;<span class="op" id="7829643">:=</span>&nbsp;<span class="op" id="7829646">&lt;-</span><span class="ident" id="7829648"><a href="/net/dial_test.go.html#7827830">errc</a></span><span class="op" id="7829652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829657">if</span>&nbsp;<span class="ident" id="7829660"><a href="/net/dial_test.go.html#7829639">err</a></span>&nbsp;<span class="op" id="7829664">==</span>&nbsp;<span class="ident" id="7829667">nil</span>&nbsp;<span class="op" id="7829671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829677"><a href="/net/dial_test.go.html#7829537">connected</a></span><span class="op" id="7829686">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829693">if</span>&nbsp;<span class="ident" id="7829696"><a href="/net/dial_test.go.html#7829537">connected</a></span>&nbsp;<span class="op" id="7829706">==</span>&nbsp;<span class="ident" id="7829709"><a href="/net/dial_test.go.html#7827857">numConns</a></span>&nbsp;<span class="op" id="7829718">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829725"><a href="/net/dial_test.go.html#7827660">t</a></span><span class="op" id="7829726">.</span><span class="ident" id="7829727">Fatal</span><span class="op" id="7829732">(</span><span class="string" id="7829733">&#34;all&nbsp;connections&nbsp;connected;&nbsp;expected&nbsp;some&nbsp;to&nbsp;time&nbsp;out&#34;</span><span class="op" id="7829787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829798">}</span>&nbsp;<span class="keyword" id="7829800">else</span>&nbsp;<span class="op" id="7829805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829811">terr</span><span class="op" id="7829815">,</span>&nbsp;<span class="ident" id="7829817">ok</span>&nbsp;<span class="op" id="7829820">:=</span>&nbsp;<span class="ident" id="7829823"><a href="/net/dial_test.go.html#7829639">err</a></span><span class="op" id="7829826">.</span><span class="op" id="7829827">(</span><span class="ident" id="7829828"><a href="/net/net.go.html#1473225">timeout</a></span><span class="op" id="7829835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829841">if</span>&nbsp;<span class="op" id="7829844">!</span><span class="ident" id="7829845"><a href="/net/dial_test.go.html#7829817">ok</a></span>&nbsp;<span class="op" id="7829848">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829855"><a href="/net/dial_test.go.html#7827660">t</a></span><span class="op" id="7829856">.</span><span class="ident" id="7829857">Fatalf</span><span class="op" id="7829863">(</span><span class="string" id="7829864">&#34;got&nbsp;error&nbsp;%q;&nbsp;want&nbsp;error&nbsp;with&nbsp;timeout&nbsp;interface&#34;</span><span class="op" id="7829913">,</span>&nbsp;<span class="ident" id="7829915"><a href="/net/dial_test.go.html#7829639">err</a></span><span class="op" id="7829918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829930">if</span>&nbsp;<span class="op" id="7829933">!</span><span class="ident" id="7829934"><a href="/net/dial_test.go.html#7829811">terr</a></span><span class="op" id="7829938">.</span><span class="ident" id="7829939">Timeout</span><span class="op" id="7829946">(</span><span class="op" id="7829947">)</span>&nbsp;<span class="op" id="7829949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829956"><a href="/net/dial_test.go.html#7827660">t</a></span><span class="op" id="7829957">.</span><span class="ident" id="7829958">Fatalf</span><span class="op" id="7829964">(</span><span class="string" id="7829965">&#34;got&nbsp;error&nbsp;%q;&nbsp;not&nbsp;a&nbsp;timeout&#34;</span><span class="op" id="7829994">,</span>&nbsp;<span class="ident" id="7829996"><a href="/net/dial_test.go.html#7829639">err</a></span><span class="op" id="7829999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830005">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830011">//&nbsp;Pass.&nbsp;We&nbsp;saw&nbsp;a&nbsp;timeout&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830048">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830065">}</span><br>
<span class="lineno">115</span><span class="op" id="7830067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7830070">func</span>&nbsp;<span class="ident" id="7830075">TestSelfConnect</span><span class="op" id="7830090">(</span><span class="ident" id="7830091">t</span>&nbsp;<span class="op" id="7830093">*</span><span class="ident" id="7830094"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7830101">.</span><span class="ident" id="7830102">T</span><span class="op" id="7830103">)</span>&nbsp;<span class="op" id="7830105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830108">if</span>&nbsp;<span class="ident" id="7830111"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7830118">.</span><span class="ident" id="7830119">GOOS</span>&nbsp;<span class="op" id="7830124">==</span>&nbsp;<span class="string" id="7830127">&#34;windows&#34;</span>&nbsp;<span class="op" id="7830137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830141">//&nbsp;TODO(brainman):&nbsp;do&nbsp;not&nbsp;know&nbsp;why&nbsp;it&nbsp;hangs.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830188"><a href="/net/dial_test.go.html#7830091">t</a></span><span class="op" id="7830189">.</span><span class="ident" id="7830190">Skip</span><span class="op" id="7830194">(</span><span class="string" id="7830195">&#34;skipping&nbsp;known-broken&nbsp;test&nbsp;on&nbsp;windows&#34;</span><span class="op" id="7830234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830241">//&nbsp;Test&nbsp;that&nbsp;Dial&nbsp;does&nbsp;not&nbsp;honor&nbsp;self-connects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830290">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;DialTCP.</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830323">//&nbsp;Find&nbsp;a&nbsp;port&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;local&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830378">l</span><span class="op" id="7830379">,</span>&nbsp;<span class="ident" id="7830381">err</span>&nbsp;<span class="op" id="7830385">:=</span>&nbsp;<span class="ident" id="7830388"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7830394">(</span><span class="string" id="7830395">&#34;tcp&#34;</span><span class="op" id="7830400">,</span>&nbsp;<span class="string" id="7830402">&#34;127.0.0.1:0&#34;</span><span class="op" id="7830415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830418">if</span>&nbsp;<span class="ident" id="7830421"><a href="/net/dial_test.go.html#7830381">err</a></span>&nbsp;<span class="op" id="7830425">!=</span>&nbsp;<span class="ident" id="7830428">nil</span>&nbsp;<span class="op" id="7830432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830436"><a href="/net/dial_test.go.html#7830091">t</a></span><span class="op" id="7830437">.</span><span class="ident" id="7830438">Fatal</span><span class="op" id="7830443">(</span><span class="ident" id="7830444"><a href="/net/dial_test.go.html#7830381">err</a></span><span class="op" id="7830447">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830453">c</span><span class="op" id="7830454">,</span>&nbsp;<span class="ident" id="7830456"><a href="/net/dial_test.go.html#7830381">err</a></span>&nbsp;<span class="op" id="7830460">:=</span>&nbsp;<span class="ident" id="7830463"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7830467">(</span><span class="string" id="7830468">&#34;tcp&#34;</span><span class="op" id="7830473">,</span>&nbsp;<span class="ident" id="7830475"><a href="/net/dial_test.go.html#7830378">l</a></span><span class="op" id="7830476">.</span><span class="ident" id="7830477">Addr</span><span class="op" id="7830481">(</span><span class="op" id="7830482">)</span><span class="op" id="7830483">.</span><span class="ident" id="7830484">String</span><span class="op" id="7830490">(</span><span class="op" id="7830491">)</span><span class="op" id="7830492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830495">if</span>&nbsp;<span class="ident" id="7830498"><a href="/net/dial_test.go.html#7830381">err</a></span>&nbsp;<span class="op" id="7830502">!=</span>&nbsp;<span class="ident" id="7830505">nil</span>&nbsp;<span class="op" id="7830509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830513"><a href="/net/dial_test.go.html#7830091">t</a></span><span class="op" id="7830514">.</span><span class="ident" id="7830515">Fatal</span><span class="op" id="7830520">(</span><span class="ident" id="7830521"><a href="/net/dial_test.go.html#7830381">err</a></span><span class="op" id="7830524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830527">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830530">addr</span>&nbsp;<span class="op" id="7830535">:=</span>&nbsp;<span class="ident" id="7830538"><a href="/net/dial_test.go.html#7830453">c</a></span><span class="op" id="7830539">.</span><span class="ident" id="7830540">LocalAddr</span><span class="op" id="7830549">(</span><span class="op" id="7830550">)</span><span class="op" id="7830551">.</span><span class="ident" id="7830552">String</span><span class="op" id="7830558">(</span><span class="op" id="7830559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830562"><a href="/net/dial_test.go.html#7830453">c</a></span><span class="op" id="7830563">.</span><span class="ident" id="7830564">Close</span><span class="op" id="7830569">(</span><span class="op" id="7830570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830573"><a href="/net/dial_test.go.html#7830378">l</a></span><span class="op" id="7830574">.</span><span class="ident" id="7830575">Close</span><span class="op" id="7830580">(</span><span class="op" id="7830581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830585">//&nbsp;Try&nbsp;to&nbsp;connect&nbsp;to&nbsp;that&nbsp;address&nbsp;repeatedly.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830632">n</span>&nbsp;<span class="op" id="7830634">:=</span>&nbsp;<span class="num" id="7830637">100000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830645">if</span>&nbsp;<span class="ident" id="7830648"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7830655">.</span><span class="ident" id="7830656">Short</span><span class="op" id="7830661">(</span><span class="op" id="7830662">)</span>&nbsp;<span class="op" id="7830664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830668"><a href="/net/dial_test.go.html#7830632">n</a></span>&nbsp;<span class="op" id="7830670">=</span>&nbsp;<span class="num" id="7830672">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830681">switch</span>&nbsp;<span class="ident" id="7830688"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7830695">.</span><span class="ident" id="7830696">GOOS</span>&nbsp;<span class="op" id="7830701">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830704">case</span>&nbsp;<span class="string" id="7830709">&#34;darwin&#34;</span><span class="op" id="7830717">,</span>&nbsp;<span class="string" id="7830719">&#34;dragonfly&#34;</span><span class="op" id="7830730">,</span>&nbsp;<span class="string" id="7830732">&#34;freebsd&#34;</span><span class="op" id="7830741">,</span>&nbsp;<span class="string" id="7830743">&#34;netbsd&#34;</span><span class="op" id="7830751">,</span>&nbsp;<span class="string" id="7830753">&#34;openbsd&#34;</span><span class="op" id="7830762">,</span>&nbsp;<span class="string" id="7830764">&#34;plan9&#34;</span><span class="op" id="7830771">,</span>&nbsp;<span class="string" id="7830773">&#34;solaris&#34;</span><span class="op" id="7830782">,</span>&nbsp;<span class="string" id="7830784">&#34;windows&#34;</span><span class="op" id="7830793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830797">//&nbsp;Non-Linux&nbsp;systems&nbsp;take&nbsp;a&nbsp;long&nbsp;time&nbsp;to&nbsp;figure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830847">//&nbsp;out&nbsp;that&nbsp;there&nbsp;is&nbsp;nothing&nbsp;listening&nbsp;on&nbsp;localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830902"><a href="/net/dial_test.go.html#7830632">n</a></span>&nbsp;<span class="op" id="7830904">=</span>&nbsp;<span class="num" id="7830906">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830911">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830914">for</span>&nbsp;<span class="ident" id="7830918">i</span>&nbsp;<span class="op" id="7830920">:=</span>&nbsp;<span class="num" id="7830923">0</span><span class="op" id="7830924">;</span>&nbsp;<span class="ident" id="7830926"><a href="/net/dial_test.go.html#7830918">i</a></span>&nbsp;<span class="op" id="7830928">&lt;</span>&nbsp;<span class="ident" id="7830930"><a href="/net/dial_test.go.html#7830632">n</a></span><span class="op" id="7830931">;</span>&nbsp;<span class="ident" id="7830933"><a href="/net/dial_test.go.html#7830918">i</a></span><span class="op" id="7830934">++</span>&nbsp;<span class="op" id="7830937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830941">c</span><span class="op" id="7830942">,</span>&nbsp;<span class="ident" id="7830944">err</span>&nbsp;<span class="op" id="7830948">:=</span>&nbsp;<span class="ident" id="7830951"><a href="/net/dial.go.html#1334583">DialTimeout</a></span><span class="op" id="7830962">(</span><span class="string" id="7830963">&#34;tcp&#34;</span><span class="op" id="7830968">,</span>&nbsp;<span class="ident" id="7830970"><a href="/net/dial_test.go.html#7830530">addr</a></span><span class="op" id="7830974">,</span>&nbsp;<span class="ident" id="7830976"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7830980">.</span><span class="ident" id="7830981">Millisecond</span><span class="op" id="7830992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830996">if</span>&nbsp;<span class="ident" id="7830999"><a href="/net/dial_test.go.html#7830944">err</a></span>&nbsp;<span class="op" id="7831003">==</span>&nbsp;<span class="ident" id="7831006">nil</span>&nbsp;<span class="op" id="7831010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831015">if</span>&nbsp;<span class="ident" id="7831018"><a href="/net/dial_test.go.html#7830941">c</a></span><span class="op" id="7831019">.</span><span class="ident" id="7831020">LocalAddr</span><span class="op" id="7831029">(</span><span class="op" id="7831030">)</span><span class="op" id="7831031">.</span><span class="ident" id="7831032">String</span><span class="op" id="7831038">(</span><span class="op" id="7831039">)</span>&nbsp;<span class="op" id="7831041">==</span>&nbsp;<span class="ident" id="7831044"><a href="/net/dial_test.go.html#7830530">addr</a></span>&nbsp;<span class="op" id="7831049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831055"><a href="/net/dial_test.go.html#7830091">t</a></span><span class="op" id="7831056">.</span><span class="ident" id="7831057">Errorf</span><span class="op" id="7831063">(</span><span class="string" id="7831064">&#34;#%d:&nbsp;Dial&nbsp;%q&nbsp;self-connect&#34;</span><span class="op" id="7831091">,</span>&nbsp;<span class="ident" id="7831093"><a href="/net/dial_test.go.html#7830918">i</a></span><span class="op" id="7831094">,</span>&nbsp;<span class="ident" id="7831096"><a href="/net/dial_test.go.html#7830530">addr</a></span><span class="op" id="7831100">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831105">}</span>&nbsp;<span class="keyword" id="7831107">else</span>&nbsp;<span class="op" id="7831112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831118"><a href="/net/dial_test.go.html#7830091">t</a></span><span class="op" id="7831119">.</span><span class="ident" id="7831120">Logf</span><span class="op" id="7831124">(</span><span class="string" id="7831125">&#34;#%d:&nbsp;Dial&nbsp;%q&nbsp;succeeded&nbsp;-&nbsp;possibly&nbsp;racing&nbsp;with&nbsp;other&nbsp;listener&#34;</span><span class="op" id="7831187">,</span>&nbsp;<span class="ident" id="7831189"><a href="/net/dial_test.go.html#7830918">i</a></span><span class="op" id="7831190">,</span>&nbsp;<span class="ident" id="7831192"><a href="/net/dial_test.go.html#7830530">addr</a></span><span class="op" id="7831196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831206"><a href="/net/dial_test.go.html#7830941">c</a></span><span class="op" id="7831207">.</span><span class="ident" id="7831208">Close</span><span class="op" id="7831213">(</span><span class="op" id="7831214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831218">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831221">}</span><br>
<span class="lineno"></span><span class="op" id="7831223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7831226">var</span>&nbsp;<span class="ident" id="7831230">runErrorTest</span>&nbsp;<span class="op" id="7831243">=</span>&nbsp;<span class="ident" id="7831245"><a href="/net/dial_test.go.html#7827334">flag</a></span><span class="op" id="7831249">.</span><span class="ident" id="7831250">Bool</span><span class="op" id="7831254">(</span><span class="string" id="7831255">&#34;run_error_test&#34;</span><span class="op" id="7831271">,</span>&nbsp;<span class="builtintype" id="7831273">false</span><span class="op" id="7831278">,</span>&nbsp;<span class="string" id="7831280">&#34;let&nbsp;TestDialError&nbsp;check&nbsp;for&nbsp;dns&nbsp;errors&#34;</span><span class="op" id="7831320">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7831323">type</span>&nbsp;<span class="ident" id="7831328">DialErrorTest</span>&nbsp;<span class="keyword" id="7831342">struct</span>&nbsp;<span class="op" id="7831349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831352">Net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7831360">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831368">Raddr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7831376">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831384">Pattern</span>&nbsp;<span class="builtintype" id="7831392">string</span><br>
<span class="lineno"></span><span class="op" id="7831399">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7831402">var</span>&nbsp;<span class="ident" id="7831406">dialErrorTests</span>&nbsp;<span class="op" id="7831421">=</span>&nbsp;<span class="op" id="7831423">[</span><span class="op" id="7831424">]</span><span class="ident" id="7831425"><a href="/net/dial_test.go.html#7831328">DialErrorTest</a></span><span class="op" id="7831438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831445">&#34;datakit&#34;</span><span class="op" id="7831454">,</span>&nbsp;<span class="string" id="7831456">&#34;mh/astro/r70&#34;</span><span class="op" id="7831470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831474">&#34;dial&nbsp;datakit&nbsp;mh/astro/r70:&nbsp;unknown&nbsp;network&nbsp;datakit&#34;</span><span class="op" id="7831526">,</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831529">}</span><span class="op" id="7831530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831537">&#34;tcp&#34;</span><span class="op" id="7831542">,</span>&nbsp;<span class="string" id="7831544">&#34;127.0.0.1:☺&#34;</span><span class="op" id="7831559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831563">&#34;dial&nbsp;tcp&nbsp;127.0.0.1:☺:&nbsp;unknown&nbsp;port&nbsp;tcp/☺&#34;</span><span class="op" id="7831609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831612">}</span><span class="op" id="7831613">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831620">&#34;tcp&#34;</span><span class="op" id="7831625">,</span>&nbsp;<span class="string" id="7831627">&#34;no-such-name.google.com.:80&#34;</span><span class="op" id="7831656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831660">&#34;dial&nbsp;tcp&nbsp;no-such-name.google.com.:80:&nbsp;lookup&nbsp;no-such-name.google.com.(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)&#34;</span><span class="op" id="7831749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831752">}</span><span class="op" id="7831753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831756">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831760">&#34;tcp&#34;</span><span class="op" id="7831765">,</span>&nbsp;<span class="string" id="7831767">&#34;no-such-name.no-such-top-level-domain.:80&#34;</span><span class="op" id="7831810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831814">&#34;dial&nbsp;tcp&nbsp;no-such-name.no-such-top-level-domain.:80:&nbsp;lookup&nbsp;no-such-name.no-such-top-level-domain.(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)&#34;</span><span class="op" id="7831931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831934">}</span><span class="op" id="7831935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831942">&#34;tcp&#34;</span><span class="op" id="7831947">,</span>&nbsp;<span class="string" id="7831949">&#34;no-such-name:80&#34;</span><span class="op" id="7831966">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7831970">`dial&nbsp;tcp&nbsp;no-such-name:80:&nbsp;lookup&nbsp;no-such-name\.(.*\.)?(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)`</span><span class="op" id="7832044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832047">}</span><span class="op" id="7832048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832055">&#34;tcp&#34;</span><span class="op" id="7832060">,</span>&nbsp;<span class="string" id="7832062">&#34;mh/astro/r70:http&#34;</span><span class="op" id="7832081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832085">&#34;dial&nbsp;tcp&nbsp;mh/astro/r70:http:&nbsp;lookup&nbsp;mh/astro/r70:&nbsp;invalid&nbsp;domain&nbsp;name&#34;</span><span class="op" id="7832155">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832158">}</span><span class="op" id="7832159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832166">&#34;unix&#34;</span><span class="op" id="7832172">,</span>&nbsp;<span class="string" id="7832174">&#34;/etc/file-not-found&#34;</span><span class="op" id="7832195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832199">&#34;dial&nbsp;unix&nbsp;/etc/file-not-found:&nbsp;no&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&#34;</span><span class="op" id="7832257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832260">}</span><span class="op" id="7832261">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832268">&#34;unix&#34;</span><span class="op" id="7832274">,</span>&nbsp;<span class="string" id="7832276">&#34;/etc/&#34;</span><span class="op" id="7832283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832287">&#34;dial&nbsp;unix&nbsp;/etc/:&nbsp;(permission&nbsp;denied|socket&nbsp;operation&nbsp;on&nbsp;non-socket|connection&nbsp;refused)&#34;</span><span class="op" id="7832375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832378">}</span><span class="op" id="7832379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832382">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832386">&#34;unixpacket&#34;</span><span class="op" id="7832398">,</span>&nbsp;<span class="string" id="7832400">&#34;/etc/file-not-found&#34;</span><span class="op" id="7832421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832425">&#34;dial&nbsp;unixpacket&nbsp;/etc/file-not-found:&nbsp;no&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&#34;</span><span class="op" id="7832489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832492">}</span><span class="op" id="7832493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832500">&#34;unixpacket&#34;</span><span class="op" id="7832512">,</span>&nbsp;<span class="string" id="7832514">&#34;/etc/&#34;</span><span class="op" id="7832521">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7832525">&#34;dial&nbsp;unixpacket&nbsp;/etc/:&nbsp;(permission&nbsp;denied|socket&nbsp;operation&nbsp;on&nbsp;non-socket|connection&nbsp;refused)&#34;</span><span class="op" id="7832619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832622">}</span><span class="op" id="7832623">,</span><br>
<span class="lineno"></span><span class="op" id="7832625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7832628">var</span>&nbsp;<span class="ident" id="7832632">duplicateErrorPattern</span>&nbsp;<span class="op" id="7832654">=</span>&nbsp;<span class="string" id="7832656">`dial&nbsp;(.*)&nbsp;dial&nbsp;(.*)`</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="7832679">func</span>&nbsp;<span class="ident" id="7832684">TestDialError</span><span class="op" id="7832697">(</span><span class="ident" id="7832698">t</span>&nbsp;<span class="op" id="7832700">*</span><span class="ident" id="7832701"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7832708">.</span><span class="ident" id="7832709">T</span><span class="op" id="7832710">)</span>&nbsp;<span class="op" id="7832712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832715">if</span>&nbsp;<span class="op" id="7832718">!</span><span class="op" id="7832719">*</span><span class="ident" id="7832720"><a href="/net/dial_test.go.html#7831230">runErrorTest</a></span>&nbsp;<span class="op" id="7832733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832737"><a href="/net/dial_test.go.html#7832698">t</a></span><span class="op" id="7832738">.</span><span class="ident" id="7832739">Logf</span><span class="op" id="7832743">(</span><span class="string" id="7832744">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-run_error_test&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7832790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832794">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832805">for</span>&nbsp;<span class="ident" id="7832809">i</span><span class="op" id="7832810">,</span>&nbsp;<span class="ident" id="7832812">tt</span>&nbsp;<span class="op" id="7832815">:=</span>&nbsp;<span class="keyword" id="7832818">range</span>&nbsp;<span class="ident" id="7832824"><a href="/net/dial_test.go.html#7831406">dialErrorTests</a></span>&nbsp;<span class="op" id="7832839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832843">c</span><span class="op" id="7832844">,</span>&nbsp;<span class="ident" id="7832846">err</span>&nbsp;<span class="op" id="7832850">:=</span>&nbsp;<span class="ident" id="7832853"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7832857">(</span><span class="ident" id="7832858"><a href="/net/dial_test.go.html#7832812">tt</a></span><span class="op" id="7832860">.</span><span class="ident" id="7832861">Net</span><span class="op" id="7832864">,</span>&nbsp;<span class="ident" id="7832866"><a href="/net/dial_test.go.html#7832812">tt</a></span><span class="op" id="7832868">.</span><span class="ident" id="7832869">Raddr</span><span class="op" id="7832874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832878">if</span>&nbsp;<span class="ident" id="7832881"><a href="/net/dial_test.go.html#7832843">c</a></span>&nbsp;<span class="op" id="7832883">!=</span>&nbsp;<span class="ident" id="7832886">nil</span>&nbsp;<span class="op" id="7832890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832895"><a href="/net/dial_test.go.html#7832843">c</a></span><span class="op" id="7832896">.</span><span class="ident" id="7832897">Close</span><span class="op" id="7832902">(</span><span class="op" id="7832903">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832911">if</span>&nbsp;<span class="ident" id="7832914"><a href="/net/dial_test.go.html#7832846">err</a></span>&nbsp;<span class="op" id="7832918">==</span>&nbsp;<span class="ident" id="7832921">nil</span>&nbsp;<span class="op" id="7832925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832930"><a href="/net/dial_test.go.html#7832698">t</a></span><span class="op" id="7832931">.</span><span class="ident" id="7832932">Errorf</span><span class="op" id="7832938">(</span><span class="string" id="7832939">&#34;#%d:&nbsp;nil&nbsp;error,&nbsp;want&nbsp;match&nbsp;for&nbsp;%#q&#34;</span><span class="op" id="7832975">,</span>&nbsp;<span class="ident" id="7832977"><a href="/net/dial_test.go.html#7832809">i</a></span><span class="op" id="7832978">,</span>&nbsp;<span class="ident" id="7832980"><a href="/net/dial_test.go.html#7832812">tt</a></span><span class="op" id="7832982">.</span><span class="ident" id="7832983">Pattern</span><span class="op" id="7832990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832995">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833006">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833010">s</span>&nbsp;<span class="op" id="7833012">:=</span>&nbsp;<span class="ident" id="7833015"><a href="/net/dial_test.go.html#7832846">err</a></span><span class="op" id="7833018">.</span><span class="ident" id="7833019">Error</span><span class="op" id="7833024">(</span><span class="op" id="7833025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833029">match</span><span class="op" id="7833034">,</span>&nbsp;<span class="ident" id="7833036">_</span>&nbsp;<span class="op" id="7833038">:=</span>&nbsp;<span class="ident" id="7833041"><a href="/net/dial_test.go.html#7827383">regexp</a></span><span class="op" id="7833047">.</span><span class="ident" id="7833048">MatchString</span><span class="op" id="7833059">(</span><span class="ident" id="7833060"><a href="/net/dial_test.go.html#7832812">tt</a></span><span class="op" id="7833062">.</span><span class="ident" id="7833063">Pattern</span><span class="op" id="7833070">,</span>&nbsp;<span class="ident" id="7833072"><a href="/net/dial_test.go.html#7833010">s</a></span><span class="op" id="7833073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833077">if</span>&nbsp;<span class="op" id="7833080">!</span><span class="ident" id="7833081"><a href="/net/dial_test.go.html#7833029">match</a></span>&nbsp;<span class="op" id="7833087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833092"><a href="/net/dial_test.go.html#7832698">t</a></span><span class="op" id="7833093">.</span><span class="ident" id="7833094">Errorf</span><span class="op" id="7833100">(</span><span class="string" id="7833101">&#34;#%d:&nbsp;%q,&nbsp;want&nbsp;match&nbsp;for&nbsp;%#q&#34;</span><span class="op" id="7833130">,</span>&nbsp;<span class="ident" id="7833132"><a href="/net/dial_test.go.html#7832809">i</a></span><span class="op" id="7833133">,</span>&nbsp;<span class="ident" id="7833135"><a href="/net/dial_test.go.html#7833010">s</a></span><span class="op" id="7833136">,</span>&nbsp;<span class="ident" id="7833138"><a href="/net/dial_test.go.html#7832812">tt</a></span><span class="op" id="7833140">.</span><span class="ident" id="7833141">Pattern</span><span class="op" id="7833148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833152">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833156"><a href="/net/dial_test.go.html#7833029">match</a></span><span class="op" id="7833161">,</span>&nbsp;<span class="ident" id="7833163">_</span>&nbsp;<span class="op" id="7833165">=</span>&nbsp;<span class="ident" id="7833167"><a href="/net/dial_test.go.html#7827383">regexp</a></span><span class="op" id="7833173">.</span><span class="ident" id="7833174">MatchString</span><span class="op" id="7833185">(</span><span class="ident" id="7833186"><a href="/net/dial_test.go.html#7832632">duplicateErrorPattern</a></span><span class="op" id="7833207">,</span>&nbsp;<span class="ident" id="7833209"><a href="/net/dial_test.go.html#7833010">s</a></span><span class="op" id="7833210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833214">if</span>&nbsp;<span class="ident" id="7833217"><a href="/net/dial_test.go.html#7833029">match</a></span>&nbsp;<span class="op" id="7833223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833228"><a href="/net/dial_test.go.html#7832698">t</a></span><span class="op" id="7833229">.</span><span class="ident" id="7833230">Errorf</span><span class="op" id="7833236">(</span><span class="string" id="7833237">&#34;#%d:&nbsp;%q,&nbsp;duplicate&nbsp;error&nbsp;return&nbsp;from&nbsp;Dial&#34;</span><span class="op" id="7833280">,</span>&nbsp;<span class="ident" id="7833282"><a href="/net/dial_test.go.html#7832809">i</a></span><span class="op" id="7833283">,</span>&nbsp;<span class="ident" id="7833285"><a href="/net/dial_test.go.html#7833010">s</a></span><span class="op" id="7833286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833293">}</span><br>
<span class="lineno">240</span><span class="op" id="7833295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7833298">var</span>&nbsp;<span class="ident" id="7833302">invalidDialAndListenArgTests</span>&nbsp;<span class="op" id="7833331">=</span>&nbsp;<span class="op" id="7833333">[</span><span class="op" id="7833334">]</span><span class="keyword" id="7833335">struct</span>&nbsp;<span class="op" id="7833342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833345">net</span>&nbsp;&nbsp;<span class="builtintype" id="7833350">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833358">addr</span>&nbsp;<span class="builtintype" id="7833363">string</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833371">err</span>&nbsp;&nbsp;<span class="builtintype" id="7833376">error</span><br>
<span class="lineno"></span><span class="op" id="7833382">}</span><span class="op" id="7833383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833386">{</span><span class="string" id="7833387">&#34;foo&#34;</span><span class="op" id="7833392">,</span>&nbsp;<span class="string" id="7833394">&#34;bar&#34;</span><span class="op" id="7833399">,</span>&nbsp;<span class="op" id="7833401">&amp;</span><span class="ident" id="7833402"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="7833409">{</span><span class="ident" id="7833410">Op</span><span class="op" id="7833412">:</span>&nbsp;<span class="string" id="7833414">&#34;dial&#34;</span><span class="op" id="7833420">,</span>&nbsp;<span class="ident" id="7833422">Net</span><span class="op" id="7833425">:</span>&nbsp;<span class="string" id="7833427">&#34;foo&#34;</span><span class="op" id="7833432">,</span>&nbsp;<span class="ident" id="7833434">Addr</span><span class="op" id="7833438">:</span>&nbsp;<span class="ident" id="7833440">nil</span><span class="op" id="7833443">,</span>&nbsp;<span class="ident" id="7833445">Err</span><span class="op" id="7833448">:</span>&nbsp;<span class="ident" id="7833450"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="7833469">(</span><span class="string" id="7833470">&#34;foo&#34;</span><span class="op" id="7833475">)</span><span class="op" id="7833476">}</span><span class="op" id="7833477">}</span><span class="op" id="7833478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833481">{</span><span class="string" id="7833482">&#34;baz&#34;</span><span class="op" id="7833487">,</span>&nbsp;<span class="string" id="7833489">&#34;&#34;</span><span class="op" id="7833491">,</span>&nbsp;<span class="op" id="7833493">&amp;</span><span class="ident" id="7833494"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="7833501">{</span><span class="ident" id="7833502">Op</span><span class="op" id="7833504">:</span>&nbsp;<span class="string" id="7833506">&#34;listen&#34;</span><span class="op" id="7833514">,</span>&nbsp;<span class="ident" id="7833516">Net</span><span class="op" id="7833519">:</span>&nbsp;<span class="string" id="7833521">&#34;baz&#34;</span><span class="op" id="7833526">,</span>&nbsp;<span class="ident" id="7833528">Addr</span><span class="op" id="7833532">:</span>&nbsp;<span class="ident" id="7833534">nil</span><span class="op" id="7833537">,</span>&nbsp;<span class="ident" id="7833539">Err</span><span class="op" id="7833542">:</span>&nbsp;<span class="ident" id="7833544"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="7833563">(</span><span class="string" id="7833564">&#34;baz&#34;</span><span class="op" id="7833569">)</span><span class="op" id="7833570">}</span><span class="op" id="7833571">}</span><span class="op" id="7833572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833575">{</span><span class="string" id="7833576">&#34;tcp&#34;</span><span class="op" id="7833581">,</span>&nbsp;<span class="string" id="7833583">&#34;&#34;</span><span class="op" id="7833585">,</span>&nbsp;<span class="op" id="7833587">&amp;</span><span class="ident" id="7833588"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="7833595">{</span><span class="ident" id="7833596">Op</span><span class="op" id="7833598">:</span>&nbsp;<span class="string" id="7833600">&#34;dial&#34;</span><span class="op" id="7833606">,</span>&nbsp;<span class="ident" id="7833608">Net</span><span class="op" id="7833611">:</span>&nbsp;<span class="string" id="7833613">&#34;tcp&#34;</span><span class="op" id="7833618">,</span>&nbsp;<span class="ident" id="7833620">Addr</span><span class="op" id="7833624">:</span>&nbsp;<span class="ident" id="7833626">nil</span><span class="op" id="7833629">,</span>&nbsp;<span class="ident" id="7833631">Err</span><span class="op" id="7833634">:</span>&nbsp;<span class="ident" id="7833636"><a href="/net/net.go.html#1472020">errMissingAddress</a></span><span class="op" id="7833653">}</span><span class="op" id="7833654">}</span><span class="op" id="7833655">,</span><br>
<span class="lineno">250</span><span class="op" id="7833657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7833660">func</span>&nbsp;<span class="ident" id="7833665">TestInvalidDialAndListenArgs</span><span class="op" id="7833693">(</span><span class="ident" id="7833694">t</span>&nbsp;<span class="op" id="7833696">*</span><span class="ident" id="7833697"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7833704">.</span><span class="ident" id="7833705">T</span><span class="op" id="7833706">)</span>&nbsp;<span class="op" id="7833708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833711">for</span>&nbsp;<span class="ident" id="7833715">_</span><span class="op" id="7833716">,</span>&nbsp;<span class="ident" id="7833718">tt</span>&nbsp;<span class="op" id="7833721">:=</span>&nbsp;<span class="keyword" id="7833724">range</span>&nbsp;<span class="ident" id="7833730"><a href="/net/dial_test.go.html#7833302">invalidDialAndListenArgTests</a></span>&nbsp;<span class="op" id="7833759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833763">var</span>&nbsp;<span class="ident" id="7833767">err</span>&nbsp;<span class="builtintype" id="7833771">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833779">switch</span>&nbsp;<span class="ident" id="7833786"><a href="/net/dial_test.go.html#7833718">tt</a></span><span class="op" id="7833788">.</span><span class="ident" id="7833789">err</span><span class="op" id="7833792">.</span><span class="op" id="7833793">(</span><span class="op" id="7833794">*</span><span class="ident" id="7833795"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="7833802">)</span><span class="op" id="7833803">.</span><span class="ident" id="7833804">Op</span>&nbsp;<span class="op" id="7833807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833811">case</span>&nbsp;<span class="string" id="7833816">&#34;dial&#34;</span><span class="op" id="7833822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833827">_</span><span class="op" id="7833828">,</span>&nbsp;<span class="ident" id="7833830"><a href="/net/dial_test.go.html#7833767">err</a></span>&nbsp;<span class="op" id="7833834">=</span>&nbsp;<span class="ident" id="7833836"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7833840">(</span><span class="ident" id="7833841"><a href="/net/dial_test.go.html#7833718">tt</a></span><span class="op" id="7833843">.</span><span class="ident" id="7833844">net</span><span class="op" id="7833847">,</span>&nbsp;<span class="ident" id="7833849"><a href="/net/dial_test.go.html#7833718">tt</a></span><span class="op" id="7833851">.</span><span class="ident" id="7833852">addr</span><span class="op" id="7833856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833860">case</span>&nbsp;<span class="string" id="7833865">&#34;listen&#34;</span><span class="op" id="7833873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833878">_</span><span class="op" id="7833879">,</span>&nbsp;<span class="ident" id="7833881"><a href="/net/dial_test.go.html#7833767">err</a></span>&nbsp;<span class="op" id="7833885">=</span>&nbsp;<span class="ident" id="7833887"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7833893">(</span><span class="ident" id="7833894"><a href="/net/dial_test.go.html#7833718">tt</a></span><span class="op" id="7833896">.</span><span class="ident" id="7833897">net</span><span class="op" id="7833900">,</span>&nbsp;<span class="ident" id="7833902"><a href="/net/dial_test.go.html#7833718">tt</a></span><span class="op" id="7833904">.</span><span class="ident" id="7833905">addr</span><span class="op" id="7833909">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833917">if</span>&nbsp;<span class="op" id="7833920">!</span><span class="ident" id="7833921"><a href="/net/dial_test.go.html#7827372">reflect</a></span><span class="op" id="7833928">.</span><span class="ident" id="7833929">DeepEqual</span><span class="op" id="7833938">(</span><span class="ident" id="7833939"><a href="/net/dial_test.go.html#7833718">tt</a></span><span class="op" id="7833941">.</span><span class="ident" id="7833942">err</span><span class="op" id="7833945">,</span>&nbsp;<span class="ident" id="7833947"><a href="/net/dial_test.go.html#7833767">err</a></span><span class="op" id="7833950">)</span>&nbsp;<span class="op" id="7833952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833957"><a href="/net/dial_test.go.html#7833694">t</a></span><span class="op" id="7833958">.</span><span class="ident" id="7833959">Fatalf</span><span class="op" id="7833965">(</span><span class="string" id="7833966">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7833989">,</span>&nbsp;<span class="ident" id="7833991"><a href="/net/dial_test.go.html#7833767">err</a></span><span class="op" id="7833994">,</span>&nbsp;<span class="ident" id="7833996"><a href="/net/dial_test.go.html#7833718">tt</a></span><span class="op" id="7833998">.</span><span class="ident" id="7833999">err</span><span class="op" id="7834002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834009">}</span><br>
<span class="lineno">265</span><span class="op" id="7834011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7834014">func</span>&nbsp;<span class="ident" id="7834019">TestDialTimeoutFDLeak</span><span class="op" id="7834040">(</span><span class="ident" id="7834041">t</span>&nbsp;<span class="op" id="7834043">*</span><span class="ident" id="7834044"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7834051">.</span><span class="ident" id="7834052">T</span><span class="op" id="7834053">)</span>&nbsp;<span class="op" id="7834055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834058">if</span>&nbsp;<span class="ident" id="7834061"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7834068">.</span><span class="ident" id="7834069">GOOS</span>&nbsp;<span class="op" id="7834074">!=</span>&nbsp;<span class="string" id="7834077">&#34;linux&#34;</span>&nbsp;<span class="op" id="7834085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834089">//&nbsp;TODO(bradfitz):&nbsp;test&nbsp;on&nbsp;other&nbsp;platforms</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834134"><a href="/net/dial_test.go.html#7834041">t</a></span><span class="op" id="7834135">.</span><span class="ident" id="7834136">Skipf</span><span class="op" id="7834141">(</span><span class="string" id="7834142">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7834163">,</span>&nbsp;<span class="ident" id="7834165"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7834172">.</span><span class="ident" id="7834173">GOOS</span><span class="op" id="7834177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834184">ln</span>&nbsp;<span class="op" id="7834187">:=</span>&nbsp;<span class="ident" id="7834190"><a href="/net/dial_test.go.html#7827449">newLocalListener</a></span><span class="op" id="7834206">(</span><span class="ident" id="7834207"><a href="/net/dial_test.go.html#7834041">t</a></span><span class="op" id="7834208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834211">defer</span>&nbsp;<span class="ident" id="7834217"><a href="/net/dial_test.go.html#7834184">ln</a></span><span class="op" id="7834219">.</span><span class="ident" id="7834220">Close</span><span class="op" id="7834225">(</span><span class="op" id="7834226">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834230">type</span>&nbsp;<span class="ident" id="7834235">connErr</span>&nbsp;<span class="keyword" id="7834243">struct</span>&nbsp;<span class="op" id="7834250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834254">conn</span>&nbsp;<span class="ident" id="7834259"><a href="/net/net.go.html#1465335">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834266">err</span>&nbsp;&nbsp;<span class="builtintype" id="7834271">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834278">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834281">dials</span>&nbsp;<span class="op" id="7834287">:=</span>&nbsp;<span class="ident" id="7834290"><a href="/net/net.go.html#1471426">listenerBacklog</a></span>&nbsp;<span class="op" id="7834306">+</span>&nbsp;<span class="num" id="7834308">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834313">//&nbsp;used&nbsp;to&nbsp;be&nbsp;listenerBacklog&nbsp;+&nbsp;5,&nbsp;but&nbsp;was&nbsp;found&nbsp;to&nbsp;be&nbsp;unreliable,&nbsp;issue&nbsp;4384.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834393">maxGoodConnect</span>&nbsp;<span class="op" id="7834408">:=</span>&nbsp;<span class="ident" id="7834411"><a href="/net/net.go.html#1471426">listenerBacklog</a></span>&nbsp;<span class="op" id="7834427">+</span>&nbsp;<span class="ident" id="7834429"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7834436">.</span><span class="ident" id="7834437">NumCPU</span><span class="op" id="7834443">(</span><span class="op" id="7834444">)</span><span class="op" id="7834445">*</span><span class="num" id="7834446">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834450">resc</span>&nbsp;<span class="op" id="7834455">:=</span>&nbsp;<span class="builtinfunc" id="7834458">make</span><span class="op" id="7834462">(</span><span class="keyword" id="7834463">chan</span>&nbsp;<span class="ident" id="7834468"><a href="/net/dial_test.go.html#7834235">connErr</a></span><span class="op" id="7834475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834478">for</span>&nbsp;<span class="ident" id="7834482">i</span>&nbsp;<span class="op" id="7834484">:=</span>&nbsp;<span class="num" id="7834487">0</span><span class="op" id="7834488">;</span>&nbsp;<span class="ident" id="7834490"><a href="/net/dial_test.go.html#7834482">i</a></span>&nbsp;<span class="op" id="7834492">&lt;</span>&nbsp;<span class="ident" id="7834494"><a href="/net/dial_test.go.html#7834281">dials</a></span><span class="op" id="7834499">;</span>&nbsp;<span class="ident" id="7834501"><a href="/net/dial_test.go.html#7834482">i</a></span><span class="op" id="7834502">++</span>&nbsp;<span class="op" id="7834505">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834509">go</span>&nbsp;<span class="keyword" id="7834512">func</span><span class="op" id="7834516">(</span><span class="op" id="7834517">)</span>&nbsp;<span class="op" id="7834519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834524">conn</span><span class="op" id="7834528">,</span>&nbsp;<span class="ident" id="7834530">err</span>&nbsp;<span class="op" id="7834534">:=</span>&nbsp;<span class="ident" id="7834537"><a href="/net/dial.go.html#1334583">DialTimeout</a></span><span class="op" id="7834548">(</span><span class="string" id="7834549">&#34;tcp&#34;</span><span class="op" id="7834554">,</span>&nbsp;<span class="ident" id="7834556"><a href="/net/dial_test.go.html#7834184">ln</a></span><span class="op" id="7834558">.</span><span class="ident" id="7834559">Addr</span><span class="op" id="7834563">(</span><span class="op" id="7834564">)</span><span class="op" id="7834565">.</span><span class="ident" id="7834566">String</span><span class="op" id="7834572">(</span><span class="op" id="7834573">)</span><span class="op" id="7834574">,</span>&nbsp;<span class="num" id="7834576">500</span><span class="op" id="7834579">*</span><span class="ident" id="7834580"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7834584">.</span><span class="ident" id="7834585">Millisecond</span><span class="op" id="7834596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834601"><a href="/net/dial_test.go.html#7834450">resc</a></span>&nbsp;<span class="op" id="7834606">&lt;-</span>&nbsp;<span class="ident" id="7834609"><a href="/net/dial_test.go.html#7834235">connErr</a></span><span class="op" id="7834616">{</span><span class="ident" id="7834617"><a href="/net/dial_test.go.html#7834524">conn</a></span><span class="op" id="7834621">,</span>&nbsp;<span class="ident" id="7834623"><a href="/net/dial_test.go.html#7834530">err</a></span><span class="op" id="7834626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834630">}</span><span class="op" id="7834631">(</span><span class="op" id="7834632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834635">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834639">var</span>&nbsp;<span class="ident" id="7834643">firstErr</span>&nbsp;<span class="builtintype" id="7834652">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834660">var</span>&nbsp;<span class="ident" id="7834664">ngood</span>&nbsp;<span class="builtintype" id="7834670">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834675">var</span>&nbsp;<span class="ident" id="7834679">toClose</span>&nbsp;<span class="op" id="7834687">[</span><span class="op" id="7834688">]</span><span class="ident" id="7834689"><a href="/net/dial_test.go.html#7827349">io</a></span><span class="op" id="7834691">.</span><span class="ident" id="7834692">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834700">for</span>&nbsp;<span class="ident" id="7834704">i</span>&nbsp;<span class="op" id="7834706">:=</span>&nbsp;<span class="num" id="7834709">0</span><span class="op" id="7834710">;</span>&nbsp;<span class="ident" id="7834712"><a href="/net/dial_test.go.html#7834704">i</a></span>&nbsp;<span class="op" id="7834714">&lt;</span>&nbsp;<span class="ident" id="7834716"><a href="/net/dial_test.go.html#7834281">dials</a></span><span class="op" id="7834721">;</span>&nbsp;<span class="ident" id="7834723"><a href="/net/dial_test.go.html#7834704">i</a></span><span class="op" id="7834724">++</span>&nbsp;<span class="op" id="7834727">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834731">ce</span>&nbsp;<span class="op" id="7834734">:=</span>&nbsp;<span class="op" id="7834737">&lt;-</span><span class="ident" id="7834739"><a href="/net/dial_test.go.html#7834450">resc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834746">if</span>&nbsp;<span class="ident" id="7834749"><a href="/net/dial_test.go.html#7834731">ce</a></span><span class="op" id="7834751">.</span><span class="ident" id="7834752">err</span>&nbsp;<span class="op" id="7834756">==</span>&nbsp;<span class="ident" id="7834759">nil</span>&nbsp;<span class="op" id="7834763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834768"><a href="/net/dial_test.go.html#7834664">ngood</a></span><span class="op" id="7834773">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834779">if</span>&nbsp;<span class="ident" id="7834782"><a href="/net/dial_test.go.html#7834664">ngood</a></span>&nbsp;<span class="op" id="7834788">&gt;</span>&nbsp;<span class="ident" id="7834790"><a href="/net/dial_test.go.html#7834393">maxGoodConnect</a></span>&nbsp;<span class="op" id="7834805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834811"><a href="/net/dial_test.go.html#7834041">t</a></span><span class="op" id="7834812">.</span><span class="ident" id="7834813">Errorf</span><span class="op" id="7834819">(</span><span class="string" id="7834820">&#34;%d&nbsp;good&nbsp;connects;&nbsp;expected&nbsp;at&nbsp;most&nbsp;%d&#34;</span><span class="op" id="7834859">,</span>&nbsp;<span class="ident" id="7834861"><a href="/net/dial_test.go.html#7834664">ngood</a></span><span class="op" id="7834866">,</span>&nbsp;<span class="ident" id="7834868"><a href="/net/dial_test.go.html#7834393">maxGoodConnect</a></span><span class="op" id="7834882">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834892"><a href="/net/dial_test.go.html#7834679">toClose</a></span>&nbsp;<span class="op" id="7834900">=</span>&nbsp;<span class="builtinfunc" id="7834902">append</span><span class="op" id="7834908">(</span><span class="ident" id="7834909"><a href="/net/dial_test.go.html#7834679">toClose</a></span><span class="op" id="7834916">,</span>&nbsp;<span class="ident" id="7834918"><a href="/net/dial_test.go.html#7834731">ce</a></span><span class="op" id="7834920">.</span><span class="ident" id="7834921">conn</span><span class="op" id="7834925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7834941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834945">err</span>&nbsp;<span class="op" id="7834949">:=</span>&nbsp;<span class="ident" id="7834952"><a href="/net/dial_test.go.html#7834731">ce</a></span><span class="op" id="7834954">.</span><span class="ident" id="7834955">err</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7834961">if</span>&nbsp;<span class="ident" id="7834964"><a href="/net/dial_test.go.html#7834643">firstErr</a></span>&nbsp;<span class="op" id="7834973">==</span>&nbsp;<span class="string" id="7834976">&#34;&#34;</span>&nbsp;<span class="op" id="7834979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834984"><a href="/net/dial_test.go.html#7834643">firstErr</a></span>&nbsp;<span class="op" id="7834993">=</span>&nbsp;<span class="ident" id="7834995"><a href="/net/dial_test.go.html#7834945">err</a></span><span class="op" id="7834998">.</span><span class="ident" id="7834999">Error</span><span class="op" id="7835004">(</span><span class="op" id="7835005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835009">}</span>&nbsp;<span class="keyword" id="7835011">else</span>&nbsp;<span class="keyword" id="7835016">if</span>&nbsp;<span class="ident" id="7835019"><a href="/net/dial_test.go.html#7834945">err</a></span><span class="op" id="7835022">.</span><span class="ident" id="7835023">Error</span><span class="op" id="7835028">(</span><span class="op" id="7835029">)</span>&nbsp;<span class="op" id="7835031">!=</span>&nbsp;<span class="ident" id="7835034"><a href="/net/dial_test.go.html#7834643">firstErr</a></span>&nbsp;<span class="op" id="7835043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835048"><a href="/net/dial_test.go.html#7834041">t</a></span><span class="op" id="7835049">.</span><span class="ident" id="7835050">Fatalf</span><span class="op" id="7835056">(</span><span class="string" id="7835057">&#34;inconsistent&nbsp;error&nbsp;messages:&nbsp;first&nbsp;was&nbsp;%q,&nbsp;then&nbsp;later&nbsp;%q&#34;</span><span class="op" id="7835115">,</span>&nbsp;<span class="ident" id="7835117"><a href="/net/dial_test.go.html#7834643">firstErr</a></span><span class="op" id="7835125">,</span>&nbsp;<span class="ident" id="7835127"><a href="/net/dial_test.go.html#7834945">err</a></span><span class="op" id="7835130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835134">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835140">for</span>&nbsp;<span class="ident" id="7835144">_</span><span class="op" id="7835145">,</span>&nbsp;<span class="ident" id="7835147">c</span>&nbsp;<span class="op" id="7835149">:=</span>&nbsp;<span class="keyword" id="7835152">range</span>&nbsp;<span class="ident" id="7835158"><a href="/net/dial_test.go.html#7834679">toClose</a></span>&nbsp;<span class="op" id="7835166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835170"><a href="/net/dial_test.go.html#7835147">c</a></span><span class="op" id="7835171">.</span><span class="ident" id="7835172">Close</span><span class="op" id="7835177">(</span><span class="op" id="7835178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835184">for</span>&nbsp;<span class="ident" id="7835188">i</span>&nbsp;<span class="op" id="7835190">:=</span>&nbsp;<span class="num" id="7835193">0</span><span class="op" id="7835194">;</span>&nbsp;<span class="ident" id="7835196"><a href="/net/dial_test.go.html#7835188">i</a></span>&nbsp;<span class="op" id="7835198">&lt;</span>&nbsp;<span class="num" id="7835200">100</span><span class="op" id="7835203">;</span>&nbsp;<span class="ident" id="7835205"><a href="/net/dial_test.go.html#7835188">i</a></span><span class="op" id="7835206">++</span>&nbsp;<span class="op" id="7835209">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835213">if</span>&nbsp;<span class="ident" id="7835216">got</span>&nbsp;<span class="op" id="7835220">:=</span>&nbsp;<span class="ident" id="7835223"><a href="/net/dial_test.go.html#7837996">numFD</a></span><span class="op" id="7835228">(</span><span class="op" id="7835229">)</span><span class="op" id="7835230">;</span>&nbsp;<span class="ident" id="7835232"><a href="/net/dial_test.go.html#7835216">got</a></span>&nbsp;<span class="op" id="7835236">&lt;</span>&nbsp;<span class="ident" id="7835238"><a href="/net/dial_test.go.html#7834281">dials</a></span>&nbsp;<span class="op" id="7835244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7835249">//&nbsp;Test&nbsp;passes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835281"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7835285">.</span><span class="ident" id="7835286">Sleep</span><span class="op" id="7835291">(</span><span class="num" id="7835292">10</span>&nbsp;<span class="op" id="7835295">*</span>&nbsp;<span class="ident" id="7835297"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7835301">.</span><span class="ident" id="7835302">Millisecond</span><span class="op" id="7835313">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835319">if</span>&nbsp;<span class="ident" id="7835322">got</span>&nbsp;<span class="op" id="7835326">:=</span>&nbsp;<span class="ident" id="7835329"><a href="/net/dial_test.go.html#7837996">numFD</a></span><span class="op" id="7835334">(</span><span class="op" id="7835335">)</span><span class="op" id="7835336">;</span>&nbsp;<span class="ident" id="7835338"><a href="/net/dial_test.go.html#7835322">got</a></span>&nbsp;<span class="op" id="7835342">&gt;=</span>&nbsp;<span class="ident" id="7835345"><a href="/net/dial_test.go.html#7834281">dials</a></span>&nbsp;<span class="op" id="7835351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835355"><a href="/net/dial_test.go.html#7834041">t</a></span><span class="op" id="7835356">.</span><span class="ident" id="7835357">Errorf</span><span class="op" id="7835363">(</span><span class="string" id="7835364">&#34;num&nbsp;fds&nbsp;after&nbsp;%d&nbsp;timeouts&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;%d&#34;</span><span class="op" id="7835406">,</span>&nbsp;<span class="ident" id="7835408"><a href="/net/dial_test.go.html#7834281">dials</a></span><span class="op" id="7835413">,</span>&nbsp;<span class="ident" id="7835415"><a href="/net/dial_test.go.html#7835322">got</a></span><span class="op" id="7835418">,</span>&nbsp;<span class="ident" id="7835420"><a href="/net/dial_test.go.html#7834281">dials</a></span><span class="op" id="7835425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835428">}</span><br>
<span class="lineno"></span><span class="op" id="7835430">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7835433">func</span>&nbsp;<span class="ident" id="7835438">numTCP</span><span class="op" id="7835444">(</span><span class="op" id="7835445">)</span>&nbsp;<span class="op" id="7835447">(</span><span class="ident" id="7835448">ntcp</span><span class="op" id="7835452">,</span>&nbsp;<span class="ident" id="7835454">nopen</span><span class="op" id="7835459">,</span>&nbsp;<span class="ident" id="7835461">nclose</span>&nbsp;<span class="builtintype" id="7835468">int</span><span class="op" id="7835471">,</span>&nbsp;<span class="ident" id="7835473">err</span>&nbsp;<span class="builtintype" id="7835477">error</span><span class="op" id="7835482">)</span>&nbsp;<span class="op" id="7835484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835487">lsof</span><span class="op" id="7835491">,</span>&nbsp;<span class="ident" id="7835493"><a href="/net/dial_test.go.html#7835473">err</a></span>&nbsp;<span class="op" id="7835497">:=</span>&nbsp;<span class="ident" id="7835500"><a href="/net/dial_test.go.html#7827361">exec</a></span><span class="op" id="7835504">.</span><span class="ident" id="7835505">Command</span><span class="op" id="7835512">(</span><span class="string" id="7835513">&#34;lsof&#34;</span><span class="op" id="7835519">,</span>&nbsp;<span class="string" id="7835521">&#34;-n&#34;</span><span class="op" id="7835525">,</span>&nbsp;<span class="string" id="7835527">&#34;-p&#34;</span><span class="op" id="7835531">,</span>&nbsp;<span class="ident" id="7835533"><a href="/net/dial_test.go.html#7827404">strconv</a></span><span class="op" id="7835540">.</span><span class="ident" id="7835541">Itoa</span><span class="op" id="7835545">(</span><span class="ident" id="7835546"><a href="/net/dial_test.go.html#7827355">os</a></span><span class="op" id="7835548">.</span><span class="ident" id="7835549">Getpid</span><span class="op" id="7835555">(</span><span class="op" id="7835556">)</span><span class="op" id="7835557">)</span><span class="op" id="7835558">)</span><span class="op" id="7835559">.</span><span class="ident" id="7835560">Output</span><span class="op" id="7835566">(</span><span class="op" id="7835567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835570">if</span>&nbsp;<span class="ident" id="7835573"><a href="/net/dial_test.go.html#7835473">err</a></span>&nbsp;<span class="op" id="7835577">!=</span>&nbsp;<span class="ident" id="7835580">nil</span>&nbsp;<span class="op" id="7835584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835588">return</span>&nbsp;<span class="num" id="7835595">0</span><span class="op" id="7835596">,</span>&nbsp;<span class="num" id="7835598">0</span><span class="op" id="7835599">,</span>&nbsp;<span class="num" id="7835601">0</span><span class="op" id="7835602">,</span>&nbsp;<span class="ident" id="7835604"><a href="/net/dial_test.go.html#7835473">err</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835612"><a href="/net/dial_test.go.html#7835448">ntcp</a></span>&nbsp;<span class="op" id="7835617">+=</span>&nbsp;<span class="ident" id="7835620"><a href="/net/dial_test.go.html#7827325">bytes</a></span><span class="op" id="7835625">.</span><span class="ident" id="7835626">Count</span><span class="op" id="7835631">(</span><span class="ident" id="7835632"><a href="/net/dial_test.go.html#7835487">lsof</a></span><span class="op" id="7835636">,</span>&nbsp;<span class="op" id="7835638">[</span><span class="op" id="7835639">]</span><span class="builtintype" id="7835640">byte</span><span class="op" id="7835644">(</span><span class="string" id="7835645">&#34;TCP&#34;</span><span class="op" id="7835650">)</span><span class="op" id="7835651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835654">for</span>&nbsp;<span class="ident" id="7835658">_</span><span class="op" id="7835659">,</span>&nbsp;<span class="ident" id="7835661">state</span>&nbsp;<span class="op" id="7835667">:=</span>&nbsp;<span class="keyword" id="7835670">range</span>&nbsp;<span class="op" id="7835676">[</span><span class="op" id="7835677">]</span><span class="builtintype" id="7835678">string</span><span class="op" id="7835684">{</span><span class="string" id="7835685">&#34;LISTEN&#34;</span><span class="op" id="7835693">,</span>&nbsp;<span class="string" id="7835695">&#34;SYN_SENT&#34;</span><span class="op" id="7835705">,</span>&nbsp;<span class="string" id="7835707">&#34;SYN_RECEIVED&#34;</span><span class="op" id="7835721">,</span>&nbsp;<span class="string" id="7835723">&#34;ESTABLISHED&#34;</span><span class="op" id="7835736">}</span>&nbsp;<span class="op" id="7835738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835742"><a href="/net/dial_test.go.html#7835454">nopen</a></span>&nbsp;<span class="op" id="7835748">+=</span>&nbsp;<span class="ident" id="7835751"><a href="/net/dial_test.go.html#7827325">bytes</a></span><span class="op" id="7835756">.</span><span class="ident" id="7835757">Count</span><span class="op" id="7835762">(</span><span class="ident" id="7835763"><a href="/net/dial_test.go.html#7835487">lsof</a></span><span class="op" id="7835767">,</span>&nbsp;<span class="op" id="7835769">[</span><span class="op" id="7835770">]</span><span class="builtintype" id="7835771">byte</span><span class="op" id="7835775">(</span><span class="ident" id="7835776"><a href="/net/dial_test.go.html#7835661">state</a></span><span class="op" id="7835781">)</span><span class="op" id="7835782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835785">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835788">for</span>&nbsp;<span class="ident" id="7835792">_</span><span class="op" id="7835793">,</span>&nbsp;<span class="ident" id="7835795">state</span>&nbsp;<span class="op" id="7835801">:=</span>&nbsp;<span class="keyword" id="7835804">range</span>&nbsp;<span class="op" id="7835810">[</span><span class="op" id="7835811">]</span><span class="builtintype" id="7835812">string</span><span class="op" id="7835818">{</span><span class="string" id="7835819">&#34;CLOSED&#34;</span><span class="op" id="7835827">,</span>&nbsp;<span class="string" id="7835829">&#34;CLOSE_WAIT&#34;</span><span class="op" id="7835841">,</span>&nbsp;<span class="string" id="7835843">&#34;LAST_ACK&#34;</span><span class="op" id="7835853">,</span>&nbsp;<span class="string" id="7835855">&#34;FIN_WAIT_1&#34;</span><span class="op" id="7835867">,</span>&nbsp;<span class="string" id="7835869">&#34;FIN_WAIT_2&#34;</span><span class="op" id="7835881">,</span>&nbsp;<span class="string" id="7835883">&#34;CLOSING&#34;</span><span class="op" id="7835892">,</span>&nbsp;<span class="string" id="7835894">&#34;TIME_WAIT&#34;</span><span class="op" id="7835905">}</span>&nbsp;<span class="op" id="7835907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835911"><a href="/net/dial_test.go.html#7835461">nclose</a></span>&nbsp;<span class="op" id="7835918">+=</span>&nbsp;<span class="ident" id="7835921"><a href="/net/dial_test.go.html#7827325">bytes</a></span><span class="op" id="7835926">.</span><span class="ident" id="7835927">Count</span><span class="op" id="7835932">(</span><span class="ident" id="7835933"><a href="/net/dial_test.go.html#7835487">lsof</a></span><span class="op" id="7835937">,</span>&nbsp;<span class="op" id="7835939">[</span><span class="op" id="7835940">]</span><span class="builtintype" id="7835941">byte</span><span class="op" id="7835945">(</span><span class="ident" id="7835946"><a href="/net/dial_test.go.html#7835795">state</a></span><span class="op" id="7835951">)</span><span class="op" id="7835952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835958">return</span>&nbsp;<span class="ident" id="7835965"><a href="/net/dial_test.go.html#7835448">ntcp</a></span><span class="op" id="7835969">,</span>&nbsp;<span class="ident" id="7835971"><a href="/net/dial_test.go.html#7835454">nopen</a></span><span class="op" id="7835976">,</span>&nbsp;<span class="ident" id="7835978"><a href="/net/dial_test.go.html#7835461">nclose</a></span><span class="op" id="7835984">,</span>&nbsp;<span class="ident" id="7835986">nil</span><br>
<span class="lineno"></span><span class="op" id="7835990">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="7835993">func</span>&nbsp;<span class="ident" id="7835998">TestDialMultiFDLeak</span><span class="op" id="7836017">(</span><span class="ident" id="7836018">t</span>&nbsp;<span class="op" id="7836020">*</span><span class="ident" id="7836021"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7836028">.</span><span class="ident" id="7836029">T</span><span class="op" id="7836030">)</span>&nbsp;<span class="op" id="7836032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836035"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7836036">.</span><span class="ident" id="7836037">Skip</span><span class="op" id="7836041">(</span><span class="string" id="7836042">&#34;flaky&nbsp;test&nbsp;-&nbsp;golang.org/issue/8764&#34;</span><span class="op" id="7836078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836082">if</span>&nbsp;<span class="op" id="7836085">!</span><span class="ident" id="7836086"><a href="/net/ipsock.go.html#1440518">supportsIPv4</a></span>&nbsp;<span class="op" id="7836099">||</span>&nbsp;<span class="op" id="7836102">!</span><span class="ident" id="7836103"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7836116">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836120"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7836121">.</span><span class="ident" id="7836122">Skip</span><span class="op" id="7836126">(</span><span class="string" id="7836127">&#34;neither&nbsp;ipv4&nbsp;nor&nbsp;ipv6&nbsp;is&nbsp;supported&#34;</span><span class="op" id="7836163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836170">halfDeadServer</span>&nbsp;<span class="op" id="7836185">:=</span>&nbsp;<span class="keyword" id="7836188">func</span><span class="op" id="7836192">(</span><span class="ident" id="7836193">dss</span>&nbsp;<span class="op" id="7836197">*</span><span class="ident" id="7836198"><a href="/net/mockserver_test.go.html#7924159">dualStackServer</a></span><span class="op" id="7836213">,</span>&nbsp;<span class="ident" id="7836215">ln</span>&nbsp;<span class="ident" id="7836218"><a href="/net/net.go.html#1471621">Listener</a></span><span class="op" id="7836226">)</span>&nbsp;<span class="op" id="7836228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836232">for</span>&nbsp;<span class="op" id="7836236">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836241">if</span>&nbsp;<span class="ident" id="7836244">c</span><span class="op" id="7836245">,</span>&nbsp;<span class="ident" id="7836247">err</span>&nbsp;<span class="op" id="7836251">:=</span>&nbsp;<span class="ident" id="7836254"><a href="/net/dial_test.go.html#7836215">ln</a></span><span class="op" id="7836256">.</span><span class="ident" id="7836257">Accept</span><span class="op" id="7836263">(</span><span class="op" id="7836264">)</span><span class="op" id="7836265">;</span>&nbsp;<span class="ident" id="7836267"><a href="/net/dial_test.go.html#7836247">err</a></span>&nbsp;<span class="op" id="7836271">!=</span>&nbsp;<span class="ident" id="7836274">nil</span>&nbsp;<span class="op" id="7836278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836284">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836294">}</span>&nbsp;<span class="keyword" id="7836296">else</span>&nbsp;<span class="op" id="7836301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7836307">//&nbsp;It&nbsp;just&nbsp;keeps&nbsp;established</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7836340">//&nbsp;connections&nbsp;like&nbsp;a&nbsp;half-dead&nbsp;server</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7836383">//&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836396"><a href="/net/dial_test.go.html#7836193">dss</a></span><span class="op" id="7836399">.</span><span class="ident" id="7836400">putConn</span><span class="op" id="7836407">(</span><span class="ident" id="7836408"><a href="/net/dial_test.go.html#7836244">c</a></span><span class="op" id="7836409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836421">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836424">dss</span><span class="op" id="7836427">,</span>&nbsp;<span class="ident" id="7836429">err</span>&nbsp;<span class="op" id="7836433">:=</span>&nbsp;<span class="ident" id="7836436"><a href="/net/mockserver_test.go.html#7925130">newDualStackServer</a></span><span class="op" id="7836454">(</span><span class="op" id="7836455">[</span><span class="op" id="7836456">]</span><span class="ident" id="7836457"><a href="/net/mockserver_test.go.html#7924089">streamListener</a></span><span class="op" id="7836471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836475">{</span><span class="ident" id="7836476">net</span><span class="op" id="7836479">:</span>&nbsp;<span class="string" id="7836481">&#34;tcp4&#34;</span><span class="op" id="7836487">,</span>&nbsp;<span class="ident" id="7836489">addr</span><span class="op" id="7836493">:</span>&nbsp;<span class="string" id="7836495">&#34;127.0.0.1&#34;</span><span class="op" id="7836506">}</span><span class="op" id="7836507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836511">{</span><span class="ident" id="7836512">net</span><span class="op" id="7836515">:</span>&nbsp;<span class="string" id="7836517">&#34;tcp6&#34;</span><span class="op" id="7836523">,</span>&nbsp;<span class="ident" id="7836525">addr</span><span class="op" id="7836529">:</span>&nbsp;<span class="string" id="7836531">&#34;[::1]&#34;</span><span class="op" id="7836538">}</span><span class="op" id="7836539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836542">}</span><span class="op" id="7836543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836546">if</span>&nbsp;<span class="ident" id="7836549"><a href="/net/dial_test.go.html#7836429">err</a></span>&nbsp;<span class="op" id="7836553">!=</span>&nbsp;<span class="ident" id="7836556">nil</span>&nbsp;<span class="op" id="7836560">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836564"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7836565">.</span><span class="ident" id="7836566">Fatalf</span><span class="op" id="7836572">(</span><span class="string" id="7836573">&#34;newDualStackServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7836604">,</span>&nbsp;<span class="ident" id="7836606"><a href="/net/dial_test.go.html#7836429">err</a></span><span class="op" id="7836609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836615">defer</span>&nbsp;<span class="ident" id="7836621"><a href="/net/dial_test.go.html#7836424">dss</a></span><span class="op" id="7836624">.</span><span class="ident" id="7836625">teardown</span><span class="op" id="7836633">(</span><span class="op" id="7836634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836637">if</span>&nbsp;<span class="ident" id="7836640">err</span>&nbsp;<span class="op" id="7836644">:=</span>&nbsp;<span class="ident" id="7836647"><a href="/net/dial_test.go.html#7836424">dss</a></span><span class="op" id="7836650">.</span><span class="ident" id="7836651">buildup</span><span class="op" id="7836658">(</span><span class="ident" id="7836659"><a href="/net/dial_test.go.html#7836170">halfDeadServer</a></span><span class="op" id="7836673">)</span><span class="op" id="7836674">;</span>&nbsp;<span class="ident" id="7836676"><a href="/net/dial_test.go.html#7836640">err</a></span>&nbsp;<span class="op" id="7836680">!=</span>&nbsp;<span class="ident" id="7836683">nil</span>&nbsp;<span class="op" id="7836687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836691"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7836692">.</span><span class="ident" id="7836693">Fatalf</span><span class="op" id="7836699">(</span><span class="string" id="7836700">&#34;dualStackServer.buildup&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7836736">,</span>&nbsp;<span class="ident" id="7836738"><a href="/net/dial_test.go.html#7836640">err</a></span><span class="op" id="7836741">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836748">_</span><span class="op" id="7836749">,</span>&nbsp;<span class="ident" id="7836751">before</span><span class="op" id="7836757">,</span>&nbsp;<span class="ident" id="7836759">_</span><span class="op" id="7836760">,</span>&nbsp;<span class="ident" id="7836762"><a href="/net/dial_test.go.html#7836429">err</a></span>&nbsp;<span class="op" id="7836766">:=</span>&nbsp;<span class="ident" id="7836769"><a href="/net/dial_test.go.html#7835438">numTCP</a></span><span class="op" id="7836775">(</span><span class="op" id="7836776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836779">if</span>&nbsp;<span class="ident" id="7836782"><a href="/net/dial_test.go.html#7836429">err</a></span>&nbsp;<span class="op" id="7836786">!=</span>&nbsp;<span class="ident" id="7836789">nil</span>&nbsp;<span class="op" id="7836793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836797"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7836798">.</span><span class="ident" id="7836799">Skipf</span><span class="op" id="7836804">(</span><span class="string" id="7836805">&#34;skipping&nbsp;test;&nbsp;error&nbsp;finding&nbsp;or&nbsp;running&nbsp;lsof:&nbsp;%v&#34;</span><span class="op" id="7836855">,</span>&nbsp;<span class="ident" id="7836857"><a href="/net/dial_test.go.html#7836429">err</a></span><span class="op" id="7836860">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836867">var</span>&nbsp;<span class="ident" id="7836871">wg</span>&nbsp;<span class="ident" id="7836874"><a href="/net/dial_test.go.html#7827415">sync</a></span><span class="op" id="7836878">.</span><span class="ident" id="7836879">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836890">portnum</span><span class="op" id="7836897">,</span>&nbsp;<span class="ident" id="7836899">_</span><span class="op" id="7836900">,</span>&nbsp;<span class="ident" id="7836902">_</span>&nbsp;<span class="op" id="7836904">:=</span>&nbsp;<span class="ident" id="7836907"><a href="/net/parse.go.html#1477870">dtoi</a></span><span class="op" id="7836911">(</span><span class="ident" id="7836912"><a href="/net/dial_test.go.html#7836424">dss</a></span><span class="op" id="7836915">.</span><span class="ident" id="7836916">port</span><span class="op" id="7836920">,</span>&nbsp;<span class="num" id="7836922">0</span><span class="op" id="7836923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836926">ras</span>&nbsp;<span class="op" id="7836930">:=</span>&nbsp;<span class="ident" id="7836933"><a href="/net/ipsock.go.html#1441289">addrList</a></span><span class="op" id="7836941">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7836945">//&nbsp;Losers&nbsp;that&nbsp;will&nbsp;fail&nbsp;to&nbsp;connect,&nbsp;see&nbsp;RFC&nbsp;6890.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836998">&amp;</span><span class="ident" id="7836999"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7837006">{</span><span class="ident" id="7837007">IP</span><span class="op" id="7837009">:</span>&nbsp;<span class="ident" id="7837011"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7837015">(</span><span class="num" id="7837016">198</span><span class="op" id="7837019">,</span>&nbsp;<span class="num" id="7837021">18</span><span class="op" id="7837023">,</span>&nbsp;<span class="num" id="7837025">0</span><span class="op" id="7837026">,</span>&nbsp;<span class="num" id="7837028">254</span><span class="op" id="7837031">)</span><span class="op" id="7837032">,</span>&nbsp;<span class="ident" id="7837034">Port</span><span class="op" id="7837038">:</span>&nbsp;<span class="ident" id="7837040"><a href="/net/dial_test.go.html#7836890">portnum</a></span><span class="op" id="7837047">}</span><span class="op" id="7837048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837052">&amp;</span><span class="ident" id="7837053"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7837060">{</span><span class="ident" id="7837061">IP</span><span class="op" id="7837063">:</span>&nbsp;<span class="ident" id="7837065"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7837072">(</span><span class="string" id="7837073">&#34;2001:2::254&#34;</span><span class="op" id="7837086">)</span><span class="op" id="7837087">,</span>&nbsp;<span class="ident" id="7837089">Port</span><span class="op" id="7837093">:</span>&nbsp;<span class="ident" id="7837095"><a href="/net/dial_test.go.html#7836890">portnum</a></span><span class="op" id="7837102">}</span><span class="op" id="7837103">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7837108">//&nbsp;Winner&nbsp;candidates&nbsp;of&nbsp;this&nbsp;race.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837145">&amp;</span><span class="ident" id="7837146"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7837153">{</span><span class="ident" id="7837154">IP</span><span class="op" id="7837156">:</span>&nbsp;<span class="ident" id="7837158"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7837162">(</span><span class="num" id="7837163">127</span><span class="op" id="7837166">,</span>&nbsp;<span class="num" id="7837168">0</span><span class="op" id="7837169">,</span>&nbsp;<span class="num" id="7837171">0</span><span class="op" id="7837172">,</span>&nbsp;<span class="num" id="7837174">1</span><span class="op" id="7837175">)</span><span class="op" id="7837176">,</span>&nbsp;<span class="ident" id="7837178">Port</span><span class="op" id="7837182">:</span>&nbsp;<span class="ident" id="7837184"><a href="/net/dial_test.go.html#7836890">portnum</a></span><span class="op" id="7837191">}</span><span class="op" id="7837192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837196">&amp;</span><span class="ident" id="7837197"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7837204">{</span><span class="ident" id="7837205">IP</span><span class="op" id="7837207">:</span>&nbsp;<span class="ident" id="7837209"><a href="/net/ip.go.html#1418830">IPv6loopback</a></span><span class="op" id="7837221">,</span>&nbsp;<span class="ident" id="7837223">Port</span><span class="op" id="7837227">:</span>&nbsp;<span class="ident" id="7837229"><a href="/net/dial_test.go.html#7836890">portnum</a></span><span class="op" id="7837236">}</span><span class="op" id="7837237">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7837242">//&nbsp;Losers&nbsp;that&nbsp;will&nbsp;have&nbsp;established&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837294">&amp;</span><span class="ident" id="7837295"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7837302">{</span><span class="ident" id="7837303">IP</span><span class="op" id="7837305">:</span>&nbsp;<span class="ident" id="7837307"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7837311">(</span><span class="num" id="7837312">127</span><span class="op" id="7837315">,</span>&nbsp;<span class="num" id="7837317">0</span><span class="op" id="7837318">,</span>&nbsp;<span class="num" id="7837320">0</span><span class="op" id="7837321">,</span>&nbsp;<span class="num" id="7837323">1</span><span class="op" id="7837324">)</span><span class="op" id="7837325">,</span>&nbsp;<span class="ident" id="7837327">Port</span><span class="op" id="7837331">:</span>&nbsp;<span class="ident" id="7837333"><a href="/net/dial_test.go.html#7836890">portnum</a></span><span class="op" id="7837340">}</span><span class="op" id="7837341">,</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837345">&amp;</span><span class="ident" id="7837346"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7837353">{</span><span class="ident" id="7837354">IP</span><span class="op" id="7837356">:</span>&nbsp;<span class="ident" id="7837358"><a href="/net/ip.go.html#1418830">IPv6loopback</a></span><span class="op" id="7837370">,</span>&nbsp;<span class="ident" id="7837372">Port</span><span class="op" id="7837376">:</span>&nbsp;<span class="ident" id="7837378"><a href="/net/dial_test.go.html#7836890">portnum</a></span><span class="op" id="7837385">}</span><span class="op" id="7837386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837392">const</span>&nbsp;<span class="ident" id="7837398">T1</span>&nbsp;<span class="op" id="7837401">=</span>&nbsp;<span class="num" id="7837403">10</span>&nbsp;<span class="op" id="7837406">*</span>&nbsp;<span class="ident" id="7837408"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7837412">.</span><span class="ident" id="7837413">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837426">const</span>&nbsp;<span class="ident" id="7837432">T2</span>&nbsp;<span class="op" id="7837435">=</span>&nbsp;<span class="num" id="7837437">2</span>&nbsp;<span class="op" id="7837439">*</span>&nbsp;<span class="ident" id="7837441"><a href="/net/dial_test.go.html#7837398">T1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837445">const</span>&nbsp;<span class="ident" id="7837451">N</span>&nbsp;<span class="op" id="7837453">=</span>&nbsp;<span class="num" id="7837455">10</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837459">for</span>&nbsp;<span class="ident" id="7837463">i</span>&nbsp;<span class="op" id="7837465">:=</span>&nbsp;<span class="num" id="7837468">0</span><span class="op" id="7837469">;</span>&nbsp;<span class="ident" id="7837471"><a href="/net/dial_test.go.html#7837463">i</a></span>&nbsp;<span class="op" id="7837473">&lt;</span>&nbsp;<span class="ident" id="7837475"><a href="/net/dial_test.go.html#7837451">N</a></span><span class="op" id="7837476">;</span>&nbsp;<span class="ident" id="7837478"><a href="/net/dial_test.go.html#7837463">i</a></span><span class="op" id="7837479">++</span>&nbsp;<span class="op" id="7837482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837486"><a href="/net/dial_test.go.html#7836871">wg</a></span><span class="op" id="7837488">.</span><span class="ident" id="7837489">Add</span><span class="op" id="7837492">(</span><span class="num" id="7837493">1</span><span class="op" id="7837494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837498">go</span>&nbsp;<span class="keyword" id="7837501">func</span><span class="op" id="7837505">(</span><span class="op" id="7837506">)</span>&nbsp;<span class="op" id="7837508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837513">defer</span>&nbsp;<span class="ident" id="7837519"><a href="/net/dial_test.go.html#7836871">wg</a></span><span class="op" id="7837521">.</span><span class="ident" id="7837522">Done</span><span class="op" id="7837526">(</span><span class="op" id="7837527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837532">if</span>&nbsp;<span class="ident" id="7837535">c</span><span class="op" id="7837536">,</span>&nbsp;<span class="ident" id="7837538">err</span>&nbsp;<span class="op" id="7837542">:=</span>&nbsp;<span class="ident" id="7837545"><a href="/net/dial.go.html#1335946">dialMulti</a></span><span class="op" id="7837554">(</span><span class="string" id="7837555">&#34;tcp&#34;</span><span class="op" id="7837560">,</span>&nbsp;<span class="string" id="7837562">&#34;fast&nbsp;failover&nbsp;test&#34;</span><span class="op" id="7837582">,</span>&nbsp;<span class="ident" id="7837584">nil</span><span class="op" id="7837587">,</span>&nbsp;<span class="ident" id="7837589"><a href="/net/dial_test.go.html#7836926">ras</a></span><span class="op" id="7837592">,</span>&nbsp;<span class="ident" id="7837594"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7837598">.</span><span class="ident" id="7837599">Now</span><span class="op" id="7837602">(</span><span class="op" id="7837603">)</span><span class="op" id="7837604">.</span><span class="ident" id="7837605">Add</span><span class="op" id="7837608">(</span><span class="ident" id="7837609"><a href="/net/dial_test.go.html#7837398">T1</a></span><span class="op" id="7837611">)</span><span class="op" id="7837612">)</span><span class="op" id="7837613">;</span>&nbsp;<span class="ident" id="7837615"><a href="/net/dial_test.go.html#7837538">err</a></span>&nbsp;<span class="op" id="7837619">==</span>&nbsp;<span class="ident" id="7837622">nil</span>&nbsp;<span class="op" id="7837626">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837632"><a href="/net/dial_test.go.html#7837535">c</a></span><span class="op" id="7837633">.</span><span class="ident" id="7837634">Close</span><span class="op" id="7837639">(</span><span class="op" id="7837640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837649">}</span><span class="op" id="7837650">(</span><span class="op" id="7837651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837657"><a href="/net/dial_test.go.html#7836871">wg</a></span><span class="op" id="7837659">.</span><span class="ident" id="7837660">Wait</span><span class="op" id="7837664">(</span><span class="op" id="7837665">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837668"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7837672">.</span><span class="ident" id="7837673">Sleep</span><span class="op" id="7837678">(</span><span class="ident" id="7837679"><a href="/net/dial_test.go.html#7837432">T2</a></span><span class="op" id="7837681">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837685">ntcp</span><span class="op" id="7837689">,</span>&nbsp;<span class="ident" id="7837691">after</span><span class="op" id="7837696">,</span>&nbsp;<span class="ident" id="7837698">nclose</span><span class="op" id="7837704">,</span>&nbsp;<span class="ident" id="7837706"><a href="/net/dial_test.go.html#7836429">err</a></span>&nbsp;<span class="op" id="7837710">:=</span>&nbsp;<span class="ident" id="7837713"><a href="/net/dial_test.go.html#7835438">numTCP</a></span><span class="op" id="7837719">(</span><span class="op" id="7837720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837723">if</span>&nbsp;<span class="ident" id="7837726"><a href="/net/dial_test.go.html#7836429">err</a></span>&nbsp;<span class="op" id="7837730">!=</span>&nbsp;<span class="ident" id="7837733">nil</span>&nbsp;<span class="op" id="7837737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837741"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7837742">.</span><span class="ident" id="7837743">Skipf</span><span class="op" id="7837748">(</span><span class="string" id="7837749">&#34;skipping&nbsp;test;&nbsp;error&nbsp;finding&nbsp;or&nbsp;running&nbsp;lsof:&nbsp;%v&#34;</span><span class="op" id="7837799">,</span>&nbsp;<span class="ident" id="7837801"><a href="/net/dial_test.go.html#7836429">err</a></span><span class="op" id="7837804">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837810"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7837811">.</span><span class="ident" id="7837812">Logf</span><span class="op" id="7837816">(</span><span class="string" id="7837817">&#34;tcp&nbsp;sessions:&nbsp;%v,&nbsp;open&nbsp;sessions:&nbsp;%v,&nbsp;closing&nbsp;sessions:&nbsp;%v&#34;</span><span class="op" id="7837876">,</span>&nbsp;<span class="ident" id="7837878"><a href="/net/dial_test.go.html#7837685">ntcp</a></span><span class="op" id="7837882">,</span>&nbsp;<span class="ident" id="7837884"><a href="/net/dial_test.go.html#7837691">after</a></span><span class="op" id="7837889">,</span>&nbsp;<span class="ident" id="7837891"><a href="/net/dial_test.go.html#7837698">nclose</a></span><span class="op" id="7837897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837901">if</span>&nbsp;<span class="ident" id="7837904"><a href="/net/dial_test.go.html#7837691">after</a></span>&nbsp;<span class="op" id="7837910">!=</span>&nbsp;<span class="ident" id="7837913"><a href="/net/dial_test.go.html#7836751">before</a></span>&nbsp;<span class="op" id="7837920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837924"><a href="/net/dial_test.go.html#7836018">t</a></span><span class="op" id="7837925">.</span><span class="ident" id="7837926">Fatalf</span><span class="op" id="7837932">(</span><span class="string" id="7837933">&#34;got&nbsp;%v&nbsp;open&nbsp;sessions;&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7837968">,</span>&nbsp;<span class="ident" id="7837970"><a href="/net/dial_test.go.html#7837691">after</a></span><span class="op" id="7837975">,</span>&nbsp;<span class="ident" id="7837977"><a href="/net/dial_test.go.html#7836751">before</a></span><span class="op" id="7837983">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837986">}</span><br>
<span class="lineno"></span><span class="op" id="7837988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7837991">func</span>&nbsp;<span class="ident" id="7837996">numFD</span><span class="op" id="7838001">(</span><span class="op" id="7838002">)</span>&nbsp;<span class="builtintype" id="7838004">int</span>&nbsp;<span class="op" id="7838008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838011">if</span>&nbsp;<span class="ident" id="7838014"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7838021">.</span><span class="ident" id="7838022">GOOS</span>&nbsp;<span class="op" id="7838027">==</span>&nbsp;<span class="string" id="7838030">&#34;linux&#34;</span>&nbsp;<span class="op" id="7838038">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838042">f</span><span class="op" id="7838043">,</span>&nbsp;<span class="ident" id="7838045">err</span>&nbsp;<span class="op" id="7838049">:=</span>&nbsp;<span class="ident" id="7838052"><a href="/net/dial_test.go.html#7827355">os</a></span><span class="op" id="7838054">.</span><span class="ident" id="7838055">Open</span><span class="op" id="7838059">(</span><span class="string" id="7838060">&#34;/proc/self/fd&#34;</span><span class="op" id="7838075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838079">if</span>&nbsp;<span class="ident" id="7838082"><a href="/net/dial_test.go.html#7838045">err</a></span>&nbsp;<span class="op" id="7838086">!=</span>&nbsp;<span class="ident" id="7838089">nil</span>&nbsp;<span class="op" id="7838093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7838098">panic</span><span class="op" id="7838103">(</span><span class="ident" id="7838104"><a href="/net/dial_test.go.html#7838045">err</a></span><span class="op" id="7838107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838115">defer</span>&nbsp;<span class="ident" id="7838121"><a href="/net/dial_test.go.html#7838042">f</a></span><span class="op" id="7838122">.</span><span class="ident" id="7838123">Close</span><span class="op" id="7838128">(</span><span class="op" id="7838129">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838133">names</span><span class="op" id="7838138">,</span>&nbsp;<span class="ident" id="7838140"><a href="/net/dial_test.go.html#7838045">err</a></span>&nbsp;<span class="op" id="7838144">:=</span>&nbsp;<span class="ident" id="7838147"><a href="/net/dial_test.go.html#7838042">f</a></span><span class="op" id="7838148">.</span><span class="ident" id="7838149">Readdirnames</span><span class="op" id="7838161">(</span><span class="num" id="7838162">0</span><span class="op" id="7838163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838167">if</span>&nbsp;<span class="ident" id="7838170"><a href="/net/dial_test.go.html#7838045">err</a></span>&nbsp;<span class="op" id="7838174">!=</span>&nbsp;<span class="ident" id="7838177">nil</span>&nbsp;<span class="op" id="7838181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7838186">panic</span><span class="op" id="7838191">(</span><span class="ident" id="7838192"><a href="/net/dial_test.go.html#7838045">err</a></span><span class="op" id="7838195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838203">return</span>&nbsp;<span class="builtinfunc" id="7838210">len</span><span class="op" id="7838213">(</span><span class="ident" id="7838214"><a href="/net/dial_test.go.html#7838133">names</a></span><span class="op" id="7838219">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7838225">//&nbsp;All&nbsp;tests&nbsp;using&nbsp;this&nbsp;should&nbsp;be&nbsp;skipped&nbsp;anyway,&nbsp;but:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7838281">panic</span><span class="op" id="7838286">(</span><span class="string" id="7838287">&#34;numFDs&nbsp;not&nbsp;implemented&nbsp;on&nbsp;&#34;</span>&nbsp;<span class="op" id="7838316">+</span>&nbsp;<span class="ident" id="7838318"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7838325">.</span><span class="ident" id="7838326">GOOS</span><span class="op" id="7838330">)</span><br>
<span class="lineno"></span><span class="op" id="7838332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="7838335">func</span>&nbsp;<span class="ident" id="7838340">TestDialer</span><span class="op" id="7838350">(</span><span class="ident" id="7838351">t</span>&nbsp;<span class="op" id="7838353">*</span><span class="ident" id="7838354"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7838361">.</span><span class="ident" id="7838362">T</span><span class="op" id="7838363">)</span>&nbsp;<span class="op" id="7838365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838368">ln</span><span class="op" id="7838370">,</span>&nbsp;<span class="ident" id="7838372">err</span>&nbsp;<span class="op" id="7838376">:=</span>&nbsp;<span class="ident" id="7838379"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7838385">(</span><span class="string" id="7838386">&#34;tcp4&#34;</span><span class="op" id="7838392">,</span>&nbsp;<span class="string" id="7838394">&#34;127.0.0.1:0&#34;</span><span class="op" id="7838407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838410">if</span>&nbsp;<span class="ident" id="7838413"><a href="/net/dial_test.go.html#7838372">err</a></span>&nbsp;<span class="op" id="7838417">!=</span>&nbsp;<span class="ident" id="7838420">nil</span>&nbsp;<span class="op" id="7838424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838428"><a href="/net/dial_test.go.html#7838351">t</a></span><span class="op" id="7838429">.</span><span class="ident" id="7838430">Fatalf</span><span class="op" id="7838436">(</span><span class="string" id="7838437">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7838456">,</span>&nbsp;<span class="ident" id="7838458"><a href="/net/dial_test.go.html#7838372">err</a></span><span class="op" id="7838461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838464">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838467">defer</span>&nbsp;<span class="ident" id="7838473"><a href="/net/dial_test.go.html#7838368">ln</a></span><span class="op" id="7838475">.</span><span class="ident" id="7838476">Close</span><span class="op" id="7838481">(</span><span class="op" id="7838482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838485">ch</span>&nbsp;<span class="op" id="7838488">:=</span>&nbsp;<span class="builtinfunc" id="7838491">make</span><span class="op" id="7838495">(</span><span class="keyword" id="7838496">chan</span>&nbsp;<span class="builtintype" id="7838501">error</span><span class="op" id="7838506">,</span>&nbsp;<span class="num" id="7838508">1</span><span class="op" id="7838509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838512">go</span>&nbsp;<span class="keyword" id="7838515">func</span><span class="op" id="7838519">(</span><span class="op" id="7838520">)</span>&nbsp;<span class="op" id="7838522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838526">c</span><span class="op" id="7838527">,</span>&nbsp;<span class="ident" id="7838529">err</span>&nbsp;<span class="op" id="7838533">:=</span>&nbsp;<span class="ident" id="7838536"><a href="/net/dial_test.go.html#7838368">ln</a></span><span class="op" id="7838538">.</span><span class="ident" id="7838539">Accept</span><span class="op" id="7838545">(</span><span class="op" id="7838546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838550">if</span>&nbsp;<span class="ident" id="7838553"><a href="/net/dial_test.go.html#7838529">err</a></span>&nbsp;<span class="op" id="7838557">!=</span>&nbsp;<span class="ident" id="7838560">nil</span>&nbsp;<span class="op" id="7838564">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838569"><a href="/net/dial_test.go.html#7838485">ch</a></span>&nbsp;<span class="op" id="7838572">&lt;-</span>&nbsp;<span class="ident" id="7838575"><a href="/net/dial_test.go.html#7827342">fmt</a></span><span class="op" id="7838578">.</span><span class="ident" id="7838579">Errorf</span><span class="op" id="7838585">(</span><span class="string" id="7838586">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7838605">,</span>&nbsp;<span class="ident" id="7838607"><a href="/net/dial_test.go.html#7838529">err</a></span><span class="op" id="7838610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838615">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838628">defer</span>&nbsp;<span class="ident" id="7838634"><a href="/net/dial_test.go.html#7838526">c</a></span><span class="op" id="7838635">.</span><span class="ident" id="7838636">Close</span><span class="op" id="7838641">(</span><span class="op" id="7838642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838646"><a href="/net/dial_test.go.html#7838485">ch</a></span>&nbsp;<span class="op" id="7838649">&lt;-</span>&nbsp;<span class="ident" id="7838652">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838657">}</span><span class="op" id="7838658">(</span><span class="op" id="7838659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838663">laddr</span><span class="op" id="7838668">,</span>&nbsp;<span class="ident" id="7838670"><a href="/net/dial_test.go.html#7838372">err</a></span>&nbsp;<span class="op" id="7838674">:=</span>&nbsp;<span class="ident" id="7838677"><a href="/net/tcpsock.go.html#1505235">ResolveTCPAddr</a></span><span class="op" id="7838691">(</span><span class="string" id="7838692">&#34;tcp4&#34;</span><span class="op" id="7838698">,</span>&nbsp;<span class="string" id="7838700">&#34;127.0.0.1:0&#34;</span><span class="op" id="7838713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838716">if</span>&nbsp;<span class="ident" id="7838719"><a href="/net/dial_test.go.html#7838372">err</a></span>&nbsp;<span class="op" id="7838723">!=</span>&nbsp;<span class="ident" id="7838726">nil</span>&nbsp;<span class="op" id="7838730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838734"><a href="/net/dial_test.go.html#7838351">t</a></span><span class="op" id="7838735">.</span><span class="ident" id="7838736">Fatalf</span><span class="op" id="7838742">(</span><span class="string" id="7838743">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7838770">,</span>&nbsp;<span class="ident" id="7838772"><a href="/net/dial_test.go.html#7838372">err</a></span><span class="op" id="7838775">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838781">d</span>&nbsp;<span class="op" id="7838783">:=</span>&nbsp;<span class="op" id="7838786">&amp;</span><span class="ident" id="7838787"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="7838793">{</span><span class="ident" id="7838794">LocalAddr</span><span class="op" id="7838803">:</span>&nbsp;<span class="ident" id="7838805"><a href="/net/dial_test.go.html#7838663">laddr</a></span><span class="op" id="7838810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838813">c</span><span class="op" id="7838814">,</span>&nbsp;<span class="ident" id="7838816"><a href="/net/dial_test.go.html#7838372">err</a></span>&nbsp;<span class="op" id="7838820">:=</span>&nbsp;<span class="ident" id="7838823"><a href="/net/dial_test.go.html#7838781">d</a></span><span class="op" id="7838824">.</span><span class="ident" id="7838825">Dial</span><span class="op" id="7838829">(</span><span class="string" id="7838830">&#34;tcp4&#34;</span><span class="op" id="7838836">,</span>&nbsp;<span class="ident" id="7838838"><a href="/net/dial_test.go.html#7838368">ln</a></span><span class="op" id="7838840">.</span><span class="ident" id="7838841">Addr</span><span class="op" id="7838845">(</span><span class="op" id="7838846">)</span><span class="op" id="7838847">.</span><span class="ident" id="7838848">String</span><span class="op" id="7838854">(</span><span class="op" id="7838855">)</span><span class="op" id="7838856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838859">if</span>&nbsp;<span class="ident" id="7838862"><a href="/net/dial_test.go.html#7838372">err</a></span>&nbsp;<span class="op" id="7838866">!=</span>&nbsp;<span class="ident" id="7838869">nil</span>&nbsp;<span class="op" id="7838873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838877"><a href="/net/dial_test.go.html#7838351">t</a></span><span class="op" id="7838878">.</span><span class="ident" id="7838879">Fatalf</span><span class="op" id="7838885">(</span><span class="string" id="7838886">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7838903">,</span>&nbsp;<span class="ident" id="7838905"><a href="/net/dial_test.go.html#7838372">err</a></span><span class="op" id="7838908">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838914">defer</span>&nbsp;<span class="ident" id="7838920"><a href="/net/dial_test.go.html#7838813">c</a></span><span class="op" id="7838921">.</span><span class="ident" id="7838922">Close</span><span class="op" id="7838927">(</span><span class="op" id="7838928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838931"><a href="/net/dial_test.go.html#7838813">c</a></span><span class="op" id="7838932">.</span><span class="ident" id="7838933">Read</span><span class="op" id="7838937">(</span><span class="builtinfunc" id="7838938">make</span><span class="op" id="7838942">(</span><span class="op" id="7838943">[</span><span class="op" id="7838944">]</span><span class="builtintype" id="7838945">byte</span><span class="op" id="7838949">,</span>&nbsp;<span class="num" id="7838951">1</span><span class="op" id="7838952">)</span><span class="op" id="7838953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838956"><a href="/net/dial_test.go.html#7838372">err</a></span>&nbsp;<span class="op" id="7838960">=</span>&nbsp;<span class="op" id="7838962">&lt;-</span><span class="ident" id="7838964"><a href="/net/dial_test.go.html#7838485">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838968">if</span>&nbsp;<span class="ident" id="7838971"><a href="/net/dial_test.go.html#7838372">err</a></span>&nbsp;<span class="op" id="7838975">!=</span>&nbsp;<span class="ident" id="7838978">nil</span>&nbsp;<span class="op" id="7838982">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838986"><a href="/net/dial_test.go.html#7838351">t</a></span><span class="op" id="7838987">.</span><span class="ident" id="7838988">Error</span><span class="op" id="7838993">(</span><span class="ident" id="7838994"><a href="/net/dial_test.go.html#7838372">err</a></span><span class="op" id="7838997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839000">}</span><br>
<span class="lineno"></span><span class="op" id="7839002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7839005">func</span>&nbsp;<span class="ident" id="7839010">TestDialDualStackLocalhost</span><span class="op" id="7839036">(</span><span class="ident" id="7839037">t</span>&nbsp;<span class="op" id="7839039">*</span><span class="ident" id="7839040"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7839047">.</span><span class="ident" id="7839048">T</span><span class="op" id="7839049">)</span>&nbsp;<span class="op" id="7839051">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839054">switch</span>&nbsp;<span class="ident" id="7839061"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7839068">.</span><span class="ident" id="7839069">GOOS</span>&nbsp;<span class="op" id="7839074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839077">case</span>&nbsp;<span class="string" id="7839082">&#34;nacl&#34;</span><span class="op" id="7839088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839092"><a href="/net/dial_test.go.html#7839037">t</a></span><span class="op" id="7839093">.</span><span class="ident" id="7839094">Skipf</span><span class="op" id="7839099">(</span><span class="string" id="7839100">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7839121">,</span>&nbsp;<span class="ident" id="7839123"><a href="/net/dial_test.go.html#7827393">runtime</a></span><span class="op" id="7839130">.</span><span class="ident" id="7839131">GOOS</span><span class="op" id="7839135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839142">if</span>&nbsp;<span class="ident" id="7839145">ips</span><span class="op" id="7839148">,</span>&nbsp;<span class="ident" id="7839150">err</span>&nbsp;<span class="op" id="7839154">:=</span>&nbsp;<span class="ident" id="7839157"><a href="/net/lookup.go.html#1454959">LookupIP</a></span><span class="op" id="7839165">(</span><span class="string" id="7839166">&#34;localhost&#34;</span><span class="op" id="7839177">)</span><span class="op" id="7839178">;</span>&nbsp;<span class="ident" id="7839180"><a href="/net/dial_test.go.html#7839150">err</a></span>&nbsp;<span class="op" id="7839184">!=</span>&nbsp;<span class="ident" id="7839187">nil</span>&nbsp;<span class="op" id="7839191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839195"><a href="/net/dial_test.go.html#7839037">t</a></span><span class="op" id="7839196">.</span><span class="ident" id="7839197">Fatalf</span><span class="op" id="7839203">(</span><span class="string" id="7839204">&#34;LookupIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7839225">,</span>&nbsp;<span class="ident" id="7839227"><a href="/net/dial_test.go.html#7839150">err</a></span><span class="op" id="7839230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839233">}</span>&nbsp;<span class="keyword" id="7839235">else</span>&nbsp;<span class="keyword" id="7839240">if</span>&nbsp;<span class="builtinfunc" id="7839243">len</span><span class="op" id="7839246">(</span><span class="ident" id="7839247"><a href="/net/dial_test.go.html#7839145">ips</a></span><span class="op" id="7839250">)</span>&nbsp;<span class="op" id="7839252">&lt;</span>&nbsp;<span class="num" id="7839254">2</span>&nbsp;<span class="op" id="7839256">||</span>&nbsp;<span class="op" id="7839259">!</span><span class="ident" id="7839260"><a href="/net/ipsock.go.html#1440518">supportsIPv4</a></span>&nbsp;<span class="op" id="7839273">||</span>&nbsp;<span class="op" id="7839276">!</span><span class="ident" id="7839277"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7839290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839294"><a href="/net/dial_test.go.html#7839037">t</a></span><span class="op" id="7839295">.</span><span class="ident" id="7839296">Skip</span><span class="op" id="7839300">(</span><span class="string" id="7839301">&#34;localhost&nbsp;doesn&#39;t&nbsp;have&nbsp;a&nbsp;pair&nbsp;of&nbsp;different&nbsp;address&nbsp;family&nbsp;IP&nbsp;addresses&#34;</span><span class="op" id="7839373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839376">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839380">touchAndByeServer</span>&nbsp;<span class="op" id="7839398">:=</span>&nbsp;<span class="keyword" id="7839401">func</span><span class="op" id="7839405">(</span><span class="ident" id="7839406">dss</span>&nbsp;<span class="op" id="7839410">*</span><span class="ident" id="7839411"><a href="/net/mockserver_test.go.html#7924159">dualStackServer</a></span><span class="op" id="7839426">,</span>&nbsp;<span class="ident" id="7839428">ln</span>&nbsp;<span class="ident" id="7839431"><a href="/net/net.go.html#1471621">Listener</a></span><span class="op" id="7839439">)</span>&nbsp;<span class="op" id="7839441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839445">for</span>&nbsp;<span class="op" id="7839449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839454">if</span>&nbsp;<span class="ident" id="7839457">c</span><span class="op" id="7839458">,</span>&nbsp;<span class="ident" id="7839460">err</span>&nbsp;<span class="op" id="7839464">:=</span>&nbsp;<span class="ident" id="7839467"><a href="/net/dial_test.go.html#7839428">ln</a></span><span class="op" id="7839469">.</span><span class="ident" id="7839470">Accept</span><span class="op" id="7839476">(</span><span class="op" id="7839477">)</span><span class="op" id="7839478">;</span>&nbsp;<span class="ident" id="7839480"><a href="/net/dial_test.go.html#7839460">err</a></span>&nbsp;<span class="op" id="7839484">!=</span>&nbsp;<span class="ident" id="7839487">nil</span>&nbsp;<span class="op" id="7839491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839497">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839507">}</span>&nbsp;<span class="keyword" id="7839509">else</span>&nbsp;<span class="op" id="7839514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839520"><a href="/net/dial_test.go.html#7839457">c</a></span><span class="op" id="7839521">.</span><span class="ident" id="7839522">Close</span><span class="op" id="7839527">(</span><span class="op" id="7839528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839540">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839543">dss</span><span class="op" id="7839546">,</span>&nbsp;<span class="ident" id="7839548">err</span>&nbsp;<span class="op" id="7839552">:=</span>&nbsp;<span class="ident" id="7839555"><a href="/net/mockserver_test.go.html#7925130">newDualStackServer</a></span><span class="op" id="7839573">(</span><span class="op" id="7839574">[</span><span class="op" id="7839575">]</span><span class="ident" id="7839576"><a href="/net/mockserver_test.go.html#7924089">streamListener</a></span><span class="op" id="7839590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839594">{</span><span class="ident" id="7839595">net</span><span class="op" id="7839598">:</span>&nbsp;<span class="string" id="7839600">&#34;tcp4&#34;</span><span class="op" id="7839606">,</span>&nbsp;<span class="ident" id="7839608">addr</span><span class="op" id="7839612">:</span>&nbsp;<span class="string" id="7839614">&#34;127.0.0.1&#34;</span><span class="op" id="7839625">}</span><span class="op" id="7839626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839630">{</span><span class="ident" id="7839631">net</span><span class="op" id="7839634">:</span>&nbsp;<span class="string" id="7839636">&#34;tcp6&#34;</span><span class="op" id="7839642">,</span>&nbsp;<span class="ident" id="7839644">addr</span><span class="op" id="7839648">:</span>&nbsp;<span class="string" id="7839650">&#34;[::1]&#34;</span><span class="op" id="7839657">}</span><span class="op" id="7839658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839661">}</span><span class="op" id="7839662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839665">if</span>&nbsp;<span class="ident" id="7839668"><a href="/net/dial_test.go.html#7839548">err</a></span>&nbsp;<span class="op" id="7839672">!=</span>&nbsp;<span class="ident" id="7839675">nil</span>&nbsp;<span class="op" id="7839679">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839683"><a href="/net/dial_test.go.html#7839037">t</a></span><span class="op" id="7839684">.</span><span class="ident" id="7839685">Fatalf</span><span class="op" id="7839691">(</span><span class="string" id="7839692">&#34;newDualStackServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7839723">,</span>&nbsp;<span class="ident" id="7839725"><a href="/net/dial_test.go.html#7839548">err</a></span><span class="op" id="7839728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839734">defer</span>&nbsp;<span class="ident" id="7839740"><a href="/net/dial_test.go.html#7839543">dss</a></span><span class="op" id="7839743">.</span><span class="ident" id="7839744">teardown</span><span class="op" id="7839752">(</span><span class="op" id="7839753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839756">if</span>&nbsp;<span class="ident" id="7839759">err</span>&nbsp;<span class="op" id="7839763">:=</span>&nbsp;<span class="ident" id="7839766"><a href="/net/dial_test.go.html#7839543">dss</a></span><span class="op" id="7839769">.</span><span class="ident" id="7839770">buildup</span><span class="op" id="7839777">(</span><span class="ident" id="7839778"><a href="/net/dial_test.go.html#7839380">touchAndByeServer</a></span><span class="op" id="7839795">)</span><span class="op" id="7839796">;</span>&nbsp;<span class="ident" id="7839798"><a href="/net/dial_test.go.html#7839759">err</a></span>&nbsp;<span class="op" id="7839802">!=</span>&nbsp;<span class="ident" id="7839805">nil</span>&nbsp;<span class="op" id="7839809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839813"><a href="/net/dial_test.go.html#7839037">t</a></span><span class="op" id="7839814">.</span><span class="ident" id="7839815">Fatalf</span><span class="op" id="7839821">(</span><span class="string" id="7839822">&#34;dualStackServer.buildup&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7839858">,</span>&nbsp;<span class="ident" id="7839860"><a href="/net/dial_test.go.html#7839759">err</a></span><span class="op" id="7839863">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839870">d</span>&nbsp;<span class="op" id="7839872">:=</span>&nbsp;<span class="op" id="7839875">&amp;</span><span class="ident" id="7839876"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="7839882">{</span><span class="ident" id="7839883">DualStack</span><span class="op" id="7839892">:</span>&nbsp;<span class="builtintype" id="7839894">true</span><span class="op" id="7839898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839901">for</span>&nbsp;<span class="keyword" id="7839905">range</span>&nbsp;<span class="ident" id="7839911"><a href="/net/dial_test.go.html#7839543">dss</a></span><span class="op" id="7839914">.</span><span class="ident" id="7839915">lns</span>&nbsp;<span class="op" id="7839919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839923">if</span>&nbsp;<span class="ident" id="7839926">c</span><span class="op" id="7839927">,</span>&nbsp;<span class="ident" id="7839929">err</span>&nbsp;<span class="op" id="7839933">:=</span>&nbsp;<span class="ident" id="7839936"><a href="/net/dial_test.go.html#7839870">d</a></span><span class="op" id="7839937">.</span><span class="ident" id="7839938">Dial</span><span class="op" id="7839942">(</span><span class="string" id="7839943">&#34;tcp&#34;</span><span class="op" id="7839948">,</span>&nbsp;<span class="string" id="7839950">&#34;localhost:&#34;</span><span class="op" id="7839962">+</span><span class="ident" id="7839963"><a href="/net/dial_test.go.html#7839543">dss</a></span><span class="op" id="7839966">.</span><span class="ident" id="7839967">port</span><span class="op" id="7839971">)</span><span class="op" id="7839972">;</span>&nbsp;<span class="ident" id="7839974"><a href="/net/dial_test.go.html#7839929">err</a></span>&nbsp;<span class="op" id="7839978">!=</span>&nbsp;<span class="ident" id="7839981">nil</span>&nbsp;<span class="op" id="7839985">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839990"><a href="/net/dial_test.go.html#7839037">t</a></span><span class="op" id="7839991">.</span><span class="ident" id="7839992">Errorf</span><span class="op" id="7839998">(</span><span class="string" id="7839999">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7840016">,</span>&nbsp;<span class="ident" id="7840018"><a href="/net/dial_test.go.html#7839929">err</a></span><span class="op" id="7840021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840025">}</span>&nbsp;<span class="keyword" id="7840027">else</span>&nbsp;<span class="op" id="7840032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840037">if</span>&nbsp;<span class="ident" id="7840040">addr</span>&nbsp;<span class="op" id="7840045">:=</span>&nbsp;<span class="ident" id="7840048"><a href="/net/dial_test.go.html#7839926">c</a></span><span class="op" id="7840049">.</span><span class="ident" id="7840050">LocalAddr</span><span class="op" id="7840059">(</span><span class="op" id="7840060">)</span><span class="op" id="7840061">.</span><span class="op" id="7840062">(</span><span class="op" id="7840063">*</span><span class="ident" id="7840064"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7840071">)</span><span class="op" id="7840072">;</span>&nbsp;<span class="ident" id="7840074"><a href="/net/dial_test.go.html#7840040">addr</a></span><span class="op" id="7840078">.</span><span class="ident" id="7840079">IP</span><span class="op" id="7840081">.</span><span class="ident" id="7840082">To4</span><span class="op" id="7840085">(</span><span class="op" id="7840086">)</span>&nbsp;<span class="op" id="7840088">!=</span>&nbsp;<span class="ident" id="7840091">nil</span>&nbsp;<span class="op" id="7840095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840101"><a href="/net/dial_test.go.html#7839543">dss</a></span><span class="op" id="7840104">.</span><span class="ident" id="7840105">teardownNetwork</span><span class="op" id="7840120">(</span><span class="string" id="7840121">&#34;tcp4&#34;</span><span class="op" id="7840127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840132">}</span>&nbsp;<span class="keyword" id="7840134">else</span>&nbsp;<span class="keyword" id="7840139">if</span>&nbsp;<span class="ident" id="7840142"><a href="/net/dial_test.go.html#7840040">addr</a></span><span class="op" id="7840146">.</span><span class="ident" id="7840147">IP</span><span class="op" id="7840149">.</span><span class="ident" id="7840150">To16</span><span class="op" id="7840154">(</span><span class="op" id="7840155">)</span>&nbsp;<span class="op" id="7840157">!=</span>&nbsp;<span class="ident" id="7840160">nil</span>&nbsp;<span class="op" id="7840164">&amp;&amp;</span>&nbsp;<span class="ident" id="7840167"><a href="/net/dial_test.go.html#7840040">addr</a></span><span class="op" id="7840171">.</span><span class="ident" id="7840172">IP</span><span class="op" id="7840174">.</span><span class="ident" id="7840175">To4</span><span class="op" id="7840178">(</span><span class="op" id="7840179">)</span>&nbsp;<span class="op" id="7840181">==</span>&nbsp;<span class="ident" id="7840184">nil</span>&nbsp;<span class="op" id="7840188">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840194"><a href="/net/dial_test.go.html#7839543">dss</a></span><span class="op" id="7840197">.</span><span class="ident" id="7840198">teardownNetwork</span><span class="op" id="7840213">(</span><span class="string" id="7840214">&#34;tcp6&#34;</span><span class="op" id="7840220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840230"><a href="/net/dial_test.go.html#7839926">c</a></span><span class="op" id="7840231">.</span><span class="ident" id="7840232">Close</span><span class="op" id="7840237">(</span><span class="op" id="7840238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840245">}</span><br>
<span class="lineno">515</span><span class="op" id="7840247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7840250">func</span>&nbsp;<span class="ident" id="7840255">TestDialerKeepAlive</span><span class="op" id="7840274">(</span><span class="ident" id="7840275">t</span>&nbsp;<span class="op" id="7840277">*</span><span class="ident" id="7840278"><a href="/net/dial_test.go.html#7827423">testing</a></span><span class="op" id="7840285">.</span><span class="ident" id="7840286">T</span><span class="op" id="7840287">)</span>&nbsp;<span class="op" id="7840289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840292">ln</span>&nbsp;<span class="op" id="7840295">:=</span>&nbsp;<span class="ident" id="7840298"><a href="/net/dial_test.go.html#7827449">newLocalListener</a></span><span class="op" id="7840314">(</span><span class="ident" id="7840315"><a href="/net/dial_test.go.html#7840275">t</a></span><span class="op" id="7840316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840319">defer</span>&nbsp;<span class="ident" id="7840325"><a href="/net/dial_test.go.html#7840292">ln</a></span><span class="op" id="7840327">.</span><span class="ident" id="7840328">Close</span><span class="op" id="7840333">(</span><span class="op" id="7840334">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840337">defer</span>&nbsp;<span class="keyword" id="7840343">func</span><span class="op" id="7840347">(</span><span class="op" id="7840348">)</span>&nbsp;<span class="op" id="7840350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840354"><a href="/net/dial.go.html#1335649">testHookSetKeepAlive</a></span>&nbsp;<span class="op" id="7840375">=</span>&nbsp;<span class="keyword" id="7840377">func</span><span class="op" id="7840381">(</span><span class="op" id="7840382">)</span>&nbsp;<span class="op" id="7840384">{</span><span class="op" id="7840385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840388">}</span><span class="op" id="7840389">(</span><span class="op" id="7840390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840393">go</span>&nbsp;<span class="keyword" id="7840396">func</span><span class="op" id="7840400">(</span><span class="op" id="7840401">)</span>&nbsp;<span class="op" id="7840403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840407">for</span>&nbsp;<span class="op" id="7840411">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840416">c</span><span class="op" id="7840417">,</span>&nbsp;<span class="ident" id="7840419">err</span>&nbsp;<span class="op" id="7840423">:=</span>&nbsp;<span class="ident" id="7840426"><a href="/net/dial_test.go.html#7840292">ln</a></span><span class="op" id="7840428">.</span><span class="ident" id="7840429">Accept</span><span class="op" id="7840435">(</span><span class="op" id="7840436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840441">if</span>&nbsp;<span class="ident" id="7840444"><a href="/net/dial_test.go.html#7840419">err</a></span>&nbsp;<span class="op" id="7840448">!=</span>&nbsp;<span class="ident" id="7840451">nil</span>&nbsp;<span class="op" id="7840455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840461">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840476"><a href="/net/dial_test.go.html#7840416">c</a></span><span class="op" id="7840477">.</span><span class="ident" id="7840478">Close</span><span class="op" id="7840483">(</span><span class="op" id="7840484">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840491">}</span><span class="op" id="7840492">(</span><span class="op" id="7840493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840496">for</span>&nbsp;<span class="ident" id="7840500">_</span><span class="op" id="7840501">,</span>&nbsp;<span class="ident" id="7840503">keepAlive</span>&nbsp;<span class="op" id="7840513">:=</span>&nbsp;<span class="keyword" id="7840516">range</span>&nbsp;<span class="op" id="7840522">[</span><span class="op" id="7840523">]</span><span class="builtintype" id="7840524">bool</span><span class="op" id="7840528">{</span><span class="builtintype" id="7840529">false</span><span class="op" id="7840534">,</span>&nbsp;<span class="builtintype" id="7840536">true</span><span class="op" id="7840540">}</span>&nbsp;<span class="op" id="7840542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840546">got</span>&nbsp;<span class="op" id="7840550">:=</span>&nbsp;<span class="builtintype" id="7840553">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840561"><a href="/net/dial.go.html#1335649">testHookSetKeepAlive</a></span>&nbsp;<span class="op" id="7840582">=</span>&nbsp;<span class="keyword" id="7840584">func</span><span class="op" id="7840588">(</span><span class="op" id="7840589">)</span>&nbsp;<span class="op" id="7840591">{</span>&nbsp;<span class="ident" id="7840593"><a href="/net/dial_test.go.html#7840546">got</a></span>&nbsp;<span class="op" id="7840597">=</span>&nbsp;<span class="builtintype" id="7840599">true</span>&nbsp;<span class="op" id="7840604">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840608">var</span>&nbsp;<span class="ident" id="7840612">d</span>&nbsp;<span class="ident" id="7840614"><a href="/net/dial.go.html#1330674">Dialer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840623">if</span>&nbsp;<span class="ident" id="7840626"><a href="/net/dial_test.go.html#7840503">keepAlive</a></span>&nbsp;<span class="op" id="7840636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840641"><a href="/net/dial_test.go.html#7840612">d</a></span><span class="op" id="7840642">.</span><span class="ident" id="7840643">KeepAlive</span>&nbsp;<span class="op" id="7840653">=</span>&nbsp;<span class="num" id="7840655">30</span>&nbsp;<span class="op" id="7840658">*</span>&nbsp;<span class="ident" id="7840660"><a href="/net/dial_test.go.html#7827434">time</a></span><span class="op" id="7840664">.</span><span class="ident" id="7840665">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840678">c</span><span class="op" id="7840679">,</span>&nbsp;<span class="ident" id="7840681">err</span>&nbsp;<span class="op" id="7840685">:=</span>&nbsp;<span class="ident" id="7840688"><a href="/net/dial_test.go.html#7840612">d</a></span><span class="op" id="7840689">.</span><span class="ident" id="7840690">Dial</span><span class="op" id="7840694">(</span><span class="string" id="7840695">&#34;tcp&#34;</span><span class="op" id="7840700">,</span>&nbsp;<span class="ident" id="7840702"><a href="/net/dial_test.go.html#7840292">ln</a></span><span class="op" id="7840704">.</span><span class="ident" id="7840705">Addr</span><span class="op" id="7840709">(</span><span class="op" id="7840710">)</span><span class="op" id="7840711">.</span><span class="ident" id="7840712">String</span><span class="op" id="7840718">(</span><span class="op" id="7840719">)</span><span class="op" id="7840720">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840724">if</span>&nbsp;<span class="ident" id="7840727"><a href="/net/dial_test.go.html#7840681">err</a></span>&nbsp;<span class="op" id="7840731">!=</span>&nbsp;<span class="ident" id="7840734">nil</span>&nbsp;<span class="op" id="7840738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840743"><a href="/net/dial_test.go.html#7840275">t</a></span><span class="op" id="7840744">.</span><span class="ident" id="7840745">Fatal</span><span class="op" id="7840750">(</span><span class="ident" id="7840751"><a href="/net/dial_test.go.html#7840681">err</a></span><span class="op" id="7840754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840762"><a href="/net/dial_test.go.html#7840678">c</a></span><span class="op" id="7840763">.</span><span class="ident" id="7840764">Close</span><span class="op" id="7840769">(</span><span class="op" id="7840770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840774">if</span>&nbsp;<span class="ident" id="7840777"><a href="/net/dial_test.go.html#7840546">got</a></span>&nbsp;<span class="op" id="7840781">!=</span>&nbsp;<span class="ident" id="7840784"><a href="/net/dial_test.go.html#7840503">keepAlive</a></span>&nbsp;<span class="op" id="7840794">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840799"><a href="/net/dial_test.go.html#7840275">t</a></span><span class="op" id="7840800">.</span><span class="ident" id="7840801">Errorf</span><span class="op" id="7840807">(</span><span class="string" id="7840808">&#34;Dialer.KeepAlive&nbsp;=&nbsp;%v:&nbsp;SetKeepAlive&nbsp;called&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7840866">,</span>&nbsp;<span class="ident" id="7840868"><a href="/net/dial_test.go.html#7840612">d</a></span><span class="op" id="7840869">.</span><span class="ident" id="7840870">KeepAlive</span><span class="op" id="7840879">,</span>&nbsp;<span class="ident" id="7840881"><a href="/net/dial_test.go.html#7840546">got</a></span><span class="op" id="7840884">,</span>&nbsp;<span class="op" id="7840886">!</span><span class="ident" id="7840887"><a href="/net/dial_test.go.html#7840546">got</a></span><span class="op" id="7840890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840897">}</span><br>
<span class="lineno"></span><span class="op" id="7840899">}</span>
</div>
</body>
</html>
