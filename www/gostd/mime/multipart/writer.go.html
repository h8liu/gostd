<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3838718">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3838773">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3838827">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3838878">package</span>&nbsp;<span class="ident" id="3838886">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3838897">import</span>&nbsp;<span class="op" id="3838904">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3838907">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3838916">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3838931">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3838941">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3838948">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3838954">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3838971">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3838981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3838984">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3839026">type</span>&nbsp;<span class="ident" id="3839031">Writer</span>&nbsp;<span class="keyword" id="3839038">struct</span>&nbsp;<span class="op" id="3839045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3839048">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839057">io</span><span class="op" id="3839059">.</span><span class="ident" id="3839060">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3839068">boundary</span>&nbsp;<span class="builtintype" id="3839077">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3839085">lastpart</span>&nbsp;<span class="op" id="3839094">*</span><span class="ident" id="3839095">part</span><br>
<span class="lineno"></span><span class="op" id="3839100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3839103">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="3839171">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3839188">func</span>&nbsp;<span class="ident" id="3839193">NewWriter</span><span class="op" id="3839202">(</span><span class="ident" id="3839203">w</span>&nbsp;<span class="ident" id="3839205">io</span><span class="op" id="3839207">.</span><span class="ident" id="3839208">Writer</span><span class="op" id="3839214">)</span>&nbsp;<span class="op" id="3839216">*</span><span class="ident" id="3839217">Writer</span>&nbsp;<span class="op" id="3839224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839227">return</span>&nbsp;<span class="op" id="3839234">&amp;</span><span class="ident" id="3839235">Writer</span><span class="op" id="3839241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3839245">w</span><span class="op" id="3839246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839255">w</span><span class="op" id="3839256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3839260">boundary</span><span class="op" id="3839268">:</span>&nbsp;<span class="ident" id="3839270">randomBoundary</span><span class="op" id="3839284">(</span><span class="op" id="3839285">)</span><span class="op" id="3839286">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3839289">}</span><br>
<span class="lineno"></span><span class="op" id="3839291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3839294">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3839337">func</span>&nbsp;<span class="op" id="3839342">(</span><span class="ident" id="3839343">w</span>&nbsp;<span class="op" id="3839345">*</span><span class="ident" id="3839346">Writer</span><span class="op" id="3839352">)</span>&nbsp;<span class="ident" id="3839354">Boundary</span><span class="op" id="3839362">(</span><span class="op" id="3839363">)</span>&nbsp;<span class="builtintype" id="3839365">string</span>&nbsp;<span class="op" id="3839372">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839375">return</span>&nbsp;<span class="ident" id="3839382">w</span><span class="op" id="3839383">.</span><span class="ident" id="3839384">boundary</span><br>
<span class="lineno"></span><span class="op" id="3839393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3839396">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="3839461">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="3839507">//</span><br>
<span class="lineno"></span><span class="comment" id="3839510">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="3839579">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="3839645">func</span>&nbsp;<span class="op" id="3839650">(</span><span class="ident" id="3839651">w</span>&nbsp;<span class="op" id="3839653">*</span><span class="ident" id="3839654">Writer</span><span class="op" id="3839660">)</span>&nbsp;<span class="ident" id="3839662">SetBoundary</span><span class="op" id="3839673">(</span><span class="ident" id="3839674">boundary</span>&nbsp;<span class="builtintype" id="3839683">string</span><span class="op" id="3839689">)</span>&nbsp;<span class="builtintype" id="3839691">error</span>&nbsp;<span class="op" id="3839697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839700">if</span>&nbsp;<span class="ident" id="3839703">w</span><span class="op" id="3839704">.</span><span class="ident" id="3839705">lastpart</span>&nbsp;<span class="op" id="3839714">!=</span>&nbsp;<span class="ident" id="3839717">nil</span>&nbsp;<span class="op" id="3839721">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839725">return</span>&nbsp;<span class="ident" id="3839732">errors</span><span class="op" id="3839738">.</span><span class="ident" id="3839739">New</span><span class="op" id="3839742">(</span><span class="string" id="3839743">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="3839781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3839784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3839787">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839813">if</span>&nbsp;<span class="builtinfunc" id="3839816">len</span><span class="op" id="3839819">(</span><span class="ident" id="3839820">boundary</span><span class="op" id="3839828">)</span>&nbsp;<span class="op" id="3839830">&lt;</span>&nbsp;<span class="num" id="3839832">1</span>&nbsp;<span class="op" id="3839834">||</span>&nbsp;<span class="builtinfunc" id="3839837">len</span><span class="op" id="3839840">(</span><span class="ident" id="3839841">boundary</span><span class="op" id="3839849">)</span>&nbsp;<span class="op" id="3839851">&gt;</span>&nbsp;<span class="num" id="3839853">69</span>&nbsp;<span class="op" id="3839856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839860">return</span>&nbsp;<span class="ident" id="3839867">errors</span><span class="op" id="3839873">.</span><span class="ident" id="3839874">New</span><span class="op" id="3839877">(</span><span class="string" id="3839878">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="3839909">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3839912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839915">for</span>&nbsp;<span class="ident" id="3839919">_</span><span class="op" id="3839920">,</span>&nbsp;<span class="ident" id="3839922">b</span>&nbsp;<span class="op" id="3839924">:=</span>&nbsp;<span class="keyword" id="3839927">range</span>&nbsp;<span class="ident" id="3839933">boundary</span>&nbsp;<span class="op" id="3839942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3839946">if</span>&nbsp;<span class="string" id="3839949">&#39;A&#39;</span>&nbsp;<span class="op" id="3839953">&lt;=</span>&nbsp;<span class="ident" id="3839956">b</span>&nbsp;<span class="op" id="3839958">&amp;&amp;</span>&nbsp;<span class="ident" id="3839961">b</span>&nbsp;<span class="op" id="3839963">&lt;=</span>&nbsp;<span class="string" id="3839966">&#39;Z&#39;</span>&nbsp;<span class="op" id="3839970">||</span>&nbsp;<span class="string" id="3839973">&#39;a&#39;</span>&nbsp;<span class="op" id="3839977">&lt;=</span>&nbsp;<span class="ident" id="3839980">b</span>&nbsp;<span class="op" id="3839982">&amp;&amp;</span>&nbsp;<span class="ident" id="3839985">b</span>&nbsp;<span class="op" id="3839987">&lt;=</span>&nbsp;<span class="string" id="3839990">&#39;z&#39;</span>&nbsp;<span class="op" id="3839994">||</span>&nbsp;<span class="string" id="3839997">&#39;0&#39;</span>&nbsp;<span class="op" id="3840001">&lt;=</span>&nbsp;<span class="ident" id="3840004">b</span>&nbsp;<span class="op" id="3840006">&amp;&amp;</span>&nbsp;<span class="ident" id="3840009">b</span>&nbsp;<span class="op" id="3840011">&lt;=</span>&nbsp;<span class="string" id="3840014">&#39;9&#39;</span>&nbsp;<span class="op" id="3840018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840023">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3840034">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840038">switch</span>&nbsp;<span class="ident" id="3840045">b</span>&nbsp;<span class="op" id="3840047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840051">case</span>&nbsp;<span class="string" id="3840056">&#39;\&#39;&#39;</span><span class="op" id="3840060">,</span>&nbsp;<span class="string" id="3840062">&#39;(&#39;</span><span class="op" id="3840065">,</span>&nbsp;<span class="string" id="3840067">&#39;)&#39;</span><span class="op" id="3840070">,</span>&nbsp;<span class="string" id="3840072">&#39;+&#39;</span><span class="op" id="3840075">,</span>&nbsp;<span class="string" id="3840077">&#39;_&#39;</span><span class="op" id="3840080">,</span>&nbsp;<span class="string" id="3840082">&#39;,&#39;</span><span class="op" id="3840085">,</span>&nbsp;<span class="string" id="3840087">&#39;-&#39;</span><span class="op" id="3840090">,</span>&nbsp;<span class="string" id="3840092">&#39;.&#39;</span><span class="op" id="3840095">,</span>&nbsp;<span class="string" id="3840097">&#39;/&#39;</span><span class="op" id="3840100">,</span>&nbsp;<span class="string" id="3840102">&#39;:&#39;</span><span class="op" id="3840105">,</span>&nbsp;<span class="string" id="3840107">&#39;=&#39;</span><span class="op" id="3840110">,</span>&nbsp;<span class="string" id="3840112">&#39;?&#39;</span><span class="op" id="3840115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840120">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3840131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840135">return</span>&nbsp;<span class="ident" id="3840142">errors</span><span class="op" id="3840148">.</span><span class="ident" id="3840149">New</span><span class="op" id="3840152">(</span><span class="string" id="3840153">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="3840187">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3840190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3840193">w</span><span class="op" id="3840194">.</span><span class="ident" id="3840195">boundary</span>&nbsp;<span class="op" id="3840204">=</span>&nbsp;<span class="ident" id="3840206">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840216">return</span>&nbsp;<span class="ident" id="3840223">nil</span><br>
<span class="lineno"></span><span class="op" id="3840227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3840230">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="3840290">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3840342">func</span>&nbsp;<span class="op" id="3840347">(</span><span class="ident" id="3840348">w</span>&nbsp;<span class="op" id="3840350">*</span><span class="ident" id="3840351">Writer</span><span class="op" id="3840357">)</span>&nbsp;<span class="ident" id="3840359">FormDataContentType</span><span class="op" id="3840378">(</span><span class="op" id="3840379">)</span>&nbsp;<span class="builtintype" id="3840381">string</span>&nbsp;<span class="op" id="3840388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840391">return</span>&nbsp;<span class="string" id="3840398">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="3840431">+</span>&nbsp;<span class="ident" id="3840433">w</span><span class="op" id="3840434">.</span><span class="ident" id="3840435">boundary</span><br>
<span class="lineno"></span><span class="op" id="3840444">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3840447">func</span>&nbsp;<span class="ident" id="3840452">randomBoundary</span><span class="op" id="3840466">(</span><span class="op" id="3840467">)</span>&nbsp;<span class="builtintype" id="3840469">string</span>&nbsp;<span class="op" id="3840476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840479">var</span>&nbsp;<span class="ident" id="3840483">buf</span>&nbsp;<span class="op" id="3840487">[</span><span class="num" id="3840488">30</span><span class="op" id="3840490">]</span><span class="builtintype" id="3840491">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3840497">_</span><span class="op" id="3840498">,</span>&nbsp;<span class="ident" id="3840500">err</span>&nbsp;<span class="op" id="3840504">:=</span>&nbsp;<span class="ident" id="3840507">io</span><span class="op" id="3840509">.</span><span class="ident" id="3840510">ReadFull</span><span class="op" id="3840518">(</span><span class="ident" id="3840519">rand</span><span class="op" id="3840523">.</span><span class="ident" id="3840524">Reader</span><span class="op" id="3840530">,</span>&nbsp;<span class="ident" id="3840532">buf</span><span class="op" id="3840535">[</span><span class="op" id="3840536">:</span><span class="op" id="3840537">]</span><span class="op" id="3840538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840541">if</span>&nbsp;<span class="ident" id="3840544">err</span>&nbsp;<span class="op" id="3840548">!=</span>&nbsp;<span class="ident" id="3840551">nil</span>&nbsp;<span class="op" id="3840555">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3840559">panic</span><span class="op" id="3840564">(</span><span class="ident" id="3840565">err</span><span class="op" id="3840568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3840571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840574">return</span>&nbsp;<span class="ident" id="3840581">fmt</span><span class="op" id="3840584">.</span><span class="ident" id="3840585">Sprintf</span><span class="op" id="3840592">(</span><span class="string" id="3840593">&#34;%x&#34;</span><span class="op" id="3840597">,</span>&nbsp;<span class="ident" id="3840599">buf</span><span class="op" id="3840602">[</span><span class="op" id="3840603">:</span><span class="op" id="3840604">]</span><span class="op" id="3840605">)</span><br>
<span class="lineno"></span><span class="op" id="3840607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3840610">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3840674">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3840740">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="3840809">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3840827">func</span>&nbsp;<span class="op" id="3840832">(</span><span class="ident" id="3840833">w</span>&nbsp;<span class="op" id="3840835">*</span><span class="ident" id="3840836">Writer</span><span class="op" id="3840842">)</span>&nbsp;<span class="ident" id="3840844">CreatePart</span><span class="op" id="3840854">(</span><span class="ident" id="3840855">header</span>&nbsp;<span class="ident" id="3840862">textproto</span><span class="op" id="3840871">.</span><span class="ident" id="3840872">MIMEHeader</span><span class="op" id="3840882">)</span>&nbsp;<span class="op" id="3840884">(</span><span class="ident" id="3840885">io</span><span class="op" id="3840887">.</span><span class="ident" id="3840888">Writer</span><span class="op" id="3840894">,</span>&nbsp;<span class="builtintype" id="3840896">error</span><span class="op" id="3840901">)</span>&nbsp;<span class="op" id="3840903">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840906">if</span>&nbsp;<span class="ident" id="3840909">w</span><span class="op" id="3840910">.</span><span class="ident" id="3840911">lastpart</span>&nbsp;<span class="op" id="3840920">!=</span>&nbsp;<span class="ident" id="3840923">nil</span>&nbsp;<span class="op" id="3840927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840931">if</span>&nbsp;<span class="ident" id="3840934">err</span>&nbsp;<span class="op" id="3840938">:=</span>&nbsp;<span class="ident" id="3840941">w</span><span class="op" id="3840942">.</span><span class="ident" id="3840943">lastpart</span><span class="op" id="3840951">.</span><span class="builtinfunc" id="3840952">close</span><span class="op" id="3840957">(</span><span class="op" id="3840958">)</span><span class="op" id="3840959">;</span>&nbsp;<span class="ident" id="3840961">err</span>&nbsp;<span class="op" id="3840965">!=</span>&nbsp;<span class="ident" id="3840968">nil</span>&nbsp;<span class="op" id="3840972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3840977">return</span>&nbsp;<span class="ident" id="3840984">nil</span><span class="op" id="3840987">,</span>&nbsp;<span class="ident" id="3840989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3840995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3840998">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841001">var</span>&nbsp;<span class="ident" id="3841005">b</span>&nbsp;<span class="ident" id="3841007">bytes</span><span class="op" id="3841012">.</span><span class="ident" id="3841013">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841021">if</span>&nbsp;<span class="ident" id="3841024">w</span><span class="op" id="3841025">.</span><span class="ident" id="3841026">lastpart</span>&nbsp;<span class="op" id="3841035">!=</span>&nbsp;<span class="ident" id="3841038">nil</span>&nbsp;<span class="op" id="3841042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841046">fmt</span><span class="op" id="3841049">.</span><span class="ident" id="3841050">Fprintf</span><span class="op" id="3841057">(</span><span class="op" id="3841058">&amp;</span><span class="ident" id="3841059">b</span><span class="op" id="3841060">,</span>&nbsp;<span class="string" id="3841062">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="3841076">,</span>&nbsp;<span class="ident" id="3841078">w</span><span class="op" id="3841079">.</span><span class="ident" id="3841080">boundary</span><span class="op" id="3841088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3841091">}</span>&nbsp;<span class="keyword" id="3841093">else</span>&nbsp;<span class="op" id="3841098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841102">fmt</span><span class="op" id="3841105">.</span><span class="ident" id="3841106">Fprintf</span><span class="op" id="3841113">(</span><span class="op" id="3841114">&amp;</span><span class="ident" id="3841115">b</span><span class="op" id="3841116">,</span>&nbsp;<span class="string" id="3841118">&#34;--%s\r\n&#34;</span><span class="op" id="3841128">,</span>&nbsp;<span class="ident" id="3841130">w</span><span class="op" id="3841131">.</span><span class="ident" id="3841132">boundary</span><span class="op" id="3841140">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3841143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841146">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841223">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841270">for</span>&nbsp;<span class="ident" id="3841274">k</span><span class="op" id="3841275">,</span>&nbsp;<span class="ident" id="3841277">vv</span>&nbsp;<span class="op" id="3841280">:=</span>&nbsp;<span class="keyword" id="3841283">range</span>&nbsp;<span class="ident" id="3841289">header</span>&nbsp;<span class="op" id="3841296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841300">for</span>&nbsp;<span class="ident" id="3841304">_</span><span class="op" id="3841305">,</span>&nbsp;<span class="ident" id="3841307">v</span>&nbsp;<span class="op" id="3841309">:=</span>&nbsp;<span class="keyword" id="3841312">range</span>&nbsp;<span class="ident" id="3841318">vv</span>&nbsp;<span class="op" id="3841321">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841326">fmt</span><span class="op" id="3841329">.</span><span class="ident" id="3841330">Fprintf</span><span class="op" id="3841337">(</span><span class="op" id="3841338">&amp;</span><span class="ident" id="3841339">b</span><span class="op" id="3841340">,</span>&nbsp;<span class="string" id="3841342">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="3841354">,</span>&nbsp;<span class="ident" id="3841356">k</span><span class="op" id="3841357">,</span>&nbsp;<span class="ident" id="3841359">v</span><span class="op" id="3841360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3841364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3841367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841370">fmt</span><span class="op" id="3841373">.</span><span class="ident" id="3841374">Fprintf</span><span class="op" id="3841381">(</span><span class="op" id="3841382">&amp;</span><span class="ident" id="3841383">b</span><span class="op" id="3841384">,</span>&nbsp;<span class="string" id="3841386">&#34;\r\n&#34;</span><span class="op" id="3841392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841395">_</span><span class="op" id="3841396">,</span>&nbsp;<span class="ident" id="3841398">err</span>&nbsp;<span class="op" id="3841402">:=</span>&nbsp;<span class="ident" id="3841405">io</span><span class="op" id="3841407">.</span><span class="ident" id="3841408">Copy</span><span class="op" id="3841412">(</span><span class="ident" id="3841413">w</span><span class="op" id="3841414">.</span><span class="ident" id="3841415">w</span><span class="op" id="3841416">,</span>&nbsp;<span class="op" id="3841418">&amp;</span><span class="ident" id="3841419">b</span><span class="op" id="3841420">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841423">if</span>&nbsp;<span class="ident" id="3841426">err</span>&nbsp;<span class="op" id="3841430">!=</span>&nbsp;<span class="ident" id="3841433">nil</span>&nbsp;<span class="op" id="3841437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841441">return</span>&nbsp;<span class="ident" id="3841448">nil</span><span class="op" id="3841451">,</span>&nbsp;<span class="ident" id="3841453">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3841458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841461">p</span>&nbsp;<span class="op" id="3841463">:=</span>&nbsp;<span class="op" id="3841466">&amp;</span><span class="ident" id="3841467">part</span><span class="op" id="3841471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841475">mw</span><span class="op" id="3841477">:</span>&nbsp;<span class="ident" id="3841479">w</span><span class="op" id="3841480">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3841483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841486">w</span><span class="op" id="3841487">.</span><span class="ident" id="3841488">lastpart</span>&nbsp;<span class="op" id="3841497">=</span>&nbsp;<span class="ident" id="3841499">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841502">return</span>&nbsp;<span class="ident" id="3841509">p</span><span class="op" id="3841510">,</span>&nbsp;<span class="ident" id="3841512">nil</span><br>
<span class="lineno"></span><span class="op" id="3841516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3841519">var</span>&nbsp;<span class="ident" id="3841523">quoteEscaper</span>&nbsp;<span class="op" id="3841536">=</span>&nbsp;<span class="ident" id="3841538">strings</span><span class="op" id="3841545">.</span><span class="ident" id="3841546">NewReplacer</span><span class="op" id="3841557">(</span><span class="string" id="3841558">&#34;\\&#34;</span><span class="op" id="3841562">,</span>&nbsp;<span class="string" id="3841564">&#34;\\\\&#34;</span><span class="op" id="3841570">,</span>&nbsp;<span class="string" id="3841572">`&#34;`</span><span class="op" id="3841575">,</span>&nbsp;<span class="string" id="3841577">&#34;\\\&#34;&#34;</span><span class="op" id="3841583">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3841586">func</span>&nbsp;<span class="ident" id="3841591">escapeQuotes</span><span class="op" id="3841603">(</span><span class="ident" id="3841604">s</span>&nbsp;<span class="builtintype" id="3841606">string</span><span class="op" id="3841612">)</span>&nbsp;<span class="builtintype" id="3841614">string</span>&nbsp;<span class="op" id="3841621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3841624">return</span>&nbsp;<span class="ident" id="3841631">quoteEscaper</span><span class="op" id="3841643">.</span><span class="ident" id="3841644">Replace</span><span class="op" id="3841651">(</span><span class="ident" id="3841652">s</span><span class="op" id="3841653">)</span><br>
<span class="lineno"></span><span class="op" id="3841655">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3841658">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="3841731">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3841801">func</span>&nbsp;<span class="op" id="3841806">(</span><span class="ident" id="3841807">w</span>&nbsp;<span class="op" id="3841809">*</span><span class="ident" id="3841810">Writer</span><span class="op" id="3841816">)</span>&nbsp;<span class="ident" id="3841818">CreateFormFile</span><span class="op" id="3841832">(</span><span class="ident" id="3841833">fieldname</span><span class="op" id="3841842">,</span>&nbsp;<span class="ident" id="3841844">filename</span>&nbsp;<span class="builtintype" id="3841853">string</span><span class="op" id="3841859">)</span>&nbsp;<span class="op" id="3841861">(</span><span class="ident" id="3841862">io</span><span class="op" id="3841864">.</span><span class="ident" id="3841865">Writer</span><span class="op" id="3841871">,</span>&nbsp;<span class="builtintype" id="3841873">error</span><span class="op" id="3841878">)</span>&nbsp;<span class="op" id="3841880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841883">h</span>&nbsp;<span class="op" id="3841885">:=</span>&nbsp;<span class="builtinfunc" id="3841888">make</span><span class="op" id="3841892">(</span><span class="ident" id="3841893">textproto</span><span class="op" id="3841902">.</span><span class="ident" id="3841903">MIMEHeader</span><span class="op" id="3841913">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841916">h</span><span class="op" id="3841917">.</span><span class="ident" id="3841918">Set</span><span class="op" id="3841921">(</span><span class="string" id="3841922">&#34;Content-Disposition&#34;</span><span class="op" id="3841943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841947">fmt</span><span class="op" id="3841950">.</span><span class="ident" id="3841951">Sprintf</span><span class="op" id="3841958">(</span><span class="string" id="3841959">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="3841996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842001">escapeQuotes</span><span class="op" id="3842013">(</span><span class="ident" id="3842014">fieldname</span><span class="op" id="3842023">)</span><span class="op" id="3842024">,</span>&nbsp;<span class="ident" id="3842026">escapeQuotes</span><span class="op" id="3842038">(</span><span class="ident" id="3842039">filename</span><span class="op" id="3842047">)</span><span class="op" id="3842048">)</span><span class="op" id="3842049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842052">h</span><span class="op" id="3842053">.</span><span class="ident" id="3842054">Set</span><span class="op" id="3842057">(</span><span class="string" id="3842058">&#34;Content-Type&#34;</span><span class="op" id="3842072">,</span>&nbsp;<span class="string" id="3842074">&#34;application/octet-stream&#34;</span><span class="op" id="3842100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842103">return</span>&nbsp;<span class="ident" id="3842110">w</span><span class="op" id="3842111">.</span><span class="ident" id="3842112">CreatePart</span><span class="op" id="3842122">(</span><span class="ident" id="3842123">h</span><span class="op" id="3842124">)</span><br>
<span class="lineno">130</span><span class="op" id="3842126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3842129">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3842189">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3842210">func</span>&nbsp;<span class="op" id="3842215">(</span><span class="ident" id="3842216">w</span>&nbsp;<span class="op" id="3842218">*</span><span class="ident" id="3842219">Writer</span><span class="op" id="3842225">)</span>&nbsp;<span class="ident" id="3842227">CreateFormField</span><span class="op" id="3842242">(</span><span class="ident" id="3842243">fieldname</span>&nbsp;<span class="builtintype" id="3842253">string</span><span class="op" id="3842259">)</span>&nbsp;<span class="op" id="3842261">(</span><span class="ident" id="3842262">io</span><span class="op" id="3842264">.</span><span class="ident" id="3842265">Writer</span><span class="op" id="3842271">,</span>&nbsp;<span class="builtintype" id="3842273">error</span><span class="op" id="3842278">)</span>&nbsp;<span class="op" id="3842280">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842283">h</span>&nbsp;<span class="op" id="3842285">:=</span>&nbsp;<span class="builtinfunc" id="3842288">make</span><span class="op" id="3842292">(</span><span class="ident" id="3842293">textproto</span><span class="op" id="3842302">.</span><span class="ident" id="3842303">MIMEHeader</span><span class="op" id="3842313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842316">h</span><span class="op" id="3842317">.</span><span class="ident" id="3842318">Set</span><span class="op" id="3842321">(</span><span class="string" id="3842322">&#34;Content-Disposition&#34;</span><span class="op" id="3842343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842347">fmt</span><span class="op" id="3842350">.</span><span class="ident" id="3842351">Sprintf</span><span class="op" id="3842358">(</span><span class="string" id="3842359">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="3842381">,</span>&nbsp;<span class="ident" id="3842383">escapeQuotes</span><span class="op" id="3842395">(</span><span class="ident" id="3842396">fieldname</span><span class="op" id="3842405">)</span><span class="op" id="3842406">)</span><span class="op" id="3842407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842410">return</span>&nbsp;<span class="ident" id="3842417">w</span><span class="op" id="3842418">.</span><span class="ident" id="3842419">CreatePart</span><span class="op" id="3842429">(</span><span class="ident" id="3842430">h</span><span class="op" id="3842431">)</span><br>
<span class="lineno"></span><span class="op" id="3842433">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3842436">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3842505">func</span>&nbsp;<span class="op" id="3842510">(</span><span class="ident" id="3842511">w</span>&nbsp;<span class="op" id="3842513">*</span><span class="ident" id="3842514">Writer</span><span class="op" id="3842520">)</span>&nbsp;<span class="ident" id="3842522">WriteField</span><span class="op" id="3842532">(</span><span class="ident" id="3842533">fieldname</span><span class="op" id="3842542">,</span>&nbsp;<span class="ident" id="3842544">value</span>&nbsp;<span class="builtintype" id="3842550">string</span><span class="op" id="3842556">)</span>&nbsp;<span class="builtintype" id="3842558">error</span>&nbsp;<span class="op" id="3842564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842567">p</span><span class="op" id="3842568">,</span>&nbsp;<span class="ident" id="3842570">err</span>&nbsp;<span class="op" id="3842574">:=</span>&nbsp;<span class="ident" id="3842577">w</span><span class="op" id="3842578">.</span><span class="ident" id="3842579">CreateFormField</span><span class="op" id="3842594">(</span><span class="ident" id="3842595">fieldname</span><span class="op" id="3842604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842607">if</span>&nbsp;<span class="ident" id="3842610">err</span>&nbsp;<span class="op" id="3842614">!=</span>&nbsp;<span class="ident" id="3842617">nil</span>&nbsp;<span class="op" id="3842621">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842625">return</span>&nbsp;<span class="ident" id="3842632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3842637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842640">_</span><span class="op" id="3842641">,</span>&nbsp;<span class="ident" id="3842643">err</span>&nbsp;<span class="op" id="3842647">=</span>&nbsp;<span class="ident" id="3842649">p</span><span class="op" id="3842650">.</span><span class="ident" id="3842651">Write</span><span class="op" id="3842656">(</span><span class="op" id="3842657">[</span><span class="op" id="3842658">]</span><span class="builtintype" id="3842659">byte</span><span class="op" id="3842663">(</span><span class="ident" id="3842664">value</span><span class="op" id="3842669">)</span><span class="op" id="3842670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842673">return</span>&nbsp;<span class="ident" id="3842680">err</span><br>
<span class="lineno"></span><span class="op" id="3842684">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3842687">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3842751">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3842787">func</span>&nbsp;<span class="op" id="3842792">(</span><span class="ident" id="3842793">w</span>&nbsp;<span class="op" id="3842795">*</span><span class="ident" id="3842796">Writer</span><span class="op" id="3842802">)</span>&nbsp;<span class="ident" id="3842804">Close</span><span class="op" id="3842809">(</span><span class="op" id="3842810">)</span>&nbsp;<span class="builtintype" id="3842812">error</span>&nbsp;<span class="op" id="3842818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842821">if</span>&nbsp;<span class="ident" id="3842824">w</span><span class="op" id="3842825">.</span><span class="ident" id="3842826">lastpart</span>&nbsp;<span class="op" id="3842835">!=</span>&nbsp;<span class="ident" id="3842838">nil</span>&nbsp;<span class="op" id="3842842">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842846">if</span>&nbsp;<span class="ident" id="3842849">err</span>&nbsp;<span class="op" id="3842853">:=</span>&nbsp;<span class="ident" id="3842856">w</span><span class="op" id="3842857">.</span><span class="ident" id="3842858">lastpart</span><span class="op" id="3842866">.</span><span class="builtinfunc" id="3842867">close</span><span class="op" id="3842872">(</span><span class="op" id="3842873">)</span><span class="op" id="3842874">;</span>&nbsp;<span class="ident" id="3842876">err</span>&nbsp;<span class="op" id="3842880">!=</span>&nbsp;<span class="ident" id="3842883">nil</span>&nbsp;<span class="op" id="3842887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842892">return</span>&nbsp;<span class="ident" id="3842899">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3842905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842909">w</span><span class="op" id="3842910">.</span><span class="ident" id="3842911">lastpart</span>&nbsp;<span class="op" id="3842920">=</span>&nbsp;<span class="ident" id="3842922">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3842927">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842930">_</span><span class="op" id="3842931">,</span>&nbsp;<span class="ident" id="3842933">err</span>&nbsp;<span class="op" id="3842937">:=</span>&nbsp;<span class="ident" id="3842940">fmt</span><span class="op" id="3842943">.</span><span class="ident" id="3842944">Fprintf</span><span class="op" id="3842951">(</span><span class="ident" id="3842952">w</span><span class="op" id="3842953">.</span><span class="ident" id="3842954">w</span><span class="op" id="3842955">,</span>&nbsp;<span class="string" id="3842957">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="3842973">,</span>&nbsp;<span class="ident" id="3842975">w</span><span class="op" id="3842976">.</span><span class="ident" id="3842977">boundary</span><span class="op" id="3842985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842988">return</span>&nbsp;<span class="ident" id="3842995">err</span><br>
<span class="lineno"></span><span class="op" id="3842999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3843002">type</span>&nbsp;<span class="ident" id="3843007">part</span>&nbsp;<span class="keyword" id="3843012">struct</span>&nbsp;<span class="op" id="3843019">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843022">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3843029">*</span><span class="ident" id="3843030">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843038">closed</span>&nbsp;<span class="builtintype" id="3843045">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843051">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3843058">error</span>&nbsp;<span class="comment" id="3843064">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="3843100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3843103">func</span>&nbsp;<span class="op" id="3843108">(</span><span class="ident" id="3843109">p</span>&nbsp;<span class="op" id="3843111">*</span><span class="ident" id="3843112">part</span><span class="op" id="3843116">)</span>&nbsp;<span class="builtinfunc" id="3843118">close</span><span class="op" id="3843123">(</span><span class="op" id="3843124">)</span>&nbsp;<span class="builtintype" id="3843126">error</span>&nbsp;<span class="op" id="3843132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843135">p</span><span class="op" id="3843136">.</span><span class="ident" id="3843137">closed</span>&nbsp;<span class="op" id="3843144">=</span>&nbsp;<span class="builtintype" id="3843146">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3843152">return</span>&nbsp;<span class="ident" id="3843159">p</span><span class="op" id="3843160">.</span><span class="ident" id="3843161">we</span><br>
<span class="lineno"></span><span class="op" id="3843164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="3843167">func</span>&nbsp;<span class="op" id="3843172">(</span><span class="ident" id="3843173">p</span>&nbsp;<span class="op" id="3843175">*</span><span class="ident" id="3843176">part</span><span class="op" id="3843180">)</span>&nbsp;<span class="ident" id="3843182">Write</span><span class="op" id="3843187">(</span><span class="ident" id="3843188">d</span>&nbsp;<span class="op" id="3843190">[</span><span class="op" id="3843191">]</span><span class="builtintype" id="3843192">byte</span><span class="op" id="3843196">)</span>&nbsp;<span class="op" id="3843198">(</span><span class="ident" id="3843199">n</span>&nbsp;<span class="builtintype" id="3843201">int</span><span class="op" id="3843204">,</span>&nbsp;<span class="ident" id="3843206">err</span>&nbsp;<span class="builtintype" id="3843210">error</span><span class="op" id="3843215">)</span>&nbsp;<span class="op" id="3843217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3843220">if</span>&nbsp;<span class="ident" id="3843223">p</span><span class="op" id="3843224">.</span><span class="ident" id="3843225">closed</span>&nbsp;<span class="op" id="3843232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3843236">return</span>&nbsp;<span class="num" id="3843243">0</span><span class="op" id="3843244">,</span>&nbsp;<span class="ident" id="3843246">errors</span><span class="op" id="3843252">.</span><span class="ident" id="3843253">New</span><span class="op" id="3843256">(</span><span class="string" id="3843257">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="3843298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3843301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843304">n</span><span class="op" id="3843305">,</span>&nbsp;<span class="ident" id="3843307">err</span>&nbsp;<span class="op" id="3843311">=</span>&nbsp;<span class="ident" id="3843313">p</span><span class="op" id="3843314">.</span><span class="ident" id="3843315">mw</span><span class="op" id="3843317">.</span><span class="ident" id="3843318">w</span><span class="op" id="3843319">.</span><span class="ident" id="3843320">Write</span><span class="op" id="3843325">(</span><span class="ident" id="3843326">d</span><span class="op" id="3843327">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3843330">if</span>&nbsp;<span class="ident" id="3843333">err</span>&nbsp;<span class="op" id="3843337">!=</span>&nbsp;<span class="ident" id="3843340">nil</span>&nbsp;<span class="op" id="3843344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843348">p</span><span class="op" id="3843349">.</span><span class="ident" id="3843350">we</span>&nbsp;<span class="op" id="3843353">=</span>&nbsp;<span class="ident" id="3843355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3843360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3843363">return</span><br>
<span class="lineno"></span><span class="op" id="3843370">}</span>
</div>
</body>
</html>
