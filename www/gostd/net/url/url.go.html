<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3302767">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3302822">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3302876">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3302927">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3302985">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3303002">package</span>&nbsp;<span class="ident" id="3303010">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303015">import</span>&nbsp;<span class="op" id="3303022">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3303025">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3303034">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3303044">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3303052">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3303063">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3303073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3303076">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3303144">type</span>&nbsp;<span class="ident" id="3303149">Error</span>&nbsp;<span class="keyword" id="3303155">struct</span>&nbsp;<span class="op" id="3303162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303165">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3303169">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303177">URL</span>&nbsp;<span class="builtintype" id="3303181">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303189">Err</span>&nbsp;<span class="builtintype" id="3303193">error</span><br>
<span class="lineno"></span><span class="op" id="3303199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303202">func</span>&nbsp;<span class="op" id="3303207">(</span><span class="ident" id="3303208">e</span>&nbsp;<span class="op" id="3303210">*</span><span class="ident" id="3303211">Error</span><span class="op" id="3303216">)</span>&nbsp;<span class="ident" id="3303218">Error</span><span class="op" id="3303223">(</span><span class="op" id="3303224">)</span>&nbsp;<span class="builtintype" id="3303226">string</span>&nbsp;<span class="op" id="3303233">{</span>&nbsp;<span class="keyword" id="3303235">return</span>&nbsp;<span class="ident" id="3303242">e</span><span class="op" id="3303243">.</span><span class="ident" id="3303244">Op</span>&nbsp;<span class="op" id="3303247">+</span>&nbsp;<span class="string" id="3303249">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3303253">+</span>&nbsp;<span class="ident" id="3303255">e</span><span class="op" id="3303256">.</span><span class="ident" id="3303257">URL</span>&nbsp;<span class="op" id="3303261">+</span>&nbsp;<span class="string" id="3303263">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3303268">+</span>&nbsp;<span class="ident" id="3303270">e</span><span class="op" id="3303271">.</span><span class="ident" id="3303272">Err</span><span class="op" id="3303275">.</span><span class="ident" id="3303276">Error</span><span class="op" id="3303281">(</span><span class="op" id="3303282">)</span>&nbsp;<span class="op" id="3303284">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3303287">func</span>&nbsp;<span class="ident" id="3303292">ishex</span><span class="op" id="3303297">(</span><span class="ident" id="3303298">c</span>&nbsp;<span class="builtintype" id="3303300">byte</span><span class="op" id="3303304">)</span>&nbsp;<span class="builtintype" id="3303306">bool</span>&nbsp;<span class="op" id="3303311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303314">switch</span>&nbsp;<span class="op" id="3303321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303324">case</span>&nbsp;<span class="string" id="3303329">&#39;0&#39;</span>&nbsp;<span class="op" id="3303333">&lt;=</span>&nbsp;<span class="ident" id="3303336">c</span>&nbsp;<span class="op" id="3303338">&amp;&amp;</span>&nbsp;<span class="ident" id="3303341">c</span>&nbsp;<span class="op" id="3303343">&lt;=</span>&nbsp;<span class="string" id="3303346">&#39;9&#39;</span><span class="op" id="3303349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303353">return</span>&nbsp;<span class="builtintype" id="3303360">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303366">case</span>&nbsp;<span class="string" id="3303371">&#39;a&#39;</span>&nbsp;<span class="op" id="3303375">&lt;=</span>&nbsp;<span class="ident" id="3303378">c</span>&nbsp;<span class="op" id="3303380">&amp;&amp;</span>&nbsp;<span class="ident" id="3303383">c</span>&nbsp;<span class="op" id="3303385">&lt;=</span>&nbsp;<span class="string" id="3303388">&#39;f&#39;</span><span class="op" id="3303391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303395">return</span>&nbsp;<span class="builtintype" id="3303402">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303408">case</span>&nbsp;<span class="string" id="3303413">&#39;A&#39;</span>&nbsp;<span class="op" id="3303417">&lt;=</span>&nbsp;<span class="ident" id="3303420">c</span>&nbsp;<span class="op" id="3303422">&amp;&amp;</span>&nbsp;<span class="ident" id="3303425">c</span>&nbsp;<span class="op" id="3303427">&lt;=</span>&nbsp;<span class="string" id="3303430">&#39;F&#39;</span><span class="op" id="3303433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303437">return</span>&nbsp;<span class="builtintype" id="3303444">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303450">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303453">return</span>&nbsp;<span class="builtintype" id="3303460">false</span><br>
<span class="lineno"></span><span class="op" id="3303466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303469">func</span>&nbsp;<span class="ident" id="3303474">unhex</span><span class="op" id="3303479">(</span><span class="ident" id="3303480">c</span>&nbsp;<span class="builtintype" id="3303482">byte</span><span class="op" id="3303486">)</span>&nbsp;<span class="builtintype" id="3303488">byte</span>&nbsp;<span class="op" id="3303493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303496">switch</span>&nbsp;<span class="op" id="3303503">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303506">case</span>&nbsp;<span class="string" id="3303511">&#39;0&#39;</span>&nbsp;<span class="op" id="3303515">&lt;=</span>&nbsp;<span class="ident" id="3303518">c</span>&nbsp;<span class="op" id="3303520">&amp;&amp;</span>&nbsp;<span class="ident" id="3303523">c</span>&nbsp;<span class="op" id="3303525">&lt;=</span>&nbsp;<span class="string" id="3303528">&#39;9&#39;</span><span class="op" id="3303531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303535">return</span>&nbsp;<span class="ident" id="3303542">c</span>&nbsp;<span class="op" id="3303544">-</span>&nbsp;<span class="string" id="3303546">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303551">case</span>&nbsp;<span class="string" id="3303556">&#39;a&#39;</span>&nbsp;<span class="op" id="3303560">&lt;=</span>&nbsp;<span class="ident" id="3303563">c</span>&nbsp;<span class="op" id="3303565">&amp;&amp;</span>&nbsp;<span class="ident" id="3303568">c</span>&nbsp;<span class="op" id="3303570">&lt;=</span>&nbsp;<span class="string" id="3303573">&#39;f&#39;</span><span class="op" id="3303576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303580">return</span>&nbsp;<span class="ident" id="3303587">c</span>&nbsp;<span class="op" id="3303589">-</span>&nbsp;<span class="string" id="3303591">&#39;a&#39;</span>&nbsp;<span class="op" id="3303595">+</span>&nbsp;<span class="num" id="3303597">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303601">case</span>&nbsp;<span class="string" id="3303606">&#39;A&#39;</span>&nbsp;<span class="op" id="3303610">&lt;=</span>&nbsp;<span class="ident" id="3303613">c</span>&nbsp;<span class="op" id="3303615">&amp;&amp;</span>&nbsp;<span class="ident" id="3303618">c</span>&nbsp;<span class="op" id="3303620">&lt;=</span>&nbsp;<span class="string" id="3303623">&#39;F&#39;</span><span class="op" id="3303626">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303630">return</span>&nbsp;<span class="ident" id="3303637">c</span>&nbsp;<span class="op" id="3303639">-</span>&nbsp;<span class="string" id="3303641">&#39;A&#39;</span>&nbsp;<span class="op" id="3303645">+</span>&nbsp;<span class="num" id="3303647">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303654">return</span>&nbsp;<span class="num" id="3303661">0</span><br>
<span class="lineno"></span><span class="op" id="3303663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3303666">type</span>&nbsp;<span class="ident" id="3303671">encoding</span>&nbsp;<span class="builtintype" id="3303680">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303685">const</span>&nbsp;<span class="op" id="3303691">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303694">encodePath</span>&nbsp;<span class="ident" id="3303705">encoding</span>&nbsp;<span class="op" id="3303714">=</span>&nbsp;<span class="num" id="3303716">1</span>&nbsp;<span class="op" id="3303718">+</span>&nbsp;<span class="ident" id="3303720">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303726">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303746">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303768">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3303783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303786">type</span>&nbsp;<span class="ident" id="3303791">EscapeError</span>&nbsp;<span class="builtintype" id="3303803">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3303811">func</span>&nbsp;<span class="op" id="3303816">(</span><span class="ident" id="3303817">e</span>&nbsp;<span class="ident" id="3303819">EscapeError</span><span class="op" id="3303830">)</span>&nbsp;<span class="ident" id="3303832">Error</span><span class="op" id="3303837">(</span><span class="op" id="3303838">)</span>&nbsp;<span class="builtintype" id="3303840">string</span>&nbsp;<span class="op" id="3303847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303850">return</span>&nbsp;<span class="string" id="3303857">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3303879">+</span>&nbsp;<span class="ident" id="3303881">strconv</span><span class="op" id="3303888">.</span><span class="ident" id="3303889">Quote</span><span class="op" id="3303894">(</span><span class="builtintype" id="3303895">string</span><span class="op" id="3303901">(</span><span class="ident" id="3303902">e</span><span class="op" id="3303903">)</span><span class="op" id="3303904">)</span><br>
<span class="lineno"></span><span class="op" id="3303906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3303909">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3303974">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3304027">func</span>&nbsp;<span class="ident" id="3304032">shouldEscape</span><span class="op" id="3304044">(</span><span class="ident" id="3304045">c</span>&nbsp;<span class="builtintype" id="3304047">byte</span><span class="op" id="3304051">,</span>&nbsp;<span class="ident" id="3304053">mode</span>&nbsp;<span class="ident" id="3304058">encoding</span><span class="op" id="3304066">)</span>&nbsp;<span class="builtintype" id="3304068">bool</span>&nbsp;<span class="op" id="3304073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304076">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304119">if</span>&nbsp;<span class="string" id="3304122">&#39;A&#39;</span>&nbsp;<span class="op" id="3304126">&lt;=</span>&nbsp;<span class="ident" id="3304129">c</span>&nbsp;<span class="op" id="3304131">&amp;&amp;</span>&nbsp;<span class="ident" id="3304134">c</span>&nbsp;<span class="op" id="3304136">&lt;=</span>&nbsp;<span class="string" id="3304139">&#39;Z&#39;</span>&nbsp;<span class="op" id="3304143">||</span>&nbsp;<span class="string" id="3304146">&#39;a&#39;</span>&nbsp;<span class="op" id="3304150">&lt;=</span>&nbsp;<span class="ident" id="3304153">c</span>&nbsp;<span class="op" id="3304155">&amp;&amp;</span>&nbsp;<span class="ident" id="3304158">c</span>&nbsp;<span class="op" id="3304160">&lt;=</span>&nbsp;<span class="string" id="3304163">&#39;z&#39;</span>&nbsp;<span class="op" id="3304167">||</span>&nbsp;<span class="string" id="3304170">&#39;0&#39;</span>&nbsp;<span class="op" id="3304174">&lt;=</span>&nbsp;<span class="ident" id="3304177">c</span>&nbsp;<span class="op" id="3304179">&amp;&amp;</span>&nbsp;<span class="ident" id="3304182">c</span>&nbsp;<span class="op" id="3304184">&lt;=</span>&nbsp;<span class="string" id="3304187">&#39;9&#39;</span>&nbsp;<span class="op" id="3304191">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304195">return</span>&nbsp;<span class="builtintype" id="3304202">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304213">switch</span>&nbsp;<span class="ident" id="3304220">c</span>&nbsp;<span class="op" id="3304222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304225">case</span>&nbsp;<span class="string" id="3304230">&#39;-&#39;</span><span class="op" id="3304233">,</span>&nbsp;<span class="string" id="3304235">&#39;_&#39;</span><span class="op" id="3304238">,</span>&nbsp;<span class="string" id="3304240">&#39;.&#39;</span><span class="op" id="3304243">,</span>&nbsp;<span class="string" id="3304245">&#39;~&#39;</span><span class="op" id="3304248">:</span>&nbsp;<span class="comment" id="3304250">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304290">return</span>&nbsp;<span class="builtintype" id="3304297">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304305">case</span>&nbsp;<span class="string" id="3304310">&#39;$&#39;</span><span class="op" id="3304313">,</span>&nbsp;<span class="string" id="3304315">&#39;&amp;&#39;</span><span class="op" id="3304318">,</span>&nbsp;<span class="string" id="3304320">&#39;+&#39;</span><span class="op" id="3304323">,</span>&nbsp;<span class="string" id="3304325">&#39;,&#39;</span><span class="op" id="3304328">,</span>&nbsp;<span class="string" id="3304330">&#39;/&#39;</span><span class="op" id="3304333">,</span>&nbsp;<span class="string" id="3304335">&#39;:&#39;</span><span class="op" id="3304338">,</span>&nbsp;<span class="string" id="3304340">&#39;;&#39;</span><span class="op" id="3304343">,</span>&nbsp;<span class="string" id="3304345">&#39;=&#39;</span><span class="op" id="3304348">,</span>&nbsp;<span class="string" id="3304350">&#39;?&#39;</span><span class="op" id="3304353">,</span>&nbsp;<span class="string" id="3304355">&#39;@&#39;</span><span class="op" id="3304358">:</span>&nbsp;<span class="comment" id="3304360">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304402">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304452">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304502">switch</span>&nbsp;<span class="ident" id="3304509">mode</span>&nbsp;<span class="op" id="3304514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304518">case</span>&nbsp;<span class="ident" id="3304523">encodePath</span><span class="op" id="3304533">:</span>&nbsp;<span class="comment" id="3304535">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304547">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304610">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304666">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304728">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304782">return</span>&nbsp;<span class="ident" id="3304789">c</span>&nbsp;<span class="op" id="3304791">==</span>&nbsp;<span class="string" id="3304794">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304801">case</span>&nbsp;<span class="ident" id="3304806">encodeUserPassword</span><span class="op" id="3304824">:</span>&nbsp;<span class="comment" id="3304826">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304840">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304902">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304960">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305030">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305046">return</span>&nbsp;<span class="ident" id="3305053">c</span>&nbsp;<span class="op" id="3305055">==</span>&nbsp;<span class="string" id="3305058">&#39;@&#39;</span>&nbsp;<span class="op" id="3305062">||</span>&nbsp;<span class="ident" id="3305065">c</span>&nbsp;<span class="op" id="3305067">==</span>&nbsp;<span class="string" id="3305070">&#39;/&#39;</span>&nbsp;<span class="op" id="3305074">||</span>&nbsp;<span class="ident" id="3305077">c</span>&nbsp;<span class="op" id="3305079">==</span>&nbsp;<span class="string" id="3305082">&#39;?&#39;</span>&nbsp;<span class="op" id="3305086">||</span>&nbsp;<span class="ident" id="3305089">c</span>&nbsp;<span class="op" id="3305091">==</span>&nbsp;<span class="string" id="3305094">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305101">case</span>&nbsp;<span class="ident" id="3305106">encodeQueryComponent</span><span class="op" id="3305126">:</span>&nbsp;<span class="comment" id="3305128">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305140">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305195">return</span>&nbsp;<span class="builtintype" id="3305202">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305210">case</span>&nbsp;<span class="ident" id="3305215">encodeFragment</span><span class="op" id="3305229">:</span>&nbsp;<span class="comment" id="3305231">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305243">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305295">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305332">return</span>&nbsp;<span class="builtintype" id="3305339">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3305347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3305350">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305354">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305391">return</span>&nbsp;<span class="builtintype" id="3305398">true</span><br>
<span class="lineno"></span><span class="op" id="3305403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3305406">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3305482">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3305557">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3305609">func</span>&nbsp;<span class="ident" id="3305614">QueryUnescape</span><span class="op" id="3305627">(</span><span class="ident" id="3305628">s</span>&nbsp;<span class="builtintype" id="3305630">string</span><span class="op" id="3305636">)</span>&nbsp;<span class="op" id="3305638">(</span><span class="builtintype" id="3305639">string</span><span class="op" id="3305645">,</span>&nbsp;<span class="builtintype" id="3305647">error</span><span class="op" id="3305652">)</span>&nbsp;<span class="op" id="3305654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305657">return</span>&nbsp;<span class="ident" id="3305664">unescape</span><span class="op" id="3305672">(</span><span class="ident" id="3305673">s</span><span class="op" id="3305674">,</span>&nbsp;<span class="ident" id="3305676">encodeQueryComponent</span><span class="op" id="3305696">)</span><br>
<span class="lineno">115</span><span class="op" id="3305698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3305701">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3305752">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3305807">func</span>&nbsp;<span class="ident" id="3305812">unescape</span><span class="op" id="3305820">(</span><span class="ident" id="3305821">s</span>&nbsp;<span class="builtintype" id="3305823">string</span><span class="op" id="3305829">,</span>&nbsp;<span class="ident" id="3305831">mode</span>&nbsp;<span class="ident" id="3305836">encoding</span><span class="op" id="3305844">)</span>&nbsp;<span class="op" id="3305846">(</span><span class="builtintype" id="3305847">string</span><span class="op" id="3305853">,</span>&nbsp;<span class="builtintype" id="3305855">error</span><span class="op" id="3305860">)</span>&nbsp;<span class="op" id="3305862">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305865">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305910">n</span>&nbsp;<span class="op" id="3305912">:=</span>&nbsp;<span class="num" id="3305915">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305918">hasPlus</span>&nbsp;<span class="op" id="3305926">:=</span>&nbsp;<span class="builtintype" id="3305929">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305936">for</span>&nbsp;<span class="ident" id="3305940">i</span>&nbsp;<span class="op" id="3305942">:=</span>&nbsp;<span class="num" id="3305945">0</span><span class="op" id="3305946">;</span>&nbsp;<span class="ident" id="3305948">i</span>&nbsp;<span class="op" id="3305950">&lt;</span>&nbsp;<span class="builtinfunc" id="3305952">len</span><span class="op" id="3305955">(</span><span class="ident" id="3305956">s</span><span class="op" id="3305957">)</span><span class="op" id="3305958">;</span>&nbsp;<span class="op" id="3305960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305964">switch</span>&nbsp;<span class="ident" id="3305971">s</span><span class="op" id="3305972">[</span><span class="ident" id="3305973">i</span><span class="op" id="3305974">]</span>&nbsp;<span class="op" id="3305976">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305980">case</span>&nbsp;<span class="string" id="3305985">&#39;%&#39;</span><span class="op" id="3305988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305993">n</span><span class="op" id="3305994">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306000">if</span>&nbsp;<span class="ident" id="3306003">i</span><span class="op" id="3306004">+</span><span class="num" id="3306005">2</span>&nbsp;<span class="op" id="3306007">&gt;=</span>&nbsp;<span class="builtinfunc" id="3306010">len</span><span class="op" id="3306013">(</span><span class="ident" id="3306014">s</span><span class="op" id="3306015">)</span>&nbsp;<span class="op" id="3306017">||</span>&nbsp;<span class="op" id="3306020">!</span><span class="ident" id="3306021">ishex</span><span class="op" id="3306026">(</span><span class="ident" id="3306027">s</span><span class="op" id="3306028">[</span><span class="ident" id="3306029">i</span><span class="op" id="3306030">+</span><span class="num" id="3306031">1</span><span class="op" id="3306032">]</span><span class="op" id="3306033">)</span>&nbsp;<span class="op" id="3306035">||</span>&nbsp;<span class="op" id="3306038">!</span><span class="ident" id="3306039">ishex</span><span class="op" id="3306044">(</span><span class="ident" id="3306045">s</span><span class="op" id="3306046">[</span><span class="ident" id="3306047">i</span><span class="op" id="3306048">+</span><span class="num" id="3306049">2</span><span class="op" id="3306050">]</span><span class="op" id="3306051">)</span>&nbsp;<span class="op" id="3306053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306059">s</span>&nbsp;<span class="op" id="3306061">=</span>&nbsp;<span class="ident" id="3306063">s</span><span class="op" id="3306064">[</span><span class="ident" id="3306065">i</span><span class="op" id="3306066">:</span><span class="op" id="3306067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306073">if</span>&nbsp;<span class="builtinfunc" id="3306076">len</span><span class="op" id="3306079">(</span><span class="ident" id="3306080">s</span><span class="op" id="3306081">)</span>&nbsp;<span class="op" id="3306083">&gt;</span>&nbsp;<span class="num" id="3306085">3</span>&nbsp;<span class="op" id="3306087">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306094">s</span>&nbsp;<span class="op" id="3306096">=</span>&nbsp;<span class="ident" id="3306098">s</span><span class="op" id="3306099">[</span><span class="num" id="3306100">0</span><span class="op" id="3306101">:</span><span class="num" id="3306102">3</span><span class="op" id="3306103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306115">return</span>&nbsp;<span class="string" id="3306122">&#34;&#34;</span><span class="op" id="3306124">,</span>&nbsp;<span class="ident" id="3306126">EscapeError</span><span class="op" id="3306137">(</span><span class="ident" id="3306138">s</span><span class="op" id="3306139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306149">i</span>&nbsp;<span class="op" id="3306151">+=</span>&nbsp;<span class="num" id="3306154">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306158">case</span>&nbsp;<span class="string" id="3306163">&#39;+&#39;</span><span class="op" id="3306166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306171">hasPlus</span>&nbsp;<span class="op" id="3306179">=</span>&nbsp;<span class="ident" id="3306181">mode</span>&nbsp;<span class="op" id="3306186">==</span>&nbsp;<span class="ident" id="3306189">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306213">i</span><span class="op" id="3306214">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306219">default</span><span class="op" id="3306226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306231">i</span><span class="op" id="3306232">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306244">if</span>&nbsp;<span class="ident" id="3306247">n</span>&nbsp;<span class="op" id="3306249">==</span>&nbsp;<span class="num" id="3306252">0</span>&nbsp;<span class="op" id="3306254">&amp;&amp;</span>&nbsp;<span class="op" id="3306257">!</span><span class="ident" id="3306258">hasPlus</span>&nbsp;<span class="op" id="3306266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306270">return</span>&nbsp;<span class="ident" id="3306277">s</span><span class="op" id="3306278">,</span>&nbsp;<span class="builtintype" id="3306280">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306289">t</span>&nbsp;<span class="op" id="3306291">:=</span>&nbsp;<span class="builtinfunc" id="3306294">make</span><span class="op" id="3306298">(</span><span class="op" id="3306299">[</span><span class="op" id="3306300">]</span><span class="builtintype" id="3306301">byte</span><span class="op" id="3306305">,</span>&nbsp;<span class="builtinfunc" id="3306307">len</span><span class="op" id="3306310">(</span><span class="ident" id="3306311">s</span><span class="op" id="3306312">)</span><span class="op" id="3306313">-</span><span class="num" id="3306314">2</span><span class="op" id="3306315">*</span><span class="ident" id="3306316">n</span><span class="op" id="3306317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306320">j</span>&nbsp;<span class="op" id="3306322">:=</span>&nbsp;<span class="num" id="3306325">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306328">for</span>&nbsp;<span class="ident" id="3306332">i</span>&nbsp;<span class="op" id="3306334">:=</span>&nbsp;<span class="num" id="3306337">0</span><span class="op" id="3306338">;</span>&nbsp;<span class="ident" id="3306340">i</span>&nbsp;<span class="op" id="3306342">&lt;</span>&nbsp;<span class="builtinfunc" id="3306344">len</span><span class="op" id="3306347">(</span><span class="ident" id="3306348">s</span><span class="op" id="3306349">)</span><span class="op" id="3306350">;</span>&nbsp;<span class="op" id="3306352">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306356">switch</span>&nbsp;<span class="ident" id="3306363">s</span><span class="op" id="3306364">[</span><span class="ident" id="3306365">i</span><span class="op" id="3306366">]</span>&nbsp;<span class="op" id="3306368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306372">case</span>&nbsp;<span class="string" id="3306377">&#39;%&#39;</span><span class="op" id="3306380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306385">t</span><span class="op" id="3306386">[</span><span class="ident" id="3306387">j</span><span class="op" id="3306388">]</span>&nbsp;<span class="op" id="3306390">=</span>&nbsp;<span class="ident" id="3306392">unhex</span><span class="op" id="3306397">(</span><span class="ident" id="3306398">s</span><span class="op" id="3306399">[</span><span class="ident" id="3306400">i</span><span class="op" id="3306401">+</span><span class="num" id="3306402">1</span><span class="op" id="3306403">]</span><span class="op" id="3306404">)</span><span class="op" id="3306405">&lt;&lt;</span><span class="num" id="3306407">4</span>&nbsp;<span class="op" id="3306409">|</span>&nbsp;<span class="ident" id="3306411">unhex</span><span class="op" id="3306416">(</span><span class="ident" id="3306417">s</span><span class="op" id="3306418">[</span><span class="ident" id="3306419">i</span><span class="op" id="3306420">+</span><span class="num" id="3306421">2</span><span class="op" id="3306422">]</span><span class="op" id="3306423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306428">j</span><span class="op" id="3306429">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306435">i</span>&nbsp;<span class="op" id="3306437">+=</span>&nbsp;<span class="num" id="3306440">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306444">case</span>&nbsp;<span class="string" id="3306449">&#39;+&#39;</span><span class="op" id="3306452">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306457">if</span>&nbsp;<span class="ident" id="3306460">mode</span>&nbsp;<span class="op" id="3306465">==</span>&nbsp;<span class="ident" id="3306468">encodeQueryComponent</span>&nbsp;<span class="op" id="3306489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306495">t</span><span class="op" id="3306496">[</span><span class="ident" id="3306497">j</span><span class="op" id="3306498">]</span>&nbsp;<span class="op" id="3306500">=</span>&nbsp;<span class="string" id="3306502">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306509">}</span>&nbsp;<span class="keyword" id="3306511">else</span>&nbsp;<span class="op" id="3306516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306522">t</span><span class="op" id="3306523">[</span><span class="ident" id="3306524">j</span><span class="op" id="3306525">]</span>&nbsp;<span class="op" id="3306527">=</span>&nbsp;<span class="string" id="3306529">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306541">j</span><span class="op" id="3306542">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306548">i</span><span class="op" id="3306549">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306554">default</span><span class="op" id="3306561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306566">t</span><span class="op" id="3306567">[</span><span class="ident" id="3306568">j</span><span class="op" id="3306569">]</span>&nbsp;<span class="op" id="3306571">=</span>&nbsp;<span class="ident" id="3306573">s</span><span class="op" id="3306574">[</span><span class="ident" id="3306575">i</span><span class="op" id="3306576">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306581">j</span><span class="op" id="3306582">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306588">i</span><span class="op" id="3306589">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306600">return</span>&nbsp;<span class="builtintype" id="3306607">string</span><span class="op" id="3306613">(</span><span class="ident" id="3306614">t</span><span class="op" id="3306615">)</span><span class="op" id="3306616">,</span>&nbsp;<span class="builtintype" id="3306618">nil</span><br>
<span class="lineno">170</span><span class="op" id="3306622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3306625">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3306686">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3306709">func</span>&nbsp;<span class="ident" id="3306714">QueryEscape</span><span class="op" id="3306725">(</span><span class="ident" id="3306726">s</span>&nbsp;<span class="builtintype" id="3306728">string</span><span class="op" id="3306734">)</span>&nbsp;<span class="builtintype" id="3306736">string</span>&nbsp;<span class="op" id="3306743">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306746">return</span>&nbsp;<span class="ident" id="3306753">escape</span><span class="op" id="3306759">(</span><span class="ident" id="3306760">s</span><span class="op" id="3306761">,</span>&nbsp;<span class="ident" id="3306763">encodeQueryComponent</span><span class="op" id="3306783">)</span><br>
<span class="lineno"></span><span class="op" id="3306785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3306788">func</span>&nbsp;<span class="ident" id="3306793">escape</span><span class="op" id="3306799">(</span><span class="ident" id="3306800">s</span>&nbsp;<span class="builtintype" id="3306802">string</span><span class="op" id="3306808">,</span>&nbsp;<span class="ident" id="3306810">mode</span>&nbsp;<span class="ident" id="3306815">encoding</span><span class="op" id="3306823">)</span>&nbsp;<span class="builtintype" id="3306825">string</span>&nbsp;<span class="op" id="3306832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306835">spaceCount</span><span class="op" id="3306845">,</span>&nbsp;<span class="ident" id="3306847">hexCount</span>&nbsp;<span class="op" id="3306856">:=</span>&nbsp;<span class="num" id="3306859">0</span><span class="op" id="3306860">,</span>&nbsp;<span class="num" id="3306862">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306865">for</span>&nbsp;<span class="ident" id="3306869">i</span>&nbsp;<span class="op" id="3306871">:=</span>&nbsp;<span class="num" id="3306874">0</span><span class="op" id="3306875">;</span>&nbsp;<span class="ident" id="3306877">i</span>&nbsp;<span class="op" id="3306879">&lt;</span>&nbsp;<span class="builtinfunc" id="3306881">len</span><span class="op" id="3306884">(</span><span class="ident" id="3306885">s</span><span class="op" id="3306886">)</span><span class="op" id="3306887">;</span>&nbsp;<span class="ident" id="3306889">i</span><span class="op" id="3306890">++</span>&nbsp;<span class="op" id="3306893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306897">c</span>&nbsp;<span class="op" id="3306899">:=</span>&nbsp;<span class="ident" id="3306902">s</span><span class="op" id="3306903">[</span><span class="ident" id="3306904">i</span><span class="op" id="3306905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306909">if</span>&nbsp;<span class="ident" id="3306912">shouldEscape</span><span class="op" id="3306924">(</span><span class="ident" id="3306925">c</span><span class="op" id="3306926">,</span>&nbsp;<span class="ident" id="3306928">mode</span><span class="op" id="3306932">)</span>&nbsp;<span class="op" id="3306934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306939">if</span>&nbsp;<span class="ident" id="3306942">c</span>&nbsp;<span class="op" id="3306944">==</span>&nbsp;<span class="string" id="3306947">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3306951">&amp;&amp;</span>&nbsp;<span class="ident" id="3306954">mode</span>&nbsp;<span class="op" id="3306959">==</span>&nbsp;<span class="ident" id="3306962">encodeQueryComponent</span>&nbsp;<span class="op" id="3306983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306989">spaceCount</span><span class="op" id="3306999">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307005">}</span>&nbsp;<span class="keyword" id="3307007">else</span>&nbsp;<span class="op" id="3307012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307018">hexCount</span><span class="op" id="3307026">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307039">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307043">if</span>&nbsp;<span class="ident" id="3307046">spaceCount</span>&nbsp;<span class="op" id="3307057">==</span>&nbsp;<span class="num" id="3307060">0</span>&nbsp;<span class="op" id="3307062">&amp;&amp;</span>&nbsp;<span class="ident" id="3307065">hexCount</span>&nbsp;<span class="op" id="3307074">==</span>&nbsp;<span class="num" id="3307077">0</span>&nbsp;<span class="op" id="3307079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307083">return</span>&nbsp;<span class="ident" id="3307090">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307097">t</span>&nbsp;<span class="op" id="3307099">:=</span>&nbsp;<span class="builtinfunc" id="3307102">make</span><span class="op" id="3307106">(</span><span class="op" id="3307107">[</span><span class="op" id="3307108">]</span><span class="builtintype" id="3307109">byte</span><span class="op" id="3307113">,</span>&nbsp;<span class="builtinfunc" id="3307115">len</span><span class="op" id="3307118">(</span><span class="ident" id="3307119">s</span><span class="op" id="3307120">)</span><span class="op" id="3307121">+</span><span class="num" id="3307122">2</span><span class="op" id="3307123">*</span><span class="ident" id="3307124">hexCount</span><span class="op" id="3307132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307135">j</span>&nbsp;<span class="op" id="3307137">:=</span>&nbsp;<span class="num" id="3307140">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307143">for</span>&nbsp;<span class="ident" id="3307147">i</span>&nbsp;<span class="op" id="3307149">:=</span>&nbsp;<span class="num" id="3307152">0</span><span class="op" id="3307153">;</span>&nbsp;<span class="ident" id="3307155">i</span>&nbsp;<span class="op" id="3307157">&lt;</span>&nbsp;<span class="builtinfunc" id="3307159">len</span><span class="op" id="3307162">(</span><span class="ident" id="3307163">s</span><span class="op" id="3307164">)</span><span class="op" id="3307165">;</span>&nbsp;<span class="ident" id="3307167">i</span><span class="op" id="3307168">++</span>&nbsp;<span class="op" id="3307171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307175">switch</span>&nbsp;<span class="ident" id="3307182">c</span>&nbsp;<span class="op" id="3307184">:=</span>&nbsp;<span class="ident" id="3307187">s</span><span class="op" id="3307188">[</span><span class="ident" id="3307189">i</span><span class="op" id="3307190">]</span><span class="op" id="3307191">;</span>&nbsp;<span class="op" id="3307193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307197">case</span>&nbsp;<span class="ident" id="3307202">c</span>&nbsp;<span class="op" id="3307204">==</span>&nbsp;<span class="string" id="3307207">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3307211">&amp;&amp;</span>&nbsp;<span class="ident" id="3307214">mode</span>&nbsp;<span class="op" id="3307219">==</span>&nbsp;<span class="ident" id="3307222">encodeQueryComponent</span><span class="op" id="3307242">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307247">t</span><span class="op" id="3307248">[</span><span class="ident" id="3307249">j</span><span class="op" id="3307250">]</span>&nbsp;<span class="op" id="3307252">=</span>&nbsp;<span class="string" id="3307254">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307261">j</span><span class="op" id="3307262">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307267">case</span>&nbsp;<span class="ident" id="3307272">shouldEscape</span><span class="op" id="3307284">(</span><span class="ident" id="3307285">c</span><span class="op" id="3307286">,</span>&nbsp;<span class="ident" id="3307288">mode</span><span class="op" id="3307292">)</span><span class="op" id="3307293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307298">t</span><span class="op" id="3307299">[</span><span class="ident" id="3307300">j</span><span class="op" id="3307301">]</span>&nbsp;<span class="op" id="3307303">=</span>&nbsp;<span class="string" id="3307305">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307312">t</span><span class="op" id="3307313">[</span><span class="ident" id="3307314">j</span><span class="op" id="3307315">+</span><span class="num" id="3307316">1</span><span class="op" id="3307317">]</span>&nbsp;<span class="op" id="3307319">=</span>&nbsp;<span class="string" id="3307321">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3307339">[</span><span class="ident" id="3307340">c</span><span class="op" id="3307341">&gt;&gt;</span><span class="num" id="3307343">4</span><span class="op" id="3307344">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307349">t</span><span class="op" id="3307350">[</span><span class="ident" id="3307351">j</span><span class="op" id="3307352">+</span><span class="num" id="3307353">2</span><span class="op" id="3307354">]</span>&nbsp;<span class="op" id="3307356">=</span>&nbsp;<span class="string" id="3307358">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3307376">[</span><span class="ident" id="3307377">c</span><span class="op" id="3307378">&amp;</span><span class="num" id="3307379">15</span><span class="op" id="3307381">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307386">j</span>&nbsp;<span class="op" id="3307388">+=</span>&nbsp;<span class="num" id="3307391">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307395">default</span><span class="op" id="3307402">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307407">t</span><span class="op" id="3307408">[</span><span class="ident" id="3307409">j</span><span class="op" id="3307410">]</span>&nbsp;<span class="op" id="3307412">=</span>&nbsp;<span class="ident" id="3307414">s</span><span class="op" id="3307415">[</span><span class="ident" id="3307416">i</span><span class="op" id="3307417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307422">j</span><span class="op" id="3307423">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307434">return</span>&nbsp;<span class="builtintype" id="3307441">string</span><span class="op" id="3307447">(</span><span class="ident" id="3307448">t</span><span class="op" id="3307449">)</span><br>
<span class="lineno"></span><span class="op" id="3307451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3307454">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3307519">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3307555">//</span><br>
<span class="lineno"></span><span class="comment" id="3307558">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3307610">//</span><br>
<span class="lineno">220</span><span class="comment" id="3307613">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3307689">//</span><br>
<span class="lineno"></span><span class="comment" id="3307692">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3307728">//</span><br>
<span class="lineno"></span><span class="comment" id="3307731">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3307811">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3307892">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3307976">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3308061">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3308140">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3308222">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3308276">type</span>&nbsp;<span class="ident" id="3308281">URL</span>&nbsp;<span class="keyword" id="3308285">struct</span>&nbsp;<span class="op" id="3308292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308295">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308304">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308312">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308321">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308331">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308355">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308364">*</span><span class="ident" id="3308365">Userinfo</span>&nbsp;<span class="comment" id="3308374">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308412">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308421">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308431">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308453">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308462">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308470">RawQuery</span>&nbsp;<span class="builtintype" id="3308479">string</span>&nbsp;<span class="comment" id="3308486">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308524">Fragment</span>&nbsp;<span class="builtintype" id="3308533">string</span>&nbsp;<span class="comment" id="3308540">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3308580">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3308583">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3308643">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3308667">func</span>&nbsp;<span class="ident" id="3308672">User</span><span class="op" id="3308676">(</span><span class="ident" id="3308677">username</span>&nbsp;<span class="builtintype" id="3308686">string</span><span class="op" id="3308692">)</span>&nbsp;<span class="op" id="3308694">*</span><span class="ident" id="3308695">Userinfo</span>&nbsp;<span class="op" id="3308704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308707">return</span>&nbsp;<span class="op" id="3308714">&amp;</span><span class="ident" id="3308715">Userinfo</span><span class="op" id="3308723">{</span><span class="ident" id="3308724">username</span><span class="op" id="3308732">,</span>&nbsp;<span class="string" id="3308734">&#34;&#34;</span><span class="op" id="3308736">,</span>&nbsp;<span class="builtintype" id="3308738">false</span><span class="op" id="3308743">}</span><br>
<span class="lineno">245</span><span class="op" id="3308745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3308748">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3308816">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3308833">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3308898">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3308952">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3309015">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3309077">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3309141">func</span>&nbsp;<span class="ident" id="3309146">UserPassword</span><span class="op" id="3309158">(</span><span class="ident" id="3309159">username</span><span class="op" id="3309167">,</span>&nbsp;<span class="ident" id="3309169">password</span>&nbsp;<span class="builtintype" id="3309178">string</span><span class="op" id="3309184">)</span>&nbsp;<span class="op" id="3309186">*</span><span class="ident" id="3309187">Userinfo</span>&nbsp;<span class="op" id="3309196">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309199">return</span>&nbsp;<span class="op" id="3309206">&amp;</span><span class="ident" id="3309207">Userinfo</span><span class="op" id="3309215">{</span><span class="ident" id="3309216">username</span><span class="op" id="3309224">,</span>&nbsp;<span class="ident" id="3309226">password</span><span class="op" id="3309234">,</span>&nbsp;<span class="builtintype" id="3309236">true</span><span class="op" id="3309240">}</span><br>
<span class="lineno"></span><span class="op" id="3309242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3309245">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3309312">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3309384">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3309455">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3309485">type</span>&nbsp;<span class="ident" id="3309490">Userinfo</span>&nbsp;<span class="keyword" id="3309499">struct</span>&nbsp;<span class="op" id="3309506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309509">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3309521">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309529">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3309541">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309549">passwordSet</span>&nbsp;<span class="builtintype" id="3309561">bool</span><br>
<span class="lineno"></span><span class="op" id="3309566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3309569">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3309603">func</span>&nbsp;<span class="op" id="3309608">(</span><span class="ident" id="3309609">u</span>&nbsp;<span class="op" id="3309611">*</span><span class="ident" id="3309612">Userinfo</span><span class="op" id="3309620">)</span>&nbsp;<span class="ident" id="3309622">Username</span><span class="op" id="3309630">(</span><span class="op" id="3309631">)</span>&nbsp;<span class="builtintype" id="3309633">string</span>&nbsp;<span class="op" id="3309640">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309643">return</span>&nbsp;<span class="ident" id="3309650">u</span><span class="op" id="3309651">.</span><span class="ident" id="3309652">username</span><br>
<span class="lineno"></span><span class="op" id="3309661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3309664">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3309739">func</span>&nbsp;<span class="op" id="3309744">(</span><span class="ident" id="3309745">u</span>&nbsp;<span class="op" id="3309747">*</span><span class="ident" id="3309748">Userinfo</span><span class="op" id="3309756">)</span>&nbsp;<span class="ident" id="3309758">Password</span><span class="op" id="3309766">(</span><span class="op" id="3309767">)</span>&nbsp;<span class="op" id="3309769">(</span><span class="builtintype" id="3309770">string</span><span class="op" id="3309776">,</span>&nbsp;<span class="builtintype" id="3309778">bool</span><span class="op" id="3309782">)</span>&nbsp;<span class="op" id="3309784">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309787">if</span>&nbsp;<span class="ident" id="3309790">u</span><span class="op" id="3309791">.</span><span class="ident" id="3309792">passwordSet</span>&nbsp;<span class="op" id="3309804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309808">return</span>&nbsp;<span class="ident" id="3309815">u</span><span class="op" id="3309816">.</span><span class="ident" id="3309817">password</span><span class="op" id="3309825">,</span>&nbsp;<span class="builtintype" id="3309827">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309836">return</span>&nbsp;<span class="string" id="3309843">&#34;&#34;</span><span class="op" id="3309845">,</span>&nbsp;<span class="builtintype" id="3309847">false</span><br>
<span class="lineno"></span><span class="op" id="3309853">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3309856">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3309928">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3309957">func</span>&nbsp;<span class="op" id="3309962">(</span><span class="ident" id="3309963">u</span>&nbsp;<span class="op" id="3309965">*</span><span class="ident" id="3309966">Userinfo</span><span class="op" id="3309974">)</span>&nbsp;<span class="ident" id="3309976">String</span><span class="op" id="3309982">(</span><span class="op" id="3309983">)</span>&nbsp;<span class="builtintype" id="3309985">string</span>&nbsp;<span class="op" id="3309992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309995">s</span>&nbsp;<span class="op" id="3309997">:=</span>&nbsp;<span class="ident" id="3310000">escape</span><span class="op" id="3310006">(</span><span class="ident" id="3310007">u</span><span class="op" id="3310008">.</span><span class="ident" id="3310009">username</span><span class="op" id="3310017">,</span>&nbsp;<span class="ident" id="3310019">encodeUserPassword</span><span class="op" id="3310037">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310040">if</span>&nbsp;<span class="ident" id="3310043">u</span><span class="op" id="3310044">.</span><span class="ident" id="3310045">passwordSet</span>&nbsp;<span class="op" id="3310057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3310061">s</span>&nbsp;<span class="op" id="3310063">+=</span>&nbsp;<span class="string" id="3310066">&#34;:&#34;</span>&nbsp;<span class="op" id="3310070">+</span>&nbsp;<span class="ident" id="3310072">escape</span><span class="op" id="3310078">(</span><span class="ident" id="3310079">u</span><span class="op" id="3310080">.</span><span class="ident" id="3310081">password</span><span class="op" id="3310089">,</span>&nbsp;<span class="ident" id="3310091">encodeUserPassword</span><span class="op" id="3310109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3310112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310115">return</span>&nbsp;<span class="ident" id="3310122">s</span><br>
<span class="lineno"></span><span class="op" id="3310124">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3310127">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3310171">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3310215">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3310270">func</span>&nbsp;<span class="ident" id="3310275">getscheme</span><span class="op" id="3310284">(</span><span class="ident" id="3310285">rawurl</span>&nbsp;<span class="builtintype" id="3310292">string</span><span class="op" id="3310298">)</span>&nbsp;<span class="op" id="3310300">(</span><span class="ident" id="3310301">scheme</span><span class="op" id="3310307">,</span>&nbsp;<span class="ident" id="3310309">path</span>&nbsp;<span class="builtintype" id="3310314">string</span><span class="op" id="3310320">,</span>&nbsp;<span class="ident" id="3310322">err</span>&nbsp;<span class="builtintype" id="3310326">error</span><span class="op" id="3310331">)</span>&nbsp;<span class="op" id="3310333">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310336">for</span>&nbsp;<span class="ident" id="3310340">i</span>&nbsp;<span class="op" id="3310342">:=</span>&nbsp;<span class="num" id="3310345">0</span><span class="op" id="3310346">;</span>&nbsp;<span class="ident" id="3310348">i</span>&nbsp;<span class="op" id="3310350">&lt;</span>&nbsp;<span class="builtinfunc" id="3310352">len</span><span class="op" id="3310355">(</span><span class="ident" id="3310356">rawurl</span><span class="op" id="3310362">)</span><span class="op" id="3310363">;</span>&nbsp;<span class="ident" id="3310365">i</span><span class="op" id="3310366">++</span>&nbsp;<span class="op" id="3310369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3310373">c</span>&nbsp;<span class="op" id="3310375">:=</span>&nbsp;<span class="ident" id="3310378">rawurl</span><span class="op" id="3310384">[</span><span class="ident" id="3310385">i</span><span class="op" id="3310386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310390">switch</span>&nbsp;<span class="op" id="3310397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310401">case</span>&nbsp;<span class="string" id="3310406">&#39;a&#39;</span>&nbsp;<span class="op" id="3310410">&lt;=</span>&nbsp;<span class="ident" id="3310413">c</span>&nbsp;<span class="op" id="3310415">&amp;&amp;</span>&nbsp;<span class="ident" id="3310418">c</span>&nbsp;<span class="op" id="3310420">&lt;=</span>&nbsp;<span class="string" id="3310423">&#39;z&#39;</span>&nbsp;<span class="op" id="3310427">||</span>&nbsp;<span class="string" id="3310430">&#39;A&#39;</span>&nbsp;<span class="op" id="3310434">&lt;=</span>&nbsp;<span class="ident" id="3310437">c</span>&nbsp;<span class="op" id="3310439">&amp;&amp;</span>&nbsp;<span class="ident" id="3310442">c</span>&nbsp;<span class="op" id="3310444">&lt;=</span>&nbsp;<span class="string" id="3310447">&#39;Z&#39;</span><span class="op" id="3310450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3310454">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310470">case</span>&nbsp;<span class="string" id="3310475">&#39;0&#39;</span>&nbsp;<span class="op" id="3310479">&lt;=</span>&nbsp;<span class="ident" id="3310482">c</span>&nbsp;<span class="op" id="3310484">&amp;&amp;</span>&nbsp;<span class="ident" id="3310487">c</span>&nbsp;<span class="op" id="3310489">&lt;=</span>&nbsp;<span class="string" id="3310492">&#39;9&#39;</span>&nbsp;<span class="op" id="3310496">||</span>&nbsp;<span class="ident" id="3310499">c</span>&nbsp;<span class="op" id="3310501">==</span>&nbsp;<span class="string" id="3310504">&#39;+&#39;</span>&nbsp;<span class="op" id="3310508">||</span>&nbsp;<span class="ident" id="3310511">c</span>&nbsp;<span class="op" id="3310513">==</span>&nbsp;<span class="string" id="3310516">&#39;-&#39;</span>&nbsp;<span class="op" id="3310520">||</span>&nbsp;<span class="ident" id="3310523">c</span>&nbsp;<span class="op" id="3310525">==</span>&nbsp;<span class="string" id="3310528">&#39;.&#39;</span><span class="op" id="3310531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310536">if</span>&nbsp;<span class="ident" id="3310539">i</span>&nbsp;<span class="op" id="3310541">==</span>&nbsp;<span class="num" id="3310544">0</span>&nbsp;<span class="op" id="3310546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310552">return</span>&nbsp;<span class="string" id="3310559">&#34;&#34;</span><span class="op" id="3310561">,</span>&nbsp;<span class="ident" id="3310563">rawurl</span><span class="op" id="3310569">,</span>&nbsp;<span class="builtintype" id="3310571">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3310578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310582">case</span>&nbsp;<span class="ident" id="3310587">c</span>&nbsp;<span class="op" id="3310589">==</span>&nbsp;<span class="string" id="3310592">&#39;:&#39;</span><span class="op" id="3310595">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310600">if</span>&nbsp;<span class="ident" id="3310603">i</span>&nbsp;<span class="op" id="3310605">==</span>&nbsp;<span class="num" id="3310608">0</span>&nbsp;<span class="op" id="3310610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310616">return</span>&nbsp;<span class="string" id="3310623">&#34;&#34;</span><span class="op" id="3310625">,</span>&nbsp;<span class="string" id="3310627">&#34;&#34;</span><span class="op" id="3310629">,</span>&nbsp;<span class="ident" id="3310631">errors</span><span class="op" id="3310637">.</span><span class="ident" id="3310638">New</span><span class="op" id="3310641">(</span><span class="string" id="3310642">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3310667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3310672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310677">return</span>&nbsp;<span class="ident" id="3310684">rawurl</span><span class="op" id="3310690">[</span><span class="num" id="3310691">0</span><span class="op" id="3310692">:</span><span class="ident" id="3310693">i</span><span class="op" id="3310694">]</span><span class="op" id="3310695">,</span>&nbsp;<span class="ident" id="3310697">rawurl</span><span class="op" id="3310703">[</span><span class="ident" id="3310704">i</span><span class="op" id="3310705">+</span><span class="num" id="3310706">1</span><span class="op" id="3310707">:</span><span class="op" id="3310708">]</span><span class="op" id="3310709">,</span>&nbsp;<span class="builtintype" id="3310711">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310717">default</span><span class="op" id="3310724">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3310729">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3310777">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310811">return</span>&nbsp;<span class="string" id="3310818">&#34;&#34;</span><span class="op" id="3310820">,</span>&nbsp;<span class="ident" id="3310822">rawurl</span><span class="op" id="3310828">,</span>&nbsp;<span class="builtintype" id="3310830">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3310836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3310839">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3310842">return</span>&nbsp;<span class="string" id="3310849">&#34;&#34;</span><span class="op" id="3310851">,</span>&nbsp;<span class="ident" id="3310853">rawurl</span><span class="op" id="3310859">,</span>&nbsp;<span class="builtintype" id="3310861">nil</span><br>
<span class="lineno"></span><span class="op" id="3310865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310868">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3310901">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3310952">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3310977">func</span>&nbsp;<span class="ident" id="3310982">split</span><span class="op" id="3310987">(</span><span class="ident" id="3310988">s</span>&nbsp;<span class="builtintype" id="3310990">string</span><span class="op" id="3310996">,</span>&nbsp;<span class="ident" id="3310998">c</span>&nbsp;<span class="builtintype" id="3311000">string</span><span class="op" id="3311006">,</span>&nbsp;<span class="ident" id="3311008">cutc</span>&nbsp;<span class="builtintype" id="3311013">bool</span><span class="op" id="3311017">)</span>&nbsp;<span class="op" id="3311019">(</span><span class="builtintype" id="3311020">string</span><span class="op" id="3311026">,</span>&nbsp;<span class="builtintype" id="3311028">string</span><span class="op" id="3311034">)</span>&nbsp;<span class="op" id="3311036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3311039">i</span>&nbsp;<span class="op" id="3311041">:=</span>&nbsp;<span class="ident" id="3311044">strings</span><span class="op" id="3311051">.</span><span class="ident" id="3311052">Index</span><span class="op" id="3311057">(</span><span class="ident" id="3311058">s</span><span class="op" id="3311059">,</span>&nbsp;<span class="ident" id="3311061">c</span><span class="op" id="3311062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311065">if</span>&nbsp;<span class="ident" id="3311068">i</span>&nbsp;<span class="op" id="3311070">&lt;</span>&nbsp;<span class="num" id="3311072">0</span>&nbsp;<span class="op" id="3311074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311078">return</span>&nbsp;<span class="ident" id="3311085">s</span><span class="op" id="3311086">,</span>&nbsp;<span class="string" id="3311088">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3311092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311095">if</span>&nbsp;<span class="ident" id="3311098">cutc</span>&nbsp;<span class="op" id="3311103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311107">return</span>&nbsp;<span class="ident" id="3311114">s</span><span class="op" id="3311115">[</span><span class="num" id="3311116">0</span><span class="op" id="3311117">:</span><span class="ident" id="3311118">i</span><span class="op" id="3311119">]</span><span class="op" id="3311120">,</span>&nbsp;<span class="ident" id="3311122">s</span><span class="op" id="3311123">[</span><span class="ident" id="3311124">i</span><span class="op" id="3311125">+</span><span class="builtinfunc" id="3311126">len</span><span class="op" id="3311129">(</span><span class="ident" id="3311130">c</span><span class="op" id="3311131">)</span><span class="op" id="3311132">:</span><span class="op" id="3311133">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3311136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311139">return</span>&nbsp;<span class="ident" id="3311146">s</span><span class="op" id="3311147">[</span><span class="num" id="3311148">0</span><span class="op" id="3311149">:</span><span class="ident" id="3311150">i</span><span class="op" id="3311151">]</span><span class="op" id="3311152">,</span>&nbsp;<span class="ident" id="3311154">s</span><span class="op" id="3311155">[</span><span class="ident" id="3311156">i</span><span class="op" id="3311157">:</span><span class="op" id="3311158">]</span><br>
<span class="lineno">330</span><span class="op" id="3311160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311163">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3311208">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3311251">func</span>&nbsp;<span class="ident" id="3311256">Parse</span><span class="op" id="3311261">(</span><span class="ident" id="3311262">rawurl</span>&nbsp;<span class="builtintype" id="3311269">string</span><span class="op" id="3311275">)</span>&nbsp;<span class="op" id="3311277">(</span><span class="ident" id="3311278">url</span>&nbsp;<span class="op" id="3311282">*</span><span class="ident" id="3311283">URL</span><span class="op" id="3311286">,</span>&nbsp;<span class="ident" id="3311288">err</span>&nbsp;<span class="builtintype" id="3311292">error</span><span class="op" id="3311297">)</span>&nbsp;<span class="op" id="3311299">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3311302">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3311320">u</span><span class="op" id="3311321">,</span>&nbsp;<span class="ident" id="3311323">frag</span>&nbsp;<span class="op" id="3311328">:=</span>&nbsp;<span class="ident" id="3311331">split</span><span class="op" id="3311336">(</span><span class="ident" id="3311337">rawurl</span><span class="op" id="3311343">,</span>&nbsp;<span class="string" id="3311345">&#34;#&#34;</span><span class="op" id="3311348">,</span>&nbsp;<span class="builtintype" id="3311350">true</span><span class="op" id="3311354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311357">if</span>&nbsp;<span class="ident" id="3311360">url</span><span class="op" id="3311363">,</span>&nbsp;<span class="ident" id="3311365">err</span>&nbsp;<span class="op" id="3311369">=</span>&nbsp;<span class="ident" id="3311371">parse</span><span class="op" id="3311376">(</span><span class="ident" id="3311377">u</span><span class="op" id="3311378">,</span>&nbsp;<span class="builtintype" id="3311380">false</span><span class="op" id="3311385">)</span><span class="op" id="3311386">;</span>&nbsp;<span class="ident" id="3311388">err</span>&nbsp;<span class="op" id="3311392">!=</span>&nbsp;<span class="builtintype" id="3311395">nil</span>&nbsp;<span class="op" id="3311399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311403">return</span>&nbsp;<span class="builtintype" id="3311410">nil</span><span class="op" id="3311413">,</span>&nbsp;<span class="ident" id="3311415">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3311420">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311423">if</span>&nbsp;<span class="ident" id="3311426">frag</span>&nbsp;<span class="op" id="3311431">==</span>&nbsp;<span class="string" id="3311434">&#34;&#34;</span>&nbsp;<span class="op" id="3311437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311441">return</span>&nbsp;<span class="ident" id="3311448">url</span><span class="op" id="3311451">,</span>&nbsp;<span class="builtintype" id="3311453">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3311458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311461">if</span>&nbsp;<span class="ident" id="3311464">url</span><span class="op" id="3311467">.</span><span class="ident" id="3311468">Fragment</span><span class="op" id="3311476">,</span>&nbsp;<span class="ident" id="3311478">err</span>&nbsp;<span class="op" id="3311482">=</span>&nbsp;<span class="ident" id="3311484">unescape</span><span class="op" id="3311492">(</span><span class="ident" id="3311493">frag</span><span class="op" id="3311497">,</span>&nbsp;<span class="ident" id="3311499">encodeFragment</span><span class="op" id="3311513">)</span><span class="op" id="3311514">;</span>&nbsp;<span class="ident" id="3311516">err</span>&nbsp;<span class="op" id="3311520">!=</span>&nbsp;<span class="builtintype" id="3311523">nil</span>&nbsp;<span class="op" id="3311527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311531">return</span>&nbsp;<span class="builtintype" id="3311538">nil</span><span class="op" id="3311541">,</span>&nbsp;<span class="op" id="3311543">&amp;</span><span class="ident" id="3311544">Error</span><span class="op" id="3311549">{</span><span class="string" id="3311550">&#34;parse&#34;</span><span class="op" id="3311557">,</span>&nbsp;<span class="ident" id="3311559">rawurl</span><span class="op" id="3311565">,</span>&nbsp;<span class="ident" id="3311567">err</span><span class="op" id="3311570">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3311573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311576">return</span>&nbsp;<span class="ident" id="3311583">url</span><span class="op" id="3311586">,</span>&nbsp;<span class="builtintype" id="3311588">nil</span><br>
<span class="lineno"></span><span class="op" id="3311592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311595">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3311667">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3311739">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3311787">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3311851">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3311925">func</span>&nbsp;<span class="ident" id="3311930">ParseRequestURI</span><span class="op" id="3311945">(</span><span class="ident" id="3311946">rawurl</span>&nbsp;<span class="builtintype" id="3311953">string</span><span class="op" id="3311959">)</span>&nbsp;<span class="op" id="3311961">(</span><span class="ident" id="3311962">url</span>&nbsp;<span class="op" id="3311966">*</span><span class="ident" id="3311967">URL</span><span class="op" id="3311970">,</span>&nbsp;<span class="ident" id="3311972">err</span>&nbsp;<span class="builtintype" id="3311976">error</span><span class="op" id="3311981">)</span>&nbsp;<span class="op" id="3311983">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3311986">return</span>&nbsp;<span class="ident" id="3311993">parse</span><span class="op" id="3311998">(</span><span class="ident" id="3311999">rawurl</span><span class="op" id="3312005">,</span>&nbsp;<span class="builtintype" id="3312007">true</span><span class="op" id="3312011">)</span><br>
<span class="lineno"></span><span class="op" id="3312013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3312016">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3312080">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3312159">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3312239">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3312306">func</span>&nbsp;<span class="ident" id="3312311">parse</span><span class="op" id="3312316">(</span><span class="ident" id="3312317">rawurl</span>&nbsp;<span class="builtintype" id="3312324">string</span><span class="op" id="3312330">,</span>&nbsp;<span class="ident" id="3312332">viaRequest</span>&nbsp;<span class="builtintype" id="3312343">bool</span><span class="op" id="3312347">)</span>&nbsp;<span class="op" id="3312349">(</span><span class="ident" id="3312350">url</span>&nbsp;<span class="op" id="3312354">*</span><span class="ident" id="3312355">URL</span><span class="op" id="3312358">,</span>&nbsp;<span class="ident" id="3312360">err</span>&nbsp;<span class="builtintype" id="3312364">error</span><span class="op" id="3312369">)</span>&nbsp;<span class="op" id="3312371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312374">var</span>&nbsp;<span class="ident" id="3312378">rest</span>&nbsp;<span class="builtintype" id="3312383">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312392">if</span>&nbsp;<span class="ident" id="3312395">rawurl</span>&nbsp;<span class="op" id="3312402">==</span>&nbsp;<span class="string" id="3312405">&#34;&#34;</span>&nbsp;<span class="op" id="3312408">&amp;&amp;</span>&nbsp;<span class="ident" id="3312411">viaRequest</span>&nbsp;<span class="op" id="3312422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3312426">err</span>&nbsp;<span class="op" id="3312430">=</span>&nbsp;<span class="ident" id="3312432">errors</span><span class="op" id="3312438">.</span><span class="ident" id="3312439">New</span><span class="op" id="3312442">(</span><span class="string" id="3312443">&#34;empty&nbsp;url&#34;</span><span class="op" id="3312454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312458">goto</span>&nbsp;<span class="ident" id="3312463">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3312473">url</span>&nbsp;<span class="op" id="3312477">=</span>&nbsp;<span class="builtinfunc" id="3312479">new</span><span class="op" id="3312482">(</span><span class="ident" id="3312483">URL</span><span class="op" id="3312486">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312490">if</span>&nbsp;<span class="ident" id="3312493">rawurl</span>&nbsp;<span class="op" id="3312500">==</span>&nbsp;<span class="string" id="3312503">&#34;*&#34;</span>&nbsp;<span class="op" id="3312507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3312511">url</span><span class="op" id="3312514">.</span><span class="ident" id="3312515">Path</span>&nbsp;<span class="op" id="3312520">=</span>&nbsp;<span class="string" id="3312522">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312528">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312536">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3312540">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3312596">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312635">if</span>&nbsp;<span class="ident" id="3312638">url</span><span class="op" id="3312641">.</span><span class="ident" id="3312642">Scheme</span><span class="op" id="3312648">,</span>&nbsp;<span class="ident" id="3312650">rest</span><span class="op" id="3312654">,</span>&nbsp;<span class="ident" id="3312656">err</span>&nbsp;<span class="op" id="3312660">=</span>&nbsp;<span class="ident" id="3312662">getscheme</span><span class="op" id="3312671">(</span><span class="ident" id="3312672">rawurl</span><span class="op" id="3312678">)</span><span class="op" id="3312679">;</span>&nbsp;<span class="ident" id="3312681">err</span>&nbsp;<span class="op" id="3312685">!=</span>&nbsp;<span class="builtintype" id="3312688">nil</span>&nbsp;<span class="op" id="3312692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312696">goto</span>&nbsp;<span class="ident" id="3312701">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3312711">url</span><span class="op" id="3312714">.</span><span class="ident" id="3312715">Scheme</span>&nbsp;<span class="op" id="3312722">=</span>&nbsp;<span class="ident" id="3312724">strings</span><span class="op" id="3312731">.</span><span class="ident" id="3312732">ToLower</span><span class="op" id="3312739">(</span><span class="ident" id="3312740">url</span><span class="op" id="3312743">.</span><span class="ident" id="3312744">Scheme</span><span class="op" id="3312750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3312754">rest</span><span class="op" id="3312758">,</span>&nbsp;<span class="ident" id="3312760">url</span><span class="op" id="3312763">.</span><span class="ident" id="3312764">RawQuery</span>&nbsp;<span class="op" id="3312773">=</span>&nbsp;<span class="ident" id="3312775">split</span><span class="op" id="3312780">(</span><span class="ident" id="3312781">rest</span><span class="op" id="3312785">,</span>&nbsp;<span class="string" id="3312787">&#34;?&#34;</span><span class="op" id="3312790">,</span>&nbsp;<span class="builtintype" id="3312792">true</span><span class="op" id="3312796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312800">if</span>&nbsp;<span class="op" id="3312803">!</span><span class="ident" id="3312804">strings</span><span class="op" id="3312811">.</span><span class="ident" id="3312812">HasPrefix</span><span class="op" id="3312821">(</span><span class="ident" id="3312822">rest</span><span class="op" id="3312826">,</span>&nbsp;<span class="string" id="3312828">&#34;/&#34;</span><span class="op" id="3312831">)</span>&nbsp;<span class="op" id="3312833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312837">if</span>&nbsp;<span class="ident" id="3312840">url</span><span class="op" id="3312843">.</span><span class="ident" id="3312844">Scheme</span>&nbsp;<span class="op" id="3312851">!=</span>&nbsp;<span class="string" id="3312854">&#34;&#34;</span>&nbsp;<span class="op" id="3312857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3312862">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3312919">url</span><span class="op" id="3312922">.</span><span class="ident" id="3312923">Opaque</span>&nbsp;<span class="op" id="3312930">=</span>&nbsp;<span class="ident" id="3312932">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312940">return</span>&nbsp;<span class="ident" id="3312947">url</span><span class="op" id="3312950">,</span>&nbsp;<span class="builtintype" id="3312952">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3312962">if</span>&nbsp;<span class="ident" id="3312965">viaRequest</span>&nbsp;<span class="op" id="3312976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3312981">err</span>&nbsp;<span class="op" id="3312985">=</span>&nbsp;<span class="ident" id="3312987">errors</span><span class="op" id="3312993">.</span><span class="ident" id="3312994">New</span><span class="op" id="3312997">(</span><span class="string" id="3312998">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3313023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313028">goto</span>&nbsp;<span class="ident" id="3313033">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313041">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313048">if</span>&nbsp;<span class="op" id="3313051">(</span><span class="ident" id="3313052">url</span><span class="op" id="3313055">.</span><span class="ident" id="3313056">Scheme</span>&nbsp;<span class="op" id="3313063">!=</span>&nbsp;<span class="string" id="3313066">&#34;&#34;</span>&nbsp;<span class="op" id="3313069">||</span>&nbsp;<span class="op" id="3313072">!</span><span class="ident" id="3313073">viaRequest</span>&nbsp;<span class="op" id="3313084">&amp;&amp;</span>&nbsp;<span class="op" id="3313087">!</span><span class="ident" id="3313088">strings</span><span class="op" id="3313095">.</span><span class="ident" id="3313096">HasPrefix</span><span class="op" id="3313105">(</span><span class="ident" id="3313106">rest</span><span class="op" id="3313110">,</span>&nbsp;<span class="string" id="3313112">&#34;///&#34;</span><span class="op" id="3313117">)</span><span class="op" id="3313118">)</span>&nbsp;<span class="op" id="3313120">&amp;&amp;</span>&nbsp;<span class="ident" id="3313123">strings</span><span class="op" id="3313130">.</span><span class="ident" id="3313131">HasPrefix</span><span class="op" id="3313140">(</span><span class="ident" id="3313141">rest</span><span class="op" id="3313145">,</span>&nbsp;<span class="string" id="3313147">&#34;//&#34;</span><span class="op" id="3313151">)</span>&nbsp;<span class="op" id="3313153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313157">var</span>&nbsp;<span class="ident" id="3313161">authority</span>&nbsp;<span class="builtintype" id="3313171">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313180">authority</span><span class="op" id="3313189">,</span>&nbsp;<span class="ident" id="3313191">rest</span>&nbsp;<span class="op" id="3313196">=</span>&nbsp;<span class="ident" id="3313198">split</span><span class="op" id="3313203">(</span><span class="ident" id="3313204">rest</span><span class="op" id="3313208">[</span><span class="num" id="3313209">2</span><span class="op" id="3313210">:</span><span class="op" id="3313211">]</span><span class="op" id="3313212">,</span>&nbsp;<span class="string" id="3313214">&#34;/&#34;</span><span class="op" id="3313217">,</span>&nbsp;<span class="builtintype" id="3313219">false</span><span class="op" id="3313224">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313228">url</span><span class="op" id="3313231">.</span><span class="ident" id="3313232">User</span><span class="op" id="3313236">,</span>&nbsp;<span class="ident" id="3313238">url</span><span class="op" id="3313241">.</span><span class="ident" id="3313242">Host</span><span class="op" id="3313246">,</span>&nbsp;<span class="ident" id="3313248">err</span>&nbsp;<span class="op" id="3313252">=</span>&nbsp;<span class="ident" id="3313254">parseAuthority</span><span class="op" id="3313268">(</span><span class="ident" id="3313269">authority</span><span class="op" id="3313278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313282">if</span>&nbsp;<span class="ident" id="3313285">err</span>&nbsp;<span class="op" id="3313289">!=</span>&nbsp;<span class="builtintype" id="3313292">nil</span>&nbsp;<span class="op" id="3313296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313301">goto</span>&nbsp;<span class="ident" id="3313306">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313318">if</span>&nbsp;<span class="ident" id="3313321">strings</span><span class="op" id="3313328">.</span><span class="ident" id="3313329">Contains</span><span class="op" id="3313337">(</span><span class="ident" id="3313338">url</span><span class="op" id="3313341">.</span><span class="ident" id="3313342">Host</span><span class="op" id="3313346">,</span>&nbsp;<span class="string" id="3313348">&#34;%&#34;</span><span class="op" id="3313351">)</span>&nbsp;<span class="op" id="3313353">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313358">err</span>&nbsp;<span class="op" id="3313362">=</span>&nbsp;<span class="ident" id="3313364">errors</span><span class="op" id="3313370">.</span><span class="ident" id="3313371">New</span><span class="op" id="3313374">(</span><span class="string" id="3313375">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3313403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313408">goto</span>&nbsp;<span class="ident" id="3313413">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313427">if</span>&nbsp;<span class="ident" id="3313430">url</span><span class="op" id="3313433">.</span><span class="ident" id="3313434">Path</span><span class="op" id="3313438">,</span>&nbsp;<span class="ident" id="3313440">err</span>&nbsp;<span class="op" id="3313444">=</span>&nbsp;<span class="ident" id="3313446">unescape</span><span class="op" id="3313454">(</span><span class="ident" id="3313455">rest</span><span class="op" id="3313459">,</span>&nbsp;<span class="ident" id="3313461">encodePath</span><span class="op" id="3313471">)</span><span class="op" id="3313472">;</span>&nbsp;<span class="ident" id="3313474">err</span>&nbsp;<span class="op" id="3313478">!=</span>&nbsp;<span class="builtintype" id="3313481">nil</span>&nbsp;<span class="op" id="3313485">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313489">goto</span>&nbsp;<span class="ident" id="3313494">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313504">return</span>&nbsp;<span class="ident" id="3313511">url</span><span class="op" id="3313514">,</span>&nbsp;<span class="builtintype" id="3313516">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3313521">Error</span><span class="op" id="3313526">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313529">return</span>&nbsp;<span class="builtintype" id="3313536">nil</span><span class="op" id="3313539">,</span>&nbsp;<span class="op" id="3313541">&amp;</span><span class="ident" id="3313542">Error</span><span class="op" id="3313547">{</span><span class="string" id="3313548">&#34;parse&#34;</span><span class="op" id="3313555">,</span>&nbsp;<span class="ident" id="3313557">rawurl</span><span class="op" id="3313563">,</span>&nbsp;<span class="ident" id="3313565">err</span><span class="op" id="3313568">}</span><br>
<span class="lineno"></span><span class="op" id="3313570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3313573">func</span>&nbsp;<span class="ident" id="3313578">parseAuthority</span><span class="op" id="3313592">(</span><span class="ident" id="3313593">authority</span>&nbsp;<span class="builtintype" id="3313603">string</span><span class="op" id="3313609">)</span>&nbsp;<span class="op" id="3313611">(</span><span class="ident" id="3313612">user</span>&nbsp;<span class="op" id="3313617">*</span><span class="ident" id="3313618">Userinfo</span><span class="op" id="3313626">,</span>&nbsp;<span class="ident" id="3313628">host</span>&nbsp;<span class="builtintype" id="3313633">string</span><span class="op" id="3313639">,</span>&nbsp;<span class="ident" id="3313641">err</span>&nbsp;<span class="builtintype" id="3313645">error</span><span class="op" id="3313650">)</span>&nbsp;<span class="op" id="3313652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313655">i</span>&nbsp;<span class="op" id="3313657">:=</span>&nbsp;<span class="ident" id="3313660">strings</span><span class="op" id="3313667">.</span><span class="ident" id="3313668">LastIndex</span><span class="op" id="3313677">(</span><span class="ident" id="3313678">authority</span><span class="op" id="3313687">,</span>&nbsp;<span class="string" id="3313689">&#34;@&#34;</span><span class="op" id="3313692">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313695">if</span>&nbsp;<span class="ident" id="3313698">i</span>&nbsp;<span class="op" id="3313700">&lt;</span>&nbsp;<span class="num" id="3313702">0</span>&nbsp;<span class="op" id="3313704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313708">host</span>&nbsp;<span class="op" id="3313713">=</span>&nbsp;<span class="ident" id="3313715">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313727">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313738">userinfo</span><span class="op" id="3313746">,</span>&nbsp;<span class="ident" id="3313748">host</span>&nbsp;<span class="op" id="3313753">:=</span>&nbsp;<span class="ident" id="3313756">authority</span><span class="op" id="3313765">[</span><span class="op" id="3313766">:</span><span class="ident" id="3313767">i</span><span class="op" id="3313768">]</span><span class="op" id="3313769">,</span>&nbsp;<span class="ident" id="3313771">authority</span><span class="op" id="3313780">[</span><span class="ident" id="3313781">i</span><span class="op" id="3313782">+</span><span class="num" id="3313783">1</span><span class="op" id="3313784">:</span><span class="op" id="3313785">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313788">if</span>&nbsp;<span class="ident" id="3313791">strings</span><span class="op" id="3313798">.</span><span class="ident" id="3313799">Index</span><span class="op" id="3313804">(</span><span class="ident" id="3313805">userinfo</span><span class="op" id="3313813">,</span>&nbsp;<span class="string" id="3313815">&#34;:&#34;</span><span class="op" id="3313818">)</span>&nbsp;<span class="op" id="3313820">&lt;</span>&nbsp;<span class="num" id="3313822">0</span>&nbsp;<span class="op" id="3313824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313828">if</span>&nbsp;<span class="ident" id="3313831">userinfo</span><span class="op" id="3313839">,</span>&nbsp;<span class="ident" id="3313841">err</span>&nbsp;<span class="op" id="3313845">=</span>&nbsp;<span class="ident" id="3313847">unescape</span><span class="op" id="3313855">(</span><span class="ident" id="3313856">userinfo</span><span class="op" id="3313864">,</span>&nbsp;<span class="ident" id="3313866">encodeUserPassword</span><span class="op" id="3313884">)</span><span class="op" id="3313885">;</span>&nbsp;<span class="ident" id="3313887">err</span>&nbsp;<span class="op" id="3313891">!=</span>&nbsp;<span class="builtintype" id="3313894">nil</span>&nbsp;<span class="op" id="3313898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3313903">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313916">user</span>&nbsp;<span class="op" id="3313921">=</span>&nbsp;<span class="ident" id="3313923">User</span><span class="op" id="3313927">(</span><span class="ident" id="3313928">userinfo</span><span class="op" id="3313936">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3313939">}</span>&nbsp;<span class="keyword" id="3313941">else</span>&nbsp;<span class="op" id="3313946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3313950">username</span><span class="op" id="3313958">,</span>&nbsp;<span class="ident" id="3313960">password</span>&nbsp;<span class="op" id="3313969">:=</span>&nbsp;<span class="ident" id="3313972">split</span><span class="op" id="3313977">(</span><span class="ident" id="3313978">userinfo</span><span class="op" id="3313986">,</span>&nbsp;<span class="string" id="3313988">&#34;:&#34;</span><span class="op" id="3313991">,</span>&nbsp;<span class="builtintype" id="3313993">true</span><span class="op" id="3313997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3314001">if</span>&nbsp;<span class="ident" id="3314004">username</span><span class="op" id="3314012">,</span>&nbsp;<span class="ident" id="3314014">err</span>&nbsp;<span class="op" id="3314018">=</span>&nbsp;<span class="ident" id="3314020">unescape</span><span class="op" id="3314028">(</span><span class="ident" id="3314029">username</span><span class="op" id="3314037">,</span>&nbsp;<span class="ident" id="3314039">encodeUserPassword</span><span class="op" id="3314057">)</span><span class="op" id="3314058">;</span>&nbsp;<span class="ident" id="3314060">err</span>&nbsp;<span class="op" id="3314064">!=</span>&nbsp;<span class="builtintype" id="3314067">nil</span>&nbsp;<span class="op" id="3314071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3314076">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3314085">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3314089">if</span>&nbsp;<span class="ident" id="3314092">password</span><span class="op" id="3314100">,</span>&nbsp;<span class="ident" id="3314102">err</span>&nbsp;<span class="op" id="3314106">=</span>&nbsp;<span class="ident" id="3314108">unescape</span><span class="op" id="3314116">(</span><span class="ident" id="3314117">password</span><span class="op" id="3314125">,</span>&nbsp;<span class="ident" id="3314127">encodeUserPassword</span><span class="op" id="3314145">)</span><span class="op" id="3314146">;</span>&nbsp;<span class="ident" id="3314148">err</span>&nbsp;<span class="op" id="3314152">!=</span>&nbsp;<span class="builtintype" id="3314155">nil</span>&nbsp;<span class="op" id="3314159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3314164">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3314173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3314177">user</span>&nbsp;<span class="op" id="3314182">=</span>&nbsp;<span class="ident" id="3314184">UserPassword</span><span class="op" id="3314196">(</span><span class="ident" id="3314197">username</span><span class="op" id="3314205">,</span>&nbsp;<span class="ident" id="3314207">password</span><span class="op" id="3314215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3314218">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3314221">return</span><br>
<span class="lineno"></span><span class="op" id="3314228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314231">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3314286">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3314331">//</span><br>
<span class="lineno"></span><span class="comment" id="3314334">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3314351">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3314397">//</span><br>
<span class="lineno"></span><span class="comment" id="3314400">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3314457">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3314495">//</span><br>
<span class="lineno"></span><span class="comment" id="3314498">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3314548">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3314595">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3314640">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3314683">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3314740">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3314793">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3314849">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3314898">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3314946">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3314997">func</span>&nbsp;<span class="op" id="3315002">(</span><span class="ident" id="3315003">u</span>&nbsp;<span class="op" id="3315005">*</span><span class="ident" id="3315006">URL</span><span class="op" id="3315009">)</span>&nbsp;<span class="ident" id="3315011">String</span><span class="op" id="3315017">(</span><span class="op" id="3315018">)</span>&nbsp;<span class="builtintype" id="3315020">string</span>&nbsp;<span class="op" id="3315027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315030">var</span>&nbsp;<span class="ident" id="3315034">buf</span>&nbsp;<span class="ident" id="3315038">bytes</span><span class="op" id="3315043">.</span><span class="ident" id="3315044">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315052">if</span>&nbsp;<span class="ident" id="3315055">u</span><span class="op" id="3315056">.</span><span class="ident" id="3315057">Scheme</span>&nbsp;<span class="op" id="3315064">!=</span>&nbsp;<span class="string" id="3315067">&#34;&#34;</span>&nbsp;<span class="op" id="3315070">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315074">buf</span><span class="op" id="3315077">.</span><span class="ident" id="3315078">WriteString</span><span class="op" id="3315089">(</span><span class="ident" id="3315090">u</span><span class="op" id="3315091">.</span><span class="ident" id="3315092">Scheme</span><span class="op" id="3315098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315102">buf</span><span class="op" id="3315105">.</span><span class="ident" id="3315106">WriteByte</span><span class="op" id="3315115">(</span><span class="string" id="3315116">&#39;:&#39;</span><span class="op" id="3315119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315125">if</span>&nbsp;<span class="ident" id="3315128">u</span><span class="op" id="3315129">.</span><span class="ident" id="3315130">Opaque</span>&nbsp;<span class="op" id="3315137">!=</span>&nbsp;<span class="string" id="3315140">&#34;&#34;</span>&nbsp;<span class="op" id="3315143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315147">buf</span><span class="op" id="3315150">.</span><span class="ident" id="3315151">WriteString</span><span class="op" id="3315162">(</span><span class="ident" id="3315163">u</span><span class="op" id="3315164">.</span><span class="ident" id="3315165">Opaque</span><span class="op" id="3315171">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315174">}</span>&nbsp;<span class="keyword" id="3315176">else</span>&nbsp;<span class="op" id="3315181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315185">if</span>&nbsp;<span class="ident" id="3315188">u</span><span class="op" id="3315189">.</span><span class="ident" id="3315190">Scheme</span>&nbsp;<span class="op" id="3315197">!=</span>&nbsp;<span class="string" id="3315200">&#34;&#34;</span>&nbsp;<span class="op" id="3315203">||</span>&nbsp;<span class="ident" id="3315206">u</span><span class="op" id="3315207">.</span><span class="ident" id="3315208">Host</span>&nbsp;<span class="op" id="3315213">!=</span>&nbsp;<span class="string" id="3315216">&#34;&#34;</span>&nbsp;<span class="op" id="3315219">||</span>&nbsp;<span class="ident" id="3315222">u</span><span class="op" id="3315223">.</span><span class="ident" id="3315224">User</span>&nbsp;<span class="op" id="3315229">!=</span>&nbsp;<span class="builtintype" id="3315232">nil</span>&nbsp;<span class="op" id="3315236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315241">buf</span><span class="op" id="3315244">.</span><span class="ident" id="3315245">WriteString</span><span class="op" id="3315256">(</span><span class="string" id="3315257">&#34;//&#34;</span><span class="op" id="3315261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315266">if</span>&nbsp;<span class="ident" id="3315269">ui</span>&nbsp;<span class="op" id="3315272">:=</span>&nbsp;<span class="ident" id="3315275">u</span><span class="op" id="3315276">.</span><span class="ident" id="3315277">User</span><span class="op" id="3315281">;</span>&nbsp;<span class="ident" id="3315283">ui</span>&nbsp;<span class="op" id="3315286">!=</span>&nbsp;<span class="builtintype" id="3315289">nil</span>&nbsp;<span class="op" id="3315293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315299">buf</span><span class="op" id="3315302">.</span><span class="ident" id="3315303">WriteString</span><span class="op" id="3315314">(</span><span class="ident" id="3315315">ui</span><span class="op" id="3315317">.</span><span class="ident" id="3315318">String</span><span class="op" id="3315324">(</span><span class="op" id="3315325">)</span><span class="op" id="3315326">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315332">buf</span><span class="op" id="3315335">.</span><span class="ident" id="3315336">WriteByte</span><span class="op" id="3315345">(</span><span class="string" id="3315346">&#39;@&#39;</span><span class="op" id="3315349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315359">if</span>&nbsp;<span class="ident" id="3315362">h</span>&nbsp;<span class="op" id="3315364">:=</span>&nbsp;<span class="ident" id="3315367">u</span><span class="op" id="3315368">.</span><span class="ident" id="3315369">Host</span><span class="op" id="3315373">;</span>&nbsp;<span class="ident" id="3315375">h</span>&nbsp;<span class="op" id="3315377">!=</span>&nbsp;<span class="string" id="3315380">&#34;&#34;</span>&nbsp;<span class="op" id="3315383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315389">buf</span><span class="op" id="3315392">.</span><span class="ident" id="3315393">WriteString</span><span class="op" id="3315404">(</span><span class="ident" id="3315405">h</span><span class="op" id="3315406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315411">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315419">if</span>&nbsp;<span class="ident" id="3315422">u</span><span class="op" id="3315423">.</span><span class="ident" id="3315424">Path</span>&nbsp;<span class="op" id="3315429">!=</span>&nbsp;<span class="string" id="3315432">&#34;&#34;</span>&nbsp;<span class="op" id="3315435">&amp;&amp;</span>&nbsp;<span class="ident" id="3315438">u</span><span class="op" id="3315439">.</span><span class="ident" id="3315440">Path</span><span class="op" id="3315444">[</span><span class="num" id="3315445">0</span><span class="op" id="3315446">]</span>&nbsp;<span class="op" id="3315448">!=</span>&nbsp;<span class="string" id="3315451">&#39;/&#39;</span>&nbsp;<span class="op" id="3315455">&amp;&amp;</span>&nbsp;<span class="ident" id="3315458">u</span><span class="op" id="3315459">.</span><span class="ident" id="3315460">Host</span>&nbsp;<span class="op" id="3315465">!=</span>&nbsp;<span class="string" id="3315468">&#34;&#34;</span>&nbsp;<span class="op" id="3315471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315476">buf</span><span class="op" id="3315479">.</span><span class="ident" id="3315480">WriteByte</span><span class="op" id="3315489">(</span><span class="string" id="3315490">&#39;/&#39;</span><span class="op" id="3315493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315501">buf</span><span class="op" id="3315504">.</span><span class="ident" id="3315505">WriteString</span><span class="op" id="3315516">(</span><span class="ident" id="3315517">escape</span><span class="op" id="3315523">(</span><span class="ident" id="3315524">u</span><span class="op" id="3315525">.</span><span class="ident" id="3315526">Path</span><span class="op" id="3315530">,</span>&nbsp;<span class="ident" id="3315532">encodePath</span><span class="op" id="3315542">)</span><span class="op" id="3315543">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315549">if</span>&nbsp;<span class="ident" id="3315552">u</span><span class="op" id="3315553">.</span><span class="ident" id="3315554">RawQuery</span>&nbsp;<span class="op" id="3315563">!=</span>&nbsp;<span class="string" id="3315566">&#34;&#34;</span>&nbsp;<span class="op" id="3315569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315573">buf</span><span class="op" id="3315576">.</span><span class="ident" id="3315577">WriteByte</span><span class="op" id="3315586">(</span><span class="string" id="3315587">&#39;?&#39;</span><span class="op" id="3315590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315594">buf</span><span class="op" id="3315597">.</span><span class="ident" id="3315598">WriteString</span><span class="op" id="3315609">(</span><span class="ident" id="3315610">u</span><span class="op" id="3315611">.</span><span class="ident" id="3315612">RawQuery</span><span class="op" id="3315620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315623">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315626">if</span>&nbsp;<span class="ident" id="3315629">u</span><span class="op" id="3315630">.</span><span class="ident" id="3315631">Fragment</span>&nbsp;<span class="op" id="3315640">!=</span>&nbsp;<span class="string" id="3315643">&#34;&#34;</span>&nbsp;<span class="op" id="3315646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315650">buf</span><span class="op" id="3315653">.</span><span class="ident" id="3315654">WriteByte</span><span class="op" id="3315663">(</span><span class="string" id="3315664">&#39;#&#39;</span><span class="op" id="3315667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315671">buf</span><span class="op" id="3315674">.</span><span class="ident" id="3315675">WriteString</span><span class="op" id="3315686">(</span><span class="ident" id="3315687">escape</span><span class="op" id="3315693">(</span><span class="ident" id="3315694">u</span><span class="op" id="3315695">.</span><span class="ident" id="3315696">Fragment</span><span class="op" id="3315704">,</span>&nbsp;<span class="ident" id="3315706">encodeFragment</span><span class="op" id="3315720">)</span><span class="op" id="3315721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315727">return</span>&nbsp;<span class="ident" id="3315734">buf</span><span class="op" id="3315737">.</span><span class="ident" id="3315738">String</span><span class="op" id="3315744">(</span><span class="op" id="3315745">)</span><br>
<span class="lineno">495</span><span class="op" id="3315747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315750">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3315799">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3315861">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3315920">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3315943">type</span>&nbsp;<span class="ident" id="3315948">Values</span>&nbsp;<span class="keyword" id="3315955">map</span><span class="op" id="3315958">[</span><span class="builtintype" id="3315959">string</span><span class="op" id="3315965">]</span><span class="op" id="3315966">[</span><span class="op" id="3315967">]</span><span class="builtintype" id="3315968">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315976">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3316035">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3316098">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3316158">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3316171">func</span>&nbsp;<span class="op" id="3316176">(</span><span class="ident" id="3316177">v</span>&nbsp;<span class="ident" id="3316179">Values</span><span class="op" id="3316185">)</span>&nbsp;<span class="ident" id="3316187">Get</span><span class="op" id="3316190">(</span><span class="ident" id="3316191">key</span>&nbsp;<span class="builtintype" id="3316195">string</span><span class="op" id="3316201">)</span>&nbsp;<span class="builtintype" id="3316203">string</span>&nbsp;<span class="op" id="3316210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316213">if</span>&nbsp;<span class="ident" id="3316216">v</span>&nbsp;<span class="op" id="3316218">==</span>&nbsp;<span class="builtintype" id="3316221">nil</span>&nbsp;<span class="op" id="3316225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316229">return</span>&nbsp;<span class="string" id="3316236">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3316240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316243">vs</span><span class="op" id="3316245">,</span>&nbsp;<span class="ident" id="3316247">ok</span>&nbsp;<span class="op" id="3316250">:=</span>&nbsp;<span class="ident" id="3316253">v</span><span class="op" id="3316254">[</span><span class="ident" id="3316255">key</span><span class="op" id="3316258">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316261">if</span>&nbsp;<span class="op" id="3316264">!</span><span class="ident" id="3316265">ok</span>&nbsp;<span class="op" id="3316268">||</span>&nbsp;<span class="builtinfunc" id="3316271">len</span><span class="op" id="3316274">(</span><span class="ident" id="3316275">vs</span><span class="op" id="3316277">)</span>&nbsp;<span class="op" id="3316279">==</span>&nbsp;<span class="num" id="3316282">0</span>&nbsp;<span class="op" id="3316284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316288">return</span>&nbsp;<span class="string" id="3316295">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3316299">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316302">return</span>&nbsp;<span class="ident" id="3316309">vs</span><span class="op" id="3316311">[</span><span class="num" id="3316312">0</span><span class="op" id="3316313">]</span><br>
<span class="lineno"></span><span class="op" id="3316315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316318">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3316373">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3316384">func</span>&nbsp;<span class="op" id="3316389">(</span><span class="ident" id="3316390">v</span>&nbsp;<span class="ident" id="3316392">Values</span><span class="op" id="3316398">)</span>&nbsp;<span class="ident" id="3316400">Set</span><span class="op" id="3316403">(</span><span class="ident" id="3316404">key</span><span class="op" id="3316407">,</span>&nbsp;<span class="ident" id="3316409">value</span>&nbsp;<span class="builtintype" id="3316415">string</span><span class="op" id="3316421">)</span>&nbsp;<span class="op" id="3316423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316426">v</span><span class="op" id="3316427">[</span><span class="ident" id="3316428">key</span><span class="op" id="3316431">]</span>&nbsp;<span class="op" id="3316433">=</span>&nbsp;<span class="op" id="3316435">[</span><span class="op" id="3316436">]</span><span class="builtintype" id="3316437">string</span><span class="op" id="3316443">{</span><span class="ident" id="3316444">value</span><span class="op" id="3316449">}</span><br>
<span class="lineno"></span><span class="op" id="3316451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316454">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3316511">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3316542">func</span>&nbsp;<span class="op" id="3316547">(</span><span class="ident" id="3316548">v</span>&nbsp;<span class="ident" id="3316550">Values</span><span class="op" id="3316556">)</span>&nbsp;<span class="ident" id="3316558">Add</span><span class="op" id="3316561">(</span><span class="ident" id="3316562">key</span><span class="op" id="3316565">,</span>&nbsp;<span class="ident" id="3316567">value</span>&nbsp;<span class="builtintype" id="3316573">string</span><span class="op" id="3316579">)</span>&nbsp;<span class="op" id="3316581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316584">v</span><span class="op" id="3316585">[</span><span class="ident" id="3316586">key</span><span class="op" id="3316589">]</span>&nbsp;<span class="op" id="3316591">=</span>&nbsp;<span class="builtinfunc" id="3316593">append</span><span class="op" id="3316599">(</span><span class="ident" id="3316600">v</span><span class="op" id="3316601">[</span><span class="ident" id="3316602">key</span><span class="op" id="3316605">]</span><span class="op" id="3316606">,</span>&nbsp;<span class="ident" id="3316608">value</span><span class="op" id="3316613">)</span><br>
<span class="lineno"></span><span class="op" id="3316615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3316618">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3316665">func</span>&nbsp;<span class="op" id="3316670">(</span><span class="ident" id="3316671">v</span>&nbsp;<span class="ident" id="3316673">Values</span><span class="op" id="3316679">)</span>&nbsp;<span class="ident" id="3316681">Del</span><span class="op" id="3316684">(</span><span class="ident" id="3316685">key</span>&nbsp;<span class="builtintype" id="3316689">string</span><span class="op" id="3316695">)</span>&nbsp;<span class="op" id="3316697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3316700">delete</span><span class="op" id="3316706">(</span><span class="ident" id="3316707">v</span><span class="op" id="3316708">,</span>&nbsp;<span class="ident" id="3316710">key</span><span class="op" id="3316713">)</span><br>
<span class="lineno"></span><span class="op" id="3316715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3316718">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3316780">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3316832">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3316894">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3316966">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3316990">func</span>&nbsp;<span class="ident" id="3316995">ParseQuery</span><span class="op" id="3317005">(</span><span class="ident" id="3317006">query</span>&nbsp;<span class="builtintype" id="3317012">string</span><span class="op" id="3317018">)</span>&nbsp;<span class="op" id="3317020">(</span><span class="ident" id="3317021">m</span>&nbsp;<span class="ident" id="3317023">Values</span><span class="op" id="3317029">,</span>&nbsp;<span class="ident" id="3317031">err</span>&nbsp;<span class="builtintype" id="3317035">error</span><span class="op" id="3317040">)</span>&nbsp;<span class="op" id="3317042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317045">m</span>&nbsp;<span class="op" id="3317047">=</span>&nbsp;<span class="builtinfunc" id="3317049">make</span><span class="op" id="3317053">(</span><span class="ident" id="3317054">Values</span><span class="op" id="3317060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317063">err</span>&nbsp;<span class="op" id="3317067">=</span>&nbsp;<span class="ident" id="3317069">parseQuery</span><span class="op" id="3317079">(</span><span class="ident" id="3317080">m</span><span class="op" id="3317081">,</span>&nbsp;<span class="ident" id="3317083">query</span><span class="op" id="3317088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317091">return</span><br>
<span class="lineno"></span><span class="op" id="3317098">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3317101">func</span>&nbsp;<span class="ident" id="3317106">parseQuery</span><span class="op" id="3317116">(</span><span class="ident" id="3317117">m</span>&nbsp;<span class="ident" id="3317119">Values</span><span class="op" id="3317125">,</span>&nbsp;<span class="ident" id="3317127">query</span>&nbsp;<span class="builtintype" id="3317133">string</span><span class="op" id="3317139">)</span>&nbsp;<span class="op" id="3317141">(</span><span class="ident" id="3317142">err</span>&nbsp;<span class="builtintype" id="3317146">error</span><span class="op" id="3317151">)</span>&nbsp;<span class="op" id="3317153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317156">for</span>&nbsp;<span class="ident" id="3317160">query</span>&nbsp;<span class="op" id="3317166">!=</span>&nbsp;<span class="string" id="3317169">&#34;&#34;</span>&nbsp;<span class="op" id="3317172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317176">key</span>&nbsp;<span class="op" id="3317180">:=</span>&nbsp;<span class="ident" id="3317183">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317191">if</span>&nbsp;<span class="ident" id="3317194">i</span>&nbsp;<span class="op" id="3317196">:=</span>&nbsp;<span class="ident" id="3317199">strings</span><span class="op" id="3317206">.</span><span class="ident" id="3317207">IndexAny</span><span class="op" id="3317215">(</span><span class="ident" id="3317216">key</span><span class="op" id="3317219">,</span>&nbsp;<span class="string" id="3317221">&#34;&amp;;&#34;</span><span class="op" id="3317225">)</span><span class="op" id="3317226">;</span>&nbsp;<span class="ident" id="3317228">i</span>&nbsp;<span class="op" id="3317230">&gt;=</span>&nbsp;<span class="num" id="3317233">0</span>&nbsp;<span class="op" id="3317235">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317240">key</span><span class="op" id="3317243">,</span>&nbsp;<span class="ident" id="3317245">query</span>&nbsp;<span class="op" id="3317251">=</span>&nbsp;<span class="ident" id="3317253">key</span><span class="op" id="3317256">[</span><span class="op" id="3317257">:</span><span class="ident" id="3317258">i</span><span class="op" id="3317259">]</span><span class="op" id="3317260">,</span>&nbsp;<span class="ident" id="3317262">key</span><span class="op" id="3317265">[</span><span class="ident" id="3317266">i</span><span class="op" id="3317267">+</span><span class="num" id="3317268">1</span><span class="op" id="3317269">:</span><span class="op" id="3317270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317274">}</span>&nbsp;<span class="keyword" id="3317276">else</span>&nbsp;<span class="op" id="3317281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317286">query</span>&nbsp;<span class="op" id="3317292">=</span>&nbsp;<span class="string" id="3317294">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317303">if</span>&nbsp;<span class="ident" id="3317306">key</span>&nbsp;<span class="op" id="3317310">==</span>&nbsp;<span class="string" id="3317313">&#34;&#34;</span>&nbsp;<span class="op" id="3317316">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317321">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317336">value</span>&nbsp;<span class="op" id="3317342">:=</span>&nbsp;<span class="string" id="3317345">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317350">if</span>&nbsp;<span class="ident" id="3317353">i</span>&nbsp;<span class="op" id="3317355">:=</span>&nbsp;<span class="ident" id="3317358">strings</span><span class="op" id="3317365">.</span><span class="ident" id="3317366">Index</span><span class="op" id="3317371">(</span><span class="ident" id="3317372">key</span><span class="op" id="3317375">,</span>&nbsp;<span class="string" id="3317377">&#34;=&#34;</span><span class="op" id="3317380">)</span><span class="op" id="3317381">;</span>&nbsp;<span class="ident" id="3317383">i</span>&nbsp;<span class="op" id="3317385">&gt;=</span>&nbsp;<span class="num" id="3317388">0</span>&nbsp;<span class="op" id="3317390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317395">key</span><span class="op" id="3317398">,</span>&nbsp;<span class="ident" id="3317400">value</span>&nbsp;<span class="op" id="3317406">=</span>&nbsp;<span class="ident" id="3317408">key</span><span class="op" id="3317411">[</span><span class="op" id="3317412">:</span><span class="ident" id="3317413">i</span><span class="op" id="3317414">]</span><span class="op" id="3317415">,</span>&nbsp;<span class="ident" id="3317417">key</span><span class="op" id="3317420">[</span><span class="ident" id="3317421">i</span><span class="op" id="3317422">+</span><span class="num" id="3317423">1</span><span class="op" id="3317424">:</span><span class="op" id="3317425">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317433">key</span><span class="op" id="3317436">,</span>&nbsp;<span class="ident" id="3317438">err1</span>&nbsp;<span class="op" id="3317443">:=</span>&nbsp;<span class="ident" id="3317446">QueryUnescape</span><span class="op" id="3317459">(</span><span class="ident" id="3317460">key</span><span class="op" id="3317463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317467">if</span>&nbsp;<span class="ident" id="3317470">err1</span>&nbsp;<span class="op" id="3317475">!=</span>&nbsp;<span class="builtintype" id="3317478">nil</span>&nbsp;<span class="op" id="3317482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317487">if</span>&nbsp;<span class="ident" id="3317490">err</span>&nbsp;<span class="op" id="3317494">==</span>&nbsp;<span class="builtintype" id="3317497">nil</span>&nbsp;<span class="op" id="3317501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317507">err</span>&nbsp;<span class="op" id="3317511">=</span>&nbsp;<span class="ident" id="3317513">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317526">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317541">value</span><span class="op" id="3317546">,</span>&nbsp;<span class="ident" id="3317548">err1</span>&nbsp;<span class="op" id="3317553">=</span>&nbsp;<span class="ident" id="3317555">QueryUnescape</span><span class="op" id="3317568">(</span><span class="ident" id="3317569">value</span><span class="op" id="3317574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317578">if</span>&nbsp;<span class="ident" id="3317581">err1</span>&nbsp;<span class="op" id="3317586">!=</span>&nbsp;<span class="builtintype" id="3317589">nil</span>&nbsp;<span class="op" id="3317593">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317598">if</span>&nbsp;<span class="ident" id="3317601">err</span>&nbsp;<span class="op" id="3317605">==</span>&nbsp;<span class="builtintype" id="3317608">nil</span>&nbsp;<span class="op" id="3317612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317618">err</span>&nbsp;<span class="op" id="3317622">=</span>&nbsp;<span class="ident" id="3317624">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317648">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317652">m</span><span class="op" id="3317653">[</span><span class="ident" id="3317654">key</span><span class="op" id="3317657">]</span>&nbsp;<span class="op" id="3317659">=</span>&nbsp;<span class="builtinfunc" id="3317661">append</span><span class="op" id="3317667">(</span><span class="ident" id="3317668">m</span><span class="op" id="3317669">[</span><span class="ident" id="3317670">key</span><span class="op" id="3317673">]</span><span class="op" id="3317674">,</span>&nbsp;<span class="ident" id="3317676">value</span><span class="op" id="3317681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317687">return</span>&nbsp;<span class="ident" id="3317694">err</span><br>
<span class="lineno"></span><span class="op" id="3317698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3317701">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3317756">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3317795">func</span>&nbsp;<span class="op" id="3317800">(</span><span class="ident" id="3317801">v</span>&nbsp;<span class="ident" id="3317803">Values</span><span class="op" id="3317809">)</span>&nbsp;<span class="ident" id="3317811">Encode</span><span class="op" id="3317817">(</span><span class="op" id="3317818">)</span>&nbsp;<span class="builtintype" id="3317820">string</span>&nbsp;<span class="op" id="3317827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317830">if</span>&nbsp;<span class="ident" id="3317833">v</span>&nbsp;<span class="op" id="3317835">==</span>&nbsp;<span class="builtintype" id="3317838">nil</span>&nbsp;<span class="op" id="3317842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317846">return</span>&nbsp;<span class="string" id="3317853">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317860">var</span>&nbsp;<span class="ident" id="3317864">buf</span>&nbsp;<span class="ident" id="3317868">bytes</span><span class="op" id="3317873">.</span><span class="ident" id="3317874">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317882">keys</span>&nbsp;<span class="op" id="3317887">:=</span>&nbsp;<span class="builtinfunc" id="3317890">make</span><span class="op" id="3317894">(</span><span class="op" id="3317895">[</span><span class="op" id="3317896">]</span><span class="builtintype" id="3317897">string</span><span class="op" id="3317903">,</span>&nbsp;<span class="num" id="3317905">0</span><span class="op" id="3317906">,</span>&nbsp;<span class="builtinfunc" id="3317908">len</span><span class="op" id="3317911">(</span><span class="ident" id="3317912">v</span><span class="op" id="3317913">)</span><span class="op" id="3317914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317917">for</span>&nbsp;<span class="ident" id="3317921">k</span>&nbsp;<span class="op" id="3317923">:=</span>&nbsp;<span class="keyword" id="3317926">range</span>&nbsp;<span class="ident" id="3317932">v</span>&nbsp;<span class="op" id="3317934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317938">keys</span>&nbsp;<span class="op" id="3317943">=</span>&nbsp;<span class="builtinfunc" id="3317945">append</span><span class="op" id="3317951">(</span><span class="ident" id="3317952">keys</span><span class="op" id="3317956">,</span>&nbsp;<span class="ident" id="3317958">k</span><span class="op" id="3317959">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317965">sort</span><span class="op" id="3317969">.</span><span class="ident" id="3317970">Strings</span><span class="op" id="3317977">(</span><span class="ident" id="3317978">keys</span><span class="op" id="3317982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317985">for</span>&nbsp;<span class="ident" id="3317989">_</span><span class="op" id="3317990">,</span>&nbsp;<span class="ident" id="3317992">k</span>&nbsp;<span class="op" id="3317994">:=</span>&nbsp;<span class="keyword" id="3317997">range</span>&nbsp;<span class="ident" id="3318003">keys</span>&nbsp;<span class="op" id="3318008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318012">vs</span>&nbsp;<span class="op" id="3318015">:=</span>&nbsp;<span class="ident" id="3318018">v</span><span class="op" id="3318019">[</span><span class="ident" id="3318020">k</span><span class="op" id="3318021">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318025">prefix</span>&nbsp;<span class="op" id="3318032">:=</span>&nbsp;<span class="ident" id="3318035">QueryEscape</span><span class="op" id="3318046">(</span><span class="ident" id="3318047">k</span><span class="op" id="3318048">)</span>&nbsp;<span class="op" id="3318050">+</span>&nbsp;<span class="string" id="3318052">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318058">for</span>&nbsp;<span class="ident" id="3318062">_</span><span class="op" id="3318063">,</span>&nbsp;<span class="ident" id="3318065">v</span>&nbsp;<span class="op" id="3318067">:=</span>&nbsp;<span class="keyword" id="3318070">range</span>&nbsp;<span class="ident" id="3318076">vs</span>&nbsp;<span class="op" id="3318079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318084">if</span>&nbsp;<span class="ident" id="3318087">buf</span><span class="op" id="3318090">.</span><span class="ident" id="3318091">Len</span><span class="op" id="3318094">(</span><span class="op" id="3318095">)</span>&nbsp;<span class="op" id="3318097">&gt;</span>&nbsp;<span class="num" id="3318099">0</span>&nbsp;<span class="op" id="3318101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318107">buf</span><span class="op" id="3318110">.</span><span class="ident" id="3318111">WriteByte</span><span class="op" id="3318120">(</span><span class="string" id="3318121">&#39;&amp;&#39;</span><span class="op" id="3318124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318134">buf</span><span class="op" id="3318137">.</span><span class="ident" id="3318138">WriteString</span><span class="op" id="3318149">(</span><span class="ident" id="3318150">prefix</span><span class="op" id="3318156">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318161">buf</span><span class="op" id="3318164">.</span><span class="ident" id="3318165">WriteString</span><span class="op" id="3318176">(</span><span class="ident" id="3318177">QueryEscape</span><span class="op" id="3318188">(</span><span class="ident" id="3318189">v</span><span class="op" id="3318190">)</span><span class="op" id="3318191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318201">return</span>&nbsp;<span class="ident" id="3318208">buf</span><span class="op" id="3318211">.</span><span class="ident" id="3318212">String</span><span class="op" id="3318218">(</span><span class="op" id="3318219">)</span><br>
<span class="lineno"></span><span class="op" id="3318221">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3318224">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3318291">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3318322">func</span>&nbsp;<span class="ident" id="3318327">resolvePath</span><span class="op" id="3318338">(</span><span class="ident" id="3318339">base</span><span class="op" id="3318343">,</span>&nbsp;<span class="ident" id="3318345">ref</span>&nbsp;<span class="builtintype" id="3318349">string</span><span class="op" id="3318355">)</span>&nbsp;<span class="builtintype" id="3318357">string</span>&nbsp;<span class="op" id="3318364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318367">var</span>&nbsp;<span class="ident" id="3318371">full</span>&nbsp;<span class="builtintype" id="3318376">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318384">if</span>&nbsp;<span class="ident" id="3318387">ref</span>&nbsp;<span class="op" id="3318391">==</span>&nbsp;<span class="string" id="3318394">&#34;&#34;</span>&nbsp;<span class="op" id="3318397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318401">full</span>&nbsp;<span class="op" id="3318406">=</span>&nbsp;<span class="ident" id="3318408">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318414">}</span>&nbsp;<span class="keyword" id="3318416">else</span>&nbsp;<span class="keyword" id="3318421">if</span>&nbsp;<span class="ident" id="3318424">ref</span><span class="op" id="3318427">[</span><span class="num" id="3318428">0</span><span class="op" id="3318429">]</span>&nbsp;<span class="op" id="3318431">!=</span>&nbsp;<span class="string" id="3318434">&#39;/&#39;</span>&nbsp;<span class="op" id="3318438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318442">i</span>&nbsp;<span class="op" id="3318444">:=</span>&nbsp;<span class="ident" id="3318447">strings</span><span class="op" id="3318454">.</span><span class="ident" id="3318455">LastIndex</span><span class="op" id="3318464">(</span><span class="ident" id="3318465">base</span><span class="op" id="3318469">,</span>&nbsp;<span class="string" id="3318471">&#34;/&#34;</span><span class="op" id="3318474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318478">full</span>&nbsp;<span class="op" id="3318483">=</span>&nbsp;<span class="ident" id="3318485">base</span><span class="op" id="3318489">[</span><span class="op" id="3318490">:</span><span class="ident" id="3318491">i</span><span class="op" id="3318492">+</span><span class="num" id="3318493">1</span><span class="op" id="3318494">]</span>&nbsp;<span class="op" id="3318496">+</span>&nbsp;<span class="ident" id="3318498">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318503">}</span>&nbsp;<span class="keyword" id="3318505">else</span>&nbsp;<span class="op" id="3318510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318514">full</span>&nbsp;<span class="op" id="3318519">=</span>&nbsp;<span class="ident" id="3318521">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318529">if</span>&nbsp;<span class="ident" id="3318532">full</span>&nbsp;<span class="op" id="3318537">==</span>&nbsp;<span class="string" id="3318540">&#34;&#34;</span>&nbsp;<span class="op" id="3318543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318547">return</span>&nbsp;<span class="string" id="3318554">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318561">var</span>&nbsp;<span class="ident" id="3318565">dst</span>&nbsp;<span class="op" id="3318569">[</span><span class="op" id="3318570">]</span><span class="builtintype" id="3318571">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318579">src</span>&nbsp;<span class="op" id="3318583">:=</span>&nbsp;<span class="ident" id="3318586">strings</span><span class="op" id="3318593">.</span><span class="ident" id="3318594">Split</span><span class="op" id="3318599">(</span><span class="ident" id="3318600">full</span><span class="op" id="3318604">,</span>&nbsp;<span class="string" id="3318606">&#34;/&#34;</span><span class="op" id="3318609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318612">for</span>&nbsp;<span class="ident" id="3318616">_</span><span class="op" id="3318617">,</span>&nbsp;<span class="ident" id="3318619">elem</span>&nbsp;<span class="op" id="3318624">:=</span>&nbsp;<span class="keyword" id="3318627">range</span>&nbsp;<span class="ident" id="3318633">src</span>&nbsp;<span class="op" id="3318637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318641">switch</span>&nbsp;<span class="ident" id="3318648">elem</span>&nbsp;<span class="op" id="3318653">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318657">case</span>&nbsp;<span class="string" id="3318662">&#34;.&#34;</span><span class="op" id="3318665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3318670">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318680">case</span>&nbsp;<span class="string" id="3318685">&#34;..&#34;</span><span class="op" id="3318689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318694">if</span>&nbsp;<span class="builtinfunc" id="3318697">len</span><span class="op" id="3318700">(</span><span class="ident" id="3318701">dst</span><span class="op" id="3318704">)</span>&nbsp;<span class="op" id="3318706">&gt;</span>&nbsp;<span class="num" id="3318708">0</span>&nbsp;<span class="op" id="3318710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318716">dst</span>&nbsp;<span class="op" id="3318720">=</span>&nbsp;<span class="ident" id="3318722">dst</span><span class="op" id="3318725">[</span><span class="op" id="3318726">:</span><span class="builtinfunc" id="3318727">len</span><span class="op" id="3318730">(</span><span class="ident" id="3318731">dst</span><span class="op" id="3318734">)</span><span class="op" id="3318735">-</span><span class="num" id="3318736">1</span><span class="op" id="3318737">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318746">default</span><span class="op" id="3318753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318758">dst</span>&nbsp;<span class="op" id="3318762">=</span>&nbsp;<span class="builtinfunc" id="3318764">append</span><span class="op" id="3318770">(</span><span class="ident" id="3318771">dst</span><span class="op" id="3318774">,</span>&nbsp;<span class="ident" id="3318776">elem</span><span class="op" id="3318780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318787">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318790">if</span>&nbsp;<span class="ident" id="3318793">last</span>&nbsp;<span class="op" id="3318798">:=</span>&nbsp;<span class="ident" id="3318801">src</span><span class="op" id="3318804">[</span><span class="builtinfunc" id="3318805">len</span><span class="op" id="3318808">(</span><span class="ident" id="3318809">src</span><span class="op" id="3318812">)</span><span class="op" id="3318813">-</span><span class="num" id="3318814">1</span><span class="op" id="3318815">]</span><span class="op" id="3318816">;</span>&nbsp;<span class="ident" id="3318818">last</span>&nbsp;<span class="op" id="3318823">==</span>&nbsp;<span class="string" id="3318826">&#34;.&#34;</span>&nbsp;<span class="op" id="3318830">||</span>&nbsp;<span class="ident" id="3318833">last</span>&nbsp;<span class="op" id="3318838">==</span>&nbsp;<span class="string" id="3318841">&#34;..&#34;</span>&nbsp;<span class="op" id="3318846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3318850">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318891">dst</span>&nbsp;<span class="op" id="3318895">=</span>&nbsp;<span class="builtinfunc" id="3318897">append</span><span class="op" id="3318903">(</span><span class="ident" id="3318904">dst</span><span class="op" id="3318907">,</span>&nbsp;<span class="string" id="3318909">&#34;&#34;</span><span class="op" id="3318911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318917">return</span>&nbsp;<span class="string" id="3318924">&#34;/&#34;</span>&nbsp;<span class="op" id="3318928">+</span>&nbsp;<span class="ident" id="3318930">strings</span><span class="op" id="3318937">.</span><span class="ident" id="3318938">TrimLeft</span><span class="op" id="3318946">(</span><span class="ident" id="3318947">strings</span><span class="op" id="3318954">.</span><span class="ident" id="3318955">Join</span><span class="op" id="3318959">(</span><span class="ident" id="3318960">dst</span><span class="op" id="3318963">,</span>&nbsp;<span class="string" id="3318965">&#34;/&#34;</span><span class="op" id="3318968">)</span><span class="op" id="3318969">,</span>&nbsp;<span class="string" id="3318971">&#34;/&#34;</span><span class="op" id="3318974">)</span><br>
<span class="lineno">640</span><span class="op" id="3318976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3318979">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3319025">func</span>&nbsp;<span class="op" id="3319030">(</span><span class="ident" id="3319031">u</span>&nbsp;<span class="op" id="3319033">*</span><span class="ident" id="3319034">URL</span><span class="op" id="3319037">)</span>&nbsp;<span class="ident" id="3319039">IsAbs</span><span class="op" id="3319044">(</span><span class="op" id="3319045">)</span>&nbsp;<span class="builtintype" id="3319047">bool</span>&nbsp;<span class="op" id="3319052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319055">return</span>&nbsp;<span class="ident" id="3319062">u</span><span class="op" id="3319063">.</span><span class="ident" id="3319064">Scheme</span>&nbsp;<span class="op" id="3319071">!=</span>&nbsp;<span class="string" id="3319074">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3319077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319080">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3319152">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3319217">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3319289">func</span>&nbsp;<span class="op" id="3319294">(</span><span class="ident" id="3319295">u</span>&nbsp;<span class="op" id="3319297">*</span><span class="ident" id="3319298">URL</span><span class="op" id="3319301">)</span>&nbsp;<span class="ident" id="3319303">Parse</span><span class="op" id="3319308">(</span><span class="ident" id="3319309">ref</span>&nbsp;<span class="builtintype" id="3319313">string</span><span class="op" id="3319319">)</span>&nbsp;<span class="op" id="3319321">(</span><span class="op" id="3319322">*</span><span class="ident" id="3319323">URL</span><span class="op" id="3319326">,</span>&nbsp;<span class="builtintype" id="3319328">error</span><span class="op" id="3319333">)</span>&nbsp;<span class="op" id="3319335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319338">refurl</span><span class="op" id="3319344">,</span>&nbsp;<span class="ident" id="3319346">err</span>&nbsp;<span class="op" id="3319350">:=</span>&nbsp;<span class="ident" id="3319353">Parse</span><span class="op" id="3319358">(</span><span class="ident" id="3319359">ref</span><span class="op" id="3319362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319365">if</span>&nbsp;<span class="ident" id="3319368">err</span>&nbsp;<span class="op" id="3319372">!=</span>&nbsp;<span class="builtintype" id="3319375">nil</span>&nbsp;<span class="op" id="3319379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319383">return</span>&nbsp;<span class="builtintype" id="3319390">nil</span><span class="op" id="3319393">,</span>&nbsp;<span class="ident" id="3319395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319400">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319403">return</span>&nbsp;<span class="ident" id="3319410">u</span><span class="op" id="3319411">.</span><span class="ident" id="3319412">ResolveReference</span><span class="op" id="3319428">(</span><span class="ident" id="3319429">refurl</span><span class="op" id="3319435">)</span><span class="op" id="3319436">,</span>&nbsp;<span class="builtintype" id="3319438">nil</span><br>
<span class="lineno"></span><span class="op" id="3319442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319445">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3319514">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3319584">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3319655">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3319724">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3319795">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3319838">func</span>&nbsp;<span class="op" id="3319843">(</span><span class="ident" id="3319844">u</span>&nbsp;<span class="op" id="3319846">*</span><span class="ident" id="3319847">URL</span><span class="op" id="3319850">)</span>&nbsp;<span class="ident" id="3319852">ResolveReference</span><span class="op" id="3319868">(</span><span class="ident" id="3319869">ref</span>&nbsp;<span class="op" id="3319873">*</span><span class="ident" id="3319874">URL</span><span class="op" id="3319877">)</span>&nbsp;<span class="op" id="3319879">*</span><span class="ident" id="3319880">URL</span>&nbsp;<span class="op" id="3319884">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319887">url</span>&nbsp;<span class="op" id="3319891">:=</span>&nbsp;<span class="op" id="3319894">*</span><span class="ident" id="3319895">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319900">if</span>&nbsp;<span class="ident" id="3319903">ref</span><span class="op" id="3319906">.</span><span class="ident" id="3319907">Scheme</span>&nbsp;<span class="op" id="3319914">==</span>&nbsp;<span class="string" id="3319917">&#34;&#34;</span>&nbsp;<span class="op" id="3319920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319924">url</span><span class="op" id="3319927">.</span><span class="ident" id="3319928">Scheme</span>&nbsp;<span class="op" id="3319935">=</span>&nbsp;<span class="ident" id="3319937">u</span><span class="op" id="3319938">.</span><span class="ident" id="3319939">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319950">if</span>&nbsp;<span class="ident" id="3319953">ref</span><span class="op" id="3319956">.</span><span class="ident" id="3319957">Scheme</span>&nbsp;<span class="op" id="3319964">!=</span>&nbsp;<span class="string" id="3319967">&#34;&#34;</span>&nbsp;<span class="op" id="3319970">||</span>&nbsp;<span class="ident" id="3319973">ref</span><span class="op" id="3319976">.</span><span class="ident" id="3319977">Host</span>&nbsp;<span class="op" id="3319982">!=</span>&nbsp;<span class="string" id="3319985">&#34;&#34;</span>&nbsp;<span class="op" id="3319988">||</span>&nbsp;<span class="ident" id="3319991">ref</span><span class="op" id="3319994">.</span><span class="ident" id="3319995">User</span>&nbsp;<span class="op" id="3320000">!=</span>&nbsp;<span class="builtintype" id="3320003">nil</span>&nbsp;<span class="op" id="3320007">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3320011">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320055">url</span><span class="op" id="3320058">.</span><span class="ident" id="3320059">Path</span>&nbsp;<span class="op" id="3320064">=</span>&nbsp;<span class="ident" id="3320066">resolvePath</span><span class="op" id="3320077">(</span><span class="ident" id="3320078">ref</span><span class="op" id="3320081">.</span><span class="ident" id="3320082">Path</span><span class="op" id="3320086">,</span>&nbsp;<span class="string" id="3320088">&#34;&#34;</span><span class="op" id="3320090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320094">return</span>&nbsp;<span class="op" id="3320101">&amp;</span><span class="ident" id="3320102">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320110">if</span>&nbsp;<span class="ident" id="3320113">ref</span><span class="op" id="3320116">.</span><span class="ident" id="3320117">Opaque</span>&nbsp;<span class="op" id="3320124">!=</span>&nbsp;<span class="string" id="3320127">&#34;&#34;</span>&nbsp;<span class="op" id="3320130">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320134">url</span><span class="op" id="3320137">.</span><span class="ident" id="3320138">User</span>&nbsp;<span class="op" id="3320143">=</span>&nbsp;<span class="builtintype" id="3320145">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320151">url</span><span class="op" id="3320154">.</span><span class="ident" id="3320155">Host</span>&nbsp;<span class="op" id="3320160">=</span>&nbsp;<span class="string" id="3320162">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320167">url</span><span class="op" id="3320170">.</span><span class="ident" id="3320171">Path</span>&nbsp;<span class="op" id="3320176">=</span>&nbsp;<span class="string" id="3320178">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320183">return</span>&nbsp;<span class="op" id="3320190">&amp;</span><span class="ident" id="3320191">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320196">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320199">if</span>&nbsp;<span class="ident" id="3320202">ref</span><span class="op" id="3320205">.</span><span class="ident" id="3320206">Path</span>&nbsp;<span class="op" id="3320211">==</span>&nbsp;<span class="string" id="3320214">&#34;&#34;</span>&nbsp;<span class="op" id="3320217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320221">if</span>&nbsp;<span class="ident" id="3320224">ref</span><span class="op" id="3320227">.</span><span class="ident" id="3320228">RawQuery</span>&nbsp;<span class="op" id="3320237">==</span>&nbsp;<span class="string" id="3320240">&#34;&#34;</span>&nbsp;<span class="op" id="3320243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320248">url</span><span class="op" id="3320251">.</span><span class="ident" id="3320252">RawQuery</span>&nbsp;<span class="op" id="3320261">=</span>&nbsp;<span class="ident" id="3320263">u</span><span class="op" id="3320264">.</span><span class="ident" id="3320265">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320277">if</span>&nbsp;<span class="ident" id="3320280">ref</span><span class="op" id="3320283">.</span><span class="ident" id="3320284">Fragment</span>&nbsp;<span class="op" id="3320293">==</span>&nbsp;<span class="string" id="3320296">&#34;&#34;</span>&nbsp;<span class="op" id="3320299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320305">url</span><span class="op" id="3320308">.</span><span class="ident" id="3320309">Fragment</span>&nbsp;<span class="op" id="3320318">=</span>&nbsp;<span class="ident" id="3320320">u</span><span class="op" id="3320321">.</span><span class="ident" id="3320322">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3320344">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320384">url</span><span class="op" id="3320387">.</span><span class="ident" id="3320388">Host</span>&nbsp;<span class="op" id="3320393">=</span>&nbsp;<span class="ident" id="3320395">u</span><span class="op" id="3320396">.</span><span class="ident" id="3320397">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320403">url</span><span class="op" id="3320406">.</span><span class="ident" id="3320407">User</span>&nbsp;<span class="op" id="3320412">=</span>&nbsp;<span class="ident" id="3320414">u</span><span class="op" id="3320415">.</span><span class="ident" id="3320416">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320422">url</span><span class="op" id="3320425">.</span><span class="ident" id="3320426">Path</span>&nbsp;<span class="op" id="3320431">=</span>&nbsp;<span class="ident" id="3320433">resolvePath</span><span class="op" id="3320444">(</span><span class="ident" id="3320445">u</span><span class="op" id="3320446">.</span><span class="ident" id="3320447">Path</span><span class="op" id="3320451">,</span>&nbsp;<span class="ident" id="3320453">ref</span><span class="op" id="3320456">.</span><span class="ident" id="3320457">Path</span><span class="op" id="3320461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320464">return</span>&nbsp;<span class="op" id="3320471">&amp;</span><span class="ident" id="3320472">url</span><br>
<span class="lineno"></span><span class="op" id="3320476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3320479">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3320542">func</span>&nbsp;<span class="op" id="3320547">(</span><span class="ident" id="3320548">u</span>&nbsp;<span class="op" id="3320550">*</span><span class="ident" id="3320551">URL</span><span class="op" id="3320554">)</span>&nbsp;<span class="ident" id="3320556">Query</span><span class="op" id="3320561">(</span><span class="op" id="3320562">)</span>&nbsp;<span class="ident" id="3320564">Values</span>&nbsp;<span class="op" id="3320571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320574">v</span><span class="op" id="3320575">,</span>&nbsp;<span class="ident" id="3320577">_</span>&nbsp;<span class="op" id="3320579">:=</span>&nbsp;<span class="ident" id="3320582">ParseQuery</span><span class="op" id="3320592">(</span><span class="ident" id="3320593">u</span><span class="op" id="3320594">.</span><span class="ident" id="3320595">RawQuery</span><span class="op" id="3320603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320606">return</span>&nbsp;<span class="ident" id="3320613">v</span><br>
<span class="lineno"></span><span class="op" id="3320615">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3320618">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3320679">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3320734">func</span>&nbsp;<span class="op" id="3320739">(</span><span class="ident" id="3320740">u</span>&nbsp;<span class="op" id="3320742">*</span><span class="ident" id="3320743">URL</span><span class="op" id="3320746">)</span>&nbsp;<span class="ident" id="3320748">RequestURI</span><span class="op" id="3320758">(</span><span class="op" id="3320759">)</span>&nbsp;<span class="builtintype" id="3320761">string</span>&nbsp;<span class="op" id="3320768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320771">result</span>&nbsp;<span class="op" id="3320778">:=</span>&nbsp;<span class="ident" id="3320781">u</span><span class="op" id="3320782">.</span><span class="ident" id="3320783">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320791">if</span>&nbsp;<span class="ident" id="3320794">result</span>&nbsp;<span class="op" id="3320801">==</span>&nbsp;<span class="string" id="3320804">&#34;&#34;</span>&nbsp;<span class="op" id="3320807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320811">result</span>&nbsp;<span class="op" id="3320818">=</span>&nbsp;<span class="ident" id="3320820">escape</span><span class="op" id="3320826">(</span><span class="ident" id="3320827">u</span><span class="op" id="3320828">.</span><span class="ident" id="3320829">Path</span><span class="op" id="3320833">,</span>&nbsp;<span class="ident" id="3320835">encodePath</span><span class="op" id="3320845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320849">if</span>&nbsp;<span class="ident" id="3320852">result</span>&nbsp;<span class="op" id="3320859">==</span>&nbsp;<span class="string" id="3320862">&#34;&#34;</span>&nbsp;<span class="op" id="3320865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320870">result</span>&nbsp;<span class="op" id="3320877">=</span>&nbsp;<span class="string" id="3320879">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320885">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320888">}</span>&nbsp;<span class="keyword" id="3320890">else</span>&nbsp;<span class="op" id="3320895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320899">if</span>&nbsp;<span class="ident" id="3320902">strings</span><span class="op" id="3320909">.</span><span class="ident" id="3320910">HasPrefix</span><span class="op" id="3320919">(</span><span class="ident" id="3320920">result</span><span class="op" id="3320926">,</span>&nbsp;<span class="string" id="3320928">&#34;//&#34;</span><span class="op" id="3320932">)</span>&nbsp;<span class="op" id="3320934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320939">result</span>&nbsp;<span class="op" id="3320946">=</span>&nbsp;<span class="ident" id="3320948">u</span><span class="op" id="3320949">.</span><span class="ident" id="3320950">Scheme</span>&nbsp;<span class="op" id="3320957">+</span>&nbsp;<span class="string" id="3320959">&#34;:&#34;</span>&nbsp;<span class="op" id="3320963">+</span>&nbsp;<span class="ident" id="3320965">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320977">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320980">if</span>&nbsp;<span class="ident" id="3320983">u</span><span class="op" id="3320984">.</span><span class="ident" id="3320985">RawQuery</span>&nbsp;<span class="op" id="3320994">!=</span>&nbsp;<span class="string" id="3320997">&#34;&#34;</span>&nbsp;<span class="op" id="3321000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321004">result</span>&nbsp;<span class="op" id="3321011">+=</span>&nbsp;<span class="string" id="3321014">&#34;?&#34;</span>&nbsp;<span class="op" id="3321018">+</span>&nbsp;<span class="ident" id="3321020">u</span><span class="op" id="3321021">.</span><span class="ident" id="3321022">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321035">return</span>&nbsp;<span class="ident" id="3321042">result</span><br>
<span class="lineno"></span><span class="op" id="3321049">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
