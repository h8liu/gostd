<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5357195">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5357250">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5357304">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5357355">package</span>&nbsp;<span class="ident" id="5357363">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5357369">import</span>&nbsp;<span class="op" id="5357376">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5357379">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5357397">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5357404">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5357412">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5357428">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5357433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5357436">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5357516">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5357582">const</span>&nbsp;<span class="op" id="5357588">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357591">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357610">=</span>&nbsp;<span class="ident" id="5357612">flate</span><span class="op" id="5357617">.</span><span class="ident" id="5357618">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357633">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357652">=</span>&nbsp;<span class="ident" id="5357654">flate</span><span class="op" id="5357659">.</span><span class="ident" id="5357660">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357671">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357690">=</span>&nbsp;<span class="ident" id="5357692">flate</span><span class="op" id="5357697">.</span><span class="ident" id="5357698">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357715">DefaultCompression</span>&nbsp;<span class="op" id="5357734">=</span>&nbsp;<span class="ident" id="5357736">flate</span><span class="op" id="5357741">.</span><span class="ident" id="5357742">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5357761">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5357764">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5357827">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5357889">type</span>&nbsp;<span class="ident" id="5357894">Writer</span>&nbsp;<span class="keyword" id="5357901">struct</span>&nbsp;<span class="op" id="5357908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357911">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357923">io</span><span class="op" id="5357925">.</span><span class="ident" id="5357926">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357934">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5357946">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357951">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357963">[</span><span class="op" id="5357964">]</span><span class="builtintype" id="5357965">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357971">compressor</span>&nbsp;&nbsp;<span class="op" id="5357983">*</span><span class="ident" id="5357984">flate</span><span class="op" id="5357989">.</span><span class="ident" id="5357990">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5357998">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358010">hash</span><span class="op" id="5358014">.</span><span class="ident" id="5358015">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5358023">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5358035">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5358042">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358054">[</span><span class="num" id="5358055">4</span><span class="op" id="5358056">]</span><span class="builtintype" id="5358057">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5358063">wroteHeader</span>&nbsp;<span class="builtintype" id="5358075">bool</span><br>
<span class="lineno">35</span><span class="op" id="5358080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5358083">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5358118">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5358184">//</span><br>
<span class="lineno">40</span><span class="comment" id="5358187">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5358268">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5358323">func</span>&nbsp;<span class="ident" id="5358328">NewWriter</span><span class="op" id="5358337">(</span><span class="ident" id="5358338">w</span>&nbsp;<span class="ident" id="5358340">io</span><span class="op" id="5358342">.</span><span class="ident" id="5358343">Writer</span><span class="op" id="5358349">)</span>&nbsp;<span class="op" id="5358351">*</span><span class="ident" id="5358352">Writer</span>&nbsp;<span class="op" id="5358359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5358362">z</span><span class="op" id="5358363">,</span>&nbsp;<span class="ident" id="5358365">_</span>&nbsp;<span class="op" id="5358367">:=</span>&nbsp;<span class="ident" id="5358370">NewWriterLevelDict</span><span class="op" id="5358388">(</span><span class="ident" id="5358389">w</span><span class="op" id="5358390">,</span>&nbsp;<span class="ident" id="5358392">DefaultCompression</span><span class="op" id="5358410">,</span>&nbsp;<span class="ident" id="5358412">nil</span><span class="op" id="5358415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5358418">return</span>&nbsp;<span class="ident" id="5358425">z</span><br>
<span class="lineno">45</span><span class="op" id="5358427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5358430">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5358510">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5358545">//</span><br>
<span class="lineno">50</span><span class="comment" id="5358548">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5358622">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5358698">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5358745">func</span>&nbsp;<span class="ident" id="5358750">NewWriterLevel</span><span class="op" id="5358764">(</span><span class="ident" id="5358765">w</span>&nbsp;<span class="ident" id="5358767">io</span><span class="op" id="5358769">.</span><span class="ident" id="5358770">Writer</span><span class="op" id="5358776">,</span>&nbsp;<span class="ident" id="5358778">level</span>&nbsp;<span class="builtintype" id="5358784">int</span><span class="op" id="5358787">)</span>&nbsp;<span class="op" id="5358789">(</span><span class="op" id="5358790">*</span><span class="ident" id="5358791">Writer</span><span class="op" id="5358797">,</span>&nbsp;<span class="builtintype" id="5358799">error</span><span class="op" id="5358804">)</span>&nbsp;<span class="op" id="5358806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5358809">return</span>&nbsp;<span class="ident" id="5358816">NewWriterLevelDict</span><span class="op" id="5358834">(</span><span class="ident" id="5358835">w</span><span class="op" id="5358836">,</span>&nbsp;<span class="ident" id="5358838">level</span><span class="op" id="5358843">,</span>&nbsp;<span class="ident" id="5358845">nil</span><span class="op" id="5358848">)</span><br>
<span class="lineno">55</span><span class="op" id="5358850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5358853">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5358928">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5358946">//</span><br>
<span class="lineno">60</span><span class="comment" id="5358949">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5359029">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5359054">func</span>&nbsp;<span class="ident" id="5359059">NewWriterLevelDict</span><span class="op" id="5359077">(</span><span class="ident" id="5359078">w</span>&nbsp;<span class="ident" id="5359080">io</span><span class="op" id="5359082">.</span><span class="ident" id="5359083">Writer</span><span class="op" id="5359089">,</span>&nbsp;<span class="ident" id="5359091">level</span>&nbsp;<span class="builtintype" id="5359097">int</span><span class="op" id="5359100">,</span>&nbsp;<span class="ident" id="5359102">dict</span>&nbsp;<span class="op" id="5359107">[</span><span class="op" id="5359108">]</span><span class="builtintype" id="5359109">byte</span><span class="op" id="5359113">)</span>&nbsp;<span class="op" id="5359115">(</span><span class="op" id="5359116">*</span><span class="ident" id="5359117">Writer</span><span class="op" id="5359123">,</span>&nbsp;<span class="builtintype" id="5359125">error</span><span class="op" id="5359130">)</span>&nbsp;<span class="op" id="5359132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5359135">if</span>&nbsp;<span class="ident" id="5359138">level</span>&nbsp;<span class="op" id="5359144">&lt;</span>&nbsp;<span class="ident" id="5359146">DefaultCompression</span>&nbsp;<span class="op" id="5359165">||</span>&nbsp;<span class="ident" id="5359168">level</span>&nbsp;<span class="op" id="5359174">&gt;</span>&nbsp;<span class="ident" id="5359176">BestCompression</span>&nbsp;<span class="op" id="5359192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5359196">return</span>&nbsp;<span class="ident" id="5359203">nil</span><span class="op" id="5359206">,</span>&nbsp;<span class="ident" id="5359208">fmt</span><span class="op" id="5359211">.</span><span class="ident" id="5359212">Errorf</span><span class="op" id="5359218">(</span><span class="string" id="5359219">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5359256">,</span>&nbsp;<span class="ident" id="5359258">level</span><span class="op" id="5359263">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5359266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5359269">return</span>&nbsp;<span class="op" id="5359276">&amp;</span><span class="ident" id="5359277">Writer</span><span class="op" id="5359283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359287">w</span><span class="op" id="5359288">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359294">w</span><span class="op" id="5359295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359299">level</span><span class="op" id="5359304">:</span>&nbsp;<span class="ident" id="5359306">level</span><span class="op" id="5359311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359315">dict</span><span class="op" id="5359319">:</span>&nbsp;&nbsp;<span class="ident" id="5359322">dict</span><span class="op" id="5359326">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5359329">}</span><span class="op" id="5359330">,</span>&nbsp;<span class="ident" id="5359332">nil</span><br>
<span class="lineno"></span><span class="op" id="5359336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5359339">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5359415">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5359495">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5359504">func</span>&nbsp;<span class="op" id="5359509">(</span><span class="ident" id="5359510">z</span>&nbsp;<span class="op" id="5359512">*</span><span class="ident" id="5359513">Writer</span><span class="op" id="5359519">)</span>&nbsp;<span class="ident" id="5359521">Reset</span><span class="op" id="5359526">(</span><span class="ident" id="5359527">w</span>&nbsp;<span class="ident" id="5359529">io</span><span class="op" id="5359531">.</span><span class="ident" id="5359532">Writer</span><span class="op" id="5359538">)</span>&nbsp;<span class="op" id="5359540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359543">z</span><span class="op" id="5359544">.</span><span class="ident" id="5359545">w</span>&nbsp;<span class="op" id="5359547">=</span>&nbsp;<span class="ident" id="5359549">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5359552">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5359591">if</span>&nbsp;<span class="ident" id="5359594">z</span><span class="op" id="5359595">.</span><span class="ident" id="5359596">compressor</span>&nbsp;<span class="op" id="5359607">!=</span>&nbsp;<span class="ident" id="5359610">nil</span>&nbsp;<span class="op" id="5359614">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359618">z</span><span class="op" id="5359619">.</span><span class="ident" id="5359620">compressor</span><span class="op" id="5359630">.</span><span class="ident" id="5359631">Reset</span><span class="op" id="5359636">(</span><span class="ident" id="5359637">w</span><span class="op" id="5359638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5359641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5359644">if</span>&nbsp;<span class="ident" id="5359647">z</span><span class="op" id="5359648">.</span><span class="ident" id="5359649">digest</span>&nbsp;<span class="op" id="5359656">!=</span>&nbsp;<span class="ident" id="5359659">nil</span>&nbsp;<span class="op" id="5359663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359667">z</span><span class="op" id="5359668">.</span><span class="ident" id="5359669">digest</span><span class="op" id="5359675">.</span><span class="ident" id="5359676">Reset</span><span class="op" id="5359681">(</span><span class="op" id="5359682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5359685">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359688">z</span><span class="op" id="5359689">.</span><span class="ident" id="5359690">err</span>&nbsp;<span class="op" id="5359694">=</span>&nbsp;<span class="ident" id="5359696">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359701">z</span><span class="op" id="5359702">.</span><span class="ident" id="5359703">scratch</span>&nbsp;<span class="op" id="5359711">=</span>&nbsp;<span class="op" id="5359713">[</span><span class="num" id="5359714">4</span><span class="op" id="5359715">]</span><span class="builtintype" id="5359716">byte</span><span class="op" id="5359720">{</span><span class="op" id="5359721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359724">z</span><span class="op" id="5359725">.</span><span class="ident" id="5359726">wroteHeader</span>&nbsp;<span class="op" id="5359738">=</span>&nbsp;<span class="builtintype" id="5359740">false</span><br>
<span class="lineno"></span><span class="op" id="5359746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5359749">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5359788">func</span>&nbsp;<span class="op" id="5359793">(</span><span class="ident" id="5359794">z</span>&nbsp;<span class="op" id="5359796">*</span><span class="ident" id="5359797">Writer</span><span class="op" id="5359803">)</span>&nbsp;<span class="ident" id="5359805">writeHeader</span><span class="op" id="5359816">(</span><span class="op" id="5359817">)</span>&nbsp;<span class="op" id="5359819">(</span><span class="ident" id="5359820">err</span>&nbsp;<span class="builtintype" id="5359824">error</span><span class="op" id="5359829">)</span>&nbsp;<span class="op" id="5359831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5359834">z</span><span class="op" id="5359835">.</span><span class="ident" id="5359836">wroteHeader</span>&nbsp;<span class="op" id="5359848">=</span>&nbsp;<span class="builtintype" id="5359850">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5359856">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5359916">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5360021">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360100">z</span><span class="op" id="5360101">.</span><span class="ident" id="5360102">scratch</span><span class="op" id="5360109">[</span><span class="num" id="5360110">0</span><span class="op" id="5360111">]</span>&nbsp;<span class="op" id="5360113">=</span>&nbsp;<span class="num" id="5360115">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5360121">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5360199">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5360241">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5360299">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360354">switch</span>&nbsp;<span class="ident" id="5360361">z</span><span class="op" id="5360362">.</span><span class="ident" id="5360363">level</span>&nbsp;<span class="op" id="5360369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360372">case</span>&nbsp;<span class="num" id="5360377">0</span><span class="op" id="5360378">,</span>&nbsp;<span class="num" id="5360380">1</span><span class="op" id="5360381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360385">z</span><span class="op" id="5360386">.</span><span class="ident" id="5360387">scratch</span><span class="op" id="5360394">[</span><span class="num" id="5360395">1</span><span class="op" id="5360396">]</span>&nbsp;<span class="op" id="5360398">=</span>&nbsp;<span class="num" id="5360400">0</span>&nbsp;<span class="op" id="5360402">&lt;&lt;</span>&nbsp;<span class="num" id="5360405">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360408">case</span>&nbsp;<span class="num" id="5360413">2</span><span class="op" id="5360414">,</span>&nbsp;<span class="num" id="5360416">3</span><span class="op" id="5360417">,</span>&nbsp;<span class="num" id="5360419">4</span><span class="op" id="5360420">,</span>&nbsp;<span class="num" id="5360422">5</span><span class="op" id="5360423">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360427">z</span><span class="op" id="5360428">.</span><span class="ident" id="5360429">scratch</span><span class="op" id="5360436">[</span><span class="num" id="5360437">1</span><span class="op" id="5360438">]</span>&nbsp;<span class="op" id="5360440">=</span>&nbsp;<span class="num" id="5360442">1</span>&nbsp;<span class="op" id="5360444">&lt;&lt;</span>&nbsp;<span class="num" id="5360447">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360450">case</span>&nbsp;<span class="num" id="5360455">6</span><span class="op" id="5360456">,</span>&nbsp;<span class="op" id="5360458">-</span><span class="num" id="5360459">1</span><span class="op" id="5360460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360464">z</span><span class="op" id="5360465">.</span><span class="ident" id="5360466">scratch</span><span class="op" id="5360473">[</span><span class="num" id="5360474">1</span><span class="op" id="5360475">]</span>&nbsp;<span class="op" id="5360477">=</span>&nbsp;<span class="num" id="5360479">2</span>&nbsp;<span class="op" id="5360481">&lt;&lt;</span>&nbsp;<span class="num" id="5360484">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360487">case</span>&nbsp;<span class="num" id="5360492">7</span><span class="op" id="5360493">,</span>&nbsp;<span class="num" id="5360495">8</span><span class="op" id="5360496">,</span>&nbsp;<span class="num" id="5360498">9</span><span class="op" id="5360499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360503">z</span><span class="op" id="5360504">.</span><span class="ident" id="5360505">scratch</span><span class="op" id="5360512">[</span><span class="num" id="5360513">1</span><span class="op" id="5360514">]</span>&nbsp;<span class="op" id="5360516">=</span>&nbsp;<span class="num" id="5360518">3</span>&nbsp;<span class="op" id="5360520">&lt;&lt;</span>&nbsp;<span class="num" id="5360523">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360526">default</span><span class="op" id="5360533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5360537">panic</span><span class="op" id="5360542">(</span><span class="string" id="5360543">&#34;unreachable&#34;</span><span class="op" id="5360556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5360559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360562">if</span>&nbsp;<span class="ident" id="5360565">z</span><span class="op" id="5360566">.</span><span class="ident" id="5360567">dict</span>&nbsp;<span class="op" id="5360572">!=</span>&nbsp;<span class="ident" id="5360575">nil</span>&nbsp;<span class="op" id="5360579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360583">z</span><span class="op" id="5360584">.</span><span class="ident" id="5360585">scratch</span><span class="op" id="5360592">[</span><span class="num" id="5360593">1</span><span class="op" id="5360594">]</span>&nbsp;<span class="op" id="5360596">|=</span>&nbsp;<span class="num" id="5360599">1</span>&nbsp;<span class="op" id="5360601">&lt;&lt;</span>&nbsp;<span class="num" id="5360604">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5360607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360610">z</span><span class="op" id="5360611">.</span><span class="ident" id="5360612">scratch</span><span class="op" id="5360619">[</span><span class="num" id="5360620">1</span><span class="op" id="5360621">]</span>&nbsp;<span class="op" id="5360623">+=</span>&nbsp;<span class="builtintype" id="5360626">uint8</span><span class="op" id="5360631">(</span><span class="num" id="5360632">31</span>&nbsp;<span class="op" id="5360635">-</span>&nbsp;<span class="op" id="5360637">(</span><span class="builtintype" id="5360638">uint16</span><span class="op" id="5360644">(</span><span class="ident" id="5360645">z</span><span class="op" id="5360646">.</span><span class="ident" id="5360647">scratch</span><span class="op" id="5360654">[</span><span class="num" id="5360655">0</span><span class="op" id="5360656">]</span><span class="op" id="5360657">)</span><span class="op" id="5360658">&lt;&lt;</span><span class="num" id="5360660">8</span><span class="op" id="5360661">+</span><span class="builtintype" id="5360662">uint16</span><span class="op" id="5360668">(</span><span class="ident" id="5360669">z</span><span class="op" id="5360670">.</span><span class="ident" id="5360671">scratch</span><span class="op" id="5360678">[</span><span class="num" id="5360679">1</span><span class="op" id="5360680">]</span><span class="op" id="5360681">)</span><span class="op" id="5360682">)</span><span class="op" id="5360683">%</span><span class="num" id="5360684">31</span><span class="op" id="5360686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360689">if</span>&nbsp;<span class="ident" id="5360692">_</span><span class="op" id="5360693">,</span>&nbsp;<span class="ident" id="5360695">err</span>&nbsp;<span class="op" id="5360699">=</span>&nbsp;<span class="ident" id="5360701">z</span><span class="op" id="5360702">.</span><span class="ident" id="5360703">w</span><span class="op" id="5360704">.</span><span class="ident" id="5360705">Write</span><span class="op" id="5360710">(</span><span class="ident" id="5360711">z</span><span class="op" id="5360712">.</span><span class="ident" id="5360713">scratch</span><span class="op" id="5360720">[</span><span class="num" id="5360721">0</span><span class="op" id="5360722">:</span><span class="num" id="5360723">2</span><span class="op" id="5360724">]</span><span class="op" id="5360725">)</span><span class="op" id="5360726">;</span>&nbsp;<span class="ident" id="5360728">err</span>&nbsp;<span class="op" id="5360732">!=</span>&nbsp;<span class="ident" id="5360735">nil</span>&nbsp;<span class="op" id="5360739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360743">return</span>&nbsp;<span class="ident" id="5360750">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5360755">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360758">if</span>&nbsp;<span class="ident" id="5360761">z</span><span class="op" id="5360762">.</span><span class="ident" id="5360763">dict</span>&nbsp;<span class="op" id="5360768">!=</span>&nbsp;<span class="ident" id="5360771">nil</span>&nbsp;<span class="op" id="5360775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5360779">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360849">checksum</span>&nbsp;<span class="op" id="5360858">:=</span>&nbsp;<span class="ident" id="5360861">adler32</span><span class="op" id="5360868">.</span><span class="ident" id="5360869">Checksum</span><span class="op" id="5360877">(</span><span class="ident" id="5360878">z</span><span class="op" id="5360879">.</span><span class="ident" id="5360880">dict</span><span class="op" id="5360884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360888">z</span><span class="op" id="5360889">.</span><span class="ident" id="5360890">scratch</span><span class="op" id="5360897">[</span><span class="num" id="5360898">0</span><span class="op" id="5360899">]</span>&nbsp;<span class="op" id="5360901">=</span>&nbsp;<span class="builtintype" id="5360903">uint8</span><span class="op" id="5360908">(</span><span class="ident" id="5360909">checksum</span>&nbsp;<span class="op" id="5360918">&gt;&gt;</span>&nbsp;<span class="num" id="5360921">24</span><span class="op" id="5360923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360927">z</span><span class="op" id="5360928">.</span><span class="ident" id="5360929">scratch</span><span class="op" id="5360936">[</span><span class="num" id="5360937">1</span><span class="op" id="5360938">]</span>&nbsp;<span class="op" id="5360940">=</span>&nbsp;<span class="builtintype" id="5360942">uint8</span><span class="op" id="5360947">(</span><span class="ident" id="5360948">checksum</span>&nbsp;<span class="op" id="5360957">&gt;&gt;</span>&nbsp;<span class="num" id="5360960">16</span><span class="op" id="5360962">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360966">z</span><span class="op" id="5360967">.</span><span class="ident" id="5360968">scratch</span><span class="op" id="5360975">[</span><span class="num" id="5360976">2</span><span class="op" id="5360977">]</span>&nbsp;<span class="op" id="5360979">=</span>&nbsp;<span class="builtintype" id="5360981">uint8</span><span class="op" id="5360986">(</span><span class="ident" id="5360987">checksum</span>&nbsp;<span class="op" id="5360996">&gt;&gt;</span>&nbsp;<span class="num" id="5360999">8</span><span class="op" id="5361000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361004">z</span><span class="op" id="5361005">.</span><span class="ident" id="5361006">scratch</span><span class="op" id="5361013">[</span><span class="num" id="5361014">3</span><span class="op" id="5361015">]</span>&nbsp;<span class="op" id="5361017">=</span>&nbsp;<span class="builtintype" id="5361019">uint8</span><span class="op" id="5361024">(</span><span class="ident" id="5361025">checksum</span>&nbsp;<span class="op" id="5361034">&gt;&gt;</span>&nbsp;<span class="num" id="5361037">0</span><span class="op" id="5361038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361042">if</span>&nbsp;<span class="ident" id="5361045">_</span><span class="op" id="5361046">,</span>&nbsp;<span class="ident" id="5361048">err</span>&nbsp;<span class="op" id="5361052">=</span>&nbsp;<span class="ident" id="5361054">z</span><span class="op" id="5361055">.</span><span class="ident" id="5361056">w</span><span class="op" id="5361057">.</span><span class="ident" id="5361058">Write</span><span class="op" id="5361063">(</span><span class="ident" id="5361064">z</span><span class="op" id="5361065">.</span><span class="ident" id="5361066">scratch</span><span class="op" id="5361073">[</span><span class="num" id="5361074">0</span><span class="op" id="5361075">:</span><span class="num" id="5361076">4</span><span class="op" id="5361077">]</span><span class="op" id="5361078">)</span><span class="op" id="5361079">;</span>&nbsp;<span class="ident" id="5361081">err</span>&nbsp;<span class="op" id="5361085">!=</span>&nbsp;<span class="ident" id="5361088">nil</span>&nbsp;<span class="op" id="5361092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361097">return</span>&nbsp;<span class="ident" id="5361104">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361110">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361116">if</span>&nbsp;<span class="ident" id="5361119">z</span><span class="op" id="5361120">.</span><span class="ident" id="5361121">compressor</span>&nbsp;<span class="op" id="5361132">==</span>&nbsp;<span class="ident" id="5361135">nil</span>&nbsp;<span class="op" id="5361139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5361143">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5361202">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361227">z</span><span class="op" id="5361228">.</span><span class="ident" id="5361229">compressor</span><span class="op" id="5361239">,</span>&nbsp;<span class="ident" id="5361241">err</span>&nbsp;<span class="op" id="5361245">=</span>&nbsp;<span class="ident" id="5361247">flate</span><span class="op" id="5361252">.</span><span class="ident" id="5361253">NewWriterDict</span><span class="op" id="5361266">(</span><span class="ident" id="5361267">z</span><span class="op" id="5361268">.</span><span class="ident" id="5361269">w</span><span class="op" id="5361270">,</span>&nbsp;<span class="ident" id="5361272">z</span><span class="op" id="5361273">.</span><span class="ident" id="5361274">level</span><span class="op" id="5361279">,</span>&nbsp;<span class="ident" id="5361281">z</span><span class="op" id="5361282">.</span><span class="ident" id="5361283">dict</span><span class="op" id="5361287">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361291">if</span>&nbsp;<span class="ident" id="5361294">err</span>&nbsp;<span class="op" id="5361298">!=</span>&nbsp;<span class="ident" id="5361301">nil</span>&nbsp;<span class="op" id="5361305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361310">return</span>&nbsp;<span class="ident" id="5361317">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361327">z</span><span class="op" id="5361328">.</span><span class="ident" id="5361329">digest</span>&nbsp;<span class="op" id="5361336">=</span>&nbsp;<span class="ident" id="5361338">adler32</span><span class="op" id="5361345">.</span><span class="ident" id="5361346">New</span><span class="op" id="5361349">(</span><span class="op" id="5361350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361353">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361356">return</span>&nbsp;<span class="ident" id="5361363">nil</span><br>
<span class="lineno"></span><span class="op" id="5361367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5361370">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5361442">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5361520">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5361543">func</span>&nbsp;<span class="op" id="5361548">(</span><span class="ident" id="5361549">z</span>&nbsp;<span class="op" id="5361551">*</span><span class="ident" id="5361552">Writer</span><span class="op" id="5361558">)</span>&nbsp;<span class="ident" id="5361560">Write</span><span class="op" id="5361565">(</span><span class="ident" id="5361566">p</span>&nbsp;<span class="op" id="5361568">[</span><span class="op" id="5361569">]</span><span class="builtintype" id="5361570">byte</span><span class="op" id="5361574">)</span>&nbsp;<span class="op" id="5361576">(</span><span class="ident" id="5361577">n</span>&nbsp;<span class="builtintype" id="5361579">int</span><span class="op" id="5361582">,</span>&nbsp;<span class="ident" id="5361584">err</span>&nbsp;<span class="builtintype" id="5361588">error</span><span class="op" id="5361593">)</span>&nbsp;<span class="op" id="5361595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361598">if</span>&nbsp;<span class="op" id="5361601">!</span><span class="ident" id="5361602">z</span><span class="op" id="5361603">.</span><span class="ident" id="5361604">wroteHeader</span>&nbsp;<span class="op" id="5361616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361620">z</span><span class="op" id="5361621">.</span><span class="ident" id="5361622">err</span>&nbsp;<span class="op" id="5361626">=</span>&nbsp;<span class="ident" id="5361628">z</span><span class="op" id="5361629">.</span><span class="ident" id="5361630">writeHeader</span><span class="op" id="5361641">(</span><span class="op" id="5361642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361645">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361648">if</span>&nbsp;<span class="ident" id="5361651">z</span><span class="op" id="5361652">.</span><span class="ident" id="5361653">err</span>&nbsp;<span class="op" id="5361657">!=</span>&nbsp;<span class="ident" id="5361660">nil</span>&nbsp;<span class="op" id="5361664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361668">return</span>&nbsp;<span class="num" id="5361675">0</span><span class="op" id="5361676">,</span>&nbsp;<span class="ident" id="5361678">z</span><span class="op" id="5361679">.</span><span class="ident" id="5361680">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361688">if</span>&nbsp;<span class="builtinfunc" id="5361691">len</span><span class="op" id="5361694">(</span><span class="ident" id="5361695">p</span><span class="op" id="5361696">)</span>&nbsp;<span class="op" id="5361698">==</span>&nbsp;<span class="num" id="5361701">0</span>&nbsp;<span class="op" id="5361703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361707">return</span>&nbsp;<span class="num" id="5361714">0</span><span class="op" id="5361715">,</span>&nbsp;<span class="ident" id="5361717">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361725">n</span><span class="op" id="5361726">,</span>&nbsp;<span class="ident" id="5361728">err</span>&nbsp;<span class="op" id="5361732">=</span>&nbsp;<span class="ident" id="5361734">z</span><span class="op" id="5361735">.</span><span class="ident" id="5361736">compressor</span><span class="op" id="5361746">.</span><span class="ident" id="5361747">Write</span><span class="op" id="5361752">(</span><span class="ident" id="5361753">p</span><span class="op" id="5361754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361757">if</span>&nbsp;<span class="ident" id="5361760">err</span>&nbsp;<span class="op" id="5361764">!=</span>&nbsp;<span class="ident" id="5361767">nil</span>&nbsp;<span class="op" id="5361771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361775">z</span><span class="op" id="5361776">.</span><span class="ident" id="5361777">err</span>&nbsp;<span class="op" id="5361781">=</span>&nbsp;<span class="ident" id="5361783">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361789">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361800">z</span><span class="op" id="5361801">.</span><span class="ident" id="5361802">digest</span><span class="op" id="5361808">.</span><span class="ident" id="5361809">Write</span><span class="op" id="5361814">(</span><span class="ident" id="5361815">p</span><span class="op" id="5361816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361819">return</span><br>
<span class="lineno"></span><span class="op" id="5361826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5361829">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5361886">func</span>&nbsp;<span class="op" id="5361891">(</span><span class="ident" id="5361892">z</span>&nbsp;<span class="op" id="5361894">*</span><span class="ident" id="5361895">Writer</span><span class="op" id="5361901">)</span>&nbsp;<span class="ident" id="5361903">Flush</span><span class="op" id="5361908">(</span><span class="op" id="5361909">)</span>&nbsp;<span class="builtintype" id="5361911">error</span>&nbsp;<span class="op" id="5361917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361920">if</span>&nbsp;<span class="op" id="5361923">!</span><span class="ident" id="5361924">z</span><span class="op" id="5361925">.</span><span class="ident" id="5361926">wroteHeader</span>&nbsp;<span class="op" id="5361938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361942">z</span><span class="op" id="5361943">.</span><span class="ident" id="5361944">err</span>&nbsp;<span class="op" id="5361948">=</span>&nbsp;<span class="ident" id="5361950">z</span><span class="op" id="5361951">.</span><span class="ident" id="5361952">writeHeader</span><span class="op" id="5361963">(</span><span class="op" id="5361964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361967">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361970">if</span>&nbsp;<span class="ident" id="5361973">z</span><span class="op" id="5361974">.</span><span class="ident" id="5361975">err</span>&nbsp;<span class="op" id="5361979">!=</span>&nbsp;<span class="ident" id="5361982">nil</span>&nbsp;<span class="op" id="5361986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361990">return</span>&nbsp;<span class="ident" id="5361997">z</span><span class="op" id="5361998">.</span><span class="ident" id="5361999">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362007">z</span><span class="op" id="5362008">.</span><span class="ident" id="5362009">err</span>&nbsp;<span class="op" id="5362013">=</span>&nbsp;<span class="ident" id="5362015">z</span><span class="op" id="5362016">.</span><span class="ident" id="5362017">compressor</span><span class="op" id="5362027">.</span><span class="ident" id="5362028">Flush</span><span class="op" id="5362033">(</span><span class="op" id="5362034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362037">return</span>&nbsp;<span class="ident" id="5362044">z</span><span class="op" id="5362045">.</span><span class="ident" id="5362046">err</span><br>
<span class="lineno">175</span><span class="op" id="5362050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5362053">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5362127">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5362186">func</span>&nbsp;<span class="op" id="5362191">(</span><span class="ident" id="5362192">z</span>&nbsp;<span class="op" id="5362194">*</span><span class="ident" id="5362195">Writer</span><span class="op" id="5362201">)</span>&nbsp;<span class="ident" id="5362203">Close</span><span class="op" id="5362208">(</span><span class="op" id="5362209">)</span>&nbsp;<span class="builtintype" id="5362211">error</span>&nbsp;<span class="op" id="5362217">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362220">if</span>&nbsp;<span class="op" id="5362223">!</span><span class="ident" id="5362224">z</span><span class="op" id="5362225">.</span><span class="ident" id="5362226">wroteHeader</span>&nbsp;<span class="op" id="5362238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362242">z</span><span class="op" id="5362243">.</span><span class="ident" id="5362244">err</span>&nbsp;<span class="op" id="5362248">=</span>&nbsp;<span class="ident" id="5362250">z</span><span class="op" id="5362251">.</span><span class="ident" id="5362252">writeHeader</span><span class="op" id="5362263">(</span><span class="op" id="5362264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362270">if</span>&nbsp;<span class="ident" id="5362273">z</span><span class="op" id="5362274">.</span><span class="ident" id="5362275">err</span>&nbsp;<span class="op" id="5362279">!=</span>&nbsp;<span class="ident" id="5362282">nil</span>&nbsp;<span class="op" id="5362286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362290">return</span>&nbsp;<span class="ident" id="5362297">z</span><span class="op" id="5362298">.</span><span class="ident" id="5362299">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362307">z</span><span class="op" id="5362308">.</span><span class="ident" id="5362309">err</span>&nbsp;<span class="op" id="5362313">=</span>&nbsp;<span class="ident" id="5362315">z</span><span class="op" id="5362316">.</span><span class="ident" id="5362317">compressor</span><span class="op" id="5362327">.</span><span class="ident" id="5362328">Close</span><span class="op" id="5362333">(</span><span class="op" id="5362334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362337">if</span>&nbsp;<span class="ident" id="5362340">z</span><span class="op" id="5362341">.</span><span class="ident" id="5362342">err</span>&nbsp;<span class="op" id="5362346">!=</span>&nbsp;<span class="ident" id="5362349">nil</span>&nbsp;<span class="op" id="5362353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362357">return</span>&nbsp;<span class="ident" id="5362364">z</span><span class="op" id="5362365">.</span><span class="ident" id="5362366">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362371">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362374">checksum</span>&nbsp;<span class="op" id="5362383">:=</span>&nbsp;<span class="ident" id="5362386">z</span><span class="op" id="5362387">.</span><span class="ident" id="5362388">digest</span><span class="op" id="5362394">.</span><span class="ident" id="5362395">Sum32</span><span class="op" id="5362400">(</span><span class="op" id="5362401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362404">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362463">z</span><span class="op" id="5362464">.</span><span class="ident" id="5362465">scratch</span><span class="op" id="5362472">[</span><span class="num" id="5362473">0</span><span class="op" id="5362474">]</span>&nbsp;<span class="op" id="5362476">=</span>&nbsp;<span class="builtintype" id="5362478">uint8</span><span class="op" id="5362483">(</span><span class="ident" id="5362484">checksum</span>&nbsp;<span class="op" id="5362493">&gt;&gt;</span>&nbsp;<span class="num" id="5362496">24</span><span class="op" id="5362498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362501">z</span><span class="op" id="5362502">.</span><span class="ident" id="5362503">scratch</span><span class="op" id="5362510">[</span><span class="num" id="5362511">1</span><span class="op" id="5362512">]</span>&nbsp;<span class="op" id="5362514">=</span>&nbsp;<span class="builtintype" id="5362516">uint8</span><span class="op" id="5362521">(</span><span class="ident" id="5362522">checksum</span>&nbsp;<span class="op" id="5362531">&gt;&gt;</span>&nbsp;<span class="num" id="5362534">16</span><span class="op" id="5362536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362539">z</span><span class="op" id="5362540">.</span><span class="ident" id="5362541">scratch</span><span class="op" id="5362548">[</span><span class="num" id="5362549">2</span><span class="op" id="5362550">]</span>&nbsp;<span class="op" id="5362552">=</span>&nbsp;<span class="builtintype" id="5362554">uint8</span><span class="op" id="5362559">(</span><span class="ident" id="5362560">checksum</span>&nbsp;<span class="op" id="5362569">&gt;&gt;</span>&nbsp;<span class="num" id="5362572">8</span><span class="op" id="5362573">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362576">z</span><span class="op" id="5362577">.</span><span class="ident" id="5362578">scratch</span><span class="op" id="5362585">[</span><span class="num" id="5362586">3</span><span class="op" id="5362587">]</span>&nbsp;<span class="op" id="5362589">=</span>&nbsp;<span class="builtintype" id="5362591">uint8</span><span class="op" id="5362596">(</span><span class="ident" id="5362597">checksum</span>&nbsp;<span class="op" id="5362606">&gt;&gt;</span>&nbsp;<span class="num" id="5362609">0</span><span class="op" id="5362610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362613">_</span><span class="op" id="5362614">,</span>&nbsp;<span class="ident" id="5362616">z</span><span class="op" id="5362617">.</span><span class="ident" id="5362618">err</span>&nbsp;<span class="op" id="5362622">=</span>&nbsp;<span class="ident" id="5362624">z</span><span class="op" id="5362625">.</span><span class="ident" id="5362626">w</span><span class="op" id="5362627">.</span><span class="ident" id="5362628">Write</span><span class="op" id="5362633">(</span><span class="ident" id="5362634">z</span><span class="op" id="5362635">.</span><span class="ident" id="5362636">scratch</span><span class="op" id="5362643">[</span><span class="num" id="5362644">0</span><span class="op" id="5362645">:</span><span class="num" id="5362646">4</span><span class="op" id="5362647">]</span><span class="op" id="5362648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362651">return</span>&nbsp;<span class="ident" id="5362658">z</span><span class="op" id="5362659">.</span><span class="ident" id="5362660">err</span><br>
<span class="lineno"></span><span class="op" id="5362664">}</span>
</div>
</body>
</html>
