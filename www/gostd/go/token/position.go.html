<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1411152">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1411207">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1411261">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1411312">package</span>&nbsp;<span class="ident" id="1411320">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1411327">import</span>&nbsp;<span class="op" id="1411334">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1411337">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1411344">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1411352">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1411359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1411362">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="1411443">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="1411457">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="1411508">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="1411558">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="1411608">//</span><br>
<span class="lineno">20</span><span class="keyword" id="1411611">type</span>&nbsp;<span class="ident" id="1411616">Position</span>&nbsp;<span class="keyword" id="1411625">struct</span>&nbsp;<span class="op" id="1411632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411635">Filename</span>&nbsp;<span class="builtintype" id="1411644">string</span>&nbsp;<span class="comment" id="1411651">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411672">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1411681">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1411688">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411714">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1411723">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1411730">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411761">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1411770">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1411777">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="1411827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1411830">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="1411880">func</span>&nbsp;<span class="op" id="1411885">(</span><span class="ident" id="1411886">pos</span>&nbsp;<span class="op" id="1411890">*</span><span class="ident" id="1411891">Position</span><span class="op" id="1411899">)</span>&nbsp;<span class="ident" id="1411901">IsValid</span><span class="op" id="1411908">(</span><span class="op" id="1411909">)</span>&nbsp;<span class="builtintype" id="1411911">bool</span>&nbsp;<span class="op" id="1411916">{</span>&nbsp;<span class="keyword" id="1411918">return</span>&nbsp;<span class="ident" id="1411925">pos</span><span class="op" id="1411928">.</span><span class="ident" id="1411929">Line</span>&nbsp;<span class="op" id="1411934">&gt;</span>&nbsp;<span class="num" id="1411936">0</span>&nbsp;<span class="op" id="1411938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="1411941">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="1411993">//</span><br>
<span class="lineno"></span><span class="comment" id="1411996">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="1412049">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="1412105">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="1412160">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="1412218">//</span><br>
<span class="lineno"></span><span class="keyword" id="1412221">func</span>&nbsp;<span class="op" id="1412226">(</span><span class="ident" id="1412227">pos</span>&nbsp;<span class="ident" id="1412231">Position</span><span class="op" id="1412239">)</span>&nbsp;<span class="ident" id="1412241">String</span><span class="op" id="1412247">(</span><span class="op" id="1412248">)</span>&nbsp;<span class="builtintype" id="1412250">string</span>&nbsp;<span class="op" id="1412257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412260">s</span>&nbsp;<span class="op" id="1412262">:=</span>&nbsp;<span class="ident" id="1412265">pos</span><span class="op" id="1412268">.</span><span class="ident" id="1412269">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1412279">if</span>&nbsp;<span class="ident" id="1412282">pos</span><span class="op" id="1412285">.</span><span class="ident" id="1412286">IsValid</span><span class="op" id="1412293">(</span><span class="op" id="1412294">)</span>&nbsp;<span class="op" id="1412296">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1412300">if</span>&nbsp;<span class="ident" id="1412303">s</span>&nbsp;<span class="op" id="1412305">!=</span>&nbsp;<span class="string" id="1412308">&#34;&#34;</span>&nbsp;<span class="op" id="1412311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412316">s</span>&nbsp;<span class="op" id="1412318">+=</span>&nbsp;<span class="string" id="1412321">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1412327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412331">s</span>&nbsp;<span class="op" id="1412333">+=</span>&nbsp;<span class="ident" id="1412336">fmt</span><span class="op" id="1412339">.</span><span class="ident" id="1412340">Sprintf</span><span class="op" id="1412347">(</span><span class="string" id="1412348">&#34;%d:%d&#34;</span><span class="op" id="1412355">,</span>&nbsp;<span class="ident" id="1412357">pos</span><span class="op" id="1412360">.</span><span class="ident" id="1412361">Line</span><span class="op" id="1412365">,</span>&nbsp;<span class="ident" id="1412367">pos</span><span class="op" id="1412370">.</span><span class="ident" id="1412371">Column</span><span class="op" id="1412377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1412380">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1412383">if</span>&nbsp;<span class="ident" id="1412386">s</span>&nbsp;<span class="op" id="1412388">==</span>&nbsp;<span class="string" id="1412391">&#34;&#34;</span>&nbsp;<span class="op" id="1412394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412398">s</span>&nbsp;<span class="op" id="1412400">=</span>&nbsp;<span class="string" id="1412402">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1412407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1412410">return</span>&nbsp;<span class="ident" id="1412417">s</span><br>
<span class="lineno"></span><span class="op" id="1412419">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="1412422">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="1412491">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="1412562">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="1412589">//</span><br>
<span class="lineno">55</span><span class="comment" id="1412592">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="1412670">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="1412748">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="1412760">//</span><br>
<span class="lineno"></span><span class="comment" id="1412763">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="1412830">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="1412899">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="1412968">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1413037">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="1413078">//</span><br>
<span class="lineno">65</span><span class="comment" id="1413081">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="1413157">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1413229">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="1413303">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="1413379">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="1413439">//</span><br>
<span class="lineno"></span><span class="keyword" id="1413442">type</span>&nbsp;<span class="ident" id="1413447">Pos</span>&nbsp;<span class="builtintype" id="1413451">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1413456">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="1413530">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="1413601">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="1413671">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="1413716">//</span><br>
<span class="lineno"></span><span class="keyword" id="1413719">const</span>&nbsp;<span class="ident" id="1413725">NoPos</span>&nbsp;<span class="ident" id="1413731">Pos</span>&nbsp;<span class="op" id="1413735">=</span>&nbsp;<span class="num" id="1413737">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="1413740">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="1413790">func</span>&nbsp;<span class="op" id="1413795">(</span><span class="ident" id="1413796">p</span>&nbsp;<span class="ident" id="1413798">Pos</span><span class="op" id="1413801">)</span>&nbsp;<span class="ident" id="1413803">IsValid</span><span class="op" id="1413810">(</span><span class="op" id="1413811">)</span>&nbsp;<span class="builtintype" id="1413813">bool</span>&nbsp;<span class="op" id="1413818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1413821">return</span>&nbsp;<span class="ident" id="1413828">p</span>&nbsp;<span class="op" id="1413830">!=</span>&nbsp;<span class="ident" id="1413833">NoPos</span><br>
<span class="lineno"></span><span class="op" id="1413839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1413842">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="1413923">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1413932">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="1413989">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="1414040">//</span><br>
<span class="lineno"></span><span class="keyword" id="1414043">type</span>&nbsp;<span class="ident" id="1414048">File</span>&nbsp;<span class="keyword" id="1414053">struct</span>&nbsp;<span class="op" id="1414060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414063">set</span>&nbsp;&nbsp;<span class="op" id="1414068">*</span><span class="ident" id="1414069">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414078">name</span>&nbsp;<span class="builtintype" id="1414083">string</span>&nbsp;<span class="comment" id="1414090">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414127">base</span>&nbsp;<span class="builtintype" id="1414132">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1414139">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414195">size</span>&nbsp;<span class="builtintype" id="1414200">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1414207">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1414245">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414292">lines</span>&nbsp;<span class="op" id="1414298">[</span><span class="op" id="1414299">]</span><span class="builtintype" id="1414300">int</span>&nbsp;<span class="comment" id="1414304">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414401">infos</span>&nbsp;<span class="op" id="1414407">[</span><span class="op" id="1414408">]</span><span class="ident" id="1414409">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="1414418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414421">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="1414489">func</span>&nbsp;<span class="op" id="1414494">(</span><span class="ident" id="1414495">f</span>&nbsp;<span class="op" id="1414497">*</span><span class="ident" id="1414498">File</span><span class="op" id="1414502">)</span>&nbsp;<span class="ident" id="1414504">Name</span><span class="op" id="1414508">(</span><span class="op" id="1414509">)</span>&nbsp;<span class="builtintype" id="1414511">string</span>&nbsp;<span class="op" id="1414518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414521">return</span>&nbsp;<span class="ident" id="1414528">f</span><span class="op" id="1414529">.</span><span class="ident" id="1414530">name</span><br>
<span class="lineno">105</span><span class="op" id="1414535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414538">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="1414608">func</span>&nbsp;<span class="op" id="1414613">(</span><span class="ident" id="1414614">f</span>&nbsp;<span class="op" id="1414616">*</span><span class="ident" id="1414617">File</span><span class="op" id="1414621">)</span>&nbsp;<span class="ident" id="1414623">Base</span><span class="op" id="1414627">(</span><span class="op" id="1414628">)</span>&nbsp;<span class="builtintype" id="1414630">int</span>&nbsp;<span class="op" id="1414634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414637">return</span>&nbsp;<span class="ident" id="1414644">f</span><span class="op" id="1414645">.</span><span class="ident" id="1414646">base</span><br>
<span class="lineno">110</span><span class="op" id="1414651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414654">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="1414717">func</span>&nbsp;<span class="op" id="1414722">(</span><span class="ident" id="1414723">f</span>&nbsp;<span class="op" id="1414725">*</span><span class="ident" id="1414726">File</span><span class="op" id="1414730">)</span>&nbsp;<span class="ident" id="1414732">Size</span><span class="op" id="1414736">(</span><span class="op" id="1414737">)</span>&nbsp;<span class="builtintype" id="1414739">int</span>&nbsp;<span class="op" id="1414743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414746">return</span>&nbsp;<span class="ident" id="1414753">f</span><span class="op" id="1414754">.</span><span class="ident" id="1414755">size</span><br>
<span class="lineno">115</span><span class="op" id="1414760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414763">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="1414815">func</span>&nbsp;<span class="op" id="1414820">(</span><span class="ident" id="1414821">f</span>&nbsp;<span class="op" id="1414823">*</span><span class="ident" id="1414824">File</span><span class="op" id="1414828">)</span>&nbsp;<span class="ident" id="1414830">LineCount</span><span class="op" id="1414839">(</span><span class="op" id="1414840">)</span>&nbsp;<span class="builtintype" id="1414842">int</span>&nbsp;<span class="op" id="1414846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414849">f</span><span class="op" id="1414850">.</span><span class="ident" id="1414851">set</span><span class="op" id="1414854">.</span><span class="ident" id="1414855">mutex</span><span class="op" id="1414860">.</span><span class="ident" id="1414861">RLock</span><span class="op" id="1414866">(</span><span class="op" id="1414867">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414870">n</span>&nbsp;<span class="op" id="1414872">:=</span>&nbsp;<span class="builtinfunc" id="1414875">len</span><span class="op" id="1414878">(</span><span class="ident" id="1414879">f</span><span class="op" id="1414880">.</span><span class="ident" id="1414881">lines</span><span class="op" id="1414886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414889">f</span><span class="op" id="1414890">.</span><span class="ident" id="1414891">set</span><span class="op" id="1414894">.</span><span class="ident" id="1414895">mutex</span><span class="op" id="1414900">.</span><span class="ident" id="1414901">RUnlock</span><span class="op" id="1414908">(</span><span class="op" id="1414909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414912">return</span>&nbsp;<span class="ident" id="1414919">n</span><br>
<span class="lineno"></span><span class="op" id="1414921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1414924">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="1414972">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="1415044">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1415117">//</span><br>
<span class="lineno"></span><span class="keyword" id="1415120">func</span>&nbsp;<span class="op" id="1415125">(</span><span class="ident" id="1415126">f</span>&nbsp;<span class="op" id="1415128">*</span><span class="ident" id="1415129">File</span><span class="op" id="1415133">)</span>&nbsp;<span class="ident" id="1415135">AddLine</span><span class="op" id="1415142">(</span><span class="ident" id="1415143">offset</span>&nbsp;<span class="builtintype" id="1415150">int</span><span class="op" id="1415153">)</span>&nbsp;<span class="op" id="1415155">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415158">f</span><span class="op" id="1415159">.</span><span class="ident" id="1415160">set</span><span class="op" id="1415163">.</span><span class="ident" id="1415164">mutex</span><span class="op" id="1415169">.</span><span class="ident" id="1415170">Lock</span><span class="op" id="1415174">(</span><span class="op" id="1415175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415178">if</span>&nbsp;<span class="ident" id="1415181">i</span>&nbsp;<span class="op" id="1415183">:=</span>&nbsp;<span class="builtinfunc" id="1415186">len</span><span class="op" id="1415189">(</span><span class="ident" id="1415190">f</span><span class="op" id="1415191">.</span><span class="ident" id="1415192">lines</span><span class="op" id="1415197">)</span><span class="op" id="1415198">;</span>&nbsp;<span class="op" id="1415200">(</span><span class="ident" id="1415201">i</span>&nbsp;<span class="op" id="1415203">==</span>&nbsp;<span class="num" id="1415206">0</span>&nbsp;<span class="op" id="1415208">||</span>&nbsp;<span class="ident" id="1415211">f</span><span class="op" id="1415212">.</span><span class="ident" id="1415213">lines</span><span class="op" id="1415218">[</span><span class="ident" id="1415219">i</span><span class="op" id="1415220">-</span><span class="num" id="1415221">1</span><span class="op" id="1415222">]</span>&nbsp;<span class="op" id="1415224">&lt;</span>&nbsp;<span class="ident" id="1415226">offset</span><span class="op" id="1415232">)</span>&nbsp;<span class="op" id="1415234">&amp;&amp;</span>&nbsp;<span class="ident" id="1415237">offset</span>&nbsp;<span class="op" id="1415244">&lt;</span>&nbsp;<span class="ident" id="1415246">f</span><span class="op" id="1415247">.</span><span class="ident" id="1415248">size</span>&nbsp;<span class="op" id="1415253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415257">f</span><span class="op" id="1415258">.</span><span class="ident" id="1415259">lines</span>&nbsp;<span class="op" id="1415265">=</span>&nbsp;<span class="builtinfunc" id="1415267">append</span><span class="op" id="1415273">(</span><span class="ident" id="1415274">f</span><span class="op" id="1415275">.</span><span class="ident" id="1415276">lines</span><span class="op" id="1415281">,</span>&nbsp;<span class="ident" id="1415283">offset</span><span class="op" id="1415289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415295">f</span><span class="op" id="1415296">.</span><span class="ident" id="1415297">set</span><span class="op" id="1415300">.</span><span class="ident" id="1415301">mutex</span><span class="op" id="1415306">.</span><span class="ident" id="1415307">Unlock</span><span class="op" id="1415313">(</span><span class="op" id="1415314">)</span><br>
<span class="lineno">135</span><span class="op" id="1415316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1415319">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="1415395">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1415475">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="1415553">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="1415610">//</span><br>
<span class="lineno"></span><span class="keyword" id="1415613">func</span>&nbsp;<span class="op" id="1415618">(</span><span class="ident" id="1415619">f</span>&nbsp;<span class="op" id="1415621">*</span><span class="ident" id="1415622">File</span><span class="op" id="1415626">)</span>&nbsp;<span class="ident" id="1415628">MergeLine</span><span class="op" id="1415637">(</span><span class="ident" id="1415638">line</span>&nbsp;<span class="builtintype" id="1415643">int</span><span class="op" id="1415646">)</span>&nbsp;<span class="op" id="1415648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415651">if</span>&nbsp;<span class="ident" id="1415654">line</span>&nbsp;<span class="op" id="1415659">&lt;=</span>&nbsp;<span class="num" id="1415662">0</span>&nbsp;<span class="op" id="1415664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1415668">panic</span><span class="op" id="1415673">(</span><span class="string" id="1415674">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="1415724">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415730">f</span><span class="op" id="1415731">.</span><span class="ident" id="1415732">set</span><span class="op" id="1415735">.</span><span class="ident" id="1415736">mutex</span><span class="op" id="1415741">.</span><span class="ident" id="1415742">Lock</span><span class="op" id="1415746">(</span><span class="op" id="1415747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415750">defer</span>&nbsp;<span class="ident" id="1415756">f</span><span class="op" id="1415757">.</span><span class="ident" id="1415758">set</span><span class="op" id="1415761">.</span><span class="ident" id="1415762">mutex</span><span class="op" id="1415767">.</span><span class="ident" id="1415768">Unlock</span><span class="op" id="1415774">(</span><span class="op" id="1415775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415778">if</span>&nbsp;<span class="ident" id="1415781">line</span>&nbsp;<span class="op" id="1415786">&gt;=</span>&nbsp;<span class="builtinfunc" id="1415789">len</span><span class="op" id="1415792">(</span><span class="ident" id="1415793">f</span><span class="op" id="1415794">.</span><span class="ident" id="1415795">lines</span><span class="op" id="1415800">)</span>&nbsp;<span class="op" id="1415802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1415806">panic</span><span class="op" id="1415811">(</span><span class="string" id="1415812">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="1415833">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1415839">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1415910">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1415977">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1416045">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1416118">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1416164">copy</span><span class="op" id="1416168">(</span><span class="ident" id="1416169">f</span><span class="op" id="1416170">.</span><span class="ident" id="1416171">lines</span><span class="op" id="1416176">[</span><span class="ident" id="1416177">line</span><span class="op" id="1416181">:</span><span class="op" id="1416182">]</span><span class="op" id="1416183">,</span>&nbsp;<span class="ident" id="1416185">f</span><span class="op" id="1416186">.</span><span class="ident" id="1416187">lines</span><span class="op" id="1416192">[</span><span class="ident" id="1416193">line</span><span class="op" id="1416197">+</span><span class="num" id="1416198">1</span><span class="op" id="1416199">:</span><span class="op" id="1416200">]</span><span class="op" id="1416201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416204">f</span><span class="op" id="1416205">.</span><span class="ident" id="1416206">lines</span>&nbsp;<span class="op" id="1416212">=</span>&nbsp;<span class="ident" id="1416214">f</span><span class="op" id="1416215">.</span><span class="ident" id="1416216">lines</span><span class="op" id="1416221">[</span><span class="op" id="1416222">:</span><span class="builtinfunc" id="1416223">len</span><span class="op" id="1416226">(</span><span class="ident" id="1416227">f</span><span class="op" id="1416228">.</span><span class="ident" id="1416229">lines</span><span class="op" id="1416234">)</span><span class="op" id="1416235">-</span><span class="num" id="1416236">1</span><span class="op" id="1416237">]</span><br>
<span class="lineno"></span><span class="op" id="1416239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="1416242">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="1416319">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="1416392">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="1416463">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="1416512">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="1416585">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="1416657">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1416667">//</span><br>
<span class="lineno"></span><span class="keyword" id="1416670">func</span>&nbsp;<span class="op" id="1416675">(</span><span class="ident" id="1416676">f</span>&nbsp;<span class="op" id="1416678">*</span><span class="ident" id="1416679">File</span><span class="op" id="1416683">)</span>&nbsp;<span class="ident" id="1416685">SetLines</span><span class="op" id="1416693">(</span><span class="ident" id="1416694">lines</span>&nbsp;<span class="op" id="1416700">[</span><span class="op" id="1416701">]</span><span class="builtintype" id="1416702">int</span><span class="op" id="1416705">)</span>&nbsp;<span class="builtintype" id="1416707">bool</span>&nbsp;<span class="op" id="1416712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1416715">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416750">size</span>&nbsp;<span class="op" id="1416755">:=</span>&nbsp;<span class="ident" id="1416758">f</span><span class="op" id="1416759">.</span><span class="ident" id="1416760">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416766">for</span>&nbsp;<span class="ident" id="1416770">i</span><span class="op" id="1416771">,</span>&nbsp;<span class="ident" id="1416773">offset</span>&nbsp;<span class="op" id="1416780">:=</span>&nbsp;<span class="keyword" id="1416783">range</span>&nbsp;<span class="ident" id="1416789">lines</span>&nbsp;<span class="op" id="1416795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416799">if</span>&nbsp;<span class="ident" id="1416802">i</span>&nbsp;<span class="op" id="1416804">&gt;</span>&nbsp;<span class="num" id="1416806">0</span>&nbsp;<span class="op" id="1416808">&amp;&amp;</span>&nbsp;<span class="ident" id="1416811">offset</span>&nbsp;<span class="op" id="1416818">&lt;=</span>&nbsp;<span class="ident" id="1416821">lines</span><span class="op" id="1416826">[</span><span class="ident" id="1416827">i</span><span class="op" id="1416828">-</span><span class="num" id="1416829">1</span><span class="op" id="1416830">]</span>&nbsp;<span class="op" id="1416832">||</span>&nbsp;<span class="ident" id="1416835">size</span>&nbsp;<span class="op" id="1416840">&lt;=</span>&nbsp;<span class="ident" id="1416843">offset</span>&nbsp;<span class="op" id="1416850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416855">return</span>&nbsp;<span class="builtintype" id="1416862">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1416870">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1416873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1416877">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416897">f</span><span class="op" id="1416898">.</span><span class="ident" id="1416899">set</span><span class="op" id="1416902">.</span><span class="ident" id="1416903">mutex</span><span class="op" id="1416908">.</span><span class="ident" id="1416909">Lock</span><span class="op" id="1416913">(</span><span class="op" id="1416914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416917">f</span><span class="op" id="1416918">.</span><span class="ident" id="1416919">lines</span>&nbsp;<span class="op" id="1416925">=</span>&nbsp;<span class="ident" id="1416927">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416934">f</span><span class="op" id="1416935">.</span><span class="ident" id="1416936">set</span><span class="op" id="1416939">.</span><span class="ident" id="1416940">mutex</span><span class="op" id="1416945">.</span><span class="ident" id="1416946">Unlock</span><span class="op" id="1416952">(</span><span class="op" id="1416953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416956">return</span>&nbsp;<span class="builtintype" id="1416963">true</span><br>
<span class="lineno"></span><span class="op" id="1416968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1416971">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="1417043">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="1417092">func</span>&nbsp;<span class="op" id="1417097">(</span><span class="ident" id="1417098">f</span>&nbsp;<span class="op" id="1417100">*</span><span class="ident" id="1417101">File</span><span class="op" id="1417105">)</span>&nbsp;<span class="ident" id="1417107">SetLinesForContent</span><span class="op" id="1417125">(</span><span class="ident" id="1417126">content</span>&nbsp;<span class="op" id="1417134">[</span><span class="op" id="1417135">]</span><span class="builtintype" id="1417136">byte</span><span class="op" id="1417140">)</span>&nbsp;<span class="op" id="1417142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417145">var</span>&nbsp;<span class="ident" id="1417149">lines</span>&nbsp;<span class="op" id="1417155">[</span><span class="op" id="1417156">]</span><span class="builtintype" id="1417157">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417162">line</span>&nbsp;<span class="op" id="1417167">:=</span>&nbsp;<span class="num" id="1417170">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417173">for</span>&nbsp;<span class="ident" id="1417177">offset</span><span class="op" id="1417183">,</span>&nbsp;<span class="ident" id="1417185">b</span>&nbsp;<span class="op" id="1417187">:=</span>&nbsp;<span class="keyword" id="1417190">range</span>&nbsp;<span class="ident" id="1417196">content</span>&nbsp;<span class="op" id="1417204">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417208">if</span>&nbsp;<span class="ident" id="1417211">line</span>&nbsp;<span class="op" id="1417216">&gt;=</span>&nbsp;<span class="num" id="1417219">0</span>&nbsp;<span class="op" id="1417221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417226">lines</span>&nbsp;<span class="op" id="1417232">=</span>&nbsp;<span class="builtinfunc" id="1417234">append</span><span class="op" id="1417240">(</span><span class="ident" id="1417241">lines</span><span class="op" id="1417246">,</span>&nbsp;<span class="ident" id="1417248">line</span><span class="op" id="1417252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417260">line</span>&nbsp;<span class="op" id="1417265">=</span>&nbsp;<span class="op" id="1417267">-</span><span class="num" id="1417268">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417272">if</span>&nbsp;<span class="ident" id="1417275">b</span>&nbsp;<span class="op" id="1417277">==</span>&nbsp;<span class="string" id="1417280">&#39;\n&#39;</span>&nbsp;<span class="op" id="1417285">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417290">line</span>&nbsp;<span class="op" id="1417295">=</span>&nbsp;<span class="ident" id="1417297">offset</span>&nbsp;<span class="op" id="1417304">+</span>&nbsp;<span class="num" id="1417306">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417317">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417337">f</span><span class="op" id="1417338">.</span><span class="ident" id="1417339">set</span><span class="op" id="1417342">.</span><span class="ident" id="1417343">mutex</span><span class="op" id="1417348">.</span><span class="ident" id="1417349">Lock</span><span class="op" id="1417353">(</span><span class="op" id="1417354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417357">f</span><span class="op" id="1417358">.</span><span class="ident" id="1417359">lines</span>&nbsp;<span class="op" id="1417365">=</span>&nbsp;<span class="ident" id="1417367">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417374">f</span><span class="op" id="1417375">.</span><span class="ident" id="1417376">set</span><span class="op" id="1417379">.</span><span class="ident" id="1417380">mutex</span><span class="op" id="1417385">.</span><span class="ident" id="1417386">Unlock</span><span class="op" id="1417392">(</span><span class="op" id="1417393">)</span><br>
<span class="lineno"></span><span class="op" id="1417395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="1417398">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="1417462">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="1417525">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="1417559">type</span>&nbsp;<span class="ident" id="1417564">lineInfo</span>&nbsp;<span class="keyword" id="1417573">struct</span>&nbsp;<span class="op" id="1417580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417583">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417638">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1417647">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417652">Filename</span>&nbsp;<span class="builtintype" id="1417661">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417669">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1417678">int</span><br>
<span class="lineno"></span><span class="op" id="1417682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="1417685">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1417754">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1417824">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1417891">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1417943">//</span><br>
<span class="lineno">220</span><span class="comment" id="1417946">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="1418012">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="1418078">//</span><br>
<span class="lineno"></span><span class="keyword" id="1418081">func</span>&nbsp;<span class="op" id="1418086">(</span><span class="ident" id="1418087">f</span>&nbsp;<span class="op" id="1418089">*</span><span class="ident" id="1418090">File</span><span class="op" id="1418094">)</span>&nbsp;<span class="ident" id="1418096">AddLineInfo</span><span class="op" id="1418107">(</span><span class="ident" id="1418108">offset</span>&nbsp;<span class="builtintype" id="1418115">int</span><span class="op" id="1418118">,</span>&nbsp;<span class="ident" id="1418120">filename</span>&nbsp;<span class="builtintype" id="1418129">string</span><span class="op" id="1418135">,</span>&nbsp;<span class="ident" id="1418137">line</span>&nbsp;<span class="builtintype" id="1418142">int</span><span class="op" id="1418145">)</span>&nbsp;<span class="op" id="1418147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1418150">f</span><span class="op" id="1418151">.</span><span class="ident" id="1418152">set</span><span class="op" id="1418155">.</span><span class="ident" id="1418156">mutex</span><span class="op" id="1418161">.</span><span class="ident" id="1418162">Lock</span><span class="op" id="1418166">(</span><span class="op" id="1418167">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418170">if</span>&nbsp;<span class="ident" id="1418173">i</span>&nbsp;<span class="op" id="1418175">:=</span>&nbsp;<span class="builtinfunc" id="1418178">len</span><span class="op" id="1418181">(</span><span class="ident" id="1418182">f</span><span class="op" id="1418183">.</span><span class="ident" id="1418184">infos</span><span class="op" id="1418189">)</span><span class="op" id="1418190">;</span>&nbsp;<span class="ident" id="1418192">i</span>&nbsp;<span class="op" id="1418194">==</span>&nbsp;<span class="num" id="1418197">0</span>&nbsp;<span class="op" id="1418199">||</span>&nbsp;<span class="ident" id="1418202">f</span><span class="op" id="1418203">.</span><span class="ident" id="1418204">infos</span><span class="op" id="1418209">[</span><span class="ident" id="1418210">i</span><span class="op" id="1418211">-</span><span class="num" id="1418212">1</span><span class="op" id="1418213">]</span><span class="op" id="1418214">.</span><span class="ident" id="1418215">Offset</span>&nbsp;<span class="op" id="1418222">&lt;</span>&nbsp;<span class="ident" id="1418224">offset</span>&nbsp;<span class="op" id="1418231">&amp;&amp;</span>&nbsp;<span class="ident" id="1418234">offset</span>&nbsp;<span class="op" id="1418241">&lt;</span>&nbsp;<span class="ident" id="1418243">f</span><span class="op" id="1418244">.</span><span class="ident" id="1418245">size</span>&nbsp;<span class="op" id="1418250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1418254">f</span><span class="op" id="1418255">.</span><span class="ident" id="1418256">infos</span>&nbsp;<span class="op" id="1418262">=</span>&nbsp;<span class="builtinfunc" id="1418264">append</span><span class="op" id="1418270">(</span><span class="ident" id="1418271">f</span><span class="op" id="1418272">.</span><span class="ident" id="1418273">infos</span><span class="op" id="1418278">,</span>&nbsp;<span class="ident" id="1418280">lineInfo</span><span class="op" id="1418288">{</span><span class="ident" id="1418289">offset</span><span class="op" id="1418295">,</span>&nbsp;<span class="ident" id="1418297">filename</span><span class="op" id="1418305">,</span>&nbsp;<span class="ident" id="1418307">line</span><span class="op" id="1418311">}</span><span class="op" id="1418312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1418318">f</span><span class="op" id="1418319">.</span><span class="ident" id="1418320">set</span><span class="op" id="1418323">.</span><span class="ident" id="1418324">mutex</span><span class="op" id="1418329">.</span><span class="ident" id="1418330">Unlock</span><span class="op" id="1418336">(</span><span class="op" id="1418337">)</span><br>
<span class="lineno"></span><span class="op" id="1418339">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1418342">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="1418398">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="1418433">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="1418461">//</span><br>
<span class="lineno">235</span><span class="keyword" id="1418464">func</span>&nbsp;<span class="op" id="1418469">(</span><span class="ident" id="1418470">f</span>&nbsp;<span class="op" id="1418472">*</span><span class="ident" id="1418473">File</span><span class="op" id="1418477">)</span>&nbsp;<span class="ident" id="1418479">Pos</span><span class="op" id="1418482">(</span><span class="ident" id="1418483">offset</span>&nbsp;<span class="builtintype" id="1418490">int</span><span class="op" id="1418493">)</span>&nbsp;<span class="ident" id="1418495">Pos</span>&nbsp;<span class="op" id="1418499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418502">if</span>&nbsp;<span class="ident" id="1418505">offset</span>&nbsp;<span class="op" id="1418512">&gt;</span>&nbsp;<span class="ident" id="1418514">f</span><span class="op" id="1418515">.</span><span class="ident" id="1418516">size</span>&nbsp;<span class="op" id="1418521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1418525">panic</span><span class="op" id="1418530">(</span><span class="string" id="1418531">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="1418552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418558">return</span>&nbsp;<span class="ident" id="1418565">Pos</span><span class="op" id="1418568">(</span><span class="ident" id="1418569">f</span><span class="op" id="1418570">.</span><span class="ident" id="1418571">base</span>&nbsp;<span class="op" id="1418576">+</span>&nbsp;<span class="ident" id="1418578">offset</span><span class="op" id="1418584">)</span><br>
<span class="lineno">240</span><span class="op" id="1418586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1418589">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="1418649">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="1418694">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="1418732">//</span><br>
<span class="lineno"></span><span class="keyword" id="1418735">func</span>&nbsp;<span class="op" id="1418740">(</span><span class="ident" id="1418741">f</span>&nbsp;<span class="op" id="1418743">*</span><span class="ident" id="1418744">File</span><span class="op" id="1418748">)</span>&nbsp;<span class="ident" id="1418750">Offset</span><span class="op" id="1418756">(</span><span class="ident" id="1418757">p</span>&nbsp;<span class="ident" id="1418759">Pos</span><span class="op" id="1418762">)</span>&nbsp;<span class="builtintype" id="1418764">int</span>&nbsp;<span class="op" id="1418768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418771">if</span>&nbsp;<span class="builtintype" id="1418774">int</span><span class="op" id="1418777">(</span><span class="ident" id="1418778">p</span><span class="op" id="1418779">)</span>&nbsp;<span class="op" id="1418781">&lt;</span>&nbsp;<span class="ident" id="1418783">f</span><span class="op" id="1418784">.</span><span class="ident" id="1418785">base</span>&nbsp;<span class="op" id="1418790">||</span>&nbsp;<span class="builtintype" id="1418793">int</span><span class="op" id="1418796">(</span><span class="ident" id="1418797">p</span><span class="op" id="1418798">)</span>&nbsp;<span class="op" id="1418800">&gt;</span>&nbsp;<span class="ident" id="1418802">f</span><span class="op" id="1418803">.</span><span class="ident" id="1418804">base</span><span class="op" id="1418808">+</span><span class="ident" id="1418809">f</span><span class="op" id="1418810">.</span><span class="ident" id="1418811">size</span>&nbsp;<span class="op" id="1418816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1418820">panic</span><span class="op" id="1418825">(</span><span class="string" id="1418826">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="1418845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418848">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418851">return</span>&nbsp;<span class="builtintype" id="1418858">int</span><span class="op" id="1418861">(</span><span class="ident" id="1418862">p</span><span class="op" id="1418863">)</span>&nbsp;<span class="op" id="1418865">-</span>&nbsp;<span class="ident" id="1418867">f</span><span class="op" id="1418868">.</span><span class="ident" id="1418869">base</span><br>
<span class="lineno"></span><span class="op" id="1418874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1418877">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="1418940">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="1418988">//</span><br>
<span class="lineno"></span><span class="keyword" id="1418991">func</span>&nbsp;<span class="op" id="1418996">(</span><span class="ident" id="1418997">f</span>&nbsp;<span class="op" id="1418999">*</span><span class="ident" id="1419000">File</span><span class="op" id="1419004">)</span>&nbsp;<span class="ident" id="1419006">Line</span><span class="op" id="1419010">(</span><span class="ident" id="1419011">p</span>&nbsp;<span class="ident" id="1419013">Pos</span><span class="op" id="1419016">)</span>&nbsp;<span class="builtintype" id="1419018">int</span>&nbsp;<span class="op" id="1419022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1419025">return</span>&nbsp;<span class="ident" id="1419032">f</span><span class="op" id="1419033">.</span><span class="ident" id="1419034">Position</span><span class="op" id="1419042">(</span><span class="ident" id="1419043">p</span><span class="op" id="1419044">)</span><span class="op" id="1419045">.</span><span class="ident" id="1419046">Line</span><br>
<span class="lineno"></span><span class="op" id="1419051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="1419054">func</span>&nbsp;<span class="ident" id="1419059">searchLineInfos</span><span class="op" id="1419074">(</span><span class="ident" id="1419075">a</span>&nbsp;<span class="op" id="1419077">[</span><span class="op" id="1419078">]</span><span class="ident" id="1419079">lineInfo</span><span class="op" id="1419087">,</span>&nbsp;<span class="ident" id="1419089">x</span>&nbsp;<span class="builtintype" id="1419091">int</span><span class="op" id="1419094">)</span>&nbsp;<span class="builtintype" id="1419096">int</span>&nbsp;<span class="op" id="1419100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1419103">return</span>&nbsp;<span class="ident" id="1419110">sort</span><span class="op" id="1419114">.</span><span class="ident" id="1419115">Search</span><span class="op" id="1419121">(</span><span class="builtinfunc" id="1419122">len</span><span class="op" id="1419125">(</span><span class="ident" id="1419126">a</span><span class="op" id="1419127">)</span><span class="op" id="1419128">,</span>&nbsp;<span class="keyword" id="1419130">func</span><span class="op" id="1419134">(</span><span class="ident" id="1419135">i</span>&nbsp;<span class="builtintype" id="1419137">int</span><span class="op" id="1419140">)</span>&nbsp;<span class="builtintype" id="1419142">bool</span>&nbsp;<span class="op" id="1419147">{</span>&nbsp;<span class="keyword" id="1419149">return</span>&nbsp;<span class="ident" id="1419156">a</span><span class="op" id="1419157">[</span><span class="ident" id="1419158">i</span><span class="op" id="1419159">]</span><span class="op" id="1419160">.</span><span class="ident" id="1419161">Offset</span>&nbsp;<span class="op" id="1419168">&gt;</span>&nbsp;<span class="ident" id="1419170">x</span>&nbsp;<span class="op" id="1419172">}</span><span class="op" id="1419173">)</span>&nbsp;<span class="op" id="1419175">-</span>&nbsp;<span class="num" id="1419177">1</span><br>
<span class="lineno"></span><span class="op" id="1419179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1419182">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="1419259">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="1419335">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1419414">//</span><br>
<span class="lineno"></span><span class="keyword" id="1419417">func</span>&nbsp;<span class="op" id="1419422">(</span><span class="ident" id="1419423">f</span>&nbsp;<span class="op" id="1419425">*</span><span class="ident" id="1419426">File</span><span class="op" id="1419430">)</span>&nbsp;<span class="ident" id="1419432">unpack</span><span class="op" id="1419438">(</span><span class="ident" id="1419439">offset</span>&nbsp;<span class="builtintype" id="1419446">int</span><span class="op" id="1419449">,</span>&nbsp;<span class="ident" id="1419451">adjusted</span>&nbsp;<span class="builtintype" id="1419460">bool</span><span class="op" id="1419464">)</span>&nbsp;<span class="op" id="1419466">(</span><span class="ident" id="1419467">filename</span>&nbsp;<span class="builtintype" id="1419476">string</span><span class="op" id="1419482">,</span>&nbsp;<span class="ident" id="1419484">line</span><span class="op" id="1419488">,</span>&nbsp;<span class="ident" id="1419490">column</span>&nbsp;<span class="builtintype" id="1419497">int</span><span class="op" id="1419500">)</span>&nbsp;<span class="op" id="1419502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1419505">filename</span>&nbsp;<span class="op" id="1419514">=</span>&nbsp;<span class="ident" id="1419516">f</span><span class="op" id="1419517">.</span><span class="ident" id="1419518">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1419524">if</span>&nbsp;<span class="ident" id="1419527">i</span>&nbsp;<span class="op" id="1419529">:=</span>&nbsp;<span class="ident" id="1419532">searchInts</span><span class="op" id="1419542">(</span><span class="ident" id="1419543">f</span><span class="op" id="1419544">.</span><span class="ident" id="1419545">lines</span><span class="op" id="1419550">,</span>&nbsp;<span class="ident" id="1419552">offset</span><span class="op" id="1419558">)</span><span class="op" id="1419559">;</span>&nbsp;<span class="ident" id="1419561">i</span>&nbsp;<span class="op" id="1419563">&gt;=</span>&nbsp;<span class="num" id="1419566">0</span>&nbsp;<span class="op" id="1419568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1419572">line</span><span class="op" id="1419576">,</span>&nbsp;<span class="ident" id="1419578">column</span>&nbsp;<span class="op" id="1419585">=</span>&nbsp;<span class="ident" id="1419587">i</span><span class="op" id="1419588">+</span><span class="num" id="1419589">1</span><span class="op" id="1419590">,</span>&nbsp;<span class="ident" id="1419592">offset</span><span class="op" id="1419598">-</span><span class="ident" id="1419599">f</span><span class="op" id="1419600">.</span><span class="ident" id="1419601">lines</span><span class="op" id="1419606">[</span><span class="ident" id="1419607">i</span><span class="op" id="1419608">]</span><span class="op" id="1419609">+</span><span class="num" id="1419610">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1419613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1419616">if</span>&nbsp;<span class="ident" id="1419619">adjusted</span>&nbsp;<span class="op" id="1419628">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1419631">len</span><span class="op" id="1419634">(</span><span class="ident" id="1419635">f</span><span class="op" id="1419636">.</span><span class="ident" id="1419637">infos</span><span class="op" id="1419642">)</span>&nbsp;<span class="op" id="1419644">&gt;</span>&nbsp;<span class="num" id="1419646">0</span>&nbsp;<span class="op" id="1419648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1419652">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1419695">if</span>&nbsp;<span class="ident" id="1419698">i</span>&nbsp;<span class="op" id="1419700">:=</span>&nbsp;<span class="ident" id="1419703">searchLineInfos</span><span class="op" id="1419718">(</span><span class="ident" id="1419719">f</span><span class="op" id="1419720">.</span><span class="ident" id="1419721">infos</span><span class="op" id="1419726">,</span>&nbsp;<span class="ident" id="1419728">offset</span><span class="op" id="1419734">)</span><span class="op" id="1419735">;</span>&nbsp;<span class="ident" id="1419737">i</span>&nbsp;<span class="op" id="1419739">&gt;=</span>&nbsp;<span class="num" id="1419742">0</span>&nbsp;<span class="op" id="1419744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1419749">alt</span>&nbsp;<span class="op" id="1419753">:=</span>&nbsp;<span class="op" id="1419756">&amp;</span><span class="ident" id="1419757">f</span><span class="op" id="1419758">.</span><span class="ident" id="1419759">infos</span><span class="op" id="1419764">[</span><span class="ident" id="1419765">i</span><span class="op" id="1419766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1419771">filename</span>&nbsp;<span class="op" id="1419780">=</span>&nbsp;<span class="ident" id="1419782">alt</span><span class="op" id="1419785">.</span><span class="ident" id="1419786">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1419798">if</span>&nbsp;<span class="ident" id="1419801">i</span>&nbsp;<span class="op" id="1419803">:=</span>&nbsp;<span class="ident" id="1419806">searchInts</span><span class="op" id="1419816">(</span><span class="ident" id="1419817">f</span><span class="op" id="1419818">.</span><span class="ident" id="1419819">lines</span><span class="op" id="1419824">,</span>&nbsp;<span class="ident" id="1419826">alt</span><span class="op" id="1419829">.</span><span class="ident" id="1419830">Offset</span><span class="op" id="1419836">)</span><span class="op" id="1419837">;</span>&nbsp;<span class="ident" id="1419839">i</span>&nbsp;<span class="op" id="1419841">&gt;=</span>&nbsp;<span class="num" id="1419844">0</span>&nbsp;<span class="op" id="1419846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1419852">line</span>&nbsp;<span class="op" id="1419857">+=</span>&nbsp;<span class="ident" id="1419860">alt</span><span class="op" id="1419863">.</span><span class="ident" id="1419864">Line</span>&nbsp;<span class="op" id="1419869">-</span>&nbsp;<span class="ident" id="1419871">i</span>&nbsp;<span class="op" id="1419873">-</span>&nbsp;<span class="num" id="1419875">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1419880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1419884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1419887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1419890">return</span><br>
<span class="lineno"></span><span class="op" id="1419897">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="1419900">func</span>&nbsp;<span class="op" id="1419905">(</span><span class="ident" id="1419906">f</span>&nbsp;<span class="op" id="1419908">*</span><span class="ident" id="1419909">File</span><span class="op" id="1419913">)</span>&nbsp;<span class="ident" id="1419915">position</span><span class="op" id="1419923">(</span><span class="ident" id="1419924">p</span>&nbsp;<span class="ident" id="1419926">Pos</span><span class="op" id="1419929">,</span>&nbsp;<span class="ident" id="1419931">adjusted</span>&nbsp;<span class="builtintype" id="1419940">bool</span><span class="op" id="1419944">)</span>&nbsp;<span class="op" id="1419946">(</span><span class="ident" id="1419947">pos</span>&nbsp;<span class="ident" id="1419951">Position</span><span class="op" id="1419959">)</span>&nbsp;<span class="op" id="1419961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1419964">offset</span>&nbsp;<span class="op" id="1419971">:=</span>&nbsp;<span class="builtintype" id="1419974">int</span><span class="op" id="1419977">(</span><span class="ident" id="1419978">p</span><span class="op" id="1419979">)</span>&nbsp;<span class="op" id="1419981">-</span>&nbsp;<span class="ident" id="1419983">f</span><span class="op" id="1419984">.</span><span class="ident" id="1419985">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1419991">pos</span><span class="op" id="1419994">.</span><span class="ident" id="1419995">Offset</span>&nbsp;<span class="op" id="1420002">=</span>&nbsp;<span class="ident" id="1420004">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1420012">pos</span><span class="op" id="1420015">.</span><span class="ident" id="1420016">Filename</span><span class="op" id="1420024">,</span>&nbsp;<span class="ident" id="1420026">pos</span><span class="op" id="1420029">.</span><span class="ident" id="1420030">Line</span><span class="op" id="1420034">,</span>&nbsp;<span class="ident" id="1420036">pos</span><span class="op" id="1420039">.</span><span class="ident" id="1420040">Column</span>&nbsp;<span class="op" id="1420047">=</span>&nbsp;<span class="ident" id="1420049">f</span><span class="op" id="1420050">.</span><span class="ident" id="1420051">unpack</span><span class="op" id="1420057">(</span><span class="ident" id="1420058">offset</span><span class="op" id="1420064">,</span>&nbsp;<span class="ident" id="1420066">adjusted</span><span class="op" id="1420074">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1420077">return</span><br>
<span class="lineno"></span><span class="op" id="1420084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1420087">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="1420160">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="1420233">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1420291">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="1420331">//</span><br>
<span class="lineno"></span><span class="keyword" id="1420334">func</span>&nbsp;<span class="op" id="1420339">(</span><span class="ident" id="1420340">f</span>&nbsp;<span class="op" id="1420342">*</span><span class="ident" id="1420343">File</span><span class="op" id="1420347">)</span>&nbsp;<span class="ident" id="1420349">PositionFor</span><span class="op" id="1420360">(</span><span class="ident" id="1420361">p</span>&nbsp;<span class="ident" id="1420363">Pos</span><span class="op" id="1420366">,</span>&nbsp;<span class="ident" id="1420368">adjusted</span>&nbsp;<span class="builtintype" id="1420377">bool</span><span class="op" id="1420381">)</span>&nbsp;<span class="op" id="1420383">(</span><span class="ident" id="1420384">pos</span>&nbsp;<span class="ident" id="1420388">Position</span><span class="op" id="1420396">)</span>&nbsp;<span class="op" id="1420398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1420401">if</span>&nbsp;<span class="ident" id="1420404">p</span>&nbsp;<span class="op" id="1420406">!=</span>&nbsp;<span class="ident" id="1420409">NoPos</span>&nbsp;<span class="op" id="1420415">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1420419">if</span>&nbsp;<span class="builtintype" id="1420422">int</span><span class="op" id="1420425">(</span><span class="ident" id="1420426">p</span><span class="op" id="1420427">)</span>&nbsp;<span class="op" id="1420429">&lt;</span>&nbsp;<span class="ident" id="1420431">f</span><span class="op" id="1420432">.</span><span class="ident" id="1420433">base</span>&nbsp;<span class="op" id="1420438">||</span>&nbsp;<span class="builtintype" id="1420441">int</span><span class="op" id="1420444">(</span><span class="ident" id="1420445">p</span><span class="op" id="1420446">)</span>&nbsp;<span class="op" id="1420448">&gt;</span>&nbsp;<span class="ident" id="1420450">f</span><span class="op" id="1420451">.</span><span class="ident" id="1420452">base</span><span class="op" id="1420456">+</span><span class="ident" id="1420457">f</span><span class="op" id="1420458">.</span><span class="ident" id="1420459">size</span>&nbsp;<span class="op" id="1420464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1420469">panic</span><span class="op" id="1420474">(</span><span class="string" id="1420475">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="1420494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1420498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1420502">pos</span>&nbsp;<span class="op" id="1420506">=</span>&nbsp;<span class="ident" id="1420508">f</span><span class="op" id="1420509">.</span><span class="ident" id="1420510">position</span><span class="op" id="1420518">(</span><span class="ident" id="1420519">p</span><span class="op" id="1420520">,</span>&nbsp;<span class="ident" id="1420522">adjusted</span><span class="op" id="1420530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1420533">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1420536">return</span><br>
<span class="lineno"></span><span class="op" id="1420543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1420546">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="1420616">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="1420690">//</span><br>
<span class="lineno"></span><span class="keyword" id="1420693">func</span>&nbsp;<span class="op" id="1420698">(</span><span class="ident" id="1420699">f</span>&nbsp;<span class="op" id="1420701">*</span><span class="ident" id="1420702">File</span><span class="op" id="1420706">)</span>&nbsp;<span class="ident" id="1420708">Position</span><span class="op" id="1420716">(</span><span class="ident" id="1420717">p</span>&nbsp;<span class="ident" id="1420719">Pos</span><span class="op" id="1420722">)</span>&nbsp;<span class="op" id="1420724">(</span><span class="ident" id="1420725">pos</span>&nbsp;<span class="ident" id="1420729">Position</span><span class="op" id="1420737">)</span>&nbsp;<span class="op" id="1420739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1420742">return</span>&nbsp;<span class="ident" id="1420749">f</span><span class="op" id="1420750">.</span><span class="ident" id="1420751">PositionFor</span><span class="op" id="1420762">(</span><span class="ident" id="1420763">p</span><span class="op" id="1420764">,</span>&nbsp;<span class="builtintype" id="1420766">true</span><span class="op" id="1420770">)</span><br>
<span class="lineno"></span><span class="op" id="1420772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="1420775">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="1420856">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1420868">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="1420915">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="1420977">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="1421010">//</span><br>
<span class="lineno"></span><span class="keyword" id="1421013">type</span>&nbsp;<span class="ident" id="1421018">FileSet</span>&nbsp;<span class="keyword" id="1421026">struct</span>&nbsp;<span class="op" id="1421033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421036">mutex</span>&nbsp;<span class="ident" id="1421042">sync</span><span class="op" id="1421046">.</span><span class="ident" id="1421047">RWMutex</span>&nbsp;<span class="comment" id="1421055">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421081">base</span>&nbsp;&nbsp;<span class="builtintype" id="1421087">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1421100">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421134">files</span>&nbsp;<span class="op" id="1421140">[</span><span class="op" id="1421141">]</span><span class="op" id="1421142">*</span><span class="ident" id="1421143">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1421153">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421201">last</span>&nbsp;&nbsp;<span class="op" id="1421207">*</span><span class="ident" id="1421208">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1421220">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="1421252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1421255">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="1421293">func</span>&nbsp;<span class="ident" id="1421298">NewFileSet</span><span class="op" id="1421308">(</span><span class="op" id="1421309">)</span>&nbsp;<span class="op" id="1421311">*</span><span class="ident" id="1421312">FileSet</span>&nbsp;<span class="op" id="1421320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1421323">return</span>&nbsp;<span class="op" id="1421330">&amp;</span><span class="ident" id="1421331">FileSet</span><span class="op" id="1421338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421342">base</span><span class="op" id="1421346">:</span>&nbsp;<span class="num" id="1421348">1</span><span class="op" id="1421349">,</span>&nbsp;<span class="comment" id="1421351">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1421366">}</span><br>
<span class="lineno"></span><span class="op" id="1421368">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="1421371">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1421436">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="1421474">//</span><br>
<span class="lineno"></span><span class="keyword" id="1421477">func</span>&nbsp;<span class="op" id="1421482">(</span><span class="ident" id="1421483">s</span>&nbsp;<span class="op" id="1421485">*</span><span class="ident" id="1421486">FileSet</span><span class="op" id="1421493">)</span>&nbsp;<span class="ident" id="1421495">Base</span><span class="op" id="1421499">(</span><span class="op" id="1421500">)</span>&nbsp;<span class="builtintype" id="1421502">int</span>&nbsp;<span class="op" id="1421506">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421509">s</span><span class="op" id="1421510">.</span><span class="ident" id="1421511">mutex</span><span class="op" id="1421516">.</span><span class="ident" id="1421517">RLock</span><span class="op" id="1421522">(</span><span class="op" id="1421523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421526">b</span>&nbsp;<span class="op" id="1421528">:=</span>&nbsp;<span class="ident" id="1421531">s</span><span class="op" id="1421532">.</span><span class="ident" id="1421533">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421539">s</span><span class="op" id="1421540">.</span><span class="ident" id="1421541">mutex</span><span class="op" id="1421546">.</span><span class="ident" id="1421547">RUnlock</span><span class="op" id="1421554">(</span><span class="op" id="1421555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1421558">return</span>&nbsp;<span class="ident" id="1421565">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="1421568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1421571">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="1421648">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="1421724">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="1421800">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="1421881">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="1421943">//</span><br>
<span class="lineno"></span><span class="comment" id="1421946">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="1422021">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="1422096">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="1422158">//</span><br>
<span class="lineno"></span><span class="comment" id="1422161">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="1422185">//</span><br>
<span class="lineno"></span><span class="comment" id="1422188">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="1422267">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="1422341">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="1422371">//</span><br>
<span class="lineno"></span><span class="keyword" id="1422374">func</span>&nbsp;<span class="op" id="1422379">(</span><span class="ident" id="1422380">s</span>&nbsp;<span class="op" id="1422382">*</span><span class="ident" id="1422383">FileSet</span><span class="op" id="1422390">)</span>&nbsp;<span class="ident" id="1422392">AddFile</span><span class="op" id="1422399">(</span><span class="ident" id="1422400">filename</span>&nbsp;<span class="builtintype" id="1422409">string</span><span class="op" id="1422415">,</span>&nbsp;<span class="ident" id="1422417">base</span><span class="op" id="1422421">,</span>&nbsp;<span class="ident" id="1422423">size</span>&nbsp;<span class="builtintype" id="1422428">int</span><span class="op" id="1422431">)</span>&nbsp;<span class="op" id="1422433">*</span><span class="ident" id="1422434">File</span>&nbsp;<span class="op" id="1422439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422442">s</span><span class="op" id="1422443">.</span><span class="ident" id="1422444">mutex</span><span class="op" id="1422449">.</span><span class="ident" id="1422450">Lock</span><span class="op" id="1422454">(</span><span class="op" id="1422455">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422458">defer</span>&nbsp;<span class="ident" id="1422464">s</span><span class="op" id="1422465">.</span><span class="ident" id="1422466">mutex</span><span class="op" id="1422471">.</span><span class="ident" id="1422472">Unlock</span><span class="op" id="1422478">(</span><span class="op" id="1422479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422482">if</span>&nbsp;<span class="ident" id="1422485">base</span>&nbsp;<span class="op" id="1422490">&lt;</span>&nbsp;<span class="num" id="1422492">0</span>&nbsp;<span class="op" id="1422494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422498">base</span>&nbsp;<span class="op" id="1422503">=</span>&nbsp;<span class="ident" id="1422505">s</span><span class="op" id="1422506">.</span><span class="ident" id="1422507">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1422513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422516">if</span>&nbsp;<span class="ident" id="1422519">base</span>&nbsp;<span class="op" id="1422524">&lt;</span>&nbsp;<span class="ident" id="1422526">s</span><span class="op" id="1422527">.</span><span class="ident" id="1422528">base</span>&nbsp;<span class="op" id="1422533">||</span>&nbsp;<span class="ident" id="1422536">size</span>&nbsp;<span class="op" id="1422541">&lt;</span>&nbsp;<span class="num" id="1422543">0</span>&nbsp;<span class="op" id="1422545">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1422549">panic</span><span class="op" id="1422554">(</span><span class="string" id="1422555">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="1422577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1422580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1422583">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422615">f</span>&nbsp;<span class="op" id="1422617">:=</span>&nbsp;<span class="op" id="1422620">&amp;</span><span class="ident" id="1422621">File</span><span class="op" id="1422625">{</span><span class="ident" id="1422626">s</span><span class="op" id="1422627">,</span>&nbsp;<span class="ident" id="1422629">filename</span><span class="op" id="1422637">,</span>&nbsp;<span class="ident" id="1422639">base</span><span class="op" id="1422643">,</span>&nbsp;<span class="ident" id="1422645">size</span><span class="op" id="1422649">,</span>&nbsp;<span class="op" id="1422651">[</span><span class="op" id="1422652">]</span><span class="builtintype" id="1422653">int</span><span class="op" id="1422656">{</span><span class="num" id="1422657">0</span><span class="op" id="1422658">}</span><span class="op" id="1422659">,</span>&nbsp;<span class="ident" id="1422661">nil</span><span class="op" id="1422664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422667">base</span>&nbsp;<span class="op" id="1422672">+=</span>&nbsp;<span class="ident" id="1422675">size</span>&nbsp;<span class="op" id="1422680">+</span>&nbsp;<span class="num" id="1422682">1</span>&nbsp;<span class="comment" id="1422684">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422723">if</span>&nbsp;<span class="ident" id="1422726">base</span>&nbsp;<span class="op" id="1422731">&lt;</span>&nbsp;<span class="num" id="1422733">0</span>&nbsp;<span class="op" id="1422735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1422739">panic</span><span class="op" id="1422744">(</span><span class="string" id="1422745">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="1422806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1422809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1422812">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422845">s</span><span class="op" id="1422846">.</span><span class="ident" id="1422847">base</span>&nbsp;<span class="op" id="1422852">=</span>&nbsp;<span class="ident" id="1422854">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422860">s</span><span class="op" id="1422861">.</span><span class="ident" id="1422862">files</span>&nbsp;<span class="op" id="1422868">=</span>&nbsp;<span class="builtinfunc" id="1422870">append</span><span class="op" id="1422876">(</span><span class="ident" id="1422877">s</span><span class="op" id="1422878">.</span><span class="ident" id="1422879">files</span><span class="op" id="1422884">,</span>&nbsp;<span class="ident" id="1422886">f</span><span class="op" id="1422887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422890">s</span><span class="op" id="1422891">.</span><span class="ident" id="1422892">last</span>&nbsp;<span class="op" id="1422897">=</span>&nbsp;<span class="ident" id="1422899">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422902">return</span>&nbsp;<span class="ident" id="1422909">f</span><br>
<span class="lineno"></span><span class="op" id="1422911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="1422914">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="1422992">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1423018">//</span><br>
<span class="lineno"></span><span class="keyword" id="1423021">func</span>&nbsp;<span class="op" id="1423026">(</span><span class="ident" id="1423027">s</span>&nbsp;<span class="op" id="1423029">*</span><span class="ident" id="1423030">FileSet</span><span class="op" id="1423037">)</span>&nbsp;<span class="ident" id="1423039">Iterate</span><span class="op" id="1423046">(</span><span class="ident" id="1423047">f</span>&nbsp;<span class="keyword" id="1423049">func</span><span class="op" id="1423053">(</span><span class="op" id="1423054">*</span><span class="ident" id="1423055">File</span><span class="op" id="1423059">)</span>&nbsp;<span class="builtintype" id="1423061">bool</span><span class="op" id="1423065">)</span>&nbsp;<span class="op" id="1423067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423070">for</span>&nbsp;<span class="ident" id="1423074">i</span>&nbsp;<span class="op" id="1423076">:=</span>&nbsp;<span class="num" id="1423079">0</span><span class="op" id="1423080">;</span>&nbsp;<span class="op" id="1423082">;</span>&nbsp;<span class="ident" id="1423084">i</span><span class="op" id="1423085">++</span>&nbsp;<span class="op" id="1423088">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423092">var</span>&nbsp;<span class="ident" id="1423096">file</span>&nbsp;<span class="op" id="1423101">*</span><span class="ident" id="1423102">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423109">s</span><span class="op" id="1423110">.</span><span class="ident" id="1423111">mutex</span><span class="op" id="1423116">.</span><span class="ident" id="1423117">RLock</span><span class="op" id="1423122">(</span><span class="op" id="1423123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423127">if</span>&nbsp;<span class="ident" id="1423130">i</span>&nbsp;<span class="op" id="1423132">&lt;</span>&nbsp;<span class="builtinfunc" id="1423134">len</span><span class="op" id="1423137">(</span><span class="ident" id="1423138">s</span><span class="op" id="1423139">.</span><span class="ident" id="1423140">files</span><span class="op" id="1423145">)</span>&nbsp;<span class="op" id="1423147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423152">file</span>&nbsp;<span class="op" id="1423157">=</span>&nbsp;<span class="ident" id="1423159">s</span><span class="op" id="1423160">.</span><span class="ident" id="1423161">files</span><span class="op" id="1423166">[</span><span class="ident" id="1423167">i</span><span class="op" id="1423168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423172">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423176">s</span><span class="op" id="1423177">.</span><span class="ident" id="1423178">mutex</span><span class="op" id="1423183">.</span><span class="ident" id="1423184">RUnlock</span><span class="op" id="1423191">(</span><span class="op" id="1423192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423196">if</span>&nbsp;<span class="ident" id="1423199">file</span>&nbsp;<span class="op" id="1423204">==</span>&nbsp;<span class="ident" id="1423207">nil</span>&nbsp;<span class="op" id="1423211">||</span>&nbsp;<span class="op" id="1423214">!</span><span class="ident" id="1423215">f</span><span class="op" id="1423216">(</span><span class="ident" id="1423217">file</span><span class="op" id="1423221">)</span>&nbsp;<span class="op" id="1423223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423228">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423239">}</span><br>
<span class="lineno">400</span><span class="op" id="1423241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1423244">func</span>&nbsp;<span class="ident" id="1423249">searchFiles</span><span class="op" id="1423260">(</span><span class="ident" id="1423261">a</span>&nbsp;<span class="op" id="1423263">[</span><span class="op" id="1423264">]</span><span class="op" id="1423265">*</span><span class="ident" id="1423266">File</span><span class="op" id="1423270">,</span>&nbsp;<span class="ident" id="1423272">x</span>&nbsp;<span class="builtintype" id="1423274">int</span><span class="op" id="1423277">)</span>&nbsp;<span class="builtintype" id="1423279">int</span>&nbsp;<span class="op" id="1423283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423286">return</span>&nbsp;<span class="ident" id="1423293">sort</span><span class="op" id="1423297">.</span><span class="ident" id="1423298">Search</span><span class="op" id="1423304">(</span><span class="builtinfunc" id="1423305">len</span><span class="op" id="1423308">(</span><span class="ident" id="1423309">a</span><span class="op" id="1423310">)</span><span class="op" id="1423311">,</span>&nbsp;<span class="keyword" id="1423313">func</span><span class="op" id="1423317">(</span><span class="ident" id="1423318">i</span>&nbsp;<span class="builtintype" id="1423320">int</span><span class="op" id="1423323">)</span>&nbsp;<span class="builtintype" id="1423325">bool</span>&nbsp;<span class="op" id="1423330">{</span>&nbsp;<span class="keyword" id="1423332">return</span>&nbsp;<span class="ident" id="1423339">a</span><span class="op" id="1423340">[</span><span class="ident" id="1423341">i</span><span class="op" id="1423342">]</span><span class="op" id="1423343">.</span><span class="ident" id="1423344">base</span>&nbsp;<span class="op" id="1423349">&gt;</span>&nbsp;<span class="ident" id="1423351">x</span>&nbsp;<span class="op" id="1423353">}</span><span class="op" id="1423354">)</span>&nbsp;<span class="op" id="1423356">-</span>&nbsp;<span class="num" id="1423358">1</span><br>
<span class="lineno"></span><span class="op" id="1423360">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="1423363">func</span>&nbsp;<span class="op" id="1423368">(</span><span class="ident" id="1423369">s</span>&nbsp;<span class="op" id="1423371">*</span><span class="ident" id="1423372">FileSet</span><span class="op" id="1423379">)</span>&nbsp;<span class="ident" id="1423381">file</span><span class="op" id="1423385">(</span><span class="ident" id="1423386">p</span>&nbsp;<span class="ident" id="1423388">Pos</span><span class="op" id="1423391">)</span>&nbsp;<span class="op" id="1423393">*</span><span class="ident" id="1423394">File</span>&nbsp;<span class="op" id="1423399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423402">s</span><span class="op" id="1423403">.</span><span class="ident" id="1423404">mutex</span><span class="op" id="1423409">.</span><span class="ident" id="1423410">RLock</span><span class="op" id="1423415">(</span><span class="op" id="1423416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1423419">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423454">if</span>&nbsp;<span class="ident" id="1423457">f</span>&nbsp;<span class="op" id="1423459">:=</span>&nbsp;<span class="ident" id="1423462">s</span><span class="op" id="1423463">.</span><span class="ident" id="1423464">last</span><span class="op" id="1423468">;</span>&nbsp;<span class="ident" id="1423470">f</span>&nbsp;<span class="op" id="1423472">!=</span>&nbsp;<span class="ident" id="1423475">nil</span>&nbsp;<span class="op" id="1423479">&amp;&amp;</span>&nbsp;<span class="ident" id="1423482">f</span><span class="op" id="1423483">.</span><span class="ident" id="1423484">base</span>&nbsp;<span class="op" id="1423489">&lt;=</span>&nbsp;<span class="builtintype" id="1423492">int</span><span class="op" id="1423495">(</span><span class="ident" id="1423496">p</span><span class="op" id="1423497">)</span>&nbsp;<span class="op" id="1423499">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1423502">int</span><span class="op" id="1423505">(</span><span class="ident" id="1423506">p</span><span class="op" id="1423507">)</span>&nbsp;<span class="op" id="1423509">&lt;=</span>&nbsp;<span class="ident" id="1423512">f</span><span class="op" id="1423513">.</span><span class="ident" id="1423514">base</span><span class="op" id="1423518">+</span><span class="ident" id="1423519">f</span><span class="op" id="1423520">.</span><span class="ident" id="1423521">size</span>&nbsp;<span class="op" id="1423526">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423530">s</span><span class="op" id="1423531">.</span><span class="ident" id="1423532">mutex</span><span class="op" id="1423537">.</span><span class="ident" id="1423538">RUnlock</span><span class="op" id="1423545">(</span><span class="op" id="1423546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423550">return</span>&nbsp;<span class="ident" id="1423557">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1423563">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423608">if</span>&nbsp;<span class="ident" id="1423611">i</span>&nbsp;<span class="op" id="1423613">:=</span>&nbsp;<span class="ident" id="1423616">searchFiles</span><span class="op" id="1423627">(</span><span class="ident" id="1423628">s</span><span class="op" id="1423629">.</span><span class="ident" id="1423630">files</span><span class="op" id="1423635">,</span>&nbsp;<span class="builtintype" id="1423637">int</span><span class="op" id="1423640">(</span><span class="ident" id="1423641">p</span><span class="op" id="1423642">)</span><span class="op" id="1423643">)</span><span class="op" id="1423644">;</span>&nbsp;<span class="ident" id="1423646">i</span>&nbsp;<span class="op" id="1423648">&gt;=</span>&nbsp;<span class="num" id="1423651">0</span>&nbsp;<span class="op" id="1423653">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423657">f</span>&nbsp;<span class="op" id="1423659">:=</span>&nbsp;<span class="ident" id="1423662">s</span><span class="op" id="1423663">.</span><span class="ident" id="1423664">files</span><span class="op" id="1423669">[</span><span class="ident" id="1423670">i</span><span class="op" id="1423671">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1423675">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423726">if</span>&nbsp;<span class="builtintype" id="1423729">int</span><span class="op" id="1423732">(</span><span class="ident" id="1423733">p</span><span class="op" id="1423734">)</span>&nbsp;<span class="op" id="1423736">&lt;=</span>&nbsp;<span class="ident" id="1423739">f</span><span class="op" id="1423740">.</span><span class="ident" id="1423741">base</span><span class="op" id="1423745">+</span><span class="ident" id="1423746">f</span><span class="op" id="1423747">.</span><span class="ident" id="1423748">size</span>&nbsp;<span class="op" id="1423753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423758">s</span><span class="op" id="1423759">.</span><span class="ident" id="1423760">mutex</span><span class="op" id="1423765">.</span><span class="ident" id="1423766">RUnlock</span><span class="op" id="1423773">(</span><span class="op" id="1423774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423779">s</span><span class="op" id="1423780">.</span><span class="ident" id="1423781">mutex</span><span class="op" id="1423786">.</span><span class="ident" id="1423787">Lock</span><span class="op" id="1423791">(</span><span class="op" id="1423792">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423797">s</span><span class="op" id="1423798">.</span><span class="ident" id="1423799">last</span>&nbsp;<span class="op" id="1423804">=</span>&nbsp;<span class="ident" id="1423806">f</span>&nbsp;<span class="comment" id="1423808">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423850">s</span><span class="op" id="1423851">.</span><span class="ident" id="1423852">mutex</span><span class="op" id="1423857">.</span><span class="ident" id="1423858">Unlock</span><span class="op" id="1423864">(</span><span class="op" id="1423865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423870">return</span>&nbsp;<span class="ident" id="1423877">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423884">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423887">s</span><span class="op" id="1423888">.</span><span class="ident" id="1423889">mutex</span><span class="op" id="1423894">.</span><span class="ident" id="1423895">RUnlock</span><span class="op" id="1423902">(</span><span class="op" id="1423903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423906">return</span>&nbsp;<span class="ident" id="1423913">nil</span><br>
<span class="lineno"></span><span class="op" id="1423917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1423920">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="1423975">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="1424034">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1424056">//</span><br>
<span class="lineno"></span><span class="keyword" id="1424059">func</span>&nbsp;<span class="op" id="1424064">(</span><span class="ident" id="1424065">s</span>&nbsp;<span class="op" id="1424067">*</span><span class="ident" id="1424068">FileSet</span><span class="op" id="1424075">)</span>&nbsp;<span class="ident" id="1424077">File</span><span class="op" id="1424081">(</span><span class="ident" id="1424082">p</span>&nbsp;<span class="ident" id="1424084">Pos</span><span class="op" id="1424087">)</span>&nbsp;<span class="op" id="1424089">(</span><span class="ident" id="1424090">f</span>&nbsp;<span class="op" id="1424092">*</span><span class="ident" id="1424093">File</span><span class="op" id="1424097">)</span>&nbsp;<span class="op" id="1424099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424102">if</span>&nbsp;<span class="ident" id="1424105">p</span>&nbsp;<span class="op" id="1424107">!=</span>&nbsp;<span class="ident" id="1424110">NoPos</span>&nbsp;<span class="op" id="1424116">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424120">f</span>&nbsp;<span class="op" id="1424122">=</span>&nbsp;<span class="ident" id="1424124">s</span><span class="op" id="1424125">.</span><span class="ident" id="1424126">file</span><span class="op" id="1424130">(</span><span class="ident" id="1424131">p</span><span class="op" id="1424132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424138">return</span><br>
<span class="lineno"></span><span class="op" id="1424145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="1424148">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1424218">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="1424291">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1424349">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="1424389">//</span><br>
<span class="lineno">445</span><span class="keyword" id="1424392">func</span>&nbsp;<span class="op" id="1424397">(</span><span class="ident" id="1424398">s</span>&nbsp;<span class="op" id="1424400">*</span><span class="ident" id="1424401">FileSet</span><span class="op" id="1424408">)</span>&nbsp;<span class="ident" id="1424410">PositionFor</span><span class="op" id="1424421">(</span><span class="ident" id="1424422">p</span>&nbsp;<span class="ident" id="1424424">Pos</span><span class="op" id="1424427">,</span>&nbsp;<span class="ident" id="1424429">adjusted</span>&nbsp;<span class="builtintype" id="1424438">bool</span><span class="op" id="1424442">)</span>&nbsp;<span class="op" id="1424444">(</span><span class="ident" id="1424445">pos</span>&nbsp;<span class="ident" id="1424449">Position</span><span class="op" id="1424457">)</span>&nbsp;<span class="op" id="1424459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424462">if</span>&nbsp;<span class="ident" id="1424465">p</span>&nbsp;<span class="op" id="1424467">!=</span>&nbsp;<span class="ident" id="1424470">NoPos</span>&nbsp;<span class="op" id="1424476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424480">if</span>&nbsp;<span class="ident" id="1424483">f</span>&nbsp;<span class="op" id="1424485">:=</span>&nbsp;<span class="ident" id="1424488">s</span><span class="op" id="1424489">.</span><span class="ident" id="1424490">file</span><span class="op" id="1424494">(</span><span class="ident" id="1424495">p</span><span class="op" id="1424496">)</span><span class="op" id="1424497">;</span>&nbsp;<span class="ident" id="1424499">f</span>&nbsp;<span class="op" id="1424501">!=</span>&nbsp;<span class="ident" id="1424504">nil</span>&nbsp;<span class="op" id="1424508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424513">pos</span>&nbsp;<span class="op" id="1424517">=</span>&nbsp;<span class="ident" id="1424519">f</span><span class="op" id="1424520">.</span><span class="ident" id="1424521">position</span><span class="op" id="1424529">(</span><span class="ident" id="1424530">p</span><span class="op" id="1424531">,</span>&nbsp;<span class="ident" id="1424533">adjusted</span><span class="op" id="1424541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424545">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424551">return</span><br>
<span class="lineno"></span><span class="op" id="1424558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424561">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="1424628">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="1424702">//</span><br>
<span class="lineno"></span><span class="keyword" id="1424705">func</span>&nbsp;<span class="op" id="1424710">(</span><span class="ident" id="1424711">s</span>&nbsp;<span class="op" id="1424713">*</span><span class="ident" id="1424714">FileSet</span><span class="op" id="1424721">)</span>&nbsp;<span class="ident" id="1424723">Position</span><span class="op" id="1424731">(</span><span class="ident" id="1424732">p</span>&nbsp;<span class="ident" id="1424734">Pos</span><span class="op" id="1424737">)</span>&nbsp;<span class="op" id="1424739">(</span><span class="ident" id="1424740">pos</span>&nbsp;<span class="ident" id="1424744">Position</span><span class="op" id="1424752">)</span>&nbsp;<span class="op" id="1424754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424757">return</span>&nbsp;<span class="ident" id="1424764">s</span><span class="op" id="1424765">.</span><span class="ident" id="1424766">PositionFor</span><span class="op" id="1424777">(</span><span class="ident" id="1424778">p</span><span class="op" id="1424779">,</span>&nbsp;<span class="builtintype" id="1424781">true</span><span class="op" id="1424785">)</span><br>
<span class="lineno"></span><span class="op" id="1424787">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="1424790">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="1424871">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1424892">func</span>&nbsp;<span class="ident" id="1424897">searchInts</span><span class="op" id="1424907">(</span><span class="ident" id="1424908">a</span>&nbsp;<span class="op" id="1424910">[</span><span class="op" id="1424911">]</span><span class="builtintype" id="1424912">int</span><span class="op" id="1424915">,</span>&nbsp;<span class="ident" id="1424917">x</span>&nbsp;<span class="builtintype" id="1424919">int</span><span class="op" id="1424922">)</span>&nbsp;<span class="builtintype" id="1424924">int</span>&nbsp;<span class="op" id="1424928">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1424931">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1424988">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1424992">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425067">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425071">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425141">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425207">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425274">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425333">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425391">i</span><span class="op" id="1425392">,</span>&nbsp;<span class="ident" id="1425394">j</span>&nbsp;<span class="op" id="1425396">:=</span>&nbsp;<span class="num" id="1425399">0</span><span class="op" id="1425400">,</span>&nbsp;<span class="builtinfunc" id="1425402">len</span><span class="op" id="1425405">(</span><span class="ident" id="1425406">a</span><span class="op" id="1425407">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425410">for</span>&nbsp;<span class="ident" id="1425414">i</span>&nbsp;<span class="op" id="1425416">&lt;</span>&nbsp;<span class="ident" id="1425418">j</span>&nbsp;<span class="op" id="1425420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425424">h</span>&nbsp;<span class="op" id="1425426">:=</span>&nbsp;<span class="ident" id="1425429">i</span>&nbsp;<span class="op" id="1425431">+</span>&nbsp;<span class="op" id="1425433">(</span><span class="ident" id="1425434">j</span><span class="op" id="1425435">-</span><span class="ident" id="1425436">i</span><span class="op" id="1425437">)</span><span class="op" id="1425438">/</span><span class="num" id="1425439">2</span>&nbsp;<span class="comment" id="1425441">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425478">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425495">if</span>&nbsp;<span class="ident" id="1425498">a</span><span class="op" id="1425499">[</span><span class="ident" id="1425500">h</span><span class="op" id="1425501">]</span>&nbsp;<span class="op" id="1425503">&lt;=</span>&nbsp;<span class="ident" id="1425506">x</span>&nbsp;<span class="op" id="1425508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425513">i</span>&nbsp;<span class="op" id="1425515">=</span>&nbsp;<span class="ident" id="1425517">h</span>&nbsp;<span class="op" id="1425519">+</span>&nbsp;<span class="num" id="1425521">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1425525">}</span>&nbsp;<span class="keyword" id="1425527">else</span>&nbsp;<span class="op" id="1425532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425537">j</span>&nbsp;<span class="op" id="1425539">=</span>&nbsp;<span class="ident" id="1425541">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1425545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1425548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425551">return</span>&nbsp;<span class="ident" id="1425558">i</span>&nbsp;<span class="op" id="1425560">-</span>&nbsp;<span class="num" id="1425562">1</span><br>
<span class="lineno">485</span><span class="op" id="1425564">}</span>
</div>
</body>
</html>
