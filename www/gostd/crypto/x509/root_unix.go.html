<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3811806">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3811861">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3811915">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3811966">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3812029">package</span>&nbsp;<span class="ident" id="3812037">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3812043">import</span>&nbsp;<span class="string" id="3812050">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3812063">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="3812118">var</span>&nbsp;<span class="ident" id="3812122">certFiles</span>&nbsp;<span class="op" id="3812132">=</span>&nbsp;<span class="op" id="3812134">[</span><span class="op" id="3812135">]</span><span class="builtintype" id="3812136">string</span><span class="op" id="3812142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812145">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="3812181">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812187">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812217">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="3812251">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812259">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812275">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="3812299">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812317">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812330">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="3812349">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812372">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812384">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="3812424">,</span>&nbsp;<span class="comment" id="3812426">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812448">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="3812473">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812490">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812503">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="3812535">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812545">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="3812562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3812565">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="3812637">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3812684">var</span>&nbsp;<span class="ident" id="3812688">certDirectories</span>&nbsp;<span class="op" id="3812704">=</span>&nbsp;<span class="op" id="3812706">[</span><span class="op" id="3812707">]</span><span class="builtintype" id="3812708">string</span><span class="op" id="3812714">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3812717">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="3812747">,</span>&nbsp;<span class="comment" id="3812749">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="3812761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3812764">func</span>&nbsp;<span class="op" id="3812769">(</span><span class="ident" id="3812770">c</span>&nbsp;<span class="op" id="3812772">*</span><span class="ident" id="3812773">Certificate</span><span class="op" id="3812784">)</span>&nbsp;<span class="ident" id="3812786">systemVerify</span><span class="op" id="3812798">(</span><span class="ident" id="3812799">opts</span>&nbsp;<span class="op" id="3812804">*</span><span class="ident" id="3812805">VerifyOptions</span><span class="op" id="3812818">)</span>&nbsp;<span class="op" id="3812820">(</span><span class="ident" id="3812821">chains</span>&nbsp;<span class="op" id="3812828">[</span><span class="op" id="3812829">]</span><span class="op" id="3812830">[</span><span class="op" id="3812831">]</span><span class="op" id="3812832">*</span><span class="ident" id="3812833">Certificate</span><span class="op" id="3812844">,</span>&nbsp;<span class="ident" id="3812846">err</span>&nbsp;<span class="builtintype" id="3812850">error</span><span class="op" id="3812855">)</span>&nbsp;<span class="op" id="3812857">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812860">return</span>&nbsp;<span class="ident" id="3812867">nil</span><span class="op" id="3812870">,</span>&nbsp;<span class="ident" id="3812872">nil</span><br>
<span class="lineno"></span><span class="op" id="3812876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3812879">func</span>&nbsp;<span class="ident" id="3812884">initSystemRoots</span><span class="op" id="3812899">(</span><span class="op" id="3812900">)</span>&nbsp;<span class="op" id="3812902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812905">roots</span>&nbsp;<span class="op" id="3812911">:=</span>&nbsp;<span class="ident" id="3812914">NewCertPool</span><span class="op" id="3812925">(</span><span class="op" id="3812926">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812929">for</span>&nbsp;<span class="ident" id="3812933">_</span><span class="op" id="3812934">,</span>&nbsp;<span class="ident" id="3812936">file</span>&nbsp;<span class="op" id="3812941">:=</span>&nbsp;<span class="keyword" id="3812944">range</span>&nbsp;<span class="ident" id="3812950">certFiles</span>&nbsp;<span class="op" id="3812960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812964">data</span><span class="op" id="3812968">,</span>&nbsp;<span class="ident" id="3812970">err</span>&nbsp;<span class="op" id="3812974">:=</span>&nbsp;<span class="ident" id="3812977">ioutil</span><span class="op" id="3812983">.</span><span class="ident" id="3812984">ReadFile</span><span class="op" id="3812992">(</span><span class="ident" id="3812993">file</span><span class="op" id="3812997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813001">if</span>&nbsp;<span class="ident" id="3813004">err</span>&nbsp;<span class="op" id="3813008">==</span>&nbsp;<span class="ident" id="3813011">nil</span>&nbsp;<span class="op" id="3813015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813020">roots</span><span class="op" id="3813025">.</span><span class="ident" id="3813026">AppendCertsFromPEM</span><span class="op" id="3813044">(</span><span class="ident" id="3813045">data</span><span class="op" id="3813049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813054">systemRoots</span>&nbsp;<span class="op" id="3813066">=</span>&nbsp;<span class="ident" id="3813068">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813077">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813093">for</span>&nbsp;<span class="ident" id="3813097">_</span><span class="op" id="3813098">,</span>&nbsp;<span class="ident" id="3813100">directory</span>&nbsp;<span class="op" id="3813110">:=</span>&nbsp;<span class="keyword" id="3813113">range</span>&nbsp;<span class="ident" id="3813119">certDirectories</span>&nbsp;<span class="op" id="3813135">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813139">fis</span><span class="op" id="3813142">,</span>&nbsp;<span class="ident" id="3813144">err</span>&nbsp;<span class="op" id="3813148">:=</span>&nbsp;<span class="ident" id="3813151">ioutil</span><span class="op" id="3813157">.</span><span class="ident" id="3813158">ReadDir</span><span class="op" id="3813165">(</span><span class="ident" id="3813166">directory</span><span class="op" id="3813175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813179">if</span>&nbsp;<span class="ident" id="3813182">err</span>&nbsp;<span class="op" id="3813186">!=</span>&nbsp;<span class="ident" id="3813189">nil</span>&nbsp;<span class="op" id="3813193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813198">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813213">rootsAdded</span>&nbsp;<span class="op" id="3813224">:=</span>&nbsp;<span class="builtintype" id="3813227">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813235">for</span>&nbsp;<span class="ident" id="3813239">_</span><span class="op" id="3813240">,</span>&nbsp;<span class="ident" id="3813242">fi</span>&nbsp;<span class="op" id="3813245">:=</span>&nbsp;<span class="keyword" id="3813248">range</span>&nbsp;<span class="ident" id="3813254">fis</span>&nbsp;<span class="op" id="3813258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813263">data</span><span class="op" id="3813267">,</span>&nbsp;<span class="ident" id="3813269">err</span>&nbsp;<span class="op" id="3813273">:=</span>&nbsp;<span class="ident" id="3813276">ioutil</span><span class="op" id="3813282">.</span><span class="ident" id="3813283">ReadFile</span><span class="op" id="3813291">(</span><span class="ident" id="3813292">directory</span>&nbsp;<span class="op" id="3813302">+</span>&nbsp;<span class="string" id="3813304">&#34;/&#34;</span>&nbsp;<span class="op" id="3813308">+</span>&nbsp;<span class="ident" id="3813310">fi</span><span class="op" id="3813312">.</span><span class="ident" id="3813313">Name</span><span class="op" id="3813317">(</span><span class="op" id="3813318">)</span><span class="op" id="3813319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813324">if</span>&nbsp;<span class="ident" id="3813327">err</span>&nbsp;<span class="op" id="3813331">==</span>&nbsp;<span class="ident" id="3813334">nil</span>&nbsp;<span class="op" id="3813338">&amp;&amp;</span>&nbsp;<span class="ident" id="3813341">roots</span><span class="op" id="3813346">.</span><span class="ident" id="3813347">AppendCertsFromPEM</span><span class="op" id="3813365">(</span><span class="ident" id="3813366">data</span><span class="op" id="3813370">)</span>&nbsp;<span class="op" id="3813372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813378">rootsAdded</span>&nbsp;<span class="op" id="3813389">=</span>&nbsp;<span class="builtintype" id="3813391">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813399">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813407">if</span>&nbsp;<span class="ident" id="3813410">rootsAdded</span>&nbsp;<span class="op" id="3813421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813426">systemRoots</span>&nbsp;<span class="op" id="3813438">=</span>&nbsp;<span class="ident" id="3813440">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813449">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813458">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3813465">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3813537">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="3813587">}</span>
</div>
</body>
</html>
