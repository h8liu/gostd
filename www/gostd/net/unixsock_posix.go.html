<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4187659">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4187715">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4187769">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4187820">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4187898">package</span>&nbsp;<span class="ident" id="4187906">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4187911">import</span>&nbsp;<span class="op" id="4187918">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4187921">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4187931">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4187937">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4187948">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4187955">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4187958">func</span>&nbsp;<span class="ident" id="4187963">unixSocket</span><span class="op" id="4187973">(</span><span class="ident" id="4187974">net</span>&nbsp;<span class="builtintype" id="4187978">string</span><span class="op" id="4187984">,</span>&nbsp;<span class="ident" id="4187986">laddr</span><span class="op" id="4187991">,</span>&nbsp;<span class="ident" id="4187993">raddr</span>&nbsp;<span class="ident" id="4187999">sockaddr</span><span class="op" id="4188007">,</span>&nbsp;<span class="ident" id="4188009">mode</span>&nbsp;<span class="builtintype" id="4188014">string</span><span class="op" id="4188020">,</span>&nbsp;<span class="ident" id="4188022">deadline</span>&nbsp;<span class="ident" id="4188031">time</span><span class="op" id="4188035">.</span><span class="ident" id="4188036">Time</span><span class="op" id="4188040">)</span>&nbsp;<span class="op" id="4188042">(</span><span class="op" id="4188043">*</span><span class="ident" id="4188044">netFD</span><span class="op" id="4188049">,</span>&nbsp;<span class="builtintype" id="4188051">error</span><span class="op" id="4188056">)</span>&nbsp;<span class="op" id="4188058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188061">var</span>&nbsp;<span class="ident" id="4188065">sotype</span>&nbsp;<span class="builtintype" id="4188072">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188077">switch</span>&nbsp;<span class="ident" id="4188084">net</span>&nbsp;<span class="op" id="4188088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188091">case</span>&nbsp;<span class="string" id="4188096">&#34;unix&#34;</span><span class="op" id="4188102">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188106">sotype</span>&nbsp;<span class="op" id="4188113">=</span>&nbsp;<span class="ident" id="4188115">syscall</span><span class="op" id="4188122">.</span><span class="ident" id="4188123">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188136">case</span>&nbsp;<span class="string" id="4188141">&#34;unixgram&#34;</span><span class="op" id="4188151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188155">sotype</span>&nbsp;<span class="op" id="4188162">=</span>&nbsp;<span class="ident" id="4188164">syscall</span><span class="op" id="4188171">.</span><span class="ident" id="4188172">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188184">case</span>&nbsp;<span class="string" id="4188189">&#34;unixpacket&#34;</span><span class="op" id="4188201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188205">sotype</span>&nbsp;<span class="op" id="4188212">=</span>&nbsp;<span class="ident" id="4188214">syscall</span><span class="op" id="4188221">.</span><span class="ident" id="4188222">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188238">default</span><span class="op" id="4188245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188249">return</span>&nbsp;<span class="ident" id="4188256">nil</span><span class="op" id="4188259">,</span>&nbsp;<span class="ident" id="4188261">UnknownNetworkError</span><span class="op" id="4188280">(</span><span class="ident" id="4188281">net</span><span class="op" id="4188284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188291">switch</span>&nbsp;<span class="ident" id="4188298">mode</span>&nbsp;<span class="op" id="4188303">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188306">case</span>&nbsp;<span class="string" id="4188311">&#34;dial&#34;</span><span class="op" id="4188317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188321">if</span>&nbsp;<span class="ident" id="4188324">laddr</span>&nbsp;<span class="op" id="4188330">!=</span>&nbsp;<span class="ident" id="4188333">nil</span>&nbsp;<span class="op" id="4188337">&amp;&amp;</span>&nbsp;<span class="ident" id="4188340">laddr</span><span class="op" id="4188345">.</span><span class="ident" id="4188346">isWildcard</span><span class="op" id="4188356">(</span><span class="op" id="4188357">)</span>&nbsp;<span class="op" id="4188359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188364">laddr</span>&nbsp;<span class="op" id="4188370">=</span>&nbsp;<span class="ident" id="4188372">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188382">if</span>&nbsp;<span class="ident" id="4188385">raddr</span>&nbsp;<span class="op" id="4188391">!=</span>&nbsp;<span class="ident" id="4188394">nil</span>&nbsp;<span class="op" id="4188398">&amp;&amp;</span>&nbsp;<span class="ident" id="4188401">raddr</span><span class="op" id="4188406">.</span><span class="ident" id="4188407">isWildcard</span><span class="op" id="4188417">(</span><span class="op" id="4188418">)</span>&nbsp;<span class="op" id="4188420">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188425">raddr</span>&nbsp;<span class="op" id="4188431">=</span>&nbsp;<span class="ident" id="4188433">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188443">if</span>&nbsp;<span class="ident" id="4188446">raddr</span>&nbsp;<span class="op" id="4188452">==</span>&nbsp;<span class="ident" id="4188455">nil</span>&nbsp;<span class="op" id="4188459">&amp;&amp;</span>&nbsp;<span class="op" id="4188462">(</span><span class="ident" id="4188463">sotype</span>&nbsp;<span class="op" id="4188470">!=</span>&nbsp;<span class="ident" id="4188473">syscall</span><span class="op" id="4188480">.</span><span class="ident" id="4188481">SOCK_DGRAM</span>&nbsp;<span class="op" id="4188492">||</span>&nbsp;<span class="ident" id="4188495">laddr</span>&nbsp;<span class="op" id="4188501">==</span>&nbsp;<span class="ident" id="4188504">nil</span><span class="op" id="4188507">)</span>&nbsp;<span class="op" id="4188509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188514">return</span>&nbsp;<span class="ident" id="4188521">nil</span><span class="op" id="4188524">,</span>&nbsp;<span class="ident" id="4188526">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188546">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188549">case</span>&nbsp;<span class="string" id="4188554">&#34;listen&#34;</span><span class="op" id="4188562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188565">default</span><span class="op" id="4188572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188576">return</span>&nbsp;<span class="ident" id="4188583">nil</span><span class="op" id="4188586">,</span>&nbsp;<span class="ident" id="4188588">errors</span><span class="op" id="4188594">.</span><span class="ident" id="4188595">New</span><span class="op" id="4188598">(</span><span class="string" id="4188599">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="4188616">+</span>&nbsp;<span class="ident" id="4188618">mode</span><span class="op" id="4188622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188629">fd</span><span class="op" id="4188631">,</span>&nbsp;<span class="ident" id="4188633">err</span>&nbsp;<span class="op" id="4188637">:=</span>&nbsp;<span class="ident" id="4188640">socket</span><span class="op" id="4188646">(</span><span class="ident" id="4188647">net</span><span class="op" id="4188650">,</span>&nbsp;<span class="ident" id="4188652">syscall</span><span class="op" id="4188659">.</span><span class="ident" id="4188660">AF_UNIX</span><span class="op" id="4188667">,</span>&nbsp;<span class="ident" id="4188669">sotype</span><span class="op" id="4188675">,</span>&nbsp;<span class="num" id="4188677">0</span><span class="op" id="4188678">,</span>&nbsp;<span class="builtintype" id="4188680">false</span><span class="op" id="4188685">,</span>&nbsp;<span class="ident" id="4188687">laddr</span><span class="op" id="4188692">,</span>&nbsp;<span class="ident" id="4188694">raddr</span><span class="op" id="4188699">,</span>&nbsp;<span class="ident" id="4188701">deadline</span><span class="op" id="4188709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188712">if</span>&nbsp;<span class="ident" id="4188715">err</span>&nbsp;<span class="op" id="4188719">!=</span>&nbsp;<span class="ident" id="4188722">nil</span>&nbsp;<span class="op" id="4188726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188730">return</span>&nbsp;<span class="ident" id="4188737">nil</span><span class="op" id="4188740">,</span>&nbsp;<span class="ident" id="4188742">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188750">return</span>&nbsp;<span class="ident" id="4188757">fd</span><span class="op" id="4188759">,</span>&nbsp;<span class="ident" id="4188761">nil</span><br>
<span class="lineno">50</span><span class="op" id="4188765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188768">func</span>&nbsp;<span class="ident" id="4188773">sockaddrToUnix</span><span class="op" id="4188787">(</span><span class="ident" id="4188788">sa</span>&nbsp;<span class="ident" id="4188791">syscall</span><span class="op" id="4188798">.</span><span class="ident" id="4188799">Sockaddr</span><span class="op" id="4188807">)</span>&nbsp;<span class="ident" id="4188809">Addr</span>&nbsp;<span class="op" id="4188814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188817">if</span>&nbsp;<span class="ident" id="4188820">s</span><span class="op" id="4188821">,</span>&nbsp;<span class="ident" id="4188823">ok</span>&nbsp;<span class="op" id="4188826">:=</span>&nbsp;<span class="ident" id="4188829">sa</span><span class="op" id="4188831">.</span><span class="op" id="4188832">(</span><span class="op" id="4188833">*</span><span class="ident" id="4188834">syscall</span><span class="op" id="4188841">.</span><span class="ident" id="4188842">SockaddrUnix</span><span class="op" id="4188854">)</span><span class="op" id="4188855">;</span>&nbsp;<span class="ident" id="4188857">ok</span>&nbsp;<span class="op" id="4188860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188864">return</span>&nbsp;<span class="op" id="4188871">&amp;</span><span class="ident" id="4188872">UnixAddr</span><span class="op" id="4188880">{</span><span class="ident" id="4188881">Name</span><span class="op" id="4188885">:</span>&nbsp;<span class="ident" id="4188887">s</span><span class="op" id="4188888">.</span><span class="ident" id="4188889">Name</span><span class="op" id="4188893">,</span>&nbsp;<span class="ident" id="4188895">Net</span><span class="op" id="4188898">:</span>&nbsp;<span class="string" id="4188900">&#34;unix&#34;</span><span class="op" id="4188906">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188912">return</span>&nbsp;<span class="ident" id="4188919">nil</span><br>
<span class="lineno"></span><span class="op" id="4188923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188926">func</span>&nbsp;<span class="ident" id="4188931">sockaddrToUnixgram</span><span class="op" id="4188949">(</span><span class="ident" id="4188950">sa</span>&nbsp;<span class="ident" id="4188953">syscall</span><span class="op" id="4188960">.</span><span class="ident" id="4188961">Sockaddr</span><span class="op" id="4188969">)</span>&nbsp;<span class="ident" id="4188971">Addr</span>&nbsp;<span class="op" id="4188976">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188979">if</span>&nbsp;<span class="ident" id="4188982">s</span><span class="op" id="4188983">,</span>&nbsp;<span class="ident" id="4188985">ok</span>&nbsp;<span class="op" id="4188988">:=</span>&nbsp;<span class="ident" id="4188991">sa</span><span class="op" id="4188993">.</span><span class="op" id="4188994">(</span><span class="op" id="4188995">*</span><span class="ident" id="4188996">syscall</span><span class="op" id="4189003">.</span><span class="ident" id="4189004">SockaddrUnix</span><span class="op" id="4189016">)</span><span class="op" id="4189017">;</span>&nbsp;<span class="ident" id="4189019">ok</span>&nbsp;<span class="op" id="4189022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189026">return</span>&nbsp;<span class="op" id="4189033">&amp;</span><span class="ident" id="4189034">UnixAddr</span><span class="op" id="4189042">{</span><span class="ident" id="4189043">Name</span><span class="op" id="4189047">:</span>&nbsp;<span class="ident" id="4189049">s</span><span class="op" id="4189050">.</span><span class="ident" id="4189051">Name</span><span class="op" id="4189055">,</span>&nbsp;<span class="ident" id="4189057">Net</span><span class="op" id="4189060">:</span>&nbsp;<span class="string" id="4189062">&#34;unixgram&#34;</span><span class="op" id="4189072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189078">return</span>&nbsp;<span class="ident" id="4189085">nil</span><br>
<span class="lineno"></span><span class="op" id="4189089">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4189092">func</span>&nbsp;<span class="ident" id="4189097">sockaddrToUnixpacket</span><span class="op" id="4189117">(</span><span class="ident" id="4189118">sa</span>&nbsp;<span class="ident" id="4189121">syscall</span><span class="op" id="4189128">.</span><span class="ident" id="4189129">Sockaddr</span><span class="op" id="4189137">)</span>&nbsp;<span class="ident" id="4189139">Addr</span>&nbsp;<span class="op" id="4189144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189147">if</span>&nbsp;<span class="ident" id="4189150">s</span><span class="op" id="4189151">,</span>&nbsp;<span class="ident" id="4189153">ok</span>&nbsp;<span class="op" id="4189156">:=</span>&nbsp;<span class="ident" id="4189159">sa</span><span class="op" id="4189161">.</span><span class="op" id="4189162">(</span><span class="op" id="4189163">*</span><span class="ident" id="4189164">syscall</span><span class="op" id="4189171">.</span><span class="ident" id="4189172">SockaddrUnix</span><span class="op" id="4189184">)</span><span class="op" id="4189185">;</span>&nbsp;<span class="ident" id="4189187">ok</span>&nbsp;<span class="op" id="4189190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189194">return</span>&nbsp;<span class="op" id="4189201">&amp;</span><span class="ident" id="4189202">UnixAddr</span><span class="op" id="4189210">{</span><span class="ident" id="4189211">Name</span><span class="op" id="4189215">:</span>&nbsp;<span class="ident" id="4189217">s</span><span class="op" id="4189218">.</span><span class="ident" id="4189219">Name</span><span class="op" id="4189223">,</span>&nbsp;<span class="ident" id="4189225">Net</span><span class="op" id="4189228">:</span>&nbsp;<span class="string" id="4189230">&#34;unixpacket&#34;</span><span class="op" id="4189242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189245">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189248">return</span>&nbsp;<span class="ident" id="4189255">nil</span><br>
<span class="lineno"></span><span class="op" id="4189259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4189262">func</span>&nbsp;<span class="ident" id="4189267">sotypeToNet</span><span class="op" id="4189278">(</span><span class="ident" id="4189279">sotype</span>&nbsp;<span class="builtintype" id="4189286">int</span><span class="op" id="4189289">)</span>&nbsp;<span class="builtintype" id="4189291">string</span>&nbsp;<span class="op" id="4189298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189301">switch</span>&nbsp;<span class="ident" id="4189308">sotype</span>&nbsp;<span class="op" id="4189315">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189318">case</span>&nbsp;<span class="ident" id="4189323">syscall</span><span class="op" id="4189330">.</span><span class="ident" id="4189331">SOCK_STREAM</span><span class="op" id="4189342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189346">return</span>&nbsp;<span class="string" id="4189353">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189361">case</span>&nbsp;<span class="ident" id="4189366">syscall</span><span class="op" id="4189373">.</span><span class="ident" id="4189374">SOCK_DGRAM</span><span class="op" id="4189384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189388">return</span>&nbsp;<span class="string" id="4189395">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189407">case</span>&nbsp;<span class="ident" id="4189412">syscall</span><span class="op" id="4189419">.</span><span class="ident" id="4189420">SOCK_SEQPACKET</span><span class="op" id="4189434">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189438">return</span>&nbsp;<span class="string" id="4189445">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189459">default</span><span class="op" id="4189466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4189470">panic</span><span class="op" id="4189475">(</span><span class="string" id="4189476">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="4189509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189512">}</span><br>
<span class="lineno"></span><span class="op" id="4189514">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4189517">func</span>&nbsp;<span class="op" id="4189522">(</span><span class="ident" id="4189523">a</span>&nbsp;<span class="op" id="4189525">*</span><span class="ident" id="4189526">UnixAddr</span><span class="op" id="4189534">)</span>&nbsp;<span class="ident" id="4189536">family</span><span class="op" id="4189542">(</span><span class="op" id="4189543">)</span>&nbsp;<span class="builtintype" id="4189545">int</span>&nbsp;<span class="op" id="4189549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189552">return</span>&nbsp;<span class="ident" id="4189559">syscall</span><span class="op" id="4189566">.</span><span class="ident" id="4189567">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="4189575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4189578">func</span>&nbsp;<span class="op" id="4189583">(</span><span class="ident" id="4189584">a</span>&nbsp;<span class="op" id="4189586">*</span><span class="ident" id="4189587">UnixAddr</span><span class="op" id="4189595">)</span>&nbsp;<span class="ident" id="4189597">isWildcard</span><span class="op" id="4189607">(</span><span class="op" id="4189608">)</span>&nbsp;<span class="builtintype" id="4189610">bool</span>&nbsp;<span class="op" id="4189615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189618">return</span>&nbsp;<span class="ident" id="4189625">a</span>&nbsp;<span class="op" id="4189627">==</span>&nbsp;<span class="ident" id="4189630">nil</span>&nbsp;<span class="op" id="4189634">||</span>&nbsp;<span class="ident" id="4189637">a</span><span class="op" id="4189638">.</span><span class="ident" id="4189639">Name</span>&nbsp;<span class="op" id="4189644">==</span>&nbsp;<span class="string" id="4189647">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4189650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4189653">func</span>&nbsp;<span class="op" id="4189658">(</span><span class="ident" id="4189659">a</span>&nbsp;<span class="op" id="4189661">*</span><span class="ident" id="4189662">UnixAddr</span><span class="op" id="4189670">)</span>&nbsp;<span class="ident" id="4189672">sockaddr</span><span class="op" id="4189680">(</span><span class="ident" id="4189681">family</span>&nbsp;<span class="builtintype" id="4189688">int</span><span class="op" id="4189691">)</span>&nbsp;<span class="op" id="4189693">(</span><span class="ident" id="4189694">syscall</span><span class="op" id="4189701">.</span><span class="ident" id="4189702">Sockaddr</span><span class="op" id="4189710">,</span>&nbsp;<span class="builtintype" id="4189712">error</span><span class="op" id="4189717">)</span>&nbsp;<span class="op" id="4189719">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189722">if</span>&nbsp;<span class="ident" id="4189725">a</span>&nbsp;<span class="op" id="4189727">==</span>&nbsp;<span class="ident" id="4189730">nil</span>&nbsp;<span class="op" id="4189734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189738">return</span>&nbsp;<span class="ident" id="4189745">nil</span><span class="op" id="4189748">,</span>&nbsp;<span class="ident" id="4189750">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189758">return</span>&nbsp;<span class="op" id="4189765">&amp;</span><span class="ident" id="4189766">syscall</span><span class="op" id="4189773">.</span><span class="ident" id="4189774">SockaddrUnix</span><span class="op" id="4189786">{</span><span class="ident" id="4189787">Name</span><span class="op" id="4189791">:</span>&nbsp;<span class="ident" id="4189793">a</span><span class="op" id="4189794">.</span><span class="ident" id="4189795">Name</span><span class="op" id="4189799">}</span><span class="op" id="4189800">,</span>&nbsp;<span class="ident" id="4189802">nil</span><br>
<span class="lineno"></span><span class="op" id="4189806">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4189809">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="4189880">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="4189907">type</span>&nbsp;<span class="ident" id="4189912">UnixConn</span>&nbsp;<span class="keyword" id="4189921">struct</span>&nbsp;<span class="op" id="4189928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189931">conn</span><br>
<span class="lineno">105</span><span class="op" id="4189936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4189939">func</span>&nbsp;<span class="ident" id="4189944">newUnixConn</span><span class="op" id="4189955">(</span><span class="ident" id="4189956">fd</span>&nbsp;<span class="op" id="4189959">*</span><span class="ident" id="4189960">netFD</span><span class="op" id="4189965">)</span>&nbsp;<span class="op" id="4189967">*</span><span class="ident" id="4189968">UnixConn</span>&nbsp;<span class="op" id="4189977">{</span>&nbsp;<span class="keyword" id="4189979">return</span>&nbsp;<span class="op" id="4189986">&amp;</span><span class="ident" id="4189987">UnixConn</span><span class="op" id="4189995">{</span><span class="ident" id="4189996">conn</span><span class="op" id="4190000">{</span><span class="ident" id="4190001">fd</span><span class="op" id="4190003">}</span><span class="op" id="4190004">}</span>&nbsp;<span class="op" id="4190006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4190009">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="4190080">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4190151">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="4190166">//</span><br>
<span class="lineno"></span><span class="comment" id="4190169">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4190234">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4190301">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4190321">func</span>&nbsp;<span class="op" id="4190326">(</span><span class="ident" id="4190327">c</span>&nbsp;<span class="op" id="4190329">*</span><span class="ident" id="4190330">UnixConn</span><span class="op" id="4190338">)</span>&nbsp;<span class="ident" id="4190340">ReadFromUnix</span><span class="op" id="4190352">(</span><span class="ident" id="4190353">b</span>&nbsp;<span class="op" id="4190355">[</span><span class="op" id="4190356">]</span><span class="builtintype" id="4190357">byte</span><span class="op" id="4190361">)</span>&nbsp;<span class="op" id="4190363">(</span><span class="ident" id="4190364">n</span>&nbsp;<span class="builtintype" id="4190366">int</span><span class="op" id="4190369">,</span>&nbsp;<span class="ident" id="4190371">addr</span>&nbsp;<span class="op" id="4190376">*</span><span class="ident" id="4190377">UnixAddr</span><span class="op" id="4190385">,</span>&nbsp;<span class="ident" id="4190387">err</span>&nbsp;<span class="builtintype" id="4190391">error</span><span class="op" id="4190396">)</span>&nbsp;<span class="op" id="4190398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190401">if</span>&nbsp;<span class="op" id="4190404">!</span><span class="ident" id="4190405">c</span><span class="op" id="4190406">.</span><span class="ident" id="4190407">ok</span><span class="op" id="4190409">(</span><span class="op" id="4190410">)</span>&nbsp;<span class="op" id="4190412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190416">return</span>&nbsp;<span class="num" id="4190423">0</span><span class="op" id="4190424">,</span>&nbsp;<span class="ident" id="4190426">nil</span><span class="op" id="4190429">,</span>&nbsp;<span class="ident" id="4190431">syscall</span><span class="op" id="4190438">.</span><span class="ident" id="4190439">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190447">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190450">n</span><span class="op" id="4190451">,</span>&nbsp;<span class="ident" id="4190453">sa</span><span class="op" id="4190455">,</span>&nbsp;<span class="ident" id="4190457">err</span>&nbsp;<span class="op" id="4190461">:=</span>&nbsp;<span class="ident" id="4190464">c</span><span class="op" id="4190465">.</span><span class="ident" id="4190466">fd</span><span class="op" id="4190468">.</span><span class="ident" id="4190469">readFrom</span><span class="op" id="4190477">(</span><span class="ident" id="4190478">b</span><span class="op" id="4190479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190482">switch</span>&nbsp;<span class="ident" id="4190489">sa</span>&nbsp;<span class="op" id="4190492">:=</span>&nbsp;<span class="ident" id="4190495">sa</span><span class="op" id="4190497">.</span><span class="op" id="4190498">(</span><span class="keyword" id="4190499">type</span><span class="op" id="4190503">)</span>&nbsp;<span class="op" id="4190505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190508">case</span>&nbsp;<span class="op" id="4190513">*</span><span class="ident" id="4190514">syscall</span><span class="op" id="4190521">.</span><span class="ident" id="4190522">SockaddrUnix</span><span class="op" id="4190534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190538">if</span>&nbsp;<span class="ident" id="4190541">sa</span><span class="op" id="4190543">.</span><span class="ident" id="4190544">Name</span>&nbsp;<span class="op" id="4190549">!=</span>&nbsp;<span class="string" id="4190552">&#34;&#34;</span>&nbsp;<span class="op" id="4190555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190560">addr</span>&nbsp;<span class="op" id="4190565">=</span>&nbsp;<span class="op" id="4190567">&amp;</span><span class="ident" id="4190568">UnixAddr</span><span class="op" id="4190576">{</span><span class="ident" id="4190577">Name</span><span class="op" id="4190581">:</span>&nbsp;<span class="ident" id="4190583">sa</span><span class="op" id="4190585">.</span><span class="ident" id="4190586">Name</span><span class="op" id="4190590">,</span>&nbsp;<span class="ident" id="4190592">Net</span><span class="op" id="4190595">:</span>&nbsp;<span class="ident" id="4190597">sotypeToNet</span><span class="op" id="4190608">(</span><span class="ident" id="4190609">c</span><span class="op" id="4190610">.</span><span class="ident" id="4190611">fd</span><span class="op" id="4190613">.</span><span class="ident" id="4190614">sotype</span><span class="op" id="4190620">)</span><span class="op" id="4190621">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190631">return</span><br>
<span class="lineno"></span><span class="op" id="4190638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4190641">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4190696">func</span>&nbsp;<span class="op" id="4190701">(</span><span class="ident" id="4190702">c</span>&nbsp;<span class="op" id="4190704">*</span><span class="ident" id="4190705">UnixConn</span><span class="op" id="4190713">)</span>&nbsp;<span class="ident" id="4190715">ReadFrom</span><span class="op" id="4190723">(</span><span class="ident" id="4190724">b</span>&nbsp;<span class="op" id="4190726">[</span><span class="op" id="4190727">]</span><span class="builtintype" id="4190728">byte</span><span class="op" id="4190732">)</span>&nbsp;<span class="op" id="4190734">(</span><span class="builtintype" id="4190735">int</span><span class="op" id="4190738">,</span>&nbsp;<span class="ident" id="4190740">Addr</span><span class="op" id="4190744">,</span>&nbsp;<span class="builtintype" id="4190746">error</span><span class="op" id="4190751">)</span>&nbsp;<span class="op" id="4190753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190756">if</span>&nbsp;<span class="op" id="4190759">!</span><span class="ident" id="4190760">c</span><span class="op" id="4190761">.</span><span class="ident" id="4190762">ok</span><span class="op" id="4190764">(</span><span class="op" id="4190765">)</span>&nbsp;<span class="op" id="4190767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190771">return</span>&nbsp;<span class="num" id="4190778">0</span><span class="op" id="4190779">,</span>&nbsp;<span class="ident" id="4190781">nil</span><span class="op" id="4190784">,</span>&nbsp;<span class="ident" id="4190786">syscall</span><span class="op" id="4190793">.</span><span class="ident" id="4190794">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190802">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190805">n</span><span class="op" id="4190806">,</span>&nbsp;<span class="ident" id="4190808">addr</span><span class="op" id="4190812">,</span>&nbsp;<span class="ident" id="4190814">err</span>&nbsp;<span class="op" id="4190818">:=</span>&nbsp;<span class="ident" id="4190821">c</span><span class="op" id="4190822">.</span><span class="ident" id="4190823">ReadFromUnix</span><span class="op" id="4190835">(</span><span class="ident" id="4190836">b</span><span class="op" id="4190837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190840">return</span>&nbsp;<span class="ident" id="4190847">n</span><span class="op" id="4190848">,</span>&nbsp;<span class="ident" id="4190850">addr</span><span class="op" id="4190854">.</span><span class="ident" id="4190855">toAddr</span><span class="op" id="4190861">(</span><span class="op" id="4190862">)</span><span class="op" id="4190863">,</span>&nbsp;<span class="ident" id="4190865">err</span><br>
<span class="lineno"></span><span class="op" id="4190869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4190872">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="4190941">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4191012">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="4191083">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="4191153">func</span>&nbsp;<span class="op" id="4191158">(</span><span class="ident" id="4191159">c</span>&nbsp;<span class="op" id="4191161">*</span><span class="ident" id="4191162">UnixConn</span><span class="op" id="4191170">)</span>&nbsp;<span class="ident" id="4191172">ReadMsgUnix</span><span class="op" id="4191183">(</span><span class="ident" id="4191184">b</span><span class="op" id="4191185">,</span>&nbsp;<span class="ident" id="4191187">oob</span>&nbsp;<span class="op" id="4191191">[</span><span class="op" id="4191192">]</span><span class="builtintype" id="4191193">byte</span><span class="op" id="4191197">)</span>&nbsp;<span class="op" id="4191199">(</span><span class="ident" id="4191200">n</span><span class="op" id="4191201">,</span>&nbsp;<span class="ident" id="4191203">oobn</span><span class="op" id="4191207">,</span>&nbsp;<span class="ident" id="4191209">flags</span>&nbsp;<span class="builtintype" id="4191215">int</span><span class="op" id="4191218">,</span>&nbsp;<span class="ident" id="4191220">addr</span>&nbsp;<span class="op" id="4191225">*</span><span class="ident" id="4191226">UnixAddr</span><span class="op" id="4191234">,</span>&nbsp;<span class="ident" id="4191236">err</span>&nbsp;<span class="builtintype" id="4191240">error</span><span class="op" id="4191245">)</span>&nbsp;<span class="op" id="4191247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191250">if</span>&nbsp;<span class="op" id="4191253">!</span><span class="ident" id="4191254">c</span><span class="op" id="4191255">.</span><span class="ident" id="4191256">ok</span><span class="op" id="4191258">(</span><span class="op" id="4191259">)</span>&nbsp;<span class="op" id="4191261">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191265">return</span>&nbsp;<span class="num" id="4191272">0</span><span class="op" id="4191273">,</span>&nbsp;<span class="num" id="4191275">0</span><span class="op" id="4191276">,</span>&nbsp;<span class="num" id="4191278">0</span><span class="op" id="4191279">,</span>&nbsp;<span class="ident" id="4191281">nil</span><span class="op" id="4191284">,</span>&nbsp;<span class="ident" id="4191286">syscall</span><span class="op" id="4191293">.</span><span class="ident" id="4191294">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191305">n</span><span class="op" id="4191306">,</span>&nbsp;<span class="ident" id="4191308">oobn</span><span class="op" id="4191312">,</span>&nbsp;<span class="ident" id="4191314">flags</span><span class="op" id="4191319">,</span>&nbsp;<span class="ident" id="4191321">sa</span><span class="op" id="4191323">,</span>&nbsp;<span class="ident" id="4191325">err</span>&nbsp;<span class="op" id="4191329">:=</span>&nbsp;<span class="ident" id="4191332">c</span><span class="op" id="4191333">.</span><span class="ident" id="4191334">fd</span><span class="op" id="4191336">.</span><span class="ident" id="4191337">readMsg</span><span class="op" id="4191344">(</span><span class="ident" id="4191345">b</span><span class="op" id="4191346">,</span>&nbsp;<span class="ident" id="4191348">oob</span><span class="op" id="4191351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191354">switch</span>&nbsp;<span class="ident" id="4191361">sa</span>&nbsp;<span class="op" id="4191364">:=</span>&nbsp;<span class="ident" id="4191367">sa</span><span class="op" id="4191369">.</span><span class="op" id="4191370">(</span><span class="keyword" id="4191371">type</span><span class="op" id="4191375">)</span>&nbsp;<span class="op" id="4191377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191380">case</span>&nbsp;<span class="op" id="4191385">*</span><span class="ident" id="4191386">syscall</span><span class="op" id="4191393">.</span><span class="ident" id="4191394">SockaddrUnix</span><span class="op" id="4191406">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191410">if</span>&nbsp;<span class="ident" id="4191413">sa</span><span class="op" id="4191415">.</span><span class="ident" id="4191416">Name</span>&nbsp;<span class="op" id="4191421">!=</span>&nbsp;<span class="string" id="4191424">&#34;&#34;</span>&nbsp;<span class="op" id="4191427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191432">addr</span>&nbsp;<span class="op" id="4191437">=</span>&nbsp;<span class="op" id="4191439">&amp;</span><span class="ident" id="4191440">UnixAddr</span><span class="op" id="4191448">{</span><span class="ident" id="4191449">Name</span><span class="op" id="4191453">:</span>&nbsp;<span class="ident" id="4191455">sa</span><span class="op" id="4191457">.</span><span class="ident" id="4191458">Name</span><span class="op" id="4191462">,</span>&nbsp;<span class="ident" id="4191464">Net</span><span class="op" id="4191467">:</span>&nbsp;<span class="ident" id="4191469">sotypeToNet</span><span class="op" id="4191480">(</span><span class="ident" id="4191481">c</span><span class="op" id="4191482">.</span><span class="ident" id="4191483">fd</span><span class="op" id="4191485">.</span><span class="ident" id="4191486">sotype</span><span class="op" id="4191492">)</span><span class="op" id="4191493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191503">return</span><br>
<span class="lineno">155</span><span class="op" id="4191510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4191513">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4191587">//</span><br>
<span class="lineno"></span><span class="comment" id="4191590">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="4191654">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4191721">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="4191790">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="4191803">func</span>&nbsp;<span class="op" id="4191808">(</span><span class="ident" id="4191809">c</span>&nbsp;<span class="op" id="4191811">*</span><span class="ident" id="4191812">UnixConn</span><span class="op" id="4191820">)</span>&nbsp;<span class="ident" id="4191822">WriteToUnix</span><span class="op" id="4191833">(</span><span class="ident" id="4191834">b</span>&nbsp;<span class="op" id="4191836">[</span><span class="op" id="4191837">]</span><span class="builtintype" id="4191838">byte</span><span class="op" id="4191842">,</span>&nbsp;<span class="ident" id="4191844">addr</span>&nbsp;<span class="op" id="4191849">*</span><span class="ident" id="4191850">UnixAddr</span><span class="op" id="4191858">)</span>&nbsp;<span class="op" id="4191860">(</span><span class="ident" id="4191861">n</span>&nbsp;<span class="builtintype" id="4191863">int</span><span class="op" id="4191866">,</span>&nbsp;<span class="ident" id="4191868">err</span>&nbsp;<span class="builtintype" id="4191872">error</span><span class="op" id="4191877">)</span>&nbsp;<span class="op" id="4191879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191882">if</span>&nbsp;<span class="op" id="4191885">!</span><span class="ident" id="4191886">c</span><span class="op" id="4191887">.</span><span class="ident" id="4191888">ok</span><span class="op" id="4191890">(</span><span class="op" id="4191891">)</span>&nbsp;<span class="op" id="4191893">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191897">return</span>&nbsp;<span class="num" id="4191904">0</span><span class="op" id="4191905">,</span>&nbsp;<span class="ident" id="4191907">syscall</span><span class="op" id="4191914">.</span><span class="ident" id="4191915">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191926">if</span>&nbsp;<span class="ident" id="4191929">c</span><span class="op" id="4191930">.</span><span class="ident" id="4191931">fd</span><span class="op" id="4191933">.</span><span class="ident" id="4191934">isConnected</span>&nbsp;<span class="op" id="4191946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191950">return</span>&nbsp;<span class="num" id="4191957">0</span><span class="op" id="4191958">,</span>&nbsp;<span class="op" id="4191960">&amp;</span><span class="ident" id="4191961">OpError</span><span class="op" id="4191968">{</span><span class="ident" id="4191969">Op</span><span class="op" id="4191971">:</span>&nbsp;<span class="string" id="4191973">&#34;write&#34;</span><span class="op" id="4191980">,</span>&nbsp;<span class="ident" id="4191982">Net</span><span class="op" id="4191985">:</span>&nbsp;<span class="ident" id="4191987">c</span><span class="op" id="4191988">.</span><span class="ident" id="4191989">fd</span><span class="op" id="4191991">.</span><span class="ident" id="4191992">net</span><span class="op" id="4191995">,</span>&nbsp;<span class="ident" id="4191997">Addr</span><span class="op" id="4192001">:</span>&nbsp;<span class="ident" id="4192003">addr</span><span class="op" id="4192007">,</span>&nbsp;<span class="ident" id="4192009">Err</span><span class="op" id="4192012">:</span>&nbsp;<span class="ident" id="4192014">ErrWriteToConnected</span><span class="op" id="4192033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192036">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192039">if</span>&nbsp;<span class="ident" id="4192042">addr</span>&nbsp;<span class="op" id="4192047">==</span>&nbsp;<span class="ident" id="4192050">nil</span>&nbsp;<span class="op" id="4192054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192058">return</span>&nbsp;<span class="num" id="4192065">0</span><span class="op" id="4192066">,</span>&nbsp;<span class="op" id="4192068">&amp;</span><span class="ident" id="4192069">OpError</span><span class="op" id="4192076">{</span><span class="ident" id="4192077">Op</span><span class="op" id="4192079">:</span>&nbsp;<span class="string" id="4192081">&#34;write&#34;</span><span class="op" id="4192088">,</span>&nbsp;<span class="ident" id="4192090">Net</span><span class="op" id="4192093">:</span>&nbsp;<span class="ident" id="4192095">c</span><span class="op" id="4192096">.</span><span class="ident" id="4192097">fd</span><span class="op" id="4192099">.</span><span class="ident" id="4192100">net</span><span class="op" id="4192103">,</span>&nbsp;<span class="ident" id="4192105">Addr</span><span class="op" id="4192109">:</span>&nbsp;<span class="ident" id="4192111">nil</span><span class="op" id="4192114">,</span>&nbsp;<span class="ident" id="4192116">Err</span><span class="op" id="4192119">:</span>&nbsp;<span class="ident" id="4192121">errMissingAddress</span><span class="op" id="4192138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192144">if</span>&nbsp;<span class="ident" id="4192147">addr</span><span class="op" id="4192151">.</span><span class="ident" id="4192152">Net</span>&nbsp;<span class="op" id="4192156">!=</span>&nbsp;<span class="ident" id="4192159">sotypeToNet</span><span class="op" id="4192170">(</span><span class="ident" id="4192171">c</span><span class="op" id="4192172">.</span><span class="ident" id="4192173">fd</span><span class="op" id="4192175">.</span><span class="ident" id="4192176">sotype</span><span class="op" id="4192182">)</span>&nbsp;<span class="op" id="4192184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192188">return</span>&nbsp;<span class="num" id="4192195">0</span><span class="op" id="4192196">,</span>&nbsp;<span class="ident" id="4192198">syscall</span><span class="op" id="4192205">.</span><span class="ident" id="4192206">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192223">sa</span>&nbsp;<span class="op" id="4192226">:=</span>&nbsp;<span class="op" id="4192229">&amp;</span><span class="ident" id="4192230">syscall</span><span class="op" id="4192237">.</span><span class="ident" id="4192238">SockaddrUnix</span><span class="op" id="4192250">{</span><span class="ident" id="4192251">Name</span><span class="op" id="4192255">:</span>&nbsp;<span class="ident" id="4192257">addr</span><span class="op" id="4192261">.</span><span class="ident" id="4192262">Name</span><span class="op" id="4192266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192269">return</span>&nbsp;<span class="ident" id="4192276">c</span><span class="op" id="4192277">.</span><span class="ident" id="4192278">fd</span><span class="op" id="4192280">.</span><span class="ident" id="4192281">writeTo</span><span class="op" id="4192288">(</span><span class="ident" id="4192289">b</span><span class="op" id="4192290">,</span>&nbsp;<span class="ident" id="4192292">sa</span><span class="op" id="4192294">)</span><br>
<span class="lineno"></span><span class="op" id="4192296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4192299">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4192352">func</span>&nbsp;<span class="op" id="4192357">(</span><span class="ident" id="4192358">c</span>&nbsp;<span class="op" id="4192360">*</span><span class="ident" id="4192361">UnixConn</span><span class="op" id="4192369">)</span>&nbsp;<span class="ident" id="4192371">WriteTo</span><span class="op" id="4192378">(</span><span class="ident" id="4192379">b</span>&nbsp;<span class="op" id="4192381">[</span><span class="op" id="4192382">]</span><span class="builtintype" id="4192383">byte</span><span class="op" id="4192387">,</span>&nbsp;<span class="ident" id="4192389">addr</span>&nbsp;<span class="ident" id="4192394">Addr</span><span class="op" id="4192398">)</span>&nbsp;<span class="op" id="4192400">(</span><span class="ident" id="4192401">n</span>&nbsp;<span class="builtintype" id="4192403">int</span><span class="op" id="4192406">,</span>&nbsp;<span class="ident" id="4192408">err</span>&nbsp;<span class="builtintype" id="4192412">error</span><span class="op" id="4192417">)</span>&nbsp;<span class="op" id="4192419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192422">if</span>&nbsp;<span class="op" id="4192425">!</span><span class="ident" id="4192426">c</span><span class="op" id="4192427">.</span><span class="ident" id="4192428">ok</span><span class="op" id="4192430">(</span><span class="op" id="4192431">)</span>&nbsp;<span class="op" id="4192433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192437">return</span>&nbsp;<span class="num" id="4192444">0</span><span class="op" id="4192445">,</span>&nbsp;<span class="ident" id="4192447">syscall</span><span class="op" id="4192454">.</span><span class="ident" id="4192455">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192463">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192466">a</span><span class="op" id="4192467">,</span>&nbsp;<span class="ident" id="4192469">ok</span>&nbsp;<span class="op" id="4192472">:=</span>&nbsp;<span class="ident" id="4192475">addr</span><span class="op" id="4192479">.</span><span class="op" id="4192480">(</span><span class="op" id="4192481">*</span><span class="ident" id="4192482">UnixAddr</span><span class="op" id="4192490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192493">if</span>&nbsp;<span class="op" id="4192496">!</span><span class="ident" id="4192497">ok</span>&nbsp;<span class="op" id="4192500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192504">return</span>&nbsp;<span class="num" id="4192511">0</span><span class="op" id="4192512">,</span>&nbsp;<span class="op" id="4192514">&amp;</span><span class="ident" id="4192515">OpError</span><span class="op" id="4192522">{</span><span class="string" id="4192523">&#34;write&#34;</span><span class="op" id="4192530">,</span>&nbsp;<span class="ident" id="4192532">c</span><span class="op" id="4192533">.</span><span class="ident" id="4192534">fd</span><span class="op" id="4192536">.</span><span class="ident" id="4192537">net</span><span class="op" id="4192540">,</span>&nbsp;<span class="ident" id="4192542">addr</span><span class="op" id="4192546">,</span>&nbsp;<span class="ident" id="4192548">syscall</span><span class="op" id="4192555">.</span><span class="ident" id="4192556">EINVAL</span><span class="op" id="4192562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192568">return</span>&nbsp;<span class="ident" id="4192575">c</span><span class="op" id="4192576">.</span><span class="ident" id="4192577">WriteToUnix</span><span class="op" id="4192588">(</span><span class="ident" id="4192589">b</span><span class="op" id="4192590">,</span>&nbsp;<span class="ident" id="4192592">a</span><span class="op" id="4192593">)</span><br>
<span class="lineno">190</span><span class="op" id="4192595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4192598">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="4192665">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4192733">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="4192789">func</span>&nbsp;<span class="op" id="4192794">(</span><span class="ident" id="4192795">c</span>&nbsp;<span class="op" id="4192797">*</span><span class="ident" id="4192798">UnixConn</span><span class="op" id="4192806">)</span>&nbsp;<span class="ident" id="4192808">WriteMsgUnix</span><span class="op" id="4192820">(</span><span class="ident" id="4192821">b</span><span class="op" id="4192822">,</span>&nbsp;<span class="ident" id="4192824">oob</span>&nbsp;<span class="op" id="4192828">[</span><span class="op" id="4192829">]</span><span class="builtintype" id="4192830">byte</span><span class="op" id="4192834">,</span>&nbsp;<span class="ident" id="4192836">addr</span>&nbsp;<span class="op" id="4192841">*</span><span class="ident" id="4192842">UnixAddr</span><span class="op" id="4192850">)</span>&nbsp;<span class="op" id="4192852">(</span><span class="ident" id="4192853">n</span><span class="op" id="4192854">,</span>&nbsp;<span class="ident" id="4192856">oobn</span>&nbsp;<span class="builtintype" id="4192861">int</span><span class="op" id="4192864">,</span>&nbsp;<span class="ident" id="4192866">err</span>&nbsp;<span class="builtintype" id="4192870">error</span><span class="op" id="4192875">)</span>&nbsp;<span class="op" id="4192877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192880">if</span>&nbsp;<span class="op" id="4192883">!</span><span class="ident" id="4192884">c</span><span class="op" id="4192885">.</span><span class="ident" id="4192886">ok</span><span class="op" id="4192888">(</span><span class="op" id="4192889">)</span>&nbsp;<span class="op" id="4192891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192895">return</span>&nbsp;<span class="num" id="4192902">0</span><span class="op" id="4192903">,</span>&nbsp;<span class="num" id="4192905">0</span><span class="op" id="4192906">,</span>&nbsp;<span class="ident" id="4192908">syscall</span><span class="op" id="4192915">.</span><span class="ident" id="4192916">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192927">if</span>&nbsp;<span class="ident" id="4192930">c</span><span class="op" id="4192931">.</span><span class="ident" id="4192932">fd</span><span class="op" id="4192934">.</span><span class="ident" id="4192935">sotype</span>&nbsp;<span class="op" id="4192942">==</span>&nbsp;<span class="ident" id="4192945">syscall</span><span class="op" id="4192952">.</span><span class="ident" id="4192953">SOCK_DGRAM</span>&nbsp;<span class="op" id="4192964">&amp;&amp;</span>&nbsp;<span class="ident" id="4192967">c</span><span class="op" id="4192968">.</span><span class="ident" id="4192969">fd</span><span class="op" id="4192971">.</span><span class="ident" id="4192972">isConnected</span>&nbsp;<span class="op" id="4192984">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192988">return</span>&nbsp;<span class="num" id="4192995">0</span><span class="op" id="4192996">,</span>&nbsp;<span class="num" id="4192998">0</span><span class="op" id="4192999">,</span>&nbsp;<span class="op" id="4193001">&amp;</span><span class="ident" id="4193002">OpError</span><span class="op" id="4193009">{</span><span class="ident" id="4193010">Op</span><span class="op" id="4193012">:</span>&nbsp;<span class="string" id="4193014">&#34;write&#34;</span><span class="op" id="4193021">,</span>&nbsp;<span class="ident" id="4193023">Net</span><span class="op" id="4193026">:</span>&nbsp;<span class="ident" id="4193028">c</span><span class="op" id="4193029">.</span><span class="ident" id="4193030">fd</span><span class="op" id="4193032">.</span><span class="ident" id="4193033">net</span><span class="op" id="4193036">,</span>&nbsp;<span class="ident" id="4193038">Addr</span><span class="op" id="4193042">:</span>&nbsp;<span class="ident" id="4193044">addr</span><span class="op" id="4193048">,</span>&nbsp;<span class="ident" id="4193050">Err</span><span class="op" id="4193053">:</span>&nbsp;<span class="ident" id="4193055">ErrWriteToConnected</span><span class="op" id="4193074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193080">if</span>&nbsp;<span class="ident" id="4193083">addr</span>&nbsp;<span class="op" id="4193088">!=</span>&nbsp;<span class="ident" id="4193091">nil</span>&nbsp;<span class="op" id="4193095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193099">if</span>&nbsp;<span class="ident" id="4193102">addr</span><span class="op" id="4193106">.</span><span class="ident" id="4193107">Net</span>&nbsp;<span class="op" id="4193111">!=</span>&nbsp;<span class="ident" id="4193114">sotypeToNet</span><span class="op" id="4193125">(</span><span class="ident" id="4193126">c</span><span class="op" id="4193127">.</span><span class="ident" id="4193128">fd</span><span class="op" id="4193130">.</span><span class="ident" id="4193131">sotype</span><span class="op" id="4193137">)</span>&nbsp;<span class="op" id="4193139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193144">return</span>&nbsp;<span class="num" id="4193151">0</span><span class="op" id="4193152">,</span>&nbsp;<span class="num" id="4193154">0</span><span class="op" id="4193155">,</span>&nbsp;<span class="ident" id="4193157">syscall</span><span class="op" id="4193164">.</span><span class="ident" id="4193165">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193184">sa</span>&nbsp;<span class="op" id="4193187">:=</span>&nbsp;<span class="op" id="4193190">&amp;</span><span class="ident" id="4193191">syscall</span><span class="op" id="4193198">.</span><span class="ident" id="4193199">SockaddrUnix</span><span class="op" id="4193211">{</span><span class="ident" id="4193212">Name</span><span class="op" id="4193216">:</span>&nbsp;<span class="ident" id="4193218">addr</span><span class="op" id="4193222">.</span><span class="ident" id="4193223">Name</span><span class="op" id="4193227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193231">return</span>&nbsp;<span class="ident" id="4193238">c</span><span class="op" id="4193239">.</span><span class="ident" id="4193240">fd</span><span class="op" id="4193242">.</span><span class="ident" id="4193243">writeMsg</span><span class="op" id="4193251">(</span><span class="ident" id="4193252">b</span><span class="op" id="4193253">,</span>&nbsp;<span class="ident" id="4193255">oob</span><span class="op" id="4193258">,</span>&nbsp;<span class="ident" id="4193260">sa</span><span class="op" id="4193262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193268">return</span>&nbsp;<span class="ident" id="4193275">c</span><span class="op" id="4193276">.</span><span class="ident" id="4193277">fd</span><span class="op" id="4193279">.</span><span class="ident" id="4193280">writeMsg</span><span class="op" id="4193288">(</span><span class="ident" id="4193289">b</span><span class="op" id="4193290">,</span>&nbsp;<span class="ident" id="4193292">oob</span><span class="op" id="4193295">,</span>&nbsp;<span class="ident" id="4193297">nil</span><span class="op" id="4193300">)</span><br>
<span class="lineno">210</span><span class="op" id="4193302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4193305">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4193377">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4193416">func</span>&nbsp;<span class="op" id="4193421">(</span><span class="ident" id="4193422">c</span>&nbsp;<span class="op" id="4193424">*</span><span class="ident" id="4193425">UnixConn</span><span class="op" id="4193433">)</span>&nbsp;<span class="ident" id="4193435">CloseRead</span><span class="op" id="4193444">(</span><span class="op" id="4193445">)</span>&nbsp;<span class="builtintype" id="4193447">error</span>&nbsp;<span class="op" id="4193453">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193456">if</span>&nbsp;<span class="op" id="4193459">!</span><span class="ident" id="4193460">c</span><span class="op" id="4193461">.</span><span class="ident" id="4193462">ok</span><span class="op" id="4193464">(</span><span class="op" id="4193465">)</span>&nbsp;<span class="op" id="4193467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193471">return</span>&nbsp;<span class="ident" id="4193478">syscall</span><span class="op" id="4193485">.</span><span class="ident" id="4193486">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193497">return</span>&nbsp;<span class="ident" id="4193504">c</span><span class="op" id="4193505">.</span><span class="ident" id="4193506">fd</span><span class="op" id="4193508">.</span><span class="ident" id="4193509">closeRead</span><span class="op" id="4193518">(</span><span class="op" id="4193519">)</span><br>
<span class="lineno"></span><span class="op" id="4193521">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4193524">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4193597">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4193636">func</span>&nbsp;<span class="op" id="4193641">(</span><span class="ident" id="4193642">c</span>&nbsp;<span class="op" id="4193644">*</span><span class="ident" id="4193645">UnixConn</span><span class="op" id="4193653">)</span>&nbsp;<span class="ident" id="4193655">CloseWrite</span><span class="op" id="4193665">(</span><span class="op" id="4193666">)</span>&nbsp;<span class="builtintype" id="4193668">error</span>&nbsp;<span class="op" id="4193674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193677">if</span>&nbsp;<span class="op" id="4193680">!</span><span class="ident" id="4193681">c</span><span class="op" id="4193682">.</span><span class="ident" id="4193683">ok</span><span class="op" id="4193685">(</span><span class="op" id="4193686">)</span>&nbsp;<span class="op" id="4193688">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193692">return</span>&nbsp;<span class="ident" id="4193699">syscall</span><span class="op" id="4193706">.</span><span class="ident" id="4193707">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193718">return</span>&nbsp;<span class="ident" id="4193725">c</span><span class="op" id="4193726">.</span><span class="ident" id="4193727">fd</span><span class="op" id="4193729">.</span><span class="ident" id="4193730">closeWrite</span><span class="op" id="4193740">(</span><span class="op" id="4193741">)</span><br>
<span class="lineno"></span><span class="op" id="4193743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="4193746">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="4193815">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4193885">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4193945">func</span>&nbsp;<span class="ident" id="4193950">DialUnix</span><span class="op" id="4193958">(</span><span class="ident" id="4193959">net</span>&nbsp;<span class="builtintype" id="4193963">string</span><span class="op" id="4193969">,</span>&nbsp;<span class="ident" id="4193971">laddr</span><span class="op" id="4193976">,</span>&nbsp;<span class="ident" id="4193978">raddr</span>&nbsp;<span class="op" id="4193984">*</span><span class="ident" id="4193985">UnixAddr</span><span class="op" id="4193993">)</span>&nbsp;<span class="op" id="4193995">(</span><span class="op" id="4193996">*</span><span class="ident" id="4193997">UnixConn</span><span class="op" id="4194005">,</span>&nbsp;<span class="builtintype" id="4194007">error</span><span class="op" id="4194012">)</span>&nbsp;<span class="op" id="4194014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194017">switch</span>&nbsp;<span class="ident" id="4194024">net</span>&nbsp;<span class="op" id="4194028">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194031">case</span>&nbsp;<span class="string" id="4194036">&#34;unix&#34;</span><span class="op" id="4194042">,</span>&nbsp;<span class="string" id="4194044">&#34;unixgram&#34;</span><span class="op" id="4194054">,</span>&nbsp;<span class="string" id="4194056">&#34;unixpacket&#34;</span><span class="op" id="4194068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194071">default</span><span class="op" id="4194078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194082">return</span>&nbsp;<span class="ident" id="4194089">nil</span><span class="op" id="4194092">,</span>&nbsp;<span class="op" id="4194094">&amp;</span><span class="ident" id="4194095">OpError</span><span class="op" id="4194102">{</span><span class="ident" id="4194103">Op</span><span class="op" id="4194105">:</span>&nbsp;<span class="string" id="4194107">&#34;dial&#34;</span><span class="op" id="4194113">,</span>&nbsp;<span class="ident" id="4194115">Net</span><span class="op" id="4194118">:</span>&nbsp;<span class="ident" id="4194120">net</span><span class="op" id="4194123">,</span>&nbsp;<span class="ident" id="4194125">Addr</span><span class="op" id="4194129">:</span>&nbsp;<span class="ident" id="4194131">raddr</span><span class="op" id="4194136">,</span>&nbsp;<span class="ident" id="4194138">Err</span><span class="op" id="4194141">:</span>&nbsp;<span class="ident" id="4194143">UnknownNetworkError</span><span class="op" id="4194162">(</span><span class="ident" id="4194163">net</span><span class="op" id="4194166">)</span><span class="op" id="4194167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194173">return</span>&nbsp;<span class="ident" id="4194180">dialUnix</span><span class="op" id="4194188">(</span><span class="ident" id="4194189">net</span><span class="op" id="4194192">,</span>&nbsp;<span class="ident" id="4194194">laddr</span><span class="op" id="4194199">,</span>&nbsp;<span class="ident" id="4194201">raddr</span><span class="op" id="4194206">,</span>&nbsp;<span class="ident" id="4194208">noDeadline</span><span class="op" id="4194218">)</span><br>
<span class="lineno">240</span><span class="op" id="4194220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4194223">func</span>&nbsp;<span class="ident" id="4194228">dialUnix</span><span class="op" id="4194236">(</span><span class="ident" id="4194237">net</span>&nbsp;<span class="builtintype" id="4194241">string</span><span class="op" id="4194247">,</span>&nbsp;<span class="ident" id="4194249">laddr</span><span class="op" id="4194254">,</span>&nbsp;<span class="ident" id="4194256">raddr</span>&nbsp;<span class="op" id="4194262">*</span><span class="ident" id="4194263">UnixAddr</span><span class="op" id="4194271">,</span>&nbsp;<span class="ident" id="4194273">deadline</span>&nbsp;<span class="ident" id="4194282">time</span><span class="op" id="4194286">.</span><span class="ident" id="4194287">Time</span><span class="op" id="4194291">)</span>&nbsp;<span class="op" id="4194293">(</span><span class="op" id="4194294">*</span><span class="ident" id="4194295">UnixConn</span><span class="op" id="4194303">,</span>&nbsp;<span class="builtintype" id="4194305">error</span><span class="op" id="4194310">)</span>&nbsp;<span class="op" id="4194312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194315">fd</span><span class="op" id="4194317">,</span>&nbsp;<span class="ident" id="4194319">err</span>&nbsp;<span class="op" id="4194323">:=</span>&nbsp;<span class="ident" id="4194326">unixSocket</span><span class="op" id="4194336">(</span><span class="ident" id="4194337">net</span><span class="op" id="4194340">,</span>&nbsp;<span class="ident" id="4194342">laddr</span><span class="op" id="4194347">,</span>&nbsp;<span class="ident" id="4194349">raddr</span><span class="op" id="4194354">,</span>&nbsp;<span class="string" id="4194356">&#34;dial&#34;</span><span class="op" id="4194362">,</span>&nbsp;<span class="ident" id="4194364">deadline</span><span class="op" id="4194372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194375">if</span>&nbsp;<span class="ident" id="4194378">err</span>&nbsp;<span class="op" id="4194382">!=</span>&nbsp;<span class="ident" id="4194385">nil</span>&nbsp;<span class="op" id="4194389">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194393">return</span>&nbsp;<span class="ident" id="4194400">nil</span><span class="op" id="4194403">,</span>&nbsp;<span class="op" id="4194405">&amp;</span><span class="ident" id="4194406">OpError</span><span class="op" id="4194413">{</span><span class="ident" id="4194414">Op</span><span class="op" id="4194416">:</span>&nbsp;<span class="string" id="4194418">&#34;dial&#34;</span><span class="op" id="4194424">,</span>&nbsp;<span class="ident" id="4194426">Net</span><span class="op" id="4194429">:</span>&nbsp;<span class="ident" id="4194431">net</span><span class="op" id="4194434">,</span>&nbsp;<span class="ident" id="4194436">Addr</span><span class="op" id="4194440">:</span>&nbsp;<span class="ident" id="4194442">raddr</span><span class="op" id="4194447">,</span>&nbsp;<span class="ident" id="4194449">Err</span><span class="op" id="4194452">:</span>&nbsp;<span class="ident" id="4194454">err</span><span class="op" id="4194457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194463">return</span>&nbsp;<span class="ident" id="4194470">newUnixConn</span><span class="op" id="4194481">(</span><span class="ident" id="4194482">fd</span><span class="op" id="4194484">)</span><span class="op" id="4194485">,</span>&nbsp;<span class="ident" id="4194487">nil</span><br>
<span class="lineno"></span><span class="op" id="4194491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="4194494">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4194560">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="4194629">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="4194648">type</span>&nbsp;<span class="ident" id="4194653">UnixListener</span>&nbsp;<span class="keyword" id="4194666">struct</span>&nbsp;<span class="op" id="4194673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194676">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4194681">*</span><span class="ident" id="4194682">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194689">path</span>&nbsp;<span class="builtintype" id="4194694">string</span><br>
<span class="lineno"></span><span class="op" id="4194701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4194704">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4194774">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="4194841">func</span>&nbsp;<span class="ident" id="4194846">ListenUnix</span><span class="op" id="4194856">(</span><span class="ident" id="4194857">net</span>&nbsp;<span class="builtintype" id="4194861">string</span><span class="op" id="4194867">,</span>&nbsp;<span class="ident" id="4194869">laddr</span>&nbsp;<span class="op" id="4194875">*</span><span class="ident" id="4194876">UnixAddr</span><span class="op" id="4194884">)</span>&nbsp;<span class="op" id="4194886">(</span><span class="op" id="4194887">*</span><span class="ident" id="4194888">UnixListener</span><span class="op" id="4194900">,</span>&nbsp;<span class="builtintype" id="4194902">error</span><span class="op" id="4194907">)</span>&nbsp;<span class="op" id="4194909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194912">switch</span>&nbsp;<span class="ident" id="4194919">net</span>&nbsp;<span class="op" id="4194923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194926">case</span>&nbsp;<span class="string" id="4194931">&#34;unix&#34;</span><span class="op" id="4194937">,</span>&nbsp;<span class="string" id="4194939">&#34;unixpacket&#34;</span><span class="op" id="4194951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194954">default</span><span class="op" id="4194961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194965">return</span>&nbsp;<span class="ident" id="4194972">nil</span><span class="op" id="4194975">,</span>&nbsp;<span class="op" id="4194977">&amp;</span><span class="ident" id="4194978">OpError</span><span class="op" id="4194985">{</span><span class="ident" id="4194986">Op</span><span class="op" id="4194988">:</span>&nbsp;<span class="string" id="4194990">&#34;listen&#34;</span><span class="op" id="4194998">,</span>&nbsp;<span class="ident" id="4195000">Net</span><span class="op" id="4195003">:</span>&nbsp;<span class="ident" id="4195005">net</span><span class="op" id="4195008">,</span>&nbsp;<span class="ident" id="4195010">Addr</span><span class="op" id="4195014">:</span>&nbsp;<span class="ident" id="4195016">laddr</span><span class="op" id="4195021">,</span>&nbsp;<span class="ident" id="4195023">Err</span><span class="op" id="4195026">:</span>&nbsp;<span class="ident" id="4195028">UnknownNetworkError</span><span class="op" id="4195047">(</span><span class="ident" id="4195048">net</span><span class="op" id="4195051">)</span><span class="op" id="4195052">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195058">if</span>&nbsp;<span class="ident" id="4195061">laddr</span>&nbsp;<span class="op" id="4195067">==</span>&nbsp;<span class="ident" id="4195070">nil</span>&nbsp;<span class="op" id="4195074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195078">return</span>&nbsp;<span class="ident" id="4195085">nil</span><span class="op" id="4195088">,</span>&nbsp;<span class="op" id="4195090">&amp;</span><span class="ident" id="4195091">OpError</span><span class="op" id="4195098">{</span><span class="ident" id="4195099">Op</span><span class="op" id="4195101">:</span>&nbsp;<span class="string" id="4195103">&#34;listen&#34;</span><span class="op" id="4195111">,</span>&nbsp;<span class="ident" id="4195113">Net</span><span class="op" id="4195116">:</span>&nbsp;<span class="ident" id="4195118">net</span><span class="op" id="4195121">,</span>&nbsp;<span class="ident" id="4195123">Addr</span><span class="op" id="4195127">:</span>&nbsp;<span class="ident" id="4195129">nil</span><span class="op" id="4195132">,</span>&nbsp;<span class="ident" id="4195134">Err</span><span class="op" id="4195137">:</span>&nbsp;<span class="ident" id="4195139">errMissingAddress</span><span class="op" id="4195156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195162">fd</span><span class="op" id="4195164">,</span>&nbsp;<span class="ident" id="4195166">err</span>&nbsp;<span class="op" id="4195170">:=</span>&nbsp;<span class="ident" id="4195173">unixSocket</span><span class="op" id="4195183">(</span><span class="ident" id="4195184">net</span><span class="op" id="4195187">,</span>&nbsp;<span class="ident" id="4195189">laddr</span><span class="op" id="4195194">,</span>&nbsp;<span class="ident" id="4195196">nil</span><span class="op" id="4195199">,</span>&nbsp;<span class="string" id="4195201">&#34;listen&#34;</span><span class="op" id="4195209">,</span>&nbsp;<span class="ident" id="4195211">noDeadline</span><span class="op" id="4195221">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195224">if</span>&nbsp;<span class="ident" id="4195227">err</span>&nbsp;<span class="op" id="4195231">!=</span>&nbsp;<span class="ident" id="4195234">nil</span>&nbsp;<span class="op" id="4195238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195242">return</span>&nbsp;<span class="ident" id="4195249">nil</span><span class="op" id="4195252">,</span>&nbsp;<span class="op" id="4195254">&amp;</span><span class="ident" id="4195255">OpError</span><span class="op" id="4195262">{</span><span class="ident" id="4195263">Op</span><span class="op" id="4195265">:</span>&nbsp;<span class="string" id="4195267">&#34;listen&#34;</span><span class="op" id="4195275">,</span>&nbsp;<span class="ident" id="4195277">Net</span><span class="op" id="4195280">:</span>&nbsp;<span class="ident" id="4195282">net</span><span class="op" id="4195285">,</span>&nbsp;<span class="ident" id="4195287">Addr</span><span class="op" id="4195291">:</span>&nbsp;<span class="ident" id="4195293">laddr</span><span class="op" id="4195298">,</span>&nbsp;<span class="ident" id="4195300">Err</span><span class="op" id="4195303">:</span>&nbsp;<span class="ident" id="4195305">err</span><span class="op" id="4195308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195314">return</span>&nbsp;<span class="op" id="4195321">&amp;</span><span class="ident" id="4195322">UnixListener</span><span class="op" id="4195334">{</span><span class="ident" id="4195335">fd</span><span class="op" id="4195337">,</span>&nbsp;<span class="ident" id="4195339">fd</span><span class="op" id="4195341">.</span><span class="ident" id="4195342">laddr</span><span class="op" id="4195347">.</span><span class="ident" id="4195348">String</span><span class="op" id="4195354">(</span><span class="op" id="4195355">)</span><span class="op" id="4195356">}</span><span class="op" id="4195357">,</span>&nbsp;<span class="ident" id="4195359">nil</span><br>
<span class="lineno"></span><span class="op" id="4195363">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="4195366">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4195431">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4195446">func</span>&nbsp;<span class="op" id="4195451">(</span><span class="ident" id="4195452">l</span>&nbsp;<span class="op" id="4195454">*</span><span class="ident" id="4195455">UnixListener</span><span class="op" id="4195467">)</span>&nbsp;<span class="ident" id="4195469">AcceptUnix</span><span class="op" id="4195479">(</span><span class="op" id="4195480">)</span>&nbsp;<span class="op" id="4195482">(</span><span class="op" id="4195483">*</span><span class="ident" id="4195484">UnixConn</span><span class="op" id="4195492">,</span>&nbsp;<span class="builtintype" id="4195494">error</span><span class="op" id="4195499">)</span>&nbsp;<span class="op" id="4195501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195504">if</span>&nbsp;<span class="ident" id="4195507">l</span>&nbsp;<span class="op" id="4195509">==</span>&nbsp;<span class="ident" id="4195512">nil</span>&nbsp;<span class="op" id="4195516">||</span>&nbsp;<span class="ident" id="4195519">l</span><span class="op" id="4195520">.</span><span class="ident" id="4195521">fd</span>&nbsp;<span class="op" id="4195524">==</span>&nbsp;<span class="ident" id="4195527">nil</span>&nbsp;<span class="op" id="4195531">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195535">return</span>&nbsp;<span class="ident" id="4195542">nil</span><span class="op" id="4195545">,</span>&nbsp;<span class="ident" id="4195547">syscall</span><span class="op" id="4195554">.</span><span class="ident" id="4195555">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195566">fd</span><span class="op" id="4195568">,</span>&nbsp;<span class="ident" id="4195570">err</span>&nbsp;<span class="op" id="4195574">:=</span>&nbsp;<span class="ident" id="4195577">l</span><span class="op" id="4195578">.</span><span class="ident" id="4195579">fd</span><span class="op" id="4195581">.</span><span class="ident" id="4195582">accept</span><span class="op" id="4195588">(</span><span class="op" id="4195589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195592">if</span>&nbsp;<span class="ident" id="4195595">err</span>&nbsp;<span class="op" id="4195599">!=</span>&nbsp;<span class="ident" id="4195602">nil</span>&nbsp;<span class="op" id="4195606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195610">return</span>&nbsp;<span class="ident" id="4195617">nil</span><span class="op" id="4195620">,</span>&nbsp;<span class="ident" id="4195622">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195630">c</span>&nbsp;<span class="op" id="4195632">:=</span>&nbsp;<span class="ident" id="4195635">newUnixConn</span><span class="op" id="4195646">(</span><span class="ident" id="4195647">fd</span><span class="op" id="4195649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195652">return</span>&nbsp;<span class="ident" id="4195659">c</span><span class="op" id="4195660">,</span>&nbsp;<span class="ident" id="4195662">nil</span><br>
<span class="lineno"></span><span class="op" id="4195666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="4195669">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4195738">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="4195793">func</span>&nbsp;<span class="op" id="4195798">(</span><span class="ident" id="4195799">l</span>&nbsp;<span class="op" id="4195801">*</span><span class="ident" id="4195802">UnixListener</span><span class="op" id="4195814">)</span>&nbsp;<span class="ident" id="4195816">Accept</span><span class="op" id="4195822">(</span><span class="op" id="4195823">)</span>&nbsp;<span class="op" id="4195825">(</span><span class="ident" id="4195826">c</span>&nbsp;<span class="ident" id="4195828">Conn</span><span class="op" id="4195832">,</span>&nbsp;<span class="ident" id="4195834">err</span>&nbsp;<span class="builtintype" id="4195838">error</span><span class="op" id="4195843">)</span>&nbsp;<span class="op" id="4195845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195848">c1</span><span class="op" id="4195850">,</span>&nbsp;<span class="ident" id="4195852">err</span>&nbsp;<span class="op" id="4195856">:=</span>&nbsp;<span class="ident" id="4195859">l</span><span class="op" id="4195860">.</span><span class="ident" id="4195861">AcceptUnix</span><span class="op" id="4195871">(</span><span class="op" id="4195872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195875">if</span>&nbsp;<span class="ident" id="4195878">err</span>&nbsp;<span class="op" id="4195882">!=</span>&nbsp;<span class="ident" id="4195885">nil</span>&nbsp;<span class="op" id="4195889">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195893">return</span>&nbsp;<span class="ident" id="4195900">nil</span><span class="op" id="4195903">,</span>&nbsp;<span class="ident" id="4195905">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195913">return</span>&nbsp;<span class="ident" id="4195920">c1</span><span class="op" id="4195922">,</span>&nbsp;<span class="ident" id="4195924">nil</span><br>
<span class="lineno"></span><span class="op" id="4195928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4195931">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="4195995">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4196026">func</span>&nbsp;<span class="op" id="4196031">(</span><span class="ident" id="4196032">l</span>&nbsp;<span class="op" id="4196034">*</span><span class="ident" id="4196035">UnixListener</span><span class="op" id="4196047">)</span>&nbsp;<span class="ident" id="4196049">Close</span><span class="op" id="4196054">(</span><span class="op" id="4196055">)</span>&nbsp;<span class="builtintype" id="4196057">error</span>&nbsp;<span class="op" id="4196063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196066">if</span>&nbsp;<span class="ident" id="4196069">l</span>&nbsp;<span class="op" id="4196071">==</span>&nbsp;<span class="ident" id="4196074">nil</span>&nbsp;<span class="op" id="4196078">||</span>&nbsp;<span class="ident" id="4196081">l</span><span class="op" id="4196082">.</span><span class="ident" id="4196083">fd</span>&nbsp;<span class="op" id="4196086">==</span>&nbsp;<span class="ident" id="4196089">nil</span>&nbsp;<span class="op" id="4196093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196097">return</span>&nbsp;<span class="ident" id="4196104">syscall</span><span class="op" id="4196111">.</span><span class="ident" id="4196112">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196124">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196166">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196207">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196245">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196288">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196333">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196376">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196418">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196466">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4196512">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196546">if</span>&nbsp;<span class="ident" id="4196549">l</span><span class="op" id="4196550">.</span><span class="ident" id="4196551">path</span><span class="op" id="4196555">[</span><span class="num" id="4196556">0</span><span class="op" id="4196557">]</span>&nbsp;<span class="op" id="4196559">!=</span>&nbsp;<span class="string" id="4196562">&#39;@&#39;</span>&nbsp;<span class="op" id="4196566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196570">syscall</span><span class="op" id="4196577">.</span><span class="ident" id="4196578">Unlink</span><span class="op" id="4196584">(</span><span class="ident" id="4196585">l</span><span class="op" id="4196586">.</span><span class="ident" id="4196587">path</span><span class="op" id="4196591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196594">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196597">return</span>&nbsp;<span class="ident" id="4196604">l</span><span class="op" id="4196605">.</span><span class="ident" id="4196606">fd</span><span class="op" id="4196608">.</span><span class="ident" id="4196609">Close</span><span class="op" id="4196614">(</span><span class="op" id="4196615">)</span><br>
<span class="lineno"></span><span class="op" id="4196617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4196620">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4196668">func</span>&nbsp;<span class="op" id="4196673">(</span><span class="ident" id="4196674">l</span>&nbsp;<span class="op" id="4196676">*</span><span class="ident" id="4196677">UnixListener</span><span class="op" id="4196689">)</span>&nbsp;<span class="ident" id="4196691">Addr</span><span class="op" id="4196695">(</span><span class="op" id="4196696">)</span>&nbsp;<span class="ident" id="4196698">Addr</span>&nbsp;<span class="op" id="4196703">{</span>&nbsp;<span class="keyword" id="4196705">return</span>&nbsp;<span class="ident" id="4196712">l</span><span class="op" id="4196713">.</span><span class="ident" id="4196714">fd</span><span class="op" id="4196716">.</span><span class="ident" id="4196717">laddr</span>&nbsp;<span class="op" id="4196723">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4196726">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="4196789">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4196833">func</span>&nbsp;<span class="op" id="4196838">(</span><span class="ident" id="4196839">l</span>&nbsp;<span class="op" id="4196841">*</span><span class="ident" id="4196842">UnixListener</span><span class="op" id="4196854">)</span>&nbsp;<span class="ident" id="4196856">SetDeadline</span><span class="op" id="4196867">(</span><span class="ident" id="4196868">t</span>&nbsp;<span class="ident" id="4196870">time</span><span class="op" id="4196874">.</span><span class="ident" id="4196875">Time</span><span class="op" id="4196879">)</span>&nbsp;<span class="op" id="4196881">(</span><span class="ident" id="4196882">err</span>&nbsp;<span class="builtintype" id="4196886">error</span><span class="op" id="4196891">)</span>&nbsp;<span class="op" id="4196893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196896">if</span>&nbsp;<span class="ident" id="4196899">l</span>&nbsp;<span class="op" id="4196901">==</span>&nbsp;<span class="ident" id="4196904">nil</span>&nbsp;<span class="op" id="4196908">||</span>&nbsp;<span class="ident" id="4196911">l</span><span class="op" id="4196912">.</span><span class="ident" id="4196913">fd</span>&nbsp;<span class="op" id="4196916">==</span>&nbsp;<span class="ident" id="4196919">nil</span>&nbsp;<span class="op" id="4196923">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196927">return</span>&nbsp;<span class="ident" id="4196934">syscall</span><span class="op" id="4196941">.</span><span class="ident" id="4196942">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196953">return</span>&nbsp;<span class="ident" id="4196960">l</span><span class="op" id="4196961">.</span><span class="ident" id="4196962">fd</span><span class="op" id="4196964">.</span><span class="ident" id="4196965">setDeadline</span><span class="op" id="4196976">(</span><span class="ident" id="4196977">t</span><span class="op" id="4196978">)</span><br>
<span class="lineno"></span><span class="op" id="4196980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="4196983">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="4197049">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="4197119">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="4197184">//</span><br>
<span class="lineno"></span><span class="comment" id="4197187">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="4197251">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="4197317">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="4197381">func</span>&nbsp;<span class="op" id="4197386">(</span><span class="ident" id="4197387">l</span>&nbsp;<span class="op" id="4197389">*</span><span class="ident" id="4197390">UnixListener</span><span class="op" id="4197402">)</span>&nbsp;<span class="ident" id="4197404">File</span><span class="op" id="4197408">(</span><span class="op" id="4197409">)</span>&nbsp;<span class="op" id="4197411">(</span><span class="ident" id="4197412">f</span>&nbsp;<span class="op" id="4197414">*</span><span class="ident" id="4197415">os</span><span class="op" id="4197417">.</span><span class="ident" id="4197418">File</span><span class="op" id="4197422">,</span>&nbsp;<span class="ident" id="4197424">err</span>&nbsp;<span class="builtintype" id="4197428">error</span><span class="op" id="4197433">)</span>&nbsp;<span class="op" id="4197435">{</span>&nbsp;<span class="keyword" id="4197437">return</span>&nbsp;<span class="ident" id="4197444">l</span><span class="op" id="4197445">.</span><span class="ident" id="4197446">fd</span><span class="op" id="4197448">.</span><span class="ident" id="4197449">dup</span><span class="op" id="4197452">(</span><span class="op" id="4197453">)</span>&nbsp;<span class="op" id="4197455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4197458">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="4197529">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4197597">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4197667">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="4197726">func</span>&nbsp;<span class="ident" id="4197731">ListenUnixgram</span><span class="op" id="4197745">(</span><span class="ident" id="4197746">net</span>&nbsp;<span class="builtintype" id="4197750">string</span><span class="op" id="4197756">,</span>&nbsp;<span class="ident" id="4197758">laddr</span>&nbsp;<span class="op" id="4197764">*</span><span class="ident" id="4197765">UnixAddr</span><span class="op" id="4197773">)</span>&nbsp;<span class="op" id="4197775">(</span><span class="op" id="4197776">*</span><span class="ident" id="4197777">UnixConn</span><span class="op" id="4197785">,</span>&nbsp;<span class="builtintype" id="4197787">error</span><span class="op" id="4197792">)</span>&nbsp;<span class="op" id="4197794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197797">switch</span>&nbsp;<span class="ident" id="4197804">net</span>&nbsp;<span class="op" id="4197808">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197811">case</span>&nbsp;<span class="string" id="4197816">&#34;unixgram&#34;</span><span class="op" id="4197826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197829">default</span><span class="op" id="4197836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197840">return</span>&nbsp;<span class="ident" id="4197847">nil</span><span class="op" id="4197850">,</span>&nbsp;<span class="op" id="4197852">&amp;</span><span class="ident" id="4197853">OpError</span><span class="op" id="4197860">{</span><span class="ident" id="4197861">Op</span><span class="op" id="4197863">:</span>&nbsp;<span class="string" id="4197865">&#34;listen&#34;</span><span class="op" id="4197873">,</span>&nbsp;<span class="ident" id="4197875">Net</span><span class="op" id="4197878">:</span>&nbsp;<span class="ident" id="4197880">net</span><span class="op" id="4197883">,</span>&nbsp;<span class="ident" id="4197885">Addr</span><span class="op" id="4197889">:</span>&nbsp;<span class="ident" id="4197891">laddr</span><span class="op" id="4197896">,</span>&nbsp;<span class="ident" id="4197898">Err</span><span class="op" id="4197901">:</span>&nbsp;<span class="ident" id="4197903">UnknownNetworkError</span><span class="op" id="4197922">(</span><span class="ident" id="4197923">net</span><span class="op" id="4197926">)</span><span class="op" id="4197927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197933">if</span>&nbsp;<span class="ident" id="4197936">laddr</span>&nbsp;<span class="op" id="4197942">==</span>&nbsp;<span class="ident" id="4197945">nil</span>&nbsp;<span class="op" id="4197949">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197953">return</span>&nbsp;<span class="ident" id="4197960">nil</span><span class="op" id="4197963">,</span>&nbsp;<span class="op" id="4197965">&amp;</span><span class="ident" id="4197966">OpError</span><span class="op" id="4197973">{</span><span class="ident" id="4197974">Op</span><span class="op" id="4197976">:</span>&nbsp;<span class="string" id="4197978">&#34;listen&#34;</span><span class="op" id="4197986">,</span>&nbsp;<span class="ident" id="4197988">Net</span><span class="op" id="4197991">:</span>&nbsp;<span class="ident" id="4197993">net</span><span class="op" id="4197996">,</span>&nbsp;<span class="ident" id="4197998">Addr</span><span class="op" id="4198002">:</span>&nbsp;<span class="ident" id="4198004">nil</span><span class="op" id="4198007">,</span>&nbsp;<span class="ident" id="4198009">Err</span><span class="op" id="4198012">:</span>&nbsp;<span class="ident" id="4198014">errMissingAddress</span><span class="op" id="4198031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198037">fd</span><span class="op" id="4198039">,</span>&nbsp;<span class="ident" id="4198041">err</span>&nbsp;<span class="op" id="4198045">:=</span>&nbsp;<span class="ident" id="4198048">unixSocket</span><span class="op" id="4198058">(</span><span class="ident" id="4198059">net</span><span class="op" id="4198062">,</span>&nbsp;<span class="ident" id="4198064">laddr</span><span class="op" id="4198069">,</span>&nbsp;<span class="ident" id="4198071">nil</span><span class="op" id="4198074">,</span>&nbsp;<span class="string" id="4198076">&#34;listen&#34;</span><span class="op" id="4198084">,</span>&nbsp;<span class="ident" id="4198086">noDeadline</span><span class="op" id="4198096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198099">if</span>&nbsp;<span class="ident" id="4198102">err</span>&nbsp;<span class="op" id="4198106">!=</span>&nbsp;<span class="ident" id="4198109">nil</span>&nbsp;<span class="op" id="4198113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198117">return</span>&nbsp;<span class="ident" id="4198124">nil</span><span class="op" id="4198127">,</span>&nbsp;<span class="op" id="4198129">&amp;</span><span class="ident" id="4198130">OpError</span><span class="op" id="4198137">{</span><span class="ident" id="4198138">Op</span><span class="op" id="4198140">:</span>&nbsp;<span class="string" id="4198142">&#34;listen&#34;</span><span class="op" id="4198150">,</span>&nbsp;<span class="ident" id="4198152">Net</span><span class="op" id="4198155">:</span>&nbsp;<span class="ident" id="4198157">net</span><span class="op" id="4198160">,</span>&nbsp;<span class="ident" id="4198162">Addr</span><span class="op" id="4198166">:</span>&nbsp;<span class="ident" id="4198168">laddr</span><span class="op" id="4198173">,</span>&nbsp;<span class="ident" id="4198175">Err</span><span class="op" id="4198178">:</span>&nbsp;<span class="ident" id="4198180">err</span><span class="op" id="4198183">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198189">return</span>&nbsp;<span class="ident" id="4198196">newUnixConn</span><span class="op" id="4198207">(</span><span class="ident" id="4198208">fd</span><span class="op" id="4198210">)</span><span class="op" id="4198211">,</span>&nbsp;<span class="ident" id="4198213">nil</span><br>
<span class="lineno"></span><span class="op" id="4198217">}</span>
</div>
</body>
</html>
