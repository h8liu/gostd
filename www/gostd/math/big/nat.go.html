<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3975078">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3975133">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3975187">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3975238">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="3975306">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="3975352">//</span><br>
<span class="lineno"></span><span class="comment" id="3975355">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="3975380">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="3975406">//</span><br>
<span class="lineno"></span><span class="comment" id="3975409">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3975447">//</span><br>
<span class="lineno"></span><span class="comment" id="3975450">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="3975505">//</span><br>
<span class="lineno">15</span><span class="comment" id="3975508">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3975582">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="3975655">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="3975729">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3975803">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="3975820">//</span><br>
<span class="lineno"></span><span class="keyword" id="3975823">package</span>&nbsp;<span class="ident" id="3975831">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3975836">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3975907">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="3975978">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3975997">import</span>&nbsp;<span class="op" id="3976004">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3976007">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3976017">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3976023">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3976031">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3976044">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3976051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3976054">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3976091">//</span><br>
<span class="lineno"></span><span class="comment" id="3976094">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="3976160">//</span><br>
<span class="lineno"></span><span class="comment" id="3976163">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="3976235">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3976282">//</span><br>
<span class="lineno"></span><span class="comment" id="3976285">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3976354">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3976425">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="3976496">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="3976559">//</span><br>
<span class="lineno"></span><span class="keyword" id="3976562">type</span>&nbsp;<span class="ident" id="3976567">nat</span>&nbsp;<span class="op" id="3976571">[</span><span class="op" id="3976572">]</span><span class="ident" id="3976573">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3976579">var</span>&nbsp;<span class="op" id="3976583">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976586">natOne</span>&nbsp;<span class="op" id="3976593">=</span>&nbsp;<span class="ident" id="3976595">nat</span><span class="op" id="3976598">{</span><span class="num" id="3976599">1</span><span class="op" id="3976600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976603">natTwo</span>&nbsp;<span class="op" id="3976610">=</span>&nbsp;<span class="ident" id="3976612">nat</span><span class="op" id="3976615">{</span><span class="num" id="3976616">2</span><span class="op" id="3976617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976620">natTen</span>&nbsp;<span class="op" id="3976627">=</span>&nbsp;<span class="ident" id="3976629">nat</span><span class="op" id="3976632">{</span><span class="num" id="3976633">10</span><span class="op" id="3976635">}</span><br>
<span class="lineno"></span><span class="op" id="3976637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3976640">func</span>&nbsp;<span class="op" id="3976645">(</span><span class="ident" id="3976646">z</span>&nbsp;<span class="ident" id="3976648">nat</span><span class="op" id="3976651">)</span>&nbsp;<span class="ident" id="3976653">clear</span><span class="op" id="3976658">(</span><span class="op" id="3976659">)</span>&nbsp;<span class="op" id="3976661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976664">for</span>&nbsp;<span class="ident" id="3976668">i</span>&nbsp;<span class="op" id="3976670">:=</span>&nbsp;<span class="keyword" id="3976673">range</span>&nbsp;<span class="ident" id="3976679">z</span>&nbsp;<span class="op" id="3976681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976685">z</span><span class="op" id="3976686">[</span><span class="ident" id="3976687">i</span><span class="op" id="3976688">]</span>&nbsp;<span class="op" id="3976690">=</span>&nbsp;<span class="num" id="3976692">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976695">}</span><br>
<span class="lineno"></span><span class="op" id="3976697">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3976700">func</span>&nbsp;<span class="op" id="3976705">(</span><span class="ident" id="3976706">z</span>&nbsp;<span class="ident" id="3976708">nat</span><span class="op" id="3976711">)</span>&nbsp;<span class="ident" id="3976713">norm</span><span class="op" id="3976717">(</span><span class="op" id="3976718">)</span>&nbsp;<span class="ident" id="3976720">nat</span>&nbsp;<span class="op" id="3976724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976727">i</span>&nbsp;<span class="op" id="3976729">:=</span>&nbsp;<span class="builtinfunc" id="3976732">len</span><span class="op" id="3976735">(</span><span class="ident" id="3976736">z</span><span class="op" id="3976737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976740">for</span>&nbsp;<span class="ident" id="3976744">i</span>&nbsp;<span class="op" id="3976746">&gt;</span>&nbsp;<span class="num" id="3976748">0</span>&nbsp;<span class="op" id="3976750">&amp;&amp;</span>&nbsp;<span class="ident" id="3976753">z</span><span class="op" id="3976754">[</span><span class="ident" id="3976755">i</span><span class="op" id="3976756">-</span><span class="num" id="3976757">1</span><span class="op" id="3976758">]</span>&nbsp;<span class="op" id="3976760">==</span>&nbsp;<span class="num" id="3976763">0</span>&nbsp;<span class="op" id="3976765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976769">i</span><span class="op" id="3976770">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976777">return</span>&nbsp;<span class="ident" id="3976784">z</span><span class="op" id="3976785">[</span><span class="num" id="3976786">0</span><span class="op" id="3976787">:</span><span class="ident" id="3976788">i</span><span class="op" id="3976789">]</span><br>
<span class="lineno"></span><span class="op" id="3976791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3976794">func</span>&nbsp;<span class="op" id="3976799">(</span><span class="ident" id="3976800">z</span>&nbsp;<span class="ident" id="3976802">nat</span><span class="op" id="3976805">)</span>&nbsp;<span class="builtinfunc" id="3976807">make</span><span class="op" id="3976811">(</span><span class="ident" id="3976812">n</span>&nbsp;<span class="builtintype" id="3976814">int</span><span class="op" id="3976817">)</span>&nbsp;<span class="ident" id="3976819">nat</span>&nbsp;<span class="op" id="3976823">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976826">if</span>&nbsp;<span class="ident" id="3976829">n</span>&nbsp;<span class="op" id="3976831">&lt;=</span>&nbsp;<span class="builtinfunc" id="3976834">cap</span><span class="op" id="3976837">(</span><span class="ident" id="3976838">z</span><span class="op" id="3976839">)</span>&nbsp;<span class="op" id="3976841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976845">return</span>&nbsp;<span class="ident" id="3976852">z</span><span class="op" id="3976853">[</span><span class="num" id="3976854">0</span><span class="op" id="3976855">:</span><span class="ident" id="3976856">n</span><span class="op" id="3976857">]</span>&nbsp;<span class="comment" id="3976859">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3976874">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3976941">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977005">const</span>&nbsp;<span class="ident" id="3977011">e</span>&nbsp;<span class="op" id="3977013">=</span>&nbsp;<span class="num" id="3977015">4</span>&nbsp;<span class="comment" id="3977017">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977036">return</span>&nbsp;<span class="builtinfunc" id="3977043">make</span><span class="op" id="3977047">(</span><span class="ident" id="3977048">nat</span><span class="op" id="3977051">,</span>&nbsp;<span class="ident" id="3977053">n</span><span class="op" id="3977054">,</span>&nbsp;<span class="ident" id="3977056">n</span><span class="op" id="3977057">+</span><span class="ident" id="3977058">e</span><span class="op" id="3977059">)</span><br>
<span class="lineno"></span><span class="op" id="3977061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3977064">func</span>&nbsp;<span class="op" id="3977069">(</span><span class="ident" id="3977070">z</span>&nbsp;<span class="ident" id="3977072">nat</span><span class="op" id="3977075">)</span>&nbsp;<span class="ident" id="3977077">setWord</span><span class="op" id="3977084">(</span><span class="ident" id="3977085">x</span>&nbsp;<span class="ident" id="3977087">Word</span><span class="op" id="3977091">)</span>&nbsp;<span class="ident" id="3977093">nat</span>&nbsp;<span class="op" id="3977097">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977100">if</span>&nbsp;<span class="ident" id="3977103">x</span>&nbsp;<span class="op" id="3977105">==</span>&nbsp;<span class="num" id="3977108">0</span>&nbsp;<span class="op" id="3977110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977114">return</span>&nbsp;<span class="ident" id="3977121">z</span><span class="op" id="3977122">.</span><span class="builtinfunc" id="3977123">make</span><span class="op" id="3977127">(</span><span class="num" id="3977128">0</span><span class="op" id="3977129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977135">z</span>&nbsp;<span class="op" id="3977137">=</span>&nbsp;<span class="ident" id="3977139">z</span><span class="op" id="3977140">.</span><span class="builtinfunc" id="3977141">make</span><span class="op" id="3977145">(</span><span class="num" id="3977146">1</span><span class="op" id="3977147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977150">z</span><span class="op" id="3977151">[</span><span class="num" id="3977152">0</span><span class="op" id="3977153">]</span>&nbsp;<span class="op" id="3977155">=</span>&nbsp;<span class="ident" id="3977157">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977160">return</span>&nbsp;<span class="ident" id="3977167">z</span><br>
<span class="lineno"></span><span class="op" id="3977169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3977172">func</span>&nbsp;<span class="op" id="3977177">(</span><span class="ident" id="3977178">z</span>&nbsp;<span class="ident" id="3977180">nat</span><span class="op" id="3977183">)</span>&nbsp;<span class="ident" id="3977185">setUint64</span><span class="op" id="3977194">(</span><span class="ident" id="3977195">x</span>&nbsp;<span class="ident" id="3977197">uint64</span><span class="op" id="3977203">)</span>&nbsp;<span class="ident" id="3977205">nat</span>&nbsp;<span class="op" id="3977209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3977212">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977236">if</span>&nbsp;<span class="ident" id="3977239">w</span>&nbsp;<span class="op" id="3977241">:=</span>&nbsp;<span class="ident" id="3977244">Word</span><span class="op" id="3977248">(</span><span class="ident" id="3977249">x</span><span class="op" id="3977250">)</span><span class="op" id="3977251">;</span>&nbsp;<span class="ident" id="3977253">uint64</span><span class="op" id="3977259">(</span><span class="ident" id="3977260">w</span><span class="op" id="3977261">)</span>&nbsp;<span class="op" id="3977263">==</span>&nbsp;<span class="ident" id="3977266">x</span>&nbsp;<span class="op" id="3977268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977272">return</span>&nbsp;<span class="ident" id="3977279">z</span><span class="op" id="3977280">.</span><span class="ident" id="3977281">setWord</span><span class="op" id="3977288">(</span><span class="ident" id="3977289">w</span><span class="op" id="3977290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3977297">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977351">n</span>&nbsp;<span class="op" id="3977353">:=</span>&nbsp;<span class="num" id="3977356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977359">for</span>&nbsp;<span class="ident" id="3977363">t</span>&nbsp;<span class="op" id="3977365">:=</span>&nbsp;<span class="ident" id="3977368">x</span><span class="op" id="3977369">;</span>&nbsp;<span class="ident" id="3977371">t</span>&nbsp;<span class="op" id="3977373">&gt;</span>&nbsp;<span class="num" id="3977375">0</span><span class="op" id="3977376">;</span>&nbsp;<span class="ident" id="3977378">t</span>&nbsp;<span class="op" id="3977380">&gt;&gt;=</span>&nbsp;<span class="ident" id="3977384">_W</span>&nbsp;<span class="op" id="3977387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977391">n</span><span class="op" id="3977392">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3977400">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977425">z</span>&nbsp;<span class="op" id="3977427">=</span>&nbsp;<span class="ident" id="3977429">z</span><span class="op" id="3977430">.</span><span class="builtinfunc" id="3977431">make</span><span class="op" id="3977435">(</span><span class="ident" id="3977436">n</span><span class="op" id="3977437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977440">for</span>&nbsp;<span class="ident" id="3977444">i</span>&nbsp;<span class="op" id="3977446">:=</span>&nbsp;<span class="keyword" id="3977449">range</span>&nbsp;<span class="ident" id="3977455">z</span>&nbsp;<span class="op" id="3977457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977461">z</span><span class="op" id="3977462">[</span><span class="ident" id="3977463">i</span><span class="op" id="3977464">]</span>&nbsp;<span class="op" id="3977466">=</span>&nbsp;<span class="ident" id="3977468">Word</span><span class="op" id="3977472">(</span><span class="ident" id="3977473">x</span>&nbsp;<span class="op" id="3977475">&amp;</span>&nbsp;<span class="ident" id="3977477">_M</span><span class="op" id="3977479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977483">x</span>&nbsp;<span class="op" id="3977485">&gt;&gt;=</span>&nbsp;<span class="ident" id="3977489">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977497">return</span>&nbsp;<span class="ident" id="3977504">z</span><br>
<span class="lineno"></span><span class="op" id="3977506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3977509">func</span>&nbsp;<span class="op" id="3977514">(</span><span class="ident" id="3977515">z</span>&nbsp;<span class="ident" id="3977517">nat</span><span class="op" id="3977520">)</span>&nbsp;<span class="ident" id="3977522">set</span><span class="op" id="3977525">(</span><span class="ident" id="3977526">x</span>&nbsp;<span class="ident" id="3977528">nat</span><span class="op" id="3977531">)</span>&nbsp;<span class="ident" id="3977533">nat</span>&nbsp;<span class="op" id="3977537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977540">z</span>&nbsp;<span class="op" id="3977542">=</span>&nbsp;<span class="ident" id="3977544">z</span><span class="op" id="3977545">.</span><span class="builtinfunc" id="3977546">make</span><span class="op" id="3977550">(</span><span class="builtinfunc" id="3977551">len</span><span class="op" id="3977554">(</span><span class="ident" id="3977555">x</span><span class="op" id="3977556">)</span><span class="op" id="3977557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3977560">copy</span><span class="op" id="3977564">(</span><span class="ident" id="3977565">z</span><span class="op" id="3977566">,</span>&nbsp;<span class="ident" id="3977568">x</span><span class="op" id="3977569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977572">return</span>&nbsp;<span class="ident" id="3977579">z</span><br>
<span class="lineno"></span><span class="op" id="3977581">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3977584">func</span>&nbsp;<span class="op" id="3977589">(</span><span class="ident" id="3977590">z</span>&nbsp;<span class="ident" id="3977592">nat</span><span class="op" id="3977595">)</span>&nbsp;<span class="ident" id="3977597">add</span><span class="op" id="3977600">(</span><span class="ident" id="3977601">x</span><span class="op" id="3977602">,</span>&nbsp;<span class="ident" id="3977604">y</span>&nbsp;<span class="ident" id="3977606">nat</span><span class="op" id="3977609">)</span>&nbsp;<span class="ident" id="3977611">nat</span>&nbsp;<span class="op" id="3977615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977618">m</span>&nbsp;<span class="op" id="3977620">:=</span>&nbsp;<span class="builtinfunc" id="3977623">len</span><span class="op" id="3977626">(</span><span class="ident" id="3977627">x</span><span class="op" id="3977628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977631">n</span>&nbsp;<span class="op" id="3977633">:=</span>&nbsp;<span class="builtinfunc" id="3977636">len</span><span class="op" id="3977639">(</span><span class="ident" id="3977640">y</span><span class="op" id="3977641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977645">switch</span>&nbsp;<span class="op" id="3977652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977655">case</span>&nbsp;<span class="ident" id="3977660">m</span>&nbsp;<span class="op" id="3977662">&lt;</span>&nbsp;<span class="ident" id="3977664">n</span><span class="op" id="3977665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977669">return</span>&nbsp;<span class="ident" id="3977676">z</span><span class="op" id="3977677">.</span><span class="ident" id="3977678">add</span><span class="op" id="3977681">(</span><span class="ident" id="3977682">y</span><span class="op" id="3977683">,</span>&nbsp;<span class="ident" id="3977685">x</span><span class="op" id="3977686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977689">case</span>&nbsp;<span class="ident" id="3977694">m</span>&nbsp;<span class="op" id="3977696">==</span>&nbsp;<span class="num" id="3977699">0</span><span class="op" id="3977700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3977704">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977744">return</span>&nbsp;<span class="ident" id="3977751">z</span><span class="op" id="3977752">.</span><span class="builtinfunc" id="3977753">make</span><span class="op" id="3977757">(</span><span class="num" id="3977758">0</span><span class="op" id="3977759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977762">case</span>&nbsp;<span class="ident" id="3977767">n</span>&nbsp;<span class="op" id="3977769">==</span>&nbsp;<span class="num" id="3977772">0</span><span class="op" id="3977773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3977777">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977794">return</span>&nbsp;<span class="ident" id="3977801">z</span><span class="op" id="3977802">.</span><span class="ident" id="3977803">set</span><span class="op" id="3977806">(</span><span class="ident" id="3977807">x</span><span class="op" id="3977808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977811">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3977814">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977825">z</span>&nbsp;<span class="op" id="3977827">=</span>&nbsp;<span class="ident" id="3977829">z</span><span class="op" id="3977830">.</span><span class="builtinfunc" id="3977831">make</span><span class="op" id="3977835">(</span><span class="ident" id="3977836">m</span>&nbsp;<span class="op" id="3977838">+</span>&nbsp;<span class="num" id="3977840">1</span><span class="op" id="3977841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977844">c</span>&nbsp;<span class="op" id="3977846">:=</span>&nbsp;<span class="ident" id="3977849">addVV</span><span class="op" id="3977854">(</span><span class="ident" id="3977855">z</span><span class="op" id="3977856">[</span><span class="num" id="3977857">0</span><span class="op" id="3977858">:</span><span class="ident" id="3977859">n</span><span class="op" id="3977860">]</span><span class="op" id="3977861">,</span>&nbsp;<span class="ident" id="3977863">x</span><span class="op" id="3977864">,</span>&nbsp;<span class="ident" id="3977866">y</span><span class="op" id="3977867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977870">if</span>&nbsp;<span class="ident" id="3977873">m</span>&nbsp;<span class="op" id="3977875">&gt;</span>&nbsp;<span class="ident" id="3977877">n</span>&nbsp;<span class="op" id="3977879">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977883">c</span>&nbsp;<span class="op" id="3977885">=</span>&nbsp;<span class="ident" id="3977887">addVW</span><span class="op" id="3977892">(</span><span class="ident" id="3977893">z</span><span class="op" id="3977894">[</span><span class="ident" id="3977895">n</span><span class="op" id="3977896">:</span><span class="ident" id="3977897">m</span><span class="op" id="3977898">]</span><span class="op" id="3977899">,</span>&nbsp;<span class="ident" id="3977901">x</span><span class="op" id="3977902">[</span><span class="ident" id="3977903">n</span><span class="op" id="3977904">:</span><span class="op" id="3977905">]</span><span class="op" id="3977906">,</span>&nbsp;<span class="ident" id="3977908">c</span><span class="op" id="3977909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977915">z</span><span class="op" id="3977916">[</span><span class="ident" id="3977917">m</span><span class="op" id="3977918">]</span>&nbsp;<span class="op" id="3977920">=</span>&nbsp;<span class="ident" id="3977922">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977926">return</span>&nbsp;<span class="ident" id="3977933">z</span><span class="op" id="3977934">.</span><span class="ident" id="3977935">norm</span><span class="op" id="3977939">(</span><span class="op" id="3977940">)</span><br>
<span class="lineno">140</span><span class="op" id="3977942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3977945">func</span>&nbsp;<span class="op" id="3977950">(</span><span class="ident" id="3977951">z</span>&nbsp;<span class="ident" id="3977953">nat</span><span class="op" id="3977956">)</span>&nbsp;<span class="ident" id="3977958">sub</span><span class="op" id="3977961">(</span><span class="ident" id="3977962">x</span><span class="op" id="3977963">,</span>&nbsp;<span class="ident" id="3977965">y</span>&nbsp;<span class="ident" id="3977967">nat</span><span class="op" id="3977970">)</span>&nbsp;<span class="ident" id="3977972">nat</span>&nbsp;<span class="op" id="3977976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977979">m</span>&nbsp;<span class="op" id="3977981">:=</span>&nbsp;<span class="builtinfunc" id="3977984">len</span><span class="op" id="3977987">(</span><span class="ident" id="3977988">x</span><span class="op" id="3977989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977992">n</span>&nbsp;<span class="op" id="3977994">:=</span>&nbsp;<span class="builtinfunc" id="3977997">len</span><span class="op" id="3978000">(</span><span class="ident" id="3978001">y</span><span class="op" id="3978002">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978006">switch</span>&nbsp;<span class="op" id="3978013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978016">case</span>&nbsp;<span class="ident" id="3978021">m</span>&nbsp;<span class="op" id="3978023">&lt;</span>&nbsp;<span class="ident" id="3978025">n</span><span class="op" id="3978026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3978030">panic</span><span class="op" id="3978035">(</span><span class="string" id="3978036">&#34;underflow&#34;</span><span class="op" id="3978047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978050">case</span>&nbsp;<span class="ident" id="3978055">m</span>&nbsp;<span class="op" id="3978057">==</span>&nbsp;<span class="num" id="3978060">0</span><span class="op" id="3978061">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3978065">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978105">return</span>&nbsp;<span class="ident" id="3978112">z</span><span class="op" id="3978113">.</span><span class="builtinfunc" id="3978114">make</span><span class="op" id="3978118">(</span><span class="num" id="3978119">0</span><span class="op" id="3978120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978123">case</span>&nbsp;<span class="ident" id="3978128">n</span>&nbsp;<span class="op" id="3978130">==</span>&nbsp;<span class="num" id="3978133">0</span><span class="op" id="3978134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3978138">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978155">return</span>&nbsp;<span class="ident" id="3978162">z</span><span class="op" id="3978163">.</span><span class="ident" id="3978164">set</span><span class="op" id="3978167">(</span><span class="ident" id="3978168">x</span><span class="op" id="3978169">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3978175">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978186">z</span>&nbsp;<span class="op" id="3978188">=</span>&nbsp;<span class="ident" id="3978190">z</span><span class="op" id="3978191">.</span><span class="builtinfunc" id="3978192">make</span><span class="op" id="3978196">(</span><span class="ident" id="3978197">m</span><span class="op" id="3978198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978201">c</span>&nbsp;<span class="op" id="3978203">:=</span>&nbsp;<span class="ident" id="3978206">subVV</span><span class="op" id="3978211">(</span><span class="ident" id="3978212">z</span><span class="op" id="3978213">[</span><span class="num" id="3978214">0</span><span class="op" id="3978215">:</span><span class="ident" id="3978216">n</span><span class="op" id="3978217">]</span><span class="op" id="3978218">,</span>&nbsp;<span class="ident" id="3978220">x</span><span class="op" id="3978221">,</span>&nbsp;<span class="ident" id="3978223">y</span><span class="op" id="3978224">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978227">if</span>&nbsp;<span class="ident" id="3978230">m</span>&nbsp;<span class="op" id="3978232">&gt;</span>&nbsp;<span class="ident" id="3978234">n</span>&nbsp;<span class="op" id="3978236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978240">c</span>&nbsp;<span class="op" id="3978242">=</span>&nbsp;<span class="ident" id="3978244">subVW</span><span class="op" id="3978249">(</span><span class="ident" id="3978250">z</span><span class="op" id="3978251">[</span><span class="ident" id="3978252">n</span><span class="op" id="3978253">:</span><span class="op" id="3978254">]</span><span class="op" id="3978255">,</span>&nbsp;<span class="ident" id="3978257">x</span><span class="op" id="3978258">[</span><span class="ident" id="3978259">n</span><span class="op" id="3978260">:</span><span class="op" id="3978261">]</span><span class="op" id="3978262">,</span>&nbsp;<span class="ident" id="3978264">c</span><span class="op" id="3978265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978271">if</span>&nbsp;<span class="ident" id="3978274">c</span>&nbsp;<span class="op" id="3978276">!=</span>&nbsp;<span class="num" id="3978279">0</span>&nbsp;<span class="op" id="3978281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3978285">panic</span><span class="op" id="3978290">(</span><span class="string" id="3978291">&#34;underflow&#34;</span><span class="op" id="3978302">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978309">return</span>&nbsp;<span class="ident" id="3978316">z</span><span class="op" id="3978317">.</span><span class="ident" id="3978318">norm</span><span class="op" id="3978322">(</span><span class="op" id="3978323">)</span><br>
<span class="lineno"></span><span class="op" id="3978325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3978328">func</span>&nbsp;<span class="op" id="3978333">(</span><span class="ident" id="3978334">x</span>&nbsp;<span class="ident" id="3978336">nat</span><span class="op" id="3978339">)</span>&nbsp;<span class="ident" id="3978341">cmp</span><span class="op" id="3978344">(</span><span class="ident" id="3978345">y</span>&nbsp;<span class="ident" id="3978347">nat</span><span class="op" id="3978350">)</span>&nbsp;<span class="op" id="3978352">(</span><span class="ident" id="3978353">r</span>&nbsp;<span class="builtintype" id="3978355">int</span><span class="op" id="3978358">)</span>&nbsp;<span class="op" id="3978360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978363">m</span>&nbsp;<span class="op" id="3978365">:=</span>&nbsp;<span class="builtinfunc" id="3978368">len</span><span class="op" id="3978371">(</span><span class="ident" id="3978372">x</span><span class="op" id="3978373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978376">n</span>&nbsp;<span class="op" id="3978378">:=</span>&nbsp;<span class="builtinfunc" id="3978381">len</span><span class="op" id="3978384">(</span><span class="ident" id="3978385">y</span><span class="op" id="3978386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978389">if</span>&nbsp;<span class="ident" id="3978392">m</span>&nbsp;<span class="op" id="3978394">!=</span>&nbsp;<span class="ident" id="3978397">n</span>&nbsp;<span class="op" id="3978399">||</span>&nbsp;<span class="ident" id="3978402">m</span>&nbsp;<span class="op" id="3978404">==</span>&nbsp;<span class="num" id="3978407">0</span>&nbsp;<span class="op" id="3978409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978413">switch</span>&nbsp;<span class="op" id="3978420">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978424">case</span>&nbsp;<span class="ident" id="3978429">m</span>&nbsp;<span class="op" id="3978431">&lt;</span>&nbsp;<span class="ident" id="3978433">n</span><span class="op" id="3978434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978439">r</span>&nbsp;<span class="op" id="3978441">=</span>&nbsp;<span class="op" id="3978443">-</span><span class="num" id="3978444">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978448">case</span>&nbsp;<span class="ident" id="3978453">m</span>&nbsp;<span class="op" id="3978455">&gt;</span>&nbsp;<span class="ident" id="3978457">n</span><span class="op" id="3978458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978463">r</span>&nbsp;<span class="op" id="3978465">=</span>&nbsp;<span class="num" id="3978467">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978471">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978475">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978487">i</span>&nbsp;<span class="op" id="3978489">:=</span>&nbsp;<span class="ident" id="3978492">m</span>&nbsp;<span class="op" id="3978494">-</span>&nbsp;<span class="num" id="3978496">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978499">for</span>&nbsp;<span class="ident" id="3978503">i</span>&nbsp;<span class="op" id="3978505">&gt;</span>&nbsp;<span class="num" id="3978507">0</span>&nbsp;<span class="op" id="3978509">&amp;&amp;</span>&nbsp;<span class="ident" id="3978512">x</span><span class="op" id="3978513">[</span><span class="ident" id="3978514">i</span><span class="op" id="3978515">]</span>&nbsp;<span class="op" id="3978517">==</span>&nbsp;<span class="ident" id="3978520">y</span><span class="op" id="3978521">[</span><span class="ident" id="3978522">i</span><span class="op" id="3978523">]</span>&nbsp;<span class="op" id="3978525">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978529">i</span><span class="op" id="3978530">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978538">switch</span>&nbsp;<span class="op" id="3978545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978548">case</span>&nbsp;<span class="ident" id="3978553">x</span><span class="op" id="3978554">[</span><span class="ident" id="3978555">i</span><span class="op" id="3978556">]</span>&nbsp;<span class="op" id="3978558">&lt;</span>&nbsp;<span class="ident" id="3978560">y</span><span class="op" id="3978561">[</span><span class="ident" id="3978562">i</span><span class="op" id="3978563">]</span><span class="op" id="3978564">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978568">r</span>&nbsp;<span class="op" id="3978570">=</span>&nbsp;<span class="op" id="3978572">-</span><span class="num" id="3978573">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978576">case</span>&nbsp;<span class="ident" id="3978581">x</span><span class="op" id="3978582">[</span><span class="ident" id="3978583">i</span><span class="op" id="3978584">]</span>&nbsp;<span class="op" id="3978586">&gt;</span>&nbsp;<span class="ident" id="3978588">y</span><span class="op" id="3978589">[</span><span class="ident" id="3978590">i</span><span class="op" id="3978591">]</span><span class="op" id="3978592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978596">r</span>&nbsp;<span class="op" id="3978598">=</span>&nbsp;<span class="num" id="3978600">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978606">return</span><br>
<span class="lineno">195</span><span class="op" id="3978613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3978616">func</span>&nbsp;<span class="op" id="3978621">(</span><span class="ident" id="3978622">z</span>&nbsp;<span class="ident" id="3978624">nat</span><span class="op" id="3978627">)</span>&nbsp;<span class="ident" id="3978629">mulAddWW</span><span class="op" id="3978637">(</span><span class="ident" id="3978638">x</span>&nbsp;<span class="ident" id="3978640">nat</span><span class="op" id="3978643">,</span>&nbsp;<span class="ident" id="3978645">y</span><span class="op" id="3978646">,</span>&nbsp;<span class="ident" id="3978648">r</span>&nbsp;<span class="ident" id="3978650">Word</span><span class="op" id="3978654">)</span>&nbsp;<span class="ident" id="3978656">nat</span>&nbsp;<span class="op" id="3978660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978663">m</span>&nbsp;<span class="op" id="3978665">:=</span>&nbsp;<span class="builtinfunc" id="3978668">len</span><span class="op" id="3978671">(</span><span class="ident" id="3978672">x</span><span class="op" id="3978673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978676">if</span>&nbsp;<span class="ident" id="3978679">m</span>&nbsp;<span class="op" id="3978681">==</span>&nbsp;<span class="num" id="3978684">0</span>&nbsp;<span class="op" id="3978686">||</span>&nbsp;<span class="ident" id="3978689">y</span>&nbsp;<span class="op" id="3978691">==</span>&nbsp;<span class="num" id="3978694">0</span>&nbsp;<span class="op" id="3978696">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978700">return</span>&nbsp;<span class="ident" id="3978707">z</span><span class="op" id="3978708">.</span><span class="ident" id="3978709">setWord</span><span class="op" id="3978716">(</span><span class="ident" id="3978717">r</span><span class="op" id="3978718">)</span>&nbsp;<span class="comment" id="3978720">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3978739">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978750">z</span>&nbsp;<span class="op" id="3978752">=</span>&nbsp;<span class="ident" id="3978754">z</span><span class="op" id="3978755">.</span><span class="builtinfunc" id="3978756">make</span><span class="op" id="3978760">(</span><span class="ident" id="3978761">m</span>&nbsp;<span class="op" id="3978763">+</span>&nbsp;<span class="num" id="3978765">1</span><span class="op" id="3978766">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978769">z</span><span class="op" id="3978770">[</span><span class="ident" id="3978771">m</span><span class="op" id="3978772">]</span>&nbsp;<span class="op" id="3978774">=</span>&nbsp;<span class="ident" id="3978776">mulAddVWW</span><span class="op" id="3978785">(</span><span class="ident" id="3978786">z</span><span class="op" id="3978787">[</span><span class="num" id="3978788">0</span><span class="op" id="3978789">:</span><span class="ident" id="3978790">m</span><span class="op" id="3978791">]</span><span class="op" id="3978792">,</span>&nbsp;<span class="ident" id="3978794">x</span><span class="op" id="3978795">,</span>&nbsp;<span class="ident" id="3978797">y</span><span class="op" id="3978798">,</span>&nbsp;<span class="ident" id="3978800">r</span><span class="op" id="3978801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978805">return</span>&nbsp;<span class="ident" id="3978812">z</span><span class="op" id="3978813">.</span><span class="ident" id="3978814">norm</span><span class="op" id="3978818">(</span><span class="op" id="3978819">)</span><br>
<span class="lineno"></span><span class="op" id="3978821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3978824">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3978883">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="3978951">func</span>&nbsp;<span class="ident" id="3978956">basicMul</span><span class="op" id="3978964">(</span><span class="ident" id="3978965">z</span><span class="op" id="3978966">,</span>&nbsp;<span class="ident" id="3978968">x</span><span class="op" id="3978969">,</span>&nbsp;<span class="ident" id="3978971">y</span>&nbsp;<span class="ident" id="3978973">nat</span><span class="op" id="3978976">)</span>&nbsp;<span class="op" id="3978978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978981">z</span><span class="op" id="3978982">[</span><span class="num" id="3978983">0</span>&nbsp;<span class="op" id="3978985">:</span>&nbsp;<span class="builtinfunc" id="3978987">len</span><span class="op" id="3978990">(</span><span class="ident" id="3978991">x</span><span class="op" id="3978992">)</span><span class="op" id="3978993">+</span><span class="builtinfunc" id="3978994">len</span><span class="op" id="3978997">(</span><span class="ident" id="3978998">y</span><span class="op" id="3978999">)</span><span class="op" id="3979000">]</span><span class="op" id="3979001">.</span><span class="ident" id="3979002">clear</span><span class="op" id="3979007">(</span><span class="op" id="3979008">)</span>&nbsp;<span class="comment" id="3979010">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979027">for</span>&nbsp;<span class="ident" id="3979031">i</span><span class="op" id="3979032">,</span>&nbsp;<span class="ident" id="3979034">d</span>&nbsp;<span class="op" id="3979036">:=</span>&nbsp;<span class="keyword" id="3979039">range</span>&nbsp;<span class="ident" id="3979045">y</span>&nbsp;<span class="op" id="3979047">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979051">if</span>&nbsp;<span class="ident" id="3979054">d</span>&nbsp;<span class="op" id="3979056">!=</span>&nbsp;<span class="num" id="3979059">0</span>&nbsp;<span class="op" id="3979061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979066">z</span><span class="op" id="3979067">[</span><span class="builtinfunc" id="3979068">len</span><span class="op" id="3979071">(</span><span class="ident" id="3979072">x</span><span class="op" id="3979073">)</span><span class="op" id="3979074">+</span><span class="ident" id="3979075">i</span><span class="op" id="3979076">]</span>&nbsp;<span class="op" id="3979078">=</span>&nbsp;<span class="ident" id="3979080">addMulVVW</span><span class="op" id="3979089">(</span><span class="ident" id="3979090">z</span><span class="op" id="3979091">[</span><span class="ident" id="3979092">i</span><span class="op" id="3979093">:</span><span class="ident" id="3979094">i</span><span class="op" id="3979095">+</span><span class="builtinfunc" id="3979096">len</span><span class="op" id="3979099">(</span><span class="ident" id="3979100">x</span><span class="op" id="3979101">)</span><span class="op" id="3979102">]</span><span class="op" id="3979103">,</span>&nbsp;<span class="ident" id="3979105">x</span><span class="op" id="3979106">,</span>&nbsp;<span class="ident" id="3979108">d</span><span class="op" id="3979109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979116">}</span><br>
<span class="lineno"></span><span class="op" id="3979118">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3979121">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3979196">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="3979260">func</span>&nbsp;<span class="ident" id="3979265">karatsubaAdd</span><span class="op" id="3979277">(</span><span class="ident" id="3979278">z</span><span class="op" id="3979279">,</span>&nbsp;<span class="ident" id="3979281">x</span>&nbsp;<span class="ident" id="3979283">nat</span><span class="op" id="3979286">,</span>&nbsp;<span class="ident" id="3979288">n</span>&nbsp;<span class="builtintype" id="3979290">int</span><span class="op" id="3979293">)</span>&nbsp;<span class="op" id="3979295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979298">if</span>&nbsp;<span class="ident" id="3979301">c</span>&nbsp;<span class="op" id="3979303">:=</span>&nbsp;<span class="ident" id="3979306">addVV</span><span class="op" id="3979311">(</span><span class="ident" id="3979312">z</span><span class="op" id="3979313">[</span><span class="num" id="3979314">0</span><span class="op" id="3979315">:</span><span class="ident" id="3979316">n</span><span class="op" id="3979317">]</span><span class="op" id="3979318">,</span>&nbsp;<span class="ident" id="3979320">z</span><span class="op" id="3979321">,</span>&nbsp;<span class="ident" id="3979323">x</span><span class="op" id="3979324">)</span><span class="op" id="3979325">;</span>&nbsp;<span class="ident" id="3979327">c</span>&nbsp;<span class="op" id="3979329">!=</span>&nbsp;<span class="num" id="3979332">0</span>&nbsp;<span class="op" id="3979334">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979338">addVW</span><span class="op" id="3979343">(</span><span class="ident" id="3979344">z</span><span class="op" id="3979345">[</span><span class="ident" id="3979346">n</span><span class="op" id="3979347">:</span><span class="ident" id="3979348">n</span><span class="op" id="3979349">+</span><span class="ident" id="3979350">n</span><span class="op" id="3979351">&gt;&gt;</span><span class="num" id="3979353">1</span><span class="op" id="3979354">]</span><span class="op" id="3979355">,</span>&nbsp;<span class="ident" id="3979357">z</span><span class="op" id="3979358">[</span><span class="ident" id="3979359">n</span><span class="op" id="3979360">:</span><span class="op" id="3979361">]</span><span class="op" id="3979362">,</span>&nbsp;<span class="ident" id="3979364">c</span><span class="op" id="3979365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979368">}</span><br>
<span class="lineno"></span><span class="op" id="3979370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3979373">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="3979414">func</span>&nbsp;<span class="ident" id="3979419">karatsubaSub</span><span class="op" id="3979431">(</span><span class="ident" id="3979432">z</span><span class="op" id="3979433">,</span>&nbsp;<span class="ident" id="3979435">x</span>&nbsp;<span class="ident" id="3979437">nat</span><span class="op" id="3979440">,</span>&nbsp;<span class="ident" id="3979442">n</span>&nbsp;<span class="builtintype" id="3979444">int</span><span class="op" id="3979447">)</span>&nbsp;<span class="op" id="3979449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979452">if</span>&nbsp;<span class="ident" id="3979455">c</span>&nbsp;<span class="op" id="3979457">:=</span>&nbsp;<span class="ident" id="3979460">subVV</span><span class="op" id="3979465">(</span><span class="ident" id="3979466">z</span><span class="op" id="3979467">[</span><span class="num" id="3979468">0</span><span class="op" id="3979469">:</span><span class="ident" id="3979470">n</span><span class="op" id="3979471">]</span><span class="op" id="3979472">,</span>&nbsp;<span class="ident" id="3979474">z</span><span class="op" id="3979475">,</span>&nbsp;<span class="ident" id="3979477">x</span><span class="op" id="3979478">)</span><span class="op" id="3979479">;</span>&nbsp;<span class="ident" id="3979481">c</span>&nbsp;<span class="op" id="3979483">!=</span>&nbsp;<span class="num" id="3979486">0</span>&nbsp;<span class="op" id="3979488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979492">subVW</span><span class="op" id="3979497">(</span><span class="ident" id="3979498">z</span><span class="op" id="3979499">[</span><span class="ident" id="3979500">n</span><span class="op" id="3979501">:</span><span class="ident" id="3979502">n</span><span class="op" id="3979503">+</span><span class="ident" id="3979504">n</span><span class="op" id="3979505">&gt;&gt;</span><span class="num" id="3979507">1</span><span class="op" id="3979508">]</span><span class="op" id="3979509">,</span>&nbsp;<span class="ident" id="3979511">z</span><span class="op" id="3979512">[</span><span class="ident" id="3979513">n</span><span class="op" id="3979514">:</span><span class="op" id="3979515">]</span><span class="op" id="3979516">,</span>&nbsp;<span class="ident" id="3979518">c</span><span class="op" id="3979519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979522">}</span><br>
<span class="lineno"></span><span class="op" id="3979524">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3979527">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3979601">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3979679">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3979691">var</span>&nbsp;<span class="ident" id="3979695">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="3979714">int</span>&nbsp;<span class="op" id="3979718">=</span>&nbsp;<span class="num" id="3979720">40</span>&nbsp;<span class="comment" id="3979723">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3979752">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3979812">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3979872">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="3979932">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="3979988">func</span>&nbsp;<span class="ident" id="3979993">karatsuba</span><span class="op" id="3980002">(</span><span class="ident" id="3980003">z</span><span class="op" id="3980004">,</span>&nbsp;<span class="ident" id="3980006">x</span><span class="op" id="3980007">,</span>&nbsp;<span class="ident" id="3980009">y</span>&nbsp;<span class="ident" id="3980011">nat</span><span class="op" id="3980014">)</span>&nbsp;<span class="op" id="3980016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980019">n</span>&nbsp;<span class="op" id="3980021">:=</span>&nbsp;<span class="builtinfunc" id="3980024">len</span><span class="op" id="3980027">(</span><span class="ident" id="3980028">y</span><span class="op" id="3980029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980033">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980097">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980157">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980175">if</span>&nbsp;<span class="ident" id="3980178">n</span><span class="op" id="3980179">&amp;</span><span class="num" id="3980180">1</span>&nbsp;<span class="op" id="3980182">!=</span>&nbsp;<span class="num" id="3980185">0</span>&nbsp;<span class="op" id="3980187">||</span>&nbsp;<span class="ident" id="3980190">n</span>&nbsp;<span class="op" id="3980192">&lt;</span>&nbsp;<span class="ident" id="3980194">karatsubaThreshold</span>&nbsp;<span class="op" id="3980213">||</span>&nbsp;<span class="ident" id="3980216">n</span>&nbsp;<span class="op" id="3980218">&lt;</span>&nbsp;<span class="num" id="3980220">2</span>&nbsp;<span class="op" id="3980222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980226">basicMul</span><span class="op" id="3980234">(</span><span class="ident" id="3980235">z</span><span class="op" id="3980236">,</span>&nbsp;<span class="ident" id="3980238">x</span><span class="op" id="3980239">,</span>&nbsp;<span class="ident" id="3980241">y</span><span class="op" id="3980242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980246">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980254">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980257">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980308">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980370">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980404">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980408">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980428">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980448">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980452">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980515">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980533">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980537">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980587">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980637">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980641">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980651">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980655">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980674">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980693">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980697">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980748">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980799">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980850">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980901">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980943">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980972">n2</span>&nbsp;<span class="op" id="3980975">:=</span>&nbsp;<span class="ident" id="3980978">n</span>&nbsp;<span class="op" id="3980980">&gt;&gt;</span>&nbsp;<span class="num" id="3980983">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3980998">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981010">x1</span><span class="op" id="3981012">,</span>&nbsp;<span class="ident" id="3981014">x0</span>&nbsp;<span class="op" id="3981017">:=</span>&nbsp;<span class="ident" id="3981020">x</span><span class="op" id="3981021">[</span><span class="ident" id="3981022">n2</span><span class="op" id="3981024">:</span><span class="op" id="3981025">]</span><span class="op" id="3981026">,</span>&nbsp;<span class="ident" id="3981028">x</span><span class="op" id="3981029">[</span><span class="num" id="3981030">0</span><span class="op" id="3981031">:</span><span class="ident" id="3981032">n2</span><span class="op" id="3981034">]</span>&nbsp;<span class="comment" id="3981036">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981054">y1</span><span class="op" id="3981056">,</span>&nbsp;<span class="ident" id="3981058">y0</span>&nbsp;<span class="op" id="3981061">:=</span>&nbsp;<span class="ident" id="3981064">y</span><span class="op" id="3981065">[</span><span class="ident" id="3981066">n2</span><span class="op" id="3981068">:</span><span class="op" id="3981069">]</span><span class="op" id="3981070">,</span>&nbsp;<span class="ident" id="3981072">y</span><span class="op" id="3981073">[</span><span class="num" id="3981074">0</span><span class="op" id="3981075">:</span><span class="ident" id="3981076">n2</span><span class="op" id="3981078">]</span>&nbsp;<span class="comment" id="3981080">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981099">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981151">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981155">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981213">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981271">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981275">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981336">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981398">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981415">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981469">karatsuba</span><span class="op" id="3981478">(</span><span class="ident" id="3981479">z</span><span class="op" id="3981480">,</span>&nbsp;<span class="ident" id="3981482">x0</span><span class="op" id="3981484">,</span>&nbsp;<span class="ident" id="3981486">y0</span><span class="op" id="3981488">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3981494">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981509">karatsuba</span><span class="op" id="3981518">(</span><span class="ident" id="3981519">z</span><span class="op" id="3981520">[</span><span class="ident" id="3981521">n</span><span class="op" id="3981522">:</span><span class="op" id="3981523">]</span><span class="op" id="3981524">,</span>&nbsp;<span class="ident" id="3981526">x1</span><span class="op" id="3981528">,</span>&nbsp;<span class="ident" id="3981530">y1</span><span class="op" id="3981532">)</span>&nbsp;<span class="comment" id="3981534">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981550">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981609">s</span>&nbsp;<span class="op" id="3981611">:=</span>&nbsp;<span class="num" id="3981614">1</span>&nbsp;<span class="comment" id="3981616">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981642">xd</span>&nbsp;<span class="op" id="3981645">:=</span>&nbsp;<span class="ident" id="3981648">z</span><span class="op" id="3981649">[</span><span class="num" id="3981650">2</span><span class="op" id="3981651">*</span><span class="ident" id="3981652">n</span>&nbsp;<span class="op" id="3981654">:</span>&nbsp;<span class="num" id="3981656">2</span><span class="op" id="3981657">*</span><span class="ident" id="3981658">n</span><span class="op" id="3981659">+</span><span class="ident" id="3981660">n2</span><span class="op" id="3981662">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981665">if</span>&nbsp;<span class="ident" id="3981668">subVV</span><span class="op" id="3981673">(</span><span class="ident" id="3981674">xd</span><span class="op" id="3981676">,</span>&nbsp;<span class="ident" id="3981678">x1</span><span class="op" id="3981680">,</span>&nbsp;<span class="ident" id="3981682">x0</span><span class="op" id="3981684">)</span>&nbsp;<span class="op" id="3981686">!=</span>&nbsp;<span class="num" id="3981689">0</span>&nbsp;<span class="op" id="3981691">{</span>&nbsp;<span class="comment" id="3981693">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981704">s</span>&nbsp;<span class="op" id="3981706">=</span>&nbsp;<span class="op" id="3981708">-</span><span class="ident" id="3981709">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981713">subVV</span><span class="op" id="3981718">(</span><span class="ident" id="3981719">xd</span><span class="op" id="3981721">,</span>&nbsp;<span class="ident" id="3981723">x0</span><span class="op" id="3981725">,</span>&nbsp;<span class="ident" id="3981727">x1</span><span class="op" id="3981729">)</span>&nbsp;<span class="comment" id="3981731">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981741">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981745">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981804">yd</span>&nbsp;<span class="op" id="3981807">:=</span>&nbsp;<span class="ident" id="3981810">z</span><span class="op" id="3981811">[</span><span class="num" id="3981812">2</span><span class="op" id="3981813">*</span><span class="ident" id="3981814">n</span><span class="op" id="3981815">+</span><span class="ident" id="3981816">n2</span>&nbsp;<span class="op" id="3981819">:</span>&nbsp;<span class="num" id="3981821">3</span><span class="op" id="3981822">*</span><span class="ident" id="3981823">n</span><span class="op" id="3981824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981827">if</span>&nbsp;<span class="ident" id="3981830">subVV</span><span class="op" id="3981835">(</span><span class="ident" id="3981836">yd</span><span class="op" id="3981838">,</span>&nbsp;<span class="ident" id="3981840">y0</span><span class="op" id="3981842">,</span>&nbsp;<span class="ident" id="3981844">y1</span><span class="op" id="3981846">)</span>&nbsp;<span class="op" id="3981848">!=</span>&nbsp;<span class="num" id="3981851">0</span>&nbsp;<span class="op" id="3981853">{</span>&nbsp;<span class="comment" id="3981855">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981866">s</span>&nbsp;<span class="op" id="3981868">=</span>&nbsp;<span class="op" id="3981870">-</span><span class="ident" id="3981871">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981875">subVV</span><span class="op" id="3981880">(</span><span class="ident" id="3981881">yd</span><span class="op" id="3981883">,</span>&nbsp;<span class="ident" id="3981885">y1</span><span class="op" id="3981887">,</span>&nbsp;<span class="ident" id="3981889">y0</span><span class="op" id="3981891">)</span>&nbsp;<span class="comment" id="3981893">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981907">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981974">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982041">p</span>&nbsp;<span class="op" id="3982043">:=</span>&nbsp;<span class="ident" id="3982046">z</span><span class="op" id="3982047">[</span><span class="ident" id="3982048">n</span><span class="op" id="3982049">*</span><span class="num" id="3982050">3</span><span class="op" id="3982051">:</span><span class="op" id="3982052">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982055">karatsuba</span><span class="op" id="3982064">(</span><span class="ident" id="3982065">p</span><span class="op" id="3982066">,</span>&nbsp;<span class="ident" id="3982068">xd</span><span class="op" id="3982070">,</span>&nbsp;<span class="ident" id="3982072">yd</span><span class="op" id="3982074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982078">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982102">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982161">r</span>&nbsp;<span class="op" id="3982163">:=</span>&nbsp;<span class="ident" id="3982166">z</span><span class="op" id="3982167">[</span><span class="ident" id="3982168">n</span><span class="op" id="3982169">*</span><span class="num" id="3982170">4</span><span class="op" id="3982171">:</span><span class="op" id="3982172">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3982175">copy</span><span class="op" id="3982179">(</span><span class="ident" id="3982180">r</span><span class="op" id="3982181">,</span>&nbsp;<span class="ident" id="3982183">z</span><span class="op" id="3982184">[</span><span class="op" id="3982185">:</span><span class="ident" id="3982186">n</span><span class="op" id="3982187">*</span><span class="num" id="3982188">2</span><span class="op" id="3982189">]</span><span class="op" id="3982190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982194">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982226">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982230">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982252">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982274">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982293">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982312">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982331">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982335">karatsubaAdd</span><span class="op" id="3982347">(</span><span class="ident" id="3982348">z</span><span class="op" id="3982349">[</span><span class="ident" id="3982350">n2</span><span class="op" id="3982352">:</span><span class="op" id="3982353">]</span><span class="op" id="3982354">,</span>&nbsp;<span class="ident" id="3982356">r</span><span class="op" id="3982357">,</span>&nbsp;<span class="ident" id="3982359">n</span><span class="op" id="3982360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982363">karatsubaAdd</span><span class="op" id="3982375">(</span><span class="ident" id="3982376">z</span><span class="op" id="3982377">[</span><span class="ident" id="3982378">n2</span><span class="op" id="3982380">:</span><span class="op" id="3982381">]</span><span class="op" id="3982382">,</span>&nbsp;<span class="ident" id="3982384">r</span><span class="op" id="3982385">[</span><span class="ident" id="3982386">n</span><span class="op" id="3982387">:</span><span class="op" id="3982388">]</span><span class="op" id="3982389">,</span>&nbsp;<span class="ident" id="3982391">n</span><span class="op" id="3982392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982395">if</span>&nbsp;<span class="ident" id="3982398">s</span>&nbsp;<span class="op" id="3982400">&gt;</span>&nbsp;<span class="num" id="3982402">0</span>&nbsp;<span class="op" id="3982404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982408">karatsubaAdd</span><span class="op" id="3982420">(</span><span class="ident" id="3982421">z</span><span class="op" id="3982422">[</span><span class="ident" id="3982423">n2</span><span class="op" id="3982425">:</span><span class="op" id="3982426">]</span><span class="op" id="3982427">,</span>&nbsp;<span class="ident" id="3982429">p</span><span class="op" id="3982430">,</span>&nbsp;<span class="ident" id="3982432">n</span><span class="op" id="3982433">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982436">}</span>&nbsp;<span class="keyword" id="3982438">else</span>&nbsp;<span class="op" id="3982443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982447">karatsubaSub</span><span class="op" id="3982459">(</span><span class="ident" id="3982460">z</span><span class="op" id="3982461">[</span><span class="ident" id="3982462">n2</span><span class="op" id="3982464">:</span><span class="op" id="3982465">]</span><span class="op" id="3982466">,</span>&nbsp;<span class="ident" id="3982468">p</span><span class="op" id="3982469">,</span>&nbsp;<span class="ident" id="3982471">n</span><span class="op" id="3982472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982475">}</span><br>
<span class="lineno"></span><span class="op" id="3982477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3982480">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3982540">func</span>&nbsp;<span class="ident" id="3982545">alias</span><span class="op" id="3982550">(</span><span class="ident" id="3982551">x</span><span class="op" id="3982552">,</span>&nbsp;<span class="ident" id="3982554">y</span>&nbsp;<span class="ident" id="3982556">nat</span><span class="op" id="3982559">)</span>&nbsp;<span class="builtintype" id="3982561">bool</span>&nbsp;<span class="op" id="3982566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982569">return</span>&nbsp;<span class="builtinfunc" id="3982576">cap</span><span class="op" id="3982579">(</span><span class="ident" id="3982580">x</span><span class="op" id="3982581">)</span>&nbsp;<span class="op" id="3982583">&gt;</span>&nbsp;<span class="num" id="3982585">0</span>&nbsp;<span class="op" id="3982587">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3982590">cap</span><span class="op" id="3982593">(</span><span class="ident" id="3982594">y</span><span class="op" id="3982595">)</span>&nbsp;<span class="op" id="3982597">&gt;</span>&nbsp;<span class="num" id="3982599">0</span>&nbsp;<span class="op" id="3982601">&amp;&amp;</span>&nbsp;<span class="op" id="3982604">&amp;</span><span class="ident" id="3982605">x</span><span class="op" id="3982606">[</span><span class="num" id="3982607">0</span><span class="op" id="3982608">:</span><span class="builtinfunc" id="3982609">cap</span><span class="op" id="3982612">(</span><span class="ident" id="3982613">x</span><span class="op" id="3982614">)</span><span class="op" id="3982615">]</span><span class="op" id="3982616">[</span><span class="builtinfunc" id="3982617">cap</span><span class="op" id="3982620">(</span><span class="ident" id="3982621">x</span><span class="op" id="3982622">)</span><span class="op" id="3982623">-</span><span class="num" id="3982624">1</span><span class="op" id="3982625">]</span>&nbsp;<span class="op" id="3982627">==</span>&nbsp;<span class="op" id="3982630">&amp;</span><span class="ident" id="3982631">y</span><span class="op" id="3982632">[</span><span class="num" id="3982633">0</span><span class="op" id="3982634">:</span><span class="builtinfunc" id="3982635">cap</span><span class="op" id="3982638">(</span><span class="ident" id="3982639">y</span><span class="op" id="3982640">)</span><span class="op" id="3982641">]</span><span class="op" id="3982642">[</span><span class="builtinfunc" id="3982643">cap</span><span class="op" id="3982646">(</span><span class="ident" id="3982647">y</span><span class="op" id="3982648">)</span><span class="op" id="3982649">-</span><span class="num" id="3982650">1</span><span class="op" id="3982651">]</span><br>
<span class="lineno"></span><span class="op" id="3982653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3982656">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3982715">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3982775">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3982839">func</span>&nbsp;<span class="ident" id="3982844">addAt</span><span class="op" id="3982849">(</span><span class="ident" id="3982850">z</span><span class="op" id="3982851">,</span>&nbsp;<span class="ident" id="3982853">x</span>&nbsp;<span class="ident" id="3982855">nat</span><span class="op" id="3982858">,</span>&nbsp;<span class="ident" id="3982860">i</span>&nbsp;<span class="builtintype" id="3982862">int</span><span class="op" id="3982865">)</span>&nbsp;<span class="op" id="3982867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982870">if</span>&nbsp;<span class="ident" id="3982873">n</span>&nbsp;<span class="op" id="3982875">:=</span>&nbsp;<span class="builtinfunc" id="3982878">len</span><span class="op" id="3982881">(</span><span class="ident" id="3982882">x</span><span class="op" id="3982883">)</span><span class="op" id="3982884">;</span>&nbsp;<span class="ident" id="3982886">n</span>&nbsp;<span class="op" id="3982888">&gt;</span>&nbsp;<span class="num" id="3982890">0</span>&nbsp;<span class="op" id="3982892">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982896">if</span>&nbsp;<span class="ident" id="3982899">c</span>&nbsp;<span class="op" id="3982901">:=</span>&nbsp;<span class="ident" id="3982904">addVV</span><span class="op" id="3982909">(</span><span class="ident" id="3982910">z</span><span class="op" id="3982911">[</span><span class="ident" id="3982912">i</span><span class="op" id="3982913">:</span><span class="ident" id="3982914">i</span><span class="op" id="3982915">+</span><span class="ident" id="3982916">n</span><span class="op" id="3982917">]</span><span class="op" id="3982918">,</span>&nbsp;<span class="ident" id="3982920">z</span><span class="op" id="3982921">[</span><span class="ident" id="3982922">i</span><span class="op" id="3982923">:</span><span class="op" id="3982924">]</span><span class="op" id="3982925">,</span>&nbsp;<span class="ident" id="3982927">x</span><span class="op" id="3982928">)</span><span class="op" id="3982929">;</span>&nbsp;<span class="ident" id="3982931">c</span>&nbsp;<span class="op" id="3982933">!=</span>&nbsp;<span class="num" id="3982936">0</span>&nbsp;<span class="op" id="3982938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982943">j</span>&nbsp;<span class="op" id="3982945">:=</span>&nbsp;<span class="ident" id="3982948">i</span>&nbsp;<span class="op" id="3982950">+</span>&nbsp;<span class="ident" id="3982952">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982957">if</span>&nbsp;<span class="ident" id="3982960">j</span>&nbsp;<span class="op" id="3982962">&lt;</span>&nbsp;<span class="builtinfunc" id="3982964">len</span><span class="op" id="3982967">(</span><span class="ident" id="3982968">z</span><span class="op" id="3982969">)</span>&nbsp;<span class="op" id="3982971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982977">addVW</span><span class="op" id="3982982">(</span><span class="ident" id="3982983">z</span><span class="op" id="3982984">[</span><span class="ident" id="3982985">j</span><span class="op" id="3982986">:</span><span class="op" id="3982987">]</span><span class="op" id="3982988">,</span>&nbsp;<span class="ident" id="3982990">z</span><span class="op" id="3982991">[</span><span class="ident" id="3982992">j</span><span class="op" id="3982993">:</span><span class="op" id="3982994">]</span><span class="op" id="3982995">,</span>&nbsp;<span class="ident" id="3982997">c</span><span class="op" id="3982998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983003">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983010">}</span><br>
<span class="lineno"></span><span class="op" id="3983012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3983015">func</span>&nbsp;<span class="ident" id="3983020">max</span><span class="op" id="3983023">(</span><span class="ident" id="3983024">x</span><span class="op" id="3983025">,</span>&nbsp;<span class="ident" id="3983027">y</span>&nbsp;<span class="builtintype" id="3983029">int</span><span class="op" id="3983032">)</span>&nbsp;<span class="builtintype" id="3983034">int</span>&nbsp;<span class="op" id="3983038">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983041">if</span>&nbsp;<span class="ident" id="3983044">x</span>&nbsp;<span class="op" id="3983046">&gt;</span>&nbsp;<span class="ident" id="3983048">y</span>&nbsp;<span class="op" id="3983050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983054">return</span>&nbsp;<span class="ident" id="3983061">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983067">return</span>&nbsp;<span class="ident" id="3983074">y</span><br>
<span class="lineno"></span><span class="op" id="3983076">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3983079">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3983153">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3983227">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3983302">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3983353">func</span>&nbsp;<span class="ident" id="3983358">karatsubaLen</span><span class="op" id="3983370">(</span><span class="ident" id="3983371">n</span>&nbsp;<span class="builtintype" id="3983373">int</span><span class="op" id="3983376">)</span>&nbsp;<span class="builtintype" id="3983378">int</span>&nbsp;<span class="op" id="3983382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983385">i</span>&nbsp;<span class="op" id="3983387">:=</span>&nbsp;<span class="builtintype" id="3983390">uint</span><span class="op" id="3983394">(</span><span class="num" id="3983395">0</span><span class="op" id="3983396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983399">for</span>&nbsp;<span class="ident" id="3983403">n</span>&nbsp;<span class="op" id="3983405">&gt;</span>&nbsp;<span class="ident" id="3983407">karatsubaThreshold</span>&nbsp;<span class="op" id="3983426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983430">n</span>&nbsp;<span class="op" id="3983432">&gt;&gt;=</span>&nbsp;<span class="num" id="3983436">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983440">i</span><span class="op" id="3983441">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983448">return</span>&nbsp;<span class="ident" id="3983455">n</span>&nbsp;<span class="op" id="3983457">&lt;&lt;</span>&nbsp;<span class="ident" id="3983460">i</span><br>
<span class="lineno"></span><span class="op" id="3983462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3983465">func</span>&nbsp;<span class="op" id="3983470">(</span><span class="ident" id="3983471">z</span>&nbsp;<span class="ident" id="3983473">nat</span><span class="op" id="3983476">)</span>&nbsp;<span class="ident" id="3983478">mul</span><span class="op" id="3983481">(</span><span class="ident" id="3983482">x</span><span class="op" id="3983483">,</span>&nbsp;<span class="ident" id="3983485">y</span>&nbsp;<span class="ident" id="3983487">nat</span><span class="op" id="3983490">)</span>&nbsp;<span class="ident" id="3983492">nat</span>&nbsp;<span class="op" id="3983496">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983499">m</span>&nbsp;<span class="op" id="3983501">:=</span>&nbsp;<span class="builtinfunc" id="3983504">len</span><span class="op" id="3983507">(</span><span class="ident" id="3983508">x</span><span class="op" id="3983509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983512">n</span>&nbsp;<span class="op" id="3983514">:=</span>&nbsp;<span class="builtinfunc" id="3983517">len</span><span class="op" id="3983520">(</span><span class="ident" id="3983521">y</span><span class="op" id="3983522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983526">switch</span>&nbsp;<span class="op" id="3983533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983536">case</span>&nbsp;<span class="ident" id="3983541">m</span>&nbsp;<span class="op" id="3983543">&lt;</span>&nbsp;<span class="ident" id="3983545">n</span><span class="op" id="3983546">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983550">return</span>&nbsp;<span class="ident" id="3983557">z</span><span class="op" id="3983558">.</span><span class="ident" id="3983559">mul</span><span class="op" id="3983562">(</span><span class="ident" id="3983563">y</span><span class="op" id="3983564">,</span>&nbsp;<span class="ident" id="3983566">x</span><span class="op" id="3983567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983570">case</span>&nbsp;<span class="ident" id="3983575">m</span>&nbsp;<span class="op" id="3983577">==</span>&nbsp;<span class="num" id="3983580">0</span>&nbsp;<span class="op" id="3983582">||</span>&nbsp;<span class="ident" id="3983585">n</span>&nbsp;<span class="op" id="3983587">==</span>&nbsp;<span class="num" id="3983590">0</span><span class="op" id="3983591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983595">return</span>&nbsp;<span class="ident" id="3983602">z</span><span class="op" id="3983603">.</span><span class="builtinfunc" id="3983604">make</span><span class="op" id="3983608">(</span><span class="num" id="3983609">0</span><span class="op" id="3983610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983613">case</span>&nbsp;<span class="ident" id="3983618">n</span>&nbsp;<span class="op" id="3983620">==</span>&nbsp;<span class="num" id="3983623">1</span><span class="op" id="3983624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983628">return</span>&nbsp;<span class="ident" id="3983635">z</span><span class="op" id="3983636">.</span><span class="ident" id="3983637">mulAddWW</span><span class="op" id="3983645">(</span><span class="ident" id="3983646">x</span><span class="op" id="3983647">,</span>&nbsp;<span class="ident" id="3983649">y</span><span class="op" id="3983650">[</span><span class="num" id="3983651">0</span><span class="op" id="3983652">]</span><span class="op" id="3983653">,</span>&nbsp;<span class="num" id="3983655">0</span><span class="op" id="3983656">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3983662">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3983678">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983711">if</span>&nbsp;<span class="ident" id="3983714">alias</span><span class="op" id="3983719">(</span><span class="ident" id="3983720">z</span><span class="op" id="3983721">,</span>&nbsp;<span class="ident" id="3983723">x</span><span class="op" id="3983724">)</span>&nbsp;<span class="op" id="3983726">||</span>&nbsp;<span class="ident" id="3983729">alias</span><span class="op" id="3983734">(</span><span class="ident" id="3983735">z</span><span class="op" id="3983736">,</span>&nbsp;<span class="ident" id="3983738">y</span><span class="op" id="3983739">)</span>&nbsp;<span class="op" id="3983741">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983745">z</span>&nbsp;<span class="op" id="3983747">=</span>&nbsp;<span class="ident" id="3983749">nil</span>&nbsp;<span class="comment" id="3983753">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3983801">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983855">if</span>&nbsp;<span class="ident" id="3983858">n</span>&nbsp;<span class="op" id="3983860">&lt;</span>&nbsp;<span class="ident" id="3983862">karatsubaThreshold</span>&nbsp;<span class="op" id="3983881">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983885">z</span>&nbsp;<span class="op" id="3983887">=</span>&nbsp;<span class="ident" id="3983889">z</span><span class="op" id="3983890">.</span><span class="builtinfunc" id="3983891">make</span><span class="op" id="3983895">(</span><span class="ident" id="3983896">m</span>&nbsp;<span class="op" id="3983898">+</span>&nbsp;<span class="ident" id="3983900">n</span><span class="op" id="3983901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983905">basicMul</span><span class="op" id="3983913">(</span><span class="ident" id="3983914">z</span><span class="op" id="3983915">,</span>&nbsp;<span class="ident" id="3983917">x</span><span class="op" id="3983918">,</span>&nbsp;<span class="ident" id="3983920">y</span><span class="op" id="3983921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983925">return</span>&nbsp;<span class="ident" id="3983932">z</span><span class="op" id="3983933">.</span><span class="ident" id="3983934">norm</span><span class="op" id="3983938">(</span><span class="op" id="3983939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3983945">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3983994">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984037">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984041">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984076">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984111">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984158">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984162">k</span>&nbsp;<span class="op" id="3984164">:=</span>&nbsp;<span class="ident" id="3984167">karatsubaLen</span><span class="op" id="3984179">(</span><span class="ident" id="3984180">n</span><span class="op" id="3984181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984184">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984196">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984233">x0</span>&nbsp;<span class="op" id="3984236">:=</span>&nbsp;<span class="ident" id="3984239">x</span><span class="op" id="3984240">[</span><span class="num" id="3984241">0</span><span class="op" id="3984242">:</span><span class="ident" id="3984243">k</span><span class="op" id="3984244">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3984259">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984284">y0</span>&nbsp;<span class="op" id="3984287">:=</span>&nbsp;<span class="ident" id="3984290">y</span><span class="op" id="3984291">[</span><span class="num" id="3984292">0</span><span class="op" id="3984293">:</span><span class="ident" id="3984294">k</span><span class="op" id="3984295">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3984310">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984335">z</span>&nbsp;<span class="op" id="3984337">=</span>&nbsp;<span class="ident" id="3984339">z</span><span class="op" id="3984340">.</span><span class="builtinfunc" id="3984341">make</span><span class="op" id="3984345">(</span><span class="ident" id="3984346">max</span><span class="op" id="3984349">(</span><span class="num" id="3984350">6</span><span class="op" id="3984351">*</span><span class="ident" id="3984352">k</span><span class="op" id="3984353">,</span>&nbsp;<span class="ident" id="3984355">m</span><span class="op" id="3984356">+</span><span class="ident" id="3984357">n</span><span class="op" id="3984358">)</span><span class="op" id="3984359">)</span>&nbsp;<span class="comment" id="3984361">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984424">karatsuba</span><span class="op" id="3984433">(</span><span class="ident" id="3984434">z</span><span class="op" id="3984435">,</span>&nbsp;<span class="ident" id="3984437">x0</span><span class="op" id="3984439">,</span>&nbsp;<span class="ident" id="3984441">y0</span><span class="op" id="3984443">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984446">z</span>&nbsp;<span class="op" id="3984448">=</span>&nbsp;<span class="ident" id="3984450">z</span><span class="op" id="3984451">[</span><span class="num" id="3984452">0</span>&nbsp;<span class="op" id="3984454">:</span>&nbsp;<span class="ident" id="3984456">m</span><span class="op" id="3984457">+</span><span class="ident" id="3984458">n</span><span class="op" id="3984459">]</span>&nbsp;&nbsp;<span class="comment" id="3984462">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984507">z</span><span class="op" id="3984508">[</span><span class="num" id="3984509">2</span><span class="op" id="3984510">*</span><span class="ident" id="3984511">k</span><span class="op" id="3984512">:</span><span class="op" id="3984513">]</span><span class="op" id="3984514">.</span><span class="ident" id="3984515">clear</span><span class="op" id="3984520">(</span><span class="op" id="3984521">)</span>&nbsp;<span class="comment" id="3984523">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984593">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984652">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984656">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984710">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984764">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984768">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984794">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984798">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984851">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984855">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984923">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984991">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985061">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985065">if</span>&nbsp;<span class="ident" id="3985068">k</span>&nbsp;<span class="op" id="3985070">&lt;</span>&nbsp;<span class="ident" id="3985072">n</span>&nbsp;<span class="op" id="3985074">||</span>&nbsp;<span class="ident" id="3985077">m</span>&nbsp;<span class="op" id="3985079">!=</span>&nbsp;<span class="ident" id="3985082">n</span>&nbsp;<span class="op" id="3985084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985088">var</span>&nbsp;<span class="ident" id="3985092">t</span>&nbsp;<span class="ident" id="3985094">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985101">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985118">x0</span>&nbsp;<span class="op" id="3985121">:=</span>&nbsp;<span class="ident" id="3985124">x0</span><span class="op" id="3985126">.</span><span class="ident" id="3985127">norm</span><span class="op" id="3985131">(</span><span class="op" id="3985132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985136">y1</span>&nbsp;<span class="op" id="3985139">:=</span>&nbsp;<span class="ident" id="3985142">y</span><span class="op" id="3985143">[</span><span class="ident" id="3985144">k</span><span class="op" id="3985145">:</span><span class="op" id="3985146">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3985154">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985189">t</span>&nbsp;<span class="op" id="3985191">=</span>&nbsp;<span class="ident" id="3985193">t</span><span class="op" id="3985194">.</span><span class="ident" id="3985195">mul</span><span class="op" id="3985198">(</span><span class="ident" id="3985199">x0</span><span class="op" id="3985201">,</span>&nbsp;<span class="ident" id="3985203">y1</span><span class="op" id="3985205">)</span>&nbsp;<span class="comment" id="3985207">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985259">addAt</span><span class="op" id="3985264">(</span><span class="ident" id="3985265">z</span><span class="op" id="3985266">,</span>&nbsp;<span class="ident" id="3985268">t</span><span class="op" id="3985269">,</span>&nbsp;<span class="ident" id="3985271">k</span><span class="op" id="3985272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985277">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985311">y0</span>&nbsp;<span class="op" id="3985314">:=</span>&nbsp;<span class="ident" id="3985317">y0</span><span class="op" id="3985319">.</span><span class="ident" id="3985320">norm</span><span class="op" id="3985324">(</span><span class="op" id="3985325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985329">for</span>&nbsp;<span class="ident" id="3985333">i</span>&nbsp;<span class="op" id="3985335">:=</span>&nbsp;<span class="ident" id="3985338">k</span><span class="op" id="3985339">;</span>&nbsp;<span class="ident" id="3985341">i</span>&nbsp;<span class="op" id="3985343">&lt;</span>&nbsp;<span class="builtinfunc" id="3985345">len</span><span class="op" id="3985348">(</span><span class="ident" id="3985349">x</span><span class="op" id="3985350">)</span><span class="op" id="3985351">;</span>&nbsp;<span class="ident" id="3985353">i</span>&nbsp;<span class="op" id="3985355">+=</span>&nbsp;<span class="ident" id="3985358">k</span>&nbsp;<span class="op" id="3985360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985365">xi</span>&nbsp;<span class="op" id="3985368">:=</span>&nbsp;<span class="ident" id="3985371">x</span><span class="op" id="3985372">[</span><span class="ident" id="3985373">i</span><span class="op" id="3985374">:</span><span class="op" id="3985375">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985380">if</span>&nbsp;<span class="builtinfunc" id="3985383">len</span><span class="op" id="3985386">(</span><span class="ident" id="3985387">xi</span><span class="op" id="3985389">)</span>&nbsp;<span class="op" id="3985391">&gt;</span>&nbsp;<span class="ident" id="3985393">k</span>&nbsp;<span class="op" id="3985395">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985401">xi</span>&nbsp;<span class="op" id="3985404">=</span>&nbsp;<span class="ident" id="3985406">xi</span><span class="op" id="3985408">[</span><span class="op" id="3985409">:</span><span class="ident" id="3985410">k</span><span class="op" id="3985411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985421">xi</span>&nbsp;<span class="op" id="3985424">=</span>&nbsp;<span class="ident" id="3985426">xi</span><span class="op" id="3985428">.</span><span class="ident" id="3985429">norm</span><span class="op" id="3985433">(</span><span class="op" id="3985434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985439">t</span>&nbsp;<span class="op" id="3985441">=</span>&nbsp;<span class="ident" id="3985443">t</span><span class="op" id="3985444">.</span><span class="ident" id="3985445">mul</span><span class="op" id="3985448">(</span><span class="ident" id="3985449">xi</span><span class="op" id="3985451">,</span>&nbsp;<span class="ident" id="3985453">y0</span><span class="op" id="3985455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985460">addAt</span><span class="op" id="3985465">(</span><span class="ident" id="3985466">z</span><span class="op" id="3985467">,</span>&nbsp;<span class="ident" id="3985469">t</span><span class="op" id="3985470">,</span>&nbsp;<span class="ident" id="3985472">i</span><span class="op" id="3985473">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985478">t</span>&nbsp;<span class="op" id="3985480">=</span>&nbsp;<span class="ident" id="3985482">t</span><span class="op" id="3985483">.</span><span class="ident" id="3985484">mul</span><span class="op" id="3985487">(</span><span class="ident" id="3985488">xi</span><span class="op" id="3985490">,</span>&nbsp;<span class="ident" id="3985492">y1</span><span class="op" id="3985494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985499">addAt</span><span class="op" id="3985504">(</span><span class="ident" id="3985505">z</span><span class="op" id="3985506">,</span>&nbsp;<span class="ident" id="3985508">t</span><span class="op" id="3985509">,</span>&nbsp;<span class="ident" id="3985511">i</span><span class="op" id="3985512">+</span><span class="ident" id="3985513">k</span><span class="op" id="3985514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985525">return</span>&nbsp;<span class="ident" id="3985532">z</span><span class="op" id="3985533">.</span><span class="ident" id="3985534">norm</span><span class="op" id="3985538">(</span><span class="op" id="3985539">)</span><br>
<span class="lineno"></span><span class="op" id="3985541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3985544">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3985613">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3985683">func</span>&nbsp;<span class="op" id="3985688">(</span><span class="ident" id="3985689">z</span>&nbsp;<span class="ident" id="3985691">nat</span><span class="op" id="3985694">)</span>&nbsp;<span class="ident" id="3985696">mulRange</span><span class="op" id="3985704">(</span><span class="ident" id="3985705">a</span><span class="op" id="3985706">,</span>&nbsp;<span class="ident" id="3985708">b</span>&nbsp;<span class="ident" id="3985710">uint64</span><span class="op" id="3985716">)</span>&nbsp;<span class="ident" id="3985718">nat</span>&nbsp;<span class="op" id="3985722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985725">switch</span>&nbsp;<span class="op" id="3985732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985735">case</span>&nbsp;<span class="ident" id="3985740">a</span>&nbsp;<span class="op" id="3985742">==</span>&nbsp;<span class="num" id="3985745">0</span><span class="op" id="3985746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985750">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985792">return</span>&nbsp;<span class="ident" id="3985799">z</span><span class="op" id="3985800">.</span><span class="ident" id="3985801">setUint64</span><span class="op" id="3985810">(</span><span class="num" id="3985811">0</span><span class="op" id="3985812">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985815">case</span>&nbsp;<span class="ident" id="3985820">a</span>&nbsp;<span class="op" id="3985822">&gt;</span>&nbsp;<span class="ident" id="3985824">b</span><span class="op" id="3985825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985829">return</span>&nbsp;<span class="ident" id="3985836">z</span><span class="op" id="3985837">.</span><span class="ident" id="3985838">setUint64</span><span class="op" id="3985847">(</span><span class="num" id="3985848">1</span><span class="op" id="3985849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985852">case</span>&nbsp;<span class="ident" id="3985857">a</span>&nbsp;<span class="op" id="3985859">==</span>&nbsp;<span class="ident" id="3985862">b</span><span class="op" id="3985863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985867">return</span>&nbsp;<span class="ident" id="3985874">z</span><span class="op" id="3985875">.</span><span class="ident" id="3985876">setUint64</span><span class="op" id="3985885">(</span><span class="ident" id="3985886">a</span><span class="op" id="3985887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985890">case</span>&nbsp;<span class="ident" id="3985895">a</span><span class="op" id="3985896">+</span><span class="num" id="3985897">1</span>&nbsp;<span class="op" id="3985899">==</span>&nbsp;<span class="ident" id="3985902">b</span><span class="op" id="3985903">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985907">return</span>&nbsp;<span class="ident" id="3985914">z</span><span class="op" id="3985915">.</span><span class="ident" id="3985916">mul</span><span class="op" id="3985919">(</span><span class="ident" id="3985920">nat</span><span class="op" id="3985923">(</span><span class="ident" id="3985924">nil</span><span class="op" id="3985927">)</span><span class="op" id="3985928">.</span><span class="ident" id="3985929">setUint64</span><span class="op" id="3985938">(</span><span class="ident" id="3985939">a</span><span class="op" id="3985940">)</span><span class="op" id="3985941">,</span>&nbsp;<span class="ident" id="3985943">nat</span><span class="op" id="3985946">(</span><span class="ident" id="3985947">nil</span><span class="op" id="3985950">)</span><span class="op" id="3985951">.</span><span class="ident" id="3985952">setUint64</span><span class="op" id="3985961">(</span><span class="ident" id="3985962">b</span><span class="op" id="3985963">)</span><span class="op" id="3985964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985970">m</span>&nbsp;<span class="op" id="3985972">:=</span>&nbsp;<span class="op" id="3985975">(</span><span class="ident" id="3985976">a</span>&nbsp;<span class="op" id="3985978">+</span>&nbsp;<span class="ident" id="3985980">b</span><span class="op" id="3985981">)</span>&nbsp;<span class="op" id="3985983">/</span>&nbsp;<span class="num" id="3985985">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985988">return</span>&nbsp;<span class="ident" id="3985995">z</span><span class="op" id="3985996">.</span><span class="ident" id="3985997">mul</span><span class="op" id="3986000">(</span><span class="ident" id="3986001">nat</span><span class="op" id="3986004">(</span><span class="ident" id="3986005">nil</span><span class="op" id="3986008">)</span><span class="op" id="3986009">.</span><span class="ident" id="3986010">mulRange</span><span class="op" id="3986018">(</span><span class="ident" id="3986019">a</span><span class="op" id="3986020">,</span>&nbsp;<span class="ident" id="3986022">m</span><span class="op" id="3986023">)</span><span class="op" id="3986024">,</span>&nbsp;<span class="ident" id="3986026">nat</span><span class="op" id="3986029">(</span><span class="ident" id="3986030">nil</span><span class="op" id="3986033">)</span><span class="op" id="3986034">.</span><span class="ident" id="3986035">mulRange</span><span class="op" id="3986043">(</span><span class="ident" id="3986044">m</span><span class="op" id="3986045">+</span><span class="num" id="3986046">1</span><span class="op" id="3986047">,</span>&nbsp;<span class="ident" id="3986049">b</span><span class="op" id="3986050">)</span><span class="op" id="3986051">)</span><br>
<span class="lineno"></span><span class="op" id="3986053">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3986056">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3986088">func</span>&nbsp;<span class="op" id="3986093">(</span><span class="ident" id="3986094">z</span>&nbsp;<span class="ident" id="3986096">nat</span><span class="op" id="3986099">)</span>&nbsp;<span class="ident" id="3986101">divW</span><span class="op" id="3986105">(</span><span class="ident" id="3986106">x</span>&nbsp;<span class="ident" id="3986108">nat</span><span class="op" id="3986111">,</span>&nbsp;<span class="ident" id="3986113">y</span>&nbsp;<span class="ident" id="3986115">Word</span><span class="op" id="3986119">)</span>&nbsp;<span class="op" id="3986121">(</span><span class="ident" id="3986122">q</span>&nbsp;<span class="ident" id="3986124">nat</span><span class="op" id="3986127">,</span>&nbsp;<span class="ident" id="3986129">r</span>&nbsp;<span class="ident" id="3986131">Word</span><span class="op" id="3986135">)</span>&nbsp;<span class="op" id="3986137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986140">m</span>&nbsp;<span class="op" id="3986142">:=</span>&nbsp;<span class="builtinfunc" id="3986145">len</span><span class="op" id="3986148">(</span><span class="ident" id="3986149">x</span><span class="op" id="3986150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986153">switch</span>&nbsp;<span class="op" id="3986160">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986163">case</span>&nbsp;<span class="ident" id="3986168">y</span>&nbsp;<span class="op" id="3986170">==</span>&nbsp;<span class="num" id="3986173">0</span><span class="op" id="3986174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3986178">panic</span><span class="op" id="3986183">(</span><span class="string" id="3986184">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3986202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986205">case</span>&nbsp;<span class="ident" id="3986210">y</span>&nbsp;<span class="op" id="3986212">==</span>&nbsp;<span class="num" id="3986215">1</span><span class="op" id="3986216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986220">q</span>&nbsp;<span class="op" id="3986222">=</span>&nbsp;<span class="ident" id="3986224">z</span><span class="op" id="3986225">.</span><span class="ident" id="3986226">set</span><span class="op" id="3986229">(</span><span class="ident" id="3986230">x</span><span class="op" id="3986231">)</span>&nbsp;<span class="comment" id="3986233">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986250">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986258">case</span>&nbsp;<span class="ident" id="3986263">m</span>&nbsp;<span class="op" id="3986265">==</span>&nbsp;<span class="num" id="3986268">0</span><span class="op" id="3986269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986273">q</span>&nbsp;<span class="op" id="3986275">=</span>&nbsp;<span class="ident" id="3986277">z</span><span class="op" id="3986278">.</span><span class="builtinfunc" id="3986279">make</span><span class="op" id="3986283">(</span><span class="num" id="3986284">0</span><span class="op" id="3986285">)</span>&nbsp;<span class="comment" id="3986287">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986304">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3986315">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986325">z</span>&nbsp;<span class="op" id="3986327">=</span>&nbsp;<span class="ident" id="3986329">z</span><span class="op" id="3986330">.</span><span class="builtinfunc" id="3986331">make</span><span class="op" id="3986335">(</span><span class="ident" id="3986336">m</span><span class="op" id="3986337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986340">r</span>&nbsp;<span class="op" id="3986342">=</span>&nbsp;<span class="ident" id="3986344">divWVW</span><span class="op" id="3986350">(</span><span class="ident" id="3986351">z</span><span class="op" id="3986352">,</span>&nbsp;<span class="num" id="3986354">0</span><span class="op" id="3986355">,</span>&nbsp;<span class="ident" id="3986357">x</span><span class="op" id="3986358">,</span>&nbsp;<span class="ident" id="3986360">y</span><span class="op" id="3986361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986364">q</span>&nbsp;<span class="op" id="3986366">=</span>&nbsp;<span class="ident" id="3986368">z</span><span class="op" id="3986369">.</span><span class="ident" id="3986370">norm</span><span class="op" id="3986374">(</span><span class="op" id="3986375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986378">return</span><br>
<span class="lineno"></span><span class="op" id="3986385">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3986388">func</span>&nbsp;<span class="op" id="3986393">(</span><span class="ident" id="3986394">z</span>&nbsp;<span class="ident" id="3986396">nat</span><span class="op" id="3986399">)</span>&nbsp;<span class="ident" id="3986401">div</span><span class="op" id="3986404">(</span><span class="ident" id="3986405">z2</span><span class="op" id="3986407">,</span>&nbsp;<span class="ident" id="3986409">u</span><span class="op" id="3986410">,</span>&nbsp;<span class="ident" id="3986412">v</span>&nbsp;<span class="ident" id="3986414">nat</span><span class="op" id="3986417">)</span>&nbsp;<span class="op" id="3986419">(</span><span class="ident" id="3986420">q</span><span class="op" id="3986421">,</span>&nbsp;<span class="ident" id="3986423">r</span>&nbsp;<span class="ident" id="3986425">nat</span><span class="op" id="3986428">)</span>&nbsp;<span class="op" id="3986430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986433">if</span>&nbsp;<span class="builtinfunc" id="3986436">len</span><span class="op" id="3986439">(</span><span class="ident" id="3986440">v</span><span class="op" id="3986441">)</span>&nbsp;<span class="op" id="3986443">==</span>&nbsp;<span class="num" id="3986446">0</span>&nbsp;<span class="op" id="3986448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3986452">panic</span><span class="op" id="3986457">(</span><span class="string" id="3986458">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3986476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986479">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986483">if</span>&nbsp;<span class="ident" id="3986486">u</span><span class="op" id="3986487">.</span><span class="ident" id="3986488">cmp</span><span class="op" id="3986491">(</span><span class="ident" id="3986492">v</span><span class="op" id="3986493">)</span>&nbsp;<span class="op" id="3986495">&lt;</span>&nbsp;<span class="num" id="3986497">0</span>&nbsp;<span class="op" id="3986499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986503">q</span>&nbsp;<span class="op" id="3986505">=</span>&nbsp;<span class="ident" id="3986507">z</span><span class="op" id="3986508">.</span><span class="builtinfunc" id="3986509">make</span><span class="op" id="3986513">(</span><span class="num" id="3986514">0</span><span class="op" id="3986515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986519">r</span>&nbsp;<span class="op" id="3986521">=</span>&nbsp;<span class="ident" id="3986523">z2</span><span class="op" id="3986525">.</span><span class="ident" id="3986526">set</span><span class="op" id="3986529">(</span><span class="ident" id="3986530">u</span><span class="op" id="3986531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986535">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986547">if</span>&nbsp;<span class="builtinfunc" id="3986550">len</span><span class="op" id="3986553">(</span><span class="ident" id="3986554">v</span><span class="op" id="3986555">)</span>&nbsp;<span class="op" id="3986557">==</span>&nbsp;<span class="num" id="3986560">1</span>&nbsp;<span class="op" id="3986562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986566">var</span>&nbsp;<span class="ident" id="3986570">r2</span>&nbsp;<span class="ident" id="3986573">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986580">q</span><span class="op" id="3986581">,</span>&nbsp;<span class="ident" id="3986583">r2</span>&nbsp;<span class="op" id="3986586">=</span>&nbsp;<span class="ident" id="3986588">z</span><span class="op" id="3986589">.</span><span class="ident" id="3986590">divW</span><span class="op" id="3986594">(</span><span class="ident" id="3986595">u</span><span class="op" id="3986596">,</span>&nbsp;<span class="ident" id="3986598">v</span><span class="op" id="3986599">[</span><span class="num" id="3986600">0</span><span class="op" id="3986601">]</span><span class="op" id="3986602">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986606">r</span>&nbsp;<span class="op" id="3986608">=</span>&nbsp;<span class="ident" id="3986610">z2</span><span class="op" id="3986612">.</span><span class="ident" id="3986613">setWord</span><span class="op" id="3986620">(</span><span class="ident" id="3986621">r2</span><span class="op" id="3986623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986639">q</span><span class="op" id="3986640">,</span>&nbsp;<span class="ident" id="3986642">r</span>&nbsp;<span class="op" id="3986644">=</span>&nbsp;<span class="ident" id="3986646">z</span><span class="op" id="3986647">.</span><span class="ident" id="3986648">divLarge</span><span class="op" id="3986656">(</span><span class="ident" id="3986657">z2</span><span class="op" id="3986659">,</span>&nbsp;<span class="ident" id="3986661">u</span><span class="op" id="3986662">,</span>&nbsp;<span class="ident" id="3986664">v</span><span class="op" id="3986665">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986668">return</span><br>
<span class="lineno"></span><span class="op" id="3986675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3986678">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3986712">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3986776">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3986828">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3986846">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3986864">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3986889">func</span>&nbsp;<span class="op" id="3986894">(</span><span class="ident" id="3986895">z</span>&nbsp;<span class="ident" id="3986897">nat</span><span class="op" id="3986900">)</span>&nbsp;<span class="ident" id="3986902">divLarge</span><span class="op" id="3986910">(</span><span class="ident" id="3986911">u</span><span class="op" id="3986912">,</span>&nbsp;<span class="ident" id="3986914">uIn</span><span class="op" id="3986917">,</span>&nbsp;<span class="ident" id="3986919">v</span>&nbsp;<span class="ident" id="3986921">nat</span><span class="op" id="3986924">)</span>&nbsp;<span class="op" id="3986926">(</span><span class="ident" id="3986927">q</span><span class="op" id="3986928">,</span>&nbsp;<span class="ident" id="3986930">r</span>&nbsp;<span class="ident" id="3986932">nat</span><span class="op" id="3986935">)</span>&nbsp;<span class="op" id="3986937">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986940">n</span>&nbsp;<span class="op" id="3986942">:=</span>&nbsp;<span class="builtinfunc" id="3986945">len</span><span class="op" id="3986948">(</span><span class="ident" id="3986949">v</span><span class="op" id="3986950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986953">m</span>&nbsp;<span class="op" id="3986955">:=</span>&nbsp;<span class="builtinfunc" id="3986958">len</span><span class="op" id="3986961">(</span><span class="ident" id="3986962">uIn</span><span class="op" id="3986965">)</span>&nbsp;<span class="op" id="3986967">-</span>&nbsp;<span class="ident" id="3986969">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3986973">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987006">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987070">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987136">if</span>&nbsp;<span class="ident" id="3987139">alias</span><span class="op" id="3987144">(</span><span class="ident" id="3987145">z</span><span class="op" id="3987146">,</span>&nbsp;<span class="ident" id="3987148">uIn</span><span class="op" id="3987151">)</span>&nbsp;<span class="op" id="3987153">||</span>&nbsp;<span class="ident" id="3987156">alias</span><span class="op" id="3987161">(</span><span class="ident" id="3987162">z</span><span class="op" id="3987163">,</span>&nbsp;<span class="ident" id="3987165">v</span><span class="op" id="3987166">)</span>&nbsp;<span class="op" id="3987168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987172">z</span>&nbsp;<span class="op" id="3987174">=</span>&nbsp;<span class="ident" id="3987176">nil</span>&nbsp;<span class="comment" id="3987180">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3987226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987229">q</span>&nbsp;<span class="op" id="3987231">=</span>&nbsp;<span class="ident" id="3987233">z</span><span class="op" id="3987234">.</span><span class="builtinfunc" id="3987235">make</span><span class="op" id="3987239">(</span><span class="ident" id="3987240">m</span>&nbsp;<span class="op" id="3987242">+</span>&nbsp;<span class="num" id="3987244">1</span><span class="op" id="3987245">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987249">qhatv</span>&nbsp;<span class="op" id="3987255">:=</span>&nbsp;<span class="builtinfunc" id="3987258">make</span><span class="op" id="3987262">(</span><span class="ident" id="3987263">nat</span><span class="op" id="3987266">,</span>&nbsp;<span class="ident" id="3987268">n</span><span class="op" id="3987269">+</span><span class="num" id="3987270">1</span><span class="op" id="3987271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987274">if</span>&nbsp;<span class="ident" id="3987277">alias</span><span class="op" id="3987282">(</span><span class="ident" id="3987283">u</span><span class="op" id="3987284">,</span>&nbsp;<span class="ident" id="3987286">uIn</span><span class="op" id="3987289">)</span>&nbsp;<span class="op" id="3987291">||</span>&nbsp;<span class="ident" id="3987294">alias</span><span class="op" id="3987299">(</span><span class="ident" id="3987300">u</span><span class="op" id="3987301">,</span>&nbsp;<span class="ident" id="3987303">v</span><span class="op" id="3987304">)</span>&nbsp;<span class="op" id="3987306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987310">u</span>&nbsp;<span class="op" id="3987312">=</span>&nbsp;<span class="ident" id="3987314">nil</span>&nbsp;<span class="comment" id="3987318">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3987364">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987367">u</span>&nbsp;<span class="op" id="3987369">=</span>&nbsp;<span class="ident" id="3987371">u</span><span class="op" id="3987372">.</span><span class="builtinfunc" id="3987373">make</span><span class="op" id="3987377">(</span><span class="builtinfunc" id="3987378">len</span><span class="op" id="3987381">(</span><span class="ident" id="3987382">uIn</span><span class="op" id="3987385">)</span>&nbsp;<span class="op" id="3987387">+</span>&nbsp;<span class="num" id="3987389">1</span><span class="op" id="3987390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987393">u</span><span class="op" id="3987394">.</span><span class="ident" id="3987395">clear</span><span class="op" id="3987400">(</span><span class="op" id="3987401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987405">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987413">shift</span>&nbsp;<span class="op" id="3987419">:=</span>&nbsp;<span class="ident" id="3987422">leadingZeros</span><span class="op" id="3987434">(</span><span class="ident" id="3987435">v</span><span class="op" id="3987436">[</span><span class="ident" id="3987437">n</span><span class="op" id="3987438">-</span><span class="num" id="3987439">1</span><span class="op" id="3987440">]</span><span class="op" id="3987441">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987444">if</span>&nbsp;<span class="ident" id="3987447">shift</span>&nbsp;<span class="op" id="3987453">&gt;</span>&nbsp;<span class="num" id="3987455">0</span>&nbsp;<span class="op" id="3987457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987461">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987534">v1</span>&nbsp;<span class="op" id="3987537">:=</span>&nbsp;<span class="builtinfunc" id="3987540">make</span><span class="op" id="3987544">(</span><span class="ident" id="3987545">nat</span><span class="op" id="3987548">,</span>&nbsp;<span class="ident" id="3987550">n</span><span class="op" id="3987551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987555">shlVU</span><span class="op" id="3987560">(</span><span class="ident" id="3987561">v1</span><span class="op" id="3987563">,</span>&nbsp;<span class="ident" id="3987565">v</span><span class="op" id="3987566">,</span>&nbsp;<span class="ident" id="3987568">shift</span><span class="op" id="3987573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987577">v</span>&nbsp;<span class="op" id="3987579">=</span>&nbsp;<span class="ident" id="3987581">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3987585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987588">u</span><span class="op" id="3987589">[</span><span class="builtinfunc" id="3987590">len</span><span class="op" id="3987593">(</span><span class="ident" id="3987594">uIn</span><span class="op" id="3987597">)</span><span class="op" id="3987598">]</span>&nbsp;<span class="op" id="3987600">=</span>&nbsp;<span class="ident" id="3987602">shlVU</span><span class="op" id="3987607">(</span><span class="ident" id="3987608">u</span><span class="op" id="3987609">[</span><span class="num" id="3987610">0</span><span class="op" id="3987611">:</span><span class="builtinfunc" id="3987612">len</span><span class="op" id="3987615">(</span><span class="ident" id="3987616">uIn</span><span class="op" id="3987619">)</span><span class="op" id="3987620">]</span><span class="op" id="3987621">,</span>&nbsp;<span class="ident" id="3987623">uIn</span><span class="op" id="3987626">,</span>&nbsp;<span class="ident" id="3987628">shift</span><span class="op" id="3987633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987637">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987645">for</span>&nbsp;<span class="ident" id="3987649">j</span>&nbsp;<span class="op" id="3987651">:=</span>&nbsp;<span class="ident" id="3987654">m</span><span class="op" id="3987655">;</span>&nbsp;<span class="ident" id="3987657">j</span>&nbsp;<span class="op" id="3987659">&gt;=</span>&nbsp;<span class="num" id="3987662">0</span><span class="op" id="3987663">;</span>&nbsp;<span class="ident" id="3987665">j</span><span class="op" id="3987666">--</span>&nbsp;<span class="op" id="3987669">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987673">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987682">qhat</span>&nbsp;<span class="op" id="3987687">:=</span>&nbsp;<span class="ident" id="3987690">Word</span><span class="op" id="3987694">(</span><span class="ident" id="3987695">_M</span><span class="op" id="3987697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987701">if</span>&nbsp;<span class="ident" id="3987704">u</span><span class="op" id="3987705">[</span><span class="ident" id="3987706">j</span><span class="op" id="3987707">+</span><span class="ident" id="3987708">n</span><span class="op" id="3987709">]</span>&nbsp;<span class="op" id="3987711">!=</span>&nbsp;<span class="ident" id="3987714">v</span><span class="op" id="3987715">[</span><span class="ident" id="3987716">n</span><span class="op" id="3987717">-</span><span class="num" id="3987718">1</span><span class="op" id="3987719">]</span>&nbsp;<span class="op" id="3987721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987726">var</span>&nbsp;<span class="ident" id="3987730">rhat</span>&nbsp;<span class="ident" id="3987735">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987743">qhat</span><span class="op" id="3987747">,</span>&nbsp;<span class="ident" id="3987749">rhat</span>&nbsp;<span class="op" id="3987754">=</span>&nbsp;<span class="ident" id="3987756">divWW</span><span class="op" id="3987761">(</span><span class="ident" id="3987762">u</span><span class="op" id="3987763">[</span><span class="ident" id="3987764">j</span><span class="op" id="3987765">+</span><span class="ident" id="3987766">n</span><span class="op" id="3987767">]</span><span class="op" id="3987768">,</span>&nbsp;<span class="ident" id="3987770">u</span><span class="op" id="3987771">[</span><span class="ident" id="3987772">j</span><span class="op" id="3987773">+</span><span class="ident" id="3987774">n</span><span class="op" id="3987775">-</span><span class="num" id="3987776">1</span><span class="op" id="3987777">]</span><span class="op" id="3987778">,</span>&nbsp;<span class="ident" id="3987780">v</span><span class="op" id="3987781">[</span><span class="ident" id="3987782">n</span><span class="op" id="3987783">-</span><span class="num" id="3987784">1</span><span class="op" id="3987785">]</span><span class="op" id="3987786">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987792">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987819">x1</span><span class="op" id="3987821">,</span>&nbsp;<span class="ident" id="3987823">x2</span>&nbsp;<span class="op" id="3987826">:=</span>&nbsp;<span class="ident" id="3987829">mulWW</span><span class="op" id="3987834">(</span><span class="ident" id="3987835">qhat</span><span class="op" id="3987839">,</span>&nbsp;<span class="ident" id="3987841">v</span><span class="op" id="3987842">[</span><span class="ident" id="3987843">n</span><span class="op" id="3987844">-</span><span class="num" id="3987845">2</span><span class="op" id="3987846">]</span><span class="op" id="3987847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987852">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987896">for</span>&nbsp;<span class="ident" id="3987900">greaterThan</span><span class="op" id="3987911">(</span><span class="ident" id="3987912">x1</span><span class="op" id="3987914">,</span>&nbsp;<span class="ident" id="3987916">x2</span><span class="op" id="3987918">,</span>&nbsp;<span class="ident" id="3987920">rhat</span><span class="op" id="3987924">,</span>&nbsp;<span class="ident" id="3987926">u</span><span class="op" id="3987927">[</span><span class="ident" id="3987928">j</span><span class="op" id="3987929">+</span><span class="ident" id="3987930">n</span><span class="op" id="3987931">-</span><span class="num" id="3987932">2</span><span class="op" id="3987933">]</span><span class="op" id="3987934">)</span>&nbsp;<span class="op" id="3987936">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987942">qhat</span><span class="op" id="3987946">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987953">prevRhat</span>&nbsp;<span class="op" id="3987962">:=</span>&nbsp;<span class="ident" id="3987965">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987974">rhat</span>&nbsp;<span class="op" id="3987979">+=</span>&nbsp;<span class="ident" id="3987982">v</span><span class="op" id="3987983">[</span><span class="ident" id="3987984">n</span><span class="op" id="3987985">-</span><span class="num" id="3987986">1</span><span class="op" id="3987987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3987993">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988041">if</span>&nbsp;<span class="ident" id="3988044">rhat</span>&nbsp;<span class="op" id="3988049">&lt;</span>&nbsp;<span class="ident" id="3988051">prevRhat</span>&nbsp;<span class="op" id="3988060">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988067">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3988077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988083">x1</span><span class="op" id="3988085">,</span>&nbsp;<span class="ident" id="3988087">x2</span>&nbsp;<span class="op" id="3988090">=</span>&nbsp;<span class="ident" id="3988092">mulWW</span><span class="op" id="3988097">(</span><span class="ident" id="3988098">qhat</span><span class="op" id="3988102">,</span>&nbsp;<span class="ident" id="3988104">v</span><span class="op" id="3988105">[</span><span class="ident" id="3988106">n</span><span class="op" id="3988107">-</span><span class="num" id="3988108">2</span><span class="op" id="3988109">]</span><span class="op" id="3988110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3988115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3988119">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3988124">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988133">qhatv</span><span class="op" id="3988138">[</span><span class="ident" id="3988139">n</span><span class="op" id="3988140">]</span>&nbsp;<span class="op" id="3988142">=</span>&nbsp;<span class="ident" id="3988144">mulAddVWW</span><span class="op" id="3988153">(</span><span class="ident" id="3988154">qhatv</span><span class="op" id="3988159">[</span><span class="num" id="3988160">0</span><span class="op" id="3988161">:</span><span class="ident" id="3988162">n</span><span class="op" id="3988163">]</span><span class="op" id="3988164">,</span>&nbsp;<span class="ident" id="3988166">v</span><span class="op" id="3988167">,</span>&nbsp;<span class="ident" id="3988169">qhat</span><span class="op" id="3988173">,</span>&nbsp;<span class="num" id="3988175">0</span><span class="op" id="3988176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988181">c</span>&nbsp;<span class="op" id="3988183">:=</span>&nbsp;<span class="ident" id="3988186">subVV</span><span class="op" id="3988191">(</span><span class="ident" id="3988192">u</span><span class="op" id="3988193">[</span><span class="ident" id="3988194">j</span><span class="op" id="3988195">:</span><span class="ident" id="3988196">j</span><span class="op" id="3988197">+</span><span class="builtinfunc" id="3988198">len</span><span class="op" id="3988201">(</span><span class="ident" id="3988202">qhatv</span><span class="op" id="3988207">)</span><span class="op" id="3988208">]</span><span class="op" id="3988209">,</span>&nbsp;<span class="ident" id="3988211">u</span><span class="op" id="3988212">[</span><span class="ident" id="3988213">j</span><span class="op" id="3988214">:</span><span class="op" id="3988215">]</span><span class="op" id="3988216">,</span>&nbsp;<span class="ident" id="3988218">qhatv</span><span class="op" id="3988223">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988227">if</span>&nbsp;<span class="ident" id="3988230">c</span>&nbsp;<span class="op" id="3988232">!=</span>&nbsp;<span class="num" id="3988235">0</span>&nbsp;<span class="op" id="3988237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988242">c</span>&nbsp;<span class="op" id="3988244">:=</span>&nbsp;<span class="ident" id="3988247">addVV</span><span class="op" id="3988252">(</span><span class="ident" id="3988253">u</span><span class="op" id="3988254">[</span><span class="ident" id="3988255">j</span><span class="op" id="3988256">:</span><span class="ident" id="3988257">j</span><span class="op" id="3988258">+</span><span class="ident" id="3988259">n</span><span class="op" id="3988260">]</span><span class="op" id="3988261">,</span>&nbsp;<span class="ident" id="3988263">u</span><span class="op" id="3988264">[</span><span class="ident" id="3988265">j</span><span class="op" id="3988266">:</span><span class="op" id="3988267">]</span><span class="op" id="3988268">,</span>&nbsp;<span class="ident" id="3988270">v</span><span class="op" id="3988271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988276">u</span><span class="op" id="3988277">[</span><span class="ident" id="3988278">j</span><span class="op" id="3988279">+</span><span class="ident" id="3988280">n</span><span class="op" id="3988281">]</span>&nbsp;<span class="op" id="3988283">+=</span>&nbsp;<span class="ident" id="3988286">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988291">qhat</span><span class="op" id="3988295">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3988300">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988305">q</span><span class="op" id="3988306">[</span><span class="ident" id="3988307">j</span><span class="op" id="3988308">]</span>&nbsp;<span class="op" id="3988310">=</span>&nbsp;<span class="ident" id="3988312">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3988318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988322">q</span>&nbsp;<span class="op" id="3988324">=</span>&nbsp;<span class="ident" id="3988326">q</span><span class="op" id="3988327">.</span><span class="ident" id="3988328">norm</span><span class="op" id="3988332">(</span><span class="op" id="3988333">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988336">shrVU</span><span class="op" id="3988341">(</span><span class="ident" id="3988342">u</span><span class="op" id="3988343">,</span>&nbsp;<span class="ident" id="3988345">u</span><span class="op" id="3988346">,</span>&nbsp;<span class="ident" id="3988348">shift</span><span class="op" id="3988353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988356">r</span>&nbsp;<span class="op" id="3988358">=</span>&nbsp;<span class="ident" id="3988360">u</span><span class="op" id="3988361">.</span><span class="ident" id="3988362">norm</span><span class="op" id="3988366">(</span><span class="op" id="3988367">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988371">return</span>&nbsp;<span class="ident" id="3988378">q</span><span class="op" id="3988379">,</span>&nbsp;<span class="ident" id="3988381">r</span><br>
<span class="lineno"></span><span class="op" id="3988383">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3988386">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3988432">func</span>&nbsp;<span class="op" id="3988437">(</span><span class="ident" id="3988438">x</span>&nbsp;<span class="ident" id="3988440">nat</span><span class="op" id="3988443">)</span>&nbsp;<span class="ident" id="3988445">bitLen</span><span class="op" id="3988451">(</span><span class="op" id="3988452">)</span>&nbsp;<span class="builtintype" id="3988454">int</span>&nbsp;<span class="op" id="3988458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988461">if</span>&nbsp;<span class="ident" id="3988464">i</span>&nbsp;<span class="op" id="3988466">:=</span>&nbsp;<span class="builtinfunc" id="3988469">len</span><span class="op" id="3988472">(</span><span class="ident" id="3988473">x</span><span class="op" id="3988474">)</span>&nbsp;<span class="op" id="3988476">-</span>&nbsp;<span class="num" id="3988478">1</span><span class="op" id="3988479">;</span>&nbsp;<span class="ident" id="3988481">i</span>&nbsp;<span class="op" id="3988483">&gt;=</span>&nbsp;<span class="num" id="3988486">0</span>&nbsp;<span class="op" id="3988488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988492">return</span>&nbsp;<span class="ident" id="3988499">i</span><span class="op" id="3988500">*</span><span class="ident" id="3988501">_W</span>&nbsp;<span class="op" id="3988504">+</span>&nbsp;<span class="ident" id="3988506">bitLen</span><span class="op" id="3988512">(</span><span class="ident" id="3988513">x</span><span class="op" id="3988514">[</span><span class="ident" id="3988515">i</span><span class="op" id="3988516">]</span><span class="op" id="3988517">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3988520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988523">return</span>&nbsp;<span class="num" id="3988530">0</span><br>
<span class="lineno"></span><span class="op" id="3988532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3988535">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3988606">const</span>&nbsp;<span class="ident" id="3988612">MaxBase</span>&nbsp;<span class="op" id="3988620">=</span>&nbsp;<span class="string" id="3988622">&#39;z&#39;</span>&nbsp;<span class="op" id="3988626">-</span>&nbsp;<span class="string" id="3988628">&#39;a&#39;</span>&nbsp;<span class="op" id="3988632">+</span>&nbsp;<span class="num" id="3988634">10</span>&nbsp;<span class="op" id="3988637">+</span>&nbsp;<span class="num" id="3988639">1</span>&nbsp;<span class="comment" id="3988641">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3988665">func</span>&nbsp;<span class="ident" id="3988670">hexValue</span><span class="op" id="3988678">(</span><span class="ident" id="3988679">ch</span>&nbsp;<span class="builtintype" id="3988682">rune</span><span class="op" id="3988686">)</span>&nbsp;<span class="ident" id="3988688">Word</span>&nbsp;<span class="op" id="3988693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988696">d</span>&nbsp;<span class="op" id="3988698">:=</span>&nbsp;<span class="builtintype" id="3988701">int</span><span class="op" id="3988704">(</span><span class="ident" id="3988705">MaxBase</span>&nbsp;<span class="op" id="3988713">+</span>&nbsp;<span class="num" id="3988715">1</span><span class="op" id="3988716">)</span>&nbsp;<span class="comment" id="3988718">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988735">switch</span>&nbsp;<span class="op" id="3988742">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988745">case</span>&nbsp;<span class="string" id="3988750">&#39;0&#39;</span>&nbsp;<span class="op" id="3988754">&lt;=</span>&nbsp;<span class="ident" id="3988757">ch</span>&nbsp;<span class="op" id="3988760">&amp;&amp;</span>&nbsp;<span class="ident" id="3988763">ch</span>&nbsp;<span class="op" id="3988766">&lt;=</span>&nbsp;<span class="string" id="3988769">&#39;9&#39;</span><span class="op" id="3988772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988776">d</span>&nbsp;<span class="op" id="3988778">=</span>&nbsp;<span class="builtintype" id="3988780">int</span><span class="op" id="3988783">(</span><span class="ident" id="3988784">ch</span>&nbsp;<span class="op" id="3988787">-</span>&nbsp;<span class="string" id="3988789">&#39;0&#39;</span><span class="op" id="3988792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988795">case</span>&nbsp;<span class="string" id="3988800">&#39;a&#39;</span>&nbsp;<span class="op" id="3988804">&lt;=</span>&nbsp;<span class="ident" id="3988807">ch</span>&nbsp;<span class="op" id="3988810">&amp;&amp;</span>&nbsp;<span class="ident" id="3988813">ch</span>&nbsp;<span class="op" id="3988816">&lt;=</span>&nbsp;<span class="string" id="3988819">&#39;z&#39;</span><span class="op" id="3988822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988826">d</span>&nbsp;<span class="op" id="3988828">=</span>&nbsp;<span class="builtintype" id="3988830">int</span><span class="op" id="3988833">(</span><span class="ident" id="3988834">ch</span>&nbsp;<span class="op" id="3988837">-</span>&nbsp;<span class="string" id="3988839">&#39;a&#39;</span>&nbsp;<span class="op" id="3988843">+</span>&nbsp;<span class="num" id="3988845">10</span><span class="op" id="3988847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988850">case</span>&nbsp;<span class="string" id="3988855">&#39;A&#39;</span>&nbsp;<span class="op" id="3988859">&lt;=</span>&nbsp;<span class="ident" id="3988862">ch</span>&nbsp;<span class="op" id="3988865">&amp;&amp;</span>&nbsp;<span class="ident" id="3988868">ch</span>&nbsp;<span class="op" id="3988871">&lt;=</span>&nbsp;<span class="string" id="3988874">&#39;Z&#39;</span><span class="op" id="3988877">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988881">d</span>&nbsp;<span class="op" id="3988883">=</span>&nbsp;<span class="builtintype" id="3988885">int</span><span class="op" id="3988888">(</span><span class="ident" id="3988889">ch</span>&nbsp;<span class="op" id="3988892">-</span>&nbsp;<span class="string" id="3988894">&#39;A&#39;</span>&nbsp;<span class="op" id="3988898">+</span>&nbsp;<span class="num" id="3988900">10</span><span class="op" id="3988902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3988905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988908">return</span>&nbsp;<span class="ident" id="3988915">Word</span><span class="op" id="3988919">(</span><span class="ident" id="3988920">d</span><span class="op" id="3988921">)</span><br>
<span class="lineno"></span><span class="op" id="3988923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3988926">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3989008">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3989084">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3989163">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3989240">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3989276">//</span><br>
<span class="lineno"></span><span class="comment" id="3989279">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3989357">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3989435">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3989511">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3989589">//</span><br>
<span class="lineno"></span><span class="keyword" id="3989592">func</span>&nbsp;<span class="op" id="3989597">(</span><span class="ident" id="3989598">z</span>&nbsp;<span class="ident" id="3989600">nat</span><span class="op" id="3989603">)</span>&nbsp;<span class="ident" id="3989605">scan</span><span class="op" id="3989609">(</span><span class="ident" id="3989610">r</span>&nbsp;<span class="ident" id="3989612">io</span><span class="op" id="3989614">.</span><span class="ident" id="3989615">RuneScanner</span><span class="op" id="3989626">,</span>&nbsp;<span class="ident" id="3989628">base</span>&nbsp;<span class="builtintype" id="3989633">int</span><span class="op" id="3989636">)</span>&nbsp;<span class="op" id="3989638">(</span><span class="ident" id="3989639">nat</span><span class="op" id="3989642">,</span>&nbsp;<span class="builtintype" id="3989644">int</span><span class="op" id="3989647">,</span>&nbsp;<span class="builtintype" id="3989649">error</span><span class="op" id="3989654">)</span>&nbsp;<span class="op" id="3989656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3989659">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989684">if</span>&nbsp;<span class="ident" id="3989687">base</span>&nbsp;<span class="op" id="3989692">&lt;</span>&nbsp;<span class="num" id="3989694">0</span>&nbsp;<span class="op" id="3989696">||</span>&nbsp;<span class="ident" id="3989699">base</span>&nbsp;<span class="op" id="3989704">==</span>&nbsp;<span class="num" id="3989707">1</span>&nbsp;<span class="op" id="3989709">||</span>&nbsp;<span class="ident" id="3989712">MaxBase</span>&nbsp;<span class="op" id="3989720">&lt;</span>&nbsp;<span class="ident" id="3989722">base</span>&nbsp;<span class="op" id="3989727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989731">return</span>&nbsp;<span class="ident" id="3989738">z</span><span class="op" id="3989739">,</span>&nbsp;<span class="num" id="3989741">0</span><span class="op" id="3989742">,</span>&nbsp;<span class="ident" id="3989744">errors</span><span class="op" id="3989750">.</span><span class="ident" id="3989751">New</span><span class="op" id="3989754">(</span><span class="string" id="3989755">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3989776">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3989779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3989783">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989807">ch</span><span class="op" id="3989809">,</span>&nbsp;<span class="ident" id="3989811">_</span><span class="op" id="3989812">,</span>&nbsp;<span class="ident" id="3989814">err</span>&nbsp;<span class="op" id="3989818">:=</span>&nbsp;<span class="ident" id="3989821">r</span><span class="op" id="3989822">.</span><span class="ident" id="3989823">ReadRune</span><span class="op" id="3989831">(</span><span class="op" id="3989832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989835">if</span>&nbsp;<span class="ident" id="3989838">err</span>&nbsp;<span class="op" id="3989842">!=</span>&nbsp;<span class="ident" id="3989845">nil</span>&nbsp;<span class="op" id="3989849">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989853">return</span>&nbsp;<span class="ident" id="3989860">z</span><span class="op" id="3989861">,</span>&nbsp;<span class="num" id="3989863">0</span><span class="op" id="3989864">,</span>&nbsp;<span class="ident" id="3989866">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3989871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3989875">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989907">b</span>&nbsp;<span class="op" id="3989909">:=</span>&nbsp;<span class="ident" id="3989912">Word</span><span class="op" id="3989916">(</span><span class="ident" id="3989917">base</span><span class="op" id="3989921">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989924">if</span>&nbsp;<span class="ident" id="3989927">base</span>&nbsp;<span class="op" id="3989932">==</span>&nbsp;<span class="num" id="3989935">0</span>&nbsp;<span class="op" id="3989937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989941">b</span>&nbsp;<span class="op" id="3989943">=</span>&nbsp;<span class="num" id="3989945">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989950">if</span>&nbsp;<span class="ident" id="3989953">ch</span>&nbsp;<span class="op" id="3989956">==</span>&nbsp;<span class="string" id="3989959">&#39;0&#39;</span>&nbsp;<span class="op" id="3989963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989968">switch</span>&nbsp;<span class="ident" id="3989975">ch</span><span class="op" id="3989977">,</span>&nbsp;<span class="ident" id="3989979">_</span><span class="op" id="3989980">,</span>&nbsp;<span class="ident" id="3989982">err</span>&nbsp;<span class="op" id="3989986">=</span>&nbsp;<span class="ident" id="3989988">r</span><span class="op" id="3989989">.</span><span class="ident" id="3989990">ReadRune</span><span class="op" id="3989998">(</span><span class="op" id="3989999">)</span><span class="op" id="3990000">;</span>&nbsp;<span class="ident" id="3990002">err</span>&nbsp;<span class="op" id="3990006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990011">case</span>&nbsp;<span class="ident" id="3990016">nil</span><span class="op" id="3990019">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990025">b</span>&nbsp;<span class="op" id="3990027">=</span>&nbsp;<span class="num" id="3990029">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990035">switch</span>&nbsp;<span class="ident" id="3990042">ch</span>&nbsp;<span class="op" id="3990045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990051">case</span>&nbsp;<span class="string" id="3990056">&#39;x&#39;</span><span class="op" id="3990059">,</span>&nbsp;<span class="string" id="3990061">&#39;X&#39;</span><span class="op" id="3990064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990071">b</span>&nbsp;<span class="op" id="3990073">=</span>&nbsp;<span class="num" id="3990075">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990082">case</span>&nbsp;<span class="string" id="3990087">&#39;b&#39;</span><span class="op" id="3990090">,</span>&nbsp;<span class="string" id="3990092">&#39;B&#39;</span><span class="op" id="3990095">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990102">b</span>&nbsp;<span class="op" id="3990104">=</span>&nbsp;<span class="num" id="3990106">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990118">if</span>&nbsp;<span class="ident" id="3990121">b</span>&nbsp;<span class="op" id="3990123">==</span>&nbsp;<span class="num" id="3990126">2</span>&nbsp;<span class="op" id="3990128">||</span>&nbsp;<span class="ident" id="3990131">b</span>&nbsp;<span class="op" id="3990133">==</span>&nbsp;<span class="num" id="3990136">16</span>&nbsp;<span class="op" id="3990139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990146">if</span>&nbsp;<span class="ident" id="3990149">ch</span><span class="op" id="3990151">,</span>&nbsp;<span class="ident" id="3990153">_</span><span class="op" id="3990154">,</span>&nbsp;<span class="ident" id="3990156">err</span>&nbsp;<span class="op" id="3990160">=</span>&nbsp;<span class="ident" id="3990162">r</span><span class="op" id="3990163">.</span><span class="ident" id="3990164">ReadRune</span><span class="op" id="3990172">(</span><span class="op" id="3990173">)</span><span class="op" id="3990174">;</span>&nbsp;<span class="ident" id="3990176">err</span>&nbsp;<span class="op" id="3990180">!=</span>&nbsp;<span class="ident" id="3990183">nil</span>&nbsp;<span class="op" id="3990187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990195">return</span>&nbsp;<span class="ident" id="3990202">z</span><span class="op" id="3990203">,</span>&nbsp;<span class="num" id="3990205">0</span><span class="op" id="3990206">,</span>&nbsp;<span class="ident" id="3990208">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990228">case</span>&nbsp;<span class="ident" id="3990233">io</span><span class="op" id="3990235">.</span><span class="ident" id="3990236">EOF</span><span class="op" id="3990239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990245">return</span>&nbsp;<span class="ident" id="3990252">z</span><span class="op" id="3990253">.</span><span class="builtinfunc" id="3990254">make</span><span class="op" id="3990258">(</span><span class="num" id="3990259">0</span><span class="op" id="3990260">)</span><span class="op" id="3990261">,</span>&nbsp;<span class="num" id="3990263">10</span><span class="op" id="3990265">,</span>&nbsp;<span class="ident" id="3990267">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990274">default</span><span class="op" id="3990281">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990287">return</span>&nbsp;<span class="ident" id="3990294">z</span><span class="op" id="3990295">,</span>&nbsp;<span class="num" id="3990297">10</span><span class="op" id="3990299">,</span>&nbsp;<span class="ident" id="3990301">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3990319">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3990338">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3990433">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990528">z</span>&nbsp;<span class="op" id="3990530">=</span>&nbsp;<span class="ident" id="3990532">z</span><span class="op" id="3990533">.</span><span class="builtinfunc" id="3990534">make</span><span class="op" id="3990538">(</span><span class="num" id="3990539">0</span><span class="op" id="3990540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990543">bb</span>&nbsp;<span class="op" id="3990546">:=</span>&nbsp;<span class="ident" id="3990549">Word</span><span class="op" id="3990553">(</span><span class="num" id="3990554">1</span><span class="op" id="3990555">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990558">dd</span>&nbsp;<span class="op" id="3990561">:=</span>&nbsp;<span class="ident" id="3990564">Word</span><span class="op" id="3990568">(</span><span class="num" id="3990569">0</span><span class="op" id="3990570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990573">for</span>&nbsp;<span class="ident" id="3990577">max</span>&nbsp;<span class="op" id="3990581">:=</span>&nbsp;<span class="ident" id="3990584">_M</span>&nbsp;<span class="op" id="3990587">/</span>&nbsp;<span class="ident" id="3990589">b</span><span class="op" id="3990590">;</span>&nbsp;<span class="op" id="3990592">;</span>&nbsp;<span class="op" id="3990594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990598">d</span>&nbsp;<span class="op" id="3990600">:=</span>&nbsp;<span class="ident" id="3990603">hexValue</span><span class="op" id="3990611">(</span><span class="ident" id="3990612">ch</span><span class="op" id="3990614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990618">if</span>&nbsp;<span class="ident" id="3990621">d</span>&nbsp;<span class="op" id="3990623">&gt;=</span>&nbsp;<span class="ident" id="3990626">b</span>&nbsp;<span class="op" id="3990628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990633">r</span><span class="op" id="3990634">.</span><span class="ident" id="3990635">UnreadRune</span><span class="op" id="3990645">(</span><span class="op" id="3990646">)</span>&nbsp;<span class="comment" id="3990648">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990691">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990704">if</span>&nbsp;<span class="ident" id="3990707">bb</span>&nbsp;<span class="op" id="3990710">&lt;=</span>&nbsp;<span class="ident" id="3990713">max</span>&nbsp;<span class="op" id="3990717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990722">bb</span>&nbsp;<span class="op" id="3990725">*=</span>&nbsp;<span class="ident" id="3990728">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990733">dd</span>&nbsp;<span class="op" id="3990736">=</span>&nbsp;<span class="ident" id="3990738">dd</span><span class="op" id="3990740">*</span><span class="ident" id="3990741">b</span>&nbsp;<span class="op" id="3990743">+</span>&nbsp;<span class="ident" id="3990745">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990749">}</span>&nbsp;<span class="keyword" id="3990751">else</span>&nbsp;<span class="op" id="3990756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3990761">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990789">z</span>&nbsp;<span class="op" id="3990791">=</span>&nbsp;<span class="ident" id="3990793">z</span><span class="op" id="3990794">.</span><span class="ident" id="3990795">mulAddWW</span><span class="op" id="3990803">(</span><span class="ident" id="3990804">z</span><span class="op" id="3990805">,</span>&nbsp;<span class="ident" id="3990807">bb</span><span class="op" id="3990809">,</span>&nbsp;<span class="ident" id="3990811">dd</span><span class="op" id="3990813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990818">bb</span>&nbsp;<span class="op" id="3990821">=</span>&nbsp;<span class="ident" id="3990823">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990828">dd</span>&nbsp;<span class="op" id="3990831">=</span>&nbsp;<span class="ident" id="3990833">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990842">if</span>&nbsp;<span class="ident" id="3990845">ch</span><span class="op" id="3990847">,</span>&nbsp;<span class="ident" id="3990849">_</span><span class="op" id="3990850">,</span>&nbsp;<span class="ident" id="3990852">err</span>&nbsp;<span class="op" id="3990856">=</span>&nbsp;<span class="ident" id="3990858">r</span><span class="op" id="3990859">.</span><span class="ident" id="3990860">ReadRune</span><span class="op" id="3990868">(</span><span class="op" id="3990869">)</span><span class="op" id="3990870">;</span>&nbsp;<span class="ident" id="3990872">err</span>&nbsp;<span class="op" id="3990876">!=</span>&nbsp;<span class="ident" id="3990879">nil</span>&nbsp;<span class="op" id="3990883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990888">if</span>&nbsp;<span class="ident" id="3990891">err</span>&nbsp;<span class="op" id="3990895">!=</span>&nbsp;<span class="ident" id="3990898">io</span><span class="op" id="3990900">.</span><span class="ident" id="3990901">EOF</span>&nbsp;<span class="op" id="3990905">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990911">return</span>&nbsp;<span class="ident" id="3990918">z</span><span class="op" id="3990919">,</span>&nbsp;<span class="builtintype" id="3990921">int</span><span class="op" id="3990924">(</span><span class="ident" id="3990925">b</span><span class="op" id="3990926">)</span><span class="op" id="3990927">,</span>&nbsp;<span class="ident" id="3990929">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990941">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990952">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990956">switch</span>&nbsp;<span class="op" id="3990963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990966">case</span>&nbsp;<span class="ident" id="3990971">bb</span>&nbsp;<span class="op" id="3990974">&gt;</span>&nbsp;<span class="num" id="3990976">1</span><span class="op" id="3990977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3990981">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991024">z</span>&nbsp;<span class="op" id="3991026">=</span>&nbsp;<span class="ident" id="3991028">z</span><span class="op" id="3991029">.</span><span class="ident" id="3991030">mulAddWW</span><span class="op" id="3991038">(</span><span class="ident" id="3991039">z</span><span class="op" id="3991040">,</span>&nbsp;<span class="ident" id="3991042">bb</span><span class="op" id="3991044">,</span>&nbsp;<span class="ident" id="3991046">dd</span><span class="op" id="3991048">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991051">case</span>&nbsp;<span class="ident" id="3991056">base</span>&nbsp;<span class="op" id="3991061">==</span>&nbsp;<span class="num" id="3991064">0</span>&nbsp;<span class="op" id="3991066">&amp;&amp;</span>&nbsp;<span class="ident" id="3991069">b</span>&nbsp;<span class="op" id="3991071">==</span>&nbsp;<span class="num" id="3991074">8</span><span class="op" id="3991075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991079">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991153">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991180">return</span>&nbsp;<span class="ident" id="3991187">z</span><span class="op" id="3991188">,</span>&nbsp;<span class="num" id="3991190">10</span><span class="op" id="3991192">,</span>&nbsp;<span class="ident" id="3991194">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991199">case</span>&nbsp;<span class="ident" id="3991204">base</span>&nbsp;<span class="op" id="3991209">!=</span>&nbsp;<span class="num" id="3991212">0</span>&nbsp;<span class="op" id="3991214">||</span>&nbsp;<span class="ident" id="3991217">b</span>&nbsp;<span class="op" id="3991219">!=</span>&nbsp;<span class="num" id="3991222">8</span><span class="op" id="3991223">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991227">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991290">return</span>&nbsp;<span class="ident" id="3991297">z</span><span class="op" id="3991298">,</span>&nbsp;<span class="builtintype" id="3991300">int</span><span class="op" id="3991303">(</span><span class="ident" id="3991304">b</span><span class="op" id="3991305">)</span><span class="op" id="3991306">,</span>&nbsp;<span class="ident" id="3991308">errors</span><span class="op" id="3991314">.</span><span class="ident" id="3991315">New</span><span class="op" id="3991318">(</span><span class="string" id="3991319">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3991349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991356">return</span>&nbsp;<span class="ident" id="3991363">z</span><span class="op" id="3991364">.</span><span class="ident" id="3991365">norm</span><span class="op" id="3991369">(</span><span class="op" id="3991370">)</span><span class="op" id="3991371">,</span>&nbsp;<span class="builtintype" id="3991373">int</span><span class="op" id="3991376">(</span><span class="ident" id="3991377">b</span><span class="op" id="3991378">)</span><span class="op" id="3991379">,</span>&nbsp;<span class="ident" id="3991381">nil</span><br>
<span class="lineno">720</span><span class="op" id="3991385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3991388">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3991429">const</span>&nbsp;<span class="op" id="3991435">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991438">lowercaseDigits</span>&nbsp;<span class="op" id="3991454">=</span>&nbsp;<span class="string" id="3991456">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991496">uppercaseDigits</span>&nbsp;<span class="op" id="3991512">=</span>&nbsp;<span class="string" id="3991514">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3991553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3991556">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3991612">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3991664">func</span>&nbsp;<span class="op" id="3991669">(</span><span class="ident" id="3991670">x</span>&nbsp;<span class="ident" id="3991672">nat</span><span class="op" id="3991675">)</span>&nbsp;<span class="ident" id="3991677">decimalString</span><span class="op" id="3991690">(</span><span class="op" id="3991691">)</span>&nbsp;<span class="builtintype" id="3991693">string</span>&nbsp;<span class="op" id="3991700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991703">return</span>&nbsp;<span class="ident" id="3991710">x</span><span class="op" id="3991711">.</span><span class="builtintype" id="3991712">string</span><span class="op" id="3991718">(</span><span class="ident" id="3991719">lowercaseDigits</span><span class="op" id="3991734">[</span><span class="num" id="3991735">0</span><span class="op" id="3991736">:</span><span class="num" id="3991737">10</span><span class="op" id="3991739">]</span><span class="op" id="3991740">)</span><br>
<span class="lineno"></span><span class="op" id="3991742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3991745">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3991820">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3991895">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3991946">func</span>&nbsp;<span class="op" id="3991951">(</span><span class="ident" id="3991952">x</span>&nbsp;<span class="ident" id="3991954">nat</span><span class="op" id="3991957">)</span>&nbsp;<span class="builtintype" id="3991959">string</span><span class="op" id="3991965">(</span><span class="ident" id="3991966">charset</span>&nbsp;<span class="builtintype" id="3991974">string</span><span class="op" id="3991980">)</span>&nbsp;<span class="builtintype" id="3991982">string</span>&nbsp;<span class="op" id="3991989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991992">b</span>&nbsp;<span class="op" id="3991994">:=</span>&nbsp;<span class="ident" id="3991997">Word</span><span class="op" id="3992001">(</span><span class="builtinfunc" id="3992002">len</span><span class="op" id="3992005">(</span><span class="ident" id="3992006">charset</span><span class="op" id="3992013">)</span><span class="op" id="3992014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992018">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992036">switch</span>&nbsp;<span class="op" id="3992043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992046">case</span>&nbsp;<span class="ident" id="3992051">b</span>&nbsp;<span class="op" id="3992053">&lt;</span>&nbsp;<span class="num" id="3992055">2</span>&nbsp;<span class="op" id="3992057">||</span>&nbsp;<span class="ident" id="3992060">MaxBase</span>&nbsp;<span class="op" id="3992068">&gt;</span>&nbsp;<span class="num" id="3992070">256</span><span class="op" id="3992073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3992077">panic</span><span class="op" id="3992082">(</span><span class="string" id="3992083">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3992097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992100">case</span>&nbsp;<span class="builtinfunc" id="3992105">len</span><span class="op" id="3992108">(</span><span class="ident" id="3992109">x</span><span class="op" id="3992110">)</span>&nbsp;<span class="op" id="3992112">==</span>&nbsp;<span class="num" id="3992115">0</span><span class="op" id="3992116">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992120">return</span>&nbsp;<span class="builtintype" id="3992127">string</span><span class="op" id="3992133">(</span><span class="ident" id="3992134">charset</span><span class="op" id="3992141">[</span><span class="num" id="3992142">0</span><span class="op" id="3992143">]</span><span class="op" id="3992144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992151">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992186">i</span>&nbsp;<span class="op" id="3992188">:=</span>&nbsp;<span class="builtintype" id="3992191">int</span><span class="op" id="3992194">(</span><span class="builtintype" id="3992195">float64</span><span class="op" id="3992202">(</span><span class="ident" id="3992203">x</span><span class="op" id="3992204">.</span><span class="ident" id="3992205">bitLen</span><span class="op" id="3992211">(</span><span class="op" id="3992212">)</span><span class="op" id="3992213">)</span><span class="op" id="3992214">/</span><span class="ident" id="3992215">math</span><span class="op" id="3992219">.</span><span class="ident" id="3992220">Log2</span><span class="op" id="3992224">(</span><span class="builtintype" id="3992225">float64</span><span class="op" id="3992232">(</span><span class="ident" id="3992233">b</span><span class="op" id="3992234">)</span><span class="op" id="3992235">)</span><span class="op" id="3992236">)</span>&nbsp;<span class="op" id="3992238">+</span>&nbsp;<span class="num" id="3992240">1</span>&nbsp;<span class="comment" id="3992242">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992265">s</span>&nbsp;<span class="op" id="3992267">:=</span>&nbsp;<span class="builtinfunc" id="3992270">make</span><span class="op" id="3992274">(</span><span class="op" id="3992275">[</span><span class="op" id="3992276">]</span><span class="builtintype" id="3992277">byte</span><span class="op" id="3992281">,</span>&nbsp;<span class="ident" id="3992283">i</span><span class="op" id="3992284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992288">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992351">if</span>&nbsp;<span class="ident" id="3992354">b</span>&nbsp;<span class="op" id="3992356">==</span>&nbsp;<span class="ident" id="3992359">b</span><span class="op" id="3992360">&amp;</span><span class="op" id="3992361">-</span><span class="ident" id="3992362">b</span>&nbsp;<span class="op" id="3992364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992368">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992408">shift</span>&nbsp;<span class="op" id="3992414">:=</span>&nbsp;<span class="ident" id="3992417">trailingZeroBits</span><span class="op" id="3992433">(</span><span class="ident" id="3992434">b</span><span class="op" id="3992435">)</span>&nbsp;<span class="comment" id="3992437">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992467">mask</span>&nbsp;<span class="op" id="3992472">:=</span>&nbsp;<span class="ident" id="3992475">Word</span><span class="op" id="3992479">(</span><span class="num" id="3992480">1</span><span class="op" id="3992481">)</span><span class="op" id="3992482">&lt;&lt;</span><span class="ident" id="3992484">shift</span>&nbsp;<span class="op" id="3992490">-</span>&nbsp;<span class="num" id="3992492">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992496">w</span>&nbsp;<span class="op" id="3992498">:=</span>&nbsp;<span class="ident" id="3992501">x</span><span class="op" id="3992502">[</span><span class="num" id="3992503">0</span><span class="op" id="3992504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992508">nbits</span>&nbsp;<span class="op" id="3992514">:=</span>&nbsp;<span class="builtintype" id="3992517">uint</span><span class="op" id="3992521">(</span><span class="ident" id="3992522">_W</span><span class="op" id="3992524">)</span>&nbsp;<span class="comment" id="3992526">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992564">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992600">for</span>&nbsp;<span class="ident" id="3992604">k</span>&nbsp;<span class="op" id="3992606">:=</span>&nbsp;<span class="num" id="3992609">1</span><span class="op" id="3992610">;</span>&nbsp;<span class="ident" id="3992612">k</span>&nbsp;<span class="op" id="3992614">&lt;</span>&nbsp;<span class="builtinfunc" id="3992616">len</span><span class="op" id="3992619">(</span><span class="ident" id="3992620">x</span><span class="op" id="3992621">)</span><span class="op" id="3992622">;</span>&nbsp;<span class="ident" id="3992624">k</span><span class="op" id="3992625">++</span>&nbsp;<span class="op" id="3992628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992633">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992659">for</span>&nbsp;<span class="ident" id="3992663">nbits</span>&nbsp;<span class="op" id="3992669">&gt;=</span>&nbsp;<span class="ident" id="3992672">shift</span>&nbsp;<span class="op" id="3992678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992684">i</span><span class="op" id="3992685">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992692">s</span><span class="op" id="3992693">[</span><span class="ident" id="3992694">i</span><span class="op" id="3992695">]</span>&nbsp;<span class="op" id="3992697">=</span>&nbsp;<span class="ident" id="3992699">charset</span><span class="op" id="3992706">[</span><span class="ident" id="3992707">w</span><span class="op" id="3992708">&amp;</span><span class="ident" id="3992709">mask</span><span class="op" id="3992713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992719">w</span>&nbsp;<span class="op" id="3992721">&gt;&gt;=</span>&nbsp;<span class="ident" id="3992725">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992735">nbits</span>&nbsp;<span class="op" id="3992741">-=</span>&nbsp;<span class="ident" id="3992744">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992759">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992824">if</span>&nbsp;<span class="ident" id="3992827">nbits</span>&nbsp;<span class="op" id="3992833">==</span>&nbsp;<span class="num" id="3992836">0</span>&nbsp;<span class="op" id="3992838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992844">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992892">w</span>&nbsp;<span class="op" id="3992894">=</span>&nbsp;<span class="ident" id="3992896">x</span><span class="op" id="3992897">[</span><span class="ident" id="3992898">k</span><span class="op" id="3992899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992905">nbits</span>&nbsp;<span class="op" id="3992911">=</span>&nbsp;<span class="ident" id="3992913">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992919">}</span>&nbsp;<span class="keyword" id="3992921">else</span>&nbsp;<span class="op" id="3992926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992932">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992988">w</span>&nbsp;<span class="op" id="3992990">|=</span>&nbsp;<span class="ident" id="3992993">x</span><span class="op" id="3992994">[</span><span class="ident" id="3992995">k</span><span class="op" id="3992996">]</span>&nbsp;<span class="op" id="3992998">&lt;&lt;</span>&nbsp;<span class="ident" id="3993001">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993011">i</span><span class="op" id="3993012">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993019">s</span><span class="op" id="3993020">[</span><span class="ident" id="3993021">i</span><span class="op" id="3993022">]</span>&nbsp;<span class="op" id="3993024">=</span>&nbsp;<span class="ident" id="3993026">charset</span><span class="op" id="3993033">[</span><span class="ident" id="3993034">w</span><span class="op" id="3993035">&amp;</span><span class="ident" id="3993036">mask</span><span class="op" id="3993040">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993047">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993062">w</span>&nbsp;<span class="op" id="3993064">=</span>&nbsp;<span class="ident" id="3993066">x</span><span class="op" id="3993067">[</span><span class="ident" id="3993068">k</span><span class="op" id="3993069">]</span>&nbsp;<span class="op" id="3993071">&gt;&gt;</span>&nbsp;<span class="op" id="3993074">(</span><span class="ident" id="3993075">shift</span>&nbsp;<span class="op" id="3993081">-</span>&nbsp;<span class="ident" id="3993083">nbits</span><span class="op" id="3993088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993094">nbits</span>&nbsp;<span class="op" id="3993100">=</span>&nbsp;<span class="ident" id="3993102">_W</span>&nbsp;<span class="op" id="3993105">-</span>&nbsp;<span class="op" id="3993107">(</span><span class="ident" id="3993108">shift</span>&nbsp;<span class="op" id="3993114">-</span>&nbsp;<span class="ident" id="3993116">nbits</span><span class="op" id="3993121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993126">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993135">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993201">for</span>&nbsp;<span class="ident" id="3993205">nbits</span>&nbsp;<span class="op" id="3993211">&gt;=</span>&nbsp;<span class="num" id="3993214">0</span>&nbsp;<span class="op" id="3993216">&amp;&amp;</span>&nbsp;<span class="ident" id="3993219">w</span>&nbsp;<span class="op" id="3993221">!=</span>&nbsp;<span class="num" id="3993224">0</span>&nbsp;<span class="op" id="3993226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993231">i</span><span class="op" id="3993232">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993238">s</span><span class="op" id="3993239">[</span><span class="ident" id="3993240">i</span><span class="op" id="3993241">]</span>&nbsp;<span class="op" id="3993243">=</span>&nbsp;<span class="ident" id="3993245">charset</span><span class="op" id="3993252">[</span><span class="ident" id="3993253">w</span><span class="op" id="3993254">&amp;</span><span class="ident" id="3993255">mask</span><span class="op" id="3993259">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993264">w</span>&nbsp;<span class="op" id="3993266">&gt;&gt;=</span>&nbsp;<span class="ident" id="3993270">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993279">nbits</span>&nbsp;<span class="op" id="3993285">-=</span>&nbsp;<span class="ident" id="3993288">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993300">}</span>&nbsp;<span class="keyword" id="3993302">else</span>&nbsp;<span class="op" id="3993307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993311">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993374">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993432">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993489">bb</span>&nbsp;<span class="op" id="3993492">:=</span>&nbsp;<span class="ident" id="3993495">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993502">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993530">ndigits</span>&nbsp;<span class="op" id="3993538">:=</span>&nbsp;<span class="num" id="3993541">1</span>&nbsp;<span class="comment" id="3993543">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993572">for</span>&nbsp;<span class="ident" id="3993576">max</span>&nbsp;<span class="op" id="3993580">:=</span>&nbsp;<span class="ident" id="3993583">Word</span><span class="op" id="3993587">(</span><span class="ident" id="3993588">_M</span>&nbsp;<span class="op" id="3993591">/</span>&nbsp;<span class="ident" id="3993593">b</span><span class="op" id="3993594">)</span><span class="op" id="3993595">;</span>&nbsp;<span class="ident" id="3993597">bb</span>&nbsp;<span class="op" id="3993600">&lt;=</span>&nbsp;<span class="ident" id="3993603">max</span><span class="op" id="3993606">;</span>&nbsp;<span class="ident" id="3993608">bb</span>&nbsp;<span class="op" id="3993611">*=</span>&nbsp;<span class="ident" id="3993614">b</span>&nbsp;<span class="op" id="3993616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993621">ndigits</span><span class="op" id="3993628">++</span>&nbsp;<span class="comment" id="3993631">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993690">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993771">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993826">table</span>&nbsp;<span class="op" id="3993832">:=</span>&nbsp;<span class="ident" id="3993835">divisors</span><span class="op" id="3993843">(</span><span class="builtinfunc" id="3993844">len</span><span class="op" id="3993847">(</span><span class="ident" id="3993848">x</span><span class="op" id="3993849">)</span><span class="op" id="3993850">,</span>&nbsp;<span class="ident" id="3993852">b</span><span class="op" id="3993853">,</span>&nbsp;<span class="ident" id="3993855">ndigits</span><span class="op" id="3993862">,</span>&nbsp;<span class="ident" id="3993864">bb</span><span class="op" id="3993866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993871">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993930">q</span>&nbsp;<span class="op" id="3993932">:=</span>&nbsp;<span class="ident" id="3993935">nat</span><span class="op" id="3993938">(</span><span class="ident" id="3993939">nil</span><span class="op" id="3993942">)</span><span class="op" id="3993943">.</span><span class="ident" id="3993944">set</span><span class="op" id="3993947">(</span><span class="ident" id="3993948">x</span><span class="op" id="3993949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3993954">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993991">q</span><span class="op" id="3993992">.</span><span class="ident" id="3993993">convertWords</span><span class="op" id="3994005">(</span><span class="ident" id="3994006">s</span><span class="op" id="3994007">,</span>&nbsp;<span class="ident" id="3994009">charset</span><span class="op" id="3994016">,</span>&nbsp;<span class="ident" id="3994018">b</span><span class="op" id="3994019">,</span>&nbsp;<span class="ident" id="3994021">ndigits</span><span class="op" id="3994028">,</span>&nbsp;<span class="ident" id="3994030">bb</span><span class="op" id="3994032">,</span>&nbsp;<span class="ident" id="3994034">table</span><span class="op" id="3994039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3994044">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3994069">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3994131">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994165">i</span>&nbsp;<span class="op" id="3994167">=</span>&nbsp;<span class="num" id="3994169">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994173">for</span>&nbsp;<span class="ident" id="3994177">zero</span>&nbsp;<span class="op" id="3994182">:=</span>&nbsp;<span class="ident" id="3994185">charset</span><span class="op" id="3994192">[</span><span class="num" id="3994193">0</span><span class="op" id="3994194">]</span><span class="op" id="3994195">;</span>&nbsp;<span class="ident" id="3994197">s</span><span class="op" id="3994198">[</span><span class="ident" id="3994199">i</span><span class="op" id="3994200">]</span>&nbsp;<span class="op" id="3994202">==</span>&nbsp;<span class="ident" id="3994205">zero</span><span class="op" id="3994209">;</span>&nbsp;<span class="op" id="3994211">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994216">i</span><span class="op" id="3994217">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3994222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3994225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994229">return</span>&nbsp;<span class="builtintype" id="3994236">string</span><span class="op" id="3994242">(</span><span class="ident" id="3994243">s</span><span class="op" id="3994244">[</span><span class="ident" id="3994245">i</span><span class="op" id="3994246">:</span><span class="op" id="3994247">]</span><span class="op" id="3994248">)</span><br>
<span class="lineno">825</span><span class="op" id="3994250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3994253">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3994347">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3994441">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3994472">//</span><br>
<span class="lineno"></span><span class="comment" id="3994475">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3994575">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3994672">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3994768">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3994864">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3994962">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3995059">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3995156">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3995254">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3995350">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3995443">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3995465">//</span><br>
<span class="lineno"></span><span class="keyword" id="3995468">func</span>&nbsp;<span class="op" id="3995473">(</span><span class="ident" id="3995474">q</span>&nbsp;<span class="ident" id="3995476">nat</span><span class="op" id="3995479">)</span>&nbsp;<span class="ident" id="3995481">convertWords</span><span class="op" id="3995493">(</span><span class="ident" id="3995494">s</span>&nbsp;<span class="op" id="3995496">[</span><span class="op" id="3995497">]</span><span class="builtintype" id="3995498">byte</span><span class="op" id="3995502">,</span>&nbsp;<span class="ident" id="3995504">charset</span>&nbsp;<span class="builtintype" id="3995512">string</span><span class="op" id="3995518">,</span>&nbsp;<span class="ident" id="3995520">b</span>&nbsp;<span class="ident" id="3995522">Word</span><span class="op" id="3995526">,</span>&nbsp;<span class="ident" id="3995528">ndigits</span>&nbsp;<span class="builtintype" id="3995536">int</span><span class="op" id="3995539">,</span>&nbsp;<span class="ident" id="3995541">bb</span>&nbsp;<span class="ident" id="3995544">Word</span><span class="op" id="3995548">,</span>&nbsp;<span class="ident" id="3995550">table</span>&nbsp;<span class="op" id="3995556">[</span><span class="op" id="3995557">]</span><span class="ident" id="3995558">divisor</span><span class="op" id="3995565">)</span>&nbsp;<span class="op" id="3995567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3995570">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995606">if</span>&nbsp;<span class="ident" id="3995609">table</span>&nbsp;<span class="op" id="3995615">!=</span>&nbsp;<span class="ident" id="3995618">nil</span>&nbsp;<span class="op" id="3995622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3995626">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995653">var</span>&nbsp;<span class="ident" id="3995657">r</span>&nbsp;<span class="ident" id="3995659">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995665">index</span>&nbsp;<span class="op" id="3995671">:=</span>&nbsp;<span class="builtinfunc" id="3995674">len</span><span class="op" id="3995677">(</span><span class="ident" id="3995678">table</span><span class="op" id="3995683">)</span>&nbsp;<span class="op" id="3995685">-</span>&nbsp;<span class="num" id="3995687">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995691">for</span>&nbsp;<span class="builtinfunc" id="3995695">len</span><span class="op" id="3995698">(</span><span class="ident" id="3995699">q</span><span class="op" id="3995700">)</span>&nbsp;<span class="op" id="3995702">&gt;</span>&nbsp;<span class="ident" id="3995704">leafSize</span>&nbsp;<span class="op" id="3995713">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3995718">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995787">maxLength</span>&nbsp;<span class="op" id="3995797">:=</span>&nbsp;<span class="ident" id="3995800">q</span><span class="op" id="3995801">.</span><span class="ident" id="3995802">bitLen</span><span class="op" id="3995808">(</span><span class="op" id="3995809">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995815">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995885">minLength</span>&nbsp;<span class="op" id="3995895">:=</span>&nbsp;<span class="ident" id="3995898">maxLength</span>&nbsp;<span class="op" id="3995908">&gt;&gt;</span>&nbsp;<span class="num" id="3995911">1</span>&nbsp;<span class="comment" id="3995913">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995935">for</span>&nbsp;<span class="ident" id="3995939">index</span>&nbsp;<span class="op" id="3995945">&gt;</span>&nbsp;<span class="num" id="3995947">0</span>&nbsp;<span class="op" id="3995949">&amp;&amp;</span>&nbsp;<span class="ident" id="3995952">table</span><span class="op" id="3995957">[</span><span class="ident" id="3995958">index</span><span class="op" id="3995963">-</span><span class="num" id="3995964">1</span><span class="op" id="3995965">]</span><span class="op" id="3995966">.</span><span class="ident" id="3995967">nbits</span>&nbsp;<span class="op" id="3995973">&gt;</span>&nbsp;<span class="ident" id="3995975">minLength</span>&nbsp;<span class="op" id="3995985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995991">index</span><span class="op" id="3995996">--</span>&nbsp;<span class="comment" id="3995999">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996018">if</span>&nbsp;<span class="ident" id="3996021">table</span><span class="op" id="3996026">[</span><span class="ident" id="3996027">index</span><span class="op" id="3996032">]</span><span class="op" id="3996033">.</span><span class="ident" id="3996034">nbits</span>&nbsp;<span class="op" id="3996040">&gt;=</span>&nbsp;<span class="ident" id="3996043">maxLength</span>&nbsp;<span class="op" id="3996053">&amp;&amp;</span>&nbsp;<span class="ident" id="3996056">table</span><span class="op" id="3996061">[</span><span class="ident" id="3996062">index</span><span class="op" id="3996067">]</span><span class="op" id="3996068">.</span><span class="ident" id="3996069">bbb</span><span class="op" id="3996072">.</span><span class="ident" id="3996073">cmp</span><span class="op" id="3996076">(</span><span class="ident" id="3996077">q</span><span class="op" id="3996078">)</span>&nbsp;<span class="op" id="3996080">&gt;=</span>&nbsp;<span class="num" id="3996083">0</span>&nbsp;<span class="op" id="3996085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996091">index</span><span class="op" id="3996096">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996103">if</span>&nbsp;<span class="ident" id="3996106">index</span>&nbsp;<span class="op" id="3996112">&lt;</span>&nbsp;<span class="num" id="3996114">0</span>&nbsp;<span class="op" id="3996116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3996123">panic</span><span class="op" id="3996128">(</span><span class="string" id="3996129">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3996153">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996170">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996253">q</span><span class="op" id="3996254">,</span>&nbsp;<span class="ident" id="3996256">r</span>&nbsp;<span class="op" id="3996258">=</span>&nbsp;<span class="ident" id="3996260">q</span><span class="op" id="3996261">.</span><span class="ident" id="3996262">div</span><span class="op" id="3996265">(</span><span class="ident" id="3996266">r</span><span class="op" id="3996267">,</span>&nbsp;<span class="ident" id="3996269">q</span><span class="op" id="3996270">,</span>&nbsp;<span class="ident" id="3996272">table</span><span class="op" id="3996277">[</span><span class="ident" id="3996278">index</span><span class="op" id="3996283">]</span><span class="op" id="3996284">.</span><span class="ident" id="3996285">bbb</span><span class="op" id="3996288">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996294">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996357">h</span>&nbsp;<span class="op" id="3996359">:=</span>&nbsp;<span class="builtinfunc" id="3996362">len</span><span class="op" id="3996365">(</span><span class="ident" id="3996366">s</span><span class="op" id="3996367">)</span>&nbsp;<span class="op" id="3996369">-</span>&nbsp;<span class="ident" id="3996371">table</span><span class="op" id="3996376">[</span><span class="ident" id="3996377">index</span><span class="op" id="3996382">]</span><span class="op" id="3996383">.</span><span class="ident" id="3996384">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996395">r</span><span class="op" id="3996396">.</span><span class="ident" id="3996397">convertWords</span><span class="op" id="3996409">(</span><span class="ident" id="3996410">s</span><span class="op" id="3996411">[</span><span class="ident" id="3996412">h</span><span class="op" id="3996413">:</span><span class="op" id="3996414">]</span><span class="op" id="3996415">,</span>&nbsp;<span class="ident" id="3996417">charset</span><span class="op" id="3996424">,</span>&nbsp;<span class="ident" id="3996426">b</span><span class="op" id="3996427">,</span>&nbsp;<span class="ident" id="3996429">ndigits</span><span class="op" id="3996436">,</span>&nbsp;<span class="ident" id="3996438">bb</span><span class="op" id="3996440">,</span>&nbsp;<span class="ident" id="3996442">table</span><span class="op" id="3996447">[</span><span class="num" id="3996448">0</span><span class="op" id="3996449">:</span><span class="ident" id="3996450">index</span><span class="op" id="3996455">]</span><span class="op" id="3996456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996461">s</span>&nbsp;<span class="op" id="3996463">=</span>&nbsp;<span class="ident" id="3996465">s</span><span class="op" id="3996466">[</span><span class="op" id="3996467">:</span><span class="ident" id="3996468">h</span><span class="op" id="3996469">]</span>&nbsp;<span class="comment" id="3996471">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996547">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996633">i</span>&nbsp;<span class="op" id="3996635">:=</span>&nbsp;<span class="builtinfunc" id="3996638">len</span><span class="op" id="3996641">(</span><span class="ident" id="3996642">s</span><span class="op" id="3996643">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996646">var</span>&nbsp;<span class="ident" id="3996650">r</span>&nbsp;<span class="ident" id="3996652">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996658">if</span>&nbsp;<span class="ident" id="3996661">b</span>&nbsp;<span class="op" id="3996663">==</span>&nbsp;<span class="num" id="3996666">10</span>&nbsp;<span class="op" id="3996669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996673">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996760">for</span>&nbsp;<span class="builtinfunc" id="3996764">len</span><span class="op" id="3996767">(</span><span class="ident" id="3996768">q</span><span class="op" id="3996769">)</span>&nbsp;<span class="op" id="3996771">&gt;</span>&nbsp;<span class="num" id="3996773">0</span>&nbsp;<span class="op" id="3996775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996780">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996829">q</span><span class="op" id="3996830">,</span>&nbsp;<span class="ident" id="3996832">r</span>&nbsp;<span class="op" id="3996834">=</span>&nbsp;<span class="ident" id="3996836">q</span><span class="op" id="3996837">.</span><span class="ident" id="3996838">divW</span><span class="op" id="3996842">(</span><span class="ident" id="3996843">q</span><span class="op" id="3996844">,</span>&nbsp;<span class="ident" id="3996846">bb</span><span class="op" id="3996848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996853">for</span>&nbsp;<span class="ident" id="3996857">j</span>&nbsp;<span class="op" id="3996859">:=</span>&nbsp;<span class="num" id="3996862">0</span><span class="op" id="3996863">;</span>&nbsp;<span class="ident" id="3996865">j</span>&nbsp;<span class="op" id="3996867">&lt;</span>&nbsp;<span class="ident" id="3996869">ndigits</span>&nbsp;<span class="op" id="3996877">&amp;&amp;</span>&nbsp;<span class="ident" id="3996880">i</span>&nbsp;<span class="op" id="3996882">&gt;</span>&nbsp;<span class="num" id="3996884">0</span><span class="op" id="3996885">;</span>&nbsp;<span class="ident" id="3996887">j</span><span class="op" id="3996888">++</span>&nbsp;<span class="op" id="3996891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996897">i</span><span class="op" id="3996898">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996905">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996964">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997028">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997090">t</span>&nbsp;<span class="op" id="3997092">:=</span>&nbsp;<span class="ident" id="3997095">r</span>&nbsp;<span class="op" id="3997097">/</span>&nbsp;<span class="num" id="3997099">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997106">s</span><span class="op" id="3997107">[</span><span class="ident" id="3997108">i</span><span class="op" id="3997109">]</span>&nbsp;<span class="op" id="3997111">=</span>&nbsp;<span class="ident" id="3997113">charset</span><span class="op" id="3997120">[</span><span class="ident" id="3997121">r</span><span class="op" id="3997122">-</span><span class="ident" id="3997123">t</span><span class="op" id="3997124">&lt;&lt;</span><span class="num" id="3997126">3</span><span class="op" id="3997127">-</span><span class="ident" id="3997128">t</span><span class="op" id="3997129">-</span><span class="ident" id="3997130">t</span><span class="op" id="3997131">]</span>&nbsp;<span class="comment" id="3997133">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997201">r</span>&nbsp;<span class="op" id="3997203">=</span>&nbsp;<span class="ident" id="3997205">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997210">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997217">}</span>&nbsp;<span class="keyword" id="3997219">else</span>&nbsp;<span class="op" id="3997224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997228">for</span>&nbsp;<span class="builtinfunc" id="3997232">len</span><span class="op" id="3997235">(</span><span class="ident" id="3997236">q</span><span class="op" id="3997237">)</span>&nbsp;<span class="op" id="3997239">&gt;</span>&nbsp;<span class="num" id="3997241">0</span>&nbsp;<span class="op" id="3997243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997248">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997297">q</span><span class="op" id="3997298">,</span>&nbsp;<span class="ident" id="3997300">r</span>&nbsp;<span class="op" id="3997302">=</span>&nbsp;<span class="ident" id="3997304">q</span><span class="op" id="3997305">.</span><span class="ident" id="3997306">divW</span><span class="op" id="3997310">(</span><span class="ident" id="3997311">q</span><span class="op" id="3997312">,</span>&nbsp;<span class="ident" id="3997314">bb</span><span class="op" id="3997316">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997321">for</span>&nbsp;<span class="ident" id="3997325">j</span>&nbsp;<span class="op" id="3997327">:=</span>&nbsp;<span class="num" id="3997330">0</span><span class="op" id="3997331">;</span>&nbsp;<span class="ident" id="3997333">j</span>&nbsp;<span class="op" id="3997335">&lt;</span>&nbsp;<span class="ident" id="3997337">ndigits</span>&nbsp;<span class="op" id="3997345">&amp;&amp;</span>&nbsp;<span class="ident" id="3997348">i</span>&nbsp;<span class="op" id="3997350">&gt;</span>&nbsp;<span class="num" id="3997352">0</span><span class="op" id="3997353">;</span>&nbsp;<span class="ident" id="3997355">j</span><span class="op" id="3997356">++</span>&nbsp;<span class="op" id="3997359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997365">i</span><span class="op" id="3997366">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997373">s</span><span class="op" id="3997374">[</span><span class="ident" id="3997375">i</span><span class="op" id="3997376">]</span>&nbsp;<span class="op" id="3997378">=</span>&nbsp;<span class="ident" id="3997380">charset</span><span class="op" id="3997387">[</span><span class="ident" id="3997388">r</span><span class="op" id="3997389">%</span><span class="ident" id="3997390">b</span><span class="op" id="3997391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997397">r</span>&nbsp;<span class="op" id="3997399">/=</span>&nbsp;<span class="ident" id="3997402">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997407">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997418">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997448">zero</span>&nbsp;<span class="op" id="3997453">:=</span>&nbsp;<span class="ident" id="3997456">charset</span><span class="op" id="3997463">[</span><span class="num" id="3997464">0</span><span class="op" id="3997465">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997468">for</span>&nbsp;<span class="ident" id="3997472">i</span>&nbsp;<span class="op" id="3997474">&gt;</span>&nbsp;<span class="num" id="3997476">0</span>&nbsp;<span class="op" id="3997478">{</span>&nbsp;<span class="comment" id="3997480">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997516">i</span><span class="op" id="3997517">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997522">s</span><span class="op" id="3997523">[</span><span class="ident" id="3997524">i</span><span class="op" id="3997525">]</span>&nbsp;<span class="op" id="3997527">=</span>&nbsp;<span class="ident" id="3997529">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997535">}</span><br>
<span class="lineno"></span><span class="op" id="3997537">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3997540">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3997630">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3997695">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3997775">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3997835">var</span>&nbsp;<span class="ident" id="3997839">leafSize</span>&nbsp;<span class="builtintype" id="3997848">int</span>&nbsp;<span class="op" id="3997852">=</span>&nbsp;<span class="num" id="3997854">8</span>&nbsp;<span class="comment" id="3997856">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3997922">type</span>&nbsp;<span class="ident" id="3997927">divisor</span>&nbsp;<span class="keyword" id="3997935">struct</span>&nbsp;<span class="op" id="3997942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997945">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997953">nat</span>&nbsp;<span class="comment" id="3997957">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997969">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3997977">int</span>&nbsp;<span class="comment" id="3997981">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998049">ndigits</span>&nbsp;<span class="builtintype" id="3998057">int</span>&nbsp;<span class="comment" id="3998061">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3998119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3998122">var</span>&nbsp;<span class="ident" id="3998126">cacheBase10</span>&nbsp;<span class="keyword" id="3998138">struct</span>&nbsp;<span class="op" id="3998145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998148">sync</span><span class="op" id="3998152">.</span><span class="ident" id="3998153">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998160">table</span>&nbsp;<span class="op" id="3998166">[</span><span class="num" id="3998167">64</span><span class="op" id="3998169">]</span><span class="ident" id="3998170">divisor</span>&nbsp;<span class="comment" id="3998178">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3998209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3998212">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3998235">func</span>&nbsp;<span class="op" id="3998240">(</span><span class="ident" id="3998241">z</span>&nbsp;<span class="ident" id="3998243">nat</span><span class="op" id="3998246">)</span>&nbsp;<span class="ident" id="3998248">expWW</span><span class="op" id="3998253">(</span><span class="ident" id="3998254">x</span><span class="op" id="3998255">,</span>&nbsp;<span class="ident" id="3998257">y</span>&nbsp;<span class="ident" id="3998259">Word</span><span class="op" id="3998263">)</span>&nbsp;<span class="ident" id="3998265">nat</span>&nbsp;<span class="op" id="3998269">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998272">return</span>&nbsp;<span class="ident" id="3998279">z</span><span class="op" id="3998280">.</span><span class="ident" id="3998281">expNN</span><span class="op" id="3998286">(</span><span class="ident" id="3998287">nat</span><span class="op" id="3998290">(</span><span class="ident" id="3998291">nil</span><span class="op" id="3998294">)</span><span class="op" id="3998295">.</span><span class="ident" id="3998296">setWord</span><span class="op" id="3998303">(</span><span class="ident" id="3998304">x</span><span class="op" id="3998305">)</span><span class="op" id="3998306">,</span>&nbsp;<span class="ident" id="3998308">nat</span><span class="op" id="3998311">(</span><span class="ident" id="3998312">nil</span><span class="op" id="3998315">)</span><span class="op" id="3998316">.</span><span class="ident" id="3998317">setWord</span><span class="op" id="3998324">(</span><span class="ident" id="3998325">y</span><span class="op" id="3998326">)</span><span class="op" id="3998327">,</span>&nbsp;<span class="ident" id="3998329">nil</span><span class="op" id="3998332">)</span><br>
<span class="lineno"></span><span class="op" id="3998334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3998337">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3998404">func</span>&nbsp;<span class="ident" id="3998409">divisors</span><span class="op" id="3998417">(</span><span class="ident" id="3998418">m</span>&nbsp;<span class="builtintype" id="3998420">int</span><span class="op" id="3998423">,</span>&nbsp;<span class="ident" id="3998425">b</span>&nbsp;<span class="ident" id="3998427">Word</span><span class="op" id="3998431">,</span>&nbsp;<span class="ident" id="3998433">ndigits</span>&nbsp;<span class="builtintype" id="3998441">int</span><span class="op" id="3998444">,</span>&nbsp;<span class="ident" id="3998446">bb</span>&nbsp;<span class="ident" id="3998449">Word</span><span class="op" id="3998453">)</span>&nbsp;<span class="op" id="3998455">[</span><span class="op" id="3998456">]</span><span class="ident" id="3998457">divisor</span>&nbsp;<span class="op" id="3998465">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3998468">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998543">if</span>&nbsp;<span class="ident" id="3998546">leafSize</span>&nbsp;<span class="op" id="3998555">==</span>&nbsp;<span class="num" id="3998558">0</span>&nbsp;<span class="op" id="3998560">||</span>&nbsp;<span class="ident" id="3998563">m</span>&nbsp;<span class="op" id="3998565">&lt;=</span>&nbsp;<span class="ident" id="3998568">leafSize</span>&nbsp;<span class="op" id="3998577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998581">return</span>&nbsp;<span class="ident" id="3998588">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3998597">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998653">k</span>&nbsp;<span class="op" id="3998655">:=</span>&nbsp;<span class="num" id="3998658">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998661">for</span>&nbsp;<span class="ident" id="3998665">words</span>&nbsp;<span class="op" id="3998671">:=</span>&nbsp;<span class="ident" id="3998674">leafSize</span><span class="op" id="3998682">;</span>&nbsp;<span class="ident" id="3998684">words</span>&nbsp;<span class="op" id="3998690">&lt;</span>&nbsp;<span class="ident" id="3998692">m</span><span class="op" id="3998693">&gt;&gt;</span><span class="num" id="3998695">1</span>&nbsp;<span class="op" id="3998697">&amp;&amp;</span>&nbsp;<span class="ident" id="3998700">k</span>&nbsp;<span class="op" id="3998702">&lt;</span>&nbsp;<span class="builtinfunc" id="3998704">len</span><span class="op" id="3998707">(</span><span class="ident" id="3998708">cacheBase10</span><span class="op" id="3998719">.</span><span class="ident" id="3998720">table</span><span class="op" id="3998725">)</span><span class="op" id="3998726">;</span>&nbsp;<span class="ident" id="3998728">words</span>&nbsp;<span class="op" id="3998734">&lt;&lt;=</span>&nbsp;<span class="num" id="3998738">1</span>&nbsp;<span class="op" id="3998740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998744">k</span><span class="op" id="3998745">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998749">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3998753">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998836">var</span>&nbsp;<span class="ident" id="3998840">table</span>&nbsp;<span class="op" id="3998846">[</span><span class="op" id="3998847">]</span><span class="ident" id="3998848">divisor</span>&nbsp;<span class="comment" id="3998856">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998911">if</span>&nbsp;<span class="ident" id="3998914">b</span>&nbsp;<span class="op" id="3998916">==</span>&nbsp;<span class="num" id="3998919">10</span>&nbsp;<span class="op" id="3998922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998926">cacheBase10</span><span class="op" id="3998937">.</span><span class="ident" id="3998938">Lock</span><span class="op" id="3998942">(</span><span class="op" id="3998943">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998947">table</span>&nbsp;<span class="op" id="3998953">=</span>&nbsp;<span class="ident" id="3998955">cacheBase10</span><span class="op" id="3998966">.</span><span class="ident" id="3998967">table</span><span class="op" id="3998972">[</span><span class="num" id="3998973">0</span><span class="op" id="3998974">:</span><span class="ident" id="3998975">k</span><span class="op" id="3998976">]</span>&nbsp;<span class="comment" id="3998978">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999018">}</span>&nbsp;<span class="keyword" id="3999020">else</span>&nbsp;<span class="op" id="3999025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999029">table</span>&nbsp;<span class="op" id="3999035">=</span>&nbsp;<span class="builtinfunc" id="3999037">make</span><span class="op" id="3999041">(</span><span class="op" id="3999042">[</span><span class="op" id="3999043">]</span><span class="ident" id="3999044">divisor</span><span class="op" id="3999051">,</span>&nbsp;<span class="ident" id="3999053">k</span><span class="op" id="3999054">)</span>&nbsp;<span class="comment" id="3999056">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3999101">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999118">if</span>&nbsp;<span class="ident" id="3999121">table</span><span class="op" id="3999126">[</span><span class="ident" id="3999127">k</span><span class="op" id="3999128">-</span><span class="num" id="3999129">1</span><span class="op" id="3999130">]</span><span class="op" id="3999131">.</span><span class="ident" id="3999132">ndigits</span>&nbsp;<span class="op" id="3999140">==</span>&nbsp;<span class="num" id="3999143">0</span>&nbsp;<span class="op" id="3999145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3999149">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999180">var</span>&nbsp;<span class="ident" id="3999184">larger</span>&nbsp;<span class="ident" id="3999191">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999197">for</span>&nbsp;<span class="ident" id="3999201">i</span>&nbsp;<span class="op" id="3999203">:=</span>&nbsp;<span class="num" id="3999206">0</span><span class="op" id="3999207">;</span>&nbsp;<span class="ident" id="3999209">i</span>&nbsp;<span class="op" id="3999211">&lt;</span>&nbsp;<span class="ident" id="3999213">k</span><span class="op" id="3999214">;</span>&nbsp;<span class="ident" id="3999216">i</span><span class="op" id="3999217">++</span>&nbsp;<span class="op" id="3999220">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999225">if</span>&nbsp;<span class="ident" id="3999228">table</span><span class="op" id="3999233">[</span><span class="ident" id="3999234">i</span><span class="op" id="3999235">]</span><span class="op" id="3999236">.</span><span class="ident" id="3999237">ndigits</span>&nbsp;<span class="op" id="3999245">==</span>&nbsp;<span class="num" id="3999248">0</span>&nbsp;<span class="op" id="3999250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999256">if</span>&nbsp;<span class="ident" id="3999259">i</span>&nbsp;<span class="op" id="3999261">==</span>&nbsp;<span class="num" id="3999264">0</span>&nbsp;<span class="op" id="3999266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999273">table</span><span class="op" id="3999278">[</span><span class="num" id="3999279">0</span><span class="op" id="3999280">]</span><span class="op" id="3999281">.</span><span class="ident" id="3999282">bbb</span>&nbsp;<span class="op" id="3999286">=</span>&nbsp;<span class="ident" id="3999288">nat</span><span class="op" id="3999291">(</span><span class="ident" id="3999292">nil</span><span class="op" id="3999295">)</span><span class="op" id="3999296">.</span><span class="ident" id="3999297">expWW</span><span class="op" id="3999302">(</span><span class="ident" id="3999303">bb</span><span class="op" id="3999305">,</span>&nbsp;<span class="ident" id="3999307">Word</span><span class="op" id="3999311">(</span><span class="ident" id="3999312">leafSize</span><span class="op" id="3999320">)</span><span class="op" id="3999321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999328">table</span><span class="op" id="3999333">[</span><span class="num" id="3999334">0</span><span class="op" id="3999335">]</span><span class="op" id="3999336">.</span><span class="ident" id="3999337">ndigits</span>&nbsp;<span class="op" id="3999345">=</span>&nbsp;<span class="ident" id="3999347">ndigits</span>&nbsp;<span class="op" id="3999355">*</span>&nbsp;<span class="ident" id="3999357">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999370">}</span>&nbsp;<span class="keyword" id="3999372">else</span>&nbsp;<span class="op" id="3999377">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999384">table</span><span class="op" id="3999389">[</span><span class="ident" id="3999390">i</span><span class="op" id="3999391">]</span><span class="op" id="3999392">.</span><span class="ident" id="3999393">bbb</span>&nbsp;<span class="op" id="3999397">=</span>&nbsp;<span class="ident" id="3999399">nat</span><span class="op" id="3999402">(</span><span class="ident" id="3999403">nil</span><span class="op" id="3999406">)</span><span class="op" id="3999407">.</span><span class="ident" id="3999408">mul</span><span class="op" id="3999411">(</span><span class="ident" id="3999412">table</span><span class="op" id="3999417">[</span><span class="ident" id="3999418">i</span><span class="op" id="3999419">-</span><span class="num" id="3999420">1</span><span class="op" id="3999421">]</span><span class="op" id="3999422">.</span><span class="ident" id="3999423">bbb</span><span class="op" id="3999426">,</span>&nbsp;<span class="ident" id="3999428">table</span><span class="op" id="3999433">[</span><span class="ident" id="3999434">i</span><span class="op" id="3999435">-</span><span class="num" id="3999436">1</span><span class="op" id="3999437">]</span><span class="op" id="3999438">.</span><span class="ident" id="3999439">bbb</span><span class="op" id="3999442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999449">table</span><span class="op" id="3999454">[</span><span class="ident" id="3999455">i</span><span class="op" id="3999456">]</span><span class="op" id="3999457">.</span><span class="ident" id="3999458">ndigits</span>&nbsp;<span class="op" id="3999466">=</span>&nbsp;<span class="num" id="3999468">2</span>&nbsp;<span class="op" id="3999470">*</span>&nbsp;<span class="ident" id="3999472">table</span><span class="op" id="3999477">[</span><span class="ident" id="3999478">i</span><span class="op" id="3999479">-</span><span class="num" id="3999480">1</span><span class="op" id="3999481">]</span><span class="op" id="3999482">.</span><span class="ident" id="3999483">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3999502">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999569">larger</span>&nbsp;<span class="op" id="3999576">=</span>&nbsp;<span class="ident" id="3999578">nat</span><span class="op" id="3999581">(</span><span class="ident" id="3999582">nil</span><span class="op" id="3999585">)</span><span class="op" id="3999586">.</span><span class="ident" id="3999587">set</span><span class="op" id="3999590">(</span><span class="ident" id="3999591">table</span><span class="op" id="3999596">[</span><span class="ident" id="3999597">i</span><span class="op" id="3999598">]</span><span class="op" id="3999599">.</span><span class="ident" id="3999600">bbb</span><span class="op" id="3999603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999609">for</span>&nbsp;<span class="ident" id="3999613">mulAddVWW</span><span class="op" id="3999622">(</span><span class="ident" id="3999623">larger</span><span class="op" id="3999629">,</span>&nbsp;<span class="ident" id="3999631">larger</span><span class="op" id="3999637">,</span>&nbsp;<span class="ident" id="3999639">b</span><span class="op" id="3999640">,</span>&nbsp;<span class="num" id="3999642">0</span><span class="op" id="3999643">)</span>&nbsp;<span class="op" id="3999645">==</span>&nbsp;<span class="num" id="3999648">0</span>&nbsp;<span class="op" id="3999650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999657">table</span><span class="op" id="3999662">[</span><span class="ident" id="3999663">i</span><span class="op" id="3999664">]</span><span class="op" id="3999665">.</span><span class="ident" id="3999666">bbb</span>&nbsp;<span class="op" id="3999670">=</span>&nbsp;<span class="ident" id="3999672">table</span><span class="op" id="3999677">[</span><span class="ident" id="3999678">i</span><span class="op" id="3999679">]</span><span class="op" id="3999680">.</span><span class="ident" id="3999681">bbb</span><span class="op" id="3999684">.</span><span class="ident" id="3999685">set</span><span class="op" id="3999688">(</span><span class="ident" id="3999689">larger</span><span class="op" id="3999695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999702">table</span><span class="op" id="3999707">[</span><span class="ident" id="3999708">i</span><span class="op" id="3999709">]</span><span class="op" id="3999710">.</span><span class="ident" id="3999711">ndigits</span><span class="op" id="3999718">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999725">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999732">table</span><span class="op" id="3999737">[</span><span class="ident" id="3999738">i</span><span class="op" id="3999739">]</span><span class="op" id="3999740">.</span><span class="ident" id="3999741">nbits</span>&nbsp;<span class="op" id="3999747">=</span>&nbsp;<span class="ident" id="3999749">table</span><span class="op" id="3999754">[</span><span class="ident" id="3999755">i</span><span class="op" id="3999756">]</span><span class="op" id="3999757">.</span><span class="ident" id="3999758">bbb</span><span class="op" id="3999761">.</span><span class="ident" id="3999762">bitLen</span><span class="op" id="3999768">(</span><span class="op" id="3999769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999781">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999785">if</span>&nbsp;<span class="ident" id="3999788">b</span>&nbsp;<span class="op" id="3999790">==</span>&nbsp;<span class="num" id="3999793">10</span>&nbsp;<span class="op" id="3999796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999800">cacheBase10</span><span class="op" id="3999811">.</span><span class="ident" id="3999812">Unlock</span><span class="op" id="3999818">(</span><span class="op" id="3999819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999826">return</span>&nbsp;<span class="ident" id="3999833">table</span><br>
<span class="lineno"></span><span class="op" id="3999839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3999842">const</span>&nbsp;<span class="ident" id="3999848">deBruijn32</span>&nbsp;<span class="op" id="3999859">=</span>&nbsp;<span class="num" id="3999861">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3999873">var</span>&nbsp;<span class="ident" id="3999877">deBruijn32Lookup</span>&nbsp;<span class="op" id="3999894">=</span>&nbsp;<span class="op" id="3999896">[</span><span class="op" id="3999897">]</span><span class="builtintype" id="3999898">byte</span><span class="op" id="3999902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3999905">0</span><span class="op" id="3999906">,</span>&nbsp;<span class="num" id="3999908">1</span><span class="op" id="3999909">,</span>&nbsp;<span class="num" id="3999911">28</span><span class="op" id="3999913">,</span>&nbsp;<span class="num" id="3999915">2</span><span class="op" id="3999916">,</span>&nbsp;<span class="num" id="3999918">29</span><span class="op" id="3999920">,</span>&nbsp;<span class="num" id="3999922">14</span><span class="op" id="3999924">,</span>&nbsp;<span class="num" id="3999926">24</span><span class="op" id="3999928">,</span>&nbsp;<span class="num" id="3999930">3</span><span class="op" id="3999931">,</span>&nbsp;<span class="num" id="3999933">30</span><span class="op" id="3999935">,</span>&nbsp;<span class="num" id="3999937">22</span><span class="op" id="3999939">,</span>&nbsp;<span class="num" id="3999941">20</span><span class="op" id="3999943">,</span>&nbsp;<span class="num" id="3999945">15</span><span class="op" id="3999947">,</span>&nbsp;<span class="num" id="3999949">25</span><span class="op" id="3999951">,</span>&nbsp;<span class="num" id="3999953">17</span><span class="op" id="3999955">,</span>&nbsp;<span class="num" id="3999957">4</span><span class="op" id="3999958">,</span>&nbsp;<span class="num" id="3999960">8</span><span class="op" id="3999961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3999964">31</span><span class="op" id="3999966">,</span>&nbsp;<span class="num" id="3999968">27</span><span class="op" id="3999970">,</span>&nbsp;<span class="num" id="3999972">13</span><span class="op" id="3999974">,</span>&nbsp;<span class="num" id="3999976">23</span><span class="op" id="3999978">,</span>&nbsp;<span class="num" id="3999980">21</span><span class="op" id="3999982">,</span>&nbsp;<span class="num" id="3999984">19</span><span class="op" id="3999986">,</span>&nbsp;<span class="num" id="3999988">16</span><span class="op" id="3999990">,</span>&nbsp;<span class="num" id="3999992">7</span><span class="op" id="3999993">,</span>&nbsp;<span class="num" id="3999995">26</span><span class="op" id="3999997">,</span>&nbsp;<span class="num" id="3999999">12</span><span class="op" id="4000001">,</span>&nbsp;<span class="num" id="4000003">18</span><span class="op" id="4000005">,</span>&nbsp;<span class="num" id="4000007">6</span><span class="op" id="4000008">,</span>&nbsp;<span class="num" id="4000010">11</span><span class="op" id="4000012">,</span>&nbsp;<span class="num" id="4000014">5</span><span class="op" id="4000015">,</span>&nbsp;<span class="num" id="4000017">10</span><span class="op" id="4000019">,</span>&nbsp;<span class="num" id="4000021">9</span><span class="op" id="4000022">,</span><br>
<span class="lineno"></span><span class="op" id="4000024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="4000027">const</span>&nbsp;<span class="ident" id="4000033">deBruijn64</span>&nbsp;<span class="op" id="4000044">=</span>&nbsp;<span class="num" id="4000046">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4000066">var</span>&nbsp;<span class="ident" id="4000070">deBruijn64Lookup</span>&nbsp;<span class="op" id="4000087">=</span>&nbsp;<span class="op" id="4000089">[</span><span class="op" id="4000090">]</span><span class="builtintype" id="4000091">byte</span><span class="op" id="4000095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4000098">0</span><span class="op" id="4000099">,</span>&nbsp;<span class="num" id="4000101">1</span><span class="op" id="4000102">,</span>&nbsp;<span class="num" id="4000104">56</span><span class="op" id="4000106">,</span>&nbsp;<span class="num" id="4000108">2</span><span class="op" id="4000109">,</span>&nbsp;<span class="num" id="4000111">57</span><span class="op" id="4000113">,</span>&nbsp;<span class="num" id="4000115">49</span><span class="op" id="4000117">,</span>&nbsp;<span class="num" id="4000119">28</span><span class="op" id="4000121">,</span>&nbsp;<span class="num" id="4000123">3</span><span class="op" id="4000124">,</span>&nbsp;<span class="num" id="4000126">61</span><span class="op" id="4000128">,</span>&nbsp;<span class="num" id="4000130">58</span><span class="op" id="4000132">,</span>&nbsp;<span class="num" id="4000134">42</span><span class="op" id="4000136">,</span>&nbsp;<span class="num" id="4000138">50</span><span class="op" id="4000140">,</span>&nbsp;<span class="num" id="4000142">38</span><span class="op" id="4000144">,</span>&nbsp;<span class="num" id="4000146">29</span><span class="op" id="4000148">,</span>&nbsp;<span class="num" id="4000150">17</span><span class="op" id="4000152">,</span>&nbsp;<span class="num" id="4000154">4</span><span class="op" id="4000155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4000158">62</span><span class="op" id="4000160">,</span>&nbsp;<span class="num" id="4000162">47</span><span class="op" id="4000164">,</span>&nbsp;<span class="num" id="4000166">59</span><span class="op" id="4000168">,</span>&nbsp;<span class="num" id="4000170">36</span><span class="op" id="4000172">,</span>&nbsp;<span class="num" id="4000174">45</span><span class="op" id="4000176">,</span>&nbsp;<span class="num" id="4000178">43</span><span class="op" id="4000180">,</span>&nbsp;<span class="num" id="4000182">51</span><span class="op" id="4000184">,</span>&nbsp;<span class="num" id="4000186">22</span><span class="op" id="4000188">,</span>&nbsp;<span class="num" id="4000190">53</span><span class="op" id="4000192">,</span>&nbsp;<span class="num" id="4000194">39</span><span class="op" id="4000196">,</span>&nbsp;<span class="num" id="4000198">33</span><span class="op" id="4000200">,</span>&nbsp;<span class="num" id="4000202">30</span><span class="op" id="4000204">,</span>&nbsp;<span class="num" id="4000206">24</span><span class="op" id="4000208">,</span>&nbsp;<span class="num" id="4000210">18</span><span class="op" id="4000212">,</span>&nbsp;<span class="num" id="4000214">12</span><span class="op" id="4000216">,</span>&nbsp;<span class="num" id="4000218">5</span><span class="op" id="4000219">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4000222">63</span><span class="op" id="4000224">,</span>&nbsp;<span class="num" id="4000226">55</span><span class="op" id="4000228">,</span>&nbsp;<span class="num" id="4000230">48</span><span class="op" id="4000232">,</span>&nbsp;<span class="num" id="4000234">27</span><span class="op" id="4000236">,</span>&nbsp;<span class="num" id="4000238">60</span><span class="op" id="4000240">,</span>&nbsp;<span class="num" id="4000242">41</span><span class="op" id="4000244">,</span>&nbsp;<span class="num" id="4000246">37</span><span class="op" id="4000248">,</span>&nbsp;<span class="num" id="4000250">16</span><span class="op" id="4000252">,</span>&nbsp;<span class="num" id="4000254">46</span><span class="op" id="4000256">,</span>&nbsp;<span class="num" id="4000258">35</span><span class="op" id="4000260">,</span>&nbsp;<span class="num" id="4000262">44</span><span class="op" id="4000264">,</span>&nbsp;<span class="num" id="4000266">21</span><span class="op" id="4000268">,</span>&nbsp;<span class="num" id="4000270">52</span><span class="op" id="4000272">,</span>&nbsp;<span class="num" id="4000274">32</span><span class="op" id="4000276">,</span>&nbsp;<span class="num" id="4000278">23</span><span class="op" id="4000280">,</span>&nbsp;<span class="num" id="4000282">11</span><span class="op" id="4000284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4000287">54</span><span class="op" id="4000289">,</span>&nbsp;<span class="num" id="4000291">26</span><span class="op" id="4000293">,</span>&nbsp;<span class="num" id="4000295">40</span><span class="op" id="4000297">,</span>&nbsp;<span class="num" id="4000299">15</span><span class="op" id="4000301">,</span>&nbsp;<span class="num" id="4000303">34</span><span class="op" id="4000305">,</span>&nbsp;<span class="num" id="4000307">20</span><span class="op" id="4000309">,</span>&nbsp;<span class="num" id="4000311">31</span><span class="op" id="4000313">,</span>&nbsp;<span class="num" id="4000315">10</span><span class="op" id="4000317">,</span>&nbsp;<span class="num" id="4000319">25</span><span class="op" id="4000321">,</span>&nbsp;<span class="num" id="4000323">14</span><span class="op" id="4000325">,</span>&nbsp;<span class="num" id="4000327">19</span><span class="op" id="4000329">,</span>&nbsp;<span class="num" id="4000331">9</span><span class="op" id="4000332">,</span>&nbsp;<span class="num" id="4000334">13</span><span class="op" id="4000336">,</span>&nbsp;<span class="num" id="4000338">8</span><span class="op" id="4000339">,</span>&nbsp;<span class="num" id="4000341">7</span><span class="op" id="4000342">,</span>&nbsp;<span class="num" id="4000344">6</span><span class="op" id="4000345">,</span><br>
<span class="lineno"></span><span class="op" id="4000347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4000350">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="4000427">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4000441">func</span>&nbsp;<span class="ident" id="4000446">trailingZeroBits</span><span class="op" id="4000462">(</span><span class="ident" id="4000463">x</span>&nbsp;<span class="ident" id="4000465">Word</span><span class="op" id="4000469">)</span>&nbsp;<span class="builtintype" id="4000471">uint</span>&nbsp;<span class="op" id="4000476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000479">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000551">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000623">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000693">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000763">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000827">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000900">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000969">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001016">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001053">switch</span>&nbsp;<span class="ident" id="4001060">_W</span>&nbsp;<span class="op" id="4001063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001066">case</span>&nbsp;<span class="num" id="4001071">32</span><span class="op" id="4001073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001077">return</span>&nbsp;<span class="builtintype" id="4001084">uint</span><span class="op" id="4001088">(</span><span class="ident" id="4001089">deBruijn32Lookup</span><span class="op" id="4001105">[</span><span class="op" id="4001106">(</span><span class="op" id="4001107">(</span><span class="ident" id="4001108">x</span><span class="op" id="4001109">&amp;</span><span class="op" id="4001110">-</span><span class="ident" id="4001111">x</span><span class="op" id="4001112">)</span><span class="op" id="4001113">*</span><span class="ident" id="4001114">deBruijn32</span><span class="op" id="4001124">)</span><span class="op" id="4001125">&gt;&gt;</span><span class="num" id="4001127">27</span><span class="op" id="4001129">]</span><span class="op" id="4001130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001133">case</span>&nbsp;<span class="num" id="4001138">64</span><span class="op" id="4001140">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001144">return</span>&nbsp;<span class="builtintype" id="4001151">uint</span><span class="op" id="4001155">(</span><span class="ident" id="4001156">deBruijn64Lookup</span><span class="op" id="4001172">[</span><span class="op" id="4001173">(</span><span class="op" id="4001174">(</span><span class="ident" id="4001175">x</span><span class="op" id="4001176">&amp;</span><span class="op" id="4001177">-</span><span class="ident" id="4001178">x</span><span class="op" id="4001179">)</span><span class="op" id="4001180">*</span><span class="op" id="4001181">(</span><span class="ident" id="4001182">deBruijn64</span><span class="op" id="4001192">&amp;</span><span class="ident" id="4001193">_M</span><span class="op" id="4001195">)</span><span class="op" id="4001196">)</span><span class="op" id="4001197">&gt;&gt;</span><span class="num" id="4001199">58</span><span class="op" id="4001201">]</span><span class="op" id="4001202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001205">default</span><span class="op" id="4001212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4001216">panic</span><span class="op" id="4001221">(</span><span class="string" id="4001222">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4001241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001244">}</span><br>
<span class="lineno"></span><span class="op" id="4001246">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="4001249">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4001326">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4001340">func</span>&nbsp;<span class="op" id="4001345">(</span><span class="ident" id="4001346">x</span>&nbsp;<span class="ident" id="4001348">nat</span><span class="op" id="4001351">)</span>&nbsp;<span class="ident" id="4001353">trailingZeroBits</span><span class="op" id="4001369">(</span><span class="op" id="4001370">)</span>&nbsp;<span class="builtintype" id="4001372">uint</span>&nbsp;<span class="op" id="4001377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001380">if</span>&nbsp;<span class="builtinfunc" id="4001383">len</span><span class="op" id="4001386">(</span><span class="ident" id="4001387">x</span><span class="op" id="4001388">)</span>&nbsp;<span class="op" id="4001390">==</span>&nbsp;<span class="num" id="4001393">0</span>&nbsp;<span class="op" id="4001395">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001399">return</span>&nbsp;<span class="num" id="4001406">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001412">var</span>&nbsp;<span class="ident" id="4001416">i</span>&nbsp;<span class="builtintype" id="4001418">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001424">for</span>&nbsp;<span class="ident" id="4001428">x</span><span class="op" id="4001429">[</span><span class="ident" id="4001430">i</span><span class="op" id="4001431">]</span>&nbsp;<span class="op" id="4001433">==</span>&nbsp;<span class="num" id="4001436">0</span>&nbsp;<span class="op" id="4001438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001442">i</span><span class="op" id="4001443">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001450">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001464">return</span>&nbsp;<span class="ident" id="4001471">i</span><span class="op" id="4001472">*</span><span class="ident" id="4001473">_W</span>&nbsp;<span class="op" id="4001476">+</span>&nbsp;<span class="ident" id="4001478">trailingZeroBits</span><span class="op" id="4001494">(</span><span class="ident" id="4001495">x</span><span class="op" id="4001496">[</span><span class="ident" id="4001497">i</span><span class="op" id="4001498">]</span><span class="op" id="4001499">)</span><br>
<span class="lineno"></span><span class="op" id="4001501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="4001504">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4001518">func</span>&nbsp;<span class="op" id="4001523">(</span><span class="ident" id="4001524">z</span>&nbsp;<span class="ident" id="4001526">nat</span><span class="op" id="4001529">)</span>&nbsp;<span class="ident" id="4001531">shl</span><span class="op" id="4001534">(</span><span class="ident" id="4001535">x</span>&nbsp;<span class="ident" id="4001537">nat</span><span class="op" id="4001540">,</span>&nbsp;<span class="ident" id="4001542">s</span>&nbsp;<span class="builtintype" id="4001544">uint</span><span class="op" id="4001548">)</span>&nbsp;<span class="ident" id="4001550">nat</span>&nbsp;<span class="op" id="4001554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001557">m</span>&nbsp;<span class="op" id="4001559">:=</span>&nbsp;<span class="builtinfunc" id="4001562">len</span><span class="op" id="4001565">(</span><span class="ident" id="4001566">x</span><span class="op" id="4001567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001570">if</span>&nbsp;<span class="ident" id="4001573">m</span>&nbsp;<span class="op" id="4001575">==</span>&nbsp;<span class="num" id="4001578">0</span>&nbsp;<span class="op" id="4001580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001584">return</span>&nbsp;<span class="ident" id="4001591">z</span><span class="op" id="4001592">.</span><span class="builtinfunc" id="4001593">make</span><span class="op" id="4001597">(</span><span class="num" id="4001598">0</span><span class="op" id="4001599">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001605">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001616">n</span>&nbsp;<span class="op" id="4001618">:=</span>&nbsp;<span class="ident" id="4001621">m</span>&nbsp;<span class="op" id="4001623">+</span>&nbsp;<span class="builtintype" id="4001625">int</span><span class="op" id="4001628">(</span><span class="ident" id="4001629">s</span><span class="op" id="4001630">/</span><span class="ident" id="4001631">_W</span><span class="op" id="4001633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001636">z</span>&nbsp;<span class="op" id="4001638">=</span>&nbsp;<span class="ident" id="4001640">z</span><span class="op" id="4001641">.</span><span class="builtinfunc" id="4001642">make</span><span class="op" id="4001646">(</span><span class="ident" id="4001647">n</span>&nbsp;<span class="op" id="4001649">+</span>&nbsp;<span class="num" id="4001651">1</span><span class="op" id="4001652">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001655">z</span><span class="op" id="4001656">[</span><span class="ident" id="4001657">n</span><span class="op" id="4001658">]</span>&nbsp;<span class="op" id="4001660">=</span>&nbsp;<span class="ident" id="4001662">shlVU</span><span class="op" id="4001667">(</span><span class="ident" id="4001668">z</span><span class="op" id="4001669">[</span><span class="ident" id="4001670">n</span><span class="op" id="4001671">-</span><span class="ident" id="4001672">m</span><span class="op" id="4001673">:</span><span class="ident" id="4001674">n</span><span class="op" id="4001675">]</span><span class="op" id="4001676">,</span>&nbsp;<span class="ident" id="4001678">x</span><span class="op" id="4001679">,</span>&nbsp;<span class="ident" id="4001681">s</span><span class="op" id="4001682">%</span><span class="ident" id="4001683">_W</span><span class="op" id="4001685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001688">z</span><span class="op" id="4001689">[</span><span class="num" id="4001690">0</span>&nbsp;<span class="op" id="4001692">:</span>&nbsp;<span class="ident" id="4001694">n</span><span class="op" id="4001695">-</span><span class="ident" id="4001696">m</span><span class="op" id="4001697">]</span><span class="op" id="4001698">.</span><span class="ident" id="4001699">clear</span><span class="op" id="4001704">(</span><span class="op" id="4001705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001709">return</span>&nbsp;<span class="ident" id="4001716">z</span><span class="op" id="4001717">.</span><span class="ident" id="4001718">norm</span><span class="op" id="4001722">(</span><span class="op" id="4001723">)</span><br>
<span class="lineno"></span><span class="op" id="4001725">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="4001728">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4001742">func</span>&nbsp;<span class="op" id="4001747">(</span><span class="ident" id="4001748">z</span>&nbsp;<span class="ident" id="4001750">nat</span><span class="op" id="4001753">)</span>&nbsp;<span class="ident" id="4001755">shr</span><span class="op" id="4001758">(</span><span class="ident" id="4001759">x</span>&nbsp;<span class="ident" id="4001761">nat</span><span class="op" id="4001764">,</span>&nbsp;<span class="ident" id="4001766">s</span>&nbsp;<span class="builtintype" id="4001768">uint</span><span class="op" id="4001772">)</span>&nbsp;<span class="ident" id="4001774">nat</span>&nbsp;<span class="op" id="4001778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001781">m</span>&nbsp;<span class="op" id="4001783">:=</span>&nbsp;<span class="builtinfunc" id="4001786">len</span><span class="op" id="4001789">(</span><span class="ident" id="4001790">x</span><span class="op" id="4001791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001794">n</span>&nbsp;<span class="op" id="4001796">:=</span>&nbsp;<span class="ident" id="4001799">m</span>&nbsp;<span class="op" id="4001801">-</span>&nbsp;<span class="builtintype" id="4001803">int</span><span class="op" id="4001806">(</span><span class="ident" id="4001807">s</span><span class="op" id="4001808">/</span><span class="ident" id="4001809">_W</span><span class="op" id="4001811">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001814">if</span>&nbsp;<span class="ident" id="4001817">n</span>&nbsp;<span class="op" id="4001819">&lt;=</span>&nbsp;<span class="num" id="4001822">0</span>&nbsp;<span class="op" id="4001824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001828">return</span>&nbsp;<span class="ident" id="4001835">z</span><span class="op" id="4001836">.</span><span class="builtinfunc" id="4001837">make</span><span class="op" id="4001841">(</span><span class="num" id="4001842">0</span><span class="op" id="4001843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001849">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001860">z</span>&nbsp;<span class="op" id="4001862">=</span>&nbsp;<span class="ident" id="4001864">z</span><span class="op" id="4001865">.</span><span class="builtinfunc" id="4001866">make</span><span class="op" id="4001870">(</span><span class="ident" id="4001871">n</span><span class="op" id="4001872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001875">shrVU</span><span class="op" id="4001880">(</span><span class="ident" id="4001881">z</span><span class="op" id="4001882">,</span>&nbsp;<span class="ident" id="4001884">x</span><span class="op" id="4001885">[</span><span class="ident" id="4001886">m</span><span class="op" id="4001887">-</span><span class="ident" id="4001888">n</span><span class="op" id="4001889">:</span><span class="op" id="4001890">]</span><span class="op" id="4001891">,</span>&nbsp;<span class="ident" id="4001893">s</span><span class="op" id="4001894">%</span><span class="ident" id="4001895">_W</span><span class="op" id="4001897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001901">return</span>&nbsp;<span class="ident" id="4001908">z</span><span class="op" id="4001909">.</span><span class="ident" id="4001910">norm</span><span class="op" id="4001914">(</span><span class="op" id="4001915">)</span><br>
<span class="lineno"></span><span class="op" id="4001917">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="4001920">func</span>&nbsp;<span class="op" id="4001925">(</span><span class="ident" id="4001926">z</span>&nbsp;<span class="ident" id="4001928">nat</span><span class="op" id="4001931">)</span>&nbsp;<span class="ident" id="4001933">setBit</span><span class="op" id="4001939">(</span><span class="ident" id="4001940">x</span>&nbsp;<span class="ident" id="4001942">nat</span><span class="op" id="4001945">,</span>&nbsp;<span class="ident" id="4001947">i</span>&nbsp;<span class="builtintype" id="4001949">uint</span><span class="op" id="4001953">,</span>&nbsp;<span class="ident" id="4001955">b</span>&nbsp;<span class="builtintype" id="4001957">uint</span><span class="op" id="4001961">)</span>&nbsp;<span class="ident" id="4001963">nat</span>&nbsp;<span class="op" id="4001967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001970">j</span>&nbsp;<span class="op" id="4001972">:=</span>&nbsp;<span class="builtintype" id="4001975">int</span><span class="op" id="4001978">(</span><span class="ident" id="4001979">i</span>&nbsp;<span class="op" id="4001981">/</span>&nbsp;<span class="ident" id="4001983">_W</span><span class="op" id="4001985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001988">m</span>&nbsp;<span class="op" id="4001990">:=</span>&nbsp;<span class="ident" id="4001993">Word</span><span class="op" id="4001997">(</span><span class="num" id="4001998">1</span><span class="op" id="4001999">)</span>&nbsp;<span class="op" id="4002001">&lt;&lt;</span>&nbsp;<span class="op" id="4002004">(</span><span class="ident" id="4002005">i</span>&nbsp;<span class="op" id="4002007">%</span>&nbsp;<span class="ident" id="4002009">_W</span><span class="op" id="4002011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002014">n</span>&nbsp;<span class="op" id="4002016">:=</span>&nbsp;<span class="builtinfunc" id="4002019">len</span><span class="op" id="4002022">(</span><span class="ident" id="4002023">x</span><span class="op" id="4002024">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002027">switch</span>&nbsp;<span class="ident" id="4002034">b</span>&nbsp;<span class="op" id="4002036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002039">case</span>&nbsp;<span class="num" id="4002044">0</span><span class="op" id="4002045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002049">z</span>&nbsp;<span class="op" id="4002051">=</span>&nbsp;<span class="ident" id="4002053">z</span><span class="op" id="4002054">.</span><span class="builtinfunc" id="4002055">make</span><span class="op" id="4002059">(</span><span class="ident" id="4002060">n</span><span class="op" id="4002061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4002065">copy</span><span class="op" id="4002069">(</span><span class="ident" id="4002070">z</span><span class="op" id="4002071">,</span>&nbsp;<span class="ident" id="4002073">x</span><span class="op" id="4002074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002078">if</span>&nbsp;<span class="ident" id="4002081">j</span>&nbsp;<span class="op" id="4002083">&gt;=</span>&nbsp;<span class="ident" id="4002086">n</span>&nbsp;<span class="op" id="4002088">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002093">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002115">return</span>&nbsp;<span class="ident" id="4002122">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002130">z</span><span class="op" id="4002131">[</span><span class="ident" id="4002132">j</span><span class="op" id="4002133">]</span>&nbsp;<span class="op" id="4002135">&amp;^=</span>&nbsp;<span class="ident" id="4002139">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002143">return</span>&nbsp;<span class="ident" id="4002150">z</span><span class="op" id="4002151">.</span><span class="ident" id="4002152">norm</span><span class="op" id="4002156">(</span><span class="op" id="4002157">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002160">case</span>&nbsp;<span class="num" id="4002165">1</span><span class="op" id="4002166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002170">if</span>&nbsp;<span class="ident" id="4002173">j</span>&nbsp;<span class="op" id="4002175">&gt;=</span>&nbsp;<span class="ident" id="4002178">n</span>&nbsp;<span class="op" id="4002180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002185">z</span>&nbsp;<span class="op" id="4002187">=</span>&nbsp;<span class="ident" id="4002189">z</span><span class="op" id="4002190">.</span><span class="builtinfunc" id="4002191">make</span><span class="op" id="4002195">(</span><span class="ident" id="4002196">j</span>&nbsp;<span class="op" id="4002198">+</span>&nbsp;<span class="num" id="4002200">1</span><span class="op" id="4002201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002206">z</span><span class="op" id="4002207">[</span><span class="ident" id="4002208">n</span><span class="op" id="4002209">:</span><span class="op" id="4002210">]</span><span class="op" id="4002211">.</span><span class="ident" id="4002212">clear</span><span class="op" id="4002217">(</span><span class="op" id="4002218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002222">}</span>&nbsp;<span class="keyword" id="4002224">else</span>&nbsp;<span class="op" id="4002229">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002234">z</span>&nbsp;<span class="op" id="4002236">=</span>&nbsp;<span class="ident" id="4002238">z</span><span class="op" id="4002239">.</span><span class="builtinfunc" id="4002240">make</span><span class="op" id="4002244">(</span><span class="ident" id="4002245">n</span><span class="op" id="4002246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4002254">copy</span><span class="op" id="4002258">(</span><span class="ident" id="4002259">z</span><span class="op" id="4002260">,</span>&nbsp;<span class="ident" id="4002262">x</span><span class="op" id="4002263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002267">z</span><span class="op" id="4002268">[</span><span class="ident" id="4002269">j</span><span class="op" id="4002270">]</span>&nbsp;<span class="op" id="4002272">|=</span>&nbsp;<span class="ident" id="4002275">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002279">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002305">return</span>&nbsp;<span class="ident" id="4002312">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4002318">panic</span><span class="op" id="4002323">(</span><span class="string" id="4002324">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="4002347">)</span><br>
<span class="lineno"></span><span class="op" id="4002349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="4002352">func</span>&nbsp;<span class="op" id="4002357">(</span><span class="ident" id="4002358">z</span>&nbsp;<span class="ident" id="4002360">nat</span><span class="op" id="4002363">)</span>&nbsp;<span class="ident" id="4002365">bit</span><span class="op" id="4002368">(</span><span class="ident" id="4002369">i</span>&nbsp;<span class="builtintype" id="4002371">uint</span><span class="op" id="4002375">)</span>&nbsp;<span class="builtintype" id="4002377">uint</span>&nbsp;<span class="op" id="4002382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002385">j</span>&nbsp;<span class="op" id="4002387">:=</span>&nbsp;<span class="builtintype" id="4002390">int</span><span class="op" id="4002393">(</span><span class="ident" id="4002394">i</span>&nbsp;<span class="op" id="4002396">/</span>&nbsp;<span class="ident" id="4002398">_W</span><span class="op" id="4002400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002403">if</span>&nbsp;<span class="ident" id="4002406">j</span>&nbsp;<span class="op" id="4002408">&gt;=</span>&nbsp;<span class="builtinfunc" id="4002411">len</span><span class="op" id="4002414">(</span><span class="ident" id="4002415">z</span><span class="op" id="4002416">)</span>&nbsp;<span class="op" id="4002418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002422">return</span>&nbsp;<span class="num" id="4002429">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002432">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002435">return</span>&nbsp;<span class="builtintype" id="4002442">uint</span><span class="op" id="4002446">(</span><span class="ident" id="4002447">z</span><span class="op" id="4002448">[</span><span class="ident" id="4002449">j</span><span class="op" id="4002450">]</span>&nbsp;<span class="op" id="4002452">&gt;&gt;</span>&nbsp;<span class="op" id="4002455">(</span><span class="ident" id="4002456">i</span>&nbsp;<span class="op" id="4002458">%</span>&nbsp;<span class="ident" id="4002460">_W</span><span class="op" id="4002462">)</span>&nbsp;<span class="op" id="4002464">&amp;</span>&nbsp;<span class="num" id="4002466">1</span><span class="op" id="4002467">)</span><br>
<span class="lineno"></span><span class="op" id="4002469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4002472">func</span>&nbsp;<span class="op" id="4002477">(</span><span class="ident" id="4002478">z</span>&nbsp;<span class="ident" id="4002480">nat</span><span class="op" id="4002483">)</span>&nbsp;<span class="ident" id="4002485">and</span><span class="op" id="4002488">(</span><span class="ident" id="4002489">x</span><span class="op" id="4002490">,</span>&nbsp;<span class="ident" id="4002492">y</span>&nbsp;<span class="ident" id="4002494">nat</span><span class="op" id="4002497">)</span>&nbsp;<span class="ident" id="4002499">nat</span>&nbsp;<span class="op" id="4002503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002506">m</span>&nbsp;<span class="op" id="4002508">:=</span>&nbsp;<span class="builtinfunc" id="4002511">len</span><span class="op" id="4002514">(</span><span class="ident" id="4002515">x</span><span class="op" id="4002516">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002519">n</span>&nbsp;<span class="op" id="4002521">:=</span>&nbsp;<span class="builtinfunc" id="4002524">len</span><span class="op" id="4002527">(</span><span class="ident" id="4002528">y</span><span class="op" id="4002529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002532">if</span>&nbsp;<span class="ident" id="4002535">m</span>&nbsp;<span class="op" id="4002537">&gt;</span>&nbsp;<span class="ident" id="4002539">n</span>&nbsp;<span class="op" id="4002541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002545">m</span>&nbsp;<span class="op" id="4002547">=</span>&nbsp;<span class="ident" id="4002549">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002555">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002567">z</span>&nbsp;<span class="op" id="4002569">=</span>&nbsp;<span class="ident" id="4002571">z</span><span class="op" id="4002572">.</span><span class="builtinfunc" id="4002573">make</span><span class="op" id="4002577">(</span><span class="ident" id="4002578">m</span><span class="op" id="4002579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002582">for</span>&nbsp;<span class="ident" id="4002586">i</span>&nbsp;<span class="op" id="4002588">:=</span>&nbsp;<span class="num" id="4002591">0</span><span class="op" id="4002592">;</span>&nbsp;<span class="ident" id="4002594">i</span>&nbsp;<span class="op" id="4002596">&lt;</span>&nbsp;<span class="ident" id="4002598">m</span><span class="op" id="4002599">;</span>&nbsp;<span class="ident" id="4002601">i</span><span class="op" id="4002602">++</span>&nbsp;<span class="op" id="4002605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002609">z</span><span class="op" id="4002610">[</span><span class="ident" id="4002611">i</span><span class="op" id="4002612">]</span>&nbsp;<span class="op" id="4002614">=</span>&nbsp;<span class="ident" id="4002616">x</span><span class="op" id="4002617">[</span><span class="ident" id="4002618">i</span><span class="op" id="4002619">]</span>&nbsp;<span class="op" id="4002621">&amp;</span>&nbsp;<span class="ident" id="4002623">y</span><span class="op" id="4002624">[</span><span class="ident" id="4002625">i</span><span class="op" id="4002626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002629">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002633">return</span>&nbsp;<span class="ident" id="4002640">z</span><span class="op" id="4002641">.</span><span class="ident" id="4002642">norm</span><span class="op" id="4002646">(</span><span class="op" id="4002647">)</span><br>
<span class="lineno"></span><span class="op" id="4002649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4002652">func</span>&nbsp;<span class="op" id="4002657">(</span><span class="ident" id="4002658">z</span>&nbsp;<span class="ident" id="4002660">nat</span><span class="op" id="4002663">)</span>&nbsp;<span class="ident" id="4002665">andNot</span><span class="op" id="4002671">(</span><span class="ident" id="4002672">x</span><span class="op" id="4002673">,</span>&nbsp;<span class="ident" id="4002675">y</span>&nbsp;<span class="ident" id="4002677">nat</span><span class="op" id="4002680">)</span>&nbsp;<span class="ident" id="4002682">nat</span>&nbsp;<span class="op" id="4002686">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002689">m</span>&nbsp;<span class="op" id="4002691">:=</span>&nbsp;<span class="builtinfunc" id="4002694">len</span><span class="op" id="4002697">(</span><span class="ident" id="4002698">x</span><span class="op" id="4002699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002702">n</span>&nbsp;<span class="op" id="4002704">:=</span>&nbsp;<span class="builtinfunc" id="4002707">len</span><span class="op" id="4002710">(</span><span class="ident" id="4002711">y</span><span class="op" id="4002712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002715">if</span>&nbsp;<span class="ident" id="4002718">n</span>&nbsp;<span class="op" id="4002720">&gt;</span>&nbsp;<span class="ident" id="4002722">m</span>&nbsp;<span class="op" id="4002724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002728">n</span>&nbsp;<span class="op" id="4002730">=</span>&nbsp;<span class="ident" id="4002732">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002735">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002738">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002750">z</span>&nbsp;<span class="op" id="4002752">=</span>&nbsp;<span class="ident" id="4002754">z</span><span class="op" id="4002755">.</span><span class="builtinfunc" id="4002756">make</span><span class="op" id="4002760">(</span><span class="ident" id="4002761">m</span><span class="op" id="4002762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002765">for</span>&nbsp;<span class="ident" id="4002769">i</span>&nbsp;<span class="op" id="4002771">:=</span>&nbsp;<span class="num" id="4002774">0</span><span class="op" id="4002775">;</span>&nbsp;<span class="ident" id="4002777">i</span>&nbsp;<span class="op" id="4002779">&lt;</span>&nbsp;<span class="ident" id="4002781">n</span><span class="op" id="4002782">;</span>&nbsp;<span class="ident" id="4002784">i</span><span class="op" id="4002785">++</span>&nbsp;<span class="op" id="4002788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002792">z</span><span class="op" id="4002793">[</span><span class="ident" id="4002794">i</span><span class="op" id="4002795">]</span>&nbsp;<span class="op" id="4002797">=</span>&nbsp;<span class="ident" id="4002799">x</span><span class="op" id="4002800">[</span><span class="ident" id="4002801">i</span><span class="op" id="4002802">]</span>&nbsp;<span class="op" id="4002804">&amp;^</span>&nbsp;<span class="ident" id="4002807">y</span><span class="op" id="4002808">[</span><span class="ident" id="4002809">i</span><span class="op" id="4002810">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4002816">copy</span><span class="op" id="4002820">(</span><span class="ident" id="4002821">z</span><span class="op" id="4002822">[</span><span class="ident" id="4002823">n</span><span class="op" id="4002824">:</span><span class="ident" id="4002825">m</span><span class="op" id="4002826">]</span><span class="op" id="4002827">,</span>&nbsp;<span class="ident" id="4002829">x</span><span class="op" id="4002830">[</span><span class="ident" id="4002831">n</span><span class="op" id="4002832">:</span><span class="ident" id="4002833">m</span><span class="op" id="4002834">]</span><span class="op" id="4002835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002839">return</span>&nbsp;<span class="ident" id="4002846">z</span><span class="op" id="4002847">.</span><span class="ident" id="4002848">norm</span><span class="op" id="4002852">(</span><span class="op" id="4002853">)</span><br>
<span class="lineno"></span><span class="op" id="4002855">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="4002858">func</span>&nbsp;<span class="op" id="4002863">(</span><span class="ident" id="4002864">z</span>&nbsp;<span class="ident" id="4002866">nat</span><span class="op" id="4002869">)</span>&nbsp;<span class="ident" id="4002871">or</span><span class="op" id="4002873">(</span><span class="ident" id="4002874">x</span><span class="op" id="4002875">,</span>&nbsp;<span class="ident" id="4002877">y</span>&nbsp;<span class="ident" id="4002879">nat</span><span class="op" id="4002882">)</span>&nbsp;<span class="ident" id="4002884">nat</span>&nbsp;<span class="op" id="4002888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002891">m</span>&nbsp;<span class="op" id="4002893">:=</span>&nbsp;<span class="builtinfunc" id="4002896">len</span><span class="op" id="4002899">(</span><span class="ident" id="4002900">x</span><span class="op" id="4002901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002904">n</span>&nbsp;<span class="op" id="4002906">:=</span>&nbsp;<span class="builtinfunc" id="4002909">len</span><span class="op" id="4002912">(</span><span class="ident" id="4002913">y</span><span class="op" id="4002914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002917">s</span>&nbsp;<span class="op" id="4002919">:=</span>&nbsp;<span class="ident" id="4002922">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002925">if</span>&nbsp;<span class="ident" id="4002928">m</span>&nbsp;<span class="op" id="4002930">&lt;</span>&nbsp;<span class="ident" id="4002932">n</span>&nbsp;<span class="op" id="4002934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002938">n</span><span class="op" id="4002939">,</span>&nbsp;<span class="ident" id="4002941">m</span>&nbsp;<span class="op" id="4002943">=</span>&nbsp;<span class="ident" id="4002945">m</span><span class="op" id="4002946">,</span>&nbsp;<span class="ident" id="4002948">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002952">s</span>&nbsp;<span class="op" id="4002954">=</span>&nbsp;<span class="ident" id="4002956">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002962">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002974">z</span>&nbsp;<span class="op" id="4002976">=</span>&nbsp;<span class="ident" id="4002978">z</span><span class="op" id="4002979">.</span><span class="builtinfunc" id="4002980">make</span><span class="op" id="4002984">(</span><span class="ident" id="4002985">m</span><span class="op" id="4002986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002989">for</span>&nbsp;<span class="ident" id="4002993">i</span>&nbsp;<span class="op" id="4002995">:=</span>&nbsp;<span class="num" id="4002998">0</span><span class="op" id="4002999">;</span>&nbsp;<span class="ident" id="4003001">i</span>&nbsp;<span class="op" id="4003003">&lt;</span>&nbsp;<span class="ident" id="4003005">n</span><span class="op" id="4003006">;</span>&nbsp;<span class="ident" id="4003008">i</span><span class="op" id="4003009">++</span>&nbsp;<span class="op" id="4003012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003016">z</span><span class="op" id="4003017">[</span><span class="ident" id="4003018">i</span><span class="op" id="4003019">]</span>&nbsp;<span class="op" id="4003021">=</span>&nbsp;<span class="ident" id="4003023">x</span><span class="op" id="4003024">[</span><span class="ident" id="4003025">i</span><span class="op" id="4003026">]</span>&nbsp;<span class="op" id="4003028">|</span>&nbsp;<span class="ident" id="4003030">y</span><span class="op" id="4003031">[</span><span class="ident" id="4003032">i</span><span class="op" id="4003033">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003036">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4003039">copy</span><span class="op" id="4003043">(</span><span class="ident" id="4003044">z</span><span class="op" id="4003045">[</span><span class="ident" id="4003046">n</span><span class="op" id="4003047">:</span><span class="ident" id="4003048">m</span><span class="op" id="4003049">]</span><span class="op" id="4003050">,</span>&nbsp;<span class="ident" id="4003052">s</span><span class="op" id="4003053">[</span><span class="ident" id="4003054">n</span><span class="op" id="4003055">:</span><span class="ident" id="4003056">m</span><span class="op" id="4003057">]</span><span class="op" id="4003058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003062">return</span>&nbsp;<span class="ident" id="4003069">z</span><span class="op" id="4003070">.</span><span class="ident" id="4003071">norm</span><span class="op" id="4003075">(</span><span class="op" id="4003076">)</span><br>
<span class="lineno"></span><span class="op" id="4003078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="4003081">func</span>&nbsp;<span class="op" id="4003086">(</span><span class="ident" id="4003087">z</span>&nbsp;<span class="ident" id="4003089">nat</span><span class="op" id="4003092">)</span>&nbsp;<span class="ident" id="4003094">xor</span><span class="op" id="4003097">(</span><span class="ident" id="4003098">x</span><span class="op" id="4003099">,</span>&nbsp;<span class="ident" id="4003101">y</span>&nbsp;<span class="ident" id="4003103">nat</span><span class="op" id="4003106">)</span>&nbsp;<span class="ident" id="4003108">nat</span>&nbsp;<span class="op" id="4003112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003115">m</span>&nbsp;<span class="op" id="4003117">:=</span>&nbsp;<span class="builtinfunc" id="4003120">len</span><span class="op" id="4003123">(</span><span class="ident" id="4003124">x</span><span class="op" id="4003125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003128">n</span>&nbsp;<span class="op" id="4003130">:=</span>&nbsp;<span class="builtinfunc" id="4003133">len</span><span class="op" id="4003136">(</span><span class="ident" id="4003137">y</span><span class="op" id="4003138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003141">s</span>&nbsp;<span class="op" id="4003143">:=</span>&nbsp;<span class="ident" id="4003146">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003149">if</span>&nbsp;<span class="ident" id="4003152">m</span>&nbsp;<span class="op" id="4003154">&lt;</span>&nbsp;<span class="ident" id="4003156">n</span>&nbsp;<span class="op" id="4003158">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003162">n</span><span class="op" id="4003163">,</span>&nbsp;<span class="ident" id="4003165">m</span>&nbsp;<span class="op" id="4003167">=</span>&nbsp;<span class="ident" id="4003169">m</span><span class="op" id="4003170">,</span>&nbsp;<span class="ident" id="4003172">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003176">s</span>&nbsp;<span class="op" id="4003178">=</span>&nbsp;<span class="ident" id="4003180">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003186">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003198">z</span>&nbsp;<span class="op" id="4003200">=</span>&nbsp;<span class="ident" id="4003202">z</span><span class="op" id="4003203">.</span><span class="builtinfunc" id="4003204">make</span><span class="op" id="4003208">(</span><span class="ident" id="4003209">m</span><span class="op" id="4003210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003213">for</span>&nbsp;<span class="ident" id="4003217">i</span>&nbsp;<span class="op" id="4003219">:=</span>&nbsp;<span class="num" id="4003222">0</span><span class="op" id="4003223">;</span>&nbsp;<span class="ident" id="4003225">i</span>&nbsp;<span class="op" id="4003227">&lt;</span>&nbsp;<span class="ident" id="4003229">n</span><span class="op" id="4003230">;</span>&nbsp;<span class="ident" id="4003232">i</span><span class="op" id="4003233">++</span>&nbsp;<span class="op" id="4003236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003240">z</span><span class="op" id="4003241">[</span><span class="ident" id="4003242">i</span><span class="op" id="4003243">]</span>&nbsp;<span class="op" id="4003245">=</span>&nbsp;<span class="ident" id="4003247">x</span><span class="op" id="4003248">[</span><span class="ident" id="4003249">i</span><span class="op" id="4003250">]</span>&nbsp;<span class="op" id="4003252">^</span>&nbsp;<span class="ident" id="4003254">y</span><span class="op" id="4003255">[</span><span class="ident" id="4003256">i</span><span class="op" id="4003257">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4003263">copy</span><span class="op" id="4003267">(</span><span class="ident" id="4003268">z</span><span class="op" id="4003269">[</span><span class="ident" id="4003270">n</span><span class="op" id="4003271">:</span><span class="ident" id="4003272">m</span><span class="op" id="4003273">]</span><span class="op" id="4003274">,</span>&nbsp;<span class="ident" id="4003276">s</span><span class="op" id="4003277">[</span><span class="ident" id="4003278">n</span><span class="op" id="4003279">:</span><span class="ident" id="4003280">m</span><span class="op" id="4003281">]</span><span class="op" id="4003282">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003286">return</span>&nbsp;<span class="ident" id="4003293">z</span><span class="op" id="4003294">.</span><span class="ident" id="4003295">norm</span><span class="op" id="4003299">(</span><span class="op" id="4003300">)</span><br>
<span class="lineno"></span><span class="op" id="4003302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4003305">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="4003367">func</span>&nbsp;<span class="ident" id="4003372">greaterThan</span><span class="op" id="4003383">(</span><span class="ident" id="4003384">x1</span><span class="op" id="4003386">,</span>&nbsp;<span class="ident" id="4003388">x2</span><span class="op" id="4003390">,</span>&nbsp;<span class="ident" id="4003392">y1</span><span class="op" id="4003394">,</span>&nbsp;<span class="ident" id="4003396">y2</span>&nbsp;<span class="ident" id="4003399">Word</span><span class="op" id="4003403">)</span>&nbsp;<span class="builtintype" id="4003405">bool</span>&nbsp;<span class="op" id="4003410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003413">return</span>&nbsp;<span class="ident" id="4003420">x1</span>&nbsp;<span class="op" id="4003423">&gt;</span>&nbsp;<span class="ident" id="4003425">y1</span>&nbsp;<span class="op" id="4003428">||</span>&nbsp;<span class="ident" id="4003431">x1</span>&nbsp;<span class="op" id="4003434">==</span>&nbsp;<span class="ident" id="4003437">y1</span>&nbsp;<span class="op" id="4003440">&amp;&amp;</span>&nbsp;<span class="ident" id="4003443">x2</span>&nbsp;<span class="op" id="4003446">&gt;</span>&nbsp;<span class="ident" id="4003448">y2</span><br>
<span class="lineno"></span><span class="op" id="4003451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4003454">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="4003477">func</span>&nbsp;<span class="op" id="4003482">(</span><span class="ident" id="4003483">x</span>&nbsp;<span class="ident" id="4003485">nat</span><span class="op" id="4003488">)</span>&nbsp;<span class="ident" id="4003490">modW</span><span class="op" id="4003494">(</span><span class="ident" id="4003495">d</span>&nbsp;<span class="ident" id="4003497">Word</span><span class="op" id="4003501">)</span>&nbsp;<span class="op" id="4003503">(</span><span class="ident" id="4003504">r</span>&nbsp;<span class="ident" id="4003506">Word</span><span class="op" id="4003510">)</span>&nbsp;<span class="op" id="4003512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003515">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003575">var</span>&nbsp;<span class="ident" id="4003579">q</span>&nbsp;<span class="ident" id="4003581">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003586">q</span>&nbsp;<span class="op" id="4003588">=</span>&nbsp;<span class="ident" id="4003590">q</span><span class="op" id="4003591">.</span><span class="builtinfunc" id="4003592">make</span><span class="op" id="4003596">(</span><span class="builtinfunc" id="4003597">len</span><span class="op" id="4003600">(</span><span class="ident" id="4003601">x</span><span class="op" id="4003602">)</span><span class="op" id="4003603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003606">return</span>&nbsp;<span class="ident" id="4003613">divWVW</span><span class="op" id="4003619">(</span><span class="ident" id="4003620">q</span><span class="op" id="4003621">,</span>&nbsp;<span class="num" id="4003623">0</span><span class="op" id="4003624">,</span>&nbsp;<span class="ident" id="4003626">x</span><span class="op" id="4003627">,</span>&nbsp;<span class="ident" id="4003629">d</span><span class="op" id="4003630">)</span><br>
<span class="lineno">1190</span><span class="op" id="4003632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4003635">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4003709">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="4003752">func</span>&nbsp;<span class="op" id="4003757">(</span><span class="ident" id="4003758">z</span>&nbsp;<span class="ident" id="4003760">nat</span><span class="op" id="4003763">)</span>&nbsp;<span class="ident" id="4003765">random</span><span class="op" id="4003771">(</span><span class="ident" id="4003772">rand</span>&nbsp;<span class="op" id="4003777">*</span><span class="ident" id="4003778">rand</span><span class="op" id="4003782">.</span><span class="ident" id="4003783">Rand</span><span class="op" id="4003787">,</span>&nbsp;<span class="ident" id="4003789">limit</span>&nbsp;<span class="ident" id="4003795">nat</span><span class="op" id="4003798">,</span>&nbsp;<span class="ident" id="4003800">n</span>&nbsp;<span class="builtintype" id="4003802">int</span><span class="op" id="4003805">)</span>&nbsp;<span class="ident" id="4003807">nat</span>&nbsp;<span class="op" id="4003811">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003814">if</span>&nbsp;<span class="ident" id="4003817">alias</span><span class="op" id="4003822">(</span><span class="ident" id="4003823">z</span><span class="op" id="4003824">,</span>&nbsp;<span class="ident" id="4003826">limit</span><span class="op" id="4003831">)</span>&nbsp;<span class="op" id="4003833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003837">z</span>&nbsp;<span class="op" id="4003839">=</span>&nbsp;<span class="ident" id="4003841">nil</span>&nbsp;<span class="comment" id="4003845">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003891">z</span>&nbsp;<span class="op" id="4003893">=</span>&nbsp;<span class="ident" id="4003895">z</span><span class="op" id="4003896">.</span><span class="builtinfunc" id="4003897">make</span><span class="op" id="4003901">(</span><span class="builtinfunc" id="4003902">len</span><span class="op" id="4003905">(</span><span class="ident" id="4003906">limit</span><span class="op" id="4003911">)</span><span class="op" id="4003912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003916">bitLengthOfMSW</span>&nbsp;<span class="op" id="4003931">:=</span>&nbsp;<span class="builtintype" id="4003934">uint</span><span class="op" id="4003938">(</span><span class="ident" id="4003939">n</span>&nbsp;<span class="op" id="4003941">%</span>&nbsp;<span class="ident" id="4003943">_W</span><span class="op" id="4003945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003948">if</span>&nbsp;<span class="ident" id="4003951">bitLengthOfMSW</span>&nbsp;<span class="op" id="4003966">==</span>&nbsp;<span class="num" id="4003969">0</span>&nbsp;<span class="op" id="4003971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003975">bitLengthOfMSW</span>&nbsp;<span class="op" id="4003990">=</span>&nbsp;<span class="ident" id="4003992">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003999">mask</span>&nbsp;<span class="op" id="4004004">:=</span>&nbsp;<span class="ident" id="4004007">Word</span><span class="op" id="4004011">(</span><span class="op" id="4004012">(</span><span class="num" id="4004013">1</span>&nbsp;<span class="op" id="4004015">&lt;&lt;</span>&nbsp;<span class="ident" id="4004018">bitLengthOfMSW</span><span class="op" id="4004032">)</span>&nbsp;<span class="op" id="4004034">-</span>&nbsp;<span class="num" id="4004036">1</span><span class="op" id="4004037">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004041">for</span>&nbsp;<span class="op" id="4004045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004049">switch</span>&nbsp;<span class="ident" id="4004056">_W</span>&nbsp;<span class="op" id="4004059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004063">case</span>&nbsp;<span class="num" id="4004068">32</span><span class="op" id="4004070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004075">for</span>&nbsp;<span class="ident" id="4004079">i</span>&nbsp;<span class="op" id="4004081">:=</span>&nbsp;<span class="keyword" id="4004084">range</span>&nbsp;<span class="ident" id="4004090">z</span>&nbsp;<span class="op" id="4004092">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004098">z</span><span class="op" id="4004099">[</span><span class="ident" id="4004100">i</span><span class="op" id="4004101">]</span>&nbsp;<span class="op" id="4004103">=</span>&nbsp;<span class="ident" id="4004105">Word</span><span class="op" id="4004109">(</span><span class="ident" id="4004110">rand</span><span class="op" id="4004114">.</span><span class="ident" id="4004115">Uint32</span><span class="op" id="4004121">(</span><span class="op" id="4004122">)</span><span class="op" id="4004123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004132">case</span>&nbsp;<span class="num" id="4004137">64</span><span class="op" id="4004139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004144">for</span>&nbsp;<span class="ident" id="4004148">i</span>&nbsp;<span class="op" id="4004150">:=</span>&nbsp;<span class="keyword" id="4004153">range</span>&nbsp;<span class="ident" id="4004159">z</span>&nbsp;<span class="op" id="4004161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004167">z</span><span class="op" id="4004168">[</span><span class="ident" id="4004169">i</span><span class="op" id="4004170">]</span>&nbsp;<span class="op" id="4004172">=</span>&nbsp;<span class="ident" id="4004174">Word</span><span class="op" id="4004178">(</span><span class="ident" id="4004179">rand</span><span class="op" id="4004183">.</span><span class="ident" id="4004184">Uint32</span><span class="op" id="4004190">(</span><span class="op" id="4004191">)</span><span class="op" id="4004192">)</span>&nbsp;<span class="op" id="4004194">|</span>&nbsp;<span class="ident" id="4004196">Word</span><span class="op" id="4004200">(</span><span class="ident" id="4004201">rand</span><span class="op" id="4004205">.</span><span class="ident" id="4004206">Uint32</span><span class="op" id="4004212">(</span><span class="op" id="4004213">)</span><span class="op" id="4004214">)</span><span class="op" id="4004215">&lt;&lt;</span><span class="num" id="4004217">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004227">default</span><span class="op" id="4004234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4004239">panic</span><span class="op" id="4004244">(</span><span class="string" id="4004245">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4004264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004272">z</span><span class="op" id="4004273">[</span><span class="builtinfunc" id="4004274">len</span><span class="op" id="4004277">(</span><span class="ident" id="4004278">limit</span><span class="op" id="4004283">)</span><span class="op" id="4004284">-</span><span class="num" id="4004285">1</span><span class="op" id="4004286">]</span>&nbsp;<span class="op" id="4004288">&amp;=</span>&nbsp;<span class="ident" id="4004291">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004298">if</span>&nbsp;<span class="ident" id="4004301">z</span><span class="op" id="4004302">.</span><span class="ident" id="4004303">cmp</span><span class="op" id="4004306">(</span><span class="ident" id="4004307">limit</span><span class="op" id="4004312">)</span>&nbsp;<span class="op" id="4004314">&lt;</span>&nbsp;<span class="num" id="4004316">0</span>&nbsp;<span class="op" id="4004318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004323">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004338">return</span>&nbsp;<span class="ident" id="4004345">z</span><span class="op" id="4004346">.</span><span class="ident" id="4004347">norm</span><span class="op" id="4004351">(</span><span class="op" id="4004352">)</span><br>
<span class="lineno"></span><span class="op" id="4004354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4004357">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="4004419">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="4004481">func</span>&nbsp;<span class="op" id="4004486">(</span><span class="ident" id="4004487">z</span>&nbsp;<span class="ident" id="4004489">nat</span><span class="op" id="4004492">)</span>&nbsp;<span class="ident" id="4004494">expNN</span><span class="op" id="4004499">(</span><span class="ident" id="4004500">x</span><span class="op" id="4004501">,</span>&nbsp;<span class="ident" id="4004503">y</span><span class="op" id="4004504">,</span>&nbsp;<span class="ident" id="4004506">m</span>&nbsp;<span class="ident" id="4004508">nat</span><span class="op" id="4004511">)</span>&nbsp;<span class="ident" id="4004513">nat</span>&nbsp;<span class="op" id="4004517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004520">if</span>&nbsp;<span class="ident" id="4004523">alias</span><span class="op" id="4004528">(</span><span class="ident" id="4004529">z</span><span class="op" id="4004530">,</span>&nbsp;<span class="ident" id="4004532">x</span><span class="op" id="4004533">)</span>&nbsp;<span class="op" id="4004535">||</span>&nbsp;<span class="ident" id="4004538">alias</span><span class="op" id="4004543">(</span><span class="ident" id="4004544">z</span><span class="op" id="4004545">,</span>&nbsp;<span class="ident" id="4004547">y</span><span class="op" id="4004548">)</span>&nbsp;<span class="op" id="4004550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004554">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004608">z</span>&nbsp;<span class="op" id="4004610">=</span>&nbsp;<span class="ident" id="4004612">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004617">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004621">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004641">if</span>&nbsp;<span class="builtinfunc" id="4004644">len</span><span class="op" id="4004647">(</span><span class="ident" id="4004648">m</span><span class="op" id="4004649">)</span>&nbsp;<span class="op" id="4004651">==</span>&nbsp;<span class="num" id="4004654">1</span>&nbsp;<span class="op" id="4004656">&amp;&amp;</span>&nbsp;<span class="ident" id="4004659">m</span><span class="op" id="4004660">[</span><span class="num" id="4004661">0</span><span class="op" id="4004662">]</span>&nbsp;<span class="op" id="4004664">==</span>&nbsp;<span class="num" id="4004667">1</span>&nbsp;<span class="op" id="4004669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004673">return</span>&nbsp;<span class="ident" id="4004680">z</span><span class="op" id="4004681">.</span><span class="ident" id="4004682">setWord</span><span class="op" id="4004689">(</span><span class="num" id="4004690">0</span><span class="op" id="4004691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004694">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004697">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004718">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004732">if</span>&nbsp;<span class="builtinfunc" id="4004735">len</span><span class="op" id="4004738">(</span><span class="ident" id="4004739">y</span><span class="op" id="4004740">)</span>&nbsp;<span class="op" id="4004742">==</span>&nbsp;<span class="num" id="4004745">0</span>&nbsp;<span class="op" id="4004747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004751">return</span>&nbsp;<span class="ident" id="4004758">z</span><span class="op" id="4004759">.</span><span class="ident" id="4004760">setWord</span><span class="op" id="4004767">(</span><span class="num" id="4004768">1</span><span class="op" id="4004769">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004775">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004786">if</span>&nbsp;<span class="builtinfunc" id="4004789">len</span><span class="op" id="4004792">(</span><span class="ident" id="4004793">m</span><span class="op" id="4004794">)</span>&nbsp;<span class="op" id="4004796">!=</span>&nbsp;<span class="num" id="4004799">0</span>&nbsp;<span class="op" id="4004801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004805">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004857">z</span>&nbsp;<span class="op" id="4004859">=</span>&nbsp;<span class="ident" id="4004861">z</span><span class="op" id="4004862">.</span><span class="builtinfunc" id="4004863">make</span><span class="op" id="4004867">(</span><span class="builtinfunc" id="4004868">len</span><span class="op" id="4004871">(</span><span class="ident" id="4004872">m</span><span class="op" id="4004873">)</span><span class="op" id="4004874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004880">z</span>&nbsp;<span class="op" id="4004882">=</span>&nbsp;<span class="ident" id="4004884">z</span><span class="op" id="4004885">.</span><span class="ident" id="4004886">set</span><span class="op" id="4004889">(</span><span class="ident" id="4004890">x</span><span class="op" id="4004891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004895">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004960">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005033">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005103">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005169">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005185">if</span>&nbsp;<span class="builtinfunc" id="4005188">len</span><span class="op" id="4005191">(</span><span class="ident" id="4005192">x</span><span class="op" id="4005193">)</span>&nbsp;<span class="op" id="4005195">&gt;</span>&nbsp;<span class="num" id="4005197">1</span>&nbsp;<span class="op" id="4005199">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4005202">len</span><span class="op" id="4005205">(</span><span class="ident" id="4005206">y</span><span class="op" id="4005207">)</span>&nbsp;<span class="op" id="4005209">&gt;</span>&nbsp;<span class="num" id="4005211">1</span>&nbsp;<span class="op" id="4005213">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4005216">len</span><span class="op" id="4005219">(</span><span class="ident" id="4005220">m</span><span class="op" id="4005221">)</span>&nbsp;<span class="op" id="4005223">&gt;</span>&nbsp;<span class="num" id="4005225">0</span>&nbsp;<span class="op" id="4005227">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005231">return</span>&nbsp;<span class="ident" id="4005238">z</span><span class="op" id="4005239">.</span><span class="ident" id="4005240">expNNWindowed</span><span class="op" id="4005253">(</span><span class="ident" id="4005254">x</span><span class="op" id="4005255">,</span>&nbsp;<span class="ident" id="4005257">y</span><span class="op" id="4005258">,</span>&nbsp;<span class="ident" id="4005260">m</span><span class="op" id="4005261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005268">v</span>&nbsp;<span class="op" id="4005270">:=</span>&nbsp;<span class="ident" id="4005273">y</span><span class="op" id="4005274">[</span><span class="builtinfunc" id="4005275">len</span><span class="op" id="4005278">(</span><span class="ident" id="4005279">y</span><span class="op" id="4005280">)</span><span class="op" id="4005281">-</span><span class="num" id="4005282">1</span><span class="op" id="4005283">]</span>&nbsp;<span class="comment" id="4005285">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005329">shift</span>&nbsp;<span class="op" id="4005335">:=</span>&nbsp;<span class="ident" id="4005338">leadingZeros</span><span class="op" id="4005350">(</span><span class="ident" id="4005351">v</span><span class="op" id="4005352">)</span>&nbsp;<span class="op" id="4005354">+</span>&nbsp;<span class="num" id="4005356">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005359">v</span>&nbsp;<span class="op" id="4005361">&lt;&lt;=</span>&nbsp;<span class="ident" id="4005365">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005372">var</span>&nbsp;<span class="ident" id="4005376">q</span>&nbsp;<span class="ident" id="4005378">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005384">const</span>&nbsp;<span class="ident" id="4005390">mask</span>&nbsp;<span class="op" id="4005395">=</span>&nbsp;<span class="num" id="4005397">1</span>&nbsp;<span class="op" id="4005399">&lt;&lt;</span>&nbsp;<span class="op" id="4005402">(</span><span class="ident" id="4005403">_W</span>&nbsp;<span class="op" id="4005406">-</span>&nbsp;<span class="num" id="4005408">1</span><span class="op" id="4005409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005413">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005483">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005555">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005613">w</span>&nbsp;<span class="op" id="4005615">:=</span>&nbsp;<span class="ident" id="4005618">_W</span>&nbsp;<span class="op" id="4005621">-</span>&nbsp;<span class="builtintype" id="4005623">int</span><span class="op" id="4005626">(</span><span class="ident" id="4005627">shift</span><span class="op" id="4005632">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005635">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4005695">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005736">var</span>&nbsp;<span class="ident" id="4005740">zz</span><span class="op" id="4005742">,</span>&nbsp;<span class="ident" id="4005744">r</span>&nbsp;<span class="ident" id="4005746">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005751">for</span>&nbsp;<span class="ident" id="4005755">j</span>&nbsp;<span class="op" id="4005757">:=</span>&nbsp;<span class="num" id="4005760">0</span><span class="op" id="4005761">;</span>&nbsp;<span class="ident" id="4005763">j</span>&nbsp;<span class="op" id="4005765">&lt;</span>&nbsp;<span class="ident" id="4005767">w</span><span class="op" id="4005768">;</span>&nbsp;<span class="ident" id="4005770">j</span><span class="op" id="4005771">++</span>&nbsp;<span class="op" id="4005774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005778">zz</span>&nbsp;<span class="op" id="4005781">=</span>&nbsp;<span class="ident" id="4005783">zz</span><span class="op" id="4005785">.</span><span class="ident" id="4005786">mul</span><span class="op" id="4005789">(</span><span class="ident" id="4005790">z</span><span class="op" id="4005791">,</span>&nbsp;<span class="ident" id="4005793">z</span><span class="op" id="4005794">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005798">zz</span><span class="op" id="4005800">,</span>&nbsp;<span class="ident" id="4005802">z</span>&nbsp;<span class="op" id="4005804">=</span>&nbsp;<span class="ident" id="4005806">z</span><span class="op" id="4005807">,</span>&nbsp;<span class="ident" id="4005809">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005815">if</span>&nbsp;<span class="ident" id="4005818">v</span><span class="op" id="4005819">&amp;</span><span class="ident" id="4005820">mask</span>&nbsp;<span class="op" id="4005825">!=</span>&nbsp;<span class="num" id="4005828">0</span>&nbsp;<span class="op" id="4005830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005835">zz</span>&nbsp;<span class="op" id="4005838">=</span>&nbsp;<span class="ident" id="4005840">zz</span><span class="op" id="4005842">.</span><span class="ident" id="4005843">mul</span><span class="op" id="4005846">(</span><span class="ident" id="4005847">z</span><span class="op" id="4005848">,</span>&nbsp;<span class="ident" id="4005850">x</span><span class="op" id="4005851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005856">zz</span><span class="op" id="4005858">,</span>&nbsp;<span class="ident" id="4005860">z</span>&nbsp;<span class="op" id="4005862">=</span>&nbsp;<span class="ident" id="4005864">z</span><span class="op" id="4005865">,</span>&nbsp;<span class="ident" id="4005867">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005877">if</span>&nbsp;<span class="builtinfunc" id="4005880">len</span><span class="op" id="4005883">(</span><span class="ident" id="4005884">m</span><span class="op" id="4005885">)</span>&nbsp;<span class="op" id="4005887">!=</span>&nbsp;<span class="num" id="4005890">0</span>&nbsp;<span class="op" id="4005892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005897">zz</span><span class="op" id="4005899">,</span>&nbsp;<span class="ident" id="4005901">r</span>&nbsp;<span class="op" id="4005903">=</span>&nbsp;<span class="ident" id="4005905">zz</span><span class="op" id="4005907">.</span><span class="ident" id="4005908">div</span><span class="op" id="4005911">(</span><span class="ident" id="4005912">r</span><span class="op" id="4005913">,</span>&nbsp;<span class="ident" id="4005915">z</span><span class="op" id="4005916">,</span>&nbsp;<span class="ident" id="4005918">m</span><span class="op" id="4005919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005924">zz</span><span class="op" id="4005926">,</span>&nbsp;<span class="ident" id="4005928">r</span><span class="op" id="4005929">,</span>&nbsp;<span class="ident" id="4005931">q</span><span class="op" id="4005932">,</span>&nbsp;<span class="ident" id="4005934">z</span>&nbsp;<span class="op" id="4005936">=</span>&nbsp;<span class="ident" id="4005938">q</span><span class="op" id="4005939">,</span>&nbsp;<span class="ident" id="4005941">z</span><span class="op" id="4005942">,</span>&nbsp;<span class="ident" id="4005944">zz</span><span class="op" id="4005946">,</span>&nbsp;<span class="ident" id="4005948">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005957">v</span>&nbsp;<span class="op" id="4005959">&lt;&lt;=</span>&nbsp;<span class="num" id="4005963">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005970">for</span>&nbsp;<span class="ident" id="4005974">i</span>&nbsp;<span class="op" id="4005976">:=</span>&nbsp;<span class="builtinfunc" id="4005979">len</span><span class="op" id="4005982">(</span><span class="ident" id="4005983">y</span><span class="op" id="4005984">)</span>&nbsp;<span class="op" id="4005986">-</span>&nbsp;<span class="num" id="4005988">2</span><span class="op" id="4005989">;</span>&nbsp;<span class="ident" id="4005991">i</span>&nbsp;<span class="op" id="4005993">&gt;=</span>&nbsp;<span class="num" id="4005996">0</span><span class="op" id="4005997">;</span>&nbsp;<span class="ident" id="4005999">i</span><span class="op" id="4006000">--</span>&nbsp;<span class="op" id="4006003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006007">v</span>&nbsp;<span class="op" id="4006009">=</span>&nbsp;<span class="ident" id="4006011">y</span><span class="op" id="4006012">[</span><span class="ident" id="4006013">i</span><span class="op" id="4006014">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006019">for</span>&nbsp;<span class="ident" id="4006023">j</span>&nbsp;<span class="op" id="4006025">:=</span>&nbsp;<span class="num" id="4006028">0</span><span class="op" id="4006029">;</span>&nbsp;<span class="ident" id="4006031">j</span>&nbsp;<span class="op" id="4006033">&lt;</span>&nbsp;<span class="ident" id="4006035">_W</span><span class="op" id="4006037">;</span>&nbsp;<span class="ident" id="4006039">j</span><span class="op" id="4006040">++</span>&nbsp;<span class="op" id="4006043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006048">zz</span>&nbsp;<span class="op" id="4006051">=</span>&nbsp;<span class="ident" id="4006053">zz</span><span class="op" id="4006055">.</span><span class="ident" id="4006056">mul</span><span class="op" id="4006059">(</span><span class="ident" id="4006060">z</span><span class="op" id="4006061">,</span>&nbsp;<span class="ident" id="4006063">z</span><span class="op" id="4006064">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006069">zz</span><span class="op" id="4006071">,</span>&nbsp;<span class="ident" id="4006073">z</span>&nbsp;<span class="op" id="4006075">=</span>&nbsp;<span class="ident" id="4006077">z</span><span class="op" id="4006078">,</span>&nbsp;<span class="ident" id="4006080">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006087">if</span>&nbsp;<span class="ident" id="4006090">v</span><span class="op" id="4006091">&amp;</span><span class="ident" id="4006092">mask</span>&nbsp;<span class="op" id="4006097">!=</span>&nbsp;<span class="num" id="4006100">0</span>&nbsp;<span class="op" id="4006102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006108">zz</span>&nbsp;<span class="op" id="4006111">=</span>&nbsp;<span class="ident" id="4006113">zz</span><span class="op" id="4006115">.</span><span class="ident" id="4006116">mul</span><span class="op" id="4006119">(</span><span class="ident" id="4006120">z</span><span class="op" id="4006121">,</span>&nbsp;<span class="ident" id="4006123">x</span><span class="op" id="4006124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006130">zz</span><span class="op" id="4006132">,</span>&nbsp;<span class="ident" id="4006134">z</span>&nbsp;<span class="op" id="4006136">=</span>&nbsp;<span class="ident" id="4006138">z</span><span class="op" id="4006139">,</span>&nbsp;<span class="ident" id="4006141">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006153">if</span>&nbsp;<span class="builtinfunc" id="4006156">len</span><span class="op" id="4006159">(</span><span class="ident" id="4006160">m</span><span class="op" id="4006161">)</span>&nbsp;<span class="op" id="4006163">!=</span>&nbsp;<span class="num" id="4006166">0</span>&nbsp;<span class="op" id="4006168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006174">zz</span><span class="op" id="4006176">,</span>&nbsp;<span class="ident" id="4006178">r</span>&nbsp;<span class="op" id="4006180">=</span>&nbsp;<span class="ident" id="4006182">zz</span><span class="op" id="4006184">.</span><span class="ident" id="4006185">div</span><span class="op" id="4006188">(</span><span class="ident" id="4006189">r</span><span class="op" id="4006190">,</span>&nbsp;<span class="ident" id="4006192">z</span><span class="op" id="4006193">,</span>&nbsp;<span class="ident" id="4006195">m</span><span class="op" id="4006196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006202">zz</span><span class="op" id="4006204">,</span>&nbsp;<span class="ident" id="4006206">r</span><span class="op" id="4006207">,</span>&nbsp;<span class="ident" id="4006209">q</span><span class="op" id="4006210">,</span>&nbsp;<span class="ident" id="4006212">z</span>&nbsp;<span class="op" id="4006214">=</span>&nbsp;<span class="ident" id="4006216">q</span><span class="op" id="4006217">,</span>&nbsp;<span class="ident" id="4006219">z</span><span class="op" id="4006220">,</span>&nbsp;<span class="ident" id="4006222">zz</span><span class="op" id="4006224">,</span>&nbsp;<span class="ident" id="4006226">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006237">v</span>&nbsp;<span class="op" id="4006239">&lt;&lt;=</span>&nbsp;<span class="num" id="4006243">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006250">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006254">return</span>&nbsp;<span class="ident" id="4006261">z</span><span class="op" id="4006262">.</span><span class="ident" id="4006263">norm</span><span class="op" id="4006267">(</span><span class="op" id="4006268">)</span><br>
<span class="lineno"></span><span class="op" id="4006270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4006273">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="4006341">func</span>&nbsp;<span class="op" id="4006346">(</span><span class="ident" id="4006347">z</span>&nbsp;<span class="ident" id="4006349">nat</span><span class="op" id="4006352">)</span>&nbsp;<span class="ident" id="4006354">expNNWindowed</span><span class="op" id="4006367">(</span><span class="ident" id="4006368">x</span><span class="op" id="4006369">,</span>&nbsp;<span class="ident" id="4006371">y</span><span class="op" id="4006372">,</span>&nbsp;<span class="ident" id="4006374">m</span>&nbsp;<span class="ident" id="4006376">nat</span><span class="op" id="4006379">)</span>&nbsp;<span class="ident" id="4006381">nat</span>&nbsp;<span class="op" id="4006385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4006388">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4006458">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006489">var</span>&nbsp;<span class="ident" id="4006493">zz</span><span class="op" id="4006495">,</span>&nbsp;<span class="ident" id="4006497">r</span>&nbsp;<span class="ident" id="4006499">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006505">const</span>&nbsp;<span class="ident" id="4006511">n</span>&nbsp;<span class="op" id="4006513">=</span>&nbsp;<span class="num" id="4006515">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4006518">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006546">var</span>&nbsp;<span class="ident" id="4006550">powers</span>&nbsp;<span class="op" id="4006557">[</span><span class="num" id="4006558">1</span>&nbsp;<span class="op" id="4006560">&lt;&lt;</span>&nbsp;<span class="ident" id="4006563">n</span><span class="op" id="4006564">]</span><span class="ident" id="4006565">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006570">powers</span><span class="op" id="4006576">[</span><span class="num" id="4006577">0</span><span class="op" id="4006578">]</span>&nbsp;<span class="op" id="4006580">=</span>&nbsp;<span class="ident" id="4006582">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006590">powers</span><span class="op" id="4006596">[</span><span class="num" id="4006597">1</span><span class="op" id="4006598">]</span>&nbsp;<span class="op" id="4006600">=</span>&nbsp;<span class="ident" id="4006602">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006605">for</span>&nbsp;<span class="ident" id="4006609">i</span>&nbsp;<span class="op" id="4006611">:=</span>&nbsp;<span class="num" id="4006614">2</span><span class="op" id="4006615">;</span>&nbsp;<span class="ident" id="4006617">i</span>&nbsp;<span class="op" id="4006619">&lt;</span>&nbsp;<span class="num" id="4006621">1</span><span class="op" id="4006622">&lt;&lt;</span><span class="ident" id="4006624">n</span><span class="op" id="4006625">;</span>&nbsp;<span class="ident" id="4006627">i</span>&nbsp;<span class="op" id="4006629">+=</span>&nbsp;<span class="num" id="4006632">2</span>&nbsp;<span class="op" id="4006634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006638">p2</span><span class="op" id="4006640">,</span>&nbsp;<span class="ident" id="4006642">p</span><span class="op" id="4006643">,</span>&nbsp;<span class="ident" id="4006645">p1</span>&nbsp;<span class="op" id="4006648">:=</span>&nbsp;<span class="op" id="4006651">&amp;</span><span class="ident" id="4006652">powers</span><span class="op" id="4006658">[</span><span class="ident" id="4006659">i</span><span class="op" id="4006660">/</span><span class="num" id="4006661">2</span><span class="op" id="4006662">]</span><span class="op" id="4006663">,</span>&nbsp;<span class="op" id="4006665">&amp;</span><span class="ident" id="4006666">powers</span><span class="op" id="4006672">[</span><span class="ident" id="4006673">i</span><span class="op" id="4006674">]</span><span class="op" id="4006675">,</span>&nbsp;<span class="op" id="4006677">&amp;</span><span class="ident" id="4006678">powers</span><span class="op" id="4006684">[</span><span class="ident" id="4006685">i</span><span class="op" id="4006686">+</span><span class="num" id="4006687">1</span><span class="op" id="4006688">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006692">*</span><span class="ident" id="4006693">p</span>&nbsp;<span class="op" id="4006695">=</span>&nbsp;<span class="ident" id="4006697">p</span><span class="op" id="4006698">.</span><span class="ident" id="4006699">mul</span><span class="op" id="4006702">(</span><span class="op" id="4006703">*</span><span class="ident" id="4006704">p2</span><span class="op" id="4006706">,</span>&nbsp;<span class="op" id="4006708">*</span><span class="ident" id="4006709">p2</span><span class="op" id="4006711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006715">zz</span><span class="op" id="4006717">,</span>&nbsp;<span class="ident" id="4006719">r</span>&nbsp;<span class="op" id="4006721">=</span>&nbsp;<span class="ident" id="4006723">zz</span><span class="op" id="4006725">.</span><span class="ident" id="4006726">div</span><span class="op" id="4006729">(</span><span class="ident" id="4006730">r</span><span class="op" id="4006731">,</span>&nbsp;<span class="op" id="4006733">*</span><span class="ident" id="4006734">p</span><span class="op" id="4006735">,</span>&nbsp;<span class="ident" id="4006737">m</span><span class="op" id="4006738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006742">*</span><span class="ident" id="4006743">p</span><span class="op" id="4006744">,</span>&nbsp;<span class="ident" id="4006746">r</span>&nbsp;<span class="op" id="4006748">=</span>&nbsp;<span class="ident" id="4006750">r</span><span class="op" id="4006751">,</span>&nbsp;<span class="op" id="4006753">*</span><span class="ident" id="4006754">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006758">*</span><span class="ident" id="4006759">p1</span>&nbsp;<span class="op" id="4006762">=</span>&nbsp;<span class="ident" id="4006764">p1</span><span class="op" id="4006766">.</span><span class="ident" id="4006767">mul</span><span class="op" id="4006770">(</span><span class="op" id="4006771">*</span><span class="ident" id="4006772">p</span><span class="op" id="4006773">,</span>&nbsp;<span class="ident" id="4006775">x</span><span class="op" id="4006776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006780">zz</span><span class="op" id="4006782">,</span>&nbsp;<span class="ident" id="4006784">r</span>&nbsp;<span class="op" id="4006786">=</span>&nbsp;<span class="ident" id="4006788">zz</span><span class="op" id="4006790">.</span><span class="ident" id="4006791">div</span><span class="op" id="4006794">(</span><span class="ident" id="4006795">r</span><span class="op" id="4006796">,</span>&nbsp;<span class="op" id="4006798">*</span><span class="ident" id="4006799">p1</span><span class="op" id="4006801">,</span>&nbsp;<span class="ident" id="4006803">m</span><span class="op" id="4006804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006808">*</span><span class="ident" id="4006809">p1</span><span class="op" id="4006811">,</span>&nbsp;<span class="ident" id="4006813">r</span>&nbsp;<span class="op" id="4006815">=</span>&nbsp;<span class="ident" id="4006817">r</span><span class="op" id="4006818">,</span>&nbsp;<span class="op" id="4006820">*</span><span class="ident" id="4006821">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4006825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006829">z</span>&nbsp;<span class="op" id="4006831">=</span>&nbsp;<span class="ident" id="4006833">z</span><span class="op" id="4006834">.</span><span class="ident" id="4006835">setWord</span><span class="op" id="4006842">(</span><span class="num" id="4006843">1</span><span class="op" id="4006844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006848">for</span>&nbsp;<span class="ident" id="4006852">i</span>&nbsp;<span class="op" id="4006854">:=</span>&nbsp;<span class="builtinfunc" id="4006857">len</span><span class="op" id="4006860">(</span><span class="ident" id="4006861">y</span><span class="op" id="4006862">)</span>&nbsp;<span class="op" id="4006864">-</span>&nbsp;<span class="num" id="4006866">1</span><span class="op" id="4006867">;</span>&nbsp;<span class="ident" id="4006869">i</span>&nbsp;<span class="op" id="4006871">&gt;=</span>&nbsp;<span class="num" id="4006874">0</span><span class="op" id="4006875">;</span>&nbsp;<span class="ident" id="4006877">i</span><span class="op" id="4006878">--</span>&nbsp;<span class="op" id="4006881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006885">yi</span>&nbsp;<span class="op" id="4006888">:=</span>&nbsp;<span class="ident" id="4006891">y</span><span class="op" id="4006892">[</span><span class="ident" id="4006893">i</span><span class="op" id="4006894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006898">for</span>&nbsp;<span class="ident" id="4006902">j</span>&nbsp;<span class="op" id="4006904">:=</span>&nbsp;<span class="num" id="4006907">0</span><span class="op" id="4006908">;</span>&nbsp;<span class="ident" id="4006910">j</span>&nbsp;<span class="op" id="4006912">&lt;</span>&nbsp;<span class="ident" id="4006914">_W</span><span class="op" id="4006916">;</span>&nbsp;<span class="ident" id="4006918">j</span>&nbsp;<span class="op" id="4006920">+=</span>&nbsp;<span class="ident" id="4006923">n</span>&nbsp;<span class="op" id="4006925">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006930">if</span>&nbsp;<span class="ident" id="4006933">i</span>&nbsp;<span class="op" id="4006935">!=</span>&nbsp;<span class="builtinfunc" id="4006938">len</span><span class="op" id="4006941">(</span><span class="ident" id="4006942">y</span><span class="op" id="4006943">)</span><span class="op" id="4006944">-</span><span class="num" id="4006945">1</span>&nbsp;<span class="op" id="4006947">||</span>&nbsp;<span class="ident" id="4006950">j</span>&nbsp;<span class="op" id="4006952">!=</span>&nbsp;<span class="num" id="4006955">0</span>&nbsp;<span class="op" id="4006957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4006963">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4007012">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4007064">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007115">zz</span>&nbsp;<span class="op" id="4007118">=</span>&nbsp;<span class="ident" id="4007120">zz</span><span class="op" id="4007122">.</span><span class="ident" id="4007123">mul</span><span class="op" id="4007126">(</span><span class="ident" id="4007127">z</span><span class="op" id="4007128">,</span>&nbsp;<span class="ident" id="4007130">z</span><span class="op" id="4007131">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007137">zz</span><span class="op" id="4007139">,</span>&nbsp;<span class="ident" id="4007141">z</span>&nbsp;<span class="op" id="4007143">=</span>&nbsp;<span class="ident" id="4007145">z</span><span class="op" id="4007146">,</span>&nbsp;<span class="ident" id="4007148">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007155">zz</span><span class="op" id="4007157">,</span>&nbsp;<span class="ident" id="4007159">r</span>&nbsp;<span class="op" id="4007161">=</span>&nbsp;<span class="ident" id="4007163">zz</span><span class="op" id="4007165">.</span><span class="ident" id="4007166">div</span><span class="op" id="4007169">(</span><span class="ident" id="4007170">r</span><span class="op" id="4007171">,</span>&nbsp;<span class="ident" id="4007173">z</span><span class="op" id="4007174">,</span>&nbsp;<span class="ident" id="4007176">m</span><span class="op" id="4007177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007183">z</span><span class="op" id="4007184">,</span>&nbsp;<span class="ident" id="4007186">r</span>&nbsp;<span class="op" id="4007188">=</span>&nbsp;<span class="ident" id="4007190">r</span><span class="op" id="4007191">,</span>&nbsp;<span class="ident" id="4007193">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007200">zz</span>&nbsp;<span class="op" id="4007203">=</span>&nbsp;<span class="ident" id="4007205">zz</span><span class="op" id="4007207">.</span><span class="ident" id="4007208">mul</span><span class="op" id="4007211">(</span><span class="ident" id="4007212">z</span><span class="op" id="4007213">,</span>&nbsp;<span class="ident" id="4007215">z</span><span class="op" id="4007216">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007222">zz</span><span class="op" id="4007224">,</span>&nbsp;<span class="ident" id="4007226">z</span>&nbsp;<span class="op" id="4007228">=</span>&nbsp;<span class="ident" id="4007230">z</span><span class="op" id="4007231">,</span>&nbsp;<span class="ident" id="4007233">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007240">zz</span><span class="op" id="4007242">,</span>&nbsp;<span class="ident" id="4007244">r</span>&nbsp;<span class="op" id="4007246">=</span>&nbsp;<span class="ident" id="4007248">zz</span><span class="op" id="4007250">.</span><span class="ident" id="4007251">div</span><span class="op" id="4007254">(</span><span class="ident" id="4007255">r</span><span class="op" id="4007256">,</span>&nbsp;<span class="ident" id="4007258">z</span><span class="op" id="4007259">,</span>&nbsp;<span class="ident" id="4007261">m</span><span class="op" id="4007262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007268">z</span><span class="op" id="4007269">,</span>&nbsp;<span class="ident" id="4007271">r</span>&nbsp;<span class="op" id="4007273">=</span>&nbsp;<span class="ident" id="4007275">r</span><span class="op" id="4007276">,</span>&nbsp;<span class="ident" id="4007278">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007285">zz</span>&nbsp;<span class="op" id="4007288">=</span>&nbsp;<span class="ident" id="4007290">zz</span><span class="op" id="4007292">.</span><span class="ident" id="4007293">mul</span><span class="op" id="4007296">(</span><span class="ident" id="4007297">z</span><span class="op" id="4007298">,</span>&nbsp;<span class="ident" id="4007300">z</span><span class="op" id="4007301">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007307">zz</span><span class="op" id="4007309">,</span>&nbsp;<span class="ident" id="4007311">z</span>&nbsp;<span class="op" id="4007313">=</span>&nbsp;<span class="ident" id="4007315">z</span><span class="op" id="4007316">,</span>&nbsp;<span class="ident" id="4007318">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007325">zz</span><span class="op" id="4007327">,</span>&nbsp;<span class="ident" id="4007329">r</span>&nbsp;<span class="op" id="4007331">=</span>&nbsp;<span class="ident" id="4007333">zz</span><span class="op" id="4007335">.</span><span class="ident" id="4007336">div</span><span class="op" id="4007339">(</span><span class="ident" id="4007340">r</span><span class="op" id="4007341">,</span>&nbsp;<span class="ident" id="4007343">z</span><span class="op" id="4007344">,</span>&nbsp;<span class="ident" id="4007346">m</span><span class="op" id="4007347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007353">z</span><span class="op" id="4007354">,</span>&nbsp;<span class="ident" id="4007356">r</span>&nbsp;<span class="op" id="4007358">=</span>&nbsp;<span class="ident" id="4007360">r</span><span class="op" id="4007361">,</span>&nbsp;<span class="ident" id="4007363">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007370">zz</span>&nbsp;<span class="op" id="4007373">=</span>&nbsp;<span class="ident" id="4007375">zz</span><span class="op" id="4007377">.</span><span class="ident" id="4007378">mul</span><span class="op" id="4007381">(</span><span class="ident" id="4007382">z</span><span class="op" id="4007383">,</span>&nbsp;<span class="ident" id="4007385">z</span><span class="op" id="4007386">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007392">zz</span><span class="op" id="4007394">,</span>&nbsp;<span class="ident" id="4007396">z</span>&nbsp;<span class="op" id="4007398">=</span>&nbsp;<span class="ident" id="4007400">z</span><span class="op" id="4007401">,</span>&nbsp;<span class="ident" id="4007403">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007410">zz</span><span class="op" id="4007412">,</span>&nbsp;<span class="ident" id="4007414">r</span>&nbsp;<span class="op" id="4007416">=</span>&nbsp;<span class="ident" id="4007418">zz</span><span class="op" id="4007420">.</span><span class="ident" id="4007421">div</span><span class="op" id="4007424">(</span><span class="ident" id="4007425">r</span><span class="op" id="4007426">,</span>&nbsp;<span class="ident" id="4007428">z</span><span class="op" id="4007429">,</span>&nbsp;<span class="ident" id="4007431">m</span><span class="op" id="4007432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007438">z</span><span class="op" id="4007439">,</span>&nbsp;<span class="ident" id="4007441">r</span>&nbsp;<span class="op" id="4007443">=</span>&nbsp;<span class="ident" id="4007445">r</span><span class="op" id="4007446">,</span>&nbsp;<span class="ident" id="4007448">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007459">zz</span>&nbsp;<span class="op" id="4007462">=</span>&nbsp;<span class="ident" id="4007464">zz</span><span class="op" id="4007466">.</span><span class="ident" id="4007467">mul</span><span class="op" id="4007470">(</span><span class="ident" id="4007471">z</span><span class="op" id="4007472">,</span>&nbsp;<span class="ident" id="4007474">powers</span><span class="op" id="4007480">[</span><span class="ident" id="4007481">yi</span><span class="op" id="4007483">&gt;&gt;</span><span class="op" id="4007485">(</span><span class="ident" id="4007486">_W</span><span class="op" id="4007488">-</span><span class="ident" id="4007489">n</span><span class="op" id="4007490">)</span><span class="op" id="4007491">]</span><span class="op" id="4007492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007497">zz</span><span class="op" id="4007499">,</span>&nbsp;<span class="ident" id="4007501">z</span>&nbsp;<span class="op" id="4007503">=</span>&nbsp;<span class="ident" id="4007505">z</span><span class="op" id="4007506">,</span>&nbsp;<span class="ident" id="4007508">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007514">zz</span><span class="op" id="4007516">,</span>&nbsp;<span class="ident" id="4007518">r</span>&nbsp;<span class="op" id="4007520">=</span>&nbsp;<span class="ident" id="4007522">zz</span><span class="op" id="4007524">.</span><span class="ident" id="4007525">div</span><span class="op" id="4007528">(</span><span class="ident" id="4007529">r</span><span class="op" id="4007530">,</span>&nbsp;<span class="ident" id="4007532">z</span><span class="op" id="4007533">,</span>&nbsp;<span class="ident" id="4007535">m</span><span class="op" id="4007536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007541">z</span><span class="op" id="4007542">,</span>&nbsp;<span class="ident" id="4007544">r</span>&nbsp;<span class="op" id="4007546">=</span>&nbsp;<span class="ident" id="4007548">r</span><span class="op" id="4007549">,</span>&nbsp;<span class="ident" id="4007551">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007557">yi</span>&nbsp;<span class="op" id="4007560">&lt;&lt;=</span>&nbsp;<span class="ident" id="4007564">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007575">return</span>&nbsp;<span class="ident" id="4007582">z</span><span class="op" id="4007583">.</span><span class="ident" id="4007584">norm</span><span class="op" id="4007588">(</span><span class="op" id="4007589">)</span><br>
<span class="lineno">1380</span><span class="op" id="4007591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4007594">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="4007673">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="4007738">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="4007778">func</span>&nbsp;<span class="op" id="4007783">(</span><span class="ident" id="4007784">n</span>&nbsp;<span class="ident" id="4007786">nat</span><span class="op" id="4007789">)</span>&nbsp;<span class="ident" id="4007791">probablyPrime</span><span class="op" id="4007804">(</span><span class="ident" id="4007805">reps</span>&nbsp;<span class="builtintype" id="4007810">int</span><span class="op" id="4007813">)</span>&nbsp;<span class="builtintype" id="4007815">bool</span>&nbsp;<span class="op" id="4007820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007823">if</span>&nbsp;<span class="builtinfunc" id="4007826">len</span><span class="op" id="4007829">(</span><span class="ident" id="4007830">n</span><span class="op" id="4007831">)</span>&nbsp;<span class="op" id="4007833">==</span>&nbsp;<span class="num" id="4007836">0</span>&nbsp;<span class="op" id="4007838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007842">return</span>&nbsp;<span class="builtintype" id="4007849">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007860">if</span>&nbsp;<span class="builtinfunc" id="4007863">len</span><span class="op" id="4007866">(</span><span class="ident" id="4007867">n</span><span class="op" id="4007868">)</span>&nbsp;<span class="op" id="4007870">==</span>&nbsp;<span class="num" id="4007873">1</span>&nbsp;<span class="op" id="4007875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007879">if</span>&nbsp;<span class="ident" id="4007882">n</span><span class="op" id="4007883">[</span><span class="num" id="4007884">0</span><span class="op" id="4007885">]</span>&nbsp;<span class="op" id="4007887">&lt;</span>&nbsp;<span class="num" id="4007889">2</span>&nbsp;<span class="op" id="4007891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007896">return</span>&nbsp;<span class="builtintype" id="4007903">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007916">if</span>&nbsp;<span class="ident" id="4007919">n</span><span class="op" id="4007920">[</span><span class="num" id="4007921">0</span><span class="op" id="4007922">]</span><span class="op" id="4007923">%</span><span class="num" id="4007924">2</span>&nbsp;<span class="op" id="4007926">==</span>&nbsp;<span class="num" id="4007929">0</span>&nbsp;<span class="op" id="4007931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007936">return</span>&nbsp;<span class="ident" id="4007943">n</span><span class="op" id="4007944">[</span><span class="num" id="4007945">0</span><span class="op" id="4007946">]</span>&nbsp;<span class="op" id="4007948">==</span>&nbsp;<span class="num" id="4007951">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4007960">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008018">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008057">switch</span>&nbsp;<span class="ident" id="4008064">n</span><span class="op" id="4008065">[</span><span class="num" id="4008066">0</span><span class="op" id="4008067">]</span>&nbsp;<span class="op" id="4008069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008073">case</span>&nbsp;<span class="num" id="4008078">3</span><span class="op" id="4008079">,</span>&nbsp;<span class="num" id="4008081">5</span><span class="op" id="4008082">,</span>&nbsp;<span class="num" id="4008084">7</span><span class="op" id="4008085">,</span>&nbsp;<span class="num" id="4008087">11</span><span class="op" id="4008089">,</span>&nbsp;<span class="num" id="4008091">13</span><span class="op" id="4008093">,</span>&nbsp;<span class="num" id="4008095">17</span><span class="op" id="4008097">,</span>&nbsp;<span class="num" id="4008099">19</span><span class="op" id="4008101">,</span>&nbsp;<span class="num" id="4008103">23</span><span class="op" id="4008105">,</span>&nbsp;<span class="num" id="4008107">29</span><span class="op" id="4008109">,</span>&nbsp;<span class="num" id="4008111">31</span><span class="op" id="4008113">,</span>&nbsp;<span class="num" id="4008115">37</span><span class="op" id="4008117">,</span>&nbsp;<span class="num" id="4008119">41</span><span class="op" id="4008121">,</span>&nbsp;<span class="num" id="4008123">43</span><span class="op" id="4008125">,</span>&nbsp;<span class="num" id="4008127">47</span><span class="op" id="4008129">,</span>&nbsp;<span class="num" id="4008131">53</span><span class="op" id="4008133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008138">return</span>&nbsp;<span class="builtintype" id="4008145">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008152">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008159">const</span>&nbsp;<span class="ident" id="4008165">primesProduct32</span>&nbsp;<span class="op" id="4008181">=</span>&nbsp;<span class="num" id="4008183">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4008202">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008237">const</span>&nbsp;<span class="ident" id="4008243">primesProduct64</span>&nbsp;<span class="op" id="4008259">=</span>&nbsp;<span class="num" id="4008261">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="4008280">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008316">var</span>&nbsp;<span class="ident" id="4008320">r</span>&nbsp;<span class="ident" id="4008322">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008328">switch</span>&nbsp;<span class="ident" id="4008335">_W</span>&nbsp;<span class="op" id="4008338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008341">case</span>&nbsp;<span class="num" id="4008346">32</span><span class="op" id="4008348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008352">r</span>&nbsp;<span class="op" id="4008354">=</span>&nbsp;<span class="ident" id="4008356">n</span><span class="op" id="4008357">.</span><span class="ident" id="4008358">modW</span><span class="op" id="4008362">(</span><span class="ident" id="4008363">primesProduct32</span><span class="op" id="4008378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008381">case</span>&nbsp;<span class="num" id="4008386">64</span><span class="op" id="4008388">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008392">r</span>&nbsp;<span class="op" id="4008394">=</span>&nbsp;<span class="ident" id="4008396">n</span><span class="op" id="4008397">.</span><span class="ident" id="4008398">modW</span><span class="op" id="4008402">(</span><span class="ident" id="4008403">primesProduct64</span>&nbsp;<span class="op" id="4008419">&amp;</span>&nbsp;<span class="ident" id="4008421">_M</span><span class="op" id="4008423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008426">default</span><span class="op" id="4008433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4008437">panic</span><span class="op" id="4008442">(</span><span class="string" id="4008443">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4008462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008469">if</span>&nbsp;<span class="ident" id="4008472">r</span><span class="op" id="4008473">%</span><span class="num" id="4008474">3</span>&nbsp;<span class="op" id="4008476">==</span>&nbsp;<span class="num" id="4008479">0</span>&nbsp;<span class="op" id="4008481">||</span>&nbsp;<span class="ident" id="4008484">r</span><span class="op" id="4008485">%</span><span class="num" id="4008486">5</span>&nbsp;<span class="op" id="4008488">==</span>&nbsp;<span class="num" id="4008491">0</span>&nbsp;<span class="op" id="4008493">||</span>&nbsp;<span class="ident" id="4008496">r</span><span class="op" id="4008497">%</span><span class="num" id="4008498">7</span>&nbsp;<span class="op" id="4008500">==</span>&nbsp;<span class="num" id="4008503">0</span>&nbsp;<span class="op" id="4008505">||</span>&nbsp;<span class="ident" id="4008508">r</span><span class="op" id="4008509">%</span><span class="num" id="4008510">11</span>&nbsp;<span class="op" id="4008513">==</span>&nbsp;<span class="num" id="4008516">0</span>&nbsp;<span class="op" id="4008518">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008523">r</span><span class="op" id="4008524">%</span><span class="num" id="4008525">13</span>&nbsp;<span class="op" id="4008528">==</span>&nbsp;<span class="num" id="4008531">0</span>&nbsp;<span class="op" id="4008533">||</span>&nbsp;<span class="ident" id="4008536">r</span><span class="op" id="4008537">%</span><span class="num" id="4008538">17</span>&nbsp;<span class="op" id="4008541">==</span>&nbsp;<span class="num" id="4008544">0</span>&nbsp;<span class="op" id="4008546">||</span>&nbsp;<span class="ident" id="4008549">r</span><span class="op" id="4008550">%</span><span class="num" id="4008551">19</span>&nbsp;<span class="op" id="4008554">==</span>&nbsp;<span class="num" id="4008557">0</span>&nbsp;<span class="op" id="4008559">||</span>&nbsp;<span class="ident" id="4008562">r</span><span class="op" id="4008563">%</span><span class="num" id="4008564">23</span>&nbsp;<span class="op" id="4008567">==</span>&nbsp;<span class="num" id="4008570">0</span>&nbsp;<span class="op" id="4008572">||</span>&nbsp;<span class="ident" id="4008575">r</span><span class="op" id="4008576">%</span><span class="num" id="4008577">29</span>&nbsp;<span class="op" id="4008580">==</span>&nbsp;<span class="num" id="4008583">0</span>&nbsp;<span class="op" id="4008585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008589">return</span>&nbsp;<span class="builtintype" id="4008596">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008607">if</span>&nbsp;<span class="ident" id="4008610">_W</span>&nbsp;<span class="op" id="4008613">==</span>&nbsp;<span class="num" id="4008616">64</span>&nbsp;<span class="op" id="4008619">&amp;&amp;</span>&nbsp;<span class="op" id="4008622">(</span><span class="ident" id="4008623">r</span><span class="op" id="4008624">%</span><span class="num" id="4008625">31</span>&nbsp;<span class="op" id="4008628">==</span>&nbsp;<span class="num" id="4008631">0</span>&nbsp;<span class="op" id="4008633">||</span>&nbsp;<span class="ident" id="4008636">r</span><span class="op" id="4008637">%</span><span class="num" id="4008638">37</span>&nbsp;<span class="op" id="4008641">==</span>&nbsp;<span class="num" id="4008644">0</span>&nbsp;<span class="op" id="4008646">||</span>&nbsp;<span class="ident" id="4008649">r</span><span class="op" id="4008650">%</span><span class="num" id="4008651">41</span>&nbsp;<span class="op" id="4008654">==</span>&nbsp;<span class="num" id="4008657">0</span>&nbsp;<span class="op" id="4008659">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008664">r</span><span class="op" id="4008665">%</span><span class="num" id="4008666">43</span>&nbsp;<span class="op" id="4008669">==</span>&nbsp;<span class="num" id="4008672">0</span>&nbsp;<span class="op" id="4008674">||</span>&nbsp;<span class="ident" id="4008677">r</span><span class="op" id="4008678">%</span><span class="num" id="4008679">47</span>&nbsp;<span class="op" id="4008682">==</span>&nbsp;<span class="num" id="4008685">0</span>&nbsp;<span class="op" id="4008687">||</span>&nbsp;<span class="ident" id="4008690">r</span><span class="op" id="4008691">%</span><span class="num" id="4008692">53</span>&nbsp;<span class="op" id="4008695">==</span>&nbsp;<span class="num" id="4008698">0</span><span class="op" id="4008699">)</span>&nbsp;<span class="op" id="4008701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008705">return</span>&nbsp;<span class="builtintype" id="4008712">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008723">nm1</span>&nbsp;<span class="op" id="4008727">:=</span>&nbsp;<span class="ident" id="4008730">nat</span><span class="op" id="4008733">(</span><span class="ident" id="4008734">nil</span><span class="op" id="4008737">)</span><span class="op" id="4008738">.</span><span class="ident" id="4008739">sub</span><span class="op" id="4008742">(</span><span class="ident" id="4008743">n</span><span class="op" id="4008744">,</span>&nbsp;<span class="ident" id="4008746">natOne</span><span class="op" id="4008752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008755">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008797">k</span>&nbsp;<span class="op" id="4008799">:=</span>&nbsp;<span class="ident" id="4008802">nm1</span><span class="op" id="4008805">.</span><span class="ident" id="4008806">trailingZeroBits</span><span class="op" id="4008822">(</span><span class="op" id="4008823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008826">q</span>&nbsp;<span class="op" id="4008828">:=</span>&nbsp;<span class="ident" id="4008831">nat</span><span class="op" id="4008834">(</span><span class="ident" id="4008835">nil</span><span class="op" id="4008838">)</span><span class="op" id="4008839">.</span><span class="ident" id="4008840">shr</span><span class="op" id="4008843">(</span><span class="ident" id="4008844">nm1</span><span class="op" id="4008847">,</span>&nbsp;<span class="ident" id="4008849">k</span><span class="op" id="4008850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008854">nm3</span>&nbsp;<span class="op" id="4008858">:=</span>&nbsp;<span class="ident" id="4008861">nat</span><span class="op" id="4008864">(</span><span class="ident" id="4008865">nil</span><span class="op" id="4008868">)</span><span class="op" id="4008869">.</span><span class="ident" id="4008870">sub</span><span class="op" id="4008873">(</span><span class="ident" id="4008874">nm1</span><span class="op" id="4008877">,</span>&nbsp;<span class="ident" id="4008879">natTwo</span><span class="op" id="4008885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008888">rand</span>&nbsp;<span class="op" id="4008893">:=</span>&nbsp;<span class="ident" id="4008896">rand</span><span class="op" id="4008900">.</span><span class="ident" id="4008901">New</span><span class="op" id="4008904">(</span><span class="ident" id="4008905">rand</span><span class="op" id="4008909">.</span><span class="ident" id="4008910">NewSource</span><span class="op" id="4008919">(</span><span class="ident" id="4008920">int64</span><span class="op" id="4008925">(</span><span class="ident" id="4008926">n</span><span class="op" id="4008927">[</span><span class="num" id="4008928">0</span><span class="op" id="4008929">]</span><span class="op" id="4008930">)</span><span class="op" id="4008931">)</span><span class="op" id="4008932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008936">var</span>&nbsp;<span class="ident" id="4008940">x</span><span class="op" id="4008941">,</span>&nbsp;<span class="ident" id="4008943">y</span><span class="op" id="4008944">,</span>&nbsp;<span class="ident" id="4008946">quotient</span>&nbsp;<span class="ident" id="4008955">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008960">nm3Len</span>&nbsp;<span class="op" id="4008967">:=</span>&nbsp;<span class="ident" id="4008970">nm3</span><span class="op" id="4008973">.</span><span class="ident" id="4008974">bitLen</span><span class="op" id="4008980">(</span><span class="op" id="4008981">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="4008984">NextRandom</span><span class="op" id="4008994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008997">for</span>&nbsp;<span class="ident" id="4009001">i</span>&nbsp;<span class="op" id="4009003">:=</span>&nbsp;<span class="num" id="4009006">0</span><span class="op" id="4009007">;</span>&nbsp;<span class="ident" id="4009009">i</span>&nbsp;<span class="op" id="4009011">&lt;</span>&nbsp;<span class="ident" id="4009013">reps</span><span class="op" id="4009017">;</span>&nbsp;<span class="ident" id="4009019">i</span><span class="op" id="4009020">++</span>&nbsp;<span class="op" id="4009023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009027">x</span>&nbsp;<span class="op" id="4009029">=</span>&nbsp;<span class="ident" id="4009031">x</span><span class="op" id="4009032">.</span><span class="ident" id="4009033">random</span><span class="op" id="4009039">(</span><span class="ident" id="4009040">rand</span><span class="op" id="4009044">,</span>&nbsp;<span class="ident" id="4009046">nm3</span><span class="op" id="4009049">,</span>&nbsp;<span class="ident" id="4009051">nm3Len</span><span class="op" id="4009057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009061">x</span>&nbsp;<span class="op" id="4009063">=</span>&nbsp;<span class="ident" id="4009065">x</span><span class="op" id="4009066">.</span><span class="ident" id="4009067">add</span><span class="op" id="4009070">(</span><span class="ident" id="4009071">x</span><span class="op" id="4009072">,</span>&nbsp;<span class="ident" id="4009074">natTwo</span><span class="op" id="4009080">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009084">y</span>&nbsp;<span class="op" id="4009086">=</span>&nbsp;<span class="ident" id="4009088">y</span><span class="op" id="4009089">.</span><span class="ident" id="4009090">expNN</span><span class="op" id="4009095">(</span><span class="ident" id="4009096">x</span><span class="op" id="4009097">,</span>&nbsp;<span class="ident" id="4009099">q</span><span class="op" id="4009100">,</span>&nbsp;<span class="ident" id="4009102">n</span><span class="op" id="4009103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009107">if</span>&nbsp;<span class="ident" id="4009110">y</span><span class="op" id="4009111">.</span><span class="ident" id="4009112">cmp</span><span class="op" id="4009115">(</span><span class="ident" id="4009116">natOne</span><span class="op" id="4009122">)</span>&nbsp;<span class="op" id="4009124">==</span>&nbsp;<span class="num" id="4009127">0</span>&nbsp;<span class="op" id="4009129">||</span>&nbsp;<span class="ident" id="4009132">y</span><span class="op" id="4009133">.</span><span class="ident" id="4009134">cmp</span><span class="op" id="4009137">(</span><span class="ident" id="4009138">nm1</span><span class="op" id="4009141">)</span>&nbsp;<span class="op" id="4009143">==</span>&nbsp;<span class="num" id="4009146">0</span>&nbsp;<span class="op" id="4009148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009153">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009168">for</span>&nbsp;<span class="ident" id="4009172">j</span>&nbsp;<span class="op" id="4009174">:=</span>&nbsp;<span class="builtintype" id="4009177">uint</span><span class="op" id="4009181">(</span><span class="num" id="4009182">1</span><span class="op" id="4009183">)</span><span class="op" id="4009184">;</span>&nbsp;<span class="ident" id="4009186">j</span>&nbsp;<span class="op" id="4009188">&lt;</span>&nbsp;<span class="ident" id="4009190">k</span><span class="op" id="4009191">;</span>&nbsp;<span class="ident" id="4009193">j</span><span class="op" id="4009194">++</span>&nbsp;<span class="op" id="4009197">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009202">y</span>&nbsp;<span class="op" id="4009204">=</span>&nbsp;<span class="ident" id="4009206">y</span><span class="op" id="4009207">.</span><span class="ident" id="4009208">mul</span><span class="op" id="4009211">(</span><span class="ident" id="4009212">y</span><span class="op" id="4009213">,</span>&nbsp;<span class="ident" id="4009215">y</span><span class="op" id="4009216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009221">quotient</span><span class="op" id="4009229">,</span>&nbsp;<span class="ident" id="4009231">y</span>&nbsp;<span class="op" id="4009233">=</span>&nbsp;<span class="ident" id="4009235">quotient</span><span class="op" id="4009243">.</span><span class="ident" id="4009244">div</span><span class="op" id="4009247">(</span><span class="ident" id="4009248">y</span><span class="op" id="4009249">,</span>&nbsp;<span class="ident" id="4009251">y</span><span class="op" id="4009252">,</span>&nbsp;<span class="ident" id="4009254">n</span><span class="op" id="4009255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009260">if</span>&nbsp;<span class="ident" id="4009263">y</span><span class="op" id="4009264">.</span><span class="ident" id="4009265">cmp</span><span class="op" id="4009268">(</span><span class="ident" id="4009269">nm1</span><span class="op" id="4009272">)</span>&nbsp;<span class="op" id="4009274">==</span>&nbsp;<span class="num" id="4009277">0</span>&nbsp;<span class="op" id="4009279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009285">continue</span>&nbsp;<span class="ident" id="4009294">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009308">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009313">if</span>&nbsp;<span class="ident" id="4009316">y</span><span class="op" id="4009317">.</span><span class="ident" id="4009318">cmp</span><span class="op" id="4009321">(</span><span class="ident" id="4009322">natOne</span><span class="op" id="4009328">)</span>&nbsp;<span class="op" id="4009330">==</span>&nbsp;<span class="num" id="4009333">0</span>&nbsp;<span class="op" id="4009335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009341">return</span>&nbsp;<span class="builtintype" id="4009348">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009365">return</span>&nbsp;<span class="builtintype" id="4009372">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009383">return</span>&nbsp;<span class="builtintype" id="4009390">true</span><br>
<span class="lineno"></span><span class="op" id="4009395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="4009398">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4009465">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4009532">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4009599">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="4009629">func</span>&nbsp;<span class="op" id="4009634">(</span><span class="ident" id="4009635">z</span>&nbsp;<span class="ident" id="4009637">nat</span><span class="op" id="4009640">)</span>&nbsp;<span class="ident" id="4009642">bytes</span><span class="op" id="4009647">(</span><span class="ident" id="4009648">buf</span>&nbsp;<span class="op" id="4009652">[</span><span class="op" id="4009653">]</span><span class="builtintype" id="4009654">byte</span><span class="op" id="4009658">)</span>&nbsp;<span class="op" id="4009660">(</span><span class="ident" id="4009661">i</span>&nbsp;<span class="builtintype" id="4009663">int</span><span class="op" id="4009666">)</span>&nbsp;<span class="op" id="4009668">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009671">i</span>&nbsp;<span class="op" id="4009673">=</span>&nbsp;<span class="builtinfunc" id="4009675">len</span><span class="op" id="4009678">(</span><span class="ident" id="4009679">buf</span><span class="op" id="4009682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009685">for</span>&nbsp;<span class="ident" id="4009689">_</span><span class="op" id="4009690">,</span>&nbsp;<span class="ident" id="4009692">d</span>&nbsp;<span class="op" id="4009694">:=</span>&nbsp;<span class="keyword" id="4009697">range</span>&nbsp;<span class="ident" id="4009703">z</span>&nbsp;<span class="op" id="4009705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009709">for</span>&nbsp;<span class="ident" id="4009713">j</span>&nbsp;<span class="op" id="4009715">:=</span>&nbsp;<span class="num" id="4009718">0</span><span class="op" id="4009719">;</span>&nbsp;<span class="ident" id="4009721">j</span>&nbsp;<span class="op" id="4009723">&lt;</span>&nbsp;<span class="ident" id="4009725">_S</span><span class="op" id="4009727">;</span>&nbsp;<span class="ident" id="4009729">j</span><span class="op" id="4009730">++</span>&nbsp;<span class="op" id="4009733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009738">i</span><span class="op" id="4009739">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009745">buf</span><span class="op" id="4009748">[</span><span class="ident" id="4009749">i</span><span class="op" id="4009750">]</span>&nbsp;<span class="op" id="4009752">=</span>&nbsp;<span class="builtintype" id="4009754">byte</span><span class="op" id="4009758">(</span><span class="ident" id="4009759">d</span><span class="op" id="4009760">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009765">d</span>&nbsp;<span class="op" id="4009767">&gt;&gt;=</span>&nbsp;<span class="num" id="4009771">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009782">for</span>&nbsp;<span class="ident" id="4009786">i</span>&nbsp;<span class="op" id="4009788">&lt;</span>&nbsp;<span class="builtinfunc" id="4009790">len</span><span class="op" id="4009793">(</span><span class="ident" id="4009794">buf</span><span class="op" id="4009797">)</span>&nbsp;<span class="op" id="4009799">&amp;&amp;</span>&nbsp;<span class="ident" id="4009802">buf</span><span class="op" id="4009805">[</span><span class="ident" id="4009806">i</span><span class="op" id="4009807">]</span>&nbsp;<span class="op" id="4009809">==</span>&nbsp;<span class="num" id="4009812">0</span>&nbsp;<span class="op" id="4009814">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009818">i</span><span class="op" id="4009819">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009827">return</span><br>
<span class="lineno"></span><span class="op" id="4009834">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="4009837">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="4009902">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4009951">func</span>&nbsp;<span class="op" id="4009956">(</span><span class="ident" id="4009957">z</span>&nbsp;<span class="ident" id="4009959">nat</span><span class="op" id="4009962">)</span>&nbsp;<span class="ident" id="4009964">setBytes</span><span class="op" id="4009972">(</span><span class="ident" id="4009973">buf</span>&nbsp;<span class="op" id="4009977">[</span><span class="op" id="4009978">]</span><span class="builtintype" id="4009979">byte</span><span class="op" id="4009983">)</span>&nbsp;<span class="ident" id="4009985">nat</span>&nbsp;<span class="op" id="4009989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009992">z</span>&nbsp;<span class="op" id="4009994">=</span>&nbsp;<span class="ident" id="4009996">z</span><span class="op" id="4009997">.</span><span class="builtinfunc" id="4009998">make</span><span class="op" id="4010002">(</span><span class="op" id="4010003">(</span><span class="builtinfunc" id="4010004">len</span><span class="op" id="4010007">(</span><span class="ident" id="4010008">buf</span><span class="op" id="4010011">)</span>&nbsp;<span class="op" id="4010013">+</span>&nbsp;<span class="ident" id="4010015">_S</span>&nbsp;<span class="op" id="4010018">-</span>&nbsp;<span class="num" id="4010020">1</span><span class="op" id="4010021">)</span>&nbsp;<span class="op" id="4010023">/</span>&nbsp;<span class="ident" id="4010025">_S</span><span class="op" id="4010027">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010031">k</span>&nbsp;<span class="op" id="4010033">:=</span>&nbsp;<span class="num" id="4010036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010039">s</span>&nbsp;<span class="op" id="4010041">:=</span>&nbsp;<span class="builtintype" id="4010044">uint</span><span class="op" id="4010048">(</span><span class="num" id="4010049">0</span><span class="op" id="4010050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010053">var</span>&nbsp;<span class="ident" id="4010057">d</span>&nbsp;<span class="ident" id="4010059">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010065">for</span>&nbsp;<span class="ident" id="4010069">i</span>&nbsp;<span class="op" id="4010071">:=</span>&nbsp;<span class="builtinfunc" id="4010074">len</span><span class="op" id="4010077">(</span><span class="ident" id="4010078">buf</span><span class="op" id="4010081">)</span><span class="op" id="4010082">;</span>&nbsp;<span class="ident" id="4010084">i</span>&nbsp;<span class="op" id="4010086">&gt;</span>&nbsp;<span class="num" id="4010088">0</span><span class="op" id="4010089">;</span>&nbsp;<span class="ident" id="4010091">i</span><span class="op" id="4010092">--</span>&nbsp;<span class="op" id="4010095">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010099">d</span>&nbsp;<span class="op" id="4010101">|=</span>&nbsp;<span class="ident" id="4010104">Word</span><span class="op" id="4010108">(</span><span class="ident" id="4010109">buf</span><span class="op" id="4010112">[</span><span class="ident" id="4010113">i</span><span class="op" id="4010114">-</span><span class="num" id="4010115">1</span><span class="op" id="4010116">]</span><span class="op" id="4010117">)</span>&nbsp;<span class="op" id="4010119">&lt;&lt;</span>&nbsp;<span class="ident" id="4010122">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010126">if</span>&nbsp;<span class="ident" id="4010129">s</span>&nbsp;<span class="op" id="4010131">+=</span>&nbsp;<span class="num" id="4010134">8</span><span class="op" id="4010135">;</span>&nbsp;<span class="ident" id="4010137">s</span>&nbsp;<span class="op" id="4010139">==</span>&nbsp;<span class="ident" id="4010142">_S</span><span class="op" id="4010144">*</span><span class="num" id="4010145">8</span>&nbsp;<span class="op" id="4010147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010152">z</span><span class="op" id="4010153">[</span><span class="ident" id="4010154">k</span><span class="op" id="4010155">]</span>&nbsp;<span class="op" id="4010157">=</span>&nbsp;<span class="ident" id="4010159">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010164">k</span><span class="op" id="4010165">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010171">s</span>&nbsp;<span class="op" id="4010173">=</span>&nbsp;<span class="num" id="4010175">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010180">d</span>&nbsp;<span class="op" id="4010182">=</span>&nbsp;<span class="num" id="4010184">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4010188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4010191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010194">if</span>&nbsp;<span class="ident" id="4010197">k</span>&nbsp;<span class="op" id="4010199">&lt;</span>&nbsp;<span class="builtinfunc" id="4010201">len</span><span class="op" id="4010204">(</span><span class="ident" id="4010205">z</span><span class="op" id="4010206">)</span>&nbsp;<span class="op" id="4010208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010212">z</span><span class="op" id="4010213">[</span><span class="ident" id="4010214">k</span><span class="op" id="4010215">]</span>&nbsp;<span class="op" id="4010217">=</span>&nbsp;<span class="ident" id="4010219">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4010222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010226">return</span>&nbsp;<span class="ident" id="4010233">z</span><span class="op" id="4010234">.</span><span class="ident" id="4010235">norm</span><span class="op" id="4010239">(</span><span class="op" id="4010240">)</span><br>
<span class="lineno"></span><span class="op" id="4010242">}</span>
</div>
</body>
</html>
