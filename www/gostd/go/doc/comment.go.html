<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html" class="current">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5987658">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5987713">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5987767">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5987818">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987879">package</span>&nbsp;<span class="ident" id="5987887">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987892">import</span>&nbsp;<span class="op" id="5987899">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5987902">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5987908">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5987918">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5987929">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="5987945">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5987964">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5987975">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5987990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987993">var</span>&nbsp;<span class="op" id="5987997">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988000">ldquo</span>&nbsp;<span class="op" id="5988006">=</span>&nbsp;<span class="op" id="5988008">[</span><span class="op" id="5988009">]</span><span class="builtintype" id="5988010">byte</span><span class="op" id="5988014">(</span><span class="string" id="5988015">&#34;&amp;ldquo;&#34;</span><span class="op" id="5988024">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988027">rdquo</span>&nbsp;<span class="op" id="5988033">=</span>&nbsp;<span class="op" id="5988035">[</span><span class="op" id="5988036">]</span><span class="builtintype" id="5988037">byte</span><span class="op" id="5988041">(</span><span class="string" id="5988042">&#34;&amp;rdquo;&#34;</span><span class="op" id="5988051">)</span><br>
<span class="lineno"></span><span class="op" id="5988053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988056">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5988105">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="5988155">func</span>&nbsp;<span class="ident" id="5988160">commentEscape</span><span class="op" id="5988173">(</span><span class="ident" id="5988174">w</span>&nbsp;<span class="ident" id="5988176">io</span><span class="op" id="5988178">.</span><span class="ident" id="5988179">Writer</span><span class="op" id="5988185">,</span>&nbsp;<span class="ident" id="5988187">text</span>&nbsp;<span class="builtintype" id="5988192">string</span><span class="op" id="5988198">,</span>&nbsp;<span class="ident" id="5988200">nice</span>&nbsp;<span class="builtintype" id="5988205">bool</span><span class="op" id="5988209">)</span>&nbsp;<span class="op" id="5988211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988214">last</span>&nbsp;<span class="op" id="5988219">:=</span>&nbsp;<span class="num" id="5988222">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988225">if</span>&nbsp;<span class="ident" id="5988228">nice</span>&nbsp;<span class="op" id="5988233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988237">for</span>&nbsp;<span class="ident" id="5988241">i</span>&nbsp;<span class="op" id="5988243">:=</span>&nbsp;<span class="num" id="5988246">0</span><span class="op" id="5988247">;</span>&nbsp;<span class="ident" id="5988249">i</span>&nbsp;<span class="op" id="5988251">&lt;</span>&nbsp;<span class="builtinfunc" id="5988253">len</span><span class="op" id="5988256">(</span><span class="ident" id="5988257">text</span><span class="op" id="5988261">)</span><span class="op" id="5988262">-</span><span class="num" id="5988263">1</span><span class="op" id="5988264">;</span>&nbsp;<span class="ident" id="5988266">i</span><span class="op" id="5988267">++</span>&nbsp;<span class="op" id="5988270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988275">ch</span>&nbsp;<span class="op" id="5988278">:=</span>&nbsp;<span class="ident" id="5988281">text</span><span class="op" id="5988285">[</span><span class="ident" id="5988286">i</span><span class="op" id="5988287">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988292">if</span>&nbsp;<span class="ident" id="5988295">ch</span>&nbsp;<span class="op" id="5988298">==</span>&nbsp;<span class="ident" id="5988301">text</span><span class="op" id="5988305">[</span><span class="ident" id="5988306">i</span><span class="op" id="5988307">+</span><span class="num" id="5988308">1</span><span class="op" id="5988309">]</span>&nbsp;<span class="op" id="5988311">&amp;&amp;</span>&nbsp;<span class="op" id="5988314">(</span><span class="ident" id="5988315">ch</span>&nbsp;<span class="op" id="5988318">==</span>&nbsp;<span class="string" id="5988321">&#39;`&#39;</span>&nbsp;<span class="op" id="5988325">||</span>&nbsp;<span class="ident" id="5988328">ch</span>&nbsp;<span class="op" id="5988331">==</span>&nbsp;<span class="string" id="5988334">&#39;\&#39;&#39;</span><span class="op" id="5988338">)</span>&nbsp;<span class="op" id="5988340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988346">template</span><span class="op" id="5988354">.</span><span class="ident" id="5988355">HTMLEscape</span><span class="op" id="5988365">(</span><span class="ident" id="5988366">w</span><span class="op" id="5988367">,</span>&nbsp;<span class="op" id="5988369">[</span><span class="op" id="5988370">]</span><span class="builtintype" id="5988371">byte</span><span class="op" id="5988375">(</span><span class="ident" id="5988376">text</span><span class="op" id="5988380">[</span><span class="ident" id="5988381">last</span><span class="op" id="5988385">:</span><span class="ident" id="5988386">i</span><span class="op" id="5988387">]</span><span class="op" id="5988388">)</span><span class="op" id="5988389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988395">last</span>&nbsp;<span class="op" id="5988400">=</span>&nbsp;<span class="ident" id="5988402">i</span>&nbsp;<span class="op" id="5988404">+</span>&nbsp;<span class="num" id="5988406">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988412">switch</span>&nbsp;<span class="ident" id="5988419">ch</span>&nbsp;<span class="op" id="5988422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988428">case</span>&nbsp;<span class="string" id="5988433">&#39;`&#39;</span><span class="op" id="5988436">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988443">w</span><span class="op" id="5988444">.</span><span class="ident" id="5988445">Write</span><span class="op" id="5988450">(</span><span class="ident" id="5988451">ldquo</span><span class="op" id="5988456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988462">case</span>&nbsp;<span class="string" id="5988467">&#39;\&#39;&#39;</span><span class="op" id="5988471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988478">w</span><span class="op" id="5988479">.</span><span class="ident" id="5988480">Write</span><span class="op" id="5988485">(</span><span class="ident" id="5988486">rdquo</span><span class="op" id="5988491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988503">i</span><span class="op" id="5988504">++</span>&nbsp;<span class="comment" id="5988507">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988546">template</span><span class="op" id="5988554">.</span><span class="ident" id="5988555">HTMLEscape</span><span class="op" id="5988565">(</span><span class="ident" id="5988566">w</span><span class="op" id="5988567">,</span>&nbsp;<span class="op" id="5988569">[</span><span class="op" id="5988570">]</span><span class="builtintype" id="5988571">byte</span><span class="op" id="5988575">(</span><span class="ident" id="5988576">text</span><span class="op" id="5988580">[</span><span class="ident" id="5988581">last</span><span class="op" id="5988585">:</span><span class="op" id="5988586">]</span><span class="op" id="5988587">)</span><span class="op" id="5988588">)</span><br>
<span class="lineno"></span><span class="op" id="5988590">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5988593">const</span>&nbsp;<span class="op" id="5988599">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5988602">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988632">identRx</span>&nbsp;<span class="op" id="5988640">=</span>&nbsp;<span class="string" id="5988642">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5988663">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988683">protocol</span>&nbsp;<span class="op" id="5988692">=</span>&nbsp;<span class="string" id="5988694">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988758">hostPart</span>&nbsp;<span class="op" id="5988767">=</span>&nbsp;<span class="string" id="5988769">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988789">filePart</span>&nbsp;<span class="op" id="5988798">=</span>&nbsp;<span class="string" id="5988800">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="5988828">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988891">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988900">=</span>&nbsp;<span class="string" id="5988902">`(`</span>&nbsp;<span class="op" id="5988906">+</span>&nbsp;<span class="ident" id="5988908">protocol</span>&nbsp;<span class="op" id="5988917">+</span>&nbsp;<span class="string" id="5988919">`)://`</span>&nbsp;<span class="op" id="5988926">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5988930">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988943">hostPart</span>&nbsp;<span class="op" id="5988952">+</span>&nbsp;<span class="string" id="5988954">`([.:]`</span>&nbsp;<span class="op" id="5988962">+</span>&nbsp;<span class="ident" id="5988964">hostPart</span>&nbsp;<span class="op" id="5988973">+</span>&nbsp;<span class="string" id="5988975">`)*/?`</span>&nbsp;<span class="op" id="5988982">+</span>&nbsp;<span class="comment" id="5988984">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989012">filePart</span>&nbsp;<span class="op" id="5989021">+</span>&nbsp;<span class="string" id="5989023">`([:.,]`</span>&nbsp;<span class="op" id="5989032">+</span>&nbsp;<span class="ident" id="5989034">filePart</span>&nbsp;<span class="op" id="5989043">+</span>&nbsp;<span class="string" id="5989045">`)*`</span><br>
<span class="lineno"></span><span class="op" id="5989050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5989053">var</span>&nbsp;<span class="ident" id="5989057">matchRx</span>&nbsp;<span class="op" id="5989065">=</span>&nbsp;<span class="ident" id="5989067">regexp</span><span class="op" id="5989073">.</span><span class="ident" id="5989074">MustCompile</span><span class="op" id="5989085">(</span><span class="string" id="5989086">`(`</span>&nbsp;<span class="op" id="5989090">+</span>&nbsp;<span class="ident" id="5989092">urlRx</span>&nbsp;<span class="op" id="5989098">+</span>&nbsp;<span class="string" id="5989100">`)|(`</span>&nbsp;<span class="op" id="5989106">+</span>&nbsp;<span class="ident" id="5989108">identRx</span>&nbsp;<span class="op" id="5989116">+</span>&nbsp;<span class="string" id="5989118">`)`</span><span class="op" id="5989121">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5989124">var</span>&nbsp;<span class="op" id="5989128">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989131">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989143">=</span>&nbsp;<span class="op" id="5989145">[</span><span class="op" id="5989146">]</span><span class="builtintype" id="5989147">byte</span><span class="op" id="5989151">(</span><span class="string" id="5989152">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="5989163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989166">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989178">=</span>&nbsp;<span class="op" id="5989180">[</span><span class="op" id="5989181">]</span><span class="builtintype" id="5989182">byte</span><span class="op" id="5989186">(</span><span class="string" id="5989187">`&#34;&gt;`</span><span class="op" id="5989191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989194">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5989206">=</span>&nbsp;<span class="op" id="5989208">[</span><span class="op" id="5989209">]</span><span class="builtintype" id="5989210">byte</span><span class="op" id="5989214">(</span><span class="string" id="5989215">&#34;&lt;/a&gt;&#34;</span><span class="op" id="5989221">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989224">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989236">=</span>&nbsp;<span class="op" id="5989238">[</span><span class="op" id="5989239">]</span><span class="builtintype" id="5989240">byte</span><span class="op" id="5989244">(</span><span class="string" id="5989245">&#34;&lt;i&gt;&#34;</span><span class="op" id="5989250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989253">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5989265">=</span>&nbsp;<span class="op" id="5989267">[</span><span class="op" id="5989268">]</span><span class="builtintype" id="5989269">byte</span><span class="op" id="5989273">(</span><span class="string" id="5989274">&#34;&lt;/i&gt;&#34;</span><span class="op" id="5989280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989283">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989295">=</span>&nbsp;<span class="op" id="5989297">[</span><span class="op" id="5989298">]</span><span class="builtintype" id="5989299">byte</span><span class="op" id="5989303">(</span><span class="string" id="5989304">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="5989311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989314">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5989326">=</span>&nbsp;<span class="op" id="5989328">[</span><span class="op" id="5989329">]</span><span class="builtintype" id="5989330">byte</span><span class="op" id="5989334">(</span><span class="string" id="5989335">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="5989343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989346">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989358">=</span>&nbsp;<span class="op" id="5989360">[</span><span class="op" id="5989361">]</span><span class="builtintype" id="5989362">byte</span><span class="op" id="5989366">(</span><span class="string" id="5989367">&#34;&lt;pre&gt;&#34;</span><span class="op" id="5989374">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989377">html_endpre</span>&nbsp;<span class="op" id="5989389">=</span>&nbsp;<span class="op" id="5989391">[</span><span class="op" id="5989392">]</span><span class="builtintype" id="5989393">byte</span><span class="op" id="5989397">(</span><span class="string" id="5989398">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="5989408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989411">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989423">=</span>&nbsp;<span class="op" id="5989425">[</span><span class="op" id="5989426">]</span><span class="builtintype" id="5989427">byte</span><span class="op" id="5989431">(</span><span class="string" id="5989432">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="5989442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989445">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989457">=</span>&nbsp;<span class="op" id="5989459">[</span><span class="op" id="5989460">]</span><span class="builtintype" id="5989461">byte</span><span class="op" id="5989465">(</span><span class="string" id="5989466">`&#34;&gt;`</span><span class="op" id="5989470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989473">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5989485">=</span>&nbsp;<span class="op" id="5989487">[</span><span class="op" id="5989488">]</span><span class="builtintype" id="5989489">byte</span><span class="op" id="5989493">(</span><span class="string" id="5989494">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="5989503">)</span><br>
<span class="lineno"></span><span class="op" id="5989505">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5989508">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="5989610">func</span>&nbsp;<span class="ident" id="5989615">pairedParensPrefixLen</span><span class="op" id="5989636">(</span><span class="ident" id="5989637">s</span>&nbsp;<span class="builtintype" id="5989639">string</span><span class="op" id="5989645">)</span>&nbsp;<span class="builtintype" id="5989647">int</span>&nbsp;<span class="op" id="5989651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989654">parens</span>&nbsp;<span class="op" id="5989661">:=</span>&nbsp;<span class="num" id="5989664">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989667">l</span>&nbsp;<span class="op" id="5989669">:=</span>&nbsp;<span class="builtinfunc" id="5989672">len</span><span class="op" id="5989675">(</span><span class="ident" id="5989676">s</span><span class="op" id="5989677">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989680">for</span>&nbsp;<span class="ident" id="5989684">i</span><span class="op" id="5989685">,</span>&nbsp;<span class="ident" id="5989687">ch</span>&nbsp;<span class="op" id="5989690">:=</span>&nbsp;<span class="keyword" id="5989693">range</span>&nbsp;<span class="ident" id="5989699">s</span>&nbsp;<span class="op" id="5989701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989705">switch</span>&nbsp;<span class="ident" id="5989712">ch</span>&nbsp;<span class="op" id="5989715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989719">case</span>&nbsp;<span class="string" id="5989724">&#39;(&#39;</span><span class="op" id="5989727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989732">if</span>&nbsp;<span class="ident" id="5989735">parens</span>&nbsp;<span class="op" id="5989742">==</span>&nbsp;<span class="num" id="5989745">0</span>&nbsp;<span class="op" id="5989747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989753">l</span>&nbsp;<span class="op" id="5989755">=</span>&nbsp;<span class="ident" id="5989757">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989767">parens</span><span class="op" id="5989773">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989778">case</span>&nbsp;<span class="string" id="5989783">&#39;)&#39;</span><span class="op" id="5989786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989791">parens</span><span class="op" id="5989797">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989803">if</span>&nbsp;<span class="ident" id="5989806">parens</span>&nbsp;<span class="op" id="5989813">==</span>&nbsp;<span class="num" id="5989816">0</span>&nbsp;<span class="op" id="5989818">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989824">l</span>&nbsp;<span class="op" id="5989826">=</span>&nbsp;<span class="builtinfunc" id="5989828">len</span><span class="op" id="5989831">(</span><span class="ident" id="5989832">s</span><span class="op" id="5989833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989838">}</span>&nbsp;<span class="keyword" id="5989840">else</span>&nbsp;<span class="keyword" id="5989845">if</span>&nbsp;<span class="ident" id="5989848">parens</span>&nbsp;<span class="op" id="5989855">&lt;</span>&nbsp;<span class="num" id="5989857">0</span>&nbsp;<span class="op" id="5989859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989865">return</span>&nbsp;<span class="ident" id="5989872">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989881">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989887">return</span>&nbsp;<span class="ident" id="5989894">l</span><br>
<span class="lineno"></span><span class="op" id="5989896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5989899">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="5989979">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="5990059">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5990136">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5990216">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="5990295">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="5990374">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="5990454">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="5990479">func</span>&nbsp;<span class="ident" id="5990484">emphasize</span><span class="op" id="5990493">(</span><span class="ident" id="5990494">w</span>&nbsp;<span class="ident" id="5990496">io</span><span class="op" id="5990498">.</span><span class="ident" id="5990499">Writer</span><span class="op" id="5990505">,</span>&nbsp;<span class="ident" id="5990507">line</span>&nbsp;<span class="builtintype" id="5990512">string</span><span class="op" id="5990518">,</span>&nbsp;<span class="ident" id="5990520">words</span>&nbsp;<span class="keyword" id="5990526">map</span><span class="op" id="5990529">[</span><span class="builtintype" id="5990530">string</span><span class="op" id="5990536">]</span><span class="builtintype" id="5990537">string</span><span class="op" id="5990543">,</span>&nbsp;<span class="ident" id="5990545">nice</span>&nbsp;<span class="builtintype" id="5990550">bool</span><span class="op" id="5990554">)</span>&nbsp;<span class="op" id="5990556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5990559">for</span>&nbsp;<span class="op" id="5990563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5990567">m</span>&nbsp;<span class="op" id="5990569">:=</span>&nbsp;<span class="ident" id="5990572">matchRx</span><span class="op" id="5990579">.</span><span class="ident" id="5990580">FindStringSubmatchIndex</span><span class="op" id="5990603">(</span><span class="ident" id="5990604">line</span><span class="op" id="5990608">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5990612">if</span>&nbsp;<span class="ident" id="5990615">m</span>&nbsp;<span class="op" id="5990617">==</span>&nbsp;<span class="ident" id="5990620">nil</span>&nbsp;<span class="op" id="5990624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5990629">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5990637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5990641">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5990715">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5990744">commentEscape</span><span class="op" id="5990757">(</span><span class="ident" id="5990758">w</span><span class="op" id="5990759">,</span>&nbsp;<span class="ident" id="5990761">line</span><span class="op" id="5990765">[</span><span class="num" id="5990766">0</span><span class="op" id="5990767">:</span><span class="ident" id="5990768">m</span><span class="op" id="5990769">[</span><span class="num" id="5990770">0</span><span class="op" id="5990771">]</span><span class="op" id="5990772">]</span><span class="op" id="5990773">,</span>&nbsp;<span class="ident" id="5990775">nice</span><span class="op" id="5990779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5990784">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5990815">match</span>&nbsp;<span class="op" id="5990821">:=</span>&nbsp;<span class="ident" id="5990824">line</span><span class="op" id="5990828">[</span><span class="ident" id="5990829">m</span><span class="op" id="5990830">[</span><span class="num" id="5990831">0</span><span class="op" id="5990832">]</span><span class="op" id="5990833">:</span><span class="ident" id="5990834">m</span><span class="op" id="5990835">[</span><span class="num" id="5990836">1</span><span class="op" id="5990837">]</span><span class="op" id="5990838">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5990842">if</span>&nbsp;<span class="ident" id="5990845">n</span>&nbsp;<span class="op" id="5990847">:=</span>&nbsp;<span class="ident" id="5990850">pairedParensPrefixLen</span><span class="op" id="5990871">(</span><span class="ident" id="5990872">match</span><span class="op" id="5990877">)</span><span class="op" id="5990878">;</span>&nbsp;<span class="ident" id="5990880">n</span>&nbsp;<span class="op" id="5990882">&lt;</span>&nbsp;<span class="builtinfunc" id="5990884">len</span><span class="op" id="5990887">(</span><span class="ident" id="5990888">match</span><span class="op" id="5990893">)</span>&nbsp;<span class="op" id="5990895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5990900">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5990950">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991010">m</span>&nbsp;<span class="op" id="5991012">=</span>&nbsp;<span class="ident" id="5991014">matchRx</span><span class="op" id="5991021">.</span><span class="ident" id="5991022">FindStringSubmatchIndex</span><span class="op" id="5991045">(</span><span class="ident" id="5991046">line</span><span class="op" id="5991050">[</span><span class="op" id="5991051">:</span><span class="ident" id="5991052">m</span><span class="op" id="5991053">[</span><span class="num" id="5991054">0</span><span class="op" id="5991055">]</span><span class="op" id="5991056">+</span><span class="ident" id="5991057">n</span><span class="op" id="5991058">]</span><span class="op" id="5991059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991064">match</span>&nbsp;<span class="op" id="5991070">=</span>&nbsp;<span class="ident" id="5991072">match</span><span class="op" id="5991077">[</span><span class="op" id="5991078">:</span><span class="ident" id="5991079">n</span><span class="op" id="5991080">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5991089">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991108">url</span>&nbsp;<span class="op" id="5991112">:=</span>&nbsp;<span class="string" id="5991115">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991120">italics</span>&nbsp;<span class="op" id="5991128">:=</span>&nbsp;<span class="builtintype" id="5991131">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991139">if</span>&nbsp;<span class="ident" id="5991142">words</span>&nbsp;<span class="op" id="5991148">!=</span>&nbsp;<span class="ident" id="5991151">nil</span>&nbsp;<span class="op" id="5991155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991160">url</span><span class="op" id="5991163">,</span>&nbsp;<span class="ident" id="5991165">italics</span>&nbsp;<span class="op" id="5991173">=</span>&nbsp;<span class="ident" id="5991175">words</span><span class="op" id="5991180">[</span><span class="ident" id="5991181">match</span><span class="op" id="5991186">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991194">if</span>&nbsp;<span class="ident" id="5991197">m</span><span class="op" id="5991198">[</span><span class="num" id="5991199">2</span><span class="op" id="5991200">]</span>&nbsp;<span class="op" id="5991202">&gt;=</span>&nbsp;<span class="num" id="5991205">0</span>&nbsp;<span class="op" id="5991207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5991212">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991292">if</span>&nbsp;<span class="op" id="5991295">!</span><span class="ident" id="5991296">italics</span>&nbsp;<span class="op" id="5991304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5991310">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991369">url</span>&nbsp;<span class="op" id="5991373">=</span>&nbsp;<span class="ident" id="5991375">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991389">italics</span>&nbsp;<span class="op" id="5991397">=</span>&nbsp;<span class="builtintype" id="5991399">false</span>&nbsp;<span class="comment" id="5991405">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5991436">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991453">if</span>&nbsp;<span class="builtinfunc" id="5991456">len</span><span class="op" id="5991459">(</span><span class="ident" id="5991460">url</span><span class="op" id="5991463">)</span>&nbsp;<span class="op" id="5991465">&gt;</span>&nbsp;<span class="num" id="5991467">0</span>&nbsp;<span class="op" id="5991469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991474">w</span><span class="op" id="5991475">.</span><span class="ident" id="5991476">Write</span><span class="op" id="5991481">(</span><span class="ident" id="5991482">html_a</span><span class="op" id="5991488">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991493">template</span><span class="op" id="5991501">.</span><span class="ident" id="5991502">HTMLEscape</span><span class="op" id="5991512">(</span><span class="ident" id="5991513">w</span><span class="op" id="5991514">,</span>&nbsp;<span class="op" id="5991516">[</span><span class="op" id="5991517">]</span><span class="builtintype" id="5991518">byte</span><span class="op" id="5991522">(</span><span class="ident" id="5991523">url</span><span class="op" id="5991526">)</span><span class="op" id="5991527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991532">w</span><span class="op" id="5991533">.</span><span class="ident" id="5991534">Write</span><span class="op" id="5991539">(</span><span class="ident" id="5991540">html_aq</span><span class="op" id="5991547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991555">if</span>&nbsp;<span class="ident" id="5991558">italics</span>&nbsp;<span class="op" id="5991566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991571">w</span><span class="op" id="5991572">.</span><span class="ident" id="5991573">Write</span><span class="op" id="5991578">(</span><span class="ident" id="5991579">html_i</span><span class="op" id="5991585">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991593">commentEscape</span><span class="op" id="5991606">(</span><span class="ident" id="5991607">w</span><span class="op" id="5991608">,</span>&nbsp;<span class="ident" id="5991610">match</span><span class="op" id="5991615">,</span>&nbsp;<span class="ident" id="5991617">nice</span><span class="op" id="5991621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991625">if</span>&nbsp;<span class="ident" id="5991628">italics</span>&nbsp;<span class="op" id="5991636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991641">w</span><span class="op" id="5991642">.</span><span class="ident" id="5991643">Write</span><span class="op" id="5991648">(</span><span class="ident" id="5991649">html_endi</span><span class="op" id="5991658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991662">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991666">if</span>&nbsp;<span class="builtinfunc" id="5991669">len</span><span class="op" id="5991672">(</span><span class="ident" id="5991673">url</span><span class="op" id="5991676">)</span>&nbsp;<span class="op" id="5991678">&gt;</span>&nbsp;<span class="num" id="5991680">0</span>&nbsp;<span class="op" id="5991682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991687">w</span><span class="op" id="5991688">.</span><span class="ident" id="5991689">Write</span><span class="op" id="5991694">(</span><span class="ident" id="5991695">html_enda</span><span class="op" id="5991704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5991713">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991726">line</span>&nbsp;<span class="op" id="5991731">=</span>&nbsp;<span class="ident" id="5991733">line</span><span class="op" id="5991737">[</span><span class="ident" id="5991738">m</span><span class="op" id="5991739">[</span><span class="num" id="5991740">1</span><span class="op" id="5991741">]</span><span class="op" id="5991742">:</span><span class="op" id="5991743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991749">commentEscape</span><span class="op" id="5991762">(</span><span class="ident" id="5991763">w</span><span class="op" id="5991764">,</span>&nbsp;<span class="ident" id="5991766">line</span><span class="op" id="5991770">,</span>&nbsp;<span class="ident" id="5991772">nice</span><span class="op" id="5991776">)</span><br>
<span class="lineno"></span><span class="op" id="5991778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5991781">func</span>&nbsp;<span class="ident" id="5991786">indentLen</span><span class="op" id="5991795">(</span><span class="ident" id="5991796">s</span>&nbsp;<span class="builtintype" id="5991798">string</span><span class="op" id="5991804">)</span>&nbsp;<span class="builtintype" id="5991806">int</span>&nbsp;<span class="op" id="5991810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991813">i</span>&nbsp;<span class="op" id="5991815">:=</span>&nbsp;<span class="num" id="5991818">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991821">for</span>&nbsp;<span class="ident" id="5991825">i</span>&nbsp;<span class="op" id="5991827">&lt;</span>&nbsp;<span class="builtinfunc" id="5991829">len</span><span class="op" id="5991832">(</span><span class="ident" id="5991833">s</span><span class="op" id="5991834">)</span>&nbsp;<span class="op" id="5991836">&amp;&amp;</span>&nbsp;<span class="op" id="5991839">(</span><span class="ident" id="5991840">s</span><span class="op" id="5991841">[</span><span class="ident" id="5991842">i</span><span class="op" id="5991843">]</span>&nbsp;<span class="op" id="5991845">==</span>&nbsp;<span class="string" id="5991848">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5991852">||</span>&nbsp;<span class="ident" id="5991855">s</span><span class="op" id="5991856">[</span><span class="ident" id="5991857">i</span><span class="op" id="5991858">]</span>&nbsp;<span class="op" id="5991860">==</span>&nbsp;<span class="string" id="5991863">&#39;\t&#39;</span><span class="op" id="5991867">)</span>&nbsp;<span class="op" id="5991869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5991873">i</span><span class="op" id="5991874">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991878">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991881">return</span>&nbsp;<span class="ident" id="5991888">i</span><br>
<span class="lineno"></span><span class="op" id="5991890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991893">func</span>&nbsp;<span class="ident" id="5991898">isBlank</span><span class="op" id="5991905">(</span><span class="ident" id="5991906">s</span>&nbsp;<span class="builtintype" id="5991908">string</span><span class="op" id="5991914">)</span>&nbsp;<span class="builtintype" id="5991916">bool</span>&nbsp;<span class="op" id="5991921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5991924">return</span>&nbsp;<span class="builtinfunc" id="5991931">len</span><span class="op" id="5991934">(</span><span class="ident" id="5991935">s</span><span class="op" id="5991936">)</span>&nbsp;<span class="op" id="5991938">==</span>&nbsp;<span class="num" id="5991941">0</span>&nbsp;<span class="op" id="5991943">||</span>&nbsp;<span class="op" id="5991946">(</span><span class="builtinfunc" id="5991947">len</span><span class="op" id="5991950">(</span><span class="ident" id="5991951">s</span><span class="op" id="5991952">)</span>&nbsp;<span class="op" id="5991954">==</span>&nbsp;<span class="num" id="5991957">1</span>&nbsp;<span class="op" id="5991959">&amp;&amp;</span>&nbsp;<span class="ident" id="5991962">s</span><span class="op" id="5991963">[</span><span class="num" id="5991964">0</span><span class="op" id="5991965">]</span>&nbsp;<span class="op" id="5991967">==</span>&nbsp;<span class="string" id="5991970">&#39;\n&#39;</span><span class="op" id="5991974">)</span><br>
<span class="lineno">175</span><span class="op" id="5991976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991979">func</span>&nbsp;<span class="ident" id="5991984">commonPrefix</span><span class="op" id="5991996">(</span><span class="ident" id="5991997">a</span><span class="op" id="5991998">,</span>&nbsp;<span class="ident" id="5992000">b</span>&nbsp;<span class="builtintype" id="5992002">string</span><span class="op" id="5992008">)</span>&nbsp;<span class="builtintype" id="5992010">string</span>&nbsp;<span class="op" id="5992017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992020">i</span>&nbsp;<span class="op" id="5992022">:=</span>&nbsp;<span class="num" id="5992025">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992028">for</span>&nbsp;<span class="ident" id="5992032">i</span>&nbsp;<span class="op" id="5992034">&lt;</span>&nbsp;<span class="builtinfunc" id="5992036">len</span><span class="op" id="5992039">(</span><span class="ident" id="5992040">a</span><span class="op" id="5992041">)</span>&nbsp;<span class="op" id="5992043">&amp;&amp;</span>&nbsp;<span class="ident" id="5992046">i</span>&nbsp;<span class="op" id="5992048">&lt;</span>&nbsp;<span class="builtinfunc" id="5992050">len</span><span class="op" id="5992053">(</span><span class="ident" id="5992054">b</span><span class="op" id="5992055">)</span>&nbsp;<span class="op" id="5992057">&amp;&amp;</span>&nbsp;<span class="ident" id="5992060">a</span><span class="op" id="5992061">[</span><span class="ident" id="5992062">i</span><span class="op" id="5992063">]</span>&nbsp;<span class="op" id="5992065">==</span>&nbsp;<span class="ident" id="5992068">b</span><span class="op" id="5992069">[</span><span class="ident" id="5992070">i</span><span class="op" id="5992071">]</span>&nbsp;<span class="op" id="5992073">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992077">i</span><span class="op" id="5992078">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992085">return</span>&nbsp;<span class="ident" id="5992092">a</span><span class="op" id="5992093">[</span><span class="num" id="5992094">0</span><span class="op" id="5992095">:</span><span class="ident" id="5992096">i</span><span class="op" id="5992097">]</span><br>
<span class="lineno"></span><span class="op" id="5992099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5992102">func</span>&nbsp;<span class="ident" id="5992107">unindent</span><span class="op" id="5992115">(</span><span class="ident" id="5992116">block</span>&nbsp;<span class="op" id="5992122">[</span><span class="op" id="5992123">]</span><span class="builtintype" id="5992124">string</span><span class="op" id="5992130">)</span>&nbsp;<span class="op" id="5992132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992135">if</span>&nbsp;<span class="builtinfunc" id="5992138">len</span><span class="op" id="5992141">(</span><span class="ident" id="5992142">block</span><span class="op" id="5992147">)</span>&nbsp;<span class="op" id="5992149">==</span>&nbsp;<span class="num" id="5992152">0</span>&nbsp;<span class="op" id="5992154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992158">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992170">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992210">prefix</span>&nbsp;<span class="op" id="5992217">:=</span>&nbsp;<span class="ident" id="5992220">block</span><span class="op" id="5992225">[</span><span class="num" id="5992226">0</span><span class="op" id="5992227">]</span><span class="op" id="5992228">[</span><span class="num" id="5992229">0</span><span class="op" id="5992230">:</span><span class="ident" id="5992231">indentLen</span><span class="op" id="5992240">(</span><span class="ident" id="5992241">block</span><span class="op" id="5992246">[</span><span class="num" id="5992247">0</span><span class="op" id="5992248">]</span><span class="op" id="5992249">)</span><span class="op" id="5992250">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992253">for</span>&nbsp;<span class="ident" id="5992257">_</span><span class="op" id="5992258">,</span>&nbsp;<span class="ident" id="5992260">line</span>&nbsp;<span class="op" id="5992265">:=</span>&nbsp;<span class="keyword" id="5992268">range</span>&nbsp;<span class="ident" id="5992274">block</span>&nbsp;<span class="op" id="5992280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992284">if</span>&nbsp;<span class="op" id="5992287">!</span><span class="ident" id="5992288">isBlank</span><span class="op" id="5992295">(</span><span class="ident" id="5992296">line</span><span class="op" id="5992300">)</span>&nbsp;<span class="op" id="5992302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992307">prefix</span>&nbsp;<span class="op" id="5992314">=</span>&nbsp;<span class="ident" id="5992316">commonPrefix</span><span class="op" id="5992328">(</span><span class="ident" id="5992329">prefix</span><span class="op" id="5992335">,</span>&nbsp;<span class="ident" id="5992337">line</span><span class="op" id="5992341">[</span><span class="num" id="5992342">0</span><span class="op" id="5992343">:</span><span class="ident" id="5992344">indentLen</span><span class="op" id="5992353">(</span><span class="ident" id="5992354">line</span><span class="op" id="5992358">)</span><span class="op" id="5992359">]</span><span class="op" id="5992360">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992370">n</span>&nbsp;<span class="op" id="5992372">:=</span>&nbsp;<span class="builtinfunc" id="5992375">len</span><span class="op" id="5992378">(</span><span class="ident" id="5992379">prefix</span><span class="op" id="5992385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992389">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992400">for</span>&nbsp;<span class="ident" id="5992404">i</span><span class="op" id="5992405">,</span>&nbsp;<span class="ident" id="5992407">line</span>&nbsp;<span class="op" id="5992412">:=</span>&nbsp;<span class="keyword" id="5992415">range</span>&nbsp;<span class="ident" id="5992421">block</span>&nbsp;<span class="op" id="5992427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992431">if</span>&nbsp;<span class="op" id="5992434">!</span><span class="ident" id="5992435">isBlank</span><span class="op" id="5992442">(</span><span class="ident" id="5992443">line</span><span class="op" id="5992447">)</span>&nbsp;<span class="op" id="5992449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992454">block</span><span class="op" id="5992459">[</span><span class="ident" id="5992460">i</span><span class="op" id="5992461">]</span>&nbsp;<span class="op" id="5992463">=</span>&nbsp;<span class="ident" id="5992465">line</span><span class="op" id="5992469">[</span><span class="ident" id="5992470">n</span><span class="op" id="5992471">:</span><span class="op" id="5992472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992479">}</span><br>
<span class="lineno">205</span><span class="op" id="5992481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5992484">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="5992555">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5992597">func</span>&nbsp;<span class="ident" id="5992602">heading</span><span class="op" id="5992609">(</span><span class="ident" id="5992610">line</span>&nbsp;<span class="builtintype" id="5992615">string</span><span class="op" id="5992621">)</span>&nbsp;<span class="builtintype" id="5992623">string</span>&nbsp;<span class="op" id="5992630">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992633">line</span>&nbsp;<span class="op" id="5992638">=</span>&nbsp;<span class="ident" id="5992640">strings</span><span class="op" id="5992647">.</span><span class="ident" id="5992648">TrimSpace</span><span class="op" id="5992657">(</span><span class="ident" id="5992658">line</span><span class="op" id="5992662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992665">if</span>&nbsp;<span class="builtinfunc" id="5992668">len</span><span class="op" id="5992671">(</span><span class="ident" id="5992672">line</span><span class="op" id="5992676">)</span>&nbsp;<span class="op" id="5992678">==</span>&nbsp;<span class="num" id="5992681">0</span>&nbsp;<span class="op" id="5992683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992687">return</span>&nbsp;<span class="string" id="5992694">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992702">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992752">r</span><span class="op" id="5992753">,</span>&nbsp;<span class="ident" id="5992755">_</span>&nbsp;<span class="op" id="5992757">:=</span>&nbsp;<span class="ident" id="5992760">utf8</span><span class="op" id="5992764">.</span><span class="ident" id="5992765">DecodeRuneInString</span><span class="op" id="5992783">(</span><span class="ident" id="5992784">line</span><span class="op" id="5992788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992791">if</span>&nbsp;<span class="op" id="5992794">!</span><span class="ident" id="5992795">unicode</span><span class="op" id="5992802">.</span><span class="ident" id="5992803">IsLetter</span><span class="op" id="5992811">(</span><span class="ident" id="5992812">r</span><span class="op" id="5992813">)</span>&nbsp;<span class="op" id="5992815">||</span>&nbsp;<span class="op" id="5992818">!</span><span class="ident" id="5992819">unicode</span><span class="op" id="5992826">.</span><span class="ident" id="5992827">IsUpper</span><span class="op" id="5992834">(</span><span class="ident" id="5992835">r</span><span class="op" id="5992836">)</span>&nbsp;<span class="op" id="5992838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992842">return</span>&nbsp;<span class="string" id="5992849">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992853">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992857">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992895">r</span><span class="op" id="5992896">,</span>&nbsp;<span class="ident" id="5992898">_</span>&nbsp;<span class="op" id="5992900">=</span>&nbsp;<span class="ident" id="5992902">utf8</span><span class="op" id="5992906">.</span><span class="ident" id="5992907">DecodeLastRuneInString</span><span class="op" id="5992929">(</span><span class="ident" id="5992930">line</span><span class="op" id="5992934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992937">if</span>&nbsp;<span class="op" id="5992940">!</span><span class="ident" id="5992941">unicode</span><span class="op" id="5992948">.</span><span class="ident" id="5992949">IsLetter</span><span class="op" id="5992957">(</span><span class="ident" id="5992958">r</span><span class="op" id="5992959">)</span>&nbsp;<span class="op" id="5992961">&amp;&amp;</span>&nbsp;<span class="op" id="5992964">!</span><span class="ident" id="5992965">unicode</span><span class="op" id="5992972">.</span><span class="ident" id="5992973">IsDigit</span><span class="op" id="5992980">(</span><span class="ident" id="5992981">r</span><span class="op" id="5992982">)</span>&nbsp;<span class="op" id="5992984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5992988">return</span>&nbsp;<span class="string" id="5992995">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993003">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993045">if</span>&nbsp;<span class="ident" id="5993048">strings</span><span class="op" id="5993055">.</span><span class="ident" id="5993056">IndexAny</span><span class="op" id="5993064">(</span><span class="ident" id="5993065">line</span><span class="op" id="5993069">,</span>&nbsp;<span class="string" id="5993071">&#34;,.;:!?+*/=()[]{}_^&amp;~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="5993106">)</span>&nbsp;<span class="op" id="5993108">&gt;=</span>&nbsp;<span class="num" id="5993111">0</span>&nbsp;<span class="op" id="5993113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993117">return</span>&nbsp;<span class="string" id="5993124">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993132">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993171">for</span>&nbsp;<span class="ident" id="5993175">b</span>&nbsp;<span class="op" id="5993177">:=</span>&nbsp;<span class="ident" id="5993180">line</span><span class="op" id="5993184">;</span>&nbsp;<span class="op" id="5993186">;</span>&nbsp;<span class="op" id="5993188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993192">i</span>&nbsp;<span class="op" id="5993194">:=</span>&nbsp;<span class="ident" id="5993197">strings</span><span class="op" id="5993204">.</span><span class="ident" id="5993205">IndexRune</span><span class="op" id="5993214">(</span><span class="ident" id="5993215">b</span><span class="op" id="5993216">,</span>&nbsp;<span class="string" id="5993218">&#39;\&#39;&#39;</span><span class="op" id="5993222">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993226">if</span>&nbsp;<span class="ident" id="5993229">i</span>&nbsp;<span class="op" id="5993231">&lt;</span>&nbsp;<span class="num" id="5993233">0</span>&nbsp;<span class="op" id="5993235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993240">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993252">if</span>&nbsp;<span class="ident" id="5993255">i</span><span class="op" id="5993256">+</span><span class="num" id="5993257">1</span>&nbsp;<span class="op" id="5993259">&gt;=</span>&nbsp;<span class="builtinfunc" id="5993262">len</span><span class="op" id="5993265">(</span><span class="ident" id="5993266">b</span><span class="op" id="5993267">)</span>&nbsp;<span class="op" id="5993269">||</span>&nbsp;<span class="ident" id="5993272">b</span><span class="op" id="5993273">[</span><span class="ident" id="5993274">i</span><span class="op" id="5993275">+</span><span class="num" id="5993276">1</span><span class="op" id="5993277">]</span>&nbsp;<span class="op" id="5993279">!=</span>&nbsp;<span class="string" id="5993282">&#39;s&#39;</span>&nbsp;<span class="op" id="5993286">||</span>&nbsp;<span class="op" id="5993289">(</span><span class="ident" id="5993290">i</span><span class="op" id="5993291">+</span><span class="num" id="5993292">2</span>&nbsp;<span class="op" id="5993294">&lt;</span>&nbsp;<span class="builtinfunc" id="5993296">len</span><span class="op" id="5993299">(</span><span class="ident" id="5993300">b</span><span class="op" id="5993301">)</span>&nbsp;<span class="op" id="5993303">&amp;&amp;</span>&nbsp;<span class="ident" id="5993306">b</span><span class="op" id="5993307">[</span><span class="ident" id="5993308">i</span><span class="op" id="5993309">+</span><span class="num" id="5993310">2</span><span class="op" id="5993311">]</span>&nbsp;<span class="op" id="5993313">!=</span>&nbsp;<span class="string" id="5993316">&#39;&nbsp;&#39;</span><span class="op" id="5993319">)</span>&nbsp;<span class="op" id="5993321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993326">return</span>&nbsp;<span class="string" id="5993333">&#34;&#34;</span>&nbsp;<span class="comment" id="5993336">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993366">b</span>&nbsp;<span class="op" id="5993368">=</span>&nbsp;<span class="ident" id="5993370">b</span><span class="op" id="5993371">[</span><span class="ident" id="5993372">i</span><span class="op" id="5993373">+</span><span class="num" id="5993374">2</span><span class="op" id="5993375">:</span><span class="op" id="5993376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993383">return</span>&nbsp;<span class="ident" id="5993390">line</span><br>
<span class="lineno">245</span><span class="op" id="5993395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5993398">type</span>&nbsp;<span class="ident" id="5993403">op</span>&nbsp;<span class="builtintype" id="5993406">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5993411">const</span>&nbsp;<span class="op" id="5993417">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993420">opPara</span>&nbsp;<span class="ident" id="5993427">op</span>&nbsp;<span class="op" id="5993430">=</span>&nbsp;<span class="ident" id="5993432">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993438">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993446">opPre</span><br>
<span class="lineno"></span><span class="op" id="5993452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5993455">type</span>&nbsp;<span class="ident" id="5993460">block</span>&nbsp;<span class="keyword" id="5993466">struct</span>&nbsp;<span class="op" id="5993473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993476">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993482">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993486">lines</span>&nbsp;<span class="op" id="5993492">[</span><span class="op" id="5993493">]</span><span class="builtintype" id="5993494">string</span><br>
<span class="lineno"></span><span class="op" id="5993501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5993504">var</span>&nbsp;<span class="ident" id="5993508">nonAlphaNumRx</span>&nbsp;<span class="op" id="5993522">=</span>&nbsp;<span class="ident" id="5993524">regexp</span><span class="op" id="5993530">.</span><span class="ident" id="5993531">MustCompile</span><span class="op" id="5993542">(</span><span class="string" id="5993543">`[^a-zA-Z0-9]`</span><span class="op" id="5993557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5993560">func</span>&nbsp;<span class="ident" id="5993565">anchorID</span><span class="op" id="5993573">(</span><span class="ident" id="5993574">line</span>&nbsp;<span class="builtintype" id="5993579">string</span><span class="op" id="5993585">)</span>&nbsp;<span class="builtintype" id="5993587">string</span>&nbsp;<span class="op" id="5993594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993597">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5993677">return</span>&nbsp;<span class="string" id="5993684">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="5993691">+</span>&nbsp;<span class="ident" id="5993693">nonAlphaNumRx</span><span class="op" id="5993706">.</span><span class="ident" id="5993707">ReplaceAllString</span><span class="op" id="5993723">(</span><span class="ident" id="5993724">line</span><span class="op" id="5993728">,</span>&nbsp;<span class="string" id="5993730">&#34;_&#34;</span><span class="op" id="5993733">)</span><br>
<span class="lineno">265</span><span class="op" id="5993735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5993738">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5993789">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="5993831">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="5993891">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="5993943">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5993993">//</span><br>
<span class="lineno"></span><span class="comment" id="5993996">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5994057">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="5994128">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="5994197">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="5994258">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="5994288">//</span><br>
<span class="lineno"></span><span class="comment" id="5994291">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="5994352">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5994394">//</span><br>
<span class="lineno"></span><span class="comment" id="5994397">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="5994475">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="5994553">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="5994622">//</span><br>
<span class="lineno"></span><span class="comment" id="5994625">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5994709">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5994796">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5994812">func</span>&nbsp;<span class="ident" id="5994817">ToHTML</span><span class="op" id="5994823">(</span><span class="ident" id="5994824">w</span>&nbsp;<span class="ident" id="5994826">io</span><span class="op" id="5994828">.</span><span class="ident" id="5994829">Writer</span><span class="op" id="5994835">,</span>&nbsp;<span class="ident" id="5994837">text</span>&nbsp;<span class="builtintype" id="5994842">string</span><span class="op" id="5994848">,</span>&nbsp;<span class="ident" id="5994850">words</span>&nbsp;<span class="keyword" id="5994856">map</span><span class="op" id="5994859">[</span><span class="builtintype" id="5994860">string</span><span class="op" id="5994866">]</span><span class="builtintype" id="5994867">string</span><span class="op" id="5994873">)</span>&nbsp;<span class="op" id="5994875">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5994878">for</span>&nbsp;<span class="ident" id="5994882">_</span><span class="op" id="5994883">,</span>&nbsp;<span class="ident" id="5994885">b</span>&nbsp;<span class="op" id="5994887">:=</span>&nbsp;<span class="keyword" id="5994890">range</span>&nbsp;<span class="ident" id="5994896">blocks</span><span class="op" id="5994902">(</span><span class="ident" id="5994903">text</span><span class="op" id="5994907">)</span>&nbsp;<span class="op" id="5994909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5994913">switch</span>&nbsp;<span class="ident" id="5994920">b</span><span class="op" id="5994921">.</span><span class="ident" id="5994922">op</span>&nbsp;<span class="op" id="5994925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5994929">case</span>&nbsp;<span class="ident" id="5994934">opPara</span><span class="op" id="5994940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994945">w</span><span class="op" id="5994946">.</span><span class="ident" id="5994947">Write</span><span class="op" id="5994952">(</span><span class="ident" id="5994953">html_p</span><span class="op" id="5994959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5994964">for</span>&nbsp;<span class="ident" id="5994968">_</span><span class="op" id="5994969">,</span>&nbsp;<span class="ident" id="5994971">line</span>&nbsp;<span class="op" id="5994976">:=</span>&nbsp;<span class="keyword" id="5994979">range</span>&nbsp;<span class="ident" id="5994985">b</span><span class="op" id="5994986">.</span><span class="ident" id="5994987">lines</span>&nbsp;<span class="op" id="5994993">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994999">emphasize</span><span class="op" id="5995008">(</span><span class="ident" id="5995009">w</span><span class="op" id="5995010">,</span>&nbsp;<span class="ident" id="5995012">line</span><span class="op" id="5995016">,</span>&nbsp;<span class="ident" id="5995018">words</span><span class="op" id="5995023">,</span>&nbsp;<span class="builtintype" id="5995025">true</span><span class="op" id="5995029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995039">w</span><span class="op" id="5995040">.</span><span class="ident" id="5995041">Write</span><span class="op" id="5995046">(</span><span class="ident" id="5995047">html_endp</span><span class="op" id="5995056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995060">case</span>&nbsp;<span class="ident" id="5995065">opHead</span><span class="op" id="5995071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995076">w</span><span class="op" id="5995077">.</span><span class="ident" id="5995078">Write</span><span class="op" id="5995083">(</span><span class="ident" id="5995084">html_h</span><span class="op" id="5995090">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995095">id</span>&nbsp;<span class="op" id="5995098">:=</span>&nbsp;<span class="string" id="5995101">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995107">for</span>&nbsp;<span class="ident" id="5995111">_</span><span class="op" id="5995112">,</span>&nbsp;<span class="ident" id="5995114">line</span>&nbsp;<span class="op" id="5995119">:=</span>&nbsp;<span class="keyword" id="5995122">range</span>&nbsp;<span class="ident" id="5995128">b</span><span class="op" id="5995129">.</span><span class="ident" id="5995130">lines</span>&nbsp;<span class="op" id="5995136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995142">if</span>&nbsp;<span class="ident" id="5995145">id</span>&nbsp;<span class="op" id="5995148">==</span>&nbsp;<span class="string" id="5995151">&#34;&#34;</span>&nbsp;<span class="op" id="5995154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995161">id</span>&nbsp;<span class="op" id="5995164">=</span>&nbsp;<span class="ident" id="5995166">anchorID</span><span class="op" id="5995174">(</span><span class="ident" id="5995175">line</span><span class="op" id="5995179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995186">w</span><span class="op" id="5995187">.</span><span class="ident" id="5995188">Write</span><span class="op" id="5995193">(</span><span class="op" id="5995194">[</span><span class="op" id="5995195">]</span><span class="builtintype" id="5995196">byte</span><span class="op" id="5995200">(</span><span class="ident" id="5995201">id</span><span class="op" id="5995203">)</span><span class="op" id="5995204">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995211">w</span><span class="op" id="5995212">.</span><span class="ident" id="5995213">Write</span><span class="op" id="5995218">(</span><span class="ident" id="5995219">html_hq</span><span class="op" id="5995226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995238">commentEscape</span><span class="op" id="5995251">(</span><span class="ident" id="5995252">w</span><span class="op" id="5995253">,</span>&nbsp;<span class="ident" id="5995255">line</span><span class="op" id="5995259">,</span>&nbsp;<span class="builtintype" id="5995261">true</span><span class="op" id="5995265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995275">if</span>&nbsp;<span class="ident" id="5995278">id</span>&nbsp;<span class="op" id="5995281">==</span>&nbsp;<span class="string" id="5995284">&#34;&#34;</span>&nbsp;<span class="op" id="5995287">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995293">w</span><span class="op" id="5995294">.</span><span class="ident" id="5995295">Write</span><span class="op" id="5995300">(</span><span class="ident" id="5995301">html_hq</span><span class="op" id="5995308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995318">w</span><span class="op" id="5995319">.</span><span class="ident" id="5995320">Write</span><span class="op" id="5995325">(</span><span class="ident" id="5995326">html_endh</span><span class="op" id="5995335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995339">case</span>&nbsp;<span class="ident" id="5995344">opPre</span><span class="op" id="5995349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995354">w</span><span class="op" id="5995355">.</span><span class="ident" id="5995356">Write</span><span class="op" id="5995361">(</span><span class="ident" id="5995362">html_pre</span><span class="op" id="5995370">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995375">for</span>&nbsp;<span class="ident" id="5995379">_</span><span class="op" id="5995380">,</span>&nbsp;<span class="ident" id="5995382">line</span>&nbsp;<span class="op" id="5995387">:=</span>&nbsp;<span class="keyword" id="5995390">range</span>&nbsp;<span class="ident" id="5995396">b</span><span class="op" id="5995397">.</span><span class="ident" id="5995398">lines</span>&nbsp;<span class="op" id="5995404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995410">emphasize</span><span class="op" id="5995419">(</span><span class="ident" id="5995420">w</span><span class="op" id="5995421">,</span>&nbsp;<span class="ident" id="5995423">line</span><span class="op" id="5995427">,</span>&nbsp;<span class="ident" id="5995429">nil</span><span class="op" id="5995432">,</span>&nbsp;<span class="builtintype" id="5995434">false</span><span class="op" id="5995439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995449">w</span><span class="op" id="5995450">.</span><span class="ident" id="5995451">Write</span><span class="op" id="5995456">(</span><span class="ident" id="5995457">html_endpre</span><span class="op" id="5995468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995472">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995475">}</span><br>
<span class="lineno"></span><span class="op" id="5995477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5995480">func</span>&nbsp;<span class="ident" id="5995485">blocks</span><span class="op" id="5995491">(</span><span class="ident" id="5995492">text</span>&nbsp;<span class="builtintype" id="5995497">string</span><span class="op" id="5995503">)</span>&nbsp;<span class="op" id="5995505">[</span><span class="op" id="5995506">]</span><span class="ident" id="5995507">block</span>&nbsp;<span class="op" id="5995513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995516">var</span>&nbsp;<span class="op" id="5995520">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995524">out</span>&nbsp;&nbsp;<span class="op" id="5995529">[</span><span class="op" id="5995530">]</span><span class="ident" id="5995531">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995539">para</span>&nbsp;<span class="op" id="5995544">[</span><span class="op" id="5995545">]</span><span class="builtintype" id="5995546">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995556">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5995571">=</span>&nbsp;<span class="builtintype" id="5995573">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995581">lastWasHeading</span>&nbsp;<span class="op" id="5995596">=</span>&nbsp;<span class="builtintype" id="5995598">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5995609">close</span>&nbsp;<span class="op" id="5995615">:=</span>&nbsp;<span class="keyword" id="5995618">func</span><span class="op" id="5995622">(</span><span class="op" id="5995623">)</span>&nbsp;<span class="op" id="5995625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995629">if</span>&nbsp;<span class="ident" id="5995632">para</span>&nbsp;<span class="op" id="5995637">!=</span>&nbsp;<span class="ident" id="5995640">nil</span>&nbsp;<span class="op" id="5995644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995649">out</span>&nbsp;<span class="op" id="5995653">=</span>&nbsp;<span class="builtinfunc" id="5995655">append</span><span class="op" id="5995661">(</span><span class="ident" id="5995662">out</span><span class="op" id="5995665">,</span>&nbsp;<span class="ident" id="5995667">block</span><span class="op" id="5995672">{</span><span class="ident" id="5995673">opPara</span><span class="op" id="5995679">,</span>&nbsp;<span class="ident" id="5995681">para</span><span class="op" id="5995685">}</span><span class="op" id="5995686">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995691">para</span>&nbsp;<span class="op" id="5995696">=</span>&nbsp;<span class="ident" id="5995698">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995711">lines</span>&nbsp;<span class="op" id="5995717">:=</span>&nbsp;<span class="ident" id="5995720">strings</span><span class="op" id="5995727">.</span><span class="ident" id="5995728">SplitAfter</span><span class="op" id="5995738">(</span><span class="ident" id="5995739">text</span><span class="op" id="5995743">,</span>&nbsp;<span class="string" id="5995745">&#34;\n&#34;</span><span class="op" id="5995749">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995752">unindent</span><span class="op" id="5995760">(</span><span class="ident" id="5995761">lines</span><span class="op" id="5995766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995769">for</span>&nbsp;<span class="ident" id="5995773">i</span>&nbsp;<span class="op" id="5995775">:=</span>&nbsp;<span class="num" id="5995778">0</span><span class="op" id="5995779">;</span>&nbsp;<span class="ident" id="5995781">i</span>&nbsp;<span class="op" id="5995783">&lt;</span>&nbsp;<span class="builtinfunc" id="5995785">len</span><span class="op" id="5995788">(</span><span class="ident" id="5995789">lines</span><span class="op" id="5995794">)</span><span class="op" id="5995795">;</span>&nbsp;<span class="op" id="5995797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995801">line</span>&nbsp;<span class="op" id="5995806">:=</span>&nbsp;<span class="ident" id="5995809">lines</span><span class="op" id="5995814">[</span><span class="ident" id="5995815">i</span><span class="op" id="5995816">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995820">if</span>&nbsp;<span class="ident" id="5995823">isBlank</span><span class="op" id="5995830">(</span><span class="ident" id="5995831">line</span><span class="op" id="5995835">)</span>&nbsp;<span class="op" id="5995837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5995842">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5995864">close</span><span class="op" id="5995869">(</span><span class="op" id="5995870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995875">i</span><span class="op" id="5995876">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5995882">lastWasBlank</span>&nbsp;<span class="op" id="5995895">=</span>&nbsp;<span class="builtintype" id="5995897">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995905">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5995916">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5995920">if</span>&nbsp;<span class="ident" id="5995923">indentLen</span><span class="op" id="5995932">(</span><span class="ident" id="5995933">line</span><span class="op" id="5995937">)</span>&nbsp;<span class="op" id="5995939">&gt;</span>&nbsp;<span class="num" id="5995941">0</span>&nbsp;<span class="op" id="5995943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5995948">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5995970">close</span><span class="op" id="5995975">(</span><span class="op" id="5995976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5995982">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996018">j</span>&nbsp;<span class="op" id="5996020">:=</span>&nbsp;<span class="ident" id="5996023">i</span>&nbsp;<span class="op" id="5996025">+</span>&nbsp;<span class="num" id="5996027">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996032">for</span>&nbsp;<span class="ident" id="5996036">j</span>&nbsp;<span class="op" id="5996038">&lt;</span>&nbsp;<span class="builtinfunc" id="5996040">len</span><span class="op" id="5996043">(</span><span class="ident" id="5996044">lines</span><span class="op" id="5996049">)</span>&nbsp;<span class="op" id="5996051">&amp;&amp;</span>&nbsp;<span class="op" id="5996054">(</span><span class="ident" id="5996055">isBlank</span><span class="op" id="5996062">(</span><span class="ident" id="5996063">lines</span><span class="op" id="5996068">[</span><span class="ident" id="5996069">j</span><span class="op" id="5996070">]</span><span class="op" id="5996071">)</span>&nbsp;<span class="op" id="5996073">||</span>&nbsp;<span class="ident" id="5996076">indentLen</span><span class="op" id="5996085">(</span><span class="ident" id="5996086">lines</span><span class="op" id="5996091">[</span><span class="ident" id="5996092">j</span><span class="op" id="5996093">]</span><span class="op" id="5996094">)</span>&nbsp;<span class="op" id="5996096">&gt;</span>&nbsp;<span class="num" id="5996098">0</span><span class="op" id="5996099">)</span>&nbsp;<span class="op" id="5996101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996107">j</span><span class="op" id="5996108">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996119">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996154">for</span>&nbsp;<span class="ident" id="5996158">j</span>&nbsp;<span class="op" id="5996160">&gt;</span>&nbsp;<span class="ident" id="5996162">i</span>&nbsp;<span class="op" id="5996164">&amp;&amp;</span>&nbsp;<span class="ident" id="5996167">isBlank</span><span class="op" id="5996174">(</span><span class="ident" id="5996175">lines</span><span class="op" id="5996180">[</span><span class="ident" id="5996181">j</span><span class="op" id="5996182">-</span><span class="num" id="5996183">1</span><span class="op" id="5996184">]</span><span class="op" id="5996185">)</span>&nbsp;<span class="op" id="5996187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996193">j</span><span class="op" id="5996194">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996205">pre</span>&nbsp;<span class="op" id="5996209">:=</span>&nbsp;<span class="ident" id="5996212">lines</span><span class="op" id="5996217">[</span><span class="ident" id="5996218">i</span><span class="op" id="5996219">:</span><span class="ident" id="5996220">j</span><span class="op" id="5996221">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996226">i</span>&nbsp;<span class="op" id="5996228">=</span>&nbsp;<span class="ident" id="5996230">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996236">unindent</span><span class="op" id="5996244">(</span><span class="ident" id="5996245">pre</span><span class="op" id="5996248">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996254">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996291">out</span>&nbsp;<span class="op" id="5996295">=</span>&nbsp;<span class="builtinfunc" id="5996297">append</span><span class="op" id="5996303">(</span><span class="ident" id="5996304">out</span><span class="op" id="5996307">,</span>&nbsp;<span class="ident" id="5996309">block</span><span class="op" id="5996314">{</span><span class="ident" id="5996315">opPre</span><span class="op" id="5996320">,</span>&nbsp;<span class="ident" id="5996322">pre</span><span class="op" id="5996325">}</span><span class="op" id="5996326">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996331">lastWasHeading</span>&nbsp;<span class="op" id="5996346">=</span>&nbsp;<span class="builtintype" id="5996348">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996357">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996373">if</span>&nbsp;<span class="ident" id="5996376">lastWasBlank</span>&nbsp;<span class="op" id="5996389">&amp;&amp;</span>&nbsp;<span class="op" id="5996392">!</span><span class="ident" id="5996393">lastWasHeading</span>&nbsp;<span class="op" id="5996408">&amp;&amp;</span>&nbsp;<span class="ident" id="5996411">i</span><span class="op" id="5996412">+</span><span class="num" id="5996413">2</span>&nbsp;<span class="op" id="5996415">&lt;</span>&nbsp;<span class="builtinfunc" id="5996417">len</span><span class="op" id="5996420">(</span><span class="ident" id="5996421">lines</span><span class="op" id="5996426">)</span>&nbsp;<span class="op" id="5996428">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996434">isBlank</span><span class="op" id="5996441">(</span><span class="ident" id="5996442">lines</span><span class="op" id="5996447">[</span><span class="ident" id="5996448">i</span><span class="op" id="5996449">+</span><span class="num" id="5996450">1</span><span class="op" id="5996451">]</span><span class="op" id="5996452">)</span>&nbsp;<span class="op" id="5996454">&amp;&amp;</span>&nbsp;<span class="op" id="5996457">!</span><span class="ident" id="5996458">isBlank</span><span class="op" id="5996465">(</span><span class="ident" id="5996466">lines</span><span class="op" id="5996471">[</span><span class="ident" id="5996472">i</span><span class="op" id="5996473">+</span><span class="num" id="5996474">2</span><span class="op" id="5996475">]</span><span class="op" id="5996476">)</span>&nbsp;<span class="op" id="5996478">&amp;&amp;</span>&nbsp;<span class="ident" id="5996481">indentLen</span><span class="op" id="5996490">(</span><span class="ident" id="5996491">lines</span><span class="op" id="5996496">[</span><span class="ident" id="5996497">i</span><span class="op" id="5996498">+</span><span class="num" id="5996499">2</span><span class="op" id="5996500">]</span><span class="op" id="5996501">)</span>&nbsp;<span class="op" id="5996503">==</span>&nbsp;<span class="num" id="5996506">0</span>&nbsp;<span class="op" id="5996508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996513">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996572">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996628">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996654">if</span>&nbsp;<span class="ident" id="5996657">head</span>&nbsp;<span class="op" id="5996662">:=</span>&nbsp;<span class="ident" id="5996665">heading</span><span class="op" id="5996672">(</span><span class="ident" id="5996673">line</span><span class="op" id="5996677">)</span><span class="op" id="5996678">;</span>&nbsp;<span class="ident" id="5996680">head</span>&nbsp;<span class="op" id="5996685">!=</span>&nbsp;<span class="string" id="5996688">&#34;&#34;</span>&nbsp;<span class="op" id="5996691">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5996697">close</span><span class="op" id="5996702">(</span><span class="op" id="5996703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996709">out</span>&nbsp;<span class="op" id="5996713">=</span>&nbsp;<span class="builtinfunc" id="5996715">append</span><span class="op" id="5996721">(</span><span class="ident" id="5996722">out</span><span class="op" id="5996725">,</span>&nbsp;<span class="ident" id="5996727">block</span><span class="op" id="5996732">{</span><span class="ident" id="5996733">opHead</span><span class="op" id="5996739">,</span>&nbsp;<span class="op" id="5996741">[</span><span class="op" id="5996742">]</span><span class="builtintype" id="5996743">string</span><span class="op" id="5996749">{</span><span class="ident" id="5996750">head</span><span class="op" id="5996754">}</span><span class="op" id="5996755">}</span><span class="op" id="5996756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996762">i</span>&nbsp;<span class="op" id="5996764">+=</span>&nbsp;<span class="num" id="5996767">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996773">lastWasHeading</span>&nbsp;<span class="op" id="5996788">=</span>&nbsp;<span class="builtintype" id="5996790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996799">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5996820">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996840">lastWasBlank</span>&nbsp;<span class="op" id="5996853">=</span>&nbsp;<span class="builtintype" id="5996855">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996863">lastWasHeading</span>&nbsp;<span class="op" id="5996878">=</span>&nbsp;<span class="builtintype" id="5996880">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996888">para</span>&nbsp;<span class="op" id="5996893">=</span>&nbsp;<span class="builtinfunc" id="5996895">append</span><span class="op" id="5996901">(</span><span class="ident" id="5996902">para</span><span class="op" id="5996906">,</span>&nbsp;<span class="ident" id="5996908">lines</span><span class="op" id="5996913">[</span><span class="ident" id="5996914">i</span><span class="op" id="5996915">]</span><span class="op" id="5996916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5996920">i</span><span class="op" id="5996921">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5996925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5996928">close</span><span class="op" id="5996933">(</span><span class="op" id="5996934">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5996938">return</span>&nbsp;<span class="ident" id="5996945">out</span><br>
<span class="lineno"></span><span class="op" id="5996949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5996952">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="5997020">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="5997089">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="5997163">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="5997238">func</span>&nbsp;<span class="ident" id="5997243">ToText</span><span class="op" id="5997249">(</span><span class="ident" id="5997250">w</span>&nbsp;<span class="ident" id="5997252">io</span><span class="op" id="5997254">.</span><span class="ident" id="5997255">Writer</span><span class="op" id="5997261">,</span>&nbsp;<span class="ident" id="5997263">text</span>&nbsp;<span class="builtintype" id="5997268">string</span><span class="op" id="5997274">,</span>&nbsp;<span class="ident" id="5997276">indent</span><span class="op" id="5997282">,</span>&nbsp;<span class="ident" id="5997284">preIndent</span>&nbsp;<span class="builtintype" id="5997294">string</span><span class="op" id="5997300">,</span>&nbsp;<span class="ident" id="5997302">width</span>&nbsp;<span class="builtintype" id="5997308">int</span><span class="op" id="5997311">)</span>&nbsp;<span class="op" id="5997313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997316">l</span>&nbsp;<span class="op" id="5997318">:=</span>&nbsp;<span class="ident" id="5997321">lineWrapper</span><span class="op" id="5997332">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997336">out</span><span class="op" id="5997339">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997344">w</span><span class="op" id="5997345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997349">width</span><span class="op" id="5997354">:</span>&nbsp;&nbsp;<span class="ident" id="5997357">width</span><span class="op" id="5997362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997366">indent</span><span class="op" id="5997372">:</span>&nbsp;<span class="ident" id="5997374">indent</span><span class="op" id="5997380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997386">for</span>&nbsp;<span class="ident" id="5997390">_</span><span class="op" id="5997391">,</span>&nbsp;<span class="ident" id="5997393">b</span>&nbsp;<span class="op" id="5997395">:=</span>&nbsp;<span class="keyword" id="5997398">range</span>&nbsp;<span class="ident" id="5997404">blocks</span><span class="op" id="5997410">(</span><span class="ident" id="5997411">text</span><span class="op" id="5997415">)</span>&nbsp;<span class="op" id="5997417">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997421">switch</span>&nbsp;<span class="ident" id="5997428">b</span><span class="op" id="5997429">.</span><span class="ident" id="5997430">op</span>&nbsp;<span class="op" id="5997433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997437">case</span>&nbsp;<span class="ident" id="5997442">opPara</span><span class="op" id="5997448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5997453">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997504">for</span>&nbsp;<span class="ident" id="5997508">_</span><span class="op" id="5997509">,</span>&nbsp;<span class="ident" id="5997511">line</span>&nbsp;<span class="op" id="5997516">:=</span>&nbsp;<span class="keyword" id="5997519">range</span>&nbsp;<span class="ident" id="5997525">b</span><span class="op" id="5997526">.</span><span class="ident" id="5997527">lines</span>&nbsp;<span class="op" id="5997533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997539">l</span><span class="op" id="5997540">.</span><span class="ident" id="5997541">write</span><span class="op" id="5997546">(</span><span class="ident" id="5997547">line</span><span class="op" id="5997551">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997561">l</span><span class="op" id="5997562">.</span><span class="ident" id="5997563">flush</span><span class="op" id="5997568">(</span><span class="op" id="5997569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997573">case</span>&nbsp;<span class="ident" id="5997578">opHead</span><span class="op" id="5997584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997589">w</span><span class="op" id="5997590">.</span><span class="ident" id="5997591">Write</span><span class="op" id="5997596">(</span><span class="ident" id="5997597">nl</span><span class="op" id="5997599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997604">for</span>&nbsp;<span class="ident" id="5997608">_</span><span class="op" id="5997609">,</span>&nbsp;<span class="ident" id="5997611">line</span>&nbsp;<span class="op" id="5997616">:=</span>&nbsp;<span class="keyword" id="5997619">range</span>&nbsp;<span class="ident" id="5997625">b</span><span class="op" id="5997626">.</span><span class="ident" id="5997627">lines</span>&nbsp;<span class="op" id="5997633">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997639">l</span><span class="op" id="5997640">.</span><span class="ident" id="5997641">write</span><span class="op" id="5997646">(</span><span class="ident" id="5997647">line</span>&nbsp;<span class="op" id="5997652">+</span>&nbsp;<span class="string" id="5997654">&#34;\n&#34;</span><span class="op" id="5997658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997668">l</span><span class="op" id="5997669">.</span><span class="ident" id="5997670">flush</span><span class="op" id="5997675">(</span><span class="op" id="5997676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997680">case</span>&nbsp;<span class="ident" id="5997685">opPre</span><span class="op" id="5997690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997695">w</span><span class="op" id="5997696">.</span><span class="ident" id="5997697">Write</span><span class="op" id="5997702">(</span><span class="ident" id="5997703">nl</span><span class="op" id="5997705">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997710">for</span>&nbsp;<span class="ident" id="5997714">_</span><span class="op" id="5997715">,</span>&nbsp;<span class="ident" id="5997717">line</span>&nbsp;<span class="op" id="5997722">:=</span>&nbsp;<span class="keyword" id="5997725">range</span>&nbsp;<span class="ident" id="5997731">b</span><span class="op" id="5997732">.</span><span class="ident" id="5997733">lines</span>&nbsp;<span class="op" id="5997739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5997745">if</span>&nbsp;<span class="ident" id="5997748">isBlank</span><span class="op" id="5997755">(</span><span class="ident" id="5997756">line</span><span class="op" id="5997760">)</span>&nbsp;<span class="op" id="5997762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997769">w</span><span class="op" id="5997770">.</span><span class="ident" id="5997771">Write</span><span class="op" id="5997776">(</span><span class="op" id="5997777">[</span><span class="op" id="5997778">]</span><span class="builtintype" id="5997779">byte</span><span class="op" id="5997783">(</span><span class="string" id="5997784">&#34;\n&#34;</span><span class="op" id="5997788">)</span><span class="op" id="5997789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997795">}</span>&nbsp;<span class="keyword" id="5997797">else</span>&nbsp;<span class="op" id="5997802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997809">w</span><span class="op" id="5997810">.</span><span class="ident" id="5997811">Write</span><span class="op" id="5997816">(</span><span class="op" id="5997817">[</span><span class="op" id="5997818">]</span><span class="builtintype" id="5997819">byte</span><span class="op" id="5997823">(</span><span class="ident" id="5997824">preIndent</span><span class="op" id="5997833">)</span><span class="op" id="5997834">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997841">w</span><span class="op" id="5997842">.</span><span class="ident" id="5997843">Write</span><span class="op" id="5997848">(</span><span class="op" id="5997849">[</span><span class="op" id="5997850">]</span><span class="builtintype" id="5997851">byte</span><span class="op" id="5997855">(</span><span class="ident" id="5997856">line</span><span class="op" id="5997860">)</span><span class="op" id="5997861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5997879">}</span><br>
<span class="lineno">435</span><span class="op" id="5997881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5997884">type</span>&nbsp;<span class="ident" id="5997889">lineWrapper</span>&nbsp;<span class="keyword" id="5997901">struct</span>&nbsp;<span class="op" id="5997908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997911">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997921">io</span><span class="op" id="5997923">.</span><span class="ident" id="5997924">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997932">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5997942">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997948">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5997958">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997963">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5997973">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997981">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5997991">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5997996">pendSpace</span>&nbsp;<span class="builtintype" id="5998006">int</span><br>
<span class="lineno"></span><span class="op" id="5998010">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="5998013">var</span>&nbsp;<span class="ident" id="5998017">nl</span>&nbsp;<span class="op" id="5998020">=</span>&nbsp;<span class="op" id="5998022">[</span><span class="op" id="5998023">]</span><span class="builtintype" id="5998024">byte</span><span class="op" id="5998028">(</span><span class="string" id="5998029">&#34;\n&#34;</span><span class="op" id="5998033">)</span><br>
<span class="lineno"></span><span class="keyword" id="5998035">var</span>&nbsp;<span class="ident" id="5998039">space</span>&nbsp;<span class="op" id="5998045">=</span>&nbsp;<span class="op" id="5998047">[</span><span class="op" id="5998048">]</span><span class="builtintype" id="5998049">byte</span><span class="op" id="5998053">(</span><span class="string" id="5998054">&#34;&nbsp;&#34;</span><span class="op" id="5998057">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5998060">func</span>&nbsp;<span class="op" id="5998065">(</span><span class="ident" id="5998066">l</span>&nbsp;<span class="op" id="5998068">*</span><span class="ident" id="5998069">lineWrapper</span><span class="op" id="5998080">)</span>&nbsp;<span class="ident" id="5998082">write</span><span class="op" id="5998087">(</span><span class="ident" id="5998088">text</span>&nbsp;<span class="builtintype" id="5998093">string</span><span class="op" id="5998099">)</span>&nbsp;<span class="op" id="5998101">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998104">if</span>&nbsp;<span class="ident" id="5998107">l</span><span class="op" id="5998108">.</span><span class="ident" id="5998109">n</span>&nbsp;<span class="op" id="5998111">==</span>&nbsp;<span class="num" id="5998114">0</span>&nbsp;<span class="op" id="5998116">&amp;&amp;</span>&nbsp;<span class="ident" id="5998119">l</span><span class="op" id="5998120">.</span><span class="ident" id="5998121">printed</span>&nbsp;<span class="op" id="5998129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998133">l</span><span class="op" id="5998134">.</span><span class="ident" id="5998135">out</span><span class="op" id="5998138">.</span><span class="ident" id="5998139">Write</span><span class="op" id="5998144">(</span><span class="ident" id="5998145">nl</span><span class="op" id="5998147">)</span>&nbsp;<span class="comment" id="5998149">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998188">l</span><span class="op" id="5998189">.</span><span class="ident" id="5998190">printed</span>&nbsp;<span class="op" id="5998198">=</span>&nbsp;<span class="builtintype" id="5998200">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998207">for</span>&nbsp;<span class="ident" id="5998211">_</span><span class="op" id="5998212">,</span>&nbsp;<span class="ident" id="5998214">f</span>&nbsp;<span class="op" id="5998216">:=</span>&nbsp;<span class="keyword" id="5998219">range</span>&nbsp;<span class="ident" id="5998225">strings</span><span class="op" id="5998232">.</span><span class="ident" id="5998233">Fields</span><span class="op" id="5998239">(</span><span class="ident" id="5998240">text</span><span class="op" id="5998244">)</span>&nbsp;<span class="op" id="5998246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998250">w</span>&nbsp;<span class="op" id="5998252">:=</span>&nbsp;<span class="ident" id="5998255">utf8</span><span class="op" id="5998259">.</span><span class="ident" id="5998260">RuneCountInString</span><span class="op" id="5998277">(</span><span class="ident" id="5998278">f</span><span class="op" id="5998279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5998283">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998313">if</span>&nbsp;<span class="ident" id="5998316">l</span><span class="op" id="5998317">.</span><span class="ident" id="5998318">n</span>&nbsp;<span class="op" id="5998320">&gt;</span>&nbsp;<span class="num" id="5998322">0</span>&nbsp;<span class="op" id="5998324">&amp;&amp;</span>&nbsp;<span class="ident" id="5998327">l</span><span class="op" id="5998328">.</span><span class="ident" id="5998329">n</span><span class="op" id="5998330">+</span><span class="ident" id="5998331">l</span><span class="op" id="5998332">.</span><span class="ident" id="5998333">pendSpace</span><span class="op" id="5998342">+</span><span class="ident" id="5998343">w</span>&nbsp;<span class="op" id="5998345">&gt;</span>&nbsp;<span class="ident" id="5998347">l</span><span class="op" id="5998348">.</span><span class="ident" id="5998349">width</span>&nbsp;<span class="op" id="5998355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998360">l</span><span class="op" id="5998361">.</span><span class="ident" id="5998362">out</span><span class="op" id="5998365">.</span><span class="ident" id="5998366">Write</span><span class="op" id="5998371">(</span><span class="ident" id="5998372">nl</span><span class="op" id="5998374">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998379">l</span><span class="op" id="5998380">.</span><span class="ident" id="5998381">n</span>&nbsp;<span class="op" id="5998383">=</span>&nbsp;<span class="num" id="5998385">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998390">l</span><span class="op" id="5998391">.</span><span class="ident" id="5998392">pendSpace</span>&nbsp;<span class="op" id="5998402">=</span>&nbsp;<span class="num" id="5998404">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998412">if</span>&nbsp;<span class="ident" id="5998415">l</span><span class="op" id="5998416">.</span><span class="ident" id="5998417">n</span>&nbsp;<span class="op" id="5998419">==</span>&nbsp;<span class="num" id="5998422">0</span>&nbsp;<span class="op" id="5998424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998429">l</span><span class="op" id="5998430">.</span><span class="ident" id="5998431">out</span><span class="op" id="5998434">.</span><span class="ident" id="5998435">Write</span><span class="op" id="5998440">(</span><span class="op" id="5998441">[</span><span class="op" id="5998442">]</span><span class="builtintype" id="5998443">byte</span><span class="op" id="5998447">(</span><span class="ident" id="5998448">l</span><span class="op" id="5998449">.</span><span class="ident" id="5998450">indent</span><span class="op" id="5998456">)</span><span class="op" id="5998457">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998465">l</span><span class="op" id="5998466">.</span><span class="ident" id="5998467">out</span><span class="op" id="5998470">.</span><span class="ident" id="5998471">Write</span><span class="op" id="5998476">(</span><span class="ident" id="5998477">space</span><span class="op" id="5998482">[</span><span class="op" id="5998483">:</span><span class="ident" id="5998484">l</span><span class="op" id="5998485">.</span><span class="ident" id="5998486">pendSpace</span><span class="op" id="5998495">]</span><span class="op" id="5998496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998500">l</span><span class="op" id="5998501">.</span><span class="ident" id="5998502">out</span><span class="op" id="5998505">.</span><span class="ident" id="5998506">Write</span><span class="op" id="5998511">(</span><span class="op" id="5998512">[</span><span class="op" id="5998513">]</span><span class="builtintype" id="5998514">byte</span><span class="op" id="5998518">(</span><span class="ident" id="5998519">f</span><span class="op" id="5998520">)</span><span class="op" id="5998521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998525">l</span><span class="op" id="5998526">.</span><span class="ident" id="5998527">n</span>&nbsp;<span class="op" id="5998529">+=</span>&nbsp;<span class="ident" id="5998532">l</span><span class="op" id="5998533">.</span><span class="ident" id="5998534">pendSpace</span>&nbsp;<span class="op" id="5998544">+</span>&nbsp;<span class="ident" id="5998546">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998550">l</span><span class="op" id="5998551">.</span><span class="ident" id="5998552">pendSpace</span>&nbsp;<span class="op" id="5998562">=</span>&nbsp;<span class="num" id="5998564">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998567">}</span><br>
<span class="lineno"></span><span class="op" id="5998569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5998572">func</span>&nbsp;<span class="op" id="5998577">(</span><span class="ident" id="5998578">l</span>&nbsp;<span class="op" id="5998580">*</span><span class="ident" id="5998581">lineWrapper</span><span class="op" id="5998592">)</span>&nbsp;<span class="ident" id="5998594">flush</span><span class="op" id="5998599">(</span><span class="op" id="5998600">)</span>&nbsp;<span class="op" id="5998602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998605">if</span>&nbsp;<span class="ident" id="5998608">l</span><span class="op" id="5998609">.</span><span class="ident" id="5998610">n</span>&nbsp;<span class="op" id="5998612">==</span>&nbsp;<span class="num" id="5998615">0</span>&nbsp;<span class="op" id="5998617">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5998621">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5998629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998632">l</span><span class="op" id="5998633">.</span><span class="ident" id="5998634">out</span><span class="op" id="5998637">.</span><span class="ident" id="5998638">Write</span><span class="op" id="5998643">(</span><span class="ident" id="5998644">nl</span><span class="op" id="5998646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998649">l</span><span class="op" id="5998650">.</span><span class="ident" id="5998651">pendSpace</span>&nbsp;<span class="op" id="5998661">=</span>&nbsp;<span class="num" id="5998663">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5998666">l</span><span class="op" id="5998667">.</span><span class="ident" id="5998668">n</span>&nbsp;<span class="op" id="5998670">=</span>&nbsp;<span class="num" id="5998672">0</span><br>
<span class="lineno">480</span><span class="op" id="5998674">}</span>
</div>
</body>
</html>
