<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4523655">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4523710">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4523764">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4523815">package</span>&nbsp;<span class="ident" id="4523823">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4523833">import</span>&nbsp;<span class="op" id="4523840">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4523843">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="4523849">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4523852">//&nbsp;context&nbsp;describes&nbsp;the&nbsp;state&nbsp;an&nbsp;HTML&nbsp;parser&nbsp;must&nbsp;be&nbsp;in&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4523929">//&nbsp;portion&nbsp;of&nbsp;HTML&nbsp;produced&nbsp;by&nbsp;evaluating&nbsp;a&nbsp;particular&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="4523999">//</span><br>
<span class="lineno"></span><span class="comment" id="4524002">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;of&nbsp;type&nbsp;context&nbsp;is&nbsp;the&nbsp;start&nbsp;context&nbsp;for&nbsp;a&nbsp;template&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="4524077">//&nbsp;produces&nbsp;an&nbsp;HTML&nbsp;fragment&nbsp;as&nbsp;defined&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4524120">//&nbsp;http://www.w3.org/TR/html5/syntax.html#the-end</span><br>
<span class="lineno"></span><span class="comment" id="4524170">//&nbsp;where&nbsp;the&nbsp;context&nbsp;element&nbsp;is&nbsp;null.</span><br>
<span class="lineno"></span><span class="keyword" id="4524208">type</span>&nbsp;<span class="ident" id="4524213">context</span>&nbsp;<span class="keyword" id="4524221">struct</span>&nbsp;<span class="op" id="4524228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524231">state</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4524239">state</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524246">delim</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4524254">delim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524261">urlPart</span>&nbsp;<span class="ident" id="4524269">urlPart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524278">jsCtx</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4524286">jsCtx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524293">attr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524301">attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524307">element</span>&nbsp;<span class="ident" id="4524315">element</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524324">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524332">*</span><span class="ident" id="4524333">Error</span><br>
<span class="lineno"></span><span class="op" id="4524339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4524342">func</span>&nbsp;<span class="op" id="4524347">(</span><span class="ident" id="4524348">c</span>&nbsp;<span class="ident" id="4524350">context</span><span class="op" id="4524357">)</span>&nbsp;<span class="ident" id="4524359">String</span><span class="op" id="4524365">(</span><span class="op" id="4524366">)</span>&nbsp;<span class="builtintype" id="4524368">string</span>&nbsp;<span class="op" id="4524375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4524378">return</span>&nbsp;<span class="ident" id="4524385">fmt</span><span class="op" id="4524388">.</span><span class="ident" id="4524389">Sprintf</span><span class="op" id="4524396">(</span><span class="string" id="4524397">&#34;{%v&nbsp;%v&nbsp;%v&nbsp;%v&nbsp;%v&nbsp;%v&nbsp;%v}&#34;</span><span class="op" id="4524421">,</span>&nbsp;<span class="ident" id="4524423">c</span><span class="op" id="4524424">.</span><span class="ident" id="4524425">state</span><span class="op" id="4524430">,</span>&nbsp;<span class="ident" id="4524432">c</span><span class="op" id="4524433">.</span><span class="ident" id="4524434">delim</span><span class="op" id="4524439">,</span>&nbsp;<span class="ident" id="4524441">c</span><span class="op" id="4524442">.</span><span class="ident" id="4524443">urlPart</span><span class="op" id="4524450">,</span>&nbsp;<span class="ident" id="4524452">c</span><span class="op" id="4524453">.</span><span class="ident" id="4524454">jsCtx</span><span class="op" id="4524459">,</span>&nbsp;<span class="ident" id="4524461">c</span><span class="op" id="4524462">.</span><span class="ident" id="4524463">attr</span><span class="op" id="4524467">,</span>&nbsp;<span class="ident" id="4524469">c</span><span class="op" id="4524470">.</span><span class="ident" id="4524471">element</span><span class="op" id="4524478">,</span>&nbsp;<span class="ident" id="4524480">c</span><span class="op" id="4524481">.</span><span class="ident" id="4524482">err</span><span class="op" id="4524485">)</span><br>
<span class="lineno">30</span><span class="op" id="4524487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4524490">//&nbsp;eq&nbsp;reports&nbsp;whether&nbsp;two&nbsp;contexts&nbsp;are&nbsp;equal.</span><br>
<span class="lineno"></span><span class="keyword" id="4524536">func</span>&nbsp;<span class="op" id="4524541">(</span><span class="ident" id="4524542">c</span>&nbsp;<span class="ident" id="4524544">context</span><span class="op" id="4524551">)</span>&nbsp;<span class="ident" id="4524553">eq</span><span class="op" id="4524555">(</span><span class="ident" id="4524556">d</span>&nbsp;<span class="ident" id="4524558">context</span><span class="op" id="4524565">)</span>&nbsp;<span class="builtintype" id="4524567">bool</span>&nbsp;<span class="op" id="4524572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4524575">return</span>&nbsp;<span class="ident" id="4524582">c</span><span class="op" id="4524583">.</span><span class="ident" id="4524584">state</span>&nbsp;<span class="op" id="4524590">==</span>&nbsp;<span class="ident" id="4524593">d</span><span class="op" id="4524594">.</span><span class="ident" id="4524595">state</span>&nbsp;<span class="op" id="4524601">&amp;&amp;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524606">c</span><span class="op" id="4524607">.</span><span class="ident" id="4524608">delim</span>&nbsp;<span class="op" id="4524614">==</span>&nbsp;<span class="ident" id="4524617">d</span><span class="op" id="4524618">.</span><span class="ident" id="4524619">delim</span>&nbsp;<span class="op" id="4524625">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524630">c</span><span class="op" id="4524631">.</span><span class="ident" id="4524632">urlPart</span>&nbsp;<span class="op" id="4524640">==</span>&nbsp;<span class="ident" id="4524643">d</span><span class="op" id="4524644">.</span><span class="ident" id="4524645">urlPart</span>&nbsp;<span class="op" id="4524653">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524658">c</span><span class="op" id="4524659">.</span><span class="ident" id="4524660">jsCtx</span>&nbsp;<span class="op" id="4524666">==</span>&nbsp;<span class="ident" id="4524669">d</span><span class="op" id="4524670">.</span><span class="ident" id="4524671">jsCtx</span>&nbsp;<span class="op" id="4524677">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524682">c</span><span class="op" id="4524683">.</span><span class="ident" id="4524684">attr</span>&nbsp;<span class="op" id="4524689">==</span>&nbsp;<span class="ident" id="4524692">d</span><span class="op" id="4524693">.</span><span class="ident" id="4524694">attr</span>&nbsp;<span class="op" id="4524699">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524704">c</span><span class="op" id="4524705">.</span><span class="ident" id="4524706">element</span>&nbsp;<span class="op" id="4524714">==</span>&nbsp;<span class="ident" id="4524717">d</span><span class="op" id="4524718">.</span><span class="ident" id="4524719">element</span>&nbsp;<span class="op" id="4524727">&amp;&amp;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524732">c</span><span class="op" id="4524733">.</span><span class="ident" id="4524734">err</span>&nbsp;<span class="op" id="4524738">==</span>&nbsp;<span class="ident" id="4524741">d</span><span class="op" id="4524742">.</span><span class="ident" id="4524743">err</span><br>
<span class="lineno"></span><span class="op" id="4524747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4524750">//&nbsp;mangle&nbsp;produces&nbsp;an&nbsp;identifier&nbsp;that&nbsp;includes&nbsp;a&nbsp;suffix&nbsp;that&nbsp;distinguishes&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4524828">//&nbsp;from&nbsp;template&nbsp;names&nbsp;mangled&nbsp;with&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno">45</span><span class="keyword" id="4524884">func</span>&nbsp;<span class="op" id="4524889">(</span><span class="ident" id="4524890">c</span>&nbsp;<span class="ident" id="4524892">context</span><span class="op" id="4524899">)</span>&nbsp;<span class="ident" id="4524901">mangle</span><span class="op" id="4524907">(</span><span class="ident" id="4524908">templateName</span>&nbsp;<span class="builtintype" id="4524921">string</span><span class="op" id="4524927">)</span>&nbsp;<span class="builtintype" id="4524929">string</span>&nbsp;<span class="op" id="4524936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4524939">//&nbsp;The&nbsp;mangled&nbsp;name&nbsp;for&nbsp;the&nbsp;default&nbsp;context&nbsp;is&nbsp;the&nbsp;input&nbsp;templateName.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525011">if</span>&nbsp;<span class="ident" id="4525014">c</span><span class="op" id="4525015">.</span><span class="ident" id="4525016">state</span>&nbsp;<span class="op" id="4525022">==</span>&nbsp;<span class="ident" id="4525025">stateText</span>&nbsp;<span class="op" id="4525035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525039">return</span>&nbsp;<span class="ident" id="4525046">templateName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4525060">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525063">s</span>&nbsp;<span class="op" id="4525065">:=</span>&nbsp;<span class="ident" id="4525068">templateName</span>&nbsp;<span class="op" id="4525081">+</span>&nbsp;<span class="string" id="4525083">&#34;$htmltemplate_&#34;</span>&nbsp;<span class="op" id="4525100">+</span>&nbsp;<span class="ident" id="4525102">c</span><span class="op" id="4525103">.</span><span class="ident" id="4525104">state</span><span class="op" id="4525109">.</span><span class="ident" id="4525110">String</span><span class="op" id="4525116">(</span><span class="op" id="4525117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525120">if</span>&nbsp;<span class="ident" id="4525123">c</span><span class="op" id="4525124">.</span><span class="ident" id="4525125">delim</span>&nbsp;<span class="op" id="4525131">!=</span>&nbsp;<span class="num" id="4525134">0</span>&nbsp;<span class="op" id="4525136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525140">s</span>&nbsp;<span class="op" id="4525142">+=</span>&nbsp;<span class="string" id="4525145">&#34;_&#34;</span>&nbsp;<span class="op" id="4525149">+</span>&nbsp;<span class="ident" id="4525151">c</span><span class="op" id="4525152">.</span><span class="ident" id="4525153">delim</span><span class="op" id="4525158">.</span><span class="ident" id="4525159">String</span><span class="op" id="4525165">(</span><span class="op" id="4525166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4525169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525172">if</span>&nbsp;<span class="ident" id="4525175">c</span><span class="op" id="4525176">.</span><span class="ident" id="4525177">urlPart</span>&nbsp;<span class="op" id="4525185">!=</span>&nbsp;<span class="num" id="4525188">0</span>&nbsp;<span class="op" id="4525190">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525194">s</span>&nbsp;<span class="op" id="4525196">+=</span>&nbsp;<span class="string" id="4525199">&#34;_&#34;</span>&nbsp;<span class="op" id="4525203">+</span>&nbsp;<span class="ident" id="4525205">c</span><span class="op" id="4525206">.</span><span class="ident" id="4525207">urlPart</span><span class="op" id="4525214">.</span><span class="ident" id="4525215">String</span><span class="op" id="4525221">(</span><span class="op" id="4525222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4525225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525228">if</span>&nbsp;<span class="ident" id="4525231">c</span><span class="op" id="4525232">.</span><span class="ident" id="4525233">jsCtx</span>&nbsp;<span class="op" id="4525239">!=</span>&nbsp;<span class="num" id="4525242">0</span>&nbsp;<span class="op" id="4525244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525248">s</span>&nbsp;<span class="op" id="4525250">+=</span>&nbsp;<span class="string" id="4525253">&#34;_&#34;</span>&nbsp;<span class="op" id="4525257">+</span>&nbsp;<span class="ident" id="4525259">c</span><span class="op" id="4525260">.</span><span class="ident" id="4525261">jsCtx</span><span class="op" id="4525266">.</span><span class="ident" id="4525267">String</span><span class="op" id="4525273">(</span><span class="op" id="4525274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4525277">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525280">if</span>&nbsp;<span class="ident" id="4525283">c</span><span class="op" id="4525284">.</span><span class="ident" id="4525285">attr</span>&nbsp;<span class="op" id="4525290">!=</span>&nbsp;<span class="num" id="4525293">0</span>&nbsp;<span class="op" id="4525295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525299">s</span>&nbsp;<span class="op" id="4525301">+=</span>&nbsp;<span class="string" id="4525304">&#34;_&#34;</span>&nbsp;<span class="op" id="4525308">+</span>&nbsp;<span class="ident" id="4525310">c</span><span class="op" id="4525311">.</span><span class="ident" id="4525312">attr</span><span class="op" id="4525316">.</span><span class="ident" id="4525317">String</span><span class="op" id="4525323">(</span><span class="op" id="4525324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4525327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525330">if</span>&nbsp;<span class="ident" id="4525333">c</span><span class="op" id="4525334">.</span><span class="ident" id="4525335">element</span>&nbsp;<span class="op" id="4525343">!=</span>&nbsp;<span class="num" id="4525346">0</span>&nbsp;<span class="op" id="4525348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525352">s</span>&nbsp;<span class="op" id="4525354">+=</span>&nbsp;<span class="string" id="4525357">&#34;_&#34;</span>&nbsp;<span class="op" id="4525361">+</span>&nbsp;<span class="ident" id="4525363">c</span><span class="op" id="4525364">.</span><span class="ident" id="4525365">element</span><span class="op" id="4525372">.</span><span class="ident" id="4525373">String</span><span class="op" id="4525379">(</span><span class="op" id="4525380">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4525383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525386">return</span>&nbsp;<span class="ident" id="4525393">s</span><br>
<span class="lineno"></span><span class="op" id="4525395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4525398">//&nbsp;state&nbsp;describes&nbsp;a&nbsp;high-level&nbsp;HTML&nbsp;parser&nbsp;state.</span><br>
<span class="lineno">70</span><span class="comment" id="4525449">//</span><br>
<span class="lineno"></span><span class="comment" id="4525452">//&nbsp;It&nbsp;bounds&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;element&nbsp;stack,&nbsp;and&nbsp;by&nbsp;extension&nbsp;the&nbsp;HTML&nbsp;insertion</span><br>
<span class="lineno"></span><span class="comment" id="4525531">//&nbsp;mode,&nbsp;but&nbsp;also&nbsp;contains&nbsp;state&nbsp;that&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;anything&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4525608">//&nbsp;HTML5&nbsp;parsing&nbsp;algorithm&nbsp;because&nbsp;a&nbsp;single&nbsp;token&nbsp;production&nbsp;in&nbsp;the&nbsp;HTML</span><br>
<span class="lineno"></span><span class="comment" id="4525681">//&nbsp;grammar&nbsp;may&nbsp;contain&nbsp;embedded&nbsp;actions&nbsp;in&nbsp;a&nbsp;template.&nbsp;For&nbsp;instance,&nbsp;the&nbsp;quoted</span><br>
<span class="lineno">75</span><span class="comment" id="4525761">//&nbsp;HTML&nbsp;attribute&nbsp;produced&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4525791">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;title=&#34;Hello&nbsp;{{.World}}&#34;&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4525829">//&nbsp;is&nbsp;a&nbsp;single&nbsp;token&nbsp;in&nbsp;HTML&#39;s&nbsp;grammar&nbsp;but&nbsp;in&nbsp;a&nbsp;template&nbsp;spans&nbsp;several&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="4525907">type</span>&nbsp;<span class="ident" id="4525912">state</span>&nbsp;<span class="builtintype" id="4525918">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4525925">const</span>&nbsp;<span class="op" id="4525931">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525934">//&nbsp;stateText&nbsp;is&nbsp;parsed&nbsp;character&nbsp;data.&nbsp;An&nbsp;HTML&nbsp;parser&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525995">//&nbsp;this&nbsp;state&nbsp;when&nbsp;its&nbsp;parse&nbsp;position&nbsp;is&nbsp;outside&nbsp;an&nbsp;HTML&nbsp;tag,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526058">//&nbsp;directive,&nbsp;comment,&nbsp;and&nbsp;special&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526108">stateText</span>&nbsp;<span class="ident" id="4526118">state</span>&nbsp;<span class="op" id="4526124">=</span>&nbsp;<span class="ident" id="4526126">iota</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526132">//&nbsp;stateTag&nbsp;occurs&nbsp;before&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;tag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526198">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526208">//&nbsp;stateAttrName&nbsp;occurs&nbsp;inside&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526259">//&nbsp;It&nbsp;occurs&nbsp;between&nbsp;the&nbsp;^&#39;s&nbsp;in&nbsp;`&nbsp;^name^&nbsp;=&nbsp;value`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526311">stateAttrName</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526326">//&nbsp;stateAfterName&nbsp;occurs&nbsp;after&nbsp;an&nbsp;attr&nbsp;name&nbsp;has&nbsp;ended&nbsp;but&nbsp;before&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526396">//&nbsp;equals&nbsp;sign.&nbsp;It&nbsp;occurs&nbsp;between&nbsp;the&nbsp;^&#39;s&nbsp;in&nbsp;`&nbsp;name^&nbsp;^=&nbsp;value`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526461">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526477">//&nbsp;stateBeforeValue&nbsp;occurs&nbsp;after&nbsp;the&nbsp;equals&nbsp;sign&nbsp;but&nbsp;before&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526549">//&nbsp;It&nbsp;occurs&nbsp;between&nbsp;the&nbsp;^&#39;s&nbsp;in&nbsp;`&nbsp;name&nbsp;=^&nbsp;^value`.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526601">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526619">//&nbsp;stateHTMLCmt&nbsp;occurs&nbsp;inside&nbsp;an&nbsp;&lt;!--&nbsp;HTML&nbsp;comment&nbsp;--&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526676">stateHTMLCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526690">//&nbsp;stateRCDATA&nbsp;occurs&nbsp;inside&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;(&lt;textarea&gt;&nbsp;or&nbsp;&lt;title&gt;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526762">//&nbsp;as&nbsp;described&nbsp;at&nbsp;http://www.w3.org/TR/html5/syntax.html#elements-0</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526832">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526845">//&nbsp;stateAttr&nbsp;occurs&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;whose&nbsp;content&nbsp;is&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526914">stateAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526925">//&nbsp;stateURL&nbsp;occurs&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;whose&nbsp;content&nbsp;is&nbsp;a&nbsp;URL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526994">stateURL</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527004">//&nbsp;stateJS&nbsp;occurs&nbsp;inside&nbsp;an&nbsp;event&nbsp;handler&nbsp;or&nbsp;script&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527066">stateJS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527075">//&nbsp;stateJSDqStr&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;JavaScript&nbsp;double&nbsp;quoted&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527141">stateJSDqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527155">//&nbsp;stateJSSqStr&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;JavaScript&nbsp;single&nbsp;quoted&nbsp;string.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527221">stateJSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527235">//&nbsp;stateJSRegexp&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;JavaScript&nbsp;regexp&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527296">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527311">//&nbsp;stateJSBlockCmt&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;JavaScript&nbsp;/*&nbsp;block&nbsp;comment&nbsp;*/.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527379">stateJSBlockCmt</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527396">//&nbsp;stateJSLineCmt&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;JavaScript&nbsp;//&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527459">stateJSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527475">//&nbsp;stateCSS&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;&lt;style&gt;&nbsp;element&nbsp;or&nbsp;style&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527540">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527550">//&nbsp;stateCSSDqStr&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;CSS&nbsp;double&nbsp;quoted&nbsp;string.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527610">stateCSSDqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527625">//&nbsp;stateCSSSqStr&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;CSS&nbsp;single&nbsp;quoted&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527685">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527700">//&nbsp;stateCSSDqURL&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;CSS&nbsp;double&nbsp;quoted&nbsp;url(&#34;...&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527764">stateCSSDqURL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527779">//&nbsp;stateCSSSqURL&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;CSS&nbsp;single&nbsp;quoted&nbsp;url(&#39;...&#39;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527843">stateCSSSqURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527858">//&nbsp;stateCSSURL&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;CSS&nbsp;unquoted&nbsp;url(...).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527913">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527926">//&nbsp;stateCSSBlockCmt&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;CSS&nbsp;/*&nbsp;block&nbsp;comment&nbsp;*/.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527988">stateCSSBlockCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528006">//&nbsp;stateCSSLineCmt&nbsp;occurs&nbsp;inside&nbsp;a&nbsp;CSS&nbsp;//&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528063">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528080">//&nbsp;stateError&nbsp;is&nbsp;an&nbsp;infectious&nbsp;error&nbsp;state&nbsp;outside&nbsp;any&nbsp;valid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528142">//&nbsp;HTML/CSS/JS&nbsp;construct.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528169">stateError</span><br>
<span class="lineno"></span><span class="op" id="4528180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4528183">var</span>&nbsp;<span class="ident" id="4528187">stateNames</span>&nbsp;<span class="op" id="4528198">=</span>&nbsp;<span class="op" id="4528200">[</span><span class="op" id="4528201">...</span><span class="op" id="4528204">]</span><span class="builtintype" id="4528205">string</span><span class="op" id="4528211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528214">stateText</span><span class="op" id="4528223">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528232">&#34;stateText&#34;</span><span class="op" id="4528243">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528246">stateTag</span><span class="op" id="4528254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528264">&#34;stateTag&#34;</span><span class="op" id="4528274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528277">stateAttrName</span><span class="op" id="4528290">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528295">&#34;stateAttrName&#34;</span><span class="op" id="4528310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528313">stateAfterName</span><span class="op" id="4528327">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4528331">&#34;stateAfterName&#34;</span><span class="op" id="4528347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528350">stateBeforeValue</span><span class="op" id="4528366">:</span>&nbsp;<span class="string" id="4528368">&#34;stateBeforeValue&#34;</span><span class="op" id="4528386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528389">stateHTMLCmt</span><span class="op" id="4528401">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528407">&#34;stateHTMLCmt&#34;</span><span class="op" id="4528421">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528424">stateRCDATA</span><span class="op" id="4528435">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528442">&#34;stateRCDATA&#34;</span><span class="op" id="4528455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528458">stateAttr</span><span class="op" id="4528467">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528476">&#34;stateAttr&#34;</span><span class="op" id="4528487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528490">stateURL</span><span class="op" id="4528498">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528508">&#34;stateURL&#34;</span><span class="op" id="4528518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528521">stateJS</span><span class="op" id="4528528">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528539">&#34;stateJS&#34;</span><span class="op" id="4528548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528551">stateJSDqStr</span><span class="op" id="4528563">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528569">&#34;stateJSDqStr&#34;</span><span class="op" id="4528583">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528586">stateJSSqStr</span><span class="op" id="4528598">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528604">&#34;stateJSSqStr&#34;</span><span class="op" id="4528618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528621">stateJSRegexp</span><span class="op" id="4528634">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528639">&#34;stateJSRegexp&#34;</span><span class="op" id="4528654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528657">stateJSBlockCmt</span><span class="op" id="4528672">:</span>&nbsp;&nbsp;<span class="string" id="4528675">&#34;stateJSBlockCmt&#34;</span><span class="op" id="4528692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528695">stateJSLineCmt</span><span class="op" id="4528709">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4528713">&#34;stateJSLineCmt&#34;</span><span class="op" id="4528729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528732">stateCSS</span><span class="op" id="4528740">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528750">&#34;stateCSS&#34;</span><span class="op" id="4528760">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528763">stateCSSDqStr</span><span class="op" id="4528776">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528781">&#34;stateCSSDqStr&#34;</span><span class="op" id="4528796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528799">stateCSSSqStr</span><span class="op" id="4528812">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528817">&#34;stateCSSSqStr&#34;</span><span class="op" id="4528832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528835">stateCSSDqURL</span><span class="op" id="4528848">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528853">&#34;stateCSSDqURL&#34;</span><span class="op" id="4528868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528871">stateCSSSqURL</span><span class="op" id="4528884">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528889">&#34;stateCSSSqURL&#34;</span><span class="op" id="4528904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528907">stateCSSURL</span><span class="op" id="4528918">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528925">&#34;stateCSSURL&#34;</span><span class="op" id="4528938">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528941">stateCSSBlockCmt</span><span class="op" id="4528957">:</span>&nbsp;<span class="string" id="4528959">&#34;stateCSSBlockCmt&#34;</span><span class="op" id="4528977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528980">stateCSSLineCmt</span><span class="op" id="4528995">:</span>&nbsp;&nbsp;<span class="string" id="4528998">&#34;stateCSSLineCmt&#34;</span><span class="op" id="4529015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529018">stateError</span><span class="op" id="4529028">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4529036">&#34;stateError&#34;</span><span class="op" id="4529048">,</span><br>
<span class="lineno"></span><span class="op" id="4529050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4529053">func</span>&nbsp;<span class="op" id="4529058">(</span><span class="ident" id="4529059">s</span>&nbsp;<span class="ident" id="4529061">state</span><span class="op" id="4529066">)</span>&nbsp;<span class="ident" id="4529068">String</span><span class="op" id="4529074">(</span><span class="op" id="4529075">)</span>&nbsp;<span class="builtintype" id="4529077">string</span>&nbsp;<span class="op" id="4529084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529087">if</span>&nbsp;<span class="builtintype" id="4529090">int</span><span class="op" id="4529093">(</span><span class="ident" id="4529094">s</span><span class="op" id="4529095">)</span>&nbsp;<span class="op" id="4529097">&lt;</span>&nbsp;<span class="builtinfunc" id="4529099">len</span><span class="op" id="4529102">(</span><span class="ident" id="4529103">stateNames</span><span class="op" id="4529113">)</span>&nbsp;<span class="op" id="4529115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529119">return</span>&nbsp;<span class="ident" id="4529126">stateNames</span><span class="op" id="4529136">[</span><span class="ident" id="4529137">s</span><span class="op" id="4529138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4529141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529144">return</span>&nbsp;<span class="ident" id="4529151">fmt</span><span class="op" id="4529154">.</span><span class="ident" id="4529155">Sprintf</span><span class="op" id="4529162">(</span><span class="string" id="4529163">&#34;illegal&nbsp;state&nbsp;%d&#34;</span><span class="op" id="4529181">,</span>&nbsp;<span class="builtintype" id="4529183">int</span><span class="op" id="4529186">(</span><span class="ident" id="4529187">s</span><span class="op" id="4529188">)</span><span class="op" id="4529189">)</span><br>
<span class="lineno">170</span><span class="op" id="4529191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4529194">//&nbsp;isComment&nbsp;is&nbsp;true&nbsp;for&nbsp;any&nbsp;state&nbsp;that&nbsp;contains&nbsp;content&nbsp;meant&nbsp;for&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4529270">//&nbsp;authors&nbsp;&amp;&nbsp;maintainers,&nbsp;not&nbsp;for&nbsp;end-users&nbsp;or&nbsp;machines.</span><br>
<span class="lineno"></span><span class="keyword" id="4529327">func</span>&nbsp;<span class="ident" id="4529332">isComment</span><span class="op" id="4529341">(</span><span class="ident" id="4529342">s</span>&nbsp;<span class="ident" id="4529344">state</span><span class="op" id="4529349">)</span>&nbsp;<span class="builtintype" id="4529351">bool</span>&nbsp;<span class="op" id="4529356">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529359">switch</span>&nbsp;<span class="ident" id="4529366">s</span>&nbsp;<span class="op" id="4529368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529371">case</span>&nbsp;<span class="ident" id="4529376">stateHTMLCmt</span><span class="op" id="4529388">,</span>&nbsp;<span class="ident" id="4529390">stateJSBlockCmt</span><span class="op" id="4529405">,</span>&nbsp;<span class="ident" id="4529407">stateJSLineCmt</span><span class="op" id="4529421">,</span>&nbsp;<span class="ident" id="4529423">stateCSSBlockCmt</span><span class="op" id="4529439">,</span>&nbsp;<span class="ident" id="4529441">stateCSSLineCmt</span><span class="op" id="4529456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529460">return</span>&nbsp;<span class="builtintype" id="4529467">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4529473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529476">return</span>&nbsp;<span class="builtintype" id="4529483">false</span><br>
<span class="lineno">180</span><span class="op" id="4529489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4529492">//&nbsp;isInTag&nbsp;return&nbsp;whether&nbsp;s&nbsp;occurs&nbsp;solely&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="4529554">func</span>&nbsp;<span class="ident" id="4529559">isInTag</span><span class="op" id="4529566">(</span><span class="ident" id="4529567">s</span>&nbsp;<span class="ident" id="4529569">state</span><span class="op" id="4529574">)</span>&nbsp;<span class="builtintype" id="4529576">bool</span>&nbsp;<span class="op" id="4529581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529584">switch</span>&nbsp;<span class="ident" id="4529591">s</span>&nbsp;<span class="op" id="4529593">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529596">case</span>&nbsp;<span class="ident" id="4529601">stateTag</span><span class="op" id="4529609">,</span>&nbsp;<span class="ident" id="4529611">stateAttrName</span><span class="op" id="4529624">,</span>&nbsp;<span class="ident" id="4529626">stateAfterName</span><span class="op" id="4529640">,</span>&nbsp;<span class="ident" id="4529642">stateBeforeValue</span><span class="op" id="4529658">,</span>&nbsp;<span class="ident" id="4529660">stateAttr</span><span class="op" id="4529669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529673">return</span>&nbsp;<span class="builtintype" id="4529680">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4529686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4529689">return</span>&nbsp;<span class="builtintype" id="4529696">false</span><br>
<span class="lineno"></span><span class="op" id="4529702">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="4529705">//&nbsp;delim&nbsp;is&nbsp;the&nbsp;delimiter&nbsp;that&nbsp;will&nbsp;end&nbsp;the&nbsp;current&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="4529773">type</span>&nbsp;<span class="ident" id="4529778">delim</span>&nbsp;<span class="builtintype" id="4529784">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4529791">const</span>&nbsp;<span class="op" id="4529797">(</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4529800">//&nbsp;delimNone&nbsp;occurs&nbsp;outside&nbsp;any&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529844">delimNone</span>&nbsp;<span class="ident" id="4529854">delim</span>&nbsp;<span class="op" id="4529860">=</span>&nbsp;<span class="ident" id="4529862">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4529868">//&nbsp;delimDoubleQuote&nbsp;occurs&nbsp;when&nbsp;a&nbsp;double&nbsp;quote&nbsp;(&#34;)&nbsp;closes&nbsp;the&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529942">delimDoubleQuote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4529960">//&nbsp;delimSingleQuote&nbsp;occurs&nbsp;when&nbsp;a&nbsp;single&nbsp;quote&nbsp;(&#39;)&nbsp;closes&nbsp;the&nbsp;attribute.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530034">delimSingleQuote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530052">//&nbsp;delimSpaceOrTagEnd&nbsp;occurs&nbsp;when&nbsp;a&nbsp;space&nbsp;or&nbsp;right&nbsp;angle&nbsp;bracket&nbsp;(&gt;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530122">//&nbsp;closes&nbsp;the&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530148">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span><span class="op" id="4530167">)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="4530170">var</span>&nbsp;<span class="ident" id="4530174">delimNames</span>&nbsp;<span class="op" id="4530185">=</span>&nbsp;<span class="op" id="4530187">[</span><span class="op" id="4530188">...</span><span class="op" id="4530191">]</span><span class="builtintype" id="4530192">string</span><span class="op" id="4530198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530201">delimNone</span><span class="op" id="4530210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4530221">&#34;delimNone&#34;</span><span class="op" id="4530232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530235">delimDoubleQuote</span><span class="op" id="4530251">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4530255">&#34;delimDoubleQuote&#34;</span><span class="op" id="4530273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530276">delimSingleQuote</span><span class="op" id="4530292">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4530296">&#34;delimSingleQuote&#34;</span><span class="op" id="4530314">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530317">delimSpaceOrTagEnd</span><span class="op" id="4530335">:</span>&nbsp;<span class="string" id="4530337">&#34;delimSpaceOrTagEnd&#34;</span><span class="op" id="4530357">,</span><br>
<span class="lineno"></span><span class="op" id="4530359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4530362">func</span>&nbsp;<span class="op" id="4530367">(</span><span class="ident" id="4530368">d</span>&nbsp;<span class="ident" id="4530370">delim</span><span class="op" id="4530375">)</span>&nbsp;<span class="ident" id="4530377">String</span><span class="op" id="4530383">(</span><span class="op" id="4530384">)</span>&nbsp;<span class="builtintype" id="4530386">string</span>&nbsp;<span class="op" id="4530393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4530396">if</span>&nbsp;<span class="builtintype" id="4530399">int</span><span class="op" id="4530402">(</span><span class="ident" id="4530403">d</span><span class="op" id="4530404">)</span>&nbsp;<span class="op" id="4530406">&lt;</span>&nbsp;<span class="builtinfunc" id="4530408">len</span><span class="op" id="4530411">(</span><span class="ident" id="4530412">delimNames</span><span class="op" id="4530422">)</span>&nbsp;<span class="op" id="4530424">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4530428">return</span>&nbsp;<span class="ident" id="4530435">delimNames</span><span class="op" id="4530445">[</span><span class="ident" id="4530446">d</span><span class="op" id="4530447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4530450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4530453">return</span>&nbsp;<span class="ident" id="4530460">fmt</span><span class="op" id="4530463">.</span><span class="ident" id="4530464">Sprintf</span><span class="op" id="4530471">(</span><span class="string" id="4530472">&#34;illegal&nbsp;delim&nbsp;%d&#34;</span><span class="op" id="4530490">,</span>&nbsp;<span class="builtintype" id="4530492">int</span><span class="op" id="4530495">(</span><span class="ident" id="4530496">d</span><span class="op" id="4530497">)</span><span class="op" id="4530498">)</span><br>
<span class="lineno"></span><span class="op" id="4530500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="4530503">//&nbsp;urlPart&nbsp;identifies&nbsp;a&nbsp;part&nbsp;in&nbsp;an&nbsp;RFC&nbsp;3986&nbsp;hierarchical&nbsp;URL&nbsp;to&nbsp;allow&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4530583">//&nbsp;encoding&nbsp;strategies.</span><br>
<span class="lineno"></span><span class="keyword" id="4530607">type</span>&nbsp;<span class="ident" id="4530612">urlPart</span>&nbsp;<span class="builtintype" id="4530620">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4530627">const</span>&nbsp;<span class="op" id="4530633">(</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530636">//&nbsp;urlPartNone&nbsp;occurs&nbsp;when&nbsp;not&nbsp;in&nbsp;a&nbsp;URL,&nbsp;or&nbsp;possibly&nbsp;at&nbsp;the&nbsp;start:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530704">//&nbsp;^&nbsp;in&nbsp;&#34;^http://auth/path?k=v#frag&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530743">urlPartNone</span>&nbsp;<span class="ident" id="4530755">urlPart</span>&nbsp;<span class="op" id="4530763">=</span>&nbsp;<span class="ident" id="4530765">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530771">//&nbsp;urlPartPreQuery&nbsp;occurs&nbsp;in&nbsp;the&nbsp;scheme,&nbsp;authority,&nbsp;or&nbsp;path;&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530845">//&nbsp;^s&nbsp;in&nbsp;&#34;h^ttp://auth/path^?k=v#frag&#34;.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530886">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530903">//&nbsp;urlPartQueryOrFrag&nbsp;occurs&nbsp;in&nbsp;the&nbsp;query&nbsp;portion&nbsp;between&nbsp;the&nbsp;^s&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4530972">//&nbsp;&#34;http://auth/path?^k=v#frag^&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531007">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4531027">//&nbsp;urlPartUnknown&nbsp;occurs&nbsp;due&nbsp;to&nbsp;joining&nbsp;of&nbsp;contexts&nbsp;both&nbsp;before&nbsp;and</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4531096">//&nbsp;after&nbsp;the&nbsp;query&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531127">urlPartUnknown</span><br>
<span class="lineno"></span><span class="op" id="4531142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4531145">var</span>&nbsp;<span class="ident" id="4531149">urlPartNames</span>&nbsp;<span class="op" id="4531162">=</span>&nbsp;<span class="op" id="4531164">[</span><span class="op" id="4531165">...</span><span class="op" id="4531168">]</span><span class="builtintype" id="4531169">string</span><span class="op" id="4531175">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531178">urlPartNone</span><span class="op" id="4531189">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4531198">&#34;urlPartNone&#34;</span><span class="op" id="4531211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531214">urlPartPreQuery</span><span class="op" id="4531229">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4531234">&#34;urlPartPreQuery&#34;</span><span class="op" id="4531251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531254">urlPartQueryOrFrag</span><span class="op" id="4531272">:</span>&nbsp;<span class="string" id="4531274">&#34;urlPartQueryOrFrag&#34;</span><span class="op" id="4531294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531297">urlPartUnknown</span><span class="op" id="4531311">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4531317">&#34;urlPartUnknown&#34;</span><span class="op" id="4531333">,</span><br>
<span class="lineno"></span><span class="op" id="4531335">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4531338">func</span>&nbsp;<span class="op" id="4531343">(</span><span class="ident" id="4531344">u</span>&nbsp;<span class="ident" id="4531346">urlPart</span><span class="op" id="4531353">)</span>&nbsp;<span class="ident" id="4531355">String</span><span class="op" id="4531361">(</span><span class="op" id="4531362">)</span>&nbsp;<span class="builtintype" id="4531364">string</span>&nbsp;<span class="op" id="4531371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531374">if</span>&nbsp;<span class="builtintype" id="4531377">int</span><span class="op" id="4531380">(</span><span class="ident" id="4531381">u</span><span class="op" id="4531382">)</span>&nbsp;<span class="op" id="4531384">&lt;</span>&nbsp;<span class="builtinfunc" id="4531386">len</span><span class="op" id="4531389">(</span><span class="ident" id="4531390">urlPartNames</span><span class="op" id="4531402">)</span>&nbsp;<span class="op" id="4531404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531408">return</span>&nbsp;<span class="ident" id="4531415">urlPartNames</span><span class="op" id="4531427">[</span><span class="ident" id="4531428">u</span><span class="op" id="4531429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4531432">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531435">return</span>&nbsp;<span class="ident" id="4531442">fmt</span><span class="op" id="4531445">.</span><span class="ident" id="4531446">Sprintf</span><span class="op" id="4531453">(</span><span class="string" id="4531454">&#34;illegal&nbsp;urlPart&nbsp;%d&#34;</span><span class="op" id="4531474">,</span>&nbsp;<span class="builtintype" id="4531476">int</span><span class="op" id="4531479">(</span><span class="ident" id="4531480">u</span><span class="op" id="4531481">)</span><span class="op" id="4531482">)</span><br>
<span class="lineno"></span><span class="op" id="4531484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4531487">//&nbsp;jsCtx&nbsp;determines&nbsp;whether&nbsp;a&nbsp;&#39;/&#39;&nbsp;starts&nbsp;a&nbsp;regular&nbsp;expression&nbsp;literal&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4531562">//&nbsp;division&nbsp;operator.</span><br>
<span class="lineno">255</span><span class="keyword" id="4531584">type</span>&nbsp;<span class="ident" id="4531589">jsCtx</span>&nbsp;<span class="builtintype" id="4531595">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4531602">const</span>&nbsp;<span class="op" id="4531608">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4531611">//&nbsp;jsCtxRegexp&nbsp;occurs&nbsp;where&nbsp;a&nbsp;&#39;/&#39;&nbsp;would&nbsp;start&nbsp;a&nbsp;regexp&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531676">jsCtxRegexp</span>&nbsp;<span class="ident" id="4531688">jsCtx</span>&nbsp;<span class="op" id="4531694">=</span>&nbsp;<span class="ident" id="4531696">iota</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4531702">//&nbsp;jsCtxDivOp&nbsp;occurs&nbsp;where&nbsp;a&nbsp;&#39;/&#39;&nbsp;would&nbsp;start&nbsp;a&nbsp;division&nbsp;operator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531769">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4531781">//&nbsp;jsCtxUnknown&nbsp;occurs&nbsp;where&nbsp;a&nbsp;&#39;/&#39;&nbsp;is&nbsp;ambiguous&nbsp;due&nbsp;to&nbsp;context&nbsp;joining.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531854">jsCtxUnknown</span><br>
<span class="lineno"></span><span class="op" id="4531867">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="4531870">func</span>&nbsp;<span class="op" id="4531875">(</span><span class="ident" id="4531876">c</span>&nbsp;<span class="ident" id="4531878">jsCtx</span><span class="op" id="4531883">)</span>&nbsp;<span class="ident" id="4531885">String</span><span class="op" id="4531891">(</span><span class="op" id="4531892">)</span>&nbsp;<span class="builtintype" id="4531894">string</span>&nbsp;<span class="op" id="4531901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531904">switch</span>&nbsp;<span class="ident" id="4531911">c</span>&nbsp;<span class="op" id="4531913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531916">case</span>&nbsp;<span class="ident" id="4531921">jsCtxRegexp</span><span class="op" id="4531932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531936">return</span>&nbsp;<span class="string" id="4531943">&#34;jsCtxRegexp&#34;</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531958">case</span>&nbsp;<span class="ident" id="4531963">jsCtxDivOp</span><span class="op" id="4531973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531977">return</span>&nbsp;<span class="string" id="4531984">&#34;jsCtxDivOp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4531998">case</span>&nbsp;<span class="ident" id="4532003">jsCtxUnknown</span><span class="op" id="4532015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532019">return</span>&nbsp;<span class="string" id="4532026">&#34;jsCtxUnknown&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532042">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532045">return</span>&nbsp;<span class="ident" id="4532052">fmt</span><span class="op" id="4532055">.</span><span class="ident" id="4532056">Sprintf</span><span class="op" id="4532063">(</span><span class="string" id="4532064">&#34;illegal&nbsp;jsCtx&nbsp;%d&#34;</span><span class="op" id="4532082">,</span>&nbsp;<span class="builtintype" id="4532084">int</span><span class="op" id="4532087">(</span><span class="ident" id="4532088">c</span><span class="op" id="4532089">)</span><span class="op" id="4532090">)</span><br>
<span class="lineno"></span><span class="op" id="4532092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4532095">//&nbsp;element&nbsp;identifies&nbsp;the&nbsp;HTML&nbsp;element&nbsp;when&nbsp;inside&nbsp;a&nbsp;start&nbsp;tag&nbsp;or&nbsp;special&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4532175">//&nbsp;Certain&nbsp;HTML&nbsp;element&nbsp;(for&nbsp;example&nbsp;&lt;script&gt;&nbsp;and&nbsp;&lt;style&gt;)&nbsp;have&nbsp;bodies&nbsp;that&nbsp;are</span><br>
<span class="lineno">280</span><span class="comment" id="4532255">//&nbsp;treated&nbsp;differently&nbsp;from&nbsp;stateText&nbsp;so&nbsp;the&nbsp;element&nbsp;type&nbsp;is&nbsp;necessary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4532329">//&nbsp;transition&nbsp;into&nbsp;the&nbsp;correct&nbsp;context&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;tag&nbsp;and&nbsp;to&nbsp;identify&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4532408">//&nbsp;end&nbsp;delimiter&nbsp;for&nbsp;the&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4532439">type</span>&nbsp;<span class="ident" id="4532444">element</span>&nbsp;<span class="builtintype" id="4532452">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="4532459">const</span>&nbsp;<span class="op" id="4532465">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532468">//&nbsp;elementNone&nbsp;occurs&nbsp;outside&nbsp;a&nbsp;special&nbsp;tag&nbsp;or&nbsp;special&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532538">elementNone</span>&nbsp;<span class="ident" id="4532550">element</span>&nbsp;<span class="op" id="4532558">=</span>&nbsp;<span class="ident" id="4532560">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532566">//&nbsp;elementScript&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;raw&nbsp;text&nbsp;&lt;script&gt;&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532630">elementScript</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532645">//&nbsp;elementStyle&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;raw&nbsp;text&nbsp;&lt;style&gt;&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532707">elementStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532721">//&nbsp;elementTextarea&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;RCDATA&nbsp;&lt;textarea&gt;&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532787">elementTextarea</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532804">//&nbsp;elementTitle&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;RCDATA&nbsp;&lt;title&gt;&nbsp;element.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532864">elementTitle</span><br>
<span class="lineno"></span><span class="op" id="4532877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4532880">var</span>&nbsp;<span class="ident" id="4532884">elementNames</span>&nbsp;<span class="op" id="4532897">=</span>&nbsp;<span class="op" id="4532899">[</span><span class="op" id="4532900">...</span><span class="op" id="4532903">]</span><span class="builtintype" id="4532904">string</span><span class="op" id="4532910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532913">elementNone</span><span class="op" id="4532924">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4532930">&#34;elementNone&#34;</span><span class="op" id="4532943">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532946">elementScript</span><span class="op" id="4532959">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4532963">&#34;elementScript&#34;</span><span class="op" id="4532978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532981">elementStyle</span><span class="op" id="4532993">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4532998">&#34;elementStyle&#34;</span><span class="op" id="4533012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533015">elementTextarea</span><span class="op" id="4533030">:</span>&nbsp;<span class="string" id="4533032">&#34;elementTextarea&#34;</span><span class="op" id="4533049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533052">elementTitle</span><span class="op" id="4533064">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4533069">&#34;elementTitle&#34;</span><span class="op" id="4533083">,</span><br>
<span class="lineno"></span><span class="op" id="4533085">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="4533088">func</span>&nbsp;<span class="op" id="4533093">(</span><span class="ident" id="4533094">e</span>&nbsp;<span class="ident" id="4533096">element</span><span class="op" id="4533103">)</span>&nbsp;<span class="ident" id="4533105">String</span><span class="op" id="4533111">(</span><span class="op" id="4533112">)</span>&nbsp;<span class="builtintype" id="4533114">string</span>&nbsp;<span class="op" id="4533121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533124">if</span>&nbsp;<span class="builtintype" id="4533127">int</span><span class="op" id="4533130">(</span><span class="ident" id="4533131">e</span><span class="op" id="4533132">)</span>&nbsp;<span class="op" id="4533134">&lt;</span>&nbsp;<span class="builtinfunc" id="4533136">len</span><span class="op" id="4533139">(</span><span class="ident" id="4533140">elementNames</span><span class="op" id="4533152">)</span>&nbsp;<span class="op" id="4533154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533158">return</span>&nbsp;<span class="ident" id="4533165">elementNames</span><span class="op" id="4533177">[</span><span class="ident" id="4533178">e</span><span class="op" id="4533179">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533182">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533185">return</span>&nbsp;<span class="ident" id="4533192">fmt</span><span class="op" id="4533195">.</span><span class="ident" id="4533196">Sprintf</span><span class="op" id="4533203">(</span><span class="string" id="4533204">&#34;illegal&nbsp;element&nbsp;%d&#34;</span><span class="op" id="4533224">,</span>&nbsp;<span class="builtintype" id="4533226">int</span><span class="op" id="4533229">(</span><span class="ident" id="4533230">e</span><span class="op" id="4533231">)</span><span class="op" id="4533232">)</span><br>
<span class="lineno"></span><span class="op" id="4533234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4533237">//&nbsp;attr&nbsp;identifies&nbsp;the&nbsp;most&nbsp;recent&nbsp;HTML&nbsp;attribute&nbsp;when&nbsp;inside&nbsp;a&nbsp;start&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="4533312">type</span>&nbsp;<span class="ident" id="4533317">attr</span>&nbsp;<span class="builtintype" id="4533322">uint8</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4533329">const</span>&nbsp;<span class="op" id="4533335">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533338">//&nbsp;attrNone&nbsp;corresponds&nbsp;to&nbsp;a&nbsp;normal&nbsp;attribute&nbsp;or&nbsp;no&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533402">attrNone</span>&nbsp;<span class="ident" id="4533411">attr</span>&nbsp;<span class="op" id="4533416">=</span>&nbsp;<span class="ident" id="4533418">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533424">//&nbsp;attrScript&nbsp;corresponds&nbsp;to&nbsp;an&nbsp;event&nbsp;handler&nbsp;attribute.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533482">attrScript</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533494">//&nbsp;attrStyle&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;style&nbsp;attribute&nbsp;whose&nbsp;value&nbsp;is&nbsp;CSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533563">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533574">//&nbsp;attrURL&nbsp;corresponds&nbsp;to&nbsp;an&nbsp;attribute&nbsp;whose&nbsp;value&nbsp;is&nbsp;a&nbsp;URL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533636">attrURL</span><br>
<span class="lineno">325</span><span class="op" id="4533644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4533647">var</span>&nbsp;<span class="ident" id="4533651">attrNames</span>&nbsp;<span class="op" id="4533661">=</span>&nbsp;<span class="op" id="4533663">[</span><span class="op" id="4533664">...</span><span class="op" id="4533667">]</span><span class="builtintype" id="4533668">string</span><span class="op" id="4533674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533677">attrNone</span><span class="op" id="4533685">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4533689">&#34;attrNone&#34;</span><span class="op" id="4533699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533702">attrScript</span><span class="op" id="4533712">:</span>&nbsp;<span class="string" id="4533714">&#34;attrScript&#34;</span><span class="op" id="4533726">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533729">attrStyle</span><span class="op" id="4533738">:</span>&nbsp;&nbsp;<span class="string" id="4533741">&#34;attrStyle&#34;</span><span class="op" id="4533752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533755">attrURL</span><span class="op" id="4533762">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4533767">&#34;attrURL&#34;</span><span class="op" id="4533776">,</span><br>
<span class="lineno"></span><span class="op" id="4533778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4533781">func</span>&nbsp;<span class="op" id="4533786">(</span><span class="ident" id="4533787">a</span>&nbsp;<span class="ident" id="4533789">attr</span><span class="op" id="4533793">)</span>&nbsp;<span class="ident" id="4533795">String</span><span class="op" id="4533801">(</span><span class="op" id="4533802">)</span>&nbsp;<span class="builtintype" id="4533804">string</span>&nbsp;<span class="op" id="4533811">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533814">if</span>&nbsp;<span class="builtintype" id="4533817">int</span><span class="op" id="4533820">(</span><span class="ident" id="4533821">a</span><span class="op" id="4533822">)</span>&nbsp;<span class="op" id="4533824">&lt;</span>&nbsp;<span class="builtinfunc" id="4533826">len</span><span class="op" id="4533829">(</span><span class="ident" id="4533830">attrNames</span><span class="op" id="4533839">)</span>&nbsp;<span class="op" id="4533841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533845">return</span>&nbsp;<span class="ident" id="4533852">attrNames</span><span class="op" id="4533861">[</span><span class="ident" id="4533862">a</span><span class="op" id="4533863">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533869">return</span>&nbsp;<span class="ident" id="4533876">fmt</span><span class="op" id="4533879">.</span><span class="ident" id="4533880">Sprintf</span><span class="op" id="4533887">(</span><span class="string" id="4533888">&#34;illegal&nbsp;attr&nbsp;%d&#34;</span><span class="op" id="4533905">,</span>&nbsp;<span class="builtintype" id="4533907">int</span><span class="op" id="4533910">(</span><span class="ident" id="4533911">a</span><span class="op" id="4533912">)</span><span class="op" id="4533913">)</span><br>
<span class="lineno"></span><span class="op" id="4533915">}</span>
</div>
</body>
</html>
