<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7885913">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7885968">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7886022">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7886073">package</span>&nbsp;<span class="ident" id="7886081">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7886086">import</span>&nbsp;<span class="op" id="7886093">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7886096">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7886105">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7886112">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7886118">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7886129">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7886140">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7886150">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7886153">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="7886196">func</span>&nbsp;<span class="ident" id="7886201">TestBasicEncoderDecoder</span><span class="op" id="7886224">(</span><span class="ident" id="7886225">t</span>&nbsp;<span class="op" id="7886227">*</span><span class="ident" id="7886228">testing</span><span class="op" id="7886235">.</span><span class="ident" id="7886236">T</span><span class="op" id="7886237">)</span>&nbsp;<span class="op" id="7886239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7886242">var</span>&nbsp;<span class="ident" id="7886246">values</span>&nbsp;<span class="op" id="7886253">=</span>&nbsp;<span class="op" id="7886255">[</span><span class="op" id="7886256">]</span><span class="keyword" id="7886257">interface</span><span class="op" id="7886266">{</span><span class="op" id="7886267">}</span><span class="op" id="7886268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886272">true</span><span class="op" id="7886276">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886280">int</span><span class="op" id="7886283">(</span><span class="num" id="7886284">123</span><span class="op" id="7886287">)</span><span class="op" id="7886288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886292">int8</span><span class="op" id="7886296">(</span><span class="num" id="7886297">123</span><span class="op" id="7886300">)</span><span class="op" id="7886301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886305">int16</span><span class="op" id="7886310">(</span><span class="op" id="7886311">-</span><span class="num" id="7886312">12345</span><span class="op" id="7886317">)</span><span class="op" id="7886318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886322">int32</span><span class="op" id="7886327">(</span><span class="num" id="7886328">123456</span><span class="op" id="7886334">)</span><span class="op" id="7886335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886339">int64</span><span class="op" id="7886344">(</span><span class="op" id="7886345">-</span><span class="num" id="7886346">1234567</span><span class="op" id="7886353">)</span><span class="op" id="7886354">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886358">uint</span><span class="op" id="7886362">(</span><span class="num" id="7886363">123</span><span class="op" id="7886366">)</span><span class="op" id="7886367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886371">uint8</span><span class="op" id="7886376">(</span><span class="num" id="7886377">123</span><span class="op" id="7886380">)</span><span class="op" id="7886381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886385">uint16</span><span class="op" id="7886391">(</span><span class="num" id="7886392">12345</span><span class="op" id="7886397">)</span><span class="op" id="7886398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886402">uint32</span><span class="op" id="7886408">(</span><span class="num" id="7886409">123456</span><span class="op" id="7886415">)</span><span class="op" id="7886416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886420">uint64</span><span class="op" id="7886426">(</span><span class="num" id="7886427">1234567</span><span class="op" id="7886434">)</span><span class="op" id="7886435">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886439">uintptr</span><span class="op" id="7886446">(</span><span class="num" id="7886447">12345678</span><span class="op" id="7886455">)</span><span class="op" id="7886456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886460">float32</span><span class="op" id="7886467">(</span><span class="num" id="7886468">1.2345</span><span class="op" id="7886474">)</span><span class="op" id="7886475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886479">float64</span><span class="op" id="7886486">(</span><span class="num" id="7886487">1.2345678</span><span class="op" id="7886496">)</span><span class="op" id="7886497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886501">complex64</span><span class="op" id="7886510">(</span><span class="num" id="7886511">1.2345</span>&nbsp;<span class="op" id="7886518">+</span>&nbsp;<span class="num" id="7886520">2.3456i</span><span class="op" id="7886527">)</span><span class="op" id="7886528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886532">complex128</span><span class="op" id="7886542">(</span><span class="num" id="7886543">1.2345678</span>&nbsp;<span class="op" id="7886553">+</span>&nbsp;<span class="num" id="7886555">2.3456789i</span><span class="op" id="7886565">)</span><span class="op" id="7886566">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7886570">[</span><span class="op" id="7886571">]</span><span class="builtintype" id="7886572">byte</span><span class="op" id="7886576">(</span><span class="string" id="7886577">&#34;hello&#34;</span><span class="op" id="7886584">)</span><span class="op" id="7886585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7886589">string</span><span class="op" id="7886595">(</span><span class="string" id="7886596">&#34;hello&#34;</span><span class="op" id="7886603">)</span><span class="op" id="7886604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7886607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7886610">for</span>&nbsp;<span class="ident" id="7886614">_</span><span class="op" id="7886615">,</span>&nbsp;<span class="ident" id="7886617">value</span>&nbsp;<span class="op" id="7886623">:=</span>&nbsp;<span class="keyword" id="7886626">range</span>&nbsp;<span class="ident" id="7886632">values</span>&nbsp;<span class="op" id="7886639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886643">b</span>&nbsp;<span class="op" id="7886645">:=</span>&nbsp;<span class="builtinfunc" id="7886648">new</span><span class="op" id="7886651">(</span><span class="ident" id="7886652">bytes</span><span class="op" id="7886657">.</span><span class="ident" id="7886658">Buffer</span><span class="op" id="7886664">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886668">enc</span>&nbsp;<span class="op" id="7886672">:=</span>&nbsp;<span class="ident" id="7886675">NewEncoder</span><span class="op" id="7886685">(</span><span class="ident" id="7886686">b</span><span class="op" id="7886687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886691">err</span>&nbsp;<span class="op" id="7886695">:=</span>&nbsp;<span class="ident" id="7886698">enc</span><span class="op" id="7886701">.</span><span class="ident" id="7886702">Encode</span><span class="op" id="7886708">(</span><span class="ident" id="7886709">value</span><span class="op" id="7886714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7886718">if</span>&nbsp;<span class="ident" id="7886721">err</span>&nbsp;<span class="op" id="7886725">!=</span>&nbsp;<span class="ident" id="7886728">nil</span>&nbsp;<span class="op" id="7886732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886737">t</span><span class="op" id="7886738">.</span><span class="ident" id="7886739">Error</span><span class="op" id="7886744">(</span><span class="string" id="7886745">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7886760">,</span>&nbsp;<span class="ident" id="7886762">err</span><span class="op" id="7886765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7886769">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886773">dec</span>&nbsp;<span class="op" id="7886777">:=</span>&nbsp;<span class="ident" id="7886780">NewDecoder</span><span class="op" id="7886790">(</span><span class="ident" id="7886791">b</span><span class="op" id="7886792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886796">result</span>&nbsp;<span class="op" id="7886803">:=</span>&nbsp;<span class="ident" id="7886806">reflect</span><span class="op" id="7886813">.</span><span class="ident" id="7886814">New</span><span class="op" id="7886817">(</span><span class="ident" id="7886818">reflect</span><span class="op" id="7886825">.</span><span class="ident" id="7886826">TypeOf</span><span class="op" id="7886832">(</span><span class="ident" id="7886833">value</span><span class="op" id="7886838">)</span><span class="op" id="7886839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886843">err</span>&nbsp;<span class="op" id="7886847">=</span>&nbsp;<span class="ident" id="7886849">dec</span><span class="op" id="7886852">.</span><span class="ident" id="7886853">Decode</span><span class="op" id="7886859">(</span><span class="ident" id="7886860">result</span><span class="op" id="7886866">.</span><span class="ident" id="7886867">Interface</span><span class="op" id="7886876">(</span><span class="op" id="7886877">)</span><span class="op" id="7886878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7886882">if</span>&nbsp;<span class="ident" id="7886885">err</span>&nbsp;<span class="op" id="7886889">!=</span>&nbsp;<span class="ident" id="7886892">nil</span>&nbsp;<span class="op" id="7886896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7886901">t</span><span class="op" id="7886902">.</span><span class="ident" id="7886903">Fatalf</span><span class="op" id="7886909">(</span><span class="string" id="7886910">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="7886934">,</span>&nbsp;<span class="ident" id="7886936">reflect</span><span class="op" id="7886943">.</span><span class="ident" id="7886944">TypeOf</span><span class="op" id="7886950">(</span><span class="ident" id="7886951">value</span><span class="op" id="7886956">)</span><span class="op" id="7886957">,</span>&nbsp;<span class="ident" id="7886959">err</span><span class="op" id="7886962">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7886966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7886970">if</span>&nbsp;<span class="op" id="7886973">!</span><span class="ident" id="7886974">reflect</span><span class="op" id="7886981">.</span><span class="ident" id="7886982">DeepEqual</span><span class="op" id="7886991">(</span><span class="ident" id="7886992">value</span><span class="op" id="7886997">,</span>&nbsp;<span class="ident" id="7886999">result</span><span class="op" id="7887005">.</span><span class="ident" id="7887006">Elem</span><span class="op" id="7887010">(</span><span class="op" id="7887011">)</span><span class="op" id="7887012">.</span><span class="ident" id="7887013">Interface</span><span class="op" id="7887022">(</span><span class="op" id="7887023">)</span><span class="op" id="7887024">)</span>&nbsp;<span class="op" id="7887026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887031">t</span><span class="op" id="7887032">.</span><span class="ident" id="7887033">Fatalf</span><span class="op" id="7887039">(</span><span class="string" id="7887040">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7887064">,</span>&nbsp;<span class="ident" id="7887066">value</span><span class="op" id="7887071">,</span>&nbsp;<span class="ident" id="7887073">value</span><span class="op" id="7887078">,</span>&nbsp;<span class="ident" id="7887080">result</span><span class="op" id="7887086">.</span><span class="ident" id="7887087">Elem</span><span class="op" id="7887091">(</span><span class="op" id="7887092">)</span><span class="op" id="7887093">.</span><span class="ident" id="7887094">Interface</span><span class="op" id="7887103">(</span><span class="op" id="7887104">)</span><span class="op" id="7887105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7887109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7887112">}</span><br>
<span class="lineno">55</span><span class="op" id="7887114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7887117">type</span>&nbsp;<span class="ident" id="7887122">ET0</span>&nbsp;<span class="keyword" id="7887126">struct</span>&nbsp;<span class="op" id="7887133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887136">A</span>&nbsp;<span class="builtintype" id="7887138">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887143">B</span>&nbsp;<span class="builtintype" id="7887145">string</span><br>
<span class="lineno">60</span><span class="op" id="7887152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7887155">type</span>&nbsp;<span class="ident" id="7887160">ET2</span>&nbsp;<span class="keyword" id="7887164">struct</span>&nbsp;<span class="op" id="7887171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887174">X</span>&nbsp;<span class="builtintype" id="7887176">string</span><br>
<span class="lineno"></span><span class="op" id="7887183">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7887186">type</span>&nbsp;<span class="ident" id="7887191">ET1</span>&nbsp;<span class="keyword" id="7887195">struct</span>&nbsp;<span class="op" id="7887202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887205">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7887210">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887215">Et2</span>&nbsp;&nbsp;<span class="op" id="7887220">*</span><span class="ident" id="7887221">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887226">Next</span>&nbsp;<span class="op" id="7887231">*</span><span class="ident" id="7887232">ET1</span><br>
<span class="lineno">70</span><span class="op" id="7887236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7887239">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="7887289">type</span>&nbsp;<span class="ident" id="7887294">ET3</span>&nbsp;<span class="keyword" id="7887298">struct</span>&nbsp;<span class="op" id="7887305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887308">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7887322">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887327">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7887341">*</span><span class="ident" id="7887342">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887347">DifferentNext</span>&nbsp;<span class="op" id="7887361">*</span><span class="ident" id="7887362">ET1</span><br>
<span class="lineno"></span><span class="op" id="7887366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7887369">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="7887419">type</span>&nbsp;<span class="ident" id="7887424">ET4</span>&nbsp;<span class="keyword" id="7887428">struct</span>&nbsp;<span class="op" id="7887435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887438">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7887443">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887448">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="7887453">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887462">Next</span>&nbsp;<span class="builtintype" id="7887467">int</span><br>
<span class="lineno"></span><span class="op" id="7887471">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7887474">func</span>&nbsp;<span class="ident" id="7887479">TestEncoderDecoder</span><span class="op" id="7887497">(</span><span class="ident" id="7887498">t</span>&nbsp;<span class="op" id="7887500">*</span><span class="ident" id="7887501">testing</span><span class="op" id="7887508">.</span><span class="ident" id="7887509">T</span><span class="op" id="7887510">)</span>&nbsp;<span class="op" id="7887512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887515">b</span>&nbsp;<span class="op" id="7887517">:=</span>&nbsp;<span class="builtinfunc" id="7887520">new</span><span class="op" id="7887523">(</span><span class="ident" id="7887524">bytes</span><span class="op" id="7887529">.</span><span class="ident" id="7887530">Buffer</span><span class="op" id="7887536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887539">enc</span>&nbsp;<span class="op" id="7887543">:=</span>&nbsp;<span class="ident" id="7887546">NewEncoder</span><span class="op" id="7887556">(</span><span class="ident" id="7887557">b</span><span class="op" id="7887558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887561">et0</span>&nbsp;<span class="op" id="7887565">:=</span>&nbsp;<span class="builtinfunc" id="7887568">new</span><span class="op" id="7887571">(</span><span class="ident" id="7887572">ET0</span><span class="op" id="7887575">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887578">et0</span><span class="op" id="7887581">.</span><span class="ident" id="7887582">A</span>&nbsp;<span class="op" id="7887584">=</span>&nbsp;<span class="num" id="7887586">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887589">et0</span><span class="op" id="7887592">.</span><span class="ident" id="7887593">B</span>&nbsp;<span class="op" id="7887595">=</span>&nbsp;<span class="string" id="7887597">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887612">err</span>&nbsp;<span class="op" id="7887616">:=</span>&nbsp;<span class="ident" id="7887619">enc</span><span class="op" id="7887622">.</span><span class="ident" id="7887623">Encode</span><span class="op" id="7887629">(</span><span class="ident" id="7887630">et0</span><span class="op" id="7887633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7887636">if</span>&nbsp;<span class="ident" id="7887639">err</span>&nbsp;<span class="op" id="7887643">!=</span>&nbsp;<span class="ident" id="7887646">nil</span>&nbsp;<span class="op" id="7887650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887654">t</span><span class="op" id="7887655">.</span><span class="ident" id="7887656">Error</span><span class="op" id="7887661">(</span><span class="string" id="7887662">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7887677">,</span>&nbsp;<span class="ident" id="7887679">err</span><span class="op" id="7887682">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7887685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7887688">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7887720">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887732">dec</span>&nbsp;<span class="op" id="7887736">:=</span>&nbsp;<span class="ident" id="7887739">NewDecoder</span><span class="op" id="7887749">(</span><span class="ident" id="7887750">b</span><span class="op" id="7887751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887754">newEt0</span>&nbsp;<span class="op" id="7887761">:=</span>&nbsp;<span class="builtinfunc" id="7887764">new</span><span class="op" id="7887767">(</span><span class="ident" id="7887768">ET0</span><span class="op" id="7887771">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887774">err</span>&nbsp;<span class="op" id="7887778">=</span>&nbsp;<span class="ident" id="7887780">dec</span><span class="op" id="7887783">.</span><span class="ident" id="7887784">Decode</span><span class="op" id="7887790">(</span><span class="ident" id="7887791">newEt0</span><span class="op" id="7887797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7887800">if</span>&nbsp;<span class="ident" id="7887803">err</span>&nbsp;<span class="op" id="7887807">!=</span>&nbsp;<span class="ident" id="7887810">nil</span>&nbsp;<span class="op" id="7887814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887818">t</span><span class="op" id="7887819">.</span><span class="ident" id="7887820">Fatal</span><span class="op" id="7887825">(</span><span class="string" id="7887826">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="7887847">,</span>&nbsp;<span class="ident" id="7887849">err</span><span class="op" id="7887852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7887855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7887859">if</span>&nbsp;<span class="op" id="7887862">!</span><span class="ident" id="7887863">reflect</span><span class="op" id="7887870">.</span><span class="ident" id="7887871">DeepEqual</span><span class="op" id="7887880">(</span><span class="ident" id="7887881">et0</span><span class="op" id="7887884">,</span>&nbsp;<span class="ident" id="7887886">newEt0</span><span class="op" id="7887892">)</span>&nbsp;<span class="op" id="7887894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887898">t</span><span class="op" id="7887899">.</span><span class="ident" id="7887900">Fatalf</span><span class="op" id="7887906">(</span><span class="string" id="7887907">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7887952">,</span>&nbsp;<span class="op" id="7887954">*</span><span class="ident" id="7887955">et0</span><span class="op" id="7887958">,</span>&nbsp;<span class="op" id="7887960">*</span><span class="ident" id="7887961">newEt0</span><span class="op" id="7887967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7887970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7887973">if</span>&nbsp;<span class="ident" id="7887976">b</span><span class="op" id="7887977">.</span><span class="ident" id="7887978">Len</span><span class="op" id="7887981">(</span><span class="op" id="7887982">)</span>&nbsp;<span class="op" id="7887984">!=</span>&nbsp;<span class="num" id="7887987">0</span>&nbsp;<span class="op" id="7887989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7887993">t</span><span class="op" id="7887994">.</span><span class="ident" id="7887995">Error</span><span class="op" id="7888000">(</span><span class="string" id="7888001">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7888014">,</span>&nbsp;<span class="ident" id="7888016">b</span><span class="op" id="7888017">.</span><span class="ident" id="7888018">Len</span><span class="op" id="7888021">(</span><span class="op" id="7888022">)</span><span class="op" id="7888023">,</span>&nbsp;<span class="string" id="7888025">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7888037">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7888043">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888060">b</span>&nbsp;<span class="op" id="7888062">=</span>&nbsp;<span class="builtinfunc" id="7888064">new</span><span class="op" id="7888067">(</span><span class="ident" id="7888068">bytes</span><span class="op" id="7888073">.</span><span class="ident" id="7888074">Buffer</span><span class="op" id="7888080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888083">enc</span>&nbsp;<span class="op" id="7888087">=</span>&nbsp;<span class="ident" id="7888089">NewEncoder</span><span class="op" id="7888099">(</span><span class="ident" id="7888100">b</span><span class="op" id="7888101">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888104">et1</span>&nbsp;<span class="op" id="7888108">:=</span>&nbsp;<span class="builtinfunc" id="7888111">new</span><span class="op" id="7888114">(</span><span class="ident" id="7888115">ET1</span><span class="op" id="7888118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888121">et1</span><span class="op" id="7888124">.</span><span class="ident" id="7888125">A</span>&nbsp;<span class="op" id="7888127">=</span>&nbsp;<span class="num" id="7888129">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888132">et1</span><span class="op" id="7888135">.</span><span class="ident" id="7888136">Et2</span>&nbsp;<span class="op" id="7888140">=</span>&nbsp;<span class="builtinfunc" id="7888142">new</span><span class="op" id="7888145">(</span><span class="ident" id="7888146">ET2</span><span class="op" id="7888149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888152">err</span>&nbsp;<span class="op" id="7888156">=</span>&nbsp;<span class="ident" id="7888158">enc</span><span class="op" id="7888161">.</span><span class="ident" id="7888162">Encode</span><span class="op" id="7888168">(</span><span class="ident" id="7888169">et1</span><span class="op" id="7888172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888175">if</span>&nbsp;<span class="ident" id="7888178">err</span>&nbsp;<span class="op" id="7888182">!=</span>&nbsp;<span class="ident" id="7888185">nil</span>&nbsp;<span class="op" id="7888189">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888193">t</span><span class="op" id="7888194">.</span><span class="ident" id="7888195">Error</span><span class="op" id="7888200">(</span><span class="string" id="7888201">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7888216">,</span>&nbsp;<span class="ident" id="7888218">err</span><span class="op" id="7888221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888227">dec</span>&nbsp;<span class="op" id="7888231">=</span>&nbsp;<span class="ident" id="7888233">NewDecoder</span><span class="op" id="7888243">(</span><span class="ident" id="7888244">b</span><span class="op" id="7888245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888248">newEt1</span>&nbsp;<span class="op" id="7888255">:=</span>&nbsp;<span class="builtinfunc" id="7888258">new</span><span class="op" id="7888261">(</span><span class="ident" id="7888262">ET1</span><span class="op" id="7888265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888268">err</span>&nbsp;<span class="op" id="7888272">=</span>&nbsp;<span class="ident" id="7888274">dec</span><span class="op" id="7888277">.</span><span class="ident" id="7888278">Decode</span><span class="op" id="7888284">(</span><span class="ident" id="7888285">newEt1</span><span class="op" id="7888291">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888294">if</span>&nbsp;<span class="ident" id="7888297">err</span>&nbsp;<span class="op" id="7888301">!=</span>&nbsp;<span class="ident" id="7888304">nil</span>&nbsp;<span class="op" id="7888308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888312">t</span><span class="op" id="7888313">.</span><span class="ident" id="7888314">Fatal</span><span class="op" id="7888319">(</span><span class="string" id="7888320">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="7888341">,</span>&nbsp;<span class="ident" id="7888343">err</span><span class="op" id="7888346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888353">if</span>&nbsp;<span class="op" id="7888356">!</span><span class="ident" id="7888357">reflect</span><span class="op" id="7888364">.</span><span class="ident" id="7888365">DeepEqual</span><span class="op" id="7888374">(</span><span class="ident" id="7888375">et1</span><span class="op" id="7888378">,</span>&nbsp;<span class="ident" id="7888380">newEt1</span><span class="op" id="7888386">)</span>&nbsp;<span class="op" id="7888388">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888392">t</span><span class="op" id="7888393">.</span><span class="ident" id="7888394">Fatalf</span><span class="op" id="7888400">(</span><span class="string" id="7888401">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7888446">,</span>&nbsp;<span class="op" id="7888448">*</span><span class="ident" id="7888449">et1</span><span class="op" id="7888452">,</span>&nbsp;<span class="op" id="7888454">*</span><span class="ident" id="7888455">newEt1</span><span class="op" id="7888461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888467">if</span>&nbsp;<span class="ident" id="7888470">b</span><span class="op" id="7888471">.</span><span class="ident" id="7888472">Len</span><span class="op" id="7888475">(</span><span class="op" id="7888476">)</span>&nbsp;<span class="op" id="7888478">!=</span>&nbsp;<span class="num" id="7888481">0</span>&nbsp;<span class="op" id="7888483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888487">t</span><span class="op" id="7888488">.</span><span class="ident" id="7888489">Error</span><span class="op" id="7888494">(</span><span class="string" id="7888495">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7888508">,</span>&nbsp;<span class="ident" id="7888510">b</span><span class="op" id="7888511">.</span><span class="ident" id="7888512">Len</span><span class="op" id="7888515">(</span><span class="op" id="7888516">)</span><span class="op" id="7888517">,</span>&nbsp;<span class="string" id="7888519">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7888531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888534">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888538">enc</span><span class="op" id="7888541">.</span><span class="ident" id="7888542">Encode</span><span class="op" id="7888548">(</span><span class="ident" id="7888549">et1</span><span class="op" id="7888552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888555">newEt1</span>&nbsp;<span class="op" id="7888562">=</span>&nbsp;<span class="builtinfunc" id="7888564">new</span><span class="op" id="7888567">(</span><span class="ident" id="7888568">ET1</span><span class="op" id="7888571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888574">err</span>&nbsp;<span class="op" id="7888578">=</span>&nbsp;<span class="ident" id="7888580">dec</span><span class="op" id="7888583">.</span><span class="ident" id="7888584">Decode</span><span class="op" id="7888590">(</span><span class="ident" id="7888591">newEt1</span><span class="op" id="7888597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888600">if</span>&nbsp;<span class="ident" id="7888603">err</span>&nbsp;<span class="op" id="7888607">!=</span>&nbsp;<span class="ident" id="7888610">nil</span>&nbsp;<span class="op" id="7888614">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888618">t</span><span class="op" id="7888619">.</span><span class="ident" id="7888620">Fatal</span><span class="op" id="7888625">(</span><span class="string" id="7888626">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="7888656">,</span>&nbsp;<span class="ident" id="7888658">err</span><span class="op" id="7888661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888667">if</span>&nbsp;<span class="op" id="7888670">!</span><span class="ident" id="7888671">reflect</span><span class="op" id="7888678">.</span><span class="ident" id="7888679">DeepEqual</span><span class="op" id="7888688">(</span><span class="ident" id="7888689">et1</span><span class="op" id="7888692">,</span>&nbsp;<span class="ident" id="7888694">newEt1</span><span class="op" id="7888700">)</span>&nbsp;<span class="op" id="7888702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888706">t</span><span class="op" id="7888707">.</span><span class="ident" id="7888708">Fatalf</span><span class="op" id="7888714">(</span><span class="string" id="7888715">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7888769">,</span>&nbsp;<span class="op" id="7888771">*</span><span class="ident" id="7888772">et1</span><span class="op" id="7888775">,</span>&nbsp;<span class="op" id="7888777">*</span><span class="ident" id="7888778">newEt1</span><span class="op" id="7888784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888787">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888790">if</span>&nbsp;<span class="ident" id="7888793">b</span><span class="op" id="7888794">.</span><span class="ident" id="7888795">Len</span><span class="op" id="7888798">(</span><span class="op" id="7888799">)</span>&nbsp;<span class="op" id="7888801">!=</span>&nbsp;<span class="num" id="7888804">0</span>&nbsp;<span class="op" id="7888806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888810">t</span><span class="op" id="7888811">.</span><span class="ident" id="7888812">Error</span><span class="op" id="7888817">(</span><span class="string" id="7888818">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7888840">,</span>&nbsp;<span class="ident" id="7888842">b</span><span class="op" id="7888843">.</span><span class="ident" id="7888844">Len</span><span class="op" id="7888847">(</span><span class="op" id="7888848">)</span><span class="op" id="7888849">,</span>&nbsp;<span class="string" id="7888851">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7888863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7888866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7888870">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888954">err</span>&nbsp;<span class="op" id="7888958">=</span>&nbsp;<span class="ident" id="7888960">enc</span><span class="op" id="7888963">.</span><span class="ident" id="7888964">Encode</span><span class="op" id="7888970">(</span><span class="ident" id="7888971">et1</span><span class="op" id="7888974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7888977">if</span>&nbsp;<span class="ident" id="7888980">err</span>&nbsp;<span class="op" id="7888984">!=</span>&nbsp;<span class="ident" id="7888987">nil</span>&nbsp;<span class="op" id="7888991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7888995">t</span><span class="op" id="7888996">.</span><span class="ident" id="7888997">Error</span><span class="op" id="7889002">(</span><span class="string" id="7889003">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="7889027">,</span>&nbsp;<span class="ident" id="7889029">err</span><span class="op" id="7889032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7889035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889038">newEt2</span>&nbsp;<span class="op" id="7889045">:=</span>&nbsp;<span class="builtinfunc" id="7889048">new</span><span class="op" id="7889051">(</span><span class="ident" id="7889052">ET2</span><span class="op" id="7889055">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889058">err</span>&nbsp;<span class="op" id="7889062">=</span>&nbsp;<span class="ident" id="7889064">dec</span><span class="op" id="7889067">.</span><span class="ident" id="7889068">Decode</span><span class="op" id="7889074">(</span><span class="ident" id="7889075">newEt2</span><span class="op" id="7889081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7889084">if</span>&nbsp;<span class="ident" id="7889087">err</span>&nbsp;<span class="op" id="7889091">==</span>&nbsp;<span class="ident" id="7889094">nil</span>&nbsp;<span class="op" id="7889098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889102">t</span><span class="op" id="7889103">.</span><span class="ident" id="7889104">Fatal</span><span class="op" id="7889109">(</span><span class="string" id="7889110">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="7889159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7889162">}</span><br>
<span class="lineno"></span><span class="op" id="7889164">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="7889167">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="7889237">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="7889304">func</span>&nbsp;<span class="ident" id="7889309">badTypeCheck</span><span class="op" id="7889321">(</span><span class="ident" id="7889322">e</span>&nbsp;<span class="keyword" id="7889324">interface</span><span class="op" id="7889333">{</span><span class="op" id="7889334">}</span><span class="op" id="7889335">,</span>&nbsp;<span class="ident" id="7889337">shouldFail</span>&nbsp;<span class="builtintype" id="7889348">bool</span><span class="op" id="7889352">,</span>&nbsp;<span class="ident" id="7889354">msg</span>&nbsp;<span class="builtintype" id="7889358">string</span><span class="op" id="7889364">,</span>&nbsp;<span class="ident" id="7889366">t</span>&nbsp;<span class="op" id="7889368">*</span><span class="ident" id="7889369">testing</span><span class="op" id="7889376">.</span><span class="ident" id="7889377">T</span><span class="op" id="7889378">)</span>&nbsp;<span class="op" id="7889380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889383">b</span>&nbsp;<span class="op" id="7889385">:=</span>&nbsp;<span class="builtinfunc" id="7889388">new</span><span class="op" id="7889391">(</span><span class="ident" id="7889392">bytes</span><span class="op" id="7889397">.</span><span class="ident" id="7889398">Buffer</span><span class="op" id="7889404">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889407">enc</span>&nbsp;<span class="op" id="7889411">:=</span>&nbsp;<span class="ident" id="7889414">NewEncoder</span><span class="op" id="7889424">(</span><span class="ident" id="7889425">b</span><span class="op" id="7889426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889429">et1</span>&nbsp;<span class="op" id="7889433">:=</span>&nbsp;<span class="builtinfunc" id="7889436">new</span><span class="op" id="7889439">(</span><span class="ident" id="7889440">ET1</span><span class="op" id="7889443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889446">et1</span><span class="op" id="7889449">.</span><span class="ident" id="7889450">A</span>&nbsp;<span class="op" id="7889452">=</span>&nbsp;<span class="num" id="7889454">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889457">et1</span><span class="op" id="7889460">.</span><span class="ident" id="7889461">Et2</span>&nbsp;<span class="op" id="7889465">=</span>&nbsp;<span class="builtinfunc" id="7889467">new</span><span class="op" id="7889470">(</span><span class="ident" id="7889471">ET2</span><span class="op" id="7889474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889477">err</span>&nbsp;<span class="op" id="7889481">:=</span>&nbsp;<span class="ident" id="7889484">enc</span><span class="op" id="7889487">.</span><span class="ident" id="7889488">Encode</span><span class="op" id="7889494">(</span><span class="ident" id="7889495">et1</span><span class="op" id="7889498">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7889501">if</span>&nbsp;<span class="ident" id="7889504">err</span>&nbsp;<span class="op" id="7889508">!=</span>&nbsp;<span class="ident" id="7889511">nil</span>&nbsp;<span class="op" id="7889515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889519">t</span><span class="op" id="7889520">.</span><span class="ident" id="7889521">Error</span><span class="op" id="7889526">(</span><span class="string" id="7889527">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7889542">,</span>&nbsp;<span class="ident" id="7889544">err</span><span class="op" id="7889547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7889550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889553">dec</span>&nbsp;<span class="op" id="7889557">:=</span>&nbsp;<span class="ident" id="7889560">NewDecoder</span><span class="op" id="7889570">(</span><span class="ident" id="7889571">b</span><span class="op" id="7889572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889575">err</span>&nbsp;<span class="op" id="7889579">=</span>&nbsp;<span class="ident" id="7889581">dec</span><span class="op" id="7889584">.</span><span class="ident" id="7889585">Decode</span><span class="op" id="7889591">(</span><span class="ident" id="7889592">e</span><span class="op" id="7889593">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7889596">if</span>&nbsp;<span class="ident" id="7889599">shouldFail</span>&nbsp;<span class="op" id="7889610">&amp;&amp;</span>&nbsp;<span class="ident" id="7889613">err</span>&nbsp;<span class="op" id="7889617">==</span>&nbsp;<span class="ident" id="7889620">nil</span>&nbsp;<span class="op" id="7889624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889628">t</span><span class="op" id="7889629">.</span><span class="ident" id="7889630">Error</span><span class="op" id="7889635">(</span><span class="string" id="7889636">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="7889656">,</span>&nbsp;<span class="ident" id="7889658">msg</span><span class="op" id="7889661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7889664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7889667">if</span>&nbsp;<span class="op" id="7889670">!</span><span class="ident" id="7889671">shouldFail</span>&nbsp;<span class="op" id="7889682">&amp;&amp;</span>&nbsp;<span class="ident" id="7889685">err</span>&nbsp;<span class="op" id="7889689">!=</span>&nbsp;<span class="ident" id="7889692">nil</span>&nbsp;<span class="op" id="7889696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889700">t</span><span class="op" id="7889701">.</span><span class="ident" id="7889702">Error</span><span class="op" id="7889707">(</span><span class="string" id="7889708">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="7889730">,</span>&nbsp;<span class="ident" id="7889732">msg</span><span class="op" id="7889735">,</span>&nbsp;<span class="ident" id="7889737">err</span><span class="op" id="7889740">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7889743">}</span><br>
<span class="lineno"></span><span class="op" id="7889745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7889748">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="7889801">func</span>&nbsp;<span class="ident" id="7889806">TestWrongTypeDecoder</span><span class="op" id="7889826">(</span><span class="ident" id="7889827">t</span>&nbsp;<span class="op" id="7889829">*</span><span class="ident" id="7889830">testing</span><span class="op" id="7889837">.</span><span class="ident" id="7889838">T</span><span class="op" id="7889839">)</span>&nbsp;<span class="op" id="7889841">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889844">badTypeCheck</span><span class="op" id="7889856">(</span><span class="builtinfunc" id="7889857">new</span><span class="op" id="7889860">(</span><span class="ident" id="7889861">ET2</span><span class="op" id="7889864">)</span><span class="op" id="7889865">,</span>&nbsp;<span class="builtintype" id="7889867">true</span><span class="op" id="7889871">,</span>&nbsp;<span class="string" id="7889873">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="7889894">,</span>&nbsp;<span class="ident" id="7889896">t</span><span class="op" id="7889897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889900">badTypeCheck</span><span class="op" id="7889912">(</span><span class="builtinfunc" id="7889913">new</span><span class="op" id="7889916">(</span><span class="ident" id="7889917">ET3</span><span class="op" id="7889920">)</span><span class="op" id="7889921">,</span>&nbsp;<span class="builtintype" id="7889923">false</span><span class="op" id="7889928">,</span>&nbsp;<span class="string" id="7889930">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="7889955">,</span>&nbsp;<span class="ident" id="7889957">t</span><span class="op" id="7889958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889961">badTypeCheck</span><span class="op" id="7889973">(</span><span class="builtinfunc" id="7889974">new</span><span class="op" id="7889977">(</span><span class="ident" id="7889978">ET4</span><span class="op" id="7889981">)</span><span class="op" id="7889982">,</span>&nbsp;<span class="builtintype" id="7889984">true</span><span class="op" id="7889988">,</span>&nbsp;<span class="string" id="7889990">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="7890015">,</span>&nbsp;<span class="ident" id="7890017">t</span><span class="op" id="7890018">)</span><br>
<span class="lineno"></span><span class="op" id="7890020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7890023">func</span>&nbsp;<span class="ident" id="7890028">corruptDataCheck</span><span class="op" id="7890044">(</span><span class="ident" id="7890045">s</span>&nbsp;<span class="builtintype" id="7890047">string</span><span class="op" id="7890053">,</span>&nbsp;<span class="ident" id="7890055">err</span>&nbsp;<span class="builtintype" id="7890059">error</span><span class="op" id="7890064">,</span>&nbsp;<span class="ident" id="7890066">t</span>&nbsp;<span class="op" id="7890068">*</span><span class="ident" id="7890069">testing</span><span class="op" id="7890076">.</span><span class="ident" id="7890077">T</span><span class="op" id="7890078">)</span>&nbsp;<span class="op" id="7890080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890083">b</span>&nbsp;<span class="op" id="7890085">:=</span>&nbsp;<span class="ident" id="7890088">bytes</span><span class="op" id="7890093">.</span><span class="ident" id="7890094">NewBufferString</span><span class="op" id="7890109">(</span><span class="ident" id="7890110">s</span><span class="op" id="7890111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890114">dec</span>&nbsp;<span class="op" id="7890118">:=</span>&nbsp;<span class="ident" id="7890121">NewDecoder</span><span class="op" id="7890131">(</span><span class="ident" id="7890132">b</span><span class="op" id="7890133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890136">err1</span>&nbsp;<span class="op" id="7890141">:=</span>&nbsp;<span class="ident" id="7890144">dec</span><span class="op" id="7890147">.</span><span class="ident" id="7890148">Decode</span><span class="op" id="7890154">(</span><span class="builtinfunc" id="7890155">new</span><span class="op" id="7890158">(</span><span class="ident" id="7890159">ET2</span><span class="op" id="7890162">)</span><span class="op" id="7890163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890166">if</span>&nbsp;<span class="ident" id="7890169">err1</span>&nbsp;<span class="op" id="7890174">!=</span>&nbsp;<span class="ident" id="7890177">err</span>&nbsp;<span class="op" id="7890181">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890185">t</span><span class="op" id="7890186">.</span><span class="ident" id="7890187">Errorf</span><span class="op" id="7890193">(</span><span class="string" id="7890194">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7890229">,</span>&nbsp;<span class="ident" id="7890231">s</span><span class="op" id="7890232">,</span>&nbsp;<span class="ident" id="7890234">err</span><span class="op" id="7890237">,</span>&nbsp;<span class="ident" id="7890239">err1</span><span class="op" id="7890243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890246">}</span><br>
<span class="lineno"></span><span class="op" id="7890248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7890251">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="7890286">func</span>&nbsp;<span class="ident" id="7890291">TestBadData</span><span class="op" id="7890302">(</span><span class="ident" id="7890303">t</span>&nbsp;<span class="op" id="7890305">*</span><span class="ident" id="7890306">testing</span><span class="op" id="7890313">.</span><span class="ident" id="7890314">T</span><span class="op" id="7890315">)</span>&nbsp;<span class="op" id="7890317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890320">corruptDataCheck</span><span class="op" id="7890336">(</span><span class="string" id="7890337">&#34;&#34;</span><span class="op" id="7890339">,</span>&nbsp;<span class="ident" id="7890341">io</span><span class="op" id="7890343">.</span><span class="ident" id="7890344">EOF</span><span class="op" id="7890347">,</span>&nbsp;<span class="ident" id="7890349">t</span><span class="op" id="7890350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890353">corruptDataCheck</span><span class="op" id="7890369">(</span><span class="string" id="7890370">&#34;\x7Fhi&#34;</span><span class="op" id="7890378">,</span>&nbsp;<span class="ident" id="7890380">io</span><span class="op" id="7890382">.</span><span class="ident" id="7890383">ErrUnexpectedEOF</span><span class="op" id="7890399">,</span>&nbsp;<span class="ident" id="7890401">t</span><span class="op" id="7890402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890405">corruptDataCheck</span><span class="op" id="7890421">(</span><span class="string" id="7890422">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="7890460">,</span>&nbsp;<span class="ident" id="7890462">errBadType</span><span class="op" id="7890472">,</span>&nbsp;<span class="ident" id="7890474">t</span><span class="op" id="7890475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7890478">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890494">corruptDataCheck</span><span class="op" id="7890510">(</span><span class="string" id="7890511">&#34;\x04\x24foo&#34;</span><span class="op" id="7890524">,</span>&nbsp;<span class="ident" id="7890526">errRange</span><span class="op" id="7890534">,</span>&nbsp;<span class="ident" id="7890536">t</span><span class="op" id="7890537">)</span><br>
<span class="lineno"></span><span class="op" id="7890539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7890542">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="7890594">var</span>&nbsp;<span class="ident" id="7890598">unsupportedValues</span>&nbsp;<span class="op" id="7890616">=</span>&nbsp;<span class="op" id="7890618">[</span><span class="op" id="7890619">]</span><span class="keyword" id="7890620">interface</span><span class="op" id="7890629">{</span><span class="op" id="7890630">}</span><span class="op" id="7890631">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7890634">make</span><span class="op" id="7890638">(</span><span class="keyword" id="7890639">chan</span>&nbsp;<span class="builtintype" id="7890644">int</span><span class="op" id="7890647">)</span><span class="op" id="7890648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890651">func</span><span class="op" id="7890655">(</span><span class="ident" id="7890656">a</span>&nbsp;<span class="builtintype" id="7890658">int</span><span class="op" id="7890661">)</span>&nbsp;<span class="builtintype" id="7890663">bool</span>&nbsp;<span class="op" id="7890668">{</span>&nbsp;<span class="keyword" id="7890670">return</span>&nbsp;<span class="builtintype" id="7890677">true</span>&nbsp;<span class="op" id="7890682">}</span><span class="op" id="7890683">,</span><br>
<span class="lineno"></span><span class="op" id="7890685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7890688">func</span>&nbsp;<span class="ident" id="7890693">TestUnsupported</span><span class="op" id="7890708">(</span><span class="ident" id="7890709">t</span>&nbsp;<span class="op" id="7890711">*</span><span class="ident" id="7890712">testing</span><span class="op" id="7890719">.</span><span class="ident" id="7890720">T</span><span class="op" id="7890721">)</span>&nbsp;<span class="op" id="7890723">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890726">var</span>&nbsp;<span class="ident" id="7890730">b</span>&nbsp;<span class="ident" id="7890732">bytes</span><span class="op" id="7890737">.</span><span class="ident" id="7890738">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890746">enc</span>&nbsp;<span class="op" id="7890750">:=</span>&nbsp;<span class="ident" id="7890753">NewEncoder</span><span class="op" id="7890763">(</span><span class="op" id="7890764">&amp;</span><span class="ident" id="7890765">b</span><span class="op" id="7890766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890769">for</span>&nbsp;<span class="ident" id="7890773">_</span><span class="op" id="7890774">,</span>&nbsp;<span class="ident" id="7890776">v</span>&nbsp;<span class="op" id="7890778">:=</span>&nbsp;<span class="keyword" id="7890781">range</span>&nbsp;<span class="ident" id="7890787">unsupportedValues</span>&nbsp;<span class="op" id="7890805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890809">err</span>&nbsp;<span class="op" id="7890813">:=</span>&nbsp;<span class="ident" id="7890816">enc</span><span class="op" id="7890819">.</span><span class="ident" id="7890820">Encode</span><span class="op" id="7890826">(</span><span class="ident" id="7890827">v</span><span class="op" id="7890828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890832">if</span>&nbsp;<span class="ident" id="7890835">err</span>&nbsp;<span class="op" id="7890839">==</span>&nbsp;<span class="ident" id="7890842">nil</span>&nbsp;<span class="op" id="7890846">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890851">t</span><span class="op" id="7890852">.</span><span class="ident" id="7890853">Errorf</span><span class="op" id="7890859">(</span><span class="string" id="7890860">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="7890893">,</span>&nbsp;<span class="ident" id="7890895">v</span><span class="op" id="7890896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890903">}</span><br>
<span class="lineno"></span><span class="op" id="7890905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="7890908">func</span>&nbsp;<span class="ident" id="7890913">encAndDec</span><span class="op" id="7890922">(</span><span class="ident" id="7890923">in</span><span class="op" id="7890925">,</span>&nbsp;<span class="ident" id="7890927">out</span>&nbsp;<span class="keyword" id="7890931">interface</span><span class="op" id="7890940">{</span><span class="op" id="7890941">}</span><span class="op" id="7890942">)</span>&nbsp;<span class="builtintype" id="7890944">error</span>&nbsp;<span class="op" id="7890950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890953">b</span>&nbsp;<span class="op" id="7890955">:=</span>&nbsp;<span class="builtinfunc" id="7890958">new</span><span class="op" id="7890961">(</span><span class="ident" id="7890962">bytes</span><span class="op" id="7890967">.</span><span class="ident" id="7890968">Buffer</span><span class="op" id="7890974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890977">enc</span>&nbsp;<span class="op" id="7890981">:=</span>&nbsp;<span class="ident" id="7890984">NewEncoder</span><span class="op" id="7890994">(</span><span class="ident" id="7890995">b</span><span class="op" id="7890996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890999">err</span>&nbsp;<span class="op" id="7891003">:=</span>&nbsp;<span class="ident" id="7891006">enc</span><span class="op" id="7891009">.</span><span class="ident" id="7891010">Encode</span><span class="op" id="7891016">(</span><span class="ident" id="7891017">in</span><span class="op" id="7891019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891022">if</span>&nbsp;<span class="ident" id="7891025">err</span>&nbsp;<span class="op" id="7891029">!=</span>&nbsp;<span class="ident" id="7891032">nil</span>&nbsp;<span class="op" id="7891036">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891040">return</span>&nbsp;<span class="ident" id="7891047">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891055">dec</span>&nbsp;<span class="op" id="7891059">:=</span>&nbsp;<span class="ident" id="7891062">NewDecoder</span><span class="op" id="7891072">(</span><span class="ident" id="7891073">b</span><span class="op" id="7891074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891077">err</span>&nbsp;<span class="op" id="7891081">=</span>&nbsp;<span class="ident" id="7891083">dec</span><span class="op" id="7891086">.</span><span class="ident" id="7891087">Decode</span><span class="op" id="7891093">(</span><span class="ident" id="7891094">out</span><span class="op" id="7891097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891100">if</span>&nbsp;<span class="ident" id="7891103">err</span>&nbsp;<span class="op" id="7891107">!=</span>&nbsp;<span class="ident" id="7891110">nil</span>&nbsp;<span class="op" id="7891114">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891118">return</span>&nbsp;<span class="ident" id="7891125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891133">return</span>&nbsp;<span class="ident" id="7891140">nil</span><br>
<span class="lineno"></span><span class="op" id="7891144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7891147">func</span>&nbsp;<span class="ident" id="7891152">TestTypeToPtrType</span><span class="op" id="7891169">(</span><span class="ident" id="7891170">t</span>&nbsp;<span class="op" id="7891172">*</span><span class="ident" id="7891173">testing</span><span class="op" id="7891180">.</span><span class="ident" id="7891181">T</span><span class="op" id="7891182">)</span>&nbsp;<span class="op" id="7891184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7891187">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891215">type</span>&nbsp;<span class="ident" id="7891220">Type0</span>&nbsp;<span class="keyword" id="7891226">struct</span>&nbsp;<span class="op" id="7891233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891237">A</span>&nbsp;<span class="builtintype" id="7891239">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891244">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891247">t0</span>&nbsp;<span class="op" id="7891250">:=</span>&nbsp;<span class="ident" id="7891253">Type0</span><span class="op" id="7891258">{</span><span class="num" id="7891259">7</span><span class="op" id="7891260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891263">t0p</span>&nbsp;<span class="op" id="7891267">:=</span>&nbsp;<span class="builtinfunc" id="7891270">new</span><span class="op" id="7891273">(</span><span class="ident" id="7891274">Type0</span><span class="op" id="7891279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891282">if</span>&nbsp;<span class="ident" id="7891285">err</span>&nbsp;<span class="op" id="7891289">:=</span>&nbsp;<span class="ident" id="7891292">encAndDec</span><span class="op" id="7891301">(</span><span class="ident" id="7891302">t0</span><span class="op" id="7891304">,</span>&nbsp;<span class="ident" id="7891306">t0p</span><span class="op" id="7891309">)</span><span class="op" id="7891310">;</span>&nbsp;<span class="ident" id="7891312">err</span>&nbsp;<span class="op" id="7891316">!=</span>&nbsp;<span class="ident" id="7891319">nil</span>&nbsp;<span class="op" id="7891323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891327">t</span><span class="op" id="7891328">.</span><span class="ident" id="7891329">Error</span><span class="op" id="7891334">(</span><span class="ident" id="7891335">err</span><span class="op" id="7891338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891341">}</span><br>
<span class="lineno">250</span><span class="op" id="7891343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891346">func</span>&nbsp;<span class="ident" id="7891351">TestPtrTypeToType</span><span class="op" id="7891368">(</span><span class="ident" id="7891369">t</span>&nbsp;<span class="op" id="7891371">*</span><span class="ident" id="7891372">testing</span><span class="op" id="7891379">.</span><span class="ident" id="7891380">T</span><span class="op" id="7891381">)</span>&nbsp;<span class="op" id="7891383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7891386">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891414">type</span>&nbsp;<span class="ident" id="7891419">Type1</span>&nbsp;<span class="keyword" id="7891425">struct</span>&nbsp;<span class="op" id="7891432">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891436">A</span>&nbsp;<span class="builtintype" id="7891438">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891447">t1p</span>&nbsp;<span class="op" id="7891451">:=</span>&nbsp;<span class="op" id="7891454">&amp;</span><span class="ident" id="7891455">Type1</span><span class="op" id="7891460">{</span><span class="num" id="7891461">17</span><span class="op" id="7891463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891466">var</span>&nbsp;<span class="ident" id="7891470">t1</span>&nbsp;<span class="ident" id="7891473">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891480">if</span>&nbsp;<span class="ident" id="7891483">err</span>&nbsp;<span class="op" id="7891487">:=</span>&nbsp;<span class="ident" id="7891490">encAndDec</span><span class="op" id="7891499">(</span><span class="ident" id="7891500">t1</span><span class="op" id="7891502">,</span>&nbsp;<span class="ident" id="7891504">t1p</span><span class="op" id="7891507">)</span><span class="op" id="7891508">;</span>&nbsp;<span class="ident" id="7891510">err</span>&nbsp;<span class="op" id="7891514">!=</span>&nbsp;<span class="ident" id="7891517">nil</span>&nbsp;<span class="op" id="7891521">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891525">t</span><span class="op" id="7891526">.</span><span class="ident" id="7891527">Error</span><span class="op" id="7891532">(</span><span class="ident" id="7891533">err</span><span class="op" id="7891536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891539">}</span><br>
<span class="lineno"></span><span class="op" id="7891541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891544">func</span>&nbsp;<span class="ident" id="7891549">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="7891575">(</span><span class="ident" id="7891576">t</span>&nbsp;<span class="op" id="7891578">*</span><span class="ident" id="7891579">testing</span><span class="op" id="7891586">.</span><span class="ident" id="7891587">T</span><span class="op" id="7891588">)</span>&nbsp;<span class="op" id="7891590">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891593">type</span>&nbsp;<span class="ident" id="7891598">Type2</span>&nbsp;<span class="keyword" id="7891604">struct</span>&nbsp;<span class="op" id="7891611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891615">A</span>&nbsp;<span class="op" id="7891617">*</span><span class="op" id="7891618">*</span><span class="op" id="7891619">*</span><span class="op" id="7891620">*</span><span class="builtintype" id="7891621">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891633">t2</span>&nbsp;<span class="op" id="7891636">:=</span>&nbsp;<span class="ident" id="7891639">Type2</span><span class="op" id="7891644">{</span><span class="op" id="7891645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891648">t2</span><span class="op" id="7891650">.</span><span class="ident" id="7891651">A</span>&nbsp;<span class="op" id="7891653">=</span>&nbsp;<span class="builtinfunc" id="7891655">new</span><span class="op" id="7891658">(</span><span class="op" id="7891659">*</span><span class="op" id="7891660">*</span><span class="op" id="7891661">*</span><span class="builtintype" id="7891662">float64</span><span class="op" id="7891669">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891672">*</span><span class="ident" id="7891673">t2</span><span class="op" id="7891675">.</span><span class="ident" id="7891676">A</span>&nbsp;<span class="op" id="7891678">=</span>&nbsp;<span class="builtinfunc" id="7891680">new</span><span class="op" id="7891683">(</span><span class="op" id="7891684">*</span><span class="op" id="7891685">*</span><span class="builtintype" id="7891686">float64</span><span class="op" id="7891693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891696">*</span><span class="op" id="7891697">*</span><span class="ident" id="7891698">t2</span><span class="op" id="7891700">.</span><span class="ident" id="7891701">A</span>&nbsp;<span class="op" id="7891703">=</span>&nbsp;<span class="builtinfunc" id="7891705">new</span><span class="op" id="7891708">(</span><span class="op" id="7891709">*</span><span class="builtintype" id="7891710">float64</span><span class="op" id="7891717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891720">*</span><span class="op" id="7891721">*</span><span class="op" id="7891722">*</span><span class="ident" id="7891723">t2</span><span class="op" id="7891725">.</span><span class="ident" id="7891726">A</span>&nbsp;<span class="op" id="7891728">=</span>&nbsp;<span class="builtinfunc" id="7891730">new</span><span class="op" id="7891733">(</span><span class="builtintype" id="7891734">float64</span><span class="op" id="7891741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891744">*</span><span class="op" id="7891745">*</span><span class="op" id="7891746">*</span><span class="op" id="7891747">*</span><span class="ident" id="7891748">t2</span><span class="op" id="7891750">.</span><span class="ident" id="7891751">A</span>&nbsp;<span class="op" id="7891753">=</span>&nbsp;<span class="num" id="7891755">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891761">t2pppp</span>&nbsp;<span class="op" id="7891768">:=</span>&nbsp;<span class="builtinfunc" id="7891771">new</span><span class="op" id="7891774">(</span><span class="op" id="7891775">*</span><span class="op" id="7891776">*</span><span class="op" id="7891777">*</span><span class="ident" id="7891778">Type2</span><span class="op" id="7891783">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891786">if</span>&nbsp;<span class="ident" id="7891789">err</span>&nbsp;<span class="op" id="7891793">:=</span>&nbsp;<span class="ident" id="7891796">encAndDec</span><span class="op" id="7891805">(</span><span class="ident" id="7891806">t2</span><span class="op" id="7891808">,</span>&nbsp;<span class="ident" id="7891810">t2pppp</span><span class="op" id="7891816">)</span><span class="op" id="7891817">;</span>&nbsp;<span class="ident" id="7891819">err</span>&nbsp;<span class="op" id="7891823">!=</span>&nbsp;<span class="ident" id="7891826">nil</span>&nbsp;<span class="op" id="7891830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891834">t</span><span class="op" id="7891835">.</span><span class="ident" id="7891836">Fatal</span><span class="op" id="7891841">(</span><span class="ident" id="7891842">err</span><span class="op" id="7891845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891851">if</span>&nbsp;<span class="op" id="7891854">*</span><span class="op" id="7891855">*</span><span class="op" id="7891856">*</span><span class="op" id="7891857">*</span><span class="op" id="7891858">(</span><span class="op" id="7891859">*</span><span class="op" id="7891860">*</span><span class="op" id="7891861">*</span><span class="op" id="7891862">*</span><span class="ident" id="7891863">t2pppp</span><span class="op" id="7891869">)</span><span class="op" id="7891870">.</span><span class="ident" id="7891871">A</span>&nbsp;<span class="op" id="7891873">!=</span>&nbsp;<span class="op" id="7891876">*</span><span class="op" id="7891877">*</span><span class="op" id="7891878">*</span><span class="op" id="7891879">*</span><span class="ident" id="7891880">t2</span><span class="op" id="7891882">.</span><span class="ident" id="7891883">A</span>&nbsp;<span class="op" id="7891885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891889">t</span><span class="op" id="7891890">.</span><span class="ident" id="7891891">Errorf</span><span class="op" id="7891897">(</span><span class="string" id="7891898">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="7891935">,</span>&nbsp;<span class="op" id="7891937">*</span><span class="op" id="7891938">*</span><span class="op" id="7891939">*</span><span class="op" id="7891940">*</span><span class="op" id="7891941">(</span><span class="op" id="7891942">*</span><span class="op" id="7891943">*</span><span class="op" id="7891944">*</span><span class="op" id="7891945">*</span><span class="ident" id="7891946">t2pppp</span><span class="op" id="7891952">)</span><span class="op" id="7891953">.</span><span class="ident" id="7891954">A</span><span class="op" id="7891955">,</span>&nbsp;<span class="op" id="7891957">*</span><span class="op" id="7891958">*</span><span class="op" id="7891959">*</span><span class="op" id="7891960">*</span><span class="ident" id="7891961">t2</span><span class="op" id="7891963">.</span><span class="ident" id="7891964">A</span><span class="op" id="7891965">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891968">}</span><br>
<span class="lineno"></span><span class="op" id="7891970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891973">func</span>&nbsp;<span class="ident" id="7891978">TestSlice</span><span class="op" id="7891987">(</span><span class="ident" id="7891988">t</span>&nbsp;<span class="op" id="7891990">*</span><span class="ident" id="7891991">testing</span><span class="op" id="7891998">.</span><span class="ident" id="7891999">T</span><span class="op" id="7892000">)</span>&nbsp;<span class="op" id="7892002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892005">type</span>&nbsp;<span class="ident" id="7892010">Type3</span>&nbsp;<span class="keyword" id="7892016">struct</span>&nbsp;<span class="op" id="7892023">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892027">A</span>&nbsp;<span class="op" id="7892029">[</span><span class="op" id="7892030">]</span><span class="builtintype" id="7892031">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892042">t3p</span>&nbsp;<span class="op" id="7892046">:=</span>&nbsp;<span class="op" id="7892049">&amp;</span><span class="ident" id="7892050">Type3</span><span class="op" id="7892055">{</span><span class="op" id="7892056">[</span><span class="op" id="7892057">]</span><span class="builtintype" id="7892058">string</span><span class="op" id="7892064">{</span><span class="string" id="7892065">&#34;hello&#34;</span><span class="op" id="7892072">,</span>&nbsp;<span class="string" id="7892074">&#34;world&#34;</span><span class="op" id="7892081">}</span><span class="op" id="7892082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892085">var</span>&nbsp;<span class="ident" id="7892089">t3</span>&nbsp;<span class="ident" id="7892092">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892099">if</span>&nbsp;<span class="ident" id="7892102">err</span>&nbsp;<span class="op" id="7892106">:=</span>&nbsp;<span class="ident" id="7892109">encAndDec</span><span class="op" id="7892118">(</span><span class="ident" id="7892119">t3</span><span class="op" id="7892121">,</span>&nbsp;<span class="ident" id="7892123">t3p</span><span class="op" id="7892126">)</span><span class="op" id="7892127">;</span>&nbsp;<span class="ident" id="7892129">err</span>&nbsp;<span class="op" id="7892133">!=</span>&nbsp;<span class="ident" id="7892136">nil</span>&nbsp;<span class="op" id="7892140">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892144">t</span><span class="op" id="7892145">.</span><span class="ident" id="7892146">Error</span><span class="op" id="7892151">(</span><span class="ident" id="7892152">err</span><span class="op" id="7892155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892158">}</span><br>
<span class="lineno"></span><span class="op" id="7892160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7892163">func</span>&nbsp;<span class="ident" id="7892168">TestValueError</span><span class="op" id="7892182">(</span><span class="ident" id="7892183">t</span>&nbsp;<span class="op" id="7892185">*</span><span class="ident" id="7892186">testing</span><span class="op" id="7892193">.</span><span class="ident" id="7892194">T</span><span class="op" id="7892195">)</span>&nbsp;<span class="op" id="7892197">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7892200">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892228">type</span>&nbsp;<span class="ident" id="7892233">Type4</span>&nbsp;<span class="keyword" id="7892239">struct</span>&nbsp;<span class="op" id="7892246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892250">A</span>&nbsp;<span class="builtintype" id="7892252">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892260">t4p</span>&nbsp;<span class="op" id="7892264">:=</span>&nbsp;<span class="op" id="7892267">&amp;</span><span class="ident" id="7892268">Type4</span><span class="op" id="7892273">{</span><span class="num" id="7892274">3</span><span class="op" id="7892275">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892278">var</span>&nbsp;<span class="ident" id="7892282">t4</span>&nbsp;<span class="ident" id="7892285">Type4</span>&nbsp;<span class="comment" id="7892291">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892316">if</span>&nbsp;<span class="ident" id="7892319">err</span>&nbsp;<span class="op" id="7892323">:=</span>&nbsp;<span class="ident" id="7892326">encAndDec</span><span class="op" id="7892335">(</span><span class="ident" id="7892336">t4p</span><span class="op" id="7892339">,</span>&nbsp;<span class="ident" id="7892341">t4</span><span class="op" id="7892343">)</span><span class="op" id="7892344">;</span>&nbsp;<span class="ident" id="7892346">err</span>&nbsp;<span class="op" id="7892350">==</span>&nbsp;<span class="ident" id="7892353">nil</span>&nbsp;<span class="op" id="7892357">||</span>&nbsp;<span class="ident" id="7892360">strings</span><span class="op" id="7892367">.</span><span class="ident" id="7892368">Index</span><span class="op" id="7892373">(</span><span class="ident" id="7892374">err</span><span class="op" id="7892377">.</span><span class="ident" id="7892378">Error</span><span class="op" id="7892383">(</span><span class="op" id="7892384">)</span><span class="op" id="7892385">,</span>&nbsp;<span class="string" id="7892387">&#34;pointer&#34;</span><span class="op" id="7892396">)</span>&nbsp;<span class="op" id="7892398">&lt;</span>&nbsp;<span class="num" id="7892400">0</span>&nbsp;<span class="op" id="7892402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892406">t</span><span class="op" id="7892407">.</span><span class="ident" id="7892408">Error</span><span class="op" id="7892413">(</span><span class="string" id="7892414">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="7892449">,</span>&nbsp;<span class="ident" id="7892451">err</span><span class="op" id="7892454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892457">}</span><br>
<span class="lineno"></span><span class="op" id="7892459">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="7892462">func</span>&nbsp;<span class="ident" id="7892467">TestArray</span><span class="op" id="7892476">(</span><span class="ident" id="7892477">t</span>&nbsp;<span class="op" id="7892479">*</span><span class="ident" id="7892480">testing</span><span class="op" id="7892487">.</span><span class="ident" id="7892488">T</span><span class="op" id="7892489">)</span>&nbsp;<span class="op" id="7892491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892494">type</span>&nbsp;<span class="ident" id="7892499">Type5</span>&nbsp;<span class="keyword" id="7892505">struct</span>&nbsp;<span class="op" id="7892512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892516">A</span>&nbsp;<span class="op" id="7892518">[</span><span class="num" id="7892519">3</span><span class="op" id="7892520">]</span><span class="builtintype" id="7892521">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892530">B</span>&nbsp;<span class="op" id="7892532">[</span><span class="num" id="7892533">3</span><span class="op" id="7892534">]</span><span class="builtintype" id="7892535">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892544">type</span>&nbsp;<span class="ident" id="7892549">Type6</span>&nbsp;<span class="keyword" id="7892555">struct</span>&nbsp;<span class="op" id="7892562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892566">A</span>&nbsp;<span class="op" id="7892568">[</span><span class="num" id="7892569">2</span><span class="op" id="7892570">]</span><span class="builtintype" id="7892571">string</span>&nbsp;<span class="comment" id="7892578">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892601">t5</span>&nbsp;<span class="op" id="7892604">:=</span>&nbsp;<span class="ident" id="7892607">Type5</span><span class="op" id="7892612">{</span><span class="op" id="7892613">[</span><span class="num" id="7892614">3</span><span class="op" id="7892615">]</span><span class="builtintype" id="7892616">string</span><span class="op" id="7892622">{</span><span class="string" id="7892623">&#34;hello&#34;</span><span class="op" id="7892630">,</span>&nbsp;<span class="string" id="7892632">&#34;,&#34;</span><span class="op" id="7892635">,</span>&nbsp;<span class="string" id="7892637">&#34;world&#34;</span><span class="op" id="7892644">}</span><span class="op" id="7892645">,</span>&nbsp;<span class="op" id="7892647">[</span><span class="num" id="7892648">3</span><span class="op" id="7892649">]</span><span class="builtintype" id="7892650">byte</span><span class="op" id="7892654">{</span><span class="num" id="7892655">1</span><span class="op" id="7892656">,</span>&nbsp;<span class="num" id="7892658">2</span><span class="op" id="7892659">,</span>&nbsp;<span class="num" id="7892661">3</span><span class="op" id="7892662">}</span><span class="op" id="7892663">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892666">var</span>&nbsp;<span class="ident" id="7892670">t5p</span>&nbsp;<span class="ident" id="7892674">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892681">if</span>&nbsp;<span class="ident" id="7892684">err</span>&nbsp;<span class="op" id="7892688">:=</span>&nbsp;<span class="ident" id="7892691">encAndDec</span><span class="op" id="7892700">(</span><span class="ident" id="7892701">t5</span><span class="op" id="7892703">,</span>&nbsp;<span class="op" id="7892705">&amp;</span><span class="ident" id="7892706">t5p</span><span class="op" id="7892709">)</span><span class="op" id="7892710">;</span>&nbsp;<span class="ident" id="7892712">err</span>&nbsp;<span class="op" id="7892716">!=</span>&nbsp;<span class="ident" id="7892719">nil</span>&nbsp;<span class="op" id="7892723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892727">t</span><span class="op" id="7892728">.</span><span class="ident" id="7892729">Error</span><span class="op" id="7892734">(</span><span class="ident" id="7892735">err</span><span class="op" id="7892738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892744">var</span>&nbsp;<span class="ident" id="7892748">t6</span>&nbsp;<span class="ident" id="7892751">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892758">if</span>&nbsp;<span class="ident" id="7892761">err</span>&nbsp;<span class="op" id="7892765">:=</span>&nbsp;<span class="ident" id="7892768">encAndDec</span><span class="op" id="7892777">(</span><span class="ident" id="7892778">t5</span><span class="op" id="7892780">,</span>&nbsp;<span class="op" id="7892782">&amp;</span><span class="ident" id="7892783">t6</span><span class="op" id="7892785">)</span><span class="op" id="7892786">;</span>&nbsp;<span class="ident" id="7892788">err</span>&nbsp;<span class="op" id="7892792">==</span>&nbsp;<span class="ident" id="7892795">nil</span>&nbsp;<span class="op" id="7892799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892803">t</span><span class="op" id="7892804">.</span><span class="ident" id="7892805">Error</span><span class="op" id="7892810">(</span><span class="string" id="7892811">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="7892852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892855">}</span><br>
<span class="lineno"></span><span class="op" id="7892857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="7892860">func</span>&nbsp;<span class="ident" id="7892865">TestRecursiveMapType</span><span class="op" id="7892885">(</span><span class="ident" id="7892886">t</span>&nbsp;<span class="op" id="7892888">*</span><span class="ident" id="7892889">testing</span><span class="op" id="7892896">.</span><span class="ident" id="7892897">T</span><span class="op" id="7892898">)</span>&nbsp;<span class="op" id="7892900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892903">type</span>&nbsp;<span class="ident" id="7892908">recursiveMap</span>&nbsp;<span class="keyword" id="7892921">map</span><span class="op" id="7892924">[</span><span class="builtintype" id="7892925">string</span><span class="op" id="7892931">]</span><span class="ident" id="7892932">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892946">r1</span>&nbsp;<span class="op" id="7892949">:=</span>&nbsp;<span class="ident" id="7892952">recursiveMap</span><span class="op" id="7892964">{</span><span class="string" id="7892965">&#34;A&#34;</span><span class="op" id="7892968">:</span>&nbsp;<span class="ident" id="7892970">recursiveMap</span><span class="op" id="7892982">{</span><span class="string" id="7892983">&#34;B&#34;</span><span class="op" id="7892986">:</span>&nbsp;<span class="ident" id="7892988">nil</span><span class="op" id="7892991">,</span>&nbsp;<span class="string" id="7892993">&#34;C&#34;</span><span class="op" id="7892996">:</span>&nbsp;<span class="ident" id="7892998">nil</span><span class="op" id="7893001">}</span><span class="op" id="7893002">,</span>&nbsp;<span class="string" id="7893004">&#34;D&#34;</span><span class="op" id="7893007">:</span>&nbsp;<span class="ident" id="7893009">nil</span><span class="op" id="7893012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893015">r2</span>&nbsp;<span class="op" id="7893018">:=</span>&nbsp;<span class="builtinfunc" id="7893021">make</span><span class="op" id="7893025">(</span><span class="ident" id="7893026">recursiveMap</span><span class="op" id="7893038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893041">if</span>&nbsp;<span class="ident" id="7893044">err</span>&nbsp;<span class="op" id="7893048">:=</span>&nbsp;<span class="ident" id="7893051">encAndDec</span><span class="op" id="7893060">(</span><span class="ident" id="7893061">r1</span><span class="op" id="7893063">,</span>&nbsp;<span class="op" id="7893065">&amp;</span><span class="ident" id="7893066">r2</span><span class="op" id="7893068">)</span><span class="op" id="7893069">;</span>&nbsp;<span class="ident" id="7893071">err</span>&nbsp;<span class="op" id="7893075">!=</span>&nbsp;<span class="ident" id="7893078">nil</span>&nbsp;<span class="op" id="7893082">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893086">t</span><span class="op" id="7893087">.</span><span class="ident" id="7893088">Error</span><span class="op" id="7893093">(</span><span class="ident" id="7893094">err</span><span class="op" id="7893097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893100">}</span><br>
<span class="lineno"></span><span class="op" id="7893102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7893105">func</span>&nbsp;<span class="ident" id="7893110">TestRecursiveSliceType</span><span class="op" id="7893132">(</span><span class="ident" id="7893133">t</span>&nbsp;<span class="op" id="7893135">*</span><span class="ident" id="7893136">testing</span><span class="op" id="7893143">.</span><span class="ident" id="7893144">T</span><span class="op" id="7893145">)</span>&nbsp;<span class="op" id="7893147">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893150">type</span>&nbsp;<span class="ident" id="7893155">recursiveSlice</span>&nbsp;<span class="op" id="7893170">[</span><span class="op" id="7893171">]</span><span class="ident" id="7893172">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893188">r1</span>&nbsp;<span class="op" id="7893191">:=</span>&nbsp;<span class="ident" id="7893194">recursiveSlice</span><span class="op" id="7893208">{</span><span class="num" id="7893209">0</span><span class="op" id="7893210">:</span>&nbsp;<span class="ident" id="7893212">recursiveSlice</span><span class="op" id="7893226">{</span><span class="num" id="7893227">0</span><span class="op" id="7893228">:</span>&nbsp;<span class="ident" id="7893230">nil</span><span class="op" id="7893233">}</span><span class="op" id="7893234">,</span>&nbsp;<span class="num" id="7893236">1</span><span class="op" id="7893237">:</span>&nbsp;<span class="ident" id="7893239">nil</span><span class="op" id="7893242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893245">r2</span>&nbsp;<span class="op" id="7893248">:=</span>&nbsp;<span class="builtinfunc" id="7893251">make</span><span class="op" id="7893255">(</span><span class="ident" id="7893256">recursiveSlice</span><span class="op" id="7893270">,</span>&nbsp;<span class="num" id="7893272">0</span><span class="op" id="7893273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893276">if</span>&nbsp;<span class="ident" id="7893279">err</span>&nbsp;<span class="op" id="7893283">:=</span>&nbsp;<span class="ident" id="7893286">encAndDec</span><span class="op" id="7893295">(</span><span class="ident" id="7893296">r1</span><span class="op" id="7893298">,</span>&nbsp;<span class="op" id="7893300">&amp;</span><span class="ident" id="7893301">r2</span><span class="op" id="7893303">)</span><span class="op" id="7893304">;</span>&nbsp;<span class="ident" id="7893306">err</span>&nbsp;<span class="op" id="7893310">!=</span>&nbsp;<span class="ident" id="7893313">nil</span>&nbsp;<span class="op" id="7893317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893321">t</span><span class="op" id="7893322">.</span><span class="ident" id="7893323">Error</span><span class="op" id="7893328">(</span><span class="ident" id="7893329">err</span><span class="op" id="7893332">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893335">}</span><br>
<span class="lineno"></span><span class="op" id="7893337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7893340">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="7893404">func</span>&nbsp;<span class="ident" id="7893409">TestDefaultsInArray</span><span class="op" id="7893428">(</span><span class="ident" id="7893429">t</span>&nbsp;<span class="op" id="7893431">*</span><span class="ident" id="7893432">testing</span><span class="op" id="7893439">.</span><span class="ident" id="7893440">T</span><span class="op" id="7893441">)</span>&nbsp;<span class="op" id="7893443">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893446">type</span>&nbsp;<span class="ident" id="7893451">Type7</span>&nbsp;<span class="keyword" id="7893457">struct</span>&nbsp;<span class="op" id="7893464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893468">B</span>&nbsp;<span class="op" id="7893470">[</span><span class="op" id="7893471">]</span><span class="builtintype" id="7893472">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893479">I</span>&nbsp;<span class="op" id="7893481">[</span><span class="op" id="7893482">]</span><span class="builtintype" id="7893483">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893489">S</span>&nbsp;<span class="op" id="7893491">[</span><span class="op" id="7893492">]</span><span class="builtintype" id="7893493">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893502">F</span>&nbsp;<span class="op" id="7893504">[</span><span class="op" id="7893505">]</span><span class="builtintype" id="7893506">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893518">t7</span>&nbsp;<span class="op" id="7893521">:=</span>&nbsp;<span class="ident" id="7893524">Type7</span><span class="op" id="7893529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893533">[</span><span class="op" id="7893534">]</span><span class="builtintype" id="7893535">bool</span><span class="op" id="7893539">{</span><span class="builtintype" id="7893540">false</span><span class="op" id="7893545">,</span>&nbsp;<span class="builtintype" id="7893547">false</span><span class="op" id="7893552">,</span>&nbsp;<span class="builtintype" id="7893554">true</span><span class="op" id="7893558">}</span><span class="op" id="7893559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893563">[</span><span class="op" id="7893564">]</span><span class="builtintype" id="7893565">int</span><span class="op" id="7893568">{</span><span class="num" id="7893569">0</span><span class="op" id="7893570">,</span>&nbsp;<span class="num" id="7893572">0</span><span class="op" id="7893573">,</span>&nbsp;<span class="num" id="7893575">1</span><span class="op" id="7893576">}</span><span class="op" id="7893577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893581">[</span><span class="op" id="7893582">]</span><span class="builtintype" id="7893583">string</span><span class="op" id="7893589">{</span><span class="string" id="7893590">&#34;hi&#34;</span><span class="op" id="7893594">,</span>&nbsp;<span class="string" id="7893596">&#34;&#34;</span><span class="op" id="7893598">,</span>&nbsp;<span class="string" id="7893600">&#34;there&#34;</span><span class="op" id="7893607">}</span><span class="op" id="7893608">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893612">[</span><span class="op" id="7893613">]</span><span class="builtintype" id="7893614">float64</span><span class="op" id="7893621">{</span><span class="num" id="7893622">0</span><span class="op" id="7893623">,</span>&nbsp;<span class="num" id="7893625">0</span><span class="op" id="7893626">,</span>&nbsp;<span class="num" id="7893628">1</span><span class="op" id="7893629">}</span><span class="op" id="7893630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893636">var</span>&nbsp;<span class="ident" id="7893640">t7p</span>&nbsp;<span class="ident" id="7893644">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893651">if</span>&nbsp;<span class="ident" id="7893654">err</span>&nbsp;<span class="op" id="7893658">:=</span>&nbsp;<span class="ident" id="7893661">encAndDec</span><span class="op" id="7893670">(</span><span class="ident" id="7893671">t7</span><span class="op" id="7893673">,</span>&nbsp;<span class="op" id="7893675">&amp;</span><span class="ident" id="7893676">t7p</span><span class="op" id="7893679">)</span><span class="op" id="7893680">;</span>&nbsp;<span class="ident" id="7893682">err</span>&nbsp;<span class="op" id="7893686">!=</span>&nbsp;<span class="ident" id="7893689">nil</span>&nbsp;<span class="op" id="7893693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893697">t</span><span class="op" id="7893698">.</span><span class="ident" id="7893699">Error</span><span class="op" id="7893704">(</span><span class="ident" id="7893705">err</span><span class="op" id="7893708">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893711">}</span><br>
<span class="lineno"></span><span class="op" id="7893713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7893716">var</span>&nbsp;<span class="ident" id="7893720">testInt</span>&nbsp;<span class="builtintype" id="7893728">int</span><br>
<span class="lineno"></span><span class="keyword" id="7893732">var</span>&nbsp;<span class="ident" id="7893736">testFloat32</span>&nbsp;<span class="builtintype" id="7893748">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="7893756">var</span>&nbsp;<span class="ident" id="7893760">testString</span>&nbsp;<span class="builtintype" id="7893771">string</span><br>
<span class="lineno"></span><span class="keyword" id="7893778">var</span>&nbsp;<span class="ident" id="7893782">testSlice</span>&nbsp;<span class="op" id="7893792">[</span><span class="op" id="7893793">]</span><span class="builtintype" id="7893794">string</span><br>
<span class="lineno"></span><span class="keyword" id="7893801">var</span>&nbsp;<span class="ident" id="7893805">testMap</span>&nbsp;<span class="keyword" id="7893813">map</span><span class="op" id="7893816">[</span><span class="builtintype" id="7893817">string</span><span class="op" id="7893823">]</span><span class="builtintype" id="7893824">int</span><br>
<span class="lineno"></span><span class="keyword" id="7893828">var</span>&nbsp;<span class="ident" id="7893832">testArray</span>&nbsp;<span class="op" id="7893842">[</span><span class="num" id="7893843">7</span><span class="op" id="7893844">]</span><span class="builtintype" id="7893845">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="7893850">type</span>&nbsp;<span class="ident" id="7893855">SingleTest</span>&nbsp;<span class="keyword" id="7893866">struct</span>&nbsp;<span class="op" id="7893873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893876">in</span>&nbsp;&nbsp;<span class="keyword" id="7893880">interface</span><span class="op" id="7893889">{</span><span class="op" id="7893890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893893">out</span>&nbsp;<span class="keyword" id="7893897">interface</span><span class="op" id="7893906">{</span><span class="op" id="7893907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893910">err</span>&nbsp;<span class="builtintype" id="7893914">string</span><br>
<span class="lineno"></span><span class="op" id="7893921">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="7893924">var</span>&nbsp;<span class="ident" id="7893928">singleTests</span>&nbsp;<span class="op" id="7893940">=</span>&nbsp;<span class="op" id="7893942">[</span><span class="op" id="7893943">]</span><span class="ident" id="7893944">SingleTest</span><span class="op" id="7893954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893957">{</span><span class="num" id="7893958">17</span><span class="op" id="7893960">,</span>&nbsp;<span class="op" id="7893962">&amp;</span><span class="ident" id="7893963">testInt</span><span class="op" id="7893970">,</span>&nbsp;<span class="string" id="7893972">&#34;&#34;</span><span class="op" id="7893974">}</span><span class="op" id="7893975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893978">{</span><span class="builtintype" id="7893979">float32</span><span class="op" id="7893986">(</span><span class="num" id="7893987">17.5</span><span class="op" id="7893991">)</span><span class="op" id="7893992">,</span>&nbsp;<span class="op" id="7893994">&amp;</span><span class="ident" id="7893995">testFloat32</span><span class="op" id="7894006">,</span>&nbsp;<span class="string" id="7894008">&#34;&#34;</span><span class="op" id="7894010">}</span><span class="op" id="7894011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894014">{</span><span class="string" id="7894015">&#34;bike&nbsp;shed&#34;</span><span class="op" id="7894026">,</span>&nbsp;<span class="op" id="7894028">&amp;</span><span class="ident" id="7894029">testString</span><span class="op" id="7894039">,</span>&nbsp;<span class="string" id="7894041">&#34;&#34;</span><span class="op" id="7894043">}</span><span class="op" id="7894044">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894047">{</span><span class="op" id="7894048">[</span><span class="op" id="7894049">]</span><span class="builtintype" id="7894050">string</span><span class="op" id="7894056">{</span><span class="string" id="7894057">&#34;bike&#34;</span><span class="op" id="7894063">,</span>&nbsp;<span class="string" id="7894065">&#34;shed&#34;</span><span class="op" id="7894071">,</span>&nbsp;<span class="string" id="7894073">&#34;paint&#34;</span><span class="op" id="7894080">,</span>&nbsp;<span class="string" id="7894082">&#34;color&#34;</span><span class="op" id="7894089">}</span><span class="op" id="7894090">,</span>&nbsp;<span class="op" id="7894092">&amp;</span><span class="ident" id="7894093">testSlice</span><span class="op" id="7894102">,</span>&nbsp;<span class="string" id="7894104">&#34;&#34;</span><span class="op" id="7894106">}</span><span class="op" id="7894107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894110">{</span><span class="keyword" id="7894111">map</span><span class="op" id="7894114">[</span><span class="builtintype" id="7894115">string</span><span class="op" id="7894121">]</span><span class="builtintype" id="7894122">int</span><span class="op" id="7894125">{</span><span class="string" id="7894126">&#34;seven&#34;</span><span class="op" id="7894133">:</span>&nbsp;<span class="num" id="7894135">7</span><span class="op" id="7894136">,</span>&nbsp;<span class="string" id="7894138">&#34;twelve&#34;</span><span class="op" id="7894146">:</span>&nbsp;<span class="num" id="7894148">12</span><span class="op" id="7894150">}</span><span class="op" id="7894151">,</span>&nbsp;<span class="op" id="7894153">&amp;</span><span class="ident" id="7894154">testMap</span><span class="op" id="7894161">,</span>&nbsp;<span class="string" id="7894163">&#34;&#34;</span><span class="op" id="7894165">}</span><span class="op" id="7894166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894169">{</span><span class="op" id="7894170">[</span><span class="num" id="7894171">7</span><span class="op" id="7894172">]</span><span class="builtintype" id="7894173">int</span><span class="op" id="7894176">{</span><span class="num" id="7894177">4</span><span class="op" id="7894178">,</span>&nbsp;<span class="num" id="7894180">55</span><span class="op" id="7894182">,</span>&nbsp;<span class="num" id="7894184">0</span><span class="op" id="7894185">,</span>&nbsp;<span class="num" id="7894187">0</span><span class="op" id="7894188">,</span>&nbsp;<span class="num" id="7894190">0</span><span class="op" id="7894191">,</span>&nbsp;<span class="num" id="7894193">0</span><span class="op" id="7894194">,</span>&nbsp;<span class="num" id="7894196">0</span><span class="op" id="7894197">}</span><span class="op" id="7894198">,</span>&nbsp;<span class="op" id="7894200">&amp;</span><span class="ident" id="7894201">testArray</span><span class="op" id="7894210">,</span>&nbsp;<span class="string" id="7894212">&#34;&#34;</span><span class="op" id="7894214">}</span><span class="op" id="7894215">,</span>&nbsp;<span class="comment" id="7894217">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894252">{</span><span class="op" id="7894253">[</span><span class="num" id="7894254">7</span><span class="op" id="7894255">]</span><span class="builtintype" id="7894256">int</span><span class="op" id="7894259">{</span><span class="num" id="7894260">4</span><span class="op" id="7894261">,</span>&nbsp;<span class="num" id="7894263">55</span><span class="op" id="7894265">,</span>&nbsp;<span class="num" id="7894267">1</span><span class="op" id="7894268">,</span>&nbsp;<span class="num" id="7894270">44</span><span class="op" id="7894272">,</span>&nbsp;<span class="num" id="7894274">22</span><span class="op" id="7894276">,</span>&nbsp;<span class="num" id="7894278">66</span><span class="op" id="7894280">,</span>&nbsp;<span class="num" id="7894282">1234</span><span class="op" id="7894286">}</span><span class="op" id="7894287">,</span>&nbsp;<span class="op" id="7894289">&amp;</span><span class="ident" id="7894290">testArray</span><span class="op" id="7894299">,</span>&nbsp;<span class="string" id="7894301">&#34;&#34;</span><span class="op" id="7894303">}</span><span class="op" id="7894304">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7894308">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894326">{</span><span class="num" id="7894327">172</span><span class="op" id="7894330">,</span>&nbsp;<span class="op" id="7894332">&amp;</span><span class="ident" id="7894333">testFloat32</span><span class="op" id="7894344">,</span>&nbsp;<span class="string" id="7894346">&#34;type&#34;</span><span class="op" id="7894352">}</span><span class="op" id="7894353">,</span><br>
<span class="lineno"></span><span class="op" id="7894355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7894358">func</span>&nbsp;<span class="ident" id="7894363">TestSingletons</span><span class="op" id="7894377">(</span><span class="ident" id="7894378">t</span>&nbsp;<span class="op" id="7894380">*</span><span class="ident" id="7894381">testing</span><span class="op" id="7894388">.</span><span class="ident" id="7894389">T</span><span class="op" id="7894390">)</span>&nbsp;<span class="op" id="7894392">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894395">b</span>&nbsp;<span class="op" id="7894397">:=</span>&nbsp;<span class="builtinfunc" id="7894400">new</span><span class="op" id="7894403">(</span><span class="ident" id="7894404">bytes</span><span class="op" id="7894409">.</span><span class="ident" id="7894410">Buffer</span><span class="op" id="7894416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894419">enc</span>&nbsp;<span class="op" id="7894423">:=</span>&nbsp;<span class="ident" id="7894426">NewEncoder</span><span class="op" id="7894436">(</span><span class="ident" id="7894437">b</span><span class="op" id="7894438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894441">dec</span>&nbsp;<span class="op" id="7894445">:=</span>&nbsp;<span class="ident" id="7894448">NewDecoder</span><span class="op" id="7894458">(</span><span class="ident" id="7894459">b</span><span class="op" id="7894460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894463">for</span>&nbsp;<span class="ident" id="7894467">_</span><span class="op" id="7894468">,</span>&nbsp;<span class="ident" id="7894470">test</span>&nbsp;<span class="op" id="7894475">:=</span>&nbsp;<span class="keyword" id="7894478">range</span>&nbsp;<span class="ident" id="7894484">singleTests</span>&nbsp;<span class="op" id="7894496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894500">b</span><span class="op" id="7894501">.</span><span class="ident" id="7894502">Reset</span><span class="op" id="7894507">(</span><span class="op" id="7894508">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894512">err</span>&nbsp;<span class="op" id="7894516">:=</span>&nbsp;<span class="ident" id="7894519">enc</span><span class="op" id="7894522">.</span><span class="ident" id="7894523">Encode</span><span class="op" id="7894529">(</span><span class="ident" id="7894530">test</span><span class="op" id="7894534">.</span><span class="ident" id="7894535">in</span><span class="op" id="7894537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894541">if</span>&nbsp;<span class="ident" id="7894544">err</span>&nbsp;<span class="op" id="7894548">!=</span>&nbsp;<span class="ident" id="7894551">nil</span>&nbsp;<span class="op" id="7894555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894560">t</span><span class="op" id="7894561">.</span><span class="ident" id="7894562">Errorf</span><span class="op" id="7894568">(</span><span class="string" id="7894569">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7894592">,</span>&nbsp;<span class="ident" id="7894594">test</span><span class="op" id="7894598">.</span><span class="ident" id="7894599">in</span><span class="op" id="7894601">,</span>&nbsp;<span class="ident" id="7894603">err</span><span class="op" id="7894606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894611">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894622">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894626">err</span>&nbsp;<span class="op" id="7894630">=</span>&nbsp;<span class="ident" id="7894632">dec</span><span class="op" id="7894635">.</span><span class="ident" id="7894636">Decode</span><span class="op" id="7894642">(</span><span class="ident" id="7894643">test</span><span class="op" id="7894647">.</span><span class="ident" id="7894648">out</span><span class="op" id="7894651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894655">switch</span>&nbsp;<span class="op" id="7894662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894666">case</span>&nbsp;<span class="ident" id="7894671">err</span>&nbsp;<span class="op" id="7894675">!=</span>&nbsp;<span class="ident" id="7894678">nil</span>&nbsp;<span class="op" id="7894682">&amp;&amp;</span>&nbsp;<span class="ident" id="7894685">test</span><span class="op" id="7894689">.</span><span class="ident" id="7894690">err</span>&nbsp;<span class="op" id="7894694">==</span>&nbsp;<span class="string" id="7894697">&#34;&#34;</span><span class="op" id="7894699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894704">t</span><span class="op" id="7894705">.</span><span class="ident" id="7894706">Errorf</span><span class="op" id="7894712">(</span><span class="string" id="7894713">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7894736">,</span>&nbsp;<span class="ident" id="7894738">test</span><span class="op" id="7894742">.</span><span class="ident" id="7894743">in</span><span class="op" id="7894745">,</span>&nbsp;<span class="ident" id="7894747">err</span><span class="op" id="7894750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894755">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894766">case</span>&nbsp;<span class="ident" id="7894771">err</span>&nbsp;<span class="op" id="7894775">==</span>&nbsp;<span class="ident" id="7894778">nil</span>&nbsp;<span class="op" id="7894782">&amp;&amp;</span>&nbsp;<span class="ident" id="7894785">test</span><span class="op" id="7894789">.</span><span class="ident" id="7894790">err</span>&nbsp;<span class="op" id="7894794">!=</span>&nbsp;<span class="string" id="7894797">&#34;&#34;</span><span class="op" id="7894799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894804">t</span><span class="op" id="7894805">.</span><span class="ident" id="7894806">Errorf</span><span class="op" id="7894812">(</span><span class="string" id="7894813">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7894845">,</span>&nbsp;<span class="ident" id="7894847">test</span><span class="op" id="7894851">.</span><span class="ident" id="7894852">in</span><span class="op" id="7894854">,</span>&nbsp;<span class="ident" id="7894856">test</span><span class="op" id="7894860">.</span><span class="ident" id="7894861">err</span><span class="op" id="7894864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894869">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894880">case</span>&nbsp;<span class="ident" id="7894885">err</span>&nbsp;<span class="op" id="7894889">!=</span>&nbsp;<span class="ident" id="7894892">nil</span>&nbsp;<span class="op" id="7894896">&amp;&amp;</span>&nbsp;<span class="ident" id="7894899">test</span><span class="op" id="7894903">.</span><span class="ident" id="7894904">err</span>&nbsp;<span class="op" id="7894908">!=</span>&nbsp;<span class="string" id="7894911">&#34;&#34;</span><span class="op" id="7894913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894918">if</span>&nbsp;<span class="ident" id="7894921">strings</span><span class="op" id="7894928">.</span><span class="ident" id="7894929">Index</span><span class="op" id="7894934">(</span><span class="ident" id="7894935">err</span><span class="op" id="7894938">.</span><span class="ident" id="7894939">Error</span><span class="op" id="7894944">(</span><span class="op" id="7894945">)</span><span class="op" id="7894946">,</span>&nbsp;<span class="ident" id="7894948">test</span><span class="op" id="7894952">.</span><span class="ident" id="7894953">err</span><span class="op" id="7894956">)</span>&nbsp;<span class="op" id="7894958">&lt;</span>&nbsp;<span class="num" id="7894960">0</span>&nbsp;<span class="op" id="7894962">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894968">t</span><span class="op" id="7894969">.</span><span class="ident" id="7894970">Errorf</span><span class="op" id="7894976">(</span><span class="string" id="7894977">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7895021">,</span>&nbsp;<span class="ident" id="7895023">test</span><span class="op" id="7895027">.</span><span class="ident" id="7895028">in</span><span class="op" id="7895030">,</span>&nbsp;<span class="ident" id="7895032">test</span><span class="op" id="7895036">.</span><span class="ident" id="7895037">err</span><span class="op" id="7895040">,</span>&nbsp;<span class="ident" id="7895042">err</span><span class="op" id="7895045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895055">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7895070">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895109">val</span>&nbsp;<span class="op" id="7895113">:=</span>&nbsp;<span class="ident" id="7895116">reflect</span><span class="op" id="7895123">.</span><span class="ident" id="7895124">ValueOf</span><span class="op" id="7895131">(</span><span class="ident" id="7895132">test</span><span class="op" id="7895136">.</span><span class="ident" id="7895137">out</span><span class="op" id="7895140">)</span><span class="op" id="7895141">.</span><span class="ident" id="7895142">Elem</span><span class="op" id="7895146">(</span><span class="op" id="7895147">)</span><span class="op" id="7895148">.</span><span class="ident" id="7895149">Interface</span><span class="op" id="7895158">(</span><span class="op" id="7895159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895163">if</span>&nbsp;<span class="op" id="7895166">!</span><span class="ident" id="7895167">reflect</span><span class="op" id="7895174">.</span><span class="ident" id="7895175">DeepEqual</span><span class="op" id="7895184">(</span><span class="ident" id="7895185">test</span><span class="op" id="7895189">.</span><span class="ident" id="7895190">in</span><span class="op" id="7895192">,</span>&nbsp;<span class="ident" id="7895194">val</span><span class="op" id="7895197">)</span>&nbsp;<span class="op" id="7895199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895204">t</span><span class="op" id="7895205">.</span><span class="ident" id="7895206">Errorf</span><span class="op" id="7895212">(</span><span class="string" id="7895213">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7895253">,</span>&nbsp;<span class="ident" id="7895255">test</span><span class="op" id="7895259">.</span><span class="ident" id="7895260">in</span><span class="op" id="7895262">,</span>&nbsp;<span class="ident" id="7895264">val</span><span class="op" id="7895267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895274">}</span><br>
<span class="lineno">420</span><span class="op" id="7895276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7895279">func</span>&nbsp;<span class="ident" id="7895284">TestStructNonStruct</span><span class="op" id="7895303">(</span><span class="ident" id="7895304">t</span>&nbsp;<span class="op" id="7895306">*</span><span class="ident" id="7895307">testing</span><span class="op" id="7895314">.</span><span class="ident" id="7895315">T</span><span class="op" id="7895316">)</span>&nbsp;<span class="op" id="7895318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895321">type</span>&nbsp;<span class="ident" id="7895326">Struct</span>&nbsp;<span class="keyword" id="7895333">struct</span>&nbsp;<span class="op" id="7895340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895344">A</span>&nbsp;<span class="builtintype" id="7895346">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895357">type</span>&nbsp;<span class="ident" id="7895362">NonStruct</span>&nbsp;<span class="builtintype" id="7895372">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895380">s</span>&nbsp;<span class="op" id="7895382">:=</span>&nbsp;<span class="ident" id="7895385">Struct</span><span class="op" id="7895391">{</span><span class="string" id="7895392">&#34;hello&#34;</span><span class="op" id="7895399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895402">var</span>&nbsp;<span class="ident" id="7895406">sp</span>&nbsp;<span class="ident" id="7895409">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895417">if</span>&nbsp;<span class="ident" id="7895420">err</span>&nbsp;<span class="op" id="7895424">:=</span>&nbsp;<span class="ident" id="7895427">encAndDec</span><span class="op" id="7895436">(</span><span class="ident" id="7895437">s</span><span class="op" id="7895438">,</span>&nbsp;<span class="op" id="7895440">&amp;</span><span class="ident" id="7895441">sp</span><span class="op" id="7895443">)</span><span class="op" id="7895444">;</span>&nbsp;<span class="ident" id="7895446">err</span>&nbsp;<span class="op" id="7895450">!=</span>&nbsp;<span class="ident" id="7895453">nil</span>&nbsp;<span class="op" id="7895457">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895461">t</span><span class="op" id="7895462">.</span><span class="ident" id="7895463">Error</span><span class="op" id="7895468">(</span><span class="ident" id="7895469">err</span><span class="op" id="7895472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895478">var</span>&nbsp;<span class="ident" id="7895482">ns</span>&nbsp;<span class="ident" id="7895485">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895496">if</span>&nbsp;<span class="ident" id="7895499">err</span>&nbsp;<span class="op" id="7895503">:=</span>&nbsp;<span class="ident" id="7895506">encAndDec</span><span class="op" id="7895515">(</span><span class="ident" id="7895516">s</span><span class="op" id="7895517">,</span>&nbsp;<span class="op" id="7895519">&amp;</span><span class="ident" id="7895520">ns</span><span class="op" id="7895522">)</span><span class="op" id="7895523">;</span>&nbsp;<span class="ident" id="7895525">err</span>&nbsp;<span class="op" id="7895529">==</span>&nbsp;<span class="ident" id="7895532">nil</span>&nbsp;<span class="op" id="7895536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895540">t</span><span class="op" id="7895541">.</span><span class="ident" id="7895542">Error</span><span class="op" id="7895547">(</span><span class="string" id="7895548">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="7895588">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895591">}</span>&nbsp;<span class="keyword" id="7895593">else</span>&nbsp;<span class="keyword" id="7895598">if</span>&nbsp;<span class="ident" id="7895601">strings</span><span class="op" id="7895608">.</span><span class="ident" id="7895609">Index</span><span class="op" id="7895614">(</span><span class="ident" id="7895615">err</span><span class="op" id="7895618">.</span><span class="ident" id="7895619">Error</span><span class="op" id="7895624">(</span><span class="op" id="7895625">)</span><span class="op" id="7895626">,</span>&nbsp;<span class="string" id="7895628">&#34;type&#34;</span><span class="op" id="7895634">)</span>&nbsp;<span class="op" id="7895636">&lt;</span>&nbsp;<span class="num" id="7895638">0</span>&nbsp;<span class="op" id="7895640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895644">t</span><span class="op" id="7895645">.</span><span class="ident" id="7895646">Error</span><span class="op" id="7895651">(</span><span class="string" id="7895652">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7895700">,</span>&nbsp;<span class="ident" id="7895702">err</span><span class="op" id="7895705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7895711">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895737">var</span>&nbsp;<span class="ident" id="7895741">nsp</span>&nbsp;<span class="ident" id="7895745">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895756">if</span>&nbsp;<span class="ident" id="7895759">err</span>&nbsp;<span class="op" id="7895763">:=</span>&nbsp;<span class="ident" id="7895766">encAndDec</span><span class="op" id="7895775">(</span><span class="ident" id="7895776">ns</span><span class="op" id="7895778">,</span>&nbsp;<span class="op" id="7895780">&amp;</span><span class="ident" id="7895781">nsp</span><span class="op" id="7895784">)</span><span class="op" id="7895785">;</span>&nbsp;<span class="ident" id="7895787">err</span>&nbsp;<span class="op" id="7895791">!=</span>&nbsp;<span class="ident" id="7895794">nil</span>&nbsp;<span class="op" id="7895798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895802">t</span><span class="op" id="7895803">.</span><span class="ident" id="7895804">Error</span><span class="op" id="7895809">(</span><span class="ident" id="7895810">err</span><span class="op" id="7895813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895819">if</span>&nbsp;<span class="ident" id="7895822">err</span>&nbsp;<span class="op" id="7895826">:=</span>&nbsp;<span class="ident" id="7895829">encAndDec</span><span class="op" id="7895838">(</span><span class="ident" id="7895839">ns</span><span class="op" id="7895841">,</span>&nbsp;<span class="op" id="7895843">&amp;</span><span class="ident" id="7895844">s</span><span class="op" id="7895845">)</span><span class="op" id="7895846">;</span>&nbsp;<span class="ident" id="7895848">err</span>&nbsp;<span class="op" id="7895852">==</span>&nbsp;<span class="ident" id="7895855">nil</span>&nbsp;<span class="op" id="7895859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895863">t</span><span class="op" id="7895864">.</span><span class="ident" id="7895865">Error</span><span class="op" id="7895870">(</span><span class="string" id="7895871">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="7895911">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895914">}</span>&nbsp;<span class="keyword" id="7895916">else</span>&nbsp;<span class="keyword" id="7895921">if</span>&nbsp;<span class="ident" id="7895924">strings</span><span class="op" id="7895931">.</span><span class="ident" id="7895932">Index</span><span class="op" id="7895937">(</span><span class="ident" id="7895938">err</span><span class="op" id="7895941">.</span><span class="ident" id="7895942">Error</span><span class="op" id="7895947">(</span><span class="op" id="7895948">)</span><span class="op" id="7895949">,</span>&nbsp;<span class="string" id="7895951">&#34;type&#34;</span><span class="op" id="7895957">)</span>&nbsp;<span class="op" id="7895959">&lt;</span>&nbsp;<span class="num" id="7895961">0</span>&nbsp;<span class="op" id="7895963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895967">t</span><span class="op" id="7895968">.</span><span class="ident" id="7895969">Error</span><span class="op" id="7895974">(</span><span class="string" id="7895975">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7896023">,</span>&nbsp;<span class="ident" id="7896025">err</span><span class="op" id="7896028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896031">}</span><br>
<span class="lineno"></span><span class="op" id="7896033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7896036">type</span>&nbsp;<span class="ident" id="7896041">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="7896064">interface</span>&nbsp;<span class="op" id="7896074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896077">F</span><span class="op" id="7896078">(</span><span class="op" id="7896079">)</span>&nbsp;<span class="builtintype" id="7896081">bool</span><br>
<span class="lineno"></span><span class="op" id="7896086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7896089">type</span>&nbsp;<span class="ident" id="7896094">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="7896117">struct</span><span class="op" id="7896123">{</span><span class="op" id="7896124">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7896127">func</span>&nbsp;<span class="op" id="7896132">(</span><span class="ident" id="7896133">this</span>&nbsp;<span class="op" id="7896138">*</span><span class="ident" id="7896139">interfaceIndirectTestT</span><span class="op" id="7896161">)</span>&nbsp;<span class="ident" id="7896163">F</span><span class="op" id="7896164">(</span><span class="op" id="7896165">)</span>&nbsp;<span class="builtintype" id="7896167">bool</span>&nbsp;<span class="op" id="7896172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896175">return</span>&nbsp;<span class="builtintype" id="7896182">true</span><br>
<span class="lineno"></span><span class="op" id="7896187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="7896190">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="7896259">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="7896328">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="7896360">func</span>&nbsp;<span class="ident" id="7896365">TestInterfaceIndirect</span><span class="op" id="7896386">(</span><span class="ident" id="7896387">t</span>&nbsp;<span class="op" id="7896389">*</span><span class="ident" id="7896390">testing</span><span class="op" id="7896397">.</span><span class="ident" id="7896398">T</span><span class="op" id="7896399">)</span>&nbsp;<span class="op" id="7896401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896404">Register</span><span class="op" id="7896412">(</span><span class="op" id="7896413">&amp;</span><span class="ident" id="7896414">interfaceIndirectTestT</span><span class="op" id="7896436">{</span><span class="op" id="7896437">}</span><span class="op" id="7896438">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896441">b</span>&nbsp;<span class="op" id="7896443">:=</span>&nbsp;<span class="builtinfunc" id="7896446">new</span><span class="op" id="7896449">(</span><span class="ident" id="7896450">bytes</span><span class="op" id="7896455">.</span><span class="ident" id="7896456">Buffer</span><span class="op" id="7896462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896465">w</span>&nbsp;<span class="op" id="7896467">:=</span>&nbsp;<span class="op" id="7896470">[</span><span class="op" id="7896471">]</span><span class="ident" id="7896472">interfaceIndirectTestI</span><span class="op" id="7896494">{</span><span class="op" id="7896495">&amp;</span><span class="ident" id="7896496">interfaceIndirectTestT</span><span class="op" id="7896518">{</span><span class="op" id="7896519">}</span><span class="op" id="7896520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896523">err</span>&nbsp;<span class="op" id="7896527">:=</span>&nbsp;<span class="ident" id="7896530">NewEncoder</span><span class="op" id="7896540">(</span><span class="ident" id="7896541">b</span><span class="op" id="7896542">)</span><span class="op" id="7896543">.</span><span class="ident" id="7896544">Encode</span><span class="op" id="7896550">(</span><span class="ident" id="7896551">w</span><span class="op" id="7896552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896555">if</span>&nbsp;<span class="ident" id="7896558">err</span>&nbsp;<span class="op" id="7896562">!=</span>&nbsp;<span class="ident" id="7896565">nil</span>&nbsp;<span class="op" id="7896569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896573">t</span><span class="op" id="7896574">.</span><span class="ident" id="7896575">Fatal</span><span class="op" id="7896580">(</span><span class="string" id="7896581">&#34;encode&nbsp;error:&#34;</span><span class="op" id="7896596">,</span>&nbsp;<span class="ident" id="7896598">err</span><span class="op" id="7896601">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896608">var</span>&nbsp;<span class="ident" id="7896612">r</span>&nbsp;<span class="op" id="7896614">[</span><span class="op" id="7896615">]</span><span class="ident" id="7896616">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896640">err</span>&nbsp;<span class="op" id="7896644">=</span>&nbsp;<span class="ident" id="7896646">NewDecoder</span><span class="op" id="7896656">(</span><span class="ident" id="7896657">b</span><span class="op" id="7896658">)</span><span class="op" id="7896659">.</span><span class="ident" id="7896660">Decode</span><span class="op" id="7896666">(</span><span class="op" id="7896667">&amp;</span><span class="ident" id="7896668">r</span><span class="op" id="7896669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896672">if</span>&nbsp;<span class="ident" id="7896675">err</span>&nbsp;<span class="op" id="7896679">!=</span>&nbsp;<span class="ident" id="7896682">nil</span>&nbsp;<span class="op" id="7896686">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896690">t</span><span class="op" id="7896691">.</span><span class="ident" id="7896692">Fatal</span><span class="op" id="7896697">(</span><span class="string" id="7896698">&#34;decode&nbsp;error:&#34;</span><span class="op" id="7896713">,</span>&nbsp;<span class="ident" id="7896715">err</span><span class="op" id="7896718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896721">}</span><br>
<span class="lineno"></span><span class="op" id="7896723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7896726">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="7896803">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7896852">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="7896928">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="7897005">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="7897078">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7897155">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897224">type</span>&nbsp;<span class="ident" id="7897229">Struct0</span>&nbsp;<span class="keyword" id="7897237">struct</span>&nbsp;<span class="op" id="7897244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897247">I</span>&nbsp;<span class="keyword" id="7897249">interface</span><span class="op" id="7897258">{</span><span class="op" id="7897259">}</span><br>
<span class="lineno">490</span><span class="op" id="7897261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897264">type</span>&nbsp;<span class="ident" id="7897269">NewType0</span>&nbsp;<span class="keyword" id="7897278">struct</span>&nbsp;<span class="op" id="7897285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897288">S</span>&nbsp;<span class="builtintype" id="7897290">string</span><br>
<span class="lineno"></span><span class="op" id="7897297">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="7897300">type</span>&nbsp;<span class="ident" id="7897305">ignoreTest</span>&nbsp;<span class="keyword" id="7897316">struct</span>&nbsp;<span class="op" id="7897323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897326">in</span><span class="op" id="7897328">,</span>&nbsp;<span class="ident" id="7897330">out</span>&nbsp;<span class="keyword" id="7897334">interface</span><span class="op" id="7897343">{</span><span class="op" id="7897344">}</span><br>
<span class="lineno"></span><span class="op" id="7897346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="7897349">var</span>&nbsp;<span class="ident" id="7897353">ignoreTests</span>&nbsp;<span class="op" id="7897365">=</span>&nbsp;<span class="op" id="7897367">[</span><span class="op" id="7897368">]</span><span class="ident" id="7897369">ignoreTest</span><span class="op" id="7897379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7897382">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897428">{</span><span class="op" id="7897429">&amp;</span><span class="keyword" id="7897430">struct</span><span class="op" id="7897436">{</span>&nbsp;<span class="ident" id="7897438">A</span>&nbsp;<span class="builtintype" id="7897440">int</span>&nbsp;<span class="op" id="7897444">}</span><span class="op" id="7897445">{</span><span class="num" id="7897446">23</span><span class="op" id="7897448">}</span><span class="op" id="7897449">,</span>&nbsp;<span class="op" id="7897451">&amp;</span><span class="keyword" id="7897452">struct</span><span class="op" id="7897458">{</span><span class="op" id="7897459">}</span><span class="op" id="7897460">{</span><span class="op" id="7897461">}</span><span class="op" id="7897462">}</span><span class="op" id="7897463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7897466">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897503">{</span><span class="op" id="7897504">&amp;</span><span class="keyword" id="7897505">struct</span><span class="op" id="7897511">{</span>&nbsp;<span class="ident" id="7897513">A</span>&nbsp;<span class="builtintype" id="7897515">int</span>&nbsp;<span class="op" id="7897519">}</span><span class="op" id="7897520">{</span><span class="num" id="7897521">23</span><span class="op" id="7897523">}</span><span class="op" id="7897524">,</span>&nbsp;<span class="ident" id="7897526">nil</span><span class="op" id="7897529">}</span><span class="op" id="7897530">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7897533">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897573">{</span><span class="string" id="7897574">&#34;hello,&nbsp;world&#34;</span><span class="op" id="7897588">,</span>&nbsp;<span class="ident" id="7897590">nil</span><span class="op" id="7897593">}</span><span class="op" id="7897594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7897597">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897636">{</span><span class="op" id="7897637">[</span><span class="op" id="7897638">]</span><span class="builtintype" id="7897639">int</span><span class="op" id="7897642">{</span><span class="num" id="7897643">1</span><span class="op" id="7897644">,</span>&nbsp;<span class="num" id="7897646">2</span><span class="op" id="7897647">,</span>&nbsp;<span class="num" id="7897649">3</span><span class="op" id="7897650">,</span>&nbsp;<span class="num" id="7897652">4</span><span class="op" id="7897653">}</span><span class="op" id="7897654">,</span>&nbsp;<span class="ident" id="7897656">nil</span><span class="op" id="7897659">}</span><span class="op" id="7897660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7897663">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897717">{</span><span class="op" id="7897718">&amp;</span><span class="ident" id="7897719">Struct0</span><span class="op" id="7897726">{</span><span class="op" id="7897727">&amp;</span><span class="ident" id="7897728">NewType0</span><span class="op" id="7897736">{</span><span class="string" id="7897737">&#34;value0&#34;</span><span class="op" id="7897745">}</span><span class="op" id="7897746">}</span><span class="op" id="7897747">,</span>&nbsp;<span class="ident" id="7897749">nil</span><span class="op" id="7897752">}</span><span class="op" id="7897753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7897756">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897809">{</span><span class="op" id="7897810">[</span><span class="op" id="7897811">]</span><span class="keyword" id="7897812">interface</span><span class="op" id="7897821">{</span><span class="op" id="7897822">}</span><span class="op" id="7897823">{</span><span class="string" id="7897824">&#34;hi&#34;</span><span class="op" id="7897828">,</span>&nbsp;<span class="op" id="7897830">&amp;</span><span class="ident" id="7897831">NewType0</span><span class="op" id="7897839">{</span><span class="string" id="7897840">&#34;value1&#34;</span><span class="op" id="7897848">}</span><span class="op" id="7897849">,</span>&nbsp;<span class="num" id="7897851">23</span><span class="op" id="7897853">}</span><span class="op" id="7897854">,</span>&nbsp;<span class="ident" id="7897856">nil</span><span class="op" id="7897859">}</span><span class="op" id="7897860">,</span><br>
<span class="lineno"></span><span class="op" id="7897862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7897865">func</span>&nbsp;<span class="ident" id="7897870">TestDecodeIntoNothing</span><span class="op" id="7897891">(</span><span class="ident" id="7897892">t</span>&nbsp;<span class="op" id="7897894">*</span><span class="ident" id="7897895">testing</span><span class="op" id="7897902">.</span><span class="ident" id="7897903">T</span><span class="op" id="7897904">)</span>&nbsp;<span class="op" id="7897906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897909">Register</span><span class="op" id="7897917">(</span><span class="builtinfunc" id="7897918">new</span><span class="op" id="7897921">(</span><span class="ident" id="7897922">NewType0</span><span class="op" id="7897930">)</span><span class="op" id="7897931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897934">for</span>&nbsp;<span class="ident" id="7897938">i</span><span class="op" id="7897939">,</span>&nbsp;<span class="ident" id="7897941">test</span>&nbsp;<span class="op" id="7897946">:=</span>&nbsp;<span class="keyword" id="7897949">range</span>&nbsp;<span class="ident" id="7897955">ignoreTests</span>&nbsp;<span class="op" id="7897967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897971">b</span>&nbsp;<span class="op" id="7897973">:=</span>&nbsp;<span class="builtinfunc" id="7897976">new</span><span class="op" id="7897979">(</span><span class="ident" id="7897980">bytes</span><span class="op" id="7897985">.</span><span class="ident" id="7897986">Buffer</span><span class="op" id="7897992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897996">enc</span>&nbsp;<span class="op" id="7898000">:=</span>&nbsp;<span class="ident" id="7898003">NewEncoder</span><span class="op" id="7898013">(</span><span class="ident" id="7898014">b</span><span class="op" id="7898015">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898019">err</span>&nbsp;<span class="op" id="7898023">:=</span>&nbsp;<span class="ident" id="7898026">enc</span><span class="op" id="7898029">.</span><span class="ident" id="7898030">Encode</span><span class="op" id="7898036">(</span><span class="ident" id="7898037">test</span><span class="op" id="7898041">.</span><span class="ident" id="7898042">in</span><span class="op" id="7898044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898048">if</span>&nbsp;<span class="ident" id="7898051">err</span>&nbsp;<span class="op" id="7898055">!=</span>&nbsp;<span class="ident" id="7898058">nil</span>&nbsp;<span class="op" id="7898062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898067">t</span><span class="op" id="7898068">.</span><span class="ident" id="7898069">Errorf</span><span class="op" id="7898075">(</span><span class="string" id="7898076">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="7898098">,</span>&nbsp;<span class="ident" id="7898100">i</span><span class="op" id="7898101">,</span>&nbsp;<span class="ident" id="7898103">err</span><span class="op" id="7898106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898111">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898122">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898126">dec</span>&nbsp;<span class="op" id="7898130">:=</span>&nbsp;<span class="ident" id="7898133">NewDecoder</span><span class="op" id="7898143">(</span><span class="ident" id="7898144">b</span><span class="op" id="7898145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898149">err</span>&nbsp;<span class="op" id="7898153">=</span>&nbsp;<span class="ident" id="7898155">dec</span><span class="op" id="7898158">.</span><span class="ident" id="7898159">Decode</span><span class="op" id="7898165">(</span><span class="ident" id="7898166">test</span><span class="op" id="7898170">.</span><span class="ident" id="7898171">out</span><span class="op" id="7898174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898178">if</span>&nbsp;<span class="ident" id="7898181">err</span>&nbsp;<span class="op" id="7898185">!=</span>&nbsp;<span class="ident" id="7898188">nil</span>&nbsp;<span class="op" id="7898192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898197">t</span><span class="op" id="7898198">.</span><span class="ident" id="7898199">Errorf</span><span class="op" id="7898205">(</span><span class="string" id="7898206">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7898228">,</span>&nbsp;<span class="ident" id="7898230">i</span><span class="op" id="7898231">,</span>&nbsp;<span class="ident" id="7898233">err</span><span class="op" id="7898236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898241">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7898256">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898323">str</span>&nbsp;<span class="op" id="7898327">:=</span>&nbsp;<span class="ident" id="7898330">fmt</span><span class="op" id="7898333">.</span><span class="ident" id="7898334">Sprintf</span><span class="op" id="7898341">(</span><span class="string" id="7898342">&#34;Value&nbsp;%d&#34;</span><span class="op" id="7898352">,</span>&nbsp;<span class="ident" id="7898354">i</span><span class="op" id="7898355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898359">err</span>&nbsp;<span class="op" id="7898363">=</span>&nbsp;<span class="ident" id="7898365">enc</span><span class="op" id="7898368">.</span><span class="ident" id="7898369">Encode</span><span class="op" id="7898375">(</span><span class="op" id="7898376">&amp;</span><span class="ident" id="7898377">NewType0</span><span class="op" id="7898385">{</span><span class="ident" id="7898386">str</span><span class="op" id="7898389">}</span><span class="op" id="7898390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898394">if</span>&nbsp;<span class="ident" id="7898397">err</span>&nbsp;<span class="op" id="7898401">!=</span>&nbsp;<span class="ident" id="7898404">nil</span>&nbsp;<span class="op" id="7898408">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898413">t</span><span class="op" id="7898414">.</span><span class="ident" id="7898415">Fatalf</span><span class="op" id="7898421">(</span><span class="string" id="7898422">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7898453">,</span>&nbsp;<span class="ident" id="7898455">i</span><span class="op" id="7898456">,</span>&nbsp;<span class="ident" id="7898458">err</span><span class="op" id="7898461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898469">ns</span>&nbsp;<span class="op" id="7898472">:=</span>&nbsp;<span class="builtinfunc" id="7898475">new</span><span class="op" id="7898478">(</span><span class="ident" id="7898479">NewType0</span><span class="op" id="7898487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898491">err</span>&nbsp;<span class="op" id="7898495">=</span>&nbsp;<span class="ident" id="7898497">dec</span><span class="op" id="7898500">.</span><span class="ident" id="7898501">Decode</span><span class="op" id="7898507">(</span><span class="ident" id="7898508">ns</span><span class="op" id="7898510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898514">if</span>&nbsp;<span class="ident" id="7898517">err</span>&nbsp;<span class="op" id="7898521">!=</span>&nbsp;<span class="ident" id="7898524">nil</span>&nbsp;<span class="op" id="7898528">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898533">t</span><span class="op" id="7898534">.</span><span class="ident" id="7898535">Fatalf</span><span class="op" id="7898541">(</span><span class="string" id="7898542">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7898573">,</span>&nbsp;<span class="ident" id="7898575">i</span><span class="op" id="7898576">,</span>&nbsp;<span class="ident" id="7898578">err</span><span class="op" id="7898581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898589">if</span>&nbsp;<span class="ident" id="7898592">ns</span><span class="op" id="7898594">.</span><span class="ident" id="7898595">S</span>&nbsp;<span class="op" id="7898597">!=</span>&nbsp;<span class="ident" id="7898600">str</span>&nbsp;<span class="op" id="7898604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898609">t</span><span class="op" id="7898610">.</span><span class="ident" id="7898611">Fatalf</span><span class="op" id="7898617">(</span><span class="string" id="7898618">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7898642">,</span>&nbsp;<span class="ident" id="7898644">i</span><span class="op" id="7898645">,</span>&nbsp;<span class="ident" id="7898647">str</span><span class="op" id="7898650">,</span>&nbsp;<span class="ident" id="7898652">ns</span><span class="op" id="7898654">.</span><span class="ident" id="7898655">S</span><span class="op" id="7898656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898660">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898663">}</span><br>
<span class="lineno"></span><span class="op" id="7898665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7898668">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="7898730">type</span>&nbsp;<span class="ident" id="7898735">Bug0Outer</span>&nbsp;<span class="keyword" id="7898745">struct</span>&nbsp;<span class="op" id="7898752">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898755">Bug0Field</span>&nbsp;<span class="keyword" id="7898765">interface</span><span class="op" id="7898774">{</span><span class="op" id="7898775">}</span><br>
<span class="lineno"></span><span class="op" id="7898777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7898780">type</span>&nbsp;<span class="ident" id="7898785">Bug0Inner</span>&nbsp;<span class="keyword" id="7898795">struct</span>&nbsp;<span class="op" id="7898802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898805">A</span>&nbsp;<span class="builtintype" id="7898807">int</span><br>
<span class="lineno">555</span><span class="op" id="7898811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7898814">func</span>&nbsp;<span class="ident" id="7898819">TestNestedInterfaces</span><span class="op" id="7898839">(</span><span class="ident" id="7898840">t</span>&nbsp;<span class="op" id="7898842">*</span><span class="ident" id="7898843">testing</span><span class="op" id="7898850">.</span><span class="ident" id="7898851">T</span><span class="op" id="7898852">)</span>&nbsp;<span class="op" id="7898854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898857">var</span>&nbsp;<span class="ident" id="7898861">buf</span>&nbsp;<span class="ident" id="7898865">bytes</span><span class="op" id="7898870">.</span><span class="ident" id="7898871">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898879">e</span>&nbsp;<span class="op" id="7898881">:=</span>&nbsp;<span class="ident" id="7898884">NewEncoder</span><span class="op" id="7898894">(</span><span class="op" id="7898895">&amp;</span><span class="ident" id="7898896">buf</span><span class="op" id="7898899">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898902">d</span>&nbsp;<span class="op" id="7898904">:=</span>&nbsp;<span class="ident" id="7898907">NewDecoder</span><span class="op" id="7898917">(</span><span class="op" id="7898918">&amp;</span><span class="ident" id="7898919">buf</span><span class="op" id="7898922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898925">Register</span><span class="op" id="7898933">(</span><span class="builtinfunc" id="7898934">new</span><span class="op" id="7898937">(</span><span class="ident" id="7898938">Bug0Outer</span><span class="op" id="7898947">)</span><span class="op" id="7898948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898951">Register</span><span class="op" id="7898959">(</span><span class="builtinfunc" id="7898960">new</span><span class="op" id="7898963">(</span><span class="ident" id="7898964">Bug0Inner</span><span class="op" id="7898973">)</span><span class="op" id="7898974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898977">f</span>&nbsp;<span class="op" id="7898979">:=</span>&nbsp;<span class="op" id="7898982">&amp;</span><span class="ident" id="7898983">Bug0Outer</span><span class="op" id="7898992">{</span><span class="op" id="7898993">&amp;</span><span class="ident" id="7898994">Bug0Outer</span><span class="op" id="7899003">{</span><span class="op" id="7899004">&amp;</span><span class="ident" id="7899005">Bug0Inner</span><span class="op" id="7899014">{</span><span class="num" id="7899015">7</span><span class="op" id="7899016">}</span><span class="op" id="7899017">}</span><span class="op" id="7899018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899021">var</span>&nbsp;<span class="ident" id="7899025">v</span>&nbsp;<span class="keyword" id="7899027">interface</span><span class="op" id="7899036">{</span><span class="op" id="7899037">}</span>&nbsp;<span class="op" id="7899039">=</span>&nbsp;<span class="ident" id="7899041">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899044">err</span>&nbsp;<span class="op" id="7899048">:=</span>&nbsp;<span class="ident" id="7899051">e</span><span class="op" id="7899052">.</span><span class="ident" id="7899053">Encode</span><span class="op" id="7899059">(</span><span class="op" id="7899060">&amp;</span><span class="ident" id="7899061">v</span><span class="op" id="7899062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899065">if</span>&nbsp;<span class="ident" id="7899068">err</span>&nbsp;<span class="op" id="7899072">!=</span>&nbsp;<span class="ident" id="7899075">nil</span>&nbsp;<span class="op" id="7899079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899083">t</span><span class="op" id="7899084">.</span><span class="ident" id="7899085">Fatal</span><span class="op" id="7899090">(</span><span class="string" id="7899091">&#34;Encode:&#34;</span><span class="op" id="7899100">,</span>&nbsp;<span class="ident" id="7899102">err</span><span class="op" id="7899105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899111">err</span>&nbsp;<span class="op" id="7899115">=</span>&nbsp;<span class="ident" id="7899117">d</span><span class="op" id="7899118">.</span><span class="ident" id="7899119">Decode</span><span class="op" id="7899125">(</span><span class="op" id="7899126">&amp;</span><span class="ident" id="7899127">v</span><span class="op" id="7899128">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899131">if</span>&nbsp;<span class="ident" id="7899134">err</span>&nbsp;<span class="op" id="7899138">!=</span>&nbsp;<span class="ident" id="7899141">nil</span>&nbsp;<span class="op" id="7899145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899149">t</span><span class="op" id="7899150">.</span><span class="ident" id="7899151">Fatal</span><span class="op" id="7899156">(</span><span class="string" id="7899157">&#34;Decode:&#34;</span><span class="op" id="7899166">,</span>&nbsp;<span class="ident" id="7899168">err</span><span class="op" id="7899171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7899177">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899213">outer1</span><span class="op" id="7899219">,</span>&nbsp;<span class="ident" id="7899221">ok</span>&nbsp;<span class="op" id="7899224">:=</span>&nbsp;<span class="ident" id="7899227">v</span><span class="op" id="7899228">.</span><span class="op" id="7899229">(</span><span class="op" id="7899230">*</span><span class="ident" id="7899231">Bug0Outer</span><span class="op" id="7899240">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899243">if</span>&nbsp;<span class="op" id="7899246">!</span><span class="ident" id="7899247">ok</span>&nbsp;<span class="op" id="7899250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899254">t</span><span class="op" id="7899255">.</span><span class="ident" id="7899256">Fatalf</span><span class="op" id="7899262">(</span><span class="string" id="7899263">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="7899284">,</span>&nbsp;<span class="ident" id="7899286">v</span><span class="op" id="7899287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899293">outer2</span><span class="op" id="7899299">,</span>&nbsp;<span class="ident" id="7899301">ok</span>&nbsp;<span class="op" id="7899304">:=</span>&nbsp;<span class="ident" id="7899307">outer1</span><span class="op" id="7899313">.</span><span class="ident" id="7899314">Bug0Field</span><span class="op" id="7899323">.</span><span class="op" id="7899324">(</span><span class="op" id="7899325">*</span><span class="ident" id="7899326">Bug0Outer</span><span class="op" id="7899335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899338">if</span>&nbsp;<span class="op" id="7899341">!</span><span class="ident" id="7899342">ok</span>&nbsp;<span class="op" id="7899345">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899349">t</span><span class="op" id="7899350">.</span><span class="ident" id="7899351">Fatalf</span><span class="op" id="7899357">(</span><span class="string" id="7899358">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="7899389">,</span>&nbsp;<span class="ident" id="7899391">outer1</span><span class="op" id="7899397">.</span><span class="ident" id="7899398">Bug0Field</span><span class="op" id="7899407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899413">inner</span><span class="op" id="7899418">,</span>&nbsp;<span class="ident" id="7899420">ok</span>&nbsp;<span class="op" id="7899423">:=</span>&nbsp;<span class="ident" id="7899426">outer2</span><span class="op" id="7899432">.</span><span class="ident" id="7899433">Bug0Field</span><span class="op" id="7899442">.</span><span class="op" id="7899443">(</span><span class="op" id="7899444">*</span><span class="ident" id="7899445">Bug0Inner</span><span class="op" id="7899454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899457">if</span>&nbsp;<span class="op" id="7899460">!</span><span class="ident" id="7899461">ok</span>&nbsp;<span class="op" id="7899464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899468">t</span><span class="op" id="7899469">.</span><span class="ident" id="7899470">Fatalf</span><span class="op" id="7899476">(</span><span class="string" id="7899477">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="7899518">,</span>&nbsp;<span class="ident" id="7899520">outer2</span><span class="op" id="7899526">.</span><span class="ident" id="7899527">Bug0Field</span><span class="op" id="7899536">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899542">if</span>&nbsp;<span class="ident" id="7899545">inner</span><span class="op" id="7899550">.</span><span class="ident" id="7899551">A</span>&nbsp;<span class="op" id="7899553">!=</span>&nbsp;<span class="num" id="7899556">7</span>&nbsp;<span class="op" id="7899558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899562">t</span><span class="op" id="7899563">.</span><span class="ident" id="7899564">Fatalf</span><span class="op" id="7899570">(</span><span class="string" id="7899571">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7899600">,</span>&nbsp;<span class="ident" id="7899602">inner</span><span class="op" id="7899607">.</span><span class="ident" id="7899608">A</span><span class="op" id="7899609">,</span>&nbsp;<span class="num" id="7899611">7</span><span class="op" id="7899612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899615">}</span><br>
<span class="lineno"></span><span class="op" id="7899617">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="7899620">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7899693">type</span>&nbsp;<span class="ident" id="7899698">Bug1Elem</span>&nbsp;<span class="keyword" id="7899707">struct</span>&nbsp;<span class="op" id="7899714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899717">Name</span>&nbsp;<span class="builtintype" id="7899722">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899730">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7899735">int</span><br>
<span class="lineno"></span><span class="op" id="7899739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7899742">type</span>&nbsp;<span class="ident" id="7899747">Bug1StructMap</span>&nbsp;<span class="keyword" id="7899761">map</span><span class="op" id="7899764">[</span><span class="builtintype" id="7899765">string</span><span class="op" id="7899771">]</span><span class="ident" id="7899772">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="7899782">func</span>&nbsp;<span class="ident" id="7899787">bug1EncDec</span><span class="op" id="7899797">(</span><span class="ident" id="7899798">in</span>&nbsp;<span class="ident" id="7899801">Bug1StructMap</span><span class="op" id="7899814">,</span>&nbsp;<span class="ident" id="7899816">out</span>&nbsp;<span class="op" id="7899820">*</span><span class="ident" id="7899821">Bug1StructMap</span><span class="op" id="7899834">)</span>&nbsp;<span class="builtintype" id="7899836">error</span>&nbsp;<span class="op" id="7899842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899845">return</span>&nbsp;<span class="ident" id="7899852">nil</span><br>
<span class="lineno"></span><span class="op" id="7899856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7899859">func</span>&nbsp;<span class="ident" id="7899864">TestMapBug1</span><span class="op" id="7899875">(</span><span class="ident" id="7899876">t</span>&nbsp;<span class="op" id="7899878">*</span><span class="ident" id="7899879">testing</span><span class="op" id="7899886">.</span><span class="ident" id="7899887">T</span><span class="op" id="7899888">)</span>&nbsp;<span class="op" id="7899890">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899893">in</span>&nbsp;<span class="op" id="7899896">:=</span>&nbsp;<span class="builtinfunc" id="7899899">make</span><span class="op" id="7899903">(</span><span class="ident" id="7899904">Bug1StructMap</span><span class="op" id="7899917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899920">in</span><span class="op" id="7899922">[</span><span class="string" id="7899923">&#34;val1&#34;</span><span class="op" id="7899929">]</span>&nbsp;<span class="op" id="7899931">=</span>&nbsp;<span class="ident" id="7899933">Bug1Elem</span><span class="op" id="7899941">{</span><span class="string" id="7899942">&#34;elem1&#34;</span><span class="op" id="7899949">,</span>&nbsp;<span class="num" id="7899951">1</span><span class="op" id="7899952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899955">in</span><span class="op" id="7899957">[</span><span class="string" id="7899958">&#34;val2&#34;</span><span class="op" id="7899964">]</span>&nbsp;<span class="op" id="7899966">=</span>&nbsp;<span class="ident" id="7899968">Bug1Elem</span><span class="op" id="7899976">{</span><span class="string" id="7899977">&#34;elem2&#34;</span><span class="op" id="7899984">,</span>&nbsp;<span class="num" id="7899986">2</span><span class="op" id="7899987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899991">b</span>&nbsp;<span class="op" id="7899993">:=</span>&nbsp;<span class="builtinfunc" id="7899996">new</span><span class="op" id="7899999">(</span><span class="ident" id="7900000">bytes</span><span class="op" id="7900005">.</span><span class="ident" id="7900006">Buffer</span><span class="op" id="7900012">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900015">enc</span>&nbsp;<span class="op" id="7900019">:=</span>&nbsp;<span class="ident" id="7900022">NewEncoder</span><span class="op" id="7900032">(</span><span class="ident" id="7900033">b</span><span class="op" id="7900034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900037">err</span>&nbsp;<span class="op" id="7900041">:=</span>&nbsp;<span class="ident" id="7900044">enc</span><span class="op" id="7900047">.</span><span class="ident" id="7900048">Encode</span><span class="op" id="7900054">(</span><span class="ident" id="7900055">in</span><span class="op" id="7900057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900060">if</span>&nbsp;<span class="ident" id="7900063">err</span>&nbsp;<span class="op" id="7900067">!=</span>&nbsp;<span class="ident" id="7900070">nil</span>&nbsp;<span class="op" id="7900074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900078">t</span><span class="op" id="7900079">.</span><span class="ident" id="7900080">Fatal</span><span class="op" id="7900085">(</span><span class="string" id="7900086">&#34;encode:&#34;</span><span class="op" id="7900095">,</span>&nbsp;<span class="ident" id="7900097">err</span><span class="op" id="7900100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900103">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900106">dec</span>&nbsp;<span class="op" id="7900110">:=</span>&nbsp;<span class="ident" id="7900113">NewDecoder</span><span class="op" id="7900123">(</span><span class="ident" id="7900124">b</span><span class="op" id="7900125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900128">out</span>&nbsp;<span class="op" id="7900132">:=</span>&nbsp;<span class="builtinfunc" id="7900135">make</span><span class="op" id="7900139">(</span><span class="ident" id="7900140">Bug1StructMap</span><span class="op" id="7900153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900156">err</span>&nbsp;<span class="op" id="7900160">=</span>&nbsp;<span class="ident" id="7900162">dec</span><span class="op" id="7900165">.</span><span class="ident" id="7900166">Decode</span><span class="op" id="7900172">(</span><span class="op" id="7900173">&amp;</span><span class="ident" id="7900174">out</span><span class="op" id="7900177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900180">if</span>&nbsp;<span class="ident" id="7900183">err</span>&nbsp;<span class="op" id="7900187">!=</span>&nbsp;<span class="ident" id="7900190">nil</span>&nbsp;<span class="op" id="7900194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900198">t</span><span class="op" id="7900199">.</span><span class="ident" id="7900200">Fatal</span><span class="op" id="7900205">(</span><span class="string" id="7900206">&#34;decode:&#34;</span><span class="op" id="7900215">,</span>&nbsp;<span class="ident" id="7900217">err</span><span class="op" id="7900220">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900226">if</span>&nbsp;<span class="op" id="7900229">!</span><span class="ident" id="7900230">reflect</span><span class="op" id="7900237">.</span><span class="ident" id="7900238">DeepEqual</span><span class="op" id="7900247">(</span><span class="ident" id="7900248">in</span><span class="op" id="7900250">,</span>&nbsp;<span class="ident" id="7900252">out</span><span class="op" id="7900255">)</span>&nbsp;<span class="op" id="7900257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900261">t</span><span class="op" id="7900262">.</span><span class="ident" id="7900263">Errorf</span><span class="op" id="7900269">(</span><span class="string" id="7900270">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="7900287">,</span>&nbsp;<span class="ident" id="7900289">in</span><span class="op" id="7900291">,</span>&nbsp;<span class="ident" id="7900293">out</span><span class="op" id="7900296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900299">}</span><br>
<span class="lineno"></span><span class="op" id="7900301">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="7900304">func</span>&nbsp;<span class="ident" id="7900309">TestGobMapInterfaceEncode</span><span class="op" id="7900334">(</span><span class="ident" id="7900335">t</span>&nbsp;<span class="op" id="7900337">*</span><span class="ident" id="7900338">testing</span><span class="op" id="7900345">.</span><span class="ident" id="7900346">T</span><span class="op" id="7900347">)</span>&nbsp;<span class="op" id="7900349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900352">m</span>&nbsp;<span class="op" id="7900354">:=</span>&nbsp;<span class="keyword" id="7900357">map</span><span class="op" id="7900360">[</span><span class="builtintype" id="7900361">string</span><span class="op" id="7900367">]</span><span class="keyword" id="7900368">interface</span><span class="op" id="7900377">{</span><span class="op" id="7900378">}</span><span class="op" id="7900379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900383">&#34;up&#34;</span><span class="op" id="7900387">:</span>&nbsp;<span class="builtintype" id="7900389">uintptr</span><span class="op" id="7900396">(</span><span class="num" id="7900397">0</span><span class="op" id="7900398">)</span><span class="op" id="7900399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900403">&#34;i0&#34;</span><span class="op" id="7900407">:</span>&nbsp;<span class="op" id="7900409">[</span><span class="op" id="7900410">]</span><span class="builtintype" id="7900411">int</span><span class="op" id="7900414">{</span><span class="op" id="7900415">-</span><span class="num" id="7900416">1</span><span class="op" id="7900417">}</span><span class="op" id="7900418">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900422">&#34;i1&#34;</span><span class="op" id="7900426">:</span>&nbsp;<span class="op" id="7900428">[</span><span class="op" id="7900429">]</span><span class="builtintype" id="7900430">int8</span><span class="op" id="7900434">{</span><span class="op" id="7900435">-</span><span class="num" id="7900436">1</span><span class="op" id="7900437">}</span><span class="op" id="7900438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900442">&#34;i2&#34;</span><span class="op" id="7900446">:</span>&nbsp;<span class="op" id="7900448">[</span><span class="op" id="7900449">]</span><span class="builtintype" id="7900450">int16</span><span class="op" id="7900455">{</span><span class="op" id="7900456">-</span><span class="num" id="7900457">1</span><span class="op" id="7900458">}</span><span class="op" id="7900459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900463">&#34;i3&#34;</span><span class="op" id="7900467">:</span>&nbsp;<span class="op" id="7900469">[</span><span class="op" id="7900470">]</span><span class="builtintype" id="7900471">int32</span><span class="op" id="7900476">{</span><span class="op" id="7900477">-</span><span class="num" id="7900478">1</span><span class="op" id="7900479">}</span><span class="op" id="7900480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900484">&#34;i4&#34;</span><span class="op" id="7900488">:</span>&nbsp;<span class="op" id="7900490">[</span><span class="op" id="7900491">]</span><span class="ident" id="7900492">int64</span><span class="op" id="7900497">{</span><span class="op" id="7900498">-</span><span class="num" id="7900499">1</span><span class="op" id="7900500">}</span><span class="op" id="7900501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900505">&#34;u0&#34;</span><span class="op" id="7900509">:</span>&nbsp;<span class="op" id="7900511">[</span><span class="op" id="7900512">]</span><span class="builtintype" id="7900513">uint</span><span class="op" id="7900517">{</span><span class="num" id="7900518">1</span><span class="op" id="7900519">}</span><span class="op" id="7900520">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900524">&#34;u1&#34;</span><span class="op" id="7900528">:</span>&nbsp;<span class="op" id="7900530">[</span><span class="op" id="7900531">]</span><span class="builtintype" id="7900532">uint8</span><span class="op" id="7900537">{</span><span class="num" id="7900538">1</span><span class="op" id="7900539">}</span><span class="op" id="7900540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900544">&#34;u2&#34;</span><span class="op" id="7900548">:</span>&nbsp;<span class="op" id="7900550">[</span><span class="op" id="7900551">]</span><span class="builtintype" id="7900552">uint16</span><span class="op" id="7900558">{</span><span class="num" id="7900559">1</span><span class="op" id="7900560">}</span><span class="op" id="7900561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900565">&#34;u3&#34;</span><span class="op" id="7900569">:</span>&nbsp;<span class="op" id="7900571">[</span><span class="op" id="7900572">]</span><span class="builtintype" id="7900573">uint32</span><span class="op" id="7900579">{</span><span class="num" id="7900580">1</span><span class="op" id="7900581">}</span><span class="op" id="7900582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900586">&#34;u4&#34;</span><span class="op" id="7900590">:</span>&nbsp;<span class="op" id="7900592">[</span><span class="op" id="7900593">]</span><span class="ident" id="7900594">uint64</span><span class="op" id="7900600">{</span><span class="num" id="7900601">1</span><span class="op" id="7900602">}</span><span class="op" id="7900603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900607">&#34;f0&#34;</span><span class="op" id="7900611">:</span>&nbsp;<span class="op" id="7900613">[</span><span class="op" id="7900614">]</span><span class="builtintype" id="7900615">float32</span><span class="op" id="7900622">{</span><span class="num" id="7900623">1</span><span class="op" id="7900624">}</span><span class="op" id="7900625">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900629">&#34;f1&#34;</span><span class="op" id="7900633">:</span>&nbsp;<span class="op" id="7900635">[</span><span class="op" id="7900636">]</span><span class="builtintype" id="7900637">float64</span><span class="op" id="7900644">{</span><span class="num" id="7900645">1</span><span class="op" id="7900646">}</span><span class="op" id="7900647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900651">&#34;c0&#34;</span><span class="op" id="7900655">:</span>&nbsp;<span class="op" id="7900657">[</span><span class="op" id="7900658">]</span><span class="builtintype" id="7900659">complex64</span><span class="op" id="7900668">{</span><span class="builtinfunc" id="7900669">complex</span><span class="op" id="7900676">(</span><span class="num" id="7900677">2</span><span class="op" id="7900678">,</span>&nbsp;<span class="op" id="7900680">-</span><span class="num" id="7900681">2</span><span class="op" id="7900682">)</span><span class="op" id="7900683">}</span><span class="op" id="7900684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900688">&#34;c1&#34;</span><span class="op" id="7900692">:</span>&nbsp;<span class="op" id="7900694">[</span><span class="op" id="7900695">]</span><span class="builtintype" id="7900696">complex128</span><span class="op" id="7900706">{</span><span class="builtinfunc" id="7900707">complex</span><span class="op" id="7900714">(</span><span class="num" id="7900715">2</span><span class="op" id="7900716">,</span>&nbsp;<span class="builtintype" id="7900718">float64</span><span class="op" id="7900725">(</span><span class="op" id="7900726">-</span><span class="num" id="7900727">2</span><span class="op" id="7900728">)</span><span class="op" id="7900729">)</span><span class="op" id="7900730">}</span><span class="op" id="7900731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900735">&#34;us&#34;</span><span class="op" id="7900739">:</span>&nbsp;<span class="op" id="7900741">[</span><span class="op" id="7900742">]</span><span class="builtintype" id="7900743">uintptr</span><span class="op" id="7900750">{</span><span class="num" id="7900751">0</span><span class="op" id="7900752">}</span><span class="op" id="7900753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900757">&#34;bo&#34;</span><span class="op" id="7900761">:</span>&nbsp;<span class="op" id="7900763">[</span><span class="op" id="7900764">]</span><span class="builtintype" id="7900765">bool</span><span class="op" id="7900769">{</span><span class="builtintype" id="7900770">false</span><span class="op" id="7900775">}</span><span class="op" id="7900776">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7900780">&#34;st&#34;</span><span class="op" id="7900784">:</span>&nbsp;<span class="op" id="7900786">[</span><span class="op" id="7900787">]</span><span class="builtintype" id="7900788">string</span><span class="op" id="7900794">{</span><span class="string" id="7900795">&#34;s&#34;</span><span class="op" id="7900798">}</span><span class="op" id="7900799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900805">enc</span>&nbsp;<span class="op" id="7900809">:=</span>&nbsp;<span class="ident" id="7900812">NewEncoder</span><span class="op" id="7900822">(</span><span class="builtinfunc" id="7900823">new</span><span class="op" id="7900826">(</span><span class="ident" id="7900827">bytes</span><span class="op" id="7900832">.</span><span class="ident" id="7900833">Buffer</span><span class="op" id="7900839">)</span><span class="op" id="7900840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900843">err</span>&nbsp;<span class="op" id="7900847">:=</span>&nbsp;<span class="ident" id="7900850">enc</span><span class="op" id="7900853">.</span><span class="ident" id="7900854">Encode</span><span class="op" id="7900860">(</span><span class="ident" id="7900861">m</span><span class="op" id="7900862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900865">if</span>&nbsp;<span class="ident" id="7900868">err</span>&nbsp;<span class="op" id="7900872">!=</span>&nbsp;<span class="ident" id="7900875">nil</span>&nbsp;<span class="op" id="7900879">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900883">t</span><span class="op" id="7900884">.</span><span class="ident" id="7900885">Errorf</span><span class="op" id="7900891">(</span><span class="string" id="7900892">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="7900908">,</span>&nbsp;<span class="ident" id="7900910">err</span><span class="op" id="7900913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900916">}</span><br>
<span class="lineno"></span><span class="op" id="7900918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7900921">func</span>&nbsp;<span class="ident" id="7900926">TestSliceReusesMemory</span><span class="op" id="7900947">(</span><span class="ident" id="7900948">t</span>&nbsp;<span class="op" id="7900950">*</span><span class="ident" id="7900951">testing</span><span class="op" id="7900958">.</span><span class="ident" id="7900959">T</span><span class="op" id="7900960">)</span>&nbsp;<span class="op" id="7900962">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900965">buf</span>&nbsp;<span class="op" id="7900969">:=</span>&nbsp;<span class="builtinfunc" id="7900972">new</span><span class="op" id="7900975">(</span><span class="ident" id="7900976">bytes</span><span class="op" id="7900981">.</span><span class="ident" id="7900982">Buffer</span><span class="op" id="7900988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7900991">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901005">x</span>&nbsp;<span class="op" id="7901007">:=</span>&nbsp;<span class="op" id="7901010">[</span><span class="op" id="7901011">]</span><span class="builtintype" id="7901012">byte</span><span class="op" id="7901016">(</span><span class="string" id="7901017">&#34;abcd&#34;</span><span class="op" id="7901023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901027">enc</span>&nbsp;<span class="op" id="7901031">:=</span>&nbsp;<span class="ident" id="7901034">NewEncoder</span><span class="op" id="7901044">(</span><span class="ident" id="7901045">buf</span><span class="op" id="7901048">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901052">err</span>&nbsp;<span class="op" id="7901056">:=</span>&nbsp;<span class="ident" id="7901059">enc</span><span class="op" id="7901062">.</span><span class="ident" id="7901063">Encode</span><span class="op" id="7901069">(</span><span class="ident" id="7901070">x</span><span class="op" id="7901071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901075">if</span>&nbsp;<span class="ident" id="7901078">err</span>&nbsp;<span class="op" id="7901082">!=</span>&nbsp;<span class="ident" id="7901085">nil</span>&nbsp;<span class="op" id="7901089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901094">t</span><span class="op" id="7901095">.</span><span class="ident" id="7901096">Errorf</span><span class="op" id="7901102">(</span><span class="string" id="7901103">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="7901122">,</span>&nbsp;<span class="ident" id="7901124">err</span><span class="op" id="7901127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901135">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901176">y</span>&nbsp;<span class="op" id="7901178">:=</span>&nbsp;<span class="op" id="7901181">[</span><span class="op" id="7901182">]</span><span class="builtintype" id="7901183">byte</span><span class="op" id="7901187">(</span><span class="string" id="7901188">&#34;ABCDE&#34;</span><span class="op" id="7901195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901199">addr</span>&nbsp;<span class="op" id="7901204">:=</span>&nbsp;<span class="op" id="7901207">&amp;</span><span class="ident" id="7901208">y</span><span class="op" id="7901209">[</span><span class="num" id="7901210">0</span><span class="op" id="7901211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901215">dec</span>&nbsp;<span class="op" id="7901219">:=</span>&nbsp;<span class="ident" id="7901222">NewDecoder</span><span class="op" id="7901232">(</span><span class="ident" id="7901233">buf</span><span class="op" id="7901236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901240">err</span>&nbsp;<span class="op" id="7901244">=</span>&nbsp;<span class="ident" id="7901246">dec</span><span class="op" id="7901249">.</span><span class="ident" id="7901250">Decode</span><span class="op" id="7901256">(</span><span class="op" id="7901257">&amp;</span><span class="ident" id="7901258">y</span><span class="op" id="7901259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901263">if</span>&nbsp;<span class="ident" id="7901266">err</span>&nbsp;<span class="op" id="7901270">!=</span>&nbsp;<span class="ident" id="7901273">nil</span>&nbsp;<span class="op" id="7901277">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901282">t</span><span class="op" id="7901283">.</span><span class="ident" id="7901284">Fatal</span><span class="op" id="7901289">(</span><span class="string" id="7901290">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="7901306">,</span>&nbsp;<span class="ident" id="7901308">err</span><span class="op" id="7901311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901319">if</span>&nbsp;<span class="op" id="7901322">!</span><span class="ident" id="7901323">bytes</span><span class="op" id="7901328">.</span><span class="ident" id="7901329">Equal</span><span class="op" id="7901334">(</span><span class="ident" id="7901335">x</span><span class="op" id="7901336">,</span>&nbsp;<span class="ident" id="7901338">y</span><span class="op" id="7901339">)</span>&nbsp;<span class="op" id="7901341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901346">t</span><span class="op" id="7901347">.</span><span class="ident" id="7901348">Errorf</span><span class="op" id="7901354">(</span><span class="string" id="7901355">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="7901384">,</span>&nbsp;<span class="ident" id="7901386">x</span><span class="op" id="7901387">,</span>&nbsp;<span class="ident" id="7901389">y</span><span class="op" id="7901390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901394">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901398">if</span>&nbsp;<span class="ident" id="7901401">addr</span>&nbsp;<span class="op" id="7901406">!=</span>&nbsp;<span class="op" id="7901409">&amp;</span><span class="ident" id="7901410">y</span><span class="op" id="7901411">[</span><span class="num" id="7901412">0</span><span class="op" id="7901413">]</span>&nbsp;<span class="op" id="7901415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901420">t</span><span class="op" id="7901421">.</span><span class="ident" id="7901422">Errorf</span><span class="op" id="7901428">(</span><span class="string" id="7901429">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="7901462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901472">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901494">x</span>&nbsp;<span class="op" id="7901496">:=</span>&nbsp;<span class="op" id="7901499">[</span><span class="op" id="7901500">]</span><span class="builtintype" id="7901501">rune</span><span class="op" id="7901505">(</span><span class="string" id="7901506">&#34;abcd&#34;</span><span class="op" id="7901512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901516">enc</span>&nbsp;<span class="op" id="7901520">:=</span>&nbsp;<span class="ident" id="7901523">NewEncoder</span><span class="op" id="7901533">(</span><span class="ident" id="7901534">buf</span><span class="op" id="7901537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901541">err</span>&nbsp;<span class="op" id="7901545">:=</span>&nbsp;<span class="ident" id="7901548">enc</span><span class="op" id="7901551">.</span><span class="ident" id="7901552">Encode</span><span class="op" id="7901558">(</span><span class="ident" id="7901559">x</span><span class="op" id="7901560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901564">if</span>&nbsp;<span class="ident" id="7901567">err</span>&nbsp;<span class="op" id="7901571">!=</span>&nbsp;<span class="ident" id="7901574">nil</span>&nbsp;<span class="op" id="7901578">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901583">t</span><span class="op" id="7901584">.</span><span class="ident" id="7901585">Errorf</span><span class="op" id="7901591">(</span><span class="string" id="7901592">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="7901610">,</span>&nbsp;<span class="ident" id="7901612">err</span><span class="op" id="7901615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901623">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901664">y</span>&nbsp;<span class="op" id="7901666">:=</span>&nbsp;<span class="op" id="7901669">[</span><span class="op" id="7901670">]</span><span class="builtintype" id="7901671">rune</span><span class="op" id="7901675">(</span><span class="string" id="7901676">&#34;ABCDE&#34;</span><span class="op" id="7901683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901687">addr</span>&nbsp;<span class="op" id="7901692">:=</span>&nbsp;<span class="op" id="7901695">&amp;</span><span class="ident" id="7901696">y</span><span class="op" id="7901697">[</span><span class="num" id="7901698">0</span><span class="op" id="7901699">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901703">dec</span>&nbsp;<span class="op" id="7901707">:=</span>&nbsp;<span class="ident" id="7901710">NewDecoder</span><span class="op" id="7901720">(</span><span class="ident" id="7901721">buf</span><span class="op" id="7901724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901728">err</span>&nbsp;<span class="op" id="7901732">=</span>&nbsp;<span class="ident" id="7901734">dec</span><span class="op" id="7901737">.</span><span class="ident" id="7901738">Decode</span><span class="op" id="7901744">(</span><span class="op" id="7901745">&amp;</span><span class="ident" id="7901746">y</span><span class="op" id="7901747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901751">if</span>&nbsp;<span class="ident" id="7901754">err</span>&nbsp;<span class="op" id="7901758">!=</span>&nbsp;<span class="ident" id="7901761">nil</span>&nbsp;<span class="op" id="7901765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901770">t</span><span class="op" id="7901771">.</span><span class="ident" id="7901772">Fatal</span><span class="op" id="7901777">(</span><span class="string" id="7901778">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="7901793">,</span>&nbsp;<span class="ident" id="7901795">err</span><span class="op" id="7901798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901802">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901806">if</span>&nbsp;<span class="op" id="7901809">!</span><span class="ident" id="7901810">reflect</span><span class="op" id="7901817">.</span><span class="ident" id="7901818">DeepEqual</span><span class="op" id="7901827">(</span><span class="ident" id="7901828">x</span><span class="op" id="7901829">,</span>&nbsp;<span class="ident" id="7901831">y</span><span class="op" id="7901832">)</span>&nbsp;<span class="op" id="7901834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901839">t</span><span class="op" id="7901840">.</span><span class="ident" id="7901841">Errorf</span><span class="op" id="7901847">(</span><span class="string" id="7901848">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="7901876">,</span>&nbsp;<span class="ident" id="7901878">x</span><span class="op" id="7901879">,</span>&nbsp;<span class="ident" id="7901881">y</span><span class="op" id="7901882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901890">if</span>&nbsp;<span class="ident" id="7901893">addr</span>&nbsp;<span class="op" id="7901898">!=</span>&nbsp;<span class="op" id="7901901">&amp;</span><span class="ident" id="7901902">y</span><span class="op" id="7901903">[</span><span class="num" id="7901904">0</span><span class="op" id="7901905">]</span>&nbsp;<span class="op" id="7901907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901912">t</span><span class="op" id="7901913">.</span><span class="ident" id="7901914">Errorf</span><span class="op" id="7901920">(</span><span class="string" id="7901921">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="7901953">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901960">}</span><br>
<span class="lineno"></span><span class="op" id="7901962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7901965">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="7902014">func</span>&nbsp;<span class="ident" id="7902019">TestBadCount</span><span class="op" id="7902031">(</span><span class="ident" id="7902032">t</span>&nbsp;<span class="op" id="7902034">*</span><span class="ident" id="7902035">testing</span><span class="op" id="7902042">.</span><span class="ident" id="7902043">T</span><span class="op" id="7902044">)</span>&nbsp;<span class="op" id="7902046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902049">b</span>&nbsp;<span class="op" id="7902051">:=</span>&nbsp;<span class="op" id="7902054">[</span><span class="op" id="7902055">]</span><span class="builtintype" id="7902056">byte</span><span class="op" id="7902060">{</span><span class="num" id="7902061">0xfb</span><span class="op" id="7902065">,</span>&nbsp;<span class="num" id="7902067">0xa5</span><span class="op" id="7902071">,</span>&nbsp;<span class="num" id="7902073">0x82</span><span class="op" id="7902077">,</span>&nbsp;<span class="num" id="7902079">0x2f</span><span class="op" id="7902083">,</span>&nbsp;<span class="num" id="7902085">0xca</span><span class="op" id="7902089">,</span>&nbsp;<span class="num" id="7902091">0x1</span><span class="op" id="7902094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902097">if</span>&nbsp;<span class="ident" id="7902100">err</span>&nbsp;<span class="op" id="7902104">:=</span>&nbsp;<span class="ident" id="7902107">NewDecoder</span><span class="op" id="7902117">(</span><span class="ident" id="7902118">bytes</span><span class="op" id="7902123">.</span><span class="ident" id="7902124">NewReader</span><span class="op" id="7902133">(</span><span class="ident" id="7902134">b</span><span class="op" id="7902135">)</span><span class="op" id="7902136">)</span><span class="op" id="7902137">.</span><span class="ident" id="7902138">Decode</span><span class="op" id="7902144">(</span><span class="ident" id="7902145">nil</span><span class="op" id="7902148">)</span><span class="op" id="7902149">;</span>&nbsp;<span class="ident" id="7902151">err</span>&nbsp;<span class="op" id="7902155">==</span>&nbsp;<span class="ident" id="7902158">nil</span>&nbsp;<span class="op" id="7902162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902166">t</span><span class="op" id="7902167">.</span><span class="ident" id="7902168">Error</span><span class="op" id="7902173">(</span><span class="string" id="7902174">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="7902205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902208">}</span>&nbsp;<span class="keyword" id="7902210">else</span>&nbsp;<span class="keyword" id="7902215">if</span>&nbsp;<span class="ident" id="7902218">err</span><span class="op" id="7902221">.</span><span class="ident" id="7902222">Error</span><span class="op" id="7902227">(</span><span class="op" id="7902228">)</span>&nbsp;<span class="op" id="7902230">!=</span>&nbsp;<span class="ident" id="7902233">errBadCount</span><span class="op" id="7902244">.</span><span class="ident" id="7902245">Error</span><span class="op" id="7902250">(</span><span class="op" id="7902251">)</span>&nbsp;<span class="op" id="7902253">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902257">t</span><span class="op" id="7902258">.</span><span class="ident" id="7902259">Error</span><span class="op" id="7902264">(</span><span class="string" id="7902265">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7902296">,</span>&nbsp;<span class="ident" id="7902298">err</span><span class="op" id="7902301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902304">}</span><br>
<span class="lineno"></span><span class="op" id="7902306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7902309">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="7902373">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="7902433">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7902468">func</span>&nbsp;<span class="ident" id="7902473">TestSequentialDecoder</span><span class="op" id="7902494">(</span><span class="ident" id="7902495">t</span>&nbsp;<span class="op" id="7902497">*</span><span class="ident" id="7902498">testing</span><span class="op" id="7902505">.</span><span class="ident" id="7902506">T</span><span class="op" id="7902507">)</span>&nbsp;<span class="op" id="7902509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902512">b</span>&nbsp;<span class="op" id="7902514">:=</span>&nbsp;<span class="builtinfunc" id="7902517">new</span><span class="op" id="7902520">(</span><span class="ident" id="7902521">bytes</span><span class="op" id="7902526">.</span><span class="ident" id="7902527">Buffer</span><span class="op" id="7902533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902536">enc</span>&nbsp;<span class="op" id="7902540">:=</span>&nbsp;<span class="ident" id="7902543">NewEncoder</span><span class="op" id="7902553">(</span><span class="ident" id="7902554">b</span><span class="op" id="7902555">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902558">const</span>&nbsp;<span class="ident" id="7902564">count</span>&nbsp;<span class="op" id="7902570">=</span>&nbsp;<span class="num" id="7902572">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902576">for</span>&nbsp;<span class="ident" id="7902580">i</span>&nbsp;<span class="op" id="7902582">:=</span>&nbsp;<span class="num" id="7902585">0</span><span class="op" id="7902586">;</span>&nbsp;<span class="ident" id="7902588">i</span>&nbsp;<span class="op" id="7902590">&lt;</span>&nbsp;<span class="ident" id="7902592">count</span><span class="op" id="7902597">;</span>&nbsp;<span class="ident" id="7902599">i</span><span class="op" id="7902600">++</span>&nbsp;<span class="op" id="7902603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902607">s</span>&nbsp;<span class="op" id="7902609">:=</span>&nbsp;<span class="ident" id="7902612">fmt</span><span class="op" id="7902615">.</span><span class="ident" id="7902616">Sprintf</span><span class="op" id="7902623">(</span><span class="string" id="7902624">&#34;%d&#34;</span><span class="op" id="7902628">,</span>&nbsp;<span class="ident" id="7902630">i</span><span class="op" id="7902631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902635">if</span>&nbsp;<span class="ident" id="7902638">err</span>&nbsp;<span class="op" id="7902642">:=</span>&nbsp;<span class="ident" id="7902645">enc</span><span class="op" id="7902648">.</span><span class="ident" id="7902649">Encode</span><span class="op" id="7902655">(</span><span class="ident" id="7902656">s</span><span class="op" id="7902657">)</span><span class="op" id="7902658">;</span>&nbsp;<span class="ident" id="7902660">err</span>&nbsp;<span class="op" id="7902664">!=</span>&nbsp;<span class="ident" id="7902667">nil</span>&nbsp;<span class="op" id="7902671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902676">t</span><span class="op" id="7902677">.</span><span class="ident" id="7902678">Error</span><span class="op" id="7902683">(</span><span class="string" id="7902684">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7902699">,</span>&nbsp;<span class="ident" id="7902701">err</span><span class="op" id="7902704">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902714">for</span>&nbsp;<span class="ident" id="7902718">i</span>&nbsp;<span class="op" id="7902720">:=</span>&nbsp;<span class="num" id="7902723">0</span><span class="op" id="7902724">;</span>&nbsp;<span class="ident" id="7902726">i</span>&nbsp;<span class="op" id="7902728">&lt;</span>&nbsp;<span class="ident" id="7902730">count</span><span class="op" id="7902735">;</span>&nbsp;<span class="ident" id="7902737">i</span><span class="op" id="7902738">++</span>&nbsp;<span class="op" id="7902741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902745">dec</span>&nbsp;<span class="op" id="7902749">:=</span>&nbsp;<span class="ident" id="7902752">NewDecoder</span><span class="op" id="7902762">(</span><span class="ident" id="7902763">b</span><span class="op" id="7902764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902768">var</span>&nbsp;<span class="ident" id="7902772">s</span>&nbsp;<span class="builtintype" id="7902774">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902783">if</span>&nbsp;<span class="ident" id="7902786">err</span>&nbsp;<span class="op" id="7902790">:=</span>&nbsp;<span class="ident" id="7902793">dec</span><span class="op" id="7902796">.</span><span class="ident" id="7902797">Decode</span><span class="op" id="7902803">(</span><span class="op" id="7902804">&amp;</span><span class="ident" id="7902805">s</span><span class="op" id="7902806">)</span><span class="op" id="7902807">;</span>&nbsp;<span class="ident" id="7902809">err</span>&nbsp;<span class="op" id="7902813">!=</span>&nbsp;<span class="ident" id="7902816">nil</span>&nbsp;<span class="op" id="7902820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902825">t</span><span class="op" id="7902826">.</span><span class="ident" id="7902827">Fatal</span><span class="op" id="7902832">(</span><span class="string" id="7902833">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="7902848">,</span>&nbsp;<span class="ident" id="7902850">err</span><span class="op" id="7902853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902861">if</span>&nbsp;<span class="ident" id="7902864">s</span>&nbsp;<span class="op" id="7902866">!=</span>&nbsp;<span class="ident" id="7902869">fmt</span><span class="op" id="7902872">.</span><span class="ident" id="7902873">Sprintf</span><span class="op" id="7902880">(</span><span class="string" id="7902881">&#34;%d&#34;</span><span class="op" id="7902885">,</span>&nbsp;<span class="ident" id="7902887">i</span><span class="op" id="7902888">)</span>&nbsp;<span class="op" id="7902890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902895">t</span><span class="op" id="7902896">.</span><span class="ident" id="7902897">Fatalf</span><span class="op" id="7902903">(</span><span class="string" id="7902904">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7902931">,</span>&nbsp;<span class="ident" id="7902933">i</span><span class="op" id="7902934">,</span>&nbsp;<span class="ident" id="7902936">s</span><span class="op" id="7902937">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902944">}</span><br>
<span class="lineno"></span><span class="op" id="7902946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7902949">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="7903045">type</span>&nbsp;<span class="ident" id="7903050">Bug2</span>&nbsp;<span class="keyword" id="7903055">struct</span>&nbsp;<span class="op" id="7903062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903065">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7903069">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903074">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7903078">chan</span>&nbsp;<span class="builtintype" id="7903083">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903088">CP</span>&nbsp;&nbsp;<span class="op" id="7903092">*</span><span class="keyword" id="7903093">chan</span>&nbsp;<span class="builtintype" id="7903098">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903103">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7903107">func</span><span class="op" id="7903111">(</span><span class="op" id="7903112">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903115">FPP</span>&nbsp;<span class="op" id="7903119">*</span><span class="op" id="7903120">*</span><span class="keyword" id="7903121">func</span><span class="op" id="7903125">(</span><span class="op" id="7903126">)</span><br>
<span class="lineno"></span><span class="op" id="7903128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7903131">func</span>&nbsp;<span class="ident" id="7903136">TestChanFuncIgnored</span><span class="op" id="7903155">(</span><span class="ident" id="7903156">t</span>&nbsp;<span class="op" id="7903158">*</span><span class="ident" id="7903159">testing</span><span class="op" id="7903166">.</span><span class="ident" id="7903167">T</span><span class="op" id="7903168">)</span>&nbsp;<span class="op" id="7903170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903173">c</span>&nbsp;<span class="op" id="7903175">:=</span>&nbsp;<span class="builtinfunc" id="7903178">make</span><span class="op" id="7903182">(</span><span class="keyword" id="7903183">chan</span>&nbsp;<span class="builtintype" id="7903188">int</span><span class="op" id="7903191">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903194">f</span>&nbsp;<span class="op" id="7903196">:=</span>&nbsp;<span class="keyword" id="7903199">func</span><span class="op" id="7903203">(</span><span class="op" id="7903204">)</span>&nbsp;<span class="op" id="7903206">{</span><span class="op" id="7903207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903210">fp</span>&nbsp;<span class="op" id="7903213">:=</span>&nbsp;<span class="op" id="7903216">&amp;</span><span class="ident" id="7903217">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903220">b0</span>&nbsp;<span class="op" id="7903223">:=</span>&nbsp;<span class="ident" id="7903226">Bug2</span><span class="op" id="7903230">{</span><span class="num" id="7903231">23</span><span class="op" id="7903233">,</span>&nbsp;<span class="ident" id="7903235">c</span><span class="op" id="7903236">,</span>&nbsp;<span class="op" id="7903238">&amp;</span><span class="ident" id="7903239">c</span><span class="op" id="7903240">,</span>&nbsp;<span class="ident" id="7903242">f</span><span class="op" id="7903243">,</span>&nbsp;<span class="op" id="7903245">&amp;</span><span class="ident" id="7903246">fp</span><span class="op" id="7903248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903251">var</span>&nbsp;<span class="ident" id="7903255">buf</span>&nbsp;<span class="ident" id="7903259">bytes</span><span class="op" id="7903264">.</span><span class="ident" id="7903265">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903273">enc</span>&nbsp;<span class="op" id="7903277">:=</span>&nbsp;<span class="ident" id="7903280">NewEncoder</span><span class="op" id="7903290">(</span><span class="op" id="7903291">&amp;</span><span class="ident" id="7903292">buf</span><span class="op" id="7903295">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903298">if</span>&nbsp;<span class="ident" id="7903301">err</span>&nbsp;<span class="op" id="7903305">:=</span>&nbsp;<span class="ident" id="7903308">enc</span><span class="op" id="7903311">.</span><span class="ident" id="7903312">Encode</span><span class="op" id="7903318">(</span><span class="ident" id="7903319">b0</span><span class="op" id="7903321">)</span><span class="op" id="7903322">;</span>&nbsp;<span class="ident" id="7903324">err</span>&nbsp;<span class="op" id="7903328">!=</span>&nbsp;<span class="ident" id="7903331">nil</span>&nbsp;<span class="op" id="7903335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903339">t</span><span class="op" id="7903340">.</span><span class="ident" id="7903341">Fatal</span><span class="op" id="7903346">(</span><span class="string" id="7903347">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="7903364">,</span>&nbsp;<span class="ident" id="7903366">err</span><span class="op" id="7903369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903375">var</span>&nbsp;<span class="ident" id="7903379">b1</span>&nbsp;<span class="ident" id="7903382">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903388">err</span>&nbsp;<span class="op" id="7903392">:=</span>&nbsp;<span class="ident" id="7903395">NewDecoder</span><span class="op" id="7903405">(</span><span class="op" id="7903406">&amp;</span><span class="ident" id="7903407">buf</span><span class="op" id="7903410">)</span><span class="op" id="7903411">.</span><span class="ident" id="7903412">Decode</span><span class="op" id="7903418">(</span><span class="op" id="7903419">&amp;</span><span class="ident" id="7903420">b1</span><span class="op" id="7903422">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903425">if</span>&nbsp;<span class="ident" id="7903428">err</span>&nbsp;<span class="op" id="7903432">!=</span>&nbsp;<span class="ident" id="7903435">nil</span>&nbsp;<span class="op" id="7903439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903443">t</span><span class="op" id="7903444">.</span><span class="ident" id="7903445">Fatal</span><span class="op" id="7903450">(</span><span class="string" id="7903451">&#34;decode:&#34;</span><span class="op" id="7903460">,</span>&nbsp;<span class="ident" id="7903462">err</span><span class="op" id="7903465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903471">if</span>&nbsp;<span class="ident" id="7903474">b1</span><span class="op" id="7903476">.</span><span class="ident" id="7903477">A</span>&nbsp;<span class="op" id="7903479">!=</span>&nbsp;<span class="ident" id="7903482">b0</span><span class="op" id="7903484">.</span><span class="ident" id="7903485">A</span>&nbsp;<span class="op" id="7903487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903491">t</span><span class="op" id="7903492">.</span><span class="ident" id="7903493">Fatalf</span><span class="op" id="7903499">(</span><span class="string" id="7903500">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7903516">,</span>&nbsp;<span class="ident" id="7903518">b1</span><span class="op" id="7903520">.</span><span class="ident" id="7903521">A</span><span class="op" id="7903522">,</span>&nbsp;<span class="ident" id="7903524">b0</span><span class="op" id="7903526">.</span><span class="ident" id="7903527">A</span><span class="op" id="7903528">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903534">if</span>&nbsp;<span class="ident" id="7903537">b1</span><span class="op" id="7903539">.</span><span class="ident" id="7903540">C</span>&nbsp;<span class="op" id="7903542">!=</span>&nbsp;<span class="ident" id="7903545">nil</span>&nbsp;<span class="op" id="7903549">||</span>&nbsp;<span class="ident" id="7903552">b1</span><span class="op" id="7903554">.</span><span class="ident" id="7903555">CP</span>&nbsp;<span class="op" id="7903558">!=</span>&nbsp;<span class="ident" id="7903561">nil</span>&nbsp;<span class="op" id="7903565">||</span>&nbsp;<span class="ident" id="7903568">b1</span><span class="op" id="7903570">.</span><span class="ident" id="7903571">F</span>&nbsp;<span class="op" id="7903573">!=</span>&nbsp;<span class="ident" id="7903576">nil</span>&nbsp;<span class="op" id="7903580">||</span>&nbsp;<span class="ident" id="7903583">b1</span><span class="op" id="7903585">.</span><span class="ident" id="7903586">FPP</span>&nbsp;<span class="op" id="7903590">!=</span>&nbsp;<span class="ident" id="7903593">nil</span>&nbsp;<span class="op" id="7903597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903601">t</span><span class="op" id="7903602">.</span><span class="ident" id="7903603">Fatal</span><span class="op" id="7903608">(</span><span class="string" id="7903609">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="7903644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903647">}</span><br>
<span class="lineno"></span><span class="op" id="7903649">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="7903652">func</span>&nbsp;<span class="ident" id="7903657">TestSliceIncompatibility</span><span class="op" id="7903681">(</span><span class="ident" id="7903682">t</span>&nbsp;<span class="op" id="7903684">*</span><span class="ident" id="7903685">testing</span><span class="op" id="7903692">.</span><span class="ident" id="7903693">T</span><span class="op" id="7903694">)</span>&nbsp;<span class="op" id="7903696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903699">var</span>&nbsp;<span class="ident" id="7903703">in</span>&nbsp;<span class="op" id="7903706">=</span>&nbsp;<span class="op" id="7903708">[</span><span class="op" id="7903709">]</span><span class="builtintype" id="7903710">byte</span><span class="op" id="7903714">{</span><span class="num" id="7903715">1</span><span class="op" id="7903716">,</span>&nbsp;<span class="num" id="7903718">2</span><span class="op" id="7903719">,</span>&nbsp;<span class="num" id="7903721">3</span><span class="op" id="7903722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903725">var</span>&nbsp;<span class="ident" id="7903729">out</span>&nbsp;<span class="op" id="7903733">[</span><span class="op" id="7903734">]</span><span class="builtintype" id="7903735">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903740">if</span>&nbsp;<span class="ident" id="7903743">err</span>&nbsp;<span class="op" id="7903747">:=</span>&nbsp;<span class="ident" id="7903750">encAndDec</span><span class="op" id="7903759">(</span><span class="ident" id="7903760">in</span><span class="op" id="7903762">,</span>&nbsp;<span class="op" id="7903764">&amp;</span><span class="ident" id="7903765">out</span><span class="op" id="7903768">)</span><span class="op" id="7903769">;</span>&nbsp;<span class="ident" id="7903771">err</span>&nbsp;<span class="op" id="7903775">==</span>&nbsp;<span class="ident" id="7903778">nil</span>&nbsp;<span class="op" id="7903782">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903786">t</span><span class="op" id="7903787">.</span><span class="ident" id="7903788">Error</span><span class="op" id="7903793">(</span><span class="string" id="7903794">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="7903824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903827">}</span><br>
<span class="lineno"></span><span class="op" id="7903829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7903832">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="7903889">type</span>&nbsp;<span class="ident" id="7903894">Bug3</span>&nbsp;<span class="keyword" id="7903899">struct</span>&nbsp;<span class="op" id="7903906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903909">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7903918">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903923">Children</span>&nbsp;<span class="op" id="7903932">[</span><span class="op" id="7903933">]</span><span class="op" id="7903934">*</span><span class="ident" id="7903935">Bug3</span><br>
<span class="lineno"></span><span class="op" id="7903940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="7903943">func</span>&nbsp;<span class="ident" id="7903948">TestGobPtrSlices</span><span class="op" id="7903964">(</span><span class="ident" id="7903965">t</span>&nbsp;<span class="op" id="7903967">*</span><span class="ident" id="7903968">testing</span><span class="op" id="7903975">.</span><span class="ident" id="7903976">T</span><span class="op" id="7903977">)</span>&nbsp;<span class="op" id="7903979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903982">in</span>&nbsp;<span class="op" id="7903985">:=</span>&nbsp;<span class="op" id="7903988">[</span><span class="op" id="7903989">]</span><span class="op" id="7903990">*</span><span class="ident" id="7903991">Bug3</span><span class="op" id="7903995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903999">{</span><span class="num" id="7904000">1</span><span class="op" id="7904001">,</span>&nbsp;<span class="ident" id="7904003">nil</span><span class="op" id="7904006">}</span><span class="op" id="7904007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904011">{</span><span class="num" id="7904012">2</span><span class="op" id="7904013">,</span>&nbsp;<span class="ident" id="7904015">nil</span><span class="op" id="7904018">}</span><span class="op" id="7904019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904022">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904025">b</span>&nbsp;<span class="op" id="7904027">:=</span>&nbsp;<span class="builtinfunc" id="7904030">new</span><span class="op" id="7904033">(</span><span class="ident" id="7904034">bytes</span><span class="op" id="7904039">.</span><span class="ident" id="7904040">Buffer</span><span class="op" id="7904046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904049">err</span>&nbsp;<span class="op" id="7904053">:=</span>&nbsp;<span class="ident" id="7904056">NewEncoder</span><span class="op" id="7904066">(</span><span class="ident" id="7904067">b</span><span class="op" id="7904068">)</span><span class="op" id="7904069">.</span><span class="ident" id="7904070">Encode</span><span class="op" id="7904076">(</span><span class="op" id="7904077">&amp;</span><span class="ident" id="7904078">in</span><span class="op" id="7904080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904083">if</span>&nbsp;<span class="ident" id="7904086">err</span>&nbsp;<span class="op" id="7904090">!=</span>&nbsp;<span class="ident" id="7904093">nil</span>&nbsp;<span class="op" id="7904097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904101">t</span><span class="op" id="7904102">.</span><span class="ident" id="7904103">Fatal</span><span class="op" id="7904108">(</span><span class="string" id="7904109">&#34;encode:&#34;</span><span class="op" id="7904118">,</span>&nbsp;<span class="ident" id="7904120">err</span><span class="op" id="7904123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904126">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904130">var</span>&nbsp;<span class="ident" id="7904134">out</span>&nbsp;<span class="op" id="7904138">[</span><span class="op" id="7904139">]</span><span class="op" id="7904140">*</span><span class="ident" id="7904141">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904147">err</span>&nbsp;<span class="op" id="7904151">=</span>&nbsp;<span class="ident" id="7904153">NewDecoder</span><span class="op" id="7904163">(</span><span class="ident" id="7904164">b</span><span class="op" id="7904165">)</span><span class="op" id="7904166">.</span><span class="ident" id="7904167">Decode</span><span class="op" id="7904173">(</span><span class="op" id="7904174">&amp;</span><span class="ident" id="7904175">out</span><span class="op" id="7904178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904181">if</span>&nbsp;<span class="ident" id="7904184">err</span>&nbsp;<span class="op" id="7904188">!=</span>&nbsp;<span class="ident" id="7904191">nil</span>&nbsp;<span class="op" id="7904195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904199">t</span><span class="op" id="7904200">.</span><span class="ident" id="7904201">Fatal</span><span class="op" id="7904206">(</span><span class="string" id="7904207">&#34;decode:&#34;</span><span class="op" id="7904216">,</span>&nbsp;<span class="ident" id="7904218">err</span><span class="op" id="7904221">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904227">if</span>&nbsp;<span class="op" id="7904230">!</span><span class="ident" id="7904231">reflect</span><span class="op" id="7904238">.</span><span class="ident" id="7904239">DeepEqual</span><span class="op" id="7904248">(</span><span class="ident" id="7904249">in</span><span class="op" id="7904251">,</span>&nbsp;<span class="ident" id="7904253">out</span><span class="op" id="7904256">)</span>&nbsp;<span class="op" id="7904258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904262">t</span><span class="op" id="7904263">.</span><span class="ident" id="7904264">Fatalf</span><span class="op" id="7904270">(</span><span class="string" id="7904271">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="7904290">,</span>&nbsp;<span class="ident" id="7904292">out</span><span class="op" id="7904295">,</span>&nbsp;<span class="ident" id="7904297">in</span><span class="op" id="7904299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904302">}</span><br>
<span class="lineno"></span><span class="op" id="7904304">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="7904307">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="7904384">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7904454">func</span>&nbsp;<span class="ident" id="7904459">TestPtrToMapOfMap</span><span class="op" id="7904476">(</span><span class="ident" id="7904477">t</span>&nbsp;<span class="op" id="7904479">*</span><span class="ident" id="7904480">testing</span><span class="op" id="7904487">.</span><span class="ident" id="7904488">T</span><span class="op" id="7904489">)</span>&nbsp;<span class="op" id="7904491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904494">Register</span><span class="op" id="7904502">(</span><span class="builtinfunc" id="7904503">make</span><span class="op" id="7904507">(</span><span class="keyword" id="7904508">map</span><span class="op" id="7904511">[</span><span class="builtintype" id="7904512">string</span><span class="op" id="7904518">]</span><span class="keyword" id="7904519">interface</span><span class="op" id="7904528">{</span><span class="op" id="7904529">}</span><span class="op" id="7904530">)</span><span class="op" id="7904531">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904534">subdata</span>&nbsp;<span class="op" id="7904542">:=</span>&nbsp;<span class="builtinfunc" id="7904545">make</span><span class="op" id="7904549">(</span><span class="keyword" id="7904550">map</span><span class="op" id="7904553">[</span><span class="builtintype" id="7904554">string</span><span class="op" id="7904560">]</span><span class="keyword" id="7904561">interface</span><span class="op" id="7904570">{</span><span class="op" id="7904571">}</span><span class="op" id="7904572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904575">subdata</span><span class="op" id="7904582">[</span><span class="string" id="7904583">&#34;bar&#34;</span><span class="op" id="7904588">]</span>&nbsp;<span class="op" id="7904590">=</span>&nbsp;<span class="string" id="7904592">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904599">data</span>&nbsp;<span class="op" id="7904604">:=</span>&nbsp;<span class="builtinfunc" id="7904607">make</span><span class="op" id="7904611">(</span><span class="keyword" id="7904612">map</span><span class="op" id="7904615">[</span><span class="builtintype" id="7904616">string</span><span class="op" id="7904622">]</span><span class="keyword" id="7904623">interface</span><span class="op" id="7904632">{</span><span class="op" id="7904633">}</span><span class="op" id="7904634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904637">data</span><span class="op" id="7904641">[</span><span class="string" id="7904642">&#34;foo&#34;</span><span class="op" id="7904647">]</span>&nbsp;<span class="op" id="7904649">=</span>&nbsp;<span class="ident" id="7904651">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904661">b</span>&nbsp;<span class="op" id="7904663">:=</span>&nbsp;<span class="builtinfunc" id="7904666">new</span><span class="op" id="7904669">(</span><span class="ident" id="7904670">bytes</span><span class="op" id="7904675">.</span><span class="ident" id="7904676">Buffer</span><span class="op" id="7904682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904685">err</span>&nbsp;<span class="op" id="7904689">:=</span>&nbsp;<span class="ident" id="7904692">NewEncoder</span><span class="op" id="7904702">(</span><span class="ident" id="7904703">b</span><span class="op" id="7904704">)</span><span class="op" id="7904705">.</span><span class="ident" id="7904706">Encode</span><span class="op" id="7904712">(</span><span class="ident" id="7904713">data</span><span class="op" id="7904717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904720">if</span>&nbsp;<span class="ident" id="7904723">err</span>&nbsp;<span class="op" id="7904727">!=</span>&nbsp;<span class="ident" id="7904730">nil</span>&nbsp;<span class="op" id="7904734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904738">t</span><span class="op" id="7904739">.</span><span class="ident" id="7904740">Fatal</span><span class="op" id="7904745">(</span><span class="string" id="7904746">&#34;encode:&#34;</span><span class="op" id="7904755">,</span>&nbsp;<span class="ident" id="7904757">err</span><span class="op" id="7904760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904763">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904766">var</span>&nbsp;<span class="ident" id="7904770">newData</span>&nbsp;<span class="keyword" id="7904778">map</span><span class="op" id="7904781">[</span><span class="builtintype" id="7904782">string</span><span class="op" id="7904788">]</span><span class="keyword" id="7904789">interface</span><span class="op" id="7904798">{</span><span class="op" id="7904799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904802">err</span>&nbsp;<span class="op" id="7904806">=</span>&nbsp;<span class="ident" id="7904808">NewDecoder</span><span class="op" id="7904818">(</span><span class="ident" id="7904819">b</span><span class="op" id="7904820">)</span><span class="op" id="7904821">.</span><span class="ident" id="7904822">Decode</span><span class="op" id="7904828">(</span><span class="op" id="7904829">&amp;</span><span class="ident" id="7904830">newData</span><span class="op" id="7904837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904840">if</span>&nbsp;<span class="ident" id="7904843">err</span>&nbsp;<span class="op" id="7904847">!=</span>&nbsp;<span class="ident" id="7904850">nil</span>&nbsp;<span class="op" id="7904854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904858">t</span><span class="op" id="7904859">.</span><span class="ident" id="7904860">Fatal</span><span class="op" id="7904865">(</span><span class="string" id="7904866">&#34;decode:&#34;</span><span class="op" id="7904875">,</span>&nbsp;<span class="ident" id="7904877">err</span><span class="op" id="7904880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904883">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904886">if</span>&nbsp;<span class="op" id="7904889">!</span><span class="ident" id="7904890">reflect</span><span class="op" id="7904897">.</span><span class="ident" id="7904898">DeepEqual</span><span class="op" id="7904907">(</span><span class="ident" id="7904908">data</span><span class="op" id="7904912">,</span>&nbsp;<span class="ident" id="7904914">newData</span><span class="op" id="7904921">)</span>&nbsp;<span class="op" id="7904923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904927">t</span><span class="op" id="7904928">.</span><span class="ident" id="7904929">Fatalf</span><span class="op" id="7904935">(</span><span class="string" id="7904936">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7904956">,</span>&nbsp;<span class="ident" id="7904958">data</span><span class="op" id="7904962">,</span>&nbsp;<span class="ident" id="7904964">newData</span><span class="op" id="7904971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904974">}</span><br>
<span class="lineno"></span><span class="op" id="7904976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="7904979">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="7905062">func</span>&nbsp;<span class="ident" id="7905067">TestTopLevelNilPointer</span><span class="op" id="7905089">(</span><span class="ident" id="7905090">t</span>&nbsp;<span class="op" id="7905092">*</span><span class="ident" id="7905093">testing</span><span class="op" id="7905100">.</span><span class="ident" id="7905101">T</span><span class="op" id="7905102">)</span>&nbsp;<span class="op" id="7905104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905107">errMsg</span>&nbsp;<span class="op" id="7905114">:=</span>&nbsp;<span class="ident" id="7905117">topLevelNilPanic</span><span class="op" id="7905133">(</span><span class="ident" id="7905134">t</span><span class="op" id="7905135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905138">if</span>&nbsp;<span class="ident" id="7905141">errMsg</span>&nbsp;<span class="op" id="7905148">==</span>&nbsp;<span class="string" id="7905151">&#34;&#34;</span>&nbsp;<span class="op" id="7905154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905158">t</span><span class="op" id="7905159">.</span><span class="ident" id="7905160">Fatal</span><span class="op" id="7905165">(</span><span class="string" id="7905166">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7905203">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905209">if</span>&nbsp;<span class="op" id="7905212">!</span><span class="ident" id="7905213">strings</span><span class="op" id="7905220">.</span><span class="ident" id="7905221">Contains</span><span class="op" id="7905229">(</span><span class="ident" id="7905230">errMsg</span><span class="op" id="7905236">,</span>&nbsp;<span class="string" id="7905238">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="7905251">)</span>&nbsp;<span class="op" id="7905253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905257">t</span><span class="op" id="7905258">.</span><span class="ident" id="7905259">Fatal</span><span class="op" id="7905264">(</span><span class="string" id="7905265">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="7905299">,</span>&nbsp;<span class="ident" id="7905301">errMsg</span><span class="op" id="7905307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905310">}</span><br>
<span class="lineno"></span><span class="op" id="7905312">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="7905315">func</span>&nbsp;<span class="ident" id="7905320">topLevelNilPanic</span><span class="op" id="7905336">(</span><span class="ident" id="7905337">t</span>&nbsp;<span class="op" id="7905339">*</span><span class="ident" id="7905340">testing</span><span class="op" id="7905347">.</span><span class="ident" id="7905348">T</span><span class="op" id="7905349">)</span>&nbsp;<span class="op" id="7905351">(</span><span class="ident" id="7905352">panicErr</span>&nbsp;<span class="builtintype" id="7905361">string</span><span class="op" id="7905367">)</span>&nbsp;<span class="op" id="7905369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905372">defer</span>&nbsp;<span class="keyword" id="7905378">func</span><span class="op" id="7905382">(</span><span class="op" id="7905383">)</span>&nbsp;<span class="op" id="7905385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905389">e</span>&nbsp;<span class="op" id="7905391">:=</span>&nbsp;<span class="builtinfunc" id="7905394">recover</span><span class="op" id="7905401">(</span><span class="op" id="7905402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905406">if</span>&nbsp;<span class="ident" id="7905409">err</span><span class="op" id="7905412">,</span>&nbsp;<span class="ident" id="7905414">ok</span>&nbsp;<span class="op" id="7905417">:=</span>&nbsp;<span class="ident" id="7905420">e</span><span class="op" id="7905421">.</span><span class="op" id="7905422">(</span><span class="builtintype" id="7905423">string</span><span class="op" id="7905429">)</span><span class="op" id="7905430">;</span>&nbsp;<span class="ident" id="7905432">ok</span>&nbsp;<span class="op" id="7905435">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905440">panicErr</span>&nbsp;<span class="op" id="7905449">=</span>&nbsp;<span class="ident" id="7905451">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905460">}</span><span class="op" id="7905461">(</span><span class="op" id="7905462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905465">var</span>&nbsp;<span class="ident" id="7905469">ip</span>&nbsp;<span class="op" id="7905472">*</span><span class="builtintype" id="7905473">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905478">buf</span>&nbsp;<span class="op" id="7905482">:=</span>&nbsp;<span class="builtinfunc" id="7905485">new</span><span class="op" id="7905488">(</span><span class="ident" id="7905489">bytes</span><span class="op" id="7905494">.</span><span class="ident" id="7905495">Buffer</span><span class="op" id="7905501">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905504">if</span>&nbsp;<span class="ident" id="7905507">err</span>&nbsp;<span class="op" id="7905511">:=</span>&nbsp;<span class="ident" id="7905514">NewEncoder</span><span class="op" id="7905524">(</span><span class="ident" id="7905525">buf</span><span class="op" id="7905528">)</span><span class="op" id="7905529">.</span><span class="ident" id="7905530">Encode</span><span class="op" id="7905536">(</span><span class="ident" id="7905537">ip</span><span class="op" id="7905539">)</span><span class="op" id="7905540">;</span>&nbsp;<span class="ident" id="7905542">err</span>&nbsp;<span class="op" id="7905546">!=</span>&nbsp;<span class="ident" id="7905549">nil</span>&nbsp;<span class="op" id="7905553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905557">t</span><span class="op" id="7905558">.</span><span class="ident" id="7905559">Fatal</span><span class="op" id="7905564">(</span><span class="string" id="7905565">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="7905583">,</span>&nbsp;<span class="ident" id="7905585">err</span><span class="op" id="7905588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905594">return</span><br>
<span class="lineno"></span><span class="op" id="7905601">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="7905604">func</span>&nbsp;<span class="ident" id="7905609">TestNilPointerInsideInterface</span><span class="op" id="7905638">(</span><span class="ident" id="7905639">t</span>&nbsp;<span class="op" id="7905641">*</span><span class="ident" id="7905642">testing</span><span class="op" id="7905649">.</span><span class="ident" id="7905650">T</span><span class="op" id="7905651">)</span>&nbsp;<span class="op" id="7905653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905656">var</span>&nbsp;<span class="ident" id="7905660">ip</span>&nbsp;<span class="op" id="7905663">*</span><span class="builtintype" id="7905664">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905669">si</span>&nbsp;<span class="op" id="7905672">:=</span>&nbsp;<span class="keyword" id="7905675">struct</span>&nbsp;<span class="op" id="7905682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905686">I</span>&nbsp;<span class="keyword" id="7905688">interface</span><span class="op" id="7905697">{</span><span class="op" id="7905698">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905701">}</span><span class="op" id="7905702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905706">I</span><span class="op" id="7905707">:</span>&nbsp;<span class="ident" id="7905709">ip</span><span class="op" id="7905711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905717">buf</span>&nbsp;<span class="op" id="7905721">:=</span>&nbsp;<span class="builtinfunc" id="7905724">new</span><span class="op" id="7905727">(</span><span class="ident" id="7905728">bytes</span><span class="op" id="7905733">.</span><span class="ident" id="7905734">Buffer</span><span class="op" id="7905740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905743">err</span>&nbsp;<span class="op" id="7905747">:=</span>&nbsp;<span class="ident" id="7905750">NewEncoder</span><span class="op" id="7905760">(</span><span class="ident" id="7905761">buf</span><span class="op" id="7905764">)</span><span class="op" id="7905765">.</span><span class="ident" id="7905766">Encode</span><span class="op" id="7905772">(</span><span class="ident" id="7905773">si</span><span class="op" id="7905775">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905778">if</span>&nbsp;<span class="ident" id="7905781">err</span>&nbsp;<span class="op" id="7905785">==</span>&nbsp;<span class="ident" id="7905788">nil</span>&nbsp;<span class="op" id="7905792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905796">t</span><span class="op" id="7905797">.</span><span class="ident" id="7905798">Fatal</span><span class="op" id="7905803">(</span><span class="string" id="7905804">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="7905830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905836">errMsg</span>&nbsp;<span class="op" id="7905843">:=</span>&nbsp;<span class="ident" id="7905846">err</span><span class="op" id="7905849">.</span><span class="ident" id="7905850">Error</span><span class="op" id="7905855">(</span><span class="op" id="7905856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905859">if</span>&nbsp;<span class="op" id="7905862">!</span><span class="ident" id="7905863">strings</span><span class="op" id="7905870">.</span><span class="ident" id="7905871">Contains</span><span class="op" id="7905879">(</span><span class="ident" id="7905880">errMsg</span><span class="op" id="7905886">,</span>&nbsp;<span class="string" id="7905888">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="7905901">)</span>&nbsp;<span class="op" id="7905903">||</span>&nbsp;<span class="op" id="7905906">!</span><span class="ident" id="7905907">strings</span><span class="op" id="7905914">.</span><span class="ident" id="7905915">Contains</span><span class="op" id="7905923">(</span><span class="ident" id="7905924">errMsg</span><span class="op" id="7905930">,</span>&nbsp;<span class="string" id="7905932">&#34;interface&#34;</span><span class="op" id="7905943">)</span>&nbsp;<span class="op" id="7905945">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905949">t</span><span class="op" id="7905950">.</span><span class="ident" id="7905951">Fatal</span><span class="op" id="7905956">(</span><span class="string" id="7905957">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="7906011">,</span>&nbsp;<span class="ident" id="7906013">errMsg</span><span class="op" id="7906019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906022">}</span><br>
<span class="lineno"></span><span class="op" id="7906024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7906027">type</span>&nbsp;<span class="ident" id="7906032">Bug4Public</span>&nbsp;<span class="keyword" id="7906043">struct</span>&nbsp;<span class="op" id="7906050">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906053">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7906060">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906068">Secret</span>&nbsp;<span class="ident" id="7906075">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="7906086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7906089">type</span>&nbsp;<span class="ident" id="7906094">Bug4Secret</span>&nbsp;<span class="keyword" id="7906105">struct</span>&nbsp;<span class="op" id="7906112">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906115">a</span>&nbsp;<span class="builtintype" id="7906117">int</span>&nbsp;<span class="comment" id="7906121">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="7906151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7906154">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="7906232">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="7906247">func</span>&nbsp;<span class="ident" id="7906252">TestMutipleEncodingsOfBadType</span><span class="op" id="7906281">(</span><span class="ident" id="7906282">t</span>&nbsp;<span class="op" id="7906284">*</span><span class="ident" id="7906285">testing</span><span class="op" id="7906292">.</span><span class="ident" id="7906293">T</span><span class="op" id="7906294">)</span>&nbsp;<span class="op" id="7906296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906299">x</span>&nbsp;<span class="op" id="7906301">:=</span>&nbsp;<span class="ident" id="7906304">Bug4Public</span><span class="op" id="7906314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906318">Name</span><span class="op" id="7906322">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7906326">&#34;name&#34;</span><span class="op" id="7906332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906336">Secret</span><span class="op" id="7906342">:</span>&nbsp;<span class="ident" id="7906344">Bug4Secret</span><span class="op" id="7906354">{</span><span class="num" id="7906355">1</span><span class="op" id="7906356">}</span><span class="op" id="7906357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906360">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906363">buf</span>&nbsp;<span class="op" id="7906367">:=</span>&nbsp;<span class="builtinfunc" id="7906370">new</span><span class="op" id="7906373">(</span><span class="ident" id="7906374">bytes</span><span class="op" id="7906379">.</span><span class="ident" id="7906380">Buffer</span><span class="op" id="7906386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906389">enc</span>&nbsp;<span class="op" id="7906393">:=</span>&nbsp;<span class="ident" id="7906396">NewEncoder</span><span class="op" id="7906406">(</span><span class="ident" id="7906407">buf</span><span class="op" id="7906410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906413">err</span>&nbsp;<span class="op" id="7906417">:=</span>&nbsp;<span class="ident" id="7906420">enc</span><span class="op" id="7906423">.</span><span class="ident" id="7906424">Encode</span><span class="op" id="7906430">(</span><span class="ident" id="7906431">x</span><span class="op" id="7906432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906435">if</span>&nbsp;<span class="ident" id="7906438">err</span>&nbsp;<span class="op" id="7906442">==</span>&nbsp;<span class="ident" id="7906445">nil</span>&nbsp;<span class="op" id="7906449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906453">t</span><span class="op" id="7906454">.</span><span class="ident" id="7906455">Fatal</span><span class="op" id="7906460">(</span><span class="string" id="7906461">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7906493">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906499">buf</span><span class="op" id="7906502">.</span><span class="ident" id="7906503">Reset</span><span class="op" id="7906508">(</span><span class="op" id="7906509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906512">enc</span>&nbsp;<span class="op" id="7906516">=</span>&nbsp;<span class="ident" id="7906518">NewEncoder</span><span class="op" id="7906528">(</span><span class="ident" id="7906529">buf</span><span class="op" id="7906532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906535">err</span>&nbsp;<span class="op" id="7906539">=</span>&nbsp;<span class="ident" id="7906541">enc</span><span class="op" id="7906544">.</span><span class="ident" id="7906545">Encode</span><span class="op" id="7906551">(</span><span class="ident" id="7906552">x</span><span class="op" id="7906553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906556">if</span>&nbsp;<span class="ident" id="7906559">err</span>&nbsp;<span class="op" id="7906563">==</span>&nbsp;<span class="ident" id="7906566">nil</span>&nbsp;<span class="op" id="7906570">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906574">t</span><span class="op" id="7906575">.</span><span class="ident" id="7906576">Fatal</span><span class="op" id="7906581">(</span><span class="string" id="7906582">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7906615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906621">if</span>&nbsp;<span class="op" id="7906624">!</span><span class="ident" id="7906625">strings</span><span class="op" id="7906632">.</span><span class="ident" id="7906633">Contains</span><span class="op" id="7906641">(</span><span class="ident" id="7906642">err</span><span class="op" id="7906645">.</span><span class="ident" id="7906646">Error</span><span class="op" id="7906651">(</span><span class="op" id="7906652">)</span><span class="op" id="7906653">,</span>&nbsp;<span class="string" id="7906655">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="7906675">)</span>&nbsp;<span class="op" id="7906677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906681">t</span><span class="op" id="7906682">.</span><span class="ident" id="7906683">Errorf</span><span class="op" id="7906689">(</span><span class="string" id="7906690">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7906739">,</span>&nbsp;<span class="ident" id="7906741">err</span><span class="op" id="7906744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906747">}</span><br>
<span class="lineno">905</span><span class="op" id="7906749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7906752">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7906823">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="7906891">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="7906961">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7907031">type</span>&nbsp;<span class="ident" id="7907036">Z</span>&nbsp;<span class="keyword" id="7907038">struct</span>&nbsp;<span class="op" id="7907045">{</span><br>
<span class="lineno"></span><span class="op" id="7907047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="7907050">func</span>&nbsp;<span class="ident" id="7907055">Test29ElementSlice</span><span class="op" id="7907073">(</span><span class="ident" id="7907074">t</span>&nbsp;<span class="op" id="7907076">*</span><span class="ident" id="7907077">testing</span><span class="op" id="7907084">.</span><span class="ident" id="7907085">T</span><span class="op" id="7907086">)</span>&nbsp;<span class="op" id="7907088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907091">Register</span><span class="op" id="7907099">(</span><span class="ident" id="7907100">Z</span><span class="op" id="7907101">{</span><span class="op" id="7907102">}</span><span class="op" id="7907103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907106">src</span>&nbsp;<span class="op" id="7907110">:=</span>&nbsp;<span class="builtinfunc" id="7907113">make</span><span class="op" id="7907117">(</span><span class="op" id="7907118">[</span><span class="op" id="7907119">]</span><span class="keyword" id="7907120">interface</span><span class="op" id="7907129">{</span><span class="op" id="7907130">}</span><span class="op" id="7907131">,</span>&nbsp;<span class="num" id="7907133">100</span><span class="op" id="7907136">)</span>&nbsp;<span class="comment" id="7907138">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907196">for</span>&nbsp;<span class="ident" id="7907200">i</span>&nbsp;<span class="op" id="7907202">:=</span>&nbsp;<span class="keyword" id="7907205">range</span>&nbsp;<span class="ident" id="7907211">src</span>&nbsp;<span class="op" id="7907215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907219">src</span><span class="op" id="7907222">[</span><span class="ident" id="7907223">i</span><span class="op" id="7907224">]</span>&nbsp;<span class="op" id="7907226">=</span>&nbsp;<span class="ident" id="7907228">Z</span><span class="op" id="7907229">{</span><span class="op" id="7907230">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907236">buf</span>&nbsp;<span class="op" id="7907240">:=</span>&nbsp;<span class="builtinfunc" id="7907243">new</span><span class="op" id="7907246">(</span><span class="ident" id="7907247">bytes</span><span class="op" id="7907252">.</span><span class="ident" id="7907253">Buffer</span><span class="op" id="7907259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907262">err</span>&nbsp;<span class="op" id="7907266">:=</span>&nbsp;<span class="ident" id="7907269">NewEncoder</span><span class="op" id="7907279">(</span><span class="ident" id="7907280">buf</span><span class="op" id="7907283">)</span><span class="op" id="7907284">.</span><span class="ident" id="7907285">Encode</span><span class="op" id="7907291">(</span><span class="ident" id="7907292">src</span><span class="op" id="7907295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907298">if</span>&nbsp;<span class="ident" id="7907301">err</span>&nbsp;<span class="op" id="7907305">!=</span>&nbsp;<span class="ident" id="7907308">nil</span>&nbsp;<span class="op" id="7907312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907316">t</span><span class="op" id="7907317">.</span><span class="ident" id="7907318">Fatalf</span><span class="op" id="7907324">(</span><span class="string" id="7907325">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="7907337">,</span>&nbsp;<span class="ident" id="7907339">err</span><span class="op" id="7907342">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907346">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907358">var</span>&nbsp;<span class="ident" id="7907362">dst</span>&nbsp;<span class="op" id="7907366">[</span><span class="op" id="7907367">]</span><span class="keyword" id="7907368">interface</span><span class="op" id="7907377">{</span><span class="op" id="7907378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907381">err</span>&nbsp;<span class="op" id="7907385">=</span>&nbsp;<span class="ident" id="7907387">NewDecoder</span><span class="op" id="7907397">(</span><span class="ident" id="7907398">buf</span><span class="op" id="7907401">)</span><span class="op" id="7907402">.</span><span class="ident" id="7907403">Decode</span><span class="op" id="7907409">(</span><span class="op" id="7907410">&amp;</span><span class="ident" id="7907411">dst</span><span class="op" id="7907414">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907417">if</span>&nbsp;<span class="ident" id="7907420">err</span>&nbsp;<span class="op" id="7907424">!=</span>&nbsp;<span class="ident" id="7907427">nil</span>&nbsp;<span class="op" id="7907431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907435">t</span><span class="op" id="7907436">.</span><span class="ident" id="7907437">Errorf</span><span class="op" id="7907443">(</span><span class="string" id="7907444">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="7907456">,</span>&nbsp;<span class="ident" id="7907458">err</span><span class="op" id="7907461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907465">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907473">}</span><br>
<span class="lineno"></span><span class="op" id="7907475">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="7907478">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="7907540">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="7907555">func</span>&nbsp;<span class="ident" id="7907560">TestErrorForHugeSlice</span><span class="op" id="7907581">(</span><span class="ident" id="7907582">t</span>&nbsp;<span class="op" id="7907584">*</span><span class="ident" id="7907585">testing</span><span class="op" id="7907592">.</span><span class="ident" id="7907593">T</span><span class="op" id="7907594">)</span>&nbsp;<span class="op" id="7907596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907599">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907624">buf</span>&nbsp;<span class="op" id="7907628">:=</span>&nbsp;<span class="builtinfunc" id="7907631">new</span><span class="op" id="7907634">(</span><span class="ident" id="7907635">bytes</span><span class="op" id="7907640">.</span><span class="ident" id="7907641">Buffer</span><span class="op" id="7907647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907650">slice</span>&nbsp;<span class="op" id="7907656">:=</span>&nbsp;<span class="op" id="7907659">[</span><span class="op" id="7907660">]</span><span class="builtintype" id="7907661">int</span><span class="op" id="7907664">{</span><span class="num" id="7907665">1</span><span class="op" id="7907666">,</span>&nbsp;<span class="num" id="7907668">1</span><span class="op" id="7907669">,</span>&nbsp;<span class="num" id="7907671">1</span><span class="op" id="7907672">,</span>&nbsp;<span class="num" id="7907674">1</span><span class="op" id="7907675">,</span>&nbsp;<span class="num" id="7907677">1</span><span class="op" id="7907678">,</span>&nbsp;<span class="num" id="7907680">1</span><span class="op" id="7907681">,</span>&nbsp;<span class="num" id="7907683">1</span><span class="op" id="7907684">,</span>&nbsp;<span class="num" id="7907686">1</span><span class="op" id="7907687">,</span>&nbsp;<span class="num" id="7907689">1</span><span class="op" id="7907690">,</span>&nbsp;<span class="num" id="7907692">1</span><span class="op" id="7907693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907696">err</span>&nbsp;<span class="op" id="7907700">:=</span>&nbsp;<span class="ident" id="7907703">NewEncoder</span><span class="op" id="7907713">(</span><span class="ident" id="7907714">buf</span><span class="op" id="7907717">)</span><span class="op" id="7907718">.</span><span class="ident" id="7907719">Encode</span><span class="op" id="7907725">(</span><span class="ident" id="7907726">slice</span><span class="op" id="7907731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907734">if</span>&nbsp;<span class="ident" id="7907737">err</span>&nbsp;<span class="op" id="7907741">!=</span>&nbsp;<span class="ident" id="7907744">nil</span>&nbsp;<span class="op" id="7907748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907752">t</span><span class="op" id="7907753">.</span><span class="ident" id="7907754">Fatal</span><span class="op" id="7907759">(</span><span class="string" id="7907760">&#34;encode:&#34;</span><span class="op" id="7907769">,</span>&nbsp;<span class="ident" id="7907771">err</span><span class="op" id="7907774">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907780">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907863">buf</span><span class="op" id="7907866">.</span><span class="ident" id="7907867">Bytes</span><span class="op" id="7907872">(</span><span class="op" id="7907873">)</span><span class="op" id="7907874">[</span><span class="ident" id="7907875">buf</span><span class="op" id="7907878">.</span><span class="ident" id="7907879">Len</span><span class="op" id="7907882">(</span><span class="op" id="7907883">)</span><span class="op" id="7907884">-</span><span class="builtinfunc" id="7907885">len</span><span class="op" id="7907888">(</span><span class="ident" id="7907889">slice</span><span class="op" id="7907894">)</span><span class="op" id="7907895">-</span><span class="num" id="7907896">1</span><span class="op" id="7907897">]</span>&nbsp;<span class="op" id="7907899">=</span>&nbsp;<span class="num" id="7907901">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907907">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907933">err</span>&nbsp;<span class="op" id="7907937">=</span>&nbsp;<span class="ident" id="7907939">NewDecoder</span><span class="op" id="7907949">(</span><span class="ident" id="7907950">buf</span><span class="op" id="7907953">)</span><span class="op" id="7907954">.</span><span class="ident" id="7907955">Decode</span><span class="op" id="7907961">(</span><span class="op" id="7907962">&amp;</span><span class="ident" id="7907963">slice</span><span class="op" id="7907968">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907971">if</span>&nbsp;<span class="ident" id="7907974">err</span>&nbsp;<span class="op" id="7907978">==</span>&nbsp;<span class="ident" id="7907981">nil</span>&nbsp;<span class="op" id="7907985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907989">t</span><span class="op" id="7907990">.</span><span class="ident" id="7907991">Fatal</span><span class="op" id="7907996">(</span><span class="string" id="7907997">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="7908015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908021">if</span>&nbsp;<span class="op" id="7908024">!</span><span class="ident" id="7908025">strings</span><span class="op" id="7908032">.</span><span class="ident" id="7908033">Contains</span><span class="op" id="7908041">(</span><span class="ident" id="7908042">err</span><span class="op" id="7908045">.</span><span class="ident" id="7908046">Error</span><span class="op" id="7908051">(</span><span class="op" id="7908052">)</span><span class="op" id="7908053">,</span>&nbsp;<span class="string" id="7908055">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="7908070">)</span>&nbsp;<span class="op" id="7908072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908076">t</span><span class="op" id="7908077">.</span><span class="ident" id="7908078">Fatal</span><span class="op" id="7908083">(</span><span class="string" id="7908084">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7908130">,</span>&nbsp;<span class="ident" id="7908132">err</span><span class="op" id="7908135">.</span><span class="ident" id="7908136">Error</span><span class="op" id="7908141">(</span><span class="op" id="7908142">)</span><span class="op" id="7908143">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908146">}</span><br>
<span class="lineno"></span><span class="op" id="7908148">}</span>
</div>
</body>
</html>
