<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5950147">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5950202">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5950256">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5950307">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5950366">//</span><br>
<span class="lineno"></span><span class="comment" id="5950369">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5950427">package</span>&nbsp;<span class="ident" id="5950435">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5950440">import</span>&nbsp;<span class="op" id="5950447">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950450">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950467">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950486">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950493">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950501">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950515">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950524">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5950539">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5950544">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5950547">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5950583">const</span>&nbsp;<span class="op" id="5950589">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950592">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950609">=</span>&nbsp;<span class="num" id="5950611">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950614">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950631">=</span>&nbsp;<span class="num" id="5950633">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950636">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950653">=</span>&nbsp;<span class="num" id="5950655">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950658">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5950675">=</span>&nbsp;<span class="num" id="5950677">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950680">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5950697">=</span>&nbsp;<span class="num" id="5950699">6</span><br>
<span class="lineno"></span><span class="op" id="5950701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5950704">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5950758">const</span>&nbsp;<span class="op" id="5950764">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950767">cbInvalid</span>&nbsp;<span class="op" id="5950777">=</span>&nbsp;<span class="ident" id="5950779">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950785">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950791">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950797">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950803">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950809">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950816">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950823">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950829">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950835">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950841">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950847">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950855">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950862">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950870">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950878">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5950886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5950889">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5950926">const</span>&nbsp;<span class="op" id="5950932">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950935">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950945">=</span>&nbsp;<span class="num" id="5950947">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950950">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950960">=</span>&nbsp;<span class="num" id="5950962">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950965">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950975">=</span>&nbsp;<span class="num" id="5950977">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950980">ftAverage</span>&nbsp;<span class="op" id="5950990">=</span>&nbsp;<span class="num" id="5950992">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950995">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5951005">=</span>&nbsp;<span class="num" id="5951007">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951010">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5951020">=</span>&nbsp;<span class="num" id="5951022">5</span><br>
<span class="lineno"></span><span class="op" id="5951024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5951027">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5951046">const</span>&nbsp;<span class="op" id="5951052">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951055">itNone</span>&nbsp;&nbsp;<span class="op" id="5951063">=</span>&nbsp;<span class="num" id="5951065">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951068">itAdam7</span>&nbsp;<span class="op" id="5951076">=</span>&nbsp;<span class="num" id="5951078">1</span><br>
<span class="lineno"></span><span class="op" id="5951080">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5951083">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5951164">type</span>&nbsp;<span class="ident" id="5951169">interlaceScan</span>&nbsp;<span class="keyword" id="5951183">struct</span>&nbsp;<span class="op" id="5951190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951193">xFactor</span><span class="op" id="5951200">,</span>&nbsp;<span class="ident" id="5951202">yFactor</span><span class="op" id="5951209">,</span>&nbsp;<span class="ident" id="5951211">xOffset</span><span class="op" id="5951218">,</span>&nbsp;<span class="ident" id="5951220">yOffset</span>&nbsp;<span class="builtintype" id="5951228">int</span><br>
<span class="lineno"></span><span class="op" id="5951232">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5951235">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5951310">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5951354">var</span>&nbsp;<span class="ident" id="5951358">interlacing</span>&nbsp;<span class="op" id="5951370">=</span>&nbsp;<span class="op" id="5951372">[</span><span class="op" id="5951373">]</span><span class="ident" id="5951374">interlaceScan</span><span class="op" id="5951387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951390">{</span><span class="num" id="5951391">8</span><span class="op" id="5951392">,</span>&nbsp;<span class="num" id="5951394">8</span><span class="op" id="5951395">,</span>&nbsp;<span class="num" id="5951397">0</span><span class="op" id="5951398">,</span>&nbsp;<span class="num" id="5951400">0</span><span class="op" id="5951401">}</span><span class="op" id="5951402">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951405">{</span><span class="num" id="5951406">8</span><span class="op" id="5951407">,</span>&nbsp;<span class="num" id="5951409">8</span><span class="op" id="5951410">,</span>&nbsp;<span class="num" id="5951412">4</span><span class="op" id="5951413">,</span>&nbsp;<span class="num" id="5951415">0</span><span class="op" id="5951416">}</span><span class="op" id="5951417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951420">{</span><span class="num" id="5951421">4</span><span class="op" id="5951422">,</span>&nbsp;<span class="num" id="5951424">8</span><span class="op" id="5951425">,</span>&nbsp;<span class="num" id="5951427">0</span><span class="op" id="5951428">,</span>&nbsp;<span class="num" id="5951430">4</span><span class="op" id="5951431">}</span><span class="op" id="5951432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951435">{</span><span class="num" id="5951436">4</span><span class="op" id="5951437">,</span>&nbsp;<span class="num" id="5951439">4</span><span class="op" id="5951440">,</span>&nbsp;<span class="num" id="5951442">2</span><span class="op" id="5951443">,</span>&nbsp;<span class="num" id="5951445">0</span><span class="op" id="5951446">}</span><span class="op" id="5951447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951450">{</span><span class="num" id="5951451">2</span><span class="op" id="5951452">,</span>&nbsp;<span class="num" id="5951454">4</span><span class="op" id="5951455">,</span>&nbsp;<span class="num" id="5951457">0</span><span class="op" id="5951458">,</span>&nbsp;<span class="num" id="5951460">2</span><span class="op" id="5951461">}</span><span class="op" id="5951462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951465">{</span><span class="num" id="5951466">2</span><span class="op" id="5951467">,</span>&nbsp;<span class="num" id="5951469">2</span><span class="op" id="5951470">,</span>&nbsp;<span class="num" id="5951472">1</span><span class="op" id="5951473">,</span>&nbsp;<span class="num" id="5951475">0</span><span class="op" id="5951476">}</span><span class="op" id="5951477">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951480">{</span><span class="num" id="5951481">1</span><span class="op" id="5951482">,</span>&nbsp;<span class="num" id="5951484">2</span><span class="op" id="5951485">,</span>&nbsp;<span class="num" id="5951487">0</span><span class="op" id="5951488">,</span>&nbsp;<span class="num" id="5951490">1</span><span class="op" id="5951491">}</span><span class="op" id="5951492">,</span><br>
<span class="lineno"></span><span class="op" id="5951494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5951497">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5951516">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5951594">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5951670">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5951745">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5951763">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5951807">const</span>&nbsp;<span class="op" id="5951813">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951816">dsStart</span>&nbsp;<span class="op" id="5951824">=</span>&nbsp;<span class="ident" id="5951826">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951832">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951844">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951856">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951868">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5951879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5951882">const</span>&nbsp;<span class="ident" id="5951888">pngHeader</span>&nbsp;<span class="op" id="5951898">=</span>&nbsp;<span class="string" id="5951900">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5951921">type</span>&nbsp;<span class="ident" id="5951926">decoder</span>&nbsp;<span class="keyword" id="5951934">struct</span>&nbsp;<span class="op" id="5951941">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951944">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951958">io</span><span class="op" id="5951960">.</span><span class="ident" id="5951961">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951969">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951983">image</span><span class="op" id="5951988">.</span><span class="ident" id="5951989">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951996">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952010">hash</span><span class="op" id="5952014">.</span><span class="ident" id="5952015">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952023">width</span><span class="op" id="5952028">,</span>&nbsp;<span class="ident" id="5952030">height</span>&nbsp;<span class="builtintype" id="5952037">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952042">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5952056">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952061">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952075">color</span><span class="op" id="5952080">.</span><span class="ident" id="5952081">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952090">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5952104">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952109">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5952123">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952128">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5952142">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952150">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952164">[</span><span class="num" id="5952165">3</span>&nbsp;<span class="op" id="5952167">*</span>&nbsp;<span class="num" id="5952169">256</span><span class="op" id="5952172">]</span><span class="builtintype" id="5952173">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952179">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5952193">int</span><br>
<span class="lineno"></span><span class="op" id="5952197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5952200">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5952260">type</span>&nbsp;<span class="ident" id="5952265">FormatError</span>&nbsp;<span class="builtintype" id="5952277">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5952285">func</span>&nbsp;<span class="op" id="5952290">(</span><span class="ident" id="5952291">e</span>&nbsp;<span class="ident" id="5952293">FormatError</span><span class="op" id="5952304">)</span>&nbsp;<span class="ident" id="5952306">Error</span><span class="op" id="5952311">(</span><span class="op" id="5952312">)</span>&nbsp;<span class="builtintype" id="5952314">string</span>&nbsp;<span class="op" id="5952321">{</span>&nbsp;<span class="keyword" id="5952323">return</span>&nbsp;<span class="string" id="5952330">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5952354">+</span>&nbsp;<span class="builtintype" id="5952356">string</span><span class="op" id="5952362">(</span><span class="ident" id="5952363">e</span><span class="op" id="5952364">)</span>&nbsp;<span class="op" id="5952366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952369">var</span>&nbsp;<span class="ident" id="5952373">chunkOrderError</span>&nbsp;<span class="op" id="5952389">=</span>&nbsp;<span class="ident" id="5952391">FormatError</span><span class="op" id="5952402">(</span><span class="string" id="5952403">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5952423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5952426">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5952516">type</span>&nbsp;<span class="ident" id="5952521">UnsupportedError</span>&nbsp;<span class="builtintype" id="5952538">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952546">func</span>&nbsp;<span class="op" id="5952551">(</span><span class="ident" id="5952552">e</span>&nbsp;<span class="ident" id="5952554">UnsupportedError</span><span class="op" id="5952570">)</span>&nbsp;<span class="ident" id="5952572">Error</span><span class="op" id="5952577">(</span><span class="op" id="5952578">)</span>&nbsp;<span class="builtintype" id="5952580">string</span>&nbsp;<span class="op" id="5952587">{</span>&nbsp;<span class="keyword" id="5952589">return</span>&nbsp;<span class="string" id="5952596">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5952625">+</span>&nbsp;<span class="builtintype" id="5952627">string</span><span class="op" id="5952633">(</span><span class="ident" id="5952634">e</span><span class="op" id="5952635">)</span>&nbsp;<span class="op" id="5952637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5952640">func</span>&nbsp;<span class="ident" id="5952645">min</span><span class="op" id="5952648">(</span><span class="ident" id="5952649">a</span><span class="op" id="5952650">,</span>&nbsp;<span class="ident" id="5952652">b</span>&nbsp;<span class="builtintype" id="5952654">int</span><span class="op" id="5952657">)</span>&nbsp;<span class="builtintype" id="5952659">int</span>&nbsp;<span class="op" id="5952663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952666">if</span>&nbsp;<span class="ident" id="5952669">a</span>&nbsp;<span class="op" id="5952671">&lt;</span>&nbsp;<span class="ident" id="5952673">b</span>&nbsp;<span class="op" id="5952675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952679">return</span>&nbsp;<span class="ident" id="5952686">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952692">return</span>&nbsp;<span class="ident" id="5952699">b</span><br>
<span class="lineno">130</span><span class="op" id="5952701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952704">func</span>&nbsp;<span class="op" id="5952709">(</span><span class="ident" id="5952710">d</span>&nbsp;<span class="op" id="5952712">*</span><span class="ident" id="5952713">decoder</span><span class="op" id="5952720">)</span>&nbsp;<span class="ident" id="5952722">parseIHDR</span><span class="op" id="5952731">(</span><span class="ident" id="5952732">length</span>&nbsp;<span class="builtintype" id="5952739">uint32</span><span class="op" id="5952745">)</span>&nbsp;<span class="builtintype" id="5952747">error</span>&nbsp;<span class="op" id="5952753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952756">if</span>&nbsp;<span class="ident" id="5952759">length</span>&nbsp;<span class="op" id="5952766">!=</span>&nbsp;<span class="num" id="5952769">13</span>&nbsp;<span class="op" id="5952772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952776">return</span>&nbsp;<span class="ident" id="5952783">FormatError</span><span class="op" id="5952794">(</span><span class="string" id="5952795">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5952812">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952818">if</span>&nbsp;<span class="ident" id="5952821">_</span><span class="op" id="5952822">,</span>&nbsp;<span class="ident" id="5952824">err</span>&nbsp;<span class="op" id="5952828">:=</span>&nbsp;<span class="ident" id="5952831">io</span><span class="op" id="5952833">.</span><span class="ident" id="5952834">ReadFull</span><span class="op" id="5952842">(</span><span class="ident" id="5952843">d</span><span class="op" id="5952844">.</span><span class="ident" id="5952845">r</span><span class="op" id="5952846">,</span>&nbsp;<span class="ident" id="5952848">d</span><span class="op" id="5952849">.</span><span class="ident" id="5952850">tmp</span><span class="op" id="5952853">[</span><span class="op" id="5952854">:</span><span class="num" id="5952855">13</span><span class="op" id="5952857">]</span><span class="op" id="5952858">)</span><span class="op" id="5952859">;</span>&nbsp;<span class="ident" id="5952861">err</span>&nbsp;<span class="op" id="5952865">!=</span>&nbsp;<span class="ident" id="5952868">nil</span>&nbsp;<span class="op" id="5952872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952876">return</span>&nbsp;<span class="ident" id="5952883">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952891">d</span><span class="op" id="5952892">.</span><span class="ident" id="5952893">crc</span><span class="op" id="5952896">.</span><span class="ident" id="5952897">Write</span><span class="op" id="5952902">(</span><span class="ident" id="5952903">d</span><span class="op" id="5952904">.</span><span class="ident" id="5952905">tmp</span><span class="op" id="5952908">[</span><span class="op" id="5952909">:</span><span class="num" id="5952910">13</span><span class="op" id="5952912">]</span><span class="op" id="5952913">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952916">if</span>&nbsp;<span class="ident" id="5952919">d</span><span class="op" id="5952920">.</span><span class="ident" id="5952921">tmp</span><span class="op" id="5952924">[</span><span class="num" id="5952925">10</span><span class="op" id="5952927">]</span>&nbsp;<span class="op" id="5952929">!=</span>&nbsp;<span class="num" id="5952932">0</span>&nbsp;<span class="op" id="5952934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952938">return</span>&nbsp;<span class="ident" id="5952945">UnsupportedError</span><span class="op" id="5952961">(</span><span class="string" id="5952962">&#34;compression&nbsp;method&#34;</span><span class="op" id="5952982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952988">if</span>&nbsp;<span class="ident" id="5952991">d</span><span class="op" id="5952992">.</span><span class="ident" id="5952993">tmp</span><span class="op" id="5952996">[</span><span class="num" id="5952997">11</span><span class="op" id="5952999">]</span>&nbsp;<span class="op" id="5953001">!=</span>&nbsp;<span class="num" id="5953004">0</span>&nbsp;<span class="op" id="5953006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953010">return</span>&nbsp;<span class="ident" id="5953017">UnsupportedError</span><span class="op" id="5953033">(</span><span class="string" id="5953034">&#34;filter&nbsp;method&#34;</span><span class="op" id="5953049">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953055">if</span>&nbsp;<span class="ident" id="5953058">d</span><span class="op" id="5953059">.</span><span class="ident" id="5953060">tmp</span><span class="op" id="5953063">[</span><span class="num" id="5953064">12</span><span class="op" id="5953066">]</span>&nbsp;<span class="op" id="5953068">!=</span>&nbsp;<span class="ident" id="5953071">itNone</span>&nbsp;<span class="op" id="5953078">&amp;&amp;</span>&nbsp;<span class="ident" id="5953081">d</span><span class="op" id="5953082">.</span><span class="ident" id="5953083">tmp</span><span class="op" id="5953086">[</span><span class="num" id="5953087">12</span><span class="op" id="5953089">]</span>&nbsp;<span class="op" id="5953091">!=</span>&nbsp;<span class="ident" id="5953094">itAdam7</span>&nbsp;<span class="op" id="5953102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953106">return</span>&nbsp;<span class="ident" id="5953113">FormatError</span><span class="op" id="5953124">(</span><span class="string" id="5953125">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5953151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953157">d</span><span class="op" id="5953158">.</span><span class="ident" id="5953159">interlace</span>&nbsp;<span class="op" id="5953169">=</span>&nbsp;<span class="builtintype" id="5953171">int</span><span class="op" id="5953174">(</span><span class="ident" id="5953175">d</span><span class="op" id="5953176">.</span><span class="ident" id="5953177">tmp</span><span class="op" id="5953180">[</span><span class="num" id="5953181">12</span><span class="op" id="5953183">]</span><span class="op" id="5953184">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953187">w</span>&nbsp;<span class="op" id="5953189">:=</span>&nbsp;<span class="builtintype" id="5953192">int32</span><span class="op" id="5953197">(</span><span class="ident" id="5953198">binary</span><span class="op" id="5953204">.</span><span class="ident" id="5953205">BigEndian</span><span class="op" id="5953214">.</span><span class="ident" id="5953215">Uint32</span><span class="op" id="5953221">(</span><span class="ident" id="5953222">d</span><span class="op" id="5953223">.</span><span class="ident" id="5953224">tmp</span><span class="op" id="5953227">[</span><span class="num" id="5953228">0</span><span class="op" id="5953229">:</span><span class="num" id="5953230">4</span><span class="op" id="5953231">]</span><span class="op" id="5953232">)</span><span class="op" id="5953233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953236">h</span>&nbsp;<span class="op" id="5953238">:=</span>&nbsp;<span class="builtintype" id="5953241">int32</span><span class="op" id="5953246">(</span><span class="ident" id="5953247">binary</span><span class="op" id="5953253">.</span><span class="ident" id="5953254">BigEndian</span><span class="op" id="5953263">.</span><span class="ident" id="5953264">Uint32</span><span class="op" id="5953270">(</span><span class="ident" id="5953271">d</span><span class="op" id="5953272">.</span><span class="ident" id="5953273">tmp</span><span class="op" id="5953276">[</span><span class="num" id="5953277">4</span><span class="op" id="5953278">:</span><span class="num" id="5953279">8</span><span class="op" id="5953280">]</span><span class="op" id="5953281">)</span><span class="op" id="5953282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953285">if</span>&nbsp;<span class="ident" id="5953288">w</span>&nbsp;<span class="op" id="5953290">&lt;</span>&nbsp;<span class="num" id="5953292">0</span>&nbsp;<span class="op" id="5953294">||</span>&nbsp;<span class="ident" id="5953297">h</span>&nbsp;<span class="op" id="5953299">&lt;</span>&nbsp;<span class="num" id="5953301">0</span>&nbsp;<span class="op" id="5953303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953307">return</span>&nbsp;<span class="ident" id="5953314">FormatError</span><span class="op" id="5953325">(</span><span class="string" id="5953326">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5953346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953349">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953352">nPixels</span>&nbsp;<span class="op" id="5953360">:=</span>&nbsp;<span class="ident" id="5953363">int64</span><span class="op" id="5953368">(</span><span class="ident" id="5953369">w</span><span class="op" id="5953370">)</span>&nbsp;<span class="op" id="5953372">*</span>&nbsp;<span class="ident" id="5953374">int64</span><span class="op" id="5953379">(</span><span class="ident" id="5953380">h</span><span class="op" id="5953381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953384">if</span>&nbsp;<span class="ident" id="5953387">nPixels</span>&nbsp;<span class="op" id="5953395">!=</span>&nbsp;<span class="ident" id="5953398">int64</span><span class="op" id="5953403">(</span><span class="builtintype" id="5953404">int</span><span class="op" id="5953407">(</span><span class="ident" id="5953408">nPixels</span><span class="op" id="5953415">)</span><span class="op" id="5953416">)</span>&nbsp;<span class="op" id="5953418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953422">return</span>&nbsp;<span class="ident" id="5953429">UnsupportedError</span><span class="op" id="5953445">(</span><span class="string" id="5953446">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5953466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953472">d</span><span class="op" id="5953473">.</span><span class="ident" id="5953474">cb</span>&nbsp;<span class="op" id="5953477">=</span>&nbsp;<span class="ident" id="5953479">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953490">d</span><span class="op" id="5953491">.</span><span class="ident" id="5953492">depth</span>&nbsp;<span class="op" id="5953498">=</span>&nbsp;<span class="builtintype" id="5953500">int</span><span class="op" id="5953503">(</span><span class="ident" id="5953504">d</span><span class="op" id="5953505">.</span><span class="ident" id="5953506">tmp</span><span class="op" id="5953509">[</span><span class="num" id="5953510">8</span><span class="op" id="5953511">]</span><span class="op" id="5953512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953515">switch</span>&nbsp;<span class="ident" id="5953522">d</span><span class="op" id="5953523">.</span><span class="ident" id="5953524">depth</span>&nbsp;<span class="op" id="5953530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953533">case</span>&nbsp;<span class="num" id="5953538">1</span><span class="op" id="5953539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953543">switch</span>&nbsp;<span class="ident" id="5953550">d</span><span class="op" id="5953551">.</span><span class="ident" id="5953552">tmp</span><span class="op" id="5953555">[</span><span class="num" id="5953556">9</span><span class="op" id="5953557">]</span>&nbsp;<span class="op" id="5953559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953563">case</span>&nbsp;<span class="ident" id="5953568">ctGrayscale</span><span class="op" id="5953579">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953584">d</span><span class="op" id="5953585">.</span><span class="ident" id="5953586">cb</span>&nbsp;<span class="op" id="5953589">=</span>&nbsp;<span class="ident" id="5953591">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953598">case</span>&nbsp;<span class="ident" id="5953603">ctPaletted</span><span class="op" id="5953613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953618">d</span><span class="op" id="5953619">.</span><span class="ident" id="5953620">cb</span>&nbsp;<span class="op" id="5953623">=</span>&nbsp;<span class="ident" id="5953625">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953635">case</span>&nbsp;<span class="num" id="5953640">2</span><span class="op" id="5953641">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953645">switch</span>&nbsp;<span class="ident" id="5953652">d</span><span class="op" id="5953653">.</span><span class="ident" id="5953654">tmp</span><span class="op" id="5953657">[</span><span class="num" id="5953658">9</span><span class="op" id="5953659">]</span>&nbsp;<span class="op" id="5953661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953665">case</span>&nbsp;<span class="ident" id="5953670">ctGrayscale</span><span class="op" id="5953681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953686">d</span><span class="op" id="5953687">.</span><span class="ident" id="5953688">cb</span>&nbsp;<span class="op" id="5953691">=</span>&nbsp;<span class="ident" id="5953693">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953700">case</span>&nbsp;<span class="ident" id="5953705">ctPaletted</span><span class="op" id="5953715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953720">d</span><span class="op" id="5953721">.</span><span class="ident" id="5953722">cb</span>&nbsp;<span class="op" id="5953725">=</span>&nbsp;<span class="ident" id="5953727">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953737">case</span>&nbsp;<span class="num" id="5953742">4</span><span class="op" id="5953743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953747">switch</span>&nbsp;<span class="ident" id="5953754">d</span><span class="op" id="5953755">.</span><span class="ident" id="5953756">tmp</span><span class="op" id="5953759">[</span><span class="num" id="5953760">9</span><span class="op" id="5953761">]</span>&nbsp;<span class="op" id="5953763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953767">case</span>&nbsp;<span class="ident" id="5953772">ctGrayscale</span><span class="op" id="5953783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953788">d</span><span class="op" id="5953789">.</span><span class="ident" id="5953790">cb</span>&nbsp;<span class="op" id="5953793">=</span>&nbsp;<span class="ident" id="5953795">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953802">case</span>&nbsp;<span class="ident" id="5953807">ctPaletted</span><span class="op" id="5953817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953822">d</span><span class="op" id="5953823">.</span><span class="ident" id="5953824">cb</span>&nbsp;<span class="op" id="5953827">=</span>&nbsp;<span class="ident" id="5953829">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953839">case</span>&nbsp;<span class="num" id="5953844">8</span><span class="op" id="5953845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953849">switch</span>&nbsp;<span class="ident" id="5953856">d</span><span class="op" id="5953857">.</span><span class="ident" id="5953858">tmp</span><span class="op" id="5953861">[</span><span class="num" id="5953862">9</span><span class="op" id="5953863">]</span>&nbsp;<span class="op" id="5953865">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953869">case</span>&nbsp;<span class="ident" id="5953874">ctGrayscale</span><span class="op" id="5953885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953890">d</span><span class="op" id="5953891">.</span><span class="ident" id="5953892">cb</span>&nbsp;<span class="op" id="5953895">=</span>&nbsp;<span class="ident" id="5953897">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953904">case</span>&nbsp;<span class="ident" id="5953909">ctTrueColor</span><span class="op" id="5953920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953925">d</span><span class="op" id="5953926">.</span><span class="ident" id="5953927">cb</span>&nbsp;<span class="op" id="5953930">=</span>&nbsp;<span class="ident" id="5953932">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953940">case</span>&nbsp;<span class="ident" id="5953945">ctPaletted</span><span class="op" id="5953955">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953960">d</span><span class="op" id="5953961">.</span><span class="ident" id="5953962">cb</span>&nbsp;<span class="op" id="5953965">=</span>&nbsp;<span class="ident" id="5953967">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953974">case</span>&nbsp;<span class="ident" id="5953979">ctGrayscaleAlpha</span><span class="op" id="5953995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954000">d</span><span class="op" id="5954001">.</span><span class="ident" id="5954002">cb</span>&nbsp;<span class="op" id="5954005">=</span>&nbsp;<span class="ident" id="5954007">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954015">case</span>&nbsp;<span class="ident" id="5954020">ctTrueColorAlpha</span><span class="op" id="5954036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954041">d</span><span class="op" id="5954042">.</span><span class="ident" id="5954043">cb</span>&nbsp;<span class="op" id="5954046">=</span>&nbsp;<span class="ident" id="5954048">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954060">case</span>&nbsp;<span class="num" id="5954065">16</span><span class="op" id="5954067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954071">switch</span>&nbsp;<span class="ident" id="5954078">d</span><span class="op" id="5954079">.</span><span class="ident" id="5954080">tmp</span><span class="op" id="5954083">[</span><span class="num" id="5954084">9</span><span class="op" id="5954085">]</span>&nbsp;<span class="op" id="5954087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954091">case</span>&nbsp;<span class="ident" id="5954096">ctGrayscale</span><span class="op" id="5954107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954112">d</span><span class="op" id="5954113">.</span><span class="ident" id="5954114">cb</span>&nbsp;<span class="op" id="5954117">=</span>&nbsp;<span class="ident" id="5954119">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954127">case</span>&nbsp;<span class="ident" id="5954132">ctTrueColor</span><span class="op" id="5954143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954148">d</span><span class="op" id="5954149">.</span><span class="ident" id="5954150">cb</span>&nbsp;<span class="op" id="5954153">=</span>&nbsp;<span class="ident" id="5954155">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954164">case</span>&nbsp;<span class="ident" id="5954169">ctGrayscaleAlpha</span><span class="op" id="5954185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954190">d</span><span class="op" id="5954191">.</span><span class="ident" id="5954192">cb</span>&nbsp;<span class="op" id="5954195">=</span>&nbsp;<span class="ident" id="5954197">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954206">case</span>&nbsp;<span class="ident" id="5954211">ctTrueColorAlpha</span><span class="op" id="5954227">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954232">d</span><span class="op" id="5954233">.</span><span class="ident" id="5954234">cb</span>&nbsp;<span class="op" id="5954237">=</span>&nbsp;<span class="ident" id="5954239">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954255">if</span>&nbsp;<span class="ident" id="5954258">d</span><span class="op" id="5954259">.</span><span class="ident" id="5954260">cb</span>&nbsp;<span class="op" id="5954263">==</span>&nbsp;<span class="ident" id="5954266">cbInvalid</span>&nbsp;<span class="op" id="5954276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954280">return</span>&nbsp;<span class="ident" id="5954287">UnsupportedError</span><span class="op" id="5954303">(</span><span class="ident" id="5954304">fmt</span><span class="op" id="5954307">.</span><span class="ident" id="5954308">Sprintf</span><span class="op" id="5954315">(</span><span class="string" id="5954316">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5954345">,</span>&nbsp;<span class="ident" id="5954347">d</span><span class="op" id="5954348">.</span><span class="ident" id="5954349">tmp</span><span class="op" id="5954352">[</span><span class="num" id="5954353">8</span><span class="op" id="5954354">]</span><span class="op" id="5954355">,</span>&nbsp;<span class="ident" id="5954357">d</span><span class="op" id="5954358">.</span><span class="ident" id="5954359">tmp</span><span class="op" id="5954362">[</span><span class="num" id="5954363">9</span><span class="op" id="5954364">]</span><span class="op" id="5954365">)</span><span class="op" id="5954366">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954372">d</span><span class="op" id="5954373">.</span><span class="ident" id="5954374">width</span><span class="op" id="5954379">,</span>&nbsp;<span class="ident" id="5954381">d</span><span class="op" id="5954382">.</span><span class="ident" id="5954383">height</span>&nbsp;<span class="op" id="5954390">=</span>&nbsp;<span class="builtintype" id="5954392">int</span><span class="op" id="5954395">(</span><span class="ident" id="5954396">w</span><span class="op" id="5954397">)</span><span class="op" id="5954398">,</span>&nbsp;<span class="builtintype" id="5954400">int</span><span class="op" id="5954403">(</span><span class="ident" id="5954404">h</span><span class="op" id="5954405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954408">return</span>&nbsp;<span class="ident" id="5954415">d</span><span class="op" id="5954416">.</span><span class="ident" id="5954417">verifyChecksum</span><span class="op" id="5954431">(</span><span class="op" id="5954432">)</span><br>
<span class="lineno"></span><span class="op" id="5954434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5954437">func</span>&nbsp;<span class="op" id="5954442">(</span><span class="ident" id="5954443">d</span>&nbsp;<span class="op" id="5954445">*</span><span class="ident" id="5954446">decoder</span><span class="op" id="5954453">)</span>&nbsp;<span class="ident" id="5954455">parsePLTE</span><span class="op" id="5954464">(</span><span class="ident" id="5954465">length</span>&nbsp;<span class="builtintype" id="5954472">uint32</span><span class="op" id="5954478">)</span>&nbsp;<span class="builtintype" id="5954480">error</span>&nbsp;<span class="op" id="5954486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954489">np</span>&nbsp;<span class="op" id="5954492">:=</span>&nbsp;<span class="builtintype" id="5954495">int</span><span class="op" id="5954498">(</span><span class="ident" id="5954499">length</span>&nbsp;<span class="op" id="5954506">/</span>&nbsp;<span class="num" id="5954508">3</span><span class="op" id="5954509">)</span>&nbsp;<span class="comment" id="5954511">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954546">if</span>&nbsp;<span class="ident" id="5954549">length</span><span class="op" id="5954555">%</span><span class="num" id="5954556">3</span>&nbsp;<span class="op" id="5954558">!=</span>&nbsp;<span class="num" id="5954561">0</span>&nbsp;<span class="op" id="5954563">||</span>&nbsp;<span class="ident" id="5954566">np</span>&nbsp;<span class="op" id="5954569">&lt;=</span>&nbsp;<span class="num" id="5954572">0</span>&nbsp;<span class="op" id="5954574">||</span>&nbsp;<span class="ident" id="5954577">np</span>&nbsp;<span class="op" id="5954580">&gt;</span>&nbsp;<span class="num" id="5954582">256</span>&nbsp;<span class="op" id="5954586">||</span>&nbsp;<span class="ident" id="5954589">np</span>&nbsp;<span class="op" id="5954592">&gt;</span>&nbsp;<span class="num" id="5954594">1</span><span class="op" id="5954595">&lt;&lt;</span><span class="builtintype" id="5954597">uint</span><span class="op" id="5954601">(</span><span class="ident" id="5954602">d</span><span class="op" id="5954603">.</span><span class="ident" id="5954604">depth</span><span class="op" id="5954609">)</span>&nbsp;<span class="op" id="5954611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954615">return</span>&nbsp;<span class="ident" id="5954622">FormatError</span><span class="op" id="5954633">(</span><span class="string" id="5954634">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5954651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954654">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954657">n</span><span class="op" id="5954658">,</span>&nbsp;<span class="ident" id="5954660">err</span>&nbsp;<span class="op" id="5954664">:=</span>&nbsp;<span class="ident" id="5954667">io</span><span class="op" id="5954669">.</span><span class="ident" id="5954670">ReadFull</span><span class="op" id="5954678">(</span><span class="ident" id="5954679">d</span><span class="op" id="5954680">.</span><span class="ident" id="5954681">r</span><span class="op" id="5954682">,</span>&nbsp;<span class="ident" id="5954684">d</span><span class="op" id="5954685">.</span><span class="ident" id="5954686">tmp</span><span class="op" id="5954689">[</span><span class="op" id="5954690">:</span><span class="num" id="5954691">3</span><span class="op" id="5954692">*</span><span class="ident" id="5954693">np</span><span class="op" id="5954695">]</span><span class="op" id="5954696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954699">if</span>&nbsp;<span class="ident" id="5954702">err</span>&nbsp;<span class="op" id="5954706">!=</span>&nbsp;<span class="ident" id="5954709">nil</span>&nbsp;<span class="op" id="5954713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954717">return</span>&nbsp;<span class="ident" id="5954724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954732">d</span><span class="op" id="5954733">.</span><span class="ident" id="5954734">crc</span><span class="op" id="5954737">.</span><span class="ident" id="5954738">Write</span><span class="op" id="5954743">(</span><span class="ident" id="5954744">d</span><span class="op" id="5954745">.</span><span class="ident" id="5954746">tmp</span><span class="op" id="5954749">[</span><span class="op" id="5954750">:</span><span class="ident" id="5954751">n</span><span class="op" id="5954752">]</span><span class="op" id="5954753">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954756">switch</span>&nbsp;<span class="ident" id="5954763">d</span><span class="op" id="5954764">.</span><span class="ident" id="5954765">cb</span>&nbsp;<span class="op" id="5954768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954771">case</span>&nbsp;<span class="ident" id="5954776">cbP1</span><span class="op" id="5954780">,</span>&nbsp;<span class="ident" id="5954782">cbP2</span><span class="op" id="5954786">,</span>&nbsp;<span class="ident" id="5954788">cbP4</span><span class="op" id="5954792">,</span>&nbsp;<span class="ident" id="5954794">cbP8</span><span class="op" id="5954798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954802">d</span><span class="op" id="5954803">.</span><span class="ident" id="5954804">palette</span>&nbsp;<span class="op" id="5954812">=</span>&nbsp;<span class="builtinfunc" id="5954814">make</span><span class="op" id="5954818">(</span><span class="ident" id="5954819">color</span><span class="op" id="5954824">.</span><span class="ident" id="5954825">Palette</span><span class="op" id="5954832">,</span>&nbsp;<span class="num" id="5954834">256</span><span class="op" id="5954837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954841">for</span>&nbsp;<span class="ident" id="5954845">i</span>&nbsp;<span class="op" id="5954847">:=</span>&nbsp;<span class="num" id="5954850">0</span><span class="op" id="5954851">;</span>&nbsp;<span class="ident" id="5954853">i</span>&nbsp;<span class="op" id="5954855">&lt;</span>&nbsp;<span class="ident" id="5954857">np</span><span class="op" id="5954859">;</span>&nbsp;<span class="ident" id="5954861">i</span><span class="op" id="5954862">++</span>&nbsp;<span class="op" id="5954865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954870">d</span><span class="op" id="5954871">.</span><span class="ident" id="5954872">palette</span><span class="op" id="5954879">[</span><span class="ident" id="5954880">i</span><span class="op" id="5954881">]</span>&nbsp;<span class="op" id="5954883">=</span>&nbsp;<span class="ident" id="5954885">color</span><span class="op" id="5954890">.</span><span class="ident" id="5954891">RGBA</span><span class="op" id="5954895">{</span><span class="ident" id="5954896">d</span><span class="op" id="5954897">.</span><span class="ident" id="5954898">tmp</span><span class="op" id="5954901">[</span><span class="num" id="5954902">3</span><span class="op" id="5954903">*</span><span class="ident" id="5954904">i</span><span class="op" id="5954905">+</span><span class="num" id="5954906">0</span><span class="op" id="5954907">]</span><span class="op" id="5954908">,</span>&nbsp;<span class="ident" id="5954910">d</span><span class="op" id="5954911">.</span><span class="ident" id="5954912">tmp</span><span class="op" id="5954915">[</span><span class="num" id="5954916">3</span><span class="op" id="5954917">*</span><span class="ident" id="5954918">i</span><span class="op" id="5954919">+</span><span class="num" id="5954920">1</span><span class="op" id="5954921">]</span><span class="op" id="5954922">,</span>&nbsp;<span class="ident" id="5954924">d</span><span class="op" id="5954925">.</span><span class="ident" id="5954926">tmp</span><span class="op" id="5954929">[</span><span class="num" id="5954930">3</span><span class="op" id="5954931">*</span><span class="ident" id="5954932">i</span><span class="op" id="5954933">+</span><span class="num" id="5954934">2</span><span class="op" id="5954935">]</span><span class="op" id="5954936">,</span>&nbsp;<span class="num" id="5954938">0xff</span><span class="op" id="5954942">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954950">for</span>&nbsp;<span class="ident" id="5954954">i</span>&nbsp;<span class="op" id="5954956">:=</span>&nbsp;<span class="ident" id="5954959">np</span><span class="op" id="5954961">;</span>&nbsp;<span class="ident" id="5954963">i</span>&nbsp;<span class="op" id="5954965">&lt;</span>&nbsp;<span class="num" id="5954967">256</span><span class="op" id="5954970">;</span>&nbsp;<span class="ident" id="5954972">i</span><span class="op" id="5954973">++</span>&nbsp;<span class="op" id="5954976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954981">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955057">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955135">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955209">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955280">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955322">d</span><span class="op" id="5955323">.</span><span class="ident" id="5955324">palette</span><span class="op" id="5955331">[</span><span class="ident" id="5955332">i</span><span class="op" id="5955333">]</span>&nbsp;<span class="op" id="5955335">=</span>&nbsp;<span class="ident" id="5955337">color</span><span class="op" id="5955342">.</span><span class="ident" id="5955343">RGBA</span><span class="op" id="5955347">{</span><span class="num" id="5955348">0x00</span><span class="op" id="5955352">,</span>&nbsp;<span class="num" id="5955354">0x00</span><span class="op" id="5955358">,</span>&nbsp;<span class="num" id="5955360">0x00</span><span class="op" id="5955364">,</span>&nbsp;<span class="num" id="5955366">0xff</span><span class="op" id="5955370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955378">d</span><span class="op" id="5955379">.</span><span class="ident" id="5955380">palette</span>&nbsp;<span class="op" id="5955388">=</span>&nbsp;<span class="ident" id="5955390">d</span><span class="op" id="5955391">.</span><span class="ident" id="5955392">palette</span><span class="op" id="5955399">[</span><span class="op" id="5955400">:</span><span class="ident" id="5955401">np</span><span class="op" id="5955403">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955406">case</span>&nbsp;<span class="ident" id="5955411">cbTC8</span><span class="op" id="5955416">,</span>&nbsp;<span class="ident" id="5955418">cbTCA8</span><span class="op" id="5955424">,</span>&nbsp;<span class="ident" id="5955426">cbTC16</span><span class="op" id="5955432">,</span>&nbsp;<span class="ident" id="5955434">cbTCA16</span><span class="op" id="5955441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955445">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955525">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955610">default</span><span class="op" id="5955617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955621">return</span>&nbsp;<span class="ident" id="5955628">FormatError</span><span class="op" id="5955639">(</span><span class="string" id="5955640">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5955667">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955673">return</span>&nbsp;<span class="ident" id="5955680">d</span><span class="op" id="5955681">.</span><span class="ident" id="5955682">verifyChecksum</span><span class="op" id="5955696">(</span><span class="op" id="5955697">)</span><br>
<span class="lineno"></span><span class="op" id="5955699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5955702">func</span>&nbsp;<span class="op" id="5955707">(</span><span class="ident" id="5955708">d</span>&nbsp;<span class="op" id="5955710">*</span><span class="ident" id="5955711">decoder</span><span class="op" id="5955718">)</span>&nbsp;<span class="ident" id="5955720">parsetRNS</span><span class="op" id="5955729">(</span><span class="ident" id="5955730">length</span>&nbsp;<span class="builtintype" id="5955737">uint32</span><span class="op" id="5955743">)</span>&nbsp;<span class="builtintype" id="5955745">error</span>&nbsp;<span class="op" id="5955751">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955754">if</span>&nbsp;<span class="ident" id="5955757">length</span>&nbsp;<span class="op" id="5955764">&gt;</span>&nbsp;<span class="num" id="5955766">256</span>&nbsp;<span class="op" id="5955770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955774">return</span>&nbsp;<span class="ident" id="5955781">FormatError</span><span class="op" id="5955792">(</span><span class="string" id="5955793">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5955810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955816">n</span><span class="op" id="5955817">,</span>&nbsp;<span class="ident" id="5955819">err</span>&nbsp;<span class="op" id="5955823">:=</span>&nbsp;<span class="ident" id="5955826">io</span><span class="op" id="5955828">.</span><span class="ident" id="5955829">ReadFull</span><span class="op" id="5955837">(</span><span class="ident" id="5955838">d</span><span class="op" id="5955839">.</span><span class="ident" id="5955840">r</span><span class="op" id="5955841">,</span>&nbsp;<span class="ident" id="5955843">d</span><span class="op" id="5955844">.</span><span class="ident" id="5955845">tmp</span><span class="op" id="5955848">[</span><span class="op" id="5955849">:</span><span class="ident" id="5955850">length</span><span class="op" id="5955856">]</span><span class="op" id="5955857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955860">if</span>&nbsp;<span class="ident" id="5955863">err</span>&nbsp;<span class="op" id="5955867">!=</span>&nbsp;<span class="ident" id="5955870">nil</span>&nbsp;<span class="op" id="5955874">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955878">return</span>&nbsp;<span class="ident" id="5955885">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955893">d</span><span class="op" id="5955894">.</span><span class="ident" id="5955895">crc</span><span class="op" id="5955898">.</span><span class="ident" id="5955899">Write</span><span class="op" id="5955904">(</span><span class="ident" id="5955905">d</span><span class="op" id="5955906">.</span><span class="ident" id="5955907">tmp</span><span class="op" id="5955910">[</span><span class="op" id="5955911">:</span><span class="ident" id="5955912">n</span><span class="op" id="5955913">]</span><span class="op" id="5955914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955917">switch</span>&nbsp;<span class="ident" id="5955924">d</span><span class="op" id="5955925">.</span><span class="ident" id="5955926">cb</span>&nbsp;<span class="op" id="5955929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955932">case</span>&nbsp;<span class="ident" id="5955937">cbG8</span><span class="op" id="5955941">,</span>&nbsp;<span class="ident" id="5955943">cbG16</span><span class="op" id="5955948">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955952">return</span>&nbsp;<span class="ident" id="5955959">UnsupportedError</span><span class="op" id="5955975">(</span><span class="string" id="5955976">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5956000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956003">case</span>&nbsp;<span class="ident" id="5956008">cbTC8</span><span class="op" id="5956013">,</span>&nbsp;<span class="ident" id="5956015">cbTC16</span><span class="op" id="5956021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956025">return</span>&nbsp;<span class="ident" id="5956032">UnsupportedError</span><span class="op" id="5956048">(</span><span class="string" id="5956049">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5956073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956076">case</span>&nbsp;<span class="ident" id="5956081">cbP1</span><span class="op" id="5956085">,</span>&nbsp;<span class="ident" id="5956087">cbP2</span><span class="op" id="5956091">,</span>&nbsp;<span class="ident" id="5956093">cbP4</span><span class="op" id="5956097">,</span>&nbsp;<span class="ident" id="5956099">cbP8</span><span class="op" id="5956103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956107">if</span>&nbsp;<span class="builtinfunc" id="5956110">len</span><span class="op" id="5956113">(</span><span class="ident" id="5956114">d</span><span class="op" id="5956115">.</span><span class="ident" id="5956116">palette</span><span class="op" id="5956123">)</span>&nbsp;<span class="op" id="5956125">&lt;</span>&nbsp;<span class="ident" id="5956127">n</span>&nbsp;<span class="op" id="5956129">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956134">d</span><span class="op" id="5956135">.</span><span class="ident" id="5956136">palette</span>&nbsp;<span class="op" id="5956144">=</span>&nbsp;<span class="ident" id="5956146">d</span><span class="op" id="5956147">.</span><span class="ident" id="5956148">palette</span><span class="op" id="5956155">[</span><span class="op" id="5956156">:</span><span class="ident" id="5956157">n</span><span class="op" id="5956158">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956166">for</span>&nbsp;<span class="ident" id="5956170">i</span>&nbsp;<span class="op" id="5956172">:=</span>&nbsp;<span class="num" id="5956175">0</span><span class="op" id="5956176">;</span>&nbsp;<span class="ident" id="5956178">i</span>&nbsp;<span class="op" id="5956180">&lt;</span>&nbsp;<span class="ident" id="5956182">n</span><span class="op" id="5956183">;</span>&nbsp;<span class="ident" id="5956185">i</span><span class="op" id="5956186">++</span>&nbsp;<span class="op" id="5956189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956194">rgba</span>&nbsp;<span class="op" id="5956199">:=</span>&nbsp;<span class="ident" id="5956202">d</span><span class="op" id="5956203">.</span><span class="ident" id="5956204">palette</span><span class="op" id="5956211">[</span><span class="ident" id="5956212">i</span><span class="op" id="5956213">]</span><span class="op" id="5956214">.</span><span class="op" id="5956215">(</span><span class="ident" id="5956216">color</span><span class="op" id="5956221">.</span><span class="ident" id="5956222">RGBA</span><span class="op" id="5956226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956231">d</span><span class="op" id="5956232">.</span><span class="ident" id="5956233">palette</span><span class="op" id="5956240">[</span><span class="ident" id="5956241">i</span><span class="op" id="5956242">]</span>&nbsp;<span class="op" id="5956244">=</span>&nbsp;<span class="ident" id="5956246">color</span><span class="op" id="5956251">.</span><span class="ident" id="5956252">NRGBA</span><span class="op" id="5956257">{</span><span class="ident" id="5956258">rgba</span><span class="op" id="5956262">.</span><span class="ident" id="5956263">R</span><span class="op" id="5956264">,</span>&nbsp;<span class="ident" id="5956266">rgba</span><span class="op" id="5956270">.</span><span class="ident" id="5956271">G</span><span class="op" id="5956272">,</span>&nbsp;<span class="ident" id="5956274">rgba</span><span class="op" id="5956278">.</span><span class="ident" id="5956279">B</span><span class="op" id="5956280">,</span>&nbsp;<span class="ident" id="5956282">d</span><span class="op" id="5956283">.</span><span class="ident" id="5956284">tmp</span><span class="op" id="5956287">[</span><span class="ident" id="5956288">i</span><span class="op" id="5956289">]</span><span class="op" id="5956290">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956297">case</span>&nbsp;<span class="ident" id="5956302">cbGA8</span><span class="op" id="5956307">,</span>&nbsp;<span class="ident" id="5956309">cbGA16</span><span class="op" id="5956315">,</span>&nbsp;<span class="ident" id="5956317">cbTCA8</span><span class="op" id="5956323">,</span>&nbsp;<span class="ident" id="5956325">cbTCA16</span><span class="op" id="5956332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956336">return</span>&nbsp;<span class="ident" id="5956343">FormatError</span><span class="op" id="5956354">(</span><span class="string" id="5956355">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5956382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956388">return</span>&nbsp;<span class="ident" id="5956395">d</span><span class="op" id="5956396">.</span><span class="ident" id="5956397">verifyChecksum</span><span class="op" id="5956411">(</span><span class="op" id="5956412">)</span><br>
<span class="lineno">275</span><span class="op" id="5956414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956417">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5956494">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5956567">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5956628">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5956708">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5956788">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5956865">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5956920">func</span>&nbsp;<span class="op" id="5956925">(</span><span class="ident" id="5956926">d</span>&nbsp;<span class="op" id="5956928">*</span><span class="ident" id="5956929">decoder</span><span class="op" id="5956936">)</span>&nbsp;<span class="ident" id="5956938">Read</span><span class="op" id="5956942">(</span><span class="ident" id="5956943">p</span>&nbsp;<span class="op" id="5956945">[</span><span class="op" id="5956946">]</span><span class="builtintype" id="5956947">byte</span><span class="op" id="5956951">)</span>&nbsp;<span class="op" id="5956953">(</span><span class="builtintype" id="5956954">int</span><span class="op" id="5956957">,</span>&nbsp;<span class="builtintype" id="5956959">error</span><span class="op" id="5956964">)</span>&nbsp;<span class="op" id="5956966">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956969">if</span>&nbsp;<span class="builtinfunc" id="5956972">len</span><span class="op" id="5956975">(</span><span class="ident" id="5956976">p</span><span class="op" id="5956977">)</span>&nbsp;<span class="op" id="5956979">==</span>&nbsp;<span class="num" id="5956982">0</span>&nbsp;<span class="op" id="5956984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956988">return</span>&nbsp;<span class="num" id="5956995">0</span><span class="op" id="5956996">,</span>&nbsp;<span class="ident" id="5956998">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957006">for</span>&nbsp;<span class="ident" id="5957010">d</span><span class="op" id="5957011">.</span><span class="ident" id="5957012">idatLength</span>&nbsp;<span class="op" id="5957023">==</span>&nbsp;<span class="num" id="5957026">0</span>&nbsp;<span class="op" id="5957028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957032">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957105">if</span>&nbsp;<span class="ident" id="5957108">err</span>&nbsp;<span class="op" id="5957112">:=</span>&nbsp;<span class="ident" id="5957115">d</span><span class="op" id="5957116">.</span><span class="ident" id="5957117">verifyChecksum</span><span class="op" id="5957131">(</span><span class="op" id="5957132">)</span><span class="op" id="5957133">;</span>&nbsp;<span class="ident" id="5957135">err</span>&nbsp;<span class="op" id="5957139">!=</span>&nbsp;<span class="ident" id="5957142">nil</span>&nbsp;<span class="op" id="5957146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957151">return</span>&nbsp;<span class="num" id="5957158">0</span><span class="op" id="5957159">,</span>&nbsp;<span class="ident" id="5957161">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957171">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957241">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957267">if</span>&nbsp;<span class="ident" id="5957270">_</span><span class="op" id="5957271">,</span>&nbsp;<span class="ident" id="5957273">err</span>&nbsp;<span class="op" id="5957277">:=</span>&nbsp;<span class="ident" id="5957280">io</span><span class="op" id="5957282">.</span><span class="ident" id="5957283">ReadFull</span><span class="op" id="5957291">(</span><span class="ident" id="5957292">d</span><span class="op" id="5957293">.</span><span class="ident" id="5957294">r</span><span class="op" id="5957295">,</span>&nbsp;<span class="ident" id="5957297">d</span><span class="op" id="5957298">.</span><span class="ident" id="5957299">tmp</span><span class="op" id="5957302">[</span><span class="op" id="5957303">:</span><span class="num" id="5957304">8</span><span class="op" id="5957305">]</span><span class="op" id="5957306">)</span><span class="op" id="5957307">;</span>&nbsp;<span class="ident" id="5957309">err</span>&nbsp;<span class="op" id="5957313">!=</span>&nbsp;<span class="ident" id="5957316">nil</span>&nbsp;<span class="op" id="5957320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957325">return</span>&nbsp;<span class="num" id="5957332">0</span><span class="op" id="5957333">,</span>&nbsp;<span class="ident" id="5957335">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957345">d</span><span class="op" id="5957346">.</span><span class="ident" id="5957347">idatLength</span>&nbsp;<span class="op" id="5957358">=</span>&nbsp;<span class="ident" id="5957360">binary</span><span class="op" id="5957366">.</span><span class="ident" id="5957367">BigEndian</span><span class="op" id="5957376">.</span><span class="ident" id="5957377">Uint32</span><span class="op" id="5957383">(</span><span class="ident" id="5957384">d</span><span class="op" id="5957385">.</span><span class="ident" id="5957386">tmp</span><span class="op" id="5957389">[</span><span class="op" id="5957390">:</span><span class="num" id="5957391">4</span><span class="op" id="5957392">]</span><span class="op" id="5957393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957397">if</span>&nbsp;<span class="builtintype" id="5957400">string</span><span class="op" id="5957406">(</span><span class="ident" id="5957407">d</span><span class="op" id="5957408">.</span><span class="ident" id="5957409">tmp</span><span class="op" id="5957412">[</span><span class="num" id="5957413">4</span><span class="op" id="5957414">:</span><span class="num" id="5957415">8</span><span class="op" id="5957416">]</span><span class="op" id="5957417">)</span>&nbsp;<span class="op" id="5957419">!=</span>&nbsp;<span class="string" id="5957422">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5957429">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957434">return</span>&nbsp;<span class="num" id="5957441">0</span><span class="op" id="5957442">,</span>&nbsp;<span class="ident" id="5957444">FormatError</span><span class="op" id="5957455">(</span><span class="string" id="5957456">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5957479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957487">d</span><span class="op" id="5957488">.</span><span class="ident" id="5957489">crc</span><span class="op" id="5957492">.</span><span class="ident" id="5957493">Reset</span><span class="op" id="5957498">(</span><span class="op" id="5957499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957503">d</span><span class="op" id="5957504">.</span><span class="ident" id="5957505">crc</span><span class="op" id="5957508">.</span><span class="ident" id="5957509">Write</span><span class="op" id="5957514">(</span><span class="ident" id="5957515">d</span><span class="op" id="5957516">.</span><span class="ident" id="5957517">tmp</span><span class="op" id="5957520">[</span><span class="num" id="5957521">4</span><span class="op" id="5957522">:</span><span class="num" id="5957523">8</span><span class="op" id="5957524">]</span><span class="op" id="5957525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957528">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957531">if</span>&nbsp;<span class="builtintype" id="5957534">int</span><span class="op" id="5957537">(</span><span class="ident" id="5957538">d</span><span class="op" id="5957539">.</span><span class="ident" id="5957540">idatLength</span><span class="op" id="5957550">)</span>&nbsp;<span class="op" id="5957552">&lt;</span>&nbsp;<span class="num" id="5957554">0</span>&nbsp;<span class="op" id="5957556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957560">return</span>&nbsp;<span class="num" id="5957567">0</span><span class="op" id="5957568">,</span>&nbsp;<span class="ident" id="5957570">UnsupportedError</span><span class="op" id="5957586">(</span><span class="string" id="5957587">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5957615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957621">n</span><span class="op" id="5957622">,</span>&nbsp;<span class="ident" id="5957624">err</span>&nbsp;<span class="op" id="5957628">:=</span>&nbsp;<span class="ident" id="5957631">d</span><span class="op" id="5957632">.</span><span class="ident" id="5957633">r</span><span class="op" id="5957634">.</span><span class="ident" id="5957635">Read</span><span class="op" id="5957639">(</span><span class="ident" id="5957640">p</span><span class="op" id="5957641">[</span><span class="op" id="5957642">:</span><span class="ident" id="5957643">min</span><span class="op" id="5957646">(</span><span class="builtinfunc" id="5957647">len</span><span class="op" id="5957650">(</span><span class="ident" id="5957651">p</span><span class="op" id="5957652">)</span><span class="op" id="5957653">,</span>&nbsp;<span class="builtintype" id="5957655">int</span><span class="op" id="5957658">(</span><span class="ident" id="5957659">d</span><span class="op" id="5957660">.</span><span class="ident" id="5957661">idatLength</span><span class="op" id="5957671">)</span><span class="op" id="5957672">)</span><span class="op" id="5957673">]</span><span class="op" id="5957674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957677">d</span><span class="op" id="5957678">.</span><span class="ident" id="5957679">crc</span><span class="op" id="5957682">.</span><span class="ident" id="5957683">Write</span><span class="op" id="5957688">(</span><span class="ident" id="5957689">p</span><span class="op" id="5957690">[</span><span class="op" id="5957691">:</span><span class="ident" id="5957692">n</span><span class="op" id="5957693">]</span><span class="op" id="5957694">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957697">d</span><span class="op" id="5957698">.</span><span class="ident" id="5957699">idatLength</span>&nbsp;<span class="op" id="5957710">-=</span>&nbsp;<span class="builtintype" id="5957713">uint32</span><span class="op" id="5957719">(</span><span class="ident" id="5957720">n</span><span class="op" id="5957721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957724">return</span>&nbsp;<span class="ident" id="5957731">n</span><span class="op" id="5957732">,</span>&nbsp;<span class="ident" id="5957734">err</span><br>
<span class="lineno"></span><span class="op" id="5957738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5957741">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5957788">func</span>&nbsp;<span class="op" id="5957793">(</span><span class="ident" id="5957794">d</span>&nbsp;<span class="op" id="5957796">*</span><span class="ident" id="5957797">decoder</span><span class="op" id="5957804">)</span>&nbsp;<span class="ident" id="5957806">decode</span><span class="op" id="5957812">(</span><span class="op" id="5957813">)</span>&nbsp;<span class="op" id="5957815">(</span><span class="ident" id="5957816">image</span><span class="op" id="5957821">.</span><span class="ident" id="5957822">Image</span><span class="op" id="5957827">,</span>&nbsp;<span class="builtintype" id="5957829">error</span><span class="op" id="5957834">)</span>&nbsp;<span class="op" id="5957836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957839">r</span><span class="op" id="5957840">,</span>&nbsp;<span class="ident" id="5957842">err</span>&nbsp;<span class="op" id="5957846">:=</span>&nbsp;<span class="ident" id="5957849">zlib</span><span class="op" id="5957853">.</span><span class="ident" id="5957854">NewReader</span><span class="op" id="5957863">(</span><span class="ident" id="5957864">d</span><span class="op" id="5957865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957868">if</span>&nbsp;<span class="ident" id="5957871">err</span>&nbsp;<span class="op" id="5957875">!=</span>&nbsp;<span class="ident" id="5957878">nil</span>&nbsp;<span class="op" id="5957882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957886">return</span>&nbsp;<span class="ident" id="5957893">nil</span><span class="op" id="5957896">,</span>&nbsp;<span class="ident" id="5957898">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957903">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957906">defer</span>&nbsp;<span class="ident" id="5957912">r</span><span class="op" id="5957913">.</span><span class="ident" id="5957914">Close</span><span class="op" id="5957919">(</span><span class="op" id="5957920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957923">var</span>&nbsp;<span class="ident" id="5957927">img</span>&nbsp;<span class="ident" id="5957931">image</span><span class="op" id="5957936">.</span><span class="ident" id="5957937">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957944">if</span>&nbsp;<span class="ident" id="5957947">d</span><span class="op" id="5957948">.</span><span class="ident" id="5957949">interlace</span>&nbsp;<span class="op" id="5957959">==</span>&nbsp;<span class="ident" id="5957962">itNone</span>&nbsp;<span class="op" id="5957969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957973">img</span><span class="op" id="5957976">,</span>&nbsp;<span class="ident" id="5957978">err</span>&nbsp;<span class="op" id="5957982">=</span>&nbsp;<span class="ident" id="5957984">d</span><span class="op" id="5957985">.</span><span class="ident" id="5957986">readImagePass</span><span class="op" id="5957999">(</span><span class="ident" id="5958000">r</span><span class="op" id="5958001">,</span>&nbsp;<span class="num" id="5958003">0</span><span class="op" id="5958004">,</span>&nbsp;<span class="builtintype" id="5958006">false</span><span class="op" id="5958011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958014">}</span>&nbsp;<span class="keyword" id="5958016">else</span>&nbsp;<span class="keyword" id="5958021">if</span>&nbsp;<span class="ident" id="5958024">d</span><span class="op" id="5958025">.</span><span class="ident" id="5958026">interlace</span>&nbsp;<span class="op" id="5958036">==</span>&nbsp;<span class="ident" id="5958039">itAdam7</span>&nbsp;<span class="op" id="5958047">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958051">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958097">img</span><span class="op" id="5958100">,</span>&nbsp;<span class="ident" id="5958102">err</span>&nbsp;<span class="op" id="5958106">=</span>&nbsp;<span class="ident" id="5958108">d</span><span class="op" id="5958109">.</span><span class="ident" id="5958110">readImagePass</span><span class="op" id="5958123">(</span><span class="ident" id="5958124">nil</span><span class="op" id="5958127">,</span>&nbsp;<span class="num" id="5958129">0</span><span class="op" id="5958130">,</span>&nbsp;<span class="builtintype" id="5958132">true</span><span class="op" id="5958136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958140">for</span>&nbsp;<span class="ident" id="5958144">pass</span>&nbsp;<span class="op" id="5958149">:=</span>&nbsp;<span class="num" id="5958152">0</span><span class="op" id="5958153">;</span>&nbsp;<span class="ident" id="5958155">pass</span>&nbsp;<span class="op" id="5958160">&lt;</span>&nbsp;<span class="num" id="5958162">7</span><span class="op" id="5958163">;</span>&nbsp;<span class="ident" id="5958165">pass</span><span class="op" id="5958169">++</span>&nbsp;<span class="op" id="5958172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958177">imagePass</span><span class="op" id="5958186">,</span>&nbsp;<span class="ident" id="5958188">err</span>&nbsp;<span class="op" id="5958192">:=</span>&nbsp;<span class="ident" id="5958195">d</span><span class="op" id="5958196">.</span><span class="ident" id="5958197">readImagePass</span><span class="op" id="5958210">(</span><span class="ident" id="5958211">r</span><span class="op" id="5958212">,</span>&nbsp;<span class="ident" id="5958214">pass</span><span class="op" id="5958218">,</span>&nbsp;<span class="builtintype" id="5958220">false</span><span class="op" id="5958225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958230">if</span>&nbsp;<span class="ident" id="5958233">err</span>&nbsp;<span class="op" id="5958237">!=</span>&nbsp;<span class="ident" id="5958240">nil</span>&nbsp;<span class="op" id="5958244">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958250">return</span>&nbsp;<span class="ident" id="5958257">nil</span><span class="op" id="5958260">,</span>&nbsp;<span class="ident" id="5958262">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958274">d</span><span class="op" id="5958275">.</span><span class="ident" id="5958276">mergePassInto</span><span class="op" id="5958289">(</span><span class="ident" id="5958290">img</span><span class="op" id="5958293">,</span>&nbsp;<span class="ident" id="5958295">imagePass</span><span class="op" id="5958304">,</span>&nbsp;<span class="ident" id="5958306">pass</span><span class="op" id="5958310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958317">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958321">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958369">n</span>&nbsp;<span class="op" id="5958371">:=</span>&nbsp;<span class="num" id="5958374">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958377">for</span>&nbsp;<span class="ident" id="5958381">i</span>&nbsp;<span class="op" id="5958383">:=</span>&nbsp;<span class="num" id="5958386">0</span><span class="op" id="5958387">;</span>&nbsp;<span class="ident" id="5958389">n</span>&nbsp;<span class="op" id="5958391">==</span>&nbsp;<span class="num" id="5958394">0</span>&nbsp;<span class="op" id="5958396">&amp;&amp;</span>&nbsp;<span class="ident" id="5958399">err</span>&nbsp;<span class="op" id="5958403">==</span>&nbsp;<span class="ident" id="5958406">nil</span><span class="op" id="5958409">;</span>&nbsp;<span class="ident" id="5958411">i</span><span class="op" id="5958412">++</span>&nbsp;<span class="op" id="5958415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958419">if</span>&nbsp;<span class="ident" id="5958422">i</span>&nbsp;<span class="op" id="5958424">==</span>&nbsp;<span class="num" id="5958427">100</span>&nbsp;<span class="op" id="5958431">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958436">return</span>&nbsp;<span class="ident" id="5958443">nil</span><span class="op" id="5958446">,</span>&nbsp;<span class="ident" id="5958448">io</span><span class="op" id="5958450">.</span><span class="ident" id="5958451">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958471">n</span><span class="op" id="5958472">,</span>&nbsp;<span class="ident" id="5958474">err</span>&nbsp;<span class="op" id="5958478">=</span>&nbsp;<span class="ident" id="5958480">r</span><span class="op" id="5958481">.</span><span class="ident" id="5958482">Read</span><span class="op" id="5958486">(</span><span class="ident" id="5958487">d</span><span class="op" id="5958488">.</span><span class="ident" id="5958489">tmp</span><span class="op" id="5958492">[</span><span class="op" id="5958493">:</span><span class="num" id="5958494">1</span><span class="op" id="5958495">]</span><span class="op" id="5958496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958502">if</span>&nbsp;<span class="ident" id="5958505">err</span>&nbsp;<span class="op" id="5958509">!=</span>&nbsp;<span class="ident" id="5958512">nil</span>&nbsp;<span class="op" id="5958516">&amp;&amp;</span>&nbsp;<span class="ident" id="5958519">err</span>&nbsp;<span class="op" id="5958523">!=</span>&nbsp;<span class="ident" id="5958526">io</span><span class="op" id="5958528">.</span><span class="ident" id="5958529">EOF</span>&nbsp;<span class="op" id="5958533">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958537">return</span>&nbsp;<span class="ident" id="5958544">nil</span><span class="op" id="5958547">,</span>&nbsp;<span class="ident" id="5958549">FormatError</span><span class="op" id="5958560">(</span><span class="ident" id="5958561">err</span><span class="op" id="5958564">.</span><span class="ident" id="5958565">Error</span><span class="op" id="5958570">(</span><span class="op" id="5958571">)</span><span class="op" id="5958572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958578">if</span>&nbsp;<span class="ident" id="5958581">n</span>&nbsp;<span class="op" id="5958583">!=</span>&nbsp;<span class="num" id="5958586">0</span>&nbsp;<span class="op" id="5958588">||</span>&nbsp;<span class="ident" id="5958591">d</span><span class="op" id="5958592">.</span><span class="ident" id="5958593">idatLength</span>&nbsp;<span class="op" id="5958604">!=</span>&nbsp;<span class="num" id="5958607">0</span>&nbsp;<span class="op" id="5958609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958613">return</span>&nbsp;<span class="ident" id="5958620">nil</span><span class="op" id="5958623">,</span>&nbsp;<span class="ident" id="5958625">FormatError</span><span class="op" id="5958636">(</span><span class="string" id="5958637">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5958658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958661">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958665">return</span>&nbsp;<span class="ident" id="5958672">img</span><span class="op" id="5958675">,</span>&nbsp;<span class="ident" id="5958677">nil</span><br>
<span class="lineno"></span><span class="op" id="5958681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5958684">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5958764">func</span>&nbsp;<span class="op" id="5958769">(</span><span class="ident" id="5958770">d</span>&nbsp;<span class="op" id="5958772">*</span><span class="ident" id="5958773">decoder</span><span class="op" id="5958780">)</span>&nbsp;<span class="ident" id="5958782">readImagePass</span><span class="op" id="5958795">(</span><span class="ident" id="5958796">r</span>&nbsp;<span class="ident" id="5958798">io</span><span class="op" id="5958800">.</span><span class="ident" id="5958801">Reader</span><span class="op" id="5958807">,</span>&nbsp;<span class="ident" id="5958809">pass</span>&nbsp;<span class="builtintype" id="5958814">int</span><span class="op" id="5958817">,</span>&nbsp;<span class="ident" id="5958819">allocateOnly</span>&nbsp;<span class="builtintype" id="5958832">bool</span><span class="op" id="5958836">)</span>&nbsp;<span class="op" id="5958838">(</span><span class="ident" id="5958839">image</span><span class="op" id="5958844">.</span><span class="ident" id="5958845">Image</span><span class="op" id="5958850">,</span>&nbsp;<span class="builtintype" id="5958852">error</span><span class="op" id="5958857">)</span>&nbsp;<span class="op" id="5958859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958862">var</span>&nbsp;<span class="ident" id="5958866">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5958879">int</span>&nbsp;<span class="op" id="5958883">=</span>&nbsp;<span class="num" id="5958885">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958888">pixOffset</span>&nbsp;<span class="op" id="5958898">:=</span>&nbsp;<span class="num" id="5958901">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958904">var</span>&nbsp;<span class="op" id="5958908">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958912">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958921">*</span><span class="ident" id="5958922">image</span><span class="op" id="5958927">.</span><span class="ident" id="5958928">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958935">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958944">*</span><span class="ident" id="5958945">image</span><span class="op" id="5958950">.</span><span class="ident" id="5958951">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958958">paletted</span>&nbsp;<span class="op" id="5958967">*</span><span class="ident" id="5958968">image</span><span class="op" id="5958973">.</span><span class="ident" id="5958974">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958985">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958994">*</span><span class="ident" id="5958995">image</span><span class="op" id="5959000">.</span><span class="ident" id="5959001">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959009">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5959018">*</span><span class="ident" id="5959019">image</span><span class="op" id="5959024">.</span><span class="ident" id="5959025">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959034">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5959043">*</span><span class="ident" id="5959044">image</span><span class="op" id="5959049">.</span><span class="ident" id="5959050">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959059">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5959068">*</span><span class="ident" id="5959069">image</span><span class="op" id="5959074">.</span><span class="ident" id="5959075">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959085">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959094">image</span><span class="op" id="5959099">.</span><span class="ident" id="5959100">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959110">width</span><span class="op" id="5959115">,</span>&nbsp;<span class="ident" id="5959117">height</span>&nbsp;<span class="op" id="5959124">:=</span>&nbsp;<span class="ident" id="5959127">d</span><span class="op" id="5959128">.</span><span class="ident" id="5959129">width</span><span class="op" id="5959134">,</span>&nbsp;<span class="ident" id="5959136">d</span><span class="op" id="5959137">.</span><span class="ident" id="5959138">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959146">if</span>&nbsp;<span class="ident" id="5959149">d</span><span class="op" id="5959150">.</span><span class="ident" id="5959151">interlace</span>&nbsp;<span class="op" id="5959161">==</span>&nbsp;<span class="ident" id="5959164">itAdam7</span>&nbsp;<span class="op" id="5959172">&amp;&amp;</span>&nbsp;<span class="op" id="5959175">!</span><span class="ident" id="5959176">allocateOnly</span>&nbsp;<span class="op" id="5959189">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959193">p</span>&nbsp;<span class="op" id="5959195">:=</span>&nbsp;<span class="ident" id="5959198">interlacing</span><span class="op" id="5959209">[</span><span class="ident" id="5959210">pass</span><span class="op" id="5959214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959218">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959296">width</span>&nbsp;<span class="op" id="5959302">=</span>&nbsp;<span class="op" id="5959304">(</span><span class="ident" id="5959305">width</span>&nbsp;<span class="op" id="5959311">-</span>&nbsp;<span class="ident" id="5959313">p</span><span class="op" id="5959314">.</span><span class="ident" id="5959315">xOffset</span>&nbsp;<span class="op" id="5959323">+</span>&nbsp;<span class="ident" id="5959325">p</span><span class="op" id="5959326">.</span><span class="ident" id="5959327">xFactor</span>&nbsp;<span class="op" id="5959335">-</span>&nbsp;<span class="num" id="5959337">1</span><span class="op" id="5959338">)</span>&nbsp;<span class="op" id="5959340">/</span>&nbsp;<span class="ident" id="5959342">p</span><span class="op" id="5959343">.</span><span class="ident" id="5959344">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959354">height</span>&nbsp;<span class="op" id="5959361">=</span>&nbsp;<span class="op" id="5959363">(</span><span class="ident" id="5959364">height</span>&nbsp;<span class="op" id="5959371">-</span>&nbsp;<span class="ident" id="5959373">p</span><span class="op" id="5959374">.</span><span class="ident" id="5959375">yOffset</span>&nbsp;<span class="op" id="5959383">+</span>&nbsp;<span class="ident" id="5959385">p</span><span class="op" id="5959386">.</span><span class="ident" id="5959387">yFactor</span>&nbsp;<span class="op" id="5959395">-</span>&nbsp;<span class="num" id="5959397">1</span><span class="op" id="5959398">)</span>&nbsp;<span class="op" id="5959400">/</span>&nbsp;<span class="ident" id="5959402">p</span><span class="op" id="5959403">.</span><span class="ident" id="5959404">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959413">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959416">switch</span>&nbsp;<span class="ident" id="5959423">d</span><span class="op" id="5959424">.</span><span class="ident" id="5959425">cb</span>&nbsp;<span class="op" id="5959428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959431">case</span>&nbsp;<span class="ident" id="5959436">cbG1</span><span class="op" id="5959440">,</span>&nbsp;<span class="ident" id="5959442">cbG2</span><span class="op" id="5959446">,</span>&nbsp;<span class="ident" id="5959448">cbG4</span><span class="op" id="5959452">,</span>&nbsp;<span class="ident" id="5959454">cbG8</span><span class="op" id="5959458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959462">bitsPerPixel</span>&nbsp;<span class="op" id="5959475">=</span>&nbsp;<span class="ident" id="5959477">d</span><span class="op" id="5959478">.</span><span class="ident" id="5959479">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959487">gray</span>&nbsp;<span class="op" id="5959492">=</span>&nbsp;<span class="ident" id="5959494">image</span><span class="op" id="5959499">.</span><span class="ident" id="5959500">NewGray</span><span class="op" id="5959507">(</span><span class="ident" id="5959508">image</span><span class="op" id="5959513">.</span><span class="ident" id="5959514">Rect</span><span class="op" id="5959518">(</span><span class="num" id="5959519">0</span><span class="op" id="5959520">,</span>&nbsp;<span class="num" id="5959522">0</span><span class="op" id="5959523">,</span>&nbsp;<span class="ident" id="5959525">width</span><span class="op" id="5959530">,</span>&nbsp;<span class="ident" id="5959532">height</span><span class="op" id="5959538">)</span><span class="op" id="5959539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959543">img</span>&nbsp;<span class="op" id="5959547">=</span>&nbsp;<span class="ident" id="5959549">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959555">case</span>&nbsp;<span class="ident" id="5959560">cbGA8</span><span class="op" id="5959565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959569">bitsPerPixel</span>&nbsp;<span class="op" id="5959582">=</span>&nbsp;<span class="num" id="5959584">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959589">nrgba</span>&nbsp;<span class="op" id="5959595">=</span>&nbsp;<span class="ident" id="5959597">image</span><span class="op" id="5959602">.</span><span class="ident" id="5959603">NewNRGBA</span><span class="op" id="5959611">(</span><span class="ident" id="5959612">image</span><span class="op" id="5959617">.</span><span class="ident" id="5959618">Rect</span><span class="op" id="5959622">(</span><span class="num" id="5959623">0</span><span class="op" id="5959624">,</span>&nbsp;<span class="num" id="5959626">0</span><span class="op" id="5959627">,</span>&nbsp;<span class="ident" id="5959629">width</span><span class="op" id="5959634">,</span>&nbsp;<span class="ident" id="5959636">height</span><span class="op" id="5959642">)</span><span class="op" id="5959643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959647">img</span>&nbsp;<span class="op" id="5959651">=</span>&nbsp;<span class="ident" id="5959653">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959660">case</span>&nbsp;<span class="ident" id="5959665">cbTC8</span><span class="op" id="5959670">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959674">bitsPerPixel</span>&nbsp;<span class="op" id="5959687">=</span>&nbsp;<span class="num" id="5959689">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959694">rgba</span>&nbsp;<span class="op" id="5959699">=</span>&nbsp;<span class="ident" id="5959701">image</span><span class="op" id="5959706">.</span><span class="ident" id="5959707">NewRGBA</span><span class="op" id="5959714">(</span><span class="ident" id="5959715">image</span><span class="op" id="5959720">.</span><span class="ident" id="5959721">Rect</span><span class="op" id="5959725">(</span><span class="num" id="5959726">0</span><span class="op" id="5959727">,</span>&nbsp;<span class="num" id="5959729">0</span><span class="op" id="5959730">,</span>&nbsp;<span class="ident" id="5959732">width</span><span class="op" id="5959737">,</span>&nbsp;<span class="ident" id="5959739">height</span><span class="op" id="5959745">)</span><span class="op" id="5959746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959750">img</span>&nbsp;<span class="op" id="5959754">=</span>&nbsp;<span class="ident" id="5959756">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959762">case</span>&nbsp;<span class="ident" id="5959767">cbP1</span><span class="op" id="5959771">,</span>&nbsp;<span class="ident" id="5959773">cbP2</span><span class="op" id="5959777">,</span>&nbsp;<span class="ident" id="5959779">cbP4</span><span class="op" id="5959783">,</span>&nbsp;<span class="ident" id="5959785">cbP8</span><span class="op" id="5959789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959793">bitsPerPixel</span>&nbsp;<span class="op" id="5959806">=</span>&nbsp;<span class="ident" id="5959808">d</span><span class="op" id="5959809">.</span><span class="ident" id="5959810">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959818">paletted</span>&nbsp;<span class="op" id="5959827">=</span>&nbsp;<span class="ident" id="5959829">image</span><span class="op" id="5959834">.</span><span class="ident" id="5959835">NewPaletted</span><span class="op" id="5959846">(</span><span class="ident" id="5959847">image</span><span class="op" id="5959852">.</span><span class="ident" id="5959853">Rect</span><span class="op" id="5959857">(</span><span class="num" id="5959858">0</span><span class="op" id="5959859">,</span>&nbsp;<span class="num" id="5959861">0</span><span class="op" id="5959862">,</span>&nbsp;<span class="ident" id="5959864">width</span><span class="op" id="5959869">,</span>&nbsp;<span class="ident" id="5959871">height</span><span class="op" id="5959877">)</span><span class="op" id="5959878">,</span>&nbsp;<span class="ident" id="5959880">d</span><span class="op" id="5959881">.</span><span class="ident" id="5959882">palette</span><span class="op" id="5959889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959893">img</span>&nbsp;<span class="op" id="5959897">=</span>&nbsp;<span class="ident" id="5959899">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959909">case</span>&nbsp;<span class="ident" id="5959914">cbTCA8</span><span class="op" id="5959920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959924">bitsPerPixel</span>&nbsp;<span class="op" id="5959937">=</span>&nbsp;<span class="num" id="5959939">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959944">nrgba</span>&nbsp;<span class="op" id="5959950">=</span>&nbsp;<span class="ident" id="5959952">image</span><span class="op" id="5959957">.</span><span class="ident" id="5959958">NewNRGBA</span><span class="op" id="5959966">(</span><span class="ident" id="5959967">image</span><span class="op" id="5959972">.</span><span class="ident" id="5959973">Rect</span><span class="op" id="5959977">(</span><span class="num" id="5959978">0</span><span class="op" id="5959979">,</span>&nbsp;<span class="num" id="5959981">0</span><span class="op" id="5959982">,</span>&nbsp;<span class="ident" id="5959984">width</span><span class="op" id="5959989">,</span>&nbsp;<span class="ident" id="5959991">height</span><span class="op" id="5959997">)</span><span class="op" id="5959998">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960002">img</span>&nbsp;<span class="op" id="5960006">=</span>&nbsp;<span class="ident" id="5960008">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960015">case</span>&nbsp;<span class="ident" id="5960020">cbG16</span><span class="op" id="5960025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960029">bitsPerPixel</span>&nbsp;<span class="op" id="5960042">=</span>&nbsp;<span class="num" id="5960044">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960049">gray16</span>&nbsp;<span class="op" id="5960056">=</span>&nbsp;<span class="ident" id="5960058">image</span><span class="op" id="5960063">.</span><span class="ident" id="5960064">NewGray16</span><span class="op" id="5960073">(</span><span class="ident" id="5960074">image</span><span class="op" id="5960079">.</span><span class="ident" id="5960080">Rect</span><span class="op" id="5960084">(</span><span class="num" id="5960085">0</span><span class="op" id="5960086">,</span>&nbsp;<span class="num" id="5960088">0</span><span class="op" id="5960089">,</span>&nbsp;<span class="ident" id="5960091">width</span><span class="op" id="5960096">,</span>&nbsp;<span class="ident" id="5960098">height</span><span class="op" id="5960104">)</span><span class="op" id="5960105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960109">img</span>&nbsp;<span class="op" id="5960113">=</span>&nbsp;<span class="ident" id="5960115">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960123">case</span>&nbsp;<span class="ident" id="5960128">cbGA16</span><span class="op" id="5960134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960138">bitsPerPixel</span>&nbsp;<span class="op" id="5960151">=</span>&nbsp;<span class="num" id="5960153">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960158">nrgba64</span>&nbsp;<span class="op" id="5960166">=</span>&nbsp;<span class="ident" id="5960168">image</span><span class="op" id="5960173">.</span><span class="ident" id="5960174">NewNRGBA64</span><span class="op" id="5960184">(</span><span class="ident" id="5960185">image</span><span class="op" id="5960190">.</span><span class="ident" id="5960191">Rect</span><span class="op" id="5960195">(</span><span class="num" id="5960196">0</span><span class="op" id="5960197">,</span>&nbsp;<span class="num" id="5960199">0</span><span class="op" id="5960200">,</span>&nbsp;<span class="ident" id="5960202">width</span><span class="op" id="5960207">,</span>&nbsp;<span class="ident" id="5960209">height</span><span class="op" id="5960215">)</span><span class="op" id="5960216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960220">img</span>&nbsp;<span class="op" id="5960224">=</span>&nbsp;<span class="ident" id="5960226">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960235">case</span>&nbsp;<span class="ident" id="5960240">cbTC16</span><span class="op" id="5960246">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960250">bitsPerPixel</span>&nbsp;<span class="op" id="5960263">=</span>&nbsp;<span class="num" id="5960265">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960270">rgba64</span>&nbsp;<span class="op" id="5960277">=</span>&nbsp;<span class="ident" id="5960279">image</span><span class="op" id="5960284">.</span><span class="ident" id="5960285">NewRGBA64</span><span class="op" id="5960294">(</span><span class="ident" id="5960295">image</span><span class="op" id="5960300">.</span><span class="ident" id="5960301">Rect</span><span class="op" id="5960305">(</span><span class="num" id="5960306">0</span><span class="op" id="5960307">,</span>&nbsp;<span class="num" id="5960309">0</span><span class="op" id="5960310">,</span>&nbsp;<span class="ident" id="5960312">width</span><span class="op" id="5960317">,</span>&nbsp;<span class="ident" id="5960319">height</span><span class="op" id="5960325">)</span><span class="op" id="5960326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960330">img</span>&nbsp;<span class="op" id="5960334">=</span>&nbsp;<span class="ident" id="5960336">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960344">case</span>&nbsp;<span class="ident" id="5960349">cbTCA16</span><span class="op" id="5960356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960360">bitsPerPixel</span>&nbsp;<span class="op" id="5960373">=</span>&nbsp;<span class="num" id="5960375">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960380">nrgba64</span>&nbsp;<span class="op" id="5960388">=</span>&nbsp;<span class="ident" id="5960390">image</span><span class="op" id="5960395">.</span><span class="ident" id="5960396">NewNRGBA64</span><span class="op" id="5960406">(</span><span class="ident" id="5960407">image</span><span class="op" id="5960412">.</span><span class="ident" id="5960413">Rect</span><span class="op" id="5960417">(</span><span class="num" id="5960418">0</span><span class="op" id="5960419">,</span>&nbsp;<span class="num" id="5960421">0</span><span class="op" id="5960422">,</span>&nbsp;<span class="ident" id="5960424">width</span><span class="op" id="5960429">,</span>&nbsp;<span class="ident" id="5960431">height</span><span class="op" id="5960437">)</span><span class="op" id="5960438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960442">img</span>&nbsp;<span class="op" id="5960446">=</span>&nbsp;<span class="ident" id="5960448">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960460">if</span>&nbsp;<span class="ident" id="5960463">allocateOnly</span>&nbsp;<span class="op" id="5960476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960480">return</span>&nbsp;<span class="ident" id="5960487">img</span><span class="op" id="5960490">,</span>&nbsp;<span class="ident" id="5960492">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960500">bytesPerPixel</span>&nbsp;<span class="op" id="5960514">:=</span>&nbsp;<span class="op" id="5960517">(</span><span class="ident" id="5960518">bitsPerPixel</span>&nbsp;<span class="op" id="5960531">+</span>&nbsp;<span class="num" id="5960533">7</span><span class="op" id="5960534">)</span>&nbsp;<span class="op" id="5960536">/</span>&nbsp;<span class="num" id="5960538">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960542">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960604">rowSize</span>&nbsp;<span class="op" id="5960612">:=</span>&nbsp;<span class="num" id="5960615">1</span>&nbsp;<span class="op" id="5960617">+</span>&nbsp;<span class="op" id="5960619">(</span><span class="ident" id="5960620">bitsPerPixel</span><span class="op" id="5960632">*</span><span class="ident" id="5960633">width</span><span class="op" id="5960638">+</span><span class="num" id="5960639">7</span><span class="op" id="5960640">)</span><span class="op" id="5960641">/</span><span class="num" id="5960642">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960645">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960707">cr</span>&nbsp;<span class="op" id="5960710">:=</span>&nbsp;<span class="builtinfunc" id="5960713">make</span><span class="op" id="5960717">(</span><span class="op" id="5960718">[</span><span class="op" id="5960719">]</span><span class="builtintype" id="5960720">uint8</span><span class="op" id="5960725">,</span>&nbsp;<span class="ident" id="5960727">rowSize</span><span class="op" id="5960734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960737">pr</span>&nbsp;<span class="op" id="5960740">:=</span>&nbsp;<span class="builtinfunc" id="5960743">make</span><span class="op" id="5960747">(</span><span class="op" id="5960748">[</span><span class="op" id="5960749">]</span><span class="builtintype" id="5960750">uint8</span><span class="op" id="5960755">,</span>&nbsp;<span class="ident" id="5960757">rowSize</span><span class="op" id="5960764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960768">for</span>&nbsp;<span class="ident" id="5960772">y</span>&nbsp;<span class="op" id="5960774">:=</span>&nbsp;<span class="num" id="5960777">0</span><span class="op" id="5960778">;</span>&nbsp;<span class="ident" id="5960780">y</span>&nbsp;<span class="op" id="5960782">&lt;</span>&nbsp;<span class="ident" id="5960784">height</span><span class="op" id="5960790">;</span>&nbsp;<span class="ident" id="5960792">y</span><span class="op" id="5960793">++</span>&nbsp;<span class="op" id="5960796">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960800">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960834">_</span><span class="op" id="5960835">,</span>&nbsp;<span class="ident" id="5960837">err</span>&nbsp;<span class="op" id="5960841">:=</span>&nbsp;<span class="ident" id="5960844">io</span><span class="op" id="5960846">.</span><span class="ident" id="5960847">ReadFull</span><span class="op" id="5960855">(</span><span class="ident" id="5960856">r</span><span class="op" id="5960857">,</span>&nbsp;<span class="ident" id="5960859">cr</span><span class="op" id="5960861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960865">if</span>&nbsp;<span class="ident" id="5960868">err</span>&nbsp;<span class="op" id="5960872">!=</span>&nbsp;<span class="ident" id="5960875">nil</span>&nbsp;<span class="op" id="5960879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960884">return</span>&nbsp;<span class="ident" id="5960891">nil</span><span class="op" id="5960894">,</span>&nbsp;<span class="ident" id="5960896">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960902">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960907">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960930">cdat</span>&nbsp;<span class="op" id="5960935">:=</span>&nbsp;<span class="ident" id="5960938">cr</span><span class="op" id="5960940">[</span><span class="num" id="5960941">1</span><span class="op" id="5960942">:</span><span class="op" id="5960943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960947">pdat</span>&nbsp;<span class="op" id="5960952">:=</span>&nbsp;<span class="ident" id="5960955">pr</span><span class="op" id="5960957">[</span><span class="num" id="5960958">1</span><span class="op" id="5960959">:</span><span class="op" id="5960960">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960964">switch</span>&nbsp;<span class="ident" id="5960971">cr</span><span class="op" id="5960973">[</span><span class="num" id="5960974">0</span><span class="op" id="5960975">]</span>&nbsp;<span class="op" id="5960977">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960981">case</span>&nbsp;<span class="ident" id="5960986">ftNone</span><span class="op" id="5960992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960997">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961009">case</span>&nbsp;<span class="ident" id="5961014">ftSub</span><span class="op" id="5961019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961024">for</span>&nbsp;<span class="ident" id="5961028">i</span>&nbsp;<span class="op" id="5961030">:=</span>&nbsp;<span class="ident" id="5961033">bytesPerPixel</span><span class="op" id="5961046">;</span>&nbsp;<span class="ident" id="5961048">i</span>&nbsp;<span class="op" id="5961050">&lt;</span>&nbsp;<span class="builtinfunc" id="5961052">len</span><span class="op" id="5961055">(</span><span class="ident" id="5961056">cdat</span><span class="op" id="5961060">)</span><span class="op" id="5961061">;</span>&nbsp;<span class="ident" id="5961063">i</span><span class="op" id="5961064">++</span>&nbsp;<span class="op" id="5961067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961073">cdat</span><span class="op" id="5961077">[</span><span class="ident" id="5961078">i</span><span class="op" id="5961079">]</span>&nbsp;<span class="op" id="5961081">+=</span>&nbsp;<span class="ident" id="5961084">cdat</span><span class="op" id="5961088">[</span><span class="ident" id="5961089">i</span><span class="op" id="5961090">-</span><span class="ident" id="5961091">bytesPerPixel</span><span class="op" id="5961104">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961113">case</span>&nbsp;<span class="ident" id="5961118">ftUp</span><span class="op" id="5961122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961127">for</span>&nbsp;<span class="ident" id="5961131">i</span><span class="op" id="5961132">,</span>&nbsp;<span class="ident" id="5961134">p</span>&nbsp;<span class="op" id="5961136">:=</span>&nbsp;<span class="keyword" id="5961139">range</span>&nbsp;<span class="ident" id="5961145">pdat</span>&nbsp;<span class="op" id="5961150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961156">cdat</span><span class="op" id="5961160">[</span><span class="ident" id="5961161">i</span><span class="op" id="5961162">]</span>&nbsp;<span class="op" id="5961164">+=</span>&nbsp;<span class="ident" id="5961167">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961172">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961176">case</span>&nbsp;<span class="ident" id="5961181">ftAverage</span><span class="op" id="5961190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961195">for</span>&nbsp;<span class="ident" id="5961199">i</span>&nbsp;<span class="op" id="5961201">:=</span>&nbsp;<span class="num" id="5961204">0</span><span class="op" id="5961205">;</span>&nbsp;<span class="ident" id="5961207">i</span>&nbsp;<span class="op" id="5961209">&lt;</span>&nbsp;<span class="ident" id="5961211">bytesPerPixel</span><span class="op" id="5961224">;</span>&nbsp;<span class="ident" id="5961226">i</span><span class="op" id="5961227">++</span>&nbsp;<span class="op" id="5961230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961236">cdat</span><span class="op" id="5961240">[</span><span class="ident" id="5961241">i</span><span class="op" id="5961242">]</span>&nbsp;<span class="op" id="5961244">+=</span>&nbsp;<span class="ident" id="5961247">pdat</span><span class="op" id="5961251">[</span><span class="ident" id="5961252">i</span><span class="op" id="5961253">]</span>&nbsp;<span class="op" id="5961255">/</span>&nbsp;<span class="num" id="5961257">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961267">for</span>&nbsp;<span class="ident" id="5961271">i</span>&nbsp;<span class="op" id="5961273">:=</span>&nbsp;<span class="ident" id="5961276">bytesPerPixel</span><span class="op" id="5961289">;</span>&nbsp;<span class="ident" id="5961291">i</span>&nbsp;<span class="op" id="5961293">&lt;</span>&nbsp;<span class="builtinfunc" id="5961295">len</span><span class="op" id="5961298">(</span><span class="ident" id="5961299">cdat</span><span class="op" id="5961303">)</span><span class="op" id="5961304">;</span>&nbsp;<span class="ident" id="5961306">i</span><span class="op" id="5961307">++</span>&nbsp;<span class="op" id="5961310">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961316">cdat</span><span class="op" id="5961320">[</span><span class="ident" id="5961321">i</span><span class="op" id="5961322">]</span>&nbsp;<span class="op" id="5961324">+=</span>&nbsp;<span class="builtintype" id="5961327">uint8</span><span class="op" id="5961332">(</span><span class="op" id="5961333">(</span><span class="builtintype" id="5961334">int</span><span class="op" id="5961337">(</span><span class="ident" id="5961338">cdat</span><span class="op" id="5961342">[</span><span class="ident" id="5961343">i</span><span class="op" id="5961344">-</span><span class="ident" id="5961345">bytesPerPixel</span><span class="op" id="5961358">]</span><span class="op" id="5961359">)</span>&nbsp;<span class="op" id="5961361">+</span>&nbsp;<span class="builtintype" id="5961363">int</span><span class="op" id="5961366">(</span><span class="ident" id="5961367">pdat</span><span class="op" id="5961371">[</span><span class="ident" id="5961372">i</span><span class="op" id="5961373">]</span><span class="op" id="5961374">)</span><span class="op" id="5961375">)</span>&nbsp;<span class="op" id="5961377">/</span>&nbsp;<span class="num" id="5961379">2</span><span class="op" id="5961380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961389">case</span>&nbsp;<span class="ident" id="5961394">ftPaeth</span><span class="op" id="5961401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961406">filterPaeth</span><span class="op" id="5961417">(</span><span class="ident" id="5961418">cdat</span><span class="op" id="5961422">,</span>&nbsp;<span class="ident" id="5961424">pdat</span><span class="op" id="5961428">,</span>&nbsp;<span class="ident" id="5961430">bytesPerPixel</span><span class="op" id="5961443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961447">default</span><span class="op" id="5961454">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961459">return</span>&nbsp;<span class="ident" id="5961466">nil</span><span class="op" id="5961469">,</span>&nbsp;<span class="ident" id="5961471">FormatError</span><span class="op" id="5961482">(</span><span class="string" id="5961483">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5961500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961509">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961544">switch</span>&nbsp;<span class="ident" id="5961551">d</span><span class="op" id="5961552">.</span><span class="ident" id="5961553">cb</span>&nbsp;<span class="op" id="5961556">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961560">case</span>&nbsp;<span class="ident" id="5961565">cbG1</span><span class="op" id="5961569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961574">for</span>&nbsp;<span class="ident" id="5961578">x</span>&nbsp;<span class="op" id="5961580">:=</span>&nbsp;<span class="num" id="5961583">0</span><span class="op" id="5961584">;</span>&nbsp;<span class="ident" id="5961586">x</span>&nbsp;<span class="op" id="5961588">&lt;</span>&nbsp;<span class="ident" id="5961590">width</span><span class="op" id="5961595">;</span>&nbsp;<span class="ident" id="5961597">x</span>&nbsp;<span class="op" id="5961599">+=</span>&nbsp;<span class="num" id="5961602">8</span>&nbsp;<span class="op" id="5961604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961610">b</span>&nbsp;<span class="op" id="5961612">:=</span>&nbsp;<span class="ident" id="5961615">cdat</span><span class="op" id="5961619">[</span><span class="ident" id="5961620">x</span><span class="op" id="5961621">/</span><span class="num" id="5961622">8</span><span class="op" id="5961623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961629">for</span>&nbsp;<span class="ident" id="5961633">x2</span>&nbsp;<span class="op" id="5961636">:=</span>&nbsp;<span class="num" id="5961639">0</span><span class="op" id="5961640">;</span>&nbsp;<span class="ident" id="5961642">x2</span>&nbsp;<span class="op" id="5961645">&lt;</span>&nbsp;<span class="num" id="5961647">8</span>&nbsp;<span class="op" id="5961649">&amp;&amp;</span>&nbsp;<span class="ident" id="5961652">x</span><span class="op" id="5961653">+</span><span class="ident" id="5961654">x2</span>&nbsp;<span class="op" id="5961657">&lt;</span>&nbsp;<span class="ident" id="5961659">width</span><span class="op" id="5961664">;</span>&nbsp;<span class="ident" id="5961666">x2</span><span class="op" id="5961668">++</span>&nbsp;<span class="op" id="5961671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961678">gray</span><span class="op" id="5961682">.</span><span class="ident" id="5961683">SetGray</span><span class="op" id="5961690">(</span><span class="ident" id="5961691">x</span><span class="op" id="5961692">+</span><span class="ident" id="5961693">x2</span><span class="op" id="5961695">,</span>&nbsp;<span class="ident" id="5961697">y</span><span class="op" id="5961698">,</span>&nbsp;<span class="ident" id="5961700">color</span><span class="op" id="5961705">.</span><span class="ident" id="5961706">Gray</span><span class="op" id="5961710">{</span><span class="op" id="5961711">(</span><span class="ident" id="5961712">b</span>&nbsp;<span class="op" id="5961714">&gt;&gt;</span>&nbsp;<span class="num" id="5961717">7</span><span class="op" id="5961718">)</span>&nbsp;<span class="op" id="5961720">*</span>&nbsp;<span class="num" id="5961722">0xff</span><span class="op" id="5961726">}</span><span class="op" id="5961727">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961734">b</span>&nbsp;<span class="op" id="5961736">&lt;&lt;=</span>&nbsp;<span class="num" id="5961740">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961755">case</span>&nbsp;<span class="ident" id="5961760">cbG2</span><span class="op" id="5961764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961769">for</span>&nbsp;<span class="ident" id="5961773">x</span>&nbsp;<span class="op" id="5961775">:=</span>&nbsp;<span class="num" id="5961778">0</span><span class="op" id="5961779">;</span>&nbsp;<span class="ident" id="5961781">x</span>&nbsp;<span class="op" id="5961783">&lt;</span>&nbsp;<span class="ident" id="5961785">width</span><span class="op" id="5961790">;</span>&nbsp;<span class="ident" id="5961792">x</span>&nbsp;<span class="op" id="5961794">+=</span>&nbsp;<span class="num" id="5961797">4</span>&nbsp;<span class="op" id="5961799">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961805">b</span>&nbsp;<span class="op" id="5961807">:=</span>&nbsp;<span class="ident" id="5961810">cdat</span><span class="op" id="5961814">[</span><span class="ident" id="5961815">x</span><span class="op" id="5961816">/</span><span class="num" id="5961817">4</span><span class="op" id="5961818">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961824">for</span>&nbsp;<span class="ident" id="5961828">x2</span>&nbsp;<span class="op" id="5961831">:=</span>&nbsp;<span class="num" id="5961834">0</span><span class="op" id="5961835">;</span>&nbsp;<span class="ident" id="5961837">x2</span>&nbsp;<span class="op" id="5961840">&lt;</span>&nbsp;<span class="num" id="5961842">4</span>&nbsp;<span class="op" id="5961844">&amp;&amp;</span>&nbsp;<span class="ident" id="5961847">x</span><span class="op" id="5961848">+</span><span class="ident" id="5961849">x2</span>&nbsp;<span class="op" id="5961852">&lt;</span>&nbsp;<span class="ident" id="5961854">width</span><span class="op" id="5961859">;</span>&nbsp;<span class="ident" id="5961861">x2</span><span class="op" id="5961863">++</span>&nbsp;<span class="op" id="5961866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961873">gray</span><span class="op" id="5961877">.</span><span class="ident" id="5961878">SetGray</span><span class="op" id="5961885">(</span><span class="ident" id="5961886">x</span><span class="op" id="5961887">+</span><span class="ident" id="5961888">x2</span><span class="op" id="5961890">,</span>&nbsp;<span class="ident" id="5961892">y</span><span class="op" id="5961893">,</span>&nbsp;<span class="ident" id="5961895">color</span><span class="op" id="5961900">.</span><span class="ident" id="5961901">Gray</span><span class="op" id="5961905">{</span><span class="op" id="5961906">(</span><span class="ident" id="5961907">b</span>&nbsp;<span class="op" id="5961909">&gt;&gt;</span>&nbsp;<span class="num" id="5961912">6</span><span class="op" id="5961913">)</span>&nbsp;<span class="op" id="5961915">*</span>&nbsp;<span class="num" id="5961917">0x55</span><span class="op" id="5961921">}</span><span class="op" id="5961922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961929">b</span>&nbsp;<span class="op" id="5961931">&lt;&lt;=</span>&nbsp;<span class="num" id="5961935">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961941">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961950">case</span>&nbsp;<span class="ident" id="5961955">cbG4</span><span class="op" id="5961959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961964">for</span>&nbsp;<span class="ident" id="5961968">x</span>&nbsp;<span class="op" id="5961970">:=</span>&nbsp;<span class="num" id="5961973">0</span><span class="op" id="5961974">;</span>&nbsp;<span class="ident" id="5961976">x</span>&nbsp;<span class="op" id="5961978">&lt;</span>&nbsp;<span class="ident" id="5961980">width</span><span class="op" id="5961985">;</span>&nbsp;<span class="ident" id="5961987">x</span>&nbsp;<span class="op" id="5961989">+=</span>&nbsp;<span class="num" id="5961992">2</span>&nbsp;<span class="op" id="5961994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962000">b</span>&nbsp;<span class="op" id="5962002">:=</span>&nbsp;<span class="ident" id="5962005">cdat</span><span class="op" id="5962009">[</span><span class="ident" id="5962010">x</span><span class="op" id="5962011">/</span><span class="num" id="5962012">2</span><span class="op" id="5962013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962019">for</span>&nbsp;<span class="ident" id="5962023">x2</span>&nbsp;<span class="op" id="5962026">:=</span>&nbsp;<span class="num" id="5962029">0</span><span class="op" id="5962030">;</span>&nbsp;<span class="ident" id="5962032">x2</span>&nbsp;<span class="op" id="5962035">&lt;</span>&nbsp;<span class="num" id="5962037">2</span>&nbsp;<span class="op" id="5962039">&amp;&amp;</span>&nbsp;<span class="ident" id="5962042">x</span><span class="op" id="5962043">+</span><span class="ident" id="5962044">x2</span>&nbsp;<span class="op" id="5962047">&lt;</span>&nbsp;<span class="ident" id="5962049">width</span><span class="op" id="5962054">;</span>&nbsp;<span class="ident" id="5962056">x2</span><span class="op" id="5962058">++</span>&nbsp;<span class="op" id="5962061">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962068">gray</span><span class="op" id="5962072">.</span><span class="ident" id="5962073">SetGray</span><span class="op" id="5962080">(</span><span class="ident" id="5962081">x</span><span class="op" id="5962082">+</span><span class="ident" id="5962083">x2</span><span class="op" id="5962085">,</span>&nbsp;<span class="ident" id="5962087">y</span><span class="op" id="5962088">,</span>&nbsp;<span class="ident" id="5962090">color</span><span class="op" id="5962095">.</span><span class="ident" id="5962096">Gray</span><span class="op" id="5962100">{</span><span class="op" id="5962101">(</span><span class="ident" id="5962102">b</span>&nbsp;<span class="op" id="5962104">&gt;&gt;</span>&nbsp;<span class="num" id="5962107">4</span><span class="op" id="5962108">)</span>&nbsp;<span class="op" id="5962110">*</span>&nbsp;<span class="num" id="5962112">0x11</span><span class="op" id="5962116">}</span><span class="op" id="5962117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962124">b</span>&nbsp;<span class="op" id="5962126">&lt;&lt;=</span>&nbsp;<span class="num" id="5962130">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962145">case</span>&nbsp;<span class="ident" id="5962150">cbG8</span><span class="op" id="5962154">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5962159">copy</span><span class="op" id="5962163">(</span><span class="ident" id="5962164">gray</span><span class="op" id="5962168">.</span><span class="ident" id="5962169">Pix</span><span class="op" id="5962172">[</span><span class="ident" id="5962173">pixOffset</span><span class="op" id="5962182">:</span><span class="op" id="5962183">]</span><span class="op" id="5962184">,</span>&nbsp;<span class="ident" id="5962186">cdat</span><span class="op" id="5962190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962195">pixOffset</span>&nbsp;<span class="op" id="5962205">+=</span>&nbsp;<span class="ident" id="5962208">gray</span><span class="op" id="5962212">.</span><span class="ident" id="5962213">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962222">case</span>&nbsp;<span class="ident" id="5962227">cbGA8</span><span class="op" id="5962232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962237">for</span>&nbsp;<span class="ident" id="5962241">x</span>&nbsp;<span class="op" id="5962243">:=</span>&nbsp;<span class="num" id="5962246">0</span><span class="op" id="5962247">;</span>&nbsp;<span class="ident" id="5962249">x</span>&nbsp;<span class="op" id="5962251">&lt;</span>&nbsp;<span class="ident" id="5962253">width</span><span class="op" id="5962258">;</span>&nbsp;<span class="ident" id="5962260">x</span><span class="op" id="5962261">++</span>&nbsp;<span class="op" id="5962264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962270">ycol</span>&nbsp;<span class="op" id="5962275">:=</span>&nbsp;<span class="ident" id="5962278">cdat</span><span class="op" id="5962282">[</span><span class="num" id="5962283">2</span><span class="op" id="5962284">*</span><span class="ident" id="5962285">x</span><span class="op" id="5962286">+</span><span class="num" id="5962287">0</span><span class="op" id="5962288">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962294">nrgba</span><span class="op" id="5962299">.</span><span class="ident" id="5962300">SetNRGBA</span><span class="op" id="5962308">(</span><span class="ident" id="5962309">x</span><span class="op" id="5962310">,</span>&nbsp;<span class="ident" id="5962312">y</span><span class="op" id="5962313">,</span>&nbsp;<span class="ident" id="5962315">color</span><span class="op" id="5962320">.</span><span class="ident" id="5962321">NRGBA</span><span class="op" id="5962326">{</span><span class="ident" id="5962327">ycol</span><span class="op" id="5962331">,</span>&nbsp;<span class="ident" id="5962333">ycol</span><span class="op" id="5962337">,</span>&nbsp;<span class="ident" id="5962339">ycol</span><span class="op" id="5962343">,</span>&nbsp;<span class="ident" id="5962345">cdat</span><span class="op" id="5962349">[</span><span class="num" id="5962350">2</span><span class="op" id="5962351">*</span><span class="ident" id="5962352">x</span><span class="op" id="5962353">+</span><span class="num" id="5962354">1</span><span class="op" id="5962355">]</span><span class="op" id="5962356">}</span><span class="op" id="5962357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962366">case</span>&nbsp;<span class="ident" id="5962371">cbTC8</span><span class="op" id="5962376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962381">pix</span><span class="op" id="5962384">,</span>&nbsp;<span class="ident" id="5962386">i</span><span class="op" id="5962387">,</span>&nbsp;<span class="ident" id="5962389">j</span>&nbsp;<span class="op" id="5962391">:=</span>&nbsp;<span class="ident" id="5962394">rgba</span><span class="op" id="5962398">.</span><span class="ident" id="5962399">Pix</span><span class="op" id="5962402">,</span>&nbsp;<span class="ident" id="5962404">pixOffset</span><span class="op" id="5962413">,</span>&nbsp;<span class="num" id="5962415">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962420">for</span>&nbsp;<span class="ident" id="5962424">x</span>&nbsp;<span class="op" id="5962426">:=</span>&nbsp;<span class="num" id="5962429">0</span><span class="op" id="5962430">;</span>&nbsp;<span class="ident" id="5962432">x</span>&nbsp;<span class="op" id="5962434">&lt;</span>&nbsp;<span class="ident" id="5962436">width</span><span class="op" id="5962441">;</span>&nbsp;<span class="ident" id="5962443">x</span><span class="op" id="5962444">++</span>&nbsp;<span class="op" id="5962447">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962453">pix</span><span class="op" id="5962456">[</span><span class="ident" id="5962457">i</span><span class="op" id="5962458">+</span><span class="num" id="5962459">0</span><span class="op" id="5962460">]</span>&nbsp;<span class="op" id="5962462">=</span>&nbsp;<span class="ident" id="5962464">cdat</span><span class="op" id="5962468">[</span><span class="ident" id="5962469">j</span><span class="op" id="5962470">+</span><span class="num" id="5962471">0</span><span class="op" id="5962472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962478">pix</span><span class="op" id="5962481">[</span><span class="ident" id="5962482">i</span><span class="op" id="5962483">+</span><span class="num" id="5962484">1</span><span class="op" id="5962485">]</span>&nbsp;<span class="op" id="5962487">=</span>&nbsp;<span class="ident" id="5962489">cdat</span><span class="op" id="5962493">[</span><span class="ident" id="5962494">j</span><span class="op" id="5962495">+</span><span class="num" id="5962496">1</span><span class="op" id="5962497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962503">pix</span><span class="op" id="5962506">[</span><span class="ident" id="5962507">i</span><span class="op" id="5962508">+</span><span class="num" id="5962509">2</span><span class="op" id="5962510">]</span>&nbsp;<span class="op" id="5962512">=</span>&nbsp;<span class="ident" id="5962514">cdat</span><span class="op" id="5962518">[</span><span class="ident" id="5962519">j</span><span class="op" id="5962520">+</span><span class="num" id="5962521">2</span><span class="op" id="5962522">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962528">pix</span><span class="op" id="5962531">[</span><span class="ident" id="5962532">i</span><span class="op" id="5962533">+</span><span class="num" id="5962534">3</span><span class="op" id="5962535">]</span>&nbsp;<span class="op" id="5962537">=</span>&nbsp;<span class="num" id="5962539">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962548">i</span>&nbsp;<span class="op" id="5962550">+=</span>&nbsp;<span class="num" id="5962553">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962559">j</span>&nbsp;<span class="op" id="5962561">+=</span>&nbsp;<span class="num" id="5962564">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962574">pixOffset</span>&nbsp;<span class="op" id="5962584">+=</span>&nbsp;<span class="ident" id="5962587">rgba</span><span class="op" id="5962591">.</span><span class="ident" id="5962592">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962601">case</span>&nbsp;<span class="ident" id="5962606">cbP1</span><span class="op" id="5962610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962615">for</span>&nbsp;<span class="ident" id="5962619">x</span>&nbsp;<span class="op" id="5962621">:=</span>&nbsp;<span class="num" id="5962624">0</span><span class="op" id="5962625">;</span>&nbsp;<span class="ident" id="5962627">x</span>&nbsp;<span class="op" id="5962629">&lt;</span>&nbsp;<span class="ident" id="5962631">width</span><span class="op" id="5962636">;</span>&nbsp;<span class="ident" id="5962638">x</span>&nbsp;<span class="op" id="5962640">+=</span>&nbsp;<span class="num" id="5962643">8</span>&nbsp;<span class="op" id="5962645">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962651">b</span>&nbsp;<span class="op" id="5962653">:=</span>&nbsp;<span class="ident" id="5962656">cdat</span><span class="op" id="5962660">[</span><span class="ident" id="5962661">x</span><span class="op" id="5962662">/</span><span class="num" id="5962663">8</span><span class="op" id="5962664">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962670">for</span>&nbsp;<span class="ident" id="5962674">x2</span>&nbsp;<span class="op" id="5962677">:=</span>&nbsp;<span class="num" id="5962680">0</span><span class="op" id="5962681">;</span>&nbsp;<span class="ident" id="5962683">x2</span>&nbsp;<span class="op" id="5962686">&lt;</span>&nbsp;<span class="num" id="5962688">8</span>&nbsp;<span class="op" id="5962690">&amp;&amp;</span>&nbsp;<span class="ident" id="5962693">x</span><span class="op" id="5962694">+</span><span class="ident" id="5962695">x2</span>&nbsp;<span class="op" id="5962698">&lt;</span>&nbsp;<span class="ident" id="5962700">width</span><span class="op" id="5962705">;</span>&nbsp;<span class="ident" id="5962707">x2</span><span class="op" id="5962709">++</span>&nbsp;<span class="op" id="5962712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962719">idx</span>&nbsp;<span class="op" id="5962723">:=</span>&nbsp;<span class="ident" id="5962726">b</span>&nbsp;<span class="op" id="5962728">&gt;&gt;</span>&nbsp;<span class="num" id="5962731">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962738">if</span>&nbsp;<span class="builtinfunc" id="5962741">len</span><span class="op" id="5962744">(</span><span class="ident" id="5962745">paletted</span><span class="op" id="5962753">.</span><span class="ident" id="5962754">Palette</span><span class="op" id="5962761">)</span>&nbsp;<span class="op" id="5962763">&lt;=</span>&nbsp;<span class="builtintype" id="5962766">int</span><span class="op" id="5962769">(</span><span class="ident" id="5962770">idx</span><span class="op" id="5962773">)</span>&nbsp;<span class="op" id="5962775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962783">paletted</span><span class="op" id="5962791">.</span><span class="ident" id="5962792">Palette</span>&nbsp;<span class="op" id="5962800">=</span>&nbsp;<span class="ident" id="5962802">paletted</span><span class="op" id="5962810">.</span><span class="ident" id="5962811">Palette</span><span class="op" id="5962818">[</span><span class="op" id="5962819">:</span><span class="builtintype" id="5962820">int</span><span class="op" id="5962823">(</span><span class="ident" id="5962824">idx</span><span class="op" id="5962827">)</span><span class="op" id="5962828">+</span><span class="num" id="5962829">1</span><span class="op" id="5962830">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962844">paletted</span><span class="op" id="5962852">.</span><span class="ident" id="5962853">SetColorIndex</span><span class="op" id="5962866">(</span><span class="ident" id="5962867">x</span><span class="op" id="5962868">+</span><span class="ident" id="5962869">x2</span><span class="op" id="5962871">,</span>&nbsp;<span class="ident" id="5962873">y</span><span class="op" id="5962874">,</span>&nbsp;<span class="ident" id="5962876">idx</span><span class="op" id="5962879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962886">b</span>&nbsp;<span class="op" id="5962888">&lt;&lt;=</span>&nbsp;<span class="num" id="5962892">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962903">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962907">case</span>&nbsp;<span class="ident" id="5962912">cbP2</span><span class="op" id="5962916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962921">for</span>&nbsp;<span class="ident" id="5962925">x</span>&nbsp;<span class="op" id="5962927">:=</span>&nbsp;<span class="num" id="5962930">0</span><span class="op" id="5962931">;</span>&nbsp;<span class="ident" id="5962933">x</span>&nbsp;<span class="op" id="5962935">&lt;</span>&nbsp;<span class="ident" id="5962937">width</span><span class="op" id="5962942">;</span>&nbsp;<span class="ident" id="5962944">x</span>&nbsp;<span class="op" id="5962946">+=</span>&nbsp;<span class="num" id="5962949">4</span>&nbsp;<span class="op" id="5962951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962957">b</span>&nbsp;<span class="op" id="5962959">:=</span>&nbsp;<span class="ident" id="5962962">cdat</span><span class="op" id="5962966">[</span><span class="ident" id="5962967">x</span><span class="op" id="5962968">/</span><span class="num" id="5962969">4</span><span class="op" id="5962970">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962976">for</span>&nbsp;<span class="ident" id="5962980">x2</span>&nbsp;<span class="op" id="5962983">:=</span>&nbsp;<span class="num" id="5962986">0</span><span class="op" id="5962987">;</span>&nbsp;<span class="ident" id="5962989">x2</span>&nbsp;<span class="op" id="5962992">&lt;</span>&nbsp;<span class="num" id="5962994">4</span>&nbsp;<span class="op" id="5962996">&amp;&amp;</span>&nbsp;<span class="ident" id="5962999">x</span><span class="op" id="5963000">+</span><span class="ident" id="5963001">x2</span>&nbsp;<span class="op" id="5963004">&lt;</span>&nbsp;<span class="ident" id="5963006">width</span><span class="op" id="5963011">;</span>&nbsp;<span class="ident" id="5963013">x2</span><span class="op" id="5963015">++</span>&nbsp;<span class="op" id="5963018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963025">idx</span>&nbsp;<span class="op" id="5963029">:=</span>&nbsp;<span class="ident" id="5963032">b</span>&nbsp;<span class="op" id="5963034">&gt;&gt;</span>&nbsp;<span class="num" id="5963037">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963044">if</span>&nbsp;<span class="builtinfunc" id="5963047">len</span><span class="op" id="5963050">(</span><span class="ident" id="5963051">paletted</span><span class="op" id="5963059">.</span><span class="ident" id="5963060">Palette</span><span class="op" id="5963067">)</span>&nbsp;<span class="op" id="5963069">&lt;=</span>&nbsp;<span class="builtintype" id="5963072">int</span><span class="op" id="5963075">(</span><span class="ident" id="5963076">idx</span><span class="op" id="5963079">)</span>&nbsp;<span class="op" id="5963081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963089">paletted</span><span class="op" id="5963097">.</span><span class="ident" id="5963098">Palette</span>&nbsp;<span class="op" id="5963106">=</span>&nbsp;<span class="ident" id="5963108">paletted</span><span class="op" id="5963116">.</span><span class="ident" id="5963117">Palette</span><span class="op" id="5963124">[</span><span class="op" id="5963125">:</span><span class="builtintype" id="5963126">int</span><span class="op" id="5963129">(</span><span class="ident" id="5963130">idx</span><span class="op" id="5963133">)</span><span class="op" id="5963134">+</span><span class="num" id="5963135">1</span><span class="op" id="5963136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963150">paletted</span><span class="op" id="5963158">.</span><span class="ident" id="5963159">SetColorIndex</span><span class="op" id="5963172">(</span><span class="ident" id="5963173">x</span><span class="op" id="5963174">+</span><span class="ident" id="5963175">x2</span><span class="op" id="5963177">,</span>&nbsp;<span class="ident" id="5963179">y</span><span class="op" id="5963180">,</span>&nbsp;<span class="ident" id="5963182">idx</span><span class="op" id="5963185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963192">b</span>&nbsp;<span class="op" id="5963194">&lt;&lt;=</span>&nbsp;<span class="num" id="5963198">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963213">case</span>&nbsp;<span class="ident" id="5963218">cbP4</span><span class="op" id="5963222">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963227">for</span>&nbsp;<span class="ident" id="5963231">x</span>&nbsp;<span class="op" id="5963233">:=</span>&nbsp;<span class="num" id="5963236">0</span><span class="op" id="5963237">;</span>&nbsp;<span class="ident" id="5963239">x</span>&nbsp;<span class="op" id="5963241">&lt;</span>&nbsp;<span class="ident" id="5963243">width</span><span class="op" id="5963248">;</span>&nbsp;<span class="ident" id="5963250">x</span>&nbsp;<span class="op" id="5963252">+=</span>&nbsp;<span class="num" id="5963255">2</span>&nbsp;<span class="op" id="5963257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963263">b</span>&nbsp;<span class="op" id="5963265">:=</span>&nbsp;<span class="ident" id="5963268">cdat</span><span class="op" id="5963272">[</span><span class="ident" id="5963273">x</span><span class="op" id="5963274">/</span><span class="num" id="5963275">2</span><span class="op" id="5963276">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963282">for</span>&nbsp;<span class="ident" id="5963286">x2</span>&nbsp;<span class="op" id="5963289">:=</span>&nbsp;<span class="num" id="5963292">0</span><span class="op" id="5963293">;</span>&nbsp;<span class="ident" id="5963295">x2</span>&nbsp;<span class="op" id="5963298">&lt;</span>&nbsp;<span class="num" id="5963300">2</span>&nbsp;<span class="op" id="5963302">&amp;&amp;</span>&nbsp;<span class="ident" id="5963305">x</span><span class="op" id="5963306">+</span><span class="ident" id="5963307">x2</span>&nbsp;<span class="op" id="5963310">&lt;</span>&nbsp;<span class="ident" id="5963312">width</span><span class="op" id="5963317">;</span>&nbsp;<span class="ident" id="5963319">x2</span><span class="op" id="5963321">++</span>&nbsp;<span class="op" id="5963324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963331">idx</span>&nbsp;<span class="op" id="5963335">:=</span>&nbsp;<span class="ident" id="5963338">b</span>&nbsp;<span class="op" id="5963340">&gt;&gt;</span>&nbsp;<span class="num" id="5963343">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963350">if</span>&nbsp;<span class="builtinfunc" id="5963353">len</span><span class="op" id="5963356">(</span><span class="ident" id="5963357">paletted</span><span class="op" id="5963365">.</span><span class="ident" id="5963366">Palette</span><span class="op" id="5963373">)</span>&nbsp;<span class="op" id="5963375">&lt;=</span>&nbsp;<span class="builtintype" id="5963378">int</span><span class="op" id="5963381">(</span><span class="ident" id="5963382">idx</span><span class="op" id="5963385">)</span>&nbsp;<span class="op" id="5963387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963395">paletted</span><span class="op" id="5963403">.</span><span class="ident" id="5963404">Palette</span>&nbsp;<span class="op" id="5963412">=</span>&nbsp;<span class="ident" id="5963414">paletted</span><span class="op" id="5963422">.</span><span class="ident" id="5963423">Palette</span><span class="op" id="5963430">[</span><span class="op" id="5963431">:</span><span class="builtintype" id="5963432">int</span><span class="op" id="5963435">(</span><span class="ident" id="5963436">idx</span><span class="op" id="5963439">)</span><span class="op" id="5963440">+</span><span class="num" id="5963441">1</span><span class="op" id="5963442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963449">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963456">paletted</span><span class="op" id="5963464">.</span><span class="ident" id="5963465">SetColorIndex</span><span class="op" id="5963478">(</span><span class="ident" id="5963479">x</span><span class="op" id="5963480">+</span><span class="ident" id="5963481">x2</span><span class="op" id="5963483">,</span>&nbsp;<span class="ident" id="5963485">y</span><span class="op" id="5963486">,</span>&nbsp;<span class="ident" id="5963488">idx</span><span class="op" id="5963491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963498">b</span>&nbsp;<span class="op" id="5963500">&lt;&lt;=</span>&nbsp;<span class="num" id="5963504">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963519">case</span>&nbsp;<span class="ident" id="5963524">cbP8</span><span class="op" id="5963528">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963533">if</span>&nbsp;<span class="builtinfunc" id="5963536">len</span><span class="op" id="5963539">(</span><span class="ident" id="5963540">paletted</span><span class="op" id="5963548">.</span><span class="ident" id="5963549">Palette</span><span class="op" id="5963556">)</span>&nbsp;<span class="op" id="5963558">!=</span>&nbsp;<span class="num" id="5963561">255</span>&nbsp;<span class="op" id="5963565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963571">for</span>&nbsp;<span class="ident" id="5963575">x</span>&nbsp;<span class="op" id="5963577">:=</span>&nbsp;<span class="num" id="5963580">0</span><span class="op" id="5963581">;</span>&nbsp;<span class="ident" id="5963583">x</span>&nbsp;<span class="op" id="5963585">&lt;</span>&nbsp;<span class="ident" id="5963587">width</span><span class="op" id="5963592">;</span>&nbsp;<span class="ident" id="5963594">x</span><span class="op" id="5963595">++</span>&nbsp;<span class="op" id="5963598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963605">if</span>&nbsp;<span class="builtinfunc" id="5963608">len</span><span class="op" id="5963611">(</span><span class="ident" id="5963612">paletted</span><span class="op" id="5963620">.</span><span class="ident" id="5963621">Palette</span><span class="op" id="5963628">)</span>&nbsp;<span class="op" id="5963630">&lt;=</span>&nbsp;<span class="builtintype" id="5963633">int</span><span class="op" id="5963636">(</span><span class="ident" id="5963637">cdat</span><span class="op" id="5963641">[</span><span class="ident" id="5963642">x</span><span class="op" id="5963643">]</span><span class="op" id="5963644">)</span>&nbsp;<span class="op" id="5963646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963654">paletted</span><span class="op" id="5963662">.</span><span class="ident" id="5963663">Palette</span>&nbsp;<span class="op" id="5963671">=</span>&nbsp;<span class="ident" id="5963673">paletted</span><span class="op" id="5963681">.</span><span class="ident" id="5963682">Palette</span><span class="op" id="5963689">[</span><span class="op" id="5963690">:</span><span class="builtintype" id="5963691">int</span><span class="op" id="5963694">(</span><span class="ident" id="5963695">cdat</span><span class="op" id="5963699">[</span><span class="ident" id="5963700">x</span><span class="op" id="5963701">]</span><span class="op" id="5963702">)</span><span class="op" id="5963703">+</span><span class="num" id="5963704">1</span><span class="op" id="5963705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963712">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5963728">copy</span><span class="op" id="5963732">(</span><span class="ident" id="5963733">paletted</span><span class="op" id="5963741">.</span><span class="ident" id="5963742">Pix</span><span class="op" id="5963745">[</span><span class="ident" id="5963746">pixOffset</span><span class="op" id="5963755">:</span><span class="op" id="5963756">]</span><span class="op" id="5963757">,</span>&nbsp;<span class="ident" id="5963759">cdat</span><span class="op" id="5963763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963768">pixOffset</span>&nbsp;<span class="op" id="5963778">+=</span>&nbsp;<span class="ident" id="5963781">paletted</span><span class="op" id="5963789">.</span><span class="ident" id="5963790">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963799">case</span>&nbsp;<span class="ident" id="5963804">cbTCA8</span><span class="op" id="5963810">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5963815">copy</span><span class="op" id="5963819">(</span><span class="ident" id="5963820">nrgba</span><span class="op" id="5963825">.</span><span class="ident" id="5963826">Pix</span><span class="op" id="5963829">[</span><span class="ident" id="5963830">pixOffset</span><span class="op" id="5963839">:</span><span class="op" id="5963840">]</span><span class="op" id="5963841">,</span>&nbsp;<span class="ident" id="5963843">cdat</span><span class="op" id="5963847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963852">pixOffset</span>&nbsp;<span class="op" id="5963862">+=</span>&nbsp;<span class="ident" id="5963865">nrgba</span><span class="op" id="5963870">.</span><span class="ident" id="5963871">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963880">case</span>&nbsp;<span class="ident" id="5963885">cbG16</span><span class="op" id="5963890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963895">for</span>&nbsp;<span class="ident" id="5963899">x</span>&nbsp;<span class="op" id="5963901">:=</span>&nbsp;<span class="num" id="5963904">0</span><span class="op" id="5963905">;</span>&nbsp;<span class="ident" id="5963907">x</span>&nbsp;<span class="op" id="5963909">&lt;</span>&nbsp;<span class="ident" id="5963911">width</span><span class="op" id="5963916">;</span>&nbsp;<span class="ident" id="5963918">x</span><span class="op" id="5963919">++</span>&nbsp;<span class="op" id="5963922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963928">ycol</span>&nbsp;<span class="op" id="5963933">:=</span>&nbsp;<span class="builtintype" id="5963936">uint16</span><span class="op" id="5963942">(</span><span class="ident" id="5963943">cdat</span><span class="op" id="5963947">[</span><span class="num" id="5963948">2</span><span class="op" id="5963949">*</span><span class="ident" id="5963950">x</span><span class="op" id="5963951">+</span><span class="num" id="5963952">0</span><span class="op" id="5963953">]</span><span class="op" id="5963954">)</span><span class="op" id="5963955">&lt;&lt;</span><span class="num" id="5963957">8</span>&nbsp;<span class="op" id="5963959">|</span>&nbsp;<span class="builtintype" id="5963961">uint16</span><span class="op" id="5963967">(</span><span class="ident" id="5963968">cdat</span><span class="op" id="5963972">[</span><span class="num" id="5963973">2</span><span class="op" id="5963974">*</span><span class="ident" id="5963975">x</span><span class="op" id="5963976">+</span><span class="num" id="5963977">1</span><span class="op" id="5963978">]</span><span class="op" id="5963979">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963985">gray16</span><span class="op" id="5963991">.</span><span class="ident" id="5963992">SetGray16</span><span class="op" id="5964001">(</span><span class="ident" id="5964002">x</span><span class="op" id="5964003">,</span>&nbsp;<span class="ident" id="5964005">y</span><span class="op" id="5964006">,</span>&nbsp;<span class="ident" id="5964008">color</span><span class="op" id="5964013">.</span><span class="ident" id="5964014">Gray16</span><span class="op" id="5964020">{</span><span class="ident" id="5964021">ycol</span><span class="op" id="5964025">}</span><span class="op" id="5964026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964035">case</span>&nbsp;<span class="ident" id="5964040">cbGA16</span><span class="op" id="5964046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964051">for</span>&nbsp;<span class="ident" id="5964055">x</span>&nbsp;<span class="op" id="5964057">:=</span>&nbsp;<span class="num" id="5964060">0</span><span class="op" id="5964061">;</span>&nbsp;<span class="ident" id="5964063">x</span>&nbsp;<span class="op" id="5964065">&lt;</span>&nbsp;<span class="ident" id="5964067">width</span><span class="op" id="5964072">;</span>&nbsp;<span class="ident" id="5964074">x</span><span class="op" id="5964075">++</span>&nbsp;<span class="op" id="5964078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964084">ycol</span>&nbsp;<span class="op" id="5964089">:=</span>&nbsp;<span class="builtintype" id="5964092">uint16</span><span class="op" id="5964098">(</span><span class="ident" id="5964099">cdat</span><span class="op" id="5964103">[</span><span class="num" id="5964104">4</span><span class="op" id="5964105">*</span><span class="ident" id="5964106">x</span><span class="op" id="5964107">+</span><span class="num" id="5964108">0</span><span class="op" id="5964109">]</span><span class="op" id="5964110">)</span><span class="op" id="5964111">&lt;&lt;</span><span class="num" id="5964113">8</span>&nbsp;<span class="op" id="5964115">|</span>&nbsp;<span class="builtintype" id="5964117">uint16</span><span class="op" id="5964123">(</span><span class="ident" id="5964124">cdat</span><span class="op" id="5964128">[</span><span class="num" id="5964129">4</span><span class="op" id="5964130">*</span><span class="ident" id="5964131">x</span><span class="op" id="5964132">+</span><span class="num" id="5964133">1</span><span class="op" id="5964134">]</span><span class="op" id="5964135">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964141">acol</span>&nbsp;<span class="op" id="5964146">:=</span>&nbsp;<span class="builtintype" id="5964149">uint16</span><span class="op" id="5964155">(</span><span class="ident" id="5964156">cdat</span><span class="op" id="5964160">[</span><span class="num" id="5964161">4</span><span class="op" id="5964162">*</span><span class="ident" id="5964163">x</span><span class="op" id="5964164">+</span><span class="num" id="5964165">2</span><span class="op" id="5964166">]</span><span class="op" id="5964167">)</span><span class="op" id="5964168">&lt;&lt;</span><span class="num" id="5964170">8</span>&nbsp;<span class="op" id="5964172">|</span>&nbsp;<span class="builtintype" id="5964174">uint16</span><span class="op" id="5964180">(</span><span class="ident" id="5964181">cdat</span><span class="op" id="5964185">[</span><span class="num" id="5964186">4</span><span class="op" id="5964187">*</span><span class="ident" id="5964188">x</span><span class="op" id="5964189">+</span><span class="num" id="5964190">3</span><span class="op" id="5964191">]</span><span class="op" id="5964192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964198">nrgba64</span><span class="op" id="5964205">.</span><span class="ident" id="5964206">SetNRGBA64</span><span class="op" id="5964216">(</span><span class="ident" id="5964217">x</span><span class="op" id="5964218">,</span>&nbsp;<span class="ident" id="5964220">y</span><span class="op" id="5964221">,</span>&nbsp;<span class="ident" id="5964223">color</span><span class="op" id="5964228">.</span><span class="ident" id="5964229">NRGBA64</span><span class="op" id="5964236">{</span><span class="ident" id="5964237">ycol</span><span class="op" id="5964241">,</span>&nbsp;<span class="ident" id="5964243">ycol</span><span class="op" id="5964247">,</span>&nbsp;<span class="ident" id="5964249">ycol</span><span class="op" id="5964253">,</span>&nbsp;<span class="ident" id="5964255">acol</span><span class="op" id="5964259">}</span><span class="op" id="5964260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964269">case</span>&nbsp;<span class="ident" id="5964274">cbTC16</span><span class="op" id="5964280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964285">for</span>&nbsp;<span class="ident" id="5964289">x</span>&nbsp;<span class="op" id="5964291">:=</span>&nbsp;<span class="num" id="5964294">0</span><span class="op" id="5964295">;</span>&nbsp;<span class="ident" id="5964297">x</span>&nbsp;<span class="op" id="5964299">&lt;</span>&nbsp;<span class="ident" id="5964301">width</span><span class="op" id="5964306">;</span>&nbsp;<span class="ident" id="5964308">x</span><span class="op" id="5964309">++</span>&nbsp;<span class="op" id="5964312">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964318">rcol</span>&nbsp;<span class="op" id="5964323">:=</span>&nbsp;<span class="builtintype" id="5964326">uint16</span><span class="op" id="5964332">(</span><span class="ident" id="5964333">cdat</span><span class="op" id="5964337">[</span><span class="num" id="5964338">6</span><span class="op" id="5964339">*</span><span class="ident" id="5964340">x</span><span class="op" id="5964341">+</span><span class="num" id="5964342">0</span><span class="op" id="5964343">]</span><span class="op" id="5964344">)</span><span class="op" id="5964345">&lt;&lt;</span><span class="num" id="5964347">8</span>&nbsp;<span class="op" id="5964349">|</span>&nbsp;<span class="builtintype" id="5964351">uint16</span><span class="op" id="5964357">(</span><span class="ident" id="5964358">cdat</span><span class="op" id="5964362">[</span><span class="num" id="5964363">6</span><span class="op" id="5964364">*</span><span class="ident" id="5964365">x</span><span class="op" id="5964366">+</span><span class="num" id="5964367">1</span><span class="op" id="5964368">]</span><span class="op" id="5964369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964375">gcol</span>&nbsp;<span class="op" id="5964380">:=</span>&nbsp;<span class="builtintype" id="5964383">uint16</span><span class="op" id="5964389">(</span><span class="ident" id="5964390">cdat</span><span class="op" id="5964394">[</span><span class="num" id="5964395">6</span><span class="op" id="5964396">*</span><span class="ident" id="5964397">x</span><span class="op" id="5964398">+</span><span class="num" id="5964399">2</span><span class="op" id="5964400">]</span><span class="op" id="5964401">)</span><span class="op" id="5964402">&lt;&lt;</span><span class="num" id="5964404">8</span>&nbsp;<span class="op" id="5964406">|</span>&nbsp;<span class="builtintype" id="5964408">uint16</span><span class="op" id="5964414">(</span><span class="ident" id="5964415">cdat</span><span class="op" id="5964419">[</span><span class="num" id="5964420">6</span><span class="op" id="5964421">*</span><span class="ident" id="5964422">x</span><span class="op" id="5964423">+</span><span class="num" id="5964424">3</span><span class="op" id="5964425">]</span><span class="op" id="5964426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964432">bcol</span>&nbsp;<span class="op" id="5964437">:=</span>&nbsp;<span class="builtintype" id="5964440">uint16</span><span class="op" id="5964446">(</span><span class="ident" id="5964447">cdat</span><span class="op" id="5964451">[</span><span class="num" id="5964452">6</span><span class="op" id="5964453">*</span><span class="ident" id="5964454">x</span><span class="op" id="5964455">+</span><span class="num" id="5964456">4</span><span class="op" id="5964457">]</span><span class="op" id="5964458">)</span><span class="op" id="5964459">&lt;&lt;</span><span class="num" id="5964461">8</span>&nbsp;<span class="op" id="5964463">|</span>&nbsp;<span class="builtintype" id="5964465">uint16</span><span class="op" id="5964471">(</span><span class="ident" id="5964472">cdat</span><span class="op" id="5964476">[</span><span class="num" id="5964477">6</span><span class="op" id="5964478">*</span><span class="ident" id="5964479">x</span><span class="op" id="5964480">+</span><span class="num" id="5964481">5</span><span class="op" id="5964482">]</span><span class="op" id="5964483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964489">rgba64</span><span class="op" id="5964495">.</span><span class="ident" id="5964496">SetRGBA64</span><span class="op" id="5964505">(</span><span class="ident" id="5964506">x</span><span class="op" id="5964507">,</span>&nbsp;<span class="ident" id="5964509">y</span><span class="op" id="5964510">,</span>&nbsp;<span class="ident" id="5964512">color</span><span class="op" id="5964517">.</span><span class="ident" id="5964518">RGBA64</span><span class="op" id="5964524">{</span><span class="ident" id="5964525">rcol</span><span class="op" id="5964529">,</span>&nbsp;<span class="ident" id="5964531">gcol</span><span class="op" id="5964535">,</span>&nbsp;<span class="ident" id="5964537">bcol</span><span class="op" id="5964541">,</span>&nbsp;<span class="num" id="5964543">0xffff</span><span class="op" id="5964549">}</span><span class="op" id="5964550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964555">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964559">case</span>&nbsp;<span class="ident" id="5964564">cbTCA16</span><span class="op" id="5964571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964576">for</span>&nbsp;<span class="ident" id="5964580">x</span>&nbsp;<span class="op" id="5964582">:=</span>&nbsp;<span class="num" id="5964585">0</span><span class="op" id="5964586">;</span>&nbsp;<span class="ident" id="5964588">x</span>&nbsp;<span class="op" id="5964590">&lt;</span>&nbsp;<span class="ident" id="5964592">width</span><span class="op" id="5964597">;</span>&nbsp;<span class="ident" id="5964599">x</span><span class="op" id="5964600">++</span>&nbsp;<span class="op" id="5964603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964609">rcol</span>&nbsp;<span class="op" id="5964614">:=</span>&nbsp;<span class="builtintype" id="5964617">uint16</span><span class="op" id="5964623">(</span><span class="ident" id="5964624">cdat</span><span class="op" id="5964628">[</span><span class="num" id="5964629">8</span><span class="op" id="5964630">*</span><span class="ident" id="5964631">x</span><span class="op" id="5964632">+</span><span class="num" id="5964633">0</span><span class="op" id="5964634">]</span><span class="op" id="5964635">)</span><span class="op" id="5964636">&lt;&lt;</span><span class="num" id="5964638">8</span>&nbsp;<span class="op" id="5964640">|</span>&nbsp;<span class="builtintype" id="5964642">uint16</span><span class="op" id="5964648">(</span><span class="ident" id="5964649">cdat</span><span class="op" id="5964653">[</span><span class="num" id="5964654">8</span><span class="op" id="5964655">*</span><span class="ident" id="5964656">x</span><span class="op" id="5964657">+</span><span class="num" id="5964658">1</span><span class="op" id="5964659">]</span><span class="op" id="5964660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964666">gcol</span>&nbsp;<span class="op" id="5964671">:=</span>&nbsp;<span class="builtintype" id="5964674">uint16</span><span class="op" id="5964680">(</span><span class="ident" id="5964681">cdat</span><span class="op" id="5964685">[</span><span class="num" id="5964686">8</span><span class="op" id="5964687">*</span><span class="ident" id="5964688">x</span><span class="op" id="5964689">+</span><span class="num" id="5964690">2</span><span class="op" id="5964691">]</span><span class="op" id="5964692">)</span><span class="op" id="5964693">&lt;&lt;</span><span class="num" id="5964695">8</span>&nbsp;<span class="op" id="5964697">|</span>&nbsp;<span class="builtintype" id="5964699">uint16</span><span class="op" id="5964705">(</span><span class="ident" id="5964706">cdat</span><span class="op" id="5964710">[</span><span class="num" id="5964711">8</span><span class="op" id="5964712">*</span><span class="ident" id="5964713">x</span><span class="op" id="5964714">+</span><span class="num" id="5964715">3</span><span class="op" id="5964716">]</span><span class="op" id="5964717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964723">bcol</span>&nbsp;<span class="op" id="5964728">:=</span>&nbsp;<span class="builtintype" id="5964731">uint16</span><span class="op" id="5964737">(</span><span class="ident" id="5964738">cdat</span><span class="op" id="5964742">[</span><span class="num" id="5964743">8</span><span class="op" id="5964744">*</span><span class="ident" id="5964745">x</span><span class="op" id="5964746">+</span><span class="num" id="5964747">4</span><span class="op" id="5964748">]</span><span class="op" id="5964749">)</span><span class="op" id="5964750">&lt;&lt;</span><span class="num" id="5964752">8</span>&nbsp;<span class="op" id="5964754">|</span>&nbsp;<span class="builtintype" id="5964756">uint16</span><span class="op" id="5964762">(</span><span class="ident" id="5964763">cdat</span><span class="op" id="5964767">[</span><span class="num" id="5964768">8</span><span class="op" id="5964769">*</span><span class="ident" id="5964770">x</span><span class="op" id="5964771">+</span><span class="num" id="5964772">5</span><span class="op" id="5964773">]</span><span class="op" id="5964774">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964780">acol</span>&nbsp;<span class="op" id="5964785">:=</span>&nbsp;<span class="builtintype" id="5964788">uint16</span><span class="op" id="5964794">(</span><span class="ident" id="5964795">cdat</span><span class="op" id="5964799">[</span><span class="num" id="5964800">8</span><span class="op" id="5964801">*</span><span class="ident" id="5964802">x</span><span class="op" id="5964803">+</span><span class="num" id="5964804">6</span><span class="op" id="5964805">]</span><span class="op" id="5964806">)</span><span class="op" id="5964807">&lt;&lt;</span><span class="num" id="5964809">8</span>&nbsp;<span class="op" id="5964811">|</span>&nbsp;<span class="builtintype" id="5964813">uint16</span><span class="op" id="5964819">(</span><span class="ident" id="5964820">cdat</span><span class="op" id="5964824">[</span><span class="num" id="5964825">8</span><span class="op" id="5964826">*</span><span class="ident" id="5964827">x</span><span class="op" id="5964828">+</span><span class="num" id="5964829">7</span><span class="op" id="5964830">]</span><span class="op" id="5964831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964837">nrgba64</span><span class="op" id="5964844">.</span><span class="ident" id="5964845">SetNRGBA64</span><span class="op" id="5964855">(</span><span class="ident" id="5964856">x</span><span class="op" id="5964857">,</span>&nbsp;<span class="ident" id="5964859">y</span><span class="op" id="5964860">,</span>&nbsp;<span class="ident" id="5964862">color</span><span class="op" id="5964867">.</span><span class="ident" id="5964868">NRGBA64</span><span class="op" id="5964875">{</span><span class="ident" id="5964876">rcol</span><span class="op" id="5964880">,</span>&nbsp;<span class="ident" id="5964882">gcol</span><span class="op" id="5964886">,</span>&nbsp;<span class="ident" id="5964888">bcol</span><span class="op" id="5964892">,</span>&nbsp;<span class="ident" id="5964894">acol</span><span class="op" id="5964898">}</span><span class="op" id="5964899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964913">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964969">pr</span><span class="op" id="5964971">,</span>&nbsp;<span class="ident" id="5964973">cr</span>&nbsp;<span class="op" id="5964976">=</span>&nbsp;<span class="ident" id="5964978">cr</span><span class="op" id="5964980">,</span>&nbsp;<span class="ident" id="5964982">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964990">return</span>&nbsp;<span class="ident" id="5964997">img</span><span class="op" id="5965000">,</span>&nbsp;<span class="ident" id="5965002">nil</span><br>
<span class="lineno">585</span><span class="op" id="5965006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5965009">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5965072">func</span>&nbsp;<span class="op" id="5965077">(</span><span class="ident" id="5965078">d</span>&nbsp;<span class="op" id="5965080">*</span><span class="ident" id="5965081">decoder</span><span class="op" id="5965088">)</span>&nbsp;<span class="ident" id="5965090">mergePassInto</span><span class="op" id="5965103">(</span><span class="ident" id="5965104">dst</span>&nbsp;<span class="ident" id="5965108">image</span><span class="op" id="5965113">.</span><span class="ident" id="5965114">Image</span><span class="op" id="5965119">,</span>&nbsp;<span class="ident" id="5965121">src</span>&nbsp;<span class="ident" id="5965125">image</span><span class="op" id="5965130">.</span><span class="ident" id="5965131">Image</span><span class="op" id="5965136">,</span>&nbsp;<span class="ident" id="5965138">pass</span>&nbsp;<span class="builtintype" id="5965143">int</span><span class="op" id="5965146">)</span>&nbsp;<span class="op" id="5965148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965151">p</span>&nbsp;<span class="op" id="5965153">:=</span>&nbsp;<span class="ident" id="5965156">interlacing</span><span class="op" id="5965167">[</span><span class="ident" id="5965168">pass</span><span class="op" id="5965172">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965175">var</span>&nbsp;<span class="op" id="5965179">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965183">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965197">[</span><span class="op" id="5965198">]</span><span class="builtintype" id="5965199">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965207">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965221">[</span><span class="op" id="5965222">]</span><span class="builtintype" id="5965223">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965231">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5965245">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965251">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965265">image</span><span class="op" id="5965270">.</span><span class="ident" id="5965271">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965283">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5965297">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965305">switch</span>&nbsp;<span class="ident" id="5965312">target</span>&nbsp;<span class="op" id="5965319">:=</span>&nbsp;<span class="ident" id="5965322">dst</span><span class="op" id="5965325">.</span><span class="op" id="5965326">(</span><span class="keyword" id="5965327">type</span><span class="op" id="5965331">)</span>&nbsp;<span class="op" id="5965333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965336">case</span>&nbsp;<span class="op" id="5965341">*</span><span class="ident" id="5965342">image</span><span class="op" id="5965347">.</span><span class="ident" id="5965348">Alpha</span><span class="op" id="5965353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965357">srcPix</span>&nbsp;<span class="op" id="5965364">=</span>&nbsp;<span class="ident" id="5965366">src</span><span class="op" id="5965369">.</span><span class="op" id="5965370">(</span><span class="op" id="5965371">*</span><span class="ident" id="5965372">image</span><span class="op" id="5965377">.</span><span class="ident" id="5965378">Alpha</span><span class="op" id="5965383">)</span><span class="op" id="5965384">.</span><span class="ident" id="5965385">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965391">dstPix</span><span class="op" id="5965397">,</span>&nbsp;<span class="ident" id="5965399">stride</span><span class="op" id="5965405">,</span>&nbsp;<span class="ident" id="5965407">rect</span>&nbsp;<span class="op" id="5965412">=</span>&nbsp;<span class="ident" id="5965414">target</span><span class="op" id="5965420">.</span><span class="ident" id="5965421">Pix</span><span class="op" id="5965424">,</span>&nbsp;<span class="ident" id="5965426">target</span><span class="op" id="5965432">.</span><span class="ident" id="5965433">Stride</span><span class="op" id="5965439">,</span>&nbsp;<span class="ident" id="5965441">target</span><span class="op" id="5965447">.</span><span class="ident" id="5965448">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965455">bytesPerPixel</span>&nbsp;<span class="op" id="5965469">=</span>&nbsp;<span class="num" id="5965471">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965474">case</span>&nbsp;<span class="op" id="5965479">*</span><span class="ident" id="5965480">image</span><span class="op" id="5965485">.</span><span class="ident" id="5965486">Alpha16</span><span class="op" id="5965493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965497">srcPix</span>&nbsp;<span class="op" id="5965504">=</span>&nbsp;<span class="ident" id="5965506">src</span><span class="op" id="5965509">.</span><span class="op" id="5965510">(</span><span class="op" id="5965511">*</span><span class="ident" id="5965512">image</span><span class="op" id="5965517">.</span><span class="ident" id="5965518">Alpha16</span><span class="op" id="5965525">)</span><span class="op" id="5965526">.</span><span class="ident" id="5965527">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965533">dstPix</span><span class="op" id="5965539">,</span>&nbsp;<span class="ident" id="5965541">stride</span><span class="op" id="5965547">,</span>&nbsp;<span class="ident" id="5965549">rect</span>&nbsp;<span class="op" id="5965554">=</span>&nbsp;<span class="ident" id="5965556">target</span><span class="op" id="5965562">.</span><span class="ident" id="5965563">Pix</span><span class="op" id="5965566">,</span>&nbsp;<span class="ident" id="5965568">target</span><span class="op" id="5965574">.</span><span class="ident" id="5965575">Stride</span><span class="op" id="5965581">,</span>&nbsp;<span class="ident" id="5965583">target</span><span class="op" id="5965589">.</span><span class="ident" id="5965590">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965597">bytesPerPixel</span>&nbsp;<span class="op" id="5965611">=</span>&nbsp;<span class="num" id="5965613">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965616">case</span>&nbsp;<span class="op" id="5965621">*</span><span class="ident" id="5965622">image</span><span class="op" id="5965627">.</span><span class="ident" id="5965628">Gray</span><span class="op" id="5965632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965636">srcPix</span>&nbsp;<span class="op" id="5965643">=</span>&nbsp;<span class="ident" id="5965645">src</span><span class="op" id="5965648">.</span><span class="op" id="5965649">(</span><span class="op" id="5965650">*</span><span class="ident" id="5965651">image</span><span class="op" id="5965656">.</span><span class="ident" id="5965657">Gray</span><span class="op" id="5965661">)</span><span class="op" id="5965662">.</span><span class="ident" id="5965663">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965669">dstPix</span><span class="op" id="5965675">,</span>&nbsp;<span class="ident" id="5965677">stride</span><span class="op" id="5965683">,</span>&nbsp;<span class="ident" id="5965685">rect</span>&nbsp;<span class="op" id="5965690">=</span>&nbsp;<span class="ident" id="5965692">target</span><span class="op" id="5965698">.</span><span class="ident" id="5965699">Pix</span><span class="op" id="5965702">,</span>&nbsp;<span class="ident" id="5965704">target</span><span class="op" id="5965710">.</span><span class="ident" id="5965711">Stride</span><span class="op" id="5965717">,</span>&nbsp;<span class="ident" id="5965719">target</span><span class="op" id="5965725">.</span><span class="ident" id="5965726">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965733">bytesPerPixel</span>&nbsp;<span class="op" id="5965747">=</span>&nbsp;<span class="num" id="5965749">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965752">case</span>&nbsp;<span class="op" id="5965757">*</span><span class="ident" id="5965758">image</span><span class="op" id="5965763">.</span><span class="ident" id="5965764">Gray16</span><span class="op" id="5965770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965774">srcPix</span>&nbsp;<span class="op" id="5965781">=</span>&nbsp;<span class="ident" id="5965783">src</span><span class="op" id="5965786">.</span><span class="op" id="5965787">(</span><span class="op" id="5965788">*</span><span class="ident" id="5965789">image</span><span class="op" id="5965794">.</span><span class="ident" id="5965795">Gray16</span><span class="op" id="5965801">)</span><span class="op" id="5965802">.</span><span class="ident" id="5965803">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965809">dstPix</span><span class="op" id="5965815">,</span>&nbsp;<span class="ident" id="5965817">stride</span><span class="op" id="5965823">,</span>&nbsp;<span class="ident" id="5965825">rect</span>&nbsp;<span class="op" id="5965830">=</span>&nbsp;<span class="ident" id="5965832">target</span><span class="op" id="5965838">.</span><span class="ident" id="5965839">Pix</span><span class="op" id="5965842">,</span>&nbsp;<span class="ident" id="5965844">target</span><span class="op" id="5965850">.</span><span class="ident" id="5965851">Stride</span><span class="op" id="5965857">,</span>&nbsp;<span class="ident" id="5965859">target</span><span class="op" id="5965865">.</span><span class="ident" id="5965866">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965873">bytesPerPixel</span>&nbsp;<span class="op" id="5965887">=</span>&nbsp;<span class="num" id="5965889">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965892">case</span>&nbsp;<span class="op" id="5965897">*</span><span class="ident" id="5965898">image</span><span class="op" id="5965903">.</span><span class="ident" id="5965904">NRGBA</span><span class="op" id="5965909">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965913">srcPix</span>&nbsp;<span class="op" id="5965920">=</span>&nbsp;<span class="ident" id="5965922">src</span><span class="op" id="5965925">.</span><span class="op" id="5965926">(</span><span class="op" id="5965927">*</span><span class="ident" id="5965928">image</span><span class="op" id="5965933">.</span><span class="ident" id="5965934">NRGBA</span><span class="op" id="5965939">)</span><span class="op" id="5965940">.</span><span class="ident" id="5965941">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965947">dstPix</span><span class="op" id="5965953">,</span>&nbsp;<span class="ident" id="5965955">stride</span><span class="op" id="5965961">,</span>&nbsp;<span class="ident" id="5965963">rect</span>&nbsp;<span class="op" id="5965968">=</span>&nbsp;<span class="ident" id="5965970">target</span><span class="op" id="5965976">.</span><span class="ident" id="5965977">Pix</span><span class="op" id="5965980">,</span>&nbsp;<span class="ident" id="5965982">target</span><span class="op" id="5965988">.</span><span class="ident" id="5965989">Stride</span><span class="op" id="5965995">,</span>&nbsp;<span class="ident" id="5965997">target</span><span class="op" id="5966003">.</span><span class="ident" id="5966004">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966011">bytesPerPixel</span>&nbsp;<span class="op" id="5966025">=</span>&nbsp;<span class="num" id="5966027">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966030">case</span>&nbsp;<span class="op" id="5966035">*</span><span class="ident" id="5966036">image</span><span class="op" id="5966041">.</span><span class="ident" id="5966042">NRGBA64</span><span class="op" id="5966049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966053">srcPix</span>&nbsp;<span class="op" id="5966060">=</span>&nbsp;<span class="ident" id="5966062">src</span><span class="op" id="5966065">.</span><span class="op" id="5966066">(</span><span class="op" id="5966067">*</span><span class="ident" id="5966068">image</span><span class="op" id="5966073">.</span><span class="ident" id="5966074">NRGBA64</span><span class="op" id="5966081">)</span><span class="op" id="5966082">.</span><span class="ident" id="5966083">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966089">dstPix</span><span class="op" id="5966095">,</span>&nbsp;<span class="ident" id="5966097">stride</span><span class="op" id="5966103">,</span>&nbsp;<span class="ident" id="5966105">rect</span>&nbsp;<span class="op" id="5966110">=</span>&nbsp;<span class="ident" id="5966112">target</span><span class="op" id="5966118">.</span><span class="ident" id="5966119">Pix</span><span class="op" id="5966122">,</span>&nbsp;<span class="ident" id="5966124">target</span><span class="op" id="5966130">.</span><span class="ident" id="5966131">Stride</span><span class="op" id="5966137">,</span>&nbsp;<span class="ident" id="5966139">target</span><span class="op" id="5966145">.</span><span class="ident" id="5966146">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966153">bytesPerPixel</span>&nbsp;<span class="op" id="5966167">=</span>&nbsp;<span class="num" id="5966169">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966172">case</span>&nbsp;<span class="op" id="5966177">*</span><span class="ident" id="5966178">image</span><span class="op" id="5966183">.</span><span class="ident" id="5966184">Paletted</span><span class="op" id="5966192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966196">srcPix</span>&nbsp;<span class="op" id="5966203">=</span>&nbsp;<span class="ident" id="5966205">src</span><span class="op" id="5966208">.</span><span class="op" id="5966209">(</span><span class="op" id="5966210">*</span><span class="ident" id="5966211">image</span><span class="op" id="5966216">.</span><span class="ident" id="5966217">Paletted</span><span class="op" id="5966225">)</span><span class="op" id="5966226">.</span><span class="ident" id="5966227">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966233">dstPix</span><span class="op" id="5966239">,</span>&nbsp;<span class="ident" id="5966241">stride</span><span class="op" id="5966247">,</span>&nbsp;<span class="ident" id="5966249">rect</span>&nbsp;<span class="op" id="5966254">=</span>&nbsp;<span class="ident" id="5966256">target</span><span class="op" id="5966262">.</span><span class="ident" id="5966263">Pix</span><span class="op" id="5966266">,</span>&nbsp;<span class="ident" id="5966268">target</span><span class="op" id="5966274">.</span><span class="ident" id="5966275">Stride</span><span class="op" id="5966281">,</span>&nbsp;<span class="ident" id="5966283">target</span><span class="op" id="5966289">.</span><span class="ident" id="5966290">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966297">bytesPerPixel</span>&nbsp;<span class="op" id="5966311">=</span>&nbsp;<span class="num" id="5966313">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966316">case</span>&nbsp;<span class="op" id="5966321">*</span><span class="ident" id="5966322">image</span><span class="op" id="5966327">.</span><span class="ident" id="5966328">RGBA</span><span class="op" id="5966332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966336">srcPix</span>&nbsp;<span class="op" id="5966343">=</span>&nbsp;<span class="ident" id="5966345">src</span><span class="op" id="5966348">.</span><span class="op" id="5966349">(</span><span class="op" id="5966350">*</span><span class="ident" id="5966351">image</span><span class="op" id="5966356">.</span><span class="ident" id="5966357">RGBA</span><span class="op" id="5966361">)</span><span class="op" id="5966362">.</span><span class="ident" id="5966363">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966369">dstPix</span><span class="op" id="5966375">,</span>&nbsp;<span class="ident" id="5966377">stride</span><span class="op" id="5966383">,</span>&nbsp;<span class="ident" id="5966385">rect</span>&nbsp;<span class="op" id="5966390">=</span>&nbsp;<span class="ident" id="5966392">target</span><span class="op" id="5966398">.</span><span class="ident" id="5966399">Pix</span><span class="op" id="5966402">,</span>&nbsp;<span class="ident" id="5966404">target</span><span class="op" id="5966410">.</span><span class="ident" id="5966411">Stride</span><span class="op" id="5966417">,</span>&nbsp;<span class="ident" id="5966419">target</span><span class="op" id="5966425">.</span><span class="ident" id="5966426">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966433">bytesPerPixel</span>&nbsp;<span class="op" id="5966447">=</span>&nbsp;<span class="num" id="5966449">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966452">case</span>&nbsp;<span class="op" id="5966457">*</span><span class="ident" id="5966458">image</span><span class="op" id="5966463">.</span><span class="ident" id="5966464">RGBA64</span><span class="op" id="5966470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966474">srcPix</span>&nbsp;<span class="op" id="5966481">=</span>&nbsp;<span class="ident" id="5966483">src</span><span class="op" id="5966486">.</span><span class="op" id="5966487">(</span><span class="op" id="5966488">*</span><span class="ident" id="5966489">image</span><span class="op" id="5966494">.</span><span class="ident" id="5966495">RGBA64</span><span class="op" id="5966501">)</span><span class="op" id="5966502">.</span><span class="ident" id="5966503">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966509">dstPix</span><span class="op" id="5966515">,</span>&nbsp;<span class="ident" id="5966517">stride</span><span class="op" id="5966523">,</span>&nbsp;<span class="ident" id="5966525">rect</span>&nbsp;<span class="op" id="5966530">=</span>&nbsp;<span class="ident" id="5966532">target</span><span class="op" id="5966538">.</span><span class="ident" id="5966539">Pix</span><span class="op" id="5966542">,</span>&nbsp;<span class="ident" id="5966544">target</span><span class="op" id="5966550">.</span><span class="ident" id="5966551">Stride</span><span class="op" id="5966557">,</span>&nbsp;<span class="ident" id="5966559">target</span><span class="op" id="5966565">.</span><span class="ident" id="5966566">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966573">bytesPerPixel</span>&nbsp;<span class="op" id="5966587">=</span>&nbsp;<span class="num" id="5966589">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966592">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966595">s</span><span class="op" id="5966596">,</span>&nbsp;<span class="ident" id="5966598">bounds</span>&nbsp;<span class="op" id="5966605">:=</span>&nbsp;<span class="num" id="5966608">0</span><span class="op" id="5966609">,</span>&nbsp;<span class="ident" id="5966611">src</span><span class="op" id="5966614">.</span><span class="ident" id="5966615">Bounds</span><span class="op" id="5966621">(</span><span class="op" id="5966622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966625">for</span>&nbsp;<span class="ident" id="5966629">y</span>&nbsp;<span class="op" id="5966631">:=</span>&nbsp;<span class="ident" id="5966634">bounds</span><span class="op" id="5966640">.</span><span class="ident" id="5966641">Min</span><span class="op" id="5966644">.</span><span class="ident" id="5966645">Y</span><span class="op" id="5966646">;</span>&nbsp;<span class="ident" id="5966648">y</span>&nbsp;<span class="op" id="5966650">&lt;</span>&nbsp;<span class="ident" id="5966652">bounds</span><span class="op" id="5966658">.</span><span class="ident" id="5966659">Max</span><span class="op" id="5966662">.</span><span class="ident" id="5966663">Y</span><span class="op" id="5966664">;</span>&nbsp;<span class="ident" id="5966666">y</span><span class="op" id="5966667">++</span>&nbsp;<span class="op" id="5966670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966674">dBase</span>&nbsp;<span class="op" id="5966680">:=</span>&nbsp;<span class="op" id="5966683">(</span><span class="ident" id="5966684">y</span><span class="op" id="5966685">*</span><span class="ident" id="5966686">p</span><span class="op" id="5966687">.</span><span class="ident" id="5966688">yFactor</span><span class="op" id="5966695">+</span><span class="ident" id="5966696">p</span><span class="op" id="5966697">.</span><span class="ident" id="5966698">yOffset</span><span class="op" id="5966705">-</span><span class="ident" id="5966706">rect</span><span class="op" id="5966710">.</span><span class="ident" id="5966711">Min</span><span class="op" id="5966714">.</span><span class="ident" id="5966715">Y</span><span class="op" id="5966716">)</span><span class="op" id="5966717">*</span><span class="ident" id="5966718">stride</span>&nbsp;<span class="op" id="5966725">+</span>&nbsp;<span class="op" id="5966727">(</span><span class="ident" id="5966728">p</span><span class="op" id="5966729">.</span><span class="ident" id="5966730">xOffset</span><span class="op" id="5966737">-</span><span class="ident" id="5966738">rect</span><span class="op" id="5966742">.</span><span class="ident" id="5966743">Min</span><span class="op" id="5966746">.</span><span class="ident" id="5966747">X</span><span class="op" id="5966748">)</span><span class="op" id="5966749">*</span><span class="ident" id="5966750">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966766">for</span>&nbsp;<span class="ident" id="5966770">x</span>&nbsp;<span class="op" id="5966772">:=</span>&nbsp;<span class="ident" id="5966775">bounds</span><span class="op" id="5966781">.</span><span class="ident" id="5966782">Min</span><span class="op" id="5966785">.</span><span class="ident" id="5966786">X</span><span class="op" id="5966787">;</span>&nbsp;<span class="ident" id="5966789">x</span>&nbsp;<span class="op" id="5966791">&lt;</span>&nbsp;<span class="ident" id="5966793">bounds</span><span class="op" id="5966799">.</span><span class="ident" id="5966800">Max</span><span class="op" id="5966803">.</span><span class="ident" id="5966804">X</span><span class="op" id="5966805">;</span>&nbsp;<span class="ident" id="5966807">x</span><span class="op" id="5966808">++</span>&nbsp;<span class="op" id="5966811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966816">d</span>&nbsp;<span class="op" id="5966818">:=</span>&nbsp;<span class="ident" id="5966821">dBase</span>&nbsp;<span class="op" id="5966827">+</span>&nbsp;<span class="ident" id="5966829">x</span><span class="op" id="5966830">*</span><span class="ident" id="5966831">p</span><span class="op" id="5966832">.</span><span class="ident" id="5966833">xFactor</span><span class="op" id="5966840">*</span><span class="ident" id="5966841">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5966858">copy</span><span class="op" id="5966862">(</span><span class="ident" id="5966863">dstPix</span><span class="op" id="5966869">[</span><span class="ident" id="5966870">d</span><span class="op" id="5966871">:</span><span class="op" id="5966872">]</span><span class="op" id="5966873">,</span>&nbsp;<span class="ident" id="5966875">srcPix</span><span class="op" id="5966881">[</span><span class="ident" id="5966882">s</span><span class="op" id="5966883">:</span><span class="ident" id="5966884">s</span><span class="op" id="5966885">+</span><span class="ident" id="5966886">bytesPerPixel</span><span class="op" id="5966899">]</span><span class="op" id="5966900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966905">s</span>&nbsp;<span class="op" id="5966907">+=</span>&nbsp;<span class="ident" id="5966910">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966929">}</span><br>
<span class="lineno"></span><span class="op" id="5966931">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5966934">func</span>&nbsp;<span class="op" id="5966939">(</span><span class="ident" id="5966940">d</span>&nbsp;<span class="op" id="5966942">*</span><span class="ident" id="5966943">decoder</span><span class="op" id="5966950">)</span>&nbsp;<span class="ident" id="5966952">parseIDAT</span><span class="op" id="5966961">(</span><span class="ident" id="5966962">length</span>&nbsp;<span class="builtintype" id="5966969">uint32</span><span class="op" id="5966975">)</span>&nbsp;<span class="op" id="5966977">(</span><span class="ident" id="5966978">err</span>&nbsp;<span class="builtintype" id="5966982">error</span><span class="op" id="5966987">)</span>&nbsp;<span class="op" id="5966989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966992">d</span><span class="op" id="5966993">.</span><span class="ident" id="5966994">idatLength</span>&nbsp;<span class="op" id="5967005">=</span>&nbsp;<span class="ident" id="5967007">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967015">d</span><span class="op" id="5967016">.</span><span class="ident" id="5967017">img</span><span class="op" id="5967020">,</span>&nbsp;<span class="ident" id="5967022">err</span>&nbsp;<span class="op" id="5967026">=</span>&nbsp;<span class="ident" id="5967028">d</span><span class="op" id="5967029">.</span><span class="ident" id="5967030">decode</span><span class="op" id="5967036">(</span><span class="op" id="5967037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967040">if</span>&nbsp;<span class="ident" id="5967043">err</span>&nbsp;<span class="op" id="5967047">!=</span>&nbsp;<span class="ident" id="5967050">nil</span>&nbsp;<span class="op" id="5967054">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967058">return</span>&nbsp;<span class="ident" id="5967065">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967073">return</span>&nbsp;<span class="ident" id="5967080">d</span><span class="op" id="5967081">.</span><span class="ident" id="5967082">verifyChecksum</span><span class="op" id="5967096">(</span><span class="op" id="5967097">)</span><br>
<span class="lineno"></span><span class="op" id="5967099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5967102">func</span>&nbsp;<span class="op" id="5967107">(</span><span class="ident" id="5967108">d</span>&nbsp;<span class="op" id="5967110">*</span><span class="ident" id="5967111">decoder</span><span class="op" id="5967118">)</span>&nbsp;<span class="ident" id="5967120">parseIEND</span><span class="op" id="5967129">(</span><span class="ident" id="5967130">length</span>&nbsp;<span class="builtintype" id="5967137">uint32</span><span class="op" id="5967143">)</span>&nbsp;<span class="builtintype" id="5967145">error</span>&nbsp;<span class="op" id="5967151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967154">if</span>&nbsp;<span class="ident" id="5967157">length</span>&nbsp;<span class="op" id="5967164">!=</span>&nbsp;<span class="num" id="5967167">0</span>&nbsp;<span class="op" id="5967169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967173">return</span>&nbsp;<span class="ident" id="5967180">FormatError</span><span class="op" id="5967191">(</span><span class="string" id="5967192">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5967209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967215">return</span>&nbsp;<span class="ident" id="5967222">d</span><span class="op" id="5967223">.</span><span class="ident" id="5967224">verifyChecksum</span><span class="op" id="5967238">(</span><span class="op" id="5967239">)</span><br>
<span class="lineno">660</span><span class="op" id="5967241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5967244">func</span>&nbsp;<span class="op" id="5967249">(</span><span class="ident" id="5967250">d</span>&nbsp;<span class="op" id="5967252">*</span><span class="ident" id="5967253">decoder</span><span class="op" id="5967260">)</span>&nbsp;<span class="ident" id="5967262">parseChunk</span><span class="op" id="5967272">(</span><span class="op" id="5967273">)</span>&nbsp;<span class="builtintype" id="5967275">error</span>&nbsp;<span class="op" id="5967281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967284">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967320">n</span><span class="op" id="5967321">,</span>&nbsp;<span class="ident" id="5967323">err</span>&nbsp;<span class="op" id="5967327">:=</span>&nbsp;<span class="ident" id="5967330">io</span><span class="op" id="5967332">.</span><span class="ident" id="5967333">ReadFull</span><span class="op" id="5967341">(</span><span class="ident" id="5967342">d</span><span class="op" id="5967343">.</span><span class="ident" id="5967344">r</span><span class="op" id="5967345">,</span>&nbsp;<span class="ident" id="5967347">d</span><span class="op" id="5967348">.</span><span class="ident" id="5967349">tmp</span><span class="op" id="5967352">[</span><span class="op" id="5967353">:</span><span class="num" id="5967354">8</span><span class="op" id="5967355">]</span><span class="op" id="5967356">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967359">if</span>&nbsp;<span class="ident" id="5967362">err</span>&nbsp;<span class="op" id="5967366">!=</span>&nbsp;<span class="ident" id="5967369">nil</span>&nbsp;<span class="op" id="5967373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967377">return</span>&nbsp;<span class="ident" id="5967384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967392">length</span>&nbsp;<span class="op" id="5967399">:=</span>&nbsp;<span class="ident" id="5967402">binary</span><span class="op" id="5967408">.</span><span class="ident" id="5967409">BigEndian</span><span class="op" id="5967418">.</span><span class="ident" id="5967419">Uint32</span><span class="op" id="5967425">(</span><span class="ident" id="5967426">d</span><span class="op" id="5967427">.</span><span class="ident" id="5967428">tmp</span><span class="op" id="5967431">[</span><span class="op" id="5967432">:</span><span class="num" id="5967433">4</span><span class="op" id="5967434">]</span><span class="op" id="5967435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967438">d</span><span class="op" id="5967439">.</span><span class="ident" id="5967440">crc</span><span class="op" id="5967443">.</span><span class="ident" id="5967444">Reset</span><span class="op" id="5967449">(</span><span class="op" id="5967450">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967453">d</span><span class="op" id="5967454">.</span><span class="ident" id="5967455">crc</span><span class="op" id="5967458">.</span><span class="ident" id="5967459">Write</span><span class="op" id="5967464">(</span><span class="ident" id="5967465">d</span><span class="op" id="5967466">.</span><span class="ident" id="5967467">tmp</span><span class="op" id="5967470">[</span><span class="num" id="5967471">4</span><span class="op" id="5967472">:</span><span class="num" id="5967473">8</span><span class="op" id="5967474">]</span><span class="op" id="5967475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967479">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967504">switch</span>&nbsp;<span class="builtintype" id="5967511">string</span><span class="op" id="5967517">(</span><span class="ident" id="5967518">d</span><span class="op" id="5967519">.</span><span class="ident" id="5967520">tmp</span><span class="op" id="5967523">[</span><span class="num" id="5967524">4</span><span class="op" id="5967525">:</span><span class="num" id="5967526">8</span><span class="op" id="5967527">]</span><span class="op" id="5967528">)</span>&nbsp;<span class="op" id="5967530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967533">case</span>&nbsp;<span class="string" id="5967538">&#34;IHDR&#34;</span><span class="op" id="5967544">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967548">if</span>&nbsp;<span class="ident" id="5967551">d</span><span class="op" id="5967552">.</span><span class="ident" id="5967553">stage</span>&nbsp;<span class="op" id="5967559">!=</span>&nbsp;<span class="ident" id="5967562">dsStart</span>&nbsp;<span class="op" id="5967570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967575">return</span>&nbsp;<span class="ident" id="5967582">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967604">d</span><span class="op" id="5967605">.</span><span class="ident" id="5967606">stage</span>&nbsp;<span class="op" id="5967612">=</span>&nbsp;<span class="ident" id="5967614">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967627">return</span>&nbsp;<span class="ident" id="5967634">d</span><span class="op" id="5967635">.</span><span class="ident" id="5967636">parseIHDR</span><span class="op" id="5967645">(</span><span class="ident" id="5967646">length</span><span class="op" id="5967652">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967655">case</span>&nbsp;<span class="string" id="5967660">&#34;PLTE&#34;</span><span class="op" id="5967666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967670">if</span>&nbsp;<span class="ident" id="5967673">d</span><span class="op" id="5967674">.</span><span class="ident" id="5967675">stage</span>&nbsp;<span class="op" id="5967681">!=</span>&nbsp;<span class="ident" id="5967684">dsSeenIHDR</span>&nbsp;<span class="op" id="5967695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967700">return</span>&nbsp;<span class="ident" id="5967707">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967729">d</span><span class="op" id="5967730">.</span><span class="ident" id="5967731">stage</span>&nbsp;<span class="op" id="5967737">=</span>&nbsp;<span class="ident" id="5967739">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967752">return</span>&nbsp;<span class="ident" id="5967759">d</span><span class="op" id="5967760">.</span><span class="ident" id="5967761">parsePLTE</span><span class="op" id="5967770">(</span><span class="ident" id="5967771">length</span><span class="op" id="5967777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967780">case</span>&nbsp;<span class="string" id="5967785">&#34;tRNS&#34;</span><span class="op" id="5967791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967795">if</span>&nbsp;<span class="ident" id="5967798">d</span><span class="op" id="5967799">.</span><span class="ident" id="5967800">stage</span>&nbsp;<span class="op" id="5967806">!=</span>&nbsp;<span class="ident" id="5967809">dsSeenPLTE</span>&nbsp;<span class="op" id="5967820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967825">return</span>&nbsp;<span class="ident" id="5967832">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967850">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967854">return</span>&nbsp;<span class="ident" id="5967861">d</span><span class="op" id="5967862">.</span><span class="ident" id="5967863">parsetRNS</span><span class="op" id="5967872">(</span><span class="ident" id="5967873">length</span><span class="op" id="5967879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967882">case</span>&nbsp;<span class="string" id="5967887">&#34;IDAT&#34;</span><span class="op" id="5967893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967897">if</span>&nbsp;<span class="ident" id="5967900">d</span><span class="op" id="5967901">.</span><span class="ident" id="5967902">stage</span>&nbsp;<span class="op" id="5967908">&lt;</span>&nbsp;<span class="ident" id="5967910">dsSeenIHDR</span>&nbsp;<span class="op" id="5967921">||</span>&nbsp;<span class="ident" id="5967924">d</span><span class="op" id="5967925">.</span><span class="ident" id="5967926">stage</span>&nbsp;<span class="op" id="5967932">&gt;</span>&nbsp;<span class="ident" id="5967934">dsSeenIDAT</span>&nbsp;<span class="op" id="5967945">||</span>&nbsp;<span class="op" id="5967948">(</span><span class="ident" id="5967949">d</span><span class="op" id="5967950">.</span><span class="ident" id="5967951">cb</span>&nbsp;<span class="op" id="5967954">==</span>&nbsp;<span class="ident" id="5967957">cbP8</span>&nbsp;<span class="op" id="5967962">&amp;&amp;</span>&nbsp;<span class="ident" id="5967965">d</span><span class="op" id="5967966">.</span><span class="ident" id="5967967">stage</span>&nbsp;<span class="op" id="5967973">==</span>&nbsp;<span class="ident" id="5967976">dsSeenIHDR</span><span class="op" id="5967986">)</span>&nbsp;<span class="op" id="5967988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967993">return</span>&nbsp;<span class="ident" id="5968000">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968018">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968022">d</span><span class="op" id="5968023">.</span><span class="ident" id="5968024">stage</span>&nbsp;<span class="op" id="5968030">=</span>&nbsp;<span class="ident" id="5968032">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968045">return</span>&nbsp;<span class="ident" id="5968052">d</span><span class="op" id="5968053">.</span><span class="ident" id="5968054">parseIDAT</span><span class="op" id="5968063">(</span><span class="ident" id="5968064">length</span><span class="op" id="5968070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968073">case</span>&nbsp;<span class="string" id="5968078">&#34;IEND&#34;</span><span class="op" id="5968084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968088">if</span>&nbsp;<span class="ident" id="5968091">d</span><span class="op" id="5968092">.</span><span class="ident" id="5968093">stage</span>&nbsp;<span class="op" id="5968099">!=</span>&nbsp;<span class="ident" id="5968102">dsSeenIDAT</span>&nbsp;<span class="op" id="5968113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968118">return</span>&nbsp;<span class="ident" id="5968125">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968147">d</span><span class="op" id="5968148">.</span><span class="ident" id="5968149">stage</span>&nbsp;<span class="op" id="5968155">=</span>&nbsp;<span class="ident" id="5968157">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968170">return</span>&nbsp;<span class="ident" id="5968177">d</span><span class="op" id="5968178">.</span><span class="ident" id="5968179">parseIEND</span><span class="op" id="5968188">(</span><span class="ident" id="5968189">length</span><span class="op" id="5968195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968201">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968244">var</span>&nbsp;<span class="ident" id="5968248">ignored</span>&nbsp;<span class="op" id="5968256">[</span><span class="num" id="5968257">4096</span><span class="op" id="5968261">]</span><span class="builtintype" id="5968262">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968268">for</span>&nbsp;<span class="ident" id="5968272">length</span>&nbsp;<span class="op" id="5968279">&gt;</span>&nbsp;<span class="num" id="5968281">0</span>&nbsp;<span class="op" id="5968283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968287">n</span><span class="op" id="5968288">,</span>&nbsp;<span class="ident" id="5968290">err</span>&nbsp;<span class="op" id="5968294">=</span>&nbsp;<span class="ident" id="5968296">io</span><span class="op" id="5968298">.</span><span class="ident" id="5968299">ReadFull</span><span class="op" id="5968307">(</span><span class="ident" id="5968308">d</span><span class="op" id="5968309">.</span><span class="ident" id="5968310">r</span><span class="op" id="5968311">,</span>&nbsp;<span class="ident" id="5968313">ignored</span><span class="op" id="5968320">[</span><span class="op" id="5968321">:</span><span class="ident" id="5968322">min</span><span class="op" id="5968325">(</span><span class="builtinfunc" id="5968326">len</span><span class="op" id="5968329">(</span><span class="ident" id="5968330">ignored</span><span class="op" id="5968337">)</span><span class="op" id="5968338">,</span>&nbsp;<span class="builtintype" id="5968340">int</span><span class="op" id="5968343">(</span><span class="ident" id="5968344">length</span><span class="op" id="5968350">)</span><span class="op" id="5968351">)</span><span class="op" id="5968352">]</span><span class="op" id="5968353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968357">if</span>&nbsp;<span class="ident" id="5968360">err</span>&nbsp;<span class="op" id="5968364">!=</span>&nbsp;<span class="ident" id="5968367">nil</span>&nbsp;<span class="op" id="5968371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968376">return</span>&nbsp;<span class="ident" id="5968383">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968393">d</span><span class="op" id="5968394">.</span><span class="ident" id="5968395">crc</span><span class="op" id="5968398">.</span><span class="ident" id="5968399">Write</span><span class="op" id="5968404">(</span><span class="ident" id="5968405">ignored</span><span class="op" id="5968412">[</span><span class="op" id="5968413">:</span><span class="ident" id="5968414">n</span><span class="op" id="5968415">]</span><span class="op" id="5968416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968420">length</span>&nbsp;<span class="op" id="5968427">-=</span>&nbsp;<span class="builtintype" id="5968430">uint32</span><span class="op" id="5968436">(</span><span class="ident" id="5968437">n</span><span class="op" id="5968438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968444">return</span>&nbsp;<span class="ident" id="5968451">d</span><span class="op" id="5968452">.</span><span class="ident" id="5968453">verifyChecksum</span><span class="op" id="5968467">(</span><span class="op" id="5968468">)</span><br>
<span class="lineno">715</span><span class="op" id="5968470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5968473">func</span>&nbsp;<span class="op" id="5968478">(</span><span class="ident" id="5968479">d</span>&nbsp;<span class="op" id="5968481">*</span><span class="ident" id="5968482">decoder</span><span class="op" id="5968489">)</span>&nbsp;<span class="ident" id="5968491">verifyChecksum</span><span class="op" id="5968505">(</span><span class="op" id="5968506">)</span>&nbsp;<span class="builtintype" id="5968508">error</span>&nbsp;<span class="op" id="5968514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968517">if</span>&nbsp;<span class="ident" id="5968520">_</span><span class="op" id="5968521">,</span>&nbsp;<span class="ident" id="5968523">err</span>&nbsp;<span class="op" id="5968527">:=</span>&nbsp;<span class="ident" id="5968530">io</span><span class="op" id="5968532">.</span><span class="ident" id="5968533">ReadFull</span><span class="op" id="5968541">(</span><span class="ident" id="5968542">d</span><span class="op" id="5968543">.</span><span class="ident" id="5968544">r</span><span class="op" id="5968545">,</span>&nbsp;<span class="ident" id="5968547">d</span><span class="op" id="5968548">.</span><span class="ident" id="5968549">tmp</span><span class="op" id="5968552">[</span><span class="op" id="5968553">:</span><span class="num" id="5968554">4</span><span class="op" id="5968555">]</span><span class="op" id="5968556">)</span><span class="op" id="5968557">;</span>&nbsp;<span class="ident" id="5968559">err</span>&nbsp;<span class="op" id="5968563">!=</span>&nbsp;<span class="ident" id="5968566">nil</span>&nbsp;<span class="op" id="5968570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968574">return</span>&nbsp;<span class="ident" id="5968581">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968589">if</span>&nbsp;<span class="ident" id="5968592">binary</span><span class="op" id="5968598">.</span><span class="ident" id="5968599">BigEndian</span><span class="op" id="5968608">.</span><span class="ident" id="5968609">Uint32</span><span class="op" id="5968615">(</span><span class="ident" id="5968616">d</span><span class="op" id="5968617">.</span><span class="ident" id="5968618">tmp</span><span class="op" id="5968621">[</span><span class="op" id="5968622">:</span><span class="num" id="5968623">4</span><span class="op" id="5968624">]</span><span class="op" id="5968625">)</span>&nbsp;<span class="op" id="5968627">!=</span>&nbsp;<span class="ident" id="5968630">d</span><span class="op" id="5968631">.</span><span class="ident" id="5968632">crc</span><span class="op" id="5968635">.</span><span class="ident" id="5968636">Sum32</span><span class="op" id="5968641">(</span><span class="op" id="5968642">)</span>&nbsp;<span class="op" id="5968644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968648">return</span>&nbsp;<span class="ident" id="5968655">FormatError</span><span class="op" id="5968666">(</span><span class="string" id="5968667">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5968685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968691">return</span>&nbsp;<span class="ident" id="5968698">nil</span><br>
<span class="lineno">725</span><span class="op" id="5968702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5968705">func</span>&nbsp;<span class="op" id="5968710">(</span><span class="ident" id="5968711">d</span>&nbsp;<span class="op" id="5968713">*</span><span class="ident" id="5968714">decoder</span><span class="op" id="5968721">)</span>&nbsp;<span class="ident" id="5968723">checkHeader</span><span class="op" id="5968734">(</span><span class="op" id="5968735">)</span>&nbsp;<span class="builtintype" id="5968737">error</span>&nbsp;<span class="op" id="5968743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968746">_</span><span class="op" id="5968747">,</span>&nbsp;<span class="ident" id="5968749">err</span>&nbsp;<span class="op" id="5968753">:=</span>&nbsp;<span class="ident" id="5968756">io</span><span class="op" id="5968758">.</span><span class="ident" id="5968759">ReadFull</span><span class="op" id="5968767">(</span><span class="ident" id="5968768">d</span><span class="op" id="5968769">.</span><span class="ident" id="5968770">r</span><span class="op" id="5968771">,</span>&nbsp;<span class="ident" id="5968773">d</span><span class="op" id="5968774">.</span><span class="ident" id="5968775">tmp</span><span class="op" id="5968778">[</span><span class="op" id="5968779">:</span><span class="builtinfunc" id="5968780">len</span><span class="op" id="5968783">(</span><span class="ident" id="5968784">pngHeader</span><span class="op" id="5968793">)</span><span class="op" id="5968794">]</span><span class="op" id="5968795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968798">if</span>&nbsp;<span class="ident" id="5968801">err</span>&nbsp;<span class="op" id="5968805">!=</span>&nbsp;<span class="ident" id="5968808">nil</span>&nbsp;<span class="op" id="5968812">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968816">return</span>&nbsp;<span class="ident" id="5968823">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968831">if</span>&nbsp;<span class="builtintype" id="5968834">string</span><span class="op" id="5968840">(</span><span class="ident" id="5968841">d</span><span class="op" id="5968842">.</span><span class="ident" id="5968843">tmp</span><span class="op" id="5968846">[</span><span class="op" id="5968847">:</span><span class="builtinfunc" id="5968848">len</span><span class="op" id="5968851">(</span><span class="ident" id="5968852">pngHeader</span><span class="op" id="5968861">)</span><span class="op" id="5968862">]</span><span class="op" id="5968863">)</span>&nbsp;<span class="op" id="5968865">!=</span>&nbsp;<span class="ident" id="5968868">pngHeader</span>&nbsp;<span class="op" id="5968878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968882">return</span>&nbsp;<span class="ident" id="5968889">FormatError</span><span class="op" id="5968900">(</span><span class="string" id="5968901">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5968917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968920">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968923">return</span>&nbsp;<span class="ident" id="5968930">nil</span><br>
<span class="lineno"></span><span class="op" id="5968934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5968937">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5969006">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5969065">func</span>&nbsp;<span class="ident" id="5969070">Decode</span><span class="op" id="5969076">(</span><span class="ident" id="5969077">r</span>&nbsp;<span class="ident" id="5969079">io</span><span class="op" id="5969081">.</span><span class="ident" id="5969082">Reader</span><span class="op" id="5969088">)</span>&nbsp;<span class="op" id="5969090">(</span><span class="ident" id="5969091">image</span><span class="op" id="5969096">.</span><span class="ident" id="5969097">Image</span><span class="op" id="5969102">,</span>&nbsp;<span class="builtintype" id="5969104">error</span><span class="op" id="5969109">)</span>&nbsp;<span class="op" id="5969111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969114">d</span>&nbsp;<span class="op" id="5969116">:=</span>&nbsp;<span class="op" id="5969119">&amp;</span><span class="ident" id="5969120">decoder</span><span class="op" id="5969127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969131">r</span><span class="op" id="5969132">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5969136">r</span><span class="op" id="5969137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969141">crc</span><span class="op" id="5969144">:</span>&nbsp;<span class="ident" id="5969146">crc32</span><span class="op" id="5969151">.</span><span class="ident" id="5969152">NewIEEE</span><span class="op" id="5969159">(</span><span class="op" id="5969160">)</span><span class="op" id="5969161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969164">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969167">if</span>&nbsp;<span class="ident" id="5969170">err</span>&nbsp;<span class="op" id="5969174">:=</span>&nbsp;<span class="ident" id="5969177">d</span><span class="op" id="5969178">.</span><span class="ident" id="5969179">checkHeader</span><span class="op" id="5969190">(</span><span class="op" id="5969191">)</span><span class="op" id="5969192">;</span>&nbsp;<span class="ident" id="5969194">err</span>&nbsp;<span class="op" id="5969198">!=</span>&nbsp;<span class="ident" id="5969201">nil</span>&nbsp;<span class="op" id="5969205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969209">if</span>&nbsp;<span class="ident" id="5969212">err</span>&nbsp;<span class="op" id="5969216">==</span>&nbsp;<span class="ident" id="5969219">io</span><span class="op" id="5969221">.</span><span class="ident" id="5969222">EOF</span>&nbsp;<span class="op" id="5969226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969231">err</span>&nbsp;<span class="op" id="5969235">=</span>&nbsp;<span class="ident" id="5969237">io</span><span class="op" id="5969239">.</span><span class="ident" id="5969240">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969263">return</span>&nbsp;<span class="ident" id="5969270">nil</span><span class="op" id="5969273">,</span>&nbsp;<span class="ident" id="5969275">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969283">for</span>&nbsp;<span class="ident" id="5969287">d</span><span class="op" id="5969288">.</span><span class="ident" id="5969289">stage</span>&nbsp;<span class="op" id="5969295">!=</span>&nbsp;<span class="ident" id="5969298">dsSeenIEND</span>&nbsp;<span class="op" id="5969309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969313">if</span>&nbsp;<span class="ident" id="5969316">err</span>&nbsp;<span class="op" id="5969320">:=</span>&nbsp;<span class="ident" id="5969323">d</span><span class="op" id="5969324">.</span><span class="ident" id="5969325">parseChunk</span><span class="op" id="5969335">(</span><span class="op" id="5969336">)</span><span class="op" id="5969337">;</span>&nbsp;<span class="ident" id="5969339">err</span>&nbsp;<span class="op" id="5969343">!=</span>&nbsp;<span class="ident" id="5969346">nil</span>&nbsp;<span class="op" id="5969350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969355">if</span>&nbsp;<span class="ident" id="5969358">err</span>&nbsp;<span class="op" id="5969362">==</span>&nbsp;<span class="ident" id="5969365">io</span><span class="op" id="5969367">.</span><span class="ident" id="5969368">EOF</span>&nbsp;<span class="op" id="5969372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969378">err</span>&nbsp;<span class="op" id="5969382">=</span>&nbsp;<span class="ident" id="5969384">io</span><span class="op" id="5969386">.</span><span class="ident" id="5969387">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969412">return</span>&nbsp;<span class="ident" id="5969419">nil</span><span class="op" id="5969422">,</span>&nbsp;<span class="ident" id="5969424">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969436">return</span>&nbsp;<span class="ident" id="5969443">d</span><span class="op" id="5969444">.</span><span class="ident" id="5969445">img</span><span class="op" id="5969448">,</span>&nbsp;<span class="ident" id="5969450">nil</span><br>
<span class="lineno">760</span><span class="op" id="5969454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5969457">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5969535">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5969565">func</span>&nbsp;<span class="ident" id="5969570">DecodeConfig</span><span class="op" id="5969582">(</span><span class="ident" id="5969583">r</span>&nbsp;<span class="ident" id="5969585">io</span><span class="op" id="5969587">.</span><span class="ident" id="5969588">Reader</span><span class="op" id="5969594">)</span>&nbsp;<span class="op" id="5969596">(</span><span class="ident" id="5969597">image</span><span class="op" id="5969602">.</span><span class="ident" id="5969603">Config</span><span class="op" id="5969609">,</span>&nbsp;<span class="builtintype" id="5969611">error</span><span class="op" id="5969616">)</span>&nbsp;<span class="op" id="5969618">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969621">d</span>&nbsp;<span class="op" id="5969623">:=</span>&nbsp;<span class="op" id="5969626">&amp;</span><span class="ident" id="5969627">decoder</span><span class="op" id="5969634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969638">r</span><span class="op" id="5969639">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5969643">r</span><span class="op" id="5969644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969648">crc</span><span class="op" id="5969651">:</span>&nbsp;<span class="ident" id="5969653">crc32</span><span class="op" id="5969658">.</span><span class="ident" id="5969659">NewIEEE</span><span class="op" id="5969666">(</span><span class="op" id="5969667">)</span><span class="op" id="5969668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969674">if</span>&nbsp;<span class="ident" id="5969677">err</span>&nbsp;<span class="op" id="5969681">:=</span>&nbsp;<span class="ident" id="5969684">d</span><span class="op" id="5969685">.</span><span class="ident" id="5969686">checkHeader</span><span class="op" id="5969697">(</span><span class="op" id="5969698">)</span><span class="op" id="5969699">;</span>&nbsp;<span class="ident" id="5969701">err</span>&nbsp;<span class="op" id="5969705">!=</span>&nbsp;<span class="ident" id="5969708">nil</span>&nbsp;<span class="op" id="5969712">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969716">if</span>&nbsp;<span class="ident" id="5969719">err</span>&nbsp;<span class="op" id="5969723">==</span>&nbsp;<span class="ident" id="5969726">io</span><span class="op" id="5969728">.</span><span class="ident" id="5969729">EOF</span>&nbsp;<span class="op" id="5969733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969738">err</span>&nbsp;<span class="op" id="5969742">=</span>&nbsp;<span class="ident" id="5969744">io</span><span class="op" id="5969746">.</span><span class="ident" id="5969747">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969770">return</span>&nbsp;<span class="ident" id="5969777">image</span><span class="op" id="5969782">.</span><span class="ident" id="5969783">Config</span><span class="op" id="5969789">{</span><span class="op" id="5969790">}</span><span class="op" id="5969791">,</span>&nbsp;<span class="ident" id="5969793">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969798">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969801">for</span>&nbsp;<span class="op" id="5969805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969809">if</span>&nbsp;<span class="ident" id="5969812">err</span>&nbsp;<span class="op" id="5969816">:=</span>&nbsp;<span class="ident" id="5969819">d</span><span class="op" id="5969820">.</span><span class="ident" id="5969821">parseChunk</span><span class="op" id="5969831">(</span><span class="op" id="5969832">)</span><span class="op" id="5969833">;</span>&nbsp;<span class="ident" id="5969835">err</span>&nbsp;<span class="op" id="5969839">!=</span>&nbsp;<span class="ident" id="5969842">nil</span>&nbsp;<span class="op" id="5969846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969851">if</span>&nbsp;<span class="ident" id="5969854">err</span>&nbsp;<span class="op" id="5969858">==</span>&nbsp;<span class="ident" id="5969861">io</span><span class="op" id="5969863">.</span><span class="ident" id="5969864">EOF</span>&nbsp;<span class="op" id="5969868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969874">err</span>&nbsp;<span class="op" id="5969878">=</span>&nbsp;<span class="ident" id="5969880">io</span><span class="op" id="5969882">.</span><span class="ident" id="5969883">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969903">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969908">return</span>&nbsp;<span class="ident" id="5969915">image</span><span class="op" id="5969920">.</span><span class="ident" id="5969921">Config</span><span class="op" id="5969927">{</span><span class="op" id="5969928">}</span><span class="op" id="5969929">,</span>&nbsp;<span class="ident" id="5969931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969941">paletted</span>&nbsp;<span class="op" id="5969950">:=</span>&nbsp;<span class="ident" id="5969953">d</span><span class="op" id="5969954">.</span><span class="ident" id="5969955">cb</span>&nbsp;<span class="op" id="5969958">==</span>&nbsp;<span class="ident" id="5969961">cbP8</span>&nbsp;<span class="op" id="5969966">||</span>&nbsp;<span class="ident" id="5969969">d</span><span class="op" id="5969970">.</span><span class="ident" id="5969971">cb</span>&nbsp;<span class="op" id="5969974">==</span>&nbsp;<span class="ident" id="5969977">cbP4</span>&nbsp;<span class="op" id="5969982">||</span>&nbsp;<span class="ident" id="5969985">d</span><span class="op" id="5969986">.</span><span class="ident" id="5969987">cb</span>&nbsp;<span class="op" id="5969990">==</span>&nbsp;<span class="ident" id="5969993">cbP2</span>&nbsp;<span class="op" id="5969998">||</span>&nbsp;<span class="ident" id="5970001">d</span><span class="op" id="5970002">.</span><span class="ident" id="5970003">cb</span>&nbsp;<span class="op" id="5970006">==</span>&nbsp;<span class="ident" id="5970009">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970016">if</span>&nbsp;<span class="ident" id="5970019">d</span><span class="op" id="5970020">.</span><span class="ident" id="5970021">stage</span>&nbsp;<span class="op" id="5970027">==</span>&nbsp;<span class="ident" id="5970030">dsSeenIHDR</span>&nbsp;<span class="op" id="5970041">&amp;&amp;</span>&nbsp;<span class="op" id="5970044">!</span><span class="ident" id="5970045">paletted</span>&nbsp;<span class="op" id="5970054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970059">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970071">if</span>&nbsp;<span class="ident" id="5970074">d</span><span class="op" id="5970075">.</span><span class="ident" id="5970076">stage</span>&nbsp;<span class="op" id="5970082">==</span>&nbsp;<span class="ident" id="5970085">dsSeenPLTE</span>&nbsp;<span class="op" id="5970096">&amp;&amp;</span>&nbsp;<span class="ident" id="5970099">paletted</span>&nbsp;<span class="op" id="5970108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970113">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970124">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970127">var</span>&nbsp;<span class="ident" id="5970131">cm</span>&nbsp;<span class="ident" id="5970134">color</span><span class="op" id="5970139">.</span><span class="ident" id="5970140">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970147">switch</span>&nbsp;<span class="ident" id="5970154">d</span><span class="op" id="5970155">.</span><span class="ident" id="5970156">cb</span>&nbsp;<span class="op" id="5970159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970162">case</span>&nbsp;<span class="ident" id="5970167">cbG1</span><span class="op" id="5970171">,</span>&nbsp;<span class="ident" id="5970173">cbG2</span><span class="op" id="5970177">,</span>&nbsp;<span class="ident" id="5970179">cbG4</span><span class="op" id="5970183">,</span>&nbsp;<span class="ident" id="5970185">cbG8</span><span class="op" id="5970189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970193">cm</span>&nbsp;<span class="op" id="5970196">=</span>&nbsp;<span class="ident" id="5970198">color</span><span class="op" id="5970203">.</span><span class="ident" id="5970204">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970215">case</span>&nbsp;<span class="ident" id="5970220">cbGA8</span><span class="op" id="5970225">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970229">cm</span>&nbsp;<span class="op" id="5970232">=</span>&nbsp;<span class="ident" id="5970234">color</span><span class="op" id="5970239">.</span><span class="ident" id="5970240">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970252">case</span>&nbsp;<span class="ident" id="5970257">cbTC8</span><span class="op" id="5970262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970266">cm</span>&nbsp;<span class="op" id="5970269">=</span>&nbsp;<span class="ident" id="5970271">color</span><span class="op" id="5970276">.</span><span class="ident" id="5970277">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970288">case</span>&nbsp;<span class="ident" id="5970293">cbP1</span><span class="op" id="5970297">,</span>&nbsp;<span class="ident" id="5970299">cbP2</span><span class="op" id="5970303">,</span>&nbsp;<span class="ident" id="5970305">cbP4</span><span class="op" id="5970309">,</span>&nbsp;<span class="ident" id="5970311">cbP8</span><span class="op" id="5970315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970319">cm</span>&nbsp;<span class="op" id="5970322">=</span>&nbsp;<span class="ident" id="5970324">d</span><span class="op" id="5970325">.</span><span class="ident" id="5970326">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970335">case</span>&nbsp;<span class="ident" id="5970340">cbTCA8</span><span class="op" id="5970346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970350">cm</span>&nbsp;<span class="op" id="5970353">=</span>&nbsp;<span class="ident" id="5970355">color</span><span class="op" id="5970360">.</span><span class="ident" id="5970361">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970373">case</span>&nbsp;<span class="ident" id="5970378">cbG16</span><span class="op" id="5970383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970387">cm</span>&nbsp;<span class="op" id="5970390">=</span>&nbsp;<span class="ident" id="5970392">color</span><span class="op" id="5970397">.</span><span class="ident" id="5970398">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970411">case</span>&nbsp;<span class="ident" id="5970416">cbGA16</span><span class="op" id="5970422">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970426">cm</span>&nbsp;<span class="op" id="5970429">=</span>&nbsp;<span class="ident" id="5970431">color</span><span class="op" id="5970436">.</span><span class="ident" id="5970437">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970451">case</span>&nbsp;<span class="ident" id="5970456">cbTC16</span><span class="op" id="5970462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970466">cm</span>&nbsp;<span class="op" id="5970469">=</span>&nbsp;<span class="ident" id="5970471">color</span><span class="op" id="5970476">.</span><span class="ident" id="5970477">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970490">case</span>&nbsp;<span class="ident" id="5970495">cbTCA16</span><span class="op" id="5970502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970506">cm</span>&nbsp;<span class="op" id="5970509">=</span>&nbsp;<span class="ident" id="5970511">color</span><span class="op" id="5970516">.</span><span class="ident" id="5970517">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970534">return</span>&nbsp;<span class="ident" id="5970541">image</span><span class="op" id="5970546">.</span><span class="ident" id="5970547">Config</span><span class="op" id="5970553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970557">ColorModel</span><span class="op" id="5970567">:</span>&nbsp;<span class="ident" id="5970569">cm</span><span class="op" id="5970571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970575">Width</span><span class="op" id="5970580">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970587">d</span><span class="op" id="5970588">.</span><span class="ident" id="5970589">width</span><span class="op" id="5970594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970598">Height</span><span class="op" id="5970604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970610">d</span><span class="op" id="5970611">.</span><span class="ident" id="5970612">height</span><span class="op" id="5970618">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970621">}</span><span class="op" id="5970622">,</span>&nbsp;<span class="ident" id="5970624">nil</span><br>
<span class="lineno"></span><span class="op" id="5970628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5970631">func</span>&nbsp;<span class="ident" id="5970636">init</span><span class="op" id="5970640">(</span><span class="op" id="5970641">)</span>&nbsp;<span class="op" id="5970643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970646">image</span><span class="op" id="5970651">.</span><span class="ident" id="5970652">RegisterFormat</span><span class="op" id="5970666">(</span><span class="string" id="5970667">&#34;png&#34;</span><span class="op" id="5970672">,</span>&nbsp;<span class="ident" id="5970674">pngHeader</span><span class="op" id="5970683">,</span>&nbsp;<span class="ident" id="5970685">Decode</span><span class="op" id="5970691">,</span>&nbsp;<span class="ident" id="5970693">DecodeConfig</span><span class="op" id="5970705">)</span><br>
<span class="lineno">820</span><span class="op" id="5970707">}</span>
</div>
</body>
</html>
