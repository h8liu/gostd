<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html" class="current">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1346477">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1346532">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1346586">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1346637">package</span>&nbsp;<span class="ident" id="1346645">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1346649">type</span>&nbsp;<span class="ident" id="1346654">multiReader</span>&nbsp;<span class="keyword" id="1346666">struct</span>&nbsp;<span class="op" id="1346673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346676">readers</span>&nbsp;<span class="op" id="1346684">[</span><span class="op" id="1346685">]</span><span class="ident" id="1346686">Reader</span><br>
<span class="lineno"></span><span class="op" id="1346693">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1346696">func</span>&nbsp;<span class="op" id="1346701">(</span><span class="ident" id="1346702">mr</span>&nbsp;<span class="op" id="1346705">*</span><span class="ident" id="1346706">multiReader</span><span class="op" id="1346717">)</span>&nbsp;<span class="ident" id="1346719">Read</span><span class="op" id="1346723">(</span><span class="ident" id="1346724">p</span>&nbsp;<span class="op" id="1346726">[</span><span class="op" id="1346727">]</span><span class="builtintype" id="1346728">byte</span><span class="op" id="1346732">)</span>&nbsp;<span class="op" id="1346734">(</span><span class="ident" id="1346735">n</span>&nbsp;<span class="builtintype" id="1346737">int</span><span class="op" id="1346740">,</span>&nbsp;<span class="ident" id="1346742">err</span>&nbsp;<span class="builtintype" id="1346746">error</span><span class="op" id="1346751">)</span>&nbsp;<span class="op" id="1346753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346756">for</span>&nbsp;<span class="builtinfunc" id="1346760">len</span><span class="op" id="1346763">(</span><span class="ident" id="1346764">mr</span><span class="op" id="1346766">.</span><span class="ident" id="1346767">readers</span><span class="op" id="1346774">)</span>&nbsp;<span class="op" id="1346776">&gt;</span>&nbsp;<span class="num" id="1346778">0</span>&nbsp;<span class="op" id="1346780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346784">n</span><span class="op" id="1346785">,</span>&nbsp;<span class="ident" id="1346787">err</span>&nbsp;<span class="op" id="1346791">=</span>&nbsp;<span class="ident" id="1346793">mr</span><span class="op" id="1346795">.</span><span class="ident" id="1346796">readers</span><span class="op" id="1346803">[</span><span class="num" id="1346804">0</span><span class="op" id="1346805">]</span><span class="op" id="1346806">.</span><span class="ident" id="1346807">Read</span><span class="op" id="1346811">(</span><span class="ident" id="1346812">p</span><span class="op" id="1346813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346817">if</span>&nbsp;<span class="ident" id="1346820">n</span>&nbsp;<span class="op" id="1346822">&gt;</span>&nbsp;<span class="num" id="1346824">0</span>&nbsp;<span class="op" id="1346826">||</span>&nbsp;<span class="ident" id="1346829">err</span>&nbsp;<span class="op" id="1346833">!=</span>&nbsp;<span class="ident" id="1346836">EOF</span>&nbsp;<span class="op" id="1346840">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346845">if</span>&nbsp;<span class="ident" id="1346848">err</span>&nbsp;<span class="op" id="1346852">==</span>&nbsp;<span class="ident" id="1346855">EOF</span>&nbsp;<span class="op" id="1346859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1346865">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1346918">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346951">err</span>&nbsp;<span class="op" id="1346955">=</span>&nbsp;<span class="builtintype" id="1346957">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346964">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346982">mr</span><span class="op" id="1346984">.</span><span class="ident" id="1346985">readers</span>&nbsp;<span class="op" id="1346993">=</span>&nbsp;<span class="ident" id="1346995">mr</span><span class="op" id="1346997">.</span><span class="ident" id="1346998">readers</span><span class="op" id="1347005">[</span><span class="num" id="1347006">1</span><span class="op" id="1347007">:</span><span class="op" id="1347008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347014">return</span>&nbsp;<span class="num" id="1347021">0</span><span class="op" id="1347022">,</span>&nbsp;<span class="ident" id="1347024">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1347028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1347031">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1347099">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1347168">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1347242">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1347307">func</span>&nbsp;<span class="ident" id="1347312">MultiReader</span><span class="op" id="1347323">(</span><span class="ident" id="1347324">readers</span>&nbsp;<span class="op" id="1347332">...</span><span class="ident" id="1347335">Reader</span><span class="op" id="1347341">)</span>&nbsp;<span class="ident" id="1347343">Reader</span>&nbsp;<span class="op" id="1347350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347353">r</span>&nbsp;<span class="op" id="1347355">:=</span>&nbsp;<span class="builtinfunc" id="1347358">make</span><span class="op" id="1347362">(</span><span class="op" id="1347363">[</span><span class="op" id="1347364">]</span><span class="ident" id="1347365">Reader</span><span class="op" id="1347371">,</span>&nbsp;<span class="builtinfunc" id="1347373">len</span><span class="op" id="1347376">(</span><span class="ident" id="1347377">readers</span><span class="op" id="1347384">)</span><span class="op" id="1347385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1347388">copy</span><span class="op" id="1347392">(</span><span class="ident" id="1347393">r</span><span class="op" id="1347394">,</span>&nbsp;<span class="ident" id="1347396">readers</span><span class="op" id="1347403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347406">return</span>&nbsp;<span class="op" id="1347413">&amp;</span><span class="ident" id="1347414">multiReader</span><span class="op" id="1347425">{</span><span class="ident" id="1347426">r</span><span class="op" id="1347427">}</span><br>
<span class="lineno">35</span><span class="op" id="1347429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1347432">type</span>&nbsp;<span class="ident" id="1347437">multiWriter</span>&nbsp;<span class="keyword" id="1347449">struct</span>&nbsp;<span class="op" id="1347456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347459">writers</span>&nbsp;<span class="op" id="1347467">[</span><span class="op" id="1347468">]</span><span class="ident" id="1347469">Writer</span><br>
<span class="lineno"></span><span class="op" id="1347476">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1347479">func</span>&nbsp;<span class="op" id="1347484">(</span><span class="ident" id="1347485">t</span>&nbsp;<span class="op" id="1347487">*</span><span class="ident" id="1347488">multiWriter</span><span class="op" id="1347499">)</span>&nbsp;<span class="ident" id="1347501">Write</span><span class="op" id="1347506">(</span><span class="ident" id="1347507">p</span>&nbsp;<span class="op" id="1347509">[</span><span class="op" id="1347510">]</span><span class="builtintype" id="1347511">byte</span><span class="op" id="1347515">)</span>&nbsp;<span class="op" id="1347517">(</span><span class="ident" id="1347518">n</span>&nbsp;<span class="builtintype" id="1347520">int</span><span class="op" id="1347523">,</span>&nbsp;<span class="ident" id="1347525">err</span>&nbsp;<span class="builtintype" id="1347529">error</span><span class="op" id="1347534">)</span>&nbsp;<span class="op" id="1347536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347539">for</span>&nbsp;<span class="ident" id="1347543">_</span><span class="op" id="1347544">,</span>&nbsp;<span class="ident" id="1347546">w</span>&nbsp;<span class="op" id="1347548">:=</span>&nbsp;<span class="keyword" id="1347551">range</span>&nbsp;<span class="ident" id="1347557">t</span><span class="op" id="1347558">.</span><span class="ident" id="1347559">writers</span>&nbsp;<span class="op" id="1347567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347571">n</span><span class="op" id="1347572">,</span>&nbsp;<span class="ident" id="1347574">err</span>&nbsp;<span class="op" id="1347578">=</span>&nbsp;<span class="ident" id="1347580">w</span><span class="op" id="1347581">.</span><span class="ident" id="1347582">Write</span><span class="op" id="1347587">(</span><span class="ident" id="1347588">p</span><span class="op" id="1347589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347593">if</span>&nbsp;<span class="ident" id="1347596">err</span>&nbsp;<span class="op" id="1347600">!=</span>&nbsp;<span class="builtintype" id="1347603">nil</span>&nbsp;<span class="op" id="1347607">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347612">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347625">if</span>&nbsp;<span class="ident" id="1347628">n</span>&nbsp;<span class="op" id="1347630">!=</span>&nbsp;<span class="builtinfunc" id="1347633">len</span><span class="op" id="1347636">(</span><span class="ident" id="1347637">p</span><span class="op" id="1347638">)</span>&nbsp;<span class="op" id="1347640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347645">err</span>&nbsp;<span class="op" id="1347649">=</span>&nbsp;<span class="ident" id="1347651">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347668">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347683">return</span>&nbsp;<span class="builtinfunc" id="1347690">len</span><span class="op" id="1347693">(</span><span class="ident" id="1347694">p</span><span class="op" id="1347695">)</span><span class="op" id="1347696">,</span>&nbsp;<span class="builtintype" id="1347698">nil</span><br>
<span class="lineno"></span><span class="op" id="1347702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1347705">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1347775">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1347832">func</span>&nbsp;<span class="ident" id="1347837">MultiWriter</span><span class="op" id="1347848">(</span><span class="ident" id="1347849">writers</span>&nbsp;<span class="op" id="1347857">...</span><span class="ident" id="1347860">Writer</span><span class="op" id="1347866">)</span>&nbsp;<span class="ident" id="1347868">Writer</span>&nbsp;<span class="op" id="1347875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347878">w</span>&nbsp;<span class="op" id="1347880">:=</span>&nbsp;<span class="builtinfunc" id="1347883">make</span><span class="op" id="1347887">(</span><span class="op" id="1347888">[</span><span class="op" id="1347889">]</span><span class="ident" id="1347890">Writer</span><span class="op" id="1347896">,</span>&nbsp;<span class="builtinfunc" id="1347898">len</span><span class="op" id="1347901">(</span><span class="ident" id="1347902">writers</span><span class="op" id="1347909">)</span><span class="op" id="1347910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1347913">copy</span><span class="op" id="1347917">(</span><span class="ident" id="1347918">w</span><span class="op" id="1347919">,</span>&nbsp;<span class="ident" id="1347921">writers</span><span class="op" id="1347928">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347931">return</span>&nbsp;<span class="op" id="1347938">&amp;</span><span class="ident" id="1347939">multiWriter</span><span class="op" id="1347950">{</span><span class="ident" id="1347951">w</span><span class="op" id="1347952">}</span><br>
<span class="lineno"></span><span class="op" id="1347954">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
