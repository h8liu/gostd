<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html" class="current">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3029415">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3029470">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3029524">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3029575">package</span>&nbsp;<span class="ident" id="3029583">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3029593">import</span>&nbsp;<span class="op" id="3029600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029603">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029612">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029619">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3029630">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3029645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3029648">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="3029722">func</span>&nbsp;<span class="ident" id="3029727">htmlNospaceEscaper</span><span class="op" id="3029745">(</span><span class="ident" id="3029746">args</span>&nbsp;<span class="op" id="3029751">...</span><span class="keyword" id="3029754">interface</span><span class="op" id="3029763">{</span><span class="op" id="3029764">}</span><span class="op" id="3029765">)</span>&nbsp;<span class="builtintype" id="3029767">string</span>&nbsp;<span class="op" id="3029774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029777">s</span><span class="op" id="3029778">,</span>&nbsp;<span class="ident" id="3029780">t</span>&nbsp;<span class="op" id="3029782">:=</span>&nbsp;<span class="ident" id="3029785">stringify</span><span class="op" id="3029794">(</span><span class="ident" id="3029795">args</span><span class="op" id="3029799">...</span><span class="op" id="3029802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029805">if</span>&nbsp;<span class="ident" id="3029808">t</span>&nbsp;<span class="op" id="3029810">==</span>&nbsp;<span class="ident" id="3029813">contentTypeHTML</span>&nbsp;<span class="op" id="3029829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029833">return</span>&nbsp;<span class="ident" id="3029840">htmlReplacer</span><span class="op" id="3029852">(</span><span class="ident" id="3029853">stripTags</span><span class="op" id="3029862">(</span><span class="ident" id="3029863">s</span><span class="op" id="3029864">)</span><span class="op" id="3029865">,</span>&nbsp;<span class="ident" id="3029867">htmlNospaceNormReplacementTable</span><span class="op" id="3029898">,</span>&nbsp;<span class="builtintype" id="3029900">false</span><span class="op" id="3029905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029908">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029911">return</span>&nbsp;<span class="ident" id="3029918">htmlReplacer</span><span class="op" id="3029930">(</span><span class="ident" id="3029931">s</span><span class="op" id="3029932">,</span>&nbsp;<span class="ident" id="3029934">htmlNospaceReplacementTable</span><span class="op" id="3029961">,</span>&nbsp;<span class="builtintype" id="3029963">false</span><span class="op" id="3029968">)</span><br>
<span class="lineno"></span><span class="op" id="3029970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3029973">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3030038">func</span>&nbsp;<span class="ident" id="3030043">attrEscaper</span><span class="op" id="3030054">(</span><span class="ident" id="3030055">args</span>&nbsp;<span class="op" id="3030060">...</span><span class="keyword" id="3030063">interface</span><span class="op" id="3030072">{</span><span class="op" id="3030073">}</span><span class="op" id="3030074">)</span>&nbsp;<span class="builtintype" id="3030076">string</span>&nbsp;<span class="op" id="3030083">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030086">s</span><span class="op" id="3030087">,</span>&nbsp;<span class="ident" id="3030089">t</span>&nbsp;<span class="op" id="3030091">:=</span>&nbsp;<span class="ident" id="3030094">stringify</span><span class="op" id="3030103">(</span><span class="ident" id="3030104">args</span><span class="op" id="3030108">...</span><span class="op" id="3030111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030114">if</span>&nbsp;<span class="ident" id="3030117">t</span>&nbsp;<span class="op" id="3030119">==</span>&nbsp;<span class="ident" id="3030122">contentTypeHTML</span>&nbsp;<span class="op" id="3030138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030142">return</span>&nbsp;<span class="ident" id="3030149">htmlReplacer</span><span class="op" id="3030161">(</span><span class="ident" id="3030162">stripTags</span><span class="op" id="3030171">(</span><span class="ident" id="3030172">s</span><span class="op" id="3030173">)</span><span class="op" id="3030174">,</span>&nbsp;<span class="ident" id="3030176">htmlNormReplacementTable</span><span class="op" id="3030200">,</span>&nbsp;<span class="builtintype" id="3030202">true</span><span class="op" id="3030206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3030209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030212">return</span>&nbsp;<span class="ident" id="3030219">htmlReplacer</span><span class="op" id="3030231">(</span><span class="ident" id="3030232">s</span><span class="op" id="3030233">,</span>&nbsp;<span class="ident" id="3030235">htmlReplacementTable</span><span class="op" id="3030255">,</span>&nbsp;<span class="builtintype" id="3030257">true</span><span class="op" id="3030261">)</span><br>
<span class="lineno">30</span><span class="op" id="3030263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3030266">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="3030332">func</span>&nbsp;<span class="ident" id="3030337">rcdataEscaper</span><span class="op" id="3030350">(</span><span class="ident" id="3030351">args</span>&nbsp;<span class="op" id="3030356">...</span><span class="keyword" id="3030359">interface</span><span class="op" id="3030368">{</span><span class="op" id="3030369">}</span><span class="op" id="3030370">)</span>&nbsp;<span class="builtintype" id="3030372">string</span>&nbsp;<span class="op" id="3030379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030382">s</span><span class="op" id="3030383">,</span>&nbsp;<span class="ident" id="3030385">t</span>&nbsp;<span class="op" id="3030387">:=</span>&nbsp;<span class="ident" id="3030390">stringify</span><span class="op" id="3030399">(</span><span class="ident" id="3030400">args</span><span class="op" id="3030404">...</span><span class="op" id="3030407">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030410">if</span>&nbsp;<span class="ident" id="3030413">t</span>&nbsp;<span class="op" id="3030415">==</span>&nbsp;<span class="ident" id="3030418">contentTypeHTML</span>&nbsp;<span class="op" id="3030434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030438">return</span>&nbsp;<span class="ident" id="3030445">htmlReplacer</span><span class="op" id="3030457">(</span><span class="ident" id="3030458">s</span><span class="op" id="3030459">,</span>&nbsp;<span class="ident" id="3030461">htmlNormReplacementTable</span><span class="op" id="3030485">,</span>&nbsp;<span class="builtintype" id="3030487">true</span><span class="op" id="3030491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3030494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030497">return</span>&nbsp;<span class="ident" id="3030504">htmlReplacer</span><span class="op" id="3030516">(</span><span class="ident" id="3030517">s</span><span class="op" id="3030518">,</span>&nbsp;<span class="ident" id="3030520">htmlReplacementTable</span><span class="op" id="3030540">,</span>&nbsp;<span class="builtintype" id="3030542">true</span><span class="op" id="3030546">)</span><br>
<span class="lineno"></span><span class="op" id="3030548">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3030551">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="3030602">func</span>&nbsp;<span class="ident" id="3030607">htmlEscaper</span><span class="op" id="3030618">(</span><span class="ident" id="3030619">args</span>&nbsp;<span class="op" id="3030624">...</span><span class="keyword" id="3030627">interface</span><span class="op" id="3030636">{</span><span class="op" id="3030637">}</span><span class="op" id="3030638">)</span>&nbsp;<span class="builtintype" id="3030640">string</span>&nbsp;<span class="op" id="3030647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3030650">s</span><span class="op" id="3030651">,</span>&nbsp;<span class="ident" id="3030653">t</span>&nbsp;<span class="op" id="3030655">:=</span>&nbsp;<span class="ident" id="3030658">stringify</span><span class="op" id="3030667">(</span><span class="ident" id="3030668">args</span><span class="op" id="3030672">...</span><span class="op" id="3030675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030678">if</span>&nbsp;<span class="ident" id="3030681">t</span>&nbsp;<span class="op" id="3030683">==</span>&nbsp;<span class="ident" id="3030686">contentTypeHTML</span>&nbsp;<span class="op" id="3030702">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030706">return</span>&nbsp;<span class="ident" id="3030713">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3030716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3030719">return</span>&nbsp;<span class="ident" id="3030726">htmlReplacer</span><span class="op" id="3030738">(</span><span class="ident" id="3030739">s</span><span class="op" id="3030740">,</span>&nbsp;<span class="ident" id="3030742">htmlReplacementTable</span><span class="op" id="3030762">,</span>&nbsp;<span class="builtintype" id="3030764">true</span><span class="op" id="3030768">)</span><br>
<span class="lineno"></span><span class="op" id="3030770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3030773">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="3030840">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3030894">var</span>&nbsp;<span class="ident" id="3030898">htmlReplacementTable</span>&nbsp;<span class="op" id="3030919">=</span>&nbsp;<span class="op" id="3030921">[</span><span class="op" id="3030922">]</span><span class="builtintype" id="3030923">string</span><span class="op" id="3030929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3030932">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031008">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031065">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031123">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031129">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3031147">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3031219">0</span><span class="op" id="3031220">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031225">&#34;\uFFFD&#34;</span><span class="op" id="3031233">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031236">&#39;&#34;&#39;</span><span class="op" id="3031239">:</span>&nbsp;&nbsp;<span class="string" id="3031242">&#34;&amp;#34;&#34;</span><span class="op" id="3031249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031252">&#39;&amp;&#39;</span><span class="op" id="3031255">:</span>&nbsp;&nbsp;<span class="string" id="3031258">&#34;&amp;amp;&#34;</span><span class="op" id="3031265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031268">&#39;\&#39;&#39;</span><span class="op" id="3031272">:</span>&nbsp;<span class="string" id="3031274">&#34;&amp;#39;&#34;</span><span class="op" id="3031281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031284">&#39;+&#39;</span><span class="op" id="3031287">:</span>&nbsp;&nbsp;<span class="string" id="3031290">&#34;&amp;#43;&#34;</span><span class="op" id="3031297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031300">&#39;&lt;&#39;</span><span class="op" id="3031303">:</span>&nbsp;&nbsp;<span class="string" id="3031306">&#34;&amp;lt;&#34;</span><span class="op" id="3031312">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031315">&#39;&gt;&#39;</span><span class="op" id="3031318">:</span>&nbsp;&nbsp;<span class="string" id="3031321">&#34;&amp;gt;&#34;</span><span class="op" id="3031327">,</span><br>
<span class="lineno"></span><span class="op" id="3031329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3031332">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3031408">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="3031450">var</span>&nbsp;<span class="ident" id="3031454">htmlNormReplacementTable</span>&nbsp;<span class="op" id="3031479">=</span>&nbsp;<span class="op" id="3031481">[</span><span class="op" id="3031482">]</span><span class="builtintype" id="3031483">string</span><span class="op" id="3031489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3031492">0</span><span class="op" id="3031493">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031498">&#34;\uFFFD&#34;</span><span class="op" id="3031506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031509">&#39;&#34;&#39;</span><span class="op" id="3031512">:</span>&nbsp;&nbsp;<span class="string" id="3031515">&#34;&amp;#34;&#34;</span><span class="op" id="3031522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031525">&#39;\&#39;&#39;</span><span class="op" id="3031529">:</span>&nbsp;<span class="string" id="3031531">&#34;&amp;#39;&#34;</span><span class="op" id="3031538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031541">&#39;+&#39;</span><span class="op" id="3031544">:</span>&nbsp;&nbsp;<span class="string" id="3031547">&#34;&amp;#43;&#34;</span><span class="op" id="3031554">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031557">&#39;&lt;&#39;</span><span class="op" id="3031560">:</span>&nbsp;&nbsp;<span class="string" id="3031563">&#34;&amp;lt;&#34;</span><span class="op" id="3031569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3031572">&#39;&gt;&#39;</span><span class="op" id="3031575">:</span>&nbsp;&nbsp;<span class="string" id="3031578">&#34;&amp;gt;&#34;</span><span class="op" id="3031584">,</span><br>
<span class="lineno"></span><span class="op" id="3031586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3031589">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="3031663">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3031702">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3031768">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="3031825">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3031845">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="3031871">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="3031929">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="3031964">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="3031997">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3032059">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="3032103">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3032172">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3032177">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="3032210">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="3032227">var</span>&nbsp;<span class="ident" id="3032231">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="3032259">=</span>&nbsp;<span class="op" id="3032261">[</span><span class="op" id="3032262">]</span><span class="builtintype" id="3032263">string</span><span class="op" id="3032269">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3032272">0</span><span class="op" id="3032273">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032278">&#34;&amp;#xfffd;&#34;</span><span class="op" id="3032288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032291">&#39;\t&#39;</span><span class="op" id="3032295">:</span>&nbsp;<span class="string" id="3032297">&#34;&amp;#9;&#34;</span><span class="op" id="3032303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032306">&#39;\n&#39;</span><span class="op" id="3032310">:</span>&nbsp;<span class="string" id="3032312">&#34;&amp;#10;&#34;</span><span class="op" id="3032319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032322">&#39;\v&#39;</span><span class="op" id="3032326">:</span>&nbsp;<span class="string" id="3032328">&#34;&amp;#11;&#34;</span><span class="op" id="3032335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032338">&#39;\f&#39;</span><span class="op" id="3032342">:</span>&nbsp;<span class="string" id="3032344">&#34;&amp;#12;&#34;</span><span class="op" id="3032351">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032354">&#39;\r&#39;</span><span class="op" id="3032358">:</span>&nbsp;<span class="string" id="3032360">&#34;&amp;#13;&#34;</span><span class="op" id="3032367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032370">&#39;&nbsp;&#39;</span><span class="op" id="3032373">:</span>&nbsp;&nbsp;<span class="string" id="3032376">&#34;&amp;#32;&#34;</span><span class="op" id="3032383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032386">&#39;&#34;&#39;</span><span class="op" id="3032389">:</span>&nbsp;&nbsp;<span class="string" id="3032392">&#34;&amp;#34;&#34;</span><span class="op" id="3032399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032402">&#39;&amp;&#39;</span><span class="op" id="3032405">:</span>&nbsp;&nbsp;<span class="string" id="3032408">&#34;&amp;amp;&#34;</span><span class="op" id="3032415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032418">&#39;\&#39;&#39;</span><span class="op" id="3032422">:</span>&nbsp;<span class="string" id="3032424">&#34;&amp;#39;&#34;</span><span class="op" id="3032431">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032434">&#39;+&#39;</span><span class="op" id="3032437">:</span>&nbsp;&nbsp;<span class="string" id="3032440">&#34;&amp;#43;&#34;</span><span class="op" id="3032447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032450">&#39;&lt;&#39;</span><span class="op" id="3032453">:</span>&nbsp;&nbsp;<span class="string" id="3032456">&#34;&amp;lt;&#34;</span><span class="op" id="3032462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032465">&#39;=&#39;</span><span class="op" id="3032468">:</span>&nbsp;&nbsp;<span class="string" id="3032471">&#34;&amp;#61;&#34;</span><span class="op" id="3032478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032481">&#39;&gt;&#39;</span><span class="op" id="3032484">:</span>&nbsp;&nbsp;<span class="string" id="3032487">&#34;&amp;gt;&#34;</span><span class="op" id="3032493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032496">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032552">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3032587">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032629">&#39;`&#39;</span><span class="op" id="3032632">:</span>&nbsp;<span class="string" id="3032634">&#34;&amp;#96;&#34;</span><span class="op" id="3032641">,</span><br>
<span class="lineno"></span><span class="op" id="3032643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3032646">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="3032721">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="3032778">var</span>&nbsp;<span class="ident" id="3032782">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="3032814">=</span>&nbsp;<span class="op" id="3032816">[</span><span class="op" id="3032817">]</span><span class="builtintype" id="3032818">string</span><span class="op" id="3032824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3032827">0</span><span class="op" id="3032828">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032833">&#34;&amp;#xfffd;&#34;</span><span class="op" id="3032843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032846">&#39;\t&#39;</span><span class="op" id="3032850">:</span>&nbsp;<span class="string" id="3032852">&#34;&amp;#9;&#34;</span><span class="op" id="3032858">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032861">&#39;\n&#39;</span><span class="op" id="3032865">:</span>&nbsp;<span class="string" id="3032867">&#34;&amp;#10;&#34;</span><span class="op" id="3032874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032877">&#39;\v&#39;</span><span class="op" id="3032881">:</span>&nbsp;<span class="string" id="3032883">&#34;&amp;#11;&#34;</span><span class="op" id="3032890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032893">&#39;\f&#39;</span><span class="op" id="3032897">:</span>&nbsp;<span class="string" id="3032899">&#34;&amp;#12;&#34;</span><span class="op" id="3032906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032909">&#39;\r&#39;</span><span class="op" id="3032913">:</span>&nbsp;<span class="string" id="3032915">&#34;&amp;#13;&#34;</span><span class="op" id="3032922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032925">&#39;&nbsp;&#39;</span><span class="op" id="3032928">:</span>&nbsp;&nbsp;<span class="string" id="3032931">&#34;&amp;#32;&#34;</span><span class="op" id="3032938">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032941">&#39;&#34;&#39;</span><span class="op" id="3032944">:</span>&nbsp;&nbsp;<span class="string" id="3032947">&#34;&amp;#34;&#34;</span><span class="op" id="3032954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032957">&#39;\&#39;&#39;</span><span class="op" id="3032961">:</span>&nbsp;<span class="string" id="3032963">&#34;&amp;#39;&#34;</span><span class="op" id="3032970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032973">&#39;+&#39;</span><span class="op" id="3032976">:</span>&nbsp;&nbsp;<span class="string" id="3032979">&#34;&amp;#43;&#34;</span><span class="op" id="3032986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3032989">&#39;&lt;&#39;</span><span class="op" id="3032992">:</span>&nbsp;&nbsp;<span class="string" id="3032995">&#34;&amp;lt;&#34;</span><span class="op" id="3033001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3033004">&#39;=&#39;</span><span class="op" id="3033007">:</span>&nbsp;&nbsp;<span class="string" id="3033010">&#34;&amp;#61;&#34;</span><span class="op" id="3033017">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3033020">&#39;&gt;&#39;</span><span class="op" id="3033023">:</span>&nbsp;&nbsp;<span class="string" id="3033026">&#34;&amp;gt;&#34;</span><span class="op" id="3033032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033035">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033091">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033126">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3033168">&#39;`&#39;</span><span class="op" id="3033171">:</span>&nbsp;<span class="string" id="3033173">&#34;&amp;#96;&#34;</span><span class="op" id="3033180">,</span><br>
<span class="lineno">135</span><span class="op" id="3033182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3033185">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="3033261">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3033340">func</span>&nbsp;<span class="ident" id="3033345">htmlReplacer</span><span class="op" id="3033357">(</span><span class="ident" id="3033358">s</span>&nbsp;<span class="builtintype" id="3033360">string</span><span class="op" id="3033366">,</span>&nbsp;<span class="ident" id="3033368">replacementTable</span>&nbsp;<span class="op" id="3033385">[</span><span class="op" id="3033386">]</span><span class="builtintype" id="3033387">string</span><span class="op" id="3033393">,</span>&nbsp;<span class="ident" id="3033395">badRunes</span>&nbsp;<span class="builtintype" id="3033404">bool</span><span class="op" id="3033408">)</span>&nbsp;<span class="builtintype" id="3033410">string</span>&nbsp;<span class="op" id="3033417">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033420">written</span><span class="op" id="3033427">,</span>&nbsp;<span class="ident" id="3033429">b</span>&nbsp;<span class="op" id="3033431">:=</span>&nbsp;<span class="num" id="3033434">0</span><span class="op" id="3033435">,</span>&nbsp;<span class="builtinfunc" id="3033437">new</span><span class="op" id="3033440">(</span><span class="ident" id="3033441">bytes</span><span class="op" id="3033446">.</span><span class="ident" id="3033447">Buffer</span><span class="op" id="3033453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033456">for</span>&nbsp;<span class="ident" id="3033460">i</span><span class="op" id="3033461">,</span>&nbsp;<span class="ident" id="3033463">r</span>&nbsp;<span class="op" id="3033465">:=</span>&nbsp;<span class="keyword" id="3033468">range</span>&nbsp;<span class="ident" id="3033474">s</span>&nbsp;<span class="op" id="3033476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033480">if</span>&nbsp;<span class="builtintype" id="3033483">int</span><span class="op" id="3033486">(</span><span class="ident" id="3033487">r</span><span class="op" id="3033488">)</span>&nbsp;<span class="op" id="3033490">&lt;</span>&nbsp;<span class="builtinfunc" id="3033492">len</span><span class="op" id="3033495">(</span><span class="ident" id="3033496">replacementTable</span><span class="op" id="3033512">)</span>&nbsp;<span class="op" id="3033514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033519">if</span>&nbsp;<span class="ident" id="3033522">repl</span>&nbsp;<span class="op" id="3033527">:=</span>&nbsp;<span class="ident" id="3033530">replacementTable</span><span class="op" id="3033546">[</span><span class="ident" id="3033547">r</span><span class="op" id="3033548">]</span><span class="op" id="3033549">;</span>&nbsp;<span class="builtinfunc" id="3033551">len</span><span class="op" id="3033554">(</span><span class="ident" id="3033555">repl</span><span class="op" id="3033559">)</span>&nbsp;<span class="op" id="3033561">!=</span>&nbsp;<span class="num" id="3033564">0</span>&nbsp;<span class="op" id="3033566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033572">b</span><span class="op" id="3033573">.</span><span class="ident" id="3033574">WriteString</span><span class="op" id="3033585">(</span><span class="ident" id="3033586">s</span><span class="op" id="3033587">[</span><span class="ident" id="3033588">written</span><span class="op" id="3033595">:</span><span class="ident" id="3033596">i</span><span class="op" id="3033597">]</span><span class="op" id="3033598">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033604">b</span><span class="op" id="3033605">.</span><span class="ident" id="3033606">WriteString</span><span class="op" id="3033617">(</span><span class="ident" id="3033618">repl</span><span class="op" id="3033622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033628">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033677">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033713">written</span>&nbsp;<span class="op" id="3033721">=</span>&nbsp;<span class="ident" id="3033723">i</span>&nbsp;<span class="op" id="3033725">+</span>&nbsp;<span class="ident" id="3033727">utf8</span><span class="op" id="3033731">.</span><span class="ident" id="3033732">RuneLen</span><span class="op" id="3033739">(</span><span class="ident" id="3033740">r</span><span class="op" id="3033741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033746">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033750">}</span>&nbsp;<span class="keyword" id="3033752">else</span>&nbsp;<span class="keyword" id="3033757">if</span>&nbsp;<span class="ident" id="3033760">badRunes</span>&nbsp;<span class="op" id="3033769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033774">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3033787">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033842">}</span>&nbsp;<span class="keyword" id="3033844">else</span>&nbsp;<span class="keyword" id="3033849">if</span>&nbsp;<span class="num" id="3033852">0xfdd0</span>&nbsp;<span class="op" id="3033859">&lt;=</span>&nbsp;<span class="ident" id="3033862">r</span>&nbsp;<span class="op" id="3033864">&amp;&amp;</span>&nbsp;<span class="ident" id="3033867">r</span>&nbsp;<span class="op" id="3033869">&lt;=</span>&nbsp;<span class="num" id="3033872">0xfdef</span>&nbsp;<span class="op" id="3033879">||</span>&nbsp;<span class="num" id="3033882">0xfff0</span>&nbsp;<span class="op" id="3033889">&lt;=</span>&nbsp;<span class="ident" id="3033892">r</span>&nbsp;<span class="op" id="3033894">&amp;&amp;</span>&nbsp;<span class="ident" id="3033897">r</span>&nbsp;<span class="op" id="3033899">&lt;=</span>&nbsp;<span class="num" id="3033902">0xffff</span>&nbsp;<span class="op" id="3033909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033914">fmt</span><span class="op" id="3033917">.</span><span class="ident" id="3033918">Fprintf</span><span class="op" id="3033925">(</span><span class="ident" id="3033926">b</span><span class="op" id="3033927">,</span>&nbsp;<span class="string" id="3033929">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="3033939">,</span>&nbsp;<span class="ident" id="3033941">s</span><span class="op" id="3033942">[</span><span class="ident" id="3033943">written</span><span class="op" id="3033950">:</span><span class="ident" id="3033951">i</span><span class="op" id="3033952">]</span><span class="op" id="3033953">,</span>&nbsp;<span class="ident" id="3033955">r</span><span class="op" id="3033956">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3033961">written</span>&nbsp;<span class="op" id="3033969">=</span>&nbsp;<span class="ident" id="3033971">i</span>&nbsp;<span class="op" id="3033973">+</span>&nbsp;<span class="ident" id="3033975">utf8</span><span class="op" id="3033979">.</span><span class="ident" id="3033980">RuneLen</span><span class="op" id="3033987">(</span><span class="ident" id="3033988">r</span><span class="op" id="3033989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3033996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3033999">if</span>&nbsp;<span class="ident" id="3034002">written</span>&nbsp;<span class="op" id="3034010">==</span>&nbsp;<span class="num" id="3034013">0</span>&nbsp;<span class="op" id="3034015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034019">return</span>&nbsp;<span class="ident" id="3034026">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034032">b</span><span class="op" id="3034033">.</span><span class="ident" id="3034034">WriteString</span><span class="op" id="3034045">(</span><span class="ident" id="3034046">s</span><span class="op" id="3034047">[</span><span class="ident" id="3034048">written</span><span class="op" id="3034055">:</span><span class="op" id="3034056">]</span><span class="op" id="3034057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034060">return</span>&nbsp;<span class="ident" id="3034067">b</span><span class="op" id="3034068">.</span><span class="ident" id="3034069">String</span><span class="op" id="3034075">(</span><span class="op" id="3034076">)</span><br>
<span class="lineno"></span><span class="op" id="3034078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3034081">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="3034153">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="3034228">func</span>&nbsp;<span class="ident" id="3034233">stripTags</span><span class="op" id="3034242">(</span><span class="ident" id="3034243">html</span>&nbsp;<span class="builtintype" id="3034248">string</span><span class="op" id="3034254">)</span>&nbsp;<span class="builtintype" id="3034256">string</span>&nbsp;<span class="op" id="3034263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034266">var</span>&nbsp;<span class="ident" id="3034270">b</span>&nbsp;<span class="ident" id="3034272">bytes</span><span class="op" id="3034277">.</span><span class="ident" id="3034278">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034286">s</span><span class="op" id="3034287">,</span>&nbsp;<span class="ident" id="3034289">c</span><span class="op" id="3034290">,</span>&nbsp;<span class="ident" id="3034292">i</span><span class="op" id="3034293">,</span>&nbsp;<span class="ident" id="3034295">allText</span>&nbsp;<span class="op" id="3034303">:=</span>&nbsp;<span class="op" id="3034306">[</span><span class="op" id="3034307">]</span><span class="builtintype" id="3034308">byte</span><span class="op" id="3034312">(</span><span class="ident" id="3034313">html</span><span class="op" id="3034317">)</span><span class="op" id="3034318">,</span>&nbsp;<span class="ident" id="3034320">context</span><span class="op" id="3034327">{</span><span class="op" id="3034328">}</span><span class="op" id="3034329">,</span>&nbsp;<span class="num" id="3034331">0</span><span class="op" id="3034332">,</span>&nbsp;<span class="builtintype" id="3034334">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034340">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034395">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034438">for</span>&nbsp;<span class="ident" id="3034442">i</span>&nbsp;<span class="op" id="3034444">!=</span>&nbsp;<span class="builtinfunc" id="3034447">len</span><span class="op" id="3034450">(</span><span class="ident" id="3034451">s</span><span class="op" id="3034452">)</span>&nbsp;<span class="op" id="3034454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034458">if</span>&nbsp;<span class="ident" id="3034461">c</span><span class="op" id="3034462">.</span><span class="ident" id="3034463">delim</span>&nbsp;<span class="op" id="3034469">==</span>&nbsp;<span class="ident" id="3034472">delimNone</span>&nbsp;<span class="op" id="3034482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034487">st</span>&nbsp;<span class="op" id="3034490">:=</span>&nbsp;<span class="ident" id="3034493">c</span><span class="op" id="3034494">.</span><span class="ident" id="3034495">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034504">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034563">if</span>&nbsp;<span class="ident" id="3034566">c</span><span class="op" id="3034567">.</span><span class="ident" id="3034568">element</span>&nbsp;<span class="op" id="3034576">!=</span>&nbsp;<span class="ident" id="3034579">elementNone</span>&nbsp;<span class="op" id="3034591">&amp;&amp;</span>&nbsp;<span class="op" id="3034594">!</span><span class="ident" id="3034595">isInTag</span><span class="op" id="3034602">(</span><span class="ident" id="3034603">st</span><span class="op" id="3034605">)</span>&nbsp;<span class="op" id="3034607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034613">st</span>&nbsp;<span class="op" id="3034616">=</span>&nbsp;<span class="ident" id="3034618">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034638">d</span><span class="op" id="3034639">,</span>&nbsp;<span class="ident" id="3034641">nread</span>&nbsp;<span class="op" id="3034647">:=</span>&nbsp;<span class="ident" id="3034650">transitionFunc</span><span class="op" id="3034664">[</span><span class="ident" id="3034665">st</span><span class="op" id="3034667">]</span><span class="op" id="3034668">(</span><span class="ident" id="3034669">c</span><span class="op" id="3034670">,</span>&nbsp;<span class="ident" id="3034672">s</span><span class="op" id="3034673">[</span><span class="ident" id="3034674">i</span><span class="op" id="3034675">:</span><span class="op" id="3034676">]</span><span class="op" id="3034677">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034682">i1</span>&nbsp;<span class="op" id="3034685">:=</span>&nbsp;<span class="ident" id="3034688">i</span>&nbsp;<span class="op" id="3034690">+</span>&nbsp;<span class="ident" id="3034692">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034701">if</span>&nbsp;<span class="ident" id="3034704">c</span><span class="op" id="3034705">.</span><span class="ident" id="3034706">state</span>&nbsp;<span class="op" id="3034712">==</span>&nbsp;<span class="ident" id="3034715">stateText</span>&nbsp;<span class="op" id="3034725">||</span>&nbsp;<span class="ident" id="3034728">c</span><span class="op" id="3034729">.</span><span class="ident" id="3034730">state</span>&nbsp;<span class="op" id="3034736">==</span>&nbsp;<span class="ident" id="3034739">stateRCDATA</span>&nbsp;<span class="op" id="3034751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3034757">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034813">j</span>&nbsp;<span class="op" id="3034815">:=</span>&nbsp;<span class="ident" id="3034818">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034825">if</span>&nbsp;<span class="ident" id="3034828">d</span><span class="op" id="3034829">.</span><span class="ident" id="3034830">state</span>&nbsp;<span class="op" id="3034836">!=</span>&nbsp;<span class="ident" id="3034839">c</span><span class="op" id="3034840">.</span><span class="ident" id="3034841">state</span>&nbsp;<span class="op" id="3034847">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034854">for</span>&nbsp;<span class="ident" id="3034858">j1</span>&nbsp;<span class="op" id="3034861">:=</span>&nbsp;<span class="ident" id="3034864">j</span>&nbsp;<span class="op" id="3034866">-</span>&nbsp;<span class="num" id="3034868">1</span><span class="op" id="3034869">;</span>&nbsp;<span class="ident" id="3034871">j1</span>&nbsp;<span class="op" id="3034874">&gt;=</span>&nbsp;<span class="ident" id="3034877">i</span><span class="op" id="3034878">;</span>&nbsp;<span class="ident" id="3034880">j1</span><span class="op" id="3034882">--</span>&nbsp;<span class="op" id="3034885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034893">if</span>&nbsp;<span class="ident" id="3034896">s</span><span class="op" id="3034897">[</span><span class="ident" id="3034898">j1</span><span class="op" id="3034900">]</span>&nbsp;<span class="op" id="3034902">==</span>&nbsp;<span class="string" id="3034905">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3034909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034918">j</span>&nbsp;<span class="op" id="3034920">=</span>&nbsp;<span class="ident" id="3034922">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3034932">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034944">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034963">b</span><span class="op" id="3034964">.</span><span class="ident" id="3034965">Write</span><span class="op" id="3034970">(</span><span class="ident" id="3034971">s</span><span class="op" id="3034972">[</span><span class="ident" id="3034973">i</span><span class="op" id="3034974">:</span><span class="ident" id="3034975">j</span><span class="op" id="3034976">]</span><span class="op" id="3034977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3034982">}</span>&nbsp;<span class="keyword" id="3034984">else</span>&nbsp;<span class="op" id="3034989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3034995">allText</span>&nbsp;<span class="op" id="3035003">=</span>&nbsp;<span class="builtintype" id="3035005">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035019">c</span><span class="op" id="3035020">,</span>&nbsp;<span class="ident" id="3035022">i</span>&nbsp;<span class="op" id="3035024">=</span>&nbsp;<span class="ident" id="3035026">d</span><span class="op" id="3035027">,</span>&nbsp;<span class="ident" id="3035029">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035035">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035050">i1</span>&nbsp;<span class="op" id="3035053">:=</span>&nbsp;<span class="ident" id="3035056">i</span>&nbsp;<span class="op" id="3035058">+</span>&nbsp;<span class="ident" id="3035060">bytes</span><span class="op" id="3035065">.</span><span class="ident" id="3035066">IndexAny</span><span class="op" id="3035074">(</span><span class="ident" id="3035075">s</span><span class="op" id="3035076">[</span><span class="ident" id="3035077">i</span><span class="op" id="3035078">:</span><span class="op" id="3035079">]</span><span class="op" id="3035080">,</span>&nbsp;<span class="ident" id="3035082">delimEnds</span><span class="op" id="3035091">[</span><span class="ident" id="3035092">c</span><span class="op" id="3035093">.</span><span class="ident" id="3035094">delim</span><span class="op" id="3035099">]</span><span class="op" id="3035100">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035104">if</span>&nbsp;<span class="ident" id="3035107">i1</span>&nbsp;<span class="op" id="3035110">&lt;</span>&nbsp;<span class="ident" id="3035112">i</span>&nbsp;<span class="op" id="3035114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035119">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035131">if</span>&nbsp;<span class="ident" id="3035134">c</span><span class="op" id="3035135">.</span><span class="ident" id="3035136">delim</span>&nbsp;<span class="op" id="3035142">!=</span>&nbsp;<span class="ident" id="3035145">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="3035164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035169">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035194">i1</span><span class="op" id="3035196">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035205">c</span><span class="op" id="3035206">,</span>&nbsp;<span class="ident" id="3035208">i</span>&nbsp;<span class="op" id="3035210">=</span>&nbsp;<span class="ident" id="3035212">context</span><span class="op" id="3035219">{</span><span class="ident" id="3035220">state</span><span class="op" id="3035225">:</span>&nbsp;<span class="ident" id="3035227">stateTag</span><span class="op" id="3035235">,</span>&nbsp;<span class="ident" id="3035237">element</span><span class="op" id="3035244">:</span>&nbsp;<span class="ident" id="3035246">c</span><span class="op" id="3035247">.</span><span class="ident" id="3035248">element</span><span class="op" id="3035255">}</span><span class="op" id="3035256">,</span>&nbsp;<span class="ident" id="3035258">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035265">if</span>&nbsp;<span class="ident" id="3035268">allText</span>&nbsp;<span class="op" id="3035276">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035280">return</span>&nbsp;<span class="ident" id="3035287">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035293">}</span>&nbsp;<span class="keyword" id="3035295">else</span>&nbsp;<span class="keyword" id="3035300">if</span>&nbsp;<span class="ident" id="3035303">c</span><span class="op" id="3035304">.</span><span class="ident" id="3035305">state</span>&nbsp;<span class="op" id="3035311">==</span>&nbsp;<span class="ident" id="3035314">stateText</span>&nbsp;<span class="op" id="3035324">||</span>&nbsp;<span class="ident" id="3035327">c</span><span class="op" id="3035328">.</span><span class="ident" id="3035329">state</span>&nbsp;<span class="op" id="3035335">==</span>&nbsp;<span class="ident" id="3035338">stateRCDATA</span>&nbsp;<span class="op" id="3035350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035354">b</span><span class="op" id="3035355">.</span><span class="ident" id="3035356">Write</span><span class="op" id="3035361">(</span><span class="ident" id="3035362">s</span><span class="op" id="3035363">[</span><span class="ident" id="3035364">i</span><span class="op" id="3035365">:</span><span class="op" id="3035366">]</span><span class="op" id="3035367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035373">return</span>&nbsp;<span class="ident" id="3035380">b</span><span class="op" id="3035381">.</span><span class="ident" id="3035382">String</span><span class="op" id="3035388">(</span><span class="op" id="3035389">)</span><br>
<span class="lineno">215</span><span class="op" id="3035391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3035394">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3035468">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="3035500">func</span>&nbsp;<span class="ident" id="3035505">htmlNameFilter</span><span class="op" id="3035519">(</span><span class="ident" id="3035520">args</span>&nbsp;<span class="op" id="3035525">...</span><span class="keyword" id="3035528">interface</span><span class="op" id="3035537">{</span><span class="op" id="3035538">}</span><span class="op" id="3035539">)</span>&nbsp;<span class="builtintype" id="3035541">string</span>&nbsp;<span class="op" id="3035548">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035551">s</span><span class="op" id="3035552">,</span>&nbsp;<span class="ident" id="3035554">t</span>&nbsp;<span class="op" id="3035556">:=</span>&nbsp;<span class="ident" id="3035559">stringify</span><span class="op" id="3035568">(</span><span class="ident" id="3035569">args</span><span class="op" id="3035573">...</span><span class="op" id="3035576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035579">if</span>&nbsp;<span class="ident" id="3035582">t</span>&nbsp;<span class="op" id="3035584">==</span>&nbsp;<span class="ident" id="3035587">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="3035607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035611">return</span>&nbsp;<span class="ident" id="3035618">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035624">if</span>&nbsp;<span class="builtinfunc" id="3035627">len</span><span class="op" id="3035630">(</span><span class="ident" id="3035631">s</span><span class="op" id="3035632">)</span>&nbsp;<span class="op" id="3035634">==</span>&nbsp;<span class="num" id="3035637">0</span>&nbsp;<span class="op" id="3035639">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035643">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035691">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035727">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035785">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035846">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035861">return</span>&nbsp;<span class="ident" id="3035868">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3035884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035887">s</span>&nbsp;<span class="op" id="3035889">=</span>&nbsp;<span class="ident" id="3035891">strings</span><span class="op" id="3035898">.</span><span class="ident" id="3035899">ToLower</span><span class="op" id="3035906">(</span><span class="ident" id="3035907">s</span><span class="op" id="3035908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3035911">if</span>&nbsp;<span class="ident" id="3035914">t</span>&nbsp;<span class="op" id="3035916">:=</span>&nbsp;<span class="ident" id="3035919">attrType</span><span class="op" id="3035927">(</span><span class="ident" id="3035928">s</span><span class="op" id="3035929">)</span><span class="op" id="3035930">;</span>&nbsp;<span class="ident" id="3035932">t</span>&nbsp;<span class="op" id="3035934">!=</span>&nbsp;<span class="ident" id="3035937">contentTypePlain</span>&nbsp;<span class="op" id="3035954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3035958">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3036030">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036047">return</span>&nbsp;<span class="ident" id="3036054">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036073">for</span>&nbsp;<span class="ident" id="3036077">_</span><span class="op" id="3036078">,</span>&nbsp;<span class="ident" id="3036080">r</span>&nbsp;<span class="op" id="3036082">:=</span>&nbsp;<span class="keyword" id="3036085">range</span>&nbsp;<span class="ident" id="3036091">s</span>&nbsp;<span class="op" id="3036093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036097">switch</span>&nbsp;<span class="op" id="3036104">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036108">case</span>&nbsp;<span class="string" id="3036113">&#39;0&#39;</span>&nbsp;<span class="op" id="3036117">&lt;=</span>&nbsp;<span class="ident" id="3036120">r</span>&nbsp;<span class="op" id="3036122">&amp;&amp;</span>&nbsp;<span class="ident" id="3036125">r</span>&nbsp;<span class="op" id="3036127">&lt;=</span>&nbsp;<span class="string" id="3036130">&#39;9&#39;</span><span class="op" id="3036133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036137">case</span>&nbsp;<span class="string" id="3036142">&#39;a&#39;</span>&nbsp;<span class="op" id="3036146">&lt;=</span>&nbsp;<span class="ident" id="3036149">r</span>&nbsp;<span class="op" id="3036151">&amp;&amp;</span>&nbsp;<span class="ident" id="3036154">r</span>&nbsp;<span class="op" id="3036156">&lt;=</span>&nbsp;<span class="string" id="3036159">&#39;z&#39;</span><span class="op" id="3036162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036166">default</span><span class="op" id="3036173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036178">return</span>&nbsp;<span class="ident" id="3036185">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036202">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3036205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036208">return</span>&nbsp;<span class="ident" id="3036215">s</span><br>
<span class="lineno"></span><span class="op" id="3036217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3036220">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="3036284">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3036350">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="3036427">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="3036466">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3036541">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="3036571">func</span>&nbsp;<span class="ident" id="3036576">commentEscaper</span><span class="op" id="3036590">(</span><span class="ident" id="3036591">args</span>&nbsp;<span class="op" id="3036596">...</span><span class="keyword" id="3036599">interface</span><span class="op" id="3036608">{</span><span class="op" id="3036609">}</span><span class="op" id="3036610">)</span>&nbsp;<span class="builtintype" id="3036612">string</span>&nbsp;<span class="op" id="3036619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3036622">return</span>&nbsp;<span class="string" id="3036629">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3036632">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
