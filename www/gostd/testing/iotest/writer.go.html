<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5169232">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5169287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5169341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5169392">package</span>&nbsp;<span class="ident" id="5169400">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5169408">import</span>&nbsp;<span class="string" id="5169415">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5169421">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="5169473">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5169510">func</span>&nbsp;<span class="ident" id="5169515">TruncateWriter</span><span class="op" id="5169529">(</span><span class="ident" id="5169530">w</span>&nbsp;<span class="ident" id="5169532">io</span><span class="op" id="5169534">.</span><span class="ident" id="5169535">Writer</span><span class="op" id="5169541">,</span>&nbsp;<span class="ident" id="5169543">n</span>&nbsp;<span class="ident" id="5169545">int64</span><span class="op" id="5169550">)</span>&nbsp;<span class="ident" id="5169552">io</span><span class="op" id="5169554">.</span><span class="ident" id="5169555">Writer</span>&nbsp;<span class="op" id="5169562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169565">return</span>&nbsp;<span class="op" id="5169572">&amp;</span><span class="ident" id="5169573">truncateWriter</span><span class="op" id="5169587">{</span><span class="ident" id="5169588">w</span><span class="op" id="5169589">,</span>&nbsp;<span class="ident" id="5169591">n</span><span class="op" id="5169592">}</span><br>
<span class="lineno"></span><span class="op" id="5169594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5169597">type</span>&nbsp;<span class="ident" id="5169602">truncateWriter</span>&nbsp;<span class="keyword" id="5169617">struct</span>&nbsp;<span class="op" id="5169624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169627">w</span>&nbsp;<span class="ident" id="5169629">io</span><span class="op" id="5169631">.</span><span class="ident" id="5169632">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169640">n</span>&nbsp;<span class="ident" id="5169642">int64</span><br>
<span class="lineno"></span><span class="op" id="5169648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5169651">func</span>&nbsp;<span class="op" id="5169656">(</span><span class="ident" id="5169657">t</span>&nbsp;<span class="op" id="5169659">*</span><span class="ident" id="5169660">truncateWriter</span><span class="op" id="5169674">)</span>&nbsp;<span class="ident" id="5169676">Write</span><span class="op" id="5169681">(</span><span class="ident" id="5169682">p</span>&nbsp;<span class="op" id="5169684">[</span><span class="op" id="5169685">]</span><span class="builtintype" id="5169686">byte</span><span class="op" id="5169690">)</span>&nbsp;<span class="op" id="5169692">(</span><span class="ident" id="5169693">n</span>&nbsp;<span class="builtintype" id="5169695">int</span><span class="op" id="5169698">,</span>&nbsp;<span class="ident" id="5169700">err</span>&nbsp;<span class="builtintype" id="5169704">error</span><span class="op" id="5169709">)</span>&nbsp;<span class="op" id="5169711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169714">if</span>&nbsp;<span class="ident" id="5169717">t</span><span class="op" id="5169718">.</span><span class="ident" id="5169719">n</span>&nbsp;<span class="op" id="5169721">&lt;=</span>&nbsp;<span class="num" id="5169724">0</span>&nbsp;<span class="op" id="5169726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169730">return</span>&nbsp;<span class="builtinfunc" id="5169737">len</span><span class="op" id="5169740">(</span><span class="ident" id="5169741">p</span><span class="op" id="5169742">)</span><span class="op" id="5169743">,</span>&nbsp;<span class="ident" id="5169745">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5169753">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169768">n</span>&nbsp;<span class="op" id="5169770">=</span>&nbsp;<span class="builtinfunc" id="5169772">len</span><span class="op" id="5169775">(</span><span class="ident" id="5169776">p</span><span class="op" id="5169777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169780">if</span>&nbsp;<span class="ident" id="5169783">int64</span><span class="op" id="5169788">(</span><span class="ident" id="5169789">n</span><span class="op" id="5169790">)</span>&nbsp;<span class="op" id="5169792">&gt;</span>&nbsp;<span class="ident" id="5169794">t</span><span class="op" id="5169795">.</span><span class="ident" id="5169796">n</span>&nbsp;<span class="op" id="5169798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169802">n</span>&nbsp;<span class="op" id="5169804">=</span>&nbsp;<span class="builtintype" id="5169806">int</span><span class="op" id="5169809">(</span><span class="ident" id="5169810">t</span><span class="op" id="5169811">.</span><span class="ident" id="5169812">n</span><span class="op" id="5169813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169819">n</span><span class="op" id="5169820">,</span>&nbsp;<span class="ident" id="5169822">err</span>&nbsp;<span class="op" id="5169826">=</span>&nbsp;<span class="ident" id="5169828">t</span><span class="op" id="5169829">.</span><span class="ident" id="5169830">w</span><span class="op" id="5169831">.</span><span class="ident" id="5169832">Write</span><span class="op" id="5169837">(</span><span class="ident" id="5169838">p</span><span class="op" id="5169839">[</span><span class="num" id="5169840">0</span><span class="op" id="5169841">:</span><span class="ident" id="5169842">n</span><span class="op" id="5169843">]</span><span class="op" id="5169844">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169847">t</span><span class="op" id="5169848">.</span><span class="ident" id="5169849">n</span>&nbsp;<span class="op" id="5169851">-=</span>&nbsp;<span class="ident" id="5169854">int64</span><span class="op" id="5169859">(</span><span class="ident" id="5169860">n</span><span class="op" id="5169861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169864">if</span>&nbsp;<span class="ident" id="5169867">err</span>&nbsp;<span class="op" id="5169871">==</span>&nbsp;<span class="ident" id="5169874">nil</span>&nbsp;<span class="op" id="5169878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169882">n</span>&nbsp;<span class="op" id="5169884">=</span>&nbsp;<span class="builtinfunc" id="5169886">len</span><span class="op" id="5169889">(</span><span class="ident" id="5169890">p</span><span class="op" id="5169891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169897">return</span><br>
<span class="lineno">35</span><span class="op" id="5169904">}</span>
</div>
</body>
</html>
