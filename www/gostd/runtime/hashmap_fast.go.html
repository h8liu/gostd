<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1732441">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1732496">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1732550">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1732601">package</span>&nbsp;<span class="ident" id="1732609">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1732618">import</span>&nbsp;<span class="op" id="1732625">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1732628">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1732637">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1732640">func</span>&nbsp;<span class="ident" id="1732645">mapaccess1_fast32</span><span class="op" id="1732662">(</span><span class="ident" id="1732663">t</span>&nbsp;<span class="op" id="1732665">*</span><span class="ident" id="1732666">maptype</span><span class="op" id="1732673">,</span>&nbsp;<span class="ident" id="1732675">h</span>&nbsp;<span class="op" id="1732677">*</span><span class="ident" id="1732678">hmap</span><span class="op" id="1732682">,</span>&nbsp;<span class="ident" id="1732684">key</span>&nbsp;<span class="builtintype" id="1732688">uint32</span><span class="op" id="1732694">)</span>&nbsp;<span class="ident" id="1732696">unsafe</span><span class="op" id="1732702">.</span><span class="ident" id="1732703">Pointer</span>&nbsp;<span class="op" id="1732711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732714">if</span>&nbsp;<span class="ident" id="1732717">raceenabled</span>&nbsp;<span class="op" id="1732729">&amp;&amp;</span>&nbsp;<span class="ident" id="1732732">h</span>&nbsp;<span class="op" id="1732734">!=</span>&nbsp;<span class="ident" id="1732737">nil</span>&nbsp;<span class="op" id="1732741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732745">callerpc</span>&nbsp;<span class="op" id="1732754">:=</span>&nbsp;<span class="ident" id="1732757">getcallerpc</span><span class="op" id="1732768">(</span><span class="ident" id="1732769">unsafe</span><span class="op" id="1732775">.</span><span class="ident" id="1732776">Pointer</span><span class="op" id="1732783">(</span><span class="op" id="1732784">&amp;</span><span class="ident" id="1732785">t</span><span class="op" id="1732786">)</span><span class="op" id="1732787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732791">racereadpc</span><span class="op" id="1732801">(</span><span class="ident" id="1732802">unsafe</span><span class="op" id="1732808">.</span><span class="ident" id="1732809">Pointer</span><span class="op" id="1732816">(</span><span class="ident" id="1732817">h</span><span class="op" id="1732818">)</span><span class="op" id="1732819">,</span>&nbsp;<span class="ident" id="1732821">callerpc</span><span class="op" id="1732829">,</span>&nbsp;<span class="ident" id="1732831">funcPC</span><span class="op" id="1732837">(</span><span class="ident" id="1732838">mapaccess1_fast32</span><span class="op" id="1732855">)</span><span class="op" id="1732856">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732862">if</span>&nbsp;<span class="ident" id="1732865">h</span>&nbsp;<span class="op" id="1732867">==</span>&nbsp;<span class="ident" id="1732870">nil</span>&nbsp;<span class="op" id="1732874">||</span>&nbsp;<span class="ident" id="1732877">h</span><span class="op" id="1732878">.</span><span class="ident" id="1732879">count</span>&nbsp;<span class="op" id="1732885">==</span>&nbsp;<span class="num" id="1732888">0</span>&nbsp;<span class="op" id="1732890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732894">return</span>&nbsp;<span class="ident" id="1732901">unsafe</span><span class="op" id="1732907">.</span><span class="ident" id="1732908">Pointer</span><span class="op" id="1732915">(</span><span class="ident" id="1732916">t</span><span class="op" id="1732917">.</span><span class="ident" id="1732918">elem</span><span class="op" id="1732922">.</span><span class="ident" id="1732923">zero</span><span class="op" id="1732927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732933">var</span>&nbsp;<span class="ident" id="1732937">b</span>&nbsp;<span class="op" id="1732939">*</span><span class="ident" id="1732940">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732946">if</span>&nbsp;<span class="ident" id="1732949">h</span><span class="op" id="1732950">.</span><span class="ident" id="1732951">B</span>&nbsp;<span class="op" id="1732953">==</span>&nbsp;<span class="num" id="1732956">0</span>&nbsp;<span class="op" id="1732958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1732962">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733003">b</span>&nbsp;<span class="op" id="1733005">=</span>&nbsp;<span class="op" id="1733007">(</span><span class="op" id="1733008">*</span><span class="ident" id="1733009">bmap</span><span class="op" id="1733013">)</span><span class="op" id="1733014">(</span><span class="ident" id="1733015">h</span><span class="op" id="1733016">.</span><span class="ident" id="1733017">buckets</span><span class="op" id="1733024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733027">}</span>&nbsp;<span class="keyword" id="1733029">else</span>&nbsp;<span class="op" id="1733034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733038">hash</span>&nbsp;<span class="op" id="1733043">:=</span>&nbsp;<span class="ident" id="1733046">goalg</span><span class="op" id="1733051">(</span><span class="ident" id="1733052">t</span><span class="op" id="1733053">.</span><span class="ident" id="1733054">key</span><span class="op" id="1733057">.</span><span class="ident" id="1733058">alg</span><span class="op" id="1733061">)</span><span class="op" id="1733062">.</span><span class="ident" id="1733063">hash</span><span class="op" id="1733067">(</span><span class="ident" id="1733068">noescape</span><span class="op" id="1733076">(</span><span class="ident" id="1733077">unsafe</span><span class="op" id="1733083">.</span><span class="ident" id="1733084">Pointer</span><span class="op" id="1733091">(</span><span class="op" id="1733092">&amp;</span><span class="ident" id="1733093">key</span><span class="op" id="1733096">)</span><span class="op" id="1733097">)</span><span class="op" id="1733098">,</span>&nbsp;<span class="num" id="1733100">4</span><span class="op" id="1733101">,</span>&nbsp;<span class="builtintype" id="1733103">uintptr</span><span class="op" id="1733110">(</span><span class="ident" id="1733111">h</span><span class="op" id="1733112">.</span><span class="ident" id="1733113">hash0</span><span class="op" id="1733118">)</span><span class="op" id="1733119">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733123">m</span>&nbsp;<span class="op" id="1733125">:=</span>&nbsp;<span class="builtintype" id="1733128">uintptr</span><span class="op" id="1733135">(</span><span class="num" id="1733136">1</span><span class="op" id="1733137">)</span><span class="op" id="1733138">&lt;&lt;</span><span class="ident" id="1733140">h</span><span class="op" id="1733141">.</span><span class="ident" id="1733142">B</span>&nbsp;<span class="op" id="1733144">-</span>&nbsp;<span class="num" id="1733146">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733150">b</span>&nbsp;<span class="op" id="1733152">=</span>&nbsp;<span class="op" id="1733154">(</span><span class="op" id="1733155">*</span><span class="ident" id="1733156">bmap</span><span class="op" id="1733160">)</span><span class="op" id="1733161">(</span><span class="ident" id="1733162">add</span><span class="op" id="1733165">(</span><span class="ident" id="1733166">h</span><span class="op" id="1733167">.</span><span class="ident" id="1733168">buckets</span><span class="op" id="1733175">,</span>&nbsp;<span class="op" id="1733177">(</span><span class="ident" id="1733178">hash</span><span class="op" id="1733182">&amp;</span><span class="ident" id="1733183">m</span><span class="op" id="1733184">)</span><span class="op" id="1733185">*</span><span class="builtintype" id="1733186">uintptr</span><span class="op" id="1733193">(</span><span class="ident" id="1733194">t</span><span class="op" id="1733195">.</span><span class="ident" id="1733196">bucketsize</span><span class="op" id="1733206">)</span><span class="op" id="1733207">)</span><span class="op" id="1733208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733212">if</span>&nbsp;<span class="ident" id="1733215">c</span>&nbsp;<span class="op" id="1733217">:=</span>&nbsp;<span class="ident" id="1733220">h</span><span class="op" id="1733221">.</span><span class="ident" id="1733222">oldbuckets</span><span class="op" id="1733232">;</span>&nbsp;<span class="ident" id="1733234">c</span>&nbsp;<span class="op" id="1733236">!=</span>&nbsp;<span class="ident" id="1733239">nil</span>&nbsp;<span class="op" id="1733243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733248">oldb</span>&nbsp;<span class="op" id="1733253">:=</span>&nbsp;<span class="op" id="1733256">(</span><span class="op" id="1733257">*</span><span class="ident" id="1733258">bmap</span><span class="op" id="1733262">)</span><span class="op" id="1733263">(</span><span class="ident" id="1733264">add</span><span class="op" id="1733267">(</span><span class="ident" id="1733268">c</span><span class="op" id="1733269">,</span>&nbsp;<span class="op" id="1733271">(</span><span class="ident" id="1733272">hash</span><span class="op" id="1733276">&amp;</span><span class="op" id="1733277">(</span><span class="ident" id="1733278">m</span><span class="op" id="1733279">&gt;&gt;</span><span class="num" id="1733281">1</span><span class="op" id="1733282">)</span><span class="op" id="1733283">)</span><span class="op" id="1733284">*</span><span class="builtintype" id="1733285">uintptr</span><span class="op" id="1733292">(</span><span class="ident" id="1733293">t</span><span class="op" id="1733294">.</span><span class="ident" id="1733295">bucketsize</span><span class="op" id="1733305">)</span><span class="op" id="1733306">)</span><span class="op" id="1733307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733312">if</span>&nbsp;<span class="op" id="1733315">!</span><span class="ident" id="1733316">evacuated</span><span class="op" id="1733325">(</span><span class="ident" id="1733326">oldb</span><span class="op" id="1733330">)</span>&nbsp;<span class="op" id="1733332">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733338">b</span>&nbsp;<span class="op" id="1733340">=</span>&nbsp;<span class="ident" id="1733342">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733360">for</span>&nbsp;<span class="op" id="1733364">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733368">for</span>&nbsp;<span class="ident" id="1733372">i</span>&nbsp;<span class="op" id="1733374">:=</span>&nbsp;<span class="builtintype" id="1733377">uintptr</span><span class="op" id="1733384">(</span><span class="num" id="1733385">0</span><span class="op" id="1733386">)</span><span class="op" id="1733387">;</span>&nbsp;<span class="ident" id="1733389">i</span>&nbsp;<span class="op" id="1733391">&lt;</span>&nbsp;<span class="ident" id="1733393">bucketCnt</span><span class="op" id="1733402">;</span>&nbsp;<span class="ident" id="1733404">i</span><span class="op" id="1733405">++</span>&nbsp;<span class="op" id="1733408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733413">k</span>&nbsp;<span class="op" id="1733415">:=</span>&nbsp;<span class="op" id="1733418">*</span><span class="op" id="1733419">(</span><span class="op" id="1733420">(</span><span class="op" id="1733421">*</span><span class="builtintype" id="1733422">uint32</span><span class="op" id="1733428">)</span><span class="op" id="1733429">(</span><span class="ident" id="1733430">add</span><span class="op" id="1733433">(</span><span class="ident" id="1733434">unsafe</span><span class="op" id="1733440">.</span><span class="ident" id="1733441">Pointer</span><span class="op" id="1733448">(</span><span class="ident" id="1733449">b</span><span class="op" id="1733450">)</span><span class="op" id="1733451">,</span>&nbsp;<span class="ident" id="1733453">dataOffset</span><span class="op" id="1733463">+</span><span class="ident" id="1733464">i</span><span class="op" id="1733465">*</span><span class="num" id="1733466">4</span><span class="op" id="1733467">)</span><span class="op" id="1733468">)</span><span class="op" id="1733469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733474">if</span>&nbsp;<span class="ident" id="1733477">k</span>&nbsp;<span class="op" id="1733479">!=</span>&nbsp;<span class="ident" id="1733482">key</span>&nbsp;<span class="op" id="1733486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733492">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733504">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733509">x</span>&nbsp;<span class="op" id="1733511">:=</span>&nbsp;<span class="op" id="1733514">*</span><span class="op" id="1733515">(</span><span class="op" id="1733516">(</span><span class="op" id="1733517">*</span><span class="builtintype" id="1733518">uint8</span><span class="op" id="1733523">)</span><span class="op" id="1733524">(</span><span class="ident" id="1733525">add</span><span class="op" id="1733528">(</span><span class="ident" id="1733529">unsafe</span><span class="op" id="1733535">.</span><span class="ident" id="1733536">Pointer</span><span class="op" id="1733543">(</span><span class="ident" id="1733544">b</span><span class="op" id="1733545">)</span><span class="op" id="1733546">,</span>&nbsp;<span class="ident" id="1733548">i</span><span class="op" id="1733549">)</span><span class="op" id="1733550">)</span><span class="op" id="1733551">)</span>&nbsp;<span class="comment" id="1733553">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733597">if</span>&nbsp;<span class="ident" id="1733600">x</span>&nbsp;<span class="op" id="1733602">==</span>&nbsp;<span class="ident" id="1733605">empty</span>&nbsp;<span class="op" id="1733611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733617">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733634">return</span>&nbsp;<span class="ident" id="1733641">add</span><span class="op" id="1733644">(</span><span class="ident" id="1733645">unsafe</span><span class="op" id="1733651">.</span><span class="ident" id="1733652">Pointer</span><span class="op" id="1733659">(</span><span class="ident" id="1733660">b</span><span class="op" id="1733661">)</span><span class="op" id="1733662">,</span>&nbsp;<span class="ident" id="1733664">dataOffset</span><span class="op" id="1733674">+</span><span class="ident" id="1733675">bucketCnt</span><span class="op" id="1733684">*</span><span class="num" id="1733685">4</span><span class="op" id="1733686">+</span><span class="ident" id="1733687">i</span><span class="op" id="1733688">*</span><span class="builtintype" id="1733689">uintptr</span><span class="op" id="1733696">(</span><span class="ident" id="1733697">t</span><span class="op" id="1733698">.</span><span class="ident" id="1733699">valuesize</span><span class="op" id="1733708">)</span><span class="op" id="1733709">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733717">b</span>&nbsp;<span class="op" id="1733719">=</span>&nbsp;<span class="ident" id="1733721">b</span><span class="op" id="1733722">.</span><span class="ident" id="1733723">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733734">if</span>&nbsp;<span class="ident" id="1733737">b</span>&nbsp;<span class="op" id="1733739">==</span>&nbsp;<span class="ident" id="1733742">nil</span>&nbsp;<span class="op" id="1733746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733751">return</span>&nbsp;<span class="ident" id="1733758">unsafe</span><span class="op" id="1733764">.</span><span class="ident" id="1733765">Pointer</span><span class="op" id="1733772">(</span><span class="ident" id="1733773">t</span><span class="op" id="1733774">.</span><span class="ident" id="1733775">elem</span><span class="op" id="1733779">.</span><span class="ident" id="1733780">zero</span><span class="op" id="1733784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733788">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733791">}</span><br>
<span class="lineno"></span><span class="op" id="1733793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1733796">func</span>&nbsp;<span class="ident" id="1733801">mapaccess2_fast32</span><span class="op" id="1733818">(</span><span class="ident" id="1733819">t</span>&nbsp;<span class="op" id="1733821">*</span><span class="ident" id="1733822">maptype</span><span class="op" id="1733829">,</span>&nbsp;<span class="ident" id="1733831">h</span>&nbsp;<span class="op" id="1733833">*</span><span class="ident" id="1733834">hmap</span><span class="op" id="1733838">,</span>&nbsp;<span class="ident" id="1733840">key</span>&nbsp;<span class="builtintype" id="1733844">uint32</span><span class="op" id="1733850">)</span>&nbsp;<span class="op" id="1733852">(</span><span class="ident" id="1733853">unsafe</span><span class="op" id="1733859">.</span><span class="ident" id="1733860">Pointer</span><span class="op" id="1733867">,</span>&nbsp;<span class="builtintype" id="1733869">bool</span><span class="op" id="1733873">)</span>&nbsp;<span class="op" id="1733875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733878">if</span>&nbsp;<span class="ident" id="1733881">raceenabled</span>&nbsp;<span class="op" id="1733893">&amp;&amp;</span>&nbsp;<span class="ident" id="1733896">h</span>&nbsp;<span class="op" id="1733898">!=</span>&nbsp;<span class="ident" id="1733901">nil</span>&nbsp;<span class="op" id="1733905">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733909">callerpc</span>&nbsp;<span class="op" id="1733918">:=</span>&nbsp;<span class="ident" id="1733921">getcallerpc</span><span class="op" id="1733932">(</span><span class="ident" id="1733933">unsafe</span><span class="op" id="1733939">.</span><span class="ident" id="1733940">Pointer</span><span class="op" id="1733947">(</span><span class="op" id="1733948">&amp;</span><span class="ident" id="1733949">t</span><span class="op" id="1733950">)</span><span class="op" id="1733951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733955">racereadpc</span><span class="op" id="1733965">(</span><span class="ident" id="1733966">unsafe</span><span class="op" id="1733972">.</span><span class="ident" id="1733973">Pointer</span><span class="op" id="1733980">(</span><span class="ident" id="1733981">h</span><span class="op" id="1733982">)</span><span class="op" id="1733983">,</span>&nbsp;<span class="ident" id="1733985">callerpc</span><span class="op" id="1733993">,</span>&nbsp;<span class="ident" id="1733995">funcPC</span><span class="op" id="1734001">(</span><span class="ident" id="1734002">mapaccess2_fast32</span><span class="op" id="1734019">)</span><span class="op" id="1734020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734026">if</span>&nbsp;<span class="ident" id="1734029">h</span>&nbsp;<span class="op" id="1734031">==</span>&nbsp;<span class="ident" id="1734034">nil</span>&nbsp;<span class="op" id="1734038">||</span>&nbsp;<span class="ident" id="1734041">h</span><span class="op" id="1734042">.</span><span class="ident" id="1734043">count</span>&nbsp;<span class="op" id="1734049">==</span>&nbsp;<span class="num" id="1734052">0</span>&nbsp;<span class="op" id="1734054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734058">return</span>&nbsp;<span class="ident" id="1734065">unsafe</span><span class="op" id="1734071">.</span><span class="ident" id="1734072">Pointer</span><span class="op" id="1734079">(</span><span class="ident" id="1734080">t</span><span class="op" id="1734081">.</span><span class="ident" id="1734082">elem</span><span class="op" id="1734086">.</span><span class="ident" id="1734087">zero</span><span class="op" id="1734091">)</span><span class="op" id="1734092">,</span>&nbsp;<span class="builtintype" id="1734094">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734104">var</span>&nbsp;<span class="ident" id="1734108">b</span>&nbsp;<span class="op" id="1734110">*</span><span class="ident" id="1734111">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734117">if</span>&nbsp;<span class="ident" id="1734120">h</span><span class="op" id="1734121">.</span><span class="ident" id="1734122">B</span>&nbsp;<span class="op" id="1734124">==</span>&nbsp;<span class="num" id="1734127">0</span>&nbsp;<span class="op" id="1734129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1734133">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734174">b</span>&nbsp;<span class="op" id="1734176">=</span>&nbsp;<span class="op" id="1734178">(</span><span class="op" id="1734179">*</span><span class="ident" id="1734180">bmap</span><span class="op" id="1734184">)</span><span class="op" id="1734185">(</span><span class="ident" id="1734186">h</span><span class="op" id="1734187">.</span><span class="ident" id="1734188">buckets</span><span class="op" id="1734195">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734198">}</span>&nbsp;<span class="keyword" id="1734200">else</span>&nbsp;<span class="op" id="1734205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734209">hash</span>&nbsp;<span class="op" id="1734214">:=</span>&nbsp;<span class="ident" id="1734217">goalg</span><span class="op" id="1734222">(</span><span class="ident" id="1734223">t</span><span class="op" id="1734224">.</span><span class="ident" id="1734225">key</span><span class="op" id="1734228">.</span><span class="ident" id="1734229">alg</span><span class="op" id="1734232">)</span><span class="op" id="1734233">.</span><span class="ident" id="1734234">hash</span><span class="op" id="1734238">(</span><span class="ident" id="1734239">noescape</span><span class="op" id="1734247">(</span><span class="ident" id="1734248">unsafe</span><span class="op" id="1734254">.</span><span class="ident" id="1734255">Pointer</span><span class="op" id="1734262">(</span><span class="op" id="1734263">&amp;</span><span class="ident" id="1734264">key</span><span class="op" id="1734267">)</span><span class="op" id="1734268">)</span><span class="op" id="1734269">,</span>&nbsp;<span class="num" id="1734271">4</span><span class="op" id="1734272">,</span>&nbsp;<span class="builtintype" id="1734274">uintptr</span><span class="op" id="1734281">(</span><span class="ident" id="1734282">h</span><span class="op" id="1734283">.</span><span class="ident" id="1734284">hash0</span><span class="op" id="1734289">)</span><span class="op" id="1734290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734294">m</span>&nbsp;<span class="op" id="1734296">:=</span>&nbsp;<span class="builtintype" id="1734299">uintptr</span><span class="op" id="1734306">(</span><span class="num" id="1734307">1</span><span class="op" id="1734308">)</span><span class="op" id="1734309">&lt;&lt;</span><span class="ident" id="1734311">h</span><span class="op" id="1734312">.</span><span class="ident" id="1734313">B</span>&nbsp;<span class="op" id="1734315">-</span>&nbsp;<span class="num" id="1734317">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734321">b</span>&nbsp;<span class="op" id="1734323">=</span>&nbsp;<span class="op" id="1734325">(</span><span class="op" id="1734326">*</span><span class="ident" id="1734327">bmap</span><span class="op" id="1734331">)</span><span class="op" id="1734332">(</span><span class="ident" id="1734333">add</span><span class="op" id="1734336">(</span><span class="ident" id="1734337">h</span><span class="op" id="1734338">.</span><span class="ident" id="1734339">buckets</span><span class="op" id="1734346">,</span>&nbsp;<span class="op" id="1734348">(</span><span class="ident" id="1734349">hash</span><span class="op" id="1734353">&amp;</span><span class="ident" id="1734354">m</span><span class="op" id="1734355">)</span><span class="op" id="1734356">*</span><span class="builtintype" id="1734357">uintptr</span><span class="op" id="1734364">(</span><span class="ident" id="1734365">t</span><span class="op" id="1734366">.</span><span class="ident" id="1734367">bucketsize</span><span class="op" id="1734377">)</span><span class="op" id="1734378">)</span><span class="op" id="1734379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734383">if</span>&nbsp;<span class="ident" id="1734386">c</span>&nbsp;<span class="op" id="1734388">:=</span>&nbsp;<span class="ident" id="1734391">h</span><span class="op" id="1734392">.</span><span class="ident" id="1734393">oldbuckets</span><span class="op" id="1734403">;</span>&nbsp;<span class="ident" id="1734405">c</span>&nbsp;<span class="op" id="1734407">!=</span>&nbsp;<span class="ident" id="1734410">nil</span>&nbsp;<span class="op" id="1734414">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734419">oldb</span>&nbsp;<span class="op" id="1734424">:=</span>&nbsp;<span class="op" id="1734427">(</span><span class="op" id="1734428">*</span><span class="ident" id="1734429">bmap</span><span class="op" id="1734433">)</span><span class="op" id="1734434">(</span><span class="ident" id="1734435">add</span><span class="op" id="1734438">(</span><span class="ident" id="1734439">c</span><span class="op" id="1734440">,</span>&nbsp;<span class="op" id="1734442">(</span><span class="ident" id="1734443">hash</span><span class="op" id="1734447">&amp;</span><span class="op" id="1734448">(</span><span class="ident" id="1734449">m</span><span class="op" id="1734450">&gt;&gt;</span><span class="num" id="1734452">1</span><span class="op" id="1734453">)</span><span class="op" id="1734454">)</span><span class="op" id="1734455">*</span><span class="builtintype" id="1734456">uintptr</span><span class="op" id="1734463">(</span><span class="ident" id="1734464">t</span><span class="op" id="1734465">.</span><span class="ident" id="1734466">bucketsize</span><span class="op" id="1734476">)</span><span class="op" id="1734477">)</span><span class="op" id="1734478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734483">if</span>&nbsp;<span class="op" id="1734486">!</span><span class="ident" id="1734487">evacuated</span><span class="op" id="1734496">(</span><span class="ident" id="1734497">oldb</span><span class="op" id="1734501">)</span>&nbsp;<span class="op" id="1734503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734509">b</span>&nbsp;<span class="op" id="1734511">=</span>&nbsp;<span class="ident" id="1734513">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734525">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734531">for</span>&nbsp;<span class="op" id="1734535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734539">for</span>&nbsp;<span class="ident" id="1734543">i</span>&nbsp;<span class="op" id="1734545">:=</span>&nbsp;<span class="builtintype" id="1734548">uintptr</span><span class="op" id="1734555">(</span><span class="num" id="1734556">0</span><span class="op" id="1734557">)</span><span class="op" id="1734558">;</span>&nbsp;<span class="ident" id="1734560">i</span>&nbsp;<span class="op" id="1734562">&lt;</span>&nbsp;<span class="ident" id="1734564">bucketCnt</span><span class="op" id="1734573">;</span>&nbsp;<span class="ident" id="1734575">i</span><span class="op" id="1734576">++</span>&nbsp;<span class="op" id="1734579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734584">k</span>&nbsp;<span class="op" id="1734586">:=</span>&nbsp;<span class="op" id="1734589">*</span><span class="op" id="1734590">(</span><span class="op" id="1734591">(</span><span class="op" id="1734592">*</span><span class="builtintype" id="1734593">uint32</span><span class="op" id="1734599">)</span><span class="op" id="1734600">(</span><span class="ident" id="1734601">add</span><span class="op" id="1734604">(</span><span class="ident" id="1734605">unsafe</span><span class="op" id="1734611">.</span><span class="ident" id="1734612">Pointer</span><span class="op" id="1734619">(</span><span class="ident" id="1734620">b</span><span class="op" id="1734621">)</span><span class="op" id="1734622">,</span>&nbsp;<span class="ident" id="1734624">dataOffset</span><span class="op" id="1734634">+</span><span class="ident" id="1734635">i</span><span class="op" id="1734636">*</span><span class="num" id="1734637">4</span><span class="op" id="1734638">)</span><span class="op" id="1734639">)</span><span class="op" id="1734640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734645">if</span>&nbsp;<span class="ident" id="1734648">k</span>&nbsp;<span class="op" id="1734650">!=</span>&nbsp;<span class="ident" id="1734653">key</span>&nbsp;<span class="op" id="1734657">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734663">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734680">x</span>&nbsp;<span class="op" id="1734682">:=</span>&nbsp;<span class="op" id="1734685">*</span><span class="op" id="1734686">(</span><span class="op" id="1734687">(</span><span class="op" id="1734688">*</span><span class="builtintype" id="1734689">uint8</span><span class="op" id="1734694">)</span><span class="op" id="1734695">(</span><span class="ident" id="1734696">add</span><span class="op" id="1734699">(</span><span class="ident" id="1734700">unsafe</span><span class="op" id="1734706">.</span><span class="ident" id="1734707">Pointer</span><span class="op" id="1734714">(</span><span class="ident" id="1734715">b</span><span class="op" id="1734716">)</span><span class="op" id="1734717">,</span>&nbsp;<span class="ident" id="1734719">i</span><span class="op" id="1734720">)</span><span class="op" id="1734721">)</span><span class="op" id="1734722">)</span>&nbsp;<span class="comment" id="1734724">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734768">if</span>&nbsp;<span class="ident" id="1734771">x</span>&nbsp;<span class="op" id="1734773">==</span>&nbsp;<span class="ident" id="1734776">empty</span>&nbsp;<span class="op" id="1734782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734788">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734805">return</span>&nbsp;<span class="ident" id="1734812">add</span><span class="op" id="1734815">(</span><span class="ident" id="1734816">unsafe</span><span class="op" id="1734822">.</span><span class="ident" id="1734823">Pointer</span><span class="op" id="1734830">(</span><span class="ident" id="1734831">b</span><span class="op" id="1734832">)</span><span class="op" id="1734833">,</span>&nbsp;<span class="ident" id="1734835">dataOffset</span><span class="op" id="1734845">+</span><span class="ident" id="1734846">bucketCnt</span><span class="op" id="1734855">*</span><span class="num" id="1734856">4</span><span class="op" id="1734857">+</span><span class="ident" id="1734858">i</span><span class="op" id="1734859">*</span><span class="builtintype" id="1734860">uintptr</span><span class="op" id="1734867">(</span><span class="ident" id="1734868">t</span><span class="op" id="1734869">.</span><span class="ident" id="1734870">valuesize</span><span class="op" id="1734879">)</span><span class="op" id="1734880">)</span><span class="op" id="1734881">,</span>&nbsp;<span class="builtintype" id="1734883">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734894">b</span>&nbsp;<span class="op" id="1734896">=</span>&nbsp;<span class="ident" id="1734898">b</span><span class="op" id="1734899">.</span><span class="ident" id="1734900">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734911">if</span>&nbsp;<span class="ident" id="1734914">b</span>&nbsp;<span class="op" id="1734916">==</span>&nbsp;<span class="ident" id="1734919">nil</span>&nbsp;<span class="op" id="1734923">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734928">return</span>&nbsp;<span class="ident" id="1734935">unsafe</span><span class="op" id="1734941">.</span><span class="ident" id="1734942">Pointer</span><span class="op" id="1734949">(</span><span class="ident" id="1734950">t</span><span class="op" id="1734951">.</span><span class="ident" id="1734952">elem</span><span class="op" id="1734956">.</span><span class="ident" id="1734957">zero</span><span class="op" id="1734961">)</span><span class="op" id="1734962">,</span>&nbsp;<span class="builtintype" id="1734964">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734975">}</span><br>
<span class="lineno"></span><span class="op" id="1734977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1734980">func</span>&nbsp;<span class="ident" id="1734985">mapaccess1_fast64</span><span class="op" id="1735002">(</span><span class="ident" id="1735003">t</span>&nbsp;<span class="op" id="1735005">*</span><span class="ident" id="1735006">maptype</span><span class="op" id="1735013">,</span>&nbsp;<span class="ident" id="1735015">h</span>&nbsp;<span class="op" id="1735017">*</span><span class="ident" id="1735018">hmap</span><span class="op" id="1735022">,</span>&nbsp;<span class="ident" id="1735024">key</span>&nbsp;<span class="ident" id="1735028">uint64</span><span class="op" id="1735034">)</span>&nbsp;<span class="ident" id="1735036">unsafe</span><span class="op" id="1735042">.</span><span class="ident" id="1735043">Pointer</span>&nbsp;<span class="op" id="1735051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735054">if</span>&nbsp;<span class="ident" id="1735057">raceenabled</span>&nbsp;<span class="op" id="1735069">&amp;&amp;</span>&nbsp;<span class="ident" id="1735072">h</span>&nbsp;<span class="op" id="1735074">!=</span>&nbsp;<span class="ident" id="1735077">nil</span>&nbsp;<span class="op" id="1735081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735085">callerpc</span>&nbsp;<span class="op" id="1735094">:=</span>&nbsp;<span class="ident" id="1735097">getcallerpc</span><span class="op" id="1735108">(</span><span class="ident" id="1735109">unsafe</span><span class="op" id="1735115">.</span><span class="ident" id="1735116">Pointer</span><span class="op" id="1735123">(</span><span class="op" id="1735124">&amp;</span><span class="ident" id="1735125">t</span><span class="op" id="1735126">)</span><span class="op" id="1735127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735131">racereadpc</span><span class="op" id="1735141">(</span><span class="ident" id="1735142">unsafe</span><span class="op" id="1735148">.</span><span class="ident" id="1735149">Pointer</span><span class="op" id="1735156">(</span><span class="ident" id="1735157">h</span><span class="op" id="1735158">)</span><span class="op" id="1735159">,</span>&nbsp;<span class="ident" id="1735161">callerpc</span><span class="op" id="1735169">,</span>&nbsp;<span class="ident" id="1735171">funcPC</span><span class="op" id="1735177">(</span><span class="ident" id="1735178">mapaccess1_fast64</span><span class="op" id="1735195">)</span><span class="op" id="1735196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735199">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735202">if</span>&nbsp;<span class="ident" id="1735205">h</span>&nbsp;<span class="op" id="1735207">==</span>&nbsp;<span class="ident" id="1735210">nil</span>&nbsp;<span class="op" id="1735214">||</span>&nbsp;<span class="ident" id="1735217">h</span><span class="op" id="1735218">.</span><span class="ident" id="1735219">count</span>&nbsp;<span class="op" id="1735225">==</span>&nbsp;<span class="num" id="1735228">0</span>&nbsp;<span class="op" id="1735230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735234">return</span>&nbsp;<span class="ident" id="1735241">unsafe</span><span class="op" id="1735247">.</span><span class="ident" id="1735248">Pointer</span><span class="op" id="1735255">(</span><span class="ident" id="1735256">t</span><span class="op" id="1735257">.</span><span class="ident" id="1735258">elem</span><span class="op" id="1735262">.</span><span class="ident" id="1735263">zero</span><span class="op" id="1735267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735273">var</span>&nbsp;<span class="ident" id="1735277">b</span>&nbsp;<span class="op" id="1735279">*</span><span class="ident" id="1735280">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735286">if</span>&nbsp;<span class="ident" id="1735289">h</span><span class="op" id="1735290">.</span><span class="ident" id="1735291">B</span>&nbsp;<span class="op" id="1735293">==</span>&nbsp;<span class="num" id="1735296">0</span>&nbsp;<span class="op" id="1735298">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1735302">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735343">b</span>&nbsp;<span class="op" id="1735345">=</span>&nbsp;<span class="op" id="1735347">(</span><span class="op" id="1735348">*</span><span class="ident" id="1735349">bmap</span><span class="op" id="1735353">)</span><span class="op" id="1735354">(</span><span class="ident" id="1735355">h</span><span class="op" id="1735356">.</span><span class="ident" id="1735357">buckets</span><span class="op" id="1735364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735367">}</span>&nbsp;<span class="keyword" id="1735369">else</span>&nbsp;<span class="op" id="1735374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735378">hash</span>&nbsp;<span class="op" id="1735383">:=</span>&nbsp;<span class="ident" id="1735386">goalg</span><span class="op" id="1735391">(</span><span class="ident" id="1735392">t</span><span class="op" id="1735393">.</span><span class="ident" id="1735394">key</span><span class="op" id="1735397">.</span><span class="ident" id="1735398">alg</span><span class="op" id="1735401">)</span><span class="op" id="1735402">.</span><span class="ident" id="1735403">hash</span><span class="op" id="1735407">(</span><span class="ident" id="1735408">noescape</span><span class="op" id="1735416">(</span><span class="ident" id="1735417">unsafe</span><span class="op" id="1735423">.</span><span class="ident" id="1735424">Pointer</span><span class="op" id="1735431">(</span><span class="op" id="1735432">&amp;</span><span class="ident" id="1735433">key</span><span class="op" id="1735436">)</span><span class="op" id="1735437">)</span><span class="op" id="1735438">,</span>&nbsp;<span class="num" id="1735440">8</span><span class="op" id="1735441">,</span>&nbsp;<span class="builtintype" id="1735443">uintptr</span><span class="op" id="1735450">(</span><span class="ident" id="1735451">h</span><span class="op" id="1735452">.</span><span class="ident" id="1735453">hash0</span><span class="op" id="1735458">)</span><span class="op" id="1735459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735463">m</span>&nbsp;<span class="op" id="1735465">:=</span>&nbsp;<span class="builtintype" id="1735468">uintptr</span><span class="op" id="1735475">(</span><span class="num" id="1735476">1</span><span class="op" id="1735477">)</span><span class="op" id="1735478">&lt;&lt;</span><span class="ident" id="1735480">h</span><span class="op" id="1735481">.</span><span class="ident" id="1735482">B</span>&nbsp;<span class="op" id="1735484">-</span>&nbsp;<span class="num" id="1735486">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735490">b</span>&nbsp;<span class="op" id="1735492">=</span>&nbsp;<span class="op" id="1735494">(</span><span class="op" id="1735495">*</span><span class="ident" id="1735496">bmap</span><span class="op" id="1735500">)</span><span class="op" id="1735501">(</span><span class="ident" id="1735502">add</span><span class="op" id="1735505">(</span><span class="ident" id="1735506">h</span><span class="op" id="1735507">.</span><span class="ident" id="1735508">buckets</span><span class="op" id="1735515">,</span>&nbsp;<span class="op" id="1735517">(</span><span class="ident" id="1735518">hash</span><span class="op" id="1735522">&amp;</span><span class="ident" id="1735523">m</span><span class="op" id="1735524">)</span><span class="op" id="1735525">*</span><span class="builtintype" id="1735526">uintptr</span><span class="op" id="1735533">(</span><span class="ident" id="1735534">t</span><span class="op" id="1735535">.</span><span class="ident" id="1735536">bucketsize</span><span class="op" id="1735546">)</span><span class="op" id="1735547">)</span><span class="op" id="1735548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735552">if</span>&nbsp;<span class="ident" id="1735555">c</span>&nbsp;<span class="op" id="1735557">:=</span>&nbsp;<span class="ident" id="1735560">h</span><span class="op" id="1735561">.</span><span class="ident" id="1735562">oldbuckets</span><span class="op" id="1735572">;</span>&nbsp;<span class="ident" id="1735574">c</span>&nbsp;<span class="op" id="1735576">!=</span>&nbsp;<span class="ident" id="1735579">nil</span>&nbsp;<span class="op" id="1735583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735588">oldb</span>&nbsp;<span class="op" id="1735593">:=</span>&nbsp;<span class="op" id="1735596">(</span><span class="op" id="1735597">*</span><span class="ident" id="1735598">bmap</span><span class="op" id="1735602">)</span><span class="op" id="1735603">(</span><span class="ident" id="1735604">add</span><span class="op" id="1735607">(</span><span class="ident" id="1735608">c</span><span class="op" id="1735609">,</span>&nbsp;<span class="op" id="1735611">(</span><span class="ident" id="1735612">hash</span><span class="op" id="1735616">&amp;</span><span class="op" id="1735617">(</span><span class="ident" id="1735618">m</span><span class="op" id="1735619">&gt;&gt;</span><span class="num" id="1735621">1</span><span class="op" id="1735622">)</span><span class="op" id="1735623">)</span><span class="op" id="1735624">*</span><span class="builtintype" id="1735625">uintptr</span><span class="op" id="1735632">(</span><span class="ident" id="1735633">t</span><span class="op" id="1735634">.</span><span class="ident" id="1735635">bucketsize</span><span class="op" id="1735645">)</span><span class="op" id="1735646">)</span><span class="op" id="1735647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735652">if</span>&nbsp;<span class="op" id="1735655">!</span><span class="ident" id="1735656">evacuated</span><span class="op" id="1735665">(</span><span class="ident" id="1735666">oldb</span><span class="op" id="1735670">)</span>&nbsp;<span class="op" id="1735672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735678">b</span>&nbsp;<span class="op" id="1735680">=</span>&nbsp;<span class="ident" id="1735682">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735700">for</span>&nbsp;<span class="op" id="1735704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735708">for</span>&nbsp;<span class="ident" id="1735712">i</span>&nbsp;<span class="op" id="1735714">:=</span>&nbsp;<span class="builtintype" id="1735717">uintptr</span><span class="op" id="1735724">(</span><span class="num" id="1735725">0</span><span class="op" id="1735726">)</span><span class="op" id="1735727">;</span>&nbsp;<span class="ident" id="1735729">i</span>&nbsp;<span class="op" id="1735731">&lt;</span>&nbsp;<span class="ident" id="1735733">bucketCnt</span><span class="op" id="1735742">;</span>&nbsp;<span class="ident" id="1735744">i</span><span class="op" id="1735745">++</span>&nbsp;<span class="op" id="1735748">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735753">k</span>&nbsp;<span class="op" id="1735755">:=</span>&nbsp;<span class="op" id="1735758">*</span><span class="op" id="1735759">(</span><span class="op" id="1735760">(</span><span class="op" id="1735761">*</span><span class="ident" id="1735762">uint64</span><span class="op" id="1735768">)</span><span class="op" id="1735769">(</span><span class="ident" id="1735770">add</span><span class="op" id="1735773">(</span><span class="ident" id="1735774">unsafe</span><span class="op" id="1735780">.</span><span class="ident" id="1735781">Pointer</span><span class="op" id="1735788">(</span><span class="ident" id="1735789">b</span><span class="op" id="1735790">)</span><span class="op" id="1735791">,</span>&nbsp;<span class="ident" id="1735793">dataOffset</span><span class="op" id="1735803">+</span><span class="ident" id="1735804">i</span><span class="op" id="1735805">*</span><span class="num" id="1735806">8</span><span class="op" id="1735807">)</span><span class="op" id="1735808">)</span><span class="op" id="1735809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735814">if</span>&nbsp;<span class="ident" id="1735817">k</span>&nbsp;<span class="op" id="1735819">!=</span>&nbsp;<span class="ident" id="1735822">key</span>&nbsp;<span class="op" id="1735826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735832">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735849">x</span>&nbsp;<span class="op" id="1735851">:=</span>&nbsp;<span class="op" id="1735854">*</span><span class="op" id="1735855">(</span><span class="op" id="1735856">(</span><span class="op" id="1735857">*</span><span class="builtintype" id="1735858">uint8</span><span class="op" id="1735863">)</span><span class="op" id="1735864">(</span><span class="ident" id="1735865">add</span><span class="op" id="1735868">(</span><span class="ident" id="1735869">unsafe</span><span class="op" id="1735875">.</span><span class="ident" id="1735876">Pointer</span><span class="op" id="1735883">(</span><span class="ident" id="1735884">b</span><span class="op" id="1735885">)</span><span class="op" id="1735886">,</span>&nbsp;<span class="ident" id="1735888">i</span><span class="op" id="1735889">)</span><span class="op" id="1735890">)</span><span class="op" id="1735891">)</span>&nbsp;<span class="comment" id="1735893">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735937">if</span>&nbsp;<span class="ident" id="1735940">x</span>&nbsp;<span class="op" id="1735942">==</span>&nbsp;<span class="ident" id="1735945">empty</span>&nbsp;<span class="op" id="1735951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735957">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735974">return</span>&nbsp;<span class="ident" id="1735981">add</span><span class="op" id="1735984">(</span><span class="ident" id="1735985">unsafe</span><span class="op" id="1735991">.</span><span class="ident" id="1735992">Pointer</span><span class="op" id="1735999">(</span><span class="ident" id="1736000">b</span><span class="op" id="1736001">)</span><span class="op" id="1736002">,</span>&nbsp;<span class="ident" id="1736004">dataOffset</span><span class="op" id="1736014">+</span><span class="ident" id="1736015">bucketCnt</span><span class="op" id="1736024">*</span><span class="num" id="1736025">8</span><span class="op" id="1736026">+</span><span class="ident" id="1736027">i</span><span class="op" id="1736028">*</span><span class="builtintype" id="1736029">uintptr</span><span class="op" id="1736036">(</span><span class="ident" id="1736037">t</span><span class="op" id="1736038">.</span><span class="ident" id="1736039">valuesize</span><span class="op" id="1736048">)</span><span class="op" id="1736049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736053">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736057">b</span>&nbsp;<span class="op" id="1736059">=</span>&nbsp;<span class="ident" id="1736061">b</span><span class="op" id="1736062">.</span><span class="ident" id="1736063">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736074">if</span>&nbsp;<span class="ident" id="1736077">b</span>&nbsp;<span class="op" id="1736079">==</span>&nbsp;<span class="ident" id="1736082">nil</span>&nbsp;<span class="op" id="1736086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736091">return</span>&nbsp;<span class="ident" id="1736098">unsafe</span><span class="op" id="1736104">.</span><span class="ident" id="1736105">Pointer</span><span class="op" id="1736112">(</span><span class="ident" id="1736113">t</span><span class="op" id="1736114">.</span><span class="ident" id="1736115">elem</span><span class="op" id="1736119">.</span><span class="ident" id="1736120">zero</span><span class="op" id="1736124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736131">}</span><br>
<span class="lineno">135</span><span class="op" id="1736133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1736136">func</span>&nbsp;<span class="ident" id="1736141">mapaccess2_fast64</span><span class="op" id="1736158">(</span><span class="ident" id="1736159">t</span>&nbsp;<span class="op" id="1736161">*</span><span class="ident" id="1736162">maptype</span><span class="op" id="1736169">,</span>&nbsp;<span class="ident" id="1736171">h</span>&nbsp;<span class="op" id="1736173">*</span><span class="ident" id="1736174">hmap</span><span class="op" id="1736178">,</span>&nbsp;<span class="ident" id="1736180">key</span>&nbsp;<span class="ident" id="1736184">uint64</span><span class="op" id="1736190">)</span>&nbsp;<span class="op" id="1736192">(</span><span class="ident" id="1736193">unsafe</span><span class="op" id="1736199">.</span><span class="ident" id="1736200">Pointer</span><span class="op" id="1736207">,</span>&nbsp;<span class="builtintype" id="1736209">bool</span><span class="op" id="1736213">)</span>&nbsp;<span class="op" id="1736215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736218">if</span>&nbsp;<span class="ident" id="1736221">raceenabled</span>&nbsp;<span class="op" id="1736233">&amp;&amp;</span>&nbsp;<span class="ident" id="1736236">h</span>&nbsp;<span class="op" id="1736238">!=</span>&nbsp;<span class="ident" id="1736241">nil</span>&nbsp;<span class="op" id="1736245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736249">callerpc</span>&nbsp;<span class="op" id="1736258">:=</span>&nbsp;<span class="ident" id="1736261">getcallerpc</span><span class="op" id="1736272">(</span><span class="ident" id="1736273">unsafe</span><span class="op" id="1736279">.</span><span class="ident" id="1736280">Pointer</span><span class="op" id="1736287">(</span><span class="op" id="1736288">&amp;</span><span class="ident" id="1736289">t</span><span class="op" id="1736290">)</span><span class="op" id="1736291">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736295">racereadpc</span><span class="op" id="1736305">(</span><span class="ident" id="1736306">unsafe</span><span class="op" id="1736312">.</span><span class="ident" id="1736313">Pointer</span><span class="op" id="1736320">(</span><span class="ident" id="1736321">h</span><span class="op" id="1736322">)</span><span class="op" id="1736323">,</span>&nbsp;<span class="ident" id="1736325">callerpc</span><span class="op" id="1736333">,</span>&nbsp;<span class="ident" id="1736335">funcPC</span><span class="op" id="1736341">(</span><span class="ident" id="1736342">mapaccess2_fast64</span><span class="op" id="1736359">)</span><span class="op" id="1736360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736366">if</span>&nbsp;<span class="ident" id="1736369">h</span>&nbsp;<span class="op" id="1736371">==</span>&nbsp;<span class="ident" id="1736374">nil</span>&nbsp;<span class="op" id="1736378">||</span>&nbsp;<span class="ident" id="1736381">h</span><span class="op" id="1736382">.</span><span class="ident" id="1736383">count</span>&nbsp;<span class="op" id="1736389">==</span>&nbsp;<span class="num" id="1736392">0</span>&nbsp;<span class="op" id="1736394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736398">return</span>&nbsp;<span class="ident" id="1736405">unsafe</span><span class="op" id="1736411">.</span><span class="ident" id="1736412">Pointer</span><span class="op" id="1736419">(</span><span class="ident" id="1736420">t</span><span class="op" id="1736421">.</span><span class="ident" id="1736422">elem</span><span class="op" id="1736426">.</span><span class="ident" id="1736427">zero</span><span class="op" id="1736431">)</span><span class="op" id="1736432">,</span>&nbsp;<span class="builtintype" id="1736434">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736441">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736444">var</span>&nbsp;<span class="ident" id="1736448">b</span>&nbsp;<span class="op" id="1736450">*</span><span class="ident" id="1736451">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736457">if</span>&nbsp;<span class="ident" id="1736460">h</span><span class="op" id="1736461">.</span><span class="ident" id="1736462">B</span>&nbsp;<span class="op" id="1736464">==</span>&nbsp;<span class="num" id="1736467">0</span>&nbsp;<span class="op" id="1736469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1736473">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736514">b</span>&nbsp;<span class="op" id="1736516">=</span>&nbsp;<span class="op" id="1736518">(</span><span class="op" id="1736519">*</span><span class="ident" id="1736520">bmap</span><span class="op" id="1736524">)</span><span class="op" id="1736525">(</span><span class="ident" id="1736526">h</span><span class="op" id="1736527">.</span><span class="ident" id="1736528">buckets</span><span class="op" id="1736535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736538">}</span>&nbsp;<span class="keyword" id="1736540">else</span>&nbsp;<span class="op" id="1736545">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736549">hash</span>&nbsp;<span class="op" id="1736554">:=</span>&nbsp;<span class="ident" id="1736557">goalg</span><span class="op" id="1736562">(</span><span class="ident" id="1736563">t</span><span class="op" id="1736564">.</span><span class="ident" id="1736565">key</span><span class="op" id="1736568">.</span><span class="ident" id="1736569">alg</span><span class="op" id="1736572">)</span><span class="op" id="1736573">.</span><span class="ident" id="1736574">hash</span><span class="op" id="1736578">(</span><span class="ident" id="1736579">noescape</span><span class="op" id="1736587">(</span><span class="ident" id="1736588">unsafe</span><span class="op" id="1736594">.</span><span class="ident" id="1736595">Pointer</span><span class="op" id="1736602">(</span><span class="op" id="1736603">&amp;</span><span class="ident" id="1736604">key</span><span class="op" id="1736607">)</span><span class="op" id="1736608">)</span><span class="op" id="1736609">,</span>&nbsp;<span class="num" id="1736611">8</span><span class="op" id="1736612">,</span>&nbsp;<span class="builtintype" id="1736614">uintptr</span><span class="op" id="1736621">(</span><span class="ident" id="1736622">h</span><span class="op" id="1736623">.</span><span class="ident" id="1736624">hash0</span><span class="op" id="1736629">)</span><span class="op" id="1736630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736634">m</span>&nbsp;<span class="op" id="1736636">:=</span>&nbsp;<span class="builtintype" id="1736639">uintptr</span><span class="op" id="1736646">(</span><span class="num" id="1736647">1</span><span class="op" id="1736648">)</span><span class="op" id="1736649">&lt;&lt;</span><span class="ident" id="1736651">h</span><span class="op" id="1736652">.</span><span class="ident" id="1736653">B</span>&nbsp;<span class="op" id="1736655">-</span>&nbsp;<span class="num" id="1736657">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736661">b</span>&nbsp;<span class="op" id="1736663">=</span>&nbsp;<span class="op" id="1736665">(</span><span class="op" id="1736666">*</span><span class="ident" id="1736667">bmap</span><span class="op" id="1736671">)</span><span class="op" id="1736672">(</span><span class="ident" id="1736673">add</span><span class="op" id="1736676">(</span><span class="ident" id="1736677">h</span><span class="op" id="1736678">.</span><span class="ident" id="1736679">buckets</span><span class="op" id="1736686">,</span>&nbsp;<span class="op" id="1736688">(</span><span class="ident" id="1736689">hash</span><span class="op" id="1736693">&amp;</span><span class="ident" id="1736694">m</span><span class="op" id="1736695">)</span><span class="op" id="1736696">*</span><span class="builtintype" id="1736697">uintptr</span><span class="op" id="1736704">(</span><span class="ident" id="1736705">t</span><span class="op" id="1736706">.</span><span class="ident" id="1736707">bucketsize</span><span class="op" id="1736717">)</span><span class="op" id="1736718">)</span><span class="op" id="1736719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736723">if</span>&nbsp;<span class="ident" id="1736726">c</span>&nbsp;<span class="op" id="1736728">:=</span>&nbsp;<span class="ident" id="1736731">h</span><span class="op" id="1736732">.</span><span class="ident" id="1736733">oldbuckets</span><span class="op" id="1736743">;</span>&nbsp;<span class="ident" id="1736745">c</span>&nbsp;<span class="op" id="1736747">!=</span>&nbsp;<span class="ident" id="1736750">nil</span>&nbsp;<span class="op" id="1736754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736759">oldb</span>&nbsp;<span class="op" id="1736764">:=</span>&nbsp;<span class="op" id="1736767">(</span><span class="op" id="1736768">*</span><span class="ident" id="1736769">bmap</span><span class="op" id="1736773">)</span><span class="op" id="1736774">(</span><span class="ident" id="1736775">add</span><span class="op" id="1736778">(</span><span class="ident" id="1736779">c</span><span class="op" id="1736780">,</span>&nbsp;<span class="op" id="1736782">(</span><span class="ident" id="1736783">hash</span><span class="op" id="1736787">&amp;</span><span class="op" id="1736788">(</span><span class="ident" id="1736789">m</span><span class="op" id="1736790">&gt;&gt;</span><span class="num" id="1736792">1</span><span class="op" id="1736793">)</span><span class="op" id="1736794">)</span><span class="op" id="1736795">*</span><span class="builtintype" id="1736796">uintptr</span><span class="op" id="1736803">(</span><span class="ident" id="1736804">t</span><span class="op" id="1736805">.</span><span class="ident" id="1736806">bucketsize</span><span class="op" id="1736816">)</span><span class="op" id="1736817">)</span><span class="op" id="1736818">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736823">if</span>&nbsp;<span class="op" id="1736826">!</span><span class="ident" id="1736827">evacuated</span><span class="op" id="1736836">(</span><span class="ident" id="1736837">oldb</span><span class="op" id="1736841">)</span>&nbsp;<span class="op" id="1736843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736849">b</span>&nbsp;<span class="op" id="1736851">=</span>&nbsp;<span class="ident" id="1736853">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736868">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736871">for</span>&nbsp;<span class="op" id="1736875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736879">for</span>&nbsp;<span class="ident" id="1736883">i</span>&nbsp;<span class="op" id="1736885">:=</span>&nbsp;<span class="builtintype" id="1736888">uintptr</span><span class="op" id="1736895">(</span><span class="num" id="1736896">0</span><span class="op" id="1736897">)</span><span class="op" id="1736898">;</span>&nbsp;<span class="ident" id="1736900">i</span>&nbsp;<span class="op" id="1736902">&lt;</span>&nbsp;<span class="ident" id="1736904">bucketCnt</span><span class="op" id="1736913">;</span>&nbsp;<span class="ident" id="1736915">i</span><span class="op" id="1736916">++</span>&nbsp;<span class="op" id="1736919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736924">k</span>&nbsp;<span class="op" id="1736926">:=</span>&nbsp;<span class="op" id="1736929">*</span><span class="op" id="1736930">(</span><span class="op" id="1736931">(</span><span class="op" id="1736932">*</span><span class="ident" id="1736933">uint64</span><span class="op" id="1736939">)</span><span class="op" id="1736940">(</span><span class="ident" id="1736941">add</span><span class="op" id="1736944">(</span><span class="ident" id="1736945">unsafe</span><span class="op" id="1736951">.</span><span class="ident" id="1736952">Pointer</span><span class="op" id="1736959">(</span><span class="ident" id="1736960">b</span><span class="op" id="1736961">)</span><span class="op" id="1736962">,</span>&nbsp;<span class="ident" id="1736964">dataOffset</span><span class="op" id="1736974">+</span><span class="ident" id="1736975">i</span><span class="op" id="1736976">*</span><span class="num" id="1736977">8</span><span class="op" id="1736978">)</span><span class="op" id="1736979">)</span><span class="op" id="1736980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736985">if</span>&nbsp;<span class="ident" id="1736988">k</span>&nbsp;<span class="op" id="1736990">!=</span>&nbsp;<span class="ident" id="1736993">key</span>&nbsp;<span class="op" id="1736997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737003">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737020">x</span>&nbsp;<span class="op" id="1737022">:=</span>&nbsp;<span class="op" id="1737025">*</span><span class="op" id="1737026">(</span><span class="op" id="1737027">(</span><span class="op" id="1737028">*</span><span class="builtintype" id="1737029">uint8</span><span class="op" id="1737034">)</span><span class="op" id="1737035">(</span><span class="ident" id="1737036">add</span><span class="op" id="1737039">(</span><span class="ident" id="1737040">unsafe</span><span class="op" id="1737046">.</span><span class="ident" id="1737047">Pointer</span><span class="op" id="1737054">(</span><span class="ident" id="1737055">b</span><span class="op" id="1737056">)</span><span class="op" id="1737057">,</span>&nbsp;<span class="ident" id="1737059">i</span><span class="op" id="1737060">)</span><span class="op" id="1737061">)</span><span class="op" id="1737062">)</span>&nbsp;<span class="comment" id="1737064">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737108">if</span>&nbsp;<span class="ident" id="1737111">x</span>&nbsp;<span class="op" id="1737113">==</span>&nbsp;<span class="ident" id="1737116">empty</span>&nbsp;<span class="op" id="1737122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737128">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737140">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737145">return</span>&nbsp;<span class="ident" id="1737152">add</span><span class="op" id="1737155">(</span><span class="ident" id="1737156">unsafe</span><span class="op" id="1737162">.</span><span class="ident" id="1737163">Pointer</span><span class="op" id="1737170">(</span><span class="ident" id="1737171">b</span><span class="op" id="1737172">)</span><span class="op" id="1737173">,</span>&nbsp;<span class="ident" id="1737175">dataOffset</span><span class="op" id="1737185">+</span><span class="ident" id="1737186">bucketCnt</span><span class="op" id="1737195">*</span><span class="num" id="1737196">8</span><span class="op" id="1737197">+</span><span class="ident" id="1737198">i</span><span class="op" id="1737199">*</span><span class="builtintype" id="1737200">uintptr</span><span class="op" id="1737207">(</span><span class="ident" id="1737208">t</span><span class="op" id="1737209">.</span><span class="ident" id="1737210">valuesize</span><span class="op" id="1737219">)</span><span class="op" id="1737220">)</span><span class="op" id="1737221">,</span>&nbsp;<span class="builtintype" id="1737223">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737234">b</span>&nbsp;<span class="op" id="1737236">=</span>&nbsp;<span class="ident" id="1737238">b</span><span class="op" id="1737239">.</span><span class="ident" id="1737240">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737251">if</span>&nbsp;<span class="ident" id="1737254">b</span>&nbsp;<span class="op" id="1737256">==</span>&nbsp;<span class="ident" id="1737259">nil</span>&nbsp;<span class="op" id="1737263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737268">return</span>&nbsp;<span class="ident" id="1737275">unsafe</span><span class="op" id="1737281">.</span><span class="ident" id="1737282">Pointer</span><span class="op" id="1737289">(</span><span class="ident" id="1737290">t</span><span class="op" id="1737291">.</span><span class="ident" id="1737292">elem</span><span class="op" id="1737296">.</span><span class="ident" id="1737297">zero</span><span class="op" id="1737301">)</span><span class="op" id="1737302">,</span>&nbsp;<span class="builtintype" id="1737304">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737315">}</span><br>
<span class="lineno"></span><span class="op" id="1737317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1737320">func</span>&nbsp;<span class="ident" id="1737325">mapaccess1_faststr</span><span class="op" id="1737343">(</span><span class="ident" id="1737344">t</span>&nbsp;<span class="op" id="1737346">*</span><span class="ident" id="1737347">maptype</span><span class="op" id="1737354">,</span>&nbsp;<span class="ident" id="1737356">h</span>&nbsp;<span class="op" id="1737358">*</span><span class="ident" id="1737359">hmap</span><span class="op" id="1737363">,</span>&nbsp;<span class="ident" id="1737365">ky</span>&nbsp;<span class="builtintype" id="1737368">string</span><span class="op" id="1737374">)</span>&nbsp;<span class="ident" id="1737376">unsafe</span><span class="op" id="1737382">.</span><span class="ident" id="1737383">Pointer</span>&nbsp;<span class="op" id="1737391">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737394">if</span>&nbsp;<span class="ident" id="1737397">raceenabled</span>&nbsp;<span class="op" id="1737409">&amp;&amp;</span>&nbsp;<span class="ident" id="1737412">h</span>&nbsp;<span class="op" id="1737414">!=</span>&nbsp;<span class="ident" id="1737417">nil</span>&nbsp;<span class="op" id="1737421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737425">callerpc</span>&nbsp;<span class="op" id="1737434">:=</span>&nbsp;<span class="ident" id="1737437">getcallerpc</span><span class="op" id="1737448">(</span><span class="ident" id="1737449">unsafe</span><span class="op" id="1737455">.</span><span class="ident" id="1737456">Pointer</span><span class="op" id="1737463">(</span><span class="op" id="1737464">&amp;</span><span class="ident" id="1737465">t</span><span class="op" id="1737466">)</span><span class="op" id="1737467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737471">racereadpc</span><span class="op" id="1737481">(</span><span class="ident" id="1737482">unsafe</span><span class="op" id="1737488">.</span><span class="ident" id="1737489">Pointer</span><span class="op" id="1737496">(</span><span class="ident" id="1737497">h</span><span class="op" id="1737498">)</span><span class="op" id="1737499">,</span>&nbsp;<span class="ident" id="1737501">callerpc</span><span class="op" id="1737509">,</span>&nbsp;<span class="ident" id="1737511">funcPC</span><span class="op" id="1737517">(</span><span class="ident" id="1737518">mapaccess1_faststr</span><span class="op" id="1737536">)</span><span class="op" id="1737537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737543">if</span>&nbsp;<span class="ident" id="1737546">h</span>&nbsp;<span class="op" id="1737548">==</span>&nbsp;<span class="ident" id="1737551">nil</span>&nbsp;<span class="op" id="1737555">||</span>&nbsp;<span class="ident" id="1737558">h</span><span class="op" id="1737559">.</span><span class="ident" id="1737560">count</span>&nbsp;<span class="op" id="1737566">==</span>&nbsp;<span class="num" id="1737569">0</span>&nbsp;<span class="op" id="1737571">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737575">return</span>&nbsp;<span class="ident" id="1737582">unsafe</span><span class="op" id="1737588">.</span><span class="ident" id="1737589">Pointer</span><span class="op" id="1737596">(</span><span class="ident" id="1737597">t</span><span class="op" id="1737598">.</span><span class="ident" id="1737599">elem</span><span class="op" id="1737603">.</span><span class="ident" id="1737604">zero</span><span class="op" id="1737608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737614">key</span>&nbsp;<span class="op" id="1737618">:=</span>&nbsp;<span class="op" id="1737621">(</span><span class="op" id="1737622">*</span><span class="ident" id="1737623">stringStruct</span><span class="op" id="1737635">)</span><span class="op" id="1737636">(</span><span class="ident" id="1737637">unsafe</span><span class="op" id="1737643">.</span><span class="ident" id="1737644">Pointer</span><span class="op" id="1737651">(</span><span class="op" id="1737652">&amp;</span><span class="ident" id="1737653">ky</span><span class="op" id="1737655">)</span><span class="op" id="1737656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737659">if</span>&nbsp;<span class="ident" id="1737662">h</span><span class="op" id="1737663">.</span><span class="ident" id="1737664">B</span>&nbsp;<span class="op" id="1737666">==</span>&nbsp;<span class="num" id="1737669">0</span>&nbsp;<span class="op" id="1737671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1737675">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737698">b</span>&nbsp;<span class="op" id="1737700">:=</span>&nbsp;<span class="op" id="1737703">(</span><span class="op" id="1737704">*</span><span class="ident" id="1737705">bmap</span><span class="op" id="1737709">)</span><span class="op" id="1737710">(</span><span class="ident" id="1737711">h</span><span class="op" id="1737712">.</span><span class="ident" id="1737713">buckets</span><span class="op" id="1737720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737724">if</span>&nbsp;<span class="ident" id="1737727">key</span><span class="op" id="1737730">.</span><span class="builtinfunc" id="1737731">len</span>&nbsp;<span class="op" id="1737735">&lt;</span>&nbsp;<span class="num" id="1737737">32</span>&nbsp;<span class="op" id="1737740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1737745">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737794">for</span>&nbsp;<span class="ident" id="1737798">i</span>&nbsp;<span class="op" id="1737800">:=</span>&nbsp;<span class="builtintype" id="1737803">uintptr</span><span class="op" id="1737810">(</span><span class="num" id="1737811">0</span><span class="op" id="1737812">)</span><span class="op" id="1737813">;</span>&nbsp;<span class="ident" id="1737815">i</span>&nbsp;<span class="op" id="1737817">&lt;</span>&nbsp;<span class="ident" id="1737819">bucketCnt</span><span class="op" id="1737828">;</span>&nbsp;<span class="ident" id="1737830">i</span><span class="op" id="1737831">++</span>&nbsp;<span class="op" id="1737834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737840">x</span>&nbsp;<span class="op" id="1737842">:=</span>&nbsp;<span class="op" id="1737845">*</span><span class="op" id="1737846">(</span><span class="op" id="1737847">(</span><span class="op" id="1737848">*</span><span class="builtintype" id="1737849">uint8</span><span class="op" id="1737854">)</span><span class="op" id="1737855">(</span><span class="ident" id="1737856">add</span><span class="op" id="1737859">(</span><span class="ident" id="1737860">unsafe</span><span class="op" id="1737866">.</span><span class="ident" id="1737867">Pointer</span><span class="op" id="1737874">(</span><span class="ident" id="1737875">b</span><span class="op" id="1737876">)</span><span class="op" id="1737877">,</span>&nbsp;<span class="ident" id="1737879">i</span><span class="op" id="1737880">)</span><span class="op" id="1737881">)</span><span class="op" id="1737882">)</span>&nbsp;<span class="comment" id="1737884">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737929">if</span>&nbsp;<span class="ident" id="1737932">x</span>&nbsp;<span class="op" id="1737934">==</span>&nbsp;<span class="ident" id="1737937">empty</span>&nbsp;<span class="op" id="1737943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1737950">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1737963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1737969">k</span>&nbsp;<span class="op" id="1737971">:=</span>&nbsp;<span class="op" id="1737974">(</span><span class="op" id="1737975">*</span><span class="ident" id="1737976">stringStruct</span><span class="op" id="1737988">)</span><span class="op" id="1737989">(</span><span class="ident" id="1737990">add</span><span class="op" id="1737993">(</span><span class="ident" id="1737994">unsafe</span><span class="op" id="1738000">.</span><span class="ident" id="1738001">Pointer</span><span class="op" id="1738008">(</span><span class="ident" id="1738009">b</span><span class="op" id="1738010">)</span><span class="op" id="1738011">,</span>&nbsp;<span class="ident" id="1738013">dataOffset</span><span class="op" id="1738023">+</span><span class="ident" id="1738024">i</span><span class="op" id="1738025">*</span><span class="num" id="1738026">2</span><span class="op" id="1738027">*</span><span class="ident" id="1738028">ptrSize</span><span class="op" id="1738035">)</span><span class="op" id="1738036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738042">if</span>&nbsp;<span class="ident" id="1738045">k</span><span class="op" id="1738046">.</span><span class="builtinfunc" id="1738047">len</span>&nbsp;<span class="op" id="1738051">!=</span>&nbsp;<span class="ident" id="1738054">key</span><span class="op" id="1738057">.</span><span class="builtinfunc" id="1738058">len</span>&nbsp;<span class="op" id="1738062">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738069">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1738082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738088">if</span>&nbsp;<span class="ident" id="1738091">k</span><span class="op" id="1738092">.</span><span class="ident" id="1738093">str</span>&nbsp;<span class="op" id="1738097">==</span>&nbsp;<span class="ident" id="1738100">key</span><span class="op" id="1738103">.</span><span class="ident" id="1738104">str</span>&nbsp;<span class="op" id="1738108">||</span>&nbsp;<span class="ident" id="1738111">memeq</span><span class="op" id="1738116">(</span><span class="ident" id="1738117">k</span><span class="op" id="1738118">.</span><span class="ident" id="1738119">str</span><span class="op" id="1738122">,</span>&nbsp;<span class="ident" id="1738124">key</span><span class="op" id="1738127">.</span><span class="ident" id="1738128">str</span><span class="op" id="1738131">,</span>&nbsp;<span class="builtintype" id="1738133">uintptr</span><span class="op" id="1738140">(</span><span class="ident" id="1738141">key</span><span class="op" id="1738144">.</span><span class="builtinfunc" id="1738145">len</span><span class="op" id="1738148">)</span><span class="op" id="1738149">)</span>&nbsp;<span class="op" id="1738151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738158">return</span>&nbsp;<span class="ident" id="1738165">add</span><span class="op" id="1738168">(</span><span class="ident" id="1738169">unsafe</span><span class="op" id="1738175">.</span><span class="ident" id="1738176">Pointer</span><span class="op" id="1738183">(</span><span class="ident" id="1738184">b</span><span class="op" id="1738185">)</span><span class="op" id="1738186">,</span>&nbsp;<span class="ident" id="1738188">dataOffset</span><span class="op" id="1738198">+</span><span class="ident" id="1738199">bucketCnt</span><span class="op" id="1738208">*</span><span class="num" id="1738209">2</span><span class="op" id="1738210">*</span><span class="ident" id="1738211">ptrSize</span><span class="op" id="1738218">+</span><span class="ident" id="1738219">i</span><span class="op" id="1738220">*</span><span class="builtintype" id="1738221">uintptr</span><span class="op" id="1738228">(</span><span class="ident" id="1738229">t</span><span class="op" id="1738230">.</span><span class="ident" id="1738231">valuesize</span><span class="op" id="1738240">)</span><span class="op" id="1738241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1738247">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1738252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738257">return</span>&nbsp;<span class="ident" id="1738264">unsafe</span><span class="op" id="1738270">.</span><span class="ident" id="1738271">Pointer</span><span class="op" id="1738278">(</span><span class="ident" id="1738279">t</span><span class="op" id="1738280">.</span><span class="ident" id="1738281">elem</span><span class="op" id="1738285">.</span><span class="ident" id="1738286">zero</span><span class="op" id="1738290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1738294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1738298">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1738359">keymaybe</span>&nbsp;<span class="op" id="1738368">:=</span>&nbsp;<span class="builtintype" id="1738371">uintptr</span><span class="op" id="1738378">(</span><span class="ident" id="1738379">bucketCnt</span><span class="op" id="1738388">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738392">for</span>&nbsp;<span class="ident" id="1738396">i</span>&nbsp;<span class="op" id="1738398">:=</span>&nbsp;<span class="builtintype" id="1738401">uintptr</span><span class="op" id="1738408">(</span><span class="num" id="1738409">0</span><span class="op" id="1738410">)</span><span class="op" id="1738411">;</span>&nbsp;<span class="ident" id="1738413">i</span>&nbsp;<span class="op" id="1738415">&lt;</span>&nbsp;<span class="ident" id="1738417">bucketCnt</span><span class="op" id="1738426">;</span>&nbsp;<span class="ident" id="1738428">i</span><span class="op" id="1738429">++</span>&nbsp;<span class="op" id="1738432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1738437">x</span>&nbsp;<span class="op" id="1738439">:=</span>&nbsp;<span class="op" id="1738442">*</span><span class="op" id="1738443">(</span><span class="op" id="1738444">(</span><span class="op" id="1738445">*</span><span class="builtintype" id="1738446">uint8</span><span class="op" id="1738451">)</span><span class="op" id="1738452">(</span><span class="ident" id="1738453">add</span><span class="op" id="1738456">(</span><span class="ident" id="1738457">unsafe</span><span class="op" id="1738463">.</span><span class="ident" id="1738464">Pointer</span><span class="op" id="1738471">(</span><span class="ident" id="1738472">b</span><span class="op" id="1738473">)</span><span class="op" id="1738474">,</span>&nbsp;<span class="ident" id="1738476">i</span><span class="op" id="1738477">)</span><span class="op" id="1738478">)</span><span class="op" id="1738479">)</span>&nbsp;<span class="comment" id="1738481">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738525">if</span>&nbsp;<span class="ident" id="1738528">x</span>&nbsp;<span class="op" id="1738530">==</span>&nbsp;<span class="ident" id="1738533">empty</span>&nbsp;<span class="op" id="1738539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738545">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1738557">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1738562">k</span>&nbsp;<span class="op" id="1738564">:=</span>&nbsp;<span class="op" id="1738567">(</span><span class="op" id="1738568">*</span><span class="ident" id="1738569">stringStruct</span><span class="op" id="1738581">)</span><span class="op" id="1738582">(</span><span class="ident" id="1738583">add</span><span class="op" id="1738586">(</span><span class="ident" id="1738587">unsafe</span><span class="op" id="1738593">.</span><span class="ident" id="1738594">Pointer</span><span class="op" id="1738601">(</span><span class="ident" id="1738602">b</span><span class="op" id="1738603">)</span><span class="op" id="1738604">,</span>&nbsp;<span class="ident" id="1738606">dataOffset</span><span class="op" id="1738616">+</span><span class="ident" id="1738617">i</span><span class="op" id="1738618">*</span><span class="num" id="1738619">2</span><span class="op" id="1738620">*</span><span class="ident" id="1738621">ptrSize</span><span class="op" id="1738628">)</span><span class="op" id="1738629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738634">if</span>&nbsp;<span class="ident" id="1738637">k</span><span class="op" id="1738638">.</span><span class="builtinfunc" id="1738639">len</span>&nbsp;<span class="op" id="1738643">!=</span>&nbsp;<span class="ident" id="1738646">key</span><span class="op" id="1738649">.</span><span class="builtinfunc" id="1738650">len</span>&nbsp;<span class="op" id="1738654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738660">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1738672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738677">if</span>&nbsp;<span class="ident" id="1738680">k</span><span class="op" id="1738681">.</span><span class="ident" id="1738682">str</span>&nbsp;<span class="op" id="1738686">==</span>&nbsp;<span class="ident" id="1738689">key</span><span class="op" id="1738692">.</span><span class="ident" id="1738693">str</span>&nbsp;<span class="op" id="1738697">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738703">return</span>&nbsp;<span class="ident" id="1738710">add</span><span class="op" id="1738713">(</span><span class="ident" id="1738714">unsafe</span><span class="op" id="1738720">.</span><span class="ident" id="1738721">Pointer</span><span class="op" id="1738728">(</span><span class="ident" id="1738729">b</span><span class="op" id="1738730">)</span><span class="op" id="1738731">,</span>&nbsp;<span class="ident" id="1738733">dataOffset</span><span class="op" id="1738743">+</span><span class="ident" id="1738744">bucketCnt</span><span class="op" id="1738753">*</span><span class="num" id="1738754">2</span><span class="op" id="1738755">*</span><span class="ident" id="1738756">ptrSize</span><span class="op" id="1738763">+</span><span class="ident" id="1738764">i</span><span class="op" id="1738765">*</span><span class="builtintype" id="1738766">uintptr</span><span class="op" id="1738773">(</span><span class="ident" id="1738774">t</span><span class="op" id="1738775">.</span><span class="ident" id="1738776">valuesize</span><span class="op" id="1738785">)</span><span class="op" id="1738786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1738791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1738796">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1738822">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1738911">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738942">if</span>&nbsp;<span class="op" id="1738945">*</span><span class="op" id="1738946">(</span><span class="op" id="1738947">(</span><span class="op" id="1738948">*</span><span class="op" id="1738949">[</span><span class="num" id="1738950">4</span><span class="op" id="1738951">]</span><span class="builtintype" id="1738952">byte</span><span class="op" id="1738956">)</span><span class="op" id="1738957">(</span><span class="ident" id="1738958">key</span><span class="op" id="1738961">.</span><span class="ident" id="1738962">str</span><span class="op" id="1738965">)</span><span class="op" id="1738966">)</span>&nbsp;<span class="op" id="1738968">!=</span>&nbsp;<span class="op" id="1738971">*</span><span class="op" id="1738972">(</span><span class="op" id="1738973">(</span><span class="op" id="1738974">*</span><span class="op" id="1738975">[</span><span class="num" id="1738976">4</span><span class="op" id="1738977">]</span><span class="builtintype" id="1738978">byte</span><span class="op" id="1738982">)</span><span class="op" id="1738983">(</span><span class="ident" id="1738984">k</span><span class="op" id="1738985">.</span><span class="ident" id="1738986">str</span><span class="op" id="1738989">)</span><span class="op" id="1738990">)</span>&nbsp;<span class="op" id="1738992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1738998">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1739015">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739040">if</span>&nbsp;<span class="op" id="1739043">*</span><span class="op" id="1739044">(</span><span class="op" id="1739045">(</span><span class="op" id="1739046">*</span><span class="op" id="1739047">[</span><span class="num" id="1739048">4</span><span class="op" id="1739049">]</span><span class="builtintype" id="1739050">byte</span><span class="op" id="1739054">)</span><span class="op" id="1739055">(</span><span class="ident" id="1739056">add</span><span class="op" id="1739059">(</span><span class="ident" id="1739060">key</span><span class="op" id="1739063">.</span><span class="ident" id="1739064">str</span><span class="op" id="1739067">,</span>&nbsp;<span class="builtintype" id="1739069">uintptr</span><span class="op" id="1739076">(</span><span class="ident" id="1739077">key</span><span class="op" id="1739080">.</span><span class="builtinfunc" id="1739081">len</span><span class="op" id="1739084">)</span><span class="op" id="1739085">-</span><span class="num" id="1739086">4</span><span class="op" id="1739087">)</span><span class="op" id="1739088">)</span><span class="op" id="1739089">)</span>&nbsp;<span class="op" id="1739091">!=</span>&nbsp;<span class="op" id="1739094">*</span><span class="op" id="1739095">(</span><span class="op" id="1739096">(</span><span class="op" id="1739097">*</span><span class="op" id="1739098">[</span><span class="num" id="1739099">4</span><span class="op" id="1739100">]</span><span class="builtintype" id="1739101">byte</span><span class="op" id="1739105">)</span><span class="op" id="1739106">(</span><span class="ident" id="1739107">add</span><span class="op" id="1739110">(</span><span class="ident" id="1739111">k</span><span class="op" id="1739112">.</span><span class="ident" id="1739113">str</span><span class="op" id="1739116">,</span>&nbsp;<span class="builtintype" id="1739118">uintptr</span><span class="op" id="1739125">(</span><span class="ident" id="1739126">key</span><span class="op" id="1739129">.</span><span class="builtinfunc" id="1739130">len</span><span class="op" id="1739133">)</span><span class="op" id="1739134">-</span><span class="num" id="1739135">4</span><span class="op" id="1739136">)</span><span class="op" id="1739137">)</span><span class="op" id="1739138">)</span>&nbsp;<span class="op" id="1739140">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739146">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739163">if</span>&nbsp;<span class="ident" id="1739166">keymaybe</span>&nbsp;<span class="op" id="1739175">!=</span>&nbsp;<span class="ident" id="1739178">bucketCnt</span>&nbsp;<span class="op" id="1739188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1739194">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739264">goto</span>&nbsp;<span class="ident" id="1739269">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739284">keymaybe</span>&nbsp;<span class="op" id="1739293">=</span>&nbsp;<span class="ident" id="1739295">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739303">if</span>&nbsp;<span class="ident" id="1739306">keymaybe</span>&nbsp;<span class="op" id="1739315">!=</span>&nbsp;<span class="ident" id="1739318">bucketCnt</span>&nbsp;<span class="op" id="1739328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739333">k</span>&nbsp;<span class="op" id="1739335">:=</span>&nbsp;<span class="op" id="1739338">(</span><span class="op" id="1739339">*</span><span class="ident" id="1739340">stringStruct</span><span class="op" id="1739352">)</span><span class="op" id="1739353">(</span><span class="ident" id="1739354">add</span><span class="op" id="1739357">(</span><span class="ident" id="1739358">unsafe</span><span class="op" id="1739364">.</span><span class="ident" id="1739365">Pointer</span><span class="op" id="1739372">(</span><span class="ident" id="1739373">b</span><span class="op" id="1739374">)</span><span class="op" id="1739375">,</span>&nbsp;<span class="ident" id="1739377">dataOffset</span><span class="op" id="1739387">+</span><span class="ident" id="1739388">keymaybe</span><span class="op" id="1739396">*</span><span class="num" id="1739397">2</span><span class="op" id="1739398">*</span><span class="ident" id="1739399">ptrSize</span><span class="op" id="1739406">)</span><span class="op" id="1739407">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739412">if</span>&nbsp;<span class="ident" id="1739415">memeq</span><span class="op" id="1739420">(</span><span class="ident" id="1739421">k</span><span class="op" id="1739422">.</span><span class="ident" id="1739423">str</span><span class="op" id="1739426">,</span>&nbsp;<span class="ident" id="1739428">key</span><span class="op" id="1739431">.</span><span class="ident" id="1739432">str</span><span class="op" id="1739435">,</span>&nbsp;<span class="builtintype" id="1739437">uintptr</span><span class="op" id="1739444">(</span><span class="ident" id="1739445">key</span><span class="op" id="1739448">.</span><span class="builtinfunc" id="1739449">len</span><span class="op" id="1739452">)</span><span class="op" id="1739453">)</span>&nbsp;<span class="op" id="1739455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739461">return</span>&nbsp;<span class="ident" id="1739468">add</span><span class="op" id="1739471">(</span><span class="ident" id="1739472">unsafe</span><span class="op" id="1739478">.</span><span class="ident" id="1739479">Pointer</span><span class="op" id="1739486">(</span><span class="ident" id="1739487">b</span><span class="op" id="1739488">)</span><span class="op" id="1739489">,</span>&nbsp;<span class="ident" id="1739491">dataOffset</span><span class="op" id="1739501">+</span><span class="ident" id="1739502">bucketCnt</span><span class="op" id="1739511">*</span><span class="num" id="1739512">2</span><span class="op" id="1739513">*</span><span class="ident" id="1739514">ptrSize</span><span class="op" id="1739521">+</span><span class="ident" id="1739522">keymaybe</span><span class="op" id="1739530">*</span><span class="builtintype" id="1739531">uintptr</span><span class="op" id="1739538">(</span><span class="ident" id="1739539">t</span><span class="op" id="1739540">.</span><span class="ident" id="1739541">valuesize</span><span class="op" id="1739550">)</span><span class="op" id="1739551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739564">return</span>&nbsp;<span class="ident" id="1739571">unsafe</span><span class="op" id="1739577">.</span><span class="ident" id="1739578">Pointer</span><span class="op" id="1739585">(</span><span class="ident" id="1739586">t</span><span class="op" id="1739587">.</span><span class="ident" id="1739588">elem</span><span class="op" id="1739592">.</span><span class="ident" id="1739593">zero</span><span class="op" id="1739597">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739600">}</span><br>
<span class="lineno"></span><span class="ident" id="1739602">dohash</span><span class="op" id="1739608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739611">hash</span>&nbsp;<span class="op" id="1739616">:=</span>&nbsp;<span class="ident" id="1739619">goalg</span><span class="op" id="1739624">(</span><span class="ident" id="1739625">t</span><span class="op" id="1739626">.</span><span class="ident" id="1739627">key</span><span class="op" id="1739630">.</span><span class="ident" id="1739631">alg</span><span class="op" id="1739634">)</span><span class="op" id="1739635">.</span><span class="ident" id="1739636">hash</span><span class="op" id="1739640">(</span><span class="ident" id="1739641">noescape</span><span class="op" id="1739649">(</span><span class="ident" id="1739650">unsafe</span><span class="op" id="1739656">.</span><span class="ident" id="1739657">Pointer</span><span class="op" id="1739664">(</span><span class="op" id="1739665">&amp;</span><span class="ident" id="1739666">ky</span><span class="op" id="1739668">)</span><span class="op" id="1739669">)</span><span class="op" id="1739670">,</span>&nbsp;<span class="num" id="1739672">2</span><span class="op" id="1739673">*</span><span class="ident" id="1739674">ptrSize</span><span class="op" id="1739681">,</span>&nbsp;<span class="builtintype" id="1739683">uintptr</span><span class="op" id="1739690">(</span><span class="ident" id="1739691">h</span><span class="op" id="1739692">.</span><span class="ident" id="1739693">hash0</span><span class="op" id="1739698">)</span><span class="op" id="1739699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739702">m</span>&nbsp;<span class="op" id="1739704">:=</span>&nbsp;<span class="builtintype" id="1739707">uintptr</span><span class="op" id="1739714">(</span><span class="num" id="1739715">1</span><span class="op" id="1739716">)</span><span class="op" id="1739717">&lt;&lt;</span><span class="ident" id="1739719">h</span><span class="op" id="1739720">.</span><span class="ident" id="1739721">B</span>&nbsp;<span class="op" id="1739723">-</span>&nbsp;<span class="num" id="1739725">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739728">b</span>&nbsp;<span class="op" id="1739730">:=</span>&nbsp;<span class="op" id="1739733">(</span><span class="op" id="1739734">*</span><span class="ident" id="1739735">bmap</span><span class="op" id="1739739">)</span><span class="op" id="1739740">(</span><span class="ident" id="1739741">add</span><span class="op" id="1739744">(</span><span class="ident" id="1739745">h</span><span class="op" id="1739746">.</span><span class="ident" id="1739747">buckets</span><span class="op" id="1739754">,</span>&nbsp;<span class="op" id="1739756">(</span><span class="ident" id="1739757">hash</span><span class="op" id="1739761">&amp;</span><span class="ident" id="1739762">m</span><span class="op" id="1739763">)</span><span class="op" id="1739764">*</span><span class="builtintype" id="1739765">uintptr</span><span class="op" id="1739772">(</span><span class="ident" id="1739773">t</span><span class="op" id="1739774">.</span><span class="ident" id="1739775">bucketsize</span><span class="op" id="1739785">)</span><span class="op" id="1739786">)</span><span class="op" id="1739787">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739790">if</span>&nbsp;<span class="ident" id="1739793">c</span>&nbsp;<span class="op" id="1739795">:=</span>&nbsp;<span class="ident" id="1739798">h</span><span class="op" id="1739799">.</span><span class="ident" id="1739800">oldbuckets</span><span class="op" id="1739810">;</span>&nbsp;<span class="ident" id="1739812">c</span>&nbsp;<span class="op" id="1739814">!=</span>&nbsp;<span class="ident" id="1739817">nil</span>&nbsp;<span class="op" id="1739821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739825">oldb</span>&nbsp;<span class="op" id="1739830">:=</span>&nbsp;<span class="op" id="1739833">(</span><span class="op" id="1739834">*</span><span class="ident" id="1739835">bmap</span><span class="op" id="1739839">)</span><span class="op" id="1739840">(</span><span class="ident" id="1739841">add</span><span class="op" id="1739844">(</span><span class="ident" id="1739845">c</span><span class="op" id="1739846">,</span>&nbsp;<span class="op" id="1739848">(</span><span class="ident" id="1739849">hash</span><span class="op" id="1739853">&amp;</span><span class="op" id="1739854">(</span><span class="ident" id="1739855">m</span><span class="op" id="1739856">&gt;&gt;</span><span class="num" id="1739858">1</span><span class="op" id="1739859">)</span><span class="op" id="1739860">)</span><span class="op" id="1739861">*</span><span class="builtintype" id="1739862">uintptr</span><span class="op" id="1739869">(</span><span class="ident" id="1739870">t</span><span class="op" id="1739871">.</span><span class="ident" id="1739872">bucketsize</span><span class="op" id="1739882">)</span><span class="op" id="1739883">)</span><span class="op" id="1739884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739888">if</span>&nbsp;<span class="op" id="1739891">!</span><span class="ident" id="1739892">evacuated</span><span class="op" id="1739901">(</span><span class="ident" id="1739902">oldb</span><span class="op" id="1739906">)</span>&nbsp;<span class="op" id="1739908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739913">b</span>&nbsp;<span class="op" id="1739915">=</span>&nbsp;<span class="ident" id="1739917">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739924">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1739927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739930">top</span>&nbsp;<span class="op" id="1739934">:=</span>&nbsp;<span class="builtintype" id="1739937">uint8</span><span class="op" id="1739942">(</span><span class="ident" id="1739943">hash</span>&nbsp;<span class="op" id="1739948">&gt;&gt;</span>&nbsp;<span class="op" id="1739951">(</span><span class="ident" id="1739952">ptrSize</span><span class="op" id="1739959">*</span><span class="num" id="1739960">8</span>&nbsp;<span class="op" id="1739962">-</span>&nbsp;<span class="num" id="1739964">8</span><span class="op" id="1739965">)</span><span class="op" id="1739966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1739969">if</span>&nbsp;<span class="ident" id="1739972">top</span>&nbsp;<span class="op" id="1739976">&lt;</span>&nbsp;<span class="ident" id="1739978">minTopHash</span>&nbsp;<span class="op" id="1739989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1739993">top</span>&nbsp;<span class="op" id="1739997">+=</span>&nbsp;<span class="ident" id="1740000">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740012">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740015">for</span>&nbsp;<span class="op" id="1740019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740023">for</span>&nbsp;<span class="ident" id="1740027">i</span>&nbsp;<span class="op" id="1740029">:=</span>&nbsp;<span class="builtintype" id="1740032">uintptr</span><span class="op" id="1740039">(</span><span class="num" id="1740040">0</span><span class="op" id="1740041">)</span><span class="op" id="1740042">;</span>&nbsp;<span class="ident" id="1740044">i</span>&nbsp;<span class="op" id="1740046">&lt;</span>&nbsp;<span class="ident" id="1740048">bucketCnt</span><span class="op" id="1740057">;</span>&nbsp;<span class="ident" id="1740059">i</span><span class="op" id="1740060">++</span>&nbsp;<span class="op" id="1740063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1740068">x</span>&nbsp;<span class="op" id="1740070">:=</span>&nbsp;<span class="op" id="1740073">*</span><span class="op" id="1740074">(</span><span class="op" id="1740075">(</span><span class="op" id="1740076">*</span><span class="builtintype" id="1740077">uint8</span><span class="op" id="1740082">)</span><span class="op" id="1740083">(</span><span class="ident" id="1740084">add</span><span class="op" id="1740087">(</span><span class="ident" id="1740088">unsafe</span><span class="op" id="1740094">.</span><span class="ident" id="1740095">Pointer</span><span class="op" id="1740102">(</span><span class="ident" id="1740103">b</span><span class="op" id="1740104">)</span><span class="op" id="1740105">,</span>&nbsp;<span class="ident" id="1740107">i</span><span class="op" id="1740108">)</span><span class="op" id="1740109">)</span><span class="op" id="1740110">)</span>&nbsp;<span class="comment" id="1740112">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740156">if</span>&nbsp;<span class="ident" id="1740159">x</span>&nbsp;<span class="op" id="1740161">!=</span>&nbsp;<span class="ident" id="1740164">top</span>&nbsp;<span class="op" id="1740168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740174">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1740191">k</span>&nbsp;<span class="op" id="1740193">:=</span>&nbsp;<span class="op" id="1740196">(</span><span class="op" id="1740197">*</span><span class="ident" id="1740198">stringStruct</span><span class="op" id="1740210">)</span><span class="op" id="1740211">(</span><span class="ident" id="1740212">add</span><span class="op" id="1740215">(</span><span class="ident" id="1740216">unsafe</span><span class="op" id="1740222">.</span><span class="ident" id="1740223">Pointer</span><span class="op" id="1740230">(</span><span class="ident" id="1740231">b</span><span class="op" id="1740232">)</span><span class="op" id="1740233">,</span>&nbsp;<span class="ident" id="1740235">dataOffset</span><span class="op" id="1740245">+</span><span class="ident" id="1740246">i</span><span class="op" id="1740247">*</span><span class="num" id="1740248">2</span><span class="op" id="1740249">*</span><span class="ident" id="1740250">ptrSize</span><span class="op" id="1740257">)</span><span class="op" id="1740258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740263">if</span>&nbsp;<span class="ident" id="1740266">k</span><span class="op" id="1740267">.</span><span class="builtinfunc" id="1740268">len</span>&nbsp;<span class="op" id="1740272">!=</span>&nbsp;<span class="ident" id="1740275">key</span><span class="op" id="1740278">.</span><span class="builtinfunc" id="1740279">len</span>&nbsp;<span class="op" id="1740283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740289">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740301">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740306">if</span>&nbsp;<span class="ident" id="1740309">k</span><span class="op" id="1740310">.</span><span class="ident" id="1740311">str</span>&nbsp;<span class="op" id="1740315">==</span>&nbsp;<span class="ident" id="1740318">key</span><span class="op" id="1740321">.</span><span class="ident" id="1740322">str</span>&nbsp;<span class="op" id="1740326">||</span>&nbsp;<span class="ident" id="1740329">memeq</span><span class="op" id="1740334">(</span><span class="ident" id="1740335">k</span><span class="op" id="1740336">.</span><span class="ident" id="1740337">str</span><span class="op" id="1740340">,</span>&nbsp;<span class="ident" id="1740342">key</span><span class="op" id="1740345">.</span><span class="ident" id="1740346">str</span><span class="op" id="1740349">,</span>&nbsp;<span class="builtintype" id="1740351">uintptr</span><span class="op" id="1740358">(</span><span class="ident" id="1740359">key</span><span class="op" id="1740362">.</span><span class="builtinfunc" id="1740363">len</span><span class="op" id="1740366">)</span><span class="op" id="1740367">)</span>&nbsp;<span class="op" id="1740369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740375">return</span>&nbsp;<span class="ident" id="1740382">add</span><span class="op" id="1740385">(</span><span class="ident" id="1740386">unsafe</span><span class="op" id="1740392">.</span><span class="ident" id="1740393">Pointer</span><span class="op" id="1740400">(</span><span class="ident" id="1740401">b</span><span class="op" id="1740402">)</span><span class="op" id="1740403">,</span>&nbsp;<span class="ident" id="1740405">dataOffset</span><span class="op" id="1740415">+</span><span class="ident" id="1740416">bucketCnt</span><span class="op" id="1740425">*</span><span class="num" id="1740426">2</span><span class="op" id="1740427">*</span><span class="ident" id="1740428">ptrSize</span><span class="op" id="1740435">+</span><span class="ident" id="1740436">i</span><span class="op" id="1740437">*</span><span class="builtintype" id="1740438">uintptr</span><span class="op" id="1740445">(</span><span class="ident" id="1740446">t</span><span class="op" id="1740447">.</span><span class="ident" id="1740448">valuesize</span><span class="op" id="1740457">)</span><span class="op" id="1740458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1740471">b</span>&nbsp;<span class="op" id="1740473">=</span>&nbsp;<span class="ident" id="1740475">b</span><span class="op" id="1740476">.</span><span class="ident" id="1740477">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740488">if</span>&nbsp;<span class="ident" id="1740491">b</span>&nbsp;<span class="op" id="1740493">==</span>&nbsp;<span class="ident" id="1740496">nil</span>&nbsp;<span class="op" id="1740500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740505">return</span>&nbsp;<span class="ident" id="1740512">unsafe</span><span class="op" id="1740518">.</span><span class="ident" id="1740519">Pointer</span><span class="op" id="1740526">(</span><span class="ident" id="1740527">t</span><span class="op" id="1740528">.</span><span class="ident" id="1740529">elem</span><span class="op" id="1740533">.</span><span class="ident" id="1740534">zero</span><span class="op" id="1740538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740545">}</span><br>
<span class="lineno"></span><span class="op" id="1740547">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1740550">func</span>&nbsp;<span class="ident" id="1740555">mapaccess2_faststr</span><span class="op" id="1740573">(</span><span class="ident" id="1740574">t</span>&nbsp;<span class="op" id="1740576">*</span><span class="ident" id="1740577">maptype</span><span class="op" id="1740584">,</span>&nbsp;<span class="ident" id="1740586">h</span>&nbsp;<span class="op" id="1740588">*</span><span class="ident" id="1740589">hmap</span><span class="op" id="1740593">,</span>&nbsp;<span class="ident" id="1740595">ky</span>&nbsp;<span class="builtintype" id="1740598">string</span><span class="op" id="1740604">)</span>&nbsp;<span class="op" id="1740606">(</span><span class="ident" id="1740607">unsafe</span><span class="op" id="1740613">.</span><span class="ident" id="1740614">Pointer</span><span class="op" id="1740621">,</span>&nbsp;<span class="builtintype" id="1740623">bool</span><span class="op" id="1740627">)</span>&nbsp;<span class="op" id="1740629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740632">if</span>&nbsp;<span class="ident" id="1740635">raceenabled</span>&nbsp;<span class="op" id="1740647">&amp;&amp;</span>&nbsp;<span class="ident" id="1740650">h</span>&nbsp;<span class="op" id="1740652">!=</span>&nbsp;<span class="ident" id="1740655">nil</span>&nbsp;<span class="op" id="1740659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1740663">callerpc</span>&nbsp;<span class="op" id="1740672">:=</span>&nbsp;<span class="ident" id="1740675">getcallerpc</span><span class="op" id="1740686">(</span><span class="ident" id="1740687">unsafe</span><span class="op" id="1740693">.</span><span class="ident" id="1740694">Pointer</span><span class="op" id="1740701">(</span><span class="op" id="1740702">&amp;</span><span class="ident" id="1740703">t</span><span class="op" id="1740704">)</span><span class="op" id="1740705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1740709">racereadpc</span><span class="op" id="1740719">(</span><span class="ident" id="1740720">unsafe</span><span class="op" id="1740726">.</span><span class="ident" id="1740727">Pointer</span><span class="op" id="1740734">(</span><span class="ident" id="1740735">h</span><span class="op" id="1740736">)</span><span class="op" id="1740737">,</span>&nbsp;<span class="ident" id="1740739">callerpc</span><span class="op" id="1740747">,</span>&nbsp;<span class="ident" id="1740749">funcPC</span><span class="op" id="1740755">(</span><span class="ident" id="1740756">mapaccess2_faststr</span><span class="op" id="1740774">)</span><span class="op" id="1740775">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740781">if</span>&nbsp;<span class="ident" id="1740784">h</span>&nbsp;<span class="op" id="1740786">==</span>&nbsp;<span class="ident" id="1740789">nil</span>&nbsp;<span class="op" id="1740793">||</span>&nbsp;<span class="ident" id="1740796">h</span><span class="op" id="1740797">.</span><span class="ident" id="1740798">count</span>&nbsp;<span class="op" id="1740804">==</span>&nbsp;<span class="num" id="1740807">0</span>&nbsp;<span class="op" id="1740809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740813">return</span>&nbsp;<span class="ident" id="1740820">unsafe</span><span class="op" id="1740826">.</span><span class="ident" id="1740827">Pointer</span><span class="op" id="1740834">(</span><span class="ident" id="1740835">t</span><span class="op" id="1740836">.</span><span class="ident" id="1740837">elem</span><span class="op" id="1740841">.</span><span class="ident" id="1740842">zero</span><span class="op" id="1740846">)</span><span class="op" id="1740847">,</span>&nbsp;<span class="builtintype" id="1740849">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1740856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1740859">key</span>&nbsp;<span class="op" id="1740863">:=</span>&nbsp;<span class="op" id="1740866">(</span><span class="op" id="1740867">*</span><span class="ident" id="1740868">stringStruct</span><span class="op" id="1740880">)</span><span class="op" id="1740881">(</span><span class="ident" id="1740882">unsafe</span><span class="op" id="1740888">.</span><span class="ident" id="1740889">Pointer</span><span class="op" id="1740896">(</span><span class="op" id="1740897">&amp;</span><span class="ident" id="1740898">ky</span><span class="op" id="1740900">)</span><span class="op" id="1740901">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740904">if</span>&nbsp;<span class="ident" id="1740907">h</span><span class="op" id="1740908">.</span><span class="ident" id="1740909">B</span>&nbsp;<span class="op" id="1740911">==</span>&nbsp;<span class="num" id="1740914">0</span>&nbsp;<span class="op" id="1740916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1740920">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1740943">b</span>&nbsp;<span class="op" id="1740945">:=</span>&nbsp;<span class="op" id="1740948">(</span><span class="op" id="1740949">*</span><span class="ident" id="1740950">bmap</span><span class="op" id="1740954">)</span><span class="op" id="1740955">(</span><span class="ident" id="1740956">h</span><span class="op" id="1740957">.</span><span class="ident" id="1740958">buckets</span><span class="op" id="1740965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1740969">if</span>&nbsp;<span class="ident" id="1740972">key</span><span class="op" id="1740975">.</span><span class="builtinfunc" id="1740976">len</span>&nbsp;<span class="op" id="1740980">&lt;</span>&nbsp;<span class="num" id="1740982">32</span>&nbsp;<span class="op" id="1740985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1740990">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741039">for</span>&nbsp;<span class="ident" id="1741043">i</span>&nbsp;<span class="op" id="1741045">:=</span>&nbsp;<span class="builtintype" id="1741048">uintptr</span><span class="op" id="1741055">(</span><span class="num" id="1741056">0</span><span class="op" id="1741057">)</span><span class="op" id="1741058">;</span>&nbsp;<span class="ident" id="1741060">i</span>&nbsp;<span class="op" id="1741062">&lt;</span>&nbsp;<span class="ident" id="1741064">bucketCnt</span><span class="op" id="1741073">;</span>&nbsp;<span class="ident" id="1741075">i</span><span class="op" id="1741076">++</span>&nbsp;<span class="op" id="1741079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741085">x</span>&nbsp;<span class="op" id="1741087">:=</span>&nbsp;<span class="op" id="1741090">*</span><span class="op" id="1741091">(</span><span class="op" id="1741092">(</span><span class="op" id="1741093">*</span><span class="builtintype" id="1741094">uint8</span><span class="op" id="1741099">)</span><span class="op" id="1741100">(</span><span class="ident" id="1741101">add</span><span class="op" id="1741104">(</span><span class="ident" id="1741105">unsafe</span><span class="op" id="1741111">.</span><span class="ident" id="1741112">Pointer</span><span class="op" id="1741119">(</span><span class="ident" id="1741120">b</span><span class="op" id="1741121">)</span><span class="op" id="1741122">,</span>&nbsp;<span class="ident" id="1741124">i</span><span class="op" id="1741125">)</span><span class="op" id="1741126">)</span><span class="op" id="1741127">)</span>&nbsp;<span class="comment" id="1741129">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741174">if</span>&nbsp;<span class="ident" id="1741177">x</span>&nbsp;<span class="op" id="1741179">==</span>&nbsp;<span class="ident" id="1741182">empty</span>&nbsp;<span class="op" id="1741188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741195">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1741208">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741214">k</span>&nbsp;<span class="op" id="1741216">:=</span>&nbsp;<span class="op" id="1741219">(</span><span class="op" id="1741220">*</span><span class="ident" id="1741221">stringStruct</span><span class="op" id="1741233">)</span><span class="op" id="1741234">(</span><span class="ident" id="1741235">add</span><span class="op" id="1741238">(</span><span class="ident" id="1741239">unsafe</span><span class="op" id="1741245">.</span><span class="ident" id="1741246">Pointer</span><span class="op" id="1741253">(</span><span class="ident" id="1741254">b</span><span class="op" id="1741255">)</span><span class="op" id="1741256">,</span>&nbsp;<span class="ident" id="1741258">dataOffset</span><span class="op" id="1741268">+</span><span class="ident" id="1741269">i</span><span class="op" id="1741270">*</span><span class="num" id="1741271">2</span><span class="op" id="1741272">*</span><span class="ident" id="1741273">ptrSize</span><span class="op" id="1741280">)</span><span class="op" id="1741281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741287">if</span>&nbsp;<span class="ident" id="1741290">k</span><span class="op" id="1741291">.</span><span class="builtinfunc" id="1741292">len</span>&nbsp;<span class="op" id="1741296">!=</span>&nbsp;<span class="ident" id="1741299">key</span><span class="op" id="1741302">.</span><span class="builtinfunc" id="1741303">len</span>&nbsp;<span class="op" id="1741307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741314">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1741327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741333">if</span>&nbsp;<span class="ident" id="1741336">k</span><span class="op" id="1741337">.</span><span class="ident" id="1741338">str</span>&nbsp;<span class="op" id="1741342">==</span>&nbsp;<span class="ident" id="1741345">key</span><span class="op" id="1741348">.</span><span class="ident" id="1741349">str</span>&nbsp;<span class="op" id="1741353">||</span>&nbsp;<span class="ident" id="1741356">memeq</span><span class="op" id="1741361">(</span><span class="ident" id="1741362">k</span><span class="op" id="1741363">.</span><span class="ident" id="1741364">str</span><span class="op" id="1741367">,</span>&nbsp;<span class="ident" id="1741369">key</span><span class="op" id="1741372">.</span><span class="ident" id="1741373">str</span><span class="op" id="1741376">,</span>&nbsp;<span class="builtintype" id="1741378">uintptr</span><span class="op" id="1741385">(</span><span class="ident" id="1741386">key</span><span class="op" id="1741389">.</span><span class="builtinfunc" id="1741390">len</span><span class="op" id="1741393">)</span><span class="op" id="1741394">)</span>&nbsp;<span class="op" id="1741396">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741403">return</span>&nbsp;<span class="ident" id="1741410">add</span><span class="op" id="1741413">(</span><span class="ident" id="1741414">unsafe</span><span class="op" id="1741420">.</span><span class="ident" id="1741421">Pointer</span><span class="op" id="1741428">(</span><span class="ident" id="1741429">b</span><span class="op" id="1741430">)</span><span class="op" id="1741431">,</span>&nbsp;<span class="ident" id="1741433">dataOffset</span><span class="op" id="1741443">+</span><span class="ident" id="1741444">bucketCnt</span><span class="op" id="1741453">*</span><span class="num" id="1741454">2</span><span class="op" id="1741455">*</span><span class="ident" id="1741456">ptrSize</span><span class="op" id="1741463">+</span><span class="ident" id="1741464">i</span><span class="op" id="1741465">*</span><span class="builtintype" id="1741466">uintptr</span><span class="op" id="1741473">(</span><span class="ident" id="1741474">t</span><span class="op" id="1741475">.</span><span class="ident" id="1741476">valuesize</span><span class="op" id="1741485">)</span><span class="op" id="1741486">)</span><span class="op" id="1741487">,</span>&nbsp;<span class="builtintype" id="1741489">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1741498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1741503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741508">return</span>&nbsp;<span class="ident" id="1741515">unsafe</span><span class="op" id="1741521">.</span><span class="ident" id="1741522">Pointer</span><span class="op" id="1741529">(</span><span class="ident" id="1741530">t</span><span class="op" id="1741531">.</span><span class="ident" id="1741532">elem</span><span class="op" id="1741536">.</span><span class="ident" id="1741537">zero</span><span class="op" id="1741541">)</span><span class="op" id="1741542">,</span>&nbsp;<span class="builtintype" id="1741544">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1741552">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1741556">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741617">keymaybe</span>&nbsp;<span class="op" id="1741626">:=</span>&nbsp;<span class="builtintype" id="1741629">uintptr</span><span class="op" id="1741636">(</span><span class="ident" id="1741637">bucketCnt</span><span class="op" id="1741646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741650">for</span>&nbsp;<span class="ident" id="1741654">i</span>&nbsp;<span class="op" id="1741656">:=</span>&nbsp;<span class="builtintype" id="1741659">uintptr</span><span class="op" id="1741666">(</span><span class="num" id="1741667">0</span><span class="op" id="1741668">)</span><span class="op" id="1741669">;</span>&nbsp;<span class="ident" id="1741671">i</span>&nbsp;<span class="op" id="1741673">&lt;</span>&nbsp;<span class="ident" id="1741675">bucketCnt</span><span class="op" id="1741684">;</span>&nbsp;<span class="ident" id="1741686">i</span><span class="op" id="1741687">++</span>&nbsp;<span class="op" id="1741690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741695">x</span>&nbsp;<span class="op" id="1741697">:=</span>&nbsp;<span class="op" id="1741700">*</span><span class="op" id="1741701">(</span><span class="op" id="1741702">(</span><span class="op" id="1741703">*</span><span class="builtintype" id="1741704">uint8</span><span class="op" id="1741709">)</span><span class="op" id="1741710">(</span><span class="ident" id="1741711">add</span><span class="op" id="1741714">(</span><span class="ident" id="1741715">unsafe</span><span class="op" id="1741721">.</span><span class="ident" id="1741722">Pointer</span><span class="op" id="1741729">(</span><span class="ident" id="1741730">b</span><span class="op" id="1741731">)</span><span class="op" id="1741732">,</span>&nbsp;<span class="ident" id="1741734">i</span><span class="op" id="1741735">)</span><span class="op" id="1741736">)</span><span class="op" id="1741737">)</span>&nbsp;<span class="comment" id="1741739">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741783">if</span>&nbsp;<span class="ident" id="1741786">x</span>&nbsp;<span class="op" id="1741788">==</span>&nbsp;<span class="ident" id="1741791">empty</span>&nbsp;<span class="op" id="1741797">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741803">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1741815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741820">k</span>&nbsp;<span class="op" id="1741822">:=</span>&nbsp;<span class="op" id="1741825">(</span><span class="op" id="1741826">*</span><span class="ident" id="1741827">stringStruct</span><span class="op" id="1741839">)</span><span class="op" id="1741840">(</span><span class="ident" id="1741841">add</span><span class="op" id="1741844">(</span><span class="ident" id="1741845">unsafe</span><span class="op" id="1741851">.</span><span class="ident" id="1741852">Pointer</span><span class="op" id="1741859">(</span><span class="ident" id="1741860">b</span><span class="op" id="1741861">)</span><span class="op" id="1741862">,</span>&nbsp;<span class="ident" id="1741864">dataOffset</span><span class="op" id="1741874">+</span><span class="ident" id="1741875">i</span><span class="op" id="1741876">*</span><span class="num" id="1741877">2</span><span class="op" id="1741878">*</span><span class="ident" id="1741879">ptrSize</span><span class="op" id="1741886">)</span><span class="op" id="1741887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741892">if</span>&nbsp;<span class="ident" id="1741895">k</span><span class="op" id="1741896">.</span><span class="builtinfunc" id="1741897">len</span>&nbsp;<span class="op" id="1741901">!=</span>&nbsp;<span class="ident" id="1741904">key</span><span class="op" id="1741907">.</span><span class="builtinfunc" id="1741908">len</span>&nbsp;<span class="op" id="1741912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741918">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1741930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741935">if</span>&nbsp;<span class="ident" id="1741938">k</span><span class="op" id="1741939">.</span><span class="ident" id="1741940">str</span>&nbsp;<span class="op" id="1741944">==</span>&nbsp;<span class="ident" id="1741947">key</span><span class="op" id="1741950">.</span><span class="ident" id="1741951">str</span>&nbsp;<span class="op" id="1741955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1741961">return</span>&nbsp;<span class="ident" id="1741968">add</span><span class="op" id="1741971">(</span><span class="ident" id="1741972">unsafe</span><span class="op" id="1741978">.</span><span class="ident" id="1741979">Pointer</span><span class="op" id="1741986">(</span><span class="ident" id="1741987">b</span><span class="op" id="1741988">)</span><span class="op" id="1741989">,</span>&nbsp;<span class="ident" id="1741991">dataOffset</span><span class="op" id="1742001">+</span><span class="ident" id="1742002">bucketCnt</span><span class="op" id="1742011">*</span><span class="num" id="1742012">2</span><span class="op" id="1742013">*</span><span class="ident" id="1742014">ptrSize</span><span class="op" id="1742021">+</span><span class="ident" id="1742022">i</span><span class="op" id="1742023">*</span><span class="builtintype" id="1742024">uintptr</span><span class="op" id="1742031">(</span><span class="ident" id="1742032">t</span><span class="op" id="1742033">.</span><span class="ident" id="1742034">valuesize</span><span class="op" id="1742043">)</span><span class="op" id="1742044">)</span><span class="op" id="1742045">,</span>&nbsp;<span class="builtintype" id="1742047">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742060">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742086">if</span>&nbsp;<span class="op" id="1742089">*</span><span class="op" id="1742090">(</span><span class="op" id="1742091">(</span><span class="op" id="1742092">*</span><span class="op" id="1742093">[</span><span class="num" id="1742094">4</span><span class="op" id="1742095">]</span><span class="builtintype" id="1742096">byte</span><span class="op" id="1742100">)</span><span class="op" id="1742101">(</span><span class="ident" id="1742102">key</span><span class="op" id="1742105">.</span><span class="ident" id="1742106">str</span><span class="op" id="1742109">)</span><span class="op" id="1742110">)</span>&nbsp;<span class="op" id="1742112">!=</span>&nbsp;<span class="op" id="1742115">*</span><span class="op" id="1742116">(</span><span class="op" id="1742117">(</span><span class="op" id="1742118">*</span><span class="op" id="1742119">[</span><span class="num" id="1742120">4</span><span class="op" id="1742121">]</span><span class="builtintype" id="1742122">byte</span><span class="op" id="1742126">)</span><span class="op" id="1742127">(</span><span class="ident" id="1742128">k</span><span class="op" id="1742129">.</span><span class="ident" id="1742130">str</span><span class="op" id="1742133">)</span><span class="op" id="1742134">)</span>&nbsp;<span class="op" id="1742136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742142">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742159">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742184">if</span>&nbsp;<span class="op" id="1742187">*</span><span class="op" id="1742188">(</span><span class="op" id="1742189">(</span><span class="op" id="1742190">*</span><span class="op" id="1742191">[</span><span class="num" id="1742192">4</span><span class="op" id="1742193">]</span><span class="builtintype" id="1742194">byte</span><span class="op" id="1742198">)</span><span class="op" id="1742199">(</span><span class="ident" id="1742200">add</span><span class="op" id="1742203">(</span><span class="ident" id="1742204">key</span><span class="op" id="1742207">.</span><span class="ident" id="1742208">str</span><span class="op" id="1742211">,</span>&nbsp;<span class="builtintype" id="1742213">uintptr</span><span class="op" id="1742220">(</span><span class="ident" id="1742221">key</span><span class="op" id="1742224">.</span><span class="builtinfunc" id="1742225">len</span><span class="op" id="1742228">)</span><span class="op" id="1742229">-</span><span class="num" id="1742230">4</span><span class="op" id="1742231">)</span><span class="op" id="1742232">)</span><span class="op" id="1742233">)</span>&nbsp;<span class="op" id="1742235">!=</span>&nbsp;<span class="op" id="1742238">*</span><span class="op" id="1742239">(</span><span class="op" id="1742240">(</span><span class="op" id="1742241">*</span><span class="op" id="1742242">[</span><span class="num" id="1742243">4</span><span class="op" id="1742244">]</span><span class="builtintype" id="1742245">byte</span><span class="op" id="1742249">)</span><span class="op" id="1742250">(</span><span class="ident" id="1742251">add</span><span class="op" id="1742254">(</span><span class="ident" id="1742255">k</span><span class="op" id="1742256">.</span><span class="ident" id="1742257">str</span><span class="op" id="1742260">,</span>&nbsp;<span class="builtintype" id="1742262">uintptr</span><span class="op" id="1742269">(</span><span class="ident" id="1742270">key</span><span class="op" id="1742273">.</span><span class="builtinfunc" id="1742274">len</span><span class="op" id="1742277">)</span><span class="op" id="1742278">-</span><span class="num" id="1742279">4</span><span class="op" id="1742280">)</span><span class="op" id="1742281">)</span><span class="op" id="1742282">)</span>&nbsp;<span class="op" id="1742284">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742290">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742307">if</span>&nbsp;<span class="ident" id="1742310">keymaybe</span>&nbsp;<span class="op" id="1742319">!=</span>&nbsp;<span class="ident" id="1742322">bucketCnt</span>&nbsp;<span class="op" id="1742332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742338">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742408">goto</span>&nbsp;<span class="ident" id="1742413">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742428">keymaybe</span>&nbsp;<span class="op" id="1742437">=</span>&nbsp;<span class="ident" id="1742439">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742447">if</span>&nbsp;<span class="ident" id="1742450">keymaybe</span>&nbsp;<span class="op" id="1742459">!=</span>&nbsp;<span class="ident" id="1742462">bucketCnt</span>&nbsp;<span class="op" id="1742472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742477">k</span>&nbsp;<span class="op" id="1742479">:=</span>&nbsp;<span class="op" id="1742482">(</span><span class="op" id="1742483">*</span><span class="ident" id="1742484">stringStruct</span><span class="op" id="1742496">)</span><span class="op" id="1742497">(</span><span class="ident" id="1742498">add</span><span class="op" id="1742501">(</span><span class="ident" id="1742502">unsafe</span><span class="op" id="1742508">.</span><span class="ident" id="1742509">Pointer</span><span class="op" id="1742516">(</span><span class="ident" id="1742517">b</span><span class="op" id="1742518">)</span><span class="op" id="1742519">,</span>&nbsp;<span class="ident" id="1742521">dataOffset</span><span class="op" id="1742531">+</span><span class="ident" id="1742532">keymaybe</span><span class="op" id="1742540">*</span><span class="num" id="1742541">2</span><span class="op" id="1742542">*</span><span class="ident" id="1742543">ptrSize</span><span class="op" id="1742550">)</span><span class="op" id="1742551">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742556">if</span>&nbsp;<span class="ident" id="1742559">memeq</span><span class="op" id="1742564">(</span><span class="ident" id="1742565">k</span><span class="op" id="1742566">.</span><span class="ident" id="1742567">str</span><span class="op" id="1742570">,</span>&nbsp;<span class="ident" id="1742572">key</span><span class="op" id="1742575">.</span><span class="ident" id="1742576">str</span><span class="op" id="1742579">,</span>&nbsp;<span class="builtintype" id="1742581">uintptr</span><span class="op" id="1742588">(</span><span class="ident" id="1742589">key</span><span class="op" id="1742592">.</span><span class="builtinfunc" id="1742593">len</span><span class="op" id="1742596">)</span><span class="op" id="1742597">)</span>&nbsp;<span class="op" id="1742599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742605">return</span>&nbsp;<span class="ident" id="1742612">add</span><span class="op" id="1742615">(</span><span class="ident" id="1742616">unsafe</span><span class="op" id="1742622">.</span><span class="ident" id="1742623">Pointer</span><span class="op" id="1742630">(</span><span class="ident" id="1742631">b</span><span class="op" id="1742632">)</span><span class="op" id="1742633">,</span>&nbsp;<span class="ident" id="1742635">dataOffset</span><span class="op" id="1742645">+</span><span class="ident" id="1742646">bucketCnt</span><span class="op" id="1742655">*</span><span class="num" id="1742656">2</span><span class="op" id="1742657">*</span><span class="ident" id="1742658">ptrSize</span><span class="op" id="1742665">+</span><span class="ident" id="1742666">keymaybe</span><span class="op" id="1742674">*</span><span class="builtintype" id="1742675">uintptr</span><span class="op" id="1742682">(</span><span class="ident" id="1742683">t</span><span class="op" id="1742684">.</span><span class="ident" id="1742685">valuesize</span><span class="op" id="1742694">)</span><span class="op" id="1742695">)</span><span class="op" id="1742696">,</span>&nbsp;<span class="builtintype" id="1742698">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742714">return</span>&nbsp;<span class="ident" id="1742721">unsafe</span><span class="op" id="1742727">.</span><span class="ident" id="1742728">Pointer</span><span class="op" id="1742735">(</span><span class="ident" id="1742736">t</span><span class="op" id="1742737">.</span><span class="ident" id="1742738">elem</span><span class="op" id="1742742">.</span><span class="ident" id="1742743">zero</span><span class="op" id="1742747">)</span><span class="op" id="1742748">,</span>&nbsp;<span class="builtintype" id="1742750">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742757">}</span><br>
<span class="lineno"></span><span class="ident" id="1742759">dohash</span><span class="op" id="1742765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742768">hash</span>&nbsp;<span class="op" id="1742773">:=</span>&nbsp;<span class="ident" id="1742776">goalg</span><span class="op" id="1742781">(</span><span class="ident" id="1742782">t</span><span class="op" id="1742783">.</span><span class="ident" id="1742784">key</span><span class="op" id="1742787">.</span><span class="ident" id="1742788">alg</span><span class="op" id="1742791">)</span><span class="op" id="1742792">.</span><span class="ident" id="1742793">hash</span><span class="op" id="1742797">(</span><span class="ident" id="1742798">noescape</span><span class="op" id="1742806">(</span><span class="ident" id="1742807">unsafe</span><span class="op" id="1742813">.</span><span class="ident" id="1742814">Pointer</span><span class="op" id="1742821">(</span><span class="op" id="1742822">&amp;</span><span class="ident" id="1742823">ky</span><span class="op" id="1742825">)</span><span class="op" id="1742826">)</span><span class="op" id="1742827">,</span>&nbsp;<span class="num" id="1742829">2</span><span class="op" id="1742830">*</span><span class="ident" id="1742831">ptrSize</span><span class="op" id="1742838">,</span>&nbsp;<span class="builtintype" id="1742840">uintptr</span><span class="op" id="1742847">(</span><span class="ident" id="1742848">h</span><span class="op" id="1742849">.</span><span class="ident" id="1742850">hash0</span><span class="op" id="1742855">)</span><span class="op" id="1742856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742859">m</span>&nbsp;<span class="op" id="1742861">:=</span>&nbsp;<span class="builtintype" id="1742864">uintptr</span><span class="op" id="1742871">(</span><span class="num" id="1742872">1</span><span class="op" id="1742873">)</span><span class="op" id="1742874">&lt;&lt;</span><span class="ident" id="1742876">h</span><span class="op" id="1742877">.</span><span class="ident" id="1742878">B</span>&nbsp;<span class="op" id="1742880">-</span>&nbsp;<span class="num" id="1742882">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742885">b</span>&nbsp;<span class="op" id="1742887">:=</span>&nbsp;<span class="op" id="1742890">(</span><span class="op" id="1742891">*</span><span class="ident" id="1742892">bmap</span><span class="op" id="1742896">)</span><span class="op" id="1742897">(</span><span class="ident" id="1742898">add</span><span class="op" id="1742901">(</span><span class="ident" id="1742902">h</span><span class="op" id="1742903">.</span><span class="ident" id="1742904">buckets</span><span class="op" id="1742911">,</span>&nbsp;<span class="op" id="1742913">(</span><span class="ident" id="1742914">hash</span><span class="op" id="1742918">&amp;</span><span class="ident" id="1742919">m</span><span class="op" id="1742920">)</span><span class="op" id="1742921">*</span><span class="builtintype" id="1742922">uintptr</span><span class="op" id="1742929">(</span><span class="ident" id="1742930">t</span><span class="op" id="1742931">.</span><span class="ident" id="1742932">bucketsize</span><span class="op" id="1742942">)</span><span class="op" id="1742943">)</span><span class="op" id="1742944">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742947">if</span>&nbsp;<span class="ident" id="1742950">c</span>&nbsp;<span class="op" id="1742952">:=</span>&nbsp;<span class="ident" id="1742955">h</span><span class="op" id="1742956">.</span><span class="ident" id="1742957">oldbuckets</span><span class="op" id="1742967">;</span>&nbsp;<span class="ident" id="1742969">c</span>&nbsp;<span class="op" id="1742971">!=</span>&nbsp;<span class="ident" id="1742974">nil</span>&nbsp;<span class="op" id="1742978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742982">oldb</span>&nbsp;<span class="op" id="1742987">:=</span>&nbsp;<span class="op" id="1742990">(</span><span class="op" id="1742991">*</span><span class="ident" id="1742992">bmap</span><span class="op" id="1742996">)</span><span class="op" id="1742997">(</span><span class="ident" id="1742998">add</span><span class="op" id="1743001">(</span><span class="ident" id="1743002">c</span><span class="op" id="1743003">,</span>&nbsp;<span class="op" id="1743005">(</span><span class="ident" id="1743006">hash</span><span class="op" id="1743010">&amp;</span><span class="op" id="1743011">(</span><span class="ident" id="1743012">m</span><span class="op" id="1743013">&gt;&gt;</span><span class="num" id="1743015">1</span><span class="op" id="1743016">)</span><span class="op" id="1743017">)</span><span class="op" id="1743018">*</span><span class="builtintype" id="1743019">uintptr</span><span class="op" id="1743026">(</span><span class="ident" id="1743027">t</span><span class="op" id="1743028">.</span><span class="ident" id="1743029">bucketsize</span><span class="op" id="1743039">)</span><span class="op" id="1743040">)</span><span class="op" id="1743041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743045">if</span>&nbsp;<span class="op" id="1743048">!</span><span class="ident" id="1743049">evacuated</span><span class="op" id="1743058">(</span><span class="ident" id="1743059">oldb</span><span class="op" id="1743063">)</span>&nbsp;<span class="op" id="1743065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743070">b</span>&nbsp;<span class="op" id="1743072">=</span>&nbsp;<span class="ident" id="1743074">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743081">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743087">top</span>&nbsp;<span class="op" id="1743091">:=</span>&nbsp;<span class="builtintype" id="1743094">uint8</span><span class="op" id="1743099">(</span><span class="ident" id="1743100">hash</span>&nbsp;<span class="op" id="1743105">&gt;&gt;</span>&nbsp;<span class="op" id="1743108">(</span><span class="ident" id="1743109">ptrSize</span><span class="op" id="1743116">*</span><span class="num" id="1743117">8</span>&nbsp;<span class="op" id="1743119">-</span>&nbsp;<span class="num" id="1743121">8</span><span class="op" id="1743122">)</span><span class="op" id="1743123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743126">if</span>&nbsp;<span class="ident" id="1743129">top</span>&nbsp;<span class="op" id="1743133">&lt;</span>&nbsp;<span class="ident" id="1743135">minTopHash</span>&nbsp;<span class="op" id="1743146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743150">top</span>&nbsp;<span class="op" id="1743154">+=</span>&nbsp;<span class="ident" id="1743157">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743169">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743172">for</span>&nbsp;<span class="op" id="1743176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743180">for</span>&nbsp;<span class="ident" id="1743184">i</span>&nbsp;<span class="op" id="1743186">:=</span>&nbsp;<span class="builtintype" id="1743189">uintptr</span><span class="op" id="1743196">(</span><span class="num" id="1743197">0</span><span class="op" id="1743198">)</span><span class="op" id="1743199">;</span>&nbsp;<span class="ident" id="1743201">i</span>&nbsp;<span class="op" id="1743203">&lt;</span>&nbsp;<span class="ident" id="1743205">bucketCnt</span><span class="op" id="1743214">;</span>&nbsp;<span class="ident" id="1743216">i</span><span class="op" id="1743217">++</span>&nbsp;<span class="op" id="1743220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743225">x</span>&nbsp;<span class="op" id="1743227">:=</span>&nbsp;<span class="op" id="1743230">*</span><span class="op" id="1743231">(</span><span class="op" id="1743232">(</span><span class="op" id="1743233">*</span><span class="builtintype" id="1743234">uint8</span><span class="op" id="1743239">)</span><span class="op" id="1743240">(</span><span class="ident" id="1743241">add</span><span class="op" id="1743244">(</span><span class="ident" id="1743245">unsafe</span><span class="op" id="1743251">.</span><span class="ident" id="1743252">Pointer</span><span class="op" id="1743259">(</span><span class="ident" id="1743260">b</span><span class="op" id="1743261">)</span><span class="op" id="1743262">,</span>&nbsp;<span class="ident" id="1743264">i</span><span class="op" id="1743265">)</span><span class="op" id="1743266">)</span><span class="op" id="1743267">)</span>&nbsp;<span class="comment" id="1743269">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743313">if</span>&nbsp;<span class="ident" id="1743316">x</span>&nbsp;<span class="op" id="1743318">!=</span>&nbsp;<span class="ident" id="1743321">top</span>&nbsp;<span class="op" id="1743325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743331">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743348">k</span>&nbsp;<span class="op" id="1743350">:=</span>&nbsp;<span class="op" id="1743353">(</span><span class="op" id="1743354">*</span><span class="ident" id="1743355">stringStruct</span><span class="op" id="1743367">)</span><span class="op" id="1743368">(</span><span class="ident" id="1743369">add</span><span class="op" id="1743372">(</span><span class="ident" id="1743373">unsafe</span><span class="op" id="1743379">.</span><span class="ident" id="1743380">Pointer</span><span class="op" id="1743387">(</span><span class="ident" id="1743388">b</span><span class="op" id="1743389">)</span><span class="op" id="1743390">,</span>&nbsp;<span class="ident" id="1743392">dataOffset</span><span class="op" id="1743402">+</span><span class="ident" id="1743403">i</span><span class="op" id="1743404">*</span><span class="num" id="1743405">2</span><span class="op" id="1743406">*</span><span class="ident" id="1743407">ptrSize</span><span class="op" id="1743414">)</span><span class="op" id="1743415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743420">if</span>&nbsp;<span class="ident" id="1743423">k</span><span class="op" id="1743424">.</span><span class="builtinfunc" id="1743425">len</span>&nbsp;<span class="op" id="1743429">!=</span>&nbsp;<span class="ident" id="1743432">key</span><span class="op" id="1743435">.</span><span class="builtinfunc" id="1743436">len</span>&nbsp;<span class="op" id="1743440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743446">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743458">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743463">if</span>&nbsp;<span class="ident" id="1743466">k</span><span class="op" id="1743467">.</span><span class="ident" id="1743468">str</span>&nbsp;<span class="op" id="1743472">==</span>&nbsp;<span class="ident" id="1743475">key</span><span class="op" id="1743478">.</span><span class="ident" id="1743479">str</span>&nbsp;<span class="op" id="1743483">||</span>&nbsp;<span class="ident" id="1743486">memeq</span><span class="op" id="1743491">(</span><span class="ident" id="1743492">k</span><span class="op" id="1743493">.</span><span class="ident" id="1743494">str</span><span class="op" id="1743497">,</span>&nbsp;<span class="ident" id="1743499">key</span><span class="op" id="1743502">.</span><span class="ident" id="1743503">str</span><span class="op" id="1743506">,</span>&nbsp;<span class="builtintype" id="1743508">uintptr</span><span class="op" id="1743515">(</span><span class="ident" id="1743516">key</span><span class="op" id="1743519">.</span><span class="builtinfunc" id="1743520">len</span><span class="op" id="1743523">)</span><span class="op" id="1743524">)</span>&nbsp;<span class="op" id="1743526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743532">return</span>&nbsp;<span class="ident" id="1743539">add</span><span class="op" id="1743542">(</span><span class="ident" id="1743543">unsafe</span><span class="op" id="1743549">.</span><span class="ident" id="1743550">Pointer</span><span class="op" id="1743557">(</span><span class="ident" id="1743558">b</span><span class="op" id="1743559">)</span><span class="op" id="1743560">,</span>&nbsp;<span class="ident" id="1743562">dataOffset</span><span class="op" id="1743572">+</span><span class="ident" id="1743573">bucketCnt</span><span class="op" id="1743582">*</span><span class="num" id="1743583">2</span><span class="op" id="1743584">*</span><span class="ident" id="1743585">ptrSize</span><span class="op" id="1743592">+</span><span class="ident" id="1743593">i</span><span class="op" id="1743594">*</span><span class="builtintype" id="1743595">uintptr</span><span class="op" id="1743602">(</span><span class="ident" id="1743603">t</span><span class="op" id="1743604">.</span><span class="ident" id="1743605">valuesize</span><span class="op" id="1743614">)</span><span class="op" id="1743615">)</span><span class="op" id="1743616">,</span>&nbsp;<span class="builtintype" id="1743618">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743634">b</span>&nbsp;<span class="op" id="1743636">=</span>&nbsp;<span class="ident" id="1743638">b</span><span class="op" id="1743639">.</span><span class="ident" id="1743640">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743651">if</span>&nbsp;<span class="ident" id="1743654">b</span>&nbsp;<span class="op" id="1743656">==</span>&nbsp;<span class="ident" id="1743659">nil</span>&nbsp;<span class="op" id="1743663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743668">return</span>&nbsp;<span class="ident" id="1743675">unsafe</span><span class="op" id="1743681">.</span><span class="ident" id="1743682">Pointer</span><span class="op" id="1743689">(</span><span class="ident" id="1743690">t</span><span class="op" id="1743691">.</span><span class="ident" id="1743692">elem</span><span class="op" id="1743696">.</span><span class="ident" id="1743697">zero</span><span class="op" id="1743701">)</span><span class="op" id="1743702">,</span>&nbsp;<span class="builtintype" id="1743704">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743715">}</span><br>
<span class="lineno"></span><span class="op" id="1743717">}</span>
</div>
</body>
</html>
