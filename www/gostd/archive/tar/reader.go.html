<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6361765">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6361820">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6361874">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6361925">package</span>&nbsp;<span class="ident" id="6361933">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6361938">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="6361957">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6361980">import</span>&nbsp;<span class="op" id="6361987">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6361990">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6361999">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6362009">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6362015">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6362028">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6362034">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6362045">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6362056">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6362063">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6362066">var</span>&nbsp;<span class="op" id="6362070">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362073">ErrHeader</span>&nbsp;<span class="op" id="6362083">=</span>&nbsp;<span class="ident" id="6362085">errors</span><span class="op" id="6362091">.</span><span class="ident" id="6362092">New</span><span class="op" id="6362095">(</span><span class="string" id="6362096">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="6362129">)</span><br>
<span class="lineno"></span><span class="op" id="6362131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6362134">const</span>&nbsp;<span class="ident" id="6362140">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6362161">=</span>&nbsp;<span class="num" id="6362163">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6362166">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6362239">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6362289">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="6362372">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6362445">type</span>&nbsp;<span class="ident" id="6362450">Reader</span>&nbsp;<span class="keyword" id="6362457">struct</span>&nbsp;<span class="op" id="6362464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362467">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362475">io</span><span class="op" id="6362477">.</span><span class="ident" id="6362478">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362486">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6362494">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362501">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362509">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6362525">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362582">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362590">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="6362606">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362640">hdrBuff</span>&nbsp;<span class="op" id="6362648">[</span><span class="ident" id="6362649">blockSize</span><span class="op" id="6362658">]</span><span class="builtintype" id="6362659">byte</span>&nbsp;<span class="comment" id="6362664">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="6362695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6362698">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="6362779">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6362833">type</span>&nbsp;<span class="ident" id="6362838">numBytesReader</span>&nbsp;<span class="keyword" id="6362853">interface</span>&nbsp;<span class="op" id="6362863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362866">io</span><span class="op" id="6362868">.</span><span class="ident" id="6362869">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6362877">numBytes</span><span class="op" id="6362885">(</span><span class="op" id="6362886">)</span>&nbsp;<span class="ident" id="6362888">int64</span><br>
<span class="lineno"></span><span class="op" id="6362894">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6362897">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6362978">type</span>&nbsp;<span class="ident" id="6362983">regFileReader</span>&nbsp;<span class="keyword" id="6362997">struct</span>&nbsp;<span class="op" id="6363004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363007">r</span>&nbsp;&nbsp;<span class="ident" id="6363010">io</span><span class="op" id="6363012">.</span><span class="ident" id="6363013">Reader</span>&nbsp;<span class="comment" id="6363020">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363042">nb</span>&nbsp;<span class="ident" id="6363045">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6363055">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="6363104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363107">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6363198">type</span>&nbsp;<span class="ident" id="6363203">sparseFileReader</span>&nbsp;<span class="keyword" id="6363220">struct</span>&nbsp;<span class="op" id="6363227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363230">rfr</span>&nbsp;<span class="op" id="6363234">*</span><span class="ident" id="6363235">regFileReader</span>&nbsp;<span class="comment" id="6363249">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363288">sp</span>&nbsp;&nbsp;<span class="op" id="6363292">[</span><span class="op" id="6363293">]</span><span class="ident" id="6363294">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="6363307">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363339">pos</span>&nbsp;<span class="ident" id="6363343">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6363358">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363391">tot</span>&nbsp;<span class="ident" id="6363395">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6363410">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="6363436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6363439">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="6363497">const</span>&nbsp;<span class="op" id="6363503">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363506">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="6363528">=</span>&nbsp;<span class="string" id="6363530">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363554">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6363576">=</span>&nbsp;<span class="string" id="6363578">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363599">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="6363621">=</span>&nbsp;<span class="string" id="6363623">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363646">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6363668">=</span>&nbsp;<span class="string" id="6363670">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363688">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6363710">=</span>&nbsp;<span class="string" id="6363712">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363731">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6363753">=</span>&nbsp;<span class="string" id="6363755">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363775">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6363797">=</span>&nbsp;<span class="string" id="6363799">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363819">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6363841">=</span>&nbsp;<span class="string" id="6363843">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363862">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="6363884">=</span>&nbsp;<span class="string" id="6363886">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="6363908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363911">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="6363950">const</span>&nbsp;<span class="op" id="6363956">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6363959">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364002">=</span>&nbsp;<span class="num" id="6364004">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364009">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364052">=</span>&nbsp;<span class="num" id="6364054">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364059">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364102">=</span>&nbsp;<span class="num" id="6364104">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364107">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="6364150">=</span>&nbsp;<span class="num" id="6364152">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364157">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364200">=</span>&nbsp;<span class="num" id="6364202">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364206">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364249">=</span>&nbsp;<span class="num" id="6364251">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364255">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364298">=</span>&nbsp;<span class="num" id="6364300">12</span><br>
<span class="lineno"></span><span class="op" id="6364303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364306">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="6364356">func</span>&nbsp;<span class="ident" id="6364361">NewReader</span><span class="op" id="6364370">(</span><span class="ident" id="6364371">r</span>&nbsp;<span class="ident" id="6364373">io</span><span class="op" id="6364375">.</span><span class="ident" id="6364376">Reader</span><span class="op" id="6364382">)</span>&nbsp;<span class="op" id="6364384">*</span><span class="ident" id="6364385">Reader</span>&nbsp;<span class="op" id="6364392">{</span>&nbsp;<span class="keyword" id="6364394">return</span>&nbsp;<span class="op" id="6364401">&amp;</span><span class="ident" id="6364402">Reader</span><span class="op" id="6364408">{</span><span class="ident" id="6364409">r</span><span class="op" id="6364410">:</span>&nbsp;<span class="ident" id="6364412">r</span><span class="op" id="6364413">}</span>&nbsp;<span class="op" id="6364415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364418">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6364473">func</span>&nbsp;<span class="op" id="6364478">(</span><span class="ident" id="6364479">tr</span>&nbsp;<span class="op" id="6364482">*</span><span class="ident" id="6364483">Reader</span><span class="op" id="6364489">)</span>&nbsp;<span class="ident" id="6364491">Next</span><span class="op" id="6364495">(</span><span class="op" id="6364496">)</span>&nbsp;<span class="op" id="6364498">(</span><span class="op" id="6364499">*</span><span class="ident" id="6364500">Header</span><span class="op" id="6364506">,</span>&nbsp;<span class="builtintype" id="6364508">error</span><span class="op" id="6364513">)</span>&nbsp;<span class="op" id="6364515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364518">var</span>&nbsp;<span class="ident" id="6364522">hdr</span>&nbsp;<span class="op" id="6364526">*</span><span class="ident" id="6364527">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364535">if</span>&nbsp;<span class="ident" id="6364538">tr</span><span class="op" id="6364540">.</span><span class="ident" id="6364541">err</span>&nbsp;<span class="op" id="6364545">==</span>&nbsp;<span class="builtintype" id="6364548">nil</span>&nbsp;<span class="op" id="6364552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364556">tr</span><span class="op" id="6364558">.</span><span class="ident" id="6364559">skipUnread</span><span class="op" id="6364569">(</span><span class="op" id="6364570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364576">if</span>&nbsp;<span class="ident" id="6364579">tr</span><span class="op" id="6364581">.</span><span class="ident" id="6364582">err</span>&nbsp;<span class="op" id="6364586">!=</span>&nbsp;<span class="builtintype" id="6364589">nil</span>&nbsp;<span class="op" id="6364593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364597">return</span>&nbsp;<span class="ident" id="6364604">hdr</span><span class="op" id="6364607">,</span>&nbsp;<span class="ident" id="6364609">tr</span><span class="op" id="6364611">.</span><span class="ident" id="6364612">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364620">hdr</span>&nbsp;<span class="op" id="6364624">=</span>&nbsp;<span class="ident" id="6364626">tr</span><span class="op" id="6364628">.</span><span class="ident" id="6364629">readHeader</span><span class="op" id="6364639">(</span><span class="op" id="6364640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364643">if</span>&nbsp;<span class="ident" id="6364646">hdr</span>&nbsp;<span class="op" id="6364650">==</span>&nbsp;<span class="builtintype" id="6364653">nil</span>&nbsp;<span class="op" id="6364657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364661">return</span>&nbsp;<span class="ident" id="6364668">hdr</span><span class="op" id="6364671">,</span>&nbsp;<span class="ident" id="6364673">tr</span><span class="op" id="6364675">.</span><span class="ident" id="6364676">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364681">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6364684">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364714">switch</span>&nbsp;<span class="ident" id="6364721">hdr</span><span class="op" id="6364724">.</span><span class="ident" id="6364725">Typeflag</span>&nbsp;<span class="op" id="6364734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364737">case</span>&nbsp;<span class="ident" id="6364742">TypeXHeader</span><span class="op" id="6364753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6364757">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364783">headers</span><span class="op" id="6364790">,</span>&nbsp;<span class="ident" id="6364792">err</span>&nbsp;<span class="op" id="6364796">:=</span>&nbsp;<span class="ident" id="6364799">parsePAX</span><span class="op" id="6364807">(</span><span class="ident" id="6364808">tr</span><span class="op" id="6364810">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364814">if</span>&nbsp;<span class="ident" id="6364817">err</span>&nbsp;<span class="op" id="6364821">!=</span>&nbsp;<span class="builtintype" id="6364824">nil</span>&nbsp;<span class="op" id="6364828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6364833">return</span>&nbsp;<span class="builtintype" id="6364840">nil</span><span class="op" id="6364843">,</span>&nbsp;<span class="ident" id="6364845">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6364851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6364855">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6364893">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364931">tr</span><span class="op" id="6364933">.</span><span class="ident" id="6364934">skipUnread</span><span class="op" id="6364944">(</span><span class="op" id="6364945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364949">hdr</span>&nbsp;<span class="op" id="6364953">=</span>&nbsp;<span class="ident" id="6364955">tr</span><span class="op" id="6364957">.</span><span class="ident" id="6364958">readHeader</span><span class="op" id="6364968">(</span><span class="op" id="6364969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364973">mergePAX</span><span class="op" id="6364981">(</span><span class="ident" id="6364982">hdr</span><span class="op" id="6364985">,</span>&nbsp;<span class="ident" id="6364987">headers</span><span class="op" id="6364994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6364999">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365039">sp</span><span class="op" id="6365041">,</span>&nbsp;<span class="ident" id="6365043">err</span>&nbsp;<span class="op" id="6365047">:=</span>&nbsp;<span class="ident" id="6365050">tr</span><span class="op" id="6365052">.</span><span class="ident" id="6365053">checkForGNUSparsePAXHeaders</span><span class="op" id="6365080">(</span><span class="ident" id="6365081">hdr</span><span class="op" id="6365084">,</span>&nbsp;<span class="ident" id="6365086">headers</span><span class="op" id="6365093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365097">if</span>&nbsp;<span class="ident" id="6365100">err</span>&nbsp;<span class="op" id="6365104">!=</span>&nbsp;<span class="builtintype" id="6365107">nil</span>&nbsp;<span class="op" id="6365111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365116">tr</span><span class="op" id="6365118">.</span><span class="ident" id="6365119">err</span>&nbsp;<span class="op" id="6365123">=</span>&nbsp;<span class="ident" id="6365125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365132">return</span>&nbsp;<span class="builtintype" id="6365139">nil</span><span class="op" id="6365142">,</span>&nbsp;<span class="ident" id="6365144">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6365150">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365154">if</span>&nbsp;<span class="ident" id="6365157">sp</span>&nbsp;<span class="op" id="6365160">!=</span>&nbsp;<span class="builtintype" id="6365163">nil</span>&nbsp;<span class="op" id="6365167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6365172">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6365224">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365283">tr</span><span class="op" id="6365285">.</span><span class="ident" id="6365286">curr</span>&nbsp;<span class="op" id="6365291">=</span>&nbsp;<span class="op" id="6365293">&amp;</span><span class="ident" id="6365294">sparseFileReader</span><span class="op" id="6365310">{</span><span class="ident" id="6365311">rfr</span><span class="op" id="6365314">:</span>&nbsp;<span class="ident" id="6365316">tr</span><span class="op" id="6365318">.</span><span class="ident" id="6365319">curr</span><span class="op" id="6365323">.</span><span class="op" id="6365324">(</span><span class="op" id="6365325">*</span><span class="ident" id="6365326">regFileReader</span><span class="op" id="6365339">)</span><span class="op" id="6365340">,</span>&nbsp;<span class="ident" id="6365342">sp</span><span class="op" id="6365344">:</span>&nbsp;<span class="ident" id="6365346">sp</span><span class="op" id="6365348">,</span>&nbsp;<span class="ident" id="6365350">tot</span><span class="op" id="6365353">:</span>&nbsp;<span class="ident" id="6365355">hdr</span><span class="op" id="6365358">.</span><span class="ident" id="6365359">Size</span><span class="op" id="6365363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6365367">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365371">return</span>&nbsp;<span class="ident" id="6365378">hdr</span><span class="op" id="6365381">,</span>&nbsp;<span class="builtintype" id="6365383">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365388">case</span>&nbsp;<span class="ident" id="6365393">TypeGNULongName</span><span class="op" id="6365408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6365412">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365486">realname</span><span class="op" id="6365494">,</span>&nbsp;<span class="ident" id="6365496">err</span>&nbsp;<span class="op" id="6365500">:=</span>&nbsp;<span class="ident" id="6365503">ioutil</span><span class="op" id="6365509">.</span><span class="ident" id="6365510">ReadAll</span><span class="op" id="6365517">(</span><span class="ident" id="6365518">tr</span><span class="op" id="6365520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365524">if</span>&nbsp;<span class="ident" id="6365527">err</span>&nbsp;<span class="op" id="6365531">!=</span>&nbsp;<span class="builtintype" id="6365534">nil</span>&nbsp;<span class="op" id="6365538">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365543">return</span>&nbsp;<span class="builtintype" id="6365550">nil</span><span class="op" id="6365553">,</span>&nbsp;<span class="ident" id="6365555">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6365561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365565">hdr</span><span class="op" id="6365568">,</span>&nbsp;<span class="ident" id="6365570">err</span>&nbsp;<span class="op" id="6365574">:=</span>&nbsp;<span class="ident" id="6365577">tr</span><span class="op" id="6365579">.</span><span class="ident" id="6365580">Next</span><span class="op" id="6365584">(</span><span class="op" id="6365585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365589">hdr</span><span class="op" id="6365592">.</span><span class="ident" id="6365593">Name</span>&nbsp;<span class="op" id="6365598">=</span>&nbsp;<span class="ident" id="6365600">cString</span><span class="op" id="6365607">(</span><span class="ident" id="6365608">realname</span><span class="op" id="6365616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365620">return</span>&nbsp;<span class="ident" id="6365627">hdr</span><span class="op" id="6365630">,</span>&nbsp;<span class="ident" id="6365632">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365637">case</span>&nbsp;<span class="ident" id="6365642">TypeGNULongLink</span><span class="op" id="6365657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6365661">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365698">realname</span><span class="op" id="6365706">,</span>&nbsp;<span class="ident" id="6365708">err</span>&nbsp;<span class="op" id="6365712">:=</span>&nbsp;<span class="ident" id="6365715">ioutil</span><span class="op" id="6365721">.</span><span class="ident" id="6365722">ReadAll</span><span class="op" id="6365729">(</span><span class="ident" id="6365730">tr</span><span class="op" id="6365732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365736">if</span>&nbsp;<span class="ident" id="6365739">err</span>&nbsp;<span class="op" id="6365743">!=</span>&nbsp;<span class="builtintype" id="6365746">nil</span>&nbsp;<span class="op" id="6365750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365755">return</span>&nbsp;<span class="builtintype" id="6365762">nil</span><span class="op" id="6365765">,</span>&nbsp;<span class="ident" id="6365767">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6365773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365777">hdr</span><span class="op" id="6365780">,</span>&nbsp;<span class="ident" id="6365782">err</span>&nbsp;<span class="op" id="6365786">:=</span>&nbsp;<span class="ident" id="6365789">tr</span><span class="op" id="6365791">.</span><span class="ident" id="6365792">Next</span><span class="op" id="6365796">(</span><span class="op" id="6365797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6365801">hdr</span><span class="op" id="6365804">.</span><span class="ident" id="6365805">Linkname</span>&nbsp;<span class="op" id="6365814">=</span>&nbsp;<span class="ident" id="6365816">cString</span><span class="op" id="6365823">(</span><span class="ident" id="6365824">realname</span><span class="op" id="6365832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365836">return</span>&nbsp;<span class="ident" id="6365843">hdr</span><span class="op" id="6365846">,</span>&nbsp;<span class="ident" id="6365848">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6365853">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365856">return</span>&nbsp;<span class="ident" id="6365863">hdr</span><span class="op" id="6365866">,</span>&nbsp;<span class="ident" id="6365868">tr</span><span class="op" id="6365870">.</span><span class="ident" id="6365871">err</span><br>
<span class="lineno"></span><span class="op" id="6365875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6365878">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="6365980">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="6366090">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6366123">func</span>&nbsp;<span class="op" id="6366128">(</span><span class="ident" id="6366129">tr</span>&nbsp;<span class="op" id="6366132">*</span><span class="ident" id="6366133">Reader</span><span class="op" id="6366139">)</span>&nbsp;<span class="ident" id="6366141">checkForGNUSparsePAXHeaders</span><span class="op" id="6366168">(</span><span class="ident" id="6366169">hdr</span>&nbsp;<span class="op" id="6366173">*</span><span class="ident" id="6366174">Header</span><span class="op" id="6366180">,</span>&nbsp;<span class="ident" id="6366182">headers</span>&nbsp;<span class="keyword" id="6366190">map</span><span class="op" id="6366193">[</span><span class="builtintype" id="6366194">string</span><span class="op" id="6366200">]</span><span class="builtintype" id="6366201">string</span><span class="op" id="6366207">)</span>&nbsp;<span class="op" id="6366209">(</span><span class="op" id="6366210">[</span><span class="op" id="6366211">]</span><span class="ident" id="6366212">sparseEntry</span><span class="op" id="6366223">,</span>&nbsp;<span class="builtintype" id="6366225">error</span><span class="op" id="6366230">)</span>&nbsp;<span class="op" id="6366232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6366235">var</span>&nbsp;<span class="ident" id="6366239">sparseFormat</span>&nbsp;<span class="builtintype" id="6366252">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6366261">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366300">major</span><span class="op" id="6366305">,</span>&nbsp;<span class="ident" id="6366307">majorOk</span>&nbsp;<span class="op" id="6366315">:=</span>&nbsp;<span class="ident" id="6366318">headers</span><span class="op" id="6366325">[</span><span class="ident" id="6366326">paxGNUSparseMajor</span><span class="op" id="6366343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366346">minor</span><span class="op" id="6366351">,</span>&nbsp;<span class="ident" id="6366353">minorOk</span>&nbsp;<span class="op" id="6366361">:=</span>&nbsp;<span class="ident" id="6366364">headers</span><span class="op" id="6366371">[</span><span class="ident" id="6366372">paxGNUSparseMinor</span><span class="op" id="6366389">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366392">sparseName</span><span class="op" id="6366402">,</span>&nbsp;<span class="ident" id="6366404">sparseNameOk</span>&nbsp;<span class="op" id="6366417">:=</span>&nbsp;<span class="ident" id="6366420">headers</span><span class="op" id="6366427">[</span><span class="ident" id="6366428">paxGNUSparseName</span><span class="op" id="6366444">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366447">_</span><span class="op" id="6366448">,</span>&nbsp;<span class="ident" id="6366450">sparseMapOk</span>&nbsp;<span class="op" id="6366462">:=</span>&nbsp;<span class="ident" id="6366465">headers</span><span class="op" id="6366472">[</span><span class="ident" id="6366473">paxGNUSparseMap</span><span class="op" id="6366488">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366491">sparseSize</span><span class="op" id="6366501">,</span>&nbsp;<span class="ident" id="6366503">sparseSizeOk</span>&nbsp;<span class="op" id="6366516">:=</span>&nbsp;<span class="ident" id="6366519">headers</span><span class="op" id="6366526">[</span><span class="ident" id="6366527">paxGNUSparseSize</span><span class="op" id="6366543">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366546">sparseRealSize</span><span class="op" id="6366560">,</span>&nbsp;<span class="ident" id="6366562">sparseRealSizeOk</span>&nbsp;<span class="op" id="6366579">:=</span>&nbsp;<span class="ident" id="6366582">headers</span><span class="op" id="6366589">[</span><span class="ident" id="6366590">paxGNUSparseRealSize</span><span class="op" id="6366610">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6366614">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6366695">if</span>&nbsp;<span class="ident" id="6366698">majorOk</span>&nbsp;<span class="op" id="6366706">&amp;&amp;</span>&nbsp;<span class="ident" id="6366709">minorOk</span>&nbsp;<span class="op" id="6366717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366721">sparseFormat</span>&nbsp;<span class="op" id="6366734">=</span>&nbsp;<span class="ident" id="6366736">major</span>&nbsp;<span class="op" id="6366742">+</span>&nbsp;<span class="string" id="6366744">&#34;.&#34;</span>&nbsp;<span class="op" id="6366748">+</span>&nbsp;<span class="ident" id="6366750">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366757">}</span>&nbsp;<span class="keyword" id="6366759">else</span>&nbsp;<span class="keyword" id="6366764">if</span>&nbsp;<span class="ident" id="6366767">sparseNameOk</span>&nbsp;<span class="op" id="6366780">&amp;&amp;</span>&nbsp;<span class="ident" id="6366783">sparseMapOk</span>&nbsp;<span class="op" id="6366795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366799">sparseFormat</span>&nbsp;<span class="op" id="6366812">=</span>&nbsp;<span class="string" id="6366814">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366821">}</span>&nbsp;<span class="keyword" id="6366823">else</span>&nbsp;<span class="keyword" id="6366828">if</span>&nbsp;<span class="ident" id="6366831">sparseSizeOk</span>&nbsp;<span class="op" id="6366844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366848">sparseFormat</span>&nbsp;<span class="op" id="6366861">=</span>&nbsp;<span class="string" id="6366863">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366870">}</span>&nbsp;<span class="keyword" id="6366872">else</span>&nbsp;<span class="op" id="6366877">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6366881">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6366920">return</span>&nbsp;<span class="builtintype" id="6366927">nil</span><span class="op" id="6366930">,</span>&nbsp;<span class="builtintype" id="6366932">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6366941">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6366977">if</span>&nbsp;<span class="ident" id="6366980">sparseFormat</span>&nbsp;<span class="op" id="6366993">!=</span>&nbsp;<span class="string" id="6366996">&#34;0.0&#34;</span>&nbsp;<span class="op" id="6367002">&amp;&amp;</span>&nbsp;<span class="ident" id="6367005">sparseFormat</span>&nbsp;<span class="op" id="6367018">!=</span>&nbsp;<span class="string" id="6367021">&#34;0.1&#34;</span>&nbsp;<span class="op" id="6367027">&amp;&amp;</span>&nbsp;<span class="ident" id="6367030">sparseFormat</span>&nbsp;<span class="op" id="6367043">!=</span>&nbsp;<span class="string" id="6367046">&#34;1.0&#34;</span>&nbsp;<span class="op" id="6367052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367056">return</span>&nbsp;<span class="builtintype" id="6367063">nil</span><span class="op" id="6367066">,</span>&nbsp;<span class="builtintype" id="6367068">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6367077">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367120">if</span>&nbsp;<span class="ident" id="6367123">sparseNameOk</span>&nbsp;<span class="op" id="6367136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367140">hdr</span><span class="op" id="6367143">.</span><span class="ident" id="6367144">Name</span>&nbsp;<span class="op" id="6367149">=</span>&nbsp;<span class="ident" id="6367151">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367166">if</span>&nbsp;<span class="ident" id="6367169">sparseSizeOk</span>&nbsp;<span class="op" id="6367182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367186">realSize</span><span class="op" id="6367194">,</span>&nbsp;<span class="ident" id="6367196">err</span>&nbsp;<span class="op" id="6367200">:=</span>&nbsp;<span class="ident" id="6367203">strconv</span><span class="op" id="6367210">.</span><span class="ident" id="6367211">ParseInt</span><span class="op" id="6367219">(</span><span class="ident" id="6367220">sparseSize</span><span class="op" id="6367230">,</span>&nbsp;<span class="num" id="6367232">10</span><span class="op" id="6367234">,</span>&nbsp;<span class="num" id="6367236">0</span><span class="op" id="6367237">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367241">if</span>&nbsp;<span class="ident" id="6367244">err</span>&nbsp;<span class="op" id="6367248">!=</span>&nbsp;<span class="builtintype" id="6367251">nil</span>&nbsp;<span class="op" id="6367255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367260">return</span>&nbsp;<span class="builtintype" id="6367267">nil</span><span class="op" id="6367270">,</span>&nbsp;<span class="ident" id="6367272">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367288">hdr</span><span class="op" id="6367291">.</span><span class="ident" id="6367292">Size</span>&nbsp;<span class="op" id="6367297">=</span>&nbsp;<span class="ident" id="6367299">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367309">}</span>&nbsp;<span class="keyword" id="6367311">else</span>&nbsp;<span class="keyword" id="6367316">if</span>&nbsp;<span class="ident" id="6367319">sparseRealSizeOk</span>&nbsp;<span class="op" id="6367336">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367340">realSize</span><span class="op" id="6367348">,</span>&nbsp;<span class="ident" id="6367350">err</span>&nbsp;<span class="op" id="6367354">:=</span>&nbsp;<span class="ident" id="6367357">strconv</span><span class="op" id="6367364">.</span><span class="ident" id="6367365">ParseInt</span><span class="op" id="6367373">(</span><span class="ident" id="6367374">sparseRealSize</span><span class="op" id="6367388">,</span>&nbsp;<span class="num" id="6367390">10</span><span class="op" id="6367392">,</span>&nbsp;<span class="num" id="6367394">0</span><span class="op" id="6367395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367399">if</span>&nbsp;<span class="ident" id="6367402">err</span>&nbsp;<span class="op" id="6367406">!=</span>&nbsp;<span class="builtintype" id="6367409">nil</span>&nbsp;<span class="op" id="6367413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367418">return</span>&nbsp;<span class="builtintype" id="6367425">nil</span><span class="op" id="6367428">,</span>&nbsp;<span class="ident" id="6367430">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367446">hdr</span><span class="op" id="6367449">.</span><span class="ident" id="6367450">Size</span>&nbsp;<span class="op" id="6367455">=</span>&nbsp;<span class="ident" id="6367457">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6367471">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367547">var</span>&nbsp;<span class="ident" id="6367551">sp</span>&nbsp;<span class="op" id="6367554">[</span><span class="op" id="6367555">]</span><span class="ident" id="6367556">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367569">var</span>&nbsp;<span class="ident" id="6367573">err</span>&nbsp;<span class="builtintype" id="6367577">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367584">switch</span>&nbsp;<span class="ident" id="6367591">sparseFormat</span>&nbsp;<span class="op" id="6367604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367607">case</span>&nbsp;<span class="string" id="6367612">&#34;0.0&#34;</span><span class="op" id="6367617">,</span>&nbsp;<span class="string" id="6367619">&#34;0.1&#34;</span><span class="op" id="6367624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367628">sp</span><span class="op" id="6367630">,</span>&nbsp;<span class="ident" id="6367632">err</span>&nbsp;<span class="op" id="6367636">=</span>&nbsp;<span class="ident" id="6367638">readGNUSparseMap0x1</span><span class="op" id="6367657">(</span><span class="ident" id="6367658">headers</span><span class="op" id="6367665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367668">case</span>&nbsp;<span class="string" id="6367673">&#34;1.0&#34;</span><span class="op" id="6367678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367682">sp</span><span class="op" id="6367684">,</span>&nbsp;<span class="ident" id="6367686">err</span>&nbsp;<span class="op" id="6367690">=</span>&nbsp;<span class="ident" id="6367692">readGNUSparseMap1x0</span><span class="op" id="6367711">(</span><span class="ident" id="6367712">tr</span><span class="op" id="6367714">.</span><span class="ident" id="6367715">curr</span><span class="op" id="6367719">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6367722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6367725">return</span>&nbsp;<span class="ident" id="6367732">sp</span><span class="op" id="6367734">,</span>&nbsp;<span class="ident" id="6367736">err</span><br>
<span class="lineno"></span><span class="op" id="6367740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6367743">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="6367808">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="6367864">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6367924">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="6367986">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6368019">func</span>&nbsp;<span class="ident" id="6368024">mergePAX</span><span class="op" id="6368032">(</span><span class="ident" id="6368033">hdr</span>&nbsp;<span class="op" id="6368037">*</span><span class="ident" id="6368038">Header</span><span class="op" id="6368044">,</span>&nbsp;<span class="ident" id="6368046">headers</span>&nbsp;<span class="keyword" id="6368054">map</span><span class="op" id="6368057">[</span><span class="builtintype" id="6368058">string</span><span class="op" id="6368064">]</span><span class="builtintype" id="6368065">string</span><span class="op" id="6368071">)</span>&nbsp;<span class="builtintype" id="6368073">error</span>&nbsp;<span class="op" id="6368079">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368082">for</span>&nbsp;<span class="ident" id="6368086">k</span><span class="op" id="6368087">,</span>&nbsp;<span class="ident" id="6368089">v</span>&nbsp;<span class="op" id="6368091">:=</span>&nbsp;<span class="keyword" id="6368094">range</span>&nbsp;<span class="ident" id="6368100">headers</span>&nbsp;<span class="op" id="6368108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368112">switch</span>&nbsp;<span class="ident" id="6368119">k</span>&nbsp;<span class="op" id="6368121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368125">case</span>&nbsp;<span class="ident" id="6368130">paxPath</span><span class="op" id="6368137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368142">hdr</span><span class="op" id="6368145">.</span><span class="ident" id="6368146">Name</span>&nbsp;<span class="op" id="6368151">=</span>&nbsp;<span class="ident" id="6368153">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368157">case</span>&nbsp;<span class="ident" id="6368162">paxLinkpath</span><span class="op" id="6368173">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368178">hdr</span><span class="op" id="6368181">.</span><span class="ident" id="6368182">Linkname</span>&nbsp;<span class="op" id="6368191">=</span>&nbsp;<span class="ident" id="6368193">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368197">case</span>&nbsp;<span class="ident" id="6368202">paxGname</span><span class="op" id="6368210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368215">hdr</span><span class="op" id="6368218">.</span><span class="ident" id="6368219">Gname</span>&nbsp;<span class="op" id="6368225">=</span>&nbsp;<span class="ident" id="6368227">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368231">case</span>&nbsp;<span class="ident" id="6368236">paxUname</span><span class="op" id="6368244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368249">hdr</span><span class="op" id="6368252">.</span><span class="ident" id="6368253">Uname</span>&nbsp;<span class="op" id="6368259">=</span>&nbsp;<span class="ident" id="6368261">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368265">case</span>&nbsp;<span class="ident" id="6368270">paxUid</span><span class="op" id="6368276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368281">uid</span><span class="op" id="6368284">,</span>&nbsp;<span class="ident" id="6368286">err</span>&nbsp;<span class="op" id="6368290">:=</span>&nbsp;<span class="ident" id="6368293">strconv</span><span class="op" id="6368300">.</span><span class="ident" id="6368301">ParseInt</span><span class="op" id="6368309">(</span><span class="ident" id="6368310">v</span><span class="op" id="6368311">,</span>&nbsp;<span class="num" id="6368313">10</span><span class="op" id="6368315">,</span>&nbsp;<span class="num" id="6368317">0</span><span class="op" id="6368318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368323">if</span>&nbsp;<span class="ident" id="6368326">err</span>&nbsp;<span class="op" id="6368330">!=</span>&nbsp;<span class="builtintype" id="6368333">nil</span>&nbsp;<span class="op" id="6368337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368343">return</span>&nbsp;<span class="ident" id="6368350">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368357">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368362">hdr</span><span class="op" id="6368365">.</span><span class="ident" id="6368366">Uid</span>&nbsp;<span class="op" id="6368370">=</span>&nbsp;<span class="builtintype" id="6368372">int</span><span class="op" id="6368375">(</span><span class="ident" id="6368376">uid</span><span class="op" id="6368379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368383">case</span>&nbsp;<span class="ident" id="6368388">paxGid</span><span class="op" id="6368394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368399">gid</span><span class="op" id="6368402">,</span>&nbsp;<span class="ident" id="6368404">err</span>&nbsp;<span class="op" id="6368408">:=</span>&nbsp;<span class="ident" id="6368411">strconv</span><span class="op" id="6368418">.</span><span class="ident" id="6368419">ParseInt</span><span class="op" id="6368427">(</span><span class="ident" id="6368428">v</span><span class="op" id="6368429">,</span>&nbsp;<span class="num" id="6368431">10</span><span class="op" id="6368433">,</span>&nbsp;<span class="num" id="6368435">0</span><span class="op" id="6368436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368441">if</span>&nbsp;<span class="ident" id="6368444">err</span>&nbsp;<span class="op" id="6368448">!=</span>&nbsp;<span class="builtintype" id="6368451">nil</span>&nbsp;<span class="op" id="6368455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368461">return</span>&nbsp;<span class="ident" id="6368468">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368480">hdr</span><span class="op" id="6368483">.</span><span class="ident" id="6368484">Gid</span>&nbsp;<span class="op" id="6368488">=</span>&nbsp;<span class="builtintype" id="6368490">int</span><span class="op" id="6368493">(</span><span class="ident" id="6368494">gid</span><span class="op" id="6368497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368501">case</span>&nbsp;<span class="ident" id="6368506">paxAtime</span><span class="op" id="6368514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368519">t</span><span class="op" id="6368520">,</span>&nbsp;<span class="ident" id="6368522">err</span>&nbsp;<span class="op" id="6368526">:=</span>&nbsp;<span class="ident" id="6368529">parsePAXTime</span><span class="op" id="6368541">(</span><span class="ident" id="6368542">v</span><span class="op" id="6368543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368548">if</span>&nbsp;<span class="ident" id="6368551">err</span>&nbsp;<span class="op" id="6368555">!=</span>&nbsp;<span class="builtintype" id="6368558">nil</span>&nbsp;<span class="op" id="6368562">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368568">return</span>&nbsp;<span class="ident" id="6368575">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368587">hdr</span><span class="op" id="6368590">.</span><span class="ident" id="6368591">AccessTime</span>&nbsp;<span class="op" id="6368602">=</span>&nbsp;<span class="ident" id="6368604">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368608">case</span>&nbsp;<span class="ident" id="6368613">paxMtime</span><span class="op" id="6368621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368626">t</span><span class="op" id="6368627">,</span>&nbsp;<span class="ident" id="6368629">err</span>&nbsp;<span class="op" id="6368633">:=</span>&nbsp;<span class="ident" id="6368636">parsePAXTime</span><span class="op" id="6368648">(</span><span class="ident" id="6368649">v</span><span class="op" id="6368650">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368655">if</span>&nbsp;<span class="ident" id="6368658">err</span>&nbsp;<span class="op" id="6368662">!=</span>&nbsp;<span class="builtintype" id="6368665">nil</span>&nbsp;<span class="op" id="6368669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368675">return</span>&nbsp;<span class="ident" id="6368682">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368694">hdr</span><span class="op" id="6368697">.</span><span class="ident" id="6368698">ModTime</span>&nbsp;<span class="op" id="6368706">=</span>&nbsp;<span class="ident" id="6368708">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368712">case</span>&nbsp;<span class="ident" id="6368717">paxCtime</span><span class="op" id="6368725">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368730">t</span><span class="op" id="6368731">,</span>&nbsp;<span class="ident" id="6368733">err</span>&nbsp;<span class="op" id="6368737">:=</span>&nbsp;<span class="ident" id="6368740">parsePAXTime</span><span class="op" id="6368752">(</span><span class="ident" id="6368753">v</span><span class="op" id="6368754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368759">if</span>&nbsp;<span class="ident" id="6368762">err</span>&nbsp;<span class="op" id="6368766">!=</span>&nbsp;<span class="builtintype" id="6368769">nil</span>&nbsp;<span class="op" id="6368773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368779">return</span>&nbsp;<span class="ident" id="6368786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368798">hdr</span><span class="op" id="6368801">.</span><span class="ident" id="6368802">ChangeTime</span>&nbsp;<span class="op" id="6368813">=</span>&nbsp;<span class="ident" id="6368815">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368819">case</span>&nbsp;<span class="ident" id="6368824">paxSize</span><span class="op" id="6368831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368836">size</span><span class="op" id="6368840">,</span>&nbsp;<span class="ident" id="6368842">err</span>&nbsp;<span class="op" id="6368846">:=</span>&nbsp;<span class="ident" id="6368849">strconv</span><span class="op" id="6368856">.</span><span class="ident" id="6368857">ParseInt</span><span class="op" id="6368865">(</span><span class="ident" id="6368866">v</span><span class="op" id="6368867">,</span>&nbsp;<span class="num" id="6368869">10</span><span class="op" id="6368871">,</span>&nbsp;<span class="num" id="6368873">0</span><span class="op" id="6368874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368879">if</span>&nbsp;<span class="ident" id="6368882">err</span>&nbsp;<span class="op" id="6368886">!=</span>&nbsp;<span class="builtintype" id="6368889">nil</span>&nbsp;<span class="op" id="6368893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368899">return</span>&nbsp;<span class="ident" id="6368906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6368913">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6368918">hdr</span><span class="op" id="6368921">.</span><span class="ident" id="6368922">Size</span>&nbsp;<span class="op" id="6368927">=</span>&nbsp;<span class="ident" id="6368929">int64</span><span class="op" id="6368934">(</span><span class="ident" id="6368935">size</span><span class="op" id="6368939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368943">default</span><span class="op" id="6368950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368955">if</span>&nbsp;<span class="ident" id="6368958">strings</span><span class="op" id="6368965">.</span><span class="ident" id="6368966">HasPrefix</span><span class="op" id="6368975">(</span><span class="ident" id="6368976">k</span><span class="op" id="6368977">,</span>&nbsp;<span class="ident" id="6368979">paxXattr</span><span class="op" id="6368987">)</span>&nbsp;<span class="op" id="6368989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6368995">if</span>&nbsp;<span class="ident" id="6368998">hdr</span><span class="op" id="6369001">.</span><span class="ident" id="6369002">Xattrs</span>&nbsp;<span class="op" id="6369009">==</span>&nbsp;<span class="builtintype" id="6369012">nil</span>&nbsp;<span class="op" id="6369016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369023">hdr</span><span class="op" id="6369026">.</span><span class="ident" id="6369027">Xattrs</span>&nbsp;<span class="op" id="6369034">=</span>&nbsp;<span class="builtinfunc" id="6369036">make</span><span class="op" id="6369040">(</span><span class="keyword" id="6369041">map</span><span class="op" id="6369044">[</span><span class="builtintype" id="6369045">string</span><span class="op" id="6369051">]</span><span class="builtintype" id="6369052">string</span><span class="op" id="6369058">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369070">hdr</span><span class="op" id="6369073">.</span><span class="ident" id="6369074">Xattrs</span><span class="op" id="6369080">[</span><span class="ident" id="6369081">k</span><span class="op" id="6369082">[</span><span class="builtinfunc" id="6369083">len</span><span class="op" id="6369086">(</span><span class="ident" id="6369087">paxXattr</span><span class="op" id="6369095">)</span><span class="op" id="6369096">:</span><span class="op" id="6369097">]</span><span class="op" id="6369098">]</span>&nbsp;<span class="op" id="6369100">=</span>&nbsp;<span class="ident" id="6369102">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369114">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369117">return</span>&nbsp;<span class="builtintype" id="6369124">nil</span><br>
<span class="lineno"></span><span class="op" id="6369128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6369131">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6369196">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="6369222">func</span>&nbsp;<span class="ident" id="6369227">parsePAXTime</span><span class="op" id="6369239">(</span><span class="ident" id="6369240">t</span>&nbsp;<span class="builtintype" id="6369242">string</span><span class="op" id="6369248">)</span>&nbsp;<span class="op" id="6369250">(</span><span class="ident" id="6369251">time</span><span class="op" id="6369255">.</span><span class="ident" id="6369256">Time</span><span class="op" id="6369260">,</span>&nbsp;<span class="builtintype" id="6369262">error</span><span class="op" id="6369267">)</span>&nbsp;<span class="op" id="6369269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369272">buf</span>&nbsp;<span class="op" id="6369276">:=</span>&nbsp;<span class="op" id="6369279">[</span><span class="op" id="6369280">]</span><span class="builtintype" id="6369281">byte</span><span class="op" id="6369285">(</span><span class="ident" id="6369286">t</span><span class="op" id="6369287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369290">pos</span>&nbsp;<span class="op" id="6369294">:=</span>&nbsp;<span class="ident" id="6369297">bytes</span><span class="op" id="6369302">.</span><span class="ident" id="6369303">IndexByte</span><span class="op" id="6369312">(</span><span class="ident" id="6369313">buf</span><span class="op" id="6369316">,</span>&nbsp;<span class="string" id="6369318">&#39;.&#39;</span><span class="op" id="6369321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369324">var</span>&nbsp;<span class="ident" id="6369328">seconds</span><span class="op" id="6369335">,</span>&nbsp;<span class="ident" id="6369337">nanoseconds</span>&nbsp;<span class="ident" id="6369349">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369356">var</span>&nbsp;<span class="ident" id="6369360">err</span>&nbsp;<span class="builtintype" id="6369364">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369371">if</span>&nbsp;<span class="ident" id="6369374">pos</span>&nbsp;<span class="op" id="6369378">==</span>&nbsp;<span class="op" id="6369381">-</span><span class="num" id="6369382">1</span>&nbsp;<span class="op" id="6369384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369388">seconds</span><span class="op" id="6369395">,</span>&nbsp;<span class="ident" id="6369397">err</span>&nbsp;<span class="op" id="6369401">=</span>&nbsp;<span class="ident" id="6369403">strconv</span><span class="op" id="6369410">.</span><span class="ident" id="6369411">ParseInt</span><span class="op" id="6369419">(</span><span class="ident" id="6369420">t</span><span class="op" id="6369421">,</span>&nbsp;<span class="num" id="6369423">10</span><span class="op" id="6369425">,</span>&nbsp;<span class="num" id="6369427">0</span><span class="op" id="6369428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369432">if</span>&nbsp;<span class="ident" id="6369435">err</span>&nbsp;<span class="op" id="6369439">!=</span>&nbsp;<span class="builtintype" id="6369442">nil</span>&nbsp;<span class="op" id="6369446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369451">return</span>&nbsp;<span class="ident" id="6369458">time</span><span class="op" id="6369462">.</span><span class="ident" id="6369463">Time</span><span class="op" id="6369467">{</span><span class="op" id="6369468">}</span><span class="op" id="6369469">,</span>&nbsp;<span class="ident" id="6369471">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369477">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369480">}</span>&nbsp;<span class="keyword" id="6369482">else</span>&nbsp;<span class="op" id="6369487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369491">seconds</span><span class="op" id="6369498">,</span>&nbsp;<span class="ident" id="6369500">err</span>&nbsp;<span class="op" id="6369504">=</span>&nbsp;<span class="ident" id="6369506">strconv</span><span class="op" id="6369513">.</span><span class="ident" id="6369514">ParseInt</span><span class="op" id="6369522">(</span><span class="builtintype" id="6369523">string</span><span class="op" id="6369529">(</span><span class="ident" id="6369530">buf</span><span class="op" id="6369533">[</span><span class="op" id="6369534">:</span><span class="ident" id="6369535">pos</span><span class="op" id="6369538">]</span><span class="op" id="6369539">)</span><span class="op" id="6369540">,</span>&nbsp;<span class="num" id="6369542">10</span><span class="op" id="6369544">,</span>&nbsp;<span class="num" id="6369546">0</span><span class="op" id="6369547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369551">if</span>&nbsp;<span class="ident" id="6369554">err</span>&nbsp;<span class="op" id="6369558">!=</span>&nbsp;<span class="builtintype" id="6369561">nil</span>&nbsp;<span class="op" id="6369565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369570">return</span>&nbsp;<span class="ident" id="6369577">time</span><span class="op" id="6369581">.</span><span class="ident" id="6369582">Time</span><span class="op" id="6369586">{</span><span class="op" id="6369587">}</span><span class="op" id="6369588">,</span>&nbsp;<span class="ident" id="6369590">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369596">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369600">nano_buf</span>&nbsp;<span class="op" id="6369609">:=</span>&nbsp;<span class="builtintype" id="6369612">string</span><span class="op" id="6369618">(</span><span class="ident" id="6369619">buf</span><span class="op" id="6369622">[</span><span class="ident" id="6369623">pos</span><span class="op" id="6369626">+</span><span class="num" id="6369627">1</span><span class="op" id="6369628">:</span><span class="op" id="6369629">]</span><span class="op" id="6369630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6369634">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6369685">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6369745">if</span>&nbsp;<span class="builtinfunc" id="6369748">len</span><span class="op" id="6369751">(</span><span class="ident" id="6369752">nano_buf</span><span class="op" id="6369760">)</span>&nbsp;<span class="op" id="6369762">&lt;</span>&nbsp;<span class="ident" id="6369764">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6369785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6369790">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369806">nano_buf</span>&nbsp;<span class="op" id="6369815">+=</span>&nbsp;<span class="ident" id="6369818">strings</span><span class="op" id="6369825">.</span><span class="ident" id="6369826">Repeat</span><span class="op" id="6369832">(</span><span class="string" id="6369833">&#34;0&#34;</span><span class="op" id="6369836">,</span>&nbsp;<span class="ident" id="6369838">maxNanoSecondIntSize</span><span class="op" id="6369858">-</span><span class="builtinfunc" id="6369859">len</span><span class="op" id="6369862">(</span><span class="ident" id="6369863">nano_buf</span><span class="op" id="6369871">)</span><span class="op" id="6369872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369876">}</span>&nbsp;<span class="keyword" id="6369878">else</span>&nbsp;<span class="keyword" id="6369883">if</span>&nbsp;<span class="builtinfunc" id="6369886">len</span><span class="op" id="6369889">(</span><span class="ident" id="6369890">nano_buf</span><span class="op" id="6369898">)</span>&nbsp;<span class="op" id="6369900">&gt;</span>&nbsp;<span class="ident" id="6369902">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6369923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6369928">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369949">nano_buf</span>&nbsp;<span class="op" id="6369958">=</span>&nbsp;<span class="ident" id="6369960">nano_buf</span><span class="op" id="6369968">[</span><span class="op" id="6369969">:</span><span class="ident" id="6369970">maxNanoSecondIntSize</span><span class="op" id="6369990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6369994">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369998">nanoseconds</span><span class="op" id="6370009">,</span>&nbsp;<span class="ident" id="6370011">err</span>&nbsp;<span class="op" id="6370015">=</span>&nbsp;<span class="ident" id="6370017">strconv</span><span class="op" id="6370024">.</span><span class="ident" id="6370025">ParseInt</span><span class="op" id="6370033">(</span><span class="builtintype" id="6370034">string</span><span class="op" id="6370040">(</span><span class="ident" id="6370041">nano_buf</span><span class="op" id="6370049">)</span><span class="op" id="6370050">,</span>&nbsp;<span class="num" id="6370052">10</span><span class="op" id="6370054">,</span>&nbsp;<span class="num" id="6370056">0</span><span class="op" id="6370057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370061">if</span>&nbsp;<span class="ident" id="6370064">err</span>&nbsp;<span class="op" id="6370068">!=</span>&nbsp;<span class="builtintype" id="6370071">nil</span>&nbsp;<span class="op" id="6370075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370080">return</span>&nbsp;<span class="ident" id="6370087">time</span><span class="op" id="6370091">.</span><span class="ident" id="6370092">Time</span><span class="op" id="6370096">{</span><span class="op" id="6370097">}</span><span class="op" id="6370098">,</span>&nbsp;<span class="ident" id="6370100">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370109">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370112">ts</span>&nbsp;<span class="op" id="6370115">:=</span>&nbsp;<span class="ident" id="6370118">time</span><span class="op" id="6370122">.</span><span class="ident" id="6370123">Unix</span><span class="op" id="6370127">(</span><span class="ident" id="6370128">seconds</span><span class="op" id="6370135">,</span>&nbsp;<span class="ident" id="6370137">nanoseconds</span><span class="op" id="6370148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370151">return</span>&nbsp;<span class="ident" id="6370158">ts</span><span class="op" id="6370160">,</span>&nbsp;<span class="builtintype" id="6370162">nil</span><br>
<span class="lineno"></span><span class="op" id="6370166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6370169">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="6370201">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="6370271">func</span>&nbsp;<span class="ident" id="6370276">parsePAX</span><span class="op" id="6370284">(</span><span class="ident" id="6370285">r</span>&nbsp;<span class="ident" id="6370287">io</span><span class="op" id="6370289">.</span><span class="ident" id="6370290">Reader</span><span class="op" id="6370296">)</span>&nbsp;<span class="op" id="6370298">(</span><span class="keyword" id="6370299">map</span><span class="op" id="6370302">[</span><span class="builtintype" id="6370303">string</span><span class="op" id="6370309">]</span><span class="builtintype" id="6370310">string</span><span class="op" id="6370316">,</span>&nbsp;<span class="builtintype" id="6370318">error</span><span class="op" id="6370323">)</span>&nbsp;<span class="op" id="6370325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370328">buf</span><span class="op" id="6370331">,</span>&nbsp;<span class="ident" id="6370333">err</span>&nbsp;<span class="op" id="6370337">:=</span>&nbsp;<span class="ident" id="6370340">ioutil</span><span class="op" id="6370346">.</span><span class="ident" id="6370347">ReadAll</span><span class="op" id="6370354">(</span><span class="ident" id="6370355">r</span><span class="op" id="6370356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370359">if</span>&nbsp;<span class="ident" id="6370362">err</span>&nbsp;<span class="op" id="6370366">!=</span>&nbsp;<span class="builtintype" id="6370369">nil</span>&nbsp;<span class="op" id="6370373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370377">return</span>&nbsp;<span class="builtintype" id="6370384">nil</span><span class="op" id="6370387">,</span>&nbsp;<span class="ident" id="6370389">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370398">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370441">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370532">var</span>&nbsp;<span class="ident" id="6370536">sparseMap</span>&nbsp;<span class="ident" id="6370546">bytes</span><span class="op" id="6370551">.</span><span class="ident" id="6370552">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370561">headers</span>&nbsp;<span class="op" id="6370569">:=</span>&nbsp;<span class="builtinfunc" id="6370572">make</span><span class="op" id="6370576">(</span><span class="keyword" id="6370577">map</span><span class="op" id="6370580">[</span><span class="builtintype" id="6370581">string</span><span class="op" id="6370587">]</span><span class="builtintype" id="6370588">string</span><span class="op" id="6370594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370597">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370631">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370676">for</span>&nbsp;<span class="builtinfunc" id="6370680">len</span><span class="op" id="6370683">(</span><span class="ident" id="6370684">buf</span><span class="op" id="6370687">)</span>&nbsp;<span class="op" id="6370689">&gt;</span>&nbsp;<span class="num" id="6370691">0</span>&nbsp;<span class="op" id="6370693">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370697">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370741">var</span>&nbsp;<span class="ident" id="6370745">sp</span>&nbsp;<span class="builtintype" id="6370748">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370754">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370799">sp</span>&nbsp;<span class="op" id="6370802">=</span>&nbsp;<span class="ident" id="6370804">bytes</span><span class="op" id="6370809">.</span><span class="ident" id="6370810">IndexByte</span><span class="op" id="6370819">(</span><span class="ident" id="6370820">buf</span><span class="op" id="6370823">,</span>&nbsp;<span class="string" id="6370825">&#39;&nbsp;&#39;</span><span class="op" id="6370828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370832">if</span>&nbsp;<span class="ident" id="6370835">sp</span>&nbsp;<span class="op" id="6370838">==</span>&nbsp;<span class="op" id="6370841">-</span><span class="num" id="6370842">1</span>&nbsp;<span class="op" id="6370844">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370849">return</span>&nbsp;<span class="builtintype" id="6370856">nil</span><span class="op" id="6370859">,</span>&nbsp;<span class="ident" id="6370861">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6370873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6370877">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6370926">n</span><span class="op" id="6370927">,</span>&nbsp;<span class="ident" id="6370929">err</span>&nbsp;<span class="op" id="6370933">:=</span>&nbsp;<span class="ident" id="6370936">strconv</span><span class="op" id="6370943">.</span><span class="ident" id="6370944">ParseInt</span><span class="op" id="6370952">(</span><span class="builtintype" id="6370953">string</span><span class="op" id="6370959">(</span><span class="ident" id="6370960">buf</span><span class="op" id="6370963">[</span><span class="op" id="6370964">:</span><span class="ident" id="6370965">sp</span><span class="op" id="6370967">]</span><span class="op" id="6370968">)</span><span class="op" id="6370969">,</span>&nbsp;<span class="num" id="6370971">10</span><span class="op" id="6370973">,</span>&nbsp;<span class="num" id="6370975">0</span><span class="op" id="6370976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370980">if</span>&nbsp;<span class="ident" id="6370983">err</span>&nbsp;<span class="op" id="6370987">!=</span>&nbsp;<span class="builtintype" id="6370990">nil</span>&nbsp;<span class="op" id="6370994">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6370999">return</span>&nbsp;<span class="builtintype" id="6371006">nil</span><span class="op" id="6371009">,</span>&nbsp;<span class="ident" id="6371011">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371027">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371091">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371157">var</span>&nbsp;<span class="ident" id="6371161">record</span>&nbsp;<span class="op" id="6371168">[</span><span class="op" id="6371169">]</span><span class="builtintype" id="6371170">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371177">record</span><span class="op" id="6371183">,</span>&nbsp;<span class="ident" id="6371185">buf</span>&nbsp;<span class="op" id="6371189">=</span>&nbsp;<span class="ident" id="6371191">buf</span><span class="op" id="6371194">[</span><span class="ident" id="6371195">sp</span><span class="op" id="6371197">+</span><span class="num" id="6371198">1</span><span class="op" id="6371199">:</span><span class="ident" id="6371200">n</span><span class="op" id="6371201">-</span><span class="num" id="6371202">1</span><span class="op" id="6371203">]</span><span class="op" id="6371204">,</span>&nbsp;<span class="ident" id="6371206">buf</span><span class="op" id="6371209">[</span><span class="ident" id="6371210">n</span><span class="op" id="6371211">:</span><span class="op" id="6371212">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371216">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371280">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371311">eq</span>&nbsp;<span class="op" id="6371314">:=</span>&nbsp;<span class="ident" id="6371317">bytes</span><span class="op" id="6371322">.</span><span class="ident" id="6371323">IndexByte</span><span class="op" id="6371332">(</span><span class="ident" id="6371333">record</span><span class="op" id="6371339">,</span>&nbsp;<span class="string" id="6371341">&#39;=&#39;</span><span class="op" id="6371344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371348">if</span>&nbsp;<span class="ident" id="6371351">eq</span>&nbsp;<span class="op" id="6371354">==</span>&nbsp;<span class="op" id="6371357">-</span><span class="num" id="6371358">1</span>&nbsp;<span class="op" id="6371360">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371365">return</span>&nbsp;<span class="builtintype" id="6371372">nil</span><span class="op" id="6371375">,</span>&nbsp;<span class="ident" id="6371377">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371393">key</span><span class="op" id="6371396">,</span>&nbsp;<span class="ident" id="6371398">value</span>&nbsp;<span class="op" id="6371404">:=</span>&nbsp;<span class="ident" id="6371407">record</span><span class="op" id="6371413">[</span><span class="op" id="6371414">:</span><span class="ident" id="6371415">eq</span><span class="op" id="6371417">]</span><span class="op" id="6371418">,</span>&nbsp;<span class="ident" id="6371420">record</span><span class="op" id="6371426">[</span><span class="ident" id="6371427">eq</span><span class="op" id="6371429">+</span><span class="num" id="6371430">1</span><span class="op" id="6371431">:</span><span class="op" id="6371432">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371437">keyStr</span>&nbsp;<span class="op" id="6371444">:=</span>&nbsp;<span class="builtintype" id="6371447">string</span><span class="op" id="6371453">(</span><span class="ident" id="6371454">key</span><span class="op" id="6371457">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371461">if</span>&nbsp;<span class="ident" id="6371464">keyStr</span>&nbsp;<span class="op" id="6371471">==</span>&nbsp;<span class="ident" id="6371474">paxGNUSparseOffset</span>&nbsp;<span class="op" id="6371493">||</span>&nbsp;<span class="ident" id="6371496">keyStr</span>&nbsp;<span class="op" id="6371503">==</span>&nbsp;<span class="ident" id="6371506">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="6371527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371532">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371626">sparseMap</span><span class="op" id="6371635">.</span><span class="ident" id="6371636">Write</span><span class="op" id="6371641">(</span><span class="ident" id="6371642">value</span><span class="op" id="6371647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371652">sparseMap</span><span class="op" id="6371661">.</span><span class="ident" id="6371662">Write</span><span class="op" id="6371667">(</span><span class="op" id="6371668">[</span><span class="op" id="6371669">]</span><span class="builtintype" id="6371670">byte</span><span class="op" id="6371674">{</span><span class="string" id="6371675">&#39;,&#39;</span><span class="op" id="6371678">}</span><span class="op" id="6371679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371683">}</span>&nbsp;<span class="keyword" id="6371685">else</span>&nbsp;<span class="op" id="6371690">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371695">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371747">headers</span><span class="op" id="6371754">[</span><span class="ident" id="6371755">keyStr</span><span class="op" id="6371761">]</span>&nbsp;<span class="op" id="6371763">=</span>&nbsp;<span class="builtintype" id="6371765">string</span><span class="op" id="6371771">(</span><span class="ident" id="6371772">value</span><span class="op" id="6371777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371787">if</span>&nbsp;<span class="ident" id="6371790">sparseMap</span><span class="op" id="6371799">.</span><span class="ident" id="6371800">Len</span><span class="op" id="6371803">(</span><span class="op" id="6371804">)</span>&nbsp;<span class="op" id="6371806">!=</span>&nbsp;<span class="num" id="6371809">0</span>&nbsp;<span class="op" id="6371811">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6371815">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371877">sparseMap</span><span class="op" id="6371886">.</span><span class="ident" id="6371887">Truncate</span><span class="op" id="6371895">(</span><span class="ident" id="6371896">sparseMap</span><span class="op" id="6371905">.</span><span class="ident" id="6371906">Len</span><span class="op" id="6371909">(</span><span class="op" id="6371910">)</span>&nbsp;<span class="op" id="6371912">-</span>&nbsp;<span class="num" id="6371914">1</span><span class="op" id="6371915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371919">headers</span><span class="op" id="6371926">[</span><span class="ident" id="6371927">paxGNUSparseMap</span><span class="op" id="6371942">]</span>&nbsp;<span class="op" id="6371944">=</span>&nbsp;<span class="ident" id="6371946">sparseMap</span><span class="op" id="6371955">.</span><span class="ident" id="6371956">String</span><span class="op" id="6371962">(</span><span class="op" id="6371963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6371966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6371969">return</span>&nbsp;<span class="ident" id="6371976">headers</span><span class="op" id="6371983">,</span>&nbsp;<span class="builtintype" id="6371985">nil</span><br>
<span class="lineno">365</span><span class="op" id="6371989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6371992">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="6372052">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="6372128">func</span>&nbsp;<span class="ident" id="6372133">cString</span><span class="op" id="6372140">(</span><span class="ident" id="6372141">b</span>&nbsp;<span class="op" id="6372143">[</span><span class="op" id="6372144">]</span><span class="builtintype" id="6372145">byte</span><span class="op" id="6372149">)</span>&nbsp;<span class="builtintype" id="6372151">string</span>&nbsp;<span class="op" id="6372158">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372161">n</span>&nbsp;<span class="op" id="6372163">:=</span>&nbsp;<span class="num" id="6372166">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372169">for</span>&nbsp;<span class="ident" id="6372173">n</span>&nbsp;<span class="op" id="6372175">&lt;</span>&nbsp;<span class="builtinfunc" id="6372177">len</span><span class="op" id="6372180">(</span><span class="ident" id="6372181">b</span><span class="op" id="6372182">)</span>&nbsp;<span class="op" id="6372184">&amp;&amp;</span>&nbsp;<span class="ident" id="6372187">b</span><span class="op" id="6372188">[</span><span class="ident" id="6372189">n</span><span class="op" id="6372190">]</span>&nbsp;<span class="op" id="6372192">!=</span>&nbsp;<span class="num" id="6372195">0</span>&nbsp;<span class="op" id="6372197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372201">n</span><span class="op" id="6372202">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372209">return</span>&nbsp;<span class="builtintype" id="6372216">string</span><span class="op" id="6372222">(</span><span class="ident" id="6372223">b</span><span class="op" id="6372224">[</span><span class="num" id="6372225">0</span><span class="op" id="6372226">:</span><span class="ident" id="6372227">n</span><span class="op" id="6372228">]</span><span class="op" id="6372229">)</span><br>
<span class="lineno">375</span><span class="op" id="6372231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6372234">func</span>&nbsp;<span class="op" id="6372239">(</span><span class="ident" id="6372240">tr</span>&nbsp;<span class="op" id="6372243">*</span><span class="ident" id="6372244">Reader</span><span class="op" id="6372250">)</span>&nbsp;<span class="ident" id="6372252">octal</span><span class="op" id="6372257">(</span><span class="ident" id="6372258">b</span>&nbsp;<span class="op" id="6372260">[</span><span class="op" id="6372261">]</span><span class="builtintype" id="6372262">byte</span><span class="op" id="6372266">)</span>&nbsp;<span class="ident" id="6372268">int64</span>&nbsp;<span class="op" id="6372274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6372277">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372312">if</span>&nbsp;<span class="builtinfunc" id="6372315">len</span><span class="op" id="6372318">(</span><span class="ident" id="6372319">b</span><span class="op" id="6372320">)</span>&nbsp;<span class="op" id="6372322">&gt;</span>&nbsp;<span class="num" id="6372324">0</span>&nbsp;<span class="op" id="6372326">&amp;&amp;</span>&nbsp;<span class="ident" id="6372329">b</span><span class="op" id="6372330">[</span><span class="num" id="6372331">0</span><span class="op" id="6372332">]</span><span class="op" id="6372333">&amp;</span><span class="num" id="6372334">0x80</span>&nbsp;<span class="op" id="6372339">!=</span>&nbsp;<span class="num" id="6372342">0</span>&nbsp;<span class="op" id="6372344">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372348">var</span>&nbsp;<span class="ident" id="6372352">x</span>&nbsp;<span class="ident" id="6372354">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372362">for</span>&nbsp;<span class="ident" id="6372366">i</span><span class="op" id="6372367">,</span>&nbsp;<span class="ident" id="6372369">c</span>&nbsp;<span class="op" id="6372371">:=</span>&nbsp;<span class="keyword" id="6372374">range</span>&nbsp;<span class="ident" id="6372380">b</span>&nbsp;<span class="op" id="6372382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372387">if</span>&nbsp;<span class="ident" id="6372390">i</span>&nbsp;<span class="op" id="6372392">==</span>&nbsp;<span class="num" id="6372395">0</span>&nbsp;<span class="op" id="6372397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372403">c</span>&nbsp;<span class="op" id="6372405">&amp;=</span>&nbsp;<span class="num" id="6372408">0x7f</span>&nbsp;<span class="comment" id="6372413">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372451">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372456">x</span>&nbsp;<span class="op" id="6372458">=</span>&nbsp;<span class="ident" id="6372460">x</span><span class="op" id="6372461">&lt;&lt;</span><span class="num" id="6372463">8</span>&nbsp;<span class="op" id="6372465">|</span>&nbsp;<span class="ident" id="6372467">int64</span><span class="op" id="6372472">(</span><span class="ident" id="6372473">c</span><span class="op" id="6372474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372482">return</span>&nbsp;<span class="ident" id="6372489">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6372496">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6372552">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6372609">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6372629">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6372686">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372699">b</span>&nbsp;<span class="op" id="6372701">=</span>&nbsp;<span class="ident" id="6372703">bytes</span><span class="op" id="6372708">.</span><span class="ident" id="6372709">Trim</span><span class="op" id="6372713">(</span><span class="ident" id="6372714">b</span><span class="op" id="6372715">,</span>&nbsp;<span class="string" id="6372717">&#34;&nbsp;\x00&#34;</span><span class="op" id="6372724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372728">if</span>&nbsp;<span class="builtinfunc" id="6372731">len</span><span class="op" id="6372734">(</span><span class="ident" id="6372735">b</span><span class="op" id="6372736">)</span>&nbsp;<span class="op" id="6372738">==</span>&nbsp;<span class="num" id="6372741">0</span>&nbsp;<span class="op" id="6372743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372747">return</span>&nbsp;<span class="num" id="6372754">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372757">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372760">x</span><span class="op" id="6372761">,</span>&nbsp;<span class="ident" id="6372763">err</span>&nbsp;<span class="op" id="6372767">:=</span>&nbsp;<span class="ident" id="6372770">strconv</span><span class="op" id="6372777">.</span><span class="ident" id="6372778">ParseUint</span><span class="op" id="6372787">(</span><span class="ident" id="6372788">cString</span><span class="op" id="6372795">(</span><span class="ident" id="6372796">b</span><span class="op" id="6372797">)</span><span class="op" id="6372798">,</span>&nbsp;<span class="num" id="6372800">8</span><span class="op" id="6372801">,</span>&nbsp;<span class="num" id="6372803">64</span><span class="op" id="6372805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372808">if</span>&nbsp;<span class="ident" id="6372811">err</span>&nbsp;<span class="op" id="6372815">!=</span>&nbsp;<span class="builtintype" id="6372818">nil</span>&nbsp;<span class="op" id="6372822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372826">tr</span><span class="op" id="6372828">.</span><span class="ident" id="6372829">err</span>&nbsp;<span class="op" id="6372833">=</span>&nbsp;<span class="ident" id="6372835">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6372840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372843">return</span>&nbsp;<span class="ident" id="6372850">int64</span><span class="op" id="6372855">(</span><span class="ident" id="6372856">x</span><span class="op" id="6372857">)</span><br>
<span class="lineno">405</span><span class="op" id="6372859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6372862">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="6372961">func</span>&nbsp;<span class="op" id="6372966">(</span><span class="ident" id="6372967">tr</span>&nbsp;<span class="op" id="6372970">*</span><span class="ident" id="6372971">Reader</span><span class="op" id="6372977">)</span>&nbsp;<span class="ident" id="6372979">skipUnread</span><span class="op" id="6372989">(</span><span class="op" id="6372990">)</span>&nbsp;<span class="op" id="6372992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6372995">nr</span>&nbsp;<span class="op" id="6372998">:=</span>&nbsp;<span class="ident" id="6373001">tr</span><span class="op" id="6373003">.</span><span class="ident" id="6373004">numBytes</span><span class="op" id="6373012">(</span><span class="op" id="6373013">)</span>&nbsp;<span class="op" id="6373015">+</span>&nbsp;<span class="ident" id="6373017">tr</span><span class="op" id="6373019">.</span><span class="ident" id="6373020">pad</span>&nbsp;<span class="comment" id="6373024">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373052">tr</span><span class="op" id="6373054">.</span><span class="ident" id="6373055">curr</span><span class="op" id="6373059">,</span>&nbsp;<span class="ident" id="6373061">tr</span><span class="op" id="6373063">.</span><span class="ident" id="6373064">pad</span>&nbsp;<span class="op" id="6373068">=</span>&nbsp;<span class="builtintype" id="6373070">nil</span><span class="op" id="6373073">,</span>&nbsp;<span class="num" id="6373075">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373078">if</span>&nbsp;<span class="ident" id="6373081">sr</span><span class="op" id="6373083">,</span>&nbsp;<span class="ident" id="6373085">ok</span>&nbsp;<span class="op" id="6373088">:=</span>&nbsp;<span class="ident" id="6373091">tr</span><span class="op" id="6373093">.</span><span class="ident" id="6373094">r</span><span class="op" id="6373095">.</span><span class="op" id="6373096">(</span><span class="ident" id="6373097">io</span><span class="op" id="6373099">.</span><span class="ident" id="6373100">Seeker</span><span class="op" id="6373106">)</span><span class="op" id="6373107">;</span>&nbsp;<span class="ident" id="6373109">ok</span>&nbsp;<span class="op" id="6373112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373116">if</span>&nbsp;<span class="ident" id="6373119">_</span><span class="op" id="6373120">,</span>&nbsp;<span class="ident" id="6373122">err</span>&nbsp;<span class="op" id="6373126">:=</span>&nbsp;<span class="ident" id="6373129">sr</span><span class="op" id="6373131">.</span><span class="ident" id="6373132">Seek</span><span class="op" id="6373136">(</span><span class="ident" id="6373137">nr</span><span class="op" id="6373139">,</span>&nbsp;<span class="ident" id="6373141">os</span><span class="op" id="6373143">.</span><span class="ident" id="6373144">SEEK_CUR</span><span class="op" id="6373152">)</span><span class="op" id="6373153">;</span>&nbsp;<span class="ident" id="6373155">err</span>&nbsp;<span class="op" id="6373159">==</span>&nbsp;<span class="builtintype" id="6373162">nil</span>&nbsp;<span class="op" id="6373166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373171">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373180">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373186">_</span><span class="op" id="6373187">,</span>&nbsp;<span class="ident" id="6373189">tr</span><span class="op" id="6373191">.</span><span class="ident" id="6373192">err</span>&nbsp;<span class="op" id="6373196">=</span>&nbsp;<span class="ident" id="6373198">io</span><span class="op" id="6373200">.</span><span class="ident" id="6373201">CopyN</span><span class="op" id="6373206">(</span><span class="ident" id="6373207">ioutil</span><span class="op" id="6373213">.</span><span class="ident" id="6373214">Discard</span><span class="op" id="6373221">,</span>&nbsp;<span class="ident" id="6373223">tr</span><span class="op" id="6373225">.</span><span class="ident" id="6373226">r</span><span class="op" id="6373227">,</span>&nbsp;<span class="ident" id="6373229">nr</span><span class="op" id="6373231">)</span><br>
<span class="lineno"></span><span class="op" id="6373233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6373236">func</span>&nbsp;<span class="op" id="6373241">(</span><span class="ident" id="6373242">tr</span>&nbsp;<span class="op" id="6373245">*</span><span class="ident" id="6373246">Reader</span><span class="op" id="6373252">)</span>&nbsp;<span class="ident" id="6373254">verifyChecksum</span><span class="op" id="6373268">(</span><span class="ident" id="6373269">header</span>&nbsp;<span class="op" id="6373276">[</span><span class="op" id="6373277">]</span><span class="builtintype" id="6373278">byte</span><span class="op" id="6373282">)</span>&nbsp;<span class="builtintype" id="6373284">bool</span>&nbsp;<span class="op" id="6373289">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373292">if</span>&nbsp;<span class="ident" id="6373295">tr</span><span class="op" id="6373297">.</span><span class="ident" id="6373298">err</span>&nbsp;<span class="op" id="6373302">!=</span>&nbsp;<span class="builtintype" id="6373305">nil</span>&nbsp;<span class="op" id="6373309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373313">return</span>&nbsp;<span class="builtintype" id="6373320">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373331">given</span>&nbsp;<span class="op" id="6373337">:=</span>&nbsp;<span class="ident" id="6373340">tr</span><span class="op" id="6373342">.</span><span class="ident" id="6373343">octal</span><span class="op" id="6373348">(</span><span class="ident" id="6373349">header</span><span class="op" id="6373355">[</span><span class="num" id="6373356">148</span><span class="op" id="6373359">:</span><span class="num" id="6373360">156</span><span class="op" id="6373363">]</span><span class="op" id="6373364">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373367">unsigned</span><span class="op" id="6373375">,</span>&nbsp;<span class="ident" id="6373377">signed</span>&nbsp;<span class="op" id="6373384">:=</span>&nbsp;<span class="ident" id="6373387">checksum</span><span class="op" id="6373395">(</span><span class="ident" id="6373396">header</span><span class="op" id="6373402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373405">return</span>&nbsp;<span class="ident" id="6373412">given</span>&nbsp;<span class="op" id="6373418">==</span>&nbsp;<span class="ident" id="6373421">unsigned</span>&nbsp;<span class="op" id="6373430">||</span>&nbsp;<span class="ident" id="6373433">given</span>&nbsp;<span class="op" id="6373439">==</span>&nbsp;<span class="ident" id="6373442">signed</span><br>
<span class="lineno"></span><span class="op" id="6373449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6373452">func</span>&nbsp;<span class="op" id="6373457">(</span><span class="ident" id="6373458">tr</span>&nbsp;<span class="op" id="6373461">*</span><span class="ident" id="6373462">Reader</span><span class="op" id="6373468">)</span>&nbsp;<span class="ident" id="6373470">readHeader</span><span class="op" id="6373480">(</span><span class="op" id="6373481">)</span>&nbsp;<span class="op" id="6373483">*</span><span class="ident" id="6373484">Header</span>&nbsp;<span class="op" id="6373491">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373494">header</span>&nbsp;<span class="op" id="6373501">:=</span>&nbsp;<span class="ident" id="6373504">tr</span><span class="op" id="6373506">.</span><span class="ident" id="6373507">hdrBuff</span><span class="op" id="6373514">[</span><span class="op" id="6373515">:</span><span class="op" id="6373516">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6373519">copy</span><span class="op" id="6373523">(</span><span class="ident" id="6373524">header</span><span class="op" id="6373530">,</span>&nbsp;<span class="ident" id="6373532">zeroBlock</span><span class="op" id="6373541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373545">if</span>&nbsp;<span class="ident" id="6373548">_</span><span class="op" id="6373549">,</span>&nbsp;<span class="ident" id="6373551">tr</span><span class="op" id="6373553">.</span><span class="ident" id="6373554">err</span>&nbsp;<span class="op" id="6373558">=</span>&nbsp;<span class="ident" id="6373560">io</span><span class="op" id="6373562">.</span><span class="ident" id="6373563">ReadFull</span><span class="op" id="6373571">(</span><span class="ident" id="6373572">tr</span><span class="op" id="6373574">.</span><span class="ident" id="6373575">r</span><span class="op" id="6373576">,</span>&nbsp;<span class="ident" id="6373578">header</span><span class="op" id="6373584">)</span><span class="op" id="6373585">;</span>&nbsp;<span class="ident" id="6373587">tr</span><span class="op" id="6373589">.</span><span class="ident" id="6373590">err</span>&nbsp;<span class="op" id="6373594">!=</span>&nbsp;<span class="builtintype" id="6373597">nil</span>&nbsp;<span class="op" id="6373601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373605">return</span>&nbsp;<span class="builtintype" id="6373612">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6373621">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373680">if</span>&nbsp;<span class="ident" id="6373683">bytes</span><span class="op" id="6373688">.</span><span class="ident" id="6373689">Equal</span><span class="op" id="6373694">(</span><span class="ident" id="6373695">header</span><span class="op" id="6373701">,</span>&nbsp;<span class="ident" id="6373703">zeroBlock</span><span class="op" id="6373712">[</span><span class="num" id="6373713">0</span><span class="op" id="6373714">:</span><span class="ident" id="6373715">blockSize</span><span class="op" id="6373724">]</span><span class="op" id="6373725">)</span>&nbsp;<span class="op" id="6373727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373731">if</span>&nbsp;<span class="ident" id="6373734">_</span><span class="op" id="6373735">,</span>&nbsp;<span class="ident" id="6373737">tr</span><span class="op" id="6373739">.</span><span class="ident" id="6373740">err</span>&nbsp;<span class="op" id="6373744">=</span>&nbsp;<span class="ident" id="6373746">io</span><span class="op" id="6373748">.</span><span class="ident" id="6373749">ReadFull</span><span class="op" id="6373757">(</span><span class="ident" id="6373758">tr</span><span class="op" id="6373760">.</span><span class="ident" id="6373761">r</span><span class="op" id="6373762">,</span>&nbsp;<span class="ident" id="6373764">header</span><span class="op" id="6373770">)</span><span class="op" id="6373771">;</span>&nbsp;<span class="ident" id="6373773">tr</span><span class="op" id="6373775">.</span><span class="ident" id="6373776">err</span>&nbsp;<span class="op" id="6373780">!=</span>&nbsp;<span class="builtintype" id="6373783">nil</span>&nbsp;<span class="op" id="6373787">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373792">return</span>&nbsp;<span class="builtintype" id="6373799">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373809">if</span>&nbsp;<span class="ident" id="6373812">bytes</span><span class="op" id="6373817">.</span><span class="ident" id="6373818">Equal</span><span class="op" id="6373823">(</span><span class="ident" id="6373824">header</span><span class="op" id="6373830">,</span>&nbsp;<span class="ident" id="6373832">zeroBlock</span><span class="op" id="6373841">[</span><span class="num" id="6373842">0</span><span class="op" id="6373843">:</span><span class="ident" id="6373844">blockSize</span><span class="op" id="6373853">]</span><span class="op" id="6373854">)</span>&nbsp;<span class="op" id="6373856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373861">tr</span><span class="op" id="6373863">.</span><span class="ident" id="6373864">err</span>&nbsp;<span class="op" id="6373868">=</span>&nbsp;<span class="ident" id="6373870">io</span><span class="op" id="6373872">.</span><span class="ident" id="6373873">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373879">}</span>&nbsp;<span class="keyword" id="6373881">else</span>&nbsp;<span class="op" id="6373886">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6373891">tr</span><span class="op" id="6373893">.</span><span class="ident" id="6373894">err</span>&nbsp;<span class="op" id="6373898">=</span>&nbsp;<span class="ident" id="6373900">ErrHeader</span>&nbsp;<span class="comment" id="6373910">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373954">return</span>&nbsp;<span class="builtintype" id="6373961">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6373970">if</span>&nbsp;<span class="op" id="6373973">!</span><span class="ident" id="6373974">tr</span><span class="op" id="6373976">.</span><span class="ident" id="6373977">verifyChecksum</span><span class="op" id="6373991">(</span><span class="ident" id="6373992">header</span><span class="op" id="6373998">)</span>&nbsp;<span class="op" id="6374000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374004">tr</span><span class="op" id="6374006">.</span><span class="ident" id="6374007">err</span>&nbsp;<span class="op" id="6374011">=</span>&nbsp;<span class="ident" id="6374013">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374025">return</span>&nbsp;<span class="builtintype" id="6374032">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6374041">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374052">hdr</span>&nbsp;<span class="op" id="6374056">:=</span>&nbsp;<span class="builtinfunc" id="6374059">new</span><span class="op" id="6374062">(</span><span class="ident" id="6374063">Header</span><span class="op" id="6374069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374072">s</span>&nbsp;<span class="op" id="6374074">:=</span>&nbsp;<span class="ident" id="6374077">slicer</span><span class="op" id="6374083">(</span><span class="ident" id="6374084">header</span><span class="op" id="6374090">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374094">hdr</span><span class="op" id="6374097">.</span><span class="ident" id="6374098">Name</span>&nbsp;<span class="op" id="6374103">=</span>&nbsp;<span class="ident" id="6374105">cString</span><span class="op" id="6374112">(</span><span class="ident" id="6374113">s</span><span class="op" id="6374114">.</span><span class="ident" id="6374115">next</span><span class="op" id="6374119">(</span><span class="num" id="6374120">100</span><span class="op" id="6374123">)</span><span class="op" id="6374124">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374127">hdr</span><span class="op" id="6374130">.</span><span class="ident" id="6374131">Mode</span>&nbsp;<span class="op" id="6374136">=</span>&nbsp;<span class="ident" id="6374138">tr</span><span class="op" id="6374140">.</span><span class="ident" id="6374141">octal</span><span class="op" id="6374146">(</span><span class="ident" id="6374147">s</span><span class="op" id="6374148">.</span><span class="ident" id="6374149">next</span><span class="op" id="6374153">(</span><span class="num" id="6374154">8</span><span class="op" id="6374155">)</span><span class="op" id="6374156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374159">hdr</span><span class="op" id="6374162">.</span><span class="ident" id="6374163">Uid</span>&nbsp;<span class="op" id="6374167">=</span>&nbsp;<span class="builtintype" id="6374169">int</span><span class="op" id="6374172">(</span><span class="ident" id="6374173">tr</span><span class="op" id="6374175">.</span><span class="ident" id="6374176">octal</span><span class="op" id="6374181">(</span><span class="ident" id="6374182">s</span><span class="op" id="6374183">.</span><span class="ident" id="6374184">next</span><span class="op" id="6374188">(</span><span class="num" id="6374189">8</span><span class="op" id="6374190">)</span><span class="op" id="6374191">)</span><span class="op" id="6374192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374195">hdr</span><span class="op" id="6374198">.</span><span class="ident" id="6374199">Gid</span>&nbsp;<span class="op" id="6374203">=</span>&nbsp;<span class="builtintype" id="6374205">int</span><span class="op" id="6374208">(</span><span class="ident" id="6374209">tr</span><span class="op" id="6374211">.</span><span class="ident" id="6374212">octal</span><span class="op" id="6374217">(</span><span class="ident" id="6374218">s</span><span class="op" id="6374219">.</span><span class="ident" id="6374220">next</span><span class="op" id="6374224">(</span><span class="num" id="6374225">8</span><span class="op" id="6374226">)</span><span class="op" id="6374227">)</span><span class="op" id="6374228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374231">hdr</span><span class="op" id="6374234">.</span><span class="ident" id="6374235">Size</span>&nbsp;<span class="op" id="6374240">=</span>&nbsp;<span class="ident" id="6374242">tr</span><span class="op" id="6374244">.</span><span class="ident" id="6374245">octal</span><span class="op" id="6374250">(</span><span class="ident" id="6374251">s</span><span class="op" id="6374252">.</span><span class="ident" id="6374253">next</span><span class="op" id="6374257">(</span><span class="num" id="6374258">12</span><span class="op" id="6374260">)</span><span class="op" id="6374261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374264">hdr</span><span class="op" id="6374267">.</span><span class="ident" id="6374268">ModTime</span>&nbsp;<span class="op" id="6374276">=</span>&nbsp;<span class="ident" id="6374278">time</span><span class="op" id="6374282">.</span><span class="ident" id="6374283">Unix</span><span class="op" id="6374287">(</span><span class="ident" id="6374288">tr</span><span class="op" id="6374290">.</span><span class="ident" id="6374291">octal</span><span class="op" id="6374296">(</span><span class="ident" id="6374297">s</span><span class="op" id="6374298">.</span><span class="ident" id="6374299">next</span><span class="op" id="6374303">(</span><span class="num" id="6374304">12</span><span class="op" id="6374306">)</span><span class="op" id="6374307">)</span><span class="op" id="6374308">,</span>&nbsp;<span class="num" id="6374310">0</span><span class="op" id="6374311">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374314">s</span><span class="op" id="6374315">.</span><span class="ident" id="6374316">next</span><span class="op" id="6374320">(</span><span class="num" id="6374321">8</span><span class="op" id="6374322">)</span>&nbsp;<span class="comment" id="6374324">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374335">hdr</span><span class="op" id="6374338">.</span><span class="ident" id="6374339">Typeflag</span>&nbsp;<span class="op" id="6374348">=</span>&nbsp;<span class="ident" id="6374350">s</span><span class="op" id="6374351">.</span><span class="ident" id="6374352">next</span><span class="op" id="6374356">(</span><span class="num" id="6374357">1</span><span class="op" id="6374358">)</span><span class="op" id="6374359">[</span><span class="num" id="6374360">0</span><span class="op" id="6374361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374364">hdr</span><span class="op" id="6374367">.</span><span class="ident" id="6374368">Linkname</span>&nbsp;<span class="op" id="6374377">=</span>&nbsp;<span class="ident" id="6374379">cString</span><span class="op" id="6374386">(</span><span class="ident" id="6374387">s</span><span class="op" id="6374388">.</span><span class="ident" id="6374389">next</span><span class="op" id="6374393">(</span><span class="num" id="6374394">100</span><span class="op" id="6374397">)</span><span class="op" id="6374398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6374402">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6374465">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6374531">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374593">magic</span>&nbsp;<span class="op" id="6374599">:=</span>&nbsp;<span class="builtintype" id="6374602">string</span><span class="op" id="6374608">(</span><span class="ident" id="6374609">s</span><span class="op" id="6374610">.</span><span class="ident" id="6374611">next</span><span class="op" id="6374615">(</span><span class="num" id="6374616">8</span><span class="op" id="6374617">)</span><span class="op" id="6374618">)</span>&nbsp;<span class="comment" id="6374620">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374656">var</span>&nbsp;<span class="ident" id="6374660">format</span>&nbsp;<span class="builtintype" id="6374667">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374675">switch</span>&nbsp;<span class="op" id="6374682">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374685">case</span>&nbsp;<span class="ident" id="6374690">magic</span><span class="op" id="6374695">[</span><span class="op" id="6374696">:</span><span class="num" id="6374697">6</span><span class="op" id="6374698">]</span>&nbsp;<span class="op" id="6374700">==</span>&nbsp;<span class="string" id="6374703">&#34;ustar\x00&#34;</span><span class="op" id="6374714">:</span>&nbsp;<span class="comment" id="6374716">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374745">if</span>&nbsp;<span class="builtintype" id="6374748">string</span><span class="op" id="6374754">(</span><span class="ident" id="6374755">header</span><span class="op" id="6374761">[</span><span class="num" id="6374762">508</span><span class="op" id="6374765">:</span><span class="num" id="6374766">512</span><span class="op" id="6374769">]</span><span class="op" id="6374770">)</span>&nbsp;<span class="op" id="6374772">==</span>&nbsp;<span class="string" id="6374775">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="6374785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374790">format</span>&nbsp;<span class="op" id="6374797">=</span>&nbsp;<span class="string" id="6374799">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374808">}</span>&nbsp;<span class="keyword" id="6374810">else</span>&nbsp;<span class="op" id="6374815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374820">format</span>&nbsp;<span class="op" id="6374827">=</span>&nbsp;<span class="string" id="6374829">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374842">case</span>&nbsp;<span class="ident" id="6374847">magic</span>&nbsp;<span class="op" id="6374853">==</span>&nbsp;<span class="string" id="6374856">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6374869">:</span>&nbsp;<span class="comment" id="6374871">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374888">format</span>&nbsp;<span class="op" id="6374895">=</span>&nbsp;<span class="string" id="6374897">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6374904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374908">switch</span>&nbsp;<span class="ident" id="6374915">format</span>&nbsp;<span class="op" id="6374922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6374925">case</span>&nbsp;<span class="string" id="6374930">&#34;posix&#34;</span><span class="op" id="6374937">,</span>&nbsp;<span class="string" id="6374939">&#34;gnu&#34;</span><span class="op" id="6374944">,</span>&nbsp;<span class="string" id="6374946">&#34;star&#34;</span><span class="op" id="6374952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374956">hdr</span><span class="op" id="6374959">.</span><span class="ident" id="6374960">Uname</span>&nbsp;<span class="op" id="6374966">=</span>&nbsp;<span class="ident" id="6374968">cString</span><span class="op" id="6374975">(</span><span class="ident" id="6374976">s</span><span class="op" id="6374977">.</span><span class="ident" id="6374978">next</span><span class="op" id="6374982">(</span><span class="num" id="6374983">32</span><span class="op" id="6374985">)</span><span class="op" id="6374986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374990">hdr</span><span class="op" id="6374993">.</span><span class="ident" id="6374994">Gname</span>&nbsp;<span class="op" id="6375000">=</span>&nbsp;<span class="ident" id="6375002">cString</span><span class="op" id="6375009">(</span><span class="ident" id="6375010">s</span><span class="op" id="6375011">.</span><span class="ident" id="6375012">next</span><span class="op" id="6375016">(</span><span class="num" id="6375017">32</span><span class="op" id="6375019">)</span><span class="op" id="6375020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375024">devmajor</span>&nbsp;<span class="op" id="6375033">:=</span>&nbsp;<span class="ident" id="6375036">s</span><span class="op" id="6375037">.</span><span class="ident" id="6375038">next</span><span class="op" id="6375042">(</span><span class="num" id="6375043">8</span><span class="op" id="6375044">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375048">devminor</span>&nbsp;<span class="op" id="6375057">:=</span>&nbsp;<span class="ident" id="6375060">s</span><span class="op" id="6375061">.</span><span class="ident" id="6375062">next</span><span class="op" id="6375066">(</span><span class="num" id="6375067">8</span><span class="op" id="6375068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375072">if</span>&nbsp;<span class="ident" id="6375075">hdr</span><span class="op" id="6375078">.</span><span class="ident" id="6375079">Typeflag</span>&nbsp;<span class="op" id="6375088">==</span>&nbsp;<span class="ident" id="6375091">TypeChar</span>&nbsp;<span class="op" id="6375100">||</span>&nbsp;<span class="ident" id="6375103">hdr</span><span class="op" id="6375106">.</span><span class="ident" id="6375107">Typeflag</span>&nbsp;<span class="op" id="6375116">==</span>&nbsp;<span class="ident" id="6375119">TypeBlock</span>&nbsp;<span class="op" id="6375129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375134">hdr</span><span class="op" id="6375137">.</span><span class="ident" id="6375138">Devmajor</span>&nbsp;<span class="op" id="6375147">=</span>&nbsp;<span class="ident" id="6375149">tr</span><span class="op" id="6375151">.</span><span class="ident" id="6375152">octal</span><span class="op" id="6375157">(</span><span class="ident" id="6375158">devmajor</span><span class="op" id="6375166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375171">hdr</span><span class="op" id="6375174">.</span><span class="ident" id="6375175">Devminor</span>&nbsp;<span class="op" id="6375184">=</span>&nbsp;<span class="ident" id="6375186">tr</span><span class="op" id="6375188">.</span><span class="ident" id="6375189">octal</span><span class="op" id="6375194">(</span><span class="ident" id="6375195">devminor</span><span class="op" id="6375203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375207">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375211">var</span>&nbsp;<span class="ident" id="6375215">prefix</span>&nbsp;<span class="builtintype" id="6375222">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375231">switch</span>&nbsp;<span class="ident" id="6375238">format</span>&nbsp;<span class="op" id="6375245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375249">case</span>&nbsp;<span class="string" id="6375254">&#34;posix&#34;</span><span class="op" id="6375261">,</span>&nbsp;<span class="string" id="6375263">&#34;gnu&#34;</span><span class="op" id="6375268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375273">prefix</span>&nbsp;<span class="op" id="6375280">=</span>&nbsp;<span class="ident" id="6375282">cString</span><span class="op" id="6375289">(</span><span class="ident" id="6375290">s</span><span class="op" id="6375291">.</span><span class="ident" id="6375292">next</span><span class="op" id="6375296">(</span><span class="num" id="6375297">155</span><span class="op" id="6375300">)</span><span class="op" id="6375301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375305">case</span>&nbsp;<span class="string" id="6375310">&#34;star&#34;</span><span class="op" id="6375316">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375321">prefix</span>&nbsp;<span class="op" id="6375328">=</span>&nbsp;<span class="ident" id="6375330">cString</span><span class="op" id="6375337">(</span><span class="ident" id="6375338">s</span><span class="op" id="6375339">.</span><span class="ident" id="6375340">next</span><span class="op" id="6375344">(</span><span class="num" id="6375345">131</span><span class="op" id="6375348">)</span><span class="op" id="6375349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375354">hdr</span><span class="op" id="6375357">.</span><span class="ident" id="6375358">AccessTime</span>&nbsp;<span class="op" id="6375369">=</span>&nbsp;<span class="ident" id="6375371">time</span><span class="op" id="6375375">.</span><span class="ident" id="6375376">Unix</span><span class="op" id="6375380">(</span><span class="ident" id="6375381">tr</span><span class="op" id="6375383">.</span><span class="ident" id="6375384">octal</span><span class="op" id="6375389">(</span><span class="ident" id="6375390">s</span><span class="op" id="6375391">.</span><span class="ident" id="6375392">next</span><span class="op" id="6375396">(</span><span class="num" id="6375397">12</span><span class="op" id="6375399">)</span><span class="op" id="6375400">)</span><span class="op" id="6375401">,</span>&nbsp;<span class="num" id="6375403">0</span><span class="op" id="6375404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375409">hdr</span><span class="op" id="6375412">.</span><span class="ident" id="6375413">ChangeTime</span>&nbsp;<span class="op" id="6375424">=</span>&nbsp;<span class="ident" id="6375426">time</span><span class="op" id="6375430">.</span><span class="ident" id="6375431">Unix</span><span class="op" id="6375435">(</span><span class="ident" id="6375436">tr</span><span class="op" id="6375438">.</span><span class="ident" id="6375439">octal</span><span class="op" id="6375444">(</span><span class="ident" id="6375445">s</span><span class="op" id="6375446">.</span><span class="ident" id="6375447">next</span><span class="op" id="6375451">(</span><span class="num" id="6375452">12</span><span class="op" id="6375454">)</span><span class="op" id="6375455">)</span><span class="op" id="6375456">,</span>&nbsp;<span class="num" id="6375458">0</span><span class="op" id="6375459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375467">if</span>&nbsp;<span class="builtinfunc" id="6375470">len</span><span class="op" id="6375473">(</span><span class="ident" id="6375474">prefix</span><span class="op" id="6375480">)</span>&nbsp;<span class="op" id="6375482">&gt;</span>&nbsp;<span class="num" id="6375484">0</span>&nbsp;<span class="op" id="6375486">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375491">hdr</span><span class="op" id="6375494">.</span><span class="ident" id="6375495">Name</span>&nbsp;<span class="op" id="6375500">=</span>&nbsp;<span class="ident" id="6375502">prefix</span>&nbsp;<span class="op" id="6375509">+</span>&nbsp;<span class="string" id="6375511">&#34;/&#34;</span>&nbsp;<span class="op" id="6375515">+</span>&nbsp;<span class="ident" id="6375517">hdr</span><span class="op" id="6375520">.</span><span class="ident" id="6375521">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375535">if</span>&nbsp;<span class="ident" id="6375538">tr</span><span class="op" id="6375540">.</span><span class="ident" id="6375541">err</span>&nbsp;<span class="op" id="6375545">!=</span>&nbsp;<span class="builtintype" id="6375548">nil</span>&nbsp;<span class="op" id="6375552">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375556">tr</span><span class="op" id="6375558">.</span><span class="ident" id="6375559">err</span>&nbsp;<span class="op" id="6375563">=</span>&nbsp;<span class="ident" id="6375565">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375577">return</span>&nbsp;<span class="builtintype" id="6375584">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6375589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6375593">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6375651">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375696">nb</span>&nbsp;<span class="op" id="6375699">:=</span>&nbsp;<span class="ident" id="6375702">int64</span><span class="op" id="6375707">(</span><span class="ident" id="6375708">hdr</span><span class="op" id="6375711">.</span><span class="ident" id="6375712">Size</span><span class="op" id="6375716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375719">tr</span><span class="op" id="6375721">.</span><span class="ident" id="6375722">pad</span>&nbsp;<span class="op" id="6375726">=</span>&nbsp;<span class="op" id="6375728">-</span><span class="ident" id="6375729">nb</span>&nbsp;<span class="op" id="6375732">&amp;</span>&nbsp;<span class="op" id="6375734">(</span><span class="ident" id="6375735">blockSize</span>&nbsp;<span class="op" id="6375745">-</span>&nbsp;<span class="num" id="6375747">1</span><span class="op" id="6375748">)</span>&nbsp;<span class="comment" id="6375750">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6375783">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375816">tr</span><span class="op" id="6375818">.</span><span class="ident" id="6375819">curr</span>&nbsp;<span class="op" id="6375824">=</span>&nbsp;<span class="op" id="6375826">&amp;</span><span class="ident" id="6375827">regFileReader</span><span class="op" id="6375840">{</span><span class="ident" id="6375841">r</span><span class="op" id="6375842">:</span>&nbsp;<span class="ident" id="6375844">tr</span><span class="op" id="6375846">.</span><span class="ident" id="6375847">r</span><span class="op" id="6375848">,</span>&nbsp;<span class="ident" id="6375850">nb</span><span class="op" id="6375852">:</span>&nbsp;<span class="ident" id="6375854">nb</span><span class="op" id="6375856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6375860">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6375903">if</span>&nbsp;<span class="ident" id="6375906">hdr</span><span class="op" id="6375909">.</span><span class="ident" id="6375910">Typeflag</span>&nbsp;<span class="op" id="6375919">==</span>&nbsp;<span class="ident" id="6375922">TypeGNUSparse</span>&nbsp;<span class="op" id="6375936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6375940">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6375976">hdr</span><span class="op" id="6375979">.</span><span class="ident" id="6375980">Size</span>&nbsp;<span class="op" id="6375985">=</span>&nbsp;<span class="ident" id="6375987">tr</span><span class="op" id="6375989">.</span><span class="ident" id="6375990">octal</span><span class="op" id="6375995">(</span><span class="ident" id="6375996">header</span><span class="op" id="6376002">[</span><span class="num" id="6376003">483</span><span class="op" id="6376006">:</span><span class="num" id="6376007">495</span><span class="op" id="6376010">]</span><span class="op" id="6376011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6376016">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376042">sp</span>&nbsp;<span class="op" id="6376045">:=</span>&nbsp;<span class="ident" id="6376048">tr</span><span class="op" id="6376050">.</span><span class="ident" id="6376051">readOldGNUSparseMap</span><span class="op" id="6376070">(</span><span class="ident" id="6376071">header</span><span class="op" id="6376077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376081">if</span>&nbsp;<span class="ident" id="6376084">tr</span><span class="op" id="6376086">.</span><span class="ident" id="6376087">err</span>&nbsp;<span class="op" id="6376091">!=</span>&nbsp;<span class="builtintype" id="6376094">nil</span>&nbsp;<span class="op" id="6376098">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376103">return</span>&nbsp;<span class="builtintype" id="6376110">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6376120">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376192">tr</span><span class="op" id="6376194">.</span><span class="ident" id="6376195">curr</span>&nbsp;<span class="op" id="6376200">=</span>&nbsp;<span class="op" id="6376202">&amp;</span><span class="ident" id="6376203">sparseFileReader</span><span class="op" id="6376219">{</span><span class="ident" id="6376220">rfr</span><span class="op" id="6376223">:</span>&nbsp;<span class="ident" id="6376225">tr</span><span class="op" id="6376227">.</span><span class="ident" id="6376228">curr</span><span class="op" id="6376232">.</span><span class="op" id="6376233">(</span><span class="op" id="6376234">*</span><span class="ident" id="6376235">regFileReader</span><span class="op" id="6376248">)</span><span class="op" id="6376249">,</span>&nbsp;<span class="ident" id="6376251">sp</span><span class="op" id="6376253">:</span>&nbsp;<span class="ident" id="6376255">sp</span><span class="op" id="6376257">,</span>&nbsp;<span class="ident" id="6376259">tot</span><span class="op" id="6376262">:</span>&nbsp;<span class="ident" id="6376264">hdr</span><span class="op" id="6376267">.</span><span class="ident" id="6376268">Size</span><span class="op" id="6376272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6376275">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376279">return</span>&nbsp;<span class="ident" id="6376286">hdr</span><br>
<span class="lineno"></span><span class="op" id="6376290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6376293">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="6376362">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6376432">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6376450">type</span>&nbsp;<span class="ident" id="6376455">sparseEntry</span>&nbsp;<span class="keyword" id="6376467">struct</span>&nbsp;<span class="op" id="6376474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376477">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6376486">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376493">numBytes</span>&nbsp;<span class="ident" id="6376502">int64</span><br>
<span class="lineno">545</span><span class="op" id="6376508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6376511">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6376595">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="6376697">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="6376781">func</span>&nbsp;<span class="op" id="6376786">(</span><span class="ident" id="6376787">tr</span>&nbsp;<span class="op" id="6376790">*</span><span class="ident" id="6376791">Reader</span><span class="op" id="6376797">)</span>&nbsp;<span class="ident" id="6376799">readOldGNUSparseMap</span><span class="op" id="6376818">(</span><span class="ident" id="6376819">header</span>&nbsp;<span class="op" id="6376826">[</span><span class="op" id="6376827">]</span><span class="builtintype" id="6376828">byte</span><span class="op" id="6376832">)</span>&nbsp;<span class="op" id="6376834">[</span><span class="op" id="6376835">]</span><span class="ident" id="6376836">sparseEntry</span>&nbsp;<span class="op" id="6376848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376851">isExtended</span>&nbsp;<span class="op" id="6376862">:=</span>&nbsp;<span class="ident" id="6376865">header</span><span class="op" id="6376871">[</span><span class="ident" id="6376872">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="6376910">]</span>&nbsp;<span class="op" id="6376912">!=</span>&nbsp;<span class="num" id="6376915">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376918">spCap</span>&nbsp;<span class="op" id="6376924">:=</span>&nbsp;<span class="ident" id="6376927">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6376961">if</span>&nbsp;<span class="ident" id="6376964">isExtended</span>&nbsp;<span class="op" id="6376975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6376979">spCap</span>&nbsp;<span class="op" id="6376985">+=</span>&nbsp;<span class="ident" id="6376988">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377029">sp</span>&nbsp;<span class="op" id="6377032">:=</span>&nbsp;<span class="builtinfunc" id="6377035">make</span><span class="op" id="6377039">(</span><span class="op" id="6377040">[</span><span class="op" id="6377041">]</span><span class="ident" id="6377042">sparseEntry</span><span class="op" id="6377053">,</span>&nbsp;<span class="num" id="6377055">0</span><span class="op" id="6377056">,</span>&nbsp;<span class="ident" id="6377058">spCap</span><span class="op" id="6377063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377066">s</span>&nbsp;<span class="op" id="6377068">:=</span>&nbsp;<span class="ident" id="6377071">slicer</span><span class="op" id="6377077">(</span><span class="ident" id="6377078">header</span><span class="op" id="6377084">[</span><span class="ident" id="6377085">oldGNUSparseMainHeaderOffset</span><span class="op" id="6377113">:</span><span class="op" id="6377114">]</span><span class="op" id="6377115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6377119">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377170">for</span>&nbsp;<span class="ident" id="6377174">i</span>&nbsp;<span class="op" id="6377176">:=</span>&nbsp;<span class="num" id="6377179">0</span><span class="op" id="6377180">;</span>&nbsp;<span class="ident" id="6377182">i</span>&nbsp;<span class="op" id="6377184">&lt;</span>&nbsp;<span class="ident" id="6377186">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="6377218">;</span>&nbsp;<span class="ident" id="6377220">i</span><span class="op" id="6377221">++</span>&nbsp;<span class="op" id="6377224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377228">offset</span>&nbsp;<span class="op" id="6377235">:=</span>&nbsp;<span class="ident" id="6377238">tr</span><span class="op" id="6377240">.</span><span class="ident" id="6377241">octal</span><span class="op" id="6377246">(</span><span class="ident" id="6377247">s</span><span class="op" id="6377248">.</span><span class="ident" id="6377249">next</span><span class="op" id="6377253">(</span><span class="ident" id="6377254">oldGNUSparseOffsetSize</span><span class="op" id="6377276">)</span><span class="op" id="6377277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377281">numBytes</span>&nbsp;<span class="op" id="6377290">:=</span>&nbsp;<span class="ident" id="6377293">tr</span><span class="op" id="6377295">.</span><span class="ident" id="6377296">octal</span><span class="op" id="6377301">(</span><span class="ident" id="6377302">s</span><span class="op" id="6377303">.</span><span class="ident" id="6377304">next</span><span class="op" id="6377308">(</span><span class="ident" id="6377309">oldGNUSparseNumBytesSize</span><span class="op" id="6377333">)</span><span class="op" id="6377334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377338">if</span>&nbsp;<span class="ident" id="6377341">tr</span><span class="op" id="6377343">.</span><span class="ident" id="6377344">err</span>&nbsp;<span class="op" id="6377348">!=</span>&nbsp;<span class="builtintype" id="6377351">nil</span>&nbsp;<span class="op" id="6377355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377360">tr</span><span class="op" id="6377362">.</span><span class="ident" id="6377363">err</span>&nbsp;<span class="op" id="6377367">=</span>&nbsp;<span class="ident" id="6377369">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377382">return</span>&nbsp;<span class="builtintype" id="6377389">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377399">if</span>&nbsp;<span class="ident" id="6377402">offset</span>&nbsp;<span class="op" id="6377409">==</span>&nbsp;<span class="num" id="6377412">0</span>&nbsp;<span class="op" id="6377414">&amp;&amp;</span>&nbsp;<span class="ident" id="6377417">numBytes</span>&nbsp;<span class="op" id="6377426">==</span>&nbsp;<span class="num" id="6377429">0</span>&nbsp;<span class="op" id="6377431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377436">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377444">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377448">sp</span>&nbsp;<span class="op" id="6377451">=</span>&nbsp;<span class="builtinfunc" id="6377453">append</span><span class="op" id="6377459">(</span><span class="ident" id="6377460">sp</span><span class="op" id="6377462">,</span>&nbsp;<span class="ident" id="6377464">sparseEntry</span><span class="op" id="6377475">{</span><span class="ident" id="6377476">offset</span><span class="op" id="6377482">:</span>&nbsp;<span class="ident" id="6377484">offset</span><span class="op" id="6377490">,</span>&nbsp;<span class="ident" id="6377492">numBytes</span><span class="op" id="6377500">:</span>&nbsp;<span class="ident" id="6377502">numBytes</span><span class="op" id="6377510">}</span><span class="op" id="6377511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377518">for</span>&nbsp;<span class="ident" id="6377522">isExtended</span>&nbsp;<span class="op" id="6377533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6377537">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377614">sparseHeader</span>&nbsp;<span class="op" id="6377627">:=</span>&nbsp;<span class="builtinfunc" id="6377630">make</span><span class="op" id="6377634">(</span><span class="op" id="6377635">[</span><span class="op" id="6377636">]</span><span class="builtintype" id="6377637">byte</span><span class="op" id="6377641">,</span>&nbsp;<span class="ident" id="6377643">blockSize</span><span class="op" id="6377652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377656">if</span>&nbsp;<span class="ident" id="6377659">_</span><span class="op" id="6377660">,</span>&nbsp;<span class="ident" id="6377662">tr</span><span class="op" id="6377664">.</span><span class="ident" id="6377665">err</span>&nbsp;<span class="op" id="6377669">=</span>&nbsp;<span class="ident" id="6377671">io</span><span class="op" id="6377673">.</span><span class="ident" id="6377674">ReadFull</span><span class="op" id="6377682">(</span><span class="ident" id="6377683">tr</span><span class="op" id="6377685">.</span><span class="ident" id="6377686">r</span><span class="op" id="6377687">,</span>&nbsp;<span class="ident" id="6377689">sparseHeader</span><span class="op" id="6377701">)</span><span class="op" id="6377702">;</span>&nbsp;<span class="ident" id="6377704">tr</span><span class="op" id="6377706">.</span><span class="ident" id="6377707">err</span>&nbsp;<span class="op" id="6377711">!=</span>&nbsp;<span class="builtintype" id="6377714">nil</span>&nbsp;<span class="op" id="6377718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377723">return</span>&nbsp;<span class="builtintype" id="6377730">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377740">isExtended</span>&nbsp;<span class="op" id="6377751">=</span>&nbsp;<span class="ident" id="6377753">sparseHeader</span><span class="op" id="6377765">[</span><span class="ident" id="6377766">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="6377808">]</span>&nbsp;<span class="op" id="6377810">!=</span>&nbsp;<span class="num" id="6377813">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377817">s</span>&nbsp;<span class="op" id="6377819">=</span>&nbsp;<span class="ident" id="6377821">slicer</span><span class="op" id="6377827">(</span><span class="ident" id="6377828">sparseHeader</span><span class="op" id="6377840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6377844">for</span>&nbsp;<span class="ident" id="6377848">i</span>&nbsp;<span class="op" id="6377850">:=</span>&nbsp;<span class="num" id="6377853">0</span><span class="op" id="6377854">;</span>&nbsp;<span class="ident" id="6377856">i</span>&nbsp;<span class="op" id="6377858">&lt;</span>&nbsp;<span class="ident" id="6377860">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="6377896">;</span>&nbsp;<span class="ident" id="6377898">i</span><span class="op" id="6377899">++</span>&nbsp;<span class="op" id="6377902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377907">offset</span>&nbsp;<span class="op" id="6377914">:=</span>&nbsp;<span class="ident" id="6377917">tr</span><span class="op" id="6377919">.</span><span class="ident" id="6377920">octal</span><span class="op" id="6377925">(</span><span class="ident" id="6377926">s</span><span class="op" id="6377927">.</span><span class="ident" id="6377928">next</span><span class="op" id="6377932">(</span><span class="ident" id="6377933">oldGNUSparseOffsetSize</span><span class="op" id="6377955">)</span><span class="op" id="6377956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6377961">numBytes</span>&nbsp;<span class="op" id="6377970">:=</span>&nbsp;<span class="ident" id="6377973">tr</span><span class="op" id="6377975">.</span><span class="ident" id="6377976">octal</span><span class="op" id="6377981">(</span><span class="ident" id="6377982">s</span><span class="op" id="6377983">.</span><span class="ident" id="6377984">next</span><span class="op" id="6377988">(</span><span class="ident" id="6377989">oldGNUSparseNumBytesSize</span><span class="op" id="6378013">)</span><span class="op" id="6378014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378019">if</span>&nbsp;<span class="ident" id="6378022">tr</span><span class="op" id="6378024">.</span><span class="ident" id="6378025">err</span>&nbsp;<span class="op" id="6378029">!=</span>&nbsp;<span class="builtintype" id="6378032">nil</span>&nbsp;<span class="op" id="6378036">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378042">tr</span><span class="op" id="6378044">.</span><span class="ident" id="6378045">err</span>&nbsp;<span class="op" id="6378049">=</span>&nbsp;<span class="ident" id="6378051">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378065">return</span>&nbsp;<span class="builtintype" id="6378072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378084">if</span>&nbsp;<span class="ident" id="6378087">offset</span>&nbsp;<span class="op" id="6378094">==</span>&nbsp;<span class="num" id="6378097">0</span>&nbsp;<span class="op" id="6378099">&amp;&amp;</span>&nbsp;<span class="ident" id="6378102">numBytes</span>&nbsp;<span class="op" id="6378111">==</span>&nbsp;<span class="num" id="6378114">0</span>&nbsp;<span class="op" id="6378116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378122">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378136">sp</span>&nbsp;<span class="op" id="6378139">=</span>&nbsp;<span class="builtinfunc" id="6378141">append</span><span class="op" id="6378147">(</span><span class="ident" id="6378148">sp</span><span class="op" id="6378150">,</span>&nbsp;<span class="ident" id="6378152">sparseEntry</span><span class="op" id="6378163">{</span><span class="ident" id="6378164">offset</span><span class="op" id="6378170">:</span>&nbsp;<span class="ident" id="6378172">offset</span><span class="op" id="6378178">,</span>&nbsp;<span class="ident" id="6378180">numBytes</span><span class="op" id="6378188">:</span>&nbsp;<span class="ident" id="6378190">numBytes</span><span class="op" id="6378198">}</span><span class="op" id="6378199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378209">return</span>&nbsp;<span class="ident" id="6378216">sp</span><br>
<span class="lineno">595</span><span class="op" id="6378219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6378222">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="6378316">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="6378416">func</span>&nbsp;<span class="ident" id="6378421">readGNUSparseMap1x0</span><span class="op" id="6378440">(</span><span class="ident" id="6378441">r</span>&nbsp;<span class="ident" id="6378443">io</span><span class="op" id="6378445">.</span><span class="ident" id="6378446">Reader</span><span class="op" id="6378452">)</span>&nbsp;<span class="op" id="6378454">(</span><span class="op" id="6378455">[</span><span class="op" id="6378456">]</span><span class="ident" id="6378457">sparseEntry</span><span class="op" id="6378468">,</span>&nbsp;<span class="builtintype" id="6378470">error</span><span class="op" id="6378475">)</span>&nbsp;<span class="op" id="6378477">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378480">buf</span>&nbsp;<span class="op" id="6378484">:=</span>&nbsp;<span class="builtinfunc" id="6378487">make</span><span class="op" id="6378491">(</span><span class="op" id="6378492">[</span><span class="op" id="6378493">]</span><span class="builtintype" id="6378494">byte</span><span class="op" id="6378498">,</span>&nbsp;<span class="num" id="6378500">2</span><span class="op" id="6378501">*</span><span class="ident" id="6378502">blockSize</span><span class="op" id="6378511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378514">sparseHeader</span>&nbsp;<span class="op" id="6378527">:=</span>&nbsp;<span class="ident" id="6378530">buf</span><span class="op" id="6378533">[</span><span class="op" id="6378534">:</span><span class="ident" id="6378535">blockSize</span><span class="op" id="6378544">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6378548">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6378631">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378703">readDecimal</span>&nbsp;<span class="op" id="6378715">:=</span>&nbsp;<span class="keyword" id="6378718">func</span><span class="op" id="6378722">(</span><span class="op" id="6378723">)</span>&nbsp;<span class="op" id="6378725">(</span><span class="ident" id="6378726">int64</span><span class="op" id="6378731">,</span>&nbsp;<span class="builtintype" id="6378733">error</span><span class="op" id="6378738">)</span>&nbsp;<span class="op" id="6378740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6378744">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378766">nl</span>&nbsp;<span class="op" id="6378769">:=</span>&nbsp;<span class="ident" id="6378772">bytes</span><span class="op" id="6378777">.</span><span class="ident" id="6378778">IndexByte</span><span class="op" id="6378787">(</span><span class="ident" id="6378788">sparseHeader</span><span class="op" id="6378800">,</span>&nbsp;<span class="string" id="6378802">&#39;\n&#39;</span><span class="op" id="6378806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378810">if</span>&nbsp;<span class="ident" id="6378813">nl</span>&nbsp;<span class="op" id="6378816">==</span>&nbsp;<span class="op" id="6378819">-</span><span class="num" id="6378820">1</span>&nbsp;<span class="op" id="6378822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378827">if</span>&nbsp;<span class="builtinfunc" id="6378830">len</span><span class="op" id="6378833">(</span><span class="ident" id="6378834">sparseHeader</span><span class="op" id="6378846">)</span>&nbsp;<span class="op" id="6378848">&gt;=</span>&nbsp;<span class="ident" id="6378851">blockSize</span>&nbsp;<span class="op" id="6378861">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6378867">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378891">return</span>&nbsp;<span class="num" id="6378898">0</span><span class="op" id="6378899">,</span>&nbsp;<span class="ident" id="6378901">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378919">oldLen</span>&nbsp;<span class="op" id="6378926">:=</span>&nbsp;<span class="builtinfunc" id="6378929">len</span><span class="op" id="6378932">(</span><span class="ident" id="6378933">sparseHeader</span><span class="op" id="6378945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378950">newLen</span>&nbsp;<span class="op" id="6378957">:=</span>&nbsp;<span class="ident" id="6378960">oldLen</span>&nbsp;<span class="op" id="6378967">+</span>&nbsp;<span class="ident" id="6378969">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6378982">if</span>&nbsp;<span class="builtinfunc" id="6378985">cap</span><span class="op" id="6378988">(</span><span class="ident" id="6378989">sparseHeader</span><span class="op" id="6379001">)</span>&nbsp;<span class="op" id="6379003">&lt;</span>&nbsp;<span class="ident" id="6379005">newLen</span>&nbsp;<span class="op" id="6379012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379018">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6379090">copy</span><span class="op" id="6379094">(</span><span class="ident" id="6379095">buf</span><span class="op" id="6379098">,</span>&nbsp;<span class="ident" id="6379100">sparseHeader</span><span class="op" id="6379112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379118">sparseHeader</span>&nbsp;<span class="op" id="6379131">=</span>&nbsp;<span class="ident" id="6379133">buf</span><span class="op" id="6379136">[</span><span class="op" id="6379137">:</span><span class="ident" id="6379138">newLen</span><span class="op" id="6379144">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379149">}</span>&nbsp;<span class="keyword" id="6379151">else</span>&nbsp;<span class="op" id="6379156">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379162">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379214">sparseHeader</span>&nbsp;<span class="op" id="6379227">=</span>&nbsp;<span class="ident" id="6379229">sparseHeader</span><span class="op" id="6379241">[</span><span class="op" id="6379242">:</span><span class="ident" id="6379243">newLen</span><span class="op" id="6379249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379260">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379321">if</span>&nbsp;<span class="ident" id="6379324">_</span><span class="op" id="6379325">,</span>&nbsp;<span class="ident" id="6379327">err</span>&nbsp;<span class="op" id="6379331">:=</span>&nbsp;<span class="ident" id="6379334">io</span><span class="op" id="6379336">.</span><span class="ident" id="6379337">ReadFull</span><span class="op" id="6379345">(</span><span class="ident" id="6379346">r</span><span class="op" id="6379347">,</span>&nbsp;<span class="ident" id="6379349">sparseHeader</span><span class="op" id="6379361">[</span><span class="ident" id="6379362">oldLen</span><span class="op" id="6379368">:</span><span class="ident" id="6379369">newLen</span><span class="op" id="6379375">]</span><span class="op" id="6379376">)</span><span class="op" id="6379377">;</span>&nbsp;<span class="ident" id="6379379">err</span>&nbsp;<span class="op" id="6379383">!=</span>&nbsp;<span class="builtintype" id="6379386">nil</span>&nbsp;<span class="op" id="6379390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379396">return</span>&nbsp;<span class="num" id="6379403">0</span><span class="op" id="6379404">,</span>&nbsp;<span class="ident" id="6379406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379419">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379460">nl</span>&nbsp;<span class="op" id="6379463">=</span>&nbsp;<span class="ident" id="6379465">bytes</span><span class="op" id="6379470">.</span><span class="ident" id="6379471">IndexByte</span><span class="op" id="6379480">(</span><span class="ident" id="6379481">sparseHeader</span><span class="op" id="6379493">[</span><span class="ident" id="6379494">oldLen</span><span class="op" id="6379500">:</span><span class="ident" id="6379501">newLen</span><span class="op" id="6379507">]</span><span class="op" id="6379508">,</span>&nbsp;<span class="string" id="6379510">&#39;\n&#39;</span><span class="op" id="6379514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379519">if</span>&nbsp;<span class="ident" id="6379522">nl</span>&nbsp;<span class="op" id="6379525">==</span>&nbsp;<span class="op" id="6379528">-</span><span class="num" id="6379529">1</span>&nbsp;<span class="op" id="6379531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379537">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379561">return</span>&nbsp;<span class="num" id="6379568">0</span><span class="op" id="6379569">,</span>&nbsp;<span class="ident" id="6379571">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379584">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379589">nl</span>&nbsp;<span class="op" id="6379592">+=</span>&nbsp;<span class="ident" id="6379595">oldLen</span>&nbsp;<span class="comment" id="6379602">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379651">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379702">n</span><span class="op" id="6379703">,</span>&nbsp;<span class="ident" id="6379705">err</span>&nbsp;<span class="op" id="6379709">:=</span>&nbsp;<span class="ident" id="6379712">strconv</span><span class="op" id="6379719">.</span><span class="ident" id="6379720">ParseInt</span><span class="op" id="6379728">(</span><span class="builtintype" id="6379729">string</span><span class="op" id="6379735">(</span><span class="ident" id="6379736">sparseHeader</span><span class="op" id="6379748">[</span><span class="op" id="6379749">:</span><span class="ident" id="6379750">nl</span><span class="op" id="6379752">]</span><span class="op" id="6379753">)</span><span class="op" id="6379754">,</span>&nbsp;<span class="num" id="6379756">10</span><span class="op" id="6379758">,</span>&nbsp;<span class="num" id="6379760">0</span><span class="op" id="6379761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379765">if</span>&nbsp;<span class="ident" id="6379768">err</span>&nbsp;<span class="op" id="6379772">!=</span>&nbsp;<span class="builtintype" id="6379775">nil</span>&nbsp;<span class="op" id="6379779">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379784">return</span>&nbsp;<span class="num" id="6379791">0</span><span class="op" id="6379792">,</span>&nbsp;<span class="ident" id="6379794">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379811">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379859">sparseHeader</span>&nbsp;<span class="op" id="6379872">=</span>&nbsp;<span class="ident" id="6379874">sparseHeader</span><span class="op" id="6379886">[</span><span class="ident" id="6379887">nl</span><span class="op" id="6379889">+</span><span class="num" id="6379890">1</span><span class="op" id="6379891">:</span><span class="op" id="6379892">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379896">return</span>&nbsp;<span class="ident" id="6379903">n</span><span class="op" id="6379904">,</span>&nbsp;<span class="builtintype" id="6379906">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379915">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379940">if</span>&nbsp;<span class="ident" id="6379943">_</span><span class="op" id="6379944">,</span>&nbsp;<span class="ident" id="6379946">err</span>&nbsp;<span class="op" id="6379950">:=</span>&nbsp;<span class="ident" id="6379953">io</span><span class="op" id="6379955">.</span><span class="ident" id="6379956">ReadFull</span><span class="op" id="6379964">(</span><span class="ident" id="6379965">r</span><span class="op" id="6379966">,</span>&nbsp;<span class="ident" id="6379968">sparseHeader</span><span class="op" id="6379980">)</span><span class="op" id="6379981">;</span>&nbsp;<span class="ident" id="6379983">err</span>&nbsp;<span class="op" id="6379987">!=</span>&nbsp;<span class="builtintype" id="6379990">nil</span>&nbsp;<span class="op" id="6379994">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379998">return</span>&nbsp;<span class="builtintype" id="6380005">nil</span><span class="op" id="6380008">,</span>&nbsp;<span class="ident" id="6380010">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380019">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380069">numEntries</span><span class="op" id="6380079">,</span>&nbsp;<span class="ident" id="6380081">err</span>&nbsp;<span class="op" id="6380085">:=</span>&nbsp;<span class="ident" id="6380088">readDecimal</span><span class="op" id="6380099">(</span><span class="op" id="6380100">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380103">if</span>&nbsp;<span class="ident" id="6380106">err</span>&nbsp;<span class="op" id="6380110">!=</span>&nbsp;<span class="builtintype" id="6380113">nil</span>&nbsp;<span class="op" id="6380117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380121">return</span>&nbsp;<span class="builtintype" id="6380128">nil</span><span class="op" id="6380131">,</span>&nbsp;<span class="ident" id="6380133">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380142">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380167">sp</span>&nbsp;<span class="op" id="6380170">:=</span>&nbsp;<span class="builtinfunc" id="6380173">make</span><span class="op" id="6380177">(</span><span class="op" id="6380178">[</span><span class="op" id="6380179">]</span><span class="ident" id="6380180">sparseEntry</span><span class="op" id="6380191">,</span>&nbsp;<span class="num" id="6380193">0</span><span class="op" id="6380194">,</span>&nbsp;<span class="ident" id="6380196">numEntries</span><span class="op" id="6380206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380209">for</span>&nbsp;<span class="ident" id="6380213">i</span>&nbsp;<span class="op" id="6380215">:=</span>&nbsp;<span class="ident" id="6380218">int64</span><span class="op" id="6380223">(</span><span class="num" id="6380224">0</span><span class="op" id="6380225">)</span><span class="op" id="6380226">;</span>&nbsp;<span class="ident" id="6380228">i</span>&nbsp;<span class="op" id="6380230">&lt;</span>&nbsp;<span class="ident" id="6380232">numEntries</span><span class="op" id="6380242">;</span>&nbsp;<span class="ident" id="6380244">i</span><span class="op" id="6380245">++</span>&nbsp;<span class="op" id="6380248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380252">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380273">offset</span><span class="op" id="6380279">,</span>&nbsp;<span class="ident" id="6380281">err</span>&nbsp;<span class="op" id="6380285">:=</span>&nbsp;<span class="ident" id="6380288">readDecimal</span><span class="op" id="6380299">(</span><span class="op" id="6380300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380304">if</span>&nbsp;<span class="ident" id="6380307">err</span>&nbsp;<span class="op" id="6380311">!=</span>&nbsp;<span class="builtintype" id="6380314">nil</span>&nbsp;<span class="op" id="6380318">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380323">return</span>&nbsp;<span class="builtintype" id="6380330">nil</span><span class="op" id="6380333">,</span>&nbsp;<span class="ident" id="6380335">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380345">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380364">numBytes</span><span class="op" id="6380372">,</span>&nbsp;<span class="ident" id="6380374">err</span>&nbsp;<span class="op" id="6380378">:=</span>&nbsp;<span class="ident" id="6380381">readDecimal</span><span class="op" id="6380392">(</span><span class="op" id="6380393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380397">if</span>&nbsp;<span class="ident" id="6380400">err</span>&nbsp;<span class="op" id="6380404">!=</span>&nbsp;<span class="builtintype" id="6380407">nil</span>&nbsp;<span class="op" id="6380411">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380416">return</span>&nbsp;<span class="builtintype" id="6380423">nil</span><span class="op" id="6380426">,</span>&nbsp;<span class="ident" id="6380428">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380439">sp</span>&nbsp;<span class="op" id="6380442">=</span>&nbsp;<span class="builtinfunc" id="6380444">append</span><span class="op" id="6380450">(</span><span class="ident" id="6380451">sp</span><span class="op" id="6380453">,</span>&nbsp;<span class="ident" id="6380455">sparseEntry</span><span class="op" id="6380466">{</span><span class="ident" id="6380467">offset</span><span class="op" id="6380473">:</span>&nbsp;<span class="ident" id="6380475">offset</span><span class="op" id="6380481">,</span>&nbsp;<span class="ident" id="6380483">numBytes</span><span class="op" id="6380491">:</span>&nbsp;<span class="ident" id="6380493">numBytes</span><span class="op" id="6380501">}</span><span class="op" id="6380502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380505">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380509">return</span>&nbsp;<span class="ident" id="6380516">sp</span><span class="op" id="6380518">,</span>&nbsp;<span class="builtintype" id="6380520">nil</span><br>
<span class="lineno"></span><span class="op" id="6380524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6380527">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="6380621">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6380669">func</span>&nbsp;<span class="ident" id="6380674">readGNUSparseMap0x1</span><span class="op" id="6380693">(</span><span class="ident" id="6380694">headers</span>&nbsp;<span class="keyword" id="6380702">map</span><span class="op" id="6380705">[</span><span class="builtintype" id="6380706">string</span><span class="op" id="6380712">]</span><span class="builtintype" id="6380713">string</span><span class="op" id="6380719">)</span>&nbsp;<span class="op" id="6380721">(</span><span class="op" id="6380722">[</span><span class="op" id="6380723">]</span><span class="ident" id="6380724">sparseEntry</span><span class="op" id="6380735">,</span>&nbsp;<span class="builtintype" id="6380737">error</span><span class="op" id="6380742">)</span>&nbsp;<span class="op" id="6380744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380747">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380773">numEntriesStr</span><span class="op" id="6380786">,</span>&nbsp;<span class="ident" id="6380788">ok</span>&nbsp;<span class="op" id="6380791">:=</span>&nbsp;<span class="ident" id="6380794">headers</span><span class="op" id="6380801">[</span><span class="ident" id="6380802">paxGNUSparseNumBlocks</span><span class="op" id="6380823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380826">if</span>&nbsp;<span class="op" id="6380829">!</span><span class="ident" id="6380830">ok</span>&nbsp;<span class="op" id="6380833">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380837">return</span>&nbsp;<span class="builtintype" id="6380844">nil</span><span class="op" id="6380847">,</span>&nbsp;<span class="ident" id="6380849">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380863">numEntries</span><span class="op" id="6380873">,</span>&nbsp;<span class="ident" id="6380875">err</span>&nbsp;<span class="op" id="6380879">:=</span>&nbsp;<span class="ident" id="6380882">strconv</span><span class="op" id="6380889">.</span><span class="ident" id="6380890">ParseInt</span><span class="op" id="6380898">(</span><span class="ident" id="6380899">numEntriesStr</span><span class="op" id="6380912">,</span>&nbsp;<span class="num" id="6380914">10</span><span class="op" id="6380916">,</span>&nbsp;<span class="num" id="6380918">0</span><span class="op" id="6380919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380922">if</span>&nbsp;<span class="ident" id="6380925">err</span>&nbsp;<span class="op" id="6380929">!=</span>&nbsp;<span class="builtintype" id="6380932">nil</span>&nbsp;<span class="op" id="6380936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380940">return</span>&nbsp;<span class="builtintype" id="6380947">nil</span><span class="op" id="6380950">,</span>&nbsp;<span class="ident" id="6380952">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380967">sparseMap</span>&nbsp;<span class="op" id="6380977">:=</span>&nbsp;<span class="ident" id="6380980">strings</span><span class="op" id="6380987">.</span><span class="ident" id="6380988">Split</span><span class="op" id="6380993">(</span><span class="ident" id="6380994">headers</span><span class="op" id="6381001">[</span><span class="ident" id="6381002">paxGNUSparseMap</span><span class="op" id="6381017">]</span><span class="op" id="6381018">,</span>&nbsp;<span class="string" id="6381020">&#34;,&#34;</span><span class="op" id="6381023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381027">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381087">if</span>&nbsp;<span class="ident" id="6381090">int64</span><span class="op" id="6381095">(</span><span class="builtinfunc" id="6381096">len</span><span class="op" id="6381099">(</span><span class="ident" id="6381100">sparseMap</span><span class="op" id="6381109">)</span><span class="op" id="6381110">)</span>&nbsp;<span class="op" id="6381112">!=</span>&nbsp;<span class="num" id="6381115">2</span><span class="op" id="6381116">*</span><span class="ident" id="6381117">numEntries</span>&nbsp;<span class="op" id="6381128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381132">return</span>&nbsp;<span class="builtintype" id="6381139">nil</span><span class="op" id="6381142">,</span>&nbsp;<span class="ident" id="6381144">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381159">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381206">sp</span>&nbsp;<span class="op" id="6381209">:=</span>&nbsp;<span class="builtinfunc" id="6381212">make</span><span class="op" id="6381216">(</span><span class="op" id="6381217">[</span><span class="op" id="6381218">]</span><span class="ident" id="6381219">sparseEntry</span><span class="op" id="6381230">,</span>&nbsp;<span class="num" id="6381232">0</span><span class="op" id="6381233">,</span>&nbsp;<span class="ident" id="6381235">numEntries</span><span class="op" id="6381245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381248">for</span>&nbsp;<span class="ident" id="6381252">i</span>&nbsp;<span class="op" id="6381254">:=</span>&nbsp;<span class="ident" id="6381257">int64</span><span class="op" id="6381262">(</span><span class="num" id="6381263">0</span><span class="op" id="6381264">)</span><span class="op" id="6381265">;</span>&nbsp;<span class="ident" id="6381267">i</span>&nbsp;<span class="op" id="6381269">&lt;</span>&nbsp;<span class="ident" id="6381271">numEntries</span><span class="op" id="6381281">;</span>&nbsp;<span class="ident" id="6381283">i</span><span class="op" id="6381284">++</span>&nbsp;<span class="op" id="6381287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381291">offset</span><span class="op" id="6381297">,</span>&nbsp;<span class="ident" id="6381299">err</span>&nbsp;<span class="op" id="6381303">:=</span>&nbsp;<span class="ident" id="6381306">strconv</span><span class="op" id="6381313">.</span><span class="ident" id="6381314">ParseInt</span><span class="op" id="6381322">(</span><span class="ident" id="6381323">sparseMap</span><span class="op" id="6381332">[</span><span class="num" id="6381333">2</span><span class="op" id="6381334">*</span><span class="ident" id="6381335">i</span><span class="op" id="6381336">]</span><span class="op" id="6381337">,</span>&nbsp;<span class="num" id="6381339">10</span><span class="op" id="6381341">,</span>&nbsp;<span class="num" id="6381343">0</span><span class="op" id="6381344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381348">if</span>&nbsp;<span class="ident" id="6381351">err</span>&nbsp;<span class="op" id="6381355">!=</span>&nbsp;<span class="builtintype" id="6381358">nil</span>&nbsp;<span class="op" id="6381362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381367">return</span>&nbsp;<span class="builtintype" id="6381374">nil</span><span class="op" id="6381377">,</span>&nbsp;<span class="ident" id="6381379">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381395">numBytes</span><span class="op" id="6381403">,</span>&nbsp;<span class="ident" id="6381405">err</span>&nbsp;<span class="op" id="6381409">:=</span>&nbsp;<span class="ident" id="6381412">strconv</span><span class="op" id="6381419">.</span><span class="ident" id="6381420">ParseInt</span><span class="op" id="6381428">(</span><span class="ident" id="6381429">sparseMap</span><span class="op" id="6381438">[</span><span class="num" id="6381439">2</span><span class="op" id="6381440">*</span><span class="ident" id="6381441">i</span><span class="op" id="6381442">+</span><span class="num" id="6381443">1</span><span class="op" id="6381444">]</span><span class="op" id="6381445">,</span>&nbsp;<span class="num" id="6381447">10</span><span class="op" id="6381449">,</span>&nbsp;<span class="num" id="6381451">0</span><span class="op" id="6381452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381456">if</span>&nbsp;<span class="ident" id="6381459">err</span>&nbsp;<span class="op" id="6381463">!=</span>&nbsp;<span class="builtintype" id="6381466">nil</span>&nbsp;<span class="op" id="6381470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381475">return</span>&nbsp;<span class="builtintype" id="6381482">nil</span><span class="op" id="6381485">,</span>&nbsp;<span class="ident" id="6381487">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381499">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381503">sp</span>&nbsp;<span class="op" id="6381506">=</span>&nbsp;<span class="builtinfunc" id="6381508">append</span><span class="op" id="6381514">(</span><span class="ident" id="6381515">sp</span><span class="op" id="6381517">,</span>&nbsp;<span class="ident" id="6381519">sparseEntry</span><span class="op" id="6381530">{</span><span class="ident" id="6381531">offset</span><span class="op" id="6381537">:</span>&nbsp;<span class="ident" id="6381539">offset</span><span class="op" id="6381545">,</span>&nbsp;<span class="ident" id="6381547">numBytes</span><span class="op" id="6381555">:</span>&nbsp;<span class="ident" id="6381557">numBytes</span><span class="op" id="6381565">}</span><span class="op" id="6381566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381573">return</span>&nbsp;<span class="ident" id="6381580">sp</span><span class="op" id="6381582">,</span>&nbsp;<span class="builtintype" id="6381584">nil</span><br>
<span class="lineno"></span><span class="op" id="6381588">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="6381591">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="6381672">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6381729">func</span>&nbsp;<span class="op" id="6381734">(</span><span class="ident" id="6381735">tr</span>&nbsp;<span class="op" id="6381738">*</span><span class="ident" id="6381739">Reader</span><span class="op" id="6381745">)</span>&nbsp;<span class="ident" id="6381747">numBytes</span><span class="op" id="6381755">(</span><span class="op" id="6381756">)</span>&nbsp;<span class="ident" id="6381758">int64</span>&nbsp;<span class="op" id="6381764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381767">if</span>&nbsp;<span class="ident" id="6381770">tr</span><span class="op" id="6381772">.</span><span class="ident" id="6381773">curr</span>&nbsp;<span class="op" id="6381778">==</span>&nbsp;<span class="builtintype" id="6381781">nil</span>&nbsp;<span class="op" id="6381785">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381789">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381823">return</span>&nbsp;<span class="num" id="6381830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381836">return</span>&nbsp;<span class="ident" id="6381843">tr</span><span class="op" id="6381845">.</span><span class="ident" id="6381846">curr</span><span class="op" id="6381850">.</span><span class="ident" id="6381851">numBytes</span><span class="op" id="6381859">(</span><span class="op" id="6381860">)</span><br>
<span class="lineno"></span><span class="op" id="6381862">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="6381865">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6381922">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="6381985">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="6382039">func</span>&nbsp;<span class="op" id="6382044">(</span><span class="ident" id="6382045">tr</span>&nbsp;<span class="op" id="6382048">*</span><span class="ident" id="6382049">Reader</span><span class="op" id="6382055">)</span>&nbsp;<span class="ident" id="6382057">Read</span><span class="op" id="6382061">(</span><span class="ident" id="6382062">b</span>&nbsp;<span class="op" id="6382064">[</span><span class="op" id="6382065">]</span><span class="builtintype" id="6382066">byte</span><span class="op" id="6382070">)</span>&nbsp;<span class="op" id="6382072">(</span><span class="ident" id="6382073">n</span>&nbsp;<span class="builtintype" id="6382075">int</span><span class="op" id="6382078">,</span>&nbsp;<span class="ident" id="6382080">err</span>&nbsp;<span class="builtintype" id="6382084">error</span><span class="op" id="6382089">)</span>&nbsp;<span class="op" id="6382091">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382094">if</span>&nbsp;<span class="ident" id="6382097">tr</span><span class="op" id="6382099">.</span><span class="ident" id="6382100">curr</span>&nbsp;<span class="op" id="6382105">==</span>&nbsp;<span class="builtintype" id="6382108">nil</span>&nbsp;<span class="op" id="6382112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382116">return</span>&nbsp;<span class="num" id="6382123">0</span><span class="op" id="6382124">,</span>&nbsp;<span class="ident" id="6382126">io</span><span class="op" id="6382128">.</span><span class="ident" id="6382129">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382137">n</span><span class="op" id="6382138">,</span>&nbsp;<span class="ident" id="6382140">err</span>&nbsp;<span class="op" id="6382144">=</span>&nbsp;<span class="ident" id="6382146">tr</span><span class="op" id="6382148">.</span><span class="ident" id="6382149">curr</span><span class="op" id="6382153">.</span><span class="ident" id="6382154">Read</span><span class="op" id="6382158">(</span><span class="ident" id="6382159">b</span><span class="op" id="6382160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382163">if</span>&nbsp;<span class="ident" id="6382166">err</span>&nbsp;<span class="op" id="6382170">!=</span>&nbsp;<span class="builtintype" id="6382173">nil</span>&nbsp;<span class="op" id="6382177">&amp;&amp;</span>&nbsp;<span class="ident" id="6382180">err</span>&nbsp;<span class="op" id="6382184">!=</span>&nbsp;<span class="ident" id="6382187">io</span><span class="op" id="6382189">.</span><span class="ident" id="6382190">EOF</span>&nbsp;<span class="op" id="6382194">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382198">tr</span><span class="op" id="6382200">.</span><span class="ident" id="6382201">err</span>&nbsp;<span class="op" id="6382205">=</span>&nbsp;<span class="ident" id="6382207">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382215">return</span><br>
<span class="lineno"></span><span class="op" id="6382222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="6382225">func</span>&nbsp;<span class="op" id="6382230">(</span><span class="ident" id="6382231">rfr</span>&nbsp;<span class="op" id="6382235">*</span><span class="ident" id="6382236">regFileReader</span><span class="op" id="6382249">)</span>&nbsp;<span class="ident" id="6382251">Read</span><span class="op" id="6382255">(</span><span class="ident" id="6382256">b</span>&nbsp;<span class="op" id="6382258">[</span><span class="op" id="6382259">]</span><span class="builtintype" id="6382260">byte</span><span class="op" id="6382264">)</span>&nbsp;<span class="op" id="6382266">(</span><span class="ident" id="6382267">n</span>&nbsp;<span class="builtintype" id="6382269">int</span><span class="op" id="6382272">,</span>&nbsp;<span class="ident" id="6382274">err</span>&nbsp;<span class="builtintype" id="6382278">error</span><span class="op" id="6382283">)</span>&nbsp;<span class="op" id="6382285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382288">if</span>&nbsp;<span class="ident" id="6382291">rfr</span><span class="op" id="6382294">.</span><span class="ident" id="6382295">nb</span>&nbsp;<span class="op" id="6382298">==</span>&nbsp;<span class="num" id="6382301">0</span>&nbsp;<span class="op" id="6382303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6382307">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382326">return</span>&nbsp;<span class="num" id="6382333">0</span><span class="op" id="6382334">,</span>&nbsp;<span class="ident" id="6382336">io</span><span class="op" id="6382338">.</span><span class="ident" id="6382339">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382344">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382347">if</span>&nbsp;<span class="ident" id="6382350">int64</span><span class="op" id="6382355">(</span><span class="builtinfunc" id="6382356">len</span><span class="op" id="6382359">(</span><span class="ident" id="6382360">b</span><span class="op" id="6382361">)</span><span class="op" id="6382362">)</span>&nbsp;<span class="op" id="6382364">&gt;</span>&nbsp;<span class="ident" id="6382366">rfr</span><span class="op" id="6382369">.</span><span class="ident" id="6382370">nb</span>&nbsp;<span class="op" id="6382373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382377">b</span>&nbsp;<span class="op" id="6382379">=</span>&nbsp;<span class="ident" id="6382381">b</span><span class="op" id="6382382">[</span><span class="num" id="6382383">0</span><span class="op" id="6382384">:</span><span class="ident" id="6382385">rfr</span><span class="op" id="6382388">.</span><span class="ident" id="6382389">nb</span><span class="op" id="6382391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382397">n</span><span class="op" id="6382398">,</span>&nbsp;<span class="ident" id="6382400">err</span>&nbsp;<span class="op" id="6382404">=</span>&nbsp;<span class="ident" id="6382406">rfr</span><span class="op" id="6382409">.</span><span class="ident" id="6382410">r</span><span class="op" id="6382411">.</span><span class="ident" id="6382412">Read</span><span class="op" id="6382416">(</span><span class="ident" id="6382417">b</span><span class="op" id="6382418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382421">rfr</span><span class="op" id="6382424">.</span><span class="ident" id="6382425">nb</span>&nbsp;<span class="op" id="6382428">-=</span>&nbsp;<span class="ident" id="6382431">int64</span><span class="op" id="6382436">(</span><span class="ident" id="6382437">n</span><span class="op" id="6382438">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382442">if</span>&nbsp;<span class="ident" id="6382445">err</span>&nbsp;<span class="op" id="6382449">==</span>&nbsp;<span class="ident" id="6382452">io</span><span class="op" id="6382454">.</span><span class="ident" id="6382455">EOF</span>&nbsp;<span class="op" id="6382459">&amp;&amp;</span>&nbsp;<span class="ident" id="6382462">rfr</span><span class="op" id="6382465">.</span><span class="ident" id="6382466">nb</span>&nbsp;<span class="op" id="6382469">&gt;</span>&nbsp;<span class="num" id="6382471">0</span>&nbsp;<span class="op" id="6382473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382477">err</span>&nbsp;<span class="op" id="6382481">=</span>&nbsp;<span class="ident" id="6382483">io</span><span class="op" id="6382485">.</span><span class="ident" id="6382486">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382507">return</span><br>
<span class="lineno">755</span><span class="op" id="6382514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6382517">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6382609">func</span>&nbsp;<span class="op" id="6382614">(</span><span class="ident" id="6382615">rfr</span>&nbsp;<span class="op" id="6382619">*</span><span class="ident" id="6382620">regFileReader</span><span class="op" id="6382633">)</span>&nbsp;<span class="ident" id="6382635">numBytes</span><span class="op" id="6382643">(</span><span class="op" id="6382644">)</span>&nbsp;<span class="ident" id="6382646">int64</span>&nbsp;<span class="op" id="6382652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382655">return</span>&nbsp;<span class="ident" id="6382662">rfr</span><span class="op" id="6382665">.</span><span class="ident" id="6382666">nb</span><br>
<span class="lineno">760</span><span class="op" id="6382669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6382672">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="6382735">func</span>&nbsp;<span class="op" id="6382740">(</span><span class="ident" id="6382741">sfr</span>&nbsp;<span class="op" id="6382745">*</span><span class="ident" id="6382746">sparseFileReader</span><span class="op" id="6382762">)</span>&nbsp;<span class="ident" id="6382764">readHole</span><span class="op" id="6382772">(</span><span class="ident" id="6382773">b</span>&nbsp;<span class="op" id="6382775">[</span><span class="op" id="6382776">]</span><span class="builtintype" id="6382777">byte</span><span class="op" id="6382781">,</span>&nbsp;<span class="ident" id="6382783">toOffset</span>&nbsp;<span class="ident" id="6382792">int64</span><span class="op" id="6382797">)</span>&nbsp;<span class="builtintype" id="6382799">int</span>&nbsp;<span class="op" id="6382803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382806">n64</span>&nbsp;<span class="op" id="6382810">:=</span>&nbsp;<span class="ident" id="6382813">toOffset</span>&nbsp;<span class="op" id="6382822">-</span>&nbsp;<span class="ident" id="6382824">sfr</span><span class="op" id="6382827">.</span><span class="ident" id="6382828">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382833">if</span>&nbsp;<span class="ident" id="6382836">n64</span>&nbsp;<span class="op" id="6382840">&gt;</span>&nbsp;<span class="ident" id="6382842">int64</span><span class="op" id="6382847">(</span><span class="builtinfunc" id="6382848">len</span><span class="op" id="6382851">(</span><span class="ident" id="6382852">b</span><span class="op" id="6382853">)</span><span class="op" id="6382854">)</span>&nbsp;<span class="op" id="6382856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382860">n64</span>&nbsp;<span class="op" id="6382864">=</span>&nbsp;<span class="ident" id="6382866">int64</span><span class="op" id="6382871">(</span><span class="builtinfunc" id="6382872">len</span><span class="op" id="6382875">(</span><span class="ident" id="6382876">b</span><span class="op" id="6382877">)</span><span class="op" id="6382878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382884">n</span>&nbsp;<span class="op" id="6382886">:=</span>&nbsp;<span class="builtintype" id="6382889">int</span><span class="op" id="6382892">(</span><span class="ident" id="6382893">n64</span><span class="op" id="6382896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382899">for</span>&nbsp;<span class="ident" id="6382903">i</span>&nbsp;<span class="op" id="6382905">:=</span>&nbsp;<span class="num" id="6382908">0</span><span class="op" id="6382909">;</span>&nbsp;<span class="ident" id="6382911">i</span>&nbsp;<span class="op" id="6382913">&lt;</span>&nbsp;<span class="ident" id="6382915">n</span><span class="op" id="6382916">;</span>&nbsp;<span class="ident" id="6382918">i</span><span class="op" id="6382919">++</span>&nbsp;<span class="op" id="6382922">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382926">b</span><span class="op" id="6382927">[</span><span class="ident" id="6382928">i</span><span class="op" id="6382929">]</span>&nbsp;<span class="op" id="6382931">=</span>&nbsp;<span class="num" id="6382933">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382939">sfr</span><span class="op" id="6382942">.</span><span class="ident" id="6382943">pos</span>&nbsp;<span class="op" id="6382947">+=</span>&nbsp;<span class="ident" id="6382950">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382955">return</span>&nbsp;<span class="ident" id="6382962">n</span><br>
<span class="lineno"></span><span class="op" id="6382964">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="6382967">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="6383020">func</span>&nbsp;<span class="op" id="6383025">(</span><span class="ident" id="6383026">sfr</span>&nbsp;<span class="op" id="6383030">*</span><span class="ident" id="6383031">sparseFileReader</span><span class="op" id="6383047">)</span>&nbsp;<span class="ident" id="6383049">Read</span><span class="op" id="6383053">(</span><span class="ident" id="6383054">b</span>&nbsp;<span class="op" id="6383056">[</span><span class="op" id="6383057">]</span><span class="builtintype" id="6383058">byte</span><span class="op" id="6383062">)</span>&nbsp;<span class="op" id="6383064">(</span><span class="ident" id="6383065">n</span>&nbsp;<span class="builtintype" id="6383067">int</span><span class="op" id="6383070">,</span>&nbsp;<span class="ident" id="6383072">err</span>&nbsp;<span class="builtintype" id="6383076">error</span><span class="op" id="6383081">)</span>&nbsp;<span class="op" id="6383083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383086">if</span>&nbsp;<span class="builtinfunc" id="6383089">len</span><span class="op" id="6383092">(</span><span class="ident" id="6383093">sfr</span><span class="op" id="6383096">.</span><span class="ident" id="6383097">sp</span><span class="op" id="6383099">)</span>&nbsp;<span class="op" id="6383101">==</span>&nbsp;<span class="num" id="6383104">0</span>&nbsp;<span class="op" id="6383106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6383110">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383152">if</span>&nbsp;<span class="ident" id="6383155">sfr</span><span class="op" id="6383158">.</span><span class="ident" id="6383159">pos</span>&nbsp;<span class="op" id="6383163">&lt;</span>&nbsp;<span class="ident" id="6383165">sfr</span><span class="op" id="6383168">.</span><span class="ident" id="6383169">tot</span>&nbsp;<span class="op" id="6383173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6383178">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383207">n</span>&nbsp;<span class="op" id="6383209">=</span>&nbsp;<span class="ident" id="6383211">sfr</span><span class="op" id="6383214">.</span><span class="ident" id="6383215">readHole</span><span class="op" id="6383223">(</span><span class="ident" id="6383224">b</span><span class="op" id="6383225">,</span>&nbsp;<span class="ident" id="6383227">sfr</span><span class="op" id="6383230">.</span><span class="ident" id="6383231">tot</span><span class="op" id="6383234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383239">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6383248">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6383252">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383297">return</span>&nbsp;<span class="num" id="6383304">0</span><span class="op" id="6383305">,</span>&nbsp;<span class="ident" id="6383307">io</span><span class="op" id="6383309">.</span><span class="ident" id="6383310">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6383315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383318">if</span>&nbsp;<span class="ident" id="6383321">sfr</span><span class="op" id="6383324">.</span><span class="ident" id="6383325">pos</span>&nbsp;<span class="op" id="6383329">&lt;</span>&nbsp;<span class="ident" id="6383331">sfr</span><span class="op" id="6383334">.</span><span class="ident" id="6383335">sp</span><span class="op" id="6383337">[</span><span class="num" id="6383338">0</span><span class="op" id="6383339">]</span><span class="op" id="6383340">.</span><span class="ident" id="6383341">offset</span>&nbsp;<span class="op" id="6383348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6383352">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383373">n</span>&nbsp;<span class="op" id="6383375">=</span>&nbsp;<span class="ident" id="6383377">sfr</span><span class="op" id="6383380">.</span><span class="ident" id="6383381">readHole</span><span class="op" id="6383389">(</span><span class="ident" id="6383390">b</span><span class="op" id="6383391">,</span>&nbsp;<span class="ident" id="6383393">sfr</span><span class="op" id="6383396">.</span><span class="ident" id="6383397">sp</span><span class="op" id="6383399">[</span><span class="num" id="6383400">0</span><span class="op" id="6383401">]</span><span class="op" id="6383402">.</span><span class="ident" id="6383403">offset</span><span class="op" id="6383409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6383421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6383425">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383492">posInFragment</span>&nbsp;<span class="op" id="6383506">:=</span>&nbsp;<span class="ident" id="6383509">sfr</span><span class="op" id="6383512">.</span><span class="ident" id="6383513">pos</span>&nbsp;<span class="op" id="6383517">-</span>&nbsp;<span class="ident" id="6383519">sfr</span><span class="op" id="6383522">.</span><span class="ident" id="6383523">sp</span><span class="op" id="6383525">[</span><span class="num" id="6383526">0</span><span class="op" id="6383527">]</span><span class="op" id="6383528">.</span><span class="ident" id="6383529">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383537">bytesLeft</span>&nbsp;<span class="op" id="6383547">:=</span>&nbsp;<span class="ident" id="6383550">sfr</span><span class="op" id="6383553">.</span><span class="ident" id="6383554">sp</span><span class="op" id="6383556">[</span><span class="num" id="6383557">0</span><span class="op" id="6383558">]</span><span class="op" id="6383559">.</span><span class="ident" id="6383560">numBytes</span>&nbsp;<span class="op" id="6383569">-</span>&nbsp;<span class="ident" id="6383571">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383586">if</span>&nbsp;<span class="ident" id="6383589">int64</span><span class="op" id="6383594">(</span><span class="builtinfunc" id="6383595">len</span><span class="op" id="6383598">(</span><span class="ident" id="6383599">b</span><span class="op" id="6383600">)</span><span class="op" id="6383601">)</span>&nbsp;<span class="op" id="6383603">&gt;</span>&nbsp;<span class="ident" id="6383605">bytesLeft</span>&nbsp;<span class="op" id="6383615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383619">b</span>&nbsp;<span class="op" id="6383621">=</span>&nbsp;<span class="ident" id="6383623">b</span><span class="op" id="6383624">[</span><span class="num" id="6383625">0</span><span class="op" id="6383626">:</span><span class="ident" id="6383627">bytesLeft</span><span class="op" id="6383636">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6383639">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383643">n</span><span class="op" id="6383644">,</span>&nbsp;<span class="ident" id="6383646">err</span>&nbsp;<span class="op" id="6383650">=</span>&nbsp;<span class="ident" id="6383652">sfr</span><span class="op" id="6383655">.</span><span class="ident" id="6383656">rfr</span><span class="op" id="6383659">.</span><span class="ident" id="6383660">Read</span><span class="op" id="6383664">(</span><span class="ident" id="6383665">b</span><span class="op" id="6383666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383669">sfr</span><span class="op" id="6383672">.</span><span class="ident" id="6383673">pos</span>&nbsp;<span class="op" id="6383677">+=</span>&nbsp;<span class="ident" id="6383680">int64</span><span class="op" id="6383685">(</span><span class="ident" id="6383686">n</span><span class="op" id="6383687">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383691">if</span>&nbsp;<span class="ident" id="6383694">int64</span><span class="op" id="6383699">(</span><span class="ident" id="6383700">n</span><span class="op" id="6383701">)</span>&nbsp;<span class="op" id="6383703">==</span>&nbsp;<span class="ident" id="6383706">bytesLeft</span>&nbsp;<span class="op" id="6383716">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6383720">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383755">sfr</span><span class="op" id="6383758">.</span><span class="ident" id="6383759">sp</span>&nbsp;<span class="op" id="6383762">=</span>&nbsp;<span class="ident" id="6383764">sfr</span><span class="op" id="6383767">.</span><span class="ident" id="6383768">sp</span><span class="op" id="6383770">[</span><span class="num" id="6383771">1</span><span class="op" id="6383772">:</span><span class="op" id="6383773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6383776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383780">if</span>&nbsp;<span class="ident" id="6383783">err</span>&nbsp;<span class="op" id="6383787">==</span>&nbsp;<span class="ident" id="6383790">io</span><span class="op" id="6383792">.</span><span class="ident" id="6383793">EOF</span>&nbsp;<span class="op" id="6383797">&amp;&amp;</span>&nbsp;<span class="ident" id="6383800">sfr</span><span class="op" id="6383803">.</span><span class="ident" id="6383804">pos</span>&nbsp;<span class="op" id="6383808">&lt;</span>&nbsp;<span class="ident" id="6383810">sfr</span><span class="op" id="6383813">.</span><span class="ident" id="6383814">tot</span>&nbsp;<span class="op" id="6383818">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6383822">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383900">err</span>&nbsp;<span class="op" id="6383904">=</span>&nbsp;<span class="builtintype" id="6383906">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6383911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383914">return</span><br>
<span class="lineno"></span><span class="op" id="6383921">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="6383924">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6383998">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6384041">func</span>&nbsp;<span class="op" id="6384046">(</span><span class="ident" id="6384047">sfr</span>&nbsp;<span class="op" id="6384051">*</span><span class="ident" id="6384052">sparseFileReader</span><span class="op" id="6384068">)</span>&nbsp;<span class="ident" id="6384070">numBytes</span><span class="op" id="6384078">(</span><span class="op" id="6384079">)</span>&nbsp;<span class="ident" id="6384081">int64</span>&nbsp;<span class="op" id="6384087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384090">return</span>&nbsp;<span class="ident" id="6384097">sfr</span><span class="op" id="6384100">.</span><span class="ident" id="6384101">rfr</span><span class="op" id="6384104">.</span><span class="ident" id="6384105">nb</span><br>
<span class="lineno">820</span><span class="op" id="6384108">}</span>
</div>
</body>
</html>
