<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html" class="current">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6097634">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6097689">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6097743">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6097794">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="6098303">package</span>&nbsp;<span class="ident" id="6098311">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6098316">import</span>&nbsp;<span class="op" id="6098323">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6098326">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6098332">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6098340">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6098347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6098350">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6098374">const</span>&nbsp;<span class="op" id="6098380">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098383">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6098391">uint16</span>&nbsp;<span class="op" id="6098398">=</span>&nbsp;<span class="num" id="6098400">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098403">Deflate</span>&nbsp;<span class="builtintype" id="6098411">uint16</span>&nbsp;<span class="op" id="6098418">=</span>&nbsp;<span class="num" id="6098420">8</span><br>
<span class="lineno"></span><span class="op" id="6098422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6098425">const</span>&nbsp;<span class="op" id="6098431">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098434">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6098459">=</span>&nbsp;<span class="num" id="6098461">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098473">directoryHeaderSignature</span>&nbsp;<span class="op" id="6098498">=</span>&nbsp;<span class="num" id="6098500">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098512">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6098537">=</span>&nbsp;<span class="num" id="6098539">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098551">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="6098576">=</span>&nbsp;<span class="num" id="6098578">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098590">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="6098615">=</span>&nbsp;<span class="num" id="6098617">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098629">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="6098654">=</span>&nbsp;<span class="num" id="6098656">0x08074b50</span>&nbsp;<span class="comment" id="6098667">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098714">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6098739">=</span>&nbsp;<span class="num" id="6098741">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6098752">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098775">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6098800">=</span>&nbsp;<span class="num" id="6098802">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6098813">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098846">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6098871">=</span>&nbsp;<span class="num" id="6098873">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6098884">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6098898">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6098923">=</span>&nbsp;<span class="num" id="6098925">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6098936">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099004">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6099029">=</span>&nbsp;<span class="num" id="6099031">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099042">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099075">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6099100">=</span>&nbsp;<span class="num" id="6099102">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099113">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099117">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6099142">=</span>&nbsp;<span class="num" id="6099144">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099155">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099168">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099219">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6099233">=</span>&nbsp;<span class="num" id="6099235">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099238">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6099252">=</span>&nbsp;<span class="num" id="6099254">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099257">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6099271">=</span>&nbsp;<span class="num" id="6099273">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099277">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6099291">=</span>&nbsp;<span class="num" id="6099293">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099297">creatorMacOSX</span>&nbsp;<span class="op" id="6099311">=</span>&nbsp;<span class="num" id="6099313">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099318">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099338">zipVersion20</span>&nbsp;<span class="op" id="6099351">=</span>&nbsp;<span class="num" id="6099353">20</span>&nbsp;<span class="comment" id="6099356">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099364">zipVersion45</span>&nbsp;<span class="op" id="6099377">=</span>&nbsp;<span class="num" id="6099379">45</span>&nbsp;<span class="comment" id="6099382">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099425">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099456">uint16max</span>&nbsp;<span class="op" id="6099466">=</span>&nbsp;<span class="op" id="6099468">(</span><span class="num" id="6099469">1</span>&nbsp;<span class="op" id="6099471">&lt;&lt;</span>&nbsp;<span class="num" id="6099474">16</span><span class="op" id="6099476">)</span>&nbsp;<span class="op" id="6099478">-</span>&nbsp;<span class="num" id="6099480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099483">uint32max</span>&nbsp;<span class="op" id="6099493">=</span>&nbsp;<span class="op" id="6099495">(</span><span class="num" id="6099496">1</span>&nbsp;<span class="op" id="6099498">&lt;&lt;</span>&nbsp;<span class="num" id="6099501">32</span><span class="op" id="6099503">)</span>&nbsp;<span class="op" id="6099505">-</span>&nbsp;<span class="num" id="6099507">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099511">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099533">zip64ExtraId</span>&nbsp;<span class="op" id="6099546">=</span>&nbsp;<span class="num" id="6099548">0x0001</span>&nbsp;<span class="comment" id="6099555">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="6099597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6099600">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6099650">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="6099683">type</span>&nbsp;<span class="ident" id="6099688">FileHeader</span>&nbsp;<span class="keyword" id="6099699">struct</span>&nbsp;<span class="op" id="6099706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099709">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099743">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099806">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6099870">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099887">Name</span>&nbsp;<span class="builtintype" id="6099892">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099901">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6099920">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099928">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6099947">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099955">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6099974">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6099982">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100001">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100009">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100028">uint16</span>&nbsp;<span class="comment" id="6100035">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100051">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100070">uint16</span>&nbsp;<span class="comment" id="6100077">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100093">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100112">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100120">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100139">uint32</span>&nbsp;<span class="comment" id="6100146">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100183">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100202">uint32</span>&nbsp;<span class="comment" id="6100209">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100248">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6100267">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100275">UncompressedSize64</span>&nbsp;<span class="ident" id="6100294">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100302">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6100321">[</span><span class="op" id="6100322">]</span><span class="builtintype" id="6100323">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100329">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100348">uint32</span>&nbsp;<span class="comment" id="6100355">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100393">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6100412">string</span><br>
<span class="lineno"></span><span class="op" id="6100419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6100422">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6100477">func</span>&nbsp;<span class="op" id="6100482">(</span><span class="ident" id="6100483">h</span>&nbsp;<span class="op" id="6100485">*</span><span class="ident" id="6100486">FileHeader</span><span class="op" id="6100496">)</span>&nbsp;<span class="ident" id="6100498">FileInfo</span><span class="op" id="6100506">(</span><span class="op" id="6100507">)</span>&nbsp;<span class="ident" id="6100509">os</span><span class="op" id="6100511">.</span><span class="ident" id="6100512">FileInfo</span>&nbsp;<span class="op" id="6100521">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6100524">return</span>&nbsp;<span class="ident" id="6100531">headerFileInfo</span><span class="op" id="6100545">{</span><span class="ident" id="6100546">h</span><span class="op" id="6100547">}</span><br>
<span class="lineno"></span><span class="op" id="6100549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6100552">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6100594">type</span>&nbsp;<span class="ident" id="6100599">headerFileInfo</span>&nbsp;<span class="keyword" id="6100614">struct</span>&nbsp;<span class="op" id="6100621">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6100624">fh</span>&nbsp;<span class="op" id="6100627">*</span><span class="ident" id="6100628">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="6100639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6100642">func</span>&nbsp;<span class="op" id="6100647">(</span><span class="ident" id="6100648">fi</span>&nbsp;<span class="ident" id="6100651">headerFileInfo</span><span class="op" id="6100665">)</span>&nbsp;<span class="ident" id="6100667">Name</span><span class="op" id="6100671">(</span><span class="op" id="6100672">)</span>&nbsp;<span class="builtintype" id="6100674">string</span>&nbsp;<span class="op" id="6100681">{</span>&nbsp;<span class="keyword" id="6100683">return</span>&nbsp;<span class="ident" id="6100690">path</span><span class="op" id="6100694">.</span><span class="ident" id="6100695">Base</span><span class="op" id="6100699">(</span><span class="ident" id="6100700">fi</span><span class="op" id="6100702">.</span><span class="ident" id="6100703">fh</span><span class="op" id="6100705">.</span><span class="ident" id="6100706">Name</span><span class="op" id="6100710">)</span>&nbsp;<span class="op" id="6100712">}</span><br>
<span class="lineno"></span><span class="keyword" id="6100714">func</span>&nbsp;<span class="op" id="6100719">(</span><span class="ident" id="6100720">fi</span>&nbsp;<span class="ident" id="6100723">headerFileInfo</span><span class="op" id="6100737">)</span>&nbsp;<span class="ident" id="6100739">Size</span><span class="op" id="6100743">(</span><span class="op" id="6100744">)</span>&nbsp;<span class="ident" id="6100746">int64</span>&nbsp;<span class="op" id="6100752">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6100755">if</span>&nbsp;<span class="ident" id="6100758">fi</span><span class="op" id="6100760">.</span><span class="ident" id="6100761">fh</span><span class="op" id="6100763">.</span><span class="ident" id="6100764">UncompressedSize64</span>&nbsp;<span class="op" id="6100783">&gt;</span>&nbsp;<span class="num" id="6100785">0</span>&nbsp;<span class="op" id="6100787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6100791">return</span>&nbsp;<span class="ident" id="6100798">int64</span><span class="op" id="6100803">(</span><span class="ident" id="6100804">fi</span><span class="op" id="6100806">.</span><span class="ident" id="6100807">fh</span><span class="op" id="6100809">.</span><span class="ident" id="6100810">UncompressedSize64</span><span class="op" id="6100828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6100831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6100834">return</span>&nbsp;<span class="ident" id="6100841">int64</span><span class="op" id="6100846">(</span><span class="ident" id="6100847">fi</span><span class="op" id="6100849">.</span><span class="ident" id="6100850">fh</span><span class="op" id="6100852">.</span><span class="ident" id="6100853">UncompressedSize</span><span class="op" id="6100869">)</span><br>
<span class="lineno"></span><span class="op" id="6100871">}</span><br>
<span class="lineno">110</span><span class="keyword" id="6100873">func</span>&nbsp;<span class="op" id="6100878">(</span><span class="ident" id="6100879">fi</span>&nbsp;<span class="ident" id="6100882">headerFileInfo</span><span class="op" id="6100896">)</span>&nbsp;<span class="ident" id="6100898">IsDir</span><span class="op" id="6100903">(</span><span class="op" id="6100904">)</span>&nbsp;<span class="builtintype" id="6100906">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6100918">{</span>&nbsp;<span class="keyword" id="6100920">return</span>&nbsp;<span class="ident" id="6100927">fi</span><span class="op" id="6100929">.</span><span class="ident" id="6100930">Mode</span><span class="op" id="6100934">(</span><span class="op" id="6100935">)</span><span class="op" id="6100936">.</span><span class="ident" id="6100937">IsDir</span><span class="op" id="6100942">(</span><span class="op" id="6100943">)</span>&nbsp;<span class="op" id="6100945">}</span><br>
<span class="lineno"></span><span class="keyword" id="6100947">func</span>&nbsp;<span class="op" id="6100952">(</span><span class="ident" id="6100953">fi</span>&nbsp;<span class="ident" id="6100956">headerFileInfo</span><span class="op" id="6100970">)</span>&nbsp;<span class="ident" id="6100972">ModTime</span><span class="op" id="6100979">(</span><span class="op" id="6100980">)</span>&nbsp;<span class="ident" id="6100982">time</span><span class="op" id="6100986">.</span><span class="ident" id="6100987">Time</span>&nbsp;<span class="op" id="6100992">{</span>&nbsp;<span class="keyword" id="6100994">return</span>&nbsp;<span class="ident" id="6101001">fi</span><span class="op" id="6101003">.</span><span class="ident" id="6101004">fh</span><span class="op" id="6101006">.</span><span class="ident" id="6101007">ModTime</span><span class="op" id="6101014">(</span><span class="op" id="6101015">)</span>&nbsp;<span class="op" id="6101017">}</span><br>
<span class="lineno"></span><span class="keyword" id="6101019">func</span>&nbsp;<span class="op" id="6101024">(</span><span class="ident" id="6101025">fi</span>&nbsp;<span class="ident" id="6101028">headerFileInfo</span><span class="op" id="6101042">)</span>&nbsp;<span class="ident" id="6101044">Mode</span><span class="op" id="6101048">(</span><span class="op" id="6101049">)</span>&nbsp;<span class="ident" id="6101051">os</span><span class="op" id="6101053">.</span><span class="ident" id="6101054">FileMode</span>&nbsp;&nbsp;<span class="op" id="6101064">{</span>&nbsp;<span class="keyword" id="6101066">return</span>&nbsp;<span class="ident" id="6101073">fi</span><span class="op" id="6101075">.</span><span class="ident" id="6101076">fh</span><span class="op" id="6101078">.</span><span class="ident" id="6101079">Mode</span><span class="op" id="6101083">(</span><span class="op" id="6101084">)</span>&nbsp;<span class="op" id="6101086">}</span><br>
<span class="lineno"></span><span class="keyword" id="6101088">func</span>&nbsp;<span class="op" id="6101093">(</span><span class="ident" id="6101094">fi</span>&nbsp;<span class="ident" id="6101097">headerFileInfo</span><span class="op" id="6101111">)</span>&nbsp;<span class="ident" id="6101113">Sys</span><span class="op" id="6101116">(</span><span class="op" id="6101117">)</span>&nbsp;<span class="keyword" id="6101119">interface</span><span class="op" id="6101128">{</span><span class="op" id="6101129">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6101133">{</span>&nbsp;<span class="keyword" id="6101135">return</span>&nbsp;<span class="ident" id="6101142">fi</span><span class="op" id="6101144">.</span><span class="ident" id="6101145">fh</span>&nbsp;<span class="op" id="6101148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6101151">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6101218">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="6101234">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6101301">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6101372">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="6101441">func</span>&nbsp;<span class="ident" id="6101446">FileInfoHeader</span><span class="op" id="6101460">(</span><span class="ident" id="6101461">fi</span>&nbsp;<span class="ident" id="6101464">os</span><span class="op" id="6101466">.</span><span class="ident" id="6101467">FileInfo</span><span class="op" id="6101475">)</span>&nbsp;<span class="op" id="6101477">(</span><span class="op" id="6101478">*</span><span class="ident" id="6101479">FileHeader</span><span class="op" id="6101489">,</span>&nbsp;<span class="builtintype" id="6101491">error</span><span class="op" id="6101496">)</span>&nbsp;<span class="op" id="6101498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101501">size</span>&nbsp;<span class="op" id="6101506">:=</span>&nbsp;<span class="ident" id="6101509">fi</span><span class="op" id="6101511">.</span><span class="ident" id="6101512">Size</span><span class="op" id="6101516">(</span><span class="op" id="6101517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101520">fh</span>&nbsp;<span class="op" id="6101523">:=</span>&nbsp;<span class="op" id="6101526">&amp;</span><span class="ident" id="6101527">FileHeader</span><span class="op" id="6101537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101541">Name</span><span class="op" id="6101545">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101561">fi</span><span class="op" id="6101563">.</span><span class="ident" id="6101564">Name</span><span class="op" id="6101568">(</span><span class="op" id="6101569">)</span><span class="op" id="6101570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101574">UncompressedSize64</span><span class="op" id="6101592">:</span>&nbsp;<span class="ident" id="6101594">uint64</span><span class="op" id="6101600">(</span><span class="ident" id="6101601">size</span><span class="op" id="6101605">)</span><span class="op" id="6101606">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6101609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101612">fh</span><span class="op" id="6101614">.</span><span class="ident" id="6101615">SetModTime</span><span class="op" id="6101625">(</span><span class="ident" id="6101626">fi</span><span class="op" id="6101628">.</span><span class="ident" id="6101629">ModTime</span><span class="op" id="6101636">(</span><span class="op" id="6101637">)</span><span class="op" id="6101638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101641">fh</span><span class="op" id="6101643">.</span><span class="ident" id="6101644">SetMode</span><span class="op" id="6101651">(</span><span class="ident" id="6101652">fi</span><span class="op" id="6101654">.</span><span class="ident" id="6101655">Mode</span><span class="op" id="6101659">(</span><span class="op" id="6101660">)</span><span class="op" id="6101661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6101664">if</span>&nbsp;<span class="ident" id="6101667">fh</span><span class="op" id="6101669">.</span><span class="ident" id="6101670">UncompressedSize64</span>&nbsp;<span class="op" id="6101689">&gt;</span>&nbsp;<span class="ident" id="6101691">uint32max</span>&nbsp;<span class="op" id="6101701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101705">fh</span><span class="op" id="6101707">.</span><span class="ident" id="6101708">UncompressedSize</span>&nbsp;<span class="op" id="6101725">=</span>&nbsp;<span class="ident" id="6101727">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6101738">}</span>&nbsp;<span class="keyword" id="6101740">else</span>&nbsp;<span class="op" id="6101745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101749">fh</span><span class="op" id="6101751">.</span><span class="ident" id="6101752">UncompressedSize</span>&nbsp;<span class="op" id="6101769">=</span>&nbsp;<span class="builtintype" id="6101771">uint32</span><span class="op" id="6101777">(</span><span class="ident" id="6101778">fh</span><span class="op" id="6101780">.</span><span class="ident" id="6101781">UncompressedSize64</span><span class="op" id="6101799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6101802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6101805">return</span>&nbsp;<span class="ident" id="6101812">fh</span><span class="op" id="6101814">,</span>&nbsp;<span class="ident" id="6101816">nil</span><br>
<span class="lineno"></span><span class="op" id="6101820">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6101823">type</span>&nbsp;<span class="ident" id="6101828">directoryEnd</span>&nbsp;<span class="keyword" id="6101841">struct</span>&nbsp;<span class="op" id="6101848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101851">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6101870">uint32</span>&nbsp;<span class="comment" id="6101877">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101888">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6101907">uint32</span>&nbsp;<span class="comment" id="6101914">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101925">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="6101944">uint64</span>&nbsp;<span class="comment" id="6101951">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101962">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6101981">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6101989">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102008">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102016">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102035">uint64</span>&nbsp;<span class="comment" id="6102042">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102063">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6102082">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102090">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6102109">string</span><br>
<span class="lineno">145</span><span class="op" id="6102116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6102119">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="6102189">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6102214">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="6102285">func</span>&nbsp;<span class="ident" id="6102290">msDosTimeToTime</span><span class="op" id="6102305">(</span><span class="ident" id="6102306">dosDate</span><span class="op" id="6102313">,</span>&nbsp;<span class="ident" id="6102315">dosTime</span>&nbsp;<span class="builtintype" id="6102323">uint16</span><span class="op" id="6102329">)</span>&nbsp;<span class="ident" id="6102331">time</span><span class="op" id="6102335">.</span><span class="ident" id="6102336">Time</span>&nbsp;<span class="op" id="6102341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6102344">return</span>&nbsp;<span class="ident" id="6102351">time</span><span class="op" id="6102355">.</span><span class="ident" id="6102356">Date</span><span class="op" id="6102360">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6102364">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6102433">int</span><span class="op" id="6102436">(</span><span class="ident" id="6102437">dosDate</span><span class="op" id="6102444">&gt;&gt;</span><span class="num" id="6102446">9</span><span class="op" id="6102447">+</span><span class="num" id="6102448">1980</span><span class="op" id="6102452">)</span><span class="op" id="6102453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102457">time</span><span class="op" id="6102461">.</span><span class="ident" id="6102462">Month</span><span class="op" id="6102467">(</span><span class="ident" id="6102468">dosDate</span><span class="op" id="6102475">&gt;&gt;</span><span class="num" id="6102477">5</span><span class="op" id="6102478">&amp;</span><span class="num" id="6102479">0xf</span><span class="op" id="6102482">)</span><span class="op" id="6102483">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6102487">int</span><span class="op" id="6102490">(</span><span class="ident" id="6102491">dosDate</span><span class="op" id="6102498">&amp;</span><span class="num" id="6102499">0x1f</span><span class="op" id="6102503">)</span><span class="op" id="6102504">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6102509">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6102565">int</span><span class="op" id="6102568">(</span><span class="ident" id="6102569">dosTime</span><span class="op" id="6102576">&gt;&gt;</span><span class="num" id="6102578">11</span><span class="op" id="6102580">)</span><span class="op" id="6102581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6102585">int</span><span class="op" id="6102588">(</span><span class="ident" id="6102589">dosTime</span><span class="op" id="6102596">&gt;&gt;</span><span class="num" id="6102598">5</span><span class="op" id="6102599">&amp;</span><span class="num" id="6102600">0x3f</span><span class="op" id="6102604">)</span><span class="op" id="6102605">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6102609">int</span><span class="op" id="6102612">(</span><span class="ident" id="6102613">dosTime</span><span class="op" id="6102620">&amp;</span><span class="num" id="6102621">0x1f</span><span class="op" id="6102625">*</span><span class="num" id="6102626">2</span><span class="op" id="6102627">)</span><span class="op" id="6102628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6102632">0</span><span class="op" id="6102633">,</span>&nbsp;<span class="comment" id="6102635">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102653">time</span><span class="op" id="6102657">.</span><span class="ident" id="6102658">UTC</span><span class="op" id="6102661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6102664">)</span><br>
<span class="lineno">165</span><span class="op" id="6102666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6102669">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6102737">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6102762">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="6102833">func</span>&nbsp;<span class="ident" id="6102838">timeToMsDosTime</span><span class="op" id="6102853">(</span><span class="ident" id="6102854">t</span>&nbsp;<span class="ident" id="6102856">time</span><span class="op" id="6102860">.</span><span class="ident" id="6102861">Time</span><span class="op" id="6102865">)</span>&nbsp;<span class="op" id="6102867">(</span><span class="ident" id="6102868">fDate</span>&nbsp;<span class="builtintype" id="6102874">uint16</span><span class="op" id="6102880">,</span>&nbsp;<span class="ident" id="6102882">fTime</span>&nbsp;<span class="builtintype" id="6102888">uint16</span><span class="op" id="6102894">)</span>&nbsp;<span class="op" id="6102896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102899">t</span>&nbsp;<span class="op" id="6102901">=</span>&nbsp;<span class="ident" id="6102903">t</span><span class="op" id="6102904">.</span><span class="ident" id="6102905">In</span><span class="op" id="6102907">(</span><span class="ident" id="6102908">time</span><span class="op" id="6102912">.</span><span class="ident" id="6102913">UTC</span><span class="op" id="6102916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102919">fDate</span>&nbsp;<span class="op" id="6102925">=</span>&nbsp;<span class="builtintype" id="6102927">uint16</span><span class="op" id="6102933">(</span><span class="ident" id="6102934">t</span><span class="op" id="6102935">.</span><span class="ident" id="6102936">Day</span><span class="op" id="6102939">(</span><span class="op" id="6102940">)</span>&nbsp;<span class="op" id="6102942">+</span>&nbsp;<span class="builtintype" id="6102944">int</span><span class="op" id="6102947">(</span><span class="ident" id="6102948">t</span><span class="op" id="6102949">.</span><span class="ident" id="6102950">Month</span><span class="op" id="6102955">(</span><span class="op" id="6102956">)</span><span class="op" id="6102957">)</span><span class="op" id="6102958">&lt;&lt;</span><span class="num" id="6102960">5</span>&nbsp;<span class="op" id="6102962">+</span>&nbsp;<span class="op" id="6102964">(</span><span class="ident" id="6102965">t</span><span class="op" id="6102966">.</span><span class="ident" id="6102967">Year</span><span class="op" id="6102971">(</span><span class="op" id="6102972">)</span><span class="op" id="6102973">-</span><span class="num" id="6102974">1980</span><span class="op" id="6102978">)</span><span class="op" id="6102979">&lt;&lt;</span><span class="num" id="6102981">9</span><span class="op" id="6102982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6102985">fTime</span>&nbsp;<span class="op" id="6102991">=</span>&nbsp;<span class="builtintype" id="6102993">uint16</span><span class="op" id="6102999">(</span><span class="ident" id="6103000">t</span><span class="op" id="6103001">.</span><span class="ident" id="6103002">Second</span><span class="op" id="6103008">(</span><span class="op" id="6103009">)</span><span class="op" id="6103010">/</span><span class="num" id="6103011">2</span>&nbsp;<span class="op" id="6103013">+</span>&nbsp;<span class="ident" id="6103015">t</span><span class="op" id="6103016">.</span><span class="ident" id="6103017">Minute</span><span class="op" id="6103023">(</span><span class="op" id="6103024">)</span><span class="op" id="6103025">&lt;&lt;</span><span class="num" id="6103027">5</span>&nbsp;<span class="op" id="6103029">+</span>&nbsp;<span class="ident" id="6103031">t</span><span class="op" id="6103032">.</span><span class="ident" id="6103033">Hour</span><span class="op" id="6103037">(</span><span class="op" id="6103038">)</span><span class="op" id="6103039">&lt;&lt;</span><span class="num" id="6103041">11</span><span class="op" id="6103043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6103046">return</span><br>
<span class="lineno">175</span><span class="op" id="6103053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6103056">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6103105">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="6103130">func</span>&nbsp;<span class="op" id="6103135">(</span><span class="ident" id="6103136">h</span>&nbsp;<span class="op" id="6103138">*</span><span class="ident" id="6103139">FileHeader</span><span class="op" id="6103149">)</span>&nbsp;<span class="ident" id="6103151">ModTime</span><span class="op" id="6103158">(</span><span class="op" id="6103159">)</span>&nbsp;<span class="ident" id="6103161">time</span><span class="op" id="6103165">.</span><span class="ident" id="6103166">Time</span>&nbsp;<span class="op" id="6103171">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6103174">return</span>&nbsp;<span class="ident" id="6103181">msDosTimeToTime</span><span class="op" id="6103196">(</span><span class="ident" id="6103197">h</span><span class="op" id="6103198">.</span><span class="ident" id="6103199">ModifiedDate</span><span class="op" id="6103211">,</span>&nbsp;<span class="ident" id="6103213">h</span><span class="op" id="6103214">.</span><span class="ident" id="6103215">ModifiedTime</span><span class="op" id="6103227">)</span><br>
<span class="lineno"></span><span class="op" id="6103229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6103232">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6103318">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="6103343">func</span>&nbsp;<span class="op" id="6103348">(</span><span class="ident" id="6103349">h</span>&nbsp;<span class="op" id="6103351">*</span><span class="ident" id="6103352">FileHeader</span><span class="op" id="6103362">)</span>&nbsp;<span class="ident" id="6103364">SetModTime</span><span class="op" id="6103374">(</span><span class="ident" id="6103375">t</span>&nbsp;<span class="ident" id="6103377">time</span><span class="op" id="6103381">.</span><span class="ident" id="6103382">Time</span><span class="op" id="6103386">)</span>&nbsp;<span class="op" id="6103388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103391">h</span><span class="op" id="6103392">.</span><span class="ident" id="6103393">ModifiedDate</span><span class="op" id="6103405">,</span>&nbsp;<span class="ident" id="6103407">h</span><span class="op" id="6103408">.</span><span class="ident" id="6103409">ModifiedTime</span>&nbsp;<span class="op" id="6103422">=</span>&nbsp;<span class="ident" id="6103424">timeToMsDosTime</span><span class="op" id="6103439">(</span><span class="ident" id="6103440">t</span><span class="op" id="6103441">)</span><br>
<span class="lineno"></span><span class="op" id="6103443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6103446">const</span>&nbsp;<span class="op" id="6103452">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6103455">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6103515">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103571">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6103580">=</span>&nbsp;<span class="num" id="6103582">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103590">s_IFSOCK</span>&nbsp;<span class="op" id="6103599">=</span>&nbsp;<span class="num" id="6103601">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103609">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="6103618">=</span>&nbsp;<span class="num" id="6103620">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103628">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="6103637">=</span>&nbsp;<span class="num" id="6103639">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103647">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="6103656">=</span>&nbsp;<span class="num" id="6103658">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103666">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="6103675">=</span>&nbsp;<span class="num" id="6103677">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103685">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="6103694">=</span>&nbsp;<span class="num" id="6103696">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103704">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="6103713">=</span>&nbsp;<span class="num" id="6103715">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103723">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="6103732">=</span>&nbsp;<span class="num" id="6103734">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103741">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="6103750">=</span>&nbsp;<span class="num" id="6103752">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103759">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="6103768">=</span>&nbsp;<span class="num" id="6103770">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103778">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6103792">=</span>&nbsp;<span class="num" id="6103794">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6103800">msdosReadOnly</span>&nbsp;<span class="op" id="6103814">=</span>&nbsp;<span class="num" id="6103816">0x01</span><br>
<span class="lineno"></span><span class="op" id="6103821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6103824">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6103889">func</span>&nbsp;<span class="op" id="6103894">(</span><span class="ident" id="6103895">h</span>&nbsp;<span class="op" id="6103897">*</span><span class="ident" id="6103898">FileHeader</span><span class="op" id="6103908">)</span>&nbsp;<span class="ident" id="6103910">Mode</span><span class="op" id="6103914">(</span><span class="op" id="6103915">)</span>&nbsp;<span class="op" id="6103917">(</span><span class="ident" id="6103918">mode</span>&nbsp;<span class="ident" id="6103923">os</span><span class="op" id="6103925">.</span><span class="ident" id="6103926">FileMode</span><span class="op" id="6103934">)</span>&nbsp;<span class="op" id="6103936">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6103939">switch</span>&nbsp;<span class="ident" id="6103946">h</span><span class="op" id="6103947">.</span><span class="ident" id="6103948">CreatorVersion</span>&nbsp;<span class="op" id="6103963">&gt;&gt;</span>&nbsp;<span class="num" id="6103966">8</span>&nbsp;<span class="op" id="6103968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6103971">case</span>&nbsp;<span class="ident" id="6103976">creatorUnix</span><span class="op" id="6103987">,</span>&nbsp;<span class="ident" id="6103989">creatorMacOSX</span><span class="op" id="6104002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104006">mode</span>&nbsp;<span class="op" id="6104011">=</span>&nbsp;<span class="ident" id="6104013">unixModeToFileMode</span><span class="op" id="6104031">(</span><span class="ident" id="6104032">h</span><span class="op" id="6104033">.</span><span class="ident" id="6104034">ExternalAttrs</span>&nbsp;<span class="op" id="6104048">&gt;&gt;</span>&nbsp;<span class="num" id="6104051">16</span><span class="op" id="6104053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104056">case</span>&nbsp;<span class="ident" id="6104061">creatorNTFS</span><span class="op" id="6104072">,</span>&nbsp;<span class="ident" id="6104074">creatorVFAT</span><span class="op" id="6104085">,</span>&nbsp;<span class="ident" id="6104087">creatorFAT</span><span class="op" id="6104097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104101">mode</span>&nbsp;<span class="op" id="6104106">=</span>&nbsp;<span class="ident" id="6104108">msdosModeToFileMode</span><span class="op" id="6104127">(</span><span class="ident" id="6104128">h</span><span class="op" id="6104129">.</span><span class="ident" id="6104130">ExternalAttrs</span><span class="op" id="6104143">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104149">if</span>&nbsp;<span class="builtinfunc" id="6104152">len</span><span class="op" id="6104155">(</span><span class="ident" id="6104156">h</span><span class="op" id="6104157">.</span><span class="ident" id="6104158">Name</span><span class="op" id="6104162">)</span>&nbsp;<span class="op" id="6104164">&gt;</span>&nbsp;<span class="num" id="6104166">0</span>&nbsp;<span class="op" id="6104168">&amp;&amp;</span>&nbsp;<span class="ident" id="6104171">h</span><span class="op" id="6104172">.</span><span class="ident" id="6104173">Name</span><span class="op" id="6104177">[</span><span class="builtinfunc" id="6104178">len</span><span class="op" id="6104181">(</span><span class="ident" id="6104182">h</span><span class="op" id="6104183">.</span><span class="ident" id="6104184">Name</span><span class="op" id="6104188">)</span><span class="op" id="6104189">-</span><span class="num" id="6104190">1</span><span class="op" id="6104191">]</span>&nbsp;<span class="op" id="6104193">==</span>&nbsp;<span class="string" id="6104196">&#39;/&#39;</span>&nbsp;<span class="op" id="6104200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104204">mode</span>&nbsp;<span class="op" id="6104209">|=</span>&nbsp;<span class="ident" id="6104212">os</span><span class="op" id="6104214">.</span><span class="ident" id="6104215">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104227">return</span>&nbsp;<span class="ident" id="6104234">mode</span><br>
<span class="lineno">220</span><span class="op" id="6104239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6104242">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6104310">func</span>&nbsp;<span class="op" id="6104315">(</span><span class="ident" id="6104316">h</span>&nbsp;<span class="op" id="6104318">*</span><span class="ident" id="6104319">FileHeader</span><span class="op" id="6104329">)</span>&nbsp;<span class="ident" id="6104331">SetMode</span><span class="op" id="6104338">(</span><span class="ident" id="6104339">mode</span>&nbsp;<span class="ident" id="6104344">os</span><span class="op" id="6104346">.</span><span class="ident" id="6104347">FileMode</span><span class="op" id="6104355">)</span>&nbsp;<span class="op" id="6104357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104360">h</span><span class="op" id="6104361">.</span><span class="ident" id="6104362">CreatorVersion</span>&nbsp;<span class="op" id="6104377">=</span>&nbsp;<span class="ident" id="6104379">h</span><span class="op" id="6104380">.</span><span class="ident" id="6104381">CreatorVersion</span><span class="op" id="6104395">&amp;</span><span class="num" id="6104396">0xff</span>&nbsp;<span class="op" id="6104401">|</span>&nbsp;<span class="ident" id="6104403">creatorUnix</span><span class="op" id="6104414">&lt;&lt;</span><span class="num" id="6104416">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104419">h</span><span class="op" id="6104420">.</span><span class="ident" id="6104421">ExternalAttrs</span>&nbsp;<span class="op" id="6104435">=</span>&nbsp;<span class="ident" id="6104437">fileModeToUnixMode</span><span class="op" id="6104455">(</span><span class="ident" id="6104456">mode</span><span class="op" id="6104460">)</span>&nbsp;<span class="op" id="6104462">&lt;&lt;</span>&nbsp;<span class="num" id="6104465">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6104470">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104526">if</span>&nbsp;<span class="ident" id="6104529">mode</span><span class="op" id="6104533">&amp;</span><span class="ident" id="6104534">os</span><span class="op" id="6104536">.</span><span class="ident" id="6104537">ModeDir</span>&nbsp;<span class="op" id="6104545">!=</span>&nbsp;<span class="num" id="6104548">0</span>&nbsp;<span class="op" id="6104550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104554">h</span><span class="op" id="6104555">.</span><span class="ident" id="6104556">ExternalAttrs</span>&nbsp;<span class="op" id="6104570">|=</span>&nbsp;<span class="ident" id="6104573">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104586">if</span>&nbsp;<span class="ident" id="6104589">mode</span><span class="op" id="6104593">&amp;</span><span class="num" id="6104594">0200</span>&nbsp;<span class="op" id="6104599">==</span>&nbsp;<span class="num" id="6104602">0</span>&nbsp;<span class="op" id="6104604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104608">h</span><span class="op" id="6104609">.</span><span class="ident" id="6104610">ExternalAttrs</span>&nbsp;<span class="op" id="6104624">|=</span>&nbsp;<span class="ident" id="6104627">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104642">}</span><br>
<span class="lineno"></span><span class="op" id="6104644">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6104647">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="6104713">func</span>&nbsp;<span class="op" id="6104718">(</span><span class="ident" id="6104719">fh</span>&nbsp;<span class="op" id="6104722">*</span><span class="ident" id="6104723">FileHeader</span><span class="op" id="6104733">)</span>&nbsp;<span class="ident" id="6104735">isZip64</span><span class="op" id="6104742">(</span><span class="op" id="6104743">)</span>&nbsp;<span class="builtintype" id="6104745">bool</span>&nbsp;<span class="op" id="6104750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104753">return</span>&nbsp;<span class="ident" id="6104760">fh</span><span class="op" id="6104762">.</span><span class="ident" id="6104763">CompressedSize64</span>&nbsp;<span class="op" id="6104780">&gt;</span>&nbsp;<span class="ident" id="6104782">uint32max</span>&nbsp;<span class="op" id="6104792">||</span>&nbsp;<span class="ident" id="6104795">fh</span><span class="op" id="6104797">.</span><span class="ident" id="6104798">UncompressedSize64</span>&nbsp;<span class="op" id="6104817">&gt;</span>&nbsp;<span class="ident" id="6104819">uint32max</span><br>
<span class="lineno"></span><span class="op" id="6104829">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="6104832">func</span>&nbsp;<span class="ident" id="6104837">msdosModeToFileMode</span><span class="op" id="6104856">(</span><span class="ident" id="6104857">m</span>&nbsp;<span class="builtintype" id="6104859">uint32</span><span class="op" id="6104865">)</span>&nbsp;<span class="op" id="6104867">(</span><span class="ident" id="6104868">mode</span>&nbsp;<span class="ident" id="6104873">os</span><span class="op" id="6104875">.</span><span class="ident" id="6104876">FileMode</span><span class="op" id="6104884">)</span>&nbsp;<span class="op" id="6104886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104889">if</span>&nbsp;<span class="ident" id="6104892">m</span><span class="op" id="6104893">&amp;</span><span class="ident" id="6104894">msdosDir</span>&nbsp;<span class="op" id="6104903">!=</span>&nbsp;<span class="num" id="6104906">0</span>&nbsp;<span class="op" id="6104908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104912">mode</span>&nbsp;<span class="op" id="6104917">=</span>&nbsp;<span class="ident" id="6104919">os</span><span class="op" id="6104921">.</span><span class="ident" id="6104922">ModeDir</span>&nbsp;<span class="op" id="6104930">|</span>&nbsp;<span class="num" id="6104932">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104938">}</span>&nbsp;<span class="keyword" id="6104940">else</span>&nbsp;<span class="op" id="6104945">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104949">mode</span>&nbsp;<span class="op" id="6104954">=</span>&nbsp;<span class="num" id="6104956">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6104962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6104965">if</span>&nbsp;<span class="ident" id="6104968">m</span><span class="op" id="6104969">&amp;</span><span class="ident" id="6104970">msdosReadOnly</span>&nbsp;<span class="op" id="6104984">!=</span>&nbsp;<span class="num" id="6104987">0</span>&nbsp;<span class="op" id="6104989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6104993">mode</span>&nbsp;<span class="op" id="6104998">&amp;^=</span>&nbsp;<span class="num" id="6105002">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105008">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105011">return</span>&nbsp;<span class="ident" id="6105018">mode</span><br>
<span class="lineno"></span><span class="op" id="6105023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6105026">func</span>&nbsp;<span class="ident" id="6105031">fileModeToUnixMode</span><span class="op" id="6105049">(</span><span class="ident" id="6105050">mode</span>&nbsp;<span class="ident" id="6105055">os</span><span class="op" id="6105057">.</span><span class="ident" id="6105058">FileMode</span><span class="op" id="6105066">)</span>&nbsp;<span class="builtintype" id="6105068">uint32</span>&nbsp;<span class="op" id="6105075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105078">var</span>&nbsp;<span class="ident" id="6105082">m</span>&nbsp;<span class="builtintype" id="6105084">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105092">switch</span>&nbsp;<span class="ident" id="6105099">mode</span>&nbsp;<span class="op" id="6105104">&amp;</span>&nbsp;<span class="ident" id="6105106">os</span><span class="op" id="6105108">.</span><span class="ident" id="6105109">ModeType</span>&nbsp;<span class="op" id="6105118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105121">default</span><span class="op" id="6105128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105132">m</span>&nbsp;<span class="op" id="6105134">=</span>&nbsp;<span class="ident" id="6105136">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105145">case</span>&nbsp;<span class="ident" id="6105150">os</span><span class="op" id="6105152">.</span><span class="ident" id="6105153">ModeDir</span><span class="op" id="6105160">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105164">m</span>&nbsp;<span class="op" id="6105166">=</span>&nbsp;<span class="ident" id="6105168">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105177">case</span>&nbsp;<span class="ident" id="6105182">os</span><span class="op" id="6105184">.</span><span class="ident" id="6105185">ModeSymlink</span><span class="op" id="6105196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105200">m</span>&nbsp;<span class="op" id="6105202">=</span>&nbsp;<span class="ident" id="6105204">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105213">case</span>&nbsp;<span class="ident" id="6105218">os</span><span class="op" id="6105220">.</span><span class="ident" id="6105221">ModeNamedPipe</span><span class="op" id="6105234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105238">m</span>&nbsp;<span class="op" id="6105240">=</span>&nbsp;<span class="ident" id="6105242">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105251">case</span>&nbsp;<span class="ident" id="6105256">os</span><span class="op" id="6105258">.</span><span class="ident" id="6105259">ModeSocket</span><span class="op" id="6105269">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105273">m</span>&nbsp;<span class="op" id="6105275">=</span>&nbsp;<span class="ident" id="6105277">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105287">case</span>&nbsp;<span class="ident" id="6105292">os</span><span class="op" id="6105294">.</span><span class="ident" id="6105295">ModeDevice</span><span class="op" id="6105305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105309">if</span>&nbsp;<span class="ident" id="6105312">mode</span><span class="op" id="6105316">&amp;</span><span class="ident" id="6105317">os</span><span class="op" id="6105319">.</span><span class="ident" id="6105320">ModeCharDevice</span>&nbsp;<span class="op" id="6105335">!=</span>&nbsp;<span class="num" id="6105338">0</span>&nbsp;<span class="op" id="6105340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105345">m</span>&nbsp;<span class="op" id="6105347">=</span>&nbsp;<span class="ident" id="6105349">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105359">}</span>&nbsp;<span class="keyword" id="6105361">else</span>&nbsp;<span class="op" id="6105366">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105371">m</span>&nbsp;<span class="op" id="6105373">=</span>&nbsp;<span class="ident" id="6105375">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105391">if</span>&nbsp;<span class="ident" id="6105394">mode</span><span class="op" id="6105398">&amp;</span><span class="ident" id="6105399">os</span><span class="op" id="6105401">.</span><span class="ident" id="6105402">ModeSetuid</span>&nbsp;<span class="op" id="6105413">!=</span>&nbsp;<span class="num" id="6105416">0</span>&nbsp;<span class="op" id="6105418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105422">m</span>&nbsp;<span class="op" id="6105424">|=</span>&nbsp;<span class="ident" id="6105427">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105439">if</span>&nbsp;<span class="ident" id="6105442">mode</span><span class="op" id="6105446">&amp;</span><span class="ident" id="6105447">os</span><span class="op" id="6105449">.</span><span class="ident" id="6105450">ModeSetgid</span>&nbsp;<span class="op" id="6105461">!=</span>&nbsp;<span class="num" id="6105464">0</span>&nbsp;<span class="op" id="6105466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105470">m</span>&nbsp;<span class="op" id="6105472">|=</span>&nbsp;<span class="ident" id="6105475">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105487">if</span>&nbsp;<span class="ident" id="6105490">mode</span><span class="op" id="6105494">&amp;</span><span class="ident" id="6105495">os</span><span class="op" id="6105497">.</span><span class="ident" id="6105498">ModeSticky</span>&nbsp;<span class="op" id="6105509">!=</span>&nbsp;<span class="num" id="6105512">0</span>&nbsp;<span class="op" id="6105514">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105518">m</span>&nbsp;<span class="op" id="6105520">|=</span>&nbsp;<span class="ident" id="6105523">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105535">return</span>&nbsp;<span class="ident" id="6105542">m</span>&nbsp;<span class="op" id="6105544">|</span>&nbsp;<span class="builtintype" id="6105546">uint32</span><span class="op" id="6105552">(</span><span class="ident" id="6105553">mode</span><span class="op" id="6105557">&amp;</span><span class="num" id="6105558">0777</span><span class="op" id="6105562">)</span><br>
<span class="lineno"></span><span class="op" id="6105564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="6105567">func</span>&nbsp;<span class="ident" id="6105572">unixModeToFileMode</span><span class="op" id="6105590">(</span><span class="ident" id="6105591">m</span>&nbsp;<span class="builtintype" id="6105593">uint32</span><span class="op" id="6105599">)</span>&nbsp;<span class="ident" id="6105601">os</span><span class="op" id="6105603">.</span><span class="ident" id="6105604">FileMode</span>&nbsp;<span class="op" id="6105613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105616">mode</span>&nbsp;<span class="op" id="6105621">:=</span>&nbsp;<span class="ident" id="6105624">os</span><span class="op" id="6105626">.</span><span class="ident" id="6105627">FileMode</span><span class="op" id="6105635">(</span><span class="ident" id="6105636">m</span>&nbsp;<span class="op" id="6105638">&amp;</span>&nbsp;<span class="num" id="6105640">0777</span><span class="op" id="6105644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105647">switch</span>&nbsp;<span class="ident" id="6105654">m</span>&nbsp;<span class="op" id="6105656">&amp;</span>&nbsp;<span class="ident" id="6105658">s_IFMT</span>&nbsp;<span class="op" id="6105665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105668">case</span>&nbsp;<span class="ident" id="6105673">s_IFBLK</span><span class="op" id="6105680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105684">mode</span>&nbsp;<span class="op" id="6105689">|=</span>&nbsp;<span class="ident" id="6105692">os</span><span class="op" id="6105694">.</span><span class="ident" id="6105695">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105707">case</span>&nbsp;<span class="ident" id="6105712">s_IFCHR</span><span class="op" id="6105719">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105723">mode</span>&nbsp;<span class="op" id="6105728">|=</span>&nbsp;<span class="ident" id="6105731">os</span><span class="op" id="6105733">.</span><span class="ident" id="6105734">ModeDevice</span>&nbsp;<span class="op" id="6105745">|</span>&nbsp;<span class="ident" id="6105747">os</span><span class="op" id="6105749">.</span><span class="ident" id="6105750">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105766">case</span>&nbsp;<span class="ident" id="6105771">s_IFDIR</span><span class="op" id="6105778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105782">mode</span>&nbsp;<span class="op" id="6105787">|=</span>&nbsp;<span class="ident" id="6105790">os</span><span class="op" id="6105792">.</span><span class="ident" id="6105793">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105802">case</span>&nbsp;<span class="ident" id="6105807">s_IFIFO</span><span class="op" id="6105814">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105818">mode</span>&nbsp;<span class="op" id="6105823">|=</span>&nbsp;<span class="ident" id="6105826">os</span><span class="op" id="6105828">.</span><span class="ident" id="6105829">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105844">case</span>&nbsp;<span class="ident" id="6105849">s_IFLNK</span><span class="op" id="6105856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105860">mode</span>&nbsp;<span class="op" id="6105865">|=</span>&nbsp;<span class="ident" id="6105868">os</span><span class="op" id="6105870">.</span><span class="ident" id="6105871">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105884">case</span>&nbsp;<span class="ident" id="6105889">s_IFREG</span><span class="op" id="6105896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6105900">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105918">case</span>&nbsp;<span class="ident" id="6105923">s_IFSOCK</span><span class="op" id="6105931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105935">mode</span>&nbsp;<span class="op" id="6105940">|=</span>&nbsp;<span class="ident" id="6105943">os</span><span class="op" id="6105945">.</span><span class="ident" id="6105946">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6105958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6105961">if</span>&nbsp;<span class="ident" id="6105964">m</span><span class="op" id="6105965">&amp;</span><span class="ident" id="6105966">s_ISGID</span>&nbsp;<span class="op" id="6105974">!=</span>&nbsp;<span class="num" id="6105977">0</span>&nbsp;<span class="op" id="6105979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6105983">mode</span>&nbsp;<span class="op" id="6105988">|=</span>&nbsp;<span class="ident" id="6105991">os</span><span class="op" id="6105993">.</span><span class="ident" id="6105994">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6106006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6106009">if</span>&nbsp;<span class="ident" id="6106012">m</span><span class="op" id="6106013">&amp;</span><span class="ident" id="6106014">s_ISUID</span>&nbsp;<span class="op" id="6106022">!=</span>&nbsp;<span class="num" id="6106025">0</span>&nbsp;<span class="op" id="6106027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6106031">mode</span>&nbsp;<span class="op" id="6106036">|=</span>&nbsp;<span class="ident" id="6106039">os</span><span class="op" id="6106041">.</span><span class="ident" id="6106042">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6106054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6106057">if</span>&nbsp;<span class="ident" id="6106060">m</span><span class="op" id="6106061">&amp;</span><span class="ident" id="6106062">s_ISVTX</span>&nbsp;<span class="op" id="6106070">!=</span>&nbsp;<span class="num" id="6106073">0</span>&nbsp;<span class="op" id="6106075">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6106079">mode</span>&nbsp;<span class="op" id="6106084">|=</span>&nbsp;<span class="ident" id="6106087">os</span><span class="op" id="6106089">.</span><span class="ident" id="6106090">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6106102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6106105">return</span>&nbsp;<span class="ident" id="6106112">mode</span><br>
<span class="lineno"></span><span class="op" id="6106117">}</span>
</div>
</body>
</html>
