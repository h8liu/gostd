<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html" class="current">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8299307">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8299363">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8299417">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8299468">package</span>&nbsp;<span class="ident" id="8299476">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8299485">import</span>&nbsp;<span class="op" id="8299492">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299495">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299504">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299521">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299531">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299538">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299544">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299557">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299564">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299575">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299586">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8299596">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8299599">type</span>&nbsp;<span class="ident" id="8299604">Args</span>&nbsp;<span class="keyword" id="8299609">struct</span>&nbsp;<span class="op" id="8299616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299619">A</span><span class="op" id="8299620">,</span>&nbsp;<span class="ident" id="8299622">B</span>&nbsp;<span class="builtintype" id="8299624">int</span><br>
<span class="lineno"></span><span class="op" id="8299628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8299631">type</span>&nbsp;<span class="ident" id="8299636">Reply</span>&nbsp;<span class="keyword" id="8299642">struct</span>&nbsp;<span class="op" id="8299649">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299652">C</span>&nbsp;<span class="builtintype" id="8299654">int</span><br>
<span class="lineno"></span><span class="op" id="8299658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8299661">type</span>&nbsp;<span class="ident" id="8299666">Arith</span>&nbsp;<span class="builtintype" id="8299672">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8299677">type</span>&nbsp;<span class="ident" id="8299682">ArithAddResp</span>&nbsp;<span class="keyword" id="8299695">struct</span>&nbsp;<span class="op" id="8299702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299705">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8299712">interface</span><span class="op" id="8299721">{</span><span class="op" id="8299722">}</span>&nbsp;<span class="string" id="8299724">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299737">Result</span>&nbsp;<span class="ident" id="8299744">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299756">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299773">Error</span>&nbsp;&nbsp;<span class="keyword" id="8299780">interface</span><span class="op" id="8299789">{</span><span class="op" id="8299790">}</span>&nbsp;<span class="string" id="8299792">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8299807">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="8299810">func</span>&nbsp;<span class="op" id="8299815">(</span><span class="ident" id="8299816">t</span>&nbsp;<span class="op" id="8299818">*</span><span class="ident" id="8299819">Arith</span><span class="op" id="8299824">)</span>&nbsp;<span class="ident" id="8299826">Add</span><span class="op" id="8299829">(</span><span class="ident" id="8299830">args</span>&nbsp;<span class="op" id="8299835">*</span><span class="ident" id="8299836">Args</span><span class="op" id="8299840">,</span>&nbsp;<span class="ident" id="8299842">reply</span>&nbsp;<span class="op" id="8299848">*</span><span class="ident" id="8299849">Reply</span><span class="op" id="8299854">)</span>&nbsp;<span class="builtintype" id="8299856">error</span>&nbsp;<span class="op" id="8299862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299865">reply</span><span class="op" id="8299870">.</span><span class="ident" id="8299871">C</span>&nbsp;<span class="op" id="8299873">=</span>&nbsp;<span class="ident" id="8299875">args</span><span class="op" id="8299879">.</span><span class="ident" id="8299880">A</span>&nbsp;<span class="op" id="8299882">+</span>&nbsp;<span class="ident" id="8299884">args</span><span class="op" id="8299888">.</span><span class="ident" id="8299889">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8299892">return</span>&nbsp;<span class="builtintype" id="8299899">nil</span><br>
<span class="lineno"></span><span class="op" id="8299903">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8299906">func</span>&nbsp;<span class="op" id="8299911">(</span><span class="ident" id="8299912">t</span>&nbsp;<span class="op" id="8299914">*</span><span class="ident" id="8299915">Arith</span><span class="op" id="8299920">)</span>&nbsp;<span class="ident" id="8299922">Mul</span><span class="op" id="8299925">(</span><span class="ident" id="8299926">args</span>&nbsp;<span class="op" id="8299931">*</span><span class="ident" id="8299932">Args</span><span class="op" id="8299936">,</span>&nbsp;<span class="ident" id="8299938">reply</span>&nbsp;<span class="op" id="8299944">*</span><span class="ident" id="8299945">Reply</span><span class="op" id="8299950">)</span>&nbsp;<span class="builtintype" id="8299952">error</span>&nbsp;<span class="op" id="8299958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299961">reply</span><span class="op" id="8299966">.</span><span class="ident" id="8299967">C</span>&nbsp;<span class="op" id="8299969">=</span>&nbsp;<span class="ident" id="8299971">args</span><span class="op" id="8299975">.</span><span class="ident" id="8299976">A</span>&nbsp;<span class="op" id="8299978">*</span>&nbsp;<span class="ident" id="8299980">args</span><span class="op" id="8299984">.</span><span class="ident" id="8299985">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8299988">return</span>&nbsp;<span class="builtintype" id="8299995">nil</span><br>
<span class="lineno"></span><span class="op" id="8299999">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8300002">func</span>&nbsp;<span class="op" id="8300007">(</span><span class="ident" id="8300008">t</span>&nbsp;<span class="op" id="8300010">*</span><span class="ident" id="8300011">Arith</span><span class="op" id="8300016">)</span>&nbsp;<span class="ident" id="8300018">Div</span><span class="op" id="8300021">(</span><span class="ident" id="8300022">args</span>&nbsp;<span class="op" id="8300027">*</span><span class="ident" id="8300028">Args</span><span class="op" id="8300032">,</span>&nbsp;<span class="ident" id="8300034">reply</span>&nbsp;<span class="op" id="8300040">*</span><span class="ident" id="8300041">Reply</span><span class="op" id="8300046">)</span>&nbsp;<span class="builtintype" id="8300048">error</span>&nbsp;<span class="op" id="8300054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300057">if</span>&nbsp;<span class="ident" id="8300060">args</span><span class="op" id="8300064">.</span><span class="ident" id="8300065">B</span>&nbsp;<span class="op" id="8300067">==</span>&nbsp;<span class="num" id="8300070">0</span>&nbsp;<span class="op" id="8300072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300076">return</span>&nbsp;<span class="ident" id="8300083">errors</span><span class="op" id="8300089">.</span><span class="ident" id="8300090">New</span><span class="op" id="8300093">(</span><span class="string" id="8300094">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8300110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300113">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300116">reply</span><span class="op" id="8300121">.</span><span class="ident" id="8300122">C</span>&nbsp;<span class="op" id="8300124">=</span>&nbsp;<span class="ident" id="8300126">args</span><span class="op" id="8300130">.</span><span class="ident" id="8300131">A</span>&nbsp;<span class="op" id="8300133">/</span>&nbsp;<span class="ident" id="8300135">args</span><span class="op" id="8300139">.</span><span class="ident" id="8300140">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300143">return</span>&nbsp;<span class="builtintype" id="8300150">nil</span><br>
<span class="lineno"></span><span class="op" id="8300154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300157">func</span>&nbsp;<span class="op" id="8300162">(</span><span class="ident" id="8300163">t</span>&nbsp;<span class="op" id="8300165">*</span><span class="ident" id="8300166">Arith</span><span class="op" id="8300171">)</span>&nbsp;<span class="ident" id="8300173">Error</span><span class="op" id="8300178">(</span><span class="ident" id="8300179">args</span>&nbsp;<span class="op" id="8300184">*</span><span class="ident" id="8300185">Args</span><span class="op" id="8300189">,</span>&nbsp;<span class="ident" id="8300191">reply</span>&nbsp;<span class="op" id="8300197">*</span><span class="ident" id="8300198">Reply</span><span class="op" id="8300203">)</span>&nbsp;<span class="builtintype" id="8300205">error</span>&nbsp;<span class="op" id="8300211">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8300214">panic</span><span class="op" id="8300219">(</span><span class="string" id="8300220">&#34;ERROR&#34;</span><span class="op" id="8300227">)</span><br>
<span class="lineno"></span><span class="op" id="8300229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300232">func</span>&nbsp;<span class="ident" id="8300237">init</span><span class="op" id="8300241">(</span><span class="op" id="8300242">)</span>&nbsp;<span class="op" id="8300244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300247">rpc</span><span class="op" id="8300250">.</span><span class="ident" id="8300251">Register</span><span class="op" id="8300259">(</span><span class="builtinfunc" id="8300260">new</span><span class="op" id="8300263">(</span><span class="ident" id="8300264">Arith</span><span class="op" id="8300269">)</span><span class="op" id="8300270">)</span><br>
<span class="lineno">60</span><span class="op" id="8300272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300275">func</span>&nbsp;<span class="ident" id="8300280">TestServerNoParams</span><span class="op" id="8300298">(</span><span class="ident" id="8300299">t</span>&nbsp;<span class="op" id="8300301">*</span><span class="ident" id="8300302">testing</span><span class="op" id="8300309">.</span><span class="ident" id="8300310">T</span><span class="op" id="8300311">)</span>&nbsp;<span class="op" id="8300313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300316">cli</span><span class="op" id="8300319">,</span>&nbsp;<span class="ident" id="8300321">srv</span>&nbsp;<span class="op" id="8300325">:=</span>&nbsp;<span class="ident" id="8300328">net</span><span class="op" id="8300331">.</span><span class="ident" id="8300332">Pipe</span><span class="op" id="8300336">(</span><span class="op" id="8300337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300340">defer</span>&nbsp;<span class="ident" id="8300346">cli</span><span class="op" id="8300349">.</span><span class="ident" id="8300350">Close</span><span class="op" id="8300355">(</span><span class="op" id="8300356">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300359">go</span>&nbsp;<span class="ident" id="8300362">ServeConn</span><span class="op" id="8300371">(</span><span class="ident" id="8300372">srv</span><span class="op" id="8300375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300378">dec</span>&nbsp;<span class="op" id="8300382">:=</span>&nbsp;<span class="ident" id="8300385">json</span><span class="op" id="8300389">.</span><span class="ident" id="8300390">NewDecoder</span><span class="op" id="8300400">(</span><span class="ident" id="8300401">cli</span><span class="op" id="8300404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300408">fmt</span><span class="op" id="8300411">.</span><span class="ident" id="8300412">Fprintf</span><span class="op" id="8300419">(</span><span class="ident" id="8300420">cli</span><span class="op" id="8300423">,</span>&nbsp;<span class="string" id="8300425">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="8300463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300466">var</span>&nbsp;<span class="ident" id="8300470">resp</span>&nbsp;<span class="ident" id="8300475">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300489">if</span>&nbsp;<span class="ident" id="8300492">err</span>&nbsp;<span class="op" id="8300496">:=</span>&nbsp;<span class="ident" id="8300499">dec</span><span class="op" id="8300502">.</span><span class="ident" id="8300503">Decode</span><span class="op" id="8300509">(</span><span class="op" id="8300510">&amp;</span><span class="ident" id="8300511">resp</span><span class="op" id="8300515">)</span><span class="op" id="8300516">;</span>&nbsp;<span class="ident" id="8300518">err</span>&nbsp;<span class="op" id="8300522">!=</span>&nbsp;<span class="builtintype" id="8300525">nil</span>&nbsp;<span class="op" id="8300529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300533">t</span><span class="op" id="8300534">.</span><span class="ident" id="8300535">Fatalf</span><span class="op" id="8300541">(</span><span class="string" id="8300542">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="8300570">,</span>&nbsp;<span class="ident" id="8300572">err</span><span class="op" id="8300575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300581">if</span>&nbsp;<span class="ident" id="8300584">resp</span><span class="op" id="8300588">.</span><span class="ident" id="8300589">Error</span>&nbsp;<span class="op" id="8300595">==</span>&nbsp;<span class="builtintype" id="8300598">nil</span>&nbsp;<span class="op" id="8300602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300606">t</span><span class="op" id="8300607">.</span><span class="ident" id="8300608">Fatalf</span><span class="op" id="8300614">(</span><span class="string" id="8300615">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8300640">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300643">}</span><br>
<span class="lineno"></span><span class="op" id="8300645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300648">func</span>&nbsp;<span class="ident" id="8300653">TestServerEmptyMessage</span><span class="op" id="8300675">(</span><span class="ident" id="8300676">t</span>&nbsp;<span class="op" id="8300678">*</span><span class="ident" id="8300679">testing</span><span class="op" id="8300686">.</span><span class="ident" id="8300687">T</span><span class="op" id="8300688">)</span>&nbsp;<span class="op" id="8300690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300693">cli</span><span class="op" id="8300696">,</span>&nbsp;<span class="ident" id="8300698">srv</span>&nbsp;<span class="op" id="8300702">:=</span>&nbsp;<span class="ident" id="8300705">net</span><span class="op" id="8300708">.</span><span class="ident" id="8300709">Pipe</span><span class="op" id="8300713">(</span><span class="op" id="8300714">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300717">defer</span>&nbsp;<span class="ident" id="8300723">cli</span><span class="op" id="8300726">.</span><span class="ident" id="8300727">Close</span><span class="op" id="8300732">(</span><span class="op" id="8300733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300736">go</span>&nbsp;<span class="ident" id="8300739">ServeConn</span><span class="op" id="8300748">(</span><span class="ident" id="8300749">srv</span><span class="op" id="8300752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300755">dec</span>&nbsp;<span class="op" id="8300759">:=</span>&nbsp;<span class="ident" id="8300762">json</span><span class="op" id="8300766">.</span><span class="ident" id="8300767">NewDecoder</span><span class="op" id="8300777">(</span><span class="ident" id="8300778">cli</span><span class="op" id="8300781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300785">fmt</span><span class="op" id="8300788">.</span><span class="ident" id="8300789">Fprintf</span><span class="op" id="8300796">(</span><span class="ident" id="8300797">cli</span><span class="op" id="8300800">,</span>&nbsp;<span class="string" id="8300802">&#34;{}&#34;</span><span class="op" id="8300806">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300809">var</span>&nbsp;<span class="ident" id="8300813">resp</span>&nbsp;<span class="ident" id="8300818">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300832">if</span>&nbsp;<span class="ident" id="8300835">err</span>&nbsp;<span class="op" id="8300839">:=</span>&nbsp;<span class="ident" id="8300842">dec</span><span class="op" id="8300845">.</span><span class="ident" id="8300846">Decode</span><span class="op" id="8300852">(</span><span class="op" id="8300853">&amp;</span><span class="ident" id="8300854">resp</span><span class="op" id="8300858">)</span><span class="op" id="8300859">;</span>&nbsp;<span class="ident" id="8300861">err</span>&nbsp;<span class="op" id="8300865">!=</span>&nbsp;<span class="builtintype" id="8300868">nil</span>&nbsp;<span class="op" id="8300872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300876">t</span><span class="op" id="8300877">.</span><span class="ident" id="8300878">Fatalf</span><span class="op" id="8300884">(</span><span class="string" id="8300885">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="8300909">,</span>&nbsp;<span class="ident" id="8300911">err</span><span class="op" id="8300914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300920">if</span>&nbsp;<span class="ident" id="8300923">resp</span><span class="op" id="8300927">.</span><span class="ident" id="8300928">Error</span>&nbsp;<span class="op" id="8300934">==</span>&nbsp;<span class="builtintype" id="8300937">nil</span>&nbsp;<span class="op" id="8300941">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300945">t</span><span class="op" id="8300946">.</span><span class="ident" id="8300947">Fatalf</span><span class="op" id="8300953">(</span><span class="string" id="8300954">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8300979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300982">}</span><br>
<span class="lineno"></span><span class="op" id="8300984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300987">func</span>&nbsp;<span class="ident" id="8300992">TestServer</span><span class="op" id="8301002">(</span><span class="ident" id="8301003">t</span>&nbsp;<span class="op" id="8301005">*</span><span class="ident" id="8301006">testing</span><span class="op" id="8301013">.</span><span class="ident" id="8301014">T</span><span class="op" id="8301015">)</span>&nbsp;<span class="op" id="8301017">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301020">cli</span><span class="op" id="8301023">,</span>&nbsp;<span class="ident" id="8301025">srv</span>&nbsp;<span class="op" id="8301029">:=</span>&nbsp;<span class="ident" id="8301032">net</span><span class="op" id="8301035">.</span><span class="ident" id="8301036">Pipe</span><span class="op" id="8301040">(</span><span class="op" id="8301041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301044">defer</span>&nbsp;<span class="ident" id="8301050">cli</span><span class="op" id="8301053">.</span><span class="ident" id="8301054">Close</span><span class="op" id="8301059">(</span><span class="op" id="8301060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301063">go</span>&nbsp;<span class="ident" id="8301066">ServeConn</span><span class="op" id="8301075">(</span><span class="ident" id="8301076">srv</span><span class="op" id="8301079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301082">dec</span>&nbsp;<span class="op" id="8301086">:=</span>&nbsp;<span class="ident" id="8301089">json</span><span class="op" id="8301093">.</span><span class="ident" id="8301094">NewDecoder</span><span class="op" id="8301104">(</span><span class="ident" id="8301105">cli</span><span class="op" id="8301108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8301112">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301169">for</span>&nbsp;<span class="ident" id="8301173">i</span>&nbsp;<span class="op" id="8301175">:=</span>&nbsp;<span class="num" id="8301178">0</span><span class="op" id="8301179">;</span>&nbsp;<span class="ident" id="8301181">i</span>&nbsp;<span class="op" id="8301183">&lt;</span>&nbsp;<span class="num" id="8301185">10</span><span class="op" id="8301187">;</span>&nbsp;<span class="ident" id="8301189">i</span><span class="op" id="8301190">++</span>&nbsp;<span class="op" id="8301193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301197">fmt</span><span class="op" id="8301200">.</span><span class="ident" id="8301201">Fprintf</span><span class="op" id="8301208">(</span><span class="ident" id="8301209">cli</span><span class="op" id="8301212">,</span>&nbsp;<span class="string" id="8301214">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="8301287">,</span>&nbsp;<span class="ident" id="8301289">i</span><span class="op" id="8301290">,</span>&nbsp;<span class="ident" id="8301292">i</span><span class="op" id="8301293">,</span>&nbsp;<span class="ident" id="8301295">i</span><span class="op" id="8301296">+</span><span class="num" id="8301297">1</span><span class="op" id="8301298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301302">var</span>&nbsp;<span class="ident" id="8301306">resp</span>&nbsp;<span class="ident" id="8301311">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301326">err</span>&nbsp;<span class="op" id="8301330">:=</span>&nbsp;<span class="ident" id="8301333">dec</span><span class="op" id="8301336">.</span><span class="ident" id="8301337">Decode</span><span class="op" id="8301343">(</span><span class="op" id="8301344">&amp;</span><span class="ident" id="8301345">resp</span><span class="op" id="8301349">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301353">if</span>&nbsp;<span class="ident" id="8301356">err</span>&nbsp;<span class="op" id="8301360">!=</span>&nbsp;<span class="builtintype" id="8301363">nil</span>&nbsp;<span class="op" id="8301367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301372">t</span><span class="op" id="8301373">.</span><span class="ident" id="8301374">Fatalf</span><span class="op" id="8301380">(</span><span class="string" id="8301381">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="8301393">,</span>&nbsp;<span class="ident" id="8301395">err</span><span class="op" id="8301398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301406">if</span>&nbsp;<span class="ident" id="8301409">resp</span><span class="op" id="8301413">.</span><span class="ident" id="8301414">Error</span>&nbsp;<span class="op" id="8301420">!=</span>&nbsp;<span class="builtintype" id="8301423">nil</span>&nbsp;<span class="op" id="8301427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301432">t</span><span class="op" id="8301433">.</span><span class="ident" id="8301434">Fatalf</span><span class="op" id="8301440">(</span><span class="string" id="8301441">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="8301457">,</span>&nbsp;<span class="ident" id="8301459">resp</span><span class="op" id="8301463">.</span><span class="ident" id="8301464">Error</span><span class="op" id="8301469">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301477">if</span>&nbsp;<span class="ident" id="8301480">resp</span><span class="op" id="8301484">.</span><span class="ident" id="8301485">Id</span><span class="op" id="8301487">.</span><span class="op" id="8301488">(</span><span class="builtintype" id="8301489">string</span><span class="op" id="8301495">)</span>&nbsp;<span class="op" id="8301497">!=</span>&nbsp;<span class="builtintype" id="8301500">string</span><span class="op" id="8301506">(</span><span class="ident" id="8301507">i</span><span class="op" id="8301508">)</span>&nbsp;<span class="op" id="8301510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301515">t</span><span class="op" id="8301516">.</span><span class="ident" id="8301517">Fatalf</span><span class="op" id="8301523">(</span><span class="string" id="8301524">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8301549">,</span>&nbsp;<span class="ident" id="8301551">resp</span><span class="op" id="8301555">.</span><span class="ident" id="8301556">Id</span><span class="op" id="8301558">.</span><span class="op" id="8301559">(</span><span class="builtintype" id="8301560">string</span><span class="op" id="8301566">)</span><span class="op" id="8301567">,</span>&nbsp;<span class="builtintype" id="8301569">string</span><span class="op" id="8301575">(</span><span class="ident" id="8301576">i</span><span class="op" id="8301577">)</span><span class="op" id="8301578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301586">if</span>&nbsp;<span class="ident" id="8301589">resp</span><span class="op" id="8301593">.</span><span class="ident" id="8301594">Result</span><span class="op" id="8301600">.</span><span class="ident" id="8301601">C</span>&nbsp;<span class="op" id="8301603">!=</span>&nbsp;<span class="num" id="8301606">2</span><span class="op" id="8301607">*</span><span class="ident" id="8301608">i</span><span class="op" id="8301609">+</span><span class="num" id="8301610">1</span>&nbsp;<span class="op" id="8301612">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301617">t</span><span class="op" id="8301618">.</span><span class="ident" id="8301619">Fatalf</span><span class="op" id="8301625">(</span><span class="string" id="8301626">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="8301654">,</span>&nbsp;<span class="ident" id="8301656">i</span><span class="op" id="8301657">,</span>&nbsp;<span class="ident" id="8301659">i</span><span class="op" id="8301660">+</span><span class="num" id="8301661">1</span><span class="op" id="8301662">,</span>&nbsp;<span class="ident" id="8301664">resp</span><span class="op" id="8301668">.</span><span class="ident" id="8301669">Result</span><span class="op" id="8301675">.</span><span class="ident" id="8301676">C</span><span class="op" id="8301677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301684">}</span><br>
<span class="lineno"></span><span class="op" id="8301686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8301689">func</span>&nbsp;<span class="ident" id="8301694">TestClient</span><span class="op" id="8301704">(</span><span class="ident" id="8301705">t</span>&nbsp;<span class="op" id="8301707">*</span><span class="ident" id="8301708">testing</span><span class="op" id="8301715">.</span><span class="ident" id="8301716">T</span><span class="op" id="8301717">)</span>&nbsp;<span class="op" id="8301719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8301722">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8301771">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301803">cli</span><span class="op" id="8301806">,</span>&nbsp;<span class="ident" id="8301808">srv</span>&nbsp;<span class="op" id="8301812">:=</span>&nbsp;<span class="ident" id="8301815">net</span><span class="op" id="8301818">.</span><span class="ident" id="8301819">Pipe</span><span class="op" id="8301823">(</span><span class="op" id="8301824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301827">go</span>&nbsp;<span class="ident" id="8301830">ServeConn</span><span class="op" id="8301839">(</span><span class="ident" id="8301840">srv</span><span class="op" id="8301843">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301847">client</span>&nbsp;<span class="op" id="8301854">:=</span>&nbsp;<span class="ident" id="8301857">NewClient</span><span class="op" id="8301866">(</span><span class="ident" id="8301867">cli</span><span class="op" id="8301870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301873">defer</span>&nbsp;<span class="ident" id="8301879">client</span><span class="op" id="8301885">.</span><span class="ident" id="8301886">Close</span><span class="op" id="8301891">(</span><span class="op" id="8301892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8301896">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301918">args</span>&nbsp;<span class="op" id="8301923">:=</span>&nbsp;<span class="op" id="8301926">&amp;</span><span class="ident" id="8301927">Args</span><span class="op" id="8301931">{</span><span class="num" id="8301932">7</span><span class="op" id="8301933">,</span>&nbsp;<span class="num" id="8301935">8</span><span class="op" id="8301936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301939">reply</span>&nbsp;<span class="op" id="8301945">:=</span>&nbsp;<span class="builtinfunc" id="8301948">new</span><span class="op" id="8301951">(</span><span class="ident" id="8301952">Reply</span><span class="op" id="8301957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301960">err</span>&nbsp;<span class="op" id="8301964">:=</span>&nbsp;<span class="ident" id="8301967">client</span><span class="op" id="8301973">.</span><span class="ident" id="8301974">Call</span><span class="op" id="8301978">(</span><span class="string" id="8301979">&#34;Arith.Add&#34;</span><span class="op" id="8301990">,</span>&nbsp;<span class="ident" id="8301992">args</span><span class="op" id="8301996">,</span>&nbsp;<span class="ident" id="8301998">reply</span><span class="op" id="8302003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302006">if</span>&nbsp;<span class="ident" id="8302009">err</span>&nbsp;<span class="op" id="8302013">!=</span>&nbsp;<span class="builtintype" id="8302016">nil</span>&nbsp;<span class="op" id="8302020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302024">t</span><span class="op" id="8302025">.</span><span class="ident" id="8302026">Errorf</span><span class="op" id="8302032">(</span><span class="string" id="8302033">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8302075">,</span>&nbsp;<span class="ident" id="8302077">err</span><span class="op" id="8302080">.</span><span class="ident" id="8302081">Error</span><span class="op" id="8302086">(</span><span class="op" id="8302087">)</span><span class="op" id="8302088">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302094">if</span>&nbsp;<span class="ident" id="8302097">reply</span><span class="op" id="8302102">.</span><span class="ident" id="8302103">C</span>&nbsp;<span class="op" id="8302105">!=</span>&nbsp;<span class="ident" id="8302108">args</span><span class="op" id="8302112">.</span><span class="ident" id="8302113">A</span><span class="op" id="8302114">+</span><span class="ident" id="8302115">args</span><span class="op" id="8302119">.</span><span class="ident" id="8302120">B</span>&nbsp;<span class="op" id="8302122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302126">t</span><span class="op" id="8302127">.</span><span class="ident" id="8302128">Errorf</span><span class="op" id="8302134">(</span><span class="string" id="8302135">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8302160">,</span>&nbsp;<span class="ident" id="8302162">reply</span><span class="op" id="8302167">.</span><span class="ident" id="8302168">C</span><span class="op" id="8302169">,</span>&nbsp;<span class="ident" id="8302171">args</span><span class="op" id="8302175">.</span><span class="ident" id="8302176">A</span><span class="op" id="8302177">+</span><span class="ident" id="8302178">args</span><span class="op" id="8302182">.</span><span class="ident" id="8302183">B</span><span class="op" id="8302184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302191">args</span>&nbsp;<span class="op" id="8302196">=</span>&nbsp;<span class="op" id="8302198">&amp;</span><span class="ident" id="8302199">Args</span><span class="op" id="8302203">{</span><span class="num" id="8302204">7</span><span class="op" id="8302205">,</span>&nbsp;<span class="num" id="8302207">8</span><span class="op" id="8302208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302211">reply</span>&nbsp;<span class="op" id="8302217">=</span>&nbsp;<span class="builtinfunc" id="8302219">new</span><span class="op" id="8302222">(</span><span class="ident" id="8302223">Reply</span><span class="op" id="8302228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302231">err</span>&nbsp;<span class="op" id="8302235">=</span>&nbsp;<span class="ident" id="8302237">client</span><span class="op" id="8302243">.</span><span class="ident" id="8302244">Call</span><span class="op" id="8302248">(</span><span class="string" id="8302249">&#34;Arith.Mul&#34;</span><span class="op" id="8302260">,</span>&nbsp;<span class="ident" id="8302262">args</span><span class="op" id="8302266">,</span>&nbsp;<span class="ident" id="8302268">reply</span><span class="op" id="8302273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302276">if</span>&nbsp;<span class="ident" id="8302279">err</span>&nbsp;<span class="op" id="8302283">!=</span>&nbsp;<span class="builtintype" id="8302286">nil</span>&nbsp;<span class="op" id="8302290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302294">t</span><span class="op" id="8302295">.</span><span class="ident" id="8302296">Errorf</span><span class="op" id="8302302">(</span><span class="string" id="8302303">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8302345">,</span>&nbsp;<span class="ident" id="8302347">err</span><span class="op" id="8302350">.</span><span class="ident" id="8302351">Error</span><span class="op" id="8302356">(</span><span class="op" id="8302357">)</span><span class="op" id="8302358">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302364">if</span>&nbsp;<span class="ident" id="8302367">reply</span><span class="op" id="8302372">.</span><span class="ident" id="8302373">C</span>&nbsp;<span class="op" id="8302375">!=</span>&nbsp;<span class="ident" id="8302378">args</span><span class="op" id="8302382">.</span><span class="ident" id="8302383">A</span><span class="op" id="8302384">*</span><span class="ident" id="8302385">args</span><span class="op" id="8302389">.</span><span class="ident" id="8302390">B</span>&nbsp;<span class="op" id="8302392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302396">t</span><span class="op" id="8302397">.</span><span class="ident" id="8302398">Errorf</span><span class="op" id="8302404">(</span><span class="string" id="8302405">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8302430">,</span>&nbsp;<span class="ident" id="8302432">reply</span><span class="op" id="8302437">.</span><span class="ident" id="8302438">C</span><span class="op" id="8302439">,</span>&nbsp;<span class="ident" id="8302441">args</span><span class="op" id="8302445">.</span><span class="ident" id="8302446">A</span><span class="op" id="8302447">*</span><span class="ident" id="8302448">args</span><span class="op" id="8302452">.</span><span class="ident" id="8302453">B</span><span class="op" id="8302454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8302461">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302479">args</span>&nbsp;<span class="op" id="8302484">=</span>&nbsp;<span class="op" id="8302486">&amp;</span><span class="ident" id="8302487">Args</span><span class="op" id="8302491">{</span><span class="num" id="8302492">7</span><span class="op" id="8302493">,</span>&nbsp;<span class="num" id="8302495">8</span><span class="op" id="8302496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302499">mulReply</span>&nbsp;<span class="op" id="8302508">:=</span>&nbsp;<span class="builtinfunc" id="8302511">new</span><span class="op" id="8302514">(</span><span class="ident" id="8302515">Reply</span><span class="op" id="8302520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302523">mulCall</span>&nbsp;<span class="op" id="8302531">:=</span>&nbsp;<span class="ident" id="8302534">client</span><span class="op" id="8302540">.</span><span class="ident" id="8302541">Go</span><span class="op" id="8302543">(</span><span class="string" id="8302544">&#34;Arith.Mul&#34;</span><span class="op" id="8302555">,</span>&nbsp;<span class="ident" id="8302557">args</span><span class="op" id="8302561">,</span>&nbsp;<span class="ident" id="8302563">mulReply</span><span class="op" id="8302571">,</span>&nbsp;<span class="builtintype" id="8302573">nil</span><span class="op" id="8302576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302579">addReply</span>&nbsp;<span class="op" id="8302588">:=</span>&nbsp;<span class="builtinfunc" id="8302591">new</span><span class="op" id="8302594">(</span><span class="ident" id="8302595">Reply</span><span class="op" id="8302600">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302603">addCall</span>&nbsp;<span class="op" id="8302611">:=</span>&nbsp;<span class="ident" id="8302614">client</span><span class="op" id="8302620">.</span><span class="ident" id="8302621">Go</span><span class="op" id="8302623">(</span><span class="string" id="8302624">&#34;Arith.Add&#34;</span><span class="op" id="8302635">,</span>&nbsp;<span class="ident" id="8302637">args</span><span class="op" id="8302641">,</span>&nbsp;<span class="ident" id="8302643">addReply</span><span class="op" id="8302651">,</span>&nbsp;<span class="builtintype" id="8302653">nil</span><span class="op" id="8302656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302660">addCall</span>&nbsp;<span class="op" id="8302668">=</span>&nbsp;<span class="op" id="8302670">&lt;-</span><span class="ident" id="8302672">addCall</span><span class="op" id="8302679">.</span><span class="ident" id="8302680">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302686">if</span>&nbsp;<span class="ident" id="8302689">addCall</span><span class="op" id="8302696">.</span><span class="ident" id="8302697">Error</span>&nbsp;<span class="op" id="8302703">!=</span>&nbsp;<span class="builtintype" id="8302706">nil</span>&nbsp;<span class="op" id="8302710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302714">t</span><span class="op" id="8302715">.</span><span class="ident" id="8302716">Errorf</span><span class="op" id="8302722">(</span><span class="string" id="8302723">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8302765">,</span>&nbsp;<span class="ident" id="8302767">addCall</span><span class="op" id="8302774">.</span><span class="ident" id="8302775">Error</span><span class="op" id="8302780">.</span><span class="ident" id="8302781">Error</span><span class="op" id="8302786">(</span><span class="op" id="8302787">)</span><span class="op" id="8302788">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302794">if</span>&nbsp;<span class="ident" id="8302797">addReply</span><span class="op" id="8302805">.</span><span class="ident" id="8302806">C</span>&nbsp;<span class="op" id="8302808">!=</span>&nbsp;<span class="ident" id="8302811">args</span><span class="op" id="8302815">.</span><span class="ident" id="8302816">A</span><span class="op" id="8302817">+</span><span class="ident" id="8302818">args</span><span class="op" id="8302822">.</span><span class="ident" id="8302823">B</span>&nbsp;<span class="op" id="8302825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302829">t</span><span class="op" id="8302830">.</span><span class="ident" id="8302831">Errorf</span><span class="op" id="8302837">(</span><span class="string" id="8302838">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8302863">,</span>&nbsp;<span class="ident" id="8302865">addReply</span><span class="op" id="8302873">.</span><span class="ident" id="8302874">C</span><span class="op" id="8302875">,</span>&nbsp;<span class="ident" id="8302877">args</span><span class="op" id="8302881">.</span><span class="ident" id="8302882">A</span><span class="op" id="8302883">+</span><span class="ident" id="8302884">args</span><span class="op" id="8302888">.</span><span class="ident" id="8302889">B</span><span class="op" id="8302890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302897">mulCall</span>&nbsp;<span class="op" id="8302905">=</span>&nbsp;<span class="op" id="8302907">&lt;-</span><span class="ident" id="8302909">mulCall</span><span class="op" id="8302916">.</span><span class="ident" id="8302917">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302923">if</span>&nbsp;<span class="ident" id="8302926">mulCall</span><span class="op" id="8302933">.</span><span class="ident" id="8302934">Error</span>&nbsp;<span class="op" id="8302940">!=</span>&nbsp;<span class="builtintype" id="8302943">nil</span>&nbsp;<span class="op" id="8302947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302951">t</span><span class="op" id="8302952">.</span><span class="ident" id="8302953">Errorf</span><span class="op" id="8302959">(</span><span class="string" id="8302960">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8303002">,</span>&nbsp;<span class="ident" id="8303004">mulCall</span><span class="op" id="8303011">.</span><span class="ident" id="8303012">Error</span><span class="op" id="8303017">.</span><span class="ident" id="8303018">Error</span><span class="op" id="8303023">(</span><span class="op" id="8303024">)</span><span class="op" id="8303025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303031">if</span>&nbsp;<span class="ident" id="8303034">mulReply</span><span class="op" id="8303042">.</span><span class="ident" id="8303043">C</span>&nbsp;<span class="op" id="8303045">!=</span>&nbsp;<span class="ident" id="8303048">args</span><span class="op" id="8303052">.</span><span class="ident" id="8303053">A</span><span class="op" id="8303054">*</span><span class="ident" id="8303055">args</span><span class="op" id="8303059">.</span><span class="ident" id="8303060">B</span>&nbsp;<span class="op" id="8303062">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303066">t</span><span class="op" id="8303067">.</span><span class="ident" id="8303068">Errorf</span><span class="op" id="8303074">(</span><span class="string" id="8303075">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8303100">,</span>&nbsp;<span class="ident" id="8303102">mulReply</span><span class="op" id="8303110">.</span><span class="ident" id="8303111">C</span><span class="op" id="8303112">,</span>&nbsp;<span class="ident" id="8303114">args</span><span class="op" id="8303118">.</span><span class="ident" id="8303119">A</span><span class="op" id="8303120">*</span><span class="ident" id="8303121">args</span><span class="op" id="8303125">.</span><span class="ident" id="8303126">B</span><span class="op" id="8303127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8303134">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303149">args</span>&nbsp;<span class="op" id="8303154">=</span>&nbsp;<span class="op" id="8303156">&amp;</span><span class="ident" id="8303157">Args</span><span class="op" id="8303161">{</span><span class="num" id="8303162">7</span><span class="op" id="8303163">,</span>&nbsp;<span class="num" id="8303165">0</span><span class="op" id="8303166">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303169">reply</span>&nbsp;<span class="op" id="8303175">=</span>&nbsp;<span class="builtinfunc" id="8303177">new</span><span class="op" id="8303180">(</span><span class="ident" id="8303181">Reply</span><span class="op" id="8303186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303189">err</span>&nbsp;<span class="op" id="8303193">=</span>&nbsp;<span class="ident" id="8303195">client</span><span class="op" id="8303201">.</span><span class="ident" id="8303202">Call</span><span class="op" id="8303206">(</span><span class="string" id="8303207">&#34;Arith.Div&#34;</span><span class="op" id="8303218">,</span>&nbsp;<span class="ident" id="8303220">args</span><span class="op" id="8303224">,</span>&nbsp;<span class="ident" id="8303226">reply</span><span class="op" id="8303231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8303234">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303267">if</span>&nbsp;<span class="ident" id="8303270">err</span>&nbsp;<span class="op" id="8303274">==</span>&nbsp;<span class="builtintype" id="8303277">nil</span>&nbsp;<span class="op" id="8303281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303285">t</span><span class="op" id="8303286">.</span><span class="ident" id="8303287">Error</span><span class="op" id="8303292">(</span><span class="string" id="8303293">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8303314">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303317">}</span>&nbsp;<span class="keyword" id="8303319">else</span>&nbsp;<span class="keyword" id="8303324">if</span>&nbsp;<span class="ident" id="8303327">err</span><span class="op" id="8303330">.</span><span class="ident" id="8303331">Error</span><span class="op" id="8303336">(</span><span class="op" id="8303337">)</span>&nbsp;<span class="op" id="8303339">!=</span>&nbsp;<span class="string" id="8303342">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8303359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303363">t</span><span class="op" id="8303364">.</span><span class="ident" id="8303365">Error</span><span class="op" id="8303370">(</span><span class="string" id="8303371">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8303412">,</span>&nbsp;<span class="ident" id="8303414">err</span><span class="op" id="8303417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303420">}</span><br>
<span class="lineno"></span><span class="op" id="8303422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="8303425">func</span>&nbsp;<span class="ident" id="8303430">TestMalformedInput</span><span class="op" id="8303448">(</span><span class="ident" id="8303449">t</span>&nbsp;<span class="op" id="8303451">*</span><span class="ident" id="8303452">testing</span><span class="op" id="8303459">.</span><span class="ident" id="8303460">T</span><span class="op" id="8303461">)</span>&nbsp;<span class="op" id="8303463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303466">cli</span><span class="op" id="8303469">,</span>&nbsp;<span class="ident" id="8303471">srv</span>&nbsp;<span class="op" id="8303475">:=</span>&nbsp;<span class="ident" id="8303478">net</span><span class="op" id="8303481">.</span><span class="ident" id="8303482">Pipe</span><span class="op" id="8303486">(</span><span class="op" id="8303487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303490">go</span>&nbsp;<span class="ident" id="8303493">cli</span><span class="op" id="8303496">.</span><span class="ident" id="8303497">Write</span><span class="op" id="8303502">(</span><span class="op" id="8303503">[</span><span class="op" id="8303504">]</span><span class="builtintype" id="8303505">byte</span><span class="op" id="8303509">(</span><span class="string" id="8303510">`{id:1}`</span><span class="op" id="8303518">)</span><span class="op" id="8303519">)</span>&nbsp;<span class="comment" id="8303521">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303538">ServeConn</span><span class="op" id="8303547">(</span><span class="ident" id="8303548">srv</span><span class="op" id="8303551">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8303569">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8303594">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="8303597">func</span>&nbsp;<span class="ident" id="8303602">TestMalformedOutput</span><span class="op" id="8303621">(</span><span class="ident" id="8303622">t</span>&nbsp;<span class="op" id="8303624">*</span><span class="ident" id="8303625">testing</span><span class="op" id="8303632">.</span><span class="ident" id="8303633">T</span><span class="op" id="8303634">)</span>&nbsp;<span class="op" id="8303636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303639">cli</span><span class="op" id="8303642">,</span>&nbsp;<span class="ident" id="8303644">srv</span>&nbsp;<span class="op" id="8303648">:=</span>&nbsp;<span class="ident" id="8303651">net</span><span class="op" id="8303654">.</span><span class="ident" id="8303655">Pipe</span><span class="op" id="8303659">(</span><span class="op" id="8303660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303663">go</span>&nbsp;<span class="ident" id="8303666">srv</span><span class="op" id="8303669">.</span><span class="ident" id="8303670">Write</span><span class="op" id="8303675">(</span><span class="op" id="8303676">[</span><span class="op" id="8303677">]</span><span class="builtintype" id="8303678">byte</span><span class="op" id="8303682">(</span><span class="string" id="8303683">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="8303720">)</span><span class="op" id="8303721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303724">go</span>&nbsp;<span class="ident" id="8303727">ioutil</span><span class="op" id="8303733">.</span><span class="ident" id="8303734">ReadAll</span><span class="op" id="8303741">(</span><span class="ident" id="8303742">srv</span><span class="op" id="8303745">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303749">client</span>&nbsp;<span class="op" id="8303756">:=</span>&nbsp;<span class="ident" id="8303759">NewClient</span><span class="op" id="8303768">(</span><span class="ident" id="8303769">cli</span><span class="op" id="8303772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303775">defer</span>&nbsp;<span class="ident" id="8303781">client</span><span class="op" id="8303787">.</span><span class="ident" id="8303788">Close</span><span class="op" id="8303793">(</span><span class="op" id="8303794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303798">args</span>&nbsp;<span class="op" id="8303803">:=</span>&nbsp;<span class="op" id="8303806">&amp;</span><span class="ident" id="8303807">Args</span><span class="op" id="8303811">{</span><span class="num" id="8303812">7</span><span class="op" id="8303813">,</span>&nbsp;<span class="num" id="8303815">8</span><span class="op" id="8303816">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303819">reply</span>&nbsp;<span class="op" id="8303825">:=</span>&nbsp;<span class="builtinfunc" id="8303828">new</span><span class="op" id="8303831">(</span><span class="ident" id="8303832">Reply</span><span class="op" id="8303837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303840">err</span>&nbsp;<span class="op" id="8303844">:=</span>&nbsp;<span class="ident" id="8303847">client</span><span class="op" id="8303853">.</span><span class="ident" id="8303854">Call</span><span class="op" id="8303858">(</span><span class="string" id="8303859">&#34;Arith.Add&#34;</span><span class="op" id="8303870">,</span>&nbsp;<span class="ident" id="8303872">args</span><span class="op" id="8303876">,</span>&nbsp;<span class="ident" id="8303878">reply</span><span class="op" id="8303883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303886">if</span>&nbsp;<span class="ident" id="8303889">err</span>&nbsp;<span class="op" id="8303893">==</span>&nbsp;<span class="builtintype" id="8303896">nil</span>&nbsp;<span class="op" id="8303900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303904">t</span><span class="op" id="8303905">.</span><span class="ident" id="8303906">Error</span><span class="op" id="8303911">(</span><span class="string" id="8303912">&#34;expected&nbsp;error&#34;</span><span class="op" id="8303928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303931">}</span><br>
<span class="lineno">205</span><span class="op" id="8303933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8303936">func</span>&nbsp;<span class="ident" id="8303941">TestServerErrorHasNullResult</span><span class="op" id="8303969">(</span><span class="ident" id="8303970">t</span>&nbsp;<span class="op" id="8303972">*</span><span class="ident" id="8303973">testing</span><span class="op" id="8303980">.</span><span class="ident" id="8303981">T</span><span class="op" id="8303982">)</span>&nbsp;<span class="op" id="8303984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303987">var</span>&nbsp;<span class="ident" id="8303991">out</span>&nbsp;<span class="ident" id="8303995">bytes</span><span class="op" id="8304000">.</span><span class="ident" id="8304001">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304009">sc</span>&nbsp;<span class="op" id="8304012">:=</span>&nbsp;<span class="ident" id="8304015">NewServerCodec</span><span class="op" id="8304029">(</span><span class="keyword" id="8304030">struct</span>&nbsp;<span class="op" id="8304037">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304041">io</span><span class="op" id="8304043">.</span><span class="ident" id="8304044">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304053">io</span><span class="op" id="8304055">.</span><span class="ident" id="8304056">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304065">io</span><span class="op" id="8304067">.</span><span class="ident" id="8304068">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304076">}</span><span class="op" id="8304077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304081">Reader</span><span class="op" id="8304087">:</span>&nbsp;<span class="ident" id="8304089">strings</span><span class="op" id="8304096">.</span><span class="ident" id="8304097">NewReader</span><span class="op" id="8304106">(</span><span class="string" id="8304107">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="8304159">)</span><span class="op" id="8304160">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304164">Writer</span><span class="op" id="8304170">:</span>&nbsp;<span class="op" id="8304172">&amp;</span><span class="ident" id="8304173">out</span><span class="op" id="8304176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304180">Closer</span><span class="op" id="8304186">:</span>&nbsp;<span class="ident" id="8304188">ioutil</span><span class="op" id="8304194">.</span><span class="ident" id="8304195">NopCloser</span><span class="op" id="8304204">(</span><span class="builtintype" id="8304205">nil</span><span class="op" id="8304208">)</span><span class="op" id="8304209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304212">}</span><span class="op" id="8304213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304216">r</span>&nbsp;<span class="op" id="8304218">:=</span>&nbsp;<span class="builtinfunc" id="8304221">new</span><span class="op" id="8304224">(</span><span class="ident" id="8304225">rpc</span><span class="op" id="8304228">.</span><span class="ident" id="8304229">Request</span><span class="op" id="8304236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304239">if</span>&nbsp;<span class="ident" id="8304242">err</span>&nbsp;<span class="op" id="8304246">:=</span>&nbsp;<span class="ident" id="8304249">sc</span><span class="op" id="8304251">.</span><span class="ident" id="8304252">ReadRequestHeader</span><span class="op" id="8304269">(</span><span class="ident" id="8304270">r</span><span class="op" id="8304271">)</span><span class="op" id="8304272">;</span>&nbsp;<span class="ident" id="8304274">err</span>&nbsp;<span class="op" id="8304278">!=</span>&nbsp;<span class="builtintype" id="8304281">nil</span>&nbsp;<span class="op" id="8304285">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304289">t</span><span class="op" id="8304290">.</span><span class="ident" id="8304291">Fatal</span><span class="op" id="8304296">(</span><span class="ident" id="8304297">err</span><span class="op" id="8304300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304306">const</span>&nbsp;<span class="ident" id="8304312">valueText</span>&nbsp;<span class="op" id="8304322">=</span>&nbsp;<span class="string" id="8304324">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304358">const</span>&nbsp;<span class="ident" id="8304364">errorText</span>&nbsp;<span class="op" id="8304374">=</span>&nbsp;<span class="string" id="8304376">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304390">err</span>&nbsp;<span class="op" id="8304394">:=</span>&nbsp;<span class="ident" id="8304397">sc</span><span class="op" id="8304399">.</span><span class="ident" id="8304400">WriteResponse</span><span class="op" id="8304413">(</span><span class="op" id="8304414">&amp;</span><span class="ident" id="8304415">rpc</span><span class="op" id="8304418">.</span><span class="ident" id="8304419">Response</span><span class="op" id="8304427">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304431">ServiceMethod</span><span class="op" id="8304444">:</span>&nbsp;<span class="string" id="8304446">&#34;Method&#34;</span><span class="op" id="8304454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304458">Seq</span><span class="op" id="8304461">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8304473">1</span><span class="op" id="8304474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304478">Error</span><span class="op" id="8304483">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304493">errorText</span><span class="op" id="8304502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304505">}</span><span class="op" id="8304506">,</span>&nbsp;<span class="ident" id="8304508">valueText</span><span class="op" id="8304517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304520">if</span>&nbsp;<span class="ident" id="8304523">err</span>&nbsp;<span class="op" id="8304527">!=</span>&nbsp;<span class="builtintype" id="8304530">nil</span>&nbsp;<span class="op" id="8304534">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304538">t</span><span class="op" id="8304539">.</span><span class="ident" id="8304540">Fatal</span><span class="op" id="8304545">(</span><span class="ident" id="8304546">err</span><span class="op" id="8304549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304555">if</span>&nbsp;<span class="op" id="8304558">!</span><span class="ident" id="8304559">strings</span><span class="op" id="8304566">.</span><span class="ident" id="8304567">Contains</span><span class="op" id="8304575">(</span><span class="ident" id="8304576">out</span><span class="op" id="8304579">.</span><span class="ident" id="8304580">String</span><span class="op" id="8304586">(</span><span class="op" id="8304587">)</span><span class="op" id="8304588">,</span>&nbsp;<span class="ident" id="8304590">errorText</span><span class="op" id="8304599">)</span>&nbsp;<span class="op" id="8304601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304605">t</span><span class="op" id="8304606">.</span><span class="ident" id="8304607">Fatalf</span><span class="op" id="8304613">(</span><span class="string" id="8304614">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="8304661">,</span>&nbsp;<span class="ident" id="8304663">errorText</span><span class="op" id="8304672">,</span>&nbsp;<span class="op" id="8304674">&amp;</span><span class="ident" id="8304675">out</span><span class="op" id="8304678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304681">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304684">if</span>&nbsp;<span class="ident" id="8304687">strings</span><span class="op" id="8304694">.</span><span class="ident" id="8304695">Contains</span><span class="op" id="8304703">(</span><span class="ident" id="8304704">out</span><span class="op" id="8304707">.</span><span class="ident" id="8304708">String</span><span class="op" id="8304714">(</span><span class="op" id="8304715">)</span><span class="op" id="8304716">,</span>&nbsp;<span class="ident" id="8304718">valueText</span><span class="op" id="8304727">)</span>&nbsp;<span class="op" id="8304729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304733">t</span><span class="op" id="8304734">.</span><span class="ident" id="8304735">Errorf</span><span class="op" id="8304741">(</span><span class="string" id="8304742">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="8304789">,</span>&nbsp;<span class="op" id="8304791">&amp;</span><span class="ident" id="8304792">out</span><span class="op" id="8304795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304798">}</span><br>
<span class="lineno"></span><span class="op" id="8304800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8304803">func</span>&nbsp;<span class="ident" id="8304808">TestUnexpectedError</span><span class="op" id="8304827">(</span><span class="ident" id="8304828">t</span>&nbsp;<span class="op" id="8304830">*</span><span class="ident" id="8304831">testing</span><span class="op" id="8304838">.</span><span class="ident" id="8304839">T</span><span class="op" id="8304840">)</span>&nbsp;<span class="op" id="8304842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304845">cli</span><span class="op" id="8304848">,</span>&nbsp;<span class="ident" id="8304850">srv</span>&nbsp;<span class="op" id="8304854">:=</span>&nbsp;<span class="ident" id="8304857">myPipe</span><span class="op" id="8304863">(</span><span class="op" id="8304864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304867">go</span>&nbsp;<span class="ident" id="8304870">cli</span><span class="op" id="8304873">.</span><span class="ident" id="8304874">PipeWriter</span><span class="op" id="8304884">.</span><span class="ident" id="8304885">CloseWithError</span><span class="op" id="8304899">(</span><span class="ident" id="8304900">errors</span><span class="op" id="8304906">.</span><span class="ident" id="8304907">New</span><span class="op" id="8304910">(</span><span class="string" id="8304911">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="8304930">)</span><span class="op" id="8304931">)</span>&nbsp;<span class="comment" id="8304933">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304964">ServeConn</span><span class="op" id="8304973">(</span><span class="ident" id="8304974">srv</span><span class="op" id="8304977">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8305030">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8305055">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8305058">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="8305086">func</span>&nbsp;<span class="ident" id="8305091">myPipe</span><span class="op" id="8305097">(</span><span class="op" id="8305098">)</span>&nbsp;<span class="op" id="8305100">(</span><span class="op" id="8305101">*</span><span class="ident" id="8305102">pipe</span><span class="op" id="8305106">,</span>&nbsp;<span class="op" id="8305108">*</span><span class="ident" id="8305109">pipe</span><span class="op" id="8305113">)</span>&nbsp;<span class="op" id="8305115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305118">r1</span><span class="op" id="8305120">,</span>&nbsp;<span class="ident" id="8305122">w1</span>&nbsp;<span class="op" id="8305125">:=</span>&nbsp;<span class="ident" id="8305128">io</span><span class="op" id="8305130">.</span><span class="ident" id="8305131">Pipe</span><span class="op" id="8305135">(</span><span class="op" id="8305136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305139">r2</span><span class="op" id="8305141">,</span>&nbsp;<span class="ident" id="8305143">w2</span>&nbsp;<span class="op" id="8305146">:=</span>&nbsp;<span class="ident" id="8305149">io</span><span class="op" id="8305151">.</span><span class="ident" id="8305152">Pipe</span><span class="op" id="8305156">(</span><span class="op" id="8305157">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305161">return</span>&nbsp;<span class="op" id="8305168">&amp;</span><span class="ident" id="8305169">pipe</span><span class="op" id="8305173">{</span><span class="ident" id="8305174">r1</span><span class="op" id="8305176">,</span>&nbsp;<span class="ident" id="8305178">w2</span><span class="op" id="8305180">}</span><span class="op" id="8305181">,</span>&nbsp;<span class="op" id="8305183">&amp;</span><span class="ident" id="8305184">pipe</span><span class="op" id="8305188">{</span><span class="ident" id="8305189">r2</span><span class="op" id="8305191">,</span>&nbsp;<span class="ident" id="8305193">w1</span><span class="op" id="8305195">}</span><br>
<span class="lineno"></span><span class="op" id="8305197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305200">type</span>&nbsp;<span class="ident" id="8305205">pipe</span>&nbsp;<span class="keyword" id="8305210">struct</span>&nbsp;<span class="op" id="8305217">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305220">*</span><span class="ident" id="8305221">io</span><span class="op" id="8305223">.</span><span class="ident" id="8305224">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305236">*</span><span class="ident" id="8305237">io</span><span class="op" id="8305239">.</span><span class="ident" id="8305240">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="8305251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305254">type</span>&nbsp;<span class="ident" id="8305259">pipeAddr</span>&nbsp;<span class="builtintype" id="8305268">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="8305273">func</span>&nbsp;<span class="op" id="8305278">(</span><span class="ident" id="8305279">pipeAddr</span><span class="op" id="8305287">)</span>&nbsp;<span class="ident" id="8305289">Network</span><span class="op" id="8305296">(</span><span class="op" id="8305297">)</span>&nbsp;<span class="builtintype" id="8305299">string</span>&nbsp;<span class="op" id="8305306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305309">return</span>&nbsp;<span class="string" id="8305316">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8305323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="8305326">func</span>&nbsp;<span class="op" id="8305331">(</span><span class="ident" id="8305332">pipeAddr</span><span class="op" id="8305340">)</span>&nbsp;<span class="ident" id="8305342">String</span><span class="op" id="8305348">(</span><span class="op" id="8305349">)</span>&nbsp;<span class="builtintype" id="8305351">string</span>&nbsp;<span class="op" id="8305358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305361">return</span>&nbsp;<span class="string" id="8305368">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8305375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305378">func</span>&nbsp;<span class="op" id="8305383">(</span><span class="ident" id="8305384">p</span>&nbsp;<span class="op" id="8305386">*</span><span class="ident" id="8305387">pipe</span><span class="op" id="8305391">)</span>&nbsp;<span class="ident" id="8305393">Close</span><span class="op" id="8305398">(</span><span class="op" id="8305399">)</span>&nbsp;<span class="builtintype" id="8305401">error</span>&nbsp;<span class="op" id="8305407">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305410">err</span>&nbsp;<span class="op" id="8305414">:=</span>&nbsp;<span class="ident" id="8305417">p</span><span class="op" id="8305418">.</span><span class="ident" id="8305419">PipeReader</span><span class="op" id="8305429">.</span><span class="ident" id="8305430">Close</span><span class="op" id="8305435">(</span><span class="op" id="8305436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305439">err1</span>&nbsp;<span class="op" id="8305444">:=</span>&nbsp;<span class="ident" id="8305447">p</span><span class="op" id="8305448">.</span><span class="ident" id="8305449">PipeWriter</span><span class="op" id="8305459">.</span><span class="ident" id="8305460">Close</span><span class="op" id="8305465">(</span><span class="op" id="8305466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305469">if</span>&nbsp;<span class="ident" id="8305472">err</span>&nbsp;<span class="op" id="8305476">==</span>&nbsp;<span class="builtintype" id="8305479">nil</span>&nbsp;<span class="op" id="8305483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305487">err</span>&nbsp;<span class="op" id="8305491">=</span>&nbsp;<span class="ident" id="8305493">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305499">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305502">return</span>&nbsp;<span class="ident" id="8305509">err</span><br>
<span class="lineno"></span><span class="op" id="8305513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305516">func</span>&nbsp;<span class="op" id="8305521">(</span><span class="ident" id="8305522">p</span>&nbsp;<span class="op" id="8305524">*</span><span class="ident" id="8305525">pipe</span><span class="op" id="8305529">)</span>&nbsp;<span class="ident" id="8305531">LocalAddr</span><span class="op" id="8305540">(</span><span class="op" id="8305541">)</span>&nbsp;<span class="ident" id="8305543">net</span><span class="op" id="8305546">.</span><span class="ident" id="8305547">Addr</span>&nbsp;<span class="op" id="8305552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305555">return</span>&nbsp;<span class="ident" id="8305562">pipeAddr</span><span class="op" id="8305570">(</span><span class="num" id="8305571">0</span><span class="op" id="8305572">)</span><br>
<span class="lineno">280</span><span class="op" id="8305574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305577">func</span>&nbsp;<span class="op" id="8305582">(</span><span class="ident" id="8305583">p</span>&nbsp;<span class="op" id="8305585">*</span><span class="ident" id="8305586">pipe</span><span class="op" id="8305590">)</span>&nbsp;<span class="ident" id="8305592">RemoteAddr</span><span class="op" id="8305602">(</span><span class="op" id="8305603">)</span>&nbsp;<span class="ident" id="8305605">net</span><span class="op" id="8305608">.</span><span class="ident" id="8305609">Addr</span>&nbsp;<span class="op" id="8305614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305617">return</span>&nbsp;<span class="ident" id="8305624">pipeAddr</span><span class="op" id="8305632">(</span><span class="num" id="8305633">0</span><span class="op" id="8305634">)</span><br>
<span class="lineno"></span><span class="op" id="8305636">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="8305639">func</span>&nbsp;<span class="op" id="8305644">(</span><span class="ident" id="8305645">p</span>&nbsp;<span class="op" id="8305647">*</span><span class="ident" id="8305648">pipe</span><span class="op" id="8305652">)</span>&nbsp;<span class="ident" id="8305654">SetTimeout</span><span class="op" id="8305664">(</span><span class="ident" id="8305665">nsec</span>&nbsp;<span class="builtintype" id="8305670">int64</span><span class="op" id="8305675">)</span>&nbsp;<span class="builtintype" id="8305677">error</span>&nbsp;<span class="op" id="8305683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305686">return</span>&nbsp;<span class="ident" id="8305693">errors</span><span class="op" id="8305699">.</span><span class="ident" id="8305700">New</span><span class="op" id="8305703">(</span><span class="string" id="8305704">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8305740">)</span><br>
<span class="lineno"></span><span class="op" id="8305742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="8305745">func</span>&nbsp;<span class="op" id="8305750">(</span><span class="ident" id="8305751">p</span>&nbsp;<span class="op" id="8305753">*</span><span class="ident" id="8305754">pipe</span><span class="op" id="8305758">)</span>&nbsp;<span class="ident" id="8305760">SetReadTimeout</span><span class="op" id="8305774">(</span><span class="ident" id="8305775">nsec</span>&nbsp;<span class="builtintype" id="8305780">int64</span><span class="op" id="8305785">)</span>&nbsp;<span class="builtintype" id="8305787">error</span>&nbsp;<span class="op" id="8305793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305796">return</span>&nbsp;<span class="ident" id="8305803">errors</span><span class="op" id="8305809">.</span><span class="ident" id="8305810">New</span><span class="op" id="8305813">(</span><span class="string" id="8305814">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8305850">)</span><br>
<span class="lineno"></span><span class="op" id="8305852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305855">func</span>&nbsp;<span class="op" id="8305860">(</span><span class="ident" id="8305861">p</span>&nbsp;<span class="op" id="8305863">*</span><span class="ident" id="8305864">pipe</span><span class="op" id="8305868">)</span>&nbsp;<span class="ident" id="8305870">SetWriteTimeout</span><span class="op" id="8305885">(</span><span class="ident" id="8305886">nsec</span>&nbsp;<span class="builtintype" id="8305891">int64</span><span class="op" id="8305896">)</span>&nbsp;<span class="builtintype" id="8305898">error</span>&nbsp;<span class="op" id="8305904">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305907">return</span>&nbsp;<span class="ident" id="8305914">errors</span><span class="op" id="8305920">.</span><span class="ident" id="8305921">New</span><span class="op" id="8305924">(</span><span class="string" id="8305925">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8305961">)</span><br>
<span class="lineno"></span><span class="op" id="8305963">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
