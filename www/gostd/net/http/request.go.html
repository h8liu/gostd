<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html" class="current">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1383435">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1383490">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1383544">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1383595">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1383633">package</span>&nbsp;<span class="ident" id="1383641">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1383647">import</span>&nbsp;<span class="op" id="1383654">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383657">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383666">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383675">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383689">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383708">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383718">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383725">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383731">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383744">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383752">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383770">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383787">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383798">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383809">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1383820">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="1383827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1383830">const</span>&nbsp;<span class="op" id="1383836">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383839">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1383856">=</span>&nbsp;<span class="num" id="1383858">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383864">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1383881">=</span>&nbsp;<span class="num" id="1383883">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383889">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1383906">=</span>&nbsp;<span class="num" id="1383908">4</span>&nbsp;<span class="op" id="1383910">&lt;&lt;</span>&nbsp;<span class="num" id="1383913">10</span>&nbsp;&nbsp;<span class="comment" id="1383917">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383933">defaultMaxMemory</span>&nbsp;<span class="op" id="1383950">=</span>&nbsp;<span class="num" id="1383952">32</span>&nbsp;<span class="op" id="1383955">&lt;&lt;</span>&nbsp;<span class="num" id="1383958">20</span>&nbsp;<span class="comment" id="1383961">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="1383970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1383973">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="1384049">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="1384110">var</span>&nbsp;<span class="ident" id="1384114">ErrMissingFile</span>&nbsp;<span class="op" id="1384129">=</span>&nbsp;<span class="ident" id="1384131">errors</span><span class="op" id="1384137">.</span><span class="ident" id="1384138">New</span><span class="op" id="1384141">(</span><span class="string" id="1384142">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="1384162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1384165">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="1384197">type</span>&nbsp;<span class="ident" id="1384202">ProtocolError</span>&nbsp;<span class="keyword" id="1384216">struct</span>&nbsp;<span class="op" id="1384223">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384226">ErrorString</span>&nbsp;<span class="builtintype" id="1384238">string</span><br>
<span class="lineno"></span><span class="op" id="1384245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1384248">func</span>&nbsp;<span class="op" id="1384253">(</span><span class="ident" id="1384254">err</span>&nbsp;<span class="op" id="1384258">*</span><span class="ident" id="1384259">ProtocolError</span><span class="op" id="1384272">)</span>&nbsp;<span class="ident" id="1384274">Error</span><span class="op" id="1384279">(</span><span class="op" id="1384280">)</span>&nbsp;<span class="builtintype" id="1384282">string</span>&nbsp;<span class="op" id="1384289">{</span>&nbsp;<span class="keyword" id="1384291">return</span>&nbsp;<span class="ident" id="1384298">err</span><span class="op" id="1384301">.</span><span class="ident" id="1384302">ErrorString</span>&nbsp;<span class="op" id="1384314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1384317">var</span>&nbsp;<span class="op" id="1384321">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384324">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1384348">=</span>&nbsp;<span class="op" id="1384350">&amp;</span><span class="ident" id="1384351">ProtocolError</span><span class="op" id="1384364">{</span><span class="string" id="1384365">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="1384382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384385">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1384409">=</span>&nbsp;<span class="op" id="1384411">&amp;</span><span class="ident" id="1384412">ProtocolError</span><span class="op" id="1384425">{</span><span class="string" id="1384426">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="1384449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384452">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1384476">=</span>&nbsp;<span class="op" id="1384478">&amp;</span><span class="ident" id="1384479">ProtocolError</span><span class="op" id="1384492">{</span><span class="string" id="1384493">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="1384516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384519">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1384543">=</span>&nbsp;<span class="op" id="1384545">&amp;</span><span class="ident" id="1384546">ProtocolError</span><span class="op" id="1384559">{</span><span class="string" id="1384560">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="1384610">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384613">ErrMissingContentLength</span>&nbsp;<span class="op" id="1384637">=</span>&nbsp;<span class="op" id="1384639">&amp;</span><span class="ident" id="1384640">ProtocolError</span><span class="op" id="1384653">{</span><span class="string" id="1384654">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="1384694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384697">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1384721">=</span>&nbsp;<span class="op" id="1384723">&amp;</span><span class="ident" id="1384724">ProtocolError</span><span class="op" id="1384737">{</span><span class="string" id="1384738">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="1384786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384789">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1384813">=</span>&nbsp;<span class="op" id="1384815">&amp;</span><span class="ident" id="1384816">ProtocolError</span><span class="op" id="1384829">{</span><span class="string" id="1384830">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="1384875">}</span><br>
<span class="lineno"></span><span class="op" id="1384877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="1384880">type</span>&nbsp;<span class="ident" id="1384885">badStringError</span>&nbsp;<span class="keyword" id="1384900">struct</span>&nbsp;<span class="op" id="1384907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384910">what</span>&nbsp;<span class="builtintype" id="1384915">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384923">str</span>&nbsp;&nbsp;<span class="builtintype" id="1384928">string</span><br>
<span class="lineno"></span><span class="op" id="1384935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="1384938">func</span>&nbsp;<span class="op" id="1384943">(</span><span class="ident" id="1384944">e</span>&nbsp;<span class="op" id="1384946">*</span><span class="ident" id="1384947">badStringError</span><span class="op" id="1384961">)</span>&nbsp;<span class="ident" id="1384963">Error</span><span class="op" id="1384968">(</span><span class="op" id="1384969">)</span>&nbsp;<span class="builtintype" id="1384971">string</span>&nbsp;<span class="op" id="1384978">{</span>&nbsp;<span class="keyword" id="1384980">return</span>&nbsp;<span class="ident" id="1384987">fmt</span><span class="op" id="1384990">.</span><span class="ident" id="1384991">Sprintf</span><span class="op" id="1384998">(</span><span class="string" id="1384999">&#34;%s&nbsp;%q&#34;</span><span class="op" id="1385006">,</span>&nbsp;<span class="ident" id="1385008">e</span><span class="op" id="1385009">.</span><span class="ident" id="1385010">what</span><span class="op" id="1385014">,</span>&nbsp;<span class="ident" id="1385016">e</span><span class="op" id="1385017">.</span><span class="ident" id="1385018">str</span><span class="op" id="1385021">)</span>&nbsp;<span class="op" id="1385023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1385026">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="1385094">var</span>&nbsp;<span class="ident" id="1385098">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="1385120">=</span>&nbsp;<span class="keyword" id="1385122">map</span><span class="op" id="1385125">[</span><span class="builtintype" id="1385126">string</span><span class="op" id="1385132">]</span><span class="builtintype" id="1385133">bool</span><span class="op" id="1385137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1385140">&#34;Host&#34;</span><span class="op" id="1385146">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1385161">true</span><span class="op" id="1385165">,</span>&nbsp;<span class="comment" id="1385167">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1385196">&#34;User-Agent&#34;</span><span class="op" id="1385208">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1385217">true</span><span class="op" id="1385221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1385224">&#34;Content-Length&#34;</span><span class="op" id="1385240">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1385245">true</span><span class="op" id="1385249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1385252">&#34;Transfer-Encoding&#34;</span><span class="op" id="1385271">:</span>&nbsp;<span class="builtintype" id="1385273">true</span><span class="op" id="1385277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1385280">&#34;Trailer&#34;</span><span class="op" id="1385289">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1385301">true</span><span class="op" id="1385305">,</span><br>
<span class="lineno"></span><span class="op" id="1385307">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="1385310">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="1385371">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="1385401">//</span><br>
<span class="lineno"></span><span class="comment" id="1385404">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="1385469">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1385533">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="1385586">type</span>&nbsp;<span class="ident" id="1385591">Request</span>&nbsp;<span class="keyword" id="1385599">struct</span>&nbsp;<span class="op" id="1385606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385609">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385670">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1385721">Method</span>&nbsp;<span class="builtintype" id="1385728">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385737">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385798">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385856">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385860">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385915">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1385978">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386041">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386082">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386086">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386150">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386208">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386264">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386277">URL</span>&nbsp;<span class="op" id="1386281">*</span><span class="ident" id="1386282">url</span><span class="op" id="1386285">.</span><span class="ident" id="1386286">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386292">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386340">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386381">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1386392">string</span>&nbsp;<span class="comment" id="1386399">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386414">ProtoMajor</span>&nbsp;<span class="builtintype" id="1386425">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1386432">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1386438">ProtoMinor</span>&nbsp;<span class="builtintype" id="1386449">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1386456">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386463">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386512">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386535">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386539">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386574">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386601">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386628">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386632">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386641">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386645">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386679">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386722">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386757">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386792">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386798">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386802">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386859">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386920">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1386976">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387033">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387037">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387095">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387140">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387144">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387200">Header</span>&nbsp;<span class="ident" id="1387207">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387216">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387248">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387252">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387312">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387373">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387422">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387426">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387485">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387546">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387604">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387634">Body</span>&nbsp;<span class="ident" id="1387639">io</span><span class="op" id="1387641">.</span><span class="ident" id="1387642">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387655">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387719">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387774">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387834">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387857">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1387929">ContentLength</span>&nbsp;<span class="ident" id="1387943">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1387951">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388019">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388081">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388146">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388212">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388236">TransferEncoding</span>&nbsp;<span class="op" id="1388253">[</span><span class="op" id="1388254">]</span><span class="builtintype" id="1388255">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388264">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388322">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388382">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388413">Close</span>&nbsp;<span class="builtintype" id="1388419">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388426">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388487">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388548">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388612">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388651">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388655">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388714">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388774">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1388801">Host</span>&nbsp;<span class="builtintype" id="1388806">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388815">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388878">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388938">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1388998">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389054">Form</span>&nbsp;<span class="ident" id="1389059">url</span><span class="op" id="1389062">.</span><span class="ident" id="1389063">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389072">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389132">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389153">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389213">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389273">PostForm</span>&nbsp;<span class="ident" id="1389282">url</span><span class="op" id="1389285">.</span><span class="ident" id="1389286">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389295">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389367">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389436">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1389501">MultipartForm</span>&nbsp;<span class="op" id="1389515">*</span><span class="ident" id="1389516">multipart</span><span class="op" id="1389525">.</span><span class="ident" id="1389526">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389533">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389606">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389616">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389620">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389688">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389762">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389833">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389905">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389978">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1389997">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390001">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390073">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390146">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390220">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390291">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390364">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390388">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390392">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390457">Trailer</span>&nbsp;<span class="ident" id="1390465">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390474">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390538">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390597">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390657">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390716">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390778">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390791">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390837">RemoteAddr</span>&nbsp;<span class="builtintype" id="1390848">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390857">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390909">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390972">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391035">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391099">RequestURI</span>&nbsp;<span class="builtintype" id="1391110">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391119">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391176">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391238">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391300">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391355">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391410">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391449">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391495">TLS</span>&nbsp;<span class="op" id="1391499">*</span><span class="ident" id="1391500">tls</span><span class="op" id="1391503">.</span><span class="ident" id="1391504">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="1391520">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1391523">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="1391578">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="1391621">func</span>&nbsp;<span class="op" id="1391626">(</span><span class="ident" id="1391627">r</span>&nbsp;<span class="op" id="1391629">*</span><span class="ident" id="1391630">Request</span><span class="op" id="1391637">)</span>&nbsp;<span class="ident" id="1391639">ProtoAtLeast</span><span class="op" id="1391651">(</span><span class="ident" id="1391652">major</span><span class="op" id="1391657">,</span>&nbsp;<span class="ident" id="1391659">minor</span>&nbsp;<span class="builtintype" id="1391665">int</span><span class="op" id="1391668">)</span>&nbsp;<span class="builtintype" id="1391670">bool</span>&nbsp;<span class="op" id="1391675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391678">return</span>&nbsp;<span class="ident" id="1391685">r</span><span class="op" id="1391686">.</span><span class="ident" id="1391687">ProtoMajor</span>&nbsp;<span class="op" id="1391698">&gt;</span>&nbsp;<span class="ident" id="1391700">major</span>&nbsp;<span class="op" id="1391706">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391711">r</span><span class="op" id="1391712">.</span><span class="ident" id="1391713">ProtoMajor</span>&nbsp;<span class="op" id="1391724">==</span>&nbsp;<span class="ident" id="1391727">major</span>&nbsp;<span class="op" id="1391733">&amp;&amp;</span>&nbsp;<span class="ident" id="1391736">r</span><span class="op" id="1391737">.</span><span class="ident" id="1391738">ProtoMinor</span>&nbsp;<span class="op" id="1391749">&gt;=</span>&nbsp;<span class="ident" id="1391752">minor</span><br>
<span class="lineno"></span><span class="op" id="1391758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1391761">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="1391831">func</span>&nbsp;<span class="op" id="1391836">(</span><span class="ident" id="1391837">r</span>&nbsp;<span class="op" id="1391839">*</span><span class="ident" id="1391840">Request</span><span class="op" id="1391847">)</span>&nbsp;<span class="ident" id="1391849">UserAgent</span><span class="op" id="1391858">(</span><span class="op" id="1391859">)</span>&nbsp;<span class="builtintype" id="1391861">string</span>&nbsp;<span class="op" id="1391868">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391871">return</span>&nbsp;<span class="ident" id="1391878">r</span><span class="op" id="1391879">.</span><span class="ident" id="1391880">Header</span><span class="op" id="1391886">.</span><span class="ident" id="1391887">Get</span><span class="op" id="1391890">(</span><span class="string" id="1391891">&#34;User-Agent&#34;</span><span class="op" id="1391903">)</span><br>
<span class="lineno"></span><span class="op" id="1391905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1391908">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="1391978">func</span>&nbsp;<span class="op" id="1391983">(</span><span class="ident" id="1391984">r</span>&nbsp;<span class="op" id="1391986">*</span><span class="ident" id="1391987">Request</span><span class="op" id="1391994">)</span>&nbsp;<span class="ident" id="1391996">Cookies</span><span class="op" id="1392003">(</span><span class="op" id="1392004">)</span>&nbsp;<span class="op" id="1392006">[</span><span class="op" id="1392007">]</span><span class="op" id="1392008">*</span><span class="ident" id="1392009">Cookie</span>&nbsp;<span class="op" id="1392016">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392019">return</span>&nbsp;<span class="ident" id="1392026">readCookies</span><span class="op" id="1392037">(</span><span class="ident" id="1392038">r</span><span class="op" id="1392039">.</span><span class="ident" id="1392040">Header</span><span class="op" id="1392046">,</span>&nbsp;<span class="string" id="1392048">&#34;&#34;</span><span class="op" id="1392050">)</span><br>
<span class="lineno"></span><span class="op" id="1392052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1392055">var</span>&nbsp;<span class="ident" id="1392059">ErrNoCookie</span>&nbsp;<span class="op" id="1392071">=</span>&nbsp;<span class="ident" id="1392073">errors</span><span class="op" id="1392079">.</span><span class="ident" id="1392080">New</span><span class="op" id="1392083">(</span><span class="string" id="1392084">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="1392116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="1392119">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1392181">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="1392210">func</span>&nbsp;<span class="op" id="1392215">(</span><span class="ident" id="1392216">r</span>&nbsp;<span class="op" id="1392218">*</span><span class="ident" id="1392219">Request</span><span class="op" id="1392226">)</span>&nbsp;<span class="ident" id="1392228">Cookie</span><span class="op" id="1392234">(</span><span class="ident" id="1392235">name</span>&nbsp;<span class="builtintype" id="1392240">string</span><span class="op" id="1392246">)</span>&nbsp;<span class="op" id="1392248">(</span><span class="op" id="1392249">*</span><span class="ident" id="1392250">Cookie</span><span class="op" id="1392256">,</span>&nbsp;<span class="builtintype" id="1392258">error</span><span class="op" id="1392263">)</span>&nbsp;<span class="op" id="1392265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392268">for</span>&nbsp;<span class="ident" id="1392272">_</span><span class="op" id="1392273">,</span>&nbsp;<span class="ident" id="1392275">c</span>&nbsp;<span class="op" id="1392277">:=</span>&nbsp;<span class="keyword" id="1392280">range</span>&nbsp;<span class="ident" id="1392286">readCookies</span><span class="op" id="1392297">(</span><span class="ident" id="1392298">r</span><span class="op" id="1392299">.</span><span class="ident" id="1392300">Header</span><span class="op" id="1392306">,</span>&nbsp;<span class="ident" id="1392308">name</span><span class="op" id="1392312">)</span>&nbsp;<span class="op" id="1392314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392318">return</span>&nbsp;<span class="ident" id="1392325">c</span><span class="op" id="1392326">,</span>&nbsp;<span class="ident" id="1392328">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392336">return</span>&nbsp;<span class="ident" id="1392343">nil</span><span class="op" id="1392346">,</span>&nbsp;<span class="ident" id="1392348">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="1392360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1392363">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="1392433">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="1392503">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="1392565">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="1392592">func</span>&nbsp;<span class="op" id="1392597">(</span><span class="ident" id="1392598">r</span>&nbsp;<span class="op" id="1392600">*</span><span class="ident" id="1392601">Request</span><span class="op" id="1392608">)</span>&nbsp;<span class="ident" id="1392610">AddCookie</span><span class="op" id="1392619">(</span><span class="ident" id="1392620">c</span>&nbsp;<span class="op" id="1392622">*</span><span class="ident" id="1392623">Cookie</span><span class="op" id="1392629">)</span>&nbsp;<span class="op" id="1392631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392634">s</span>&nbsp;<span class="op" id="1392636">:=</span>&nbsp;<span class="ident" id="1392639">fmt</span><span class="op" id="1392642">.</span><span class="ident" id="1392643">Sprintf</span><span class="op" id="1392650">(</span><span class="string" id="1392651">&#34;%s=%s&#34;</span><span class="op" id="1392658">,</span>&nbsp;<span class="ident" id="1392660">sanitizeCookieName</span><span class="op" id="1392678">(</span><span class="ident" id="1392679">c</span><span class="op" id="1392680">.</span><span class="ident" id="1392681">Name</span><span class="op" id="1392685">)</span><span class="op" id="1392686">,</span>&nbsp;<span class="ident" id="1392688">sanitizeCookieValue</span><span class="op" id="1392707">(</span><span class="ident" id="1392708">c</span><span class="op" id="1392709">.</span><span class="ident" id="1392710">Value</span><span class="op" id="1392715">)</span><span class="op" id="1392716">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392719">if</span>&nbsp;<span class="ident" id="1392722">c</span>&nbsp;<span class="op" id="1392724">:=</span>&nbsp;<span class="ident" id="1392727">r</span><span class="op" id="1392728">.</span><span class="ident" id="1392729">Header</span><span class="op" id="1392735">.</span><span class="ident" id="1392736">Get</span><span class="op" id="1392739">(</span><span class="string" id="1392740">&#34;Cookie&#34;</span><span class="op" id="1392748">)</span><span class="op" id="1392749">;</span>&nbsp;<span class="ident" id="1392751">c</span>&nbsp;<span class="op" id="1392753">!=</span>&nbsp;<span class="string" id="1392756">&#34;&#34;</span>&nbsp;<span class="op" id="1392759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392763">r</span><span class="op" id="1392764">.</span><span class="ident" id="1392765">Header</span><span class="op" id="1392771">.</span><span class="ident" id="1392772">Set</span><span class="op" id="1392775">(</span><span class="string" id="1392776">&#34;Cookie&#34;</span><span class="op" id="1392784">,</span>&nbsp;<span class="ident" id="1392786">c</span><span class="op" id="1392787">+</span><span class="string" id="1392788">&#34;;&nbsp;&#34;</span><span class="op" id="1392792">+</span><span class="ident" id="1392793">s</span><span class="op" id="1392794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392797">}</span>&nbsp;<span class="keyword" id="1392799">else</span>&nbsp;<span class="op" id="1392804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392808">r</span><span class="op" id="1392809">.</span><span class="ident" id="1392810">Header</span><span class="op" id="1392816">.</span><span class="ident" id="1392817">Set</span><span class="op" id="1392820">(</span><span class="string" id="1392821">&#34;Cookie&#34;</span><span class="op" id="1392829">,</span>&nbsp;<span class="ident" id="1392831">s</span><span class="op" id="1392832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392835">}</span><br>
<span class="lineno">270</span><span class="op" id="1392837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1392840">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="1392902">//</span><br>
<span class="lineno"></span><span class="comment" id="1392905">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="1392975">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1393042">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="1393113">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1393184">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="1393250">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="1393300">func</span>&nbsp;<span class="op" id="1393305">(</span><span class="ident" id="1393306">r</span>&nbsp;<span class="op" id="1393308">*</span><span class="ident" id="1393309">Request</span><span class="op" id="1393316">)</span>&nbsp;<span class="ident" id="1393318">Referer</span><span class="op" id="1393325">(</span><span class="op" id="1393326">)</span>&nbsp;<span class="builtintype" id="1393328">string</span>&nbsp;<span class="op" id="1393335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393338">return</span>&nbsp;<span class="ident" id="1393345">r</span><span class="op" id="1393346">.</span><span class="ident" id="1393347">Header</span><span class="op" id="1393353">.</span><span class="ident" id="1393354">Get</span><span class="op" id="1393357">(</span><span class="string" id="1393358">&#34;Referer&#34;</span><span class="op" id="1393367">)</span><br>
<span class="lineno"></span><span class="op" id="1393369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1393372">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="1393414">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="1393493">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="1393573">var</span>&nbsp;<span class="ident" id="1393577">multipartByReader</span>&nbsp;<span class="op" id="1393595">=</span>&nbsp;<span class="op" id="1393597">&amp;</span><span class="ident" id="1393598">multipart</span><span class="op" id="1393607">.</span><span class="ident" id="1393608">Form</span><span class="op" id="1393612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393615">Value</span><span class="op" id="1393620">:</span>&nbsp;<span class="builtinfunc" id="1393622">make</span><span class="op" id="1393626">(</span><span class="keyword" id="1393627">map</span><span class="op" id="1393630">[</span><span class="builtintype" id="1393631">string</span><span class="op" id="1393637">]</span><span class="op" id="1393638">[</span><span class="op" id="1393639">]</span><span class="builtintype" id="1393640">string</span><span class="op" id="1393646">)</span><span class="op" id="1393647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393650">File</span><span class="op" id="1393654">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="1393657">make</span><span class="op" id="1393661">(</span><span class="keyword" id="1393662">map</span><span class="op" id="1393665">[</span><span class="builtintype" id="1393666">string</span><span class="op" id="1393672">]</span><span class="op" id="1393673">[</span><span class="op" id="1393674">]</span><span class="op" id="1393675">*</span><span class="ident" id="1393676">multipart</span><span class="op" id="1393685">.</span><span class="ident" id="1393686">FileHeader</span><span class="op" id="1393696">)</span><span class="op" id="1393697">,</span><br>
<span class="lineno">290</span><span class="op" id="1393699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1393702">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1393766">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="1393834">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="1393888">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="1393929">func</span>&nbsp;<span class="op" id="1393934">(</span><span class="ident" id="1393935">r</span>&nbsp;<span class="op" id="1393937">*</span><span class="ident" id="1393938">Request</span><span class="op" id="1393945">)</span>&nbsp;<span class="ident" id="1393947">MultipartReader</span><span class="op" id="1393962">(</span><span class="op" id="1393963">)</span>&nbsp;<span class="op" id="1393965">(</span><span class="op" id="1393966">*</span><span class="ident" id="1393967">multipart</span><span class="op" id="1393976">.</span><span class="ident" id="1393977">Reader</span><span class="op" id="1393983">,</span>&nbsp;<span class="builtintype" id="1393985">error</span><span class="op" id="1393990">)</span>&nbsp;<span class="op" id="1393992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393995">if</span>&nbsp;<span class="ident" id="1393998">r</span><span class="op" id="1393999">.</span><span class="ident" id="1394000">MultipartForm</span>&nbsp;<span class="op" id="1394014">==</span>&nbsp;<span class="ident" id="1394017">multipartByReader</span>&nbsp;<span class="op" id="1394035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394039">return</span>&nbsp;<span class="ident" id="1394046">nil</span><span class="op" id="1394049">,</span>&nbsp;<span class="ident" id="1394051">errors</span><span class="op" id="1394057">.</span><span class="ident" id="1394058">New</span><span class="op" id="1394061">(</span><span class="string" id="1394062">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="1394098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394101">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394104">if</span>&nbsp;<span class="ident" id="1394107">r</span><span class="op" id="1394108">.</span><span class="ident" id="1394109">MultipartForm</span>&nbsp;<span class="op" id="1394123">!=</span>&nbsp;<span class="ident" id="1394126">nil</span>&nbsp;<span class="op" id="1394130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394134">return</span>&nbsp;<span class="ident" id="1394141">nil</span><span class="op" id="1394144">,</span>&nbsp;<span class="ident" id="1394146">errors</span><span class="op" id="1394152">.</span><span class="ident" id="1394153">New</span><span class="op" id="1394156">(</span><span class="string" id="1394157">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="1394204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394210">r</span><span class="op" id="1394211">.</span><span class="ident" id="1394212">MultipartForm</span>&nbsp;<span class="op" id="1394226">=</span>&nbsp;<span class="ident" id="1394228">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394247">return</span>&nbsp;<span class="ident" id="1394254">r</span><span class="op" id="1394255">.</span><span class="ident" id="1394256">multipartReader</span><span class="op" id="1394271">(</span><span class="op" id="1394272">)</span><br>
<span class="lineno">305</span><span class="op" id="1394274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1394277">func</span>&nbsp;<span class="op" id="1394282">(</span><span class="ident" id="1394283">r</span>&nbsp;<span class="op" id="1394285">*</span><span class="ident" id="1394286">Request</span><span class="op" id="1394293">)</span>&nbsp;<span class="ident" id="1394295">multipartReader</span><span class="op" id="1394310">(</span><span class="op" id="1394311">)</span>&nbsp;<span class="op" id="1394313">(</span><span class="op" id="1394314">*</span><span class="ident" id="1394315">multipart</span><span class="op" id="1394324">.</span><span class="ident" id="1394325">Reader</span><span class="op" id="1394331">,</span>&nbsp;<span class="builtintype" id="1394333">error</span><span class="op" id="1394338">)</span>&nbsp;<span class="op" id="1394340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394343">v</span>&nbsp;<span class="op" id="1394345">:=</span>&nbsp;<span class="ident" id="1394348">r</span><span class="op" id="1394349">.</span><span class="ident" id="1394350">Header</span><span class="op" id="1394356">.</span><span class="ident" id="1394357">Get</span><span class="op" id="1394360">(</span><span class="string" id="1394361">&#34;Content-Type&#34;</span><span class="op" id="1394375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394378">if</span>&nbsp;<span class="ident" id="1394381">v</span>&nbsp;<span class="op" id="1394383">==</span>&nbsp;<span class="string" id="1394386">&#34;&#34;</span>&nbsp;<span class="op" id="1394389">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394393">return</span>&nbsp;<span class="ident" id="1394400">nil</span><span class="op" id="1394403">,</span>&nbsp;<span class="ident" id="1394405">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394425">d</span><span class="op" id="1394426">,</span>&nbsp;<span class="ident" id="1394428">params</span><span class="op" id="1394434">,</span>&nbsp;<span class="ident" id="1394436">err</span>&nbsp;<span class="op" id="1394440">:=</span>&nbsp;<span class="ident" id="1394443">mime</span><span class="op" id="1394447">.</span><span class="ident" id="1394448">ParseMediaType</span><span class="op" id="1394462">(</span><span class="ident" id="1394463">v</span><span class="op" id="1394464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394467">if</span>&nbsp;<span class="ident" id="1394470">err</span>&nbsp;<span class="op" id="1394474">!=</span>&nbsp;<span class="ident" id="1394477">nil</span>&nbsp;<span class="op" id="1394481">||</span>&nbsp;<span class="ident" id="1394484">d</span>&nbsp;<span class="op" id="1394486">!=</span>&nbsp;<span class="string" id="1394489">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="1394511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394515">return</span>&nbsp;<span class="ident" id="1394522">nil</span><span class="op" id="1394525">,</span>&nbsp;<span class="ident" id="1394527">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394547">boundary</span><span class="op" id="1394555">,</span>&nbsp;<span class="ident" id="1394557">ok</span>&nbsp;<span class="op" id="1394560">:=</span>&nbsp;<span class="ident" id="1394563">params</span><span class="op" id="1394569">[</span><span class="string" id="1394570">&#34;boundary&#34;</span><span class="op" id="1394580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394583">if</span>&nbsp;<span class="op" id="1394586">!</span><span class="ident" id="1394587">ok</span>&nbsp;<span class="op" id="1394590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394594">return</span>&nbsp;<span class="ident" id="1394601">nil</span><span class="op" id="1394604">,</span>&nbsp;<span class="ident" id="1394606">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394626">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394629">return</span>&nbsp;<span class="ident" id="1394636">multipart</span><span class="op" id="1394645">.</span><span class="ident" id="1394646">NewReader</span><span class="op" id="1394655">(</span><span class="ident" id="1394656">r</span><span class="op" id="1394657">.</span><span class="ident" id="1394658">Body</span><span class="op" id="1394662">,</span>&nbsp;<span class="ident" id="1394664">boundary</span><span class="op" id="1394672">)</span><span class="op" id="1394673">,</span>&nbsp;<span class="ident" id="1394675">nil</span><br>
<span class="lineno"></span><span class="op" id="1394679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1394682">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="1394726">func</span>&nbsp;<span class="ident" id="1394731">valueOrDefault</span><span class="op" id="1394745">(</span><span class="ident" id="1394746">value</span><span class="op" id="1394751">,</span>&nbsp;<span class="ident" id="1394753">def</span>&nbsp;<span class="builtintype" id="1394757">string</span><span class="op" id="1394763">)</span>&nbsp;<span class="builtintype" id="1394765">string</span>&nbsp;<span class="op" id="1394772">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394775">if</span>&nbsp;<span class="ident" id="1394778">value</span>&nbsp;<span class="op" id="1394784">!=</span>&nbsp;<span class="string" id="1394787">&#34;&#34;</span>&nbsp;<span class="op" id="1394790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394794">return</span>&nbsp;<span class="ident" id="1394801">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394811">return</span>&nbsp;<span class="ident" id="1394818">def</span><br>
<span class="lineno"></span><span class="op" id="1394822">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="1394825">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="1394900">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1394973">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="1395046">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="1395102">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="1395149">const</span>&nbsp;<span class="ident" id="1395155">defaultUserAgent</span>&nbsp;<span class="op" id="1395172">=</span>&nbsp;<span class="string" id="1395174">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1395197">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="1395271">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="1395332">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="1395340">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="1395347">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="1395377">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="1395387">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="1395404">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="1395424">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="1395432">//</span><br>
<span class="lineno"></span><span class="comment" id="1395435">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="1395502">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="1395567">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="1395627">func</span>&nbsp;<span class="op" id="1395632">(</span><span class="ident" id="1395633">r</span>&nbsp;<span class="op" id="1395635">*</span><span class="ident" id="1395636">Request</span><span class="op" id="1395643">)</span>&nbsp;<span class="ident" id="1395645">Write</span><span class="op" id="1395650">(</span><span class="ident" id="1395651">w</span>&nbsp;<span class="ident" id="1395653">io</span><span class="op" id="1395655">.</span><span class="ident" id="1395656">Writer</span><span class="op" id="1395662">)</span>&nbsp;<span class="builtintype" id="1395664">error</span>&nbsp;<span class="op" id="1395670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395673">return</span>&nbsp;<span class="ident" id="1395680">r</span><span class="op" id="1395681">.</span><span class="ident" id="1395682">write</span><span class="op" id="1395687">(</span><span class="ident" id="1395688">w</span><span class="op" id="1395689">,</span>&nbsp;<span class="builtintype" id="1395691">false</span><span class="op" id="1395696">,</span>&nbsp;<span class="ident" id="1395698">nil</span><span class="op" id="1395701">)</span><br>
<span class="lineno"></span><span class="op" id="1395703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="1395706">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="1395769">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1395837">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="1395906">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="1395967">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="1396030">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="1396062">func</span>&nbsp;<span class="op" id="1396067">(</span><span class="ident" id="1396068">r</span>&nbsp;<span class="op" id="1396070">*</span><span class="ident" id="1396071">Request</span><span class="op" id="1396078">)</span>&nbsp;<span class="ident" id="1396080">WriteProxy</span><span class="op" id="1396090">(</span><span class="ident" id="1396091">w</span>&nbsp;<span class="ident" id="1396093">io</span><span class="op" id="1396095">.</span><span class="ident" id="1396096">Writer</span><span class="op" id="1396102">)</span>&nbsp;<span class="builtintype" id="1396104">error</span>&nbsp;<span class="op" id="1396110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396113">return</span>&nbsp;<span class="ident" id="1396120">r</span><span class="op" id="1396121">.</span><span class="ident" id="1396122">write</span><span class="op" id="1396127">(</span><span class="ident" id="1396128">w</span><span class="op" id="1396129">,</span>&nbsp;<span class="builtintype" id="1396131">true</span><span class="op" id="1396135">,</span>&nbsp;<span class="ident" id="1396137">nil</span><span class="op" id="1396140">)</span><br>
<span class="lineno"></span><span class="op" id="1396142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="1396145">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="1396172">func</span>&nbsp;<span class="op" id="1396177">(</span><span class="ident" id="1396178">req</span>&nbsp;<span class="op" id="1396182">*</span><span class="ident" id="1396183">Request</span><span class="op" id="1396190">)</span>&nbsp;<span class="ident" id="1396192">write</span><span class="op" id="1396197">(</span><span class="ident" id="1396198">w</span>&nbsp;<span class="ident" id="1396200">io</span><span class="op" id="1396202">.</span><span class="ident" id="1396203">Writer</span><span class="op" id="1396209">,</span>&nbsp;<span class="ident" id="1396211">usingProxy</span>&nbsp;<span class="builtintype" id="1396222">bool</span><span class="op" id="1396226">,</span>&nbsp;<span class="ident" id="1396228">extraHeaders</span>&nbsp;<span class="ident" id="1396241">Header</span><span class="op" id="1396247">)</span>&nbsp;<span class="builtintype" id="1396249">error</span>&nbsp;<span class="op" id="1396255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396258">host</span>&nbsp;<span class="op" id="1396263">:=</span>&nbsp;<span class="ident" id="1396266">req</span><span class="op" id="1396269">.</span><span class="ident" id="1396270">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396276">if</span>&nbsp;<span class="ident" id="1396279">host</span>&nbsp;<span class="op" id="1396284">==</span>&nbsp;<span class="string" id="1396287">&#34;&#34;</span>&nbsp;<span class="op" id="1396290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396294">if</span>&nbsp;<span class="ident" id="1396297">req</span><span class="op" id="1396300">.</span><span class="ident" id="1396301">URL</span>&nbsp;<span class="op" id="1396305">==</span>&nbsp;<span class="ident" id="1396308">nil</span>&nbsp;<span class="op" id="1396312">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396317">return</span>&nbsp;<span class="ident" id="1396324">errors</span><span class="op" id="1396330">.</span><span class="ident" id="1396331">New</span><span class="op" id="1396334">(</span><span class="string" id="1396335">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="1396391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396399">host</span>&nbsp;<span class="op" id="1396404">=</span>&nbsp;<span class="ident" id="1396406">req</span><span class="op" id="1396409">.</span><span class="ident" id="1396410">URL</span><span class="op" id="1396413">.</span><span class="ident" id="1396414">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396424">ruri</span>&nbsp;<span class="op" id="1396429">:=</span>&nbsp;<span class="ident" id="1396432">req</span><span class="op" id="1396435">.</span><span class="ident" id="1396436">URL</span><span class="op" id="1396439">.</span><span class="ident" id="1396440">RequestURI</span><span class="op" id="1396450">(</span><span class="op" id="1396451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396454">if</span>&nbsp;<span class="ident" id="1396457">usingProxy</span>&nbsp;<span class="op" id="1396468">&amp;&amp;</span>&nbsp;<span class="ident" id="1396471">req</span><span class="op" id="1396474">.</span><span class="ident" id="1396475">URL</span><span class="op" id="1396478">.</span><span class="ident" id="1396479">Scheme</span>&nbsp;<span class="op" id="1396486">!=</span>&nbsp;<span class="string" id="1396489">&#34;&#34;</span>&nbsp;<span class="op" id="1396492">&amp;&amp;</span>&nbsp;<span class="ident" id="1396495">req</span><span class="op" id="1396498">.</span><span class="ident" id="1396499">URL</span><span class="op" id="1396502">.</span><span class="ident" id="1396503">Opaque</span>&nbsp;<span class="op" id="1396510">==</span>&nbsp;<span class="string" id="1396513">&#34;&#34;</span>&nbsp;<span class="op" id="1396516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396520">ruri</span>&nbsp;<span class="op" id="1396525">=</span>&nbsp;<span class="ident" id="1396527">req</span><span class="op" id="1396530">.</span><span class="ident" id="1396531">URL</span><span class="op" id="1396534">.</span><span class="ident" id="1396535">Scheme</span>&nbsp;<span class="op" id="1396542">+</span>&nbsp;<span class="string" id="1396544">&#34;://&#34;</span>&nbsp;<span class="op" id="1396550">+</span>&nbsp;<span class="ident" id="1396552">host</span>&nbsp;<span class="op" id="1396557">+</span>&nbsp;<span class="ident" id="1396559">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396565">}</span>&nbsp;<span class="keyword" id="1396567">else</span>&nbsp;<span class="keyword" id="1396572">if</span>&nbsp;<span class="ident" id="1396575">req</span><span class="op" id="1396578">.</span><span class="ident" id="1396579">Method</span>&nbsp;<span class="op" id="1396586">==</span>&nbsp;<span class="string" id="1396589">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="1396599">&amp;&amp;</span>&nbsp;<span class="ident" id="1396602">req</span><span class="op" id="1396605">.</span><span class="ident" id="1396606">URL</span><span class="op" id="1396609">.</span><span class="ident" id="1396610">Path</span>&nbsp;<span class="op" id="1396615">==</span>&nbsp;<span class="string" id="1396618">&#34;&#34;</span>&nbsp;<span class="op" id="1396621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1396625">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396701">ruri</span>&nbsp;<span class="op" id="1396706">=</span>&nbsp;<span class="ident" id="1396708">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1396717">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1396772">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1396840">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1396903">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1396965">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396975">var</span>&nbsp;<span class="ident" id="1396979">bw</span>&nbsp;<span class="op" id="1396982">*</span><span class="ident" id="1396983">bufio</span><span class="op" id="1396988">.</span><span class="ident" id="1396989">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396997">if</span>&nbsp;<span class="ident" id="1397000">_</span><span class="op" id="1397001">,</span>&nbsp;<span class="ident" id="1397003">ok</span>&nbsp;<span class="op" id="1397006">:=</span>&nbsp;<span class="ident" id="1397009">w</span><span class="op" id="1397010">.</span><span class="op" id="1397011">(</span><span class="ident" id="1397012">io</span><span class="op" id="1397014">.</span><span class="ident" id="1397015">ByteWriter</span><span class="op" id="1397025">)</span><span class="op" id="1397026">;</span>&nbsp;<span class="op" id="1397028">!</span><span class="ident" id="1397029">ok</span>&nbsp;<span class="op" id="1397032">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397036">bw</span>&nbsp;<span class="op" id="1397039">=</span>&nbsp;<span class="ident" id="1397041">bufio</span><span class="op" id="1397046">.</span><span class="ident" id="1397047">NewWriter</span><span class="op" id="1397056">(</span><span class="ident" id="1397057">w</span><span class="op" id="1397058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397062">w</span>&nbsp;<span class="op" id="1397064">=</span>&nbsp;<span class="ident" id="1397066">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397074">_</span><span class="op" id="1397075">,</span>&nbsp;<span class="ident" id="1397077">err</span>&nbsp;<span class="op" id="1397081">:=</span>&nbsp;<span class="ident" id="1397084">fmt</span><span class="op" id="1397087">.</span><span class="ident" id="1397088">Fprintf</span><span class="op" id="1397095">(</span><span class="ident" id="1397096">w</span><span class="op" id="1397097">,</span>&nbsp;<span class="string" id="1397099">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="1397119">,</span>&nbsp;<span class="ident" id="1397121">valueOrDefault</span><span class="op" id="1397135">(</span><span class="ident" id="1397136">req</span><span class="op" id="1397139">.</span><span class="ident" id="1397140">Method</span><span class="op" id="1397146">,</span>&nbsp;<span class="string" id="1397148">&#34;GET&#34;</span><span class="op" id="1397153">)</span><span class="op" id="1397154">,</span>&nbsp;<span class="ident" id="1397156">ruri</span><span class="op" id="1397160">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397163">if</span>&nbsp;<span class="ident" id="1397166">err</span>&nbsp;<span class="op" id="1397170">!=</span>&nbsp;<span class="ident" id="1397173">nil</span>&nbsp;<span class="op" id="1397177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397181">return</span>&nbsp;<span class="ident" id="1397188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1397197">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397214">_</span><span class="op" id="1397215">,</span>&nbsp;<span class="ident" id="1397217">err</span>&nbsp;<span class="op" id="1397221">=</span>&nbsp;<span class="ident" id="1397223">fmt</span><span class="op" id="1397226">.</span><span class="ident" id="1397227">Fprintf</span><span class="op" id="1397234">(</span><span class="ident" id="1397235">w</span><span class="op" id="1397236">,</span>&nbsp;<span class="string" id="1397238">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="1397252">,</span>&nbsp;<span class="ident" id="1397254">host</span><span class="op" id="1397258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397261">if</span>&nbsp;<span class="ident" id="1397264">err</span>&nbsp;<span class="op" id="1397268">!=</span>&nbsp;<span class="ident" id="1397271">nil</span>&nbsp;<span class="op" id="1397275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397279">return</span>&nbsp;<span class="ident" id="1397286">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1397295">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1397362">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397403">userAgent</span>&nbsp;<span class="op" id="1397413">:=</span>&nbsp;<span class="ident" id="1397416">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397434">if</span>&nbsp;<span class="ident" id="1397437">req</span><span class="op" id="1397440">.</span><span class="ident" id="1397441">Header</span>&nbsp;<span class="op" id="1397448">!=</span>&nbsp;<span class="ident" id="1397451">nil</span>&nbsp;<span class="op" id="1397455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397459">if</span>&nbsp;<span class="ident" id="1397462">ua</span>&nbsp;<span class="op" id="1397465">:=</span>&nbsp;<span class="ident" id="1397468">req</span><span class="op" id="1397471">.</span><span class="ident" id="1397472">Header</span><span class="op" id="1397478">[</span><span class="string" id="1397479">&#34;User-Agent&#34;</span><span class="op" id="1397491">]</span><span class="op" id="1397492">;</span>&nbsp;<span class="builtinfunc" id="1397494">len</span><span class="op" id="1397497">(</span><span class="ident" id="1397498">ua</span><span class="op" id="1397500">)</span>&nbsp;<span class="op" id="1397502">&gt;</span>&nbsp;<span class="num" id="1397504">0</span>&nbsp;<span class="op" id="1397506">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397511">userAgent</span>&nbsp;<span class="op" id="1397521">=</span>&nbsp;<span class="ident" id="1397523">ua</span><span class="op" id="1397525">[</span><span class="num" id="1397526">0</span><span class="op" id="1397527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397537">if</span>&nbsp;<span class="ident" id="1397540">userAgent</span>&nbsp;<span class="op" id="1397550">!=</span>&nbsp;<span class="string" id="1397553">&#34;&#34;</span>&nbsp;<span class="op" id="1397556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397560">_</span><span class="op" id="1397561">,</span>&nbsp;<span class="ident" id="1397563">err</span>&nbsp;<span class="op" id="1397567">=</span>&nbsp;<span class="ident" id="1397569">fmt</span><span class="op" id="1397572">.</span><span class="ident" id="1397573">Fprintf</span><span class="op" id="1397580">(</span><span class="ident" id="1397581">w</span><span class="op" id="1397582">,</span>&nbsp;<span class="string" id="1397584">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="1397604">,</span>&nbsp;<span class="ident" id="1397606">userAgent</span><span class="op" id="1397615">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397619">if</span>&nbsp;<span class="ident" id="1397622">err</span>&nbsp;<span class="op" id="1397626">!=</span>&nbsp;<span class="ident" id="1397629">nil</span>&nbsp;<span class="op" id="1397633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397638">return</span>&nbsp;<span class="ident" id="1397645">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1397658">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397703">tw</span><span class="op" id="1397705">,</span>&nbsp;<span class="ident" id="1397707">err</span>&nbsp;<span class="op" id="1397711">:=</span>&nbsp;<span class="ident" id="1397714">newTransferWriter</span><span class="op" id="1397731">(</span><span class="ident" id="1397732">req</span><span class="op" id="1397735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397738">if</span>&nbsp;<span class="ident" id="1397741">err</span>&nbsp;<span class="op" id="1397745">!=</span>&nbsp;<span class="ident" id="1397748">nil</span>&nbsp;<span class="op" id="1397752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397756">return</span>&nbsp;<span class="ident" id="1397763">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397768">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397771">err</span>&nbsp;<span class="op" id="1397775">=</span>&nbsp;<span class="ident" id="1397777">tw</span><span class="op" id="1397779">.</span><span class="ident" id="1397780">WriteHeader</span><span class="op" id="1397791">(</span><span class="ident" id="1397792">w</span><span class="op" id="1397793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397796">if</span>&nbsp;<span class="ident" id="1397799">err</span>&nbsp;<span class="op" id="1397803">!=</span>&nbsp;<span class="ident" id="1397806">nil</span>&nbsp;<span class="op" id="1397810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397814">return</span>&nbsp;<span class="ident" id="1397821">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397830">err</span>&nbsp;<span class="op" id="1397834">=</span>&nbsp;<span class="ident" id="1397836">req</span><span class="op" id="1397839">.</span><span class="ident" id="1397840">Header</span><span class="op" id="1397846">.</span><span class="ident" id="1397847">WriteSubset</span><span class="op" id="1397858">(</span><span class="ident" id="1397859">w</span><span class="op" id="1397860">,</span>&nbsp;<span class="ident" id="1397862">reqWriteExcludeHeader</span><span class="op" id="1397883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397886">if</span>&nbsp;<span class="ident" id="1397889">err</span>&nbsp;<span class="op" id="1397893">!=</span>&nbsp;<span class="ident" id="1397896">nil</span>&nbsp;<span class="op" id="1397900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397904">return</span>&nbsp;<span class="ident" id="1397911">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397920">if</span>&nbsp;<span class="ident" id="1397923">extraHeaders</span>&nbsp;<span class="op" id="1397936">!=</span>&nbsp;<span class="ident" id="1397939">nil</span>&nbsp;<span class="op" id="1397943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397947">err</span>&nbsp;<span class="op" id="1397951">=</span>&nbsp;<span class="ident" id="1397953">extraHeaders</span><span class="op" id="1397965">.</span><span class="ident" id="1397966">Write</span><span class="op" id="1397971">(</span><span class="ident" id="1397972">w</span><span class="op" id="1397973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397977">if</span>&nbsp;<span class="ident" id="1397980">err</span>&nbsp;<span class="op" id="1397984">!=</span>&nbsp;<span class="ident" id="1397987">nil</span>&nbsp;<span class="op" id="1397991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397996">return</span>&nbsp;<span class="ident" id="1398003">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398009">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1398016">_</span><span class="op" id="1398017">,</span>&nbsp;<span class="ident" id="1398019">err</span>&nbsp;<span class="op" id="1398023">=</span>&nbsp;<span class="ident" id="1398025">io</span><span class="op" id="1398027">.</span><span class="ident" id="1398028">WriteString</span><span class="op" id="1398039">(</span><span class="ident" id="1398040">w</span><span class="op" id="1398041">,</span>&nbsp;<span class="string" id="1398043">&#34;\r\n&#34;</span><span class="op" id="1398049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398052">if</span>&nbsp;<span class="ident" id="1398055">err</span>&nbsp;<span class="op" id="1398059">!=</span>&nbsp;<span class="ident" id="1398062">nil</span>&nbsp;<span class="op" id="1398066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398070">return</span>&nbsp;<span class="ident" id="1398077">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1398086">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1398113">err</span>&nbsp;<span class="op" id="1398117">=</span>&nbsp;<span class="ident" id="1398119">tw</span><span class="op" id="1398121">.</span><span class="ident" id="1398122">WriteBody</span><span class="op" id="1398131">(</span><span class="ident" id="1398132">w</span><span class="op" id="1398133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398136">if</span>&nbsp;<span class="ident" id="1398139">err</span>&nbsp;<span class="op" id="1398143">!=</span>&nbsp;<span class="ident" id="1398146">nil</span>&nbsp;<span class="op" id="1398150">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398154">return</span>&nbsp;<span class="ident" id="1398161">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398170">if</span>&nbsp;<span class="ident" id="1398173">bw</span>&nbsp;<span class="op" id="1398176">!=</span>&nbsp;<span class="ident" id="1398179">nil</span>&nbsp;<span class="op" id="1398183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398187">return</span>&nbsp;<span class="ident" id="1398194">bw</span><span class="op" id="1398196">.</span><span class="ident" id="1398197">Flush</span><span class="op" id="1398202">(</span><span class="op" id="1398203">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398209">return</span>&nbsp;<span class="ident" id="1398216">nil</span><br>
<span class="lineno"></span><span class="op" id="1398220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1398223">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="1398273">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="1398309">func</span>&nbsp;<span class="ident" id="1398314">ParseHTTPVersion</span><span class="op" id="1398330">(</span><span class="ident" id="1398331">vers</span>&nbsp;<span class="builtintype" id="1398336">string</span><span class="op" id="1398342">)</span>&nbsp;<span class="op" id="1398344">(</span><span class="ident" id="1398345">major</span><span class="op" id="1398350">,</span>&nbsp;<span class="ident" id="1398352">minor</span>&nbsp;<span class="builtintype" id="1398358">int</span><span class="op" id="1398361">,</span>&nbsp;<span class="ident" id="1398363">ok</span>&nbsp;<span class="builtintype" id="1398366">bool</span><span class="op" id="1398370">)</span>&nbsp;<span class="op" id="1398372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398375">const</span>&nbsp;<span class="ident" id="1398381">Big</span>&nbsp;<span class="op" id="1398385">=</span>&nbsp;<span class="num" id="1398387">1000000</span>&nbsp;<span class="comment" id="1398395">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398421">switch</span>&nbsp;<span class="ident" id="1398428">vers</span>&nbsp;<span class="op" id="1398433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398436">case</span>&nbsp;<span class="string" id="1398441">&#34;HTTP/1.1&#34;</span><span class="op" id="1398451">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398455">return</span>&nbsp;<span class="num" id="1398462">1</span><span class="op" id="1398463">,</span>&nbsp;<span class="num" id="1398465">1</span><span class="op" id="1398466">,</span>&nbsp;<span class="builtintype" id="1398468">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398474">case</span>&nbsp;<span class="string" id="1398479">&#34;HTTP/1.0&#34;</span><span class="op" id="1398489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398493">return</span>&nbsp;<span class="num" id="1398500">1</span><span class="op" id="1398501">,</span>&nbsp;<span class="num" id="1398503">0</span><span class="op" id="1398504">,</span>&nbsp;<span class="builtintype" id="1398506">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398515">if</span>&nbsp;<span class="op" id="1398518">!</span><span class="ident" id="1398519">strings</span><span class="op" id="1398526">.</span><span class="ident" id="1398527">HasPrefix</span><span class="op" id="1398536">(</span><span class="ident" id="1398537">vers</span><span class="op" id="1398541">,</span>&nbsp;<span class="string" id="1398543">&#34;HTTP/&#34;</span><span class="op" id="1398550">)</span>&nbsp;<span class="op" id="1398552">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398556">return</span>&nbsp;<span class="num" id="1398563">0</span><span class="op" id="1398564">,</span>&nbsp;<span class="num" id="1398566">0</span><span class="op" id="1398567">,</span>&nbsp;<span class="builtintype" id="1398569">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1398579">dot</span>&nbsp;<span class="op" id="1398583">:=</span>&nbsp;<span class="ident" id="1398586">strings</span><span class="op" id="1398593">.</span><span class="ident" id="1398594">Index</span><span class="op" id="1398599">(</span><span class="ident" id="1398600">vers</span><span class="op" id="1398604">,</span>&nbsp;<span class="string" id="1398606">&#34;.&#34;</span><span class="op" id="1398609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398612">if</span>&nbsp;<span class="ident" id="1398615">dot</span>&nbsp;<span class="op" id="1398619">&lt;</span>&nbsp;<span class="num" id="1398621">0</span>&nbsp;<span class="op" id="1398623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398627">return</span>&nbsp;<span class="num" id="1398634">0</span><span class="op" id="1398635">,</span>&nbsp;<span class="num" id="1398637">0</span><span class="op" id="1398638">,</span>&nbsp;<span class="builtintype" id="1398640">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1398650">major</span><span class="op" id="1398655">,</span>&nbsp;<span class="ident" id="1398657">err</span>&nbsp;<span class="op" id="1398661">:=</span>&nbsp;<span class="ident" id="1398664">strconv</span><span class="op" id="1398671">.</span><span class="ident" id="1398672">Atoi</span><span class="op" id="1398676">(</span><span class="ident" id="1398677">vers</span><span class="op" id="1398681">[</span><span class="num" id="1398682">5</span><span class="op" id="1398683">:</span><span class="ident" id="1398684">dot</span><span class="op" id="1398687">]</span><span class="op" id="1398688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398691">if</span>&nbsp;<span class="ident" id="1398694">err</span>&nbsp;<span class="op" id="1398698">!=</span>&nbsp;<span class="ident" id="1398701">nil</span>&nbsp;<span class="op" id="1398705">||</span>&nbsp;<span class="ident" id="1398708">major</span>&nbsp;<span class="op" id="1398714">&lt;</span>&nbsp;<span class="num" id="1398716">0</span>&nbsp;<span class="op" id="1398718">||</span>&nbsp;<span class="ident" id="1398721">major</span>&nbsp;<span class="op" id="1398727">&gt;</span>&nbsp;<span class="ident" id="1398729">Big</span>&nbsp;<span class="op" id="1398733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398737">return</span>&nbsp;<span class="num" id="1398744">0</span><span class="op" id="1398745">,</span>&nbsp;<span class="num" id="1398747">0</span><span class="op" id="1398748">,</span>&nbsp;<span class="builtintype" id="1398750">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398757">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1398760">minor</span><span class="op" id="1398765">,</span>&nbsp;<span class="ident" id="1398767">err</span>&nbsp;<span class="op" id="1398771">=</span>&nbsp;<span class="ident" id="1398773">strconv</span><span class="op" id="1398780">.</span><span class="ident" id="1398781">Atoi</span><span class="op" id="1398785">(</span><span class="ident" id="1398786">vers</span><span class="op" id="1398790">[</span><span class="ident" id="1398791">dot</span><span class="op" id="1398794">+</span><span class="num" id="1398795">1</span><span class="op" id="1398796">:</span><span class="op" id="1398797">]</span><span class="op" id="1398798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398801">if</span>&nbsp;<span class="ident" id="1398804">err</span>&nbsp;<span class="op" id="1398808">!=</span>&nbsp;<span class="ident" id="1398811">nil</span>&nbsp;<span class="op" id="1398815">||</span>&nbsp;<span class="ident" id="1398818">minor</span>&nbsp;<span class="op" id="1398824">&lt;</span>&nbsp;<span class="num" id="1398826">0</span>&nbsp;<span class="op" id="1398828">||</span>&nbsp;<span class="ident" id="1398831">minor</span>&nbsp;<span class="op" id="1398837">&gt;</span>&nbsp;<span class="ident" id="1398839">Big</span>&nbsp;<span class="op" id="1398843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398847">return</span>&nbsp;<span class="num" id="1398854">0</span><span class="op" id="1398855">,</span>&nbsp;<span class="num" id="1398857">0</span><span class="op" id="1398858">,</span>&nbsp;<span class="builtintype" id="1398860">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1398867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398870">return</span>&nbsp;<span class="ident" id="1398877">major</span><span class="op" id="1398882">,</span>&nbsp;<span class="ident" id="1398884">minor</span><span class="op" id="1398889">,</span>&nbsp;<span class="builtintype" id="1398891">true</span><br>
<span class="lineno">485</span><span class="op" id="1398896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1398899">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="1398975">//</span><br>
<span class="lineno"></span><span class="comment" id="1398978">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="1399037">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="1399101">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="1399161">func</span>&nbsp;<span class="ident" id="1399166">NewRequest</span><span class="op" id="1399176">(</span><span class="ident" id="1399177">method</span><span class="op" id="1399183">,</span>&nbsp;<span class="ident" id="1399185">urlStr</span>&nbsp;<span class="builtintype" id="1399192">string</span><span class="op" id="1399198">,</span>&nbsp;<span class="ident" id="1399200">body</span>&nbsp;<span class="ident" id="1399205">io</span><span class="op" id="1399207">.</span><span class="ident" id="1399208">Reader</span><span class="op" id="1399214">)</span>&nbsp;<span class="op" id="1399216">(</span><span class="op" id="1399217">*</span><span class="ident" id="1399218">Request</span><span class="op" id="1399225">,</span>&nbsp;<span class="builtintype" id="1399227">error</span><span class="op" id="1399232">)</span>&nbsp;<span class="op" id="1399234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399237">u</span><span class="op" id="1399238">,</span>&nbsp;<span class="ident" id="1399240">err</span>&nbsp;<span class="op" id="1399244">:=</span>&nbsp;<span class="ident" id="1399247">url</span><span class="op" id="1399250">.</span><span class="ident" id="1399251">Parse</span><span class="op" id="1399256">(</span><span class="ident" id="1399257">urlStr</span><span class="op" id="1399263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399266">if</span>&nbsp;<span class="ident" id="1399269">err</span>&nbsp;<span class="op" id="1399273">!=</span>&nbsp;<span class="ident" id="1399276">nil</span>&nbsp;<span class="op" id="1399280">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399284">return</span>&nbsp;<span class="ident" id="1399291">nil</span><span class="op" id="1399294">,</span>&nbsp;<span class="ident" id="1399296">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399304">rc</span><span class="op" id="1399306">,</span>&nbsp;<span class="ident" id="1399308">ok</span>&nbsp;<span class="op" id="1399311">:=</span>&nbsp;<span class="ident" id="1399314">body</span><span class="op" id="1399318">.</span><span class="op" id="1399319">(</span><span class="ident" id="1399320">io</span><span class="op" id="1399322">.</span><span class="ident" id="1399323">ReadCloser</span><span class="op" id="1399333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399336">if</span>&nbsp;<span class="op" id="1399339">!</span><span class="ident" id="1399340">ok</span>&nbsp;<span class="op" id="1399343">&amp;&amp;</span>&nbsp;<span class="ident" id="1399346">body</span>&nbsp;<span class="op" id="1399351">!=</span>&nbsp;<span class="ident" id="1399354">nil</span>&nbsp;<span class="op" id="1399358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399362">rc</span>&nbsp;<span class="op" id="1399365">=</span>&nbsp;<span class="ident" id="1399367">ioutil</span><span class="op" id="1399373">.</span><span class="ident" id="1399374">NopCloser</span><span class="op" id="1399383">(</span><span class="ident" id="1399384">body</span><span class="op" id="1399388">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399394">req</span>&nbsp;<span class="op" id="1399398">:=</span>&nbsp;<span class="op" id="1399401">&amp;</span><span class="ident" id="1399402">Request</span><span class="op" id="1399409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399413">Method</span><span class="op" id="1399419">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399425">method</span><span class="op" id="1399431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399435">URL</span><span class="op" id="1399438">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399447">u</span><span class="op" id="1399448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399452">Proto</span><span class="op" id="1399457">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1399464">&#34;HTTP/1.1&#34;</span><span class="op" id="1399474">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399478">ProtoMajor</span><span class="op" id="1399488">:</span>&nbsp;<span class="num" id="1399490">1</span><span class="op" id="1399491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399495">ProtoMinor</span><span class="op" id="1399505">:</span>&nbsp;<span class="num" id="1399507">1</span><span class="op" id="1399508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399512">Header</span><span class="op" id="1399518">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1399524">make</span><span class="op" id="1399528">(</span><span class="ident" id="1399529">Header</span><span class="op" id="1399535">)</span><span class="op" id="1399536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399540">Body</span><span class="op" id="1399544">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399552">rc</span><span class="op" id="1399554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399558">Host</span><span class="op" id="1399562">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399570">u</span><span class="op" id="1399571">.</span><span class="ident" id="1399572">Host</span><span class="op" id="1399576">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399582">if</span>&nbsp;<span class="ident" id="1399585">body</span>&nbsp;<span class="op" id="1399590">!=</span>&nbsp;<span class="ident" id="1399593">nil</span>&nbsp;<span class="op" id="1399597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399601">switch</span>&nbsp;<span class="ident" id="1399608">v</span>&nbsp;<span class="op" id="1399610">:=</span>&nbsp;<span class="ident" id="1399613">body</span><span class="op" id="1399617">.</span><span class="op" id="1399618">(</span><span class="keyword" id="1399619">type</span><span class="op" id="1399623">)</span>&nbsp;<span class="op" id="1399625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399629">case</span>&nbsp;<span class="op" id="1399634">*</span><span class="ident" id="1399635">bytes</span><span class="op" id="1399640">.</span><span class="ident" id="1399641">Buffer</span><span class="op" id="1399647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399652">req</span><span class="op" id="1399655">.</span><span class="ident" id="1399656">ContentLength</span>&nbsp;<span class="op" id="1399670">=</span>&nbsp;<span class="ident" id="1399672">int64</span><span class="op" id="1399677">(</span><span class="ident" id="1399678">v</span><span class="op" id="1399679">.</span><span class="ident" id="1399680">Len</span><span class="op" id="1399683">(</span><span class="op" id="1399684">)</span><span class="op" id="1399685">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399689">case</span>&nbsp;<span class="op" id="1399694">*</span><span class="ident" id="1399695">bytes</span><span class="op" id="1399700">.</span><span class="ident" id="1399701">Reader</span><span class="op" id="1399707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399712">req</span><span class="op" id="1399715">.</span><span class="ident" id="1399716">ContentLength</span>&nbsp;<span class="op" id="1399730">=</span>&nbsp;<span class="ident" id="1399732">int64</span><span class="op" id="1399737">(</span><span class="ident" id="1399738">v</span><span class="op" id="1399739">.</span><span class="ident" id="1399740">Len</span><span class="op" id="1399743">(</span><span class="op" id="1399744">)</span><span class="op" id="1399745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399749">case</span>&nbsp;<span class="op" id="1399754">*</span><span class="ident" id="1399755">strings</span><span class="op" id="1399762">.</span><span class="ident" id="1399763">Reader</span><span class="op" id="1399769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399774">req</span><span class="op" id="1399777">.</span><span class="ident" id="1399778">ContentLength</span>&nbsp;<span class="op" id="1399792">=</span>&nbsp;<span class="ident" id="1399794">int64</span><span class="op" id="1399799">(</span><span class="ident" id="1399800">v</span><span class="op" id="1399801">.</span><span class="ident" id="1399802">Len</span><span class="op" id="1399805">(</span><span class="op" id="1399806">)</span><span class="op" id="1399807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399811">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399818">return</span>&nbsp;<span class="ident" id="1399825">req</span><span class="op" id="1399828">,</span>&nbsp;<span class="ident" id="1399830">nil</span><br>
<span class="lineno"></span><span class="op" id="1399834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="1399837">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1399910">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="1399982">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="1400010">func</span>&nbsp;<span class="op" id="1400015">(</span><span class="ident" id="1400016">r</span>&nbsp;<span class="op" id="1400018">*</span><span class="ident" id="1400019">Request</span><span class="op" id="1400026">)</span>&nbsp;<span class="ident" id="1400028">BasicAuth</span><span class="op" id="1400037">(</span><span class="op" id="1400038">)</span>&nbsp;<span class="op" id="1400040">(</span><span class="ident" id="1400041">username</span><span class="op" id="1400049">,</span>&nbsp;<span class="ident" id="1400051">password</span>&nbsp;<span class="builtintype" id="1400060">string</span><span class="op" id="1400066">,</span>&nbsp;<span class="ident" id="1400068">ok</span>&nbsp;<span class="builtintype" id="1400071">bool</span><span class="op" id="1400075">)</span>&nbsp;<span class="op" id="1400077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400080">auth</span>&nbsp;<span class="op" id="1400085">:=</span>&nbsp;<span class="ident" id="1400088">r</span><span class="op" id="1400089">.</span><span class="ident" id="1400090">Header</span><span class="op" id="1400096">.</span><span class="ident" id="1400097">Get</span><span class="op" id="1400100">(</span><span class="string" id="1400101">&#34;Authorization&#34;</span><span class="op" id="1400116">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400119">if</span>&nbsp;<span class="ident" id="1400122">auth</span>&nbsp;<span class="op" id="1400127">==</span>&nbsp;<span class="string" id="1400130">&#34;&#34;</span>&nbsp;<span class="op" id="1400133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400137">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400148">return</span>&nbsp;<span class="ident" id="1400155">parseBasicAuth</span><span class="op" id="1400169">(</span><span class="ident" id="1400170">auth</span><span class="op" id="1400174">)</span><br>
<span class="lineno"></span><span class="op" id="1400176">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="1400179">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1400241">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="1400323">func</span>&nbsp;<span class="ident" id="1400328">parseBasicAuth</span><span class="op" id="1400342">(</span><span class="ident" id="1400343">auth</span>&nbsp;<span class="builtintype" id="1400348">string</span><span class="op" id="1400354">)</span>&nbsp;<span class="op" id="1400356">(</span><span class="ident" id="1400357">username</span><span class="op" id="1400365">,</span>&nbsp;<span class="ident" id="1400367">password</span>&nbsp;<span class="builtintype" id="1400376">string</span><span class="op" id="1400382">,</span>&nbsp;<span class="ident" id="1400384">ok</span>&nbsp;<span class="builtintype" id="1400387">bool</span><span class="op" id="1400391">)</span>&nbsp;<span class="op" id="1400393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400396">if</span>&nbsp;<span class="op" id="1400399">!</span><span class="ident" id="1400400">strings</span><span class="op" id="1400407">.</span><span class="ident" id="1400408">HasPrefix</span><span class="op" id="1400417">(</span><span class="ident" id="1400418">auth</span><span class="op" id="1400422">,</span>&nbsp;<span class="string" id="1400424">&#34;Basic&nbsp;&#34;</span><span class="op" id="1400432">)</span>&nbsp;<span class="op" id="1400434">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400438">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400449">c</span><span class="op" id="1400450">,</span>&nbsp;<span class="ident" id="1400452">err</span>&nbsp;<span class="op" id="1400456">:=</span>&nbsp;<span class="ident" id="1400459">base64</span><span class="op" id="1400465">.</span><span class="ident" id="1400466">StdEncoding</span><span class="op" id="1400477">.</span><span class="ident" id="1400478">DecodeString</span><span class="op" id="1400490">(</span><span class="ident" id="1400491">strings</span><span class="op" id="1400498">.</span><span class="ident" id="1400499">TrimPrefix</span><span class="op" id="1400509">(</span><span class="ident" id="1400510">auth</span><span class="op" id="1400514">,</span>&nbsp;<span class="string" id="1400516">&#34;Basic&nbsp;&#34;</span><span class="op" id="1400524">)</span><span class="op" id="1400525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400528">if</span>&nbsp;<span class="ident" id="1400531">err</span>&nbsp;<span class="op" id="1400535">!=</span>&nbsp;<span class="ident" id="1400538">nil</span>&nbsp;<span class="op" id="1400542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400546">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400557">cs</span>&nbsp;<span class="op" id="1400560">:=</span>&nbsp;<span class="builtintype" id="1400563">string</span><span class="op" id="1400569">(</span><span class="ident" id="1400570">c</span><span class="op" id="1400571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400574">s</span>&nbsp;<span class="op" id="1400576">:=</span>&nbsp;<span class="ident" id="1400579">strings</span><span class="op" id="1400586">.</span><span class="ident" id="1400587">IndexByte</span><span class="op" id="1400596">(</span><span class="ident" id="1400597">cs</span><span class="op" id="1400599">,</span>&nbsp;<span class="string" id="1400601">&#39;:&#39;</span><span class="op" id="1400604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400607">if</span>&nbsp;<span class="ident" id="1400610">s</span>&nbsp;<span class="op" id="1400612">&lt;</span>&nbsp;<span class="num" id="1400614">0</span>&nbsp;<span class="op" id="1400616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400620">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400631">return</span>&nbsp;<span class="ident" id="1400638">cs</span><span class="op" id="1400640">[</span><span class="op" id="1400641">:</span><span class="ident" id="1400642">s</span><span class="op" id="1400643">]</span><span class="op" id="1400644">,</span>&nbsp;<span class="ident" id="1400646">cs</span><span class="op" id="1400648">[</span><span class="ident" id="1400649">s</span><span class="op" id="1400650">+</span><span class="num" id="1400651">1</span><span class="op" id="1400652">:</span><span class="op" id="1400653">]</span><span class="op" id="1400654">,</span>&nbsp;<span class="builtintype" id="1400656">true</span><br>
<span class="lineno"></span><span class="op" id="1400661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1400664">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="1400732">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="1400797">//</span><br>
<span class="lineno"></span><span class="comment" id="1400800">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="1400869">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="1400891">func</span>&nbsp;<span class="op" id="1400896">(</span><span class="ident" id="1400897">r</span>&nbsp;<span class="op" id="1400899">*</span><span class="ident" id="1400900">Request</span><span class="op" id="1400907">)</span>&nbsp;<span class="ident" id="1400909">SetBasicAuth</span><span class="op" id="1400921">(</span><span class="ident" id="1400922">username</span><span class="op" id="1400930">,</span>&nbsp;<span class="ident" id="1400932">password</span>&nbsp;<span class="builtintype" id="1400941">string</span><span class="op" id="1400947">)</span>&nbsp;<span class="op" id="1400949">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400952">r</span><span class="op" id="1400953">.</span><span class="ident" id="1400954">Header</span><span class="op" id="1400960">.</span><span class="ident" id="1400961">Set</span><span class="op" id="1400964">(</span><span class="string" id="1400965">&#34;Authorization&#34;</span><span class="op" id="1400980">,</span>&nbsp;<span class="string" id="1400982">&#34;Basic&nbsp;&#34;</span><span class="op" id="1400990">+</span><span class="ident" id="1400991">basicAuth</span><span class="op" id="1401000">(</span><span class="ident" id="1401001">username</span><span class="op" id="1401009">,</span>&nbsp;<span class="ident" id="1401011">password</span><span class="op" id="1401019">)</span><span class="op" id="1401020">)</span><br>
<span class="lineno"></span><span class="op" id="1401022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1401025">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="1401094">func</span>&nbsp;<span class="ident" id="1401099">parseRequestLine</span><span class="op" id="1401115">(</span><span class="ident" id="1401116">line</span>&nbsp;<span class="builtintype" id="1401121">string</span><span class="op" id="1401127">)</span>&nbsp;<span class="op" id="1401129">(</span><span class="ident" id="1401130">method</span><span class="op" id="1401136">,</span>&nbsp;<span class="ident" id="1401138">requestURI</span><span class="op" id="1401148">,</span>&nbsp;<span class="ident" id="1401150">proto</span>&nbsp;<span class="builtintype" id="1401156">string</span><span class="op" id="1401162">,</span>&nbsp;<span class="ident" id="1401164">ok</span>&nbsp;<span class="builtintype" id="1401167">bool</span><span class="op" id="1401171">)</span>&nbsp;<span class="op" id="1401173">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401176">s1</span>&nbsp;<span class="op" id="1401179">:=</span>&nbsp;<span class="ident" id="1401182">strings</span><span class="op" id="1401189">.</span><span class="ident" id="1401190">Index</span><span class="op" id="1401195">(</span><span class="ident" id="1401196">line</span><span class="op" id="1401200">,</span>&nbsp;<span class="string" id="1401202">&#34;&nbsp;&#34;</span><span class="op" id="1401205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401208">s2</span>&nbsp;<span class="op" id="1401211">:=</span>&nbsp;<span class="ident" id="1401214">strings</span><span class="op" id="1401221">.</span><span class="ident" id="1401222">Index</span><span class="op" id="1401227">(</span><span class="ident" id="1401228">line</span><span class="op" id="1401232">[</span><span class="ident" id="1401233">s1</span><span class="op" id="1401235">+</span><span class="num" id="1401236">1</span><span class="op" id="1401237">:</span><span class="op" id="1401238">]</span><span class="op" id="1401239">,</span>&nbsp;<span class="string" id="1401241">&#34;&nbsp;&#34;</span><span class="op" id="1401244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401247">if</span>&nbsp;<span class="ident" id="1401250">s1</span>&nbsp;<span class="op" id="1401253">&lt;</span>&nbsp;<span class="num" id="1401255">0</span>&nbsp;<span class="op" id="1401257">||</span>&nbsp;<span class="ident" id="1401260">s2</span>&nbsp;<span class="op" id="1401263">&lt;</span>&nbsp;<span class="num" id="1401265">0</span>&nbsp;<span class="op" id="1401267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1401279">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401282">s2</span>&nbsp;<span class="op" id="1401285">+=</span>&nbsp;<span class="ident" id="1401288">s1</span>&nbsp;<span class="op" id="1401291">+</span>&nbsp;<span class="num" id="1401293">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401296">return</span>&nbsp;<span class="ident" id="1401303">line</span><span class="op" id="1401307">[</span><span class="op" id="1401308">:</span><span class="ident" id="1401309">s1</span><span class="op" id="1401311">]</span><span class="op" id="1401312">,</span>&nbsp;<span class="ident" id="1401314">line</span><span class="op" id="1401318">[</span><span class="ident" id="1401319">s1</span><span class="op" id="1401321">+</span><span class="num" id="1401322">1</span>&nbsp;<span class="op" id="1401324">:</span>&nbsp;<span class="ident" id="1401326">s2</span><span class="op" id="1401328">]</span><span class="op" id="1401329">,</span>&nbsp;<span class="ident" id="1401331">line</span><span class="op" id="1401335">[</span><span class="ident" id="1401336">s2</span><span class="op" id="1401338">+</span><span class="num" id="1401339">1</span><span class="op" id="1401340">:</span><span class="op" id="1401341">]</span><span class="op" id="1401342">,</span>&nbsp;<span class="builtintype" id="1401344">true</span><br>
<span class="lineno"></span><span class="op" id="1401349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1401352">var</span>&nbsp;<span class="ident" id="1401356">textprotoReaderPool</span>&nbsp;<span class="ident" id="1401376">sync</span><span class="op" id="1401380">.</span><span class="ident" id="1401381">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="1401387">func</span>&nbsp;<span class="ident" id="1401392">newTextprotoReader</span><span class="op" id="1401410">(</span><span class="ident" id="1401411">br</span>&nbsp;<span class="op" id="1401414">*</span><span class="ident" id="1401415">bufio</span><span class="op" id="1401420">.</span><span class="ident" id="1401421">Reader</span><span class="op" id="1401427">)</span>&nbsp;<span class="op" id="1401429">*</span><span class="ident" id="1401430">textproto</span><span class="op" id="1401439">.</span><span class="ident" id="1401440">Reader</span>&nbsp;<span class="op" id="1401447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401450">if</span>&nbsp;<span class="ident" id="1401453">v</span>&nbsp;<span class="op" id="1401455">:=</span>&nbsp;<span class="ident" id="1401458">textprotoReaderPool</span><span class="op" id="1401477">.</span><span class="ident" id="1401478">Get</span><span class="op" id="1401481">(</span><span class="op" id="1401482">)</span><span class="op" id="1401483">;</span>&nbsp;<span class="ident" id="1401485">v</span>&nbsp;<span class="op" id="1401487">!=</span>&nbsp;<span class="ident" id="1401490">nil</span>&nbsp;<span class="op" id="1401494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401498">tr</span>&nbsp;<span class="op" id="1401501">:=</span>&nbsp;<span class="ident" id="1401504">v</span><span class="op" id="1401505">.</span><span class="op" id="1401506">(</span><span class="op" id="1401507">*</span><span class="ident" id="1401508">textproto</span><span class="op" id="1401517">.</span><span class="ident" id="1401518">Reader</span><span class="op" id="1401524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401528">tr</span><span class="op" id="1401530">.</span><span class="ident" id="1401531">R</span>&nbsp;<span class="op" id="1401533">=</span>&nbsp;<span class="ident" id="1401535">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401540">return</span>&nbsp;<span class="ident" id="1401547">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1401551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401554">return</span>&nbsp;<span class="ident" id="1401561">textproto</span><span class="op" id="1401570">.</span><span class="ident" id="1401571">NewReader</span><span class="op" id="1401580">(</span><span class="ident" id="1401581">br</span><span class="op" id="1401583">)</span><br>
<span class="lineno"></span><span class="op" id="1401585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="1401588">func</span>&nbsp;<span class="ident" id="1401593">putTextprotoReader</span><span class="op" id="1401611">(</span><span class="ident" id="1401612">r</span>&nbsp;<span class="op" id="1401614">*</span><span class="ident" id="1401615">textproto</span><span class="op" id="1401624">.</span><span class="ident" id="1401625">Reader</span><span class="op" id="1401631">)</span>&nbsp;<span class="op" id="1401633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401636">r</span><span class="op" id="1401637">.</span><span class="ident" id="1401638">R</span>&nbsp;<span class="op" id="1401640">=</span>&nbsp;<span class="ident" id="1401642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401647">textprotoReaderPool</span><span class="op" id="1401666">.</span><span class="ident" id="1401667">Put</span><span class="op" id="1401670">(</span><span class="ident" id="1401671">r</span><span class="op" id="1401672">)</span><br>
<span class="lineno"></span><span class="op" id="1401674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="1401677">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1401727">func</span>&nbsp;<span class="ident" id="1401732">ReadRequest</span><span class="op" id="1401743">(</span><span class="ident" id="1401744">b</span>&nbsp;<span class="op" id="1401746">*</span><span class="ident" id="1401747">bufio</span><span class="op" id="1401752">.</span><span class="ident" id="1401753">Reader</span><span class="op" id="1401759">)</span>&nbsp;<span class="op" id="1401761">(</span><span class="ident" id="1401762">req</span>&nbsp;<span class="op" id="1401766">*</span><span class="ident" id="1401767">Request</span><span class="op" id="1401774">,</span>&nbsp;<span class="ident" id="1401776">err</span>&nbsp;<span class="builtintype" id="1401780">error</span><span class="op" id="1401785">)</span>&nbsp;<span class="op" id="1401787">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401791">tp</span>&nbsp;<span class="op" id="1401794">:=</span>&nbsp;<span class="ident" id="1401797">newTextprotoReader</span><span class="op" id="1401815">(</span><span class="ident" id="1401816">b</span><span class="op" id="1401817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401820">req</span>&nbsp;<span class="op" id="1401824">=</span>&nbsp;<span class="builtinfunc" id="1401826">new</span><span class="op" id="1401829">(</span><span class="ident" id="1401830">Request</span><span class="op" id="1401837">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1401841">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401882">var</span>&nbsp;<span class="ident" id="1401886">s</span>&nbsp;<span class="builtintype" id="1401888">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401896">if</span>&nbsp;<span class="ident" id="1401899">s</span><span class="op" id="1401900">,</span>&nbsp;<span class="ident" id="1401902">err</span>&nbsp;<span class="op" id="1401906">=</span>&nbsp;<span class="ident" id="1401908">tp</span><span class="op" id="1401910">.</span><span class="ident" id="1401911">ReadLine</span><span class="op" id="1401919">(</span><span class="op" id="1401920">)</span><span class="op" id="1401921">;</span>&nbsp;<span class="ident" id="1401923">err</span>&nbsp;<span class="op" id="1401927">!=</span>&nbsp;<span class="ident" id="1401930">nil</span>&nbsp;<span class="op" id="1401934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401938">return</span>&nbsp;<span class="ident" id="1401945">nil</span><span class="op" id="1401948">,</span>&nbsp;<span class="ident" id="1401950">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1401955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401958">defer</span>&nbsp;<span class="keyword" id="1401964">func</span><span class="op" id="1401968">(</span><span class="op" id="1401969">)</span>&nbsp;<span class="op" id="1401971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401975">putTextprotoReader</span><span class="op" id="1401993">(</span><span class="ident" id="1401994">tp</span><span class="op" id="1401996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402000">if</span>&nbsp;<span class="ident" id="1402003">err</span>&nbsp;<span class="op" id="1402007">==</span>&nbsp;<span class="ident" id="1402010">io</span><span class="op" id="1402012">.</span><span class="ident" id="1402013">EOF</span>&nbsp;<span class="op" id="1402017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402022">err</span>&nbsp;<span class="op" id="1402026">=</span>&nbsp;<span class="ident" id="1402028">io</span><span class="op" id="1402030">.</span><span class="ident" id="1402031">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402053">}</span><span class="op" id="1402054">(</span><span class="op" id="1402055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402059">var</span>&nbsp;<span class="ident" id="1402063">ok</span>&nbsp;<span class="builtintype" id="1402066">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402072">req</span><span class="op" id="1402075">.</span><span class="ident" id="1402076">Method</span><span class="op" id="1402082">,</span>&nbsp;<span class="ident" id="1402084">req</span><span class="op" id="1402087">.</span><span class="ident" id="1402088">RequestURI</span><span class="op" id="1402098">,</span>&nbsp;<span class="ident" id="1402100">req</span><span class="op" id="1402103">.</span><span class="ident" id="1402104">Proto</span><span class="op" id="1402109">,</span>&nbsp;<span class="ident" id="1402111">ok</span>&nbsp;<span class="op" id="1402114">=</span>&nbsp;<span class="ident" id="1402116">parseRequestLine</span><span class="op" id="1402132">(</span><span class="ident" id="1402133">s</span><span class="op" id="1402134">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402137">if</span>&nbsp;<span class="op" id="1402140">!</span><span class="ident" id="1402141">ok</span>&nbsp;<span class="op" id="1402144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402148">return</span>&nbsp;<span class="ident" id="1402155">nil</span><span class="op" id="1402158">,</span>&nbsp;<span class="op" id="1402160">&amp;</span><span class="ident" id="1402161">badStringError</span><span class="op" id="1402175">{</span><span class="string" id="1402176">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="1402200">,</span>&nbsp;<span class="ident" id="1402202">s</span><span class="op" id="1402203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402209">rawurl</span>&nbsp;<span class="op" id="1402216">:=</span>&nbsp;<span class="ident" id="1402219">req</span><span class="op" id="1402222">.</span><span class="ident" id="1402223">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402235">if</span>&nbsp;<span class="ident" id="1402238">req</span><span class="op" id="1402241">.</span><span class="ident" id="1402242">ProtoMajor</span><span class="op" id="1402252">,</span>&nbsp;<span class="ident" id="1402254">req</span><span class="op" id="1402257">.</span><span class="ident" id="1402258">ProtoMinor</span><span class="op" id="1402268">,</span>&nbsp;<span class="ident" id="1402270">ok</span>&nbsp;<span class="op" id="1402273">=</span>&nbsp;<span class="ident" id="1402275">ParseHTTPVersion</span><span class="op" id="1402291">(</span><span class="ident" id="1402292">req</span><span class="op" id="1402295">.</span><span class="ident" id="1402296">Proto</span><span class="op" id="1402301">)</span><span class="op" id="1402302">;</span>&nbsp;<span class="op" id="1402304">!</span><span class="ident" id="1402305">ok</span>&nbsp;<span class="op" id="1402308">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402312">return</span>&nbsp;<span class="ident" id="1402319">nil</span><span class="op" id="1402322">,</span>&nbsp;<span class="op" id="1402324">&amp;</span><span class="ident" id="1402325">badStringError</span><span class="op" id="1402339">{</span><span class="string" id="1402340">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="1402364">,</span>&nbsp;<span class="ident" id="1402366">req</span><span class="op" id="1402369">.</span><span class="ident" id="1402370">Proto</span><span class="op" id="1402375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402382">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402461">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402524">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402602">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402687">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402691">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402768">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402844">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1402924">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402941">justAuthority</span>&nbsp;<span class="op" id="1402955">:=</span>&nbsp;<span class="ident" id="1402958">req</span><span class="op" id="1402961">.</span><span class="ident" id="1402962">Method</span>&nbsp;<span class="op" id="1402969">==</span>&nbsp;<span class="string" id="1402972">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="1402982">&amp;&amp;</span>&nbsp;<span class="op" id="1402985">!</span><span class="ident" id="1402986">strings</span><span class="op" id="1402993">.</span><span class="ident" id="1402994">HasPrefix</span><span class="op" id="1403003">(</span><span class="ident" id="1403004">rawurl</span><span class="op" id="1403010">,</span>&nbsp;<span class="string" id="1403012">&#34;/&#34;</span><span class="op" id="1403015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403018">if</span>&nbsp;<span class="ident" id="1403021">justAuthority</span>&nbsp;<span class="op" id="1403035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403039">rawurl</span>&nbsp;<span class="op" id="1403046">=</span>&nbsp;<span class="string" id="1403048">&#34;http://&#34;</span>&nbsp;<span class="op" id="1403058">+</span>&nbsp;<span class="ident" id="1403060">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1403068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403072">if</span>&nbsp;<span class="ident" id="1403075">req</span><span class="op" id="1403078">.</span><span class="ident" id="1403079">URL</span><span class="op" id="1403082">,</span>&nbsp;<span class="ident" id="1403084">err</span>&nbsp;<span class="op" id="1403088">=</span>&nbsp;<span class="ident" id="1403090">url</span><span class="op" id="1403093">.</span><span class="ident" id="1403094">ParseRequestURI</span><span class="op" id="1403109">(</span><span class="ident" id="1403110">rawurl</span><span class="op" id="1403116">)</span><span class="op" id="1403117">;</span>&nbsp;<span class="ident" id="1403119">err</span>&nbsp;<span class="op" id="1403123">!=</span>&nbsp;<span class="ident" id="1403126">nil</span>&nbsp;<span class="op" id="1403130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403134">return</span>&nbsp;<span class="ident" id="1403141">nil</span><span class="op" id="1403144">,</span>&nbsp;<span class="ident" id="1403146">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1403151">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403155">if</span>&nbsp;<span class="ident" id="1403158">justAuthority</span>&nbsp;<span class="op" id="1403172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403176">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403217">req</span><span class="op" id="1403220">.</span><span class="ident" id="1403221">URL</span><span class="op" id="1403224">.</span><span class="ident" id="1403225">Scheme</span>&nbsp;<span class="op" id="1403232">=</span>&nbsp;<span class="string" id="1403234">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1403238">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403242">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403276">mimeHeader</span><span class="op" id="1403286">,</span>&nbsp;<span class="ident" id="1403288">err</span>&nbsp;<span class="op" id="1403292">:=</span>&nbsp;<span class="ident" id="1403295">tp</span><span class="op" id="1403297">.</span><span class="ident" id="1403298">ReadMIMEHeader</span><span class="op" id="1403312">(</span><span class="op" id="1403313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403316">if</span>&nbsp;<span class="ident" id="1403319">err</span>&nbsp;<span class="op" id="1403323">!=</span>&nbsp;<span class="ident" id="1403326">nil</span>&nbsp;<span class="op" id="1403330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403334">return</span>&nbsp;<span class="ident" id="1403341">nil</span><span class="op" id="1403344">,</span>&nbsp;<span class="ident" id="1403346">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1403351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403354">req</span><span class="op" id="1403357">.</span><span class="ident" id="1403358">Header</span>&nbsp;<span class="op" id="1403365">=</span>&nbsp;<span class="ident" id="1403367">Header</span><span class="op" id="1403373">(</span><span class="ident" id="1403374">mimeHeader</span><span class="op" id="1403384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403388">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403412">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403441">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403466">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403474">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403524">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403547">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403608">req</span><span class="op" id="1403611">.</span><span class="ident" id="1403612">Host</span>&nbsp;<span class="op" id="1403617">=</span>&nbsp;<span class="ident" id="1403619">req</span><span class="op" id="1403622">.</span><span class="ident" id="1403623">URL</span><span class="op" id="1403626">.</span><span class="ident" id="1403627">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403633">if</span>&nbsp;<span class="ident" id="1403636">req</span><span class="op" id="1403639">.</span><span class="ident" id="1403640">Host</span>&nbsp;<span class="op" id="1403645">==</span>&nbsp;<span class="string" id="1403648">&#34;&#34;</span>&nbsp;<span class="op" id="1403651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403655">req</span><span class="op" id="1403658">.</span><span class="ident" id="1403659">Host</span>&nbsp;<span class="op" id="1403664">=</span>&nbsp;<span class="ident" id="1403666">req</span><span class="op" id="1403669">.</span><span class="ident" id="1403670">Header</span><span class="op" id="1403676">.</span><span class="ident" id="1403677">get</span><span class="op" id="1403680">(</span><span class="string" id="1403681">&#34;Host&#34;</span><span class="op" id="1403687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1403690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1403693">delete</span><span class="op" id="1403699">(</span><span class="ident" id="1403700">req</span><span class="op" id="1403703">.</span><span class="ident" id="1403704">Header</span><span class="op" id="1403710">,</span>&nbsp;<span class="string" id="1403712">&#34;Host&#34;</span><span class="op" id="1403718">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403722">fixPragmaCacheControl</span><span class="op" id="1403743">(</span><span class="ident" id="1403744">req</span><span class="op" id="1403747">.</span><span class="ident" id="1403748">Header</span><span class="op" id="1403754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403758">err</span>&nbsp;<span class="op" id="1403762">=</span>&nbsp;<span class="ident" id="1403764">readTransfer</span><span class="op" id="1403776">(</span><span class="ident" id="1403777">req</span><span class="op" id="1403780">,</span>&nbsp;<span class="ident" id="1403782">b</span><span class="op" id="1403783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403786">if</span>&nbsp;<span class="ident" id="1403789">err</span>&nbsp;<span class="op" id="1403793">!=</span>&nbsp;<span class="ident" id="1403796">nil</span>&nbsp;<span class="op" id="1403800">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403804">return</span>&nbsp;<span class="ident" id="1403811">nil</span><span class="op" id="1403814">,</span>&nbsp;<span class="ident" id="1403816">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1403821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1403825">req</span><span class="op" id="1403828">.</span><span class="ident" id="1403829">Close</span>&nbsp;<span class="op" id="1403835">=</span>&nbsp;<span class="ident" id="1403837">shouldClose</span><span class="op" id="1403848">(</span><span class="ident" id="1403849">req</span><span class="op" id="1403852">.</span><span class="ident" id="1403853">ProtoMajor</span><span class="op" id="1403863">,</span>&nbsp;<span class="ident" id="1403865">req</span><span class="op" id="1403868">.</span><span class="ident" id="1403869">ProtoMinor</span><span class="op" id="1403879">,</span>&nbsp;<span class="ident" id="1403881">req</span><span class="op" id="1403884">.</span><span class="ident" id="1403885">Header</span><span class="op" id="1403891">,</span>&nbsp;<span class="builtintype" id="1403893">false</span><span class="op" id="1403898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403901">return</span>&nbsp;<span class="ident" id="1403908">req</span><span class="op" id="1403911">,</span>&nbsp;<span class="ident" id="1403913">nil</span><br>
<span class="lineno">670</span><span class="op" id="1403917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1403920">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1403987">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1404051">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="1404121">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1404182">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="1404236">//</span><br>
<span class="lineno"></span><span class="comment" id="1404239">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="1404307">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="1404364">func</span>&nbsp;<span class="ident" id="1404369">MaxBytesReader</span><span class="op" id="1404383">(</span><span class="ident" id="1404384">w</span>&nbsp;<span class="ident" id="1404386">ResponseWriter</span><span class="op" id="1404400">,</span>&nbsp;<span class="ident" id="1404402">r</span>&nbsp;<span class="ident" id="1404404">io</span><span class="op" id="1404406">.</span><span class="ident" id="1404407">ReadCloser</span><span class="op" id="1404417">,</span>&nbsp;<span class="ident" id="1404419">n</span>&nbsp;<span class="ident" id="1404421">int64</span><span class="op" id="1404426">)</span>&nbsp;<span class="ident" id="1404428">io</span><span class="op" id="1404430">.</span><span class="ident" id="1404431">ReadCloser</span>&nbsp;<span class="op" id="1404442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404445">return</span>&nbsp;<span class="op" id="1404452">&amp;</span><span class="ident" id="1404453">maxBytesReader</span><span class="op" id="1404467">{</span><span class="ident" id="1404468">w</span><span class="op" id="1404469">:</span>&nbsp;<span class="ident" id="1404471">w</span><span class="op" id="1404472">,</span>&nbsp;<span class="ident" id="1404474">r</span><span class="op" id="1404475">:</span>&nbsp;<span class="ident" id="1404477">r</span><span class="op" id="1404478">,</span>&nbsp;<span class="ident" id="1404480">n</span><span class="op" id="1404481">:</span>&nbsp;<span class="ident" id="1404483">n</span><span class="op" id="1404484">}</span><br>
<span class="lineno"></span><span class="op" id="1404486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1404489">type</span>&nbsp;<span class="ident" id="1404494">maxBytesReader</span>&nbsp;<span class="keyword" id="1404509">struct</span>&nbsp;<span class="op" id="1404516">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404519">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1404527">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404543">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1404551">io</span><span class="op" id="1404553">.</span><span class="ident" id="1404554">ReadCloser</span>&nbsp;<span class="comment" id="1404565">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404587">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1404595">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1404609">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404633">stopped</span>&nbsp;<span class="builtintype" id="1404641">bool</span><br>
<span class="lineno"></span><span class="op" id="1404646">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="1404649">func</span>&nbsp;<span class="op" id="1404654">(</span><span class="ident" id="1404655">l</span>&nbsp;<span class="op" id="1404657">*</span><span class="ident" id="1404658">maxBytesReader</span><span class="op" id="1404672">)</span>&nbsp;<span class="ident" id="1404674">Read</span><span class="op" id="1404678">(</span><span class="ident" id="1404679">p</span>&nbsp;<span class="op" id="1404681">[</span><span class="op" id="1404682">]</span><span class="builtintype" id="1404683">byte</span><span class="op" id="1404687">)</span>&nbsp;<span class="op" id="1404689">(</span><span class="ident" id="1404690">n</span>&nbsp;<span class="builtintype" id="1404692">int</span><span class="op" id="1404695">,</span>&nbsp;<span class="ident" id="1404697">err</span>&nbsp;<span class="builtintype" id="1404701">error</span><span class="op" id="1404706">)</span>&nbsp;<span class="op" id="1404708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404711">if</span>&nbsp;<span class="ident" id="1404714">l</span><span class="op" id="1404715">.</span><span class="ident" id="1404716">n</span>&nbsp;<span class="op" id="1404718">&lt;=</span>&nbsp;<span class="num" id="1404721">0</span>&nbsp;<span class="op" id="1404723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404727">if</span>&nbsp;<span class="op" id="1404730">!</span><span class="ident" id="1404731">l</span><span class="op" id="1404732">.</span><span class="ident" id="1404733">stopped</span>&nbsp;<span class="op" id="1404741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404746">l</span><span class="op" id="1404747">.</span><span class="ident" id="1404748">stopped</span>&nbsp;<span class="op" id="1404756">=</span>&nbsp;<span class="builtintype" id="1404758">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404766">if</span>&nbsp;<span class="ident" id="1404769">res</span><span class="op" id="1404772">,</span>&nbsp;<span class="ident" id="1404774">ok</span>&nbsp;<span class="op" id="1404777">:=</span>&nbsp;<span class="ident" id="1404780">l</span><span class="op" id="1404781">.</span><span class="ident" id="1404782">w</span><span class="op" id="1404783">.</span><span class="op" id="1404784">(</span><span class="op" id="1404785">*</span><span class="ident" id="1404786">response</span><span class="op" id="1404794">)</span><span class="op" id="1404795">;</span>&nbsp;<span class="ident" id="1404797">ok</span>&nbsp;<span class="op" id="1404800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404806">res</span><span class="op" id="1404809">.</span><span class="ident" id="1404810">requestTooLarge</span><span class="op" id="1404825">(</span><span class="op" id="1404826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404839">return</span>&nbsp;<span class="num" id="1404846">0</span><span class="op" id="1404847">,</span>&nbsp;<span class="ident" id="1404849">errors</span><span class="op" id="1404855">.</span><span class="ident" id="1404856">New</span><span class="op" id="1404859">(</span><span class="string" id="1404860">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="1404890">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404896">if</span>&nbsp;<span class="ident" id="1404899">int64</span><span class="op" id="1404904">(</span><span class="builtinfunc" id="1404905">len</span><span class="op" id="1404908">(</span><span class="ident" id="1404909">p</span><span class="op" id="1404910">)</span><span class="op" id="1404911">)</span>&nbsp;<span class="op" id="1404913">&gt;</span>&nbsp;<span class="ident" id="1404915">l</span><span class="op" id="1404916">.</span><span class="ident" id="1404917">n</span>&nbsp;<span class="op" id="1404919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404923">p</span>&nbsp;<span class="op" id="1404925">=</span>&nbsp;<span class="ident" id="1404927">p</span><span class="op" id="1404928">[</span><span class="op" id="1404929">:</span><span class="ident" id="1404930">l</span><span class="op" id="1404931">.</span><span class="ident" id="1404932">n</span><span class="op" id="1404933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404939">n</span><span class="op" id="1404940">,</span>&nbsp;<span class="ident" id="1404942">err</span>&nbsp;<span class="op" id="1404946">=</span>&nbsp;<span class="ident" id="1404948">l</span><span class="op" id="1404949">.</span><span class="ident" id="1404950">r</span><span class="op" id="1404951">.</span><span class="ident" id="1404952">Read</span><span class="op" id="1404956">(</span><span class="ident" id="1404957">p</span><span class="op" id="1404958">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404961">l</span><span class="op" id="1404962">.</span><span class="ident" id="1404963">n</span>&nbsp;<span class="op" id="1404965">-=</span>&nbsp;<span class="ident" id="1404968">int64</span><span class="op" id="1404973">(</span><span class="ident" id="1404974">n</span><span class="op" id="1404975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404978">return</span><br>
<span class="lineno"></span><span class="op" id="1404985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1404988">func</span>&nbsp;<span class="op" id="1404993">(</span><span class="ident" id="1404994">l</span>&nbsp;<span class="op" id="1404996">*</span><span class="ident" id="1404997">maxBytesReader</span><span class="op" id="1405011">)</span>&nbsp;<span class="ident" id="1405013">Close</span><span class="op" id="1405018">(</span><span class="op" id="1405019">)</span>&nbsp;<span class="builtintype" id="1405021">error</span>&nbsp;<span class="op" id="1405027">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405030">return</span>&nbsp;<span class="ident" id="1405037">l</span><span class="op" id="1405038">.</span><span class="ident" id="1405039">r</span><span class="op" id="1405040">.</span><span class="ident" id="1405041">Close</span><span class="op" id="1405046">(</span><span class="op" id="1405047">)</span><br>
<span class="lineno"></span><span class="op" id="1405049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1405052">func</span>&nbsp;<span class="ident" id="1405057">copyValues</span><span class="op" id="1405067">(</span><span class="ident" id="1405068">dst</span><span class="op" id="1405071">,</span>&nbsp;<span class="ident" id="1405073">src</span>&nbsp;<span class="ident" id="1405077">url</span><span class="op" id="1405080">.</span><span class="ident" id="1405081">Values</span><span class="op" id="1405087">)</span>&nbsp;<span class="op" id="1405089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405092">for</span>&nbsp;<span class="ident" id="1405096">k</span><span class="op" id="1405097">,</span>&nbsp;<span class="ident" id="1405099">vs</span>&nbsp;<span class="op" id="1405102">:=</span>&nbsp;<span class="keyword" id="1405105">range</span>&nbsp;<span class="ident" id="1405111">src</span>&nbsp;<span class="op" id="1405115">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405119">for</span>&nbsp;<span class="ident" id="1405123">_</span><span class="op" id="1405124">,</span>&nbsp;<span class="ident" id="1405126">value</span>&nbsp;<span class="op" id="1405132">:=</span>&nbsp;<span class="keyword" id="1405135">range</span>&nbsp;<span class="ident" id="1405141">vs</span>&nbsp;<span class="op" id="1405144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405149">dst</span><span class="op" id="1405152">.</span><span class="ident" id="1405153">Add</span><span class="op" id="1405156">(</span><span class="ident" id="1405157">k</span><span class="op" id="1405158">,</span>&nbsp;<span class="ident" id="1405160">value</span><span class="op" id="1405165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405172">}</span><br>
<span class="lineno"></span><span class="op" id="1405174">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="1405177">func</span>&nbsp;<span class="ident" id="1405182">parsePostForm</span><span class="op" id="1405195">(</span><span class="ident" id="1405196">r</span>&nbsp;<span class="op" id="1405198">*</span><span class="ident" id="1405199">Request</span><span class="op" id="1405206">)</span>&nbsp;<span class="op" id="1405208">(</span><span class="ident" id="1405209">vs</span>&nbsp;<span class="ident" id="1405212">url</span><span class="op" id="1405215">.</span><span class="ident" id="1405216">Values</span><span class="op" id="1405222">,</span>&nbsp;<span class="ident" id="1405224">err</span>&nbsp;<span class="builtintype" id="1405228">error</span><span class="op" id="1405233">)</span>&nbsp;<span class="op" id="1405235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405238">if</span>&nbsp;<span class="ident" id="1405241">r</span><span class="op" id="1405242">.</span><span class="ident" id="1405243">Body</span>&nbsp;<span class="op" id="1405248">==</span>&nbsp;<span class="ident" id="1405251">nil</span>&nbsp;<span class="op" id="1405255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405259">err</span>&nbsp;<span class="op" id="1405263">=</span>&nbsp;<span class="ident" id="1405265">errors</span><span class="op" id="1405271">.</span><span class="ident" id="1405272">New</span><span class="op" id="1405275">(</span><span class="string" id="1405276">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="1405295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405299">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405310">ct</span>&nbsp;<span class="op" id="1405313">:=</span>&nbsp;<span class="ident" id="1405316">r</span><span class="op" id="1405317">.</span><span class="ident" id="1405318">Header</span><span class="op" id="1405324">.</span><span class="ident" id="1405325">Get</span><span class="op" id="1405328">(</span><span class="string" id="1405329">&#34;Content-Type&#34;</span><span class="op" id="1405343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1405346">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1405387">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405439">if</span>&nbsp;<span class="ident" id="1405442">ct</span>&nbsp;<span class="op" id="1405445">==</span>&nbsp;<span class="string" id="1405448">&#34;&#34;</span>&nbsp;<span class="op" id="1405451">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405455">ct</span>&nbsp;<span class="op" id="1405458">=</span>&nbsp;<span class="string" id="1405460">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405491">ct</span><span class="op" id="1405493">,</span>&nbsp;<span class="ident" id="1405495">_</span><span class="op" id="1405496">,</span>&nbsp;<span class="ident" id="1405498">err</span>&nbsp;<span class="op" id="1405502">=</span>&nbsp;<span class="ident" id="1405504">mime</span><span class="op" id="1405508">.</span><span class="ident" id="1405509">ParseMediaType</span><span class="op" id="1405523">(</span><span class="ident" id="1405524">ct</span><span class="op" id="1405526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405529">switch</span>&nbsp;<span class="op" id="1405536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405539">case</span>&nbsp;<span class="ident" id="1405544">ct</span>&nbsp;<span class="op" id="1405547">==</span>&nbsp;<span class="string" id="1405550">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="1405585">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405589">var</span>&nbsp;<span class="ident" id="1405593">reader</span>&nbsp;<span class="ident" id="1405600">io</span><span class="op" id="1405602">.</span><span class="ident" id="1405603">Reader</span>&nbsp;<span class="op" id="1405610">=</span>&nbsp;<span class="ident" id="1405612">r</span><span class="op" id="1405613">.</span><span class="ident" id="1405614">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405621">maxFormSize</span>&nbsp;<span class="op" id="1405633">:=</span>&nbsp;<span class="ident" id="1405636">int64</span><span class="op" id="1405641">(</span><span class="num" id="1405642">1</span><span class="op" id="1405643">&lt;&lt;</span><span class="num" id="1405645">63</span>&nbsp;<span class="op" id="1405648">-</span>&nbsp;<span class="num" id="1405650">1</span><span class="op" id="1405651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405655">if</span>&nbsp;<span class="ident" id="1405658">_</span><span class="op" id="1405659">,</span>&nbsp;<span class="ident" id="1405661">ok</span>&nbsp;<span class="op" id="1405664">:=</span>&nbsp;<span class="ident" id="1405667">r</span><span class="op" id="1405668">.</span><span class="ident" id="1405669">Body</span><span class="op" id="1405673">.</span><span class="op" id="1405674">(</span><span class="op" id="1405675">*</span><span class="ident" id="1405676">maxBytesReader</span><span class="op" id="1405690">)</span><span class="op" id="1405691">;</span>&nbsp;<span class="op" id="1405693">!</span><span class="ident" id="1405694">ok</span>&nbsp;<span class="op" id="1405697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405702">maxFormSize</span>&nbsp;<span class="op" id="1405714">=</span>&nbsp;<span class="ident" id="1405716">int64</span><span class="op" id="1405721">(</span><span class="num" id="1405722">10</span>&nbsp;<span class="op" id="1405725">&lt;&lt;</span>&nbsp;<span class="num" id="1405728">20</span><span class="op" id="1405730">)</span>&nbsp;<span class="comment" id="1405732">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405762">reader</span>&nbsp;<span class="op" id="1405769">=</span>&nbsp;<span class="ident" id="1405771">io</span><span class="op" id="1405773">.</span><span class="ident" id="1405774">LimitReader</span><span class="op" id="1405785">(</span><span class="ident" id="1405786">r</span><span class="op" id="1405787">.</span><span class="ident" id="1405788">Body</span><span class="op" id="1405792">,</span>&nbsp;<span class="ident" id="1405794">maxFormSize</span><span class="op" id="1405805">+</span><span class="num" id="1405806">1</span><span class="op" id="1405807">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405815">b</span><span class="op" id="1405816">,</span>&nbsp;<span class="ident" id="1405818">e</span>&nbsp;<span class="op" id="1405820">:=</span>&nbsp;<span class="ident" id="1405823">ioutil</span><span class="op" id="1405829">.</span><span class="ident" id="1405830">ReadAll</span><span class="op" id="1405837">(</span><span class="ident" id="1405838">reader</span><span class="op" id="1405844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405848">if</span>&nbsp;<span class="ident" id="1405851">e</span>&nbsp;<span class="op" id="1405853">!=</span>&nbsp;<span class="ident" id="1405856">nil</span>&nbsp;<span class="op" id="1405860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405865">if</span>&nbsp;<span class="ident" id="1405868">err</span>&nbsp;<span class="op" id="1405872">==</span>&nbsp;<span class="ident" id="1405875">nil</span>&nbsp;<span class="op" id="1405879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405885">err</span>&nbsp;<span class="op" id="1405889">=</span>&nbsp;<span class="ident" id="1405891">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405901">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405913">if</span>&nbsp;<span class="ident" id="1405916">int64</span><span class="op" id="1405921">(</span><span class="builtinfunc" id="1405922">len</span><span class="op" id="1405925">(</span><span class="ident" id="1405926">b</span><span class="op" id="1405927">)</span><span class="op" id="1405928">)</span>&nbsp;<span class="op" id="1405930">&gt;</span>&nbsp;<span class="ident" id="1405932">maxFormSize</span>&nbsp;<span class="op" id="1405944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405949">err</span>&nbsp;<span class="op" id="1405953">=</span>&nbsp;<span class="ident" id="1405955">errors</span><span class="op" id="1405961">.</span><span class="ident" id="1405962">New</span><span class="op" id="1405965">(</span><span class="string" id="1405966">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="1405988">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405993">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1406002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1406006">vs</span><span class="op" id="1406008">,</span>&nbsp;<span class="ident" id="1406010">e</span>&nbsp;<span class="op" id="1406012">=</span>&nbsp;<span class="ident" id="1406014">url</span><span class="op" id="1406017">.</span><span class="ident" id="1406018">ParseQuery</span><span class="op" id="1406028">(</span><span class="builtintype" id="1406029">string</span><span class="op" id="1406035">(</span><span class="ident" id="1406036">b</span><span class="op" id="1406037">)</span><span class="op" id="1406038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406042">if</span>&nbsp;<span class="ident" id="1406045">err</span>&nbsp;<span class="op" id="1406049">==</span>&nbsp;<span class="ident" id="1406052">nil</span>&nbsp;<span class="op" id="1406056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1406061">err</span>&nbsp;<span class="op" id="1406065">=</span>&nbsp;<span class="ident" id="1406067">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1406071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406074">case</span>&nbsp;<span class="ident" id="1406079">ct</span>&nbsp;<span class="op" id="1406082">==</span>&nbsp;<span class="string" id="1406085">&#34;multipart/form-data&#34;</span><span class="op" id="1406106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1406110">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1406181">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1406230">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1406275">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1406316">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1406365">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1406412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406415">return</span><br>
<span class="lineno">765</span><span class="op" id="1406422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1406425">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="1406492">//</span><br>
<span class="lineno"></span><span class="comment" id="1406495">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="1406570">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="1406622">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="1406699">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="1406713">//</span><br>
<span class="lineno"></span><span class="comment" id="1406716">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="1406794">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="1406825">//</span><br>
<span class="lineno"></span><span class="comment" id="1406828">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="1406881">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="1406902">func</span>&nbsp;<span class="op" id="1406907">(</span><span class="ident" id="1406908">r</span>&nbsp;<span class="op" id="1406910">*</span><span class="ident" id="1406911">Request</span><span class="op" id="1406918">)</span>&nbsp;<span class="ident" id="1406920">ParseForm</span><span class="op" id="1406929">(</span><span class="op" id="1406930">)</span>&nbsp;<span class="builtintype" id="1406932">error</span>&nbsp;<span class="op" id="1406938">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406941">var</span>&nbsp;<span class="ident" id="1406945">err</span>&nbsp;<span class="builtintype" id="1406949">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406956">if</span>&nbsp;<span class="ident" id="1406959">r</span><span class="op" id="1406960">.</span><span class="ident" id="1406961">PostForm</span>&nbsp;<span class="op" id="1406970">==</span>&nbsp;<span class="ident" id="1406973">nil</span>&nbsp;<span class="op" id="1406977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406981">if</span>&nbsp;<span class="ident" id="1406984">r</span><span class="op" id="1406985">.</span><span class="ident" id="1406986">Method</span>&nbsp;<span class="op" id="1406993">==</span>&nbsp;<span class="string" id="1406996">&#34;POST&#34;</span>&nbsp;<span class="op" id="1407003">||</span>&nbsp;<span class="ident" id="1407006">r</span><span class="op" id="1407007">.</span><span class="ident" id="1407008">Method</span>&nbsp;<span class="op" id="1407015">==</span>&nbsp;<span class="string" id="1407018">&#34;PUT&#34;</span>&nbsp;<span class="op" id="1407024">||</span>&nbsp;<span class="ident" id="1407027">r</span><span class="op" id="1407028">.</span><span class="ident" id="1407029">Method</span>&nbsp;<span class="op" id="1407036">==</span>&nbsp;<span class="string" id="1407039">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="1407047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407052">r</span><span class="op" id="1407053">.</span><span class="ident" id="1407054">PostForm</span><span class="op" id="1407062">,</span>&nbsp;<span class="ident" id="1407064">err</span>&nbsp;<span class="op" id="1407068">=</span>&nbsp;<span class="ident" id="1407070">parsePostForm</span><span class="op" id="1407083">(</span><span class="ident" id="1407084">r</span><span class="op" id="1407085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407089">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407093">if</span>&nbsp;<span class="ident" id="1407096">r</span><span class="op" id="1407097">.</span><span class="ident" id="1407098">PostForm</span>&nbsp;<span class="op" id="1407107">==</span>&nbsp;<span class="ident" id="1407110">nil</span>&nbsp;<span class="op" id="1407114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407119">r</span><span class="op" id="1407120">.</span><span class="ident" id="1407121">PostForm</span>&nbsp;<span class="op" id="1407130">=</span>&nbsp;<span class="builtinfunc" id="1407132">make</span><span class="op" id="1407136">(</span><span class="ident" id="1407137">url</span><span class="op" id="1407140">.</span><span class="ident" id="1407141">Values</span><span class="op" id="1407147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407157">if</span>&nbsp;<span class="ident" id="1407160">r</span><span class="op" id="1407161">.</span><span class="ident" id="1407162">Form</span>&nbsp;<span class="op" id="1407167">==</span>&nbsp;<span class="ident" id="1407170">nil</span>&nbsp;<span class="op" id="1407174">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407178">if</span>&nbsp;<span class="builtinfunc" id="1407181">len</span><span class="op" id="1407184">(</span><span class="ident" id="1407185">r</span><span class="op" id="1407186">.</span><span class="ident" id="1407187">PostForm</span><span class="op" id="1407195">)</span>&nbsp;<span class="op" id="1407197">&gt;</span>&nbsp;<span class="num" id="1407199">0</span>&nbsp;<span class="op" id="1407201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407206">r</span><span class="op" id="1407207">.</span><span class="ident" id="1407208">Form</span>&nbsp;<span class="op" id="1407213">=</span>&nbsp;<span class="builtinfunc" id="1407215">make</span><span class="op" id="1407219">(</span><span class="ident" id="1407220">url</span><span class="op" id="1407223">.</span><span class="ident" id="1407224">Values</span><span class="op" id="1407230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407235">copyValues</span><span class="op" id="1407245">(</span><span class="ident" id="1407246">r</span><span class="op" id="1407247">.</span><span class="ident" id="1407248">Form</span><span class="op" id="1407252">,</span>&nbsp;<span class="ident" id="1407254">r</span><span class="op" id="1407255">.</span><span class="ident" id="1407256">PostForm</span><span class="op" id="1407264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407272">var</span>&nbsp;<span class="ident" id="1407276">newValues</span>&nbsp;<span class="ident" id="1407286">url</span><span class="op" id="1407289">.</span><span class="ident" id="1407290">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407299">if</span>&nbsp;<span class="ident" id="1407302">r</span><span class="op" id="1407303">.</span><span class="ident" id="1407304">URL</span>&nbsp;<span class="op" id="1407308">!=</span>&nbsp;<span class="ident" id="1407311">nil</span>&nbsp;<span class="op" id="1407315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407320">var</span>&nbsp;<span class="ident" id="1407324">e</span>&nbsp;<span class="builtintype" id="1407326">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407335">newValues</span><span class="op" id="1407344">,</span>&nbsp;<span class="ident" id="1407346">e</span>&nbsp;<span class="op" id="1407348">=</span>&nbsp;<span class="ident" id="1407350">url</span><span class="op" id="1407353">.</span><span class="ident" id="1407354">ParseQuery</span><span class="op" id="1407364">(</span><span class="ident" id="1407365">r</span><span class="op" id="1407366">.</span><span class="ident" id="1407367">URL</span><span class="op" id="1407370">.</span><span class="ident" id="1407371">RawQuery</span><span class="op" id="1407379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407384">if</span>&nbsp;<span class="ident" id="1407387">err</span>&nbsp;<span class="op" id="1407391">==</span>&nbsp;<span class="ident" id="1407394">nil</span>&nbsp;<span class="op" id="1407398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407404">err</span>&nbsp;<span class="op" id="1407408">=</span>&nbsp;<span class="ident" id="1407410">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407423">if</span>&nbsp;<span class="ident" id="1407426">newValues</span>&nbsp;<span class="op" id="1407436">==</span>&nbsp;<span class="ident" id="1407439">nil</span>&nbsp;<span class="op" id="1407443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407448">newValues</span>&nbsp;<span class="op" id="1407458">=</span>&nbsp;<span class="builtinfunc" id="1407460">make</span><span class="op" id="1407464">(</span><span class="ident" id="1407465">url</span><span class="op" id="1407468">.</span><span class="ident" id="1407469">Values</span><span class="op" id="1407475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407479">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407483">if</span>&nbsp;<span class="ident" id="1407486">r</span><span class="op" id="1407487">.</span><span class="ident" id="1407488">Form</span>&nbsp;<span class="op" id="1407493">==</span>&nbsp;<span class="ident" id="1407496">nil</span>&nbsp;<span class="op" id="1407500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407505">r</span><span class="op" id="1407506">.</span><span class="ident" id="1407507">Form</span>&nbsp;<span class="op" id="1407512">=</span>&nbsp;<span class="ident" id="1407514">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407526">}</span>&nbsp;<span class="keyword" id="1407528">else</span>&nbsp;<span class="op" id="1407533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407538">copyValues</span><span class="op" id="1407548">(</span><span class="ident" id="1407549">r</span><span class="op" id="1407550">.</span><span class="ident" id="1407551">Form</span><span class="op" id="1407555">,</span>&nbsp;<span class="ident" id="1407557">newValues</span><span class="op" id="1407566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407570">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407576">return</span>&nbsp;<span class="ident" id="1407583">err</span><br>
<span class="lineno"></span><span class="op" id="1407587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1407590">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="1407658">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1407734">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1407803">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="1407831">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="1407883">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="1407957">func</span>&nbsp;<span class="op" id="1407962">(</span><span class="ident" id="1407963">r</span>&nbsp;<span class="op" id="1407965">*</span><span class="ident" id="1407966">Request</span><span class="op" id="1407973">)</span>&nbsp;<span class="ident" id="1407975">ParseMultipartForm</span><span class="op" id="1407993">(</span><span class="ident" id="1407994">maxMemory</span>&nbsp;<span class="ident" id="1408004">int64</span><span class="op" id="1408009">)</span>&nbsp;<span class="builtintype" id="1408011">error</span>&nbsp;<span class="op" id="1408017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408020">if</span>&nbsp;<span class="ident" id="1408023">r</span><span class="op" id="1408024">.</span><span class="ident" id="1408025">MultipartForm</span>&nbsp;<span class="op" id="1408039">==</span>&nbsp;<span class="ident" id="1408042">multipartByReader</span>&nbsp;<span class="op" id="1408060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408064">return</span>&nbsp;<span class="ident" id="1408071">errors</span><span class="op" id="1408077">.</span><span class="ident" id="1408078">New</span><span class="op" id="1408081">(</span><span class="string" id="1408082">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="1408126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408132">if</span>&nbsp;<span class="ident" id="1408135">r</span><span class="op" id="1408136">.</span><span class="ident" id="1408137">Form</span>&nbsp;<span class="op" id="1408142">==</span>&nbsp;<span class="ident" id="1408145">nil</span>&nbsp;<span class="op" id="1408149">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408153">err</span>&nbsp;<span class="op" id="1408157">:=</span>&nbsp;<span class="ident" id="1408160">r</span><span class="op" id="1408161">.</span><span class="ident" id="1408162">ParseForm</span><span class="op" id="1408171">(</span><span class="op" id="1408172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408176">if</span>&nbsp;<span class="ident" id="1408179">err</span>&nbsp;<span class="op" id="1408183">!=</span>&nbsp;<span class="ident" id="1408186">nil</span>&nbsp;<span class="op" id="1408190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408195">return</span>&nbsp;<span class="ident" id="1408202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408211">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408214">if</span>&nbsp;<span class="ident" id="1408217">r</span><span class="op" id="1408218">.</span><span class="ident" id="1408219">MultipartForm</span>&nbsp;<span class="op" id="1408233">!=</span>&nbsp;<span class="ident" id="1408236">nil</span>&nbsp;<span class="op" id="1408240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408244">return</span>&nbsp;<span class="ident" id="1408251">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408260">mr</span><span class="op" id="1408262">,</span>&nbsp;<span class="ident" id="1408264">err</span>&nbsp;<span class="op" id="1408268">:=</span>&nbsp;<span class="ident" id="1408271">r</span><span class="op" id="1408272">.</span><span class="ident" id="1408273">multipartReader</span><span class="op" id="1408288">(</span><span class="op" id="1408289">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408292">if</span>&nbsp;<span class="ident" id="1408295">err</span>&nbsp;<span class="op" id="1408299">!=</span>&nbsp;<span class="ident" id="1408302">nil</span>&nbsp;<span class="op" id="1408306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408310">return</span>&nbsp;<span class="ident" id="1408317">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408326">f</span><span class="op" id="1408327">,</span>&nbsp;<span class="ident" id="1408329">err</span>&nbsp;<span class="op" id="1408333">:=</span>&nbsp;<span class="ident" id="1408336">mr</span><span class="op" id="1408338">.</span><span class="ident" id="1408339">ReadForm</span><span class="op" id="1408347">(</span><span class="ident" id="1408348">maxMemory</span><span class="op" id="1408357">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408360">if</span>&nbsp;<span class="ident" id="1408363">err</span>&nbsp;<span class="op" id="1408367">!=</span>&nbsp;<span class="ident" id="1408370">nil</span>&nbsp;<span class="op" id="1408374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408378">return</span>&nbsp;<span class="ident" id="1408385">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408393">for</span>&nbsp;<span class="ident" id="1408397">k</span><span class="op" id="1408398">,</span>&nbsp;<span class="ident" id="1408400">v</span>&nbsp;<span class="op" id="1408402">:=</span>&nbsp;<span class="keyword" id="1408405">range</span>&nbsp;<span class="ident" id="1408411">f</span><span class="op" id="1408412">.</span><span class="ident" id="1408413">Value</span>&nbsp;<span class="op" id="1408419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408423">r</span><span class="op" id="1408424">.</span><span class="ident" id="1408425">Form</span><span class="op" id="1408429">[</span><span class="ident" id="1408430">k</span><span class="op" id="1408431">]</span>&nbsp;<span class="op" id="1408433">=</span>&nbsp;<span class="builtinfunc" id="1408435">append</span><span class="op" id="1408441">(</span><span class="ident" id="1408442">r</span><span class="op" id="1408443">.</span><span class="ident" id="1408444">Form</span><span class="op" id="1408448">[</span><span class="ident" id="1408449">k</span><span class="op" id="1408450">]</span><span class="op" id="1408451">,</span>&nbsp;<span class="ident" id="1408453">v</span><span class="op" id="1408454">...</span><span class="op" id="1408457">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408463">r</span><span class="op" id="1408464">.</span><span class="ident" id="1408465">MultipartForm</span>&nbsp;<span class="op" id="1408479">=</span>&nbsp;<span class="ident" id="1408481">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408485">return</span>&nbsp;<span class="ident" id="1408492">nil</span><br>
<span class="lineno"></span><span class="op" id="1408496">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="1408499">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="1408574">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="1408652">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="1408729">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="1408772">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1408837">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1408876">func</span>&nbsp;<span class="op" id="1408881">(</span><span class="ident" id="1408882">r</span>&nbsp;<span class="op" id="1408884">*</span><span class="ident" id="1408885">Request</span><span class="op" id="1408892">)</span>&nbsp;<span class="ident" id="1408894">FormValue</span><span class="op" id="1408903">(</span><span class="ident" id="1408904">key</span>&nbsp;<span class="builtintype" id="1408908">string</span><span class="op" id="1408914">)</span>&nbsp;<span class="builtintype" id="1408916">string</span>&nbsp;<span class="op" id="1408923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408926">if</span>&nbsp;<span class="ident" id="1408929">r</span><span class="op" id="1408930">.</span><span class="ident" id="1408931">Form</span>&nbsp;<span class="op" id="1408936">==</span>&nbsp;<span class="ident" id="1408939">nil</span>&nbsp;<span class="op" id="1408943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408947">r</span><span class="op" id="1408948">.</span><span class="ident" id="1408949">ParseMultipartForm</span><span class="op" id="1408967">(</span><span class="ident" id="1408968">defaultMaxMemory</span><span class="op" id="1408984">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408990">if</span>&nbsp;<span class="ident" id="1408993">vs</span>&nbsp;<span class="op" id="1408996">:=</span>&nbsp;<span class="ident" id="1408999">r</span><span class="op" id="1409000">.</span><span class="ident" id="1409001">Form</span><span class="op" id="1409005">[</span><span class="ident" id="1409006">key</span><span class="op" id="1409009">]</span><span class="op" id="1409010">;</span>&nbsp;<span class="builtinfunc" id="1409012">len</span><span class="op" id="1409015">(</span><span class="ident" id="1409016">vs</span><span class="op" id="1409018">)</span>&nbsp;<span class="op" id="1409020">&gt;</span>&nbsp;<span class="num" id="1409022">0</span>&nbsp;<span class="op" id="1409024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409028">return</span>&nbsp;<span class="ident" id="1409035">vs</span><span class="op" id="1409037">[</span><span class="num" id="1409038">0</span><span class="op" id="1409039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409045">return</span>&nbsp;<span class="string" id="1409052">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="1409055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1409058">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="1409135">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1409193">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="1409274">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="1409317">func</span>&nbsp;<span class="op" id="1409322">(</span><span class="ident" id="1409323">r</span>&nbsp;<span class="op" id="1409325">*</span><span class="ident" id="1409326">Request</span><span class="op" id="1409333">)</span>&nbsp;<span class="ident" id="1409335">PostFormValue</span><span class="op" id="1409348">(</span><span class="ident" id="1409349">key</span>&nbsp;<span class="builtintype" id="1409353">string</span><span class="op" id="1409359">)</span>&nbsp;<span class="builtintype" id="1409361">string</span>&nbsp;<span class="op" id="1409368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409371">if</span>&nbsp;<span class="ident" id="1409374">r</span><span class="op" id="1409375">.</span><span class="ident" id="1409376">PostForm</span>&nbsp;<span class="op" id="1409385">==</span>&nbsp;<span class="ident" id="1409388">nil</span>&nbsp;<span class="op" id="1409392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409396">r</span><span class="op" id="1409397">.</span><span class="ident" id="1409398">ParseMultipartForm</span><span class="op" id="1409416">(</span><span class="ident" id="1409417">defaultMaxMemory</span><span class="op" id="1409433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409436">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409439">if</span>&nbsp;<span class="ident" id="1409442">vs</span>&nbsp;<span class="op" id="1409445">:=</span>&nbsp;<span class="ident" id="1409448">r</span><span class="op" id="1409449">.</span><span class="ident" id="1409450">PostForm</span><span class="op" id="1409458">[</span><span class="ident" id="1409459">key</span><span class="op" id="1409462">]</span><span class="op" id="1409463">;</span>&nbsp;<span class="builtinfunc" id="1409465">len</span><span class="op" id="1409468">(</span><span class="ident" id="1409469">vs</span><span class="op" id="1409471">)</span>&nbsp;<span class="op" id="1409473">&gt;</span>&nbsp;<span class="num" id="1409475">0</span>&nbsp;<span class="op" id="1409477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409481">return</span>&nbsp;<span class="ident" id="1409488">vs</span><span class="op" id="1409490">[</span><span class="num" id="1409491">0</span><span class="op" id="1409492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409498">return</span>&nbsp;<span class="string" id="1409505">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="1409508">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="1409511">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="1409573">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="1409638">func</span>&nbsp;<span class="op" id="1409643">(</span><span class="ident" id="1409644">r</span>&nbsp;<span class="op" id="1409646">*</span><span class="ident" id="1409647">Request</span><span class="op" id="1409654">)</span>&nbsp;<span class="ident" id="1409656">FormFile</span><span class="op" id="1409664">(</span><span class="ident" id="1409665">key</span>&nbsp;<span class="builtintype" id="1409669">string</span><span class="op" id="1409675">)</span>&nbsp;<span class="op" id="1409677">(</span><span class="ident" id="1409678">multipart</span><span class="op" id="1409687">.</span><span class="ident" id="1409688">File</span><span class="op" id="1409692">,</span>&nbsp;<span class="op" id="1409694">*</span><span class="ident" id="1409695">multipart</span><span class="op" id="1409704">.</span><span class="ident" id="1409705">FileHeader</span><span class="op" id="1409715">,</span>&nbsp;<span class="builtintype" id="1409717">error</span><span class="op" id="1409722">)</span>&nbsp;<span class="op" id="1409724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409727">if</span>&nbsp;<span class="ident" id="1409730">r</span><span class="op" id="1409731">.</span><span class="ident" id="1409732">MultipartForm</span>&nbsp;<span class="op" id="1409746">==</span>&nbsp;<span class="ident" id="1409749">multipartByReader</span>&nbsp;<span class="op" id="1409767">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409771">return</span>&nbsp;<span class="ident" id="1409778">nil</span><span class="op" id="1409781">,</span>&nbsp;<span class="ident" id="1409783">nil</span><span class="op" id="1409786">,</span>&nbsp;<span class="ident" id="1409788">errors</span><span class="op" id="1409794">.</span><span class="ident" id="1409795">New</span><span class="op" id="1409798">(</span><span class="string" id="1409799">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="1409843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409849">if</span>&nbsp;<span class="ident" id="1409852">r</span><span class="op" id="1409853">.</span><span class="ident" id="1409854">MultipartForm</span>&nbsp;<span class="op" id="1409868">==</span>&nbsp;<span class="ident" id="1409871">nil</span>&nbsp;<span class="op" id="1409875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409879">err</span>&nbsp;<span class="op" id="1409883">:=</span>&nbsp;<span class="ident" id="1409886">r</span><span class="op" id="1409887">.</span><span class="ident" id="1409888">ParseMultipartForm</span><span class="op" id="1409906">(</span><span class="ident" id="1409907">defaultMaxMemory</span><span class="op" id="1409923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409927">if</span>&nbsp;<span class="ident" id="1409930">err</span>&nbsp;<span class="op" id="1409934">!=</span>&nbsp;<span class="ident" id="1409937">nil</span>&nbsp;<span class="op" id="1409941">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409946">return</span>&nbsp;<span class="ident" id="1409953">nil</span><span class="op" id="1409956">,</span>&nbsp;<span class="ident" id="1409958">nil</span><span class="op" id="1409961">,</span>&nbsp;<span class="ident" id="1409963">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409975">if</span>&nbsp;<span class="ident" id="1409978">r</span><span class="op" id="1409979">.</span><span class="ident" id="1409980">MultipartForm</span>&nbsp;<span class="op" id="1409994">!=</span>&nbsp;<span class="ident" id="1409997">nil</span>&nbsp;<span class="op" id="1410001">&amp;&amp;</span>&nbsp;<span class="ident" id="1410004">r</span><span class="op" id="1410005">.</span><span class="ident" id="1410006">MultipartForm</span><span class="op" id="1410019">.</span><span class="ident" id="1410020">File</span>&nbsp;<span class="op" id="1410025">!=</span>&nbsp;<span class="ident" id="1410028">nil</span>&nbsp;<span class="op" id="1410032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410036">if</span>&nbsp;<span class="ident" id="1410039">fhs</span>&nbsp;<span class="op" id="1410043">:=</span>&nbsp;<span class="ident" id="1410046">r</span><span class="op" id="1410047">.</span><span class="ident" id="1410048">MultipartForm</span><span class="op" id="1410061">.</span><span class="ident" id="1410062">File</span><span class="op" id="1410066">[</span><span class="ident" id="1410067">key</span><span class="op" id="1410070">]</span><span class="op" id="1410071">;</span>&nbsp;<span class="builtinfunc" id="1410073">len</span><span class="op" id="1410076">(</span><span class="ident" id="1410077">fhs</span><span class="op" id="1410080">)</span>&nbsp;<span class="op" id="1410082">&gt;</span>&nbsp;<span class="num" id="1410084">0</span>&nbsp;<span class="op" id="1410086">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410091">f</span><span class="op" id="1410092">,</span>&nbsp;<span class="ident" id="1410094">err</span>&nbsp;<span class="op" id="1410098">:=</span>&nbsp;<span class="ident" id="1410101">fhs</span><span class="op" id="1410104">[</span><span class="num" id="1410105">0</span><span class="op" id="1410106">]</span><span class="op" id="1410107">.</span><span class="ident" id="1410108">Open</span><span class="op" id="1410112">(</span><span class="op" id="1410113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410118">return</span>&nbsp;<span class="ident" id="1410125">f</span><span class="op" id="1410126">,</span>&nbsp;<span class="ident" id="1410128">fhs</span><span class="op" id="1410131">[</span><span class="num" id="1410132">0</span><span class="op" id="1410133">]</span><span class="op" id="1410134">,</span>&nbsp;<span class="ident" id="1410136">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410148">return</span>&nbsp;<span class="ident" id="1410155">nil</span><span class="op" id="1410158">,</span>&nbsp;<span class="ident" id="1410160">nil</span><span class="op" id="1410163">,</span>&nbsp;<span class="ident" id="1410165">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="1410180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1410183">func</span>&nbsp;<span class="op" id="1410188">(</span><span class="ident" id="1410189">r</span>&nbsp;<span class="op" id="1410191">*</span><span class="ident" id="1410192">Request</span><span class="op" id="1410199">)</span>&nbsp;<span class="ident" id="1410201">expectsContinue</span><span class="op" id="1410216">(</span><span class="op" id="1410217">)</span>&nbsp;<span class="builtintype" id="1410219">bool</span>&nbsp;<span class="op" id="1410224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410227">return</span>&nbsp;<span class="ident" id="1410234">hasToken</span><span class="op" id="1410242">(</span><span class="ident" id="1410243">r</span><span class="op" id="1410244">.</span><span class="ident" id="1410245">Header</span><span class="op" id="1410251">.</span><span class="ident" id="1410252">get</span><span class="op" id="1410255">(</span><span class="string" id="1410256">&#34;Expect&#34;</span><span class="op" id="1410264">)</span><span class="op" id="1410265">,</span>&nbsp;<span class="string" id="1410267">&#34;100-continue&#34;</span><span class="op" id="1410281">)</span><br>
<span class="lineno"></span><span class="op" id="1410283">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="1410286">func</span>&nbsp;<span class="op" id="1410291">(</span><span class="ident" id="1410292">r</span>&nbsp;<span class="op" id="1410294">*</span><span class="ident" id="1410295">Request</span><span class="op" id="1410302">)</span>&nbsp;<span class="ident" id="1410304">wantsHttp10KeepAlive</span><span class="op" id="1410324">(</span><span class="op" id="1410325">)</span>&nbsp;<span class="builtintype" id="1410327">bool</span>&nbsp;<span class="op" id="1410332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410335">if</span>&nbsp;<span class="ident" id="1410338">r</span><span class="op" id="1410339">.</span><span class="ident" id="1410340">ProtoMajor</span>&nbsp;<span class="op" id="1410351">!=</span>&nbsp;<span class="num" id="1410354">1</span>&nbsp;<span class="op" id="1410356">||</span>&nbsp;<span class="ident" id="1410359">r</span><span class="op" id="1410360">.</span><span class="ident" id="1410361">ProtoMinor</span>&nbsp;<span class="op" id="1410372">!=</span>&nbsp;<span class="num" id="1410375">0</span>&nbsp;<span class="op" id="1410377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410381">return</span>&nbsp;<span class="builtintype" id="1410388">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410395">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410398">return</span>&nbsp;<span class="ident" id="1410405">hasToken</span><span class="op" id="1410413">(</span><span class="ident" id="1410414">r</span><span class="op" id="1410415">.</span><span class="ident" id="1410416">Header</span><span class="op" id="1410422">.</span><span class="ident" id="1410423">get</span><span class="op" id="1410426">(</span><span class="string" id="1410427">&#34;Connection&#34;</span><span class="op" id="1410439">)</span><span class="op" id="1410440">,</span>&nbsp;<span class="string" id="1410442">&#34;keep-alive&#34;</span><span class="op" id="1410454">)</span><br>
<span class="lineno"></span><span class="op" id="1410456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1410459">func</span>&nbsp;<span class="op" id="1410464">(</span><span class="ident" id="1410465">r</span>&nbsp;<span class="op" id="1410467">*</span><span class="ident" id="1410468">Request</span><span class="op" id="1410475">)</span>&nbsp;<span class="ident" id="1410477">wantsClose</span><span class="op" id="1410487">(</span><span class="op" id="1410488">)</span>&nbsp;<span class="builtintype" id="1410490">bool</span>&nbsp;<span class="op" id="1410495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410498">return</span>&nbsp;<span class="ident" id="1410505">hasToken</span><span class="op" id="1410513">(</span><span class="ident" id="1410514">r</span><span class="op" id="1410515">.</span><span class="ident" id="1410516">Header</span><span class="op" id="1410522">.</span><span class="ident" id="1410523">get</span><span class="op" id="1410526">(</span><span class="string" id="1410527">&#34;Connection&#34;</span><span class="op" id="1410539">)</span><span class="op" id="1410540">,</span>&nbsp;<span class="string" id="1410542">&#34;close&#34;</span><span class="op" id="1410549">)</span><br>
<span class="lineno">915</span><span class="op" id="1410551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1410554">func</span>&nbsp;<span class="op" id="1410559">(</span><span class="ident" id="1410560">r</span>&nbsp;<span class="op" id="1410562">*</span><span class="ident" id="1410563">Request</span><span class="op" id="1410570">)</span>&nbsp;<span class="ident" id="1410572">closeBody</span><span class="op" id="1410581">(</span><span class="op" id="1410582">)</span>&nbsp;<span class="op" id="1410584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410587">if</span>&nbsp;<span class="ident" id="1410590">r</span><span class="op" id="1410591">.</span><span class="ident" id="1410592">Body</span>&nbsp;<span class="op" id="1410597">!=</span>&nbsp;<span class="ident" id="1410600">nil</span>&nbsp;<span class="op" id="1410604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410608">r</span><span class="op" id="1410609">.</span><span class="ident" id="1410610">Body</span><span class="op" id="1410614">.</span><span class="ident" id="1410615">Close</span><span class="op" id="1410620">(</span><span class="op" id="1410621">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410624">}</span><br>
<span class="lineno"></span><span class="op" id="1410626">}</span>
</div>
</body>
</html>
