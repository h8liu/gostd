<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html" class="current">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6957616">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6957671">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6957725">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6957776">package</span>&nbsp;<span class="ident" id="6957784">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6957791">import</span>&nbsp;<span class="op" id="6957798">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6957801">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6957814">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6957820">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6957831">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6957841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6957844">func</span>&nbsp;<span class="ident" id="6957849">TestWriteHeapDumpNonempty</span><span class="op" id="6957874">(</span><span class="ident" id="6957875">t</span>&nbsp;<span class="op" id="6957877">*</span><span class="ident" id="6957878">testing</span><span class="op" id="6957885">.</span><span class="ident" id="6957886">T</span><span class="op" id="6957887">)</span>&nbsp;<span class="op" id="6957889">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957892">if</span>&nbsp;<span class="ident" id="6957895">runtime</span><span class="op" id="6957902">.</span><span class="ident" id="6957903">GOOS</span>&nbsp;<span class="op" id="6957908">==</span>&nbsp;<span class="string" id="6957911">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6957918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957922">t</span><span class="op" id="6957923">.</span><span class="ident" id="6957924">Skip</span><span class="op" id="6957928">(</span><span class="string" id="6957929">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="6957970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6957973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957976">f</span><span class="op" id="6957977">,</span>&nbsp;<span class="ident" id="6957979">err</span>&nbsp;<span class="op" id="6957983">:=</span>&nbsp;<span class="ident" id="6957986">ioutil</span><span class="op" id="6957992">.</span><span class="ident" id="6957993">TempFile</span><span class="op" id="6958001">(</span><span class="string" id="6958002">&#34;&#34;</span><span class="op" id="6958004">,</span>&nbsp;<span class="string" id="6958006">&#34;heapdumptest&#34;</span><span class="op" id="6958020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958023">if</span>&nbsp;<span class="ident" id="6958026">err</span>&nbsp;<span class="op" id="6958030">!=</span>&nbsp;<span class="ident" id="6958033">nil</span>&nbsp;<span class="op" id="6958037">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958041">t</span><span class="op" id="6958042">.</span><span class="ident" id="6958043">Fatalf</span><span class="op" id="6958049">(</span><span class="string" id="6958050">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6958071">,</span>&nbsp;<span class="ident" id="6958073">err</span><span class="op" id="6958076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958082">defer</span>&nbsp;<span class="ident" id="6958088">os</span><span class="op" id="6958090">.</span><span class="ident" id="6958091">Remove</span><span class="op" id="6958097">(</span><span class="ident" id="6958098">f</span><span class="op" id="6958099">.</span><span class="ident" id="6958100">Name</span><span class="op" id="6958104">(</span><span class="op" id="6958105">)</span><span class="op" id="6958106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958109">defer</span>&nbsp;<span class="ident" id="6958115">f</span><span class="op" id="6958116">.</span><span class="ident" id="6958117">Close</span><span class="op" id="6958122">(</span><span class="op" id="6958123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958126">WriteHeapDump</span><span class="op" id="6958139">(</span><span class="ident" id="6958140">f</span><span class="op" id="6958141">.</span><span class="ident" id="6958142">Fd</span><span class="op" id="6958144">(</span><span class="op" id="6958145">)</span><span class="op" id="6958146">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958149">fi</span><span class="op" id="6958151">,</span>&nbsp;<span class="ident" id="6958153">err</span>&nbsp;<span class="op" id="6958157">:=</span>&nbsp;<span class="ident" id="6958160">f</span><span class="op" id="6958161">.</span><span class="ident" id="6958162">Stat</span><span class="op" id="6958166">(</span><span class="op" id="6958167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958170">if</span>&nbsp;<span class="ident" id="6958173">err</span>&nbsp;<span class="op" id="6958177">!=</span>&nbsp;<span class="ident" id="6958180">nil</span>&nbsp;<span class="op" id="6958184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958188">t</span><span class="op" id="6958189">.</span><span class="ident" id="6958190">Fatalf</span><span class="op" id="6958196">(</span><span class="string" id="6958197">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6958214">,</span>&nbsp;<span class="ident" id="6958216">err</span><span class="op" id="6958219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958225">const</span>&nbsp;<span class="ident" id="6958231">minSize</span>&nbsp;<span class="op" id="6958239">=</span>&nbsp;<span class="num" id="6958241">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958244">if</span>&nbsp;<span class="ident" id="6958247">size</span>&nbsp;<span class="op" id="6958252">:=</span>&nbsp;<span class="ident" id="6958255">fi</span><span class="op" id="6958257">.</span><span class="ident" id="6958258">Size</span><span class="op" id="6958262">(</span><span class="op" id="6958263">)</span><span class="op" id="6958264">;</span>&nbsp;<span class="ident" id="6958266">size</span>&nbsp;<span class="op" id="6958271">&lt;</span>&nbsp;<span class="ident" id="6958273">minSize</span>&nbsp;<span class="op" id="6958281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958285">t</span><span class="op" id="6958286">.</span><span class="ident" id="6958287">Fatalf</span><span class="op" id="6958293">(</span><span class="string" id="6958294">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6958347">,</span>&nbsp;<span class="ident" id="6958349">size</span><span class="op" id="6958353">,</span>&nbsp;<span class="ident" id="6958355">minSize</span><span class="op" id="6958362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958365">}</span><br>
<span class="lineno"></span><span class="op" id="6958367">}</span>
</div>
</body>
</html>
