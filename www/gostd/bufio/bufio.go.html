<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html" class="current">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3427675">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3427730">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3427784">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3427835">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="3427913">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3427988">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="3428059">package</span>&nbsp;<span class="ident" id="3428067">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3428074">import</span>&nbsp;<span class="op" id="3428081">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3428084">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3428093">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3428103">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3428109">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3428124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3428127">const</span>&nbsp;<span class="op" id="3428133">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428136">defaultBufSize</span>&nbsp;<span class="op" id="3428151">=</span>&nbsp;<span class="num" id="3428153">4096</span><br>
<span class="lineno"></span><span class="op" id="3428158">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3428161">var</span>&nbsp;<span class="op" id="3428165">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428168">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="3428189">=</span>&nbsp;<span class="ident" id="3428191">errors</span><span class="op" id="3428197">.</span><span class="ident" id="3428198">New</span><span class="op" id="3428201">(</span><span class="string" id="3428202">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="3428236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428239">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="3428260">=</span>&nbsp;<span class="ident" id="3428262">errors</span><span class="op" id="3428268">.</span><span class="ident" id="3428269">New</span><span class="op" id="3428272">(</span><span class="string" id="3428273">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="3428307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428310">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3428331">=</span>&nbsp;<span class="ident" id="3428333">errors</span><span class="op" id="3428339">.</span><span class="ident" id="3428340">New</span><span class="op" id="3428343">(</span><span class="string" id="3428344">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="3428364">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428367">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3428388">=</span>&nbsp;<span class="ident" id="3428390">errors</span><span class="op" id="3428396">.</span><span class="ident" id="3428397">New</span><span class="op" id="3428400">(</span><span class="string" id="3428401">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="3428424">)</span><br>
<span class="lineno"></span><span class="op" id="3428426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3428429">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3428449">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="3428505">type</span>&nbsp;<span class="ident" id="3428510">Reader</span>&nbsp;<span class="keyword" id="3428517">struct</span>&nbsp;<span class="op" id="3428524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428527">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3428540">[</span><span class="op" id="3428541">]</span><span class="builtintype" id="3428542">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428548">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3428561">io</span><span class="op" id="3428563">.</span><span class="ident" id="3428564">Reader</span>&nbsp;<span class="comment" id="3428571">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428605">r</span><span class="op" id="3428606">,</span>&nbsp;<span class="ident" id="3428608">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3428618">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3428628">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428661">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3428674">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428681">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3428694">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428699">lastRuneSize</span>&nbsp;<span class="builtintype" id="3428712">int</span><br>
<span class="lineno"></span><span class="op" id="3428716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3428719">const</span>&nbsp;<span class="ident" id="3428725">minReadBufferSize</span>&nbsp;<span class="op" id="3428743">=</span>&nbsp;<span class="num" id="3428745">16</span><br>
<span class="lineno"></span><span class="keyword" id="3428748">const</span>&nbsp;<span class="ident" id="3428754">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3428779">=</span>&nbsp;<span class="num" id="3428781">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3428786">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3428864">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="3428937">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="3428980">func</span>&nbsp;<span class="ident" id="3428985">NewReaderSize</span><span class="op" id="3428998">(</span><span class="ident" id="3428999">rd</span>&nbsp;<span class="ident" id="3429002">io</span><span class="op" id="3429004">.</span><span class="ident" id="3429005">Reader</span><span class="op" id="3429011">,</span>&nbsp;<span class="ident" id="3429013">size</span>&nbsp;<span class="builtintype" id="3429018">int</span><span class="op" id="3429021">)</span>&nbsp;<span class="op" id="3429023">*</span><span class="ident" id="3429024">Reader</span>&nbsp;<span class="op" id="3429031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429034">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429062">b</span><span class="op" id="3429063">,</span>&nbsp;<span class="ident" id="3429065">ok</span>&nbsp;<span class="op" id="3429068">:=</span>&nbsp;<span class="ident" id="3429071">rd</span><span class="op" id="3429073">.</span><span class="op" id="3429074">(</span><span class="op" id="3429075">*</span><span class="ident" id="3429076">Reader</span><span class="op" id="3429082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429085">if</span>&nbsp;<span class="ident" id="3429088">ok</span>&nbsp;<span class="op" id="3429091">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3429094">len</span><span class="op" id="3429097">(</span><span class="ident" id="3429098">b</span><span class="op" id="3429099">.</span><span class="ident" id="3429100">buf</span><span class="op" id="3429103">)</span>&nbsp;<span class="op" id="3429105">&gt;=</span>&nbsp;<span class="ident" id="3429108">size</span>&nbsp;<span class="op" id="3429113">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429117">return</span>&nbsp;<span class="ident" id="3429124">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429130">if</span>&nbsp;<span class="ident" id="3429133">size</span>&nbsp;<span class="op" id="3429138">&lt;</span>&nbsp;<span class="ident" id="3429140">minReadBufferSize</span>&nbsp;<span class="op" id="3429158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429162">size</span>&nbsp;<span class="op" id="3429167">=</span>&nbsp;<span class="ident" id="3429169">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429188">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429191">r</span>&nbsp;<span class="op" id="3429193">:=</span>&nbsp;<span class="builtinfunc" id="3429196">new</span><span class="op" id="3429199">(</span><span class="ident" id="3429200">Reader</span><span class="op" id="3429206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429209">r</span><span class="op" id="3429210">.</span><span class="ident" id="3429211">reset</span><span class="op" id="3429216">(</span><span class="builtinfunc" id="3429217">make</span><span class="op" id="3429221">(</span><span class="op" id="3429222">[</span><span class="op" id="3429223">]</span><span class="builtintype" id="3429224">byte</span><span class="op" id="3429228">,</span>&nbsp;<span class="ident" id="3429230">size</span><span class="op" id="3429234">)</span><span class="op" id="3429235">,</span>&nbsp;<span class="ident" id="3429237">rd</span><span class="op" id="3429239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429242">return</span>&nbsp;<span class="ident" id="3429249">r</span><br>
<span class="lineno"></span><span class="op" id="3429251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3429254">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3429323">func</span>&nbsp;<span class="ident" id="3429328">NewReader</span><span class="op" id="3429337">(</span><span class="ident" id="3429338">rd</span>&nbsp;<span class="ident" id="3429341">io</span><span class="op" id="3429343">.</span><span class="ident" id="3429344">Reader</span><span class="op" id="3429350">)</span>&nbsp;<span class="op" id="3429352">*</span><span class="ident" id="3429353">Reader</span>&nbsp;<span class="op" id="3429360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429363">return</span>&nbsp;<span class="ident" id="3429370">NewReaderSize</span><span class="op" id="3429383">(</span><span class="ident" id="3429384">rd</span><span class="op" id="3429386">,</span>&nbsp;<span class="ident" id="3429388">defaultBufSize</span><span class="op" id="3429402">)</span><br>
<span class="lineno"></span><span class="op" id="3429404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3429407">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="3429475">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3429514">func</span>&nbsp;<span class="op" id="3429519">(</span><span class="ident" id="3429520">b</span>&nbsp;<span class="op" id="3429522">*</span><span class="ident" id="3429523">Reader</span><span class="op" id="3429529">)</span>&nbsp;<span class="ident" id="3429531">Reset</span><span class="op" id="3429536">(</span><span class="ident" id="3429537">r</span>&nbsp;<span class="ident" id="3429539">io</span><span class="op" id="3429541">.</span><span class="ident" id="3429542">Reader</span><span class="op" id="3429548">)</span>&nbsp;<span class="op" id="3429550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429553">b</span><span class="op" id="3429554">.</span><span class="ident" id="3429555">reset</span><span class="op" id="3429560">(</span><span class="ident" id="3429561">b</span><span class="op" id="3429562">.</span><span class="ident" id="3429563">buf</span><span class="op" id="3429566">,</span>&nbsp;<span class="ident" id="3429568">r</span><span class="op" id="3429569">)</span><br>
<span class="lineno"></span><span class="op" id="3429571">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3429574">func</span>&nbsp;<span class="op" id="3429579">(</span><span class="ident" id="3429580">b</span>&nbsp;<span class="op" id="3429582">*</span><span class="ident" id="3429583">Reader</span><span class="op" id="3429589">)</span>&nbsp;<span class="ident" id="3429591">reset</span><span class="op" id="3429596">(</span><span class="ident" id="3429597">buf</span>&nbsp;<span class="op" id="3429601">[</span><span class="op" id="3429602">]</span><span class="builtintype" id="3429603">byte</span><span class="op" id="3429607">,</span>&nbsp;<span class="ident" id="3429609">r</span>&nbsp;<span class="ident" id="3429611">io</span><span class="op" id="3429613">.</span><span class="ident" id="3429614">Reader</span><span class="op" id="3429620">)</span>&nbsp;<span class="op" id="3429622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429625">*</span><span class="ident" id="3429626">b</span>&nbsp;<span class="op" id="3429628">=</span>&nbsp;<span class="ident" id="3429630">Reader</span><span class="op" id="3429636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429640">buf</span><span class="op" id="3429643">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3429654">buf</span><span class="op" id="3429657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429661">rd</span><span class="op" id="3429663">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3429675">r</span><span class="op" id="3429676">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429680">lastByte</span><span class="op" id="3429688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3429694">-</span><span class="num" id="3429695">1</span><span class="op" id="3429696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429700">lastRuneSize</span><span class="op" id="3429712">:</span>&nbsp;<span class="op" id="3429714">-</span><span class="num" id="3429715">1</span><span class="op" id="3429716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429719">}</span><br>
<span class="lineno"></span><span class="op" id="3429721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3429724">var</span>&nbsp;<span class="ident" id="3429728">errNegativeRead</span>&nbsp;<span class="op" id="3429744">=</span>&nbsp;<span class="ident" id="3429746">errors</span><span class="op" id="3429752">.</span><span class="ident" id="3429753">New</span><span class="op" id="3429756">(</span><span class="string" id="3429757">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="3429806">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3429809">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3429852">func</span>&nbsp;<span class="op" id="3429857">(</span><span class="ident" id="3429858">b</span>&nbsp;<span class="op" id="3429860">*</span><span class="ident" id="3429861">Reader</span><span class="op" id="3429867">)</span>&nbsp;<span class="ident" id="3429869">fill</span><span class="op" id="3429873">(</span><span class="op" id="3429874">)</span>&nbsp;<span class="op" id="3429876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429879">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429917">if</span>&nbsp;<span class="ident" id="3429920">b</span><span class="op" id="3429921">.</span><span class="ident" id="3429922">r</span>&nbsp;<span class="op" id="3429924">&gt;</span>&nbsp;<span class="num" id="3429926">0</span>&nbsp;<span class="op" id="3429928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3429932">copy</span><span class="op" id="3429936">(</span><span class="ident" id="3429937">b</span><span class="op" id="3429938">.</span><span class="ident" id="3429939">buf</span><span class="op" id="3429942">,</span>&nbsp;<span class="ident" id="3429944">b</span><span class="op" id="3429945">.</span><span class="ident" id="3429946">buf</span><span class="op" id="3429949">[</span><span class="ident" id="3429950">b</span><span class="op" id="3429951">.</span><span class="ident" id="3429952">r</span><span class="op" id="3429953">:</span><span class="ident" id="3429954">b</span><span class="op" id="3429955">.</span><span class="ident" id="3429956">w</span><span class="op" id="3429957">]</span><span class="op" id="3429958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429962">b</span><span class="op" id="3429963">.</span><span class="ident" id="3429964">w</span>&nbsp;<span class="op" id="3429966">-=</span>&nbsp;<span class="ident" id="3429969">b</span><span class="op" id="3429970">.</span><span class="ident" id="3429971">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429975">b</span><span class="op" id="3429976">.</span><span class="ident" id="3429977">r</span>&nbsp;<span class="op" id="3429979">=</span>&nbsp;<span class="num" id="3429981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429984">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429988">if</span>&nbsp;<span class="ident" id="3429991">b</span><span class="op" id="3429992">.</span><span class="ident" id="3429993">w</span>&nbsp;<span class="op" id="3429995">&gt;=</span>&nbsp;<span class="builtinfunc" id="3429998">len</span><span class="op" id="3430001">(</span><span class="ident" id="3430002">b</span><span class="op" id="3430003">.</span><span class="ident" id="3430004">buf</span><span class="op" id="3430007">)</span>&nbsp;<span class="op" id="3430009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3430013">panic</span><span class="op" id="3430018">(</span><span class="string" id="3430019">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="3430053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3430060">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430110">for</span>&nbsp;<span class="ident" id="3430114">i</span>&nbsp;<span class="op" id="3430116">:=</span>&nbsp;<span class="ident" id="3430119">maxConsecutiveEmptyReads</span><span class="op" id="3430143">;</span>&nbsp;<span class="ident" id="3430145">i</span>&nbsp;<span class="op" id="3430147">&gt;</span>&nbsp;<span class="num" id="3430149">0</span><span class="op" id="3430150">;</span>&nbsp;<span class="ident" id="3430152">i</span><span class="op" id="3430153">--</span>&nbsp;<span class="op" id="3430156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430160">n</span><span class="op" id="3430161">,</span>&nbsp;<span class="ident" id="3430163">err</span>&nbsp;<span class="op" id="3430167">:=</span>&nbsp;<span class="ident" id="3430170">b</span><span class="op" id="3430171">.</span><span class="ident" id="3430172">rd</span><span class="op" id="3430174">.</span><span class="ident" id="3430175">Read</span><span class="op" id="3430179">(</span><span class="ident" id="3430180">b</span><span class="op" id="3430181">.</span><span class="ident" id="3430182">buf</span><span class="op" id="3430185">[</span><span class="ident" id="3430186">b</span><span class="op" id="3430187">.</span><span class="ident" id="3430188">w</span><span class="op" id="3430189">:</span><span class="op" id="3430190">]</span><span class="op" id="3430191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430195">if</span>&nbsp;<span class="ident" id="3430198">n</span>&nbsp;<span class="op" id="3430200">&lt;</span>&nbsp;<span class="num" id="3430202">0</span>&nbsp;<span class="op" id="3430204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3430209">panic</span><span class="op" id="3430214">(</span><span class="ident" id="3430215">errNegativeRead</span><span class="op" id="3430230">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430238">b</span><span class="op" id="3430239">.</span><span class="ident" id="3430240">w</span>&nbsp;<span class="op" id="3430242">+=</span>&nbsp;<span class="ident" id="3430245">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430249">if</span>&nbsp;<span class="ident" id="3430252">err</span>&nbsp;<span class="op" id="3430256">!=</span>&nbsp;<span class="ident" id="3430259">nil</span>&nbsp;<span class="op" id="3430263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430268">b</span><span class="op" id="3430269">.</span><span class="ident" id="3430270">err</span>&nbsp;<span class="op" id="3430274">=</span>&nbsp;<span class="ident" id="3430276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430283">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430296">if</span>&nbsp;<span class="ident" id="3430299">n</span>&nbsp;<span class="op" id="3430301">&gt;</span>&nbsp;<span class="num" id="3430303">0</span>&nbsp;<span class="op" id="3430305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430310">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430322">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430325">b</span><span class="op" id="3430326">.</span><span class="ident" id="3430327">err</span>&nbsp;<span class="op" id="3430331">=</span>&nbsp;<span class="ident" id="3430333">io</span><span class="op" id="3430335">.</span><span class="ident" id="3430336">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="3430350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430353">func</span>&nbsp;<span class="op" id="3430358">(</span><span class="ident" id="3430359">b</span>&nbsp;<span class="op" id="3430361">*</span><span class="ident" id="3430362">Reader</span><span class="op" id="3430368">)</span>&nbsp;<span class="ident" id="3430370">readErr</span><span class="op" id="3430377">(</span><span class="op" id="3430378">)</span>&nbsp;<span class="builtintype" id="3430380">error</span>&nbsp;<span class="op" id="3430386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430389">err</span>&nbsp;<span class="op" id="3430393">:=</span>&nbsp;<span class="ident" id="3430396">b</span><span class="op" id="3430397">.</span><span class="ident" id="3430398">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430403">b</span><span class="op" id="3430404">.</span><span class="ident" id="3430405">err</span>&nbsp;<span class="op" id="3430409">=</span>&nbsp;<span class="ident" id="3430411">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430416">return</span>&nbsp;<span class="ident" id="3430423">err</span><br>
<span class="lineno"></span><span class="op" id="3430427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3430430">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="3430508">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3430585">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3430657">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3430711">func</span>&nbsp;<span class="op" id="3430716">(</span><span class="ident" id="3430717">b</span>&nbsp;<span class="op" id="3430719">*</span><span class="ident" id="3430720">Reader</span><span class="op" id="3430726">)</span>&nbsp;<span class="ident" id="3430728">Peek</span><span class="op" id="3430732">(</span><span class="ident" id="3430733">n</span>&nbsp;<span class="builtintype" id="3430735">int</span><span class="op" id="3430738">)</span>&nbsp;<span class="op" id="3430740">(</span><span class="op" id="3430741">[</span><span class="op" id="3430742">]</span><span class="builtintype" id="3430743">byte</span><span class="op" id="3430747">,</span>&nbsp;<span class="builtintype" id="3430749">error</span><span class="op" id="3430754">)</span>&nbsp;<span class="op" id="3430756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430759">if</span>&nbsp;<span class="ident" id="3430762">n</span>&nbsp;<span class="op" id="3430764">&lt;</span>&nbsp;<span class="num" id="3430766">0</span>&nbsp;<span class="op" id="3430768">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430772">return</span>&nbsp;<span class="ident" id="3430779">nil</span><span class="op" id="3430782">,</span>&nbsp;<span class="ident" id="3430784">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430805">if</span>&nbsp;<span class="ident" id="3430808">n</span>&nbsp;<span class="op" id="3430810">&gt;</span>&nbsp;<span class="builtinfunc" id="3430812">len</span><span class="op" id="3430815">(</span><span class="ident" id="3430816">b</span><span class="op" id="3430817">.</span><span class="ident" id="3430818">buf</span><span class="op" id="3430821">)</span>&nbsp;<span class="op" id="3430823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430827">return</span>&nbsp;<span class="ident" id="3430834">nil</span><span class="op" id="3430837">,</span>&nbsp;<span class="ident" id="3430839">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430854">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3430857">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430882">for</span>&nbsp;<span class="ident" id="3430886">b</span><span class="op" id="3430887">.</span><span class="ident" id="3430888">w</span><span class="op" id="3430889">-</span><span class="ident" id="3430890">b</span><span class="op" id="3430891">.</span><span class="ident" id="3430892">r</span>&nbsp;<span class="op" id="3430894">&lt;</span>&nbsp;<span class="ident" id="3430896">n</span>&nbsp;<span class="op" id="3430898">&amp;&amp;</span>&nbsp;<span class="ident" id="3430901">b</span><span class="op" id="3430902">.</span><span class="ident" id="3430903">err</span>&nbsp;<span class="op" id="3430907">==</span>&nbsp;<span class="ident" id="3430910">nil</span>&nbsp;<span class="op" id="3430914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430918">b</span><span class="op" id="3430919">.</span><span class="ident" id="3430920">fill</span><span class="op" id="3430924">(</span><span class="op" id="3430925">)</span>&nbsp;<span class="comment" id="3430927">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430978">var</span>&nbsp;<span class="ident" id="3430982">err</span>&nbsp;<span class="builtintype" id="3430986">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430993">if</span>&nbsp;<span class="ident" id="3430996">avail</span>&nbsp;<span class="op" id="3431002">:=</span>&nbsp;<span class="ident" id="3431005">b</span><span class="op" id="3431006">.</span><span class="ident" id="3431007">w</span>&nbsp;<span class="op" id="3431009">-</span>&nbsp;<span class="ident" id="3431011">b</span><span class="op" id="3431012">.</span><span class="ident" id="3431013">r</span><span class="op" id="3431014">;</span>&nbsp;<span class="ident" id="3431016">avail</span>&nbsp;<span class="op" id="3431022">&lt;</span>&nbsp;<span class="ident" id="3431024">n</span>&nbsp;<span class="op" id="3431026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3431030">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431061">n</span>&nbsp;<span class="op" id="3431063">=</span>&nbsp;<span class="ident" id="3431065">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431073">err</span>&nbsp;<span class="op" id="3431077">=</span>&nbsp;<span class="ident" id="3431079">b</span><span class="op" id="3431080">.</span><span class="ident" id="3431081">readErr</span><span class="op" id="3431088">(</span><span class="op" id="3431089">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431093">if</span>&nbsp;<span class="ident" id="3431096">err</span>&nbsp;<span class="op" id="3431100">==</span>&nbsp;<span class="ident" id="3431103">nil</span>&nbsp;<span class="op" id="3431107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431112">err</span>&nbsp;<span class="op" id="3431116">=</span>&nbsp;<span class="ident" id="3431118">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431140">return</span>&nbsp;<span class="ident" id="3431147">b</span><span class="op" id="3431148">.</span><span class="ident" id="3431149">buf</span><span class="op" id="3431152">[</span><span class="ident" id="3431153">b</span><span class="op" id="3431154">.</span><span class="ident" id="3431155">r</span>&nbsp;<span class="op" id="3431157">:</span>&nbsp;<span class="ident" id="3431159">b</span><span class="op" id="3431160">.</span><span class="ident" id="3431161">r</span><span class="op" id="3431162">+</span><span class="ident" id="3431163">n</span><span class="op" id="3431164">]</span><span class="op" id="3431165">,</span>&nbsp;<span class="ident" id="3431167">err</span><br>
<span class="lineno">145</span><span class="op" id="3431171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3431174">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3431201">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3431248">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="3431304">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="3431340">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="3431398">func</span>&nbsp;<span class="op" id="3431403">(</span><span class="ident" id="3431404">b</span>&nbsp;<span class="op" id="3431406">*</span><span class="ident" id="3431407">Reader</span><span class="op" id="3431413">)</span>&nbsp;<span class="ident" id="3431415">Read</span><span class="op" id="3431419">(</span><span class="ident" id="3431420">p</span>&nbsp;<span class="op" id="3431422">[</span><span class="op" id="3431423">]</span><span class="builtintype" id="3431424">byte</span><span class="op" id="3431428">)</span>&nbsp;<span class="op" id="3431430">(</span><span class="ident" id="3431431">n</span>&nbsp;<span class="builtintype" id="3431433">int</span><span class="op" id="3431436">,</span>&nbsp;<span class="ident" id="3431438">err</span>&nbsp;<span class="builtintype" id="3431442">error</span><span class="op" id="3431447">)</span>&nbsp;<span class="op" id="3431449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431452">n</span>&nbsp;<span class="op" id="3431454">=</span>&nbsp;<span class="builtinfunc" id="3431456">len</span><span class="op" id="3431459">(</span><span class="ident" id="3431460">p</span><span class="op" id="3431461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431464">if</span>&nbsp;<span class="ident" id="3431467">n</span>&nbsp;<span class="op" id="3431469">==</span>&nbsp;<span class="num" id="3431472">0</span>&nbsp;<span class="op" id="3431474">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431478">return</span>&nbsp;<span class="num" id="3431485">0</span><span class="op" id="3431486">,</span>&nbsp;<span class="ident" id="3431488">b</span><span class="op" id="3431489">.</span><span class="ident" id="3431490">readErr</span><span class="op" id="3431497">(</span><span class="op" id="3431498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431504">if</span>&nbsp;<span class="ident" id="3431507">b</span><span class="op" id="3431508">.</span><span class="ident" id="3431509">r</span>&nbsp;<span class="op" id="3431511">==</span>&nbsp;<span class="ident" id="3431514">b</span><span class="op" id="3431515">.</span><span class="ident" id="3431516">w</span>&nbsp;<span class="op" id="3431518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431522">if</span>&nbsp;<span class="ident" id="3431525">b</span><span class="op" id="3431526">.</span><span class="ident" id="3431527">err</span>&nbsp;<span class="op" id="3431531">!=</span>&nbsp;<span class="ident" id="3431534">nil</span>&nbsp;<span class="op" id="3431538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431543">return</span>&nbsp;<span class="num" id="3431550">0</span><span class="op" id="3431551">,</span>&nbsp;<span class="ident" id="3431553">b</span><span class="op" id="3431554">.</span><span class="ident" id="3431555">readErr</span><span class="op" id="3431562">(</span><span class="op" id="3431563">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431571">if</span>&nbsp;<span class="builtinfunc" id="3431574">len</span><span class="op" id="3431577">(</span><span class="ident" id="3431578">p</span><span class="op" id="3431579">)</span>&nbsp;<span class="op" id="3431581">&gt;=</span>&nbsp;<span class="builtinfunc" id="3431584">len</span><span class="op" id="3431587">(</span><span class="ident" id="3431588">b</span><span class="op" id="3431589">.</span><span class="ident" id="3431590">buf</span><span class="op" id="3431593">)</span>&nbsp;<span class="op" id="3431595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3431600">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3431632">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431674">n</span><span class="op" id="3431675">,</span>&nbsp;<span class="ident" id="3431677">b</span><span class="op" id="3431678">.</span><span class="ident" id="3431679">err</span>&nbsp;<span class="op" id="3431683">=</span>&nbsp;<span class="ident" id="3431685">b</span><span class="op" id="3431686">.</span><span class="ident" id="3431687">rd</span><span class="op" id="3431689">.</span><span class="ident" id="3431690">Read</span><span class="op" id="3431694">(</span><span class="ident" id="3431695">p</span><span class="op" id="3431696">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431701">if</span>&nbsp;<span class="ident" id="3431704">n</span>&nbsp;<span class="op" id="3431706">&lt;</span>&nbsp;<span class="num" id="3431708">0</span>&nbsp;<span class="op" id="3431710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3431716">panic</span><span class="op" id="3431721">(</span><span class="ident" id="3431722">errNegativeRead</span><span class="op" id="3431737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431747">if</span>&nbsp;<span class="ident" id="3431750">n</span>&nbsp;<span class="op" id="3431752">&gt;</span>&nbsp;<span class="num" id="3431754">0</span>&nbsp;<span class="op" id="3431756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431762">b</span><span class="op" id="3431763">.</span><span class="ident" id="3431764">lastByte</span>&nbsp;<span class="op" id="3431773">=</span>&nbsp;<span class="builtintype" id="3431775">int</span><span class="op" id="3431778">(</span><span class="ident" id="3431779">p</span><span class="op" id="3431780">[</span><span class="ident" id="3431781">n</span><span class="op" id="3431782">-</span><span class="num" id="3431783">1</span><span class="op" id="3431784">]</span><span class="op" id="3431785">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431791">b</span><span class="op" id="3431792">.</span><span class="ident" id="3431793">lastRuneSize</span>&nbsp;<span class="op" id="3431806">=</span>&nbsp;<span class="op" id="3431808">-</span><span class="num" id="3431809">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431819">return</span>&nbsp;<span class="ident" id="3431826">n</span><span class="op" id="3431827">,</span>&nbsp;<span class="ident" id="3431829">b</span><span class="op" id="3431830">.</span><span class="ident" id="3431831">readErr</span><span class="op" id="3431838">(</span><span class="op" id="3431839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431847">b</span><span class="op" id="3431848">.</span><span class="ident" id="3431849">fill</span><span class="op" id="3431853">(</span><span class="op" id="3431854">)</span>&nbsp;<span class="comment" id="3431856">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431877">if</span>&nbsp;<span class="ident" id="3431880">b</span><span class="op" id="3431881">.</span><span class="ident" id="3431882">r</span>&nbsp;<span class="op" id="3431884">==</span>&nbsp;<span class="ident" id="3431887">b</span><span class="op" id="3431888">.</span><span class="ident" id="3431889">w</span>&nbsp;<span class="op" id="3431891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431896">return</span>&nbsp;<span class="num" id="3431903">0</span><span class="op" id="3431904">,</span>&nbsp;<span class="ident" id="3431906">b</span><span class="op" id="3431907">.</span><span class="ident" id="3431908">readErr</span><span class="op" id="3431915">(</span><span class="op" id="3431916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3431927">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431954">n</span>&nbsp;<span class="op" id="3431956">=</span>&nbsp;<span class="builtinfunc" id="3431958">copy</span><span class="op" id="3431962">(</span><span class="ident" id="3431963">p</span><span class="op" id="3431964">,</span>&nbsp;<span class="ident" id="3431966">b</span><span class="op" id="3431967">.</span><span class="ident" id="3431968">buf</span><span class="op" id="3431971">[</span><span class="ident" id="3431972">b</span><span class="op" id="3431973">.</span><span class="ident" id="3431974">r</span><span class="op" id="3431975">:</span><span class="ident" id="3431976">b</span><span class="op" id="3431977">.</span><span class="ident" id="3431978">w</span><span class="op" id="3431979">]</span><span class="op" id="3431980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431983">b</span><span class="op" id="3431984">.</span><span class="ident" id="3431985">r</span>&nbsp;<span class="op" id="3431987">+=</span>&nbsp;<span class="ident" id="3431990">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431993">b</span><span class="op" id="3431994">.</span><span class="ident" id="3431995">lastByte</span>&nbsp;<span class="op" id="3432004">=</span>&nbsp;<span class="builtintype" id="3432006">int</span><span class="op" id="3432009">(</span><span class="ident" id="3432010">b</span><span class="op" id="3432011">.</span><span class="ident" id="3432012">buf</span><span class="op" id="3432015">[</span><span class="ident" id="3432016">b</span><span class="op" id="3432017">.</span><span class="ident" id="3432018">r</span><span class="op" id="3432019">-</span><span class="num" id="3432020">1</span><span class="op" id="3432021">]</span><span class="op" id="3432022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432025">b</span><span class="op" id="3432026">.</span><span class="ident" id="3432027">lastRuneSize</span>&nbsp;<span class="op" id="3432040">=</span>&nbsp;<span class="op" id="3432042">-</span><span class="num" id="3432043">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432046">return</span>&nbsp;<span class="ident" id="3432053">n</span><span class="op" id="3432054">,</span>&nbsp;<span class="ident" id="3432056">nil</span><br>
<span class="lineno"></span><span class="op" id="3432060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3432063">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="3432108">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="3432154">func</span>&nbsp;<span class="op" id="3432159">(</span><span class="ident" id="3432160">b</span>&nbsp;<span class="op" id="3432162">*</span><span class="ident" id="3432163">Reader</span><span class="op" id="3432169">)</span>&nbsp;<span class="ident" id="3432171">ReadByte</span><span class="op" id="3432179">(</span><span class="op" id="3432180">)</span>&nbsp;<span class="op" id="3432182">(</span><span class="ident" id="3432183">c</span>&nbsp;<span class="builtintype" id="3432185">byte</span><span class="op" id="3432189">,</span>&nbsp;<span class="ident" id="3432191">err</span>&nbsp;<span class="builtintype" id="3432195">error</span><span class="op" id="3432200">)</span>&nbsp;<span class="op" id="3432202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432205">b</span><span class="op" id="3432206">.</span><span class="ident" id="3432207">lastRuneSize</span>&nbsp;<span class="op" id="3432220">=</span>&nbsp;<span class="op" id="3432222">-</span><span class="num" id="3432223">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432226">for</span>&nbsp;<span class="ident" id="3432230">b</span><span class="op" id="3432231">.</span><span class="ident" id="3432232">r</span>&nbsp;<span class="op" id="3432234">==</span>&nbsp;<span class="ident" id="3432237">b</span><span class="op" id="3432238">.</span><span class="ident" id="3432239">w</span>&nbsp;<span class="op" id="3432241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432245">if</span>&nbsp;<span class="ident" id="3432248">b</span><span class="op" id="3432249">.</span><span class="ident" id="3432250">err</span>&nbsp;<span class="op" id="3432254">!=</span>&nbsp;<span class="ident" id="3432257">nil</span>&nbsp;<span class="op" id="3432261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432266">return</span>&nbsp;<span class="num" id="3432273">0</span><span class="op" id="3432274">,</span>&nbsp;<span class="ident" id="3432276">b</span><span class="op" id="3432277">.</span><span class="ident" id="3432278">readErr</span><span class="op" id="3432285">(</span><span class="op" id="3432286">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432294">b</span><span class="op" id="3432295">.</span><span class="ident" id="3432296">fill</span><span class="op" id="3432300">(</span><span class="op" id="3432301">)</span>&nbsp;<span class="comment" id="3432303">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432326">c</span>&nbsp;<span class="op" id="3432328">=</span>&nbsp;<span class="ident" id="3432330">b</span><span class="op" id="3432331">.</span><span class="ident" id="3432332">buf</span><span class="op" id="3432335">[</span><span class="ident" id="3432336">b</span><span class="op" id="3432337">.</span><span class="ident" id="3432338">r</span><span class="op" id="3432339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432342">b</span><span class="op" id="3432343">.</span><span class="ident" id="3432344">r</span><span class="op" id="3432345">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432349">b</span><span class="op" id="3432350">.</span><span class="ident" id="3432351">lastByte</span>&nbsp;<span class="op" id="3432360">=</span>&nbsp;<span class="builtintype" id="3432362">int</span><span class="op" id="3432365">(</span><span class="ident" id="3432366">c</span><span class="op" id="3432367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432370">return</span>&nbsp;<span class="ident" id="3432377">c</span><span class="op" id="3432378">,</span>&nbsp;<span class="ident" id="3432380">nil</span><br>
<span class="lineno"></span><span class="op" id="3432384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3432387">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="3432473">func</span>&nbsp;<span class="op" id="3432478">(</span><span class="ident" id="3432479">b</span>&nbsp;<span class="op" id="3432481">*</span><span class="ident" id="3432482">Reader</span><span class="op" id="3432488">)</span>&nbsp;<span class="ident" id="3432490">UnreadByte</span><span class="op" id="3432500">(</span><span class="op" id="3432501">)</span>&nbsp;<span class="builtintype" id="3432503">error</span>&nbsp;<span class="op" id="3432509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432512">if</span>&nbsp;<span class="ident" id="3432515">b</span><span class="op" id="3432516">.</span><span class="ident" id="3432517">lastByte</span>&nbsp;<span class="op" id="3432526">&lt;</span>&nbsp;<span class="num" id="3432528">0</span>&nbsp;<span class="op" id="3432530">||</span>&nbsp;<span class="ident" id="3432533">b</span><span class="op" id="3432534">.</span><span class="ident" id="3432535">r</span>&nbsp;<span class="op" id="3432537">==</span>&nbsp;<span class="num" id="3432540">0</span>&nbsp;<span class="op" id="3432542">&amp;&amp;</span>&nbsp;<span class="ident" id="3432545">b</span><span class="op" id="3432546">.</span><span class="ident" id="3432547">w</span>&nbsp;<span class="op" id="3432549">&gt;</span>&nbsp;<span class="num" id="3432551">0</span>&nbsp;<span class="op" id="3432553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432557">return</span>&nbsp;<span class="ident" id="3432564">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3432589">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432613">if</span>&nbsp;<span class="ident" id="3432616">b</span><span class="op" id="3432617">.</span><span class="ident" id="3432618">r</span>&nbsp;<span class="op" id="3432620">&gt;</span>&nbsp;<span class="num" id="3432622">0</span>&nbsp;<span class="op" id="3432624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432628">b</span><span class="op" id="3432629">.</span><span class="ident" id="3432630">r</span><span class="op" id="3432631">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432635">}</span>&nbsp;<span class="keyword" id="3432637">else</span>&nbsp;<span class="op" id="3432642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3432646">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432672">b</span><span class="op" id="3432673">.</span><span class="ident" id="3432674">w</span>&nbsp;<span class="op" id="3432676">=</span>&nbsp;<span class="num" id="3432678">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432684">b</span><span class="op" id="3432685">.</span><span class="ident" id="3432686">buf</span><span class="op" id="3432689">[</span><span class="ident" id="3432690">b</span><span class="op" id="3432691">.</span><span class="ident" id="3432692">r</span><span class="op" id="3432693">]</span>&nbsp;<span class="op" id="3432695">=</span>&nbsp;<span class="builtintype" id="3432697">byte</span><span class="op" id="3432701">(</span><span class="ident" id="3432702">b</span><span class="op" id="3432703">.</span><span class="ident" id="3432704">lastByte</span><span class="op" id="3432712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432715">b</span><span class="op" id="3432716">.</span><span class="ident" id="3432717">lastByte</span>&nbsp;<span class="op" id="3432726">=</span>&nbsp;<span class="op" id="3432728">-</span><span class="num" id="3432729">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432732">b</span><span class="op" id="3432733">.</span><span class="ident" id="3432734">lastRuneSize</span>&nbsp;<span class="op" id="3432747">=</span>&nbsp;<span class="op" id="3432749">-</span><span class="num" id="3432750">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432753">return</span>&nbsp;<span class="ident" id="3432760">nil</span><br>
<span class="lineno">220</span><span class="op" id="3432764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3432767">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3432842">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3432926">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="3432992">func</span>&nbsp;<span class="op" id="3432997">(</span><span class="ident" id="3432998">b</span>&nbsp;<span class="op" id="3433000">*</span><span class="ident" id="3433001">Reader</span><span class="op" id="3433007">)</span>&nbsp;<span class="ident" id="3433009">ReadRune</span><span class="op" id="3433017">(</span><span class="op" id="3433018">)</span>&nbsp;<span class="op" id="3433020">(</span><span class="ident" id="3433021">r</span>&nbsp;<span class="builtintype" id="3433023">rune</span><span class="op" id="3433027">,</span>&nbsp;<span class="ident" id="3433029">size</span>&nbsp;<span class="builtintype" id="3433034">int</span><span class="op" id="3433037">,</span>&nbsp;<span class="ident" id="3433039">err</span>&nbsp;<span class="builtintype" id="3433043">error</span><span class="op" id="3433048">)</span>&nbsp;<span class="op" id="3433050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433053">for</span>&nbsp;<span class="ident" id="3433057">b</span><span class="op" id="3433058">.</span><span class="ident" id="3433059">r</span><span class="op" id="3433060">+</span><span class="ident" id="3433061">utf8</span><span class="op" id="3433065">.</span><span class="ident" id="3433066">UTFMax</span>&nbsp;<span class="op" id="3433073">&gt;</span>&nbsp;<span class="ident" id="3433075">b</span><span class="op" id="3433076">.</span><span class="ident" id="3433077">w</span>&nbsp;<span class="op" id="3433079">&amp;&amp;</span>&nbsp;<span class="op" id="3433082">!</span><span class="ident" id="3433083">utf8</span><span class="op" id="3433087">.</span><span class="ident" id="3433088">FullRune</span><span class="op" id="3433096">(</span><span class="ident" id="3433097">b</span><span class="op" id="3433098">.</span><span class="ident" id="3433099">buf</span><span class="op" id="3433102">[</span><span class="ident" id="3433103">b</span><span class="op" id="3433104">.</span><span class="ident" id="3433105">r</span><span class="op" id="3433106">:</span><span class="ident" id="3433107">b</span><span class="op" id="3433108">.</span><span class="ident" id="3433109">w</span><span class="op" id="3433110">]</span><span class="op" id="3433111">)</span>&nbsp;<span class="op" id="3433113">&amp;&amp;</span>&nbsp;<span class="ident" id="3433116">b</span><span class="op" id="3433117">.</span><span class="ident" id="3433118">err</span>&nbsp;<span class="op" id="3433122">==</span>&nbsp;<span class="ident" id="3433125">nil</span>&nbsp;<span class="op" id="3433129">&amp;&amp;</span>&nbsp;<span class="ident" id="3433132">b</span><span class="op" id="3433133">.</span><span class="ident" id="3433134">w</span><span class="op" id="3433135">-</span><span class="ident" id="3433136">b</span><span class="op" id="3433137">.</span><span class="ident" id="3433138">r</span>&nbsp;<span class="op" id="3433140">&lt;</span>&nbsp;<span class="builtinfunc" id="3433142">len</span><span class="op" id="3433145">(</span><span class="ident" id="3433146">b</span><span class="op" id="3433147">.</span><span class="ident" id="3433148">buf</span><span class="op" id="3433151">)</span>&nbsp;<span class="op" id="3433153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433157">b</span><span class="op" id="3433158">.</span><span class="ident" id="3433159">fill</span><span class="op" id="3433163">(</span><span class="op" id="3433164">)</span>&nbsp;<span class="comment" id="3433166">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3433211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433214">b</span><span class="op" id="3433215">.</span><span class="ident" id="3433216">lastRuneSize</span>&nbsp;<span class="op" id="3433229">=</span>&nbsp;<span class="op" id="3433231">-</span><span class="num" id="3433232">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433235">if</span>&nbsp;<span class="ident" id="3433238">b</span><span class="op" id="3433239">.</span><span class="ident" id="3433240">r</span>&nbsp;<span class="op" id="3433242">==</span>&nbsp;<span class="ident" id="3433245">b</span><span class="op" id="3433246">.</span><span class="ident" id="3433247">w</span>&nbsp;<span class="op" id="3433249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433253">return</span>&nbsp;<span class="num" id="3433260">0</span><span class="op" id="3433261">,</span>&nbsp;<span class="num" id="3433263">0</span><span class="op" id="3433264">,</span>&nbsp;<span class="ident" id="3433266">b</span><span class="op" id="3433267">.</span><span class="ident" id="3433268">readErr</span><span class="op" id="3433275">(</span><span class="op" id="3433276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3433279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433282">r</span><span class="op" id="3433283">,</span>&nbsp;<span class="ident" id="3433285">size</span>&nbsp;<span class="op" id="3433290">=</span>&nbsp;<span class="builtintype" id="3433292">rune</span><span class="op" id="3433296">(</span><span class="ident" id="3433297">b</span><span class="op" id="3433298">.</span><span class="ident" id="3433299">buf</span><span class="op" id="3433302">[</span><span class="ident" id="3433303">b</span><span class="op" id="3433304">.</span><span class="ident" id="3433305">r</span><span class="op" id="3433306">]</span><span class="op" id="3433307">)</span><span class="op" id="3433308">,</span>&nbsp;<span class="num" id="3433310">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433313">if</span>&nbsp;<span class="ident" id="3433316">r</span>&nbsp;<span class="op" id="3433318">&gt;=</span>&nbsp;<span class="num" id="3433321">0x80</span>&nbsp;<span class="op" id="3433326">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433330">r</span><span class="op" id="3433331">,</span>&nbsp;<span class="ident" id="3433333">size</span>&nbsp;<span class="op" id="3433338">=</span>&nbsp;<span class="ident" id="3433340">utf8</span><span class="op" id="3433344">.</span><span class="ident" id="3433345">DecodeRune</span><span class="op" id="3433355">(</span><span class="ident" id="3433356">b</span><span class="op" id="3433357">.</span><span class="ident" id="3433358">buf</span><span class="op" id="3433361">[</span><span class="ident" id="3433362">b</span><span class="op" id="3433363">.</span><span class="ident" id="3433364">r</span><span class="op" id="3433365">:</span><span class="ident" id="3433366">b</span><span class="op" id="3433367">.</span><span class="ident" id="3433368">w</span><span class="op" id="3433369">]</span><span class="op" id="3433370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3433373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433376">b</span><span class="op" id="3433377">.</span><span class="ident" id="3433378">r</span>&nbsp;<span class="op" id="3433380">+=</span>&nbsp;<span class="ident" id="3433383">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433389">b</span><span class="op" id="3433390">.</span><span class="ident" id="3433391">lastByte</span>&nbsp;<span class="op" id="3433400">=</span>&nbsp;<span class="builtintype" id="3433402">int</span><span class="op" id="3433405">(</span><span class="ident" id="3433406">b</span><span class="op" id="3433407">.</span><span class="ident" id="3433408">buf</span><span class="op" id="3433411">[</span><span class="ident" id="3433412">b</span><span class="op" id="3433413">.</span><span class="ident" id="3433414">r</span><span class="op" id="3433415">-</span><span class="num" id="3433416">1</span><span class="op" id="3433417">]</span><span class="op" id="3433418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433421">b</span><span class="op" id="3433422">.</span><span class="ident" id="3433423">lastRuneSize</span>&nbsp;<span class="op" id="3433436">=</span>&nbsp;<span class="ident" id="3433438">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433444">return</span>&nbsp;<span class="ident" id="3433451">r</span><span class="op" id="3433452">,</span>&nbsp;<span class="ident" id="3433454">size</span><span class="op" id="3433458">,</span>&nbsp;<span class="ident" id="3433460">nil</span><br>
<span class="lineno"></span><span class="op" id="3433464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3433467">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3433542">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="3433615">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3433689">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="3433718">func</span>&nbsp;<span class="op" id="3433723">(</span><span class="ident" id="3433724">b</span>&nbsp;<span class="op" id="3433726">*</span><span class="ident" id="3433727">Reader</span><span class="op" id="3433733">)</span>&nbsp;<span class="ident" id="3433735">UnreadRune</span><span class="op" id="3433745">(</span><span class="op" id="3433746">)</span>&nbsp;<span class="builtintype" id="3433748">error</span>&nbsp;<span class="op" id="3433754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433757">if</span>&nbsp;<span class="ident" id="3433760">b</span><span class="op" id="3433761">.</span><span class="ident" id="3433762">lastRuneSize</span>&nbsp;<span class="op" id="3433775">&lt;</span>&nbsp;<span class="num" id="3433777">0</span>&nbsp;<span class="op" id="3433779">||</span>&nbsp;<span class="ident" id="3433782">b</span><span class="op" id="3433783">.</span><span class="ident" id="3433784">r</span>&nbsp;<span class="op" id="3433786">&lt;</span>&nbsp;<span class="ident" id="3433788">b</span><span class="op" id="3433789">.</span><span class="ident" id="3433790">lastRuneSize</span>&nbsp;<span class="op" id="3433803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433807">return</span>&nbsp;<span class="ident" id="3433814">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3433836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433839">b</span><span class="op" id="3433840">.</span><span class="ident" id="3433841">r</span>&nbsp;<span class="op" id="3433843">-=</span>&nbsp;<span class="ident" id="3433846">b</span><span class="op" id="3433847">.</span><span class="ident" id="3433848">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433862">b</span><span class="op" id="3433863">.</span><span class="ident" id="3433864">lastByte</span>&nbsp;<span class="op" id="3433873">=</span>&nbsp;<span class="op" id="3433875">-</span><span class="num" id="3433876">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3433879">b</span><span class="op" id="3433880">.</span><span class="ident" id="3433881">lastRuneSize</span>&nbsp;<span class="op" id="3433894">=</span>&nbsp;<span class="op" id="3433896">-</span><span class="num" id="3433897">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3433900">return</span>&nbsp;<span class="ident" id="3433907">nil</span><br>
<span class="lineno">255</span><span class="op" id="3433911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3433914">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3433996">func</span>&nbsp;<span class="op" id="3434001">(</span><span class="ident" id="3434002">b</span>&nbsp;<span class="op" id="3434004">*</span><span class="ident" id="3434005">Reader</span><span class="op" id="3434011">)</span>&nbsp;<span class="ident" id="3434013">Buffered</span><span class="op" id="3434021">(</span><span class="op" id="3434022">)</span>&nbsp;<span class="builtintype" id="3434024">int</span>&nbsp;<span class="op" id="3434028">{</span>&nbsp;<span class="keyword" id="3434030">return</span>&nbsp;<span class="ident" id="3434037">b</span><span class="op" id="3434038">.</span><span class="ident" id="3434039">w</span>&nbsp;<span class="op" id="3434041">-</span>&nbsp;<span class="ident" id="3434043">b</span><span class="op" id="3434044">.</span><span class="ident" id="3434045">r</span>&nbsp;<span class="op" id="3434047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3434050">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3434119">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3434177">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="3434225">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3434289">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="3434367">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3434448">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="3434512">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3434566">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3434602">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="3434677">func</span>&nbsp;<span class="op" id="3434682">(</span><span class="ident" id="3434683">b</span>&nbsp;<span class="op" id="3434685">*</span><span class="ident" id="3434686">Reader</span><span class="op" id="3434692">)</span>&nbsp;<span class="ident" id="3434694">ReadSlice</span><span class="op" id="3434703">(</span><span class="ident" id="3434704">delim</span>&nbsp;<span class="builtintype" id="3434710">byte</span><span class="op" id="3434714">)</span>&nbsp;<span class="op" id="3434716">(</span><span class="ident" id="3434717">line</span>&nbsp;<span class="op" id="3434722">[</span><span class="op" id="3434723">]</span><span class="builtintype" id="3434724">byte</span><span class="op" id="3434728">,</span>&nbsp;<span class="ident" id="3434730">err</span>&nbsp;<span class="builtintype" id="3434734">error</span><span class="op" id="3434739">)</span>&nbsp;<span class="op" id="3434741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3434744">for</span>&nbsp;<span class="op" id="3434748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3434752">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3434772">if</span>&nbsp;<span class="ident" id="3434775">i</span>&nbsp;<span class="op" id="3434777">:=</span>&nbsp;<span class="ident" id="3434780">bytes</span><span class="op" id="3434785">.</span><span class="ident" id="3434786">IndexByte</span><span class="op" id="3434795">(</span><span class="ident" id="3434796">b</span><span class="op" id="3434797">.</span><span class="ident" id="3434798">buf</span><span class="op" id="3434801">[</span><span class="ident" id="3434802">b</span><span class="op" id="3434803">.</span><span class="ident" id="3434804">r</span><span class="op" id="3434805">:</span><span class="ident" id="3434806">b</span><span class="op" id="3434807">.</span><span class="ident" id="3434808">w</span><span class="op" id="3434809">]</span><span class="op" id="3434810">,</span>&nbsp;<span class="ident" id="3434812">delim</span><span class="op" id="3434817">)</span><span class="op" id="3434818">;</span>&nbsp;<span class="ident" id="3434820">i</span>&nbsp;<span class="op" id="3434822">&gt;=</span>&nbsp;<span class="num" id="3434825">0</span>&nbsp;<span class="op" id="3434827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434832">line</span>&nbsp;<span class="op" id="3434837">=</span>&nbsp;<span class="ident" id="3434839">b</span><span class="op" id="3434840">.</span><span class="ident" id="3434841">buf</span><span class="op" id="3434844">[</span><span class="ident" id="3434845">b</span><span class="op" id="3434846">.</span><span class="ident" id="3434847">r</span>&nbsp;<span class="op" id="3434849">:</span>&nbsp;<span class="ident" id="3434851">b</span><span class="op" id="3434852">.</span><span class="ident" id="3434853">r</span><span class="op" id="3434854">+</span><span class="ident" id="3434855">i</span><span class="op" id="3434856">+</span><span class="num" id="3434857">1</span><span class="op" id="3434858">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434863">b</span><span class="op" id="3434864">.</span><span class="ident" id="3434865">r</span>&nbsp;<span class="op" id="3434867">+=</span>&nbsp;<span class="ident" id="3434870">i</span>&nbsp;<span class="op" id="3434872">+</span>&nbsp;<span class="num" id="3434874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3434879">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3434887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3434892">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3434912">if</span>&nbsp;<span class="ident" id="3434915">b</span><span class="op" id="3434916">.</span><span class="ident" id="3434917">err</span>&nbsp;<span class="op" id="3434921">!=</span>&nbsp;<span class="ident" id="3434924">nil</span>&nbsp;<span class="op" id="3434928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434933">line</span>&nbsp;<span class="op" id="3434938">=</span>&nbsp;<span class="ident" id="3434940">b</span><span class="op" id="3434941">.</span><span class="ident" id="3434942">buf</span><span class="op" id="3434945">[</span><span class="ident" id="3434946">b</span><span class="op" id="3434947">.</span><span class="ident" id="3434948">r</span><span class="op" id="3434949">:</span><span class="ident" id="3434950">b</span><span class="op" id="3434951">.</span><span class="ident" id="3434952">w</span><span class="op" id="3434953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434958">b</span><span class="op" id="3434959">.</span><span class="ident" id="3434960">r</span>&nbsp;<span class="op" id="3434962">=</span>&nbsp;<span class="ident" id="3434964">b</span><span class="op" id="3434965">.</span><span class="ident" id="3434966">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434971">err</span>&nbsp;<span class="op" id="3434975">=</span>&nbsp;<span class="ident" id="3434977">b</span><span class="op" id="3434978">.</span><span class="ident" id="3434979">readErr</span><span class="op" id="3434986">(</span><span class="op" id="3434987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3434992">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3435000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3435005">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3435023">if</span>&nbsp;<span class="ident" id="3435026">b</span><span class="op" id="3435027">.</span><span class="ident" id="3435028">Buffered</span><span class="op" id="3435036">(</span><span class="op" id="3435037">)</span>&nbsp;<span class="op" id="3435039">&gt;=</span>&nbsp;<span class="builtinfunc" id="3435042">len</span><span class="op" id="3435045">(</span><span class="ident" id="3435046">b</span><span class="op" id="3435047">.</span><span class="ident" id="3435048">buf</span><span class="op" id="3435051">)</span>&nbsp;<span class="op" id="3435053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435058">b</span><span class="op" id="3435059">.</span><span class="ident" id="3435060">r</span>&nbsp;<span class="op" id="3435062">=</span>&nbsp;<span class="ident" id="3435064">b</span><span class="op" id="3435065">.</span><span class="ident" id="3435066">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435071">line</span>&nbsp;<span class="op" id="3435076">=</span>&nbsp;<span class="ident" id="3435078">b</span><span class="op" id="3435079">.</span><span class="ident" id="3435080">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435087">err</span>&nbsp;<span class="op" id="3435091">=</span>&nbsp;<span class="ident" id="3435093">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3435110">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3435118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435123">b</span><span class="op" id="3435124">.</span><span class="ident" id="3435125">fill</span><span class="op" id="3435129">(</span><span class="op" id="3435130">)</span>&nbsp;<span class="comment" id="3435132">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3435155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3435159">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3435189">if</span>&nbsp;<span class="ident" id="3435192">i</span>&nbsp;<span class="op" id="3435194">:=</span>&nbsp;<span class="builtinfunc" id="3435197">len</span><span class="op" id="3435200">(</span><span class="ident" id="3435201">line</span><span class="op" id="3435205">)</span>&nbsp;<span class="op" id="3435207">-</span>&nbsp;<span class="num" id="3435209">1</span><span class="op" id="3435210">;</span>&nbsp;<span class="ident" id="3435212">i</span>&nbsp;<span class="op" id="3435214">&gt;=</span>&nbsp;<span class="num" id="3435217">0</span>&nbsp;<span class="op" id="3435219">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435223">b</span><span class="op" id="3435224">.</span><span class="ident" id="3435225">lastByte</span>&nbsp;<span class="op" id="3435234">=</span>&nbsp;<span class="builtintype" id="3435236">int</span><span class="op" id="3435239">(</span><span class="ident" id="3435240">line</span><span class="op" id="3435244">[</span><span class="ident" id="3435245">i</span><span class="op" id="3435246">]</span><span class="op" id="3435247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435251">b</span><span class="op" id="3435252">.</span><span class="ident" id="3435253">lastRuneSize</span>&nbsp;<span class="op" id="3435266">=</span>&nbsp;<span class="op" id="3435268">-</span><span class="num" id="3435269">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3435272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3435276">return</span><br>
<span class="lineno">305</span><span class="op" id="3435283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3435286">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3435361">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="3435426">//</span><br>
<span class="lineno">310</span><span class="comment" id="3435429">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3435509">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3435581">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3435657">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="3435735">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="3435808">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="3435884">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="3435899">//</span><br>
<span class="lineno"></span><span class="comment" id="3435902">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="3435985">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="3436064">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3436139">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3436216">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="3436258">func</span>&nbsp;<span class="op" id="3436263">(</span><span class="ident" id="3436264">b</span>&nbsp;<span class="op" id="3436266">*</span><span class="ident" id="3436267">Reader</span><span class="op" id="3436273">)</span>&nbsp;<span class="ident" id="3436275">ReadLine</span><span class="op" id="3436283">(</span><span class="op" id="3436284">)</span>&nbsp;<span class="op" id="3436286">(</span><span class="ident" id="3436287">line</span>&nbsp;<span class="op" id="3436292">[</span><span class="op" id="3436293">]</span><span class="builtintype" id="3436294">byte</span><span class="op" id="3436298">,</span>&nbsp;<span class="ident" id="3436300">isPrefix</span>&nbsp;<span class="builtintype" id="3436309">bool</span><span class="op" id="3436313">,</span>&nbsp;<span class="ident" id="3436315">err</span>&nbsp;<span class="builtintype" id="3436319">error</span><span class="op" id="3436324">)</span>&nbsp;<span class="op" id="3436326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436329">line</span><span class="op" id="3436333">,</span>&nbsp;<span class="ident" id="3436335">err</span>&nbsp;<span class="op" id="3436339">=</span>&nbsp;<span class="ident" id="3436341">b</span><span class="op" id="3436342">.</span><span class="ident" id="3436343">ReadSlice</span><span class="op" id="3436352">(</span><span class="string" id="3436353">&#39;\n&#39;</span><span class="op" id="3436357">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436360">if</span>&nbsp;<span class="ident" id="3436363">err</span>&nbsp;<span class="op" id="3436367">==</span>&nbsp;<span class="ident" id="3436370">ErrBufferFull</span>&nbsp;<span class="op" id="3436384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436388">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436444">if</span>&nbsp;<span class="builtinfunc" id="3436447">len</span><span class="op" id="3436450">(</span><span class="ident" id="3436451">line</span><span class="op" id="3436455">)</span>&nbsp;<span class="op" id="3436457">&gt;</span>&nbsp;<span class="num" id="3436459">0</span>&nbsp;<span class="op" id="3436461">&amp;&amp;</span>&nbsp;<span class="ident" id="3436464">line</span><span class="op" id="3436468">[</span><span class="builtinfunc" id="3436469">len</span><span class="op" id="3436472">(</span><span class="ident" id="3436473">line</span><span class="op" id="3436477">)</span><span class="op" id="3436478">-</span><span class="num" id="3436479">1</span><span class="op" id="3436480">]</span>&nbsp;<span class="op" id="3436482">==</span>&nbsp;<span class="string" id="3436485">&#39;\r&#39;</span>&nbsp;<span class="op" id="3436490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436495">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436549">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436603">if</span>&nbsp;<span class="ident" id="3436606">b</span><span class="op" id="3436607">.</span><span class="ident" id="3436608">r</span>&nbsp;<span class="op" id="3436610">==</span>&nbsp;<span class="num" id="3436613">0</span>&nbsp;<span class="op" id="3436615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436621">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3436650">panic</span><span class="op" id="3436655">(</span><span class="string" id="3436656">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="3436701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436711">b</span><span class="op" id="3436712">.</span><span class="ident" id="3436713">r</span><span class="op" id="3436714">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436720">line</span>&nbsp;<span class="op" id="3436725">=</span>&nbsp;<span class="ident" id="3436727">line</span><span class="op" id="3436731">[</span><span class="op" id="3436732">:</span><span class="builtinfunc" id="3436733">len</span><span class="op" id="3436736">(</span><span class="ident" id="3436737">line</span><span class="op" id="3436741">)</span><span class="op" id="3436742">-</span><span class="num" id="3436743">1</span><span class="op" id="3436744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436752">return</span>&nbsp;<span class="ident" id="3436759">line</span><span class="op" id="3436763">,</span>&nbsp;<span class="builtintype" id="3436765">true</span><span class="op" id="3436769">,</span>&nbsp;<span class="ident" id="3436771">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436780">if</span>&nbsp;<span class="builtinfunc" id="3436783">len</span><span class="op" id="3436786">(</span><span class="ident" id="3436787">line</span><span class="op" id="3436791">)</span>&nbsp;<span class="op" id="3436793">==</span>&nbsp;<span class="num" id="3436796">0</span>&nbsp;<span class="op" id="3436798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436802">if</span>&nbsp;<span class="ident" id="3436805">err</span>&nbsp;<span class="op" id="3436809">!=</span>&nbsp;<span class="ident" id="3436812">nil</span>&nbsp;<span class="op" id="3436816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436821">line</span>&nbsp;<span class="op" id="3436826">=</span>&nbsp;<span class="ident" id="3436828">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436838">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436849">err</span>&nbsp;<span class="op" id="3436853">=</span>&nbsp;<span class="ident" id="3436855">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436861">if</span>&nbsp;<span class="ident" id="3436864">line</span><span class="op" id="3436868">[</span><span class="builtinfunc" id="3436869">len</span><span class="op" id="3436872">(</span><span class="ident" id="3436873">line</span><span class="op" id="3436877">)</span><span class="op" id="3436878">-</span><span class="num" id="3436879">1</span><span class="op" id="3436880">]</span>&nbsp;<span class="op" id="3436882">==</span>&nbsp;<span class="string" id="3436885">&#39;\n&#39;</span>&nbsp;<span class="op" id="3436890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436894">drop</span>&nbsp;<span class="op" id="3436899">:=</span>&nbsp;<span class="num" id="3436902">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436906">if</span>&nbsp;<span class="builtinfunc" id="3436909">len</span><span class="op" id="3436912">(</span><span class="ident" id="3436913">line</span><span class="op" id="3436917">)</span>&nbsp;<span class="op" id="3436919">&gt;</span>&nbsp;<span class="num" id="3436921">1</span>&nbsp;<span class="op" id="3436923">&amp;&amp;</span>&nbsp;<span class="ident" id="3436926">line</span><span class="op" id="3436930">[</span><span class="builtinfunc" id="3436931">len</span><span class="op" id="3436934">(</span><span class="ident" id="3436935">line</span><span class="op" id="3436939">)</span><span class="op" id="3436940">-</span><span class="num" id="3436941">2</span><span class="op" id="3436942">]</span>&nbsp;<span class="op" id="3436944">==</span>&nbsp;<span class="string" id="3436947">&#39;\r&#39;</span>&nbsp;<span class="op" id="3436952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436957">drop</span>&nbsp;<span class="op" id="3436962">=</span>&nbsp;<span class="num" id="3436964">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436972">line</span>&nbsp;<span class="op" id="3436977">=</span>&nbsp;<span class="ident" id="3436979">line</span><span class="op" id="3436983">[</span><span class="op" id="3436984">:</span><span class="builtinfunc" id="3436985">len</span><span class="op" id="3436988">(</span><span class="ident" id="3436989">line</span><span class="op" id="3436993">)</span><span class="op" id="3436994">-</span><span class="ident" id="3436995">drop</span><span class="op" id="3436999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3437002">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437005">return</span><br>
<span class="lineno"></span><span class="op" id="3437012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3437015">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3437084">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="3437160">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3437224">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="3437306">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3437387">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3437397">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="3437451">func</span>&nbsp;<span class="op" id="3437456">(</span><span class="ident" id="3437457">b</span>&nbsp;<span class="op" id="3437459">*</span><span class="ident" id="3437460">Reader</span><span class="op" id="3437466">)</span>&nbsp;<span class="ident" id="3437468">ReadBytes</span><span class="op" id="3437477">(</span><span class="ident" id="3437478">delim</span>&nbsp;<span class="builtintype" id="3437484">byte</span><span class="op" id="3437488">)</span>&nbsp;<span class="op" id="3437490">(</span><span class="ident" id="3437491">line</span>&nbsp;<span class="op" id="3437496">[</span><span class="op" id="3437497">]</span><span class="builtintype" id="3437498">byte</span><span class="op" id="3437502">,</span>&nbsp;<span class="ident" id="3437504">err</span>&nbsp;<span class="builtintype" id="3437508">error</span><span class="op" id="3437513">)</span>&nbsp;<span class="op" id="3437515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437518">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437555">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437586">var</span>&nbsp;<span class="ident" id="3437590">frag</span>&nbsp;<span class="op" id="3437595">[</span><span class="op" id="3437596">]</span><span class="builtintype" id="3437597">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437603">var</span>&nbsp;<span class="ident" id="3437607">full</span>&nbsp;<span class="op" id="3437612">[</span><span class="op" id="3437613">]</span><span class="op" id="3437614">[</span><span class="op" id="3437615">]</span><span class="builtintype" id="3437616">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437622">err</span>&nbsp;<span class="op" id="3437626">=</span>&nbsp;<span class="ident" id="3437628">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437634">for</span>&nbsp;<span class="op" id="3437638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437642">var</span>&nbsp;<span class="ident" id="3437646">e</span>&nbsp;<span class="builtintype" id="3437648">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437656">frag</span><span class="op" id="3437660">,</span>&nbsp;<span class="ident" id="3437662">e</span>&nbsp;<span class="op" id="3437664">=</span>&nbsp;<span class="ident" id="3437666">b</span><span class="op" id="3437667">.</span><span class="ident" id="3437668">ReadSlice</span><span class="op" id="3437677">(</span><span class="ident" id="3437678">delim</span><span class="op" id="3437683">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437687">if</span>&nbsp;<span class="ident" id="3437690">e</span>&nbsp;<span class="op" id="3437692">==</span>&nbsp;<span class="ident" id="3437695">nil</span>&nbsp;<span class="op" id="3437699">{</span>&nbsp;<span class="comment" id="3437701">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437726">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3437734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437738">if</span>&nbsp;<span class="ident" id="3437741">e</span>&nbsp;<span class="op" id="3437743">!=</span>&nbsp;<span class="ident" id="3437746">ErrBufferFull</span>&nbsp;<span class="op" id="3437760">{</span>&nbsp;<span class="comment" id="3437762">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437785">err</span>&nbsp;<span class="op" id="3437789">=</span>&nbsp;<span class="ident" id="3437791">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437796">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3437804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437809">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437841">buf</span>&nbsp;<span class="op" id="3437845">:=</span>&nbsp;<span class="builtinfunc" id="3437848">make</span><span class="op" id="3437852">(</span><span class="op" id="3437853">[</span><span class="op" id="3437854">]</span><span class="builtintype" id="3437855">byte</span><span class="op" id="3437859">,</span>&nbsp;<span class="builtinfunc" id="3437861">len</span><span class="op" id="3437864">(</span><span class="ident" id="3437865">frag</span><span class="op" id="3437869">)</span><span class="op" id="3437870">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3437874">copy</span><span class="op" id="3437878">(</span><span class="ident" id="3437879">buf</span><span class="op" id="3437882">,</span>&nbsp;<span class="ident" id="3437884">frag</span><span class="op" id="3437888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437892">full</span>&nbsp;<span class="op" id="3437897">=</span>&nbsp;<span class="builtinfunc" id="3437899">append</span><span class="op" id="3437905">(</span><span class="ident" id="3437906">full</span><span class="op" id="3437910">,</span>&nbsp;<span class="ident" id="3437912">buf</span><span class="op" id="3437915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3437918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437922">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437988">n</span>&nbsp;<span class="op" id="3437990">:=</span>&nbsp;<span class="num" id="3437993">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437996">for</span>&nbsp;<span class="ident" id="3438000">i</span>&nbsp;<span class="op" id="3438002">:=</span>&nbsp;<span class="keyword" id="3438005">range</span>&nbsp;<span class="ident" id="3438011">full</span>&nbsp;<span class="op" id="3438016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438020">n</span>&nbsp;<span class="op" id="3438022">+=</span>&nbsp;<span class="builtinfunc" id="3438025">len</span><span class="op" id="3438028">(</span><span class="ident" id="3438029">full</span><span class="op" id="3438033">[</span><span class="ident" id="3438034">i</span><span class="op" id="3438035">]</span><span class="op" id="3438036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3438039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438042">n</span>&nbsp;<span class="op" id="3438044">+=</span>&nbsp;<span class="builtinfunc" id="3438047">len</span><span class="op" id="3438050">(</span><span class="ident" id="3438051">frag</span><span class="op" id="3438055">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438059">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438097">buf</span>&nbsp;<span class="op" id="3438101">:=</span>&nbsp;<span class="builtinfunc" id="3438104">make</span><span class="op" id="3438108">(</span><span class="op" id="3438109">[</span><span class="op" id="3438110">]</span><span class="builtintype" id="3438111">byte</span><span class="op" id="3438115">,</span>&nbsp;<span class="ident" id="3438117">n</span><span class="op" id="3438118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438121">n</span>&nbsp;<span class="op" id="3438123">=</span>&nbsp;<span class="num" id="3438125">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438128">for</span>&nbsp;<span class="ident" id="3438132">i</span>&nbsp;<span class="op" id="3438134">:=</span>&nbsp;<span class="keyword" id="3438137">range</span>&nbsp;<span class="ident" id="3438143">full</span>&nbsp;<span class="op" id="3438148">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438152">n</span>&nbsp;<span class="op" id="3438154">+=</span>&nbsp;<span class="builtinfunc" id="3438157">copy</span><span class="op" id="3438161">(</span><span class="ident" id="3438162">buf</span><span class="op" id="3438165">[</span><span class="ident" id="3438166">n</span><span class="op" id="3438167">:</span><span class="op" id="3438168">]</span><span class="op" id="3438169">,</span>&nbsp;<span class="ident" id="3438171">full</span><span class="op" id="3438175">[</span><span class="ident" id="3438176">i</span><span class="op" id="3438177">]</span><span class="op" id="3438178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3438181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3438184">copy</span><span class="op" id="3438188">(</span><span class="ident" id="3438189">buf</span><span class="op" id="3438192">[</span><span class="ident" id="3438193">n</span><span class="op" id="3438194">:</span><span class="op" id="3438195">]</span><span class="op" id="3438196">,</span>&nbsp;<span class="ident" id="3438198">frag</span><span class="op" id="3438202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438205">return</span>&nbsp;<span class="ident" id="3438212">buf</span><span class="op" id="3438215">,</span>&nbsp;<span class="ident" id="3438217">err</span><br>
<span class="lineno"></span><span class="op" id="3438221">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3438224">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3438294">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3438371">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3438436">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="3438518">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3438600">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3438610">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="3438664">func</span>&nbsp;<span class="op" id="3438669">(</span><span class="ident" id="3438670">b</span>&nbsp;<span class="op" id="3438672">*</span><span class="ident" id="3438673">Reader</span><span class="op" id="3438679">)</span>&nbsp;<span class="ident" id="3438681">ReadString</span><span class="op" id="3438691">(</span><span class="ident" id="3438692">delim</span>&nbsp;<span class="builtintype" id="3438698">byte</span><span class="op" id="3438702">)</span>&nbsp;<span class="op" id="3438704">(</span><span class="ident" id="3438705">line</span>&nbsp;<span class="builtintype" id="3438710">string</span><span class="op" id="3438716">,</span>&nbsp;<span class="ident" id="3438718">err</span>&nbsp;<span class="builtintype" id="3438722">error</span><span class="op" id="3438727">)</span>&nbsp;<span class="op" id="3438729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438732">bytes</span><span class="op" id="3438737">,</span>&nbsp;<span class="ident" id="3438739">err</span>&nbsp;<span class="op" id="3438743">:=</span>&nbsp;<span class="ident" id="3438746">b</span><span class="op" id="3438747">.</span><span class="ident" id="3438748">ReadBytes</span><span class="op" id="3438757">(</span><span class="ident" id="3438758">delim</span><span class="op" id="3438763">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438766">line</span>&nbsp;<span class="op" id="3438771">=</span>&nbsp;<span class="builtintype" id="3438773">string</span><span class="op" id="3438779">(</span><span class="ident" id="3438780">bytes</span><span class="op" id="3438785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438788">return</span>&nbsp;<span class="ident" id="3438795">line</span><span class="op" id="3438799">,</span>&nbsp;<span class="ident" id="3438801">err</span><br>
<span class="lineno"></span><span class="op" id="3438805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3438808">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="3438843">func</span>&nbsp;<span class="op" id="3438848">(</span><span class="ident" id="3438849">b</span>&nbsp;<span class="op" id="3438851">*</span><span class="ident" id="3438852">Reader</span><span class="op" id="3438858">)</span>&nbsp;<span class="ident" id="3438860">WriteTo</span><span class="op" id="3438867">(</span><span class="ident" id="3438868">w</span>&nbsp;<span class="ident" id="3438870">io</span><span class="op" id="3438872">.</span><span class="ident" id="3438873">Writer</span><span class="op" id="3438879">)</span>&nbsp;<span class="op" id="3438881">(</span><span class="ident" id="3438882">n</span>&nbsp;<span class="ident" id="3438884">int64</span><span class="op" id="3438889">,</span>&nbsp;<span class="ident" id="3438891">err</span>&nbsp;<span class="builtintype" id="3438895">error</span><span class="op" id="3438900">)</span>&nbsp;<span class="op" id="3438902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438905">n</span><span class="op" id="3438906">,</span>&nbsp;<span class="ident" id="3438908">err</span>&nbsp;<span class="op" id="3438912">=</span>&nbsp;<span class="ident" id="3438914">b</span><span class="op" id="3438915">.</span><span class="ident" id="3438916">writeBuf</span><span class="op" id="3438924">(</span><span class="ident" id="3438925">w</span><span class="op" id="3438926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438929">if</span>&nbsp;<span class="ident" id="3438932">err</span>&nbsp;<span class="op" id="3438936">!=</span>&nbsp;<span class="ident" id="3438939">nil</span>&nbsp;<span class="op" id="3438943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438947">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3438955">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438959">if</span>&nbsp;<span class="ident" id="3438962">r</span><span class="op" id="3438963">,</span>&nbsp;<span class="ident" id="3438965">ok</span>&nbsp;<span class="op" id="3438968">:=</span>&nbsp;<span class="ident" id="3438971">b</span><span class="op" id="3438972">.</span><span class="ident" id="3438973">rd</span><span class="op" id="3438975">.</span><span class="op" id="3438976">(</span><span class="ident" id="3438977">io</span><span class="op" id="3438979">.</span><span class="ident" id="3438980">WriterTo</span><span class="op" id="3438988">)</span><span class="op" id="3438989">;</span>&nbsp;<span class="ident" id="3438991">ok</span>&nbsp;<span class="op" id="3438994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438998">m</span><span class="op" id="3438999">,</span>&nbsp;<span class="ident" id="3439001">err</span>&nbsp;<span class="op" id="3439005">:=</span>&nbsp;<span class="ident" id="3439008">r</span><span class="op" id="3439009">.</span><span class="ident" id="3439010">WriteTo</span><span class="op" id="3439017">(</span><span class="ident" id="3439018">w</span><span class="op" id="3439019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439023">n</span>&nbsp;<span class="op" id="3439025">+=</span>&nbsp;<span class="ident" id="3439028">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439032">return</span>&nbsp;<span class="ident" id="3439039">n</span><span class="op" id="3439040">,</span>&nbsp;<span class="ident" id="3439042">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439051">if</span>&nbsp;<span class="ident" id="3439054">w</span><span class="op" id="3439055">,</span>&nbsp;<span class="ident" id="3439057">ok</span>&nbsp;<span class="op" id="3439060">:=</span>&nbsp;<span class="ident" id="3439063">w</span><span class="op" id="3439064">.</span><span class="op" id="3439065">(</span><span class="ident" id="3439066">io</span><span class="op" id="3439068">.</span><span class="ident" id="3439069">ReaderFrom</span><span class="op" id="3439079">)</span><span class="op" id="3439080">;</span>&nbsp;<span class="ident" id="3439082">ok</span>&nbsp;<span class="op" id="3439085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439089">m</span><span class="op" id="3439090">,</span>&nbsp;<span class="ident" id="3439092">err</span>&nbsp;<span class="op" id="3439096">:=</span>&nbsp;<span class="ident" id="3439099">w</span><span class="op" id="3439100">.</span><span class="ident" id="3439101">ReadFrom</span><span class="op" id="3439109">(</span><span class="ident" id="3439110">b</span><span class="op" id="3439111">.</span><span class="ident" id="3439112">rd</span><span class="op" id="3439114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439118">n</span>&nbsp;<span class="op" id="3439120">+=</span>&nbsp;<span class="ident" id="3439123">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439127">return</span>&nbsp;<span class="ident" id="3439134">n</span><span class="op" id="3439135">,</span>&nbsp;<span class="ident" id="3439137">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439146">if</span>&nbsp;<span class="ident" id="3439149">b</span><span class="op" id="3439150">.</span><span class="ident" id="3439151">w</span><span class="op" id="3439152">-</span><span class="ident" id="3439153">b</span><span class="op" id="3439154">.</span><span class="ident" id="3439155">r</span>&nbsp;<span class="op" id="3439157">&lt;</span>&nbsp;<span class="builtinfunc" id="3439159">len</span><span class="op" id="3439162">(</span><span class="ident" id="3439163">b</span><span class="op" id="3439164">.</span><span class="ident" id="3439165">buf</span><span class="op" id="3439168">)</span>&nbsp;<span class="op" id="3439170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439174">b</span><span class="op" id="3439175">.</span><span class="ident" id="3439176">fill</span><span class="op" id="3439180">(</span><span class="op" id="3439181">)</span>&nbsp;<span class="comment" id="3439183">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439207">for</span>&nbsp;<span class="ident" id="3439211">b</span><span class="op" id="3439212">.</span><span class="ident" id="3439213">r</span>&nbsp;<span class="op" id="3439215">&lt;</span>&nbsp;<span class="ident" id="3439217">b</span><span class="op" id="3439218">.</span><span class="ident" id="3439219">w</span>&nbsp;<span class="op" id="3439221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3439225">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439263">m</span><span class="op" id="3439264">,</span>&nbsp;<span class="ident" id="3439266">err</span>&nbsp;<span class="op" id="3439270">:=</span>&nbsp;<span class="ident" id="3439273">b</span><span class="op" id="3439274">.</span><span class="ident" id="3439275">writeBuf</span><span class="op" id="3439283">(</span><span class="ident" id="3439284">w</span><span class="op" id="3439285">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439289">n</span>&nbsp;<span class="op" id="3439291">+=</span>&nbsp;<span class="ident" id="3439294">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439298">if</span>&nbsp;<span class="ident" id="3439301">err</span>&nbsp;<span class="op" id="3439305">!=</span>&nbsp;<span class="ident" id="3439308">nil</span>&nbsp;<span class="op" id="3439312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439317">return</span>&nbsp;<span class="ident" id="3439324">n</span><span class="op" id="3439325">,</span>&nbsp;<span class="ident" id="3439327">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439337">b</span><span class="op" id="3439338">.</span><span class="ident" id="3439339">fill</span><span class="op" id="3439343">(</span><span class="op" id="3439344">)</span>&nbsp;<span class="comment" id="3439346">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439370">if</span>&nbsp;<span class="ident" id="3439373">b</span><span class="op" id="3439374">.</span><span class="ident" id="3439375">err</span>&nbsp;<span class="op" id="3439379">==</span>&nbsp;<span class="ident" id="3439382">io</span><span class="op" id="3439384">.</span><span class="ident" id="3439385">EOF</span>&nbsp;<span class="op" id="3439389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439393">b</span><span class="op" id="3439394">.</span><span class="ident" id="3439395">err</span>&nbsp;<span class="op" id="3439399">=</span>&nbsp;<span class="ident" id="3439401">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439406">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439410">return</span>&nbsp;<span class="ident" id="3439417">n</span><span class="op" id="3439418">,</span>&nbsp;<span class="ident" id="3439420">b</span><span class="op" id="3439421">.</span><span class="ident" id="3439422">readErr</span><span class="op" id="3439429">(</span><span class="op" id="3439430">)</span><br>
<span class="lineno"></span><span class="op" id="3439432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3439435">var</span>&nbsp;<span class="ident" id="3439439">errNegativeWrite</span>&nbsp;<span class="op" id="3439456">=</span>&nbsp;<span class="ident" id="3439458">errors</span><span class="op" id="3439464">.</span><span class="ident" id="3439465">New</span><span class="op" id="3439468">(</span><span class="string" id="3439469">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="3439519">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3439522">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3439576">func</span>&nbsp;<span class="op" id="3439581">(</span><span class="ident" id="3439582">b</span>&nbsp;<span class="op" id="3439584">*</span><span class="ident" id="3439585">Reader</span><span class="op" id="3439591">)</span>&nbsp;<span class="ident" id="3439593">writeBuf</span><span class="op" id="3439601">(</span><span class="ident" id="3439602">w</span>&nbsp;<span class="ident" id="3439604">io</span><span class="op" id="3439606">.</span><span class="ident" id="3439607">Writer</span><span class="op" id="3439613">)</span>&nbsp;<span class="op" id="3439615">(</span><span class="ident" id="3439616">int64</span><span class="op" id="3439621">,</span>&nbsp;<span class="builtintype" id="3439623">error</span><span class="op" id="3439628">)</span>&nbsp;<span class="op" id="3439630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439633">n</span><span class="op" id="3439634">,</span>&nbsp;<span class="ident" id="3439636">err</span>&nbsp;<span class="op" id="3439640">:=</span>&nbsp;<span class="ident" id="3439643">w</span><span class="op" id="3439644">.</span><span class="ident" id="3439645">Write</span><span class="op" id="3439650">(</span><span class="ident" id="3439651">b</span><span class="op" id="3439652">.</span><span class="ident" id="3439653">buf</span><span class="op" id="3439656">[</span><span class="ident" id="3439657">b</span><span class="op" id="3439658">.</span><span class="ident" id="3439659">r</span><span class="op" id="3439660">:</span><span class="ident" id="3439661">b</span><span class="op" id="3439662">.</span><span class="ident" id="3439663">w</span><span class="op" id="3439664">]</span><span class="op" id="3439665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439668">if</span>&nbsp;<span class="ident" id="3439671">n</span>&nbsp;<span class="op" id="3439673">&lt;</span>&nbsp;<span class="num" id="3439675">0</span>&nbsp;<span class="op" id="3439677">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3439681">panic</span><span class="op" id="3439686">(</span><span class="ident" id="3439687">errNegativeWrite</span><span class="op" id="3439703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439709">b</span><span class="op" id="3439710">.</span><span class="ident" id="3439711">r</span>&nbsp;<span class="op" id="3439713">+=</span>&nbsp;<span class="ident" id="3439716">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439719">return</span>&nbsp;<span class="ident" id="3439726">int64</span><span class="op" id="3439731">(</span><span class="ident" id="3439732">n</span><span class="op" id="3439733">)</span><span class="op" id="3439734">,</span>&nbsp;<span class="ident" id="3439736">err</span><br>
<span class="lineno"></span><span class="op" id="3439740">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3439743">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3439763">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3439819">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="3439883">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3439944">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3440007">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3440067">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3440096">type</span>&nbsp;<span class="ident" id="3440101">Writer</span>&nbsp;<span class="keyword" id="3440108">struct</span>&nbsp;<span class="op" id="3440115">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440118">err</span>&nbsp;<span class="builtintype" id="3440122">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440129">buf</span>&nbsp;<span class="op" id="3440133">[</span><span class="op" id="3440134">]</span><span class="builtintype" id="3440135">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440141">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3440145">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440150">wr</span>&nbsp;&nbsp;<span class="ident" id="3440154">io</span><span class="op" id="3440156">.</span><span class="ident" id="3440157">Writer</span><br>
<span class="lineno"></span><span class="op" id="3440164">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="3440167">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3440245">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="3440318">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3440361">func</span>&nbsp;<span class="ident" id="3440366">NewWriterSize</span><span class="op" id="3440379">(</span><span class="ident" id="3440380">w</span>&nbsp;<span class="ident" id="3440382">io</span><span class="op" id="3440384">.</span><span class="ident" id="3440385">Writer</span><span class="op" id="3440391">,</span>&nbsp;<span class="ident" id="3440393">size</span>&nbsp;<span class="builtintype" id="3440398">int</span><span class="op" id="3440401">)</span>&nbsp;<span class="op" id="3440403">*</span><span class="ident" id="3440404">Writer</span>&nbsp;<span class="op" id="3440411">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3440414">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440442">b</span><span class="op" id="3440443">,</span>&nbsp;<span class="ident" id="3440445">ok</span>&nbsp;<span class="op" id="3440448">:=</span>&nbsp;<span class="ident" id="3440451">w</span><span class="op" id="3440452">.</span><span class="op" id="3440453">(</span><span class="op" id="3440454">*</span><span class="ident" id="3440455">Writer</span><span class="op" id="3440461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440464">if</span>&nbsp;<span class="ident" id="3440467">ok</span>&nbsp;<span class="op" id="3440470">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3440473">len</span><span class="op" id="3440476">(</span><span class="ident" id="3440477">b</span><span class="op" id="3440478">.</span><span class="ident" id="3440479">buf</span><span class="op" id="3440482">)</span>&nbsp;<span class="op" id="3440484">&gt;=</span>&nbsp;<span class="ident" id="3440487">size</span>&nbsp;<span class="op" id="3440492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440496">return</span>&nbsp;<span class="ident" id="3440503">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440506">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440509">if</span>&nbsp;<span class="ident" id="3440512">size</span>&nbsp;<span class="op" id="3440517">&lt;=</span>&nbsp;<span class="num" id="3440520">0</span>&nbsp;<span class="op" id="3440522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440526">size</span>&nbsp;<span class="op" id="3440531">=</span>&nbsp;<span class="ident" id="3440533">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440552">return</span>&nbsp;<span class="op" id="3440559">&amp;</span><span class="ident" id="3440560">Writer</span><span class="op" id="3440566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440570">buf</span><span class="op" id="3440573">:</span>&nbsp;<span class="builtinfunc" id="3440575">make</span><span class="op" id="3440579">(</span><span class="op" id="3440580">[</span><span class="op" id="3440581">]</span><span class="builtintype" id="3440582">byte</span><span class="op" id="3440586">,</span>&nbsp;<span class="ident" id="3440588">size</span><span class="op" id="3440592">)</span><span class="op" id="3440593">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440597">wr</span><span class="op" id="3440599">:</span>&nbsp;&nbsp;<span class="ident" id="3440602">w</span><span class="op" id="3440603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440606">}</span><br>
<span class="lineno"></span><span class="op" id="3440608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3440611">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="3440680">func</span>&nbsp;<span class="ident" id="3440685">NewWriter</span><span class="op" id="3440694">(</span><span class="ident" id="3440695">w</span>&nbsp;<span class="ident" id="3440697">io</span><span class="op" id="3440699">.</span><span class="ident" id="3440700">Writer</span><span class="op" id="3440706">)</span>&nbsp;<span class="op" id="3440708">*</span><span class="ident" id="3440709">Writer</span>&nbsp;<span class="op" id="3440716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440719">return</span>&nbsp;<span class="ident" id="3440726">NewWriterSize</span><span class="op" id="3440739">(</span><span class="ident" id="3440740">w</span><span class="op" id="3440741">,</span>&nbsp;<span class="ident" id="3440743">defaultBufSize</span><span class="op" id="3440757">)</span><br>
<span class="lineno"></span><span class="op" id="3440759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3440762">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="3440831">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3440869">func</span>&nbsp;<span class="op" id="3440874">(</span><span class="ident" id="3440875">b</span>&nbsp;<span class="op" id="3440877">*</span><span class="ident" id="3440878">Writer</span><span class="op" id="3440884">)</span>&nbsp;<span class="ident" id="3440886">Reset</span><span class="op" id="3440891">(</span><span class="ident" id="3440892">w</span>&nbsp;<span class="ident" id="3440894">io</span><span class="op" id="3440896">.</span><span class="ident" id="3440897">Writer</span><span class="op" id="3440903">)</span>&nbsp;<span class="op" id="3440905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440908">b</span><span class="op" id="3440909">.</span><span class="ident" id="3440910">err</span>&nbsp;<span class="op" id="3440914">=</span>&nbsp;<span class="ident" id="3440916">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440921">b</span><span class="op" id="3440922">.</span><span class="ident" id="3440923">n</span>&nbsp;<span class="op" id="3440925">=</span>&nbsp;<span class="num" id="3440927">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440930">b</span><span class="op" id="3440931">.</span><span class="ident" id="3440932">wr</span>&nbsp;<span class="op" id="3440935">=</span>&nbsp;<span class="ident" id="3440937">w</span><br>
<span class="lineno">515</span><span class="op" id="3440939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3440942">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3441005">func</span>&nbsp;<span class="op" id="3441010">(</span><span class="ident" id="3441011">b</span>&nbsp;<span class="op" id="3441013">*</span><span class="ident" id="3441014">Writer</span><span class="op" id="3441020">)</span>&nbsp;<span class="ident" id="3441022">Flush</span><span class="op" id="3441027">(</span><span class="op" id="3441028">)</span>&nbsp;<span class="builtintype" id="3441030">error</span>&nbsp;<span class="op" id="3441036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441039">err</span>&nbsp;<span class="op" id="3441043">:=</span>&nbsp;<span class="ident" id="3441046">b</span><span class="op" id="3441047">.</span><span class="ident" id="3441048">flush</span><span class="op" id="3441053">(</span><span class="op" id="3441054">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441057">return</span>&nbsp;<span class="ident" id="3441064">err</span><br>
<span class="lineno"></span><span class="op" id="3441068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3441071">func</span>&nbsp;<span class="op" id="3441076">(</span><span class="ident" id="3441077">b</span>&nbsp;<span class="op" id="3441079">*</span><span class="ident" id="3441080">Writer</span><span class="op" id="3441086">)</span>&nbsp;<span class="ident" id="3441088">flush</span><span class="op" id="3441093">(</span><span class="op" id="3441094">)</span>&nbsp;<span class="builtintype" id="3441096">error</span>&nbsp;<span class="op" id="3441102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441105">if</span>&nbsp;<span class="ident" id="3441108">b</span><span class="op" id="3441109">.</span><span class="ident" id="3441110">err</span>&nbsp;<span class="op" id="3441114">!=</span>&nbsp;<span class="ident" id="3441117">nil</span>&nbsp;<span class="op" id="3441121">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441125">return</span>&nbsp;<span class="ident" id="3441132">b</span><span class="op" id="3441133">.</span><span class="ident" id="3441134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441142">if</span>&nbsp;<span class="ident" id="3441145">b</span><span class="op" id="3441146">.</span><span class="ident" id="3441147">n</span>&nbsp;<span class="op" id="3441149">==</span>&nbsp;<span class="num" id="3441152">0</span>&nbsp;<span class="op" id="3441154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441158">return</span>&nbsp;<span class="ident" id="3441165">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441170">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441173">n</span><span class="op" id="3441174">,</span>&nbsp;<span class="ident" id="3441176">err</span>&nbsp;<span class="op" id="3441180">:=</span>&nbsp;<span class="ident" id="3441183">b</span><span class="op" id="3441184">.</span><span class="ident" id="3441185">wr</span><span class="op" id="3441187">.</span><span class="ident" id="3441188">Write</span><span class="op" id="3441193">(</span><span class="ident" id="3441194">b</span><span class="op" id="3441195">.</span><span class="ident" id="3441196">buf</span><span class="op" id="3441199">[</span><span class="num" id="3441200">0</span><span class="op" id="3441201">:</span><span class="ident" id="3441202">b</span><span class="op" id="3441203">.</span><span class="ident" id="3441204">n</span><span class="op" id="3441205">]</span><span class="op" id="3441206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441209">if</span>&nbsp;<span class="ident" id="3441212">n</span>&nbsp;<span class="op" id="3441214">&lt;</span>&nbsp;<span class="ident" id="3441216">b</span><span class="op" id="3441217">.</span><span class="ident" id="3441218">n</span>&nbsp;<span class="op" id="3441220">&amp;&amp;</span>&nbsp;<span class="ident" id="3441223">err</span>&nbsp;<span class="op" id="3441227">==</span>&nbsp;<span class="ident" id="3441230">nil</span>&nbsp;<span class="op" id="3441234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441238">err</span>&nbsp;<span class="op" id="3441242">=</span>&nbsp;<span class="ident" id="3441244">io</span><span class="op" id="3441246">.</span><span class="ident" id="3441247">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441265">if</span>&nbsp;<span class="ident" id="3441268">err</span>&nbsp;<span class="op" id="3441272">!=</span>&nbsp;<span class="ident" id="3441275">nil</span>&nbsp;<span class="op" id="3441279">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441283">if</span>&nbsp;<span class="ident" id="3441286">n</span>&nbsp;<span class="op" id="3441288">&gt;</span>&nbsp;<span class="num" id="3441290">0</span>&nbsp;<span class="op" id="3441292">&amp;&amp;</span>&nbsp;<span class="ident" id="3441295">n</span>&nbsp;<span class="op" id="3441297">&lt;</span>&nbsp;<span class="ident" id="3441299">b</span><span class="op" id="3441300">.</span><span class="ident" id="3441301">n</span>&nbsp;<span class="op" id="3441303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3441308">copy</span><span class="op" id="3441312">(</span><span class="ident" id="3441313">b</span><span class="op" id="3441314">.</span><span class="ident" id="3441315">buf</span><span class="op" id="3441318">[</span><span class="num" id="3441319">0</span><span class="op" id="3441320">:</span><span class="ident" id="3441321">b</span><span class="op" id="3441322">.</span><span class="ident" id="3441323">n</span><span class="op" id="3441324">-</span><span class="ident" id="3441325">n</span><span class="op" id="3441326">]</span><span class="op" id="3441327">,</span>&nbsp;<span class="ident" id="3441329">b</span><span class="op" id="3441330">.</span><span class="ident" id="3441331">buf</span><span class="op" id="3441334">[</span><span class="ident" id="3441335">n</span><span class="op" id="3441336">:</span><span class="ident" id="3441337">b</span><span class="op" id="3441338">.</span><span class="ident" id="3441339">n</span><span class="op" id="3441340">]</span><span class="op" id="3441341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441349">b</span><span class="op" id="3441350">.</span><span class="ident" id="3441351">n</span>&nbsp;<span class="op" id="3441353">-=</span>&nbsp;<span class="ident" id="3441356">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441360">b</span><span class="op" id="3441361">.</span><span class="ident" id="3441362">err</span>&nbsp;<span class="op" id="3441366">=</span>&nbsp;<span class="ident" id="3441368">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441374">return</span>&nbsp;<span class="ident" id="3441381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441389">b</span><span class="op" id="3441390">.</span><span class="ident" id="3441391">n</span>&nbsp;<span class="op" id="3441393">=</span>&nbsp;<span class="num" id="3441395">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441398">return</span>&nbsp;<span class="ident" id="3441405">nil</span><br>
<span class="lineno"></span><span class="op" id="3441409">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="3441412">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3441474">func</span>&nbsp;<span class="op" id="3441479">(</span><span class="ident" id="3441480">b</span>&nbsp;<span class="op" id="3441482">*</span><span class="ident" id="3441483">Writer</span><span class="op" id="3441489">)</span>&nbsp;<span class="ident" id="3441491">Available</span><span class="op" id="3441500">(</span><span class="op" id="3441501">)</span>&nbsp;<span class="builtintype" id="3441503">int</span>&nbsp;<span class="op" id="3441507">{</span>&nbsp;<span class="keyword" id="3441509">return</span>&nbsp;<span class="builtinfunc" id="3441516">len</span><span class="op" id="3441519">(</span><span class="ident" id="3441520">b</span><span class="op" id="3441521">.</span><span class="ident" id="3441522">buf</span><span class="op" id="3441525">)</span>&nbsp;<span class="op" id="3441527">-</span>&nbsp;<span class="ident" id="3441529">b</span><span class="op" id="3441530">.</span><span class="ident" id="3441531">n</span>&nbsp;<span class="op" id="3441533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3441536">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="3441624">func</span>&nbsp;<span class="op" id="3441629">(</span><span class="ident" id="3441630">b</span>&nbsp;<span class="op" id="3441632">*</span><span class="ident" id="3441633">Writer</span><span class="op" id="3441639">)</span>&nbsp;<span class="ident" id="3441641">Buffered</span><span class="op" id="3441649">(</span><span class="op" id="3441650">)</span>&nbsp;<span class="builtintype" id="3441652">int</span>&nbsp;<span class="op" id="3441656">{</span>&nbsp;<span class="keyword" id="3441658">return</span>&nbsp;<span class="ident" id="3441665">b</span><span class="op" id="3441666">.</span><span class="ident" id="3441667">n</span>&nbsp;<span class="op" id="3441669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3441672">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3441723">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3441766">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="3441821">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3441848">func</span>&nbsp;<span class="op" id="3441853">(</span><span class="ident" id="3441854">b</span>&nbsp;<span class="op" id="3441856">*</span><span class="ident" id="3441857">Writer</span><span class="op" id="3441863">)</span>&nbsp;<span class="ident" id="3441865">Write</span><span class="op" id="3441870">(</span><span class="ident" id="3441871">p</span>&nbsp;<span class="op" id="3441873">[</span><span class="op" id="3441874">]</span><span class="builtintype" id="3441875">byte</span><span class="op" id="3441879">)</span>&nbsp;<span class="op" id="3441881">(</span><span class="ident" id="3441882">nn</span>&nbsp;<span class="builtintype" id="3441885">int</span><span class="op" id="3441888">,</span>&nbsp;<span class="ident" id="3441890">err</span>&nbsp;<span class="builtintype" id="3441894">error</span><span class="op" id="3441899">)</span>&nbsp;<span class="op" id="3441901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441904">for</span>&nbsp;<span class="builtinfunc" id="3441908">len</span><span class="op" id="3441911">(</span><span class="ident" id="3441912">p</span><span class="op" id="3441913">)</span>&nbsp;<span class="op" id="3441915">&gt;</span>&nbsp;<span class="ident" id="3441917">b</span><span class="op" id="3441918">.</span><span class="ident" id="3441919">Available</span><span class="op" id="3441928">(</span><span class="op" id="3441929">)</span>&nbsp;<span class="op" id="3441931">&amp;&amp;</span>&nbsp;<span class="ident" id="3441934">b</span><span class="op" id="3441935">.</span><span class="ident" id="3441936">err</span>&nbsp;<span class="op" id="3441940">==</span>&nbsp;<span class="ident" id="3441943">nil</span>&nbsp;<span class="op" id="3441947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441951">var</span>&nbsp;<span class="ident" id="3441955">n</span>&nbsp;<span class="builtintype" id="3441957">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441963">if</span>&nbsp;<span class="ident" id="3441966">b</span><span class="op" id="3441967">.</span><span class="ident" id="3441968">Buffered</span><span class="op" id="3441976">(</span><span class="op" id="3441977">)</span>&nbsp;<span class="op" id="3441979">==</span>&nbsp;<span class="num" id="3441982">0</span>&nbsp;<span class="op" id="3441984">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441989">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3442022">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442065">n</span><span class="op" id="3442066">,</span>&nbsp;<span class="ident" id="3442068">b</span><span class="op" id="3442069">.</span><span class="ident" id="3442070">err</span>&nbsp;<span class="op" id="3442074">=</span>&nbsp;<span class="ident" id="3442076">b</span><span class="op" id="3442077">.</span><span class="ident" id="3442078">wr</span><span class="op" id="3442080">.</span><span class="ident" id="3442081">Write</span><span class="op" id="3442086">(</span><span class="ident" id="3442087">p</span><span class="op" id="3442088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442092">}</span>&nbsp;<span class="keyword" id="3442094">else</span>&nbsp;<span class="op" id="3442099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442104">n</span>&nbsp;<span class="op" id="3442106">=</span>&nbsp;<span class="builtinfunc" id="3442108">copy</span><span class="op" id="3442112">(</span><span class="ident" id="3442113">b</span><span class="op" id="3442114">.</span><span class="ident" id="3442115">buf</span><span class="op" id="3442118">[</span><span class="ident" id="3442119">b</span><span class="op" id="3442120">.</span><span class="ident" id="3442121">n</span><span class="op" id="3442122">:</span><span class="op" id="3442123">]</span><span class="op" id="3442124">,</span>&nbsp;<span class="ident" id="3442126">p</span><span class="op" id="3442127">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442132">b</span><span class="op" id="3442133">.</span><span class="ident" id="3442134">n</span>&nbsp;<span class="op" id="3442136">+=</span>&nbsp;<span class="ident" id="3442139">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442144">b</span><span class="op" id="3442145">.</span><span class="ident" id="3442146">flush</span><span class="op" id="3442151">(</span><span class="op" id="3442152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442160">nn</span>&nbsp;<span class="op" id="3442163">+=</span>&nbsp;<span class="ident" id="3442166">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442170">p</span>&nbsp;<span class="op" id="3442172">=</span>&nbsp;<span class="ident" id="3442174">p</span><span class="op" id="3442175">[</span><span class="ident" id="3442176">n</span><span class="op" id="3442177">:</span><span class="op" id="3442178">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442184">if</span>&nbsp;<span class="ident" id="3442187">b</span><span class="op" id="3442188">.</span><span class="ident" id="3442189">err</span>&nbsp;<span class="op" id="3442193">!=</span>&nbsp;<span class="ident" id="3442196">nil</span>&nbsp;<span class="op" id="3442200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442204">return</span>&nbsp;<span class="ident" id="3442211">nn</span><span class="op" id="3442213">,</span>&nbsp;<span class="ident" id="3442215">b</span><span class="op" id="3442216">.</span><span class="ident" id="3442217">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442225">n</span>&nbsp;<span class="op" id="3442227">:=</span>&nbsp;<span class="builtinfunc" id="3442230">copy</span><span class="op" id="3442234">(</span><span class="ident" id="3442235">b</span><span class="op" id="3442236">.</span><span class="ident" id="3442237">buf</span><span class="op" id="3442240">[</span><span class="ident" id="3442241">b</span><span class="op" id="3442242">.</span><span class="ident" id="3442243">n</span><span class="op" id="3442244">:</span><span class="op" id="3442245">]</span><span class="op" id="3442246">,</span>&nbsp;<span class="ident" id="3442248">p</span><span class="op" id="3442249">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442252">b</span><span class="op" id="3442253">.</span><span class="ident" id="3442254">n</span>&nbsp;<span class="op" id="3442256">+=</span>&nbsp;<span class="ident" id="3442259">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442262">nn</span>&nbsp;<span class="op" id="3442265">+=</span>&nbsp;<span class="ident" id="3442268">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442271">return</span>&nbsp;<span class="ident" id="3442278">nn</span><span class="op" id="3442280">,</span>&nbsp;<span class="ident" id="3442282">nil</span><br>
<span class="lineno"></span><span class="op" id="3442286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3442289">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="3442324">func</span>&nbsp;<span class="op" id="3442329">(</span><span class="ident" id="3442330">b</span>&nbsp;<span class="op" id="3442332">*</span><span class="ident" id="3442333">Writer</span><span class="op" id="3442339">)</span>&nbsp;<span class="ident" id="3442341">WriteByte</span><span class="op" id="3442350">(</span><span class="ident" id="3442351">c</span>&nbsp;<span class="builtintype" id="3442353">byte</span><span class="op" id="3442357">)</span>&nbsp;<span class="builtintype" id="3442359">error</span>&nbsp;<span class="op" id="3442365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442368">if</span>&nbsp;<span class="ident" id="3442371">b</span><span class="op" id="3442372">.</span><span class="ident" id="3442373">err</span>&nbsp;<span class="op" id="3442377">!=</span>&nbsp;<span class="ident" id="3442380">nil</span>&nbsp;<span class="op" id="3442384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442388">return</span>&nbsp;<span class="ident" id="3442395">b</span><span class="op" id="3442396">.</span><span class="ident" id="3442397">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442402">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442405">if</span>&nbsp;<span class="ident" id="3442408">b</span><span class="op" id="3442409">.</span><span class="ident" id="3442410">Available</span><span class="op" id="3442419">(</span><span class="op" id="3442420">)</span>&nbsp;<span class="op" id="3442422">&lt;=</span>&nbsp;<span class="num" id="3442425">0</span>&nbsp;<span class="op" id="3442427">&amp;&amp;</span>&nbsp;<span class="ident" id="3442430">b</span><span class="op" id="3442431">.</span><span class="ident" id="3442432">flush</span><span class="op" id="3442437">(</span><span class="op" id="3442438">)</span>&nbsp;<span class="op" id="3442440">!=</span>&nbsp;<span class="ident" id="3442443">nil</span>&nbsp;<span class="op" id="3442447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442451">return</span>&nbsp;<span class="ident" id="3442458">b</span><span class="op" id="3442459">.</span><span class="ident" id="3442460">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442468">b</span><span class="op" id="3442469">.</span><span class="ident" id="3442470">buf</span><span class="op" id="3442473">[</span><span class="ident" id="3442474">b</span><span class="op" id="3442475">.</span><span class="ident" id="3442476">n</span><span class="op" id="3442477">]</span>&nbsp;<span class="op" id="3442479">=</span>&nbsp;<span class="ident" id="3442481">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442484">b</span><span class="op" id="3442485">.</span><span class="ident" id="3442486">n</span><span class="op" id="3442487">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442491">return</span>&nbsp;<span class="ident" id="3442498">nil</span><br>
<span class="lineno"></span><span class="op" id="3442502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3442505">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="3442564">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="3442610">func</span>&nbsp;<span class="op" id="3442615">(</span><span class="ident" id="3442616">b</span>&nbsp;<span class="op" id="3442618">*</span><span class="ident" id="3442619">Writer</span><span class="op" id="3442625">)</span>&nbsp;<span class="ident" id="3442627">WriteRune</span><span class="op" id="3442636">(</span><span class="ident" id="3442637">r</span>&nbsp;<span class="builtintype" id="3442639">rune</span><span class="op" id="3442643">)</span>&nbsp;<span class="op" id="3442645">(</span><span class="ident" id="3442646">size</span>&nbsp;<span class="builtintype" id="3442651">int</span><span class="op" id="3442654">,</span>&nbsp;<span class="ident" id="3442656">err</span>&nbsp;<span class="builtintype" id="3442660">error</span><span class="op" id="3442665">)</span>&nbsp;<span class="op" id="3442667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442670">if</span>&nbsp;<span class="ident" id="3442673">r</span>&nbsp;<span class="op" id="3442675">&lt;</span>&nbsp;<span class="ident" id="3442677">utf8</span><span class="op" id="3442681">.</span><span class="ident" id="3442682">RuneSelf</span>&nbsp;<span class="op" id="3442691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442695">err</span>&nbsp;<span class="op" id="3442699">=</span>&nbsp;<span class="ident" id="3442701">b</span><span class="op" id="3442702">.</span><span class="ident" id="3442703">WriteByte</span><span class="op" id="3442712">(</span><span class="builtintype" id="3442713">byte</span><span class="op" id="3442717">(</span><span class="ident" id="3442718">r</span><span class="op" id="3442719">)</span><span class="op" id="3442720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442724">if</span>&nbsp;<span class="ident" id="3442727">err</span>&nbsp;<span class="op" id="3442731">!=</span>&nbsp;<span class="ident" id="3442734">nil</span>&nbsp;<span class="op" id="3442738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442743">return</span>&nbsp;<span class="num" id="3442750">0</span><span class="op" id="3442751">,</span>&nbsp;<span class="ident" id="3442753">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442763">return</span>&nbsp;<span class="num" id="3442770">1</span><span class="op" id="3442771">,</span>&nbsp;<span class="ident" id="3442773">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442781">if</span>&nbsp;<span class="ident" id="3442784">b</span><span class="op" id="3442785">.</span><span class="ident" id="3442786">err</span>&nbsp;<span class="op" id="3442790">!=</span>&nbsp;<span class="ident" id="3442793">nil</span>&nbsp;<span class="op" id="3442797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442801">return</span>&nbsp;<span class="num" id="3442808">0</span><span class="op" id="3442809">,</span>&nbsp;<span class="ident" id="3442811">b</span><span class="op" id="3442812">.</span><span class="ident" id="3442813">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442821">n</span>&nbsp;<span class="op" id="3442823">:=</span>&nbsp;<span class="ident" id="3442826">b</span><span class="op" id="3442827">.</span><span class="ident" id="3442828">Available</span><span class="op" id="3442837">(</span><span class="op" id="3442838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442841">if</span>&nbsp;<span class="ident" id="3442844">n</span>&nbsp;<span class="op" id="3442846">&lt;</span>&nbsp;<span class="ident" id="3442848">utf8</span><span class="op" id="3442852">.</span><span class="ident" id="3442853">UTFMax</span>&nbsp;<span class="op" id="3442860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442864">if</span>&nbsp;<span class="ident" id="3442867">b</span><span class="op" id="3442868">.</span><span class="ident" id="3442869">flush</span><span class="op" id="3442874">(</span><span class="op" id="3442875">)</span><span class="op" id="3442876">;</span>&nbsp;<span class="ident" id="3442878">b</span><span class="op" id="3442879">.</span><span class="ident" id="3442880">err</span>&nbsp;<span class="op" id="3442884">!=</span>&nbsp;<span class="ident" id="3442887">nil</span>&nbsp;<span class="op" id="3442891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442896">return</span>&nbsp;<span class="num" id="3442903">0</span><span class="op" id="3442904">,</span>&nbsp;<span class="ident" id="3442906">b</span><span class="op" id="3442907">.</span><span class="ident" id="3442908">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442918">n</span>&nbsp;<span class="op" id="3442920">=</span>&nbsp;<span class="ident" id="3442922">b</span><span class="op" id="3442923">.</span><span class="ident" id="3442924">Available</span><span class="op" id="3442933">(</span><span class="op" id="3442934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442938">if</span>&nbsp;<span class="ident" id="3442941">n</span>&nbsp;<span class="op" id="3442943">&lt;</span>&nbsp;<span class="ident" id="3442945">utf8</span><span class="op" id="3442949">.</span><span class="ident" id="3442950">UTFMax</span>&nbsp;<span class="op" id="3442957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3442962">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443010">return</span>&nbsp;<span class="ident" id="3443017">b</span><span class="op" id="3443018">.</span><span class="ident" id="3443019">WriteString</span><span class="op" id="3443030">(</span><span class="builtintype" id="3443031">string</span><span class="op" id="3443037">(</span><span class="ident" id="3443038">r</span><span class="op" id="3443039">)</span><span class="op" id="3443040">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443050">size</span>&nbsp;<span class="op" id="3443055">=</span>&nbsp;<span class="ident" id="3443057">utf8</span><span class="op" id="3443061">.</span><span class="ident" id="3443062">EncodeRune</span><span class="op" id="3443072">(</span><span class="ident" id="3443073">b</span><span class="op" id="3443074">.</span><span class="ident" id="3443075">buf</span><span class="op" id="3443078">[</span><span class="ident" id="3443079">b</span><span class="op" id="3443080">.</span><span class="ident" id="3443081">n</span><span class="op" id="3443082">:</span><span class="op" id="3443083">]</span><span class="op" id="3443084">,</span>&nbsp;<span class="ident" id="3443086">r</span><span class="op" id="3443087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443090">b</span><span class="op" id="3443091">.</span><span class="ident" id="3443092">n</span>&nbsp;<span class="op" id="3443094">+=</span>&nbsp;<span class="ident" id="3443097">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443103">return</span>&nbsp;<span class="ident" id="3443110">size</span><span class="op" id="3443114">,</span>&nbsp;<span class="ident" id="3443116">nil</span><br>
<span class="lineno">620</span><span class="op" id="3443120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3443123">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3443155">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3443198">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="3443271">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3443298">func</span>&nbsp;<span class="op" id="3443303">(</span><span class="ident" id="3443304">b</span>&nbsp;<span class="op" id="3443306">*</span><span class="ident" id="3443307">Writer</span><span class="op" id="3443313">)</span>&nbsp;<span class="ident" id="3443315">WriteString</span><span class="op" id="3443326">(</span><span class="ident" id="3443327">s</span>&nbsp;<span class="builtintype" id="3443329">string</span><span class="op" id="3443335">)</span>&nbsp;<span class="op" id="3443337">(</span><span class="builtintype" id="3443338">int</span><span class="op" id="3443341">,</span>&nbsp;<span class="builtintype" id="3443343">error</span><span class="op" id="3443348">)</span>&nbsp;<span class="op" id="3443350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443353">nn</span>&nbsp;<span class="op" id="3443356">:=</span>&nbsp;<span class="num" id="3443359">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443362">for</span>&nbsp;<span class="builtinfunc" id="3443366">len</span><span class="op" id="3443369">(</span><span class="ident" id="3443370">s</span><span class="op" id="3443371">)</span>&nbsp;<span class="op" id="3443373">&gt;</span>&nbsp;<span class="ident" id="3443375">b</span><span class="op" id="3443376">.</span><span class="ident" id="3443377">Available</span><span class="op" id="3443386">(</span><span class="op" id="3443387">)</span>&nbsp;<span class="op" id="3443389">&amp;&amp;</span>&nbsp;<span class="ident" id="3443392">b</span><span class="op" id="3443393">.</span><span class="ident" id="3443394">err</span>&nbsp;<span class="op" id="3443398">==</span>&nbsp;<span class="ident" id="3443401">nil</span>&nbsp;<span class="op" id="3443405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443409">n</span>&nbsp;<span class="op" id="3443411">:=</span>&nbsp;<span class="builtinfunc" id="3443414">copy</span><span class="op" id="3443418">(</span><span class="ident" id="3443419">b</span><span class="op" id="3443420">.</span><span class="ident" id="3443421">buf</span><span class="op" id="3443424">[</span><span class="ident" id="3443425">b</span><span class="op" id="3443426">.</span><span class="ident" id="3443427">n</span><span class="op" id="3443428">:</span><span class="op" id="3443429">]</span><span class="op" id="3443430">,</span>&nbsp;<span class="ident" id="3443432">s</span><span class="op" id="3443433">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443437">b</span><span class="op" id="3443438">.</span><span class="ident" id="3443439">n</span>&nbsp;<span class="op" id="3443441">+=</span>&nbsp;<span class="ident" id="3443444">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443448">nn</span>&nbsp;<span class="op" id="3443451">+=</span>&nbsp;<span class="ident" id="3443454">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443458">s</span>&nbsp;<span class="op" id="3443460">=</span>&nbsp;<span class="ident" id="3443462">s</span><span class="op" id="3443463">[</span><span class="ident" id="3443464">n</span><span class="op" id="3443465">:</span><span class="op" id="3443466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443470">b</span><span class="op" id="3443471">.</span><span class="ident" id="3443472">flush</span><span class="op" id="3443477">(</span><span class="op" id="3443478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443481">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443484">if</span>&nbsp;<span class="ident" id="3443487">b</span><span class="op" id="3443488">.</span><span class="ident" id="3443489">err</span>&nbsp;<span class="op" id="3443493">!=</span>&nbsp;<span class="ident" id="3443496">nil</span>&nbsp;<span class="op" id="3443500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443504">return</span>&nbsp;<span class="ident" id="3443511">nn</span><span class="op" id="3443513">,</span>&nbsp;<span class="ident" id="3443515">b</span><span class="op" id="3443516">.</span><span class="ident" id="3443517">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443525">n</span>&nbsp;<span class="op" id="3443527">:=</span>&nbsp;<span class="builtinfunc" id="3443530">copy</span><span class="op" id="3443534">(</span><span class="ident" id="3443535">b</span><span class="op" id="3443536">.</span><span class="ident" id="3443537">buf</span><span class="op" id="3443540">[</span><span class="ident" id="3443541">b</span><span class="op" id="3443542">.</span><span class="ident" id="3443543">n</span><span class="op" id="3443544">:</span><span class="op" id="3443545">]</span><span class="op" id="3443546">,</span>&nbsp;<span class="ident" id="3443548">s</span><span class="op" id="3443549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443552">b</span><span class="op" id="3443553">.</span><span class="ident" id="3443554">n</span>&nbsp;<span class="op" id="3443556">+=</span>&nbsp;<span class="ident" id="3443559">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443562">nn</span>&nbsp;<span class="op" id="3443565">+=</span>&nbsp;<span class="ident" id="3443568">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443571">return</span>&nbsp;<span class="ident" id="3443578">nn</span><span class="op" id="3443580">,</span>&nbsp;<span class="ident" id="3443582">nil</span><br>
<span class="lineno"></span><span class="op" id="3443586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3443589">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="3443627">func</span>&nbsp;<span class="op" id="3443632">(</span><span class="ident" id="3443633">b</span>&nbsp;<span class="op" id="3443635">*</span><span class="ident" id="3443636">Writer</span><span class="op" id="3443642">)</span>&nbsp;<span class="ident" id="3443644">ReadFrom</span><span class="op" id="3443652">(</span><span class="ident" id="3443653">r</span>&nbsp;<span class="ident" id="3443655">io</span><span class="op" id="3443657">.</span><span class="ident" id="3443658">Reader</span><span class="op" id="3443664">)</span>&nbsp;<span class="op" id="3443666">(</span><span class="ident" id="3443667">n</span>&nbsp;<span class="ident" id="3443669">int64</span><span class="op" id="3443674">,</span>&nbsp;<span class="ident" id="3443676">err</span>&nbsp;<span class="builtintype" id="3443680">error</span><span class="op" id="3443685">)</span>&nbsp;<span class="op" id="3443687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443690">if</span>&nbsp;<span class="ident" id="3443693">b</span><span class="op" id="3443694">.</span><span class="ident" id="3443695">Buffered</span><span class="op" id="3443703">(</span><span class="op" id="3443704">)</span>&nbsp;<span class="op" id="3443706">==</span>&nbsp;<span class="num" id="3443709">0</span>&nbsp;<span class="op" id="3443711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443715">if</span>&nbsp;<span class="ident" id="3443718">w</span><span class="op" id="3443719">,</span>&nbsp;<span class="ident" id="3443721">ok</span>&nbsp;<span class="op" id="3443724">:=</span>&nbsp;<span class="ident" id="3443727">b</span><span class="op" id="3443728">.</span><span class="ident" id="3443729">wr</span><span class="op" id="3443731">.</span><span class="op" id="3443732">(</span><span class="ident" id="3443733">io</span><span class="op" id="3443735">.</span><span class="ident" id="3443736">ReaderFrom</span><span class="op" id="3443746">)</span><span class="op" id="3443747">;</span>&nbsp;<span class="ident" id="3443749">ok</span>&nbsp;<span class="op" id="3443752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443757">return</span>&nbsp;<span class="ident" id="3443764">w</span><span class="op" id="3443765">.</span><span class="ident" id="3443766">ReadFrom</span><span class="op" id="3443774">(</span><span class="ident" id="3443775">r</span><span class="op" id="3443776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443780">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443786">var</span>&nbsp;<span class="ident" id="3443790">m</span>&nbsp;<span class="builtintype" id="3443792">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443797">for</span>&nbsp;<span class="op" id="3443801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443805">if</span>&nbsp;<span class="ident" id="3443808">b</span><span class="op" id="3443809">.</span><span class="ident" id="3443810">Available</span><span class="op" id="3443819">(</span><span class="op" id="3443820">)</span>&nbsp;<span class="op" id="3443822">==</span>&nbsp;<span class="num" id="3443825">0</span>&nbsp;<span class="op" id="3443827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443832">if</span>&nbsp;<span class="ident" id="3443835">err1</span>&nbsp;<span class="op" id="3443840">:=</span>&nbsp;<span class="ident" id="3443843">b</span><span class="op" id="3443844">.</span><span class="ident" id="3443845">flush</span><span class="op" id="3443850">(</span><span class="op" id="3443851">)</span><span class="op" id="3443852">;</span>&nbsp;<span class="ident" id="3443854">err1</span>&nbsp;<span class="op" id="3443859">!=</span>&nbsp;<span class="ident" id="3443862">nil</span>&nbsp;<span class="op" id="3443866">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443872">return</span>&nbsp;<span class="ident" id="3443879">n</span><span class="op" id="3443880">,</span>&nbsp;<span class="ident" id="3443882">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3443894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443898">nr</span>&nbsp;<span class="op" id="3443901">:=</span>&nbsp;<span class="num" id="3443904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443908">for</span>&nbsp;<span class="ident" id="3443912">nr</span>&nbsp;<span class="op" id="3443915">&lt;</span>&nbsp;<span class="ident" id="3443917">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3443942">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3443947">m</span><span class="op" id="3443948">,</span>&nbsp;<span class="ident" id="3443950">err</span>&nbsp;<span class="op" id="3443954">=</span>&nbsp;<span class="ident" id="3443956">r</span><span class="op" id="3443957">.</span><span class="ident" id="3443958">Read</span><span class="op" id="3443962">(</span><span class="ident" id="3443963">b</span><span class="op" id="3443964">.</span><span class="ident" id="3443965">buf</span><span class="op" id="3443968">[</span><span class="ident" id="3443969">b</span><span class="op" id="3443970">.</span><span class="ident" id="3443971">n</span><span class="op" id="3443972">:</span><span class="op" id="3443973">]</span><span class="op" id="3443974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3443979">if</span>&nbsp;<span class="ident" id="3443982">m</span>&nbsp;<span class="op" id="3443984">!=</span>&nbsp;<span class="num" id="3443987">0</span>&nbsp;<span class="op" id="3443989">||</span>&nbsp;<span class="ident" id="3443992">err</span>&nbsp;<span class="op" id="3443996">!=</span>&nbsp;<span class="ident" id="3443999">nil</span>&nbsp;<span class="op" id="3444003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444009">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3444023">nr</span><span class="op" id="3444025">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444034">if</span>&nbsp;<span class="ident" id="3444037">nr</span>&nbsp;<span class="op" id="3444040">==</span>&nbsp;<span class="ident" id="3444043">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3444068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444073">return</span>&nbsp;<span class="ident" id="3444080">n</span><span class="op" id="3444081">,</span>&nbsp;<span class="ident" id="3444083">io</span><span class="op" id="3444085">.</span><span class="ident" id="3444086">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3444106">b</span><span class="op" id="3444107">.</span><span class="ident" id="3444108">n</span>&nbsp;<span class="op" id="3444110">+=</span>&nbsp;<span class="ident" id="3444113">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3444117">n</span>&nbsp;<span class="op" id="3444119">+=</span>&nbsp;<span class="ident" id="3444122">int64</span><span class="op" id="3444127">(</span><span class="ident" id="3444128">m</span><span class="op" id="3444129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444133">if</span>&nbsp;<span class="ident" id="3444136">err</span>&nbsp;<span class="op" id="3444140">!=</span>&nbsp;<span class="ident" id="3444143">nil</span>&nbsp;<span class="op" id="3444147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444152">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444163">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444166">if</span>&nbsp;<span class="ident" id="3444169">err</span>&nbsp;<span class="op" id="3444173">==</span>&nbsp;<span class="ident" id="3444176">io</span><span class="op" id="3444178">.</span><span class="ident" id="3444179">EOF</span>&nbsp;<span class="op" id="3444183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3444187">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444246">if</span>&nbsp;<span class="ident" id="3444249">b</span><span class="op" id="3444250">.</span><span class="ident" id="3444251">Available</span><span class="op" id="3444260">(</span><span class="op" id="3444261">)</span>&nbsp;<span class="op" id="3444263">==</span>&nbsp;<span class="num" id="3444266">0</span>&nbsp;<span class="op" id="3444268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3444273">err</span>&nbsp;<span class="op" id="3444277">=</span>&nbsp;<span class="ident" id="3444279">b</span><span class="op" id="3444280">.</span><span class="ident" id="3444281">flush</span><span class="op" id="3444286">(</span><span class="op" id="3444287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444291">}</span>&nbsp;<span class="keyword" id="3444293">else</span>&nbsp;<span class="op" id="3444298">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3444303">err</span>&nbsp;<span class="op" id="3444307">=</span>&nbsp;<span class="ident" id="3444309">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444321">return</span>&nbsp;<span class="ident" id="3444328">n</span><span class="op" id="3444329">,</span>&nbsp;<span class="ident" id="3444331">err</span><br>
<span class="lineno"></span><span class="op" id="3444335">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3444338">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3444368">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="3444424">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="3444456">type</span>&nbsp;<span class="ident" id="3444461">ReadWriter</span>&nbsp;<span class="keyword" id="3444472">struct</span>&nbsp;<span class="op" id="3444479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444482">*</span><span class="ident" id="3444483">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3444491">*</span><span class="ident" id="3444492">Writer</span><br>
<span class="lineno"></span><span class="op" id="3444499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3444502">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3444574">func</span>&nbsp;<span class="ident" id="3444579">NewReadWriter</span><span class="op" id="3444592">(</span><span class="ident" id="3444593">r</span>&nbsp;<span class="op" id="3444595">*</span><span class="ident" id="3444596">Reader</span><span class="op" id="3444602">,</span>&nbsp;<span class="ident" id="3444604">w</span>&nbsp;<span class="op" id="3444606">*</span><span class="ident" id="3444607">Writer</span><span class="op" id="3444613">)</span>&nbsp;<span class="op" id="3444615">*</span><span class="ident" id="3444616">ReadWriter</span>&nbsp;<span class="op" id="3444627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3444630">return</span>&nbsp;<span class="op" id="3444637">&amp;</span><span class="ident" id="3444638">ReadWriter</span><span class="op" id="3444648">{</span><span class="ident" id="3444649">r</span><span class="op" id="3444650">,</span>&nbsp;<span class="ident" id="3444652">w</span><span class="op" id="3444653">}</span><br>
<span class="lineno"></span><span class="op" id="3444655">}</span>
</div>
</body>
</html>
