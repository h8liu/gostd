<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5192716">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5192771">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5192825">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5192876">package</span>&nbsp;<span class="ident" id="5192884">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5192891">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5192964">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5193041">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5193120">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5193199">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5193277">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5193356">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5193430">type</span>&nbsp;<span class="ident" id="5193435">moveToFrontDecoder</span>&nbsp;<span class="op" id="5193454">[</span><span class="op" id="5193455">]</span><span class="builtintype" id="5193456">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5193462">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5193541">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5193556">func</span>&nbsp;<span class="ident" id="5193561">newMTFDecoder</span><span class="op" id="5193574">(</span><span class="ident" id="5193575">symbols</span>&nbsp;<span class="op" id="5193583">[</span><span class="op" id="5193584">]</span><span class="builtintype" id="5193585">byte</span><span class="op" id="5193589">)</span>&nbsp;<span class="ident" id="5193591">moveToFrontDecoder</span>&nbsp;<span class="op" id="5193610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193613">if</span>&nbsp;<span class="builtinfunc" id="5193616">len</span><span class="op" id="5193619">(</span><span class="ident" id="5193620">symbols</span><span class="op" id="5193627">)</span>&nbsp;<span class="op" id="5193629">&gt;</span>&nbsp;<span class="num" id="5193631">256</span>&nbsp;<span class="op" id="5193635">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5193639">panic</span><span class="op" id="5193644">(</span><span class="string" id="5193645">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5193663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193669">return</span>&nbsp;<span class="ident" id="5193676">moveToFrontDecoder</span><span class="op" id="5193694">(</span><span class="ident" id="5193695">symbols</span><span class="op" id="5193702">)</span><br>
<span class="lineno"></span><span class="op" id="5193704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5193707">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5193781">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5193808">func</span>&nbsp;<span class="ident" id="5193813">newMTFDecoderWithRange</span><span class="op" id="5193835">(</span><span class="ident" id="5193836">n</span>&nbsp;<span class="builtintype" id="5193838">int</span><span class="op" id="5193841">)</span>&nbsp;<span class="ident" id="5193843">moveToFrontDecoder</span>&nbsp;<span class="op" id="5193862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193865">if</span>&nbsp;<span class="ident" id="5193868">n</span>&nbsp;<span class="op" id="5193870">&gt;</span>&nbsp;<span class="num" id="5193872">256</span>&nbsp;<span class="op" id="5193876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5193880">panic</span><span class="op" id="5193885">(</span><span class="string" id="5193886">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5193937">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193944">m</span>&nbsp;<span class="op" id="5193946">:=</span>&nbsp;<span class="builtinfunc" id="5193949">make</span><span class="op" id="5193953">(</span><span class="op" id="5193954">[</span><span class="op" id="5193955">]</span><span class="builtintype" id="5193956">byte</span><span class="op" id="5193960">,</span>&nbsp;<span class="ident" id="5193962">n</span><span class="op" id="5193963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193966">for</span>&nbsp;<span class="ident" id="5193970">i</span>&nbsp;<span class="op" id="5193972">:=</span>&nbsp;<span class="num" id="5193975">0</span><span class="op" id="5193976">;</span>&nbsp;<span class="ident" id="5193978">i</span>&nbsp;<span class="op" id="5193980">&lt;</span>&nbsp;<span class="ident" id="5193982">n</span><span class="op" id="5193983">;</span>&nbsp;<span class="ident" id="5193985">i</span><span class="op" id="5193986">++</span>&nbsp;<span class="op" id="5193989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193993">m</span><span class="op" id="5193994">[</span><span class="ident" id="5193995">i</span><span class="op" id="5193996">]</span>&nbsp;<span class="op" id="5193998">=</span>&nbsp;<span class="builtintype" id="5194000">byte</span><span class="op" id="5194004">(</span><span class="ident" id="5194005">i</span><span class="op" id="5194006">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194012">return</span>&nbsp;<span class="ident" id="5194019">moveToFrontDecoder</span><span class="op" id="5194037">(</span><span class="ident" id="5194038">m</span><span class="op" id="5194039">)</span><br>
<span class="lineno"></span><span class="op" id="5194041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5194044">func</span>&nbsp;<span class="op" id="5194049">(</span><span class="ident" id="5194050">m</span>&nbsp;<span class="ident" id="5194052">moveToFrontDecoder</span><span class="op" id="5194070">)</span>&nbsp;<span class="ident" id="5194072">Decode</span><span class="op" id="5194078">(</span><span class="ident" id="5194079">n</span>&nbsp;<span class="builtintype" id="5194081">int</span><span class="op" id="5194084">)</span>&nbsp;<span class="op" id="5194086">(</span><span class="ident" id="5194087">b</span>&nbsp;<span class="builtintype" id="5194089">byte</span><span class="op" id="5194093">)</span>&nbsp;<span class="op" id="5194095">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5194098">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5194160">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5194226">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5194284">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194351">b</span>&nbsp;<span class="op" id="5194353">=</span>&nbsp;<span class="ident" id="5194355">m</span><span class="op" id="5194356">[</span><span class="ident" id="5194357">n</span><span class="op" id="5194358">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5194361">copy</span><span class="op" id="5194365">(</span><span class="ident" id="5194366">m</span><span class="op" id="5194367">[</span><span class="num" id="5194368">1</span><span class="op" id="5194369">:</span><span class="op" id="5194370">]</span><span class="op" id="5194371">,</span>&nbsp;<span class="ident" id="5194373">m</span><span class="op" id="5194374">[</span><span class="op" id="5194375">:</span><span class="ident" id="5194376">n</span><span class="op" id="5194377">]</span><span class="op" id="5194378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194381">m</span><span class="op" id="5194382">[</span><span class="num" id="5194383">0</span><span class="op" id="5194384">]</span>&nbsp;<span class="op" id="5194386">=</span>&nbsp;<span class="ident" id="5194388">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194391">return</span><br>
<span class="lineno"></span><span class="op" id="5194398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5194401">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5194455">func</span>&nbsp;<span class="op" id="5194460">(</span><span class="ident" id="5194461">m</span>&nbsp;<span class="ident" id="5194463">moveToFrontDecoder</span><span class="op" id="5194481">)</span>&nbsp;<span class="ident" id="5194483">First</span><span class="op" id="5194488">(</span><span class="op" id="5194489">)</span>&nbsp;<span class="builtintype" id="5194491">byte</span>&nbsp;<span class="op" id="5194496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194499">return</span>&nbsp;<span class="ident" id="5194506">m</span><span class="op" id="5194507">[</span><span class="num" id="5194508">0</span><span class="op" id="5194509">]</span><br>
<span class="lineno"></span><span class="op" id="5194511">}</span>
</div>
</body>
</html>
