<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4741609">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4741664">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4741718">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4741769">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4741824">package</span>&nbsp;<span class="ident" id="4741832">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4741837">import</span>&nbsp;<span class="op" id="4741844">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4741847">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4741859">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4741869">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4741875">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4741883">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4741893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4741896">var</span>&nbsp;<span class="op" id="4741900">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741903">errBadUint</span>&nbsp;<span class="op" id="4741914">=</span>&nbsp;<span class="ident" id="4741916">errors</span><span class="op" id="4741922">.</span><span class="ident" id="4741923">New</span><span class="op" id="4741926">(</span><span class="string" id="4741927">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="4741971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741974">errBadType</span>&nbsp;<span class="op" id="4741985">=</span>&nbsp;<span class="ident" id="4741987">errors</span><span class="op" id="4741993">.</span><span class="ident" id="4741994">New</span><span class="op" id="4741997">(</span><span class="string" id="4741998">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="4742038">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742041">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4742052">=</span>&nbsp;<span class="ident" id="4742054">errors</span><span class="op" id="4742060">.</span><span class="ident" id="4742061">New</span><span class="op" id="4742064">(</span><span class="string" id="4742065">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="4742109">)</span><br>
<span class="lineno"></span><span class="op" id="4742111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4742114">type</span>&nbsp;<span class="ident" id="4742119">decHelper</span>&nbsp;<span class="keyword" id="4742129">func</span><span class="op" id="4742133">(</span><span class="ident" id="4742134">state</span>&nbsp;<span class="op" id="4742140">*</span><span class="ident" id="4742141">decoderState</span><span class="op" id="4742153">,</span>&nbsp;<span class="ident" id="4742155">v</span>&nbsp;<span class="ident" id="4742157">reflect</span><span class="op" id="4742164">.</span><span class="ident" id="4742165">Value</span><span class="op" id="4742170">,</span>&nbsp;<span class="ident" id="4742172">length</span>&nbsp;<span class="builtintype" id="4742179">int</span><span class="op" id="4742182">,</span>&nbsp;<span class="ident" id="4742184">ovfl</span>&nbsp;<span class="builtintype" id="4742189">error</span><span class="op" id="4742194">)</span>&nbsp;<span class="builtintype" id="4742196">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4742202">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4742284">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="4742318">type</span>&nbsp;<span class="ident" id="4742323">decoderState</span>&nbsp;<span class="keyword" id="4742336">struct</span>&nbsp;<span class="op" id="4742343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742346">dec</span>&nbsp;<span class="op" id="4742350">*</span><span class="ident" id="4742351">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742360">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742438">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742509">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4742518">*</span><span class="ident" id="4742519">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742530">fieldnum</span>&nbsp;<span class="builtintype" id="4742539">int</span>&nbsp;<span class="comment" id="4742543">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742575">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4742584">[</span><span class="op" id="4742585">]</span><span class="builtintype" id="4742586">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742592">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4742601">*</span><span class="ident" id="4742602">decoderState</span>&nbsp;<span class="comment" id="4742615">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="4742632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4742635">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4742720">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="4742819">type</span>&nbsp;<span class="ident" id="4742824">decBuffer</span>&nbsp;<span class="keyword" id="4742834">struct</span>&nbsp;<span class="op" id="4742841">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742844">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4742851">[</span><span class="op" id="4742852">]</span><span class="builtintype" id="4742853">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742859">offset</span>&nbsp;<span class="builtintype" id="4742866">int</span>&nbsp;<span class="comment" id="4742870">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="4742886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4742889">func</span>&nbsp;<span class="op" id="4742894">(</span><span class="ident" id="4742895">d</span>&nbsp;<span class="op" id="4742897">*</span><span class="ident" id="4742898">decBuffer</span><span class="op" id="4742907">)</span>&nbsp;<span class="ident" id="4742909">Read</span><span class="op" id="4742913">(</span><span class="ident" id="4742914">p</span>&nbsp;<span class="op" id="4742916">[</span><span class="op" id="4742917">]</span><span class="builtintype" id="4742918">byte</span><span class="op" id="4742922">)</span>&nbsp;<span class="op" id="4742924">(</span><span class="builtintype" id="4742925">int</span><span class="op" id="4742928">,</span>&nbsp;<span class="builtintype" id="4742930">error</span><span class="op" id="4742935">)</span>&nbsp;<span class="op" id="4742937">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742940">n</span>&nbsp;<span class="op" id="4742942">:=</span>&nbsp;<span class="builtinfunc" id="4742945">copy</span><span class="op" id="4742949">(</span><span class="ident" id="4742950">p</span><span class="op" id="4742951">,</span>&nbsp;<span class="ident" id="4742953">d</span><span class="op" id="4742954">.</span><span class="ident" id="4742955">data</span><span class="op" id="4742959">[</span><span class="ident" id="4742960">d</span><span class="op" id="4742961">.</span><span class="ident" id="4742962">offset</span><span class="op" id="4742968">:</span><span class="op" id="4742969">]</span><span class="op" id="4742970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742973">if</span>&nbsp;<span class="ident" id="4742976">n</span>&nbsp;<span class="op" id="4742978">==</span>&nbsp;<span class="num" id="4742981">0</span>&nbsp;<span class="op" id="4742983">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4742986">len</span><span class="op" id="4742989">(</span><span class="ident" id="4742990">p</span><span class="op" id="4742991">)</span>&nbsp;<span class="op" id="4742993">!=</span>&nbsp;<span class="num" id="4742996">0</span>&nbsp;<span class="op" id="4742998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743002">return</span>&nbsp;<span class="num" id="4743009">0</span><span class="op" id="4743010">,</span>&nbsp;<span class="ident" id="4743012">io</span><span class="op" id="4743014">.</span><span class="ident" id="4743015">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743023">d</span><span class="op" id="4743024">.</span><span class="ident" id="4743025">offset</span>&nbsp;<span class="op" id="4743032">+=</span>&nbsp;<span class="ident" id="4743035">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743038">return</span>&nbsp;<span class="ident" id="4743045">n</span><span class="op" id="4743046">,</span>&nbsp;<span class="ident" id="4743048">nil</span><br>
<span class="lineno"></span><span class="op" id="4743052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4743055">func</span>&nbsp;<span class="op" id="4743060">(</span><span class="ident" id="4743061">d</span>&nbsp;<span class="op" id="4743063">*</span><span class="ident" id="4743064">decBuffer</span><span class="op" id="4743073">)</span>&nbsp;<span class="ident" id="4743075">Drop</span><span class="op" id="4743079">(</span><span class="ident" id="4743080">n</span>&nbsp;<span class="builtintype" id="4743082">int</span><span class="op" id="4743085">)</span>&nbsp;<span class="op" id="4743087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743090">if</span>&nbsp;<span class="ident" id="4743093">n</span>&nbsp;<span class="op" id="4743095">&gt;</span>&nbsp;<span class="ident" id="4743097">d</span><span class="op" id="4743098">.</span><span class="ident" id="4743099">Len</span><span class="op" id="4743102">(</span><span class="op" id="4743103">)</span>&nbsp;<span class="op" id="4743105">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4743109">panic</span><span class="op" id="4743114">(</span><span class="string" id="4743115">&#34;drop&#34;</span><span class="op" id="4743121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743127">d</span><span class="op" id="4743128">.</span><span class="ident" id="4743129">offset</span>&nbsp;<span class="op" id="4743136">+=</span>&nbsp;<span class="ident" id="4743139">n</span><br>
<span class="lineno"></span><span class="op" id="4743141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4743144">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4743207">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4743272">func</span>&nbsp;<span class="op" id="4743277">(</span><span class="ident" id="4743278">d</span>&nbsp;<span class="op" id="4743280">*</span><span class="ident" id="4743281">decBuffer</span><span class="op" id="4743290">)</span>&nbsp;<span class="ident" id="4743292">Size</span><span class="op" id="4743296">(</span><span class="ident" id="4743297">n</span>&nbsp;<span class="builtintype" id="4743299">int</span><span class="op" id="4743302">)</span>&nbsp;<span class="op" id="4743304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743307">d</span><span class="op" id="4743308">.</span><span class="ident" id="4743309">Reset</span><span class="op" id="4743314">(</span><span class="op" id="4743315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743318">if</span>&nbsp;<span class="builtinfunc" id="4743321">cap</span><span class="op" id="4743324">(</span><span class="ident" id="4743325">d</span><span class="op" id="4743326">.</span><span class="ident" id="4743327">data</span><span class="op" id="4743331">)</span>&nbsp;<span class="op" id="4743333">&lt;</span>&nbsp;<span class="ident" id="4743335">n</span>&nbsp;<span class="op" id="4743337">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743341">d</span><span class="op" id="4743342">.</span><span class="ident" id="4743343">data</span>&nbsp;<span class="op" id="4743348">=</span>&nbsp;<span class="builtinfunc" id="4743350">make</span><span class="op" id="4743354">(</span><span class="op" id="4743355">[</span><span class="op" id="4743356">]</span><span class="builtintype" id="4743357">byte</span><span class="op" id="4743361">,</span>&nbsp;<span class="ident" id="4743363">n</span><span class="op" id="4743364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743367">}</span>&nbsp;<span class="keyword" id="4743369">else</span>&nbsp;<span class="op" id="4743374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743378">d</span><span class="op" id="4743379">.</span><span class="ident" id="4743380">data</span>&nbsp;<span class="op" id="4743385">=</span>&nbsp;<span class="ident" id="4743387">d</span><span class="op" id="4743388">.</span><span class="ident" id="4743389">data</span><span class="op" id="4743393">[</span><span class="num" id="4743394">0</span><span class="op" id="4743395">:</span><span class="ident" id="4743396">n</span><span class="op" id="4743397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743400">}</span><br>
<span class="lineno"></span><span class="op" id="4743402">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4743405">func</span>&nbsp;<span class="op" id="4743410">(</span><span class="ident" id="4743411">d</span>&nbsp;<span class="op" id="4743413">*</span><span class="ident" id="4743414">decBuffer</span><span class="op" id="4743423">)</span>&nbsp;<span class="ident" id="4743425">ReadByte</span><span class="op" id="4743433">(</span><span class="op" id="4743434">)</span>&nbsp;<span class="op" id="4743436">(</span><span class="builtintype" id="4743437">byte</span><span class="op" id="4743441">,</span>&nbsp;<span class="builtintype" id="4743443">error</span><span class="op" id="4743448">)</span>&nbsp;<span class="op" id="4743450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743453">if</span>&nbsp;<span class="ident" id="4743456">d</span><span class="op" id="4743457">.</span><span class="ident" id="4743458">offset</span>&nbsp;<span class="op" id="4743465">&gt;=</span>&nbsp;<span class="builtinfunc" id="4743468">len</span><span class="op" id="4743471">(</span><span class="ident" id="4743472">d</span><span class="op" id="4743473">.</span><span class="ident" id="4743474">data</span><span class="op" id="4743478">)</span>&nbsp;<span class="op" id="4743480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743484">return</span>&nbsp;<span class="num" id="4743491">0</span><span class="op" id="4743492">,</span>&nbsp;<span class="ident" id="4743494">io</span><span class="op" id="4743496">.</span><span class="ident" id="4743497">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743502">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743505">c</span>&nbsp;<span class="op" id="4743507">:=</span>&nbsp;<span class="ident" id="4743510">d</span><span class="op" id="4743511">.</span><span class="ident" id="4743512">data</span><span class="op" id="4743516">[</span><span class="ident" id="4743517">d</span><span class="op" id="4743518">.</span><span class="ident" id="4743519">offset</span><span class="op" id="4743525">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743528">d</span><span class="op" id="4743529">.</span><span class="ident" id="4743530">offset</span><span class="op" id="4743536">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743540">return</span>&nbsp;<span class="ident" id="4743547">c</span><span class="op" id="4743548">,</span>&nbsp;<span class="ident" id="4743550">nil</span><br>
<span class="lineno"></span><span class="op" id="4743554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4743557">func</span>&nbsp;<span class="op" id="4743562">(</span><span class="ident" id="4743563">d</span>&nbsp;<span class="op" id="4743565">*</span><span class="ident" id="4743566">decBuffer</span><span class="op" id="4743575">)</span>&nbsp;<span class="ident" id="4743577">Len</span><span class="op" id="4743580">(</span><span class="op" id="4743581">)</span>&nbsp;<span class="builtintype" id="4743583">int</span>&nbsp;<span class="op" id="4743587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743590">return</span>&nbsp;<span class="builtinfunc" id="4743597">len</span><span class="op" id="4743600">(</span><span class="ident" id="4743601">d</span><span class="op" id="4743602">.</span><span class="ident" id="4743603">data</span><span class="op" id="4743607">)</span>&nbsp;<span class="op" id="4743609">-</span>&nbsp;<span class="ident" id="4743611">d</span><span class="op" id="4743612">.</span><span class="ident" id="4743613">offset</span><br>
<span class="lineno"></span><span class="op" id="4743620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4743623">func</span>&nbsp;<span class="op" id="4743628">(</span><span class="ident" id="4743629">d</span>&nbsp;<span class="op" id="4743631">*</span><span class="ident" id="4743632">decBuffer</span><span class="op" id="4743641">)</span>&nbsp;<span class="ident" id="4743643">Bytes</span><span class="op" id="4743648">(</span><span class="op" id="4743649">)</span>&nbsp;<span class="op" id="4743651">[</span><span class="op" id="4743652">]</span><span class="builtintype" id="4743653">byte</span>&nbsp;<span class="op" id="4743658">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743661">return</span>&nbsp;<span class="ident" id="4743668">d</span><span class="op" id="4743669">.</span><span class="ident" id="4743670">data</span><span class="op" id="4743674">[</span><span class="ident" id="4743675">d</span><span class="op" id="4743676">.</span><span class="ident" id="4743677">offset</span><span class="op" id="4743683">:</span><span class="op" id="4743684">]</span><br>
<span class="lineno"></span><span class="op" id="4743686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4743689">func</span>&nbsp;<span class="op" id="4743694">(</span><span class="ident" id="4743695">d</span>&nbsp;<span class="op" id="4743697">*</span><span class="ident" id="4743698">decBuffer</span><span class="op" id="4743707">)</span>&nbsp;<span class="ident" id="4743709">Reset</span><span class="op" id="4743714">(</span><span class="op" id="4743715">)</span>&nbsp;<span class="op" id="4743717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743720">d</span><span class="op" id="4743721">.</span><span class="ident" id="4743722">data</span>&nbsp;<span class="op" id="4743727">=</span>&nbsp;<span class="ident" id="4743729">d</span><span class="op" id="4743730">.</span><span class="ident" id="4743731">data</span><span class="op" id="4743735">[</span><span class="num" id="4743736">0</span><span class="op" id="4743737">:</span><span class="num" id="4743738">0</span><span class="op" id="4743739">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743742">d</span><span class="op" id="4743743">.</span><span class="ident" id="4743744">offset</span>&nbsp;<span class="op" id="4743751">=</span>&nbsp;<span class="num" id="4743753">0</span><br>
<span class="lineno"></span><span class="op" id="4743755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4743758">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="4743838">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="4743875">func</span>&nbsp;<span class="op" id="4743880">(</span><span class="ident" id="4743881">dec</span>&nbsp;<span class="op" id="4743885">*</span><span class="ident" id="4743886">Decoder</span><span class="op" id="4743893">)</span>&nbsp;<span class="ident" id="4743895">newDecoderState</span><span class="op" id="4743910">(</span><span class="ident" id="4743911">buf</span>&nbsp;<span class="op" id="4743915">*</span><span class="ident" id="4743916">decBuffer</span><span class="op" id="4743925">)</span>&nbsp;<span class="op" id="4743927">*</span><span class="ident" id="4743928">decoderState</span>&nbsp;<span class="op" id="4743941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743944">d</span>&nbsp;<span class="op" id="4743946">:=</span>&nbsp;<span class="ident" id="4743949">dec</span><span class="op" id="4743952">.</span><span class="ident" id="4743953">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743963">if</span>&nbsp;<span class="ident" id="4743966">d</span>&nbsp;<span class="op" id="4743968">==</span>&nbsp;<span class="ident" id="4743971">nil</span>&nbsp;<span class="op" id="4743975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743979">d</span>&nbsp;<span class="op" id="4743981">=</span>&nbsp;<span class="builtinfunc" id="4743983">new</span><span class="op" id="4743986">(</span><span class="ident" id="4743987">decoderState</span><span class="op" id="4743999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744003">d</span><span class="op" id="4744004">.</span><span class="ident" id="4744005">dec</span>&nbsp;<span class="op" id="4744009">=</span>&nbsp;<span class="ident" id="4744011">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744017">d</span><span class="op" id="4744018">.</span><span class="ident" id="4744019">buf</span>&nbsp;<span class="op" id="4744023">=</span>&nbsp;<span class="builtinfunc" id="4744025">make</span><span class="op" id="4744029">(</span><span class="op" id="4744030">[</span><span class="op" id="4744031">]</span><span class="builtintype" id="4744032">byte</span><span class="op" id="4744036">,</span>&nbsp;<span class="ident" id="4744038">uint64Size</span><span class="op" id="4744048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744051">}</span>&nbsp;<span class="keyword" id="4744053">else</span>&nbsp;<span class="op" id="4744058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744062">dec</span><span class="op" id="4744065">.</span><span class="ident" id="4744066">freeList</span>&nbsp;<span class="op" id="4744075">=</span>&nbsp;<span class="ident" id="4744077">d</span><span class="op" id="4744078">.</span><span class="ident" id="4744079">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744088">d</span><span class="op" id="4744089">.</span><span class="ident" id="4744090">b</span>&nbsp;<span class="op" id="4744092">=</span>&nbsp;<span class="ident" id="4744094">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744099">return</span>&nbsp;<span class="ident" id="4744106">d</span><br>
<span class="lineno"></span><span class="op" id="4744108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4744111">func</span>&nbsp;<span class="op" id="4744116">(</span><span class="ident" id="4744117">dec</span>&nbsp;<span class="op" id="4744121">*</span><span class="ident" id="4744122">Decoder</span><span class="op" id="4744129">)</span>&nbsp;<span class="ident" id="4744131">freeDecoderState</span><span class="op" id="4744147">(</span><span class="ident" id="4744148">d</span>&nbsp;<span class="op" id="4744150">*</span><span class="ident" id="4744151">decoderState</span><span class="op" id="4744163">)</span>&nbsp;<span class="op" id="4744165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744168">d</span><span class="op" id="4744169">.</span><span class="ident" id="4744170">next</span>&nbsp;<span class="op" id="4744175">=</span>&nbsp;<span class="ident" id="4744177">dec</span><span class="op" id="4744180">.</span><span class="ident" id="4744181">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744191">dec</span><span class="op" id="4744194">.</span><span class="ident" id="4744195">freeList</span>&nbsp;<span class="op" id="4744204">=</span>&nbsp;<span class="ident" id="4744206">d</span><br>
<span class="lineno"></span><span class="op" id="4744208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4744211">func</span>&nbsp;<span class="ident" id="4744216">overflow</span><span class="op" id="4744224">(</span><span class="ident" id="4744225">name</span>&nbsp;<span class="builtintype" id="4744230">string</span><span class="op" id="4744236">)</span>&nbsp;<span class="builtintype" id="4744238">error</span>&nbsp;<span class="op" id="4744244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744247">return</span>&nbsp;<span class="ident" id="4744254">errors</span><span class="op" id="4744260">.</span><span class="ident" id="4744261">New</span><span class="op" id="4744264">(</span><span class="string" id="4744265">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4744279">+</span>&nbsp;<span class="ident" id="4744281">name</span>&nbsp;<span class="op" id="4744286">+</span>&nbsp;<span class="string" id="4744288">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4744304">)</span><br>
<span class="lineno">115</span><span class="op" id="4744306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4744309">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4744382">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4744438">func</span>&nbsp;<span class="ident" id="4744443">decodeUintReader</span><span class="op" id="4744459">(</span><span class="ident" id="4744460">r</span>&nbsp;<span class="ident" id="4744462">io</span><span class="op" id="4744464">.</span><span class="ident" id="4744465">Reader</span><span class="op" id="4744471">,</span>&nbsp;<span class="ident" id="4744473">buf</span>&nbsp;<span class="op" id="4744477">[</span><span class="op" id="4744478">]</span><span class="builtintype" id="4744479">byte</span><span class="op" id="4744483">)</span>&nbsp;<span class="op" id="4744485">(</span><span class="ident" id="4744486">x</span>&nbsp;<span class="ident" id="4744488">uint64</span><span class="op" id="4744494">,</span>&nbsp;<span class="ident" id="4744496">width</span>&nbsp;<span class="builtintype" id="4744502">int</span><span class="op" id="4744505">,</span>&nbsp;<span class="ident" id="4744507">err</span>&nbsp;<span class="builtintype" id="4744511">error</span><span class="op" id="4744516">)</span>&nbsp;<span class="op" id="4744518">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744521">width</span>&nbsp;<span class="op" id="4744527">=</span>&nbsp;<span class="num" id="4744529">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744532">n</span><span class="op" id="4744533">,</span>&nbsp;<span class="ident" id="4744535">err</span>&nbsp;<span class="op" id="4744539">:=</span>&nbsp;<span class="ident" id="4744542">io</span><span class="op" id="4744544">.</span><span class="ident" id="4744545">ReadFull</span><span class="op" id="4744553">(</span><span class="ident" id="4744554">r</span><span class="op" id="4744555">,</span>&nbsp;<span class="ident" id="4744557">buf</span><span class="op" id="4744560">[</span><span class="num" id="4744561">0</span><span class="op" id="4744562">:</span><span class="ident" id="4744563">width</span><span class="op" id="4744568">]</span><span class="op" id="4744569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744572">if</span>&nbsp;<span class="ident" id="4744575">n</span>&nbsp;<span class="op" id="4744577">==</span>&nbsp;<span class="num" id="4744580">0</span>&nbsp;<span class="op" id="4744582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744586">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744594">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744597">b</span>&nbsp;<span class="op" id="4744599">:=</span>&nbsp;<span class="ident" id="4744602">buf</span><span class="op" id="4744605">[</span><span class="num" id="4744606">0</span><span class="op" id="4744607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744610">if</span>&nbsp;<span class="ident" id="4744613">b</span>&nbsp;<span class="op" id="4744615">&lt;=</span>&nbsp;<span class="num" id="4744618">0x7f</span>&nbsp;<span class="op" id="4744623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744627">return</span>&nbsp;<span class="ident" id="4744634">uint64</span><span class="op" id="4744640">(</span><span class="ident" id="4744641">b</span><span class="op" id="4744642">)</span><span class="op" id="4744643">,</span>&nbsp;<span class="ident" id="4744645">width</span><span class="op" id="4744650">,</span>&nbsp;<span class="ident" id="4744652">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744660">n</span>&nbsp;<span class="op" id="4744662">=</span>&nbsp;<span class="op" id="4744664">-</span><span class="builtintype" id="4744665">int</span><span class="op" id="4744668">(</span><span class="builtintype" id="4744669">int8</span><span class="op" id="4744673">(</span><span class="ident" id="4744674">b</span><span class="op" id="4744675">)</span><span class="op" id="4744676">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744679">if</span>&nbsp;<span class="ident" id="4744682">n</span>&nbsp;<span class="op" id="4744684">&gt;</span>&nbsp;<span class="ident" id="4744686">uint64Size</span>&nbsp;<span class="op" id="4744697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744701">err</span>&nbsp;<span class="op" id="4744705">=</span>&nbsp;<span class="ident" id="4744707">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744720">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744731">width</span><span class="op" id="4744736">,</span>&nbsp;<span class="ident" id="4744738">err</span>&nbsp;<span class="op" id="4744742">=</span>&nbsp;<span class="ident" id="4744744">io</span><span class="op" id="4744746">.</span><span class="ident" id="4744747">ReadFull</span><span class="op" id="4744755">(</span><span class="ident" id="4744756">r</span><span class="op" id="4744757">,</span>&nbsp;<span class="ident" id="4744759">buf</span><span class="op" id="4744762">[</span><span class="num" id="4744763">0</span><span class="op" id="4744764">:</span><span class="ident" id="4744765">n</span><span class="op" id="4744766">]</span><span class="op" id="4744767">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744770">if</span>&nbsp;<span class="ident" id="4744773">err</span>&nbsp;<span class="op" id="4744777">!=</span>&nbsp;<span class="ident" id="4744780">nil</span>&nbsp;<span class="op" id="4744784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744788">if</span>&nbsp;<span class="ident" id="4744791">err</span>&nbsp;<span class="op" id="4744795">==</span>&nbsp;<span class="ident" id="4744798">io</span><span class="op" id="4744800">.</span><span class="ident" id="4744801">EOF</span>&nbsp;<span class="op" id="4744805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744810">err</span>&nbsp;<span class="op" id="4744814">=</span>&nbsp;<span class="ident" id="4744816">io</span><span class="op" id="4744818">.</span><span class="ident" id="4744819">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744842">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4744853">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744919">for</span>&nbsp;<span class="ident" id="4744923">_</span><span class="op" id="4744924">,</span>&nbsp;<span class="ident" id="4744926">b</span>&nbsp;<span class="op" id="4744928">:=</span>&nbsp;<span class="keyword" id="4744931">range</span>&nbsp;<span class="ident" id="4744937">buf</span><span class="op" id="4744940">[</span><span class="num" id="4744941">0</span><span class="op" id="4744942">:</span><span class="ident" id="4744943">width</span><span class="op" id="4744948">]</span>&nbsp;<span class="op" id="4744950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744954">x</span>&nbsp;<span class="op" id="4744956">=</span>&nbsp;<span class="ident" id="4744958">x</span><span class="op" id="4744959">&lt;&lt;</span><span class="num" id="4744961">8</span>&nbsp;<span class="op" id="4744963">|</span>&nbsp;<span class="ident" id="4744965">uint64</span><span class="op" id="4744971">(</span><span class="ident" id="4744972">b</span><span class="op" id="4744973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744976">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744979">width</span><span class="op" id="4744984">++</span>&nbsp;<span class="comment" id="4744987">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745010">return</span><br>
<span class="lineno"></span><span class="op" id="4745017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4745020">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="4745082">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4745114">func</span>&nbsp;<span class="op" id="4745119">(</span><span class="ident" id="4745120">state</span>&nbsp;<span class="op" id="4745126">*</span><span class="ident" id="4745127">decoderState</span><span class="op" id="4745139">)</span>&nbsp;<span class="ident" id="4745141">decodeUint</span><span class="op" id="4745151">(</span><span class="op" id="4745152">)</span>&nbsp;<span class="op" id="4745154">(</span><span class="ident" id="4745155">x</span>&nbsp;<span class="ident" id="4745157">uint64</span><span class="op" id="4745163">)</span>&nbsp;<span class="op" id="4745165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745168">b</span><span class="op" id="4745169">,</span>&nbsp;<span class="ident" id="4745171">err</span>&nbsp;<span class="op" id="4745175">:=</span>&nbsp;<span class="ident" id="4745178">state</span><span class="op" id="4745183">.</span><span class="ident" id="4745184">b</span><span class="op" id="4745185">.</span><span class="ident" id="4745186">ReadByte</span><span class="op" id="4745194">(</span><span class="op" id="4745195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745198">if</span>&nbsp;<span class="ident" id="4745201">err</span>&nbsp;<span class="op" id="4745205">!=</span>&nbsp;<span class="ident" id="4745208">nil</span>&nbsp;<span class="op" id="4745212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745216">error_</span><span class="op" id="4745222">(</span><span class="ident" id="4745223">err</span><span class="op" id="4745226">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745232">if</span>&nbsp;<span class="ident" id="4745235">b</span>&nbsp;<span class="op" id="4745237">&lt;=</span>&nbsp;<span class="num" id="4745240">0x7f</span>&nbsp;<span class="op" id="4745245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745249">return</span>&nbsp;<span class="ident" id="4745256">uint64</span><span class="op" id="4745262">(</span><span class="ident" id="4745263">b</span><span class="op" id="4745264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745270">n</span>&nbsp;<span class="op" id="4745272">:=</span>&nbsp;<span class="op" id="4745275">-</span><span class="builtintype" id="4745276">int</span><span class="op" id="4745279">(</span><span class="builtintype" id="4745280">int8</span><span class="op" id="4745284">(</span><span class="ident" id="4745285">b</span><span class="op" id="4745286">)</span><span class="op" id="4745287">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745290">if</span>&nbsp;<span class="ident" id="4745293">n</span>&nbsp;<span class="op" id="4745295">&gt;</span>&nbsp;<span class="ident" id="4745297">uint64Size</span>&nbsp;<span class="op" id="4745308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745312">error_</span><span class="op" id="4745318">(</span><span class="ident" id="4745319">errBadUint</span><span class="op" id="4745329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745335">width</span><span class="op" id="4745340">,</span>&nbsp;<span class="ident" id="4745342">err</span>&nbsp;<span class="op" id="4745346">:=</span>&nbsp;<span class="ident" id="4745349">state</span><span class="op" id="4745354">.</span><span class="ident" id="4745355">b</span><span class="op" id="4745356">.</span><span class="ident" id="4745357">Read</span><span class="op" id="4745361">(</span><span class="ident" id="4745362">state</span><span class="op" id="4745367">.</span><span class="ident" id="4745368">buf</span><span class="op" id="4745371">[</span><span class="num" id="4745372">0</span><span class="op" id="4745373">:</span><span class="ident" id="4745374">n</span><span class="op" id="4745375">]</span><span class="op" id="4745376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745379">if</span>&nbsp;<span class="ident" id="4745382">err</span>&nbsp;<span class="op" id="4745386">!=</span>&nbsp;<span class="ident" id="4745389">nil</span>&nbsp;<span class="op" id="4745393">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745397">error_</span><span class="op" id="4745403">(</span><span class="ident" id="4745404">err</span><span class="op" id="4745407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4745413">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4745474">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745540">for</span>&nbsp;<span class="ident" id="4745544">_</span><span class="op" id="4745545">,</span>&nbsp;<span class="ident" id="4745547">b</span>&nbsp;<span class="op" id="4745549">:=</span>&nbsp;<span class="keyword" id="4745552">range</span>&nbsp;<span class="ident" id="4745558">state</span><span class="op" id="4745563">.</span><span class="ident" id="4745564">buf</span><span class="op" id="4745567">[</span><span class="num" id="4745568">0</span><span class="op" id="4745569">:</span><span class="ident" id="4745570">width</span><span class="op" id="4745575">]</span>&nbsp;<span class="op" id="4745577">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745581">x</span>&nbsp;<span class="op" id="4745583">=</span>&nbsp;<span class="ident" id="4745585">x</span><span class="op" id="4745586">&lt;&lt;</span><span class="num" id="4745588">8</span>&nbsp;<span class="op" id="4745590">|</span>&nbsp;<span class="ident" id="4745592">uint64</span><span class="op" id="4745598">(</span><span class="ident" id="4745599">b</span><span class="op" id="4745600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745606">return</span>&nbsp;<span class="ident" id="4745613">x</span><br>
<span class="lineno"></span><span class="op" id="4745615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4745618">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="4745677">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4745709">func</span>&nbsp;<span class="op" id="4745714">(</span><span class="ident" id="4745715">state</span>&nbsp;<span class="op" id="4745721">*</span><span class="ident" id="4745722">decoderState</span><span class="op" id="4745734">)</span>&nbsp;<span class="ident" id="4745736">decodeInt</span><span class="op" id="4745745">(</span><span class="op" id="4745746">)</span>&nbsp;<span class="ident" id="4745748">int64</span>&nbsp;<span class="op" id="4745754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745757">x</span>&nbsp;<span class="op" id="4745759">:=</span>&nbsp;<span class="ident" id="4745762">state</span><span class="op" id="4745767">.</span><span class="ident" id="4745768">decodeUint</span><span class="op" id="4745778">(</span><span class="op" id="4745779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745782">if</span>&nbsp;<span class="ident" id="4745785">x</span><span class="op" id="4745786">&amp;</span><span class="num" id="4745787">1</span>&nbsp;<span class="op" id="4745789">!=</span>&nbsp;<span class="num" id="4745792">0</span>&nbsp;<span class="op" id="4745794">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745798">return</span>&nbsp;<span class="op" id="4745805">^</span><span class="ident" id="4745806">int64</span><span class="op" id="4745811">(</span><span class="ident" id="4745812">x</span>&nbsp;<span class="op" id="4745814">&gt;&gt;</span>&nbsp;<span class="num" id="4745817">1</span><span class="op" id="4745818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745824">return</span>&nbsp;<span class="ident" id="4745831">int64</span><span class="op" id="4745836">(</span><span class="ident" id="4745837">x</span>&nbsp;<span class="op" id="4745839">&gt;&gt;</span>&nbsp;<span class="num" id="4745842">1</span><span class="op" id="4745843">)</span><br>
<span class="lineno"></span><span class="op" id="4745845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4745848">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4745915">type</span>&nbsp;<span class="ident" id="4745920">decOp</span>&nbsp;<span class="keyword" id="4745926">func</span><span class="op" id="4745930">(</span><span class="ident" id="4745931">i</span>&nbsp;<span class="op" id="4745933">*</span><span class="ident" id="4745934">decInstr</span><span class="op" id="4745942">,</span>&nbsp;<span class="ident" id="4745944">state</span>&nbsp;<span class="op" id="4745950">*</span><span class="ident" id="4745951">decoderState</span><span class="op" id="4745963">,</span>&nbsp;<span class="ident" id="4745965">v</span>&nbsp;<span class="ident" id="4745967">reflect</span><span class="op" id="4745974">.</span><span class="ident" id="4745975">Value</span><span class="op" id="4745980">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4745983">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="4746029">type</span>&nbsp;<span class="ident" id="4746034">decInstr</span>&nbsp;<span class="keyword" id="4746043">struct</span>&nbsp;<span class="op" id="4746050">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746053">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746059">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746066">field</span>&nbsp;<span class="builtintype" id="4746072">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4746078">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746112">index</span>&nbsp;<span class="op" id="4746118">[</span><span class="op" id="4746119">]</span><span class="builtintype" id="4746120">int</span>&nbsp;<span class="comment" id="4746124">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746170">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="4746176">error</span>&nbsp;<span class="comment" id="4746182">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="4746252">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4746255">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4746312">func</span>&nbsp;<span class="ident" id="4746317">ignoreUint</span><span class="op" id="4746327">(</span><span class="ident" id="4746328">i</span>&nbsp;<span class="op" id="4746330">*</span><span class="ident" id="4746331">decInstr</span><span class="op" id="4746339">,</span>&nbsp;<span class="ident" id="4746341">state</span>&nbsp;<span class="op" id="4746347">*</span><span class="ident" id="4746348">decoderState</span><span class="op" id="4746360">,</span>&nbsp;<span class="ident" id="4746362">v</span>&nbsp;<span class="ident" id="4746364">reflect</span><span class="op" id="4746371">.</span><span class="ident" id="4746372">Value</span><span class="op" id="4746377">)</span>&nbsp;<span class="op" id="4746379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746382">state</span><span class="op" id="4746387">.</span><span class="ident" id="4746388">decodeUint</span><span class="op" id="4746398">(</span><span class="op" id="4746399">)</span><br>
<span class="lineno"></span><span class="op" id="4746401">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4746404">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4746483">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4746502">func</span>&nbsp;<span class="ident" id="4746507">ignoreTwoUints</span><span class="op" id="4746521">(</span><span class="ident" id="4746522">i</span>&nbsp;<span class="op" id="4746524">*</span><span class="ident" id="4746525">decInstr</span><span class="op" id="4746533">,</span>&nbsp;<span class="ident" id="4746535">state</span>&nbsp;<span class="op" id="4746541">*</span><span class="ident" id="4746542">decoderState</span><span class="op" id="4746554">,</span>&nbsp;<span class="ident" id="4746556">v</span>&nbsp;<span class="ident" id="4746558">reflect</span><span class="op" id="4746565">.</span><span class="ident" id="4746566">Value</span><span class="op" id="4746571">)</span>&nbsp;<span class="op" id="4746573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746576">state</span><span class="op" id="4746581">.</span><span class="ident" id="4746582">decodeUint</span><span class="op" id="4746592">(</span><span class="op" id="4746593">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746596">state</span><span class="op" id="4746601">.</span><span class="ident" id="4746602">decodeUint</span><span class="op" id="4746612">(</span><span class="op" id="4746613">)</span><br>
<span class="lineno"></span><span class="op" id="4746615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4746618">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4746690">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="4746763">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="4746807">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4746879">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4746958">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4746971">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4747035">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="4747123">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="4747201">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4747246">func</span>&nbsp;<span class="ident" id="4747251">decAlloc</span><span class="op" id="4747259">(</span><span class="ident" id="4747260">v</span>&nbsp;<span class="ident" id="4747262">reflect</span><span class="op" id="4747269">.</span><span class="ident" id="4747270">Value</span><span class="op" id="4747275">)</span>&nbsp;<span class="ident" id="4747277">reflect</span><span class="op" id="4747284">.</span><span class="ident" id="4747285">Value</span>&nbsp;<span class="op" id="4747291">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747294">for</span>&nbsp;<span class="ident" id="4747298">v</span><span class="op" id="4747299">.</span><span class="ident" id="4747300">Kind</span><span class="op" id="4747304">(</span><span class="op" id="4747305">)</span>&nbsp;<span class="op" id="4747307">==</span>&nbsp;<span class="ident" id="4747310">reflect</span><span class="op" id="4747317">.</span><span class="ident" id="4747318">Ptr</span>&nbsp;<span class="op" id="4747322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747326">if</span>&nbsp;<span class="ident" id="4747329">v</span><span class="op" id="4747330">.</span><span class="ident" id="4747331">IsNil</span><span class="op" id="4747336">(</span><span class="op" id="4747337">)</span>&nbsp;<span class="op" id="4747339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747344">v</span><span class="op" id="4747345">.</span><span class="ident" id="4747346">Set</span><span class="op" id="4747349">(</span><span class="ident" id="4747350">reflect</span><span class="op" id="4747357">.</span><span class="ident" id="4747358">New</span><span class="op" id="4747361">(</span><span class="ident" id="4747362">v</span><span class="op" id="4747363">.</span><span class="ident" id="4747364">Type</span><span class="op" id="4747368">(</span><span class="op" id="4747369">)</span><span class="op" id="4747370">.</span><span class="ident" id="4747371">Elem</span><span class="op" id="4747375">(</span><span class="op" id="4747376">)</span><span class="op" id="4747377">)</span><span class="op" id="4747378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747386">v</span>&nbsp;<span class="op" id="4747388">=</span>&nbsp;<span class="ident" id="4747390">v</span><span class="op" id="4747391">.</span><span class="ident" id="4747392">Elem</span><span class="op" id="4747396">(</span><span class="op" id="4747397">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747403">return</span>&nbsp;<span class="ident" id="4747410">v</span><br>
<span class="lineno"></span><span class="op" id="4747412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4747415">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="4747478">func</span>&nbsp;<span class="ident" id="4747483">decBool</span><span class="op" id="4747490">(</span><span class="ident" id="4747491">i</span>&nbsp;<span class="op" id="4747493">*</span><span class="ident" id="4747494">decInstr</span><span class="op" id="4747502">,</span>&nbsp;<span class="ident" id="4747504">state</span>&nbsp;<span class="op" id="4747510">*</span><span class="ident" id="4747511">decoderState</span><span class="op" id="4747523">,</span>&nbsp;<span class="ident" id="4747525">value</span>&nbsp;<span class="ident" id="4747531">reflect</span><span class="op" id="4747538">.</span><span class="ident" id="4747539">Value</span><span class="op" id="4747544">)</span>&nbsp;<span class="op" id="4747546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747549">value</span><span class="op" id="4747554">.</span><span class="ident" id="4747555">SetBool</span><span class="op" id="4747562">(</span><span class="ident" id="4747563">state</span><span class="op" id="4747568">.</span><span class="ident" id="4747569">decodeUint</span><span class="op" id="4747579">(</span><span class="op" id="4747580">)</span>&nbsp;<span class="op" id="4747582">!=</span>&nbsp;<span class="num" id="4747585">0</span><span class="op" id="4747586">)</span><br>
<span class="lineno"></span><span class="op" id="4747588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4747591">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="4747656">func</span>&nbsp;<span class="ident" id="4747661">decInt8</span><span class="op" id="4747668">(</span><span class="ident" id="4747669">i</span>&nbsp;<span class="op" id="4747671">*</span><span class="ident" id="4747672">decInstr</span><span class="op" id="4747680">,</span>&nbsp;<span class="ident" id="4747682">state</span>&nbsp;<span class="op" id="4747688">*</span><span class="ident" id="4747689">decoderState</span><span class="op" id="4747701">,</span>&nbsp;<span class="ident" id="4747703">value</span>&nbsp;<span class="ident" id="4747709">reflect</span><span class="op" id="4747716">.</span><span class="ident" id="4747717">Value</span><span class="op" id="4747722">)</span>&nbsp;<span class="op" id="4747724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747727">v</span>&nbsp;<span class="op" id="4747729">:=</span>&nbsp;<span class="ident" id="4747732">state</span><span class="op" id="4747737">.</span><span class="ident" id="4747738">decodeInt</span><span class="op" id="4747747">(</span><span class="op" id="4747748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747751">if</span>&nbsp;<span class="ident" id="4747754">v</span>&nbsp;<span class="op" id="4747756">&lt;</span>&nbsp;<span class="ident" id="4747758">math</span><span class="op" id="4747762">.</span><span class="ident" id="4747763">MinInt8</span>&nbsp;<span class="op" id="4747771">||</span>&nbsp;<span class="ident" id="4747774">math</span><span class="op" id="4747778">.</span><span class="ident" id="4747779">MaxInt8</span>&nbsp;<span class="op" id="4747787">&lt;</span>&nbsp;<span class="ident" id="4747789">v</span>&nbsp;<span class="op" id="4747791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747795">error_</span><span class="op" id="4747801">(</span><span class="ident" id="4747802">i</span><span class="op" id="4747803">.</span><span class="ident" id="4747804">ovfl</span><span class="op" id="4747808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747811">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747814">value</span><span class="op" id="4747819">.</span><span class="ident" id="4747820">SetInt</span><span class="op" id="4747826">(</span><span class="ident" id="4747827">v</span><span class="op" id="4747828">)</span><br>
<span class="lineno"></span><span class="op" id="4747830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4747833">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4747908">func</span>&nbsp;<span class="ident" id="4747913">decUint8</span><span class="op" id="4747921">(</span><span class="ident" id="4747922">i</span>&nbsp;<span class="op" id="4747924">*</span><span class="ident" id="4747925">decInstr</span><span class="op" id="4747933">,</span>&nbsp;<span class="ident" id="4747935">state</span>&nbsp;<span class="op" id="4747941">*</span><span class="ident" id="4747942">decoderState</span><span class="op" id="4747954">,</span>&nbsp;<span class="ident" id="4747956">value</span>&nbsp;<span class="ident" id="4747962">reflect</span><span class="op" id="4747969">.</span><span class="ident" id="4747970">Value</span><span class="op" id="4747975">)</span>&nbsp;<span class="op" id="4747977">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747980">v</span>&nbsp;<span class="op" id="4747982">:=</span>&nbsp;<span class="ident" id="4747985">state</span><span class="op" id="4747990">.</span><span class="ident" id="4747991">decodeUint</span><span class="op" id="4748001">(</span><span class="op" id="4748002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748005">if</span>&nbsp;<span class="ident" id="4748008">math</span><span class="op" id="4748012">.</span><span class="ident" id="4748013">MaxUint8</span>&nbsp;<span class="op" id="4748022">&lt;</span>&nbsp;<span class="ident" id="4748024">v</span>&nbsp;<span class="op" id="4748026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748030">error_</span><span class="op" id="4748036">(</span><span class="ident" id="4748037">i</span><span class="op" id="4748038">.</span><span class="ident" id="4748039">ovfl</span><span class="op" id="4748043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748049">value</span><span class="op" id="4748054">.</span><span class="ident" id="4748055">SetUint</span><span class="op" id="4748062">(</span><span class="ident" id="4748063">v</span><span class="op" id="4748064">)</span><br>
<span class="lineno">250</span><span class="op" id="4748066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4748069">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4748136">func</span>&nbsp;<span class="ident" id="4748141">decInt16</span><span class="op" id="4748149">(</span><span class="ident" id="4748150">i</span>&nbsp;<span class="op" id="4748152">*</span><span class="ident" id="4748153">decInstr</span><span class="op" id="4748161">,</span>&nbsp;<span class="ident" id="4748163">state</span>&nbsp;<span class="op" id="4748169">*</span><span class="ident" id="4748170">decoderState</span><span class="op" id="4748182">,</span>&nbsp;<span class="ident" id="4748184">value</span>&nbsp;<span class="ident" id="4748190">reflect</span><span class="op" id="4748197">.</span><span class="ident" id="4748198">Value</span><span class="op" id="4748203">)</span>&nbsp;<span class="op" id="4748205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748208">v</span>&nbsp;<span class="op" id="4748210">:=</span>&nbsp;<span class="ident" id="4748213">state</span><span class="op" id="4748218">.</span><span class="ident" id="4748219">decodeInt</span><span class="op" id="4748228">(</span><span class="op" id="4748229">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748232">if</span>&nbsp;<span class="ident" id="4748235">v</span>&nbsp;<span class="op" id="4748237">&lt;</span>&nbsp;<span class="ident" id="4748239">math</span><span class="op" id="4748243">.</span><span class="ident" id="4748244">MinInt16</span>&nbsp;<span class="op" id="4748253">||</span>&nbsp;<span class="ident" id="4748256">math</span><span class="op" id="4748260">.</span><span class="ident" id="4748261">MaxInt16</span>&nbsp;<span class="op" id="4748270">&lt;</span>&nbsp;<span class="ident" id="4748272">v</span>&nbsp;<span class="op" id="4748274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748278">error_</span><span class="op" id="4748284">(</span><span class="ident" id="4748285">i</span><span class="op" id="4748286">.</span><span class="ident" id="4748287">ovfl</span><span class="op" id="4748291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748297">value</span><span class="op" id="4748302">.</span><span class="ident" id="4748303">SetInt</span><span class="op" id="4748309">(</span><span class="ident" id="4748310">v</span><span class="op" id="4748311">)</span><br>
<span class="lineno"></span><span class="op" id="4748313">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4748316">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4748393">func</span>&nbsp;<span class="ident" id="4748398">decUint16</span><span class="op" id="4748407">(</span><span class="ident" id="4748408">i</span>&nbsp;<span class="op" id="4748410">*</span><span class="ident" id="4748411">decInstr</span><span class="op" id="4748419">,</span>&nbsp;<span class="ident" id="4748421">state</span>&nbsp;<span class="op" id="4748427">*</span><span class="ident" id="4748428">decoderState</span><span class="op" id="4748440">,</span>&nbsp;<span class="ident" id="4748442">value</span>&nbsp;<span class="ident" id="4748448">reflect</span><span class="op" id="4748455">.</span><span class="ident" id="4748456">Value</span><span class="op" id="4748461">)</span>&nbsp;<span class="op" id="4748463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748466">v</span>&nbsp;<span class="op" id="4748468">:=</span>&nbsp;<span class="ident" id="4748471">state</span><span class="op" id="4748476">.</span><span class="ident" id="4748477">decodeUint</span><span class="op" id="4748487">(</span><span class="op" id="4748488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748491">if</span>&nbsp;<span class="ident" id="4748494">math</span><span class="op" id="4748498">.</span><span class="ident" id="4748499">MaxUint16</span>&nbsp;<span class="op" id="4748509">&lt;</span>&nbsp;<span class="ident" id="4748511">v</span>&nbsp;<span class="op" id="4748513">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748517">error_</span><span class="op" id="4748523">(</span><span class="ident" id="4748524">i</span><span class="op" id="4748525">.</span><span class="ident" id="4748526">ovfl</span><span class="op" id="4748530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748536">value</span><span class="op" id="4748541">.</span><span class="ident" id="4748542">SetUint</span><span class="op" id="4748549">(</span><span class="ident" id="4748550">v</span><span class="op" id="4748551">)</span><br>
<span class="lineno"></span><span class="op" id="4748553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4748556">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4748623">func</span>&nbsp;<span class="ident" id="4748628">decInt32</span><span class="op" id="4748636">(</span><span class="ident" id="4748637">i</span>&nbsp;<span class="op" id="4748639">*</span><span class="ident" id="4748640">decInstr</span><span class="op" id="4748648">,</span>&nbsp;<span class="ident" id="4748650">state</span>&nbsp;<span class="op" id="4748656">*</span><span class="ident" id="4748657">decoderState</span><span class="op" id="4748669">,</span>&nbsp;<span class="ident" id="4748671">value</span>&nbsp;<span class="ident" id="4748677">reflect</span><span class="op" id="4748684">.</span><span class="ident" id="4748685">Value</span><span class="op" id="4748690">)</span>&nbsp;<span class="op" id="4748692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748695">v</span>&nbsp;<span class="op" id="4748697">:=</span>&nbsp;<span class="ident" id="4748700">state</span><span class="op" id="4748705">.</span><span class="ident" id="4748706">decodeInt</span><span class="op" id="4748715">(</span><span class="op" id="4748716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748719">if</span>&nbsp;<span class="ident" id="4748722">v</span>&nbsp;<span class="op" id="4748724">&lt;</span>&nbsp;<span class="ident" id="4748726">math</span><span class="op" id="4748730">.</span><span class="ident" id="4748731">MinInt32</span>&nbsp;<span class="op" id="4748740">||</span>&nbsp;<span class="ident" id="4748743">math</span><span class="op" id="4748747">.</span><span class="ident" id="4748748">MaxInt32</span>&nbsp;<span class="op" id="4748757">&lt;</span>&nbsp;<span class="ident" id="4748759">v</span>&nbsp;<span class="op" id="4748761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748765">error_</span><span class="op" id="4748771">(</span><span class="ident" id="4748772">i</span><span class="op" id="4748773">.</span><span class="ident" id="4748774">ovfl</span><span class="op" id="4748778">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748784">value</span><span class="op" id="4748789">.</span><span class="ident" id="4748790">SetInt</span><span class="op" id="4748796">(</span><span class="ident" id="4748797">v</span><span class="op" id="4748798">)</span><br>
<span class="lineno"></span><span class="op" id="4748800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4748803">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="4748880">func</span>&nbsp;<span class="ident" id="4748885">decUint32</span><span class="op" id="4748894">(</span><span class="ident" id="4748895">i</span>&nbsp;<span class="op" id="4748897">*</span><span class="ident" id="4748898">decInstr</span><span class="op" id="4748906">,</span>&nbsp;<span class="ident" id="4748908">state</span>&nbsp;<span class="op" id="4748914">*</span><span class="ident" id="4748915">decoderState</span><span class="op" id="4748927">,</span>&nbsp;<span class="ident" id="4748929">value</span>&nbsp;<span class="ident" id="4748935">reflect</span><span class="op" id="4748942">.</span><span class="ident" id="4748943">Value</span><span class="op" id="4748948">)</span>&nbsp;<span class="op" id="4748950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748953">v</span>&nbsp;<span class="op" id="4748955">:=</span>&nbsp;<span class="ident" id="4748958">state</span><span class="op" id="4748963">.</span><span class="ident" id="4748964">decodeUint</span><span class="op" id="4748974">(</span><span class="op" id="4748975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748978">if</span>&nbsp;<span class="ident" id="4748981">math</span><span class="op" id="4748985">.</span><span class="ident" id="4748986">MaxUint32</span>&nbsp;<span class="op" id="4748996">&lt;</span>&nbsp;<span class="ident" id="4748998">v</span>&nbsp;<span class="op" id="4749000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749004">error_</span><span class="op" id="4749010">(</span><span class="ident" id="4749011">i</span><span class="op" id="4749012">.</span><span class="ident" id="4749013">ovfl</span><span class="op" id="4749017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749020">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749023">value</span><span class="op" id="4749028">.</span><span class="ident" id="4749029">SetUint</span><span class="op" id="4749036">(</span><span class="ident" id="4749037">v</span><span class="op" id="4749038">)</span><br>
<span class="lineno"></span><span class="op" id="4749040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4749043">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4749110">func</span>&nbsp;<span class="ident" id="4749115">decInt64</span><span class="op" id="4749123">(</span><span class="ident" id="4749124">i</span>&nbsp;<span class="op" id="4749126">*</span><span class="ident" id="4749127">decInstr</span><span class="op" id="4749135">,</span>&nbsp;<span class="ident" id="4749137">state</span>&nbsp;<span class="op" id="4749143">*</span><span class="ident" id="4749144">decoderState</span><span class="op" id="4749156">,</span>&nbsp;<span class="ident" id="4749158">value</span>&nbsp;<span class="ident" id="4749164">reflect</span><span class="op" id="4749171">.</span><span class="ident" id="4749172">Value</span><span class="op" id="4749177">)</span>&nbsp;<span class="op" id="4749179">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749182">v</span>&nbsp;<span class="op" id="4749184">:=</span>&nbsp;<span class="ident" id="4749187">state</span><span class="op" id="4749192">.</span><span class="ident" id="4749193">decodeInt</span><span class="op" id="4749202">(</span><span class="op" id="4749203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749206">value</span><span class="op" id="4749211">.</span><span class="ident" id="4749212">SetInt</span><span class="op" id="4749218">(</span><span class="ident" id="4749219">v</span><span class="op" id="4749220">)</span><br>
<span class="lineno"></span><span class="op" id="4749222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4749225">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="4749302">func</span>&nbsp;<span class="ident" id="4749307">decUint64</span><span class="op" id="4749316">(</span><span class="ident" id="4749317">i</span>&nbsp;<span class="op" id="4749319">*</span><span class="ident" id="4749320">decInstr</span><span class="op" id="4749328">,</span>&nbsp;<span class="ident" id="4749330">state</span>&nbsp;<span class="op" id="4749336">*</span><span class="ident" id="4749337">decoderState</span><span class="op" id="4749349">,</span>&nbsp;<span class="ident" id="4749351">value</span>&nbsp;<span class="ident" id="4749357">reflect</span><span class="op" id="4749364">.</span><span class="ident" id="4749365">Value</span><span class="op" id="4749370">)</span>&nbsp;<span class="op" id="4749372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749375">v</span>&nbsp;<span class="op" id="4749377">:=</span>&nbsp;<span class="ident" id="4749380">state</span><span class="op" id="4749385">.</span><span class="ident" id="4749386">decodeUint</span><span class="op" id="4749396">(</span><span class="op" id="4749397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749400">value</span><span class="op" id="4749405">.</span><span class="ident" id="4749406">SetUint</span><span class="op" id="4749413">(</span><span class="ident" id="4749414">v</span><span class="op" id="4749415">)</span><br>
<span class="lineno"></span><span class="op" id="4749417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4749420">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4749490">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4749562">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="4749634">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4749699">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="4749715">func</span>&nbsp;<span class="ident" id="4749720">float64FromBits</span><span class="op" id="4749735">(</span><span class="ident" id="4749736">u</span>&nbsp;<span class="ident" id="4749738">uint64</span><span class="op" id="4749744">)</span>&nbsp;<span class="builtintype" id="4749746">float64</span>&nbsp;<span class="op" id="4749754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749757">var</span>&nbsp;<span class="ident" id="4749761">v</span>&nbsp;<span class="ident" id="4749763">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749771">for</span>&nbsp;<span class="ident" id="4749775">i</span>&nbsp;<span class="op" id="4749777">:=</span>&nbsp;<span class="num" id="4749780">0</span><span class="op" id="4749781">;</span>&nbsp;<span class="ident" id="4749783">i</span>&nbsp;<span class="op" id="4749785">&lt;</span>&nbsp;<span class="num" id="4749787">8</span><span class="op" id="4749788">;</span>&nbsp;<span class="ident" id="4749790">i</span><span class="op" id="4749791">++</span>&nbsp;<span class="op" id="4749794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749798">v</span>&nbsp;<span class="op" id="4749800">&lt;&lt;=</span>&nbsp;<span class="num" id="4749804">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749808">v</span>&nbsp;<span class="op" id="4749810">|=</span>&nbsp;<span class="ident" id="4749813">u</span>&nbsp;<span class="op" id="4749815">&amp;</span>&nbsp;<span class="num" id="4749817">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749824">u</span>&nbsp;<span class="op" id="4749826">&gt;&gt;=</span>&nbsp;<span class="num" id="4749830">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749836">return</span>&nbsp;<span class="ident" id="4749843">math</span><span class="op" id="4749847">.</span><span class="ident" id="4749848">Float64frombits</span><span class="op" id="4749863">(</span><span class="ident" id="4749864">v</span><span class="op" id="4749865">)</span><br>
<span class="lineno"></span><span class="op" id="4749867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4749870">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4749955">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="4750032">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4750109">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="4750172">func</span>&nbsp;<span class="ident" id="4750177">float32FromBits</span><span class="op" id="4750192">(</span><span class="ident" id="4750193">u</span>&nbsp;<span class="ident" id="4750195">uint64</span><span class="op" id="4750201">,</span>&nbsp;<span class="ident" id="4750203">ovfl</span>&nbsp;<span class="builtintype" id="4750208">error</span><span class="op" id="4750213">)</span>&nbsp;<span class="builtintype" id="4750215">float64</span>&nbsp;<span class="op" id="4750223">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750226">v</span>&nbsp;<span class="op" id="4750228">:=</span>&nbsp;<span class="ident" id="4750231">float64FromBits</span><span class="op" id="4750246">(</span><span class="ident" id="4750247">u</span><span class="op" id="4750248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750251">av</span>&nbsp;<span class="op" id="4750254">:=</span>&nbsp;<span class="ident" id="4750257">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750260">if</span>&nbsp;<span class="ident" id="4750263">av</span>&nbsp;<span class="op" id="4750266">&lt;</span>&nbsp;<span class="num" id="4750268">0</span>&nbsp;<span class="op" id="4750270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750274">av</span>&nbsp;<span class="op" id="4750277">=</span>&nbsp;<span class="op" id="4750279">-</span><span class="ident" id="4750280">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750284">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4750287">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750358">if</span>&nbsp;<span class="ident" id="4750361">math</span><span class="op" id="4750365">.</span><span class="ident" id="4750366">MaxFloat32</span>&nbsp;<span class="op" id="4750377">&lt;</span>&nbsp;<span class="ident" id="4750379">av</span>&nbsp;<span class="op" id="4750382">&amp;&amp;</span>&nbsp;<span class="ident" id="4750385">av</span>&nbsp;<span class="op" id="4750388">&lt;=</span>&nbsp;<span class="ident" id="4750391">math</span><span class="op" id="4750395">.</span><span class="ident" id="4750396">MaxFloat64</span>&nbsp;<span class="op" id="4750407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750411">error_</span><span class="op" id="4750417">(</span><span class="ident" id="4750418">ovfl</span><span class="op" id="4750422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750428">return</span>&nbsp;<span class="ident" id="4750435">v</span><br>
<span class="lineno">330</span><span class="op" id="4750437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4750440">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4750520">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4750555">func</span>&nbsp;<span class="ident" id="4750560">decFloat32</span><span class="op" id="4750570">(</span><span class="ident" id="4750571">i</span>&nbsp;<span class="op" id="4750573">*</span><span class="ident" id="4750574">decInstr</span><span class="op" id="4750582">,</span>&nbsp;<span class="ident" id="4750584">state</span>&nbsp;<span class="op" id="4750590">*</span><span class="ident" id="4750591">decoderState</span><span class="op" id="4750603">,</span>&nbsp;<span class="ident" id="4750605">value</span>&nbsp;<span class="ident" id="4750611">reflect</span><span class="op" id="4750618">.</span><span class="ident" id="4750619">Value</span><span class="op" id="4750624">)</span>&nbsp;<span class="op" id="4750626">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750629">value</span><span class="op" id="4750634">.</span><span class="ident" id="4750635">SetFloat</span><span class="op" id="4750643">(</span><span class="ident" id="4750644">float32FromBits</span><span class="op" id="4750659">(</span><span class="ident" id="4750660">state</span><span class="op" id="4750665">.</span><span class="ident" id="4750666">decodeUint</span><span class="op" id="4750676">(</span><span class="op" id="4750677">)</span><span class="op" id="4750678">,</span>&nbsp;<span class="ident" id="4750680">i</span><span class="op" id="4750681">.</span><span class="ident" id="4750682">ovfl</span><span class="op" id="4750686">)</span><span class="op" id="4750687">)</span><br>
<span class="lineno"></span><span class="op" id="4750689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4750692">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4750772">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="4750807">func</span>&nbsp;<span class="ident" id="4750812">decFloat64</span><span class="op" id="4750822">(</span><span class="ident" id="4750823">i</span>&nbsp;<span class="op" id="4750825">*</span><span class="ident" id="4750826">decInstr</span><span class="op" id="4750834">,</span>&nbsp;<span class="ident" id="4750836">state</span>&nbsp;<span class="op" id="4750842">*</span><span class="ident" id="4750843">decoderState</span><span class="op" id="4750855">,</span>&nbsp;<span class="ident" id="4750857">value</span>&nbsp;<span class="ident" id="4750863">reflect</span><span class="op" id="4750870">.</span><span class="ident" id="4750871">Value</span><span class="op" id="4750876">)</span>&nbsp;<span class="op" id="4750878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750881">value</span><span class="op" id="4750886">.</span><span class="ident" id="4750887">SetFloat</span><span class="op" id="4750895">(</span><span class="ident" id="4750896">float64FromBits</span><span class="op" id="4750911">(</span><span class="ident" id="4750912">state</span><span class="op" id="4750917">.</span><span class="ident" id="4750918">decodeUint</span><span class="op" id="4750928">(</span><span class="op" id="4750929">)</span><span class="op" id="4750930">)</span><span class="op" id="4750931">)</span><br>
<span class="lineno"></span><span class="op" id="4750933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4750936">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="4751006">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4751082">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4751112">func</span>&nbsp;<span class="ident" id="4751117">decComplex64</span><span class="op" id="4751129">(</span><span class="ident" id="4751130">i</span>&nbsp;<span class="op" id="4751132">*</span><span class="ident" id="4751133">decInstr</span><span class="op" id="4751141">,</span>&nbsp;<span class="ident" id="4751143">state</span>&nbsp;<span class="op" id="4751149">*</span><span class="ident" id="4751150">decoderState</span><span class="op" id="4751162">,</span>&nbsp;<span class="ident" id="4751164">value</span>&nbsp;<span class="ident" id="4751170">reflect</span><span class="op" id="4751177">.</span><span class="ident" id="4751178">Value</span><span class="op" id="4751183">)</span>&nbsp;<span class="op" id="4751185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4751188">real</span>&nbsp;<span class="op" id="4751193">:=</span>&nbsp;<span class="ident" id="4751196">float32FromBits</span><span class="op" id="4751211">(</span><span class="ident" id="4751212">state</span><span class="op" id="4751217">.</span><span class="ident" id="4751218">decodeUint</span><span class="op" id="4751228">(</span><span class="op" id="4751229">)</span><span class="op" id="4751230">,</span>&nbsp;<span class="ident" id="4751232">i</span><span class="op" id="4751233">.</span><span class="ident" id="4751234">ovfl</span><span class="op" id="4751238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4751241">imag</span>&nbsp;<span class="op" id="4751246">:=</span>&nbsp;<span class="ident" id="4751249">float32FromBits</span><span class="op" id="4751264">(</span><span class="ident" id="4751265">state</span><span class="op" id="4751270">.</span><span class="ident" id="4751271">decodeUint</span><span class="op" id="4751281">(</span><span class="op" id="4751282">)</span><span class="op" id="4751283">,</span>&nbsp;<span class="ident" id="4751285">i</span><span class="op" id="4751286">.</span><span class="ident" id="4751287">ovfl</span><span class="op" id="4751291">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751294">value</span><span class="op" id="4751299">.</span><span class="ident" id="4751300">SetComplex</span><span class="op" id="4751310">(</span><span class="builtinfunc" id="4751311">complex</span><span class="op" id="4751318">(</span><span class="builtinfunc" id="4751319">real</span><span class="op" id="4751323">,</span>&nbsp;<span class="builtinfunc" id="4751325">imag</span><span class="op" id="4751329">)</span><span class="op" id="4751330">)</span><br>
<span class="lineno"></span><span class="op" id="4751332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4751335">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4751406">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="4751483">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4751513">func</span>&nbsp;<span class="ident" id="4751518">decComplex128</span><span class="op" id="4751531">(</span><span class="ident" id="4751532">i</span>&nbsp;<span class="op" id="4751534">*</span><span class="ident" id="4751535">decInstr</span><span class="op" id="4751543">,</span>&nbsp;<span class="ident" id="4751545">state</span>&nbsp;<span class="op" id="4751551">*</span><span class="ident" id="4751552">decoderState</span><span class="op" id="4751564">,</span>&nbsp;<span class="ident" id="4751566">value</span>&nbsp;<span class="ident" id="4751572">reflect</span><span class="op" id="4751579">.</span><span class="ident" id="4751580">Value</span><span class="op" id="4751585">)</span>&nbsp;<span class="op" id="4751587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4751590">real</span>&nbsp;<span class="op" id="4751595">:=</span>&nbsp;<span class="ident" id="4751598">float64FromBits</span><span class="op" id="4751613">(</span><span class="ident" id="4751614">state</span><span class="op" id="4751619">.</span><span class="ident" id="4751620">decodeUint</span><span class="op" id="4751630">(</span><span class="op" id="4751631">)</span><span class="op" id="4751632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4751635">imag</span>&nbsp;<span class="op" id="4751640">:=</span>&nbsp;<span class="ident" id="4751643">float64FromBits</span><span class="op" id="4751658">(</span><span class="ident" id="4751659">state</span><span class="op" id="4751664">.</span><span class="ident" id="4751665">decodeUint</span><span class="op" id="4751675">(</span><span class="op" id="4751676">)</span><span class="op" id="4751677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751680">value</span><span class="op" id="4751685">.</span><span class="ident" id="4751686">SetComplex</span><span class="op" id="4751696">(</span><span class="builtinfunc" id="4751697">complex</span><span class="op" id="4751704">(</span><span class="builtinfunc" id="4751705">real</span><span class="op" id="4751709">,</span>&nbsp;<span class="builtinfunc" id="4751711">imag</span><span class="op" id="4751715">)</span><span class="op" id="4751716">)</span><br>
<span class="lineno">360</span><span class="op" id="4751718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4751721">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4751794">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4751818">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="4751894">func</span>&nbsp;<span class="ident" id="4751899">decUint8Slice</span><span class="op" id="4751912">(</span><span class="ident" id="4751913">i</span>&nbsp;<span class="op" id="4751915">*</span><span class="ident" id="4751916">decInstr</span><span class="op" id="4751924">,</span>&nbsp;<span class="ident" id="4751926">state</span>&nbsp;<span class="op" id="4751932">*</span><span class="ident" id="4751933">decoderState</span><span class="op" id="4751945">,</span>&nbsp;<span class="ident" id="4751947">value</span>&nbsp;<span class="ident" id="4751953">reflect</span><span class="op" id="4751960">.</span><span class="ident" id="4751961">Value</span><span class="op" id="4751966">)</span>&nbsp;<span class="op" id="4751968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751971">u</span>&nbsp;<span class="op" id="4751973">:=</span>&nbsp;<span class="ident" id="4751976">state</span><span class="op" id="4751981">.</span><span class="ident" id="4751982">decodeUint</span><span class="op" id="4751992">(</span><span class="op" id="4751993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751996">n</span>&nbsp;<span class="op" id="4751998">:=</span>&nbsp;<span class="builtintype" id="4752001">int</span><span class="op" id="4752004">(</span><span class="ident" id="4752005">u</span><span class="op" id="4752006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752009">if</span>&nbsp;<span class="ident" id="4752012">n</span>&nbsp;<span class="op" id="4752014">&lt;</span>&nbsp;<span class="num" id="4752016">0</span>&nbsp;<span class="op" id="4752018">||</span>&nbsp;<span class="ident" id="4752021">uint64</span><span class="op" id="4752027">(</span><span class="ident" id="4752028">n</span><span class="op" id="4752029">)</span>&nbsp;<span class="op" id="4752031">!=</span>&nbsp;<span class="ident" id="4752034">u</span>&nbsp;<span class="op" id="4752036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752040">errorf</span><span class="op" id="4752046">(</span><span class="string" id="4752047">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4752091">,</span>&nbsp;<span class="ident" id="4752093">value</span><span class="op" id="4752098">.</span><span class="ident" id="4752099">Type</span><span class="op" id="4752103">(</span><span class="op" id="4752104">)</span><span class="op" id="4752105">,</span>&nbsp;<span class="ident" id="4752107">u</span><span class="op" id="4752108">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752114">if</span>&nbsp;<span class="ident" id="4752117">n</span>&nbsp;<span class="op" id="4752119">&gt;</span>&nbsp;<span class="ident" id="4752121">state</span><span class="op" id="4752126">.</span><span class="ident" id="4752127">b</span><span class="op" id="4752128">.</span><span class="ident" id="4752129">Len</span><span class="op" id="4752132">(</span><span class="op" id="4752133">)</span>&nbsp;<span class="op" id="4752135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752139">errorf</span><span class="op" id="4752145">(</span><span class="string" id="4752146">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4752179">,</span>&nbsp;<span class="ident" id="4752181">value</span><span class="op" id="4752186">.</span><span class="ident" id="4752187">Type</span><span class="op" id="4752191">(</span><span class="op" id="4752192">)</span><span class="op" id="4752193">,</span>&nbsp;<span class="ident" id="4752195">n</span><span class="op" id="4752196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752202">if</span>&nbsp;<span class="ident" id="4752205">n</span>&nbsp;<span class="op" id="4752207">&gt;</span>&nbsp;<span class="ident" id="4752209">tooBig</span>&nbsp;<span class="op" id="4752216">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752220">errorf</span><span class="op" id="4752226">(</span><span class="string" id="4752227">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="4752251">,</span>&nbsp;<span class="ident" id="4752253">n</span><span class="op" id="4752254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752260">if</span>&nbsp;<span class="ident" id="4752263">value</span><span class="op" id="4752268">.</span><span class="ident" id="4752269">Cap</span><span class="op" id="4752272">(</span><span class="op" id="4752273">)</span>&nbsp;<span class="op" id="4752275">&lt;</span>&nbsp;<span class="ident" id="4752277">n</span>&nbsp;<span class="op" id="4752279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752283">value</span><span class="op" id="4752288">.</span><span class="ident" id="4752289">Set</span><span class="op" id="4752292">(</span><span class="ident" id="4752293">reflect</span><span class="op" id="4752300">.</span><span class="ident" id="4752301">MakeSlice</span><span class="op" id="4752310">(</span><span class="ident" id="4752311">value</span><span class="op" id="4752316">.</span><span class="ident" id="4752317">Type</span><span class="op" id="4752321">(</span><span class="op" id="4752322">)</span><span class="op" id="4752323">,</span>&nbsp;<span class="ident" id="4752325">n</span><span class="op" id="4752326">,</span>&nbsp;<span class="ident" id="4752328">n</span><span class="op" id="4752329">)</span><span class="op" id="4752330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752333">}</span>&nbsp;<span class="keyword" id="4752335">else</span>&nbsp;<span class="op" id="4752340">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752344">value</span><span class="op" id="4752349">.</span><span class="ident" id="4752350">Set</span><span class="op" id="4752353">(</span><span class="ident" id="4752354">value</span><span class="op" id="4752359">.</span><span class="ident" id="4752360">Slice</span><span class="op" id="4752365">(</span><span class="num" id="4752366">0</span><span class="op" id="4752367">,</span>&nbsp;<span class="ident" id="4752369">n</span><span class="op" id="4752370">)</span><span class="op" id="4752371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752377">if</span>&nbsp;<span class="ident" id="4752380">_</span><span class="op" id="4752381">,</span>&nbsp;<span class="ident" id="4752383">err</span>&nbsp;<span class="op" id="4752387">:=</span>&nbsp;<span class="ident" id="4752390">state</span><span class="op" id="4752395">.</span><span class="ident" id="4752396">b</span><span class="op" id="4752397">.</span><span class="ident" id="4752398">Read</span><span class="op" id="4752402">(</span><span class="ident" id="4752403">value</span><span class="op" id="4752408">.</span><span class="ident" id="4752409">Bytes</span><span class="op" id="4752414">(</span><span class="op" id="4752415">)</span><span class="op" id="4752416">)</span><span class="op" id="4752417">;</span>&nbsp;<span class="ident" id="4752419">err</span>&nbsp;<span class="op" id="4752423">!=</span>&nbsp;<span class="ident" id="4752426">nil</span>&nbsp;<span class="op" id="4752430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752434">errorf</span><span class="op" id="4752440">(</span><span class="string" id="4752441">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="4752468">,</span>&nbsp;<span class="ident" id="4752470">err</span><span class="op" id="4752473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752476">}</span><br>
<span class="lineno">385</span><span class="op" id="4752478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4752481">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4752549">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4752573">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="4752644">func</span>&nbsp;<span class="ident" id="4752649">decString</span><span class="op" id="4752658">(</span><span class="ident" id="4752659">i</span>&nbsp;<span class="op" id="4752661">*</span><span class="ident" id="4752662">decInstr</span><span class="op" id="4752670">,</span>&nbsp;<span class="ident" id="4752672">state</span>&nbsp;<span class="op" id="4752678">*</span><span class="ident" id="4752679">decoderState</span><span class="op" id="4752691">,</span>&nbsp;<span class="ident" id="4752693">value</span>&nbsp;<span class="ident" id="4752699">reflect</span><span class="op" id="4752706">.</span><span class="ident" id="4752707">Value</span><span class="op" id="4752712">)</span>&nbsp;<span class="op" id="4752714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752717">u</span>&nbsp;<span class="op" id="4752719">:=</span>&nbsp;<span class="ident" id="4752722">state</span><span class="op" id="4752727">.</span><span class="ident" id="4752728">decodeUint</span><span class="op" id="4752738">(</span><span class="op" id="4752739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752742">n</span>&nbsp;<span class="op" id="4752744">:=</span>&nbsp;<span class="builtintype" id="4752747">int</span><span class="op" id="4752750">(</span><span class="ident" id="4752751">u</span><span class="op" id="4752752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752755">if</span>&nbsp;<span class="ident" id="4752758">n</span>&nbsp;<span class="op" id="4752760">&lt;</span>&nbsp;<span class="num" id="4752762">0</span>&nbsp;<span class="op" id="4752764">||</span>&nbsp;<span class="ident" id="4752767">uint64</span><span class="op" id="4752773">(</span><span class="ident" id="4752774">n</span><span class="op" id="4752775">)</span>&nbsp;<span class="op" id="4752777">!=</span>&nbsp;<span class="ident" id="4752780">u</span>&nbsp;<span class="op" id="4752782">||</span>&nbsp;<span class="ident" id="4752785">n</span>&nbsp;<span class="op" id="4752787">&gt;</span>&nbsp;<span class="ident" id="4752789">state</span><span class="op" id="4752794">.</span><span class="ident" id="4752795">b</span><span class="op" id="4752796">.</span><span class="ident" id="4752797">Len</span><span class="op" id="4752800">(</span><span class="op" id="4752801">)</span>&nbsp;<span class="op" id="4752803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752807">errorf</span><span class="op" id="4752813">(</span><span class="string" id="4752814">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4752858">,</span>&nbsp;<span class="ident" id="4752860">value</span><span class="op" id="4752865">.</span><span class="ident" id="4752866">Type</span><span class="op" id="4752870">(</span><span class="op" id="4752871">)</span><span class="op" id="4752872">,</span>&nbsp;<span class="ident" id="4752874">u</span><span class="op" id="4752875">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752881">if</span>&nbsp;<span class="ident" id="4752884">n</span>&nbsp;<span class="op" id="4752886">&gt;</span>&nbsp;<span class="ident" id="4752888">state</span><span class="op" id="4752893">.</span><span class="ident" id="4752894">b</span><span class="op" id="4752895">.</span><span class="ident" id="4752896">Len</span><span class="op" id="4752899">(</span><span class="op" id="4752900">)</span>&nbsp;<span class="op" id="4752902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752906">errorf</span><span class="op" id="4752912">(</span><span class="string" id="4752913">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4752946">,</span>&nbsp;<span class="ident" id="4752948">value</span><span class="op" id="4752953">.</span><span class="ident" id="4752954">Type</span><span class="op" id="4752958">(</span><span class="op" id="4752959">)</span><span class="op" id="4752960">,</span>&nbsp;<span class="ident" id="4752962">n</span><span class="op" id="4752963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4752969">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752988">data</span>&nbsp;<span class="op" id="4752993">:=</span>&nbsp;<span class="builtinfunc" id="4752996">make</span><span class="op" id="4753000">(</span><span class="op" id="4753001">[</span><span class="op" id="4753002">]</span><span class="builtintype" id="4753003">byte</span><span class="op" id="4753007">,</span>&nbsp;<span class="ident" id="4753009">n</span><span class="op" id="4753010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753013">if</span>&nbsp;<span class="ident" id="4753016">_</span><span class="op" id="4753017">,</span>&nbsp;<span class="ident" id="4753019">err</span>&nbsp;<span class="op" id="4753023">:=</span>&nbsp;<span class="ident" id="4753026">state</span><span class="op" id="4753031">.</span><span class="ident" id="4753032">b</span><span class="op" id="4753033">.</span><span class="ident" id="4753034">Read</span><span class="op" id="4753038">(</span><span class="ident" id="4753039">data</span><span class="op" id="4753043">)</span><span class="op" id="4753044">;</span>&nbsp;<span class="ident" id="4753046">err</span>&nbsp;<span class="op" id="4753050">!=</span>&nbsp;<span class="ident" id="4753053">nil</span>&nbsp;<span class="op" id="4753057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753061">errorf</span><span class="op" id="4753067">(</span><span class="string" id="4753068">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="4753095">,</span>&nbsp;<span class="ident" id="4753097">err</span><span class="op" id="4753100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4753103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753106">value</span><span class="op" id="4753111">.</span><span class="ident" id="4753112">SetString</span><span class="op" id="4753121">(</span><span class="builtintype" id="4753122">string</span><span class="op" id="4753128">(</span><span class="ident" id="4753129">data</span><span class="op" id="4753133">)</span><span class="op" id="4753134">)</span><br>
<span class="lineno">405</span><span class="op" id="4753136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4753139">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4753223">func</span>&nbsp;<span class="ident" id="4753228">ignoreUint8Array</span><span class="op" id="4753244">(</span><span class="ident" id="4753245">i</span>&nbsp;<span class="op" id="4753247">*</span><span class="ident" id="4753248">decInstr</span><span class="op" id="4753256">,</span>&nbsp;<span class="ident" id="4753258">state</span>&nbsp;<span class="op" id="4753264">*</span><span class="ident" id="4753265">decoderState</span><span class="op" id="4753277">,</span>&nbsp;<span class="ident" id="4753279">value</span>&nbsp;<span class="ident" id="4753285">reflect</span><span class="op" id="4753292">.</span><span class="ident" id="4753293">Value</span><span class="op" id="4753298">)</span>&nbsp;<span class="op" id="4753300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753303">b</span>&nbsp;<span class="op" id="4753305">:=</span>&nbsp;<span class="builtinfunc" id="4753308">make</span><span class="op" id="4753312">(</span><span class="op" id="4753313">[</span><span class="op" id="4753314">]</span><span class="builtintype" id="4753315">byte</span><span class="op" id="4753319">,</span>&nbsp;<span class="ident" id="4753321">state</span><span class="op" id="4753326">.</span><span class="ident" id="4753327">decodeUint</span><span class="op" id="4753337">(</span><span class="op" id="4753338">)</span><span class="op" id="4753339">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753342">state</span><span class="op" id="4753347">.</span><span class="ident" id="4753348">b</span><span class="op" id="4753349">.</span><span class="ident" id="4753350">Read</span><span class="op" id="4753354">(</span><span class="ident" id="4753355">b</span><span class="op" id="4753356">)</span><br>
<span class="lineno"></span><span class="op" id="4753358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4753361">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4753382">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4753472">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="4753546">type</span>&nbsp;<span class="ident" id="4753551">decEngine</span>&nbsp;<span class="keyword" id="4753561">struct</span>&nbsp;<span class="op" id="4753568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753571">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4753580">[</span><span class="op" id="4753581">]</span><span class="ident" id="4753582">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753592">numInstr</span>&nbsp;<span class="builtintype" id="4753601">int</span>&nbsp;<span class="comment" id="4753605">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="4753642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4753645">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4753732">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4753811">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="4753868">func</span>&nbsp;<span class="op" id="4753873">(</span><span class="ident" id="4753874">dec</span>&nbsp;<span class="op" id="4753878">*</span><span class="ident" id="4753879">Decoder</span><span class="op" id="4753886">)</span>&nbsp;<span class="ident" id="4753888">decodeSingle</span><span class="op" id="4753900">(</span><span class="ident" id="4753901">engine</span>&nbsp;<span class="op" id="4753908">*</span><span class="ident" id="4753909">decEngine</span><span class="op" id="4753918">,</span>&nbsp;<span class="ident" id="4753920">ut</span>&nbsp;<span class="op" id="4753923">*</span><span class="ident" id="4753924">userTypeInfo</span><span class="op" id="4753936">,</span>&nbsp;<span class="ident" id="4753938">value</span>&nbsp;<span class="ident" id="4753944">reflect</span><span class="op" id="4753951">.</span><span class="ident" id="4753952">Value</span><span class="op" id="4753957">)</span>&nbsp;<span class="op" id="4753959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753962">state</span>&nbsp;<span class="op" id="4753968">:=</span>&nbsp;<span class="ident" id="4753971">dec</span><span class="op" id="4753974">.</span><span class="ident" id="4753975">newDecoderState</span><span class="op" id="4753990">(</span><span class="op" id="4753991">&amp;</span><span class="ident" id="4753992">dec</span><span class="op" id="4753995">.</span><span class="ident" id="4753996">buf</span><span class="op" id="4753999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754002">defer</span>&nbsp;<span class="ident" id="4754008">dec</span><span class="op" id="4754011">.</span><span class="ident" id="4754012">freeDecoderState</span><span class="op" id="4754028">(</span><span class="ident" id="4754029">state</span><span class="op" id="4754034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754037">state</span><span class="op" id="4754042">.</span><span class="ident" id="4754043">fieldnum</span>&nbsp;<span class="op" id="4754052">=</span>&nbsp;<span class="ident" id="4754054">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754070">if</span>&nbsp;<span class="ident" id="4754073">state</span><span class="op" id="4754078">.</span><span class="ident" id="4754079">decodeUint</span><span class="op" id="4754089">(</span><span class="op" id="4754090">)</span>&nbsp;<span class="op" id="4754092">!=</span>&nbsp;<span class="num" id="4754095">0</span>&nbsp;<span class="op" id="4754097">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754101">errorf</span><span class="op" id="4754107">(</span><span class="string" id="4754108">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4754162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4754165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754168">instr</span>&nbsp;<span class="op" id="4754174">:=</span>&nbsp;<span class="op" id="4754177">&amp;</span><span class="ident" id="4754178">engine</span><span class="op" id="4754184">.</span><span class="ident" id="4754185">instr</span><span class="op" id="4754190">[</span><span class="ident" id="4754191">singletonField</span><span class="op" id="4754205">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754208">instr</span><span class="op" id="4754213">.</span><span class="ident" id="4754214">op</span><span class="op" id="4754216">(</span><span class="ident" id="4754217">instr</span><span class="op" id="4754222">,</span>&nbsp;<span class="ident" id="4754224">state</span><span class="op" id="4754229">,</span>&nbsp;<span class="ident" id="4754231">value</span><span class="op" id="4754236">)</span><br>
<span class="lineno"></span><span class="op" id="4754238">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="4754241">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4754308">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="4754381">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="4754452">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="4754522">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="4754583">func</span>&nbsp;<span class="op" id="4754588">(</span><span class="ident" id="4754589">dec</span>&nbsp;<span class="op" id="4754593">*</span><span class="ident" id="4754594">Decoder</span><span class="op" id="4754601">)</span>&nbsp;<span class="ident" id="4754603">decodeStruct</span><span class="op" id="4754615">(</span><span class="ident" id="4754616">engine</span>&nbsp;<span class="op" id="4754623">*</span><span class="ident" id="4754624">decEngine</span><span class="op" id="4754633">,</span>&nbsp;<span class="ident" id="4754635">ut</span>&nbsp;<span class="op" id="4754638">*</span><span class="ident" id="4754639">userTypeInfo</span><span class="op" id="4754651">,</span>&nbsp;<span class="ident" id="4754653">value</span>&nbsp;<span class="ident" id="4754659">reflect</span><span class="op" id="4754666">.</span><span class="ident" id="4754667">Value</span><span class="op" id="4754672">)</span>&nbsp;<span class="op" id="4754674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754677">state</span>&nbsp;<span class="op" id="4754683">:=</span>&nbsp;<span class="ident" id="4754686">dec</span><span class="op" id="4754689">.</span><span class="ident" id="4754690">newDecoderState</span><span class="op" id="4754705">(</span><span class="op" id="4754706">&amp;</span><span class="ident" id="4754707">dec</span><span class="op" id="4754710">.</span><span class="ident" id="4754711">buf</span><span class="op" id="4754714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754717">defer</span>&nbsp;<span class="ident" id="4754723">dec</span><span class="op" id="4754726">.</span><span class="ident" id="4754727">freeDecoderState</span><span class="op" id="4754743">(</span><span class="ident" id="4754744">state</span><span class="op" id="4754749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754752">state</span><span class="op" id="4754757">.</span><span class="ident" id="4754758">fieldnum</span>&nbsp;<span class="op" id="4754767">=</span>&nbsp;<span class="op" id="4754769">-</span><span class="num" id="4754770">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754773">for</span>&nbsp;<span class="ident" id="4754777">state</span><span class="op" id="4754782">.</span><span class="ident" id="4754783">b</span><span class="op" id="4754784">.</span><span class="ident" id="4754785">Len</span><span class="op" id="4754788">(</span><span class="op" id="4754789">)</span>&nbsp;<span class="op" id="4754791">&gt;</span>&nbsp;<span class="num" id="4754793">0</span>&nbsp;<span class="op" id="4754795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754799">delta</span>&nbsp;<span class="op" id="4754805">:=</span>&nbsp;<span class="builtintype" id="4754808">int</span><span class="op" id="4754811">(</span><span class="ident" id="4754812">state</span><span class="op" id="4754817">.</span><span class="ident" id="4754818">decodeUint</span><span class="op" id="4754828">(</span><span class="op" id="4754829">)</span><span class="op" id="4754830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754834">if</span>&nbsp;<span class="ident" id="4754837">delta</span>&nbsp;<span class="op" id="4754843">&lt;</span>&nbsp;<span class="num" id="4754845">0</span>&nbsp;<span class="op" id="4754847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754852">errorf</span><span class="op" id="4754858">(</span><span class="string" id="4754859">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4754899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4754903">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754907">if</span>&nbsp;<span class="ident" id="4754910">delta</span>&nbsp;<span class="op" id="4754916">==</span>&nbsp;<span class="num" id="4754919">0</span>&nbsp;<span class="op" id="4754921">{</span>&nbsp;<span class="comment" id="4754923">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754970">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4754978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754982">fieldnum</span>&nbsp;<span class="op" id="4754991">:=</span>&nbsp;<span class="ident" id="4754994">state</span><span class="op" id="4754999">.</span><span class="ident" id="4755000">fieldnum</span>&nbsp;<span class="op" id="4755009">+</span>&nbsp;<span class="ident" id="4755011">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755019">if</span>&nbsp;<span class="ident" id="4755022">fieldnum</span>&nbsp;<span class="op" id="4755031">&gt;=</span>&nbsp;<span class="builtinfunc" id="4755034">len</span><span class="op" id="4755037">(</span><span class="ident" id="4755038">engine</span><span class="op" id="4755044">.</span><span class="ident" id="4755045">instr</span><span class="op" id="4755050">)</span>&nbsp;<span class="op" id="4755052">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755057">error_</span><span class="op" id="4755063">(</span><span class="ident" id="4755064">errRange</span><span class="op" id="4755072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755077">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755089">instr</span>&nbsp;<span class="op" id="4755095">:=</span>&nbsp;<span class="op" id="4755098">&amp;</span><span class="ident" id="4755099">engine</span><span class="op" id="4755105">.</span><span class="ident" id="4755106">instr</span><span class="op" id="4755111">[</span><span class="ident" id="4755112">fieldnum</span><span class="op" id="4755120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755124">var</span>&nbsp;<span class="ident" id="4755128">field</span>&nbsp;<span class="ident" id="4755134">reflect</span><span class="op" id="4755141">.</span><span class="ident" id="4755142">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755150">if</span>&nbsp;<span class="ident" id="4755153">instr</span><span class="op" id="4755158">.</span><span class="ident" id="4755159">index</span>&nbsp;<span class="op" id="4755165">!=</span>&nbsp;<span class="ident" id="4755168">nil</span>&nbsp;<span class="op" id="4755172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4755177">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755250">field</span>&nbsp;<span class="op" id="4755256">=</span>&nbsp;<span class="ident" id="4755258">value</span><span class="op" id="4755263">.</span><span class="ident" id="4755264">FieldByIndex</span><span class="op" id="4755276">(</span><span class="ident" id="4755277">instr</span><span class="op" id="4755282">.</span><span class="ident" id="4755283">index</span><span class="op" id="4755288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755293">if</span>&nbsp;<span class="ident" id="4755296">field</span><span class="op" id="4755301">.</span><span class="ident" id="4755302">Kind</span><span class="op" id="4755306">(</span><span class="op" id="4755307">)</span>&nbsp;<span class="op" id="4755309">==</span>&nbsp;<span class="ident" id="4755312">reflect</span><span class="op" id="4755319">.</span><span class="ident" id="4755320">Ptr</span>&nbsp;<span class="op" id="4755324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755330">field</span>&nbsp;<span class="op" id="4755336">=</span>&nbsp;<span class="ident" id="4755338">decAlloc</span><span class="op" id="4755346">(</span><span class="ident" id="4755347">field</span><span class="op" id="4755352">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755365">instr</span><span class="op" id="4755370">.</span><span class="ident" id="4755371">op</span><span class="op" id="4755373">(</span><span class="ident" id="4755374">instr</span><span class="op" id="4755379">,</span>&nbsp;<span class="ident" id="4755381">state</span><span class="op" id="4755386">,</span>&nbsp;<span class="ident" id="4755388">field</span><span class="op" id="4755393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755397">state</span><span class="op" id="4755402">.</span><span class="ident" id="4755403">fieldnum</span>&nbsp;<span class="op" id="4755412">=</span>&nbsp;<span class="ident" id="4755414">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755424">}</span><br>
<span class="lineno">470</span><span class="op" id="4755426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4755429">var</span>&nbsp;<span class="ident" id="4755433">noValue</span>&nbsp;<span class="ident" id="4755441">reflect</span><span class="op" id="4755448">.</span><span class="ident" id="4755449">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4755456">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="4755524">func</span>&nbsp;<span class="op" id="4755529">(</span><span class="ident" id="4755530">dec</span>&nbsp;<span class="op" id="4755534">*</span><span class="ident" id="4755535">Decoder</span><span class="op" id="4755542">)</span>&nbsp;<span class="ident" id="4755544">ignoreStruct</span><span class="op" id="4755556">(</span><span class="ident" id="4755557">engine</span>&nbsp;<span class="op" id="4755564">*</span><span class="ident" id="4755565">decEngine</span><span class="op" id="4755574">)</span>&nbsp;<span class="op" id="4755576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755579">state</span>&nbsp;<span class="op" id="4755585">:=</span>&nbsp;<span class="ident" id="4755588">dec</span><span class="op" id="4755591">.</span><span class="ident" id="4755592">newDecoderState</span><span class="op" id="4755607">(</span><span class="op" id="4755608">&amp;</span><span class="ident" id="4755609">dec</span><span class="op" id="4755612">.</span><span class="ident" id="4755613">buf</span><span class="op" id="4755616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755619">defer</span>&nbsp;<span class="ident" id="4755625">dec</span><span class="op" id="4755628">.</span><span class="ident" id="4755629">freeDecoderState</span><span class="op" id="4755645">(</span><span class="ident" id="4755646">state</span><span class="op" id="4755651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755654">state</span><span class="op" id="4755659">.</span><span class="ident" id="4755660">fieldnum</span>&nbsp;<span class="op" id="4755669">=</span>&nbsp;<span class="op" id="4755671">-</span><span class="num" id="4755672">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755675">for</span>&nbsp;<span class="ident" id="4755679">state</span><span class="op" id="4755684">.</span><span class="ident" id="4755685">b</span><span class="op" id="4755686">.</span><span class="ident" id="4755687">Len</span><span class="op" id="4755690">(</span><span class="op" id="4755691">)</span>&nbsp;<span class="op" id="4755693">&gt;</span>&nbsp;<span class="num" id="4755695">0</span>&nbsp;<span class="op" id="4755697">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755701">delta</span>&nbsp;<span class="op" id="4755707">:=</span>&nbsp;<span class="builtintype" id="4755710">int</span><span class="op" id="4755713">(</span><span class="ident" id="4755714">state</span><span class="op" id="4755719">.</span><span class="ident" id="4755720">decodeUint</span><span class="op" id="4755730">(</span><span class="op" id="4755731">)</span><span class="op" id="4755732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755736">if</span>&nbsp;<span class="ident" id="4755739">delta</span>&nbsp;<span class="op" id="4755745">&lt;</span>&nbsp;<span class="num" id="4755747">0</span>&nbsp;<span class="op" id="4755749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755754">errorf</span><span class="op" id="4755760">(</span><span class="string" id="4755761">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4755808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755816">if</span>&nbsp;<span class="ident" id="4755819">delta</span>&nbsp;<span class="op" id="4755825">==</span>&nbsp;<span class="num" id="4755828">0</span>&nbsp;<span class="op" id="4755830">{</span>&nbsp;<span class="comment" id="4755832">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755879">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755891">fieldnum</span>&nbsp;<span class="op" id="4755900">:=</span>&nbsp;<span class="ident" id="4755903">state</span><span class="op" id="4755908">.</span><span class="ident" id="4755909">fieldnum</span>&nbsp;<span class="op" id="4755918">+</span>&nbsp;<span class="ident" id="4755920">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755928">if</span>&nbsp;<span class="ident" id="4755931">fieldnum</span>&nbsp;<span class="op" id="4755940">&gt;=</span>&nbsp;<span class="builtinfunc" id="4755943">len</span><span class="op" id="4755946">(</span><span class="ident" id="4755947">engine</span><span class="op" id="4755953">.</span><span class="ident" id="4755954">instr</span><span class="op" id="4755959">)</span>&nbsp;<span class="op" id="4755961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755966">error_</span><span class="op" id="4755972">(</span><span class="ident" id="4755973">errRange</span><span class="op" id="4755981">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755989">instr</span>&nbsp;<span class="op" id="4755995">:=</span>&nbsp;<span class="op" id="4755998">&amp;</span><span class="ident" id="4755999">engine</span><span class="op" id="4756005">.</span><span class="ident" id="4756006">instr</span><span class="op" id="4756011">[</span><span class="ident" id="4756012">fieldnum</span><span class="op" id="4756020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756024">instr</span><span class="op" id="4756029">.</span><span class="ident" id="4756030">op</span><span class="op" id="4756032">(</span><span class="ident" id="4756033">instr</span><span class="op" id="4756038">,</span>&nbsp;<span class="ident" id="4756040">state</span><span class="op" id="4756045">,</span>&nbsp;<span class="ident" id="4756047">noValue</span><span class="op" id="4756054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756058">state</span><span class="op" id="4756063">.</span><span class="ident" id="4756064">fieldnum</span>&nbsp;<span class="op" id="4756073">=</span>&nbsp;<span class="ident" id="4756075">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4756085">}</span><br>
<span class="lineno">495</span><span class="op" id="4756087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4756090">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4756165">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4756229">func</span>&nbsp;<span class="op" id="4756234">(</span><span class="ident" id="4756235">dec</span>&nbsp;<span class="op" id="4756239">*</span><span class="ident" id="4756240">Decoder</span><span class="op" id="4756247">)</span>&nbsp;<span class="ident" id="4756249">ignoreSingle</span><span class="op" id="4756261">(</span><span class="ident" id="4756262">engine</span>&nbsp;<span class="op" id="4756269">*</span><span class="ident" id="4756270">decEngine</span><span class="op" id="4756279">)</span>&nbsp;<span class="op" id="4756281">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756284">state</span>&nbsp;<span class="op" id="4756290">:=</span>&nbsp;<span class="ident" id="4756293">dec</span><span class="op" id="4756296">.</span><span class="ident" id="4756297">newDecoderState</span><span class="op" id="4756312">(</span><span class="op" id="4756313">&amp;</span><span class="ident" id="4756314">dec</span><span class="op" id="4756317">.</span><span class="ident" id="4756318">buf</span><span class="op" id="4756321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756324">defer</span>&nbsp;<span class="ident" id="4756330">dec</span><span class="op" id="4756333">.</span><span class="ident" id="4756334">freeDecoderState</span><span class="op" id="4756350">(</span><span class="ident" id="4756351">state</span><span class="op" id="4756356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756359">state</span><span class="op" id="4756364">.</span><span class="ident" id="4756365">fieldnum</span>&nbsp;<span class="op" id="4756374">=</span>&nbsp;<span class="ident" id="4756376">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756392">delta</span>&nbsp;<span class="op" id="4756398">:=</span>&nbsp;<span class="builtintype" id="4756401">int</span><span class="op" id="4756404">(</span><span class="ident" id="4756405">state</span><span class="op" id="4756410">.</span><span class="ident" id="4756411">decodeUint</span><span class="op" id="4756421">(</span><span class="op" id="4756422">)</span><span class="op" id="4756423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756426">if</span>&nbsp;<span class="ident" id="4756429">delta</span>&nbsp;<span class="op" id="4756435">!=</span>&nbsp;<span class="num" id="4756438">0</span>&nbsp;<span class="op" id="4756440">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756444">errorf</span><span class="op" id="4756450">(</span><span class="string" id="4756451">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4756505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4756508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756511">instr</span>&nbsp;<span class="op" id="4756517">:=</span>&nbsp;<span class="op" id="4756520">&amp;</span><span class="ident" id="4756521">engine</span><span class="op" id="4756527">.</span><span class="ident" id="4756528">instr</span><span class="op" id="4756533">[</span><span class="ident" id="4756534">singletonField</span><span class="op" id="4756548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756551">instr</span><span class="op" id="4756556">.</span><span class="ident" id="4756557">op</span><span class="op" id="4756559">(</span><span class="ident" id="4756560">instr</span><span class="op" id="4756565">,</span>&nbsp;<span class="ident" id="4756567">state</span><span class="op" id="4756572">,</span>&nbsp;<span class="ident" id="4756574">noValue</span><span class="op" id="4756581">)</span><br>
<span class="lineno"></span><span class="op" id="4756583">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="4756586">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4756653">func</span>&nbsp;<span class="op" id="4756658">(</span><span class="ident" id="4756659">dec</span>&nbsp;<span class="op" id="4756663">*</span><span class="ident" id="4756664">Decoder</span><span class="op" id="4756671">)</span>&nbsp;<span class="ident" id="4756673">decodeArrayHelper</span><span class="op" id="4756690">(</span><span class="ident" id="4756691">state</span>&nbsp;<span class="op" id="4756697">*</span><span class="ident" id="4756698">decoderState</span><span class="op" id="4756710">,</span>&nbsp;<span class="ident" id="4756712">value</span>&nbsp;<span class="ident" id="4756718">reflect</span><span class="op" id="4756725">.</span><span class="ident" id="4756726">Value</span><span class="op" id="4756731">,</span>&nbsp;<span class="ident" id="4756733">elemOp</span>&nbsp;<span class="ident" id="4756740">decOp</span><span class="op" id="4756745">,</span>&nbsp;<span class="ident" id="4756747">length</span>&nbsp;<span class="builtintype" id="4756754">int</span><span class="op" id="4756757">,</span>&nbsp;<span class="ident" id="4756759">ovfl</span>&nbsp;<span class="builtintype" id="4756764">error</span><span class="op" id="4756769">,</span>&nbsp;<span class="ident" id="4756771">helper</span>&nbsp;<span class="ident" id="4756778">decHelper</span><span class="op" id="4756787">)</span>&nbsp;<span class="op" id="4756789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756792">if</span>&nbsp;<span class="ident" id="4756795">helper</span>&nbsp;<span class="op" id="4756802">!=</span>&nbsp;<span class="ident" id="4756805">nil</span>&nbsp;<span class="op" id="4756809">&amp;&amp;</span>&nbsp;<span class="ident" id="4756812">helper</span><span class="op" id="4756818">(</span><span class="ident" id="4756819">state</span><span class="op" id="4756824">,</span>&nbsp;<span class="ident" id="4756826">value</span><span class="op" id="4756831">,</span>&nbsp;<span class="ident" id="4756833">length</span><span class="op" id="4756839">,</span>&nbsp;<span class="ident" id="4756841">ovfl</span><span class="op" id="4756845">)</span>&nbsp;<span class="op" id="4756847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756851">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4756859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756862">instr</span>&nbsp;<span class="op" id="4756868">:=</span>&nbsp;<span class="op" id="4756871">&amp;</span><span class="ident" id="4756872">decInstr</span><span class="op" id="4756880">{</span><span class="ident" id="4756881">elemOp</span><span class="op" id="4756887">,</span>&nbsp;<span class="num" id="4756889">0</span><span class="op" id="4756890">,</span>&nbsp;<span class="ident" id="4756892">nil</span><span class="op" id="4756895">,</span>&nbsp;<span class="ident" id="4756897">ovfl</span><span class="op" id="4756901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756904">isPtr</span>&nbsp;<span class="op" id="4756910">:=</span>&nbsp;<span class="ident" id="4756913">value</span><span class="op" id="4756918">.</span><span class="ident" id="4756919">Type</span><span class="op" id="4756923">(</span><span class="op" id="4756924">)</span><span class="op" id="4756925">.</span><span class="ident" id="4756926">Elem</span><span class="op" id="4756930">(</span><span class="op" id="4756931">)</span><span class="op" id="4756932">.</span><span class="ident" id="4756933">Kind</span><span class="op" id="4756937">(</span><span class="op" id="4756938">)</span>&nbsp;<span class="op" id="4756940">==</span>&nbsp;<span class="ident" id="4756943">reflect</span><span class="op" id="4756950">.</span><span class="ident" id="4756951">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756956">for</span>&nbsp;<span class="ident" id="4756960">i</span>&nbsp;<span class="op" id="4756962">:=</span>&nbsp;<span class="num" id="4756965">0</span><span class="op" id="4756966">;</span>&nbsp;<span class="ident" id="4756968">i</span>&nbsp;<span class="op" id="4756970">&lt;</span>&nbsp;<span class="ident" id="4756972">length</span><span class="op" id="4756978">;</span>&nbsp;<span class="ident" id="4756980">i</span><span class="op" id="4756981">++</span>&nbsp;<span class="op" id="4756984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756988">if</span>&nbsp;<span class="ident" id="4756991">state</span><span class="op" id="4756996">.</span><span class="ident" id="4756997">b</span><span class="op" id="4756998">.</span><span class="ident" id="4756999">Len</span><span class="op" id="4757002">(</span><span class="op" id="4757003">)</span>&nbsp;<span class="op" id="4757005">==</span>&nbsp;<span class="num" id="4757008">0</span>&nbsp;<span class="op" id="4757010">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757015">errorf</span><span class="op" id="4757021">(</span><span class="string" id="4757022">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="4757088">,</span>&nbsp;<span class="ident" id="4757090">length</span><span class="op" id="4757096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757104">v</span>&nbsp;<span class="op" id="4757106">:=</span>&nbsp;<span class="ident" id="4757109">value</span><span class="op" id="4757114">.</span><span class="ident" id="4757115">Index</span><span class="op" id="4757120">(</span><span class="ident" id="4757121">i</span><span class="op" id="4757122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757126">if</span>&nbsp;<span class="ident" id="4757129">isPtr</span>&nbsp;<span class="op" id="4757135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757140">v</span>&nbsp;<span class="op" id="4757142">=</span>&nbsp;<span class="ident" id="4757144">decAlloc</span><span class="op" id="4757152">(</span><span class="ident" id="4757153">v</span><span class="op" id="4757154">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757162">elemOp</span><span class="op" id="4757168">(</span><span class="ident" id="4757169">instr</span><span class="op" id="4757174">,</span>&nbsp;<span class="ident" id="4757176">state</span><span class="op" id="4757181">,</span>&nbsp;<span class="ident" id="4757183">v</span><span class="op" id="4757184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757187">}</span><br>
<span class="lineno"></span><span class="op" id="4757189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4757192">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4757248">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="4757346">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4757427">func</span>&nbsp;<span class="op" id="4757432">(</span><span class="ident" id="4757433">dec</span>&nbsp;<span class="op" id="4757437">*</span><span class="ident" id="4757438">Decoder</span><span class="op" id="4757445">)</span>&nbsp;<span class="ident" id="4757447">decodeArray</span><span class="op" id="4757458">(</span><span class="ident" id="4757459">atyp</span>&nbsp;<span class="ident" id="4757464">reflect</span><span class="op" id="4757471">.</span><span class="ident" id="4757472">Type</span><span class="op" id="4757476">,</span>&nbsp;<span class="ident" id="4757478">state</span>&nbsp;<span class="op" id="4757484">*</span><span class="ident" id="4757485">decoderState</span><span class="op" id="4757497">,</span>&nbsp;<span class="ident" id="4757499">value</span>&nbsp;<span class="ident" id="4757505">reflect</span><span class="op" id="4757512">.</span><span class="ident" id="4757513">Value</span><span class="op" id="4757518">,</span>&nbsp;<span class="ident" id="4757520">elemOp</span>&nbsp;<span class="ident" id="4757527">decOp</span><span class="op" id="4757532">,</span>&nbsp;<span class="ident" id="4757534">length</span>&nbsp;<span class="builtintype" id="4757541">int</span><span class="op" id="4757544">,</span>&nbsp;<span class="ident" id="4757546">ovfl</span>&nbsp;<span class="builtintype" id="4757551">error</span><span class="op" id="4757556">,</span>&nbsp;<span class="ident" id="4757558">helper</span>&nbsp;<span class="ident" id="4757565">decHelper</span><span class="op" id="4757574">)</span>&nbsp;<span class="op" id="4757576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757579">if</span>&nbsp;<span class="ident" id="4757582">n</span>&nbsp;<span class="op" id="4757584">:=</span>&nbsp;<span class="ident" id="4757587">state</span><span class="op" id="4757592">.</span><span class="ident" id="4757593">decodeUint</span><span class="op" id="4757603">(</span><span class="op" id="4757604">)</span><span class="op" id="4757605">;</span>&nbsp;<span class="ident" id="4757607">n</span>&nbsp;<span class="op" id="4757609">!=</span>&nbsp;<span class="ident" id="4757612">uint64</span><span class="op" id="4757618">(</span><span class="ident" id="4757619">length</span><span class="op" id="4757625">)</span>&nbsp;<span class="op" id="4757627">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757631">errorf</span><span class="op" id="4757637">(</span><span class="string" id="4757638">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="4757670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757676">dec</span><span class="op" id="4757679">.</span><span class="ident" id="4757680">decodeArrayHelper</span><span class="op" id="4757697">(</span><span class="ident" id="4757698">state</span><span class="op" id="4757703">,</span>&nbsp;<span class="ident" id="4757705">value</span><span class="op" id="4757710">,</span>&nbsp;<span class="ident" id="4757712">elemOp</span><span class="op" id="4757718">,</span>&nbsp;<span class="ident" id="4757720">length</span><span class="op" id="4757726">,</span>&nbsp;<span class="ident" id="4757728">ovfl</span><span class="op" id="4757732">,</span>&nbsp;<span class="ident" id="4757734">helper</span><span class="op" id="4757740">)</span><br>
<span class="lineno"></span><span class="op" id="4757742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="4757745">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4757794">func</span>&nbsp;<span class="ident" id="4757799">decodeIntoValue</span><span class="op" id="4757814">(</span><span class="ident" id="4757815">state</span>&nbsp;<span class="op" id="4757821">*</span><span class="ident" id="4757822">decoderState</span><span class="op" id="4757834">,</span>&nbsp;<span class="ident" id="4757836">op</span>&nbsp;<span class="ident" id="4757839">decOp</span><span class="op" id="4757844">,</span>&nbsp;<span class="ident" id="4757846">isPtr</span>&nbsp;<span class="builtintype" id="4757852">bool</span><span class="op" id="4757856">,</span>&nbsp;<span class="ident" id="4757858">value</span>&nbsp;<span class="ident" id="4757864">reflect</span><span class="op" id="4757871">.</span><span class="ident" id="4757872">Value</span><span class="op" id="4757877">,</span>&nbsp;<span class="ident" id="4757879">ovfl</span>&nbsp;<span class="builtintype" id="4757884">error</span><span class="op" id="4757889">)</span>&nbsp;<span class="ident" id="4757891">reflect</span><span class="op" id="4757898">.</span><span class="ident" id="4757899">Value</span>&nbsp;<span class="op" id="4757905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757908">instr</span>&nbsp;<span class="op" id="4757914">:=</span>&nbsp;<span class="op" id="4757917">&amp;</span><span class="ident" id="4757918">decInstr</span><span class="op" id="4757926">{</span><span class="ident" id="4757927">op</span><span class="op" id="4757929">,</span>&nbsp;<span class="num" id="4757931">0</span><span class="op" id="4757932">,</span>&nbsp;<span class="ident" id="4757934">nil</span><span class="op" id="4757937">,</span>&nbsp;<span class="ident" id="4757939">ovfl</span><span class="op" id="4757943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757946">v</span>&nbsp;<span class="op" id="4757948">:=</span>&nbsp;<span class="ident" id="4757951">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757958">if</span>&nbsp;<span class="ident" id="4757961">isPtr</span>&nbsp;<span class="op" id="4757967">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757971">v</span>&nbsp;<span class="op" id="4757973">=</span>&nbsp;<span class="ident" id="4757975">decAlloc</span><span class="op" id="4757983">(</span><span class="ident" id="4757984">value</span><span class="op" id="4757989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757995">op</span><span class="op" id="4757997">(</span><span class="ident" id="4757998">instr</span><span class="op" id="4758003">,</span>&nbsp;<span class="ident" id="4758005">state</span><span class="op" id="4758010">,</span>&nbsp;<span class="ident" id="4758012">v</span><span class="op" id="4758013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758016">return</span>&nbsp;<span class="ident" id="4758023">value</span><br>
<span class="lineno"></span><span class="op" id="4758029">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="4758032">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4758083">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="4758144">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4758208">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="4758253">func</span>&nbsp;<span class="op" id="4758258">(</span><span class="ident" id="4758259">dec</span>&nbsp;<span class="op" id="4758263">*</span><span class="ident" id="4758264">Decoder</span><span class="op" id="4758271">)</span>&nbsp;<span class="ident" id="4758273">decodeMap</span><span class="op" id="4758282">(</span><span class="ident" id="4758283">mtyp</span>&nbsp;<span class="ident" id="4758288">reflect</span><span class="op" id="4758295">.</span><span class="ident" id="4758296">Type</span><span class="op" id="4758300">,</span>&nbsp;<span class="ident" id="4758302">state</span>&nbsp;<span class="op" id="4758308">*</span><span class="ident" id="4758309">decoderState</span><span class="op" id="4758321">,</span>&nbsp;<span class="ident" id="4758323">value</span>&nbsp;<span class="ident" id="4758329">reflect</span><span class="op" id="4758336">.</span><span class="ident" id="4758337">Value</span><span class="op" id="4758342">,</span>&nbsp;<span class="ident" id="4758344">keyOp</span><span class="op" id="4758349">,</span>&nbsp;<span class="ident" id="4758351">elemOp</span>&nbsp;<span class="ident" id="4758358">decOp</span><span class="op" id="4758363">,</span>&nbsp;<span class="ident" id="4758365">ovfl</span>&nbsp;<span class="builtintype" id="4758370">error</span><span class="op" id="4758375">)</span>&nbsp;<span class="op" id="4758377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758380">if</span>&nbsp;<span class="ident" id="4758383">value</span><span class="op" id="4758388">.</span><span class="ident" id="4758389">IsNil</span><span class="op" id="4758394">(</span><span class="op" id="4758395">)</span>&nbsp;<span class="op" id="4758397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4758401">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758420">value</span><span class="op" id="4758425">.</span><span class="ident" id="4758426">Set</span><span class="op" id="4758429">(</span><span class="ident" id="4758430">reflect</span><span class="op" id="4758437">.</span><span class="ident" id="4758438">MakeMap</span><span class="op" id="4758445">(</span><span class="ident" id="4758446">mtyp</span><span class="op" id="4758450">)</span><span class="op" id="4758451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4758454">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758457">n</span>&nbsp;<span class="op" id="4758459">:=</span>&nbsp;<span class="builtintype" id="4758462">int</span><span class="op" id="4758465">(</span><span class="ident" id="4758466">state</span><span class="op" id="4758471">.</span><span class="ident" id="4758472">decodeUint</span><span class="op" id="4758482">(</span><span class="op" id="4758483">)</span><span class="op" id="4758484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758487">keyIsPtr</span>&nbsp;<span class="op" id="4758496">:=</span>&nbsp;<span class="ident" id="4758499">mtyp</span><span class="op" id="4758503">.</span><span class="ident" id="4758504">Key</span><span class="op" id="4758507">(</span><span class="op" id="4758508">)</span><span class="op" id="4758509">.</span><span class="ident" id="4758510">Kind</span><span class="op" id="4758514">(</span><span class="op" id="4758515">)</span>&nbsp;<span class="op" id="4758517">==</span>&nbsp;<span class="ident" id="4758520">reflect</span><span class="op" id="4758527">.</span><span class="ident" id="4758528">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758533">elemIsPtr</span>&nbsp;<span class="op" id="4758543">:=</span>&nbsp;<span class="ident" id="4758546">mtyp</span><span class="op" id="4758550">.</span><span class="ident" id="4758551">Elem</span><span class="op" id="4758555">(</span><span class="op" id="4758556">)</span><span class="op" id="4758557">.</span><span class="ident" id="4758558">Kind</span><span class="op" id="4758562">(</span><span class="op" id="4758563">)</span>&nbsp;<span class="op" id="4758565">==</span>&nbsp;<span class="ident" id="4758568">reflect</span><span class="op" id="4758575">.</span><span class="ident" id="4758576">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758581">for</span>&nbsp;<span class="ident" id="4758585">i</span>&nbsp;<span class="op" id="4758587">:=</span>&nbsp;<span class="num" id="4758590">0</span><span class="op" id="4758591">;</span>&nbsp;<span class="ident" id="4758593">i</span>&nbsp;<span class="op" id="4758595">&lt;</span>&nbsp;<span class="ident" id="4758597">n</span><span class="op" id="4758598">;</span>&nbsp;<span class="ident" id="4758600">i</span><span class="op" id="4758601">++</span>&nbsp;<span class="op" id="4758604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758608">key</span>&nbsp;<span class="op" id="4758612">:=</span>&nbsp;<span class="ident" id="4758615">decodeIntoValue</span><span class="op" id="4758630">(</span><span class="ident" id="4758631">state</span><span class="op" id="4758636">,</span>&nbsp;<span class="ident" id="4758638">keyOp</span><span class="op" id="4758643">,</span>&nbsp;<span class="ident" id="4758645">keyIsPtr</span><span class="op" id="4758653">,</span>&nbsp;<span class="ident" id="4758655">allocValue</span><span class="op" id="4758665">(</span><span class="ident" id="4758666">mtyp</span><span class="op" id="4758670">.</span><span class="ident" id="4758671">Key</span><span class="op" id="4758674">(</span><span class="op" id="4758675">)</span><span class="op" id="4758676">)</span><span class="op" id="4758677">,</span>&nbsp;<span class="ident" id="4758679">ovfl</span><span class="op" id="4758683">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758687">elem</span>&nbsp;<span class="op" id="4758692">:=</span>&nbsp;<span class="ident" id="4758695">decodeIntoValue</span><span class="op" id="4758710">(</span><span class="ident" id="4758711">state</span><span class="op" id="4758716">,</span>&nbsp;<span class="ident" id="4758718">elemOp</span><span class="op" id="4758724">,</span>&nbsp;<span class="ident" id="4758726">elemIsPtr</span><span class="op" id="4758735">,</span>&nbsp;<span class="ident" id="4758737">allocValue</span><span class="op" id="4758747">(</span><span class="ident" id="4758748">mtyp</span><span class="op" id="4758752">.</span><span class="ident" id="4758753">Elem</span><span class="op" id="4758757">(</span><span class="op" id="4758758">)</span><span class="op" id="4758759">)</span><span class="op" id="4758760">,</span>&nbsp;<span class="ident" id="4758762">ovfl</span><span class="op" id="4758766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758770">value</span><span class="op" id="4758775">.</span><span class="ident" id="4758776">SetMapIndex</span><span class="op" id="4758787">(</span><span class="ident" id="4758788">key</span><span class="op" id="4758791">,</span>&nbsp;<span class="ident" id="4758793">elem</span><span class="op" id="4758797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4758800">}</span><br>
<span class="lineno"></span><span class="op" id="4758802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="4758805">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4758874">func</span>&nbsp;<span class="op" id="4758879">(</span><span class="ident" id="4758880">dec</span>&nbsp;<span class="op" id="4758884">*</span><span class="ident" id="4758885">Decoder</span><span class="op" id="4758892">)</span>&nbsp;<span class="ident" id="4758894">ignoreArrayHelper</span><span class="op" id="4758911">(</span><span class="ident" id="4758912">state</span>&nbsp;<span class="op" id="4758918">*</span><span class="ident" id="4758919">decoderState</span><span class="op" id="4758931">,</span>&nbsp;<span class="ident" id="4758933">elemOp</span>&nbsp;<span class="ident" id="4758940">decOp</span><span class="op" id="4758945">,</span>&nbsp;<span class="ident" id="4758947">length</span>&nbsp;<span class="builtintype" id="4758954">int</span><span class="op" id="4758957">)</span>&nbsp;<span class="op" id="4758959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758962">instr</span>&nbsp;<span class="op" id="4758968">:=</span>&nbsp;<span class="op" id="4758971">&amp;</span><span class="ident" id="4758972">decInstr</span><span class="op" id="4758980">{</span><span class="ident" id="4758981">elemOp</span><span class="op" id="4758987">,</span>&nbsp;<span class="num" id="4758989">0</span><span class="op" id="4758990">,</span>&nbsp;<span class="ident" id="4758992">nil</span><span class="op" id="4758995">,</span>&nbsp;<span class="ident" id="4758997">errors</span><span class="op" id="4759003">.</span><span class="ident" id="4759004">New</span><span class="op" id="4759007">(</span><span class="string" id="4759008">&#34;no&nbsp;error&#34;</span><span class="op" id="4759018">)</span><span class="op" id="4759019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759022">for</span>&nbsp;<span class="ident" id="4759026">i</span>&nbsp;<span class="op" id="4759028">:=</span>&nbsp;<span class="num" id="4759031">0</span><span class="op" id="4759032">;</span>&nbsp;<span class="ident" id="4759034">i</span>&nbsp;<span class="op" id="4759036">&lt;</span>&nbsp;<span class="ident" id="4759038">length</span><span class="op" id="4759044">;</span>&nbsp;<span class="ident" id="4759046">i</span><span class="op" id="4759047">++</span>&nbsp;<span class="op" id="4759050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759054">elemOp</span><span class="op" id="4759060">(</span><span class="ident" id="4759061">instr</span><span class="op" id="4759066">,</span>&nbsp;<span class="ident" id="4759068">state</span><span class="op" id="4759073">,</span>&nbsp;<span class="ident" id="4759075">noValue</span><span class="op" id="4759082">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759085">}</span><br>
<span class="lineno"></span><span class="op" id="4759087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4759090">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4759163">func</span>&nbsp;<span class="op" id="4759168">(</span><span class="ident" id="4759169">dec</span>&nbsp;<span class="op" id="4759173">*</span><span class="ident" id="4759174">Decoder</span><span class="op" id="4759181">)</span>&nbsp;<span class="ident" id="4759183">ignoreArray</span><span class="op" id="4759194">(</span><span class="ident" id="4759195">state</span>&nbsp;<span class="op" id="4759201">*</span><span class="ident" id="4759202">decoderState</span><span class="op" id="4759214">,</span>&nbsp;<span class="ident" id="4759216">elemOp</span>&nbsp;<span class="ident" id="4759223">decOp</span><span class="op" id="4759228">,</span>&nbsp;<span class="ident" id="4759230">length</span>&nbsp;<span class="builtintype" id="4759237">int</span><span class="op" id="4759240">)</span>&nbsp;<span class="op" id="4759242">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759245">if</span>&nbsp;<span class="ident" id="4759248">n</span>&nbsp;<span class="op" id="4759250">:=</span>&nbsp;<span class="ident" id="4759253">state</span><span class="op" id="4759258">.</span><span class="ident" id="4759259">decodeUint</span><span class="op" id="4759269">(</span><span class="op" id="4759270">)</span><span class="op" id="4759271">;</span>&nbsp;<span class="ident" id="4759273">n</span>&nbsp;<span class="op" id="4759275">!=</span>&nbsp;<span class="ident" id="4759278">uint64</span><span class="op" id="4759284">(</span><span class="ident" id="4759285">length</span><span class="op" id="4759291">)</span>&nbsp;<span class="op" id="4759293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759297">errorf</span><span class="op" id="4759303">(</span><span class="string" id="4759304">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="4759336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759342">dec</span><span class="op" id="4759345">.</span><span class="ident" id="4759346">ignoreArrayHelper</span><span class="op" id="4759363">(</span><span class="ident" id="4759364">state</span><span class="op" id="4759369">,</span>&nbsp;<span class="ident" id="4759371">elemOp</span><span class="op" id="4759377">,</span>&nbsp;<span class="ident" id="4759379">length</span><span class="op" id="4759385">)</span><br>
<span class="lineno"></span><span class="op" id="4759387">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="4759390">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4759458">func</span>&nbsp;<span class="op" id="4759463">(</span><span class="ident" id="4759464">dec</span>&nbsp;<span class="op" id="4759468">*</span><span class="ident" id="4759469">Decoder</span><span class="op" id="4759476">)</span>&nbsp;<span class="ident" id="4759478">ignoreMap</span><span class="op" id="4759487">(</span><span class="ident" id="4759488">state</span>&nbsp;<span class="op" id="4759494">*</span><span class="ident" id="4759495">decoderState</span><span class="op" id="4759507">,</span>&nbsp;<span class="ident" id="4759509">keyOp</span><span class="op" id="4759514">,</span>&nbsp;<span class="ident" id="4759516">elemOp</span>&nbsp;<span class="ident" id="4759523">decOp</span><span class="op" id="4759528">)</span>&nbsp;<span class="op" id="4759530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759533">n</span>&nbsp;<span class="op" id="4759535">:=</span>&nbsp;<span class="builtintype" id="4759538">int</span><span class="op" id="4759541">(</span><span class="ident" id="4759542">state</span><span class="op" id="4759547">.</span><span class="ident" id="4759548">decodeUint</span><span class="op" id="4759558">(</span><span class="op" id="4759559">)</span><span class="op" id="4759560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759563">keyInstr</span>&nbsp;<span class="op" id="4759572">:=</span>&nbsp;<span class="op" id="4759575">&amp;</span><span class="ident" id="4759576">decInstr</span><span class="op" id="4759584">{</span><span class="ident" id="4759585">keyOp</span><span class="op" id="4759590">,</span>&nbsp;<span class="num" id="4759592">0</span><span class="op" id="4759593">,</span>&nbsp;<span class="ident" id="4759595">nil</span><span class="op" id="4759598">,</span>&nbsp;<span class="ident" id="4759600">errors</span><span class="op" id="4759606">.</span><span class="ident" id="4759607">New</span><span class="op" id="4759610">(</span><span class="string" id="4759611">&#34;no&nbsp;error&#34;</span><span class="op" id="4759621">)</span><span class="op" id="4759622">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759625">elemInstr</span>&nbsp;<span class="op" id="4759635">:=</span>&nbsp;<span class="op" id="4759638">&amp;</span><span class="ident" id="4759639">decInstr</span><span class="op" id="4759647">{</span><span class="ident" id="4759648">elemOp</span><span class="op" id="4759654">,</span>&nbsp;<span class="num" id="4759656">0</span><span class="op" id="4759657">,</span>&nbsp;<span class="ident" id="4759659">nil</span><span class="op" id="4759662">,</span>&nbsp;<span class="ident" id="4759664">errors</span><span class="op" id="4759670">.</span><span class="ident" id="4759671">New</span><span class="op" id="4759674">(</span><span class="string" id="4759675">&#34;no&nbsp;error&#34;</span><span class="op" id="4759685">)</span><span class="op" id="4759686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759689">for</span>&nbsp;<span class="ident" id="4759693">i</span>&nbsp;<span class="op" id="4759695">:=</span>&nbsp;<span class="num" id="4759698">0</span><span class="op" id="4759699">;</span>&nbsp;<span class="ident" id="4759701">i</span>&nbsp;<span class="op" id="4759703">&lt;</span>&nbsp;<span class="ident" id="4759705">n</span><span class="op" id="4759706">;</span>&nbsp;<span class="ident" id="4759708">i</span><span class="op" id="4759709">++</span>&nbsp;<span class="op" id="4759712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759716">keyOp</span><span class="op" id="4759721">(</span><span class="ident" id="4759722">keyInstr</span><span class="op" id="4759730">,</span>&nbsp;<span class="ident" id="4759732">state</span><span class="op" id="4759737">,</span>&nbsp;<span class="ident" id="4759739">noValue</span><span class="op" id="4759746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759750">elemOp</span><span class="op" id="4759756">(</span><span class="ident" id="4759757">elemInstr</span><span class="op" id="4759766">,</span>&nbsp;<span class="ident" id="4759768">state</span><span class="op" id="4759773">,</span>&nbsp;<span class="ident" id="4759775">noValue</span><span class="op" id="4759782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759785">}</span><br>
<span class="lineno">595</span><span class="op" id="4759787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4759790">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4759845">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="4759915">func</span>&nbsp;<span class="op" id="4759920">(</span><span class="ident" id="4759921">dec</span>&nbsp;<span class="op" id="4759925">*</span><span class="ident" id="4759926">Decoder</span><span class="op" id="4759933">)</span>&nbsp;<span class="ident" id="4759935">decodeSlice</span><span class="op" id="4759946">(</span><span class="ident" id="4759947">state</span>&nbsp;<span class="op" id="4759953">*</span><span class="ident" id="4759954">decoderState</span><span class="op" id="4759966">,</span>&nbsp;<span class="ident" id="4759968">value</span>&nbsp;<span class="ident" id="4759974">reflect</span><span class="op" id="4759981">.</span><span class="ident" id="4759982">Value</span><span class="op" id="4759987">,</span>&nbsp;<span class="ident" id="4759989">elemOp</span>&nbsp;<span class="ident" id="4759996">decOp</span><span class="op" id="4760001">,</span>&nbsp;<span class="ident" id="4760003">ovfl</span>&nbsp;<span class="builtintype" id="4760008">error</span><span class="op" id="4760013">,</span>&nbsp;<span class="ident" id="4760015">helper</span>&nbsp;<span class="ident" id="4760022">decHelper</span><span class="op" id="4760031">)</span>&nbsp;<span class="op" id="4760033">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760036">u</span>&nbsp;<span class="op" id="4760038">:=</span>&nbsp;<span class="ident" id="4760041">state</span><span class="op" id="4760046">.</span><span class="ident" id="4760047">decodeUint</span><span class="op" id="4760057">(</span><span class="op" id="4760058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760061">typ</span>&nbsp;<span class="op" id="4760065">:=</span>&nbsp;<span class="ident" id="4760068">value</span><span class="op" id="4760073">.</span><span class="ident" id="4760074">Type</span><span class="op" id="4760078">(</span><span class="op" id="4760079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760082">size</span>&nbsp;<span class="op" id="4760087">:=</span>&nbsp;<span class="ident" id="4760090">uint64</span><span class="op" id="4760096">(</span><span class="ident" id="4760097">typ</span><span class="op" id="4760100">.</span><span class="ident" id="4760101">Elem</span><span class="op" id="4760105">(</span><span class="op" id="4760106">)</span><span class="op" id="4760107">.</span><span class="ident" id="4760108">Size</span><span class="op" id="4760112">(</span><span class="op" id="4760113">)</span><span class="op" id="4760114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760117">nBytes</span>&nbsp;<span class="op" id="4760124">:=</span>&nbsp;<span class="ident" id="4760127">u</span>&nbsp;<span class="op" id="4760129">*</span>&nbsp;<span class="ident" id="4760131">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760137">n</span>&nbsp;<span class="op" id="4760139">:=</span>&nbsp;<span class="builtintype" id="4760142">int</span><span class="op" id="4760145">(</span><span class="ident" id="4760146">u</span><span class="op" id="4760147">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4760150">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760199">if</span>&nbsp;<span class="ident" id="4760202">n</span>&nbsp;<span class="op" id="4760204">&lt;</span>&nbsp;<span class="num" id="4760206">0</span>&nbsp;<span class="op" id="4760208">||</span>&nbsp;<span class="ident" id="4760211">uint64</span><span class="op" id="4760217">(</span><span class="ident" id="4760218">n</span><span class="op" id="4760219">)</span>&nbsp;<span class="op" id="4760221">!=</span>&nbsp;<span class="ident" id="4760224">u</span>&nbsp;<span class="op" id="4760226">||</span>&nbsp;<span class="ident" id="4760229">nBytes</span>&nbsp;<span class="op" id="4760236">&gt;</span>&nbsp;<span class="ident" id="4760238">tooBig</span>&nbsp;<span class="op" id="4760245">||</span>&nbsp;<span class="op" id="4760248">(</span><span class="ident" id="4760249">size</span>&nbsp;<span class="op" id="4760254">&gt;</span>&nbsp;<span class="num" id="4760256">0</span>&nbsp;<span class="op" id="4760258">&amp;&amp;</span>&nbsp;<span class="ident" id="4760261">nBytes</span><span class="op" id="4760267">/</span><span class="ident" id="4760268">size</span>&nbsp;<span class="op" id="4760273">!=</span>&nbsp;<span class="ident" id="4760276">u</span><span class="op" id="4760277">)</span>&nbsp;<span class="op" id="4760279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4760283">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4760356">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760406">errorf</span><span class="op" id="4760412">(</span><span class="string" id="4760413">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="4760456">,</span>&nbsp;<span class="ident" id="4760458">typ</span><span class="op" id="4760461">.</span><span class="ident" id="4760462">Elem</span><span class="op" id="4760466">(</span><span class="op" id="4760467">)</span><span class="op" id="4760468">,</span>&nbsp;<span class="ident" id="4760470">u</span><span class="op" id="4760471">,</span>&nbsp;<span class="ident" id="4760473">size</span><span class="op" id="4760477">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4760480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760483">if</span>&nbsp;<span class="ident" id="4760486">value</span><span class="op" id="4760491">.</span><span class="ident" id="4760492">Cap</span><span class="op" id="4760495">(</span><span class="op" id="4760496">)</span>&nbsp;<span class="op" id="4760498">&lt;</span>&nbsp;<span class="ident" id="4760500">n</span>&nbsp;<span class="op" id="4760502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760506">value</span><span class="op" id="4760511">.</span><span class="ident" id="4760512">Set</span><span class="op" id="4760515">(</span><span class="ident" id="4760516">reflect</span><span class="op" id="4760523">.</span><span class="ident" id="4760524">MakeSlice</span><span class="op" id="4760533">(</span><span class="ident" id="4760534">typ</span><span class="op" id="4760537">,</span>&nbsp;<span class="ident" id="4760539">n</span><span class="op" id="4760540">,</span>&nbsp;<span class="ident" id="4760542">n</span><span class="op" id="4760543">)</span><span class="op" id="4760544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4760547">}</span>&nbsp;<span class="keyword" id="4760549">else</span>&nbsp;<span class="op" id="4760554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760558">value</span><span class="op" id="4760563">.</span><span class="ident" id="4760564">Set</span><span class="op" id="4760567">(</span><span class="ident" id="4760568">value</span><span class="op" id="4760573">.</span><span class="ident" id="4760574">Slice</span><span class="op" id="4760579">(</span><span class="num" id="4760580">0</span><span class="op" id="4760581">,</span>&nbsp;<span class="ident" id="4760583">n</span><span class="op" id="4760584">)</span><span class="op" id="4760585">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4760588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760591">dec</span><span class="op" id="4760594">.</span><span class="ident" id="4760595">decodeArrayHelper</span><span class="op" id="4760612">(</span><span class="ident" id="4760613">state</span><span class="op" id="4760618">,</span>&nbsp;<span class="ident" id="4760620">value</span><span class="op" id="4760625">,</span>&nbsp;<span class="ident" id="4760627">elemOp</span><span class="op" id="4760633">,</span>&nbsp;<span class="ident" id="4760635">n</span><span class="op" id="4760636">,</span>&nbsp;<span class="ident" id="4760638">ovfl</span><span class="op" id="4760642">,</span>&nbsp;<span class="ident" id="4760644">helper</span><span class="op" id="4760650">)</span><br>
<span class="lineno"></span><span class="op" id="4760652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4760655">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="4760729">func</span>&nbsp;<span class="op" id="4760734">(</span><span class="ident" id="4760735">dec</span>&nbsp;<span class="op" id="4760739">*</span><span class="ident" id="4760740">Decoder</span><span class="op" id="4760747">)</span>&nbsp;<span class="ident" id="4760749">ignoreSlice</span><span class="op" id="4760760">(</span><span class="ident" id="4760761">state</span>&nbsp;<span class="op" id="4760767">*</span><span class="ident" id="4760768">decoderState</span><span class="op" id="4760780">,</span>&nbsp;<span class="ident" id="4760782">elemOp</span>&nbsp;<span class="ident" id="4760789">decOp</span><span class="op" id="4760794">)</span>&nbsp;<span class="op" id="4760796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760799">dec</span><span class="op" id="4760802">.</span><span class="ident" id="4760803">ignoreArrayHelper</span><span class="op" id="4760820">(</span><span class="ident" id="4760821">state</span><span class="op" id="4760826">,</span>&nbsp;<span class="ident" id="4760828">elemOp</span><span class="op" id="4760834">,</span>&nbsp;<span class="builtintype" id="4760836">int</span><span class="op" id="4760839">(</span><span class="ident" id="4760840">state</span><span class="op" id="4760845">.</span><span class="ident" id="4760846">decodeUint</span><span class="op" id="4760856">(</span><span class="op" id="4760857">)</span><span class="op" id="4760858">)</span><span class="op" id="4760859">)</span><br>
<span class="lineno"></span><span class="op" id="4760861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4760864">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="4760934">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4761012">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4761076">func</span>&nbsp;<span class="op" id="4761081">(</span><span class="ident" id="4761082">dec</span>&nbsp;<span class="op" id="4761086">*</span><span class="ident" id="4761087">Decoder</span><span class="op" id="4761094">)</span>&nbsp;<span class="ident" id="4761096">decodeInterface</span><span class="op" id="4761111">(</span><span class="ident" id="4761112">ityp</span>&nbsp;<span class="ident" id="4761117">reflect</span><span class="op" id="4761124">.</span><span class="ident" id="4761125">Type</span><span class="op" id="4761129">,</span>&nbsp;<span class="ident" id="4761131">state</span>&nbsp;<span class="op" id="4761137">*</span><span class="ident" id="4761138">decoderState</span><span class="op" id="4761150">,</span>&nbsp;<span class="ident" id="4761152">value</span>&nbsp;<span class="ident" id="4761158">reflect</span><span class="op" id="4761165">.</span><span class="ident" id="4761166">Value</span><span class="op" id="4761171">)</span>&nbsp;<span class="op" id="4761173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761176">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761216">nr</span>&nbsp;<span class="op" id="4761219">:=</span>&nbsp;<span class="ident" id="4761222">state</span><span class="op" id="4761227">.</span><span class="ident" id="4761228">decodeUint</span><span class="op" id="4761238">(</span><span class="op" id="4761239">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761242">if</span>&nbsp;<span class="ident" id="4761245">nr</span>&nbsp;<span class="op" id="4761248">&lt;</span>&nbsp;<span class="num" id="4761250">0</span>&nbsp;<span class="op" id="4761252">||</span>&nbsp;<span class="ident" id="4761255">nr</span>&nbsp;<span class="op" id="4761258">&gt;</span>&nbsp;<span class="num" id="4761260">1</span><span class="op" id="4761261">&lt;&lt;</span><span class="num" id="4761263">31</span>&nbsp;<span class="op" id="4761266">{</span>&nbsp;<span class="comment" id="4761268">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761313">errorf</span><span class="op" id="4761319">(</span><span class="string" id="4761320">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="4761349">,</span>&nbsp;<span class="ident" id="4761351">nr</span><span class="op" id="4761353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761359">if</span>&nbsp;<span class="ident" id="4761362">nr</span>&nbsp;<span class="op" id="4761365">&gt;</span>&nbsp;<span class="ident" id="4761367">uint64</span><span class="op" id="4761373">(</span><span class="ident" id="4761374">state</span><span class="op" id="4761379">.</span><span class="ident" id="4761380">b</span><span class="op" id="4761381">.</span><span class="ident" id="4761382">Len</span><span class="op" id="4761385">(</span><span class="op" id="4761386">)</span><span class="op" id="4761387">)</span>&nbsp;<span class="op" id="4761389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761393">errorf</span><span class="op" id="4761399">(</span><span class="string" id="4761400">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="4761449">,</span>&nbsp;<span class="ident" id="4761451">nr</span><span class="op" id="4761453">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761459">b</span>&nbsp;<span class="op" id="4761461">:=</span>&nbsp;<span class="builtinfunc" id="4761464">make</span><span class="op" id="4761468">(</span><span class="op" id="4761469">[</span><span class="op" id="4761470">]</span><span class="builtintype" id="4761471">byte</span><span class="op" id="4761475">,</span>&nbsp;<span class="ident" id="4761477">nr</span><span class="op" id="4761479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761482">state</span><span class="op" id="4761487">.</span><span class="ident" id="4761488">b</span><span class="op" id="4761489">.</span><span class="ident" id="4761490">Read</span><span class="op" id="4761494">(</span><span class="ident" id="4761495">b</span><span class="op" id="4761496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761499">name</span>&nbsp;<span class="op" id="4761504">:=</span>&nbsp;<span class="builtintype" id="4761507">string</span><span class="op" id="4761513">(</span><span class="ident" id="4761514">b</span><span class="op" id="4761515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761518">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761564">if</span>&nbsp;<span class="ident" id="4761567">name</span>&nbsp;<span class="op" id="4761572">==</span>&nbsp;<span class="string" id="4761575">&#34;&#34;</span>&nbsp;<span class="op" id="4761578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761582">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761631">value</span><span class="op" id="4761636">.</span><span class="ident" id="4761637">Set</span><span class="op" id="4761640">(</span><span class="ident" id="4761641">reflect</span><span class="op" id="4761648">.</span><span class="ident" id="4761649">Zero</span><span class="op" id="4761653">(</span><span class="ident" id="4761654">value</span><span class="op" id="4761659">.</span><span class="ident" id="4761660">Type</span><span class="op" id="4761664">(</span><span class="op" id="4761665">)</span><span class="op" id="4761666">)</span><span class="op" id="4761667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761671">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761679">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761682">if</span>&nbsp;<span class="builtinfunc" id="4761685">len</span><span class="op" id="4761688">(</span><span class="ident" id="4761689">name</span><span class="op" id="4761693">)</span>&nbsp;<span class="op" id="4761695">&gt;</span>&nbsp;<span class="num" id="4761697">1024</span>&nbsp;<span class="op" id="4761702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761706">errorf</span><span class="op" id="4761712">(</span><span class="string" id="4761713">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="4761749">,</span>&nbsp;<span class="builtinfunc" id="4761751">len</span><span class="op" id="4761754">(</span><span class="ident" id="4761755">name</span><span class="op" id="4761759">)</span><span class="op" id="4761760">,</span>&nbsp;<span class="ident" id="4761762">name</span><span class="op" id="4761766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761772">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761814">registerLock</span><span class="op" id="4761826">.</span><span class="ident" id="4761827">RLock</span><span class="op" id="4761832">(</span><span class="op" id="4761833">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761836">typ</span><span class="op" id="4761839">,</span>&nbsp;<span class="ident" id="4761841">ok</span>&nbsp;<span class="op" id="4761844">:=</span>&nbsp;<span class="ident" id="4761847">nameToConcreteType</span><span class="op" id="4761865">[</span><span class="ident" id="4761866">name</span><span class="op" id="4761870">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761873">registerLock</span><span class="op" id="4761885">.</span><span class="ident" id="4761886">RUnlock</span><span class="op" id="4761893">(</span><span class="op" id="4761894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761897">if</span>&nbsp;<span class="op" id="4761900">!</span><span class="ident" id="4761901">ok</span>&nbsp;<span class="op" id="4761904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761908">errorf</span><span class="op" id="4761914">(</span><span class="string" id="4761915">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="4761954">,</span>&nbsp;<span class="ident" id="4761956">name</span><span class="op" id="4761960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761963">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761966">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762010">concreteId</span>&nbsp;<span class="op" id="4762021">:=</span>&nbsp;<span class="ident" id="4762024">dec</span><span class="op" id="4762027">.</span><span class="ident" id="4762028">decodeTypeSequence</span><span class="op" id="4762046">(</span><span class="builtintype" id="4762047">true</span><span class="op" id="4762051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762054">if</span>&nbsp;<span class="ident" id="4762057">concreteId</span>&nbsp;<span class="op" id="4762068">&lt;</span>&nbsp;<span class="num" id="4762070">0</span>&nbsp;<span class="op" id="4762072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762076">error_</span><span class="op" id="4762082">(</span><span class="ident" id="4762083">dec</span><span class="op" id="4762086">.</span><span class="ident" id="4762087">err</span><span class="op" id="4762090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762093">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762096">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762166">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762234">state</span><span class="op" id="4762239">.</span><span class="ident" id="4762240">decodeUint</span><span class="op" id="4762250">(</span><span class="op" id="4762251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762254">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762283">v</span>&nbsp;<span class="op" id="4762285">:=</span>&nbsp;<span class="ident" id="4762288">allocValue</span><span class="op" id="4762298">(</span><span class="ident" id="4762299">typ</span><span class="op" id="4762302">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762305">dec</span><span class="op" id="4762308">.</span><span class="ident" id="4762309">decodeValue</span><span class="op" id="4762320">(</span><span class="ident" id="4762321">concreteId</span><span class="op" id="4762331">,</span>&nbsp;<span class="ident" id="4762333">v</span><span class="op" id="4762334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762337">if</span>&nbsp;<span class="ident" id="4762340">dec</span><span class="op" id="4762343">.</span><span class="ident" id="4762344">err</span>&nbsp;<span class="op" id="4762348">!=</span>&nbsp;<span class="ident" id="4762351">nil</span>&nbsp;<span class="op" id="4762355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762359">error_</span><span class="op" id="4762365">(</span><span class="ident" id="4762366">dec</span><span class="op" id="4762369">.</span><span class="ident" id="4762370">err</span><span class="op" id="4762373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762379">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762427">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762484">if</span>&nbsp;<span class="op" id="4762487">!</span><span class="ident" id="4762488">typ</span><span class="op" id="4762491">.</span><span class="ident" id="4762492">AssignableTo</span><span class="op" id="4762504">(</span><span class="ident" id="4762505">ityp</span><span class="op" id="4762509">)</span>&nbsp;<span class="op" id="4762511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762515">errorf</span><span class="op" id="4762521">(</span><span class="string" id="4762522">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4762555">,</span>&nbsp;<span class="ident" id="4762557">typ</span><span class="op" id="4762560">,</span>&nbsp;<span class="ident" id="4762562">ityp</span><span class="op" id="4762566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762572">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762616">value</span><span class="op" id="4762621">.</span><span class="ident" id="4762622">Set</span><span class="op" id="4762625">(</span><span class="ident" id="4762626">v</span><span class="op" id="4762627">)</span><br>
<span class="lineno"></span><span class="op" id="4762629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4762632">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4762713">func</span>&nbsp;<span class="op" id="4762718">(</span><span class="ident" id="4762719">dec</span>&nbsp;<span class="op" id="4762723">*</span><span class="ident" id="4762724">Decoder</span><span class="op" id="4762731">)</span>&nbsp;<span class="ident" id="4762733">ignoreInterface</span><span class="op" id="4762748">(</span><span class="ident" id="4762749">state</span>&nbsp;<span class="op" id="4762755">*</span><span class="ident" id="4762756">decoderState</span><span class="op" id="4762768">)</span>&nbsp;<span class="op" id="4762770">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762773">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762813">b</span>&nbsp;<span class="op" id="4762815">:=</span>&nbsp;<span class="builtinfunc" id="4762818">make</span><span class="op" id="4762822">(</span><span class="op" id="4762823">[</span><span class="op" id="4762824">]</span><span class="builtintype" id="4762825">byte</span><span class="op" id="4762829">,</span>&nbsp;<span class="ident" id="4762831">state</span><span class="op" id="4762836">.</span><span class="ident" id="4762837">decodeUint</span><span class="op" id="4762847">(</span><span class="op" id="4762848">)</span><span class="op" id="4762849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762852">_</span><span class="op" id="4762853">,</span>&nbsp;<span class="ident" id="4762855">err</span>&nbsp;<span class="op" id="4762859">:=</span>&nbsp;<span class="ident" id="4762862">state</span><span class="op" id="4762867">.</span><span class="ident" id="4762868">b</span><span class="op" id="4762869">.</span><span class="ident" id="4762870">Read</span><span class="op" id="4762874">(</span><span class="ident" id="4762875">b</span><span class="op" id="4762876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762879">if</span>&nbsp;<span class="ident" id="4762882">err</span>&nbsp;<span class="op" id="4762886">!=</span>&nbsp;<span class="ident" id="4762889">nil</span>&nbsp;<span class="op" id="4762893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762897">error_</span><span class="op" id="4762903">(</span><span class="ident" id="4762904">err</span><span class="op" id="4762907">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762913">id</span>&nbsp;<span class="op" id="4762916">:=</span>&nbsp;<span class="ident" id="4762919">dec</span><span class="op" id="4762922">.</span><span class="ident" id="4762923">decodeTypeSequence</span><span class="op" id="4762941">(</span><span class="builtintype" id="4762942">true</span><span class="op" id="4762946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762949">if</span>&nbsp;<span class="ident" id="4762952">id</span>&nbsp;<span class="op" id="4762955">&lt;</span>&nbsp;<span class="num" id="4762957">0</span>&nbsp;<span class="op" id="4762959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762963">error_</span><span class="op" id="4762969">(</span><span class="ident" id="4762970">dec</span><span class="op" id="4762973">.</span><span class="ident" id="4762974">err</span><span class="op" id="4762977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762980">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762983">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763063">state</span><span class="op" id="4763068">.</span><span class="ident" id="4763069">b</span><span class="op" id="4763070">.</span><span class="ident" id="4763071">Drop</span><span class="op" id="4763075">(</span><span class="builtintype" id="4763076">int</span><span class="op" id="4763079">(</span><span class="ident" id="4763080">state</span><span class="op" id="4763085">.</span><span class="ident" id="4763086">decodeUint</span><span class="op" id="4763096">(</span><span class="op" id="4763097">)</span><span class="op" id="4763098">)</span><span class="op" id="4763099">)</span><br>
<span class="lineno"></span><span class="op" id="4763101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4763104">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="4763181">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4763221">func</span>&nbsp;<span class="op" id="4763226">(</span><span class="ident" id="4763227">dec</span>&nbsp;<span class="op" id="4763231">*</span><span class="ident" id="4763232">Decoder</span><span class="op" id="4763239">)</span>&nbsp;<span class="ident" id="4763241">decodeGobDecoder</span><span class="op" id="4763257">(</span><span class="ident" id="4763258">ut</span>&nbsp;<span class="op" id="4763261">*</span><span class="ident" id="4763262">userTypeInfo</span><span class="op" id="4763274">,</span>&nbsp;<span class="ident" id="4763276">state</span>&nbsp;<span class="op" id="4763282">*</span><span class="ident" id="4763283">decoderState</span><span class="op" id="4763295">,</span>&nbsp;<span class="ident" id="4763297">value</span>&nbsp;<span class="ident" id="4763303">reflect</span><span class="op" id="4763310">.</span><span class="ident" id="4763311">Value</span><span class="op" id="4763316">)</span>&nbsp;<span class="op" id="4763318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763321">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763355">b</span>&nbsp;<span class="op" id="4763357">:=</span>&nbsp;<span class="builtinfunc" id="4763360">make</span><span class="op" id="4763364">(</span><span class="op" id="4763365">[</span><span class="op" id="4763366">]</span><span class="builtintype" id="4763367">byte</span><span class="op" id="4763371">,</span>&nbsp;<span class="ident" id="4763373">state</span><span class="op" id="4763378">.</span><span class="ident" id="4763379">decodeUint</span><span class="op" id="4763389">(</span><span class="op" id="4763390">)</span><span class="op" id="4763391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763394">_</span><span class="op" id="4763395">,</span>&nbsp;<span class="ident" id="4763397">err</span>&nbsp;<span class="op" id="4763401">:=</span>&nbsp;<span class="ident" id="4763404">state</span><span class="op" id="4763409">.</span><span class="ident" id="4763410">b</span><span class="op" id="4763411">.</span><span class="ident" id="4763412">Read</span><span class="op" id="4763416">(</span><span class="ident" id="4763417">b</span><span class="op" id="4763418">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763421">if</span>&nbsp;<span class="ident" id="4763424">err</span>&nbsp;<span class="op" id="4763428">!=</span>&nbsp;<span class="ident" id="4763431">nil</span>&nbsp;<span class="op" id="4763435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763439">error_</span><span class="op" id="4763445">(</span><span class="ident" id="4763446">err</span><span class="op" id="4763449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763455">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763486">switch</span>&nbsp;<span class="ident" id="4763493">ut</span><span class="op" id="4763495">.</span><span class="ident" id="4763496">externalDec</span>&nbsp;<span class="op" id="4763508">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763511">case</span>&nbsp;<span class="ident" id="4763516">xGob</span><span class="op" id="4763520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763524">err</span>&nbsp;<span class="op" id="4763528">=</span>&nbsp;<span class="ident" id="4763530">value</span><span class="op" id="4763535">.</span><span class="ident" id="4763536">Interface</span><span class="op" id="4763545">(</span><span class="op" id="4763546">)</span><span class="op" id="4763547">.</span><span class="op" id="4763548">(</span><span class="ident" id="4763549">GobDecoder</span><span class="op" id="4763559">)</span><span class="op" id="4763560">.</span><span class="ident" id="4763561">GobDecode</span><span class="op" id="4763570">(</span><span class="ident" id="4763571">b</span><span class="op" id="4763572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763575">case</span>&nbsp;<span class="ident" id="4763580">xBinary</span><span class="op" id="4763587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763591">err</span>&nbsp;<span class="op" id="4763595">=</span>&nbsp;<span class="ident" id="4763597">value</span><span class="op" id="4763602">.</span><span class="ident" id="4763603">Interface</span><span class="op" id="4763612">(</span><span class="op" id="4763613">)</span><span class="op" id="4763614">.</span><span class="op" id="4763615">(</span><span class="ident" id="4763616">encoding</span><span class="op" id="4763624">.</span><span class="ident" id="4763625">BinaryUnmarshaler</span><span class="op" id="4763642">)</span><span class="op" id="4763643">.</span><span class="ident" id="4763644">UnmarshalBinary</span><span class="op" id="4763659">(</span><span class="ident" id="4763660">b</span><span class="op" id="4763661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763664">case</span>&nbsp;<span class="ident" id="4763669">xText</span><span class="op" id="4763674">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763678">err</span>&nbsp;<span class="op" id="4763682">=</span>&nbsp;<span class="ident" id="4763684">value</span><span class="op" id="4763689">.</span><span class="ident" id="4763690">Interface</span><span class="op" id="4763699">(</span><span class="op" id="4763700">)</span><span class="op" id="4763701">.</span><span class="op" id="4763702">(</span><span class="ident" id="4763703">encoding</span><span class="op" id="4763711">.</span><span class="ident" id="4763712">TextUnmarshaler</span><span class="op" id="4763727">)</span><span class="op" id="4763728">.</span><span class="ident" id="4763729">UnmarshalText</span><span class="op" id="4763742">(</span><span class="ident" id="4763743">b</span><span class="op" id="4763744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763750">if</span>&nbsp;<span class="ident" id="4763753">err</span>&nbsp;<span class="op" id="4763757">!=</span>&nbsp;<span class="ident" id="4763760">nil</span>&nbsp;<span class="op" id="4763764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763768">error_</span><span class="op" id="4763774">(</span><span class="ident" id="4763775">err</span><span class="op" id="4763778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763781">}</span><br>
<span class="lineno">715</span><span class="op" id="4763783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4763786">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4763868">func</span>&nbsp;<span class="op" id="4763873">(</span><span class="ident" id="4763874">dec</span>&nbsp;<span class="op" id="4763878">*</span><span class="ident" id="4763879">Decoder</span><span class="op" id="4763886">)</span>&nbsp;<span class="ident" id="4763888">ignoreGobDecoder</span><span class="op" id="4763904">(</span><span class="ident" id="4763905">state</span>&nbsp;<span class="op" id="4763911">*</span><span class="ident" id="4763912">decoderState</span><span class="op" id="4763924">)</span>&nbsp;<span class="op" id="4763926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763929">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763963">b</span>&nbsp;<span class="op" id="4763965">:=</span>&nbsp;<span class="builtinfunc" id="4763968">make</span><span class="op" id="4763972">(</span><span class="op" id="4763973">[</span><span class="op" id="4763974">]</span><span class="builtintype" id="4763975">byte</span><span class="op" id="4763979">,</span>&nbsp;<span class="ident" id="4763981">state</span><span class="op" id="4763986">.</span><span class="ident" id="4763987">decodeUint</span><span class="op" id="4763997">(</span><span class="op" id="4763998">)</span><span class="op" id="4763999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764002">_</span><span class="op" id="4764003">,</span>&nbsp;<span class="ident" id="4764005">err</span>&nbsp;<span class="op" id="4764009">:=</span>&nbsp;<span class="ident" id="4764012">state</span><span class="op" id="4764017">.</span><span class="ident" id="4764018">b</span><span class="op" id="4764019">.</span><span class="ident" id="4764020">Read</span><span class="op" id="4764024">(</span><span class="ident" id="4764025">b</span><span class="op" id="4764026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764029">if</span>&nbsp;<span class="ident" id="4764032">err</span>&nbsp;<span class="op" id="4764036">!=</span>&nbsp;<span class="ident" id="4764039">nil</span>&nbsp;<span class="op" id="4764043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764047">error_</span><span class="op" id="4764053">(</span><span class="ident" id="4764054">err</span><span class="op" id="4764057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4764060">}</span><br>
<span class="lineno">725</span><span class="op" id="4764062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4764065">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4764087">var</span>&nbsp;<span class="ident" id="4764091">decOpTable</span>&nbsp;<span class="op" id="4764102">=</span>&nbsp;<span class="op" id="4764104">[</span><span class="op" id="4764105">...</span><span class="op" id="4764108">]</span><span class="ident" id="4764109">decOp</span><span class="op" id="4764114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764117">reflect</span><span class="op" id="4764124">.</span><span class="ident" id="4764125">Bool</span><span class="op" id="4764129">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764137">decBool</span><span class="op" id="4764144">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764147">reflect</span><span class="op" id="4764154">.</span><span class="ident" id="4764155">Int8</span><span class="op" id="4764159">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764167">decInt8</span><span class="op" id="4764174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764177">reflect</span><span class="op" id="4764184">.</span><span class="ident" id="4764185">Int16</span><span class="op" id="4764190">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764197">decInt16</span><span class="op" id="4764205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764208">reflect</span><span class="op" id="4764215">.</span><span class="ident" id="4764216">Int32</span><span class="op" id="4764221">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764228">decInt32</span><span class="op" id="4764236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764239">reflect</span><span class="op" id="4764246">.</span><span class="ident" id="4764247">Int64</span><span class="op" id="4764252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764259">decInt64</span><span class="op" id="4764267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764270">reflect</span><span class="op" id="4764277">.</span><span class="ident" id="4764278">Uint8</span><span class="op" id="4764283">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764290">decUint8</span><span class="op" id="4764298">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764301">reflect</span><span class="op" id="4764308">.</span><span class="ident" id="4764309">Uint16</span><span class="op" id="4764315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764321">decUint16</span><span class="op" id="4764330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764333">reflect</span><span class="op" id="4764340">.</span><span class="ident" id="4764341">Uint32</span><span class="op" id="4764347">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764353">decUint32</span><span class="op" id="4764362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764365">reflect</span><span class="op" id="4764372">.</span><span class="ident" id="4764373">Uint64</span><span class="op" id="4764379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764385">decUint64</span><span class="op" id="4764394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764397">reflect</span><span class="op" id="4764404">.</span><span class="ident" id="4764405">Float32</span><span class="op" id="4764412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764417">decFloat32</span><span class="op" id="4764427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764430">reflect</span><span class="op" id="4764437">.</span><span class="ident" id="4764438">Float64</span><span class="op" id="4764445">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764450">decFloat64</span><span class="op" id="4764460">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764463">reflect</span><span class="op" id="4764470">.</span><span class="ident" id="4764471">Complex64</span><span class="op" id="4764480">:</span>&nbsp;&nbsp;<span class="ident" id="4764483">decComplex64</span><span class="op" id="4764495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764498">reflect</span><span class="op" id="4764505">.</span><span class="ident" id="4764506">Complex128</span><span class="op" id="4764516">:</span>&nbsp;<span class="ident" id="4764518">decComplex128</span><span class="op" id="4764531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764534">reflect</span><span class="op" id="4764541">.</span><span class="ident" id="4764542">String</span><span class="op" id="4764548">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764554">decString</span><span class="op" id="4764563">,</span><br>
<span class="lineno"></span><span class="op" id="4764565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="4764568">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="4764637">var</span>&nbsp;<span class="ident" id="4764641">decIgnoreOpMap</span>&nbsp;<span class="op" id="4764656">=</span>&nbsp;<span class="keyword" id="4764658">map</span><span class="op" id="4764661">[</span><span class="ident" id="4764662">typeId</span><span class="op" id="4764668">]</span><span class="ident" id="4764669">decOp</span><span class="op" id="4764674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764677">tBool</span><span class="op" id="4764682">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764687">ignoreUint</span><span class="op" id="4764697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764700">tInt</span><span class="op" id="4764704">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764710">ignoreUint</span><span class="op" id="4764720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764723">tUint</span><span class="op" id="4764728">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764733">ignoreUint</span><span class="op" id="4764743">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764746">tFloat</span><span class="op" id="4764752">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4764756">ignoreUint</span><span class="op" id="4764766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764769">tBytes</span><span class="op" id="4764775">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4764779">ignoreUint8Array</span><span class="op" id="4764795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764798">tString</span><span class="op" id="4764805">:</span>&nbsp;&nbsp;<span class="ident" id="4764808">ignoreUint8Array</span><span class="op" id="4764824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764827">tComplex</span><span class="op" id="4764835">:</span>&nbsp;<span class="ident" id="4764837">ignoreTwoUints</span><span class="op" id="4764851">,</span><br>
<span class="lineno"></span><span class="op" id="4764853">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="4764856">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4764923">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4764961">func</span>&nbsp;<span class="op" id="4764966">(</span><span class="ident" id="4764967">dec</span>&nbsp;<span class="op" id="4764971">*</span><span class="ident" id="4764972">Decoder</span><span class="op" id="4764979">)</span>&nbsp;<span class="ident" id="4764981">decOpFor</span><span class="op" id="4764989">(</span><span class="ident" id="4764990">wireId</span>&nbsp;<span class="ident" id="4764997">typeId</span><span class="op" id="4765003">,</span>&nbsp;<span class="ident" id="4765005">rt</span>&nbsp;<span class="ident" id="4765008">reflect</span><span class="op" id="4765015">.</span><span class="ident" id="4765016">Type</span><span class="op" id="4765020">,</span>&nbsp;<span class="ident" id="4765022">name</span>&nbsp;<span class="builtintype" id="4765027">string</span><span class="op" id="4765033">,</span>&nbsp;<span class="ident" id="4765035">inProgress</span>&nbsp;<span class="keyword" id="4765046">map</span><span class="op" id="4765049">[</span><span class="ident" id="4765050">reflect</span><span class="op" id="4765057">.</span><span class="ident" id="4765058">Type</span><span class="op" id="4765062">]</span><span class="op" id="4765063">*</span><span class="ident" id="4765064">decOp</span><span class="op" id="4765069">)</span>&nbsp;<span class="op" id="4765071">*</span><span class="ident" id="4765072">decOp</span>&nbsp;<span class="op" id="4765078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765081">ut</span>&nbsp;<span class="op" id="4765084">:=</span>&nbsp;<span class="ident" id="4765087">userType</span><span class="op" id="4765095">(</span><span class="ident" id="4765096">rt</span><span class="op" id="4765098">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765101">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765181">if</span>&nbsp;<span class="ident" id="4765184">ut</span><span class="op" id="4765186">.</span><span class="ident" id="4765187">externalDec</span>&nbsp;<span class="op" id="4765199">!=</span>&nbsp;<span class="num" id="4765202">0</span>&nbsp;<span class="op" id="4765204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765208">return</span>&nbsp;<span class="ident" id="4765215">dec</span><span class="op" id="4765218">.</span><span class="ident" id="4765219">gobDecodeOpFor</span><span class="op" id="4765233">(</span><span class="ident" id="4765234">ut</span><span class="op" id="4765236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765243">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765328">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765385">if</span>&nbsp;<span class="ident" id="4765388">opPtr</span>&nbsp;<span class="op" id="4765394">:=</span>&nbsp;<span class="ident" id="4765397">inProgress</span><span class="op" id="4765407">[</span><span class="ident" id="4765408">rt</span><span class="op" id="4765410">]</span><span class="op" id="4765411">;</span>&nbsp;<span class="ident" id="4765413">opPtr</span>&nbsp;<span class="op" id="4765419">!=</span>&nbsp;<span class="ident" id="4765422">nil</span>&nbsp;<span class="op" id="4765426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765430">return</span>&nbsp;<span class="ident" id="4765437">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765444">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765447">typ</span>&nbsp;<span class="op" id="4765451">:=</span>&nbsp;<span class="ident" id="4765454">ut</span><span class="op" id="4765456">.</span><span class="ident" id="4765457">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765463">var</span>&nbsp;<span class="ident" id="4765467">op</span>&nbsp;<span class="ident" id="4765470">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765477">k</span>&nbsp;<span class="op" id="4765479">:=</span>&nbsp;<span class="ident" id="4765482">typ</span><span class="op" id="4765485">.</span><span class="ident" id="4765486">Kind</span><span class="op" id="4765490">(</span><span class="op" id="4765491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765494">if</span>&nbsp;<span class="builtintype" id="4765497">int</span><span class="op" id="4765500">(</span><span class="ident" id="4765501">k</span><span class="op" id="4765502">)</span>&nbsp;<span class="op" id="4765504">&lt;</span>&nbsp;<span class="builtinfunc" id="4765506">len</span><span class="op" id="4765509">(</span><span class="ident" id="4765510">decOpTable</span><span class="op" id="4765520">)</span>&nbsp;<span class="op" id="4765522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765526">op</span>&nbsp;<span class="op" id="4765529">=</span>&nbsp;<span class="ident" id="4765531">decOpTable</span><span class="op" id="4765541">[</span><span class="ident" id="4765542">k</span><span class="op" id="4765543">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765549">if</span>&nbsp;<span class="ident" id="4765552">op</span>&nbsp;<span class="op" id="4765555">==</span>&nbsp;<span class="ident" id="4765558">nil</span>&nbsp;<span class="op" id="4765562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765566">inProgress</span><span class="op" id="4765576">[</span><span class="ident" id="4765577">rt</span><span class="op" id="4765579">]</span>&nbsp;<span class="op" id="4765581">=</span>&nbsp;<span class="op" id="4765583">&amp;</span><span class="ident" id="4765584">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765589">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765608">switch</span>&nbsp;<span class="ident" id="4765615">t</span>&nbsp;<span class="op" id="4765617">:=</span>&nbsp;<span class="ident" id="4765620">typ</span><span class="op" id="4765623">;</span>&nbsp;<span class="ident" id="4765625">t</span><span class="op" id="4765626">.</span><span class="ident" id="4765627">Kind</span><span class="op" id="4765631">(</span><span class="op" id="4765632">)</span>&nbsp;<span class="op" id="4765634">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765638">case</span>&nbsp;<span class="ident" id="4765643">reflect</span><span class="op" id="4765650">.</span><span class="ident" id="4765651">Array</span><span class="op" id="4765656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765661">name</span>&nbsp;<span class="op" id="4765666">=</span>&nbsp;<span class="string" id="4765668">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4765682">+</span>&nbsp;<span class="ident" id="4765684">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765692">elemId</span>&nbsp;<span class="op" id="4765699">:=</span>&nbsp;<span class="ident" id="4765702">dec</span><span class="op" id="4765705">.</span><span class="ident" id="4765706">wireType</span><span class="op" id="4765714">[</span><span class="ident" id="4765715">wireId</span><span class="op" id="4765721">]</span><span class="op" id="4765722">.</span><span class="ident" id="4765723">ArrayT</span><span class="op" id="4765729">.</span><span class="ident" id="4765730">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765738">elemOp</span>&nbsp;<span class="op" id="4765745">:=</span>&nbsp;<span class="ident" id="4765748">dec</span><span class="op" id="4765751">.</span><span class="ident" id="4765752">decOpFor</span><span class="op" id="4765760">(</span><span class="ident" id="4765761">elemId</span><span class="op" id="4765767">,</span>&nbsp;<span class="ident" id="4765769">t</span><span class="op" id="4765770">.</span><span class="ident" id="4765771">Elem</span><span class="op" id="4765775">(</span><span class="op" id="4765776">)</span><span class="op" id="4765777">,</span>&nbsp;<span class="ident" id="4765779">name</span><span class="op" id="4765783">,</span>&nbsp;<span class="ident" id="4765785">inProgress</span><span class="op" id="4765795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765800">ovfl</span>&nbsp;<span class="op" id="4765805">:=</span>&nbsp;<span class="ident" id="4765808">overflow</span><span class="op" id="4765816">(</span><span class="ident" id="4765817">name</span><span class="op" id="4765821">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765826">helper</span>&nbsp;<span class="op" id="4765833">:=</span>&nbsp;<span class="ident" id="4765836">decArrayHelper</span><span class="op" id="4765850">[</span><span class="ident" id="4765851">t</span><span class="op" id="4765852">.</span><span class="ident" id="4765853">Elem</span><span class="op" id="4765857">(</span><span class="op" id="4765858">)</span><span class="op" id="4765859">.</span><span class="ident" id="4765860">Kind</span><span class="op" id="4765864">(</span><span class="op" id="4765865">)</span><span class="op" id="4765866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765871">op</span>&nbsp;<span class="op" id="4765874">=</span>&nbsp;<span class="keyword" id="4765876">func</span><span class="op" id="4765880">(</span><span class="ident" id="4765881">i</span>&nbsp;<span class="op" id="4765883">*</span><span class="ident" id="4765884">decInstr</span><span class="op" id="4765892">,</span>&nbsp;<span class="ident" id="4765894">state</span>&nbsp;<span class="op" id="4765900">*</span><span class="ident" id="4765901">decoderState</span><span class="op" id="4765913">,</span>&nbsp;<span class="ident" id="4765915">value</span>&nbsp;<span class="ident" id="4765921">reflect</span><span class="op" id="4765928">.</span><span class="ident" id="4765929">Value</span><span class="op" id="4765934">)</span>&nbsp;<span class="op" id="4765936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765942">state</span><span class="op" id="4765947">.</span><span class="ident" id="4765948">dec</span><span class="op" id="4765951">.</span><span class="ident" id="4765952">decodeArray</span><span class="op" id="4765963">(</span><span class="ident" id="4765964">t</span><span class="op" id="4765965">,</span>&nbsp;<span class="ident" id="4765967">state</span><span class="op" id="4765972">,</span>&nbsp;<span class="ident" id="4765974">value</span><span class="op" id="4765979">,</span>&nbsp;<span class="op" id="4765981">*</span><span class="ident" id="4765982">elemOp</span><span class="op" id="4765988">,</span>&nbsp;<span class="ident" id="4765990">t</span><span class="op" id="4765991">.</span><span class="ident" id="4765992">Len</span><span class="op" id="4765995">(</span><span class="op" id="4765996">)</span><span class="op" id="4765997">,</span>&nbsp;<span class="ident" id="4765999">ovfl</span><span class="op" id="4766003">,</span>&nbsp;<span class="ident" id="4766005">helper</span><span class="op" id="4766011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766021">case</span>&nbsp;<span class="ident" id="4766026">reflect</span><span class="op" id="4766033">.</span><span class="ident" id="4766034">Map</span><span class="op" id="4766037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766042">keyId</span>&nbsp;<span class="op" id="4766048">:=</span>&nbsp;<span class="ident" id="4766051">dec</span><span class="op" id="4766054">.</span><span class="ident" id="4766055">wireType</span><span class="op" id="4766063">[</span><span class="ident" id="4766064">wireId</span><span class="op" id="4766070">]</span><span class="op" id="4766071">.</span><span class="ident" id="4766072">MapT</span><span class="op" id="4766076">.</span><span class="ident" id="4766077">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766084">elemId</span>&nbsp;<span class="op" id="4766091">:=</span>&nbsp;<span class="ident" id="4766094">dec</span><span class="op" id="4766097">.</span><span class="ident" id="4766098">wireType</span><span class="op" id="4766106">[</span><span class="ident" id="4766107">wireId</span><span class="op" id="4766113">]</span><span class="op" id="4766114">.</span><span class="ident" id="4766115">MapT</span><span class="op" id="4766119">.</span><span class="ident" id="4766120">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766128">keyOp</span>&nbsp;<span class="op" id="4766134">:=</span>&nbsp;<span class="ident" id="4766137">dec</span><span class="op" id="4766140">.</span><span class="ident" id="4766141">decOpFor</span><span class="op" id="4766149">(</span><span class="ident" id="4766150">keyId</span><span class="op" id="4766155">,</span>&nbsp;<span class="ident" id="4766157">t</span><span class="op" id="4766158">.</span><span class="ident" id="4766159">Key</span><span class="op" id="4766162">(</span><span class="op" id="4766163">)</span><span class="op" id="4766164">,</span>&nbsp;<span class="string" id="4766166">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="4766175">+</span><span class="ident" id="4766176">name</span><span class="op" id="4766180">,</span>&nbsp;<span class="ident" id="4766182">inProgress</span><span class="op" id="4766192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766197">elemOp</span>&nbsp;<span class="op" id="4766204">:=</span>&nbsp;<span class="ident" id="4766207">dec</span><span class="op" id="4766210">.</span><span class="ident" id="4766211">decOpFor</span><span class="op" id="4766219">(</span><span class="ident" id="4766220">elemId</span><span class="op" id="4766226">,</span>&nbsp;<span class="ident" id="4766228">t</span><span class="op" id="4766229">.</span><span class="ident" id="4766230">Elem</span><span class="op" id="4766234">(</span><span class="op" id="4766235">)</span><span class="op" id="4766236">,</span>&nbsp;<span class="string" id="4766238">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="4766251">+</span><span class="ident" id="4766252">name</span><span class="op" id="4766256">,</span>&nbsp;<span class="ident" id="4766258">inProgress</span><span class="op" id="4766268">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766273">ovfl</span>&nbsp;<span class="op" id="4766278">:=</span>&nbsp;<span class="ident" id="4766281">overflow</span><span class="op" id="4766289">(</span><span class="ident" id="4766290">name</span><span class="op" id="4766294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766299">op</span>&nbsp;<span class="op" id="4766302">=</span>&nbsp;<span class="keyword" id="4766304">func</span><span class="op" id="4766308">(</span><span class="ident" id="4766309">i</span>&nbsp;<span class="op" id="4766311">*</span><span class="ident" id="4766312">decInstr</span><span class="op" id="4766320">,</span>&nbsp;<span class="ident" id="4766322">state</span>&nbsp;<span class="op" id="4766328">*</span><span class="ident" id="4766329">decoderState</span><span class="op" id="4766341">,</span>&nbsp;<span class="ident" id="4766343">value</span>&nbsp;<span class="ident" id="4766349">reflect</span><span class="op" id="4766356">.</span><span class="ident" id="4766357">Value</span><span class="op" id="4766362">)</span>&nbsp;<span class="op" id="4766364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766370">state</span><span class="op" id="4766375">.</span><span class="ident" id="4766376">dec</span><span class="op" id="4766379">.</span><span class="ident" id="4766380">decodeMap</span><span class="op" id="4766389">(</span><span class="ident" id="4766390">t</span><span class="op" id="4766391">,</span>&nbsp;<span class="ident" id="4766393">state</span><span class="op" id="4766398">,</span>&nbsp;<span class="ident" id="4766400">value</span><span class="op" id="4766405">,</span>&nbsp;<span class="op" id="4766407">*</span><span class="ident" id="4766408">keyOp</span><span class="op" id="4766413">,</span>&nbsp;<span class="op" id="4766415">*</span><span class="ident" id="4766416">elemOp</span><span class="op" id="4766422">,</span>&nbsp;<span class="ident" id="4766424">ovfl</span><span class="op" id="4766428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766438">case</span>&nbsp;<span class="ident" id="4766443">reflect</span><span class="op" id="4766450">.</span><span class="ident" id="4766451">Slice</span><span class="op" id="4766456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766461">name</span>&nbsp;<span class="op" id="4766466">=</span>&nbsp;<span class="string" id="4766468">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4766482">+</span>&nbsp;<span class="ident" id="4766484">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766492">if</span>&nbsp;<span class="ident" id="4766495">t</span><span class="op" id="4766496">.</span><span class="ident" id="4766497">Elem</span><span class="op" id="4766501">(</span><span class="op" id="4766502">)</span><span class="op" id="4766503">.</span><span class="ident" id="4766504">Kind</span><span class="op" id="4766508">(</span><span class="op" id="4766509">)</span>&nbsp;<span class="op" id="4766511">==</span>&nbsp;<span class="ident" id="4766514">reflect</span><span class="op" id="4766521">.</span><span class="ident" id="4766522">Uint8</span>&nbsp;<span class="op" id="4766528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766534">op</span>&nbsp;<span class="op" id="4766537">=</span>&nbsp;<span class="ident" id="4766539">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766557">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766571">var</span>&nbsp;<span class="ident" id="4766575">elemId</span>&nbsp;<span class="ident" id="4766582">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766592">if</span>&nbsp;<span class="ident" id="4766595">tt</span><span class="op" id="4766597">,</span>&nbsp;<span class="ident" id="4766599">ok</span>&nbsp;<span class="op" id="4766602">:=</span>&nbsp;<span class="ident" id="4766605">builtinIdToType</span><span class="op" id="4766620">[</span><span class="ident" id="4766621">wireId</span><span class="op" id="4766627">]</span><span class="op" id="4766628">;</span>&nbsp;<span class="ident" id="4766630">ok</span>&nbsp;<span class="op" id="4766633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766639">elemId</span>&nbsp;<span class="op" id="4766646">=</span>&nbsp;<span class="ident" id="4766648">tt</span><span class="op" id="4766650">.</span><span class="op" id="4766651">(</span><span class="op" id="4766652">*</span><span class="ident" id="4766653">sliceType</span><span class="op" id="4766662">)</span><span class="op" id="4766663">.</span><span class="ident" id="4766664">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766672">}</span>&nbsp;<span class="keyword" id="4766674">else</span>&nbsp;<span class="op" id="4766679">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766685">elemId</span>&nbsp;<span class="op" id="4766692">=</span>&nbsp;<span class="ident" id="4766694">dec</span><span class="op" id="4766697">.</span><span class="ident" id="4766698">wireType</span><span class="op" id="4766706">[</span><span class="ident" id="4766707">wireId</span><span class="op" id="4766713">]</span><span class="op" id="4766714">.</span><span class="ident" id="4766715">SliceT</span><span class="op" id="4766721">.</span><span class="ident" id="4766722">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766735">elemOp</span>&nbsp;<span class="op" id="4766742">:=</span>&nbsp;<span class="ident" id="4766745">dec</span><span class="op" id="4766748">.</span><span class="ident" id="4766749">decOpFor</span><span class="op" id="4766757">(</span><span class="ident" id="4766758">elemId</span><span class="op" id="4766764">,</span>&nbsp;<span class="ident" id="4766766">t</span><span class="op" id="4766767">.</span><span class="ident" id="4766768">Elem</span><span class="op" id="4766772">(</span><span class="op" id="4766773">)</span><span class="op" id="4766774">,</span>&nbsp;<span class="ident" id="4766776">name</span><span class="op" id="4766780">,</span>&nbsp;<span class="ident" id="4766782">inProgress</span><span class="op" id="4766792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766797">ovfl</span>&nbsp;<span class="op" id="4766802">:=</span>&nbsp;<span class="ident" id="4766805">overflow</span><span class="op" id="4766813">(</span><span class="ident" id="4766814">name</span><span class="op" id="4766818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766823">helper</span>&nbsp;<span class="op" id="4766830">:=</span>&nbsp;<span class="ident" id="4766833">decSliceHelper</span><span class="op" id="4766847">[</span><span class="ident" id="4766848">t</span><span class="op" id="4766849">.</span><span class="ident" id="4766850">Elem</span><span class="op" id="4766854">(</span><span class="op" id="4766855">)</span><span class="op" id="4766856">.</span><span class="ident" id="4766857">Kind</span><span class="op" id="4766861">(</span><span class="op" id="4766862">)</span><span class="op" id="4766863">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766868">op</span>&nbsp;<span class="op" id="4766871">=</span>&nbsp;<span class="keyword" id="4766873">func</span><span class="op" id="4766877">(</span><span class="ident" id="4766878">i</span>&nbsp;<span class="op" id="4766880">*</span><span class="ident" id="4766881">decInstr</span><span class="op" id="4766889">,</span>&nbsp;<span class="ident" id="4766891">state</span>&nbsp;<span class="op" id="4766897">*</span><span class="ident" id="4766898">decoderState</span><span class="op" id="4766910">,</span>&nbsp;<span class="ident" id="4766912">value</span>&nbsp;<span class="ident" id="4766918">reflect</span><span class="op" id="4766925">.</span><span class="ident" id="4766926">Value</span><span class="op" id="4766931">)</span>&nbsp;<span class="op" id="4766933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766939">state</span><span class="op" id="4766944">.</span><span class="ident" id="4766945">dec</span><span class="op" id="4766948">.</span><span class="ident" id="4766949">decodeSlice</span><span class="op" id="4766960">(</span><span class="ident" id="4766961">state</span><span class="op" id="4766966">,</span>&nbsp;<span class="ident" id="4766968">value</span><span class="op" id="4766973">,</span>&nbsp;<span class="op" id="4766975">*</span><span class="ident" id="4766976">elemOp</span><span class="op" id="4766982">,</span>&nbsp;<span class="ident" id="4766984">ovfl</span><span class="op" id="4766988">,</span>&nbsp;<span class="ident" id="4766990">helper</span><span class="op" id="4766996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4767001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4767006">case</span>&nbsp;<span class="ident" id="4767011">reflect</span><span class="op" id="4767018">.</span><span class="ident" id="4767019">Struct</span><span class="op" id="4767025">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4767030">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767105">ut</span>&nbsp;<span class="op" id="4767108">:=</span>&nbsp;<span class="ident" id="4767111">userType</span><span class="op" id="4767119">(</span><span class="ident" id="4767120">typ</span><span class="op" id="4767123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767128">enginePtr</span><span class="op" id="4767137">,</span>&nbsp;<span class="ident" id="4767139">err</span>&nbsp;<span class="op" id="4767143">:=</span>&nbsp;<span class="ident" id="4767146">dec</span><span class="op" id="4767149">.</span><span class="ident" id="4767150">getDecEnginePtr</span><span class="op" id="4767165">(</span><span class="ident" id="4767166">wireId</span><span class="op" id="4767172">,</span>&nbsp;<span class="ident" id="4767174">ut</span><span class="op" id="4767176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4767181">if</span>&nbsp;<span class="ident" id="4767184">err</span>&nbsp;<span class="op" id="4767188">!=</span>&nbsp;<span class="ident" id="4767191">nil</span>&nbsp;<span class="op" id="4767195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767201">error_</span><span class="op" id="4767207">(</span><span class="ident" id="4767208">err</span><span class="op" id="4767211">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4767216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767221">op</span>&nbsp;<span class="op" id="4767224">=</span>&nbsp;<span class="keyword" id="4767226">func</span><span class="op" id="4767230">(</span><span class="ident" id="4767231">i</span>&nbsp;<span class="op" id="4767233">*</span><span class="ident" id="4767234">decInstr</span><span class="op" id="4767242">,</span>&nbsp;<span class="ident" id="4767244">state</span>&nbsp;<span class="op" id="4767250">*</span><span class="ident" id="4767251">decoderState</span><span class="op" id="4767263">,</span>&nbsp;<span class="ident" id="4767265">value</span>&nbsp;<span class="ident" id="4767271">reflect</span><span class="op" id="4767278">.</span><span class="ident" id="4767279">Value</span><span class="op" id="4767284">)</span>&nbsp;<span class="op" id="4767286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4767292">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767369">dec</span><span class="op" id="4767372">.</span><span class="ident" id="4767373">decodeStruct</span><span class="op" id="4767385">(</span><span class="op" id="4767386">*</span><span class="ident" id="4767387">enginePtr</span><span class="op" id="4767396">,</span>&nbsp;<span class="ident" id="4767398">ut</span><span class="op" id="4767400">,</span>&nbsp;<span class="ident" id="4767402">value</span><span class="op" id="4767407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4767412">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4767416">case</span>&nbsp;<span class="ident" id="4767421">reflect</span><span class="op" id="4767428">.</span><span class="ident" id="4767429">Interface</span><span class="op" id="4767438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767443">op</span>&nbsp;<span class="op" id="4767446">=</span>&nbsp;<span class="keyword" id="4767448">func</span><span class="op" id="4767452">(</span><span class="ident" id="4767453">i</span>&nbsp;<span class="op" id="4767455">*</span><span class="ident" id="4767456">decInstr</span><span class="op" id="4767464">,</span>&nbsp;<span class="ident" id="4767466">state</span>&nbsp;<span class="op" id="4767472">*</span><span class="ident" id="4767473">decoderState</span><span class="op" id="4767485">,</span>&nbsp;<span class="ident" id="4767487">value</span>&nbsp;<span class="ident" id="4767493">reflect</span><span class="op" id="4767500">.</span><span class="ident" id="4767501">Value</span><span class="op" id="4767506">)</span>&nbsp;<span class="op" id="4767508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767514">state</span><span class="op" id="4767519">.</span><span class="ident" id="4767520">dec</span><span class="op" id="4767523">.</span><span class="ident" id="4767524">decodeInterface</span><span class="op" id="4767539">(</span><span class="ident" id="4767540">t</span><span class="op" id="4767541">,</span>&nbsp;<span class="ident" id="4767543">state</span><span class="op" id="4767548">,</span>&nbsp;<span class="ident" id="4767550">value</span><span class="op" id="4767555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4767560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4767564">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4767567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4767570">if</span>&nbsp;<span class="ident" id="4767573">op</span>&nbsp;<span class="op" id="4767576">==</span>&nbsp;<span class="ident" id="4767579">nil</span>&nbsp;<span class="op" id="4767583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767587">errorf</span><span class="op" id="4767593">(</span><span class="string" id="4767594">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4767623">,</span>&nbsp;<span class="ident" id="4767625">rt</span><span class="op" id="4767627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4767630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4767633">return</span>&nbsp;<span class="op" id="4767640">&amp;</span><span class="ident" id="4767641">op</span><br>
<span class="lineno">840</span><span class="op" id="4767644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4767647">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4767726">func</span>&nbsp;<span class="op" id="4767731">(</span><span class="ident" id="4767732">dec</span>&nbsp;<span class="op" id="4767736">*</span><span class="ident" id="4767737">Decoder</span><span class="op" id="4767744">)</span>&nbsp;<span class="ident" id="4767746">decIgnoreOpFor</span><span class="op" id="4767760">(</span><span class="ident" id="4767761">wireId</span>&nbsp;<span class="ident" id="4767768">typeId</span><span class="op" id="4767774">)</span>&nbsp;<span class="ident" id="4767776">decOp</span>&nbsp;<span class="op" id="4767782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767785">op</span><span class="op" id="4767787">,</span>&nbsp;<span class="ident" id="4767789">ok</span>&nbsp;<span class="op" id="4767792">:=</span>&nbsp;<span class="ident" id="4767795">decIgnoreOpMap</span><span class="op" id="4767809">[</span><span class="ident" id="4767810">wireId</span><span class="op" id="4767816">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4767819">if</span>&nbsp;<span class="op" id="4767822">!</span><span class="ident" id="4767823">ok</span>&nbsp;<span class="op" id="4767826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4767830">if</span>&nbsp;<span class="ident" id="4767833">wireId</span>&nbsp;<span class="op" id="4767840">==</span>&nbsp;<span class="ident" id="4767843">tInterface</span>&nbsp;<span class="op" id="4767854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4767859">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4767924">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4767993">op</span>&nbsp;<span class="op" id="4767996">=</span>&nbsp;<span class="keyword" id="4767998">func</span><span class="op" id="4768002">(</span><span class="ident" id="4768003">i</span>&nbsp;<span class="op" id="4768005">*</span><span class="ident" id="4768006">decInstr</span><span class="op" id="4768014">,</span>&nbsp;<span class="ident" id="4768016">state</span>&nbsp;<span class="op" id="4768022">*</span><span class="ident" id="4768023">decoderState</span><span class="op" id="4768035">,</span>&nbsp;<span class="ident" id="4768037">value</span>&nbsp;<span class="ident" id="4768043">reflect</span><span class="op" id="4768050">.</span><span class="ident" id="4768051">Value</span><span class="op" id="4768056">)</span>&nbsp;<span class="op" id="4768058">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768064">state</span><span class="op" id="4768069">.</span><span class="ident" id="4768070">dec</span><span class="op" id="4768073">.</span><span class="ident" id="4768074">ignoreInterface</span><span class="op" id="4768089">(</span><span class="ident" id="4768090">state</span><span class="op" id="4768095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4768100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4768105">return</span>&nbsp;<span class="ident" id="4768112">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4768117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4768121">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768140">wire</span>&nbsp;<span class="op" id="4768145">:=</span>&nbsp;<span class="ident" id="4768148">dec</span><span class="op" id="4768151">.</span><span class="ident" id="4768152">wireType</span><span class="op" id="4768160">[</span><span class="ident" id="4768161">wireId</span><span class="op" id="4768167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4768171">switch</span>&nbsp;<span class="op" id="4768178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4768182">case</span>&nbsp;<span class="ident" id="4768187">wire</span>&nbsp;<span class="op" id="4768192">==</span>&nbsp;<span class="ident" id="4768195">nil</span><span class="op" id="4768198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768203">errorf</span><span class="op" id="4768209">(</span><span class="string" id="4768210">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4768239">,</span>&nbsp;<span class="ident" id="4768241">wireId</span><span class="op" id="4768247">.</span><span class="builtintype" id="4768248">string</span><span class="op" id="4768254">(</span><span class="op" id="4768255">)</span><span class="op" id="4768256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4768260">case</span>&nbsp;<span class="ident" id="4768265">wire</span><span class="op" id="4768269">.</span><span class="ident" id="4768270">ArrayT</span>&nbsp;<span class="op" id="4768277">!=</span>&nbsp;<span class="ident" id="4768280">nil</span><span class="op" id="4768283">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768288">elemId</span>&nbsp;<span class="op" id="4768295">:=</span>&nbsp;<span class="ident" id="4768298">wire</span><span class="op" id="4768302">.</span><span class="ident" id="4768303">ArrayT</span><span class="op" id="4768309">.</span><span class="ident" id="4768310">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768318">elemOp</span>&nbsp;<span class="op" id="4768325">:=</span>&nbsp;<span class="ident" id="4768328">dec</span><span class="op" id="4768331">.</span><span class="ident" id="4768332">decIgnoreOpFor</span><span class="op" id="4768346">(</span><span class="ident" id="4768347">elemId</span><span class="op" id="4768353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768358">op</span>&nbsp;<span class="op" id="4768361">=</span>&nbsp;<span class="keyword" id="4768363">func</span><span class="op" id="4768367">(</span><span class="ident" id="4768368">i</span>&nbsp;<span class="op" id="4768370">*</span><span class="ident" id="4768371">decInstr</span><span class="op" id="4768379">,</span>&nbsp;<span class="ident" id="4768381">state</span>&nbsp;<span class="op" id="4768387">*</span><span class="ident" id="4768388">decoderState</span><span class="op" id="4768400">,</span>&nbsp;<span class="ident" id="4768402">value</span>&nbsp;<span class="ident" id="4768408">reflect</span><span class="op" id="4768415">.</span><span class="ident" id="4768416">Value</span><span class="op" id="4768421">)</span>&nbsp;<span class="op" id="4768423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768429">state</span><span class="op" id="4768434">.</span><span class="ident" id="4768435">dec</span><span class="op" id="4768438">.</span><span class="ident" id="4768439">ignoreArray</span><span class="op" id="4768450">(</span><span class="ident" id="4768451">state</span><span class="op" id="4768456">,</span>&nbsp;<span class="ident" id="4768458">elemOp</span><span class="op" id="4768464">,</span>&nbsp;<span class="ident" id="4768466">wire</span><span class="op" id="4768470">.</span><span class="ident" id="4768471">ArrayT</span><span class="op" id="4768477">.</span><span class="ident" id="4768478">Len</span><span class="op" id="4768481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4768486">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4768491">case</span>&nbsp;<span class="ident" id="4768496">wire</span><span class="op" id="4768500">.</span><span class="ident" id="4768501">MapT</span>&nbsp;<span class="op" id="4768506">!=</span>&nbsp;<span class="ident" id="4768509">nil</span><span class="op" id="4768512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768517">keyId</span>&nbsp;<span class="op" id="4768523">:=</span>&nbsp;<span class="ident" id="4768526">dec</span><span class="op" id="4768529">.</span><span class="ident" id="4768530">wireType</span><span class="op" id="4768538">[</span><span class="ident" id="4768539">wireId</span><span class="op" id="4768545">]</span><span class="op" id="4768546">.</span><span class="ident" id="4768547">MapT</span><span class="op" id="4768551">.</span><span class="ident" id="4768552">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768559">elemId</span>&nbsp;<span class="op" id="4768566">:=</span>&nbsp;<span class="ident" id="4768569">dec</span><span class="op" id="4768572">.</span><span class="ident" id="4768573">wireType</span><span class="op" id="4768581">[</span><span class="ident" id="4768582">wireId</span><span class="op" id="4768588">]</span><span class="op" id="4768589">.</span><span class="ident" id="4768590">MapT</span><span class="op" id="4768594">.</span><span class="ident" id="4768595">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768603">keyOp</span>&nbsp;<span class="op" id="4768609">:=</span>&nbsp;<span class="ident" id="4768612">dec</span><span class="op" id="4768615">.</span><span class="ident" id="4768616">decIgnoreOpFor</span><span class="op" id="4768630">(</span><span class="ident" id="4768631">keyId</span><span class="op" id="4768636">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768641">elemOp</span>&nbsp;<span class="op" id="4768648">:=</span>&nbsp;<span class="ident" id="4768651">dec</span><span class="op" id="4768654">.</span><span class="ident" id="4768655">decIgnoreOpFor</span><span class="op" id="4768669">(</span><span class="ident" id="4768670">elemId</span><span class="op" id="4768676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768681">op</span>&nbsp;<span class="op" id="4768684">=</span>&nbsp;<span class="keyword" id="4768686">func</span><span class="op" id="4768690">(</span><span class="ident" id="4768691">i</span>&nbsp;<span class="op" id="4768693">*</span><span class="ident" id="4768694">decInstr</span><span class="op" id="4768702">,</span>&nbsp;<span class="ident" id="4768704">state</span>&nbsp;<span class="op" id="4768710">*</span><span class="ident" id="4768711">decoderState</span><span class="op" id="4768723">,</span>&nbsp;<span class="ident" id="4768725">value</span>&nbsp;<span class="ident" id="4768731">reflect</span><span class="op" id="4768738">.</span><span class="ident" id="4768739">Value</span><span class="op" id="4768744">)</span>&nbsp;<span class="op" id="4768746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768752">state</span><span class="op" id="4768757">.</span><span class="ident" id="4768758">dec</span><span class="op" id="4768761">.</span><span class="ident" id="4768762">ignoreMap</span><span class="op" id="4768771">(</span><span class="ident" id="4768772">state</span><span class="op" id="4768777">,</span>&nbsp;<span class="ident" id="4768779">keyOp</span><span class="op" id="4768784">,</span>&nbsp;<span class="ident" id="4768786">elemOp</span><span class="op" id="4768792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4768797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4768802">case</span>&nbsp;<span class="ident" id="4768807">wire</span><span class="op" id="4768811">.</span><span class="ident" id="4768812">SliceT</span>&nbsp;<span class="op" id="4768819">!=</span>&nbsp;<span class="ident" id="4768822">nil</span><span class="op" id="4768825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768830">elemId</span>&nbsp;<span class="op" id="4768837">:=</span>&nbsp;<span class="ident" id="4768840">wire</span><span class="op" id="4768844">.</span><span class="ident" id="4768845">SliceT</span><span class="op" id="4768851">.</span><span class="ident" id="4768852">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768860">elemOp</span>&nbsp;<span class="op" id="4768867">:=</span>&nbsp;<span class="ident" id="4768870">dec</span><span class="op" id="4768873">.</span><span class="ident" id="4768874">decIgnoreOpFor</span><span class="op" id="4768888">(</span><span class="ident" id="4768889">elemId</span><span class="op" id="4768895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768900">op</span>&nbsp;<span class="op" id="4768903">=</span>&nbsp;<span class="keyword" id="4768905">func</span><span class="op" id="4768909">(</span><span class="ident" id="4768910">i</span>&nbsp;<span class="op" id="4768912">*</span><span class="ident" id="4768913">decInstr</span><span class="op" id="4768921">,</span>&nbsp;<span class="ident" id="4768923">state</span>&nbsp;<span class="op" id="4768929">*</span><span class="ident" id="4768930">decoderState</span><span class="op" id="4768942">,</span>&nbsp;<span class="ident" id="4768944">value</span>&nbsp;<span class="ident" id="4768950">reflect</span><span class="op" id="4768957">.</span><span class="ident" id="4768958">Value</span><span class="op" id="4768963">)</span>&nbsp;<span class="op" id="4768965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4768971">state</span><span class="op" id="4768976">.</span><span class="ident" id="4768977">dec</span><span class="op" id="4768980">.</span><span class="ident" id="4768981">ignoreSlice</span><span class="op" id="4768992">(</span><span class="ident" id="4768993">state</span><span class="op" id="4768998">,</span>&nbsp;<span class="ident" id="4769000">elemOp</span><span class="op" id="4769006">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4769016">case</span>&nbsp;<span class="ident" id="4769021">wire</span><span class="op" id="4769025">.</span><span class="ident" id="4769026">StructT</span>&nbsp;<span class="op" id="4769034">!=</span>&nbsp;<span class="ident" id="4769037">nil</span><span class="op" id="4769040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4769045">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769120">enginePtr</span><span class="op" id="4769129">,</span>&nbsp;<span class="ident" id="4769131">err</span>&nbsp;<span class="op" id="4769135">:=</span>&nbsp;<span class="ident" id="4769138">dec</span><span class="op" id="4769141">.</span><span class="ident" id="4769142">getIgnoreEnginePtr</span><span class="op" id="4769160">(</span><span class="ident" id="4769161">wireId</span><span class="op" id="4769167">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4769172">if</span>&nbsp;<span class="ident" id="4769175">err</span>&nbsp;<span class="op" id="4769179">!=</span>&nbsp;<span class="ident" id="4769182">nil</span>&nbsp;<span class="op" id="4769186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769192">error_</span><span class="op" id="4769198">(</span><span class="ident" id="4769199">err</span><span class="op" id="4769202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769212">op</span>&nbsp;<span class="op" id="4769215">=</span>&nbsp;<span class="keyword" id="4769217">func</span><span class="op" id="4769221">(</span><span class="ident" id="4769222">i</span>&nbsp;<span class="op" id="4769224">*</span><span class="ident" id="4769225">decInstr</span><span class="op" id="4769233">,</span>&nbsp;<span class="ident" id="4769235">state</span>&nbsp;<span class="op" id="4769241">*</span><span class="ident" id="4769242">decoderState</span><span class="op" id="4769254">,</span>&nbsp;<span class="ident" id="4769256">value</span>&nbsp;<span class="ident" id="4769262">reflect</span><span class="op" id="4769269">.</span><span class="ident" id="4769270">Value</span><span class="op" id="4769275">)</span>&nbsp;<span class="op" id="4769277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4769283">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769359">state</span><span class="op" id="4769364">.</span><span class="ident" id="4769365">dec</span><span class="op" id="4769368">.</span><span class="ident" id="4769369">ignoreStruct</span><span class="op" id="4769381">(</span><span class="op" id="4769382">*</span><span class="ident" id="4769383">enginePtr</span><span class="op" id="4769392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4769402">case</span>&nbsp;<span class="ident" id="4769407">wire</span><span class="op" id="4769411">.</span><span class="ident" id="4769412">GobEncoderT</span>&nbsp;<span class="op" id="4769424">!=</span>&nbsp;<span class="ident" id="4769427">nil</span><span class="op" id="4769430">,</span>&nbsp;<span class="ident" id="4769432">wire</span><span class="op" id="4769436">.</span><span class="ident" id="4769437">BinaryMarshalerT</span>&nbsp;<span class="op" id="4769454">!=</span>&nbsp;<span class="ident" id="4769457">nil</span><span class="op" id="4769460">,</span>&nbsp;<span class="ident" id="4769462">wire</span><span class="op" id="4769466">.</span><span class="ident" id="4769467">TextMarshalerT</span>&nbsp;<span class="op" id="4769482">!=</span>&nbsp;<span class="ident" id="4769485">nil</span><span class="op" id="4769488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769493">op</span>&nbsp;<span class="op" id="4769496">=</span>&nbsp;<span class="keyword" id="4769498">func</span><span class="op" id="4769502">(</span><span class="ident" id="4769503">i</span>&nbsp;<span class="op" id="4769505">*</span><span class="ident" id="4769506">decInstr</span><span class="op" id="4769514">,</span>&nbsp;<span class="ident" id="4769516">state</span>&nbsp;<span class="op" id="4769522">*</span><span class="ident" id="4769523">decoderState</span><span class="op" id="4769535">,</span>&nbsp;<span class="ident" id="4769537">value</span>&nbsp;<span class="ident" id="4769543">reflect</span><span class="op" id="4769550">.</span><span class="ident" id="4769551">Value</span><span class="op" id="4769556">)</span>&nbsp;<span class="op" id="4769558">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769564">state</span><span class="op" id="4769569">.</span><span class="ident" id="4769570">dec</span><span class="op" id="4769573">.</span><span class="ident" id="4769574">ignoreGobDecoder</span><span class="op" id="4769590">(</span><span class="ident" id="4769591">state</span><span class="op" id="4769596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4769611">if</span>&nbsp;<span class="ident" id="4769614">op</span>&nbsp;<span class="op" id="4769617">==</span>&nbsp;<span class="ident" id="4769620">nil</span>&nbsp;<span class="op" id="4769624">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769628">errorf</span><span class="op" id="4769634">(</span><span class="string" id="4769635">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4769674">,</span>&nbsp;<span class="ident" id="4769676">wireId</span><span class="op" id="4769682">.</span><span class="builtintype" id="4769683">string</span><span class="op" id="4769689">(</span><span class="op" id="4769690">)</span><span class="op" id="4769691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4769697">return</span>&nbsp;<span class="ident" id="4769704">op</span><br>
<span class="lineno"></span><span class="op" id="4769707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="4769710">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="4769781">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4769796">func</span>&nbsp;<span class="op" id="4769801">(</span><span class="ident" id="4769802">dec</span>&nbsp;<span class="op" id="4769806">*</span><span class="ident" id="4769807">Decoder</span><span class="op" id="4769814">)</span>&nbsp;<span class="ident" id="4769816">gobDecodeOpFor</span><span class="op" id="4769830">(</span><span class="ident" id="4769831">ut</span>&nbsp;<span class="op" id="4769834">*</span><span class="ident" id="4769835">userTypeInfo</span><span class="op" id="4769847">)</span>&nbsp;<span class="op" id="4769849">*</span><span class="ident" id="4769850">decOp</span>&nbsp;<span class="op" id="4769856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769859">rcvrType</span>&nbsp;<span class="op" id="4769868">:=</span>&nbsp;<span class="ident" id="4769871">ut</span><span class="op" id="4769873">.</span><span class="ident" id="4769874">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4769880">if</span>&nbsp;<span class="ident" id="4769883">ut</span><span class="op" id="4769885">.</span><span class="ident" id="4769886">decIndir</span>&nbsp;<span class="op" id="4769895">==</span>&nbsp;<span class="op" id="4769898">-</span><span class="num" id="4769899">1</span>&nbsp;<span class="op" id="4769901">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4769905">rcvrType</span>&nbsp;<span class="op" id="4769914">=</span>&nbsp;<span class="ident" id="4769916">reflect</span><span class="op" id="4769923">.</span><span class="ident" id="4769924">PtrTo</span><span class="op" id="4769929">(</span><span class="ident" id="4769930">rcvrType</span><span class="op" id="4769938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4769941">}</span>&nbsp;<span class="keyword" id="4769943">else</span>&nbsp;<span class="keyword" id="4769948">if</span>&nbsp;<span class="ident" id="4769951">ut</span><span class="op" id="4769953">.</span><span class="ident" id="4769954">decIndir</span>&nbsp;<span class="op" id="4769963">&gt;</span>&nbsp;<span class="num" id="4769965">0</span>&nbsp;<span class="op" id="4769967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4769971">for</span>&nbsp;<span class="ident" id="4769975">i</span>&nbsp;<span class="op" id="4769977">:=</span>&nbsp;<span class="builtintype" id="4769980">int8</span><span class="op" id="4769984">(</span><span class="num" id="4769985">0</span><span class="op" id="4769986">)</span><span class="op" id="4769987">;</span>&nbsp;<span class="ident" id="4769989">i</span>&nbsp;<span class="op" id="4769991">&lt;</span>&nbsp;<span class="ident" id="4769993">ut</span><span class="op" id="4769995">.</span><span class="ident" id="4769996">decIndir</span><span class="op" id="4770004">;</span>&nbsp;<span class="ident" id="4770006">i</span><span class="op" id="4770007">++</span>&nbsp;<span class="op" id="4770010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770015">rcvrType</span>&nbsp;<span class="op" id="4770024">=</span>&nbsp;<span class="ident" id="4770026">rcvrType</span><span class="op" id="4770034">.</span><span class="ident" id="4770035">Elem</span><span class="op" id="4770039">(</span><span class="op" id="4770040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770044">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770050">var</span>&nbsp;<span class="ident" id="4770054">op</span>&nbsp;<span class="ident" id="4770057">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770064">op</span>&nbsp;<span class="op" id="4770067">=</span>&nbsp;<span class="keyword" id="4770069">func</span><span class="op" id="4770073">(</span><span class="ident" id="4770074">i</span>&nbsp;<span class="op" id="4770076">*</span><span class="ident" id="4770077">decInstr</span><span class="op" id="4770085">,</span>&nbsp;<span class="ident" id="4770087">state</span>&nbsp;<span class="op" id="4770093">*</span><span class="ident" id="4770094">decoderState</span><span class="op" id="4770106">,</span>&nbsp;<span class="ident" id="4770108">value</span>&nbsp;<span class="ident" id="4770114">reflect</span><span class="op" id="4770121">.</span><span class="ident" id="4770122">Value</span><span class="op" id="4770127">)</span>&nbsp;<span class="op" id="4770129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4770133">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770215">if</span>&nbsp;<span class="ident" id="4770218">value</span><span class="op" id="4770223">.</span><span class="ident" id="4770224">Kind</span><span class="op" id="4770228">(</span><span class="op" id="4770229">)</span>&nbsp;<span class="op" id="4770231">!=</span>&nbsp;<span class="ident" id="4770234">reflect</span><span class="op" id="4770241">.</span><span class="ident" id="4770242">Ptr</span>&nbsp;<span class="op" id="4770246">&amp;&amp;</span>&nbsp;<span class="ident" id="4770249">rcvrType</span><span class="op" id="4770257">.</span><span class="ident" id="4770258">Kind</span><span class="op" id="4770262">(</span><span class="op" id="4770263">)</span>&nbsp;<span class="op" id="4770265">==</span>&nbsp;<span class="ident" id="4770268">reflect</span><span class="op" id="4770275">.</span><span class="ident" id="4770276">Ptr</span>&nbsp;<span class="op" id="4770280">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770285">value</span>&nbsp;<span class="op" id="4770291">=</span>&nbsp;<span class="ident" id="4770293">value</span><span class="op" id="4770298">.</span><span class="ident" id="4770299">Addr</span><span class="op" id="4770303">(</span><span class="op" id="4770304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770312">state</span><span class="op" id="4770317">.</span><span class="ident" id="4770318">dec</span><span class="op" id="4770321">.</span><span class="ident" id="4770322">decodeGobDecoder</span><span class="op" id="4770338">(</span><span class="ident" id="4770339">ut</span><span class="op" id="4770341">,</span>&nbsp;<span class="ident" id="4770343">state</span><span class="op" id="4770348">,</span>&nbsp;<span class="ident" id="4770350">value</span><span class="op" id="4770355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770361">return</span>&nbsp;<span class="op" id="4770368">&amp;</span><span class="ident" id="4770369">op</span><br>
<span class="lineno">925</span><span class="op" id="4770372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4770375">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="4770435">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="4770506">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="4770535">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="4770595">func</span>&nbsp;<span class="op" id="4770600">(</span><span class="ident" id="4770601">dec</span>&nbsp;<span class="op" id="4770605">*</span><span class="ident" id="4770606">Decoder</span><span class="op" id="4770613">)</span>&nbsp;<span class="ident" id="4770615">compatibleType</span><span class="op" id="4770629">(</span><span class="ident" id="4770630">fr</span>&nbsp;<span class="ident" id="4770633">reflect</span><span class="op" id="4770640">.</span><span class="ident" id="4770641">Type</span><span class="op" id="4770645">,</span>&nbsp;<span class="ident" id="4770647">fw</span>&nbsp;<span class="ident" id="4770650">typeId</span><span class="op" id="4770656">,</span>&nbsp;<span class="ident" id="4770658">inProgress</span>&nbsp;<span class="keyword" id="4770669">map</span><span class="op" id="4770672">[</span><span class="ident" id="4770673">reflect</span><span class="op" id="4770680">.</span><span class="ident" id="4770681">Type</span><span class="op" id="4770685">]</span><span class="ident" id="4770686">typeId</span><span class="op" id="4770692">)</span>&nbsp;<span class="builtintype" id="4770694">bool</span>&nbsp;<span class="op" id="4770699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770702">if</span>&nbsp;<span class="ident" id="4770705">rhs</span><span class="op" id="4770708">,</span>&nbsp;<span class="ident" id="4770710">ok</span>&nbsp;<span class="op" id="4770713">:=</span>&nbsp;<span class="ident" id="4770716">inProgress</span><span class="op" id="4770726">[</span><span class="ident" id="4770727">fr</span><span class="op" id="4770729">]</span><span class="op" id="4770730">;</span>&nbsp;<span class="ident" id="4770732">ok</span>&nbsp;<span class="op" id="4770735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770739">return</span>&nbsp;<span class="ident" id="4770746">rhs</span>&nbsp;<span class="op" id="4770750">==</span>&nbsp;<span class="ident" id="4770753">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770757">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770760">inProgress</span><span class="op" id="4770770">[</span><span class="ident" id="4770771">fr</span><span class="op" id="4770773">]</span>&nbsp;<span class="op" id="4770775">=</span>&nbsp;<span class="ident" id="4770777">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770781">ut</span>&nbsp;<span class="op" id="4770784">:=</span>&nbsp;<span class="ident" id="4770787">userType</span><span class="op" id="4770795">(</span><span class="ident" id="4770796">fr</span><span class="op" id="4770798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770801">wire</span><span class="op" id="4770805">,</span>&nbsp;<span class="ident" id="4770807">ok</span>&nbsp;<span class="op" id="4770810">:=</span>&nbsp;<span class="ident" id="4770813">dec</span><span class="op" id="4770816">.</span><span class="ident" id="4770817">wireType</span><span class="op" id="4770825">[</span><span class="ident" id="4770826">fw</span><span class="op" id="4770828">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4770831">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4770906">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4770935">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4770981">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4771051">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4771114">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771160">if</span>&nbsp;<span class="op" id="4771163">(</span><span class="ident" id="4771164">ut</span><span class="op" id="4771166">.</span><span class="ident" id="4771167">externalDec</span>&nbsp;<span class="op" id="4771179">==</span>&nbsp;<span class="ident" id="4771182">xGob</span><span class="op" id="4771186">)</span>&nbsp;<span class="op" id="4771188">!=</span>&nbsp;<span class="op" id="4771191">(</span><span class="ident" id="4771192">ok</span>&nbsp;<span class="op" id="4771195">&amp;&amp;</span>&nbsp;<span class="ident" id="4771198">wire</span><span class="op" id="4771202">.</span><span class="ident" id="4771203">GobEncoderT</span>&nbsp;<span class="op" id="4771215">!=</span>&nbsp;<span class="ident" id="4771218">nil</span><span class="op" id="4771221">)</span>&nbsp;<span class="op" id="4771223">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771228">(</span><span class="ident" id="4771229">ut</span><span class="op" id="4771231">.</span><span class="ident" id="4771232">externalDec</span>&nbsp;<span class="op" id="4771244">==</span>&nbsp;<span class="ident" id="4771247">xBinary</span><span class="op" id="4771254">)</span>&nbsp;<span class="op" id="4771256">!=</span>&nbsp;<span class="op" id="4771259">(</span><span class="ident" id="4771260">ok</span>&nbsp;<span class="op" id="4771263">&amp;&amp;</span>&nbsp;<span class="ident" id="4771266">wire</span><span class="op" id="4771270">.</span><span class="ident" id="4771271">BinaryMarshalerT</span>&nbsp;<span class="op" id="4771288">!=</span>&nbsp;<span class="ident" id="4771291">nil</span><span class="op" id="4771294">)</span>&nbsp;<span class="op" id="4771296">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771301">(</span><span class="ident" id="4771302">ut</span><span class="op" id="4771304">.</span><span class="ident" id="4771305">externalDec</span>&nbsp;<span class="op" id="4771317">==</span>&nbsp;<span class="ident" id="4771320">xText</span><span class="op" id="4771325">)</span>&nbsp;<span class="op" id="4771327">!=</span>&nbsp;<span class="op" id="4771330">(</span><span class="ident" id="4771331">ok</span>&nbsp;<span class="op" id="4771334">&amp;&amp;</span>&nbsp;<span class="ident" id="4771337">wire</span><span class="op" id="4771341">.</span><span class="ident" id="4771342">TextMarshalerT</span>&nbsp;<span class="op" id="4771357">!=</span>&nbsp;<span class="ident" id="4771360">nil</span><span class="op" id="4771363">)</span>&nbsp;<span class="op" id="4771365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771369">return</span>&nbsp;<span class="builtintype" id="4771376">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771386">if</span>&nbsp;<span class="ident" id="4771389">ut</span><span class="op" id="4771391">.</span><span class="ident" id="4771392">externalDec</span>&nbsp;<span class="op" id="4771404">!=</span>&nbsp;<span class="num" id="4771407">0</span>&nbsp;<span class="op" id="4771409">{</span>&nbsp;<span class="comment" id="4771411">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771445">return</span>&nbsp;<span class="builtintype" id="4771452">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771461">switch</span>&nbsp;<span class="ident" id="4771468">t</span>&nbsp;<span class="op" id="4771470">:=</span>&nbsp;<span class="ident" id="4771473">ut</span><span class="op" id="4771475">.</span><span class="ident" id="4771476">base</span><span class="op" id="4771480">;</span>&nbsp;<span class="ident" id="4771482">t</span><span class="op" id="4771483">.</span><span class="ident" id="4771484">Kind</span><span class="op" id="4771488">(</span><span class="op" id="4771489">)</span>&nbsp;<span class="op" id="4771491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771494">default</span><span class="op" id="4771501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4771505">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771536">return</span>&nbsp;<span class="builtintype" id="4771543">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771550">case</span>&nbsp;<span class="ident" id="4771555">reflect</span><span class="op" id="4771562">.</span><span class="ident" id="4771563">Bool</span><span class="op" id="4771567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771571">return</span>&nbsp;<span class="ident" id="4771578">fw</span>&nbsp;<span class="op" id="4771581">==</span>&nbsp;<span class="ident" id="4771584">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771591">case</span>&nbsp;<span class="ident" id="4771596">reflect</span><span class="op" id="4771603">.</span><span class="ident" id="4771604">Int</span><span class="op" id="4771607">,</span>&nbsp;<span class="ident" id="4771609">reflect</span><span class="op" id="4771616">.</span><span class="ident" id="4771617">Int8</span><span class="op" id="4771621">,</span>&nbsp;<span class="ident" id="4771623">reflect</span><span class="op" id="4771630">.</span><span class="ident" id="4771631">Int16</span><span class="op" id="4771636">,</span>&nbsp;<span class="ident" id="4771638">reflect</span><span class="op" id="4771645">.</span><span class="ident" id="4771646">Int32</span><span class="op" id="4771651">,</span>&nbsp;<span class="ident" id="4771653">reflect</span><span class="op" id="4771660">.</span><span class="ident" id="4771661">Int64</span><span class="op" id="4771666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771670">return</span>&nbsp;<span class="ident" id="4771677">fw</span>&nbsp;<span class="op" id="4771680">==</span>&nbsp;<span class="ident" id="4771683">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771689">case</span>&nbsp;<span class="ident" id="4771694">reflect</span><span class="op" id="4771701">.</span><span class="ident" id="4771702">Uint</span><span class="op" id="4771706">,</span>&nbsp;<span class="ident" id="4771708">reflect</span><span class="op" id="4771715">.</span><span class="ident" id="4771716">Uint8</span><span class="op" id="4771721">,</span>&nbsp;<span class="ident" id="4771723">reflect</span><span class="op" id="4771730">.</span><span class="ident" id="4771731">Uint16</span><span class="op" id="4771737">,</span>&nbsp;<span class="ident" id="4771739">reflect</span><span class="op" id="4771746">.</span><span class="ident" id="4771747">Uint32</span><span class="op" id="4771753">,</span>&nbsp;<span class="ident" id="4771755">reflect</span><span class="op" id="4771762">.</span><span class="ident" id="4771763">Uint64</span><span class="op" id="4771769">,</span>&nbsp;<span class="ident" id="4771771">reflect</span><span class="op" id="4771778">.</span><span class="ident" id="4771779">Uintptr</span><span class="op" id="4771786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771790">return</span>&nbsp;<span class="ident" id="4771797">fw</span>&nbsp;<span class="op" id="4771800">==</span>&nbsp;<span class="ident" id="4771803">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771810">case</span>&nbsp;<span class="ident" id="4771815">reflect</span><span class="op" id="4771822">.</span><span class="ident" id="4771823">Float32</span><span class="op" id="4771830">,</span>&nbsp;<span class="ident" id="4771832">reflect</span><span class="op" id="4771839">.</span><span class="ident" id="4771840">Float64</span><span class="op" id="4771847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771851">return</span>&nbsp;<span class="ident" id="4771858">fw</span>&nbsp;<span class="op" id="4771861">==</span>&nbsp;<span class="ident" id="4771864">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771872">case</span>&nbsp;<span class="ident" id="4771877">reflect</span><span class="op" id="4771884">.</span><span class="ident" id="4771885">Complex64</span><span class="op" id="4771894">,</span>&nbsp;<span class="ident" id="4771896">reflect</span><span class="op" id="4771903">.</span><span class="ident" id="4771904">Complex128</span><span class="op" id="4771914">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771918">return</span>&nbsp;<span class="ident" id="4771925">fw</span>&nbsp;<span class="op" id="4771928">==</span>&nbsp;<span class="ident" id="4771931">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771941">case</span>&nbsp;<span class="ident" id="4771946">reflect</span><span class="op" id="4771953">.</span><span class="ident" id="4771954">String</span><span class="op" id="4771960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771964">return</span>&nbsp;<span class="ident" id="4771971">fw</span>&nbsp;<span class="op" id="4771974">==</span>&nbsp;<span class="ident" id="4771977">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771986">case</span>&nbsp;<span class="ident" id="4771991">reflect</span><span class="op" id="4771998">.</span><span class="ident" id="4771999">Interface</span><span class="op" id="4772008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772012">return</span>&nbsp;<span class="ident" id="4772019">fw</span>&nbsp;<span class="op" id="4772022">==</span>&nbsp;<span class="ident" id="4772025">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772037">case</span>&nbsp;<span class="ident" id="4772042">reflect</span><span class="op" id="4772049">.</span><span class="ident" id="4772050">Array</span><span class="op" id="4772055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772059">if</span>&nbsp;<span class="op" id="4772062">!</span><span class="ident" id="4772063">ok</span>&nbsp;<span class="op" id="4772066">||</span>&nbsp;<span class="ident" id="4772069">wire</span><span class="op" id="4772073">.</span><span class="ident" id="4772074">ArrayT</span>&nbsp;<span class="op" id="4772081">==</span>&nbsp;<span class="ident" id="4772084">nil</span>&nbsp;<span class="op" id="4772088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772093">return</span>&nbsp;<span class="builtintype" id="4772100">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772112">array</span>&nbsp;<span class="op" id="4772118">:=</span>&nbsp;<span class="ident" id="4772121">wire</span><span class="op" id="4772125">.</span><span class="ident" id="4772126">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772135">return</span>&nbsp;<span class="ident" id="4772142">t</span><span class="op" id="4772143">.</span><span class="ident" id="4772144">Len</span><span class="op" id="4772147">(</span><span class="op" id="4772148">)</span>&nbsp;<span class="op" id="4772150">==</span>&nbsp;<span class="ident" id="4772153">array</span><span class="op" id="4772158">.</span><span class="ident" id="4772159">Len</span>&nbsp;<span class="op" id="4772163">&amp;&amp;</span>&nbsp;<span class="ident" id="4772166">dec</span><span class="op" id="4772169">.</span><span class="ident" id="4772170">compatibleType</span><span class="op" id="4772184">(</span><span class="ident" id="4772185">t</span><span class="op" id="4772186">.</span><span class="ident" id="4772187">Elem</span><span class="op" id="4772191">(</span><span class="op" id="4772192">)</span><span class="op" id="4772193">,</span>&nbsp;<span class="ident" id="4772195">array</span><span class="op" id="4772200">.</span><span class="ident" id="4772201">Elem</span><span class="op" id="4772205">,</span>&nbsp;<span class="ident" id="4772207">inProgress</span><span class="op" id="4772217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772220">case</span>&nbsp;<span class="ident" id="4772225">reflect</span><span class="op" id="4772232">.</span><span class="ident" id="4772233">Map</span><span class="op" id="4772236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772240">if</span>&nbsp;<span class="op" id="4772243">!</span><span class="ident" id="4772244">ok</span>&nbsp;<span class="op" id="4772247">||</span>&nbsp;<span class="ident" id="4772250">wire</span><span class="op" id="4772254">.</span><span class="ident" id="4772255">MapT</span>&nbsp;<span class="op" id="4772260">==</span>&nbsp;<span class="ident" id="4772263">nil</span>&nbsp;<span class="op" id="4772267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772272">return</span>&nbsp;<span class="builtintype" id="4772279">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772287">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772291">MapType</span>&nbsp;<span class="op" id="4772299">:=</span>&nbsp;<span class="ident" id="4772302">wire</span><span class="op" id="4772306">.</span><span class="ident" id="4772307">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772314">return</span>&nbsp;<span class="ident" id="4772321">dec</span><span class="op" id="4772324">.</span><span class="ident" id="4772325">compatibleType</span><span class="op" id="4772339">(</span><span class="ident" id="4772340">t</span><span class="op" id="4772341">.</span><span class="ident" id="4772342">Key</span><span class="op" id="4772345">(</span><span class="op" id="4772346">)</span><span class="op" id="4772347">,</span>&nbsp;<span class="ident" id="4772349">MapType</span><span class="op" id="4772356">.</span><span class="ident" id="4772357">Key</span><span class="op" id="4772360">,</span>&nbsp;<span class="ident" id="4772362">inProgress</span><span class="op" id="4772372">)</span>&nbsp;<span class="op" id="4772374">&amp;&amp;</span>&nbsp;<span class="ident" id="4772377">dec</span><span class="op" id="4772380">.</span><span class="ident" id="4772381">compatibleType</span><span class="op" id="4772395">(</span><span class="ident" id="4772396">t</span><span class="op" id="4772397">.</span><span class="ident" id="4772398">Elem</span><span class="op" id="4772402">(</span><span class="op" id="4772403">)</span><span class="op" id="4772404">,</span>&nbsp;<span class="ident" id="4772406">MapType</span><span class="op" id="4772413">.</span><span class="ident" id="4772414">Elem</span><span class="op" id="4772418">,</span>&nbsp;<span class="ident" id="4772420">inProgress</span><span class="op" id="4772430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772433">case</span>&nbsp;<span class="ident" id="4772438">reflect</span><span class="op" id="4772445">.</span><span class="ident" id="4772446">Slice</span><span class="op" id="4772451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4772455">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772485">if</span>&nbsp;<span class="ident" id="4772488">t</span><span class="op" id="4772489">.</span><span class="ident" id="4772490">Elem</span><span class="op" id="4772494">(</span><span class="op" id="4772495">)</span><span class="op" id="4772496">.</span><span class="ident" id="4772497">Kind</span><span class="op" id="4772501">(</span><span class="op" id="4772502">)</span>&nbsp;<span class="op" id="4772504">==</span>&nbsp;<span class="ident" id="4772507">reflect</span><span class="op" id="4772514">.</span><span class="ident" id="4772515">Uint8</span>&nbsp;<span class="op" id="4772521">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772526">return</span>&nbsp;<span class="ident" id="4772533">fw</span>&nbsp;<span class="op" id="4772536">==</span>&nbsp;<span class="ident" id="4772539">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4772552">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772592">var</span>&nbsp;<span class="ident" id="4772596">sw</span>&nbsp;<span class="op" id="4772599">*</span><span class="ident" id="4772600">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772612">if</span>&nbsp;<span class="ident" id="4772615">tt</span><span class="op" id="4772617">,</span>&nbsp;<span class="ident" id="4772619">ok</span>&nbsp;<span class="op" id="4772622">:=</span>&nbsp;<span class="ident" id="4772625">builtinIdToType</span><span class="op" id="4772640">[</span><span class="ident" id="4772641">fw</span><span class="op" id="4772643">]</span><span class="op" id="4772644">;</span>&nbsp;<span class="ident" id="4772646">ok</span>&nbsp;<span class="op" id="4772649">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772654">sw</span><span class="op" id="4772656">,</span>&nbsp;<span class="ident" id="4772658">_</span>&nbsp;<span class="op" id="4772660">=</span>&nbsp;<span class="ident" id="4772662">tt</span><span class="op" id="4772664">.</span><span class="op" id="4772665">(</span><span class="op" id="4772666">*</span><span class="ident" id="4772667">sliceType</span><span class="op" id="4772676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772680">}</span>&nbsp;<span class="keyword" id="4772682">else</span>&nbsp;<span class="keyword" id="4772687">if</span>&nbsp;<span class="ident" id="4772690">wire</span>&nbsp;<span class="op" id="4772695">!=</span>&nbsp;<span class="ident" id="4772698">nil</span>&nbsp;<span class="op" id="4772702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772707">sw</span>&nbsp;<span class="op" id="4772710">=</span>&nbsp;<span class="ident" id="4772712">wire</span><span class="op" id="4772716">.</span><span class="ident" id="4772717">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772730">elem</span>&nbsp;<span class="op" id="4772735">:=</span>&nbsp;<span class="ident" id="4772738">userType</span><span class="op" id="4772746">(</span><span class="ident" id="4772747">t</span><span class="op" id="4772748">.</span><span class="ident" id="4772749">Elem</span><span class="op" id="4772753">(</span><span class="op" id="4772754">)</span><span class="op" id="4772755">)</span><span class="op" id="4772756">.</span><span class="ident" id="4772757">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772764">return</span>&nbsp;<span class="ident" id="4772771">sw</span>&nbsp;<span class="op" id="4772774">!=</span>&nbsp;<span class="ident" id="4772777">nil</span>&nbsp;<span class="op" id="4772781">&amp;&amp;</span>&nbsp;<span class="ident" id="4772784">dec</span><span class="op" id="4772787">.</span><span class="ident" id="4772788">compatibleType</span><span class="op" id="4772802">(</span><span class="ident" id="4772803">elem</span><span class="op" id="4772807">,</span>&nbsp;<span class="ident" id="4772809">sw</span><span class="op" id="4772811">.</span><span class="ident" id="4772812">Elem</span><span class="op" id="4772816">,</span>&nbsp;<span class="ident" id="4772818">inProgress</span><span class="op" id="4772828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772831">case</span>&nbsp;<span class="ident" id="4772836">reflect</span><span class="op" id="4772843">.</span><span class="ident" id="4772844">Struct</span><span class="op" id="4772850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772854">return</span>&nbsp;<span class="builtintype" id="4772861">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772867">}</span><br>
<span class="lineno"></span><span class="op" id="4772869">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="4772872">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="4772959">func</span>&nbsp;<span class="op" id="4772964">(</span><span class="ident" id="4772965">dec</span>&nbsp;<span class="op" id="4772969">*</span><span class="ident" id="4772970">Decoder</span><span class="op" id="4772977">)</span>&nbsp;<span class="ident" id="4772979">typeString</span><span class="op" id="4772989">(</span><span class="ident" id="4772990">remoteId</span>&nbsp;<span class="ident" id="4772999">typeId</span><span class="op" id="4773005">)</span>&nbsp;<span class="builtintype" id="4773007">string</span>&nbsp;<span class="op" id="4773014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4773017">if</span>&nbsp;<span class="ident" id="4773020">t</span>&nbsp;<span class="op" id="4773022">:=</span>&nbsp;<span class="ident" id="4773025">idToType</span><span class="op" id="4773033">[</span><span class="ident" id="4773034">remoteId</span><span class="op" id="4773042">]</span><span class="op" id="4773043">;</span>&nbsp;<span class="ident" id="4773045">t</span>&nbsp;<span class="op" id="4773047">!=</span>&nbsp;<span class="ident" id="4773050">nil</span>&nbsp;<span class="op" id="4773054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4773058">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4773084">return</span>&nbsp;<span class="ident" id="4773091">t</span><span class="op" id="4773092">.</span><span class="builtintype" id="4773093">string</span><span class="op" id="4773099">(</span><span class="op" id="4773100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4773103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4773106">return</span>&nbsp;<span class="ident" id="4773113">dec</span><span class="op" id="4773116">.</span><span class="ident" id="4773117">wireType</span><span class="op" id="4773125">[</span><span class="ident" id="4773126">remoteId</span><span class="op" id="4773134">]</span><span class="op" id="4773135">.</span><span class="builtintype" id="4773136">string</span><span class="op" id="4773142">(</span><span class="op" id="4773143">)</span><br>
<span class="lineno"></span><span class="op" id="4773145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="4773148">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="4773237">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="4773253">func</span>&nbsp;<span class="op" id="4773258">(</span><span class="ident" id="4773259">dec</span>&nbsp;<span class="op" id="4773263">*</span><span class="ident" id="4773264">Decoder</span><span class="op" id="4773271">)</span>&nbsp;<span class="ident" id="4773273">compileSingle</span><span class="op" id="4773286">(</span><span class="ident" id="4773287">remoteId</span>&nbsp;<span class="ident" id="4773296">typeId</span><span class="op" id="4773302">,</span>&nbsp;<span class="ident" id="4773304">ut</span>&nbsp;<span class="op" id="4773307">*</span><span class="ident" id="4773308">userTypeInfo</span><span class="op" id="4773320">)</span>&nbsp;<span class="op" id="4773322">(</span><span class="ident" id="4773323">engine</span>&nbsp;<span class="op" id="4773330">*</span><span class="ident" id="4773331">decEngine</span><span class="op" id="4773340">,</span>&nbsp;<span class="ident" id="4773342">err</span>&nbsp;<span class="builtintype" id="4773346">error</span><span class="op" id="4773351">)</span>&nbsp;<span class="op" id="4773353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4773356">rt</span>&nbsp;<span class="op" id="4773359">:=</span>&nbsp;<span class="ident" id="4773362">ut</span><span class="op" id="4773364">.</span><span class="ident" id="4773365">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4773371">engine</span>&nbsp;<span class="op" id="4773378">=</span>&nbsp;<span class="builtinfunc" id="4773380">new</span><span class="op" id="4773383">(</span><span class="ident" id="4773384">decEngine</span><span class="op" id="4773393">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4773396">engine</span><span class="op" id="4773402">.</span><span class="ident" id="4773403">instr</span>&nbsp;<span class="op" id="4773409">=</span>&nbsp;<span class="builtinfunc" id="4773411">make</span><span class="op" id="4773415">(</span><span class="op" id="4773416">[</span><span class="op" id="4773417">]</span><span class="ident" id="4773418">decInstr</span><span class="op" id="4773426">,</span>&nbsp;<span class="num" id="4773428">1</span><span class="op" id="4773429">)</span>&nbsp;<span class="comment" id="4773431">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4773444">name</span>&nbsp;<span class="op" id="4773449">:=</span>&nbsp;<span class="ident" id="4773452">rt</span><span class="op" id="4773454">.</span><span class="ident" id="4773455">String</span><span class="op" id="4773461">(</span><span class="op" id="4773462">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4773479">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4773498">if</span>&nbsp;<span class="op" id="4773501">!</span><span class="ident" id="4773502">dec</span><span class="op" id="4773505">.</span><span class="ident" id="4773506">compatibleType</span><span class="op" id="4773520">(</span><span class="ident" id="4773521">rt</span><span class="op" id="4773523">,</span>&nbsp;<span class="ident" id="4773525">remoteId</span><span class="op" id="4773533">,</span>&nbsp;<span class="builtinfunc" id="4773535">make</span><span class="op" id="4773539">(</span><span class="keyword" id="4773540">map</span><span class="op" id="4773543">[</span><span class="ident" id="4773544">reflect</span><span class="op" id="4773551">.</span><span class="ident" id="4773552">Type</span><span class="op" id="4773556">]</span><span class="ident" id="4773557">typeId</span><span class="op" id="4773563">)</span><span class="op" id="4773564">)</span>&nbsp;<span class="op" id="4773566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4773570">remoteType</span>&nbsp;<span class="op" id="4773581">:=</span>&nbsp;<span class="ident" id="4773584">dec</span><span class="op" id="4773587">.</span><span class="ident" id="4773588">typeString</span><span class="op" id="4773598">(</span><span class="ident" id="4773599">remoteId</span><span class="op" id="4773607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4773611">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4773683">if</span>&nbsp;<span class="ident" id="4773686">ut</span><span class="op" id="4773688">.</span><span class="ident" id="4773689">base</span><span class="op" id="4773693">.</span><span class="ident" id="4773694">Kind</span><span class="op" id="4773698">(</span><span class="op" id="4773699">)</span>&nbsp;<span class="op" id="4773701">==</span>&nbsp;<span class="ident" id="4773704">reflect</span><span class="op" id="4773711">.</span><span class="ident" id="4773712">Interface</span>&nbsp;<span class="op" id="4773722">&amp;&amp;</span>&nbsp;<span class="ident" id="4773725">remoteId</span>&nbsp;<span class="op" id="4773734">!=</span>&nbsp;<span class="ident" id="4773737">tInterface</span>&nbsp;<span class="op" id="4773748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4773753">return</span>&nbsp;<span class="ident" id="4773760">nil</span><span class="op" id="4773763">,</span>&nbsp;<span class="ident" id="4773765">errors</span><span class="op" id="4773771">.</span><span class="ident" id="4773772">New</span><span class="op" id="4773775">(</span><span class="string" id="4773776">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4773805">+</span>&nbsp;<span class="ident" id="4773807">name</span>&nbsp;<span class="op" id="4773812">+</span>&nbsp;<span class="string" id="4773814">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4773889">+</span>&nbsp;<span class="ident" id="4773891">remoteType</span><span class="op" id="4773901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4773905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4773909">return</span>&nbsp;<span class="ident" id="4773916">nil</span><span class="op" id="4773919">,</span>&nbsp;<span class="ident" id="4773921">errors</span><span class="op" id="4773927">.</span><span class="ident" id="4773928">New</span><span class="op" id="4773931">(</span><span class="string" id="4773932">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4773965">+</span>&nbsp;<span class="ident" id="4773967">name</span>&nbsp;<span class="op" id="4773972">+</span>&nbsp;<span class="string" id="4773974">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4774000">+</span>&nbsp;<span class="ident" id="4774002">remoteType</span><span class="op" id="4774012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4774015">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774018">op</span>&nbsp;<span class="op" id="4774021">:=</span>&nbsp;<span class="ident" id="4774024">dec</span><span class="op" id="4774027">.</span><span class="ident" id="4774028">decOpFor</span><span class="op" id="4774036">(</span><span class="ident" id="4774037">remoteId</span><span class="op" id="4774045">,</span>&nbsp;<span class="ident" id="4774047">rt</span><span class="op" id="4774049">,</span>&nbsp;<span class="ident" id="4774051">name</span><span class="op" id="4774055">,</span>&nbsp;<span class="builtinfunc" id="4774057">make</span><span class="op" id="4774061">(</span><span class="keyword" id="4774062">map</span><span class="op" id="4774065">[</span><span class="ident" id="4774066">reflect</span><span class="op" id="4774073">.</span><span class="ident" id="4774074">Type</span><span class="op" id="4774078">]</span><span class="op" id="4774079">*</span><span class="ident" id="4774080">decOp</span><span class="op" id="4774085">)</span><span class="op" id="4774086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774089">ovfl</span>&nbsp;<span class="op" id="4774094">:=</span>&nbsp;<span class="ident" id="4774097">errors</span><span class="op" id="4774103">.</span><span class="ident" id="4774104">New</span><span class="op" id="4774107">(</span><span class="string" id="4774108">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4774122">+</span>&nbsp;<span class="ident" id="4774124">name</span>&nbsp;<span class="op" id="4774129">+</span>&nbsp;<span class="string" id="4774131">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4774147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774150">engine</span><span class="op" id="4774156">.</span><span class="ident" id="4774157">instr</span><span class="op" id="4774162">[</span><span class="ident" id="4774163">singletonField</span><span class="op" id="4774177">]</span>&nbsp;<span class="op" id="4774179">=</span>&nbsp;<span class="ident" id="4774181">decInstr</span><span class="op" id="4774189">{</span><span class="op" id="4774190">*</span><span class="ident" id="4774191">op</span><span class="op" id="4774193">,</span>&nbsp;<span class="ident" id="4774195">singletonField</span><span class="op" id="4774209">,</span>&nbsp;<span class="ident" id="4774211">nil</span><span class="op" id="4774214">,</span>&nbsp;<span class="ident" id="4774216">ovfl</span><span class="op" id="4774220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774223">engine</span><span class="op" id="4774229">.</span><span class="ident" id="4774230">numInstr</span>&nbsp;<span class="op" id="4774239">=</span>&nbsp;<span class="num" id="4774241">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4774244">return</span><br>
<span class="lineno">1030</span><span class="op" id="4774251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4774254">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4774362">func</span>&nbsp;<span class="op" id="4774367">(</span><span class="ident" id="4774368">dec</span>&nbsp;<span class="op" id="4774372">*</span><span class="ident" id="4774373">Decoder</span><span class="op" id="4774380">)</span>&nbsp;<span class="ident" id="4774382">compileIgnoreSingle</span><span class="op" id="4774401">(</span><span class="ident" id="4774402">remoteId</span>&nbsp;<span class="ident" id="4774411">typeId</span><span class="op" id="4774417">)</span>&nbsp;<span class="op" id="4774419">(</span><span class="ident" id="4774420">engine</span>&nbsp;<span class="op" id="4774427">*</span><span class="ident" id="4774428">decEngine</span><span class="op" id="4774437">,</span>&nbsp;<span class="ident" id="4774439">err</span>&nbsp;<span class="builtintype" id="4774443">error</span><span class="op" id="4774448">)</span>&nbsp;<span class="op" id="4774450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774453">engine</span>&nbsp;<span class="op" id="4774460">=</span>&nbsp;<span class="builtinfunc" id="4774462">new</span><span class="op" id="4774465">(</span><span class="ident" id="4774466">decEngine</span><span class="op" id="4774475">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774478">engine</span><span class="op" id="4774484">.</span><span class="ident" id="4774485">instr</span>&nbsp;<span class="op" id="4774491">=</span>&nbsp;<span class="builtinfunc" id="4774493">make</span><span class="op" id="4774497">(</span><span class="op" id="4774498">[</span><span class="op" id="4774499">]</span><span class="ident" id="4774500">decInstr</span><span class="op" id="4774508">,</span>&nbsp;<span class="num" id="4774510">1</span><span class="op" id="4774511">)</span>&nbsp;<span class="comment" id="4774513">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774526">op</span>&nbsp;<span class="op" id="4774529">:=</span>&nbsp;<span class="ident" id="4774532">dec</span><span class="op" id="4774535">.</span><span class="ident" id="4774536">decIgnoreOpFor</span><span class="op" id="4774550">(</span><span class="ident" id="4774551">remoteId</span><span class="op" id="4774559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774562">ovfl</span>&nbsp;<span class="op" id="4774567">:=</span>&nbsp;<span class="ident" id="4774570">overflow</span><span class="op" id="4774578">(</span><span class="ident" id="4774579">dec</span><span class="op" id="4774582">.</span><span class="ident" id="4774583">typeString</span><span class="op" id="4774593">(</span><span class="ident" id="4774594">remoteId</span><span class="op" id="4774602">)</span><span class="op" id="4774603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774606">engine</span><span class="op" id="4774612">.</span><span class="ident" id="4774613">instr</span><span class="op" id="4774618">[</span><span class="num" id="4774619">0</span><span class="op" id="4774620">]</span>&nbsp;<span class="op" id="4774622">=</span>&nbsp;<span class="ident" id="4774624">decInstr</span><span class="op" id="4774632">{</span><span class="ident" id="4774633">op</span><span class="op" id="4774635">,</span>&nbsp;<span class="num" id="4774637">0</span><span class="op" id="4774638">,</span>&nbsp;<span class="ident" id="4774640">nil</span><span class="op" id="4774643">,</span>&nbsp;<span class="ident" id="4774645">ovfl</span><span class="op" id="4774649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774652">engine</span><span class="op" id="4774658">.</span><span class="ident" id="4774659">numInstr</span>&nbsp;<span class="op" id="4774668">=</span>&nbsp;<span class="num" id="4774670">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4774673">return</span><br>
<span class="lineno"></span><span class="op" id="4774680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4774683">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="4774769">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="4774803">func</span>&nbsp;<span class="op" id="4774808">(</span><span class="ident" id="4774809">dec</span>&nbsp;<span class="op" id="4774813">*</span><span class="ident" id="4774814">Decoder</span><span class="op" id="4774821">)</span>&nbsp;<span class="ident" id="4774823">compileDec</span><span class="op" id="4774833">(</span><span class="ident" id="4774834">remoteId</span>&nbsp;<span class="ident" id="4774843">typeId</span><span class="op" id="4774849">,</span>&nbsp;<span class="ident" id="4774851">ut</span>&nbsp;<span class="op" id="4774854">*</span><span class="ident" id="4774855">userTypeInfo</span><span class="op" id="4774867">)</span>&nbsp;<span class="op" id="4774869">(</span><span class="ident" id="4774870">engine</span>&nbsp;<span class="op" id="4774877">*</span><span class="ident" id="4774878">decEngine</span><span class="op" id="4774887">,</span>&nbsp;<span class="ident" id="4774889">err</span>&nbsp;<span class="builtintype" id="4774893">error</span><span class="op" id="4774898">)</span>&nbsp;<span class="op" id="4774900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774903">rt</span>&nbsp;<span class="op" id="4774906">:=</span>&nbsp;<span class="ident" id="4774909">ut</span><span class="op" id="4774911">.</span><span class="ident" id="4774912">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4774918">srt</span>&nbsp;<span class="op" id="4774922">:=</span>&nbsp;<span class="ident" id="4774925">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4774929">if</span>&nbsp;<span class="ident" id="4774932">srt</span><span class="op" id="4774935">.</span><span class="ident" id="4774936">Kind</span><span class="op" id="4774940">(</span><span class="op" id="4774941">)</span>&nbsp;<span class="op" id="4774943">!=</span>&nbsp;<span class="ident" id="4774946">reflect</span><span class="op" id="4774953">.</span><span class="ident" id="4774954">Struct</span>&nbsp;<span class="op" id="4774961">||</span>&nbsp;<span class="ident" id="4774964">ut</span><span class="op" id="4774966">.</span><span class="ident" id="4774967">externalDec</span>&nbsp;<span class="op" id="4774979">!=</span>&nbsp;<span class="num" id="4774982">0</span>&nbsp;<span class="op" id="4774984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4774988">return</span>&nbsp;<span class="ident" id="4774995">dec</span><span class="op" id="4774998">.</span><span class="ident" id="4774999">compileSingle</span><span class="op" id="4775012">(</span><span class="ident" id="4775013">remoteId</span><span class="op" id="4775021">,</span>&nbsp;<span class="ident" id="4775023">ut</span><span class="op" id="4775025">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4775028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4775031">var</span>&nbsp;<span class="ident" id="4775035">wireStruct</span>&nbsp;<span class="op" id="4775046">*</span><span class="ident" id="4775047">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4775059">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4775145">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4775225">if</span>&nbsp;<span class="ident" id="4775228">t</span><span class="op" id="4775229">,</span>&nbsp;<span class="ident" id="4775231">ok</span>&nbsp;<span class="op" id="4775234">:=</span>&nbsp;<span class="ident" id="4775237">builtinIdToType</span><span class="op" id="4775252">[</span><span class="ident" id="4775253">remoteId</span><span class="op" id="4775261">]</span><span class="op" id="4775262">;</span>&nbsp;<span class="ident" id="4775264">ok</span>&nbsp;<span class="op" id="4775267">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775271">wireStruct</span><span class="op" id="4775281">,</span>&nbsp;<span class="ident" id="4775283">_</span>&nbsp;<span class="op" id="4775285">=</span>&nbsp;<span class="ident" id="4775287">t</span><span class="op" id="4775288">.</span><span class="op" id="4775289">(</span><span class="op" id="4775290">*</span><span class="ident" id="4775291">structType</span><span class="op" id="4775301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4775304">}</span>&nbsp;<span class="keyword" id="4775306">else</span>&nbsp;<span class="op" id="4775311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775315">wire</span>&nbsp;<span class="op" id="4775320">:=</span>&nbsp;<span class="ident" id="4775323">dec</span><span class="op" id="4775326">.</span><span class="ident" id="4775327">wireType</span><span class="op" id="4775335">[</span><span class="ident" id="4775336">remoteId</span><span class="op" id="4775344">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4775348">if</span>&nbsp;<span class="ident" id="4775351">wire</span>&nbsp;<span class="op" id="4775356">==</span>&nbsp;<span class="ident" id="4775359">nil</span>&nbsp;<span class="op" id="4775363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775368">error_</span><span class="op" id="4775374">(</span><span class="ident" id="4775375">errBadType</span><span class="op" id="4775385">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4775389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775393">wireStruct</span>&nbsp;<span class="op" id="4775404">=</span>&nbsp;<span class="ident" id="4775406">wire</span><span class="op" id="4775410">.</span><span class="ident" id="4775411">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4775420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4775423">if</span>&nbsp;<span class="ident" id="4775426">wireStruct</span>&nbsp;<span class="op" id="4775437">==</span>&nbsp;<span class="ident" id="4775440">nil</span>&nbsp;<span class="op" id="4775444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775448">errorf</span><span class="op" id="4775454">(</span><span class="string" id="4775455">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="4775518">,</span>&nbsp;<span class="ident" id="4775520">rt</span><span class="op" id="4775522">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4775525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775528">engine</span>&nbsp;<span class="op" id="4775535">=</span>&nbsp;<span class="builtinfunc" id="4775537">new</span><span class="op" id="4775540">(</span><span class="ident" id="4775541">decEngine</span><span class="op" id="4775550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775553">engine</span><span class="op" id="4775559">.</span><span class="ident" id="4775560">instr</span>&nbsp;<span class="op" id="4775566">=</span>&nbsp;<span class="builtinfunc" id="4775568">make</span><span class="op" id="4775572">(</span><span class="op" id="4775573">[</span><span class="op" id="4775574">]</span><span class="ident" id="4775575">decInstr</span><span class="op" id="4775583">,</span>&nbsp;<span class="builtinfunc" id="4775585">len</span><span class="op" id="4775588">(</span><span class="ident" id="4775589">wireStruct</span><span class="op" id="4775599">.</span><span class="ident" id="4775600">Field</span><span class="op" id="4775605">)</span><span class="op" id="4775606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775609">seen</span>&nbsp;<span class="op" id="4775614">:=</span>&nbsp;<span class="builtinfunc" id="4775617">make</span><span class="op" id="4775621">(</span><span class="keyword" id="4775622">map</span><span class="op" id="4775625">[</span><span class="ident" id="4775626">reflect</span><span class="op" id="4775633">.</span><span class="ident" id="4775634">Type</span><span class="op" id="4775638">]</span><span class="op" id="4775639">*</span><span class="ident" id="4775640">decOp</span><span class="op" id="4775645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4775648">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4775691">for</span>&nbsp;<span class="ident" id="4775695">fieldnum</span>&nbsp;<span class="op" id="4775704">:=</span>&nbsp;<span class="num" id="4775707">0</span><span class="op" id="4775708">;</span>&nbsp;<span class="ident" id="4775710">fieldnum</span>&nbsp;<span class="op" id="4775719">&lt;</span>&nbsp;<span class="builtinfunc" id="4775721">len</span><span class="op" id="4775724">(</span><span class="ident" id="4775725">wireStruct</span><span class="op" id="4775735">.</span><span class="ident" id="4775736">Field</span><span class="op" id="4775741">)</span><span class="op" id="4775742">;</span>&nbsp;<span class="ident" id="4775744">fieldnum</span><span class="op" id="4775752">++</span>&nbsp;<span class="op" id="4775755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775759">wireField</span>&nbsp;<span class="op" id="4775769">:=</span>&nbsp;<span class="ident" id="4775772">wireStruct</span><span class="op" id="4775782">.</span><span class="ident" id="4775783">Field</span><span class="op" id="4775788">[</span><span class="ident" id="4775789">fieldnum</span><span class="op" id="4775797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4775801">if</span>&nbsp;<span class="ident" id="4775804">wireField</span><span class="op" id="4775813">.</span><span class="ident" id="4775814">Name</span>&nbsp;<span class="op" id="4775819">==</span>&nbsp;<span class="string" id="4775822">&#34;&#34;</span>&nbsp;<span class="op" id="4775825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775830">errorf</span><span class="op" id="4775836">(</span><span class="string" id="4775837">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4775877">,</span>&nbsp;<span class="ident" id="4775879">wireStruct</span><span class="op" id="4775889">.</span><span class="ident" id="4775890">Name</span><span class="op" id="4775894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4775898">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775902">ovfl</span>&nbsp;<span class="op" id="4775907">:=</span>&nbsp;<span class="ident" id="4775910">overflow</span><span class="op" id="4775918">(</span><span class="ident" id="4775919">wireField</span><span class="op" id="4775928">.</span><span class="ident" id="4775929">Name</span><span class="op" id="4775933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4775937">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775995">localField</span><span class="op" id="4776005">,</span>&nbsp;<span class="ident" id="4776007">present</span>&nbsp;<span class="op" id="4776015">:=</span>&nbsp;<span class="ident" id="4776018">srt</span><span class="op" id="4776021">.</span><span class="ident" id="4776022">FieldByName</span><span class="op" id="4776033">(</span><span class="ident" id="4776034">wireField</span><span class="op" id="4776043">.</span><span class="ident" id="4776044">Name</span><span class="op" id="4776048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4776052">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776082">if</span>&nbsp;<span class="op" id="4776085">!</span><span class="ident" id="4776086">present</span>&nbsp;<span class="op" id="4776094">||</span>&nbsp;<span class="op" id="4776097">!</span><span class="ident" id="4776098">isExported</span><span class="op" id="4776108">(</span><span class="ident" id="4776109">wireField</span><span class="op" id="4776118">.</span><span class="ident" id="4776119">Name</span><span class="op" id="4776123">)</span>&nbsp;<span class="op" id="4776125">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776130">op</span>&nbsp;<span class="op" id="4776133">:=</span>&nbsp;<span class="ident" id="4776136">dec</span><span class="op" id="4776139">.</span><span class="ident" id="4776140">decIgnoreOpFor</span><span class="op" id="4776154">(</span><span class="ident" id="4776155">wireField</span><span class="op" id="4776164">.</span><span class="ident" id="4776165">Id</span><span class="op" id="4776167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776172">engine</span><span class="op" id="4776178">.</span><span class="ident" id="4776179">instr</span><span class="op" id="4776184">[</span><span class="ident" id="4776185">fieldnum</span><span class="op" id="4776193">]</span>&nbsp;<span class="op" id="4776195">=</span>&nbsp;<span class="ident" id="4776197">decInstr</span><span class="op" id="4776205">{</span><span class="ident" id="4776206">op</span><span class="op" id="4776208">,</span>&nbsp;<span class="ident" id="4776210">fieldnum</span><span class="op" id="4776218">,</span>&nbsp;<span class="ident" id="4776220">nil</span><span class="op" id="4776223">,</span>&nbsp;<span class="ident" id="4776225">ovfl</span><span class="op" id="4776229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776234">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776249">if</span>&nbsp;<span class="op" id="4776252">!</span><span class="ident" id="4776253">dec</span><span class="op" id="4776256">.</span><span class="ident" id="4776257">compatibleType</span><span class="op" id="4776271">(</span><span class="ident" id="4776272">localField</span><span class="op" id="4776282">.</span><span class="ident" id="4776283">Type</span><span class="op" id="4776287">,</span>&nbsp;<span class="ident" id="4776289">wireField</span><span class="op" id="4776298">.</span><span class="ident" id="4776299">Id</span><span class="op" id="4776301">,</span>&nbsp;<span class="builtinfunc" id="4776303">make</span><span class="op" id="4776307">(</span><span class="keyword" id="4776308">map</span><span class="op" id="4776311">[</span><span class="ident" id="4776312">reflect</span><span class="op" id="4776319">.</span><span class="ident" id="4776320">Type</span><span class="op" id="4776324">]</span><span class="ident" id="4776325">typeId</span><span class="op" id="4776331">)</span><span class="op" id="4776332">)</span>&nbsp;<span class="op" id="4776334">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776339">errorf</span><span class="op" id="4776345">(</span><span class="string" id="4776346">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="4776388">,</span>&nbsp;<span class="ident" id="4776390">localField</span><span class="op" id="4776400">.</span><span class="ident" id="4776401">Type</span><span class="op" id="4776405">,</span>&nbsp;<span class="ident" id="4776407">wireStruct</span><span class="op" id="4776417">.</span><span class="ident" id="4776418">Name</span><span class="op" id="4776422">,</span>&nbsp;<span class="ident" id="4776424">wireField</span><span class="op" id="4776433">.</span><span class="ident" id="4776434">Name</span><span class="op" id="4776438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776446">op</span>&nbsp;<span class="op" id="4776449">:=</span>&nbsp;<span class="ident" id="4776452">dec</span><span class="op" id="4776455">.</span><span class="ident" id="4776456">decOpFor</span><span class="op" id="4776464">(</span><span class="ident" id="4776465">wireField</span><span class="op" id="4776474">.</span><span class="ident" id="4776475">Id</span><span class="op" id="4776477">,</span>&nbsp;<span class="ident" id="4776479">localField</span><span class="op" id="4776489">.</span><span class="ident" id="4776490">Type</span><span class="op" id="4776494">,</span>&nbsp;<span class="ident" id="4776496">localField</span><span class="op" id="4776506">.</span><span class="ident" id="4776507">Name</span><span class="op" id="4776511">,</span>&nbsp;<span class="ident" id="4776513">seen</span><span class="op" id="4776517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776521">engine</span><span class="op" id="4776527">.</span><span class="ident" id="4776528">instr</span><span class="op" id="4776533">[</span><span class="ident" id="4776534">fieldnum</span><span class="op" id="4776542">]</span>&nbsp;<span class="op" id="4776544">=</span>&nbsp;<span class="ident" id="4776546">decInstr</span><span class="op" id="4776554">{</span><span class="op" id="4776555">*</span><span class="ident" id="4776556">op</span><span class="op" id="4776558">,</span>&nbsp;<span class="ident" id="4776560">fieldnum</span><span class="op" id="4776568">,</span>&nbsp;<span class="ident" id="4776570">localField</span><span class="op" id="4776580">.</span><span class="ident" id="4776581">Index</span><span class="op" id="4776586">,</span>&nbsp;<span class="ident" id="4776588">ovfl</span><span class="op" id="4776592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776596">engine</span><span class="op" id="4776602">.</span><span class="ident" id="4776603">numInstr</span><span class="op" id="4776611">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776618">return</span><br>
<span class="lineno"></span><span class="op" id="4776625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4776628">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="4776690">func</span>&nbsp;<span class="op" id="4776695">(</span><span class="ident" id="4776696">dec</span>&nbsp;<span class="op" id="4776700">*</span><span class="ident" id="4776701">Decoder</span><span class="op" id="4776708">)</span>&nbsp;<span class="ident" id="4776710">getDecEnginePtr</span><span class="op" id="4776725">(</span><span class="ident" id="4776726">remoteId</span>&nbsp;<span class="ident" id="4776735">typeId</span><span class="op" id="4776741">,</span>&nbsp;<span class="ident" id="4776743">ut</span>&nbsp;<span class="op" id="4776746">*</span><span class="ident" id="4776747">userTypeInfo</span><span class="op" id="4776759">)</span>&nbsp;<span class="op" id="4776761">(</span><span class="ident" id="4776762">enginePtr</span>&nbsp;<span class="op" id="4776772">*</span><span class="op" id="4776773">*</span><span class="ident" id="4776774">decEngine</span><span class="op" id="4776783">,</span>&nbsp;<span class="ident" id="4776785">err</span>&nbsp;<span class="builtintype" id="4776789">error</span><span class="op" id="4776794">)</span>&nbsp;<span class="op" id="4776796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776799">rt</span>&nbsp;<span class="op" id="4776802">:=</span>&nbsp;<span class="ident" id="4776805">ut</span><span class="op" id="4776807">.</span><span class="ident" id="4776808">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776814">decoderMap</span><span class="op" id="4776824">,</span>&nbsp;<span class="ident" id="4776826">ok</span>&nbsp;<span class="op" id="4776829">:=</span>&nbsp;<span class="ident" id="4776832">dec</span><span class="op" id="4776835">.</span><span class="ident" id="4776836">decoderCache</span><span class="op" id="4776848">[</span><span class="ident" id="4776849">rt</span><span class="op" id="4776851">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776854">if</span>&nbsp;<span class="op" id="4776857">!</span><span class="ident" id="4776858">ok</span>&nbsp;<span class="op" id="4776861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776865">decoderMap</span>&nbsp;<span class="op" id="4776876">=</span>&nbsp;<span class="builtinfunc" id="4776878">make</span><span class="op" id="4776882">(</span><span class="keyword" id="4776883">map</span><span class="op" id="4776886">[</span><span class="ident" id="4776887">typeId</span><span class="op" id="4776893">]</span><span class="op" id="4776894">*</span><span class="op" id="4776895">*</span><span class="ident" id="4776896">decEngine</span><span class="op" id="4776905">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776909">dec</span><span class="op" id="4776912">.</span><span class="ident" id="4776913">decoderCache</span><span class="op" id="4776925">[</span><span class="ident" id="4776926">rt</span><span class="op" id="4776928">]</span>&nbsp;<span class="op" id="4776930">=</span>&nbsp;<span class="ident" id="4776932">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776947">if</span>&nbsp;<span class="ident" id="4776950">enginePtr</span><span class="op" id="4776959">,</span>&nbsp;<span class="ident" id="4776961">ok</span>&nbsp;<span class="op" id="4776964">=</span>&nbsp;<span class="ident" id="4776966">decoderMap</span><span class="op" id="4776976">[</span><span class="ident" id="4776977">remoteId</span><span class="op" id="4776985">]</span><span class="op" id="4776986">;</span>&nbsp;<span class="op" id="4776988">!</span><span class="ident" id="4776989">ok</span>&nbsp;<span class="op" id="4776992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4776996">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777075">enginePtr</span>&nbsp;<span class="op" id="4777085">=</span>&nbsp;<span class="builtinfunc" id="4777087">new</span><span class="op" id="4777090">(</span><span class="op" id="4777091">*</span><span class="ident" id="4777092">decEngine</span><span class="op" id="4777101">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777105">decoderMap</span><span class="op" id="4777115">[</span><span class="ident" id="4777116">remoteId</span><span class="op" id="4777124">]</span>&nbsp;<span class="op" id="4777126">=</span>&nbsp;<span class="ident" id="4777128">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777140">*</span><span class="ident" id="4777141">enginePtr</span><span class="op" id="4777150">,</span>&nbsp;<span class="ident" id="4777152">err</span>&nbsp;<span class="op" id="4777156">=</span>&nbsp;<span class="ident" id="4777158">dec</span><span class="op" id="4777161">.</span><span class="ident" id="4777162">compileDec</span><span class="op" id="4777172">(</span><span class="ident" id="4777173">remoteId</span><span class="op" id="4777181">,</span>&nbsp;<span class="ident" id="4777183">ut</span><span class="op" id="4777185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777189">if</span>&nbsp;<span class="ident" id="4777192">err</span>&nbsp;<span class="op" id="4777196">!=</span>&nbsp;<span class="ident" id="4777199">nil</span>&nbsp;<span class="op" id="4777203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4777208">delete</span><span class="op" id="4777214">(</span><span class="ident" id="4777215">decoderMap</span><span class="op" id="4777225">,</span>&nbsp;<span class="ident" id="4777227">remoteId</span><span class="op" id="4777235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777239">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777245">return</span><br>
<span class="lineno"></span><span class="op" id="4777252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4777255">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="4777328">type</span>&nbsp;<span class="ident" id="4777333">emptyStruct</span>&nbsp;<span class="keyword" id="4777345">struct</span><span class="op" id="4777351">{</span><span class="op" id="4777352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4777355">var</span>&nbsp;<span class="ident" id="4777359">emptyStructType</span>&nbsp;<span class="op" id="4777375">=</span>&nbsp;<span class="ident" id="4777377">reflect</span><span class="op" id="4777384">.</span><span class="ident" id="4777385">TypeOf</span><span class="op" id="4777391">(</span><span class="ident" id="4777392">emptyStruct</span><span class="op" id="4777403">{</span><span class="op" id="4777404">}</span><span class="op" id="4777405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4777408">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="4777504">func</span>&nbsp;<span class="op" id="4777509">(</span><span class="ident" id="4777510">dec</span>&nbsp;<span class="op" id="4777514">*</span><span class="ident" id="4777515">Decoder</span><span class="op" id="4777522">)</span>&nbsp;<span class="ident" id="4777524">getIgnoreEnginePtr</span><span class="op" id="4777542">(</span><span class="ident" id="4777543">wireId</span>&nbsp;<span class="ident" id="4777550">typeId</span><span class="op" id="4777556">)</span>&nbsp;<span class="op" id="4777558">(</span><span class="ident" id="4777559">enginePtr</span>&nbsp;<span class="op" id="4777569">*</span><span class="op" id="4777570">*</span><span class="ident" id="4777571">decEngine</span><span class="op" id="4777580">,</span>&nbsp;<span class="ident" id="4777582">err</span>&nbsp;<span class="builtintype" id="4777586">error</span><span class="op" id="4777591">)</span>&nbsp;<span class="op" id="4777593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777596">var</span>&nbsp;<span class="ident" id="4777600">ok</span>&nbsp;<span class="builtintype" id="4777603">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777609">if</span>&nbsp;<span class="ident" id="4777612">enginePtr</span><span class="op" id="4777621">,</span>&nbsp;<span class="ident" id="4777623">ok</span>&nbsp;<span class="op" id="4777626">=</span>&nbsp;<span class="ident" id="4777628">dec</span><span class="op" id="4777631">.</span><span class="ident" id="4777632">ignorerCache</span><span class="op" id="4777644">[</span><span class="ident" id="4777645">wireId</span><span class="op" id="4777651">]</span><span class="op" id="4777652">;</span>&nbsp;<span class="op" id="4777654">!</span><span class="ident" id="4777655">ok</span>&nbsp;<span class="op" id="4777658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4777662">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777741">enginePtr</span>&nbsp;<span class="op" id="4777751">=</span>&nbsp;<span class="builtinfunc" id="4777753">new</span><span class="op" id="4777756">(</span><span class="op" id="4777757">*</span><span class="ident" id="4777758">decEngine</span><span class="op" id="4777767">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777771">dec</span><span class="op" id="4777774">.</span><span class="ident" id="4777775">ignorerCache</span><span class="op" id="4777787">[</span><span class="ident" id="4777788">wireId</span><span class="op" id="4777794">]</span>&nbsp;<span class="op" id="4777796">=</span>&nbsp;<span class="ident" id="4777798">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777810">wire</span>&nbsp;<span class="op" id="4777815">:=</span>&nbsp;<span class="ident" id="4777818">dec</span><span class="op" id="4777821">.</span><span class="ident" id="4777822">wireType</span><span class="op" id="4777830">[</span><span class="ident" id="4777831">wireId</span><span class="op" id="4777837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777841">if</span>&nbsp;<span class="ident" id="4777844">wire</span>&nbsp;<span class="op" id="4777849">!=</span>&nbsp;<span class="ident" id="4777852">nil</span>&nbsp;<span class="op" id="4777856">&amp;&amp;</span>&nbsp;<span class="ident" id="4777859">wire</span><span class="op" id="4777863">.</span><span class="ident" id="4777864">StructT</span>&nbsp;<span class="op" id="4777872">!=</span>&nbsp;<span class="ident" id="4777875">nil</span>&nbsp;<span class="op" id="4777879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777884">*</span><span class="ident" id="4777885">enginePtr</span><span class="op" id="4777894">,</span>&nbsp;<span class="ident" id="4777896">err</span>&nbsp;<span class="op" id="4777900">=</span>&nbsp;<span class="ident" id="4777902">dec</span><span class="op" id="4777905">.</span><span class="ident" id="4777906">compileDec</span><span class="op" id="4777916">(</span><span class="ident" id="4777917">wireId</span><span class="op" id="4777923">,</span>&nbsp;<span class="ident" id="4777925">userType</span><span class="op" id="4777933">(</span><span class="ident" id="4777934">emptyStructType</span><span class="op" id="4777949">)</span><span class="op" id="4777950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777954">}</span>&nbsp;<span class="keyword" id="4777956">else</span>&nbsp;<span class="op" id="4777961">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777966">*</span><span class="ident" id="4777967">enginePtr</span><span class="op" id="4777976">,</span>&nbsp;<span class="ident" id="4777978">err</span>&nbsp;<span class="op" id="4777982">=</span>&nbsp;<span class="ident" id="4777984">dec</span><span class="op" id="4777987">.</span><span class="ident" id="4777988">compileIgnoreSingle</span><span class="op" id="4778007">(</span><span class="ident" id="4778008">wireId</span><span class="op" id="4778014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4778018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778022">if</span>&nbsp;<span class="ident" id="4778025">err</span>&nbsp;<span class="op" id="4778029">!=</span>&nbsp;<span class="ident" id="4778032">nil</span>&nbsp;<span class="op" id="4778036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4778041">delete</span><span class="op" id="4778047">(</span><span class="ident" id="4778048">dec</span><span class="op" id="4778051">.</span><span class="ident" id="4778052">ignorerCache</span><span class="op" id="4778064">,</span>&nbsp;<span class="ident" id="4778066">wireId</span><span class="op" id="4778072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4778076">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4778079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778082">return</span><br>
<span class="lineno"></span><span class="op" id="4778089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4778092">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="4778176">func</span>&nbsp;<span class="op" id="4778181">(</span><span class="ident" id="4778182">dec</span>&nbsp;<span class="op" id="4778186">*</span><span class="ident" id="4778187">Decoder</span><span class="op" id="4778194">)</span>&nbsp;<span class="ident" id="4778196">decodeValue</span><span class="op" id="4778207">(</span><span class="ident" id="4778208">wireId</span>&nbsp;<span class="ident" id="4778215">typeId</span><span class="op" id="4778221">,</span>&nbsp;<span class="ident" id="4778223">value</span>&nbsp;<span class="ident" id="4778229">reflect</span><span class="op" id="4778236">.</span><span class="ident" id="4778237">Value</span><span class="op" id="4778242">)</span>&nbsp;<span class="op" id="4778244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778247">defer</span>&nbsp;<span class="ident" id="4778253">catchError</span><span class="op" id="4778263">(</span><span class="op" id="4778264">&amp;</span><span class="ident" id="4778265">dec</span><span class="op" id="4778268">.</span><span class="ident" id="4778269">err</span><span class="op" id="4778272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4778275">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778342">if</span>&nbsp;<span class="op" id="4778345">!</span><span class="ident" id="4778346">value</span><span class="op" id="4778351">.</span><span class="ident" id="4778352">IsValid</span><span class="op" id="4778359">(</span><span class="op" id="4778360">)</span>&nbsp;<span class="op" id="4778362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778366">dec</span><span class="op" id="4778369">.</span><span class="ident" id="4778370">decodeIgnoredValue</span><span class="op" id="4778388">(</span><span class="ident" id="4778389">wireId</span><span class="op" id="4778395">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778399">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4778407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4778410">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778455">ut</span>&nbsp;<span class="op" id="4778458">:=</span>&nbsp;<span class="ident" id="4778461">userType</span><span class="op" id="4778469">(</span><span class="ident" id="4778470">value</span><span class="op" id="4778475">.</span><span class="ident" id="4778476">Type</span><span class="op" id="4778480">(</span><span class="op" id="4778481">)</span><span class="op" id="4778482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778485">base</span>&nbsp;<span class="op" id="4778490">:=</span>&nbsp;<span class="ident" id="4778493">ut</span><span class="op" id="4778495">.</span><span class="ident" id="4778496">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778502">var</span>&nbsp;<span class="ident" id="4778506">enginePtr</span>&nbsp;<span class="op" id="4778516">*</span><span class="op" id="4778517">*</span><span class="ident" id="4778518">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778529">enginePtr</span><span class="op" id="4778538">,</span>&nbsp;<span class="ident" id="4778540">dec</span><span class="op" id="4778543">.</span><span class="ident" id="4778544">err</span>&nbsp;<span class="op" id="4778548">=</span>&nbsp;<span class="ident" id="4778550">dec</span><span class="op" id="4778553">.</span><span class="ident" id="4778554">getDecEnginePtr</span><span class="op" id="4778569">(</span><span class="ident" id="4778570">wireId</span><span class="op" id="4778576">,</span>&nbsp;<span class="ident" id="4778578">ut</span><span class="op" id="4778580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778583">if</span>&nbsp;<span class="ident" id="4778586">dec</span><span class="op" id="4778589">.</span><span class="ident" id="4778590">err</span>&nbsp;<span class="op" id="4778594">!=</span>&nbsp;<span class="ident" id="4778597">nil</span>&nbsp;<span class="op" id="4778601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4778613">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778616">value</span>&nbsp;<span class="op" id="4778622">=</span>&nbsp;<span class="ident" id="4778624">decAlloc</span><span class="op" id="4778632">(</span><span class="ident" id="4778633">value</span><span class="op" id="4778638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778641">engine</span>&nbsp;<span class="op" id="4778648">:=</span>&nbsp;<span class="op" id="4778651">*</span><span class="ident" id="4778652">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778663">if</span>&nbsp;<span class="ident" id="4778666">st</span>&nbsp;<span class="op" id="4778669">:=</span>&nbsp;<span class="ident" id="4778672">base</span><span class="op" id="4778676">;</span>&nbsp;<span class="ident" id="4778678">st</span><span class="op" id="4778680">.</span><span class="ident" id="4778681">Kind</span><span class="op" id="4778685">(</span><span class="op" id="4778686">)</span>&nbsp;<span class="op" id="4778688">==</span>&nbsp;<span class="ident" id="4778691">reflect</span><span class="op" id="4778698">.</span><span class="ident" id="4778699">Struct</span>&nbsp;<span class="op" id="4778706">&amp;&amp;</span>&nbsp;<span class="ident" id="4778709">ut</span><span class="op" id="4778711">.</span><span class="ident" id="4778712">externalDec</span>&nbsp;<span class="op" id="4778724">==</span>&nbsp;<span class="num" id="4778727">0</span>&nbsp;<span class="op" id="4778729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4778733">if</span>&nbsp;<span class="ident" id="4778736">engine</span><span class="op" id="4778742">.</span><span class="ident" id="4778743">numInstr</span>&nbsp;<span class="op" id="4778752">==</span>&nbsp;<span class="num" id="4778755">0</span>&nbsp;<span class="op" id="4778757">&amp;&amp;</span>&nbsp;<span class="ident" id="4778760">st</span><span class="op" id="4778762">.</span><span class="ident" id="4778763">NumField</span><span class="op" id="4778771">(</span><span class="op" id="4778772">)</span>&nbsp;<span class="op" id="4778774">&gt;</span>&nbsp;<span class="num" id="4778776">0</span>&nbsp;<span class="op" id="4778778">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778784">dec</span><span class="op" id="4778787">.</span><span class="ident" id="4778788">wireType</span><span class="op" id="4778796">[</span><span class="ident" id="4778797">wireId</span><span class="op" id="4778803">]</span>&nbsp;<span class="op" id="4778805">!=</span>&nbsp;<span class="ident" id="4778808">nil</span>&nbsp;<span class="op" id="4778812">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4778815">len</span><span class="op" id="4778818">(</span><span class="ident" id="4778819">dec</span><span class="op" id="4778822">.</span><span class="ident" id="4778823">wireType</span><span class="op" id="4778831">[</span><span class="ident" id="4778832">wireId</span><span class="op" id="4778838">]</span><span class="op" id="4778839">.</span><span class="ident" id="4778840">StructT</span><span class="op" id="4778847">.</span><span class="ident" id="4778848">Field</span><span class="op" id="4778853">)</span>&nbsp;<span class="op" id="4778855">&gt;</span>&nbsp;<span class="num" id="4778857">0</span>&nbsp;<span class="op" id="4778859">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778864">name</span>&nbsp;<span class="op" id="4778869">:=</span>&nbsp;<span class="ident" id="4778872">base</span><span class="op" id="4778876">.</span><span class="ident" id="4778877">Name</span><span class="op" id="4778881">(</span><span class="op" id="4778882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778887">errorf</span><span class="op" id="4778893">(</span><span class="string" id="4778894">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="4778953">,</span>&nbsp;<span class="ident" id="4778955">name</span><span class="op" id="4778959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4778963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4778967">dec</span><span class="op" id="4778970">.</span><span class="ident" id="4778971">decodeStruct</span><span class="op" id="4778983">(</span><span class="ident" id="4778984">engine</span><span class="op" id="4778990">,</span>&nbsp;<span class="ident" id="4778992">ut</span><span class="op" id="4778994">,</span>&nbsp;<span class="ident" id="4778996">value</span><span class="op" id="4779001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779004">}</span>&nbsp;<span class="keyword" id="4779006">else</span>&nbsp;<span class="op" id="4779011">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779015">dec</span><span class="op" id="4779018">.</span><span class="ident" id="4779019">decodeSingle</span><span class="op" id="4779031">(</span><span class="ident" id="4779032">engine</span><span class="op" id="4779038">,</span>&nbsp;<span class="ident" id="4779040">ut</span><span class="op" id="4779042">,</span>&nbsp;<span class="ident" id="4779044">value</span><span class="op" id="4779049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779052">}</span><br>
<span class="lineno"></span><span class="op" id="4779054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4779057">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="4779163">func</span>&nbsp;<span class="op" id="4779168">(</span><span class="ident" id="4779169">dec</span>&nbsp;<span class="op" id="4779173">*</span><span class="ident" id="4779174">Decoder</span><span class="op" id="4779181">)</span>&nbsp;<span class="ident" id="4779183">decodeIgnoredValue</span><span class="op" id="4779201">(</span><span class="ident" id="4779202">wireId</span>&nbsp;<span class="ident" id="4779209">typeId</span><span class="op" id="4779215">)</span>&nbsp;<span class="op" id="4779217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779220">var</span>&nbsp;<span class="ident" id="4779224">enginePtr</span>&nbsp;<span class="op" id="4779234">*</span><span class="op" id="4779235">*</span><span class="ident" id="4779236">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779247">enginePtr</span><span class="op" id="4779256">,</span>&nbsp;<span class="ident" id="4779258">dec</span><span class="op" id="4779261">.</span><span class="ident" id="4779262">err</span>&nbsp;<span class="op" id="4779266">=</span>&nbsp;<span class="ident" id="4779268">dec</span><span class="op" id="4779271">.</span><span class="ident" id="4779272">getIgnoreEnginePtr</span><span class="op" id="4779290">(</span><span class="ident" id="4779291">wireId</span><span class="op" id="4779297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779300">if</span>&nbsp;<span class="ident" id="4779303">dec</span><span class="op" id="4779306">.</span><span class="ident" id="4779307">err</span>&nbsp;<span class="op" id="4779311">!=</span>&nbsp;<span class="ident" id="4779314">nil</span>&nbsp;<span class="op" id="4779318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779322">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779333">wire</span>&nbsp;<span class="op" id="4779338">:=</span>&nbsp;<span class="ident" id="4779341">dec</span><span class="op" id="4779344">.</span><span class="ident" id="4779345">wireType</span><span class="op" id="4779353">[</span><span class="ident" id="4779354">wireId</span><span class="op" id="4779360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779363">if</span>&nbsp;<span class="ident" id="4779366">wire</span>&nbsp;<span class="op" id="4779371">!=</span>&nbsp;<span class="ident" id="4779374">nil</span>&nbsp;<span class="op" id="4779378">&amp;&amp;</span>&nbsp;<span class="ident" id="4779381">wire</span><span class="op" id="4779385">.</span><span class="ident" id="4779386">StructT</span>&nbsp;<span class="op" id="4779394">!=</span>&nbsp;<span class="ident" id="4779397">nil</span>&nbsp;<span class="op" id="4779401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779405">dec</span><span class="op" id="4779408">.</span><span class="ident" id="4779409">ignoreStruct</span><span class="op" id="4779421">(</span><span class="op" id="4779422">*</span><span class="ident" id="4779423">enginePtr</span><span class="op" id="4779432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779435">}</span>&nbsp;<span class="keyword" id="4779437">else</span>&nbsp;<span class="op" id="4779442">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779446">dec</span><span class="op" id="4779449">.</span><span class="ident" id="4779450">ignoreSingle</span><span class="op" id="4779462">(</span><span class="op" id="4779463">*</span><span class="ident" id="4779464">enginePtr</span><span class="op" id="4779473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779476">}</span><br>
<span class="lineno"></span><span class="op" id="4779478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4779481">func</span>&nbsp;<span class="ident" id="4779486">init</span><span class="op" id="4779490">(</span><span class="op" id="4779491">)</span>&nbsp;<span class="op" id="4779493">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779496">var</span>&nbsp;<span class="ident" id="4779500">iop</span><span class="op" id="4779503">,</span>&nbsp;<span class="ident" id="4779505">uop</span>&nbsp;<span class="ident" id="4779509">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779516">switch</span>&nbsp;<span class="ident" id="4779523">reflect</span><span class="op" id="4779530">.</span><span class="ident" id="4779531">TypeOf</span><span class="op" id="4779537">(</span><span class="builtintype" id="4779538">int</span><span class="op" id="4779541">(</span><span class="num" id="4779542">0</span><span class="op" id="4779543">)</span><span class="op" id="4779544">)</span><span class="op" id="4779545">.</span><span class="ident" id="4779546">Bits</span><span class="op" id="4779550">(</span><span class="op" id="4779551">)</span>&nbsp;<span class="op" id="4779553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779556">case</span>&nbsp;<span class="num" id="4779561">32</span><span class="op" id="4779563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779567">iop</span>&nbsp;<span class="op" id="4779571">=</span>&nbsp;<span class="ident" id="4779573">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779584">uop</span>&nbsp;<span class="op" id="4779588">=</span>&nbsp;<span class="ident" id="4779590">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779601">case</span>&nbsp;<span class="num" id="4779606">64</span><span class="op" id="4779608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779612">iop</span>&nbsp;<span class="op" id="4779616">=</span>&nbsp;<span class="ident" id="4779618">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779629">uop</span>&nbsp;<span class="op" id="4779633">=</span>&nbsp;<span class="ident" id="4779635">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779646">default</span><span class="op" id="4779653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4779657">panic</span><span class="op" id="4779662">(</span><span class="string" id="4779663">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="4779694">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779700">decOpTable</span><span class="op" id="4779710">[</span><span class="ident" id="4779711">reflect</span><span class="op" id="4779718">.</span><span class="ident" id="4779719">Int</span><span class="op" id="4779722">]</span>&nbsp;<span class="op" id="4779724">=</span>&nbsp;<span class="ident" id="4779726">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779731">decOpTable</span><span class="op" id="4779741">[</span><span class="ident" id="4779742">reflect</span><span class="op" id="4779749">.</span><span class="ident" id="4779750">Uint</span><span class="op" id="4779754">]</span>&nbsp;<span class="op" id="4779756">=</span>&nbsp;<span class="ident" id="4779758">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4779764">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779784">switch</span>&nbsp;<span class="ident" id="4779791">reflect</span><span class="op" id="4779798">.</span><span class="ident" id="4779799">TypeOf</span><span class="op" id="4779805">(</span><span class="builtintype" id="4779806">uintptr</span><span class="op" id="4779813">(</span><span class="num" id="4779814">0</span><span class="op" id="4779815">)</span><span class="op" id="4779816">)</span><span class="op" id="4779817">.</span><span class="ident" id="4779818">Bits</span><span class="op" id="4779822">(</span><span class="op" id="4779823">)</span>&nbsp;<span class="op" id="4779825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779828">case</span>&nbsp;<span class="num" id="4779833">32</span><span class="op" id="4779835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779839">uop</span>&nbsp;<span class="op" id="4779843">=</span>&nbsp;<span class="ident" id="4779845">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779856">case</span>&nbsp;<span class="num" id="4779861">64</span><span class="op" id="4779863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779867">uop</span>&nbsp;<span class="op" id="4779871">=</span>&nbsp;<span class="ident" id="4779873">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779884">default</span><span class="op" id="4779891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4779895">panic</span><span class="op" id="4779900">(</span><span class="string" id="4779901">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="4779931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779937">decOpTable</span><span class="op" id="4779947">[</span><span class="ident" id="4779948">reflect</span><span class="op" id="4779955">.</span><span class="ident" id="4779956">Uintptr</span><span class="op" id="4779963">]</span>&nbsp;<span class="op" id="4779965">=</span>&nbsp;<span class="ident" id="4779967">uop</span><br>
<span class="lineno"></span><span class="op" id="4779971">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="4779974">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4780023">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4780083">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="4780116">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="4780145">func</span>&nbsp;<span class="ident" id="4780150">allocValue</span><span class="op" id="4780160">(</span><span class="ident" id="4780161">t</span>&nbsp;<span class="ident" id="4780163">reflect</span><span class="op" id="4780170">.</span><span class="ident" id="4780171">Type</span><span class="op" id="4780175">)</span>&nbsp;<span class="ident" id="4780177">reflect</span><span class="op" id="4780184">.</span><span class="ident" id="4780185">Value</span>&nbsp;<span class="op" id="4780191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780194">return</span>&nbsp;<span class="ident" id="4780201">reflect</span><span class="op" id="4780208">.</span><span class="ident" id="4780209">New</span><span class="op" id="4780212">(</span><span class="ident" id="4780213">t</span><span class="op" id="4780214">)</span><span class="op" id="4780215">.</span><span class="ident" id="4780216">Elem</span><span class="op" id="4780220">(</span><span class="op" id="4780221">)</span><br>
<span class="lineno"></span><span class="op" id="4780223">}</span>
</div>
</body>
</html>
