<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3681687">package</span>&nbsp;<span class="ident" id="3681695">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3681702">import</span>&nbsp;<span class="op" id="3681709">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3681712">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3681721">&#34;math&#34;</span><br>
<span class="lineno"></span><span class="op" id="3681728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3681731">//&nbsp;Var&nbsp;reprsents&nbsp;a&nbsp;variable&nbsp;object</span><br>
<span class="lineno"></span><span class="keyword" id="3681766">type</span>&nbsp;<span class="ident" id="3681771">Var</span>&nbsp;<span class="keyword" id="3681775">struct</span>&nbsp;<span class="op" id="3681782">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681785">align</span>&nbsp;<span class="builtintype" id="3681791">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681799">buf</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3681805">*</span><span class="ident" id="3681806">bytes</span><span class="op" id="3681811">.</span><span class="ident" id="3681812">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681821">addr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3681828">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681836">prePad</span>&nbsp;<span class="builtintype" id="3681843">uint32</span><br>
<span class="lineno">15</span><span class="op" id="3681850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3681853">//&nbsp;NewVar&nbsp;creates&nbsp;a&nbsp;new&nbsp;relocatable&nbsp;data&nbsp;section.</span><br>
<span class="lineno"></span><span class="keyword" id="3681903">func</span>&nbsp;<span class="ident" id="3681908">NewVar</span><span class="op" id="3681914">(</span><span class="ident" id="3681915">align</span>&nbsp;<span class="builtintype" id="3681921">uint32</span><span class="op" id="3681927">)</span>&nbsp;<span class="op" id="3681929">*</span><span class="ident" id="3681930">Var</span>&nbsp;<span class="op" id="3681934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681937">ret</span>&nbsp;<span class="op" id="3681941">:=</span>&nbsp;<span class="builtinfunc" id="3681944">new</span><span class="op" id="3681947">(</span><span class="ident" id="3681948">Var</span><span class="op" id="3681951">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681955">if</span>&nbsp;<span class="ident" id="3681958">align</span>&nbsp;<span class="op" id="3681964">==</span>&nbsp;<span class="num" id="3681967">0</span>&nbsp;<span class="op" id="3681969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681973">align</span>&nbsp;<span class="op" id="3681979">=</span>&nbsp;<span class="num" id="3681981">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681984">}</span>&nbsp;<span class="keyword" id="3681986">else</span>&nbsp;<span class="keyword" id="3681991">if</span>&nbsp;<span class="ident" id="3681994">align</span>&nbsp;<span class="op" id="3682000">!=</span>&nbsp;<span class="num" id="3682003">1</span>&nbsp;<span class="op" id="3682005">&amp;&amp;</span>&nbsp;<span class="ident" id="3682008">align</span>&nbsp;<span class="op" id="3682014">!=</span>&nbsp;<span class="num" id="3682017">4</span>&nbsp;<span class="op" id="3682019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3682023">panic</span><span class="op" id="3682028">(</span><span class="string" id="3682029">&#34;invalid&nbsp;align&#34;</span><span class="op" id="3682044">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3682047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682051">ret</span><span class="op" id="3682054">.</span><span class="ident" id="3682055">align</span>&nbsp;<span class="op" id="3682061">=</span>&nbsp;<span class="ident" id="3682063">align</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682070">ret</span><span class="op" id="3682073">.</span><span class="ident" id="3682074">buf</span>&nbsp;<span class="op" id="3682078">=</span>&nbsp;<span class="builtinfunc" id="3682080">new</span><span class="op" id="3682083">(</span><span class="ident" id="3682084">bytes</span><span class="op" id="3682089">.</span><span class="ident" id="3682090">Buffer</span><span class="op" id="3682096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682100">return</span>&nbsp;<span class="ident" id="3682107">ret</span><br>
<span class="lineno"></span><span class="op" id="3682111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3682114">//&nbsp;Write&nbsp;appends&nbsp;bytes&nbsp;to&nbsp;this&nbsp;data&nbsp;section.</span><br>
<span class="lineno"></span><span class="keyword" id="3682159">func</span>&nbsp;<span class="op" id="3682164">(</span><span class="ident" id="3682165">v</span>&nbsp;<span class="op" id="3682167">*</span><span class="ident" id="3682168">Var</span><span class="op" id="3682171">)</span>&nbsp;<span class="ident" id="3682173">Write</span><span class="op" id="3682178">(</span><span class="ident" id="3682179">buf</span>&nbsp;<span class="op" id="3682183">[</span><span class="op" id="3682184">]</span><span class="builtintype" id="3682185">byte</span><span class="op" id="3682189">)</span>&nbsp;<span class="op" id="3682191">(</span><span class="builtintype" id="3682192">int</span><span class="op" id="3682195">,</span>&nbsp;<span class="builtintype" id="3682197">error</span><span class="op" id="3682202">)</span>&nbsp;<span class="op" id="3682204">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682207">return</span>&nbsp;<span class="ident" id="3682214">v</span><span class="op" id="3682215">.</span><span class="ident" id="3682216">buf</span><span class="op" id="3682219">.</span><span class="ident" id="3682220">Write</span><span class="op" id="3682225">(</span><span class="ident" id="3682226">buf</span><span class="op" id="3682229">)</span><br>
<span class="lineno"></span><span class="op" id="3682231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3682234">//&nbsp;Pad&nbsp;pads&nbsp;n&nbsp;bytes&nbsp;into&nbsp;this&nbsp;data&nbsp;section</span><br>
<span class="lineno"></span><span class="keyword" id="3682277">func</span>&nbsp;<span class="op" id="3682282">(</span><span class="ident" id="3682283">v</span>&nbsp;<span class="op" id="3682285">*</span><span class="ident" id="3682286">Var</span><span class="op" id="3682289">)</span>&nbsp;<span class="ident" id="3682291">Pad</span><span class="op" id="3682294">(</span><span class="ident" id="3682295">n</span>&nbsp;<span class="builtintype" id="3682297">uint32</span><span class="op" id="3682303">)</span>&nbsp;<span class="op" id="3682305">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682308">v</span><span class="op" id="3682309">.</span><span class="ident" id="3682310">buf</span><span class="op" id="3682313">.</span><span class="ident" id="3682314">Write</span><span class="op" id="3682319">(</span><span class="builtinfunc" id="3682320">make</span><span class="op" id="3682324">(</span><span class="op" id="3682325">[</span><span class="op" id="3682326">]</span><span class="builtintype" id="3682327">byte</span><span class="op" id="3682331">,</span>&nbsp;<span class="ident" id="3682333">n</span><span class="op" id="3682334">)</span><span class="op" id="3682335">)</span><br>
<span class="lineno"></span><span class="op" id="3682337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3682340">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;current&nbsp;size&nbsp;of&nbsp;the&nbsp;section</span><br>
<span class="lineno"></span><span class="keyword" id="3682388">func</span>&nbsp;<span class="op" id="3682393">(</span><span class="ident" id="3682394">v</span>&nbsp;<span class="op" id="3682396">*</span><span class="ident" id="3682397">Var</span><span class="op" id="3682400">)</span>&nbsp;<span class="ident" id="3682402">Size</span><span class="op" id="3682406">(</span><span class="op" id="3682407">)</span>&nbsp;<span class="builtintype" id="3682409">uint32</span>&nbsp;<span class="op" id="3682416">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682419">return</span>&nbsp;<span class="builtintype" id="3682426">uint32</span><span class="op" id="3682432">(</span><span class="ident" id="3682433">v</span><span class="op" id="3682434">.</span><span class="ident" id="3682435">buf</span><span class="op" id="3682438">.</span><span class="ident" id="3682439">Len</span><span class="op" id="3682442">(</span><span class="op" id="3682443">)</span><span class="op" id="3682444">)</span><br>
<span class="lineno"></span><span class="op" id="3682446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3682449">//&nbsp;TooLarge&nbsp;checks&nbsp;if&nbsp;the&nbsp;size&nbsp;is&nbsp;larger&nbsp;than&nbsp;2GB</span><br>
<span class="lineno"></span><span class="keyword" id="3682499">func</span>&nbsp;<span class="op" id="3682504">(</span><span class="ident" id="3682505">v</span>&nbsp;<span class="op" id="3682507">*</span><span class="ident" id="3682508">Var</span><span class="op" id="3682511">)</span>&nbsp;<span class="ident" id="3682513">TooLarge</span><span class="op" id="3682521">(</span><span class="op" id="3682522">)</span>&nbsp;<span class="builtintype" id="3682524">bool</span>&nbsp;<span class="op" id="3682529">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682532">return</span>&nbsp;<span class="ident" id="3682539">v</span><span class="op" id="3682540">.</span><span class="ident" id="3682541">buf</span><span class="op" id="3682544">.</span><span class="ident" id="3682545">Len</span><span class="op" id="3682548">(</span><span class="op" id="3682549">)</span>&nbsp;<span class="op" id="3682551">&gt;</span>&nbsp;<span class="ident" id="3682553">math</span><span class="op" id="3682557">.</span><span class="ident" id="3682558">MaxInt32</span><br>
<span class="lineno"></span><span class="op" id="3682567">}</span>
</div>
</body>
</html>
