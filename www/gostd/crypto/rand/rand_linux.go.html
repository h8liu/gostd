<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rand</h2>
<ul>
<li><a href="/gostd/crypto/rand/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand.go.html">rand.go</a></li>
<li><a href="/gostd/crypto/rand/rand_linux.go.html">rand_linux.go</a></li>
<li><a href="/gostd/crypto/rand/rand_test.go.html">rand_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand_unix.go.html">rand_unix.go</a></li>
<li><a href="/gostd/crypto/rand/util.go.html">util.go</a></li>
<li><a href="/gostd/crypto/rand/util_test.go.html">util_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3828377">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3828433">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3828487">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3828538">package</span>&nbsp;<span class="ident" id="3828546">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3828552">import</span>&nbsp;<span class="op" id="3828559">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3828562">&#34;internal/syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3828582">&#34;sync&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3828589">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3828592">func</span>&nbsp;<span class="ident" id="3828597">init</span><span class="op" id="3828601">(</span><span class="op" id="3828602">)</span>&nbsp;<span class="op" id="3828604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828607">altGetRandom</span>&nbsp;<span class="op" id="3828620">=</span>&nbsp;<span class="ident" id="3828622">getRandomLinux</span><br>
<span class="lineno"></span><span class="op" id="3828637">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3828640">var</span>&nbsp;<span class="op" id="3828644">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828647">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828658">sync</span><span class="op" id="3828662">.</span><span class="ident" id="3828663">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828669">useSyscall</span>&nbsp;<span class="builtintype" id="3828680">bool</span><br>
<span class="lineno"></span><span class="op" id="3828685">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3828688">func</span>&nbsp;<span class="ident" id="3828693">pickStrategy</span><span class="op" id="3828705">(</span><span class="op" id="3828706">)</span>&nbsp;<span class="op" id="3828708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828711">//&nbsp;Test&nbsp;whether&nbsp;we&nbsp;should&nbsp;use&nbsp;the&nbsp;system&nbsp;call&nbsp;or&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828775">//&nbsp;We&#39;ll&nbsp;fall&nbsp;back&nbsp;to&nbsp;urandom&nbsp;if:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828810">//&nbsp;-&nbsp;the&nbsp;kernel&nbsp;is&nbsp;too&nbsp;old&nbsp;(before&nbsp;3.17)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828852">//&nbsp;-&nbsp;the&nbsp;machine&nbsp;has&nbsp;no&nbsp;entropy&nbsp;available&nbsp;(early&nbsp;boot&nbsp;+&nbsp;no&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828921">//&nbsp;&nbsp;&nbsp;entropy&nbsp;source?)&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;avoid&nbsp;blocking&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828981">var</span>&nbsp;<span class="ident" id="3828985">buf</span>&nbsp;<span class="op" id="3828989">[</span><span class="num" id="3828990">1</span><span class="op" id="3828991">]</span><span class="builtintype" id="3828992">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828998">n</span><span class="op" id="3828999">,</span>&nbsp;<span class="ident" id="3829001">err</span>&nbsp;<span class="op" id="3829005">:=</span>&nbsp;<span class="ident" id="3829008">syscall</span><span class="op" id="3829015">.</span><span class="ident" id="3829016">GetRandom</span><span class="op" id="3829025">(</span><span class="ident" id="3829026">buf</span><span class="op" id="3829029">[</span><span class="op" id="3829030">:</span><span class="op" id="3829031">]</span><span class="op" id="3829032">,</span>&nbsp;<span class="ident" id="3829034">syscall</span><span class="op" id="3829041">.</span><span class="ident" id="3829042">GRND_NONBLOCK</span><span class="op" id="3829055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829058">useSyscall</span>&nbsp;<span class="op" id="3829069">=</span>&nbsp;<span class="ident" id="3829071">n</span>&nbsp;<span class="op" id="3829073">==</span>&nbsp;<span class="num" id="3829076">1</span>&nbsp;<span class="op" id="3829078">&amp;&amp;</span>&nbsp;<span class="ident" id="3829081">err</span>&nbsp;<span class="op" id="3829085">==</span>&nbsp;<span class="ident" id="3829088">nil</span><br>
<span class="lineno">30</span><span class="op" id="3829092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3829095">func</span>&nbsp;<span class="ident" id="3829100">getRandomLinux</span><span class="op" id="3829114">(</span><span class="ident" id="3829115">p</span>&nbsp;<span class="op" id="3829117">[</span><span class="op" id="3829118">]</span><span class="builtintype" id="3829119">byte</span><span class="op" id="3829123">)</span>&nbsp;<span class="op" id="3829125">(</span><span class="ident" id="3829126">ok</span>&nbsp;<span class="builtintype" id="3829129">bool</span><span class="op" id="3829133">)</span>&nbsp;<span class="op" id="3829135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829138">once</span><span class="op" id="3829142">.</span><span class="ident" id="3829143">Do</span><span class="op" id="3829145">(</span><span class="ident" id="3829146">pickStrategy</span><span class="op" id="3829158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829161">if</span>&nbsp;<span class="op" id="3829164">!</span><span class="ident" id="3829165">useSyscall</span>&nbsp;<span class="op" id="3829176">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829180">return</span>&nbsp;<span class="builtintype" id="3829187">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829197">n</span><span class="op" id="3829198">,</span>&nbsp;<span class="ident" id="3829200">err</span>&nbsp;<span class="op" id="3829204">:=</span>&nbsp;<span class="ident" id="3829207">syscall</span><span class="op" id="3829214">.</span><span class="ident" id="3829215">GetRandom</span><span class="op" id="3829224">(</span><span class="ident" id="3829225">p</span><span class="op" id="3829226">,</span>&nbsp;<span class="num" id="3829228">0</span><span class="op" id="3829229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829232">return</span>&nbsp;<span class="ident" id="3829239">n</span>&nbsp;<span class="op" id="3829241">==</span>&nbsp;<span class="builtinfunc" id="3829244">len</span><span class="op" id="3829247">(</span><span class="ident" id="3829248">p</span><span class="op" id="3829249">)</span>&nbsp;<span class="op" id="3829251">&amp;&amp;</span>&nbsp;<span class="ident" id="3829254">err</span>&nbsp;<span class="op" id="3829258">==</span>&nbsp;<span class="ident" id="3829261">nil</span><br>
<span class="lineno"></span><span class="op" id="3829265">}</span>
</div>
</body>
</html>
