<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7949566">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7949622">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7949676">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7949727">package</span>&nbsp;<span class="ident" id="7949735">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7949746">import</span>&nbsp;<span class="op" id="7949753">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7949756">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7949765">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7949774">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7949780">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7949791">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7949802">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7949812">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7949815">type</span>&nbsp;<span class="ident" id="7949820">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="7949843">struct</span>&nbsp;<span class="op" id="7949850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949853">in</span><span class="op" id="7949855">,</span>&nbsp;<span class="ident" id="7949857">out</span>&nbsp;<span class="builtintype" id="7949861">string</span><br>
<span class="lineno"></span><span class="op" id="7949868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7949871">var</span>&nbsp;<span class="ident" id="7949875">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7949899">=</span>&nbsp;<span class="op" id="7949901">[</span><span class="op" id="7949902">]</span><span class="ident" id="7949903">canonicalHeaderKeyTest</span><span class="op" id="7949925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949928">{</span><span class="string" id="7949929">&#34;a-b-c&#34;</span><span class="op" id="7949936">,</span>&nbsp;<span class="string" id="7949938">&#34;A-B-C&#34;</span><span class="op" id="7949945">}</span><span class="op" id="7949946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949949">{</span><span class="string" id="7949950">&#34;a-1-c&#34;</span><span class="op" id="7949957">,</span>&nbsp;<span class="string" id="7949959">&#34;A-1-C&#34;</span><span class="op" id="7949966">}</span><span class="op" id="7949967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949970">{</span><span class="string" id="7949971">&#34;User-Agent&#34;</span><span class="op" id="7949983">,</span>&nbsp;<span class="string" id="7949985">&#34;User-Agent&#34;</span><span class="op" id="7949997">}</span><span class="op" id="7949998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950001">{</span><span class="string" id="7950002">&#34;uSER-aGENT&#34;</span><span class="op" id="7950014">,</span>&nbsp;<span class="string" id="7950016">&#34;User-Agent&#34;</span><span class="op" id="7950028">}</span><span class="op" id="7950029">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950032">{</span><span class="string" id="7950033">&#34;user-agent&#34;</span><span class="op" id="7950045">,</span>&nbsp;<span class="string" id="7950047">&#34;User-Agent&#34;</span><span class="op" id="7950059">}</span><span class="op" id="7950060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950063">{</span><span class="string" id="7950064">&#34;USER-AGENT&#34;</span><span class="op" id="7950076">,</span>&nbsp;<span class="string" id="7950078">&#34;User-Agent&#34;</span><span class="op" id="7950090">}</span><span class="op" id="7950091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950094">{</span><span class="string" id="7950095">&#34;üser-agenT&#34;</span><span class="op" id="7950108">,</span>&nbsp;<span class="string" id="7950110">&#34;üser-Agent&#34;</span><span class="op" id="7950123">}</span><span class="op" id="7950124">,</span>&nbsp;<span class="comment" id="7950126">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7950151">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950206">{</span><span class="string" id="7950207">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="7950235">,</span>&nbsp;<span class="string" id="7950237">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="7950265">}</span><span class="op" id="7950266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950269">{</span><span class="string" id="7950270">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7950279">,</span>&nbsp;<span class="string" id="7950281">&#34;Foo-Bar&#34;</span><span class="op" id="7950290">}</span><span class="op" id="7950291">,</span><br>
<span class="lineno"></span><span class="op" id="7950293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950296">func</span>&nbsp;<span class="ident" id="7950301">TestCanonicalMIMEHeaderKey</span><span class="op" id="7950327">(</span><span class="ident" id="7950328">t</span>&nbsp;<span class="op" id="7950330">*</span><span class="ident" id="7950331">testing</span><span class="op" id="7950338">.</span><span class="ident" id="7950339">T</span><span class="op" id="7950340">)</span>&nbsp;<span class="op" id="7950342">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950345">for</span>&nbsp;<span class="ident" id="7950349">_</span><span class="op" id="7950350">,</span>&nbsp;<span class="ident" id="7950352">tt</span>&nbsp;<span class="op" id="7950355">:=</span>&nbsp;<span class="keyword" id="7950358">range</span>&nbsp;<span class="ident" id="7950364">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7950388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950392">if</span>&nbsp;<span class="ident" id="7950395">s</span>&nbsp;<span class="op" id="7950397">:=</span>&nbsp;<span class="ident" id="7950400">CanonicalMIMEHeaderKey</span><span class="op" id="7950422">(</span><span class="ident" id="7950423">tt</span><span class="op" id="7950425">.</span><span class="ident" id="7950426">in</span><span class="op" id="7950428">)</span><span class="op" id="7950429">;</span>&nbsp;<span class="ident" id="7950431">s</span>&nbsp;<span class="op" id="7950433">!=</span>&nbsp;<span class="ident" id="7950436">tt</span><span class="op" id="7950438">.</span><span class="ident" id="7950439">out</span>&nbsp;<span class="op" id="7950443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950448">t</span><span class="op" id="7950449">.</span><span class="ident" id="7950450">Errorf</span><span class="op" id="7950456">(</span><span class="string" id="7950457">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7950499">,</span>&nbsp;<span class="ident" id="7950501">tt</span><span class="op" id="7950503">.</span><span class="ident" id="7950504">in</span><span class="op" id="7950506">,</span>&nbsp;<span class="ident" id="7950508">s</span><span class="op" id="7950509">,</span>&nbsp;<span class="ident" id="7950511">tt</span><span class="op" id="7950513">.</span><span class="ident" id="7950514">out</span><span class="op" id="7950517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950524">}</span><br>
<span class="lineno">40</span><span class="op" id="7950526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950529">func</span>&nbsp;<span class="ident" id="7950534">reader</span><span class="op" id="7950540">(</span><span class="ident" id="7950541">s</span>&nbsp;<span class="builtintype" id="7950543">string</span><span class="op" id="7950549">)</span>&nbsp;<span class="op" id="7950551">*</span><span class="ident" id="7950552">Reader</span>&nbsp;<span class="op" id="7950559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950562">return</span>&nbsp;<span class="ident" id="7950569">NewReader</span><span class="op" id="7950578">(</span><span class="ident" id="7950579">bufio</span><span class="op" id="7950584">.</span><span class="ident" id="7950585">NewReader</span><span class="op" id="7950594">(</span><span class="ident" id="7950595">strings</span><span class="op" id="7950602">.</span><span class="ident" id="7950603">NewReader</span><span class="op" id="7950612">(</span><span class="ident" id="7950613">s</span><span class="op" id="7950614">)</span><span class="op" id="7950615">)</span><span class="op" id="7950616">)</span><br>
<span class="lineno"></span><span class="op" id="7950618">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7950621">func</span>&nbsp;<span class="ident" id="7950626">TestReadLine</span><span class="op" id="7950638">(</span><span class="ident" id="7950639">t</span>&nbsp;<span class="op" id="7950641">*</span><span class="ident" id="7950642">testing</span><span class="op" id="7950649">.</span><span class="ident" id="7950650">T</span><span class="op" id="7950651">)</span>&nbsp;<span class="op" id="7950653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950656">r</span>&nbsp;<span class="op" id="7950658">:=</span>&nbsp;<span class="ident" id="7950661">reader</span><span class="op" id="7950667">(</span><span class="string" id="7950668">&#34;line1\nline2\n&#34;</span><span class="op" id="7950684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950687">s</span><span class="op" id="7950688">,</span>&nbsp;<span class="ident" id="7950690">err</span>&nbsp;<span class="op" id="7950694">:=</span>&nbsp;<span class="ident" id="7950697">r</span><span class="op" id="7950698">.</span><span class="ident" id="7950699">ReadLine</span><span class="op" id="7950707">(</span><span class="op" id="7950708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950711">if</span>&nbsp;<span class="ident" id="7950714">s</span>&nbsp;<span class="op" id="7950716">!=</span>&nbsp;<span class="string" id="7950719">&#34;line1&#34;</span>&nbsp;<span class="op" id="7950727">||</span>&nbsp;<span class="ident" id="7950730">err</span>&nbsp;<span class="op" id="7950734">!=</span>&nbsp;<span class="ident" id="7950737">nil</span>&nbsp;<span class="op" id="7950741">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950745">t</span><span class="op" id="7950746">.</span><span class="ident" id="7950747">Fatalf</span><span class="op" id="7950753">(</span><span class="string" id="7950754">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7950770">,</span>&nbsp;<span class="ident" id="7950772">s</span><span class="op" id="7950773">,</span>&nbsp;<span class="ident" id="7950775">err</span><span class="op" id="7950778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950784">s</span><span class="op" id="7950785">,</span>&nbsp;<span class="ident" id="7950787">err</span>&nbsp;<span class="op" id="7950791">=</span>&nbsp;<span class="ident" id="7950793">r</span><span class="op" id="7950794">.</span><span class="ident" id="7950795">ReadLine</span><span class="op" id="7950803">(</span><span class="op" id="7950804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950807">if</span>&nbsp;<span class="ident" id="7950810">s</span>&nbsp;<span class="op" id="7950812">!=</span>&nbsp;<span class="string" id="7950815">&#34;line2&#34;</span>&nbsp;<span class="op" id="7950823">||</span>&nbsp;<span class="ident" id="7950826">err</span>&nbsp;<span class="op" id="7950830">!=</span>&nbsp;<span class="ident" id="7950833">nil</span>&nbsp;<span class="op" id="7950837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950841">t</span><span class="op" id="7950842">.</span><span class="ident" id="7950843">Fatalf</span><span class="op" id="7950849">(</span><span class="string" id="7950850">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7950866">,</span>&nbsp;<span class="ident" id="7950868">s</span><span class="op" id="7950869">,</span>&nbsp;<span class="ident" id="7950871">err</span><span class="op" id="7950874">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950880">s</span><span class="op" id="7950881">,</span>&nbsp;<span class="ident" id="7950883">err</span>&nbsp;<span class="op" id="7950887">=</span>&nbsp;<span class="ident" id="7950889">r</span><span class="op" id="7950890">.</span><span class="ident" id="7950891">ReadLine</span><span class="op" id="7950899">(</span><span class="op" id="7950900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950903">if</span>&nbsp;<span class="ident" id="7950906">s</span>&nbsp;<span class="op" id="7950908">!=</span>&nbsp;<span class="string" id="7950911">&#34;&#34;</span>&nbsp;<span class="op" id="7950914">||</span>&nbsp;<span class="ident" id="7950917">err</span>&nbsp;<span class="op" id="7950921">!=</span>&nbsp;<span class="ident" id="7950924">io</span><span class="op" id="7950926">.</span><span class="ident" id="7950927">EOF</span>&nbsp;<span class="op" id="7950931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950935">t</span><span class="op" id="7950936">.</span><span class="ident" id="7950937">Fatalf</span><span class="op" id="7950943">(</span><span class="string" id="7950944">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7950957">,</span>&nbsp;<span class="ident" id="7950959">s</span><span class="op" id="7950960">,</span>&nbsp;<span class="ident" id="7950962">err</span><span class="op" id="7950965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950968">}</span><br>
<span class="lineno">60</span><span class="op" id="7950970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950973">func</span>&nbsp;<span class="ident" id="7950978">TestReadContinuedLine</span><span class="op" id="7950999">(</span><span class="ident" id="7951000">t</span>&nbsp;<span class="op" id="7951002">*</span><span class="ident" id="7951003">testing</span><span class="op" id="7951010">.</span><span class="ident" id="7951011">T</span><span class="op" id="7951012">)</span>&nbsp;<span class="op" id="7951014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951017">r</span>&nbsp;<span class="op" id="7951019">:=</span>&nbsp;<span class="ident" id="7951022">reader</span><span class="op" id="7951028">(</span><span class="string" id="7951029">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="7951055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951058">s</span><span class="op" id="7951059">,</span>&nbsp;<span class="ident" id="7951061">err</span>&nbsp;<span class="op" id="7951065">:=</span>&nbsp;<span class="ident" id="7951068">r</span><span class="op" id="7951069">.</span><span class="ident" id="7951070">ReadContinuedLine</span><span class="op" id="7951087">(</span><span class="op" id="7951088">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951091">if</span>&nbsp;<span class="ident" id="7951094">s</span>&nbsp;<span class="op" id="7951096">!=</span>&nbsp;<span class="string" id="7951099">&#34;line1&#34;</span>&nbsp;<span class="op" id="7951107">||</span>&nbsp;<span class="ident" id="7951110">err</span>&nbsp;<span class="op" id="7951114">!=</span>&nbsp;<span class="ident" id="7951117">nil</span>&nbsp;<span class="op" id="7951121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951125">t</span><span class="op" id="7951126">.</span><span class="ident" id="7951127">Fatalf</span><span class="op" id="7951133">(</span><span class="string" id="7951134">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7951150">,</span>&nbsp;<span class="ident" id="7951152">s</span><span class="op" id="7951153">,</span>&nbsp;<span class="ident" id="7951155">err</span><span class="op" id="7951158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951164">s</span><span class="op" id="7951165">,</span>&nbsp;<span class="ident" id="7951167">err</span>&nbsp;<span class="op" id="7951171">=</span>&nbsp;<span class="ident" id="7951173">r</span><span class="op" id="7951174">.</span><span class="ident" id="7951175">ReadContinuedLine</span><span class="op" id="7951192">(</span><span class="op" id="7951193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951196">if</span>&nbsp;<span class="ident" id="7951199">s</span>&nbsp;<span class="op" id="7951201">!=</span>&nbsp;<span class="string" id="7951204">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="7951213">||</span>&nbsp;<span class="ident" id="7951216">err</span>&nbsp;<span class="op" id="7951220">!=</span>&nbsp;<span class="ident" id="7951223">nil</span>&nbsp;<span class="op" id="7951227">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951231">t</span><span class="op" id="7951232">.</span><span class="ident" id="7951233">Fatalf</span><span class="op" id="7951239">(</span><span class="string" id="7951240">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7951256">,</span>&nbsp;<span class="ident" id="7951258">s</span><span class="op" id="7951259">,</span>&nbsp;<span class="ident" id="7951261">err</span><span class="op" id="7951264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951270">s</span><span class="op" id="7951271">,</span>&nbsp;<span class="ident" id="7951273">err</span>&nbsp;<span class="op" id="7951277">=</span>&nbsp;<span class="ident" id="7951279">r</span><span class="op" id="7951280">.</span><span class="ident" id="7951281">ReadContinuedLine</span><span class="op" id="7951298">(</span><span class="op" id="7951299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951302">if</span>&nbsp;<span class="ident" id="7951305">s</span>&nbsp;<span class="op" id="7951307">!=</span>&nbsp;<span class="string" id="7951310">&#34;line3&#34;</span>&nbsp;<span class="op" id="7951318">||</span>&nbsp;<span class="ident" id="7951321">err</span>&nbsp;<span class="op" id="7951325">!=</span>&nbsp;<span class="ident" id="7951328">nil</span>&nbsp;<span class="op" id="7951332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951336">t</span><span class="op" id="7951337">.</span><span class="ident" id="7951338">Fatalf</span><span class="op" id="7951344">(</span><span class="string" id="7951345">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7951361">,</span>&nbsp;<span class="ident" id="7951363">s</span><span class="op" id="7951364">,</span>&nbsp;<span class="ident" id="7951366">err</span><span class="op" id="7951369">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951375">s</span><span class="op" id="7951376">,</span>&nbsp;<span class="ident" id="7951378">err</span>&nbsp;<span class="op" id="7951382">=</span>&nbsp;<span class="ident" id="7951384">r</span><span class="op" id="7951385">.</span><span class="ident" id="7951386">ReadContinuedLine</span><span class="op" id="7951403">(</span><span class="op" id="7951404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951407">if</span>&nbsp;<span class="ident" id="7951410">s</span>&nbsp;<span class="op" id="7951412">!=</span>&nbsp;<span class="string" id="7951415">&#34;&#34;</span>&nbsp;<span class="op" id="7951418">||</span>&nbsp;<span class="ident" id="7951421">err</span>&nbsp;<span class="op" id="7951425">!=</span>&nbsp;<span class="ident" id="7951428">io</span><span class="op" id="7951430">.</span><span class="ident" id="7951431">EOF</span>&nbsp;<span class="op" id="7951435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951439">t</span><span class="op" id="7951440">.</span><span class="ident" id="7951441">Fatalf</span><span class="op" id="7951447">(</span><span class="string" id="7951448">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7951461">,</span>&nbsp;<span class="ident" id="7951463">s</span><span class="op" id="7951464">,</span>&nbsp;<span class="ident" id="7951466">err</span><span class="op" id="7951469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951472">}</span><br>
<span class="lineno">80</span><span class="op" id="7951474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7951477">func</span>&nbsp;<span class="ident" id="7951482">TestReadCodeLine</span><span class="op" id="7951498">(</span><span class="ident" id="7951499">t</span>&nbsp;<span class="op" id="7951501">*</span><span class="ident" id="7951502">testing</span><span class="op" id="7951509">.</span><span class="ident" id="7951510">T</span><span class="op" id="7951511">)</span>&nbsp;<span class="op" id="7951513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951516">r</span>&nbsp;<span class="op" id="7951518">:=</span>&nbsp;<span class="ident" id="7951521">reader</span><span class="op" id="7951527">(</span><span class="string" id="7951528">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="7951559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951562">code</span><span class="op" id="7951566">,</span>&nbsp;<span class="ident" id="7951568">msg</span><span class="op" id="7951571">,</span>&nbsp;<span class="ident" id="7951573">err</span>&nbsp;<span class="op" id="7951577">:=</span>&nbsp;<span class="ident" id="7951580">r</span><span class="op" id="7951581">.</span><span class="ident" id="7951582">ReadCodeLine</span><span class="op" id="7951594">(</span><span class="num" id="7951595">0</span><span class="op" id="7951596">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951599">if</span>&nbsp;<span class="ident" id="7951602">code</span>&nbsp;<span class="op" id="7951607">!=</span>&nbsp;<span class="num" id="7951610">123</span>&nbsp;<span class="op" id="7951614">||</span>&nbsp;<span class="ident" id="7951617">msg</span>&nbsp;<span class="op" id="7951621">!=</span>&nbsp;<span class="string" id="7951624">&#34;hi&#34;</span>&nbsp;<span class="op" id="7951629">||</span>&nbsp;<span class="ident" id="7951632">err</span>&nbsp;<span class="op" id="7951636">!=</span>&nbsp;<span class="ident" id="7951639">nil</span>&nbsp;<span class="op" id="7951643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951647">t</span><span class="op" id="7951648">.</span><span class="ident" id="7951649">Fatalf</span><span class="op" id="7951655">(</span><span class="string" id="7951656">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7951676">,</span>&nbsp;<span class="ident" id="7951678">code</span><span class="op" id="7951682">,</span>&nbsp;<span class="ident" id="7951684">msg</span><span class="op" id="7951687">,</span>&nbsp;<span class="ident" id="7951689">err</span><span class="op" id="7951692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951698">code</span><span class="op" id="7951702">,</span>&nbsp;<span class="ident" id="7951704">msg</span><span class="op" id="7951707">,</span>&nbsp;<span class="ident" id="7951709">err</span>&nbsp;<span class="op" id="7951713">=</span>&nbsp;<span class="ident" id="7951715">r</span><span class="op" id="7951716">.</span><span class="ident" id="7951717">ReadCodeLine</span><span class="op" id="7951729">(</span><span class="num" id="7951730">23</span><span class="op" id="7951732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951735">if</span>&nbsp;<span class="ident" id="7951738">code</span>&nbsp;<span class="op" id="7951743">!=</span>&nbsp;<span class="num" id="7951746">234</span>&nbsp;<span class="op" id="7951750">||</span>&nbsp;<span class="ident" id="7951753">msg</span>&nbsp;<span class="op" id="7951757">!=</span>&nbsp;<span class="string" id="7951760">&#34;bye&#34;</span>&nbsp;<span class="op" id="7951766">||</span>&nbsp;<span class="ident" id="7951769">err</span>&nbsp;<span class="op" id="7951773">!=</span>&nbsp;<span class="ident" id="7951776">nil</span>&nbsp;<span class="op" id="7951780">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951784">t</span><span class="op" id="7951785">.</span><span class="ident" id="7951786">Fatalf</span><span class="op" id="7951792">(</span><span class="string" id="7951793">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7951813">,</span>&nbsp;<span class="ident" id="7951815">code</span><span class="op" id="7951819">,</span>&nbsp;<span class="ident" id="7951821">msg</span><span class="op" id="7951824">,</span>&nbsp;<span class="ident" id="7951826">err</span><span class="op" id="7951829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951835">code</span><span class="op" id="7951839">,</span>&nbsp;<span class="ident" id="7951841">msg</span><span class="op" id="7951844">,</span>&nbsp;<span class="ident" id="7951846">err</span>&nbsp;<span class="op" id="7951850">=</span>&nbsp;<span class="ident" id="7951852">r</span><span class="op" id="7951853">.</span><span class="ident" id="7951854">ReadCodeLine</span><span class="op" id="7951866">(</span><span class="num" id="7951867">346</span><span class="op" id="7951870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951873">if</span>&nbsp;<span class="ident" id="7951876">code</span>&nbsp;<span class="op" id="7951881">!=</span>&nbsp;<span class="num" id="7951884">345</span>&nbsp;<span class="op" id="7951888">||</span>&nbsp;<span class="ident" id="7951891">msg</span>&nbsp;<span class="op" id="7951895">!=</span>&nbsp;<span class="string" id="7951898">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="7951907">||</span>&nbsp;<span class="ident" id="7951910">err</span>&nbsp;<span class="op" id="7951914">==</span>&nbsp;<span class="ident" id="7951917">nil</span>&nbsp;<span class="op" id="7951921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951925">t</span><span class="op" id="7951926">.</span><span class="ident" id="7951927">Fatalf</span><span class="op" id="7951933">(</span><span class="string" id="7951934">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7951954">,</span>&nbsp;<span class="ident" id="7951956">code</span><span class="op" id="7951960">,</span>&nbsp;<span class="ident" id="7951962">msg</span><span class="op" id="7951965">,</span>&nbsp;<span class="ident" id="7951967">err</span><span class="op" id="7951970">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951976">if</span>&nbsp;<span class="ident" id="7951979">e</span><span class="op" id="7951980">,</span>&nbsp;<span class="ident" id="7951982">ok</span>&nbsp;<span class="op" id="7951985">:=</span>&nbsp;<span class="ident" id="7951988">err</span><span class="op" id="7951991">.</span><span class="op" id="7951992">(</span><span class="op" id="7951993">*</span><span class="ident" id="7951994">Error</span><span class="op" id="7951999">)</span><span class="op" id="7952000">;</span>&nbsp;<span class="op" id="7952002">!</span><span class="ident" id="7952003">ok</span>&nbsp;<span class="op" id="7952006">||</span>&nbsp;<span class="ident" id="7952009">e</span><span class="op" id="7952010">.</span><span class="ident" id="7952011">Code</span>&nbsp;<span class="op" id="7952016">!=</span>&nbsp;<span class="ident" id="7952019">code</span>&nbsp;<span class="op" id="7952024">||</span>&nbsp;<span class="ident" id="7952027">e</span><span class="op" id="7952028">.</span><span class="ident" id="7952029">Msg</span>&nbsp;<span class="op" id="7952033">!=</span>&nbsp;<span class="ident" id="7952036">msg</span>&nbsp;<span class="op" id="7952040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952044">t</span><span class="op" id="7952045">.</span><span class="ident" id="7952046">Fatalf</span><span class="op" id="7952052">(</span><span class="string" id="7952053">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="7952079">,</span>&nbsp;<span class="ident" id="7952081">err</span><span class="op" id="7952084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952090">code</span><span class="op" id="7952094">,</span>&nbsp;<span class="ident" id="7952096">msg</span><span class="op" id="7952099">,</span>&nbsp;<span class="ident" id="7952101">err</span>&nbsp;<span class="op" id="7952105">=</span>&nbsp;<span class="ident" id="7952107">r</span><span class="op" id="7952108">.</span><span class="ident" id="7952109">ReadCodeLine</span><span class="op" id="7952121">(</span><span class="num" id="7952122">1</span><span class="op" id="7952123">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952126">if</span>&nbsp;<span class="ident" id="7952129">code</span>&nbsp;<span class="op" id="7952134">!=</span>&nbsp;<span class="num" id="7952137">0</span>&nbsp;<span class="op" id="7952139">||</span>&nbsp;<span class="ident" id="7952142">msg</span>&nbsp;<span class="op" id="7952146">!=</span>&nbsp;<span class="string" id="7952149">&#34;&#34;</span>&nbsp;<span class="op" id="7952152">||</span>&nbsp;<span class="ident" id="7952155">err</span>&nbsp;<span class="op" id="7952159">!=</span>&nbsp;<span class="ident" id="7952162">io</span><span class="op" id="7952164">.</span><span class="ident" id="7952165">EOF</span>&nbsp;<span class="op" id="7952169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952173">t</span><span class="op" id="7952174">.</span><span class="ident" id="7952175">Fatalf</span><span class="op" id="7952181">(</span><span class="string" id="7952182">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7952199">,</span>&nbsp;<span class="ident" id="7952201">code</span><span class="op" id="7952205">,</span>&nbsp;<span class="ident" id="7952207">msg</span><span class="op" id="7952210">,</span>&nbsp;<span class="ident" id="7952212">err</span><span class="op" id="7952215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952218">}</span><br>
<span class="lineno"></span><span class="op" id="7952220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7952223">func</span>&nbsp;<span class="ident" id="7952228">TestReadDotLines</span><span class="op" id="7952244">(</span><span class="ident" id="7952245">t</span>&nbsp;<span class="op" id="7952247">*</span><span class="ident" id="7952248">testing</span><span class="op" id="7952255">.</span><span class="ident" id="7952256">T</span><span class="op" id="7952257">)</span>&nbsp;<span class="op" id="7952259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952262">r</span>&nbsp;<span class="op" id="7952264">:=</span>&nbsp;<span class="ident" id="7952267">reader</span><span class="op" id="7952273">(</span><span class="string" id="7952274">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="7952337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952340">s</span><span class="op" id="7952341">,</span>&nbsp;<span class="ident" id="7952343">err</span>&nbsp;<span class="op" id="7952347">:=</span>&nbsp;<span class="ident" id="7952350">r</span><span class="op" id="7952351">.</span><span class="ident" id="7952352">ReadDotLines</span><span class="op" id="7952364">(</span><span class="op" id="7952365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952368">want</span>&nbsp;<span class="op" id="7952373">:=</span>&nbsp;<span class="op" id="7952376">[</span><span class="op" id="7952377">]</span><span class="builtintype" id="7952378">string</span><span class="op" id="7952384">{</span><span class="string" id="7952385">&#34;dotlines&#34;</span><span class="op" id="7952395">,</span>&nbsp;<span class="string" id="7952397">&#34;foo&#34;</span><span class="op" id="7952402">,</span>&nbsp;<span class="string" id="7952404">&#34;.bar&#34;</span><span class="op" id="7952410">,</span>&nbsp;<span class="string" id="7952412">&#34;..baz&#34;</span><span class="op" id="7952419">,</span>&nbsp;<span class="string" id="7952421">&#34;quux&#34;</span><span class="op" id="7952427">,</span>&nbsp;<span class="string" id="7952429">&#34;&#34;</span><span class="op" id="7952431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952434">if</span>&nbsp;<span class="op" id="7952437">!</span><span class="ident" id="7952438">reflect</span><span class="op" id="7952445">.</span><span class="ident" id="7952446">DeepEqual</span><span class="op" id="7952455">(</span><span class="ident" id="7952456">s</span><span class="op" id="7952457">,</span>&nbsp;<span class="ident" id="7952459">want</span><span class="op" id="7952463">)</span>&nbsp;<span class="op" id="7952465">||</span>&nbsp;<span class="ident" id="7952468">err</span>&nbsp;<span class="op" id="7952472">!=</span>&nbsp;<span class="ident" id="7952475">nil</span>&nbsp;<span class="op" id="7952479">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952483">t</span><span class="op" id="7952484">.</span><span class="ident" id="7952485">Fatalf</span><span class="op" id="7952491">(</span><span class="string" id="7952492">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7952514">,</span>&nbsp;<span class="ident" id="7952516">s</span><span class="op" id="7952517">,</span>&nbsp;<span class="ident" id="7952519">err</span><span class="op" id="7952522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952529">s</span><span class="op" id="7952530">,</span>&nbsp;<span class="ident" id="7952532">err</span>&nbsp;<span class="op" id="7952536">=</span>&nbsp;<span class="ident" id="7952538">r</span><span class="op" id="7952539">.</span><span class="ident" id="7952540">ReadDotLines</span><span class="op" id="7952552">(</span><span class="op" id="7952553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952556">want</span>&nbsp;<span class="op" id="7952561">=</span>&nbsp;<span class="op" id="7952563">[</span><span class="op" id="7952564">]</span><span class="builtintype" id="7952565">string</span><span class="op" id="7952571">{</span><span class="string" id="7952572">&#34;another&#34;</span><span class="op" id="7952581">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952584">if</span>&nbsp;<span class="op" id="7952587">!</span><span class="ident" id="7952588">reflect</span><span class="op" id="7952595">.</span><span class="ident" id="7952596">DeepEqual</span><span class="op" id="7952605">(</span><span class="ident" id="7952606">s</span><span class="op" id="7952607">,</span>&nbsp;<span class="ident" id="7952609">want</span><span class="op" id="7952613">)</span>&nbsp;<span class="op" id="7952615">||</span>&nbsp;<span class="ident" id="7952618">err</span>&nbsp;<span class="op" id="7952622">!=</span>&nbsp;<span class="ident" id="7952625">io</span><span class="op" id="7952627">.</span><span class="ident" id="7952628">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7952645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952649">t</span><span class="op" id="7952650">.</span><span class="ident" id="7952651">Fatalf</span><span class="op" id="7952657">(</span><span class="string" id="7952658">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7952681">,</span>&nbsp;<span class="ident" id="7952683">s</span><span class="op" id="7952684">,</span>&nbsp;<span class="ident" id="7952686">err</span><span class="op" id="7952689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952692">}</span><br>
<span class="lineno"></span><span class="op" id="7952694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7952697">func</span>&nbsp;<span class="ident" id="7952702">TestReadDotBytes</span><span class="op" id="7952718">(</span><span class="ident" id="7952719">t</span>&nbsp;<span class="op" id="7952721">*</span><span class="ident" id="7952722">testing</span><span class="op" id="7952729">.</span><span class="ident" id="7952730">T</span><span class="op" id="7952731">)</span>&nbsp;<span class="op" id="7952733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952736">r</span>&nbsp;<span class="op" id="7952738">:=</span>&nbsp;<span class="ident" id="7952741">reader</span><span class="op" id="7952747">(</span><span class="string" id="7952748">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="7952814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952817">b</span><span class="op" id="7952818">,</span>&nbsp;<span class="ident" id="7952820">err</span>&nbsp;<span class="op" id="7952824">:=</span>&nbsp;<span class="ident" id="7952827">r</span><span class="op" id="7952828">.</span><span class="ident" id="7952829">ReadDotBytes</span><span class="op" id="7952841">(</span><span class="op" id="7952842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952845">want</span>&nbsp;<span class="op" id="7952850">:=</span>&nbsp;<span class="op" id="7952853">[</span><span class="op" id="7952854">]</span><span class="builtintype" id="7952855">byte</span><span class="op" id="7952859">(</span><span class="string" id="7952860">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="7952898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952901">if</span>&nbsp;<span class="op" id="7952904">!</span><span class="ident" id="7952905">reflect</span><span class="op" id="7952912">.</span><span class="ident" id="7952913">DeepEqual</span><span class="op" id="7952922">(</span><span class="ident" id="7952923">b</span><span class="op" id="7952924">,</span>&nbsp;<span class="ident" id="7952926">want</span><span class="op" id="7952930">)</span>&nbsp;<span class="op" id="7952932">||</span>&nbsp;<span class="ident" id="7952935">err</span>&nbsp;<span class="op" id="7952939">!=</span>&nbsp;<span class="ident" id="7952942">nil</span>&nbsp;<span class="op" id="7952946">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952950">t</span><span class="op" id="7952951">.</span><span class="ident" id="7952952">Fatalf</span><span class="op" id="7952958">(</span><span class="string" id="7952959">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7952981">,</span>&nbsp;<span class="ident" id="7952983">b</span><span class="op" id="7952984">,</span>&nbsp;<span class="ident" id="7952986">err</span><span class="op" id="7952989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952996">b</span><span class="op" id="7952997">,</span>&nbsp;<span class="ident" id="7952999">err</span>&nbsp;<span class="op" id="7953003">=</span>&nbsp;<span class="ident" id="7953005">r</span><span class="op" id="7953006">.</span><span class="ident" id="7953007">ReadDotBytes</span><span class="op" id="7953019">(</span><span class="op" id="7953020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953023">want</span>&nbsp;<span class="op" id="7953028">=</span>&nbsp;<span class="op" id="7953030">[</span><span class="op" id="7953031">]</span><span class="builtintype" id="7953032">byte</span><span class="op" id="7953036">(</span><span class="string" id="7953037">&#34;anot.her\n&#34;</span><span class="op" id="7953049">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953052">if</span>&nbsp;<span class="op" id="7953055">!</span><span class="ident" id="7953056">reflect</span><span class="op" id="7953063">.</span><span class="ident" id="7953064">DeepEqual</span><span class="op" id="7953073">(</span><span class="ident" id="7953074">b</span><span class="op" id="7953075">,</span>&nbsp;<span class="ident" id="7953077">want</span><span class="op" id="7953081">)</span>&nbsp;<span class="op" id="7953083">||</span>&nbsp;<span class="ident" id="7953086">err</span>&nbsp;<span class="op" id="7953090">!=</span>&nbsp;<span class="ident" id="7953093">io</span><span class="op" id="7953095">.</span><span class="ident" id="7953096">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7953113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953117">t</span><span class="op" id="7953118">.</span><span class="ident" id="7953119">Fatalf</span><span class="op" id="7953125">(</span><span class="string" id="7953126">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7953149">,</span>&nbsp;<span class="ident" id="7953151">b</span><span class="op" id="7953152">,</span>&nbsp;<span class="ident" id="7953154">err</span><span class="op" id="7953157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953160">}</span><br>
<span class="lineno"></span><span class="op" id="7953162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="7953165">func</span>&nbsp;<span class="ident" id="7953170">TestReadMIMEHeader</span><span class="op" id="7953188">(</span><span class="ident" id="7953189">t</span>&nbsp;<span class="op" id="7953191">*</span><span class="ident" id="7953192">testing</span><span class="op" id="7953199">.</span><span class="ident" id="7953200">T</span><span class="op" id="7953201">)</span>&nbsp;<span class="op" id="7953203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953206">r</span>&nbsp;<span class="op" id="7953208">:=</span>&nbsp;<span class="ident" id="7953211">reader</span><span class="op" id="7953217">(</span><span class="string" id="7953218">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="7953296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953299">m</span><span class="op" id="7953300">,</span>&nbsp;<span class="ident" id="7953302">err</span>&nbsp;<span class="op" id="7953306">:=</span>&nbsp;<span class="ident" id="7953309">r</span><span class="op" id="7953310">.</span><span class="ident" id="7953311">ReadMIMEHeader</span><span class="op" id="7953325">(</span><span class="op" id="7953326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953329">want</span>&nbsp;<span class="op" id="7953334">:=</span>&nbsp;<span class="ident" id="7953337">MIMEHeader</span><span class="op" id="7953347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7953351">&#34;My-Key&#34;</span><span class="op" id="7953359">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7953363">{</span><span class="string" id="7953364">&#34;Value&nbsp;1&#34;</span><span class="op" id="7953373">,</span>&nbsp;<span class="string" id="7953375">&#34;Value&nbsp;2&#34;</span><span class="op" id="7953384">}</span><span class="op" id="7953385">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7953389">&#34;Long-Key&#34;</span><span class="op" id="7953399">:</span>&nbsp;<span class="op" id="7953401">{</span><span class="string" id="7953402">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="7953421">}</span><span class="op" id="7953422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953428">if</span>&nbsp;<span class="op" id="7953431">!</span><span class="ident" id="7953432">reflect</span><span class="op" id="7953439">.</span><span class="ident" id="7953440">DeepEqual</span><span class="op" id="7953449">(</span><span class="ident" id="7953450">m</span><span class="op" id="7953451">,</span>&nbsp;<span class="ident" id="7953453">want</span><span class="op" id="7953457">)</span>&nbsp;<span class="op" id="7953459">||</span>&nbsp;<span class="ident" id="7953462">err</span>&nbsp;<span class="op" id="7953466">!=</span>&nbsp;<span class="ident" id="7953469">nil</span>&nbsp;<span class="op" id="7953473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953477">t</span><span class="op" id="7953478">.</span><span class="ident" id="7953479">Fatalf</span><span class="op" id="7953485">(</span><span class="string" id="7953486">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7953519">,</span>&nbsp;<span class="ident" id="7953521">m</span><span class="op" id="7953522">,</span>&nbsp;<span class="ident" id="7953524">err</span><span class="op" id="7953527">,</span>&nbsp;<span class="ident" id="7953529">want</span><span class="op" id="7953533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953536">}</span><br>
<span class="lineno">145</span><span class="op" id="7953538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953541">func</span>&nbsp;<span class="ident" id="7953546">TestReadMIMEHeaderSingle</span><span class="op" id="7953570">(</span><span class="ident" id="7953571">t</span>&nbsp;<span class="op" id="7953573">*</span><span class="ident" id="7953574">testing</span><span class="op" id="7953581">.</span><span class="ident" id="7953582">T</span><span class="op" id="7953583">)</span>&nbsp;<span class="op" id="7953585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953588">r</span>&nbsp;<span class="op" id="7953590">:=</span>&nbsp;<span class="ident" id="7953593">reader</span><span class="op" id="7953599">(</span><span class="string" id="7953600">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="7953614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953617">m</span><span class="op" id="7953618">,</span>&nbsp;<span class="ident" id="7953620">err</span>&nbsp;<span class="op" id="7953624">:=</span>&nbsp;<span class="ident" id="7953627">r</span><span class="op" id="7953628">.</span><span class="ident" id="7953629">ReadMIMEHeader</span><span class="op" id="7953643">(</span><span class="op" id="7953644">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953647">want</span>&nbsp;<span class="op" id="7953652">:=</span>&nbsp;<span class="ident" id="7953655">MIMEHeader</span><span class="op" id="7953665">{</span><span class="string" id="7953666">&#34;Foo&#34;</span><span class="op" id="7953671">:</span>&nbsp;<span class="op" id="7953673">{</span><span class="string" id="7953674">&#34;bar&#34;</span><span class="op" id="7953679">}</span><span class="op" id="7953680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953683">if</span>&nbsp;<span class="op" id="7953686">!</span><span class="ident" id="7953687">reflect</span><span class="op" id="7953694">.</span><span class="ident" id="7953695">DeepEqual</span><span class="op" id="7953704">(</span><span class="ident" id="7953705">m</span><span class="op" id="7953706">,</span>&nbsp;<span class="ident" id="7953708">want</span><span class="op" id="7953712">)</span>&nbsp;<span class="op" id="7953714">||</span>&nbsp;<span class="ident" id="7953717">err</span>&nbsp;<span class="op" id="7953721">!=</span>&nbsp;<span class="ident" id="7953724">nil</span>&nbsp;<span class="op" id="7953728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953732">t</span><span class="op" id="7953733">.</span><span class="ident" id="7953734">Fatalf</span><span class="op" id="7953740">(</span><span class="string" id="7953741">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7953774">,</span>&nbsp;<span class="ident" id="7953776">m</span><span class="op" id="7953777">,</span>&nbsp;<span class="ident" id="7953779">err</span><span class="op" id="7953782">,</span>&nbsp;<span class="ident" id="7953784">want</span><span class="op" id="7953788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953791">}</span><br>
<span class="lineno"></span><span class="op" id="7953793">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7953796">func</span>&nbsp;<span class="ident" id="7953801">TestLargeReadMIMEHeader</span><span class="op" id="7953824">(</span><span class="ident" id="7953825">t</span>&nbsp;<span class="op" id="7953827">*</span><span class="ident" id="7953828">testing</span><span class="op" id="7953835">.</span><span class="ident" id="7953836">T</span><span class="op" id="7953837">)</span>&nbsp;<span class="op" id="7953839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953842">data</span>&nbsp;<span class="op" id="7953847">:=</span>&nbsp;<span class="builtinfunc" id="7953850">make</span><span class="op" id="7953854">(</span><span class="op" id="7953855">[</span><span class="op" id="7953856">]</span><span class="builtintype" id="7953857">byte</span><span class="op" id="7953861">,</span>&nbsp;<span class="num" id="7953863">16</span><span class="op" id="7953865">*</span><span class="num" id="7953866">1024</span><span class="op" id="7953870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953873">for</span>&nbsp;<span class="ident" id="7953877">i</span>&nbsp;<span class="op" id="7953879">:=</span>&nbsp;<span class="num" id="7953882">0</span><span class="op" id="7953883">;</span>&nbsp;<span class="ident" id="7953885">i</span>&nbsp;<span class="op" id="7953887">&lt;</span>&nbsp;<span class="builtinfunc" id="7953889">len</span><span class="op" id="7953892">(</span><span class="ident" id="7953893">data</span><span class="op" id="7953897">)</span><span class="op" id="7953898">;</span>&nbsp;<span class="ident" id="7953900">i</span><span class="op" id="7953901">++</span>&nbsp;<span class="op" id="7953904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953908">data</span><span class="op" id="7953912">[</span><span class="ident" id="7953913">i</span><span class="op" id="7953914">]</span>&nbsp;<span class="op" id="7953916">=</span>&nbsp;<span class="string" id="7953918">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953926">sdata</span>&nbsp;<span class="op" id="7953932">:=</span>&nbsp;<span class="builtintype" id="7953935">string</span><span class="op" id="7953941">(</span><span class="ident" id="7953942">data</span><span class="op" id="7953946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953949">r</span>&nbsp;<span class="op" id="7953951">:=</span>&nbsp;<span class="ident" id="7953954">reader</span><span class="op" id="7953960">(</span><span class="string" id="7953961">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="7953972">+</span>&nbsp;<span class="ident" id="7953974">sdata</span>&nbsp;<span class="op" id="7953980">+</span>&nbsp;<span class="string" id="7953982">&#34;\r\n\n&#34;</span><span class="op" id="7953990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953993">m</span><span class="op" id="7953994">,</span>&nbsp;<span class="ident" id="7953996">err</span>&nbsp;<span class="op" id="7954000">:=</span>&nbsp;<span class="ident" id="7954003">r</span><span class="op" id="7954004">.</span><span class="ident" id="7954005">ReadMIMEHeader</span><span class="op" id="7954019">(</span><span class="op" id="7954020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954023">if</span>&nbsp;<span class="ident" id="7954026">err</span>&nbsp;<span class="op" id="7954030">!=</span>&nbsp;<span class="ident" id="7954033">nil</span>&nbsp;<span class="op" id="7954037">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954041">t</span><span class="op" id="7954042">.</span><span class="ident" id="7954043">Fatalf</span><span class="op" id="7954049">(</span><span class="string" id="7954050">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="7954070">,</span>&nbsp;<span class="ident" id="7954072">err</span><span class="op" id="7954075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954081">cookie</span>&nbsp;<span class="op" id="7954088">:=</span>&nbsp;<span class="ident" id="7954091">m</span><span class="op" id="7954092">.</span><span class="ident" id="7954093">Get</span><span class="op" id="7954096">(</span><span class="string" id="7954097">&#34;Cookie&#34;</span><span class="op" id="7954105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954108">if</span>&nbsp;<span class="ident" id="7954111">cookie</span>&nbsp;<span class="op" id="7954118">!=</span>&nbsp;<span class="ident" id="7954121">sdata</span>&nbsp;<span class="op" id="7954127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954131">t</span><span class="op" id="7954132">.</span><span class="ident" id="7954133">Fatalf</span><span class="op" id="7954139">(</span><span class="string" id="7954140">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="7954181">,</span>&nbsp;<span class="builtinfunc" id="7954183">len</span><span class="op" id="7954186">(</span><span class="ident" id="7954187">cookie</span><span class="op" id="7954193">)</span><span class="op" id="7954194">,</span>&nbsp;<span class="builtinfunc" id="7954196">len</span><span class="op" id="7954199">(</span><span class="ident" id="7954200">sdata</span><span class="op" id="7954205">)</span><span class="op" id="7954206">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954209">}</span><br>
<span class="lineno"></span><span class="op" id="7954211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7954214">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="7954281">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="7954331">func</span>&nbsp;<span class="ident" id="7954336">TestReadMIMEHeaderNonCompliant</span><span class="op" id="7954366">(</span><span class="ident" id="7954367">t</span>&nbsp;<span class="op" id="7954369">*</span><span class="ident" id="7954370">testing</span><span class="op" id="7954377">.</span><span class="ident" id="7954378">T</span><span class="op" id="7954379">)</span>&nbsp;<span class="op" id="7954381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7954384">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7954445">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954510">r</span>&nbsp;<span class="op" id="7954512">:=</span>&nbsp;<span class="ident" id="7954515">reader</span><span class="op" id="7954521">(</span><span class="string" id="7954522">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="7954537">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954541">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="7954568">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954572">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="7954586">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954590">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="7954614">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954618">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="7954643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954646">m</span><span class="op" id="7954647">,</span>&nbsp;<span class="ident" id="7954649">err</span>&nbsp;<span class="op" id="7954653">:=</span>&nbsp;<span class="ident" id="7954656">r</span><span class="op" id="7954657">.</span><span class="ident" id="7954658">ReadMIMEHeader</span><span class="op" id="7954672">(</span><span class="op" id="7954673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954676">want</span>&nbsp;<span class="op" id="7954681">:=</span>&nbsp;<span class="ident" id="7954684">MIMEHeader</span><span class="op" id="7954694">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954698">&#34;Foo&#34;</span><span class="op" id="7954703">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954718">{</span><span class="string" id="7954719">&#34;bar&#34;</span><span class="op" id="7954724">}</span><span class="op" id="7954725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954729">&#34;Content-Language&#34;</span><span class="op" id="7954747">:</span>&nbsp;<span class="op" id="7954749">{</span><span class="string" id="7954750">&#34;en&#34;</span><span class="op" id="7954754">}</span><span class="op" id="7954755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954759">&#34;Sid&#34;</span><span class="op" id="7954764">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954779">{</span><span class="string" id="7954780">&#34;0&#34;</span><span class="op" id="7954783">}</span><span class="op" id="7954784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954788">&#34;Audio-Mode&#34;</span><span class="op" id="7954800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954808">{</span><span class="string" id="7954809">&#34;None&#34;</span><span class="op" id="7954815">}</span><span class="op" id="7954816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7954820">&#34;Privilege&#34;</span><span class="op" id="7954831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954840">{</span><span class="string" id="7954841">&#34;127&#34;</span><span class="op" id="7954846">}</span><span class="op" id="7954847">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954853">if</span>&nbsp;<span class="op" id="7954856">!</span><span class="ident" id="7954857">reflect</span><span class="op" id="7954864">.</span><span class="ident" id="7954865">DeepEqual</span><span class="op" id="7954874">(</span><span class="ident" id="7954875">m</span><span class="op" id="7954876">,</span>&nbsp;<span class="ident" id="7954878">want</span><span class="op" id="7954882">)</span>&nbsp;<span class="op" id="7954884">||</span>&nbsp;<span class="ident" id="7954887">err</span>&nbsp;<span class="op" id="7954891">!=</span>&nbsp;<span class="ident" id="7954894">nil</span>&nbsp;<span class="op" id="7954898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954902">t</span><span class="op" id="7954903">.</span><span class="ident" id="7954904">Fatalf</span><span class="op" id="7954910">(</span><span class="string" id="7954911">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="7954948">,</span>&nbsp;<span class="ident" id="7954950">m</span><span class="op" id="7954951">,</span>&nbsp;<span class="ident" id="7954953">err</span><span class="op" id="7954956">,</span>&nbsp;<span class="ident" id="7954958">want</span><span class="op" id="7954962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954965">}</span><br>
<span class="lineno"></span><span class="op" id="7954967">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="7954970">type</span>&nbsp;<span class="ident" id="7954975">readResponseTest</span>&nbsp;<span class="keyword" id="7954992">struct</span>&nbsp;<span class="op" id="7954999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955002">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7955011">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955019">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7955028">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955033">wantCode</span>&nbsp;<span class="builtintype" id="7955042">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955047">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="7955056">string</span><br>
<span class="lineno"></span><span class="op" id="7955063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955066">var</span>&nbsp;<span class="ident" id="7955070">readResponseTests</span>&nbsp;<span class="op" id="7955088">=</span>&nbsp;<span class="op" id="7955090">[</span><span class="op" id="7955091">]</span><span class="ident" id="7955092">readResponseTest</span><span class="op" id="7955108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955111">{</span><span class="string" id="7955112">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="7955165">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955169">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="7955199">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955203">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="7955216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955220">23</span><span class="op" id="7955222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955226">230</span><span class="op" id="7955229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955233">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="7955315">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955318">}</span><span class="op" id="7955319">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955323">{</span><span class="string" id="7955324">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="7955376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955380">23</span><span class="op" id="7955382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955386">230</span><span class="op" id="7955389">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955393">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="7955439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955442">}</span><span class="op" id="7955443">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955447">{</span><span class="string" id="7955448">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="7955469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955473">4</span><span class="op" id="7955474">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955478">400</span><span class="op" id="7955481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955485">&#34;A\nB\nC&#34;</span><span class="op" id="7955494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955497">}</span><span class="op" id="7955498">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955502">{</span><span class="string" id="7955503">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="7955532">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955536">4</span><span class="op" id="7955537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7955541">400</span><span class="op" id="7955544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955548">&#34;A\nB\nC&#34;</span><span class="op" id="7955557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955560">}</span><span class="op" id="7955561">,</span><br>
<span class="lineno"></span><span class="op" id="7955563">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="7955566">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="7955617">func</span>&nbsp;<span class="ident" id="7955622">TestRFC959Lines</span><span class="op" id="7955637">(</span><span class="ident" id="7955638">t</span>&nbsp;<span class="op" id="7955640">*</span><span class="ident" id="7955641">testing</span><span class="op" id="7955648">.</span><span class="ident" id="7955649">T</span><span class="op" id="7955650">)</span>&nbsp;<span class="op" id="7955652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955655">for</span>&nbsp;<span class="ident" id="7955659">i</span><span class="op" id="7955660">,</span>&nbsp;<span class="ident" id="7955662">tt</span>&nbsp;<span class="op" id="7955665">:=</span>&nbsp;<span class="keyword" id="7955668">range</span>&nbsp;<span class="ident" id="7955674">readResponseTests</span>&nbsp;<span class="op" id="7955692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955696">r</span>&nbsp;<span class="op" id="7955698">:=</span>&nbsp;<span class="ident" id="7955701">reader</span><span class="op" id="7955707">(</span><span class="ident" id="7955708">tt</span><span class="op" id="7955710">.</span><span class="ident" id="7955711">in</span>&nbsp;<span class="op" id="7955714">+</span>&nbsp;<span class="string" id="7955716">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="7955734">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955738">code</span><span class="op" id="7955742">,</span>&nbsp;<span class="ident" id="7955744">msg</span><span class="op" id="7955747">,</span>&nbsp;<span class="ident" id="7955749">err</span>&nbsp;<span class="op" id="7955753">:=</span>&nbsp;<span class="ident" id="7955756">r</span><span class="op" id="7955757">.</span><span class="ident" id="7955758">ReadResponse</span><span class="op" id="7955770">(</span><span class="ident" id="7955771">tt</span><span class="op" id="7955773">.</span><span class="ident" id="7955774">inCode</span><span class="op" id="7955780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955784">if</span>&nbsp;<span class="ident" id="7955787">err</span>&nbsp;<span class="op" id="7955791">!=</span>&nbsp;<span class="ident" id="7955794">nil</span>&nbsp;<span class="op" id="7955798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955803">t</span><span class="op" id="7955804">.</span><span class="ident" id="7955805">Errorf</span><span class="op" id="7955811">(</span><span class="string" id="7955812">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="7955835">,</span>&nbsp;<span class="ident" id="7955837">i</span><span class="op" id="7955838">,</span>&nbsp;<span class="ident" id="7955840">err</span><span class="op" id="7955843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955848">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955859">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955863">if</span>&nbsp;<span class="ident" id="7955866">code</span>&nbsp;<span class="op" id="7955871">!=</span>&nbsp;<span class="ident" id="7955874">tt</span><span class="op" id="7955876">.</span><span class="ident" id="7955877">wantCode</span>&nbsp;<span class="op" id="7955886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955891">t</span><span class="op" id="7955892">.</span><span class="ident" id="7955893">Errorf</span><span class="op" id="7955899">(</span><span class="string" id="7955900">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7955923">,</span>&nbsp;<span class="ident" id="7955925">i</span><span class="op" id="7955926">,</span>&nbsp;<span class="ident" id="7955928">code</span><span class="op" id="7955932">,</span>&nbsp;<span class="ident" id="7955934">tt</span><span class="op" id="7955936">.</span><span class="ident" id="7955937">wantCode</span><span class="op" id="7955945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955953">if</span>&nbsp;<span class="ident" id="7955956">msg</span>&nbsp;<span class="op" id="7955960">!=</span>&nbsp;<span class="ident" id="7955963">tt</span><span class="op" id="7955965">.</span><span class="ident" id="7955966">wantMsg</span>&nbsp;<span class="op" id="7955974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955979">t</span><span class="op" id="7955980">.</span><span class="ident" id="7955981">Errorf</span><span class="op" id="7955987">(</span><span class="string" id="7955988">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7956010">,</span>&nbsp;<span class="ident" id="7956012">i</span><span class="op" id="7956013">,</span>&nbsp;<span class="ident" id="7956015">msg</span><span class="op" id="7956018">,</span>&nbsp;<span class="ident" id="7956020">tt</span><span class="op" id="7956022">.</span><span class="ident" id="7956023">wantMsg</span><span class="op" id="7956030">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956037">}</span><br>
<span class="lineno"></span><span class="op" id="7956039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956042">func</span>&nbsp;<span class="ident" id="7956047">TestCommonHeaders</span><span class="op" id="7956064">(</span><span class="ident" id="7956065">t</span>&nbsp;<span class="op" id="7956067">*</span><span class="ident" id="7956068">testing</span><span class="op" id="7956075">.</span><span class="ident" id="7956076">T</span><span class="op" id="7956077">)</span>&nbsp;<span class="op" id="7956079">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956082">for</span>&nbsp;<span class="ident" id="7956086">h</span>&nbsp;<span class="op" id="7956088">:=</span>&nbsp;<span class="keyword" id="7956091">range</span>&nbsp;<span class="ident" id="7956097">commonHeader</span>&nbsp;<span class="op" id="7956110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956114">if</span>&nbsp;<span class="ident" id="7956117">h</span>&nbsp;<span class="op" id="7956119">!=</span>&nbsp;<span class="ident" id="7956122">CanonicalMIMEHeaderKey</span><span class="op" id="7956144">(</span><span class="ident" id="7956145">h</span><span class="op" id="7956146">)</span>&nbsp;<span class="op" id="7956148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956153">t</span><span class="op" id="7956154">.</span><span class="ident" id="7956155">Errorf</span><span class="op" id="7956161">(</span><span class="string" id="7956162">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="7956203">,</span>&nbsp;<span class="ident" id="7956205">h</span><span class="op" id="7956206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956213">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956216">b</span>&nbsp;<span class="op" id="7956218">:=</span>&nbsp;<span class="op" id="7956221">[</span><span class="op" id="7956222">]</span><span class="builtintype" id="7956223">byte</span><span class="op" id="7956227">(</span><span class="string" id="7956228">&#34;content-Length&#34;</span><span class="op" id="7956244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956247">want</span>&nbsp;<span class="op" id="7956252">:=</span>&nbsp;<span class="string" id="7956255">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956273">n</span>&nbsp;<span class="op" id="7956275">:=</span>&nbsp;<span class="ident" id="7956278">testing</span><span class="op" id="7956285">.</span><span class="ident" id="7956286">AllocsPerRun</span><span class="op" id="7956298">(</span><span class="num" id="7956299">200</span><span class="op" id="7956302">,</span>&nbsp;<span class="keyword" id="7956304">func</span><span class="op" id="7956308">(</span><span class="op" id="7956309">)</span>&nbsp;<span class="op" id="7956311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956315">if</span>&nbsp;<span class="ident" id="7956318">x</span>&nbsp;<span class="op" id="7956320">:=</span>&nbsp;<span class="ident" id="7956323">canonicalMIMEHeaderKey</span><span class="op" id="7956345">(</span><span class="ident" id="7956346">b</span><span class="op" id="7956347">)</span><span class="op" id="7956348">;</span>&nbsp;<span class="ident" id="7956350">x</span>&nbsp;<span class="op" id="7956352">!=</span>&nbsp;<span class="ident" id="7956355">want</span>&nbsp;<span class="op" id="7956360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956365">t</span><span class="op" id="7956366">.</span><span class="ident" id="7956367">Fatalf</span><span class="op" id="7956373">(</span><span class="string" id="7956374">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7956416">,</span>&nbsp;<span class="ident" id="7956418">b</span><span class="op" id="7956419">,</span>&nbsp;<span class="ident" id="7956421">x</span><span class="op" id="7956422">,</span>&nbsp;<span class="ident" id="7956424">want</span><span class="op" id="7956428">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956435">}</span><span class="op" id="7956436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956439">if</span>&nbsp;<span class="ident" id="7956442">n</span>&nbsp;<span class="op" id="7956444">&gt;</span>&nbsp;<span class="num" id="7956446">0</span>&nbsp;<span class="op" id="7956448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956452">t</span><span class="op" id="7956453">.</span><span class="ident" id="7956454">Errorf</span><span class="op" id="7956460">(</span><span class="string" id="7956461">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7956505">,</span>&nbsp;<span class="ident" id="7956507">n</span><span class="op" id="7956508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956511">}</span><br>
<span class="lineno">265</span><span class="op" id="7956513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956516">var</span>&nbsp;<span class="ident" id="7956520">clientHeaders</span>&nbsp;<span class="op" id="7956534">=</span>&nbsp;<span class="ident" id="7956536">strings</span><span class="op" id="7956543">.</span><span class="ident" id="7956544">Replace</span><span class="op" id="7956551">(</span><span class="string" id="7956552">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="7957229">,</span>&nbsp;<span class="string" id="7957231">&#34;\n&#34;</span><span class="op" id="7957235">,</span>&nbsp;<span class="string" id="7957237">&#34;\r\n&#34;</span><span class="op" id="7957243">,</span>&nbsp;<span class="op" id="7957245">-</span><span class="num" id="7957246">1</span><span class="op" id="7957247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7957250">var</span>&nbsp;<span class="ident" id="7957254">serverHeaders</span>&nbsp;<span class="op" id="7957268">=</span>&nbsp;<span class="ident" id="7957270">strings</span><span class="op" id="7957277">.</span><span class="ident" id="7957278">Replace</span><span class="op" id="7957285">(</span><span class="string" id="7957286">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="7957538">,</span>&nbsp;<span class="string" id="7957540">&#34;\n&#34;</span><span class="op" id="7957544">,</span>&nbsp;<span class="string" id="7957546">&#34;\r\n&#34;</span><span class="op" id="7957552">,</span>&nbsp;<span class="op" id="7957554">-</span><span class="num" id="7957555">1</span><span class="op" id="7957556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7957559">func</span>&nbsp;<span class="ident" id="7957564">BenchmarkReadMIMEHeader</span><span class="op" id="7957587">(</span><span class="ident" id="7957588">b</span>&nbsp;<span class="op" id="7957590">*</span><span class="ident" id="7957591">testing</span><span class="op" id="7957598">.</span><span class="ident" id="7957599">B</span><span class="op" id="7957600">)</span>&nbsp;<span class="op" id="7957602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957605">b</span><span class="op" id="7957606">.</span><span class="ident" id="7957607">ReportAllocs</span><span class="op" id="7957619">(</span><span class="op" id="7957620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957623">var</span>&nbsp;<span class="ident" id="7957627">buf</span>&nbsp;<span class="ident" id="7957631">bytes</span><span class="op" id="7957636">.</span><span class="ident" id="7957637">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957645">br</span>&nbsp;<span class="op" id="7957648">:=</span>&nbsp;<span class="ident" id="7957651">bufio</span><span class="op" id="7957656">.</span><span class="ident" id="7957657">NewReader</span><span class="op" id="7957666">(</span><span class="op" id="7957667">&amp;</span><span class="ident" id="7957668">buf</span><span class="op" id="7957671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957674">r</span>&nbsp;<span class="op" id="7957676">:=</span>&nbsp;<span class="ident" id="7957679">NewReader</span><span class="op" id="7957688">(</span><span class="ident" id="7957689">br</span><span class="op" id="7957691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957694">for</span>&nbsp;<span class="ident" id="7957698">i</span>&nbsp;<span class="op" id="7957700">:=</span>&nbsp;<span class="num" id="7957703">0</span><span class="op" id="7957704">;</span>&nbsp;<span class="ident" id="7957706">i</span>&nbsp;<span class="op" id="7957708">&lt;</span>&nbsp;<span class="ident" id="7957710">b</span><span class="op" id="7957711">.</span><span class="ident" id="7957712">N</span><span class="op" id="7957713">;</span>&nbsp;<span class="ident" id="7957715">i</span><span class="op" id="7957716">++</span>&nbsp;<span class="op" id="7957719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957723">var</span>&nbsp;<span class="ident" id="7957727">want</span>&nbsp;<span class="builtintype" id="7957732">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957738">var</span>&nbsp;<span class="ident" id="7957742">find</span>&nbsp;<span class="builtintype" id="7957747">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957756">if</span>&nbsp;<span class="op" id="7957759">(</span><span class="ident" id="7957760">i</span>&nbsp;<span class="op" id="7957762">&amp;</span>&nbsp;<span class="num" id="7957764">1</span><span class="op" id="7957765">)</span>&nbsp;<span class="op" id="7957767">==</span>&nbsp;<span class="num" id="7957770">1</span>&nbsp;<span class="op" id="7957772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957777">buf</span><span class="op" id="7957780">.</span><span class="ident" id="7957781">WriteString</span><span class="op" id="7957792">(</span><span class="ident" id="7957793">clientHeaders</span><span class="op" id="7957806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957811">want</span>&nbsp;<span class="op" id="7957816">=</span>&nbsp;<span class="num" id="7957818">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957824">find</span>&nbsp;<span class="op" id="7957829">=</span>&nbsp;<span class="string" id="7957831">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957842">}</span>&nbsp;<span class="keyword" id="7957844">else</span>&nbsp;<span class="op" id="7957849">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957854">buf</span><span class="op" id="7957857">.</span><span class="ident" id="7957858">WriteString</span><span class="op" id="7957869">(</span><span class="ident" id="7957870">serverHeaders</span><span class="op" id="7957883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957888">want</span>&nbsp;<span class="op" id="7957893">=</span>&nbsp;<span class="num" id="7957895">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957900">find</span>&nbsp;<span class="op" id="7957905">=</span>&nbsp;<span class="string" id="7957907">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957919">h</span><span class="op" id="7957920">,</span>&nbsp;<span class="ident" id="7957922">err</span>&nbsp;<span class="op" id="7957926">:=</span>&nbsp;<span class="ident" id="7957929">r</span><span class="op" id="7957930">.</span><span class="ident" id="7957931">ReadMIMEHeader</span><span class="op" id="7957945">(</span><span class="op" id="7957946">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957950">if</span>&nbsp;<span class="ident" id="7957953">err</span>&nbsp;<span class="op" id="7957957">!=</span>&nbsp;<span class="ident" id="7957960">nil</span>&nbsp;<span class="op" id="7957964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957969">b</span><span class="op" id="7957970">.</span><span class="ident" id="7957971">Fatal</span><span class="op" id="7957976">(</span><span class="ident" id="7957977">err</span><span class="op" id="7957980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957988">if</span>&nbsp;<span class="builtinfunc" id="7957991">len</span><span class="op" id="7957994">(</span><span class="ident" id="7957995">h</span><span class="op" id="7957996">)</span>&nbsp;<span class="op" id="7957998">!=</span>&nbsp;<span class="ident" id="7958001">want</span>&nbsp;<span class="op" id="7958006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958011">b</span><span class="op" id="7958012">.</span><span class="ident" id="7958013">Fatalf</span><span class="op" id="7958019">(</span><span class="string" id="7958020">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7958062">,</span>&nbsp;<span class="builtinfunc" id="7958064">len</span><span class="op" id="7958067">(</span><span class="ident" id="7958068">h</span><span class="op" id="7958069">)</span><span class="op" id="7958070">,</span>&nbsp;<span class="ident" id="7958072">want</span><span class="op" id="7958076">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958084">if</span>&nbsp;<span class="ident" id="7958087">_</span><span class="op" id="7958088">,</span>&nbsp;<span class="ident" id="7958090">ok</span>&nbsp;<span class="op" id="7958093">:=</span>&nbsp;<span class="ident" id="7958096">h</span><span class="op" id="7958097">[</span><span class="ident" id="7958098">find</span><span class="op" id="7958102">]</span><span class="op" id="7958103">;</span>&nbsp;<span class="op" id="7958105">!</span><span class="ident" id="7958106">ok</span>&nbsp;<span class="op" id="7958109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958114">b</span><span class="op" id="7958115">.</span><span class="ident" id="7958116">Fatalf</span><span class="op" id="7958122">(</span><span class="string" id="7958123">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="7958144">,</span>&nbsp;<span class="ident" id="7958146">find</span><span class="op" id="7958150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958157">}</span><br>
<span class="lineno">320</span><span class="op" id="7958159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7958162">func</span>&nbsp;<span class="ident" id="7958167">BenchmarkUncommon</span><span class="op" id="7958184">(</span><span class="ident" id="7958185">b</span>&nbsp;<span class="op" id="7958187">*</span><span class="ident" id="7958188">testing</span><span class="op" id="7958195">.</span><span class="ident" id="7958196">B</span><span class="op" id="7958197">)</span>&nbsp;<span class="op" id="7958199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958202">b</span><span class="op" id="7958203">.</span><span class="ident" id="7958204">ReportAllocs</span><span class="op" id="7958216">(</span><span class="op" id="7958217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958220">var</span>&nbsp;<span class="ident" id="7958224">buf</span>&nbsp;<span class="ident" id="7958228">bytes</span><span class="op" id="7958233">.</span><span class="ident" id="7958234">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958242">br</span>&nbsp;<span class="op" id="7958245">:=</span>&nbsp;<span class="ident" id="7958248">bufio</span><span class="op" id="7958253">.</span><span class="ident" id="7958254">NewReader</span><span class="op" id="7958263">(</span><span class="op" id="7958264">&amp;</span><span class="ident" id="7958265">buf</span><span class="op" id="7958268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958271">r</span>&nbsp;<span class="op" id="7958273">:=</span>&nbsp;<span class="ident" id="7958276">NewReader</span><span class="op" id="7958285">(</span><span class="ident" id="7958286">br</span><span class="op" id="7958288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958291">for</span>&nbsp;<span class="ident" id="7958295">i</span>&nbsp;<span class="op" id="7958297">:=</span>&nbsp;<span class="num" id="7958300">0</span><span class="op" id="7958301">;</span>&nbsp;<span class="ident" id="7958303">i</span>&nbsp;<span class="op" id="7958305">&lt;</span>&nbsp;<span class="ident" id="7958307">b</span><span class="op" id="7958308">.</span><span class="ident" id="7958309">N</span><span class="op" id="7958310">;</span>&nbsp;<span class="ident" id="7958312">i</span><span class="op" id="7958313">++</span>&nbsp;<span class="op" id="7958316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958320">buf</span><span class="op" id="7958323">.</span><span class="ident" id="7958324">WriteString</span><span class="op" id="7958335">(</span><span class="string" id="7958336">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="7958380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958384">h</span><span class="op" id="7958385">,</span>&nbsp;<span class="ident" id="7958387">err</span>&nbsp;<span class="op" id="7958391">:=</span>&nbsp;<span class="ident" id="7958394">r</span><span class="op" id="7958395">.</span><span class="ident" id="7958396">ReadMIMEHeader</span><span class="op" id="7958410">(</span><span class="op" id="7958411">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958415">if</span>&nbsp;<span class="ident" id="7958418">err</span>&nbsp;<span class="op" id="7958422">!=</span>&nbsp;<span class="ident" id="7958425">nil</span>&nbsp;<span class="op" id="7958429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958434">b</span><span class="op" id="7958435">.</span><span class="ident" id="7958436">Fatal</span><span class="op" id="7958441">(</span><span class="ident" id="7958442">err</span><span class="op" id="7958445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958453">if</span>&nbsp;<span class="ident" id="7958456">_</span><span class="op" id="7958457">,</span>&nbsp;<span class="ident" id="7958459">ok</span>&nbsp;<span class="op" id="7958462">:=</span>&nbsp;<span class="ident" id="7958465">h</span><span class="op" id="7958466">[</span><span class="string" id="7958467">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="7958498">]</span><span class="op" id="7958499">;</span>&nbsp;<span class="op" id="7958501">!</span><span class="ident" id="7958502">ok</span>&nbsp;<span class="op" id="7958505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958510">b</span><span class="op" id="7958511">.</span><span class="ident" id="7958512">Fatal</span><span class="op" id="7958517">(</span><span class="string" id="7958518">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="7958542">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958549">}</span><br>
<span class="lineno"></span><span class="op" id="7958551">}</span>
</div>
</body>
</html>
