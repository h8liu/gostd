<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html" class="current">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1481785">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1481841">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1481895">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1481946">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1481980">//</span><br>
<span class="lineno"></span><span class="comment" id="1481983">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1482054">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1482119">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1482160">//</span><br>
<span class="lineno"></span><span class="comment" id="1482163">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1482223">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1482288">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1482347">//</span><br>
<span class="lineno">15</span><span class="comment" id="1482350">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1482419">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1482489">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1482545">//</span><br>
<span class="lineno"></span><span class="comment" id="1482548">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1482611">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1482680">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1482718">//</span><br>
<span class="lineno"></span><span class="comment" id="1482721">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1482790">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1482854">//</span><br>
<span class="lineno"></span><span class="comment" id="1482857">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1482934">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1483007">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1483037">//</span><br>
<span class="lineno">30</span><span class="comment" id="1483040">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1483114">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1483185">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1483231">//</span><br>
<span class="lineno"></span><span class="comment" id="1483234">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1483310">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1483388">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1483455">//</span><br>
<span class="lineno"></span><span class="comment" id="1483458">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1483526">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1483600">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1483671">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1483741">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1483806">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1483872">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1483943">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1483978">//</span><br>
<span class="lineno"></span><span class="comment" id="1483981">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1484048">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1484118">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1484192">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1484250">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1484285">//</span><br>
<span class="lineno"></span><span class="comment" id="1484288">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1484352">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1484416">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1484466">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1484536">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1484606">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1484681">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1484751">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1484801">//</span><br>
<span class="lineno"></span><span class="comment" id="1484804">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1484871">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1484950">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1485018">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1485097">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1485174">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1485244">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1485321">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1485376">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1485451">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1485528">//</span><br>
<span class="lineno"></span><span class="comment" id="1485531">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1485597">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1485673">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1485741">//</span><br>
<span class="lineno"></span><span class="comment" id="1485744">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1485813">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1485887">package</span>&nbsp;<span class="ident" id="1485895">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1485904">import</span>&nbsp;<span class="string" id="1485911">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1485921">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1485943">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1485956">func</span>&nbsp;<span class="ident" id="1485961">cgocall</span><span class="op" id="1485968">(</span><span class="ident" id="1485969">fn</span><span class="op" id="1485971">,</span>&nbsp;<span class="ident" id="1485973">arg</span>&nbsp;<span class="ident" id="1485977"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1485983">.</span><span class="ident" id="1485984">Pointer</span><span class="op" id="1485991">)</span>&nbsp;<span class="op" id="1485993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485996"><a href="/gostd/runtime/cgocall.go.html#1486040">cgocall_errno</a></span><span class="op" id="1486009">(</span><span class="ident" id="1486010"><a href="/gostd/runtime/cgocall.go.html#1485969">fn</a></span><span class="op" id="1486012">,</span>&nbsp;<span class="ident" id="1486014"><a href="/gostd/runtime/cgocall.go.html#1485973">arg</a></span><span class="op" id="1486017">)</span><br>
<span class="lineno"></span><span class="op" id="1486019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1486022">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1486035">func</span>&nbsp;<span class="ident" id="1486040">cgocall_errno</span><span class="op" id="1486053">(</span><span class="ident" id="1486054">fn</span><span class="op" id="1486056">,</span>&nbsp;<span class="ident" id="1486058">arg</span>&nbsp;<span class="ident" id="1486062"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1486068">.</span><span class="ident" id="1486069">Pointer</span><span class="op" id="1486076">)</span>&nbsp;<span class="builtintype" id="1486078">int32</span>&nbsp;<span class="op" id="1486084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486087">if</span>&nbsp;<span class="op" id="1486090">!</span><span class="ident" id="1486091"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791365">iscgo</a></span>&nbsp;<span class="op" id="1486097">&amp;&amp;</span>&nbsp;<span class="ident" id="1486100"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="1486105">!=</span>&nbsp;<span class="string" id="1486108">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1486118">&amp;&amp;</span>&nbsp;<span class="ident" id="1486121"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="1486126">!=</span>&nbsp;<span class="string" id="1486129">&#34;windows&#34;</span>&nbsp;<span class="op" id="1486139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486143"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1486150">(</span><span class="string" id="1486151">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1486172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486175">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486179">if</span>&nbsp;<span class="ident" id="1486182"><a href="/gostd/runtime/cgocall.go.html#1486054">fn</a></span>&nbsp;<span class="op" id="1486185">==</span>&nbsp;<span class="builtintype" id="1486188">nil</span>&nbsp;<span class="op" id="1486192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486196"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1486203">(</span><span class="string" id="1486204">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1486217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486224">if</span>&nbsp;<span class="ident" id="1486227"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1486239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486243"><a href="/gostd/runtime/race0.go.html#1677864">racereleasemerge</a></span><span class="op" id="1486259">(</span><span class="ident" id="1486260"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1486266">.</span><span class="ident" id="1486267">Pointer</span><span class="op" id="1486274">(</span><span class="op" id="1486275">&amp;</span><span class="ident" id="1486276"><a href="/gostd/runtime/cgocall.go.html#1490462">racecgosync</a></span><span class="op" id="1486287">)</span><span class="op" id="1486288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1486295">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486379">if</span>&nbsp;<span class="ident" id="1486382"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791292">needextram</a></span>&nbsp;<span class="op" id="1486393">==</span>&nbsp;<span class="num" id="1486396">1</span>&nbsp;<span class="op" id="1486398">&amp;&amp;</span>&nbsp;<span class="ident" id="1486401"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1486404">(</span><span class="op" id="1486405">&amp;</span><span class="ident" id="1486406"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791292">needextram</a></span><span class="op" id="1486416">,</span>&nbsp;<span class="num" id="1486418">1</span><span class="op" id="1486419">,</span>&nbsp;<span class="num" id="1486421">0</span><span class="op" id="1486422">)</span>&nbsp;<span class="op" id="1486424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486428"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1486431">(</span><span class="ident" id="1486432"><a href="/gostd/runtime/stubs.go.html#1742814">newextram</a></span><span class="op" id="1486441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1486448">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486581"><a href="/gostd/runtime/stubs.go.html#1742831">lockOSThread</a></span><span class="op" id="1486593">(</span><span class="op" id="1486594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486597">mp</span>&nbsp;<span class="op" id="1486600">:=</span>&nbsp;<span class="ident" id="1486603"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1486607">(</span><span class="op" id="1486608">)</span><span class="op" id="1486609">.</span><span class="ident" id="1486610"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486613"><a href="/gostd/runtime/cgocall.go.html#1486597">mp</a></span><span class="op" id="1486615">.</span><span class="ident" id="1486616"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788127">ncgocall</a></span><span class="op" id="1486624">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486628"><a href="/gostd/runtime/cgocall.go.html#1486597">mp</a></span><span class="op" id="1486630">.</span><span class="ident" id="1486631"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788144">ncgo</a></span><span class="op" id="1486635">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486639">defer</span>&nbsp;<span class="ident" id="1486645"><a href="/gostd/runtime/cgocall.go.html#1487118">endcgo</a></span><span class="op" id="1486651">(</span><span class="ident" id="1486652"><a href="/gostd/runtime/cgocall.go.html#1486597">mp</a></span><span class="op" id="1486654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1486658">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487016"><a href="/gostd/runtime/stubs.go.html#1743419">entersyscall</a></span><span class="op" id="1487028">(</span><span class="op" id="1487029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487032">errno</span>&nbsp;<span class="op" id="1487038">:=</span>&nbsp;<span class="ident" id="1487041"><a href="/gostd/runtime/stubs.go.html#1746574">asmcgocall_errno</a></span><span class="op" id="1487057">(</span><span class="ident" id="1487058"><a href="/gostd/runtime/cgocall.go.html#1486054">fn</a></span><span class="op" id="1487060">,</span>&nbsp;<span class="ident" id="1487062"><a href="/gostd/runtime/cgocall.go.html#1486058">arg</a></span><span class="op" id="1487065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487068"><a href="/gostd/runtime/stubs.go.html#1743515">exitsyscall</a></span><span class="op" id="1487079">(</span><span class="op" id="1487080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1487084">return</span>&nbsp;<span class="ident" id="1487091"><a href="/gostd/runtime/cgocall.go.html#1487032">errno</a></span><br>
<span class="lineno">135</span><span class="op" id="1487097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1487100">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1487113">func</span>&nbsp;<span class="ident" id="1487118">endcgo</span><span class="op" id="1487124">(</span><span class="ident" id="1487125">mp</span>&nbsp;<span class="op" id="1487128">*</span><span class="ident" id="1487129"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787810">m</a></span><span class="op" id="1487130">)</span>&nbsp;<span class="op" id="1487132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487135"><a href="/gostd/runtime/cgocall.go.html#1487125">mp</a></span><span class="op" id="1487137">.</span><span class="ident" id="1487138"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788144">ncgo</a></span><span class="op" id="1487142">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1487146">if</span>&nbsp;<span class="ident" id="1487149"><a href="/gostd/runtime/cgocall.go.html#1487125">mp</a></span><span class="op" id="1487151">.</span><span class="ident" id="1487152"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788144">ncgo</a></span>&nbsp;<span class="op" id="1487157">==</span>&nbsp;<span class="num" id="1487160">0</span>&nbsp;<span class="op" id="1487162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1487166">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1487222">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1487278">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487327"><a href="/gostd/runtime/cgocall.go.html#1487125">mp</a></span><span class="op" id="1487329">.</span><span class="ident" id="1487330"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788156">cgomal</a></span>&nbsp;<span class="op" id="1487337">=</span>&nbsp;<span class="builtintype" id="1487339">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1487344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1487348">if</span>&nbsp;<span class="ident" id="1487351"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1487363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487367"><a href="/gostd/runtime/race0.go.html#1677480">raceacquire</a></span><span class="op" id="1487378">(</span><span class="ident" id="1487379"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1487385">.</span><span class="ident" id="1487386">Pointer</span><span class="op" id="1487393">(</span><span class="op" id="1487394">&amp;</span><span class="ident" id="1487395"><a href="/gostd/runtime/cgocall.go.html#1490462">racecgosync</a></span><span class="op" id="1487406">)</span><span class="op" id="1487407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1487410">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487414"><a href="/gostd/runtime/stubs.go.html#1742851">unlockOSThread</a></span><span class="op" id="1487428">(</span><span class="op" id="1487429">)</span>&nbsp;<span class="comment" id="1487431">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1487449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1487452">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1487487">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1487542">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1487614">var</span>&nbsp;<span class="ident" id="1487618">cgoMalloc</span><span class="op" id="1487627">,</span>&nbsp;<span class="ident" id="1487629">cgoFree</span>&nbsp;<span class="ident" id="1487637"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1487643">.</span><span class="ident" id="1487644">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1487653">func</span>&nbsp;<span class="ident" id="1487658">cmalloc</span><span class="op" id="1487665">(</span><span class="ident" id="1487666">n</span>&nbsp;<span class="builtintype" id="1487668">uintptr</span><span class="op" id="1487675">)</span>&nbsp;<span class="ident" id="1487677"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1487683">.</span><span class="ident" id="1487684">Pointer</span>&nbsp;<span class="op" id="1487692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1487695">var</span>&nbsp;<span class="ident" id="1487699">args</span>&nbsp;<span class="keyword" id="1487704">struct</span>&nbsp;<span class="op" id="1487711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487715">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1487719">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487728">ret</span>&nbsp;<span class="ident" id="1487732"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1487738">.</span><span class="ident" id="1487739">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1487748">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487751"><a href="/gostd/runtime/cgocall.go.html#1487699">args</a></span><span class="op" id="1487755">.</span><span class="ident" id="1487756"><a href="/gostd/runtime/cgocall.go.html#1487715">n</a></span>&nbsp;<span class="op" id="1487758">=</span>&nbsp;<span class="builtintype" id="1487760">uint64</span><span class="op" id="1487766">(</span><span class="ident" id="1487767"><a href="/gostd/runtime/cgocall.go.html#1487666">n</a></span><span class="op" id="1487768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487771"><a href="/gostd/runtime/cgocall.go.html#1485961">cgocall</a></span><span class="op" id="1487778">(</span><span class="ident" id="1487779"><a href="/gostd/runtime/cgocall.go.html#1487618">cgoMalloc</a></span><span class="op" id="1487788">,</span>&nbsp;<span class="ident" id="1487790"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1487796">.</span><span class="ident" id="1487797">Pointer</span><span class="op" id="1487804">(</span><span class="op" id="1487805">&amp;</span><span class="ident" id="1487806"><a href="/gostd/runtime/cgocall.go.html#1487699">args</a></span><span class="op" id="1487810">)</span><span class="op" id="1487811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1487814">if</span>&nbsp;<span class="ident" id="1487817"><a href="/gostd/runtime/cgocall.go.html#1487699">args</a></span><span class="op" id="1487821">.</span><span class="ident" id="1487822"><a href="/gostd/runtime/cgocall.go.html#1487728">ret</a></span>&nbsp;<span class="op" id="1487826">==</span>&nbsp;<span class="builtintype" id="1487829">nil</span>&nbsp;<span class="op" id="1487833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487837"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1487844">(</span><span class="string" id="1487845">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1487862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1487865">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1487868">return</span>&nbsp;<span class="ident" id="1487875"><a href="/gostd/runtime/cgocall.go.html#1487699">args</a></span><span class="op" id="1487879">.</span><span class="ident" id="1487880"><a href="/gostd/runtime/cgocall.go.html#1487728">ret</a></span><br>
<span class="lineno"></span><span class="op" id="1487884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1487887">func</span>&nbsp;<span class="ident" id="1487892">cfree</span><span class="op" id="1487897">(</span><span class="ident" id="1487898">p</span>&nbsp;<span class="ident" id="1487900"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1487906">.</span><span class="ident" id="1487907">Pointer</span><span class="op" id="1487914">)</span>&nbsp;<span class="op" id="1487916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1487919"><a href="/gostd/runtime/cgocall.go.html#1485961">cgocall</a></span><span class="op" id="1487926">(</span><span class="ident" id="1487927"><a href="/gostd/runtime/cgocall.go.html#1487629">cgoFree</a></span><span class="op" id="1487934">,</span>&nbsp;<span class="ident" id="1487936"><a href="/gostd/runtime/cgocall.go.html#1487898">p</a></span><span class="op" id="1487937">)</span><br>
<span class="lineno">175</span><span class="op" id="1487939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1487942">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1487969">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1487982">func</span>&nbsp;<span class="ident" id="1487987">cgocallbackg</span><span class="op" id="1487999">(</span><span class="op" id="1488000">)</span>&nbsp;<span class="op" id="1488002">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488005">gp</span>&nbsp;<span class="op" id="1488008">:=</span>&nbsp;<span class="ident" id="1488011"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1488015">(</span><span class="op" id="1488016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1488019">if</span>&nbsp;<span class="ident" id="1488022"><a href="/gostd/runtime/cgocall.go.html#1488005">gp</a></span>&nbsp;<span class="op" id="1488025">!=</span>&nbsp;<span class="ident" id="1488028"><a href="/gostd/runtime/cgocall.go.html#1488005">gp</a></span><span class="op" id="1488030">.</span><span class="ident" id="1488031"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1488032">.</span><span class="ident" id="1488033"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1488038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1488042">println</span><span class="op" id="1488049">(</span><span class="string" id="1488050">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1488081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488085"><a href="/gostd/runtime/stubs.go.html#1743896">exit</a></span><span class="op" id="1488089">(</span><span class="num" id="1488090">2</span><span class="op" id="1488091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1488094">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488098">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488169">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488241">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488312">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488367">savedsp</span>&nbsp;<span class="op" id="1488375">:=</span>&nbsp;<span class="ident" id="1488378"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1488384">.</span><span class="ident" id="1488385">Pointer</span><span class="op" id="1488392">(</span><span class="ident" id="1488393"><a href="/gostd/runtime/cgocall.go.html#1488005">gp</a></span><span class="op" id="1488395">.</span><span class="ident" id="1488396"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787383">syscallsp</a></span><span class="op" id="1488405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488408">savedpc</span>&nbsp;<span class="op" id="1488416">:=</span>&nbsp;<span class="ident" id="1488419"><a href="/gostd/runtime/cgocall.go.html#1488005">gp</a></span><span class="op" id="1488421">.</span><span class="ident" id="1488422"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787402">syscallpc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488433"><a href="/gostd/runtime/stubs.go.html#1743515">exitsyscall</a></span><span class="op" id="1488444">(</span><span class="op" id="1488445">)</span>&nbsp;<span class="comment" id="1488447">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488474"><a href="/gostd/runtime/cgocall.go.html#1488559">cgocallbackg1</a></span><span class="op" id="1488487">(</span><span class="op" id="1488488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488491">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488518"><a href="/gostd/runtime/stubs.go.html#1743439">reentersyscall</a></span><span class="op" id="1488532">(</span><span class="ident" id="1488533"><a href="/gostd/runtime/cgocall.go.html#1488408">savedpc</a></span><span class="op" id="1488540">,</span>&nbsp;<span class="ident" id="1488542"><a href="/gostd/runtime/cgocall.go.html#1488367">savedsp</a></span><span class="op" id="1488549">)</span><br>
<span class="lineno"></span><span class="op" id="1488551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1488554">func</span>&nbsp;<span class="ident" id="1488559">cgocallbackg1</span><span class="op" id="1488572">(</span><span class="op" id="1488573">)</span>&nbsp;<span class="op" id="1488575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488578">gp</span>&nbsp;<span class="op" id="1488581">:=</span>&nbsp;<span class="ident" id="1488584"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1488588">(</span><span class="op" id="1488589">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1488592">if</span>&nbsp;<span class="ident" id="1488595"><a href="/gostd/runtime/cgocall.go.html#1488578">gp</a></span><span class="op" id="1488597">.</span><span class="ident" id="1488598"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1488599">.</span><span class="ident" id="1488600"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788438">needextram</a></span>&nbsp;<span class="op" id="1488611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488615"><a href="/gostd/runtime/cgocall.go.html#1488578">gp</a></span><span class="op" id="1488617">.</span><span class="ident" id="1488618"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1488619">.</span><span class="ident" id="1488620"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788438">needextram</a></span>&nbsp;<span class="op" id="1488631">=</span>&nbsp;<span class="builtintype" id="1488633">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488641"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1488644">(</span><span class="ident" id="1488645"><a href="/gostd/runtime/stubs.go.html#1742814">newextram</a></span><span class="op" id="1488654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1488657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488661">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488708">restore</span>&nbsp;<span class="op" id="1488716">:=</span>&nbsp;<span class="builtintype" id="1488719">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1488725">defer</span>&nbsp;<span class="ident" id="1488731"><a href="/gostd/runtime/cgocall.go.html#1489856">unwindm</a></span><span class="op" id="1488738">(</span><span class="op" id="1488739">&amp;</span><span class="ident" id="1488740"><a href="/gostd/runtime/cgocall.go.html#1488708">restore</a></span><span class="op" id="1488747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1488751">if</span>&nbsp;<span class="ident" id="1488754"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1488766">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488770"><a href="/gostd/runtime/race0.go.html#1677480">raceacquire</a></span><span class="op" id="1488781">(</span><span class="ident" id="1488782"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1488788">.</span><span class="ident" id="1488789">Pointer</span><span class="op" id="1488796">(</span><span class="op" id="1488797">&amp;</span><span class="ident" id="1488798"><a href="/gostd/runtime/cgocall.go.html#1490462">racecgosync</a></span><span class="op" id="1488809">)</span><span class="op" id="1488810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1488813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1488817">type</span>&nbsp;<span class="ident" id="1488822">args</span>&nbsp;<span class="keyword" id="1488827">struct</span>&nbsp;<span class="op" id="1488834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488838">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1488846">*</span><span class="ident" id="1488847"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786324">funcval</a></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488857">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488865"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1488871">.</span><span class="ident" id="1488872">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1488882">argsize</span>&nbsp;<span class="builtintype" id="1488890">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1488899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1488902">var</span>&nbsp;<span class="ident" id="1488906">cb</span>&nbsp;<span class="op" id="1488909">*</span><span class="ident" id="1488910"><a href="/gostd/runtime/cgocall.go.html#1488822">args</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488917">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1488982">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489033">sp</span>&nbsp;<span class="op" id="1489036">:=</span>&nbsp;<span class="ident" id="1489039"><a href="/gostd/runtime/cgocall.go.html#1488578">gp</a></span><span class="op" id="1489041">.</span><span class="ident" id="1489042"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1489043">.</span><span class="ident" id="1489044"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787822">g0</a></span><span class="op" id="1489046">.</span><span class="ident" id="1489047"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787370">sched</a></span><span class="op" id="1489052">.</span><span class="ident" id="1489053"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786666">sp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489057">switch</span>&nbsp;<span class="ident" id="1489064"><a href="/gostd/runtime/extern.go.html#1533781">GOARCH</a></span>&nbsp;<span class="op" id="1489071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489074">default</span><span class="op" id="1489081">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489085"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1489092">(</span><span class="string" id="1489093">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1489132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489135">case</span>&nbsp;<span class="string" id="1489140">&#34;arm&#34;</span><span class="op" id="1489145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489149">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489218">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489293"><a href="/gostd/runtime/cgocall.go.html#1488906">cb</a></span>&nbsp;<span class="op" id="1489296">=</span>&nbsp;<span class="op" id="1489298">(</span><span class="op" id="1489299">*</span><span class="ident" id="1489300"><a href="/gostd/runtime/cgocall.go.html#1488822">args</a></span><span class="op" id="1489304">)</span><span class="op" id="1489305">(</span><span class="ident" id="1489306"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1489312">.</span><span class="ident" id="1489313">Pointer</span><span class="op" id="1489320">(</span><span class="ident" id="1489321"><a href="/gostd/runtime/cgocall.go.html#1489033">sp</a></span>&nbsp;<span class="op" id="1489324">+</span>&nbsp;<span class="num" id="1489326">4</span><span class="op" id="1489327">*</span><span class="ident" id="1489328"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><span class="op" id="1489335">)</span><span class="op" id="1489336">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489339">case</span>&nbsp;<span class="string" id="1489344">&#34;amd64&#34;</span><span class="op" id="1489351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489355">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489411"><a href="/gostd/runtime/cgocall.go.html#1488906">cb</a></span>&nbsp;<span class="op" id="1489414">=</span>&nbsp;<span class="op" id="1489416">(</span><span class="op" id="1489417">*</span><span class="ident" id="1489418"><a href="/gostd/runtime/cgocall.go.html#1488822">args</a></span><span class="op" id="1489422">)</span><span class="op" id="1489423">(</span><span class="ident" id="1489424"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1489430">.</span><span class="ident" id="1489431">Pointer</span><span class="op" id="1489438">(</span><span class="ident" id="1489439"><a href="/gostd/runtime/cgocall.go.html#1489033">sp</a></span>&nbsp;<span class="op" id="1489442">+</span>&nbsp;<span class="num" id="1489444">2</span><span class="op" id="1489445">*</span><span class="ident" id="1489446"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><span class="op" id="1489453">)</span><span class="op" id="1489454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489457">case</span>&nbsp;<span class="string" id="1489462">&#34;386&#34;</span><span class="op" id="1489467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489471">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489528"><a href="/gostd/runtime/cgocall.go.html#1488906">cb</a></span>&nbsp;<span class="op" id="1489531">=</span>&nbsp;<span class="op" id="1489533">(</span><span class="op" id="1489534">*</span><span class="ident" id="1489535"><a href="/gostd/runtime/cgocall.go.html#1488822">args</a></span><span class="op" id="1489539">)</span><span class="op" id="1489540">(</span><span class="ident" id="1489541"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1489547">.</span><span class="ident" id="1489548">Pointer</span><span class="op" id="1489555">(</span><span class="ident" id="1489556"><a href="/gostd/runtime/cgocall.go.html#1489033">sp</a></span>&nbsp;<span class="op" id="1489559">+</span>&nbsp;<span class="num" id="1489561">4</span><span class="op" id="1489562">*</span><span class="ident" id="1489563"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><span class="op" id="1489570">)</span><span class="op" id="1489571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1489574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489578">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489599"><a href="/gostd/runtime/stubs.go.html#1744361">reflectcall</a></span><span class="op" id="1489610">(</span><span class="ident" id="1489611"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1489617">.</span><span class="ident" id="1489618">Pointer</span><span class="op" id="1489625">(</span><span class="ident" id="1489626"><a href="/gostd/runtime/cgocall.go.html#1488906">cb</a></span><span class="op" id="1489628">.</span><span class="ident" id="1489629"><a href="/gostd/runtime/cgocall.go.html#1488838">fn</a></span><span class="op" id="1489631">)</span><span class="op" id="1489632">,</span>&nbsp;<span class="ident" id="1489634"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1489640">.</span><span class="ident" id="1489641">Pointer</span><span class="op" id="1489648">(</span><span class="ident" id="1489649"><a href="/gostd/runtime/cgocall.go.html#1488906">cb</a></span><span class="op" id="1489651">.</span><span class="ident" id="1489652"><a href="/gostd/runtime/cgocall.go.html#1488857">arg</a></span><span class="op" id="1489655">)</span><span class="op" id="1489656">,</span>&nbsp;<span class="builtintype" id="1489658">uint32</span><span class="op" id="1489664">(</span><span class="ident" id="1489665"><a href="/gostd/runtime/cgocall.go.html#1488906">cb</a></span><span class="op" id="1489667">.</span><span class="ident" id="1489668"><a href="/gostd/runtime/cgocall.go.html#1488882">argsize</a></span><span class="op" id="1489675">)</span><span class="op" id="1489676">,</span>&nbsp;<span class="num" id="1489678">0</span><span class="op" id="1489679">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489683">if</span>&nbsp;<span class="ident" id="1489686"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1489698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489702"><a href="/gostd/runtime/race0.go.html#1677864">racereleasemerge</a></span><span class="op" id="1489718">(</span><span class="ident" id="1489719"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1489725">.</span><span class="ident" id="1489726">Pointer</span><span class="op" id="1489733">(</span><span class="op" id="1489734">&amp;</span><span class="ident" id="1489735"><a href="/gostd/runtime/cgocall.go.html#1490462">racecgosync</a></span><span class="op" id="1489746">)</span><span class="op" id="1489747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1489750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489754">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489789">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1489832"><a href="/gostd/runtime/cgocall.go.html#1488708">restore</a></span>&nbsp;<span class="op" id="1489840">=</span>&nbsp;<span class="builtintype" id="1489842">false</span><br>
<span class="lineno"></span><span class="op" id="1489848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1489851">func</span>&nbsp;<span class="ident" id="1489856">unwindm</span><span class="op" id="1489863">(</span><span class="ident" id="1489864">restore</span>&nbsp;<span class="op" id="1489872">*</span><span class="builtintype" id="1489873">bool</span><span class="op" id="1489877">)</span>&nbsp;<span class="op" id="1489879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489882">if</span>&nbsp;<span class="op" id="1489885">!</span><span class="op" id="1489886">*</span><span class="ident" id="1489887"><a href="/gostd/runtime/cgocall.go.html#1489864">restore</a></span>&nbsp;<span class="op" id="1489895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1489899">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1489907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489910">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1489953">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490007">mp</span>&nbsp;<span class="op" id="1490010">:=</span>&nbsp;<span class="ident" id="1490013"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1490021">(</span><span class="op" id="1490022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490025">sched</span>&nbsp;<span class="op" id="1490031">:=</span>&nbsp;<span class="op" id="1490034">&amp;</span><span class="ident" id="1490035"><a href="/gostd/runtime/cgocall.go.html#1490007">mp</a></span><span class="op" id="1490037">.</span><span class="ident" id="1490038"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787822">g0</a></span><span class="op" id="1490040">.</span><span class="ident" id="1490041"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787370">sched</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1490048">switch</span>&nbsp;<span class="ident" id="1490055"><a href="/gostd/runtime/extern.go.html#1533781">GOARCH</a></span>&nbsp;<span class="op" id="1490062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1490065">default</span><span class="op" id="1490072">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490076"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1490083">(</span><span class="string" id="1490084">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1490109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1490112">case</span>&nbsp;<span class="string" id="1490117">&#34;386&#34;</span><span class="op" id="1490122">,</span>&nbsp;<span class="string" id="1490124">&#34;amd64&#34;</span><span class="op" id="1490131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490135"><a href="/gostd/runtime/cgocall.go.html#1490025">sched</a></span><span class="op" id="1490140">.</span><span class="ident" id="1490141"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786666">sp</a></span>&nbsp;<span class="op" id="1490144">=</span>&nbsp;<span class="op" id="1490146">*</span><span class="op" id="1490147">(</span><span class="op" id="1490148">*</span><span class="builtintype" id="1490149">uintptr</span><span class="op" id="1490156">)</span><span class="op" id="1490157">(</span><span class="ident" id="1490158"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1490164">.</span><span class="ident" id="1490165">Pointer</span><span class="op" id="1490172">(</span><span class="ident" id="1490173"><a href="/gostd/runtime/cgocall.go.html#1490025">sched</a></span><span class="op" id="1490178">.</span><span class="ident" id="1490179"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786666">sp</a></span><span class="op" id="1490181">)</span><span class="op" id="1490182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1490185">case</span>&nbsp;<span class="string" id="1490190">&#34;arm&#34;</span><span class="op" id="1490195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490199"><a href="/gostd/runtime/cgocall.go.html#1490025">sched</a></span><span class="op" id="1490204">.</span><span class="ident" id="1490205"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786666">sp</a></span>&nbsp;<span class="op" id="1490208">=</span>&nbsp;<span class="op" id="1490210">*</span><span class="op" id="1490211">(</span><span class="op" id="1490212">*</span><span class="builtintype" id="1490213">uintptr</span><span class="op" id="1490220">)</span><span class="op" id="1490221">(</span><span class="ident" id="1490222"><a href="/gostd/runtime/cgocall.go.html#1485911">unsafe</a></span><span class="op" id="1490228">.</span><span class="ident" id="1490229">Pointer</span><span class="op" id="1490236">(</span><span class="ident" id="1490237"><a href="/gostd/runtime/cgocall.go.html#1490025">sched</a></span><span class="op" id="1490242">.</span><span class="ident" id="1490243"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786666">sp</a></span>&nbsp;<span class="op" id="1490246">+</span>&nbsp;<span class="num" id="1490248">4</span><span class="op" id="1490249">)</span><span class="op" id="1490250">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1490253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490256"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1490264">(</span><span class="ident" id="1490265"><a href="/gostd/runtime/cgocall.go.html#1490007">mp</a></span><span class="op" id="1490267">)</span><br>
<span class="lineno"></span><span class="op" id="1490269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1490272">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1490296">func</span>&nbsp;<span class="ident" id="1490301">badcgocallback</span><span class="op" id="1490315">(</span><span class="op" id="1490316">)</span>&nbsp;<span class="op" id="1490318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490321"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1490328">(</span><span class="string" id="1490329">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1490362">)</span><br>
<span class="lineno"></span><span class="op" id="1490364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1490367">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1490404">func</span>&nbsp;<span class="ident" id="1490409">cgounimpl</span><span class="op" id="1490418">(</span><span class="op" id="1490419">)</span>&nbsp;<span class="op" id="1490421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1490424"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1490431">(</span><span class="string" id="1490432">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1490453">)</span><br>
<span class="lineno"></span><span class="op" id="1490455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1490458">var</span>&nbsp;<span class="ident" id="1490462">racecgosync</span>&nbsp;<span class="builtintype" id="1490474">uint64</span>&nbsp;<span class="comment" id="1490481">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
