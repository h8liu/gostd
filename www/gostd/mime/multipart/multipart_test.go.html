<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html" class="current">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8486021">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8486076">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8486130">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8486181">package</span>&nbsp;<span class="ident" id="8486189">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8486200">import</span>&nbsp;<span class="op" id="8486207">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486210">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486219">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486236">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486243">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486249">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486262">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486279">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486285">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486296">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8486307">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8486317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8486320">func</span>&nbsp;<span class="ident" id="8486325">TestBoundaryLine</span><span class="op" id="8486341">(</span><span class="ident" id="8486342">t</span>&nbsp;<span class="op" id="8486344">*</span><span class="ident" id="8486345">testing</span><span class="op" id="8486352">.</span><span class="ident" id="8486353">T</span><span class="op" id="8486354">)</span>&nbsp;<span class="op" id="8486356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486359">mr</span>&nbsp;<span class="op" id="8486362">:=</span>&nbsp;<span class="ident" id="8486365">NewReader</span><span class="op" id="8486374">(</span><span class="ident" id="8486375">strings</span><span class="op" id="8486382">.</span><span class="ident" id="8486383">NewReader</span><span class="op" id="8486392">(</span><span class="string" id="8486393">&#34;&#34;</span><span class="op" id="8486395">)</span><span class="op" id="8486396">,</span>&nbsp;<span class="string" id="8486398">&#34;myBoundary&#34;</span><span class="op" id="8486410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486413">if</span>&nbsp;<span class="op" id="8486416">!</span><span class="ident" id="8486417">mr</span><span class="op" id="8486419">.</span><span class="ident" id="8486420">isBoundaryDelimiterLine</span><span class="op" id="8486443">(</span><span class="op" id="8486444">[</span><span class="op" id="8486445">]</span><span class="builtintype" id="8486446">byte</span><span class="op" id="8486450">(</span><span class="string" id="8486451">&#34;--myBoundary\r\n&#34;</span><span class="op" id="8486469">)</span><span class="op" id="8486470">)</span>&nbsp;<span class="op" id="8486472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486476">t</span><span class="op" id="8486477">.</span><span class="ident" id="8486478">Error</span><span class="op" id="8486483">(</span><span class="string" id="8486484">&#34;expected&#34;</span><span class="op" id="8486494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486497">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486500">if</span>&nbsp;<span class="op" id="8486503">!</span><span class="ident" id="8486504">mr</span><span class="op" id="8486506">.</span><span class="ident" id="8486507">isBoundaryDelimiterLine</span><span class="op" id="8486530">(</span><span class="op" id="8486531">[</span><span class="op" id="8486532">]</span><span class="builtintype" id="8486533">byte</span><span class="op" id="8486537">(</span><span class="string" id="8486538">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="8486557">)</span><span class="op" id="8486558">)</span>&nbsp;<span class="op" id="8486560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486564">t</span><span class="op" id="8486565">.</span><span class="ident" id="8486566">Error</span><span class="op" id="8486571">(</span><span class="string" id="8486572">&#34;expected&#34;</span><span class="op" id="8486582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486588">if</span>&nbsp;<span class="op" id="8486591">!</span><span class="ident" id="8486592">mr</span><span class="op" id="8486594">.</span><span class="ident" id="8486595">isBoundaryDelimiterLine</span><span class="op" id="8486618">(</span><span class="op" id="8486619">[</span><span class="op" id="8486620">]</span><span class="builtintype" id="8486621">byte</span><span class="op" id="8486625">(</span><span class="string" id="8486626">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="8486643">)</span><span class="op" id="8486644">)</span>&nbsp;<span class="op" id="8486646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486650">t</span><span class="op" id="8486651">.</span><span class="ident" id="8486652">Error</span><span class="op" id="8486657">(</span><span class="string" id="8486658">&#34;expected&#34;</span><span class="op" id="8486668">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486674">if</span>&nbsp;<span class="ident" id="8486677">mr</span><span class="op" id="8486679">.</span><span class="ident" id="8486680">isBoundaryDelimiterLine</span><span class="op" id="8486703">(</span><span class="op" id="8486704">[</span><span class="op" id="8486705">]</span><span class="builtintype" id="8486706">byte</span><span class="op" id="8486710">(</span><span class="string" id="8486711">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="8486734">)</span><span class="op" id="8486735">)</span>&nbsp;<span class="op" id="8486737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486741">t</span><span class="op" id="8486742">.</span><span class="ident" id="8486743">Error</span><span class="op" id="8486748">(</span><span class="string" id="8486749">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8486764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486770">if</span>&nbsp;<span class="ident" id="8486773">mr</span><span class="op" id="8486775">.</span><span class="ident" id="8486776">isBoundaryDelimiterLine</span><span class="op" id="8486799">(</span><span class="op" id="8486800">[</span><span class="op" id="8486801">]</span><span class="builtintype" id="8486802">byte</span><span class="op" id="8486806">(</span><span class="string" id="8486807">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="8486829">)</span><span class="op" id="8486830">)</span>&nbsp;<span class="op" id="8486832">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486836">t</span><span class="op" id="8486837">.</span><span class="ident" id="8486838">Error</span><span class="op" id="8486843">(</span><span class="string" id="8486844">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8486859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486862">}</span><br>
<span class="lineno"></span><span class="op" id="8486864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8486867">func</span>&nbsp;<span class="ident" id="8486872">escapeString</span><span class="op" id="8486884">(</span><span class="ident" id="8486885">v</span>&nbsp;<span class="builtintype" id="8486887">string</span><span class="op" id="8486893">)</span>&nbsp;<span class="builtintype" id="8486895">string</span>&nbsp;<span class="op" id="8486902">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486905">bytes</span><span class="op" id="8486910">,</span>&nbsp;<span class="ident" id="8486912">_</span>&nbsp;<span class="op" id="8486914">:=</span>&nbsp;<span class="ident" id="8486917">json</span><span class="op" id="8486921">.</span><span class="ident" id="8486922">Marshal</span><span class="op" id="8486929">(</span><span class="ident" id="8486930">v</span><span class="op" id="8486931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486934">return</span>&nbsp;<span class="builtintype" id="8486941">string</span><span class="op" id="8486947">(</span><span class="ident" id="8486948">bytes</span><span class="op" id="8486953">)</span><br>
<span class="lineno"></span><span class="op" id="8486955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8486958">func</span>&nbsp;<span class="ident" id="8486963">expectEq</span><span class="op" id="8486971">(</span><span class="ident" id="8486972">t</span>&nbsp;<span class="op" id="8486974">*</span><span class="ident" id="8486975">testing</span><span class="op" id="8486982">.</span><span class="ident" id="8486983">T</span><span class="op" id="8486984">,</span>&nbsp;<span class="ident" id="8486986">expected</span><span class="op" id="8486994">,</span>&nbsp;<span class="ident" id="8486996">actual</span><span class="op" id="8487002">,</span>&nbsp;<span class="ident" id="8487004">what</span>&nbsp;<span class="builtintype" id="8487009">string</span><span class="op" id="8487015">)</span>&nbsp;<span class="op" id="8487017">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487020">if</span>&nbsp;<span class="ident" id="8487023">expected</span>&nbsp;<span class="op" id="8487032">==</span>&nbsp;<span class="ident" id="8487035">actual</span>&nbsp;<span class="op" id="8487042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487057">t</span><span class="op" id="8487058">.</span><span class="ident" id="8487059">Errorf</span><span class="op" id="8487065">(</span><span class="string" id="8487066">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="8487134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487138">what</span><span class="op" id="8487142">,</span>&nbsp;<span class="ident" id="8487144">escapeString</span><span class="op" id="8487156">(</span><span class="ident" id="8487157">actual</span><span class="op" id="8487163">)</span><span class="op" id="8487164">,</span>&nbsp;<span class="builtinfunc" id="8487166">len</span><span class="op" id="8487169">(</span><span class="ident" id="8487170">actual</span><span class="op" id="8487176">)</span><span class="op" id="8487177">,</span>&nbsp;<span class="ident" id="8487179">escapeString</span><span class="op" id="8487191">(</span><span class="ident" id="8487192">expected</span><span class="op" id="8487200">)</span><span class="op" id="8487201">,</span>&nbsp;<span class="builtinfunc" id="8487203">len</span><span class="op" id="8487206">(</span><span class="ident" id="8487207">expected</span><span class="op" id="8487215">)</span><span class="op" id="8487216">)</span><br>
<span class="lineno">50</span><span class="op" id="8487218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8487221">func</span>&nbsp;<span class="ident" id="8487226">TestNameAccessors</span><span class="op" id="8487243">(</span><span class="ident" id="8487244">t</span>&nbsp;<span class="op" id="8487246">*</span><span class="ident" id="8487247">testing</span><span class="op" id="8487254">.</span><span class="ident" id="8487255">T</span><span class="op" id="8487256">)</span>&nbsp;<span class="op" id="8487258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487261">tests</span>&nbsp;<span class="op" id="8487267">:=</span>&nbsp;<span class="op" id="8487270">[</span><span class="op" id="8487271">...</span><span class="op" id="8487274">]</span><span class="op" id="8487275">[</span><span class="num" id="8487276">3</span><span class="op" id="8487277">]</span><span class="builtintype" id="8487278">string</span><span class="op" id="8487284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487288">{</span><span class="string" id="8487289">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8487312">,</span>&nbsp;<span class="string" id="8487314">&#34;foo&#34;</span><span class="op" id="8487319">,</span>&nbsp;<span class="string" id="8487321">&#34;&#34;</span><span class="op" id="8487323">}</span><span class="op" id="8487324">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487328">{</span><span class="string" id="8487329">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="8487352">,</span>&nbsp;<span class="string" id="8487354">&#34;foo&#34;</span><span class="op" id="8487359">,</span>&nbsp;<span class="string" id="8487361">&#34;&#34;</span><span class="op" id="8487363">}</span><span class="op" id="8487364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487368">{</span><span class="string" id="8487369">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="8487391">,</span>&nbsp;<span class="string" id="8487393">&#34;foo&#34;</span><span class="op" id="8487398">,</span>&nbsp;<span class="string" id="8487400">&#34;&#34;</span><span class="op" id="8487402">}</span><span class="op" id="8487403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487407">{</span><span class="string" id="8487408">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8487433">,</span>&nbsp;<span class="string" id="8487435">&#34;foo&#34;</span><span class="op" id="8487440">,</span>&nbsp;<span class="string" id="8487442">&#34;&#34;</span><span class="op" id="8487444">}</span><span class="op" id="8487445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487449">{</span><span class="string" id="8487450">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8487475">,</span>&nbsp;<span class="string" id="8487477">&#34;foo&#34;</span><span class="op" id="8487482">,</span>&nbsp;<span class="string" id="8487484">&#34;&#34;</span><span class="op" id="8487486">}</span><span class="op" id="8487487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487491">{</span><span class="string" id="8487492">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="8487515">,</span>&nbsp;<span class="string" id="8487517">&#34;foo&#34;</span><span class="op" id="8487522">,</span>&nbsp;<span class="string" id="8487524">&#34;&#34;</span><span class="op" id="8487526">}</span><span class="op" id="8487527">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487531">{</span><span class="string" id="8487532">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8487585">,</span>&nbsp;<span class="string" id="8487587">&#34;foo&#34;</span><span class="op" id="8487592">,</span>&nbsp;<span class="string" id="8487594">&#34;foo.txt&#34;</span><span class="op" id="8487603">}</span><span class="op" id="8487604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487608">{</span><span class="string" id="8487609">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8487666">,</span>&nbsp;<span class="string" id="8487668">&#34;&#34;</span><span class="op" id="8487670">,</span>&nbsp;<span class="string" id="8487672">&#34;bar.txt&#34;</span><span class="op" id="8487681">}</span><span class="op" id="8487682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487688">for</span>&nbsp;<span class="ident" id="8487692">i</span><span class="op" id="8487693">,</span>&nbsp;<span class="ident" id="8487695">test</span>&nbsp;<span class="op" id="8487700">:=</span>&nbsp;<span class="keyword" id="8487703">range</span>&nbsp;<span class="ident" id="8487709">tests</span>&nbsp;<span class="op" id="8487715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487719">p</span>&nbsp;<span class="op" id="8487721">:=</span>&nbsp;<span class="op" id="8487724">&amp;</span><span class="ident" id="8487725">Part</span><span class="op" id="8487729">{</span><span class="ident" id="8487730">Header</span><span class="op" id="8487736">:</span>&nbsp;<span class="builtinfunc" id="8487738">make</span><span class="op" id="8487742">(</span><span class="keyword" id="8487743">map</span><span class="op" id="8487746">[</span><span class="builtintype" id="8487747">string</span><span class="op" id="8487753">]</span><span class="op" id="8487754">[</span><span class="op" id="8487755">]</span><span class="builtintype" id="8487756">string</span><span class="op" id="8487762">)</span><span class="op" id="8487763">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487767">p</span><span class="op" id="8487768">.</span><span class="ident" id="8487769">Header</span><span class="op" id="8487775">.</span><span class="ident" id="8487776">Set</span><span class="op" id="8487779">(</span><span class="string" id="8487780">&#34;Content-Disposition&#34;</span><span class="op" id="8487801">,</span>&nbsp;<span class="ident" id="8487803">test</span><span class="op" id="8487807">[</span><span class="num" id="8487808">0</span><span class="op" id="8487809">]</span><span class="op" id="8487810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487814">if</span>&nbsp;<span class="ident" id="8487817">g</span><span class="op" id="8487818">,</span>&nbsp;<span class="ident" id="8487820">e</span>&nbsp;<span class="op" id="8487822">:=</span>&nbsp;<span class="ident" id="8487825">p</span><span class="op" id="8487826">.</span><span class="ident" id="8487827">FormName</span><span class="op" id="8487835">(</span><span class="op" id="8487836">)</span><span class="op" id="8487837">,</span>&nbsp;<span class="ident" id="8487839">test</span><span class="op" id="8487843">[</span><span class="num" id="8487844">1</span><span class="op" id="8487845">]</span><span class="op" id="8487846">;</span>&nbsp;<span class="ident" id="8487848">g</span>&nbsp;<span class="op" id="8487850">!=</span>&nbsp;<span class="ident" id="8487853">e</span>&nbsp;<span class="op" id="8487855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487860">t</span><span class="op" id="8487861">.</span><span class="ident" id="8487862">Errorf</span><span class="op" id="8487868">(</span><span class="string" id="8487869">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8487904">,</span>&nbsp;<span class="ident" id="8487906">i</span><span class="op" id="8487907">,</span>&nbsp;<span class="ident" id="8487909">g</span><span class="op" id="8487910">,</span>&nbsp;<span class="ident" id="8487912">e</span><span class="op" id="8487913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487921">if</span>&nbsp;<span class="ident" id="8487924">g</span><span class="op" id="8487925">,</span>&nbsp;<span class="ident" id="8487927">e</span>&nbsp;<span class="op" id="8487929">:=</span>&nbsp;<span class="ident" id="8487932">p</span><span class="op" id="8487933">.</span><span class="ident" id="8487934">FileName</span><span class="op" id="8487942">(</span><span class="op" id="8487943">)</span><span class="op" id="8487944">,</span>&nbsp;<span class="ident" id="8487946">test</span><span class="op" id="8487950">[</span><span class="num" id="8487951">2</span><span class="op" id="8487952">]</span><span class="op" id="8487953">;</span>&nbsp;<span class="ident" id="8487955">g</span>&nbsp;<span class="op" id="8487957">!=</span>&nbsp;<span class="ident" id="8487960">e</span>&nbsp;<span class="op" id="8487962">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487967">t</span><span class="op" id="8487968">.</span><span class="ident" id="8487969">Errorf</span><span class="op" id="8487975">(</span><span class="string" id="8487976">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8488011">,</span>&nbsp;<span class="ident" id="8488013">i</span><span class="op" id="8488014">,</span>&nbsp;<span class="ident" id="8488016">g</span><span class="op" id="8488017">,</span>&nbsp;<span class="ident" id="8488019">e</span><span class="op" id="8488020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488027">}</span><br>
<span class="lineno"></span><span class="op" id="8488029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8488032">var</span>&nbsp;<span class="ident" id="8488036">longLine</span>&nbsp;<span class="op" id="8488045">=</span>&nbsp;<span class="ident" id="8488047">strings</span><span class="op" id="8488054">.</span><span class="ident" id="8488055">Repeat</span><span class="op" id="8488061">(</span><span class="string" id="8488062">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="8488082">,</span>&nbsp;<span class="op" id="8488084">(</span><span class="num" id="8488085">1</span><span class="op" id="8488086">&lt;&lt;</span><span class="num" id="8488088">20</span><span class="op" id="8488090">)</span><span class="op" id="8488091">/</span><span class="num" id="8488092">8</span><span class="op" id="8488093">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8488096">func</span>&nbsp;<span class="ident" id="8488101">testMultipartBody</span><span class="op" id="8488118">(</span><span class="ident" id="8488119">sep</span>&nbsp;<span class="builtintype" id="8488123">string</span><span class="op" id="8488129">)</span>&nbsp;<span class="builtintype" id="8488131">string</span>&nbsp;<span class="op" id="8488138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488141">testBody</span>&nbsp;<span class="op" id="8488150">:=</span>&nbsp;<span class="string" id="8488153">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488510">testBody</span>&nbsp;<span class="op" id="8488519">=</span>&nbsp;<span class="ident" id="8488521">strings</span><span class="op" id="8488528">.</span><span class="ident" id="8488529">Replace</span><span class="op" id="8488536">(</span><span class="ident" id="8488537">testBody</span><span class="op" id="8488545">,</span>&nbsp;<span class="string" id="8488547">&#34;\n&#34;</span><span class="op" id="8488551">,</span>&nbsp;<span class="ident" id="8488553">sep</span><span class="op" id="8488556">,</span>&nbsp;<span class="op" id="8488558">-</span><span class="num" id="8488559">1</span><span class="op" id="8488560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488563">return</span>&nbsp;<span class="ident" id="8488570">strings</span><span class="op" id="8488577">.</span><span class="ident" id="8488578">Replace</span><span class="op" id="8488585">(</span><span class="ident" id="8488586">testBody</span><span class="op" id="8488594">,</span>&nbsp;<span class="string" id="8488596">&#34;[longline]&#34;</span><span class="op" id="8488608">,</span>&nbsp;<span class="ident" id="8488610">longLine</span><span class="op" id="8488618">,</span>&nbsp;<span class="num" id="8488620">1</span><span class="op" id="8488621">)</span><br>
<span class="lineno">110</span><span class="op" id="8488623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8488626">func</span>&nbsp;<span class="ident" id="8488631">TestMultipart</span><span class="op" id="8488644">(</span><span class="ident" id="8488645">t</span>&nbsp;<span class="op" id="8488647">*</span><span class="ident" id="8488648">testing</span><span class="op" id="8488655">.</span><span class="ident" id="8488656">T</span><span class="op" id="8488657">)</span>&nbsp;<span class="op" id="8488659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488662">bodyReader</span>&nbsp;<span class="op" id="8488673">:=</span>&nbsp;<span class="ident" id="8488676">strings</span><span class="op" id="8488683">.</span><span class="ident" id="8488684">NewReader</span><span class="op" id="8488693">(</span><span class="ident" id="8488694">testMultipartBody</span><span class="op" id="8488711">(</span><span class="string" id="8488712">&#34;\r\n&#34;</span><span class="op" id="8488718">)</span><span class="op" id="8488719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488722">testMultipart</span><span class="op" id="8488735">(</span><span class="ident" id="8488736">t</span><span class="op" id="8488737">,</span>&nbsp;<span class="ident" id="8488739">bodyReader</span><span class="op" id="8488749">,</span>&nbsp;<span class="builtintype" id="8488751">false</span><span class="op" id="8488756">)</span><br>
<span class="lineno">115</span><span class="op" id="8488758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8488761">func</span>&nbsp;<span class="ident" id="8488766">TestMultipartOnlyNewlines</span><span class="op" id="8488791">(</span><span class="ident" id="8488792">t</span>&nbsp;<span class="op" id="8488794">*</span><span class="ident" id="8488795">testing</span><span class="op" id="8488802">.</span><span class="ident" id="8488803">T</span><span class="op" id="8488804">)</span>&nbsp;<span class="op" id="8488806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488809">bodyReader</span>&nbsp;<span class="op" id="8488820">:=</span>&nbsp;<span class="ident" id="8488823">strings</span><span class="op" id="8488830">.</span><span class="ident" id="8488831">NewReader</span><span class="op" id="8488840">(</span><span class="ident" id="8488841">testMultipartBody</span><span class="op" id="8488858">(</span><span class="string" id="8488859">&#34;\n&#34;</span><span class="op" id="8488863">)</span><span class="op" id="8488864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488867">testMultipart</span><span class="op" id="8488880">(</span><span class="ident" id="8488881">t</span><span class="op" id="8488882">,</span>&nbsp;<span class="ident" id="8488884">bodyReader</span><span class="op" id="8488894">,</span>&nbsp;<span class="builtintype" id="8488896">true</span><span class="op" id="8488900">)</span><br>
<span class="lineno">120</span><span class="op" id="8488902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8488905">func</span>&nbsp;<span class="ident" id="8488910">TestMultipartSlowInput</span><span class="op" id="8488932">(</span><span class="ident" id="8488933">t</span>&nbsp;<span class="op" id="8488935">*</span><span class="ident" id="8488936">testing</span><span class="op" id="8488943">.</span><span class="ident" id="8488944">T</span><span class="op" id="8488945">)</span>&nbsp;<span class="op" id="8488947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488950">bodyReader</span>&nbsp;<span class="op" id="8488961">:=</span>&nbsp;<span class="ident" id="8488964">strings</span><span class="op" id="8488971">.</span><span class="ident" id="8488972">NewReader</span><span class="op" id="8488981">(</span><span class="ident" id="8488982">testMultipartBody</span><span class="op" id="8488999">(</span><span class="string" id="8489000">&#34;\r\n&#34;</span><span class="op" id="8489006">)</span><span class="op" id="8489007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489010">testMultipart</span><span class="op" id="8489023">(</span><span class="ident" id="8489024">t</span><span class="op" id="8489025">,</span>&nbsp;<span class="op" id="8489027">&amp;</span><span class="ident" id="8489028">slowReader</span><span class="op" id="8489038">{</span><span class="ident" id="8489039">bodyReader</span><span class="op" id="8489049">}</span><span class="op" id="8489050">,</span>&nbsp;<span class="builtintype" id="8489052">false</span><span class="op" id="8489057">)</span><br>
<span class="lineno">125</span><span class="op" id="8489059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8489062">func</span>&nbsp;<span class="ident" id="8489067">testMultipart</span><span class="op" id="8489080">(</span><span class="ident" id="8489081">t</span>&nbsp;<span class="op" id="8489083">*</span><span class="ident" id="8489084">testing</span><span class="op" id="8489091">.</span><span class="ident" id="8489092">T</span><span class="op" id="8489093">,</span>&nbsp;<span class="ident" id="8489095">r</span>&nbsp;<span class="ident" id="8489097">io</span><span class="op" id="8489099">.</span><span class="ident" id="8489100">Reader</span><span class="op" id="8489106">,</span>&nbsp;<span class="ident" id="8489108">onlyNewlines</span>&nbsp;<span class="builtintype" id="8489121">bool</span><span class="op" id="8489125">)</span>&nbsp;<span class="op" id="8489127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489130">reader</span>&nbsp;<span class="op" id="8489137">:=</span>&nbsp;<span class="ident" id="8489140">NewReader</span><span class="op" id="8489149">(</span><span class="ident" id="8489150">r</span><span class="op" id="8489151">,</span>&nbsp;<span class="string" id="8489153">&#34;MyBoundary&#34;</span><span class="op" id="8489165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489168">buf</span>&nbsp;<span class="op" id="8489172">:=</span>&nbsp;<span class="builtinfunc" id="8489175">new</span><span class="op" id="8489178">(</span><span class="ident" id="8489179">bytes</span><span class="op" id="8489184">.</span><span class="ident" id="8489185">Buffer</span><span class="op" id="8489191">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8489195">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489205">part</span><span class="op" id="8489209">,</span>&nbsp;<span class="ident" id="8489211">err</span>&nbsp;<span class="op" id="8489215">:=</span>&nbsp;<span class="ident" id="8489218">reader</span><span class="op" id="8489224">.</span><span class="ident" id="8489225">NextPart</span><span class="op" id="8489233">(</span><span class="op" id="8489234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489237">if</span>&nbsp;<span class="ident" id="8489240">part</span>&nbsp;<span class="op" id="8489245">==</span>&nbsp;<span class="builtintype" id="8489248">nil</span>&nbsp;<span class="op" id="8489252">||</span>&nbsp;<span class="ident" id="8489255">err</span>&nbsp;<span class="op" id="8489259">!=</span>&nbsp;<span class="builtintype" id="8489262">nil</span>&nbsp;<span class="op" id="8489266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489270">t</span><span class="op" id="8489271">.</span><span class="ident" id="8489272">Error</span><span class="op" id="8489277">(</span><span class="string" id="8489278">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="8489294">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489298">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8489306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489309">if</span>&nbsp;<span class="ident" id="8489312">x</span>&nbsp;<span class="op" id="8489314">:=</span>&nbsp;<span class="ident" id="8489317">part</span><span class="op" id="8489321">.</span><span class="ident" id="8489322">Header</span><span class="op" id="8489328">.</span><span class="ident" id="8489329">Get</span><span class="op" id="8489332">(</span><span class="string" id="8489333">&#34;Header1&#34;</span><span class="op" id="8489342">)</span><span class="op" id="8489343">;</span>&nbsp;<span class="ident" id="8489345">x</span>&nbsp;<span class="op" id="8489347">!=</span>&nbsp;<span class="string" id="8489350">&#34;value1&#34;</span>&nbsp;<span class="op" id="8489359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489363">t</span><span class="op" id="8489364">.</span><span class="ident" id="8489365">Errorf</span><span class="op" id="8489371">(</span><span class="string" id="8489372">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8489407">,</span>&nbsp;<span class="string" id="8489409">&#34;Header1&#34;</span><span class="op" id="8489418">,</span>&nbsp;<span class="ident" id="8489420">x</span><span class="op" id="8489421">,</span>&nbsp;<span class="string" id="8489423">&#34;value1&#34;</span><span class="op" id="8489431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8489434">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489437">if</span>&nbsp;<span class="ident" id="8489440">x</span>&nbsp;<span class="op" id="8489442">:=</span>&nbsp;<span class="ident" id="8489445">part</span><span class="op" id="8489449">.</span><span class="ident" id="8489450">Header</span><span class="op" id="8489456">.</span><span class="ident" id="8489457">Get</span><span class="op" id="8489460">(</span><span class="string" id="8489461">&#34;foo-bar&#34;</span><span class="op" id="8489470">)</span><span class="op" id="8489471">;</span>&nbsp;<span class="ident" id="8489473">x</span>&nbsp;<span class="op" id="8489475">!=</span>&nbsp;<span class="string" id="8489478">&#34;baz&#34;</span>&nbsp;<span class="op" id="8489484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489488">t</span><span class="op" id="8489489">.</span><span class="ident" id="8489490">Errorf</span><span class="op" id="8489496">(</span><span class="string" id="8489497">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8489532">,</span>&nbsp;<span class="string" id="8489534">&#34;foo-bar&#34;</span><span class="op" id="8489543">,</span>&nbsp;<span class="ident" id="8489545">x</span><span class="op" id="8489546">,</span>&nbsp;<span class="string" id="8489548">&#34;baz&#34;</span><span class="op" id="8489553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8489556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489559">if</span>&nbsp;<span class="ident" id="8489562">x</span>&nbsp;<span class="op" id="8489564">:=</span>&nbsp;<span class="ident" id="8489567">part</span><span class="op" id="8489571">.</span><span class="ident" id="8489572">Header</span><span class="op" id="8489578">.</span><span class="ident" id="8489579">Get</span><span class="op" id="8489582">(</span><span class="string" id="8489583">&#34;Foo-Bar&#34;</span><span class="op" id="8489592">)</span><span class="op" id="8489593">;</span>&nbsp;<span class="ident" id="8489595">x</span>&nbsp;<span class="op" id="8489597">!=</span>&nbsp;<span class="string" id="8489600">&#34;baz&#34;</span>&nbsp;<span class="op" id="8489606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489610">t</span><span class="op" id="8489611">.</span><span class="ident" id="8489612">Errorf</span><span class="op" id="8489618">(</span><span class="string" id="8489619">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8489654">,</span>&nbsp;<span class="string" id="8489656">&#34;Foo-Bar&#34;</span><span class="op" id="8489665">,</span>&nbsp;<span class="ident" id="8489667">x</span><span class="op" id="8489668">,</span>&nbsp;<span class="string" id="8489670">&#34;baz&#34;</span><span class="op" id="8489675">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8489678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489681">buf</span><span class="op" id="8489684">.</span><span class="ident" id="8489685">Reset</span><span class="op" id="8489690">(</span><span class="op" id="8489691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489694">if</span>&nbsp;<span class="ident" id="8489697">_</span><span class="op" id="8489698">,</span>&nbsp;<span class="ident" id="8489700">err</span>&nbsp;<span class="op" id="8489704">:=</span>&nbsp;<span class="ident" id="8489707">io</span><span class="op" id="8489709">.</span><span class="ident" id="8489710">Copy</span><span class="op" id="8489714">(</span><span class="ident" id="8489715">buf</span><span class="op" id="8489718">,</span>&nbsp;<span class="ident" id="8489720">part</span><span class="op" id="8489724">)</span><span class="op" id="8489725">;</span>&nbsp;<span class="ident" id="8489727">err</span>&nbsp;<span class="op" id="8489731">!=</span>&nbsp;<span class="builtintype" id="8489734">nil</span>&nbsp;<span class="op" id="8489738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489742">t</span><span class="op" id="8489743">.</span><span class="ident" id="8489744">Errorf</span><span class="op" id="8489750">(</span><span class="string" id="8489751">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8489768">,</span>&nbsp;<span class="ident" id="8489770">err</span><span class="op" id="8489773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8489776">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489780">adjustNewlines</span>&nbsp;<span class="op" id="8489795">:=</span>&nbsp;<span class="keyword" id="8489798">func</span><span class="op" id="8489802">(</span><span class="ident" id="8489803">s</span>&nbsp;<span class="builtintype" id="8489805">string</span><span class="op" id="8489811">)</span>&nbsp;<span class="builtintype" id="8489813">string</span>&nbsp;<span class="op" id="8489820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489824">if</span>&nbsp;<span class="ident" id="8489827">onlyNewlines</span>&nbsp;<span class="op" id="8489840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489845">return</span>&nbsp;<span class="ident" id="8489852">strings</span><span class="op" id="8489859">.</span><span class="ident" id="8489860">Replace</span><span class="op" id="8489867">(</span><span class="ident" id="8489868">s</span><span class="op" id="8489869">,</span>&nbsp;<span class="string" id="8489871">&#34;\r\n&#34;</span><span class="op" id="8489877">,</span>&nbsp;<span class="string" id="8489879">&#34;\n&#34;</span><span class="op" id="8489883">,</span>&nbsp;<span class="op" id="8489885">-</span><span class="num" id="8489886">1</span><span class="op" id="8489887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8489891">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8489895">return</span>&nbsp;<span class="ident" id="8489902">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8489905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8489909">expectEq</span><span class="op" id="8489917">(</span><span class="ident" id="8489918">t</span><span class="op" id="8489919">,</span>&nbsp;<span class="ident" id="8489921">adjustNewlines</span><span class="op" id="8489935">(</span><span class="string" id="8489936">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="8489958">)</span><span class="op" id="8489959">,</span>&nbsp;<span class="ident" id="8489961">buf</span><span class="op" id="8489964">.</span><span class="ident" id="8489965">String</span><span class="op" id="8489971">(</span><span class="op" id="8489972">)</span><span class="op" id="8489973">,</span>&nbsp;<span class="string" id="8489975">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="8489996">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8490000">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490010">part</span><span class="op" id="8490014">,</span>&nbsp;<span class="ident" id="8490016">err</span>&nbsp;<span class="op" id="8490020">=</span>&nbsp;<span class="ident" id="8490022">reader</span><span class="op" id="8490028">.</span><span class="ident" id="8490029">NextPart</span><span class="op" id="8490037">(</span><span class="op" id="8490038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490041">if</span>&nbsp;<span class="ident" id="8490044">err</span>&nbsp;<span class="op" id="8490048">!=</span>&nbsp;<span class="builtintype" id="8490051">nil</span>&nbsp;<span class="op" id="8490055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490059">t</span><span class="op" id="8490060">.</span><span class="ident" id="8490061">Fatalf</span><span class="op" id="8490067">(</span><span class="string" id="8490068">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="8490093">,</span>&nbsp;<span class="ident" id="8490095">err</span><span class="op" id="8490098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490102">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490113">if</span>&nbsp;<span class="ident" id="8490116">e</span><span class="op" id="8490117">,</span>&nbsp;<span class="ident" id="8490119">g</span>&nbsp;<span class="op" id="8490121">:=</span>&nbsp;<span class="string" id="8490124">&#34;bigsection&#34;</span><span class="op" id="8490136">,</span>&nbsp;<span class="ident" id="8490138">part</span><span class="op" id="8490142">.</span><span class="ident" id="8490143">Header</span><span class="op" id="8490149">.</span><span class="ident" id="8490150">Get</span><span class="op" id="8490153">(</span><span class="string" id="8490154">&#34;name&#34;</span><span class="op" id="8490160">)</span><span class="op" id="8490161">;</span>&nbsp;<span class="ident" id="8490163">e</span>&nbsp;<span class="op" id="8490165">!=</span>&nbsp;<span class="ident" id="8490168">g</span>&nbsp;<span class="op" id="8490170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490174">t</span><span class="op" id="8490175">.</span><span class="ident" id="8490176">Errorf</span><span class="op" id="8490182">(</span><span class="string" id="8490183">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8490225">,</span>&nbsp;<span class="ident" id="8490227">e</span><span class="op" id="8490228">,</span>&nbsp;<span class="ident" id="8490230">g</span><span class="op" id="8490231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490237">buf</span><span class="op" id="8490240">.</span><span class="ident" id="8490241">Reset</span><span class="op" id="8490246">(</span><span class="op" id="8490247">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490250">if</span>&nbsp;<span class="ident" id="8490253">_</span><span class="op" id="8490254">,</span>&nbsp;<span class="ident" id="8490256">err</span>&nbsp;<span class="op" id="8490260">:=</span>&nbsp;<span class="ident" id="8490263">io</span><span class="op" id="8490265">.</span><span class="ident" id="8490266">Copy</span><span class="op" id="8490270">(</span><span class="ident" id="8490271">buf</span><span class="op" id="8490274">,</span>&nbsp;<span class="ident" id="8490276">part</span><span class="op" id="8490280">)</span><span class="op" id="8490281">;</span>&nbsp;<span class="ident" id="8490283">err</span>&nbsp;<span class="op" id="8490287">!=</span>&nbsp;<span class="builtintype" id="8490290">nil</span>&nbsp;<span class="op" id="8490294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490298">t</span><span class="op" id="8490299">.</span><span class="ident" id="8490300">Errorf</span><span class="op" id="8490306">(</span><span class="string" id="8490307">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8490324">,</span>&nbsp;<span class="ident" id="8490326">err</span><span class="op" id="8490329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490335">s</span>&nbsp;<span class="op" id="8490337">:=</span>&nbsp;<span class="ident" id="8490340">buf</span><span class="op" id="8490343">.</span><span class="ident" id="8490344">String</span><span class="op" id="8490350">(</span><span class="op" id="8490351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490354">if</span>&nbsp;<span class="builtinfunc" id="8490357">len</span><span class="op" id="8490360">(</span><span class="ident" id="8490361">s</span><span class="op" id="8490362">)</span>&nbsp;<span class="op" id="8490364">!=</span>&nbsp;<span class="builtinfunc" id="8490367">len</span><span class="op" id="8490370">(</span><span class="ident" id="8490371">longLine</span><span class="op" id="8490379">)</span>&nbsp;<span class="op" id="8490381">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490385">t</span><span class="op" id="8490386">.</span><span class="ident" id="8490387">Errorf</span><span class="op" id="8490393">(</span><span class="string" id="8490394">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="8490453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8490458">len</span><span class="op" id="8490461">(</span><span class="ident" id="8490462">longLine</span><span class="op" id="8490470">)</span><span class="op" id="8490471">,</span>&nbsp;<span class="builtinfunc" id="8490473">len</span><span class="op" id="8490476">(</span><span class="ident" id="8490477">s</span><span class="op" id="8490478">)</span><span class="op" id="8490479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490485">if</span>&nbsp;<span class="ident" id="8490488">s</span>&nbsp;<span class="op" id="8490490">!=</span>&nbsp;<span class="ident" id="8490493">longLine</span>&nbsp;<span class="op" id="8490502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490506">t</span><span class="op" id="8490507">.</span><span class="ident" id="8490508">Errorf</span><span class="op" id="8490514">(</span><span class="string" id="8490515">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="8490545">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8490552">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490562">part</span><span class="op" id="8490566">,</span>&nbsp;<span class="ident" id="8490568">err</span>&nbsp;<span class="op" id="8490572">=</span>&nbsp;<span class="ident" id="8490574">reader</span><span class="op" id="8490580">.</span><span class="ident" id="8490581">NextPart</span><span class="op" id="8490589">(</span><span class="op" id="8490590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490593">if</span>&nbsp;<span class="ident" id="8490596">part</span>&nbsp;<span class="op" id="8490601">==</span>&nbsp;<span class="builtintype" id="8490604">nil</span>&nbsp;<span class="op" id="8490608">||</span>&nbsp;<span class="ident" id="8490611">err</span>&nbsp;<span class="op" id="8490615">!=</span>&nbsp;<span class="builtintype" id="8490618">nil</span>&nbsp;<span class="op" id="8490622">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490626">t</span><span class="op" id="8490627">.</span><span class="ident" id="8490628">Error</span><span class="op" id="8490633">(</span><span class="string" id="8490634">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="8490650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490665">if</span>&nbsp;<span class="ident" id="8490668">part</span><span class="op" id="8490672">.</span><span class="ident" id="8490673">Header</span><span class="op" id="8490679">.</span><span class="ident" id="8490680">Get</span><span class="op" id="8490683">(</span><span class="string" id="8490684">&#34;foo-bar&#34;</span><span class="op" id="8490693">)</span>&nbsp;<span class="op" id="8490695">!=</span>&nbsp;<span class="string" id="8490698">&#34;bazb&#34;</span>&nbsp;<span class="op" id="8490705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490709">t</span><span class="op" id="8490710">.</span><span class="ident" id="8490711">Error</span><span class="op" id="8490716">(</span><span class="string" id="8490717">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="8490741">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490747">buf</span><span class="op" id="8490750">.</span><span class="ident" id="8490751">Reset</span><span class="op" id="8490756">(</span><span class="op" id="8490757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8490760">if</span>&nbsp;<span class="ident" id="8490763">_</span><span class="op" id="8490764">,</span>&nbsp;<span class="ident" id="8490766">err</span>&nbsp;<span class="op" id="8490770">:=</span>&nbsp;<span class="ident" id="8490773">io</span><span class="op" id="8490775">.</span><span class="ident" id="8490776">Copy</span><span class="op" id="8490780">(</span><span class="ident" id="8490781">buf</span><span class="op" id="8490784">,</span>&nbsp;<span class="ident" id="8490786">part</span><span class="op" id="8490790">)</span><span class="op" id="8490791">;</span>&nbsp;<span class="ident" id="8490793">err</span>&nbsp;<span class="op" id="8490797">!=</span>&nbsp;<span class="builtintype" id="8490800">nil</span>&nbsp;<span class="op" id="8490804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490808">t</span><span class="op" id="8490809">.</span><span class="ident" id="8490810">Errorf</span><span class="op" id="8490816">(</span><span class="string" id="8490817">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8490834">,</span>&nbsp;<span class="ident" id="8490836">err</span><span class="op" id="8490839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8490842">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490845">expectEq</span><span class="op" id="8490853">(</span><span class="ident" id="8490854">t</span><span class="op" id="8490855">,</span>&nbsp;<span class="ident" id="8490857">adjustNewlines</span><span class="op" id="8490871">(</span><span class="string" id="8490872">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="8490937">)</span><span class="op" id="8490938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490942">buf</span><span class="op" id="8490945">.</span><span class="ident" id="8490946">String</span><span class="op" id="8490952">(</span><span class="op" id="8490953">)</span><span class="op" id="8490954">,</span>&nbsp;<span class="string" id="8490956">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="8490972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8490976">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8490986">part</span><span class="op" id="8490990">,</span>&nbsp;<span class="ident" id="8490992">err</span>&nbsp;<span class="op" id="8490996">=</span>&nbsp;<span class="ident" id="8490998">reader</span><span class="op" id="8491004">.</span><span class="ident" id="8491005">NextPart</span><span class="op" id="8491013">(</span><span class="op" id="8491014">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491017">if</span>&nbsp;<span class="ident" id="8491020">part</span>&nbsp;<span class="op" id="8491025">==</span>&nbsp;<span class="builtintype" id="8491028">nil</span>&nbsp;<span class="op" id="8491032">||</span>&nbsp;<span class="ident" id="8491035">err</span>&nbsp;<span class="op" id="8491039">!=</span>&nbsp;<span class="builtintype" id="8491042">nil</span>&nbsp;<span class="op" id="8491046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491050">t</span><span class="op" id="8491051">.</span><span class="ident" id="8491052">Error</span><span class="op" id="8491057">(</span><span class="string" id="8491058">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="8491090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491094">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8491102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8491106">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491129">part</span><span class="op" id="8491133">,</span>&nbsp;<span class="ident" id="8491135">err</span>&nbsp;<span class="op" id="8491139">=</span>&nbsp;<span class="ident" id="8491141">reader</span><span class="op" id="8491147">.</span><span class="ident" id="8491148">NextPart</span><span class="op" id="8491156">(</span><span class="op" id="8491157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491160">if</span>&nbsp;<span class="ident" id="8491163">part</span>&nbsp;<span class="op" id="8491168">!=</span>&nbsp;<span class="builtintype" id="8491171">nil</span>&nbsp;<span class="op" id="8491175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491179">t</span><span class="op" id="8491180">.</span><span class="ident" id="8491181">Error</span><span class="op" id="8491186">(</span><span class="string" id="8491187">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="8491216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8491219">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491222">if</span>&nbsp;<span class="ident" id="8491225">err</span>&nbsp;<span class="op" id="8491229">!=</span>&nbsp;<span class="ident" id="8491232">io</span><span class="op" id="8491234">.</span><span class="ident" id="8491235">EOF</span>&nbsp;<span class="op" id="8491239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491243">t</span><span class="op" id="8491244">.</span><span class="ident" id="8491245">Errorf</span><span class="op" id="8491251">(</span><span class="string" id="8491252">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8491291">,</span>&nbsp;<span class="ident" id="8491293">err</span><span class="op" id="8491296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8491299">}</span><br>
<span class="lineno"></span><span class="op" id="8491301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8491304">func</span>&nbsp;<span class="ident" id="8491309">TestVariousTextLineEndings</span><span class="op" id="8491335">(</span><span class="ident" id="8491336">t</span>&nbsp;<span class="op" id="8491338">*</span><span class="ident" id="8491339">testing</span><span class="op" id="8491346">.</span><span class="ident" id="8491347">T</span><span class="op" id="8491348">)</span>&nbsp;<span class="op" id="8491350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491353">tests</span>&nbsp;<span class="op" id="8491359">:=</span>&nbsp;<span class="op" id="8491362">[</span><span class="op" id="8491363">...</span><span class="op" id="8491366">]</span><span class="builtintype" id="8491367">string</span><span class="op" id="8491373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491377">&#34;Foo\nBar&#34;</span><span class="op" id="8491387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491391">&#34;Foo\nBar\n&#34;</span><span class="op" id="8491403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491407">&#34;Foo\r\nBar&#34;</span><span class="op" id="8491419">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491423">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="8491439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491443">&#34;Foo\rBar&#34;</span><span class="op" id="8491453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491457">&#34;Foo\rBar\r&#34;</span><span class="op" id="8491469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491473">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="8491519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8491522">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491526">for</span>&nbsp;<span class="ident" id="8491530">testNum</span><span class="op" id="8491537">,</span>&nbsp;<span class="ident" id="8491539">expectedBody</span>&nbsp;<span class="op" id="8491552">:=</span>&nbsp;<span class="keyword" id="8491555">range</span>&nbsp;<span class="ident" id="8491561">tests</span>&nbsp;<span class="op" id="8491567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491571">body</span>&nbsp;<span class="op" id="8491576">:=</span>&nbsp;<span class="string" id="8491579">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="8491596">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491601">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8491654">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491659">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8491666">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491671">expectedBody</span>&nbsp;<span class="op" id="8491684">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491689">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491714">bodyReader</span>&nbsp;<span class="op" id="8491725">:=</span>&nbsp;<span class="ident" id="8491728">strings</span><span class="op" id="8491735">.</span><span class="ident" id="8491736">NewReader</span><span class="op" id="8491745">(</span><span class="ident" id="8491746">body</span><span class="op" id="8491750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491755">reader</span>&nbsp;<span class="op" id="8491762">:=</span>&nbsp;<span class="ident" id="8491765">NewReader</span><span class="op" id="8491774">(</span><span class="ident" id="8491775">bodyReader</span><span class="op" id="8491785">,</span>&nbsp;<span class="string" id="8491787">&#34;BOUNDARY&#34;</span><span class="op" id="8491797">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491801">buf</span>&nbsp;<span class="op" id="8491805">:=</span>&nbsp;<span class="builtinfunc" id="8491808">new</span><span class="op" id="8491811">(</span><span class="ident" id="8491812">bytes</span><span class="op" id="8491817">.</span><span class="ident" id="8491818">Buffer</span><span class="op" id="8491824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491828">part</span><span class="op" id="8491832">,</span>&nbsp;<span class="ident" id="8491834">err</span>&nbsp;<span class="op" id="8491838">:=</span>&nbsp;<span class="ident" id="8491841">reader</span><span class="op" id="8491847">.</span><span class="ident" id="8491848">NextPart</span><span class="op" id="8491856">(</span><span class="op" id="8491857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491861">if</span>&nbsp;<span class="ident" id="8491864">part</span>&nbsp;<span class="op" id="8491869">==</span>&nbsp;<span class="builtintype" id="8491872">nil</span>&nbsp;<span class="op" id="8491876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491881">t</span><span class="op" id="8491882">.</span><span class="ident" id="8491883">Errorf</span><span class="op" id="8491889">(</span><span class="string" id="8491890">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="8491923">,</span>&nbsp;<span class="ident" id="8491925">testNum</span><span class="op" id="8491932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491937">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8491948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8491952">if</span>&nbsp;<span class="ident" id="8491955">err</span>&nbsp;<span class="op" id="8491959">!=</span>&nbsp;<span class="builtintype" id="8491962">nil</span>&nbsp;<span class="op" id="8491966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8491971">t</span><span class="op" id="8491972">.</span><span class="ident" id="8491973">Errorf</span><span class="op" id="8491979">(</span><span class="string" id="8491980">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="8492013">,</span>&nbsp;<span class="ident" id="8492015">testNum</span><span class="op" id="8492022">,</span>&nbsp;<span class="ident" id="8492024">err</span><span class="op" id="8492027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492032">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492043">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492047">written</span><span class="op" id="8492054">,</span>&nbsp;<span class="ident" id="8492056">err</span>&nbsp;<span class="op" id="8492060">:=</span>&nbsp;<span class="ident" id="8492063">io</span><span class="op" id="8492065">.</span><span class="ident" id="8492066">Copy</span><span class="op" id="8492070">(</span><span class="ident" id="8492071">buf</span><span class="op" id="8492074">,</span>&nbsp;<span class="ident" id="8492076">part</span><span class="op" id="8492080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492084">expectEq</span><span class="op" id="8492092">(</span><span class="ident" id="8492093">t</span><span class="op" id="8492094">,</span>&nbsp;<span class="ident" id="8492096">expectedBody</span><span class="op" id="8492108">,</span>&nbsp;<span class="ident" id="8492110">buf</span><span class="op" id="8492113">.</span><span class="ident" id="8492114">String</span><span class="op" id="8492120">(</span><span class="op" id="8492121">)</span><span class="op" id="8492122">,</span>&nbsp;<span class="ident" id="8492124">fmt</span><span class="op" id="8492127">.</span><span class="ident" id="8492128">Sprintf</span><span class="op" id="8492135">(</span><span class="string" id="8492136">&#34;test&nbsp;%d&#34;</span><span class="op" id="8492145">,</span>&nbsp;<span class="ident" id="8492147">testNum</span><span class="op" id="8492154">)</span><span class="op" id="8492155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492159">if</span>&nbsp;<span class="ident" id="8492162">err</span>&nbsp;<span class="op" id="8492166">!=</span>&nbsp;<span class="builtintype" id="8492169">nil</span>&nbsp;<span class="op" id="8492173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492178">t</span><span class="op" id="8492179">.</span><span class="ident" id="8492180">Errorf</span><span class="op" id="8492186">(</span><span class="string" id="8492187">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="8492232">,</span>&nbsp;<span class="ident" id="8492234">written</span><span class="op" id="8492241">,</span>&nbsp;<span class="ident" id="8492243">err</span><span class="op" id="8492246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492250">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492255">part</span><span class="op" id="8492259">,</span>&nbsp;<span class="ident" id="8492261">err</span>&nbsp;<span class="op" id="8492265">=</span>&nbsp;<span class="ident" id="8492267">reader</span><span class="op" id="8492273">.</span><span class="ident" id="8492274">NextPart</span><span class="op" id="8492282">(</span><span class="op" id="8492283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492287">if</span>&nbsp;<span class="ident" id="8492290">part</span>&nbsp;<span class="op" id="8492295">!=</span>&nbsp;<span class="builtintype" id="8492298">nil</span>&nbsp;<span class="op" id="8492302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492307">t</span><span class="op" id="8492308">.</span><span class="ident" id="8492309">Errorf</span><span class="op" id="8492315">(</span><span class="string" id="8492316">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="8492344">,</span>&nbsp;<span class="ident" id="8492346">testNum</span><span class="op" id="8492353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492357">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492361">if</span>&nbsp;<span class="ident" id="8492364">err</span>&nbsp;<span class="op" id="8492368">!=</span>&nbsp;<span class="ident" id="8492371">io</span><span class="op" id="8492373">.</span><span class="ident" id="8492374">EOF</span>&nbsp;<span class="op" id="8492378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492383">t</span><span class="op" id="8492384">.</span><span class="ident" id="8492385">Errorf</span><span class="op" id="8492391">(</span><span class="string" id="8492392">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8492428">,</span>&nbsp;<span class="ident" id="8492430">testNum</span><span class="op" id="8492437">,</span>&nbsp;<span class="ident" id="8492439">err</span><span class="op" id="8492442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492450">}</span><br>
<span class="lineno">260</span><span class="op" id="8492452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8492455">type</span>&nbsp;<span class="ident" id="8492460">maliciousReader</span>&nbsp;<span class="keyword" id="8492476">struct</span>&nbsp;<span class="op" id="8492483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492486">t</span>&nbsp;<span class="op" id="8492488">*</span><span class="ident" id="8492489">testing</span><span class="op" id="8492496">.</span><span class="ident" id="8492497">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492500">n</span>&nbsp;<span class="builtintype" id="8492502">int</span><br>
<span class="lineno">265</span><span class="op" id="8492506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8492509">const</span>&nbsp;<span class="ident" id="8492515">maxReadThreshold</span>&nbsp;<span class="op" id="8492532">=</span>&nbsp;<span class="num" id="8492534">1</span>&nbsp;<span class="op" id="8492536">&lt;&lt;</span>&nbsp;<span class="num" id="8492539">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8492543">func</span>&nbsp;<span class="op" id="8492548">(</span><span class="ident" id="8492549">mr</span>&nbsp;<span class="op" id="8492552">*</span><span class="ident" id="8492553">maliciousReader</span><span class="op" id="8492568">)</span>&nbsp;<span class="ident" id="8492570">Read</span><span class="op" id="8492574">(</span><span class="ident" id="8492575">b</span>&nbsp;<span class="op" id="8492577">[</span><span class="op" id="8492578">]</span><span class="builtintype" id="8492579">byte</span><span class="op" id="8492583">)</span>&nbsp;<span class="op" id="8492585">(</span><span class="ident" id="8492586">n</span>&nbsp;<span class="builtintype" id="8492588">int</span><span class="op" id="8492591">,</span>&nbsp;<span class="ident" id="8492593">err</span>&nbsp;<span class="builtintype" id="8492597">error</span><span class="op" id="8492602">)</span>&nbsp;<span class="op" id="8492604">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492607">mr</span><span class="op" id="8492609">.</span><span class="ident" id="8492610">n</span>&nbsp;<span class="op" id="8492612">+=</span>&nbsp;<span class="builtinfunc" id="8492615">len</span><span class="op" id="8492618">(</span><span class="ident" id="8492619">b</span><span class="op" id="8492620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492623">if</span>&nbsp;<span class="ident" id="8492626">mr</span><span class="op" id="8492628">.</span><span class="ident" id="8492629">n</span>&nbsp;<span class="op" id="8492631">&gt;=</span>&nbsp;<span class="ident" id="8492634">maxReadThreshold</span>&nbsp;<span class="op" id="8492651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492655">mr</span><span class="op" id="8492657">.</span><span class="ident" id="8492658">t</span><span class="op" id="8492659">.</span><span class="ident" id="8492660">Fatal</span><span class="op" id="8492665">(</span><span class="string" id="8492666">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="8492685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492689">return</span>&nbsp;<span class="num" id="8492696">0</span><span class="op" id="8492697">,</span>&nbsp;<span class="ident" id="8492699">io</span><span class="op" id="8492701">.</span><span class="ident" id="8492702">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492707">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492710">return</span>&nbsp;<span class="builtinfunc" id="8492717">len</span><span class="op" id="8492720">(</span><span class="ident" id="8492721">b</span><span class="op" id="8492722">)</span><span class="op" id="8492723">,</span>&nbsp;<span class="builtintype" id="8492725">nil</span><br>
<span class="lineno"></span><span class="op" id="8492729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8492732">func</span>&nbsp;<span class="ident" id="8492737">TestLineLimit</span><span class="op" id="8492750">(</span><span class="ident" id="8492751">t</span>&nbsp;<span class="op" id="8492753">*</span><span class="ident" id="8492754">testing</span><span class="op" id="8492761">.</span><span class="ident" id="8492762">T</span><span class="op" id="8492763">)</span>&nbsp;<span class="op" id="8492765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492768">mr</span>&nbsp;<span class="op" id="8492771">:=</span>&nbsp;<span class="op" id="8492774">&amp;</span><span class="ident" id="8492775">maliciousReader</span><span class="op" id="8492790">{</span><span class="ident" id="8492791">t</span><span class="op" id="8492792">:</span>&nbsp;<span class="ident" id="8492794">t</span><span class="op" id="8492795">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492798">r</span>&nbsp;<span class="op" id="8492800">:=</span>&nbsp;<span class="ident" id="8492803">NewReader</span><span class="op" id="8492812">(</span><span class="ident" id="8492813">mr</span><span class="op" id="8492815">,</span>&nbsp;<span class="string" id="8492817">&#34;fooBoundary&#34;</span><span class="op" id="8492830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492833">part</span><span class="op" id="8492837">,</span>&nbsp;<span class="ident" id="8492839">err</span>&nbsp;<span class="op" id="8492843">:=</span>&nbsp;<span class="ident" id="8492846">r</span><span class="op" id="8492847">.</span><span class="ident" id="8492848">NextPart</span><span class="op" id="8492856">(</span><span class="op" id="8492857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492860">if</span>&nbsp;<span class="ident" id="8492863">part</span>&nbsp;<span class="op" id="8492868">!=</span>&nbsp;<span class="builtintype" id="8492871">nil</span>&nbsp;<span class="op" id="8492875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492879">t</span><span class="op" id="8492880">.</span><span class="ident" id="8492881">Errorf</span><span class="op" id="8492887">(</span><span class="string" id="8492888">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="8492910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492913">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492916">if</span>&nbsp;<span class="ident" id="8492919">err</span>&nbsp;<span class="op" id="8492923">==</span>&nbsp;<span class="builtintype" id="8492926">nil</span>&nbsp;<span class="op" id="8492930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8492934">t</span><span class="op" id="8492935">.</span><span class="ident" id="8492936">Errorf</span><span class="op" id="8492942">(</span><span class="string" id="8492943">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="8492962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8492965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8492968">if</span>&nbsp;<span class="ident" id="8492971">mr</span><span class="op" id="8492973">.</span><span class="ident" id="8492974">n</span>&nbsp;<span class="op" id="8492976">&gt;=</span>&nbsp;<span class="ident" id="8492979">maxReadThreshold</span>&nbsp;<span class="op" id="8492996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493000">t</span><span class="op" id="8493001">.</span><span class="ident" id="8493002">Errorf</span><span class="op" id="8493008">(</span><span class="string" id="8493009">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8493047">,</span>&nbsp;<span class="ident" id="8493049">maxReadThreshold</span><span class="op" id="8493065">,</span>&nbsp;<span class="ident" id="8493067">mr</span><span class="op" id="8493069">.</span><span class="ident" id="8493070">n</span><span class="op" id="8493071">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8493074">}</span><br>
<span class="lineno"></span><span class="op" id="8493076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8493079">func</span>&nbsp;<span class="ident" id="8493084">TestMultipartTruncated</span><span class="op" id="8493106">(</span><span class="ident" id="8493107">t</span>&nbsp;<span class="op" id="8493109">*</span><span class="ident" id="8493110">testing</span><span class="op" id="8493117">.</span><span class="ident" id="8493118">T</span><span class="op" id="8493119">)</span>&nbsp;<span class="op" id="8493121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493124">testBody</span>&nbsp;<span class="op" id="8493133">:=</span>&nbsp;<span class="string" id="8493136">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493243">body</span>&nbsp;<span class="op" id="8493248">:=</span>&nbsp;<span class="ident" id="8493251">strings</span><span class="op" id="8493258">.</span><span class="ident" id="8493259">Replace</span><span class="op" id="8493266">(</span><span class="ident" id="8493267">testBody</span><span class="op" id="8493275">,</span>&nbsp;<span class="string" id="8493277">&#34;\n&#34;</span><span class="op" id="8493281">,</span>&nbsp;<span class="string" id="8493283">&#34;\r\n&#34;</span><span class="op" id="8493289">,</span>&nbsp;<span class="op" id="8493291">-</span><span class="num" id="8493292">1</span><span class="op" id="8493293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493296">bodyReader</span>&nbsp;<span class="op" id="8493307">:=</span>&nbsp;<span class="ident" id="8493310">strings</span><span class="op" id="8493317">.</span><span class="ident" id="8493318">NewReader</span><span class="op" id="8493327">(</span><span class="ident" id="8493328">body</span><span class="op" id="8493332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493335">r</span>&nbsp;<span class="op" id="8493337">:=</span>&nbsp;<span class="ident" id="8493340">NewReader</span><span class="op" id="8493349">(</span><span class="ident" id="8493350">bodyReader</span><span class="op" id="8493360">,</span>&nbsp;<span class="string" id="8493362">&#34;MyBoundary&#34;</span><span class="op" id="8493374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493378">part</span><span class="op" id="8493382">,</span>&nbsp;<span class="ident" id="8493384">err</span>&nbsp;<span class="op" id="8493388">:=</span>&nbsp;<span class="ident" id="8493391">r</span><span class="op" id="8493392">.</span><span class="ident" id="8493393">NextPart</span><span class="op" id="8493401">(</span><span class="op" id="8493402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8493405">if</span>&nbsp;<span class="ident" id="8493408">err</span>&nbsp;<span class="op" id="8493412">!=</span>&nbsp;<span class="builtintype" id="8493415">nil</span>&nbsp;<span class="op" id="8493419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493423">t</span><span class="op" id="8493424">.</span><span class="ident" id="8493425">Fatalf</span><span class="op" id="8493431">(</span><span class="string" id="8493432">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8493451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8493454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493457">_</span><span class="op" id="8493458">,</span>&nbsp;<span class="ident" id="8493460">err</span>&nbsp;<span class="op" id="8493464">=</span>&nbsp;<span class="ident" id="8493466">io</span><span class="op" id="8493468">.</span><span class="ident" id="8493469">Copy</span><span class="op" id="8493473">(</span><span class="ident" id="8493474">ioutil</span><span class="op" id="8493480">.</span><span class="ident" id="8493481">Discard</span><span class="op" id="8493488">,</span>&nbsp;<span class="ident" id="8493490">part</span><span class="op" id="8493494">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8493497">if</span>&nbsp;<span class="ident" id="8493500">err</span>&nbsp;<span class="op" id="8493504">!=</span>&nbsp;<span class="ident" id="8493507">io</span><span class="op" id="8493509">.</span><span class="ident" id="8493510">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8493527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493531">t</span><span class="op" id="8493532">.</span><span class="ident" id="8493533">Fatalf</span><span class="op" id="8493539">(</span><span class="string" id="8493540">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8493584">,</span>&nbsp;<span class="ident" id="8493586">err</span><span class="op" id="8493589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8493592">}</span><br>
<span class="lineno"></span><span class="op" id="8493594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8493597">type</span>&nbsp;<span class="ident" id="8493602">slowReader</span>&nbsp;<span class="keyword" id="8493613">struct</span>&nbsp;<span class="op" id="8493620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8493623">r</span>&nbsp;<span class="ident" id="8493625">io</span><span class="op" id="8493627">.</span><span class="ident" id="8493628">Reader</span><br>
<span class="lineno"></span><span class="op" id="8493635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8493638">func</span>&nbsp;<span class="op" id="8493643">(</span><span class="ident" id="8493644">s</span>&nbsp;<span class="op" id="8493646">*</span><span class="ident" id="8493647">slowReader</span><span class="op" id="8493657">)</span>&nbsp;<span class="ident" id="8493659">Read</span><span class="op" id="8493663">(</span><span class="ident" id="8493664">p</span>&nbsp;<span class="op" id="8493666">[</span><span class="op" id="8493667">]</span><span class="builtintype" id="8493668">byte</span><span class="op" id="8493672">)</span>&nbsp;<span class="op" id="8493674">(</span><span class="builtintype" id="8493675">int</span><span class="op" id="8493678">,</span>&nbsp;<span class="builtintype" id="8493680">error</span><span class="op" id="8493685">)</span>&nbsp;<span class="op" id="8493687">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8493690">if</span>&nbsp;<span class="builtinfunc" id="8493693">len</span><span class="op" id="8493696">(</span><span class="ident" id="8493697">p</span><span class="op" id="8493698">)</span>&nbsp;<span class="op" id="8493700">==</span>&nbsp;<span class="num" id="8493703">0</span>&nbsp;<span class="op" id="8493705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8493709">return</span>&nbsp;<span class="ident" id="8493716">s</span><span class="op" id="8493717">.</span><span class="ident" id="8493718">r</span><span class="op" id="8493719">.</span><span class="ident" id="8493720">Read</span><span class="op" id="8493724">(</span><span class="ident" id="8493725">p</span><span class="op" id="8493726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8493729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8493732">return</span>&nbsp;<span class="ident" id="8493739">s</span><span class="op" id="8493740">.</span><span class="ident" id="8493741">r</span><span class="op" id="8493742">.</span><span class="ident" id="8493743">Read</span><span class="op" id="8493747">(</span><span class="ident" id="8493748">p</span><span class="op" id="8493749">[</span><span class="op" id="8493750">:</span><span class="num" id="8493751">1</span><span class="op" id="8493752">]</span><span class="op" id="8493753">)</span><br>
<span class="lineno"></span><span class="op" id="8493755">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="8493758">func</span>&nbsp;<span class="ident" id="8493763">TestLineContinuation</span><span class="op" id="8493783">(</span><span class="ident" id="8493784">t</span>&nbsp;<span class="op" id="8493786">*</span><span class="ident" id="8493787">testing</span><span class="op" id="8493794">.</span><span class="ident" id="8493795">T</span><span class="op" id="8493796">)</span>&nbsp;<span class="op" id="8493798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8493801">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8493877">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8493889">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8493956">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8494017">testBody</span>&nbsp;<span class="op" id="8494026">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8494031">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8494527">r</span>&nbsp;<span class="op" id="8494529">:=</span>&nbsp;<span class="ident" id="8494532">NewReader</span><span class="op" id="8494541">(</span><span class="ident" id="8494542">strings</span><span class="op" id="8494549">.</span><span class="ident" id="8494550">NewReader</span><span class="op" id="8494559">(</span><span class="ident" id="8494560">testBody</span><span class="op" id="8494568">)</span><span class="op" id="8494569">,</span>&nbsp;<span class="string" id="8494571">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="8494595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8494599">for</span>&nbsp;<span class="ident" id="8494603">i</span>&nbsp;<span class="op" id="8494605">:=</span>&nbsp;<span class="num" id="8494608">0</span><span class="op" id="8494609">;</span>&nbsp;<span class="ident" id="8494611">i</span>&nbsp;<span class="op" id="8494613">&lt;</span>&nbsp;<span class="num" id="8494615">2</span><span class="op" id="8494616">;</span>&nbsp;<span class="ident" id="8494618">i</span><span class="op" id="8494619">++</span>&nbsp;<span class="op" id="8494622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8494626">part</span><span class="op" id="8494630">,</span>&nbsp;<span class="ident" id="8494632">err</span>&nbsp;<span class="op" id="8494636">:=</span>&nbsp;<span class="ident" id="8494639">r</span><span class="op" id="8494640">.</span><span class="ident" id="8494641">NextPart</span><span class="op" id="8494649">(</span><span class="op" id="8494650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8494654">if</span>&nbsp;<span class="ident" id="8494657">err</span>&nbsp;<span class="op" id="8494661">!=</span>&nbsp;<span class="builtintype" id="8494664">nil</span>&nbsp;<span class="op" id="8494668">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8494673">t</span><span class="op" id="8494674">.</span><span class="ident" id="8494675">Fatalf</span><span class="op" id="8494681">(</span><span class="string" id="8494682">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8494701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8494705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8494709">var</span>&nbsp;<span class="ident" id="8494713">buf</span>&nbsp;<span class="ident" id="8494717">bytes</span><span class="op" id="8494722">.</span><span class="ident" id="8494723">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8494732">n</span><span class="op" id="8494733">,</span>&nbsp;<span class="ident" id="8494735">err</span>&nbsp;<span class="op" id="8494739">:=</span>&nbsp;<span class="ident" id="8494742">io</span><span class="op" id="8494744">.</span><span class="ident" id="8494745">Copy</span><span class="op" id="8494749">(</span><span class="op" id="8494750">&amp;</span><span class="ident" id="8494751">buf</span><span class="op" id="8494754">,</span>&nbsp;<span class="ident" id="8494756">part</span><span class="op" id="8494760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8494764">if</span>&nbsp;<span class="ident" id="8494767">err</span>&nbsp;<span class="op" id="8494771">!=</span>&nbsp;<span class="builtintype" id="8494774">nil</span>&nbsp;<span class="op" id="8494778">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8494783">t</span><span class="op" id="8494784">.</span><span class="ident" id="8494785">Errorf</span><span class="op" id="8494791">(</span><span class="string" id="8494792">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="8494833">,</span>&nbsp;<span class="ident" id="8494835">err</span><span class="op" id="8494838">,</span>&nbsp;<span class="ident" id="8494840">buf</span><span class="op" id="8494843">.</span><span class="ident" id="8494844">String</span><span class="op" id="8494850">(</span><span class="op" id="8494851">)</span><span class="op" id="8494852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8494856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8494860">if</span>&nbsp;<span class="ident" id="8494863">n</span>&nbsp;<span class="op" id="8494865">&lt;=</span>&nbsp;<span class="num" id="8494868">0</span>&nbsp;<span class="op" id="8494870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8494875">t</span><span class="op" id="8494876">.</span><span class="ident" id="8494877">Errorf</span><span class="op" id="8494883">(</span><span class="string" id="8494884">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="8494912">,</span>&nbsp;<span class="ident" id="8494914">n</span><span class="op" id="8494915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8494919">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8494922">}</span><br>
<span class="lineno"></span><span class="op" id="8494924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8494927">func</span>&nbsp;<span class="ident" id="8494932">TestQuotedPrintableEncoding</span><span class="op" id="8494959">(</span><span class="ident" id="8494960">t</span>&nbsp;<span class="op" id="8494962">*</span><span class="ident" id="8494963">testing</span><span class="op" id="8494970">.</span><span class="ident" id="8494971">T</span><span class="op" id="8494972">)</span>&nbsp;<span class="op" id="8494974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8494977">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8495015">body</span>&nbsp;<span class="op" id="8495020">:=</span>&nbsp;<span class="string" id="8495023">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8495757">r</span>&nbsp;<span class="op" id="8495759">:=</span>&nbsp;<span class="ident" id="8495762">NewReader</span><span class="op" id="8495771">(</span><span class="ident" id="8495772">strings</span><span class="op" id="8495779">.</span><span class="ident" id="8495780">NewReader</span><span class="op" id="8495789">(</span><span class="ident" id="8495790">body</span><span class="op" id="8495794">)</span><span class="op" id="8495795">,</span>&nbsp;<span class="string" id="8495797">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="8495827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8495830">part</span><span class="op" id="8495834">,</span>&nbsp;<span class="ident" id="8495836">err</span>&nbsp;<span class="op" id="8495840">:=</span>&nbsp;<span class="ident" id="8495843">r</span><span class="op" id="8495844">.</span><span class="ident" id="8495845">NextPart</span><span class="op" id="8495853">(</span><span class="op" id="8495854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8495857">if</span>&nbsp;<span class="ident" id="8495860">err</span>&nbsp;<span class="op" id="8495864">!=</span>&nbsp;<span class="builtintype" id="8495867">nil</span>&nbsp;<span class="op" id="8495871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8495875">t</span><span class="op" id="8495876">.</span><span class="ident" id="8495877">Fatal</span><span class="op" id="8495882">(</span><span class="ident" id="8495883">err</span><span class="op" id="8495886">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8495889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8495892">if</span>&nbsp;<span class="ident" id="8495895">te</span><span class="op" id="8495897">,</span>&nbsp;<span class="ident" id="8495899">ok</span>&nbsp;<span class="op" id="8495902">:=</span>&nbsp;<span class="ident" id="8495905">part</span><span class="op" id="8495909">.</span><span class="ident" id="8495910">Header</span><span class="op" id="8495916">[</span><span class="string" id="8495917">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="8495944">]</span><span class="op" id="8495945">;</span>&nbsp;<span class="ident" id="8495947">ok</span>&nbsp;<span class="op" id="8495950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8495954">t</span><span class="op" id="8495955">.</span><span class="ident" id="8495956">Errorf</span><span class="op" id="8495962">(</span><span class="string" id="8495963">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="8496007">,</span>&nbsp;<span class="ident" id="8496009">te</span><span class="op" id="8496011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8496014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8496017">var</span>&nbsp;<span class="ident" id="8496021">buf</span>&nbsp;<span class="ident" id="8496025">bytes</span><span class="op" id="8496030">.</span><span class="ident" id="8496031">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496039">_</span><span class="op" id="8496040">,</span>&nbsp;<span class="ident" id="8496042">err</span>&nbsp;<span class="op" id="8496046">=</span>&nbsp;<span class="ident" id="8496048">io</span><span class="op" id="8496050">.</span><span class="ident" id="8496051">Copy</span><span class="op" id="8496055">(</span><span class="op" id="8496056">&amp;</span><span class="ident" id="8496057">buf</span><span class="op" id="8496060">,</span>&nbsp;<span class="ident" id="8496062">part</span><span class="op" id="8496066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8496069">if</span>&nbsp;<span class="ident" id="8496072">err</span>&nbsp;<span class="op" id="8496076">!=</span>&nbsp;<span class="builtintype" id="8496079">nil</span>&nbsp;<span class="op" id="8496083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496087">t</span><span class="op" id="8496088">.</span><span class="ident" id="8496089">Error</span><span class="op" id="8496094">(</span><span class="ident" id="8496095">err</span><span class="op" id="8496098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8496101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496104">got</span>&nbsp;<span class="op" id="8496108">:=</span>&nbsp;<span class="ident" id="8496111">buf</span><span class="op" id="8496114">.</span><span class="ident" id="8496115">String</span><span class="op" id="8496121">(</span><span class="op" id="8496122">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496125">want</span>&nbsp;<span class="op" id="8496130">:=</span>&nbsp;<span class="string" id="8496133">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8496490">if</span>&nbsp;<span class="ident" id="8496493">got</span>&nbsp;<span class="op" id="8496497">!=</span>&nbsp;<span class="ident" id="8496500">want</span>&nbsp;<span class="op" id="8496505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496509">t</span><span class="op" id="8496510">.</span><span class="ident" id="8496511">Errorf</span><span class="op" id="8496517">(</span><span class="string" id="8496518">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="8496557">,</span>&nbsp;<span class="ident" id="8496559">got</span><span class="op" id="8496562">,</span>&nbsp;<span class="ident" id="8496564">want</span><span class="op" id="8496568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8496571">}</span><br>
<span class="lineno"></span><span class="op" id="8496573">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="8496576">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="8496649">func</span>&nbsp;<span class="ident" id="8496654">TestNested</span><span class="op" id="8496664">(</span><span class="ident" id="8496665">t</span>&nbsp;<span class="op" id="8496667">*</span><span class="ident" id="8496668">testing</span><span class="op" id="8496675">.</span><span class="ident" id="8496676">T</span><span class="op" id="8496677">)</span>&nbsp;<span class="op" id="8496679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8496682">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8496742">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496789">f</span><span class="op" id="8496790">,</span>&nbsp;<span class="ident" id="8496792">err</span>&nbsp;<span class="op" id="8496796">:=</span>&nbsp;<span class="ident" id="8496799">os</span><span class="op" id="8496801">.</span><span class="ident" id="8496802">Open</span><span class="op" id="8496806">(</span><span class="string" id="8496807">&#34;testdata/nested-mime&#34;</span><span class="op" id="8496829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8496832">if</span>&nbsp;<span class="ident" id="8496835">err</span>&nbsp;<span class="op" id="8496839">!=</span>&nbsp;<span class="builtintype" id="8496842">nil</span>&nbsp;<span class="op" id="8496846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496850">t</span><span class="op" id="8496851">.</span><span class="ident" id="8496852">Fatal</span><span class="op" id="8496857">(</span><span class="ident" id="8496858">err</span><span class="op" id="8496861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8496864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8496867">defer</span>&nbsp;<span class="ident" id="8496873">f</span><span class="op" id="8496874">.</span><span class="ident" id="8496875">Close</span><span class="op" id="8496880">(</span><span class="op" id="8496881">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496884">mr</span>&nbsp;<span class="op" id="8496887">:=</span>&nbsp;<span class="ident" id="8496890">NewReader</span><span class="op" id="8496899">(</span><span class="ident" id="8496900">f</span><span class="op" id="8496901">,</span>&nbsp;<span class="string" id="8496903">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="8496933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496936">p</span><span class="op" id="8496937">,</span>&nbsp;<span class="ident" id="8496939">err</span>&nbsp;<span class="op" id="8496943">:=</span>&nbsp;<span class="ident" id="8496946">mr</span><span class="op" id="8496948">.</span><span class="ident" id="8496949">NextPart</span><span class="op" id="8496957">(</span><span class="op" id="8496958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8496961">if</span>&nbsp;<span class="ident" id="8496964">err</span>&nbsp;<span class="op" id="8496968">!=</span>&nbsp;<span class="builtintype" id="8496971">nil</span>&nbsp;<span class="op" id="8496975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8496979">t</span><span class="op" id="8496980">.</span><span class="ident" id="8496981">Fatalf</span><span class="op" id="8496987">(</span><span class="string" id="8496988">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="8497035">,</span>&nbsp;<span class="ident" id="8497037">err</span><span class="op" id="8497040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8497043">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8497047">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497130">mr2</span>&nbsp;<span class="op" id="8497134">:=</span>&nbsp;<span class="ident" id="8497137">NewReader</span><span class="op" id="8497146">(</span><span class="ident" id="8497147">p</span><span class="op" id="8497148">,</span>&nbsp;<span class="string" id="8497150">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="8497180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497183">p</span><span class="op" id="8497184">,</span>&nbsp;<span class="ident" id="8497186">err</span>&nbsp;<span class="op" id="8497190">=</span>&nbsp;<span class="ident" id="8497192">mr2</span><span class="op" id="8497195">.</span><span class="ident" id="8497196">NextPart</span><span class="op" id="8497204">(</span><span class="op" id="8497205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8497208">if</span>&nbsp;<span class="ident" id="8497211">err</span>&nbsp;<span class="op" id="8497215">!=</span>&nbsp;<span class="builtintype" id="8497218">nil</span>&nbsp;<span class="op" id="8497222">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497226">t</span><span class="op" id="8497227">.</span><span class="ident" id="8497228">Fatalf</span><span class="op" id="8497234">(</span><span class="string" id="8497235">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8497264">,</span>&nbsp;<span class="ident" id="8497266">err</span><span class="op" id="8497269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8497272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8497275">if</span>&nbsp;<span class="ident" id="8497278">b</span><span class="op" id="8497279">,</span>&nbsp;<span class="ident" id="8497281">err</span>&nbsp;<span class="op" id="8497285">:=</span>&nbsp;<span class="ident" id="8497288">ioutil</span><span class="op" id="8497294">.</span><span class="ident" id="8497295">ReadAll</span><span class="op" id="8497302">(</span><span class="ident" id="8497303">p</span><span class="op" id="8497304">)</span><span class="op" id="8497305">;</span>&nbsp;<span class="builtintype" id="8497307">string</span><span class="op" id="8497313">(</span><span class="ident" id="8497314">b</span><span class="op" id="8497315">)</span>&nbsp;<span class="op" id="8497317">!=</span>&nbsp;<span class="string" id="8497320">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="8497333">||</span>&nbsp;<span class="ident" id="8497336">err</span>&nbsp;<span class="op" id="8497340">!=</span>&nbsp;<span class="builtintype" id="8497343">nil</span>&nbsp;<span class="op" id="8497347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497351">t</span><span class="op" id="8497352">.</span><span class="ident" id="8497353">Fatalf</span><span class="op" id="8497359">(</span><span class="string" id="8497360">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8497397">,</span>&nbsp;<span class="ident" id="8497399">b</span><span class="op" id="8497400">,</span>&nbsp;<span class="ident" id="8497402">err</span><span class="op" id="8497405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8497408">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497411">p</span><span class="op" id="8497412">,</span>&nbsp;<span class="ident" id="8497414">err</span>&nbsp;<span class="op" id="8497418">=</span>&nbsp;<span class="ident" id="8497420">mr2</span><span class="op" id="8497423">.</span><span class="ident" id="8497424">NextPart</span><span class="op" id="8497432">(</span><span class="op" id="8497433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8497436">if</span>&nbsp;<span class="ident" id="8497439">err</span>&nbsp;<span class="op" id="8497443">!=</span>&nbsp;<span class="builtintype" id="8497446">nil</span>&nbsp;<span class="op" id="8497450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497454">t</span><span class="op" id="8497455">.</span><span class="ident" id="8497456">Fatalf</span><span class="op" id="8497462">(</span><span class="string" id="8497463">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8497491">,</span>&nbsp;<span class="ident" id="8497493">err</span><span class="op" id="8497496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8497499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8497502">if</span>&nbsp;<span class="ident" id="8497505">b</span><span class="op" id="8497506">,</span>&nbsp;<span class="ident" id="8497508">err</span>&nbsp;<span class="op" id="8497512">:=</span>&nbsp;<span class="ident" id="8497515">ioutil</span><span class="op" id="8497521">.</span><span class="ident" id="8497522">ReadAll</span><span class="op" id="8497529">(</span><span class="ident" id="8497530">p</span><span class="op" id="8497531">)</span><span class="op" id="8497532">;</span>&nbsp;<span class="builtintype" id="8497534">string</span><span class="op" id="8497540">(</span><span class="ident" id="8497541">b</span><span class="op" id="8497542">)</span>&nbsp;<span class="op" id="8497544">!=</span>&nbsp;<span class="string" id="8497547">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="8497565">||</span>&nbsp;<span class="ident" id="8497568">err</span>&nbsp;<span class="op" id="8497572">!=</span>&nbsp;<span class="builtintype" id="8497575">nil</span>&nbsp;<span class="op" id="8497579">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497583">t</span><span class="op" id="8497584">.</span><span class="ident" id="8497585">Fatalf</span><span class="op" id="8497591">(</span><span class="string" id="8497592">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8497628">,</span>&nbsp;<span class="ident" id="8497630">b</span><span class="op" id="8497631">,</span>&nbsp;<span class="ident" id="8497633">err</span><span class="op" id="8497636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8497639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497643">p</span><span class="op" id="8497644">,</span>&nbsp;<span class="ident" id="8497646">err</span>&nbsp;<span class="op" id="8497650">=</span>&nbsp;<span class="ident" id="8497652">mr2</span><span class="op" id="8497655">.</span><span class="ident" id="8497656">NextPart</span><span class="op" id="8497664">(</span><span class="op" id="8497665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8497668">if</span>&nbsp;<span class="ident" id="8497671">err</span>&nbsp;<span class="op" id="8497675">!=</span>&nbsp;<span class="ident" id="8497678">io</span><span class="op" id="8497680">.</span><span class="ident" id="8497681">EOF</span>&nbsp;<span class="op" id="8497685">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497689">t</span><span class="op" id="8497690">.</span><span class="ident" id="8497691">Fatalf</span><span class="op" id="8497697">(</span><span class="string" id="8497698">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8497738">,</span>&nbsp;<span class="ident" id="8497740">err</span><span class="op" id="8497743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8497746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8497750">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497819">_</span><span class="op" id="8497820">,</span>&nbsp;<span class="ident" id="8497822">err</span>&nbsp;<span class="op" id="8497826">=</span>&nbsp;<span class="ident" id="8497828">mr</span><span class="op" id="8497830">.</span><span class="ident" id="8497831">NextPart</span><span class="op" id="8497839">(</span><span class="op" id="8497840">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8497843">if</span>&nbsp;<span class="ident" id="8497846">err</span>&nbsp;<span class="op" id="8497850">!=</span>&nbsp;<span class="builtintype" id="8497853">nil</span>&nbsp;<span class="op" id="8497857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497861">t</span><span class="op" id="8497862">.</span><span class="ident" id="8497863">Fatalf</span><span class="op" id="8497869">(</span><span class="string" id="8497870">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="8497921">,</span>&nbsp;<span class="ident" id="8497923">err</span><span class="op" id="8497926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8497929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497933">_</span><span class="op" id="8497934">,</span>&nbsp;<span class="ident" id="8497936">err</span>&nbsp;<span class="op" id="8497940">=</span>&nbsp;<span class="ident" id="8497942">mr</span><span class="op" id="8497944">.</span><span class="ident" id="8497945">NextPart</span><span class="op" id="8497953">(</span><span class="op" id="8497954">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8497957">if</span>&nbsp;<span class="ident" id="8497960">err</span>&nbsp;<span class="op" id="8497964">!=</span>&nbsp;<span class="ident" id="8497967">io</span><span class="op" id="8497969">.</span><span class="ident" id="8497970">EOF</span>&nbsp;<span class="op" id="8497974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8497978">t</span><span class="op" id="8497979">.</span><span class="ident" id="8497980">Fatalf</span><span class="op" id="8497986">(</span><span class="string" id="8497987">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8498027">,</span>&nbsp;<span class="ident" id="8498029">err</span><span class="op" id="8498032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8498035">}</span><br>
<span class="lineno"></span><span class="op" id="8498037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="8498040">type</span>&nbsp;<span class="ident" id="8498045">headerBody</span>&nbsp;<span class="keyword" id="8498056">struct</span>&nbsp;<span class="op" id="8498063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498066">header</span>&nbsp;<span class="ident" id="8498073">textproto</span><span class="op" id="8498082">.</span><span class="ident" id="8498083">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498095">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8498102">string</span><br>
<span class="lineno"></span><span class="op" id="8498109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8498112">func</span>&nbsp;<span class="ident" id="8498117">formData</span><span class="op" id="8498125">(</span><span class="ident" id="8498126">key</span><span class="op" id="8498129">,</span>&nbsp;<span class="ident" id="8498131">value</span>&nbsp;<span class="builtintype" id="8498137">string</span><span class="op" id="8498143">)</span>&nbsp;<span class="ident" id="8498145">headerBody</span>&nbsp;<span class="op" id="8498156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8498159">return</span>&nbsp;<span class="ident" id="8498166">headerBody</span><span class="op" id="8498176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498180">textproto</span><span class="op" id="8498189">.</span><span class="ident" id="8498190">MIMEHeader</span><span class="op" id="8498200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8498205">&#34;Content-Type&#34;</span><span class="op" id="8498219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8498228">{</span><span class="string" id="8498229">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="8498261">}</span><span class="op" id="8498262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8498267">&#34;Content-Disposition&#34;</span><span class="op" id="8498288">:</span>&nbsp;<span class="op" id="8498290">{</span><span class="string" id="8498291">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="8498310">+</span>&nbsp;<span class="ident" id="8498312">key</span><span class="op" id="8498315">}</span><span class="op" id="8498316">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8498320">}</span><span class="op" id="8498321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498325">value</span><span class="op" id="8498330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8498333">}</span><br>
<span class="lineno"></span><span class="op" id="8498335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="8498338">type</span>&nbsp;<span class="ident" id="8498343">parseTest</span>&nbsp;<span class="keyword" id="8498353">struct</span>&nbsp;<span class="op" id="8498360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498363">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8498371">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498379">in</span><span class="op" id="8498381">,</span>&nbsp;<span class="ident" id="8498383">sep</span>&nbsp;<span class="builtintype" id="8498387">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498395">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8498403">[</span><span class="op" id="8498404">]</span><span class="ident" id="8498405">headerBody</span><br>
<span class="lineno"></span><span class="op" id="8498416">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8498419">var</span>&nbsp;<span class="ident" id="8498423">parseTests</span>&nbsp;<span class="op" id="8498434">=</span>&nbsp;<span class="op" id="8498436">[</span><span class="op" id="8498437">]</span><span class="ident" id="8498438">parseTest</span><span class="op" id="8498447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8498450">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8498520">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8498589">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8498655">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8498718">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8498784">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8498847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498851">name</span><span class="op" id="8498855">:</span>&nbsp;<span class="string" id="8498857">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="8498874">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498878">sep</span><span class="op" id="8498881">:</span>&nbsp;&nbsp;<span class="string" id="8498884">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="8498914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8498918">in</span><span class="op" id="8498920">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8498924">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="8500832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8500836">want</span><span class="op" id="8500840">:</span>&nbsp;<span class="op" id="8500842">[</span><span class="op" id="8500843">]</span><span class="ident" id="8500844">headerBody</span><span class="op" id="8500854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8500859">formData</span><span class="op" id="8500867">(</span><span class="string" id="8500868">&#34;otherEmpty1&#34;</span><span class="op" id="8500881">,</span>&nbsp;<span class="string" id="8500883">&#34;&#34;</span><span class="op" id="8500885">)</span><span class="op" id="8500886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8500891">formData</span><span class="op" id="8500899">(</span><span class="string" id="8500900">&#34;otherFoo1&#34;</span><span class="op" id="8500911">,</span>&nbsp;<span class="string" id="8500913">&#34;foo&#34;</span><span class="op" id="8500918">)</span><span class="op" id="8500919">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8500924">formData</span><span class="op" id="8500932">(</span><span class="string" id="8500933">&#34;otherFoo2&#34;</span><span class="op" id="8500944">,</span>&nbsp;<span class="string" id="8500946">&#34;foo&#34;</span><span class="op" id="8500951">)</span><span class="op" id="8500952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8500957">formData</span><span class="op" id="8500965">(</span><span class="string" id="8500966">&#34;otherEmpty2&#34;</span><span class="op" id="8500979">,</span>&nbsp;<span class="string" id="8500981">&#34;&#34;</span><span class="op" id="8500983">)</span><span class="op" id="8500984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8500989">formData</span><span class="op" id="8500997">(</span><span class="string" id="8500998">&#34;otherRepeatFoo&#34;</span><span class="op" id="8501014">,</span>&nbsp;<span class="string" id="8501016">&#34;foo&#34;</span><span class="op" id="8501021">)</span><span class="op" id="8501022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501027">formData</span><span class="op" id="8501035">(</span><span class="string" id="8501036">&#34;otherRepeatFoo&#34;</span><span class="op" id="8501052">,</span>&nbsp;<span class="string" id="8501054">&#34;foo&#34;</span><span class="op" id="8501059">)</span><span class="op" id="8501060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501065">formData</span><span class="op" id="8501073">(</span><span class="string" id="8501074">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8501092">,</span>&nbsp;<span class="string" id="8501094">&#34;&#34;</span><span class="op" id="8501096">)</span><span class="op" id="8501097">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501102">formData</span><span class="op" id="8501110">(</span><span class="string" id="8501111">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8501129">,</span>&nbsp;<span class="string" id="8501131">&#34;&#34;</span><span class="op" id="8501133">)</span><span class="op" id="8501134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501139">formData</span><span class="op" id="8501147">(</span><span class="string" id="8501148">&#34;submit&#34;</span><span class="op" id="8501156">,</span>&nbsp;<span class="string" id="8501158">&#34;Submit&#34;</span><span class="op" id="8501166">)</span><span class="op" id="8501167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8501172">{</span><span class="ident" id="8501173">textproto</span><span class="op" id="8501182">.</span><span class="ident" id="8501183">MIMEHeader</span><span class="op" id="8501193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8501199">&#34;Content-Type&#34;</span><span class="op" id="8501213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8501222">{</span><span class="string" id="8501223">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="8501439">}</span><span class="op" id="8501440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8501446">&#34;Content-Disposition&#34;</span><span class="op" id="8501467">:</span>&nbsp;<span class="op" id="8501469">{</span><span class="string" id="8501470">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="8501515">}</span><span class="op" id="8501516">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8501521">}</span><span class="op" id="8501522">,</span>&nbsp;<span class="string" id="8501524">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="8501771">}</span><span class="op" id="8501772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8501776">}</span><span class="op" id="8501777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8501780">}</span><span class="op" id="8501781">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8501785">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8501857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501861">name</span><span class="op" id="8501865">:</span>&nbsp;<span class="string" id="8501867">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="8501898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501902">sep</span><span class="op" id="8501905">:</span>&nbsp;&nbsp;<span class="string" id="8501908">&#34;abc&#34;</span><span class="op" id="8501913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501917">in</span><span class="op" id="8501919">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8501923">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="8501957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8501961">want</span><span class="op" id="8501965">:</span>&nbsp;<span class="op" id="8501967">[</span><span class="op" id="8501968">]</span><span class="ident" id="8501969">headerBody</span><span class="op" id="8501979">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8501984">{</span><span class="ident" id="8501985">textproto</span><span class="op" id="8501994">.</span><span class="ident" id="8501995">MIMEHeader</span><span class="op" id="8502005">{</span><span class="string" id="8502006">&#34;Foo&#34;</span><span class="op" id="8502011">:</span>&nbsp;<span class="op" id="8502013">{</span><span class="string" id="8502014">&#34;bar&#34;</span><span class="op" id="8502019">}</span><span class="op" id="8502020">}</span><span class="op" id="8502021">,</span>&nbsp;<span class="string" id="8502023">&#34;&#34;</span><span class="op" id="8502025">}</span><span class="op" id="8502026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502030">}</span><span class="op" id="8502031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502034">}</span><span class="op" id="8502035">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8502039">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502119">name</span><span class="op" id="8502123">:</span>&nbsp;<span class="string" id="8502125">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="8502160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502164">sep</span><span class="op" id="8502167">:</span>&nbsp;&nbsp;<span class="string" id="8502170">&#34;abc&#34;</span><span class="op" id="8502175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502179">in</span><span class="op" id="8502181">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8502185">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="8502223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502227">want</span><span class="op" id="8502231">:</span>&nbsp;<span class="op" id="8502233">[</span><span class="op" id="8502234">]</span><span class="ident" id="8502235">headerBody</span><span class="op" id="8502245">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502250">{</span><span class="ident" id="8502251">textproto</span><span class="op" id="8502260">.</span><span class="ident" id="8502261">MIMEHeader</span><span class="op" id="8502271">{</span><span class="string" id="8502272">&#34;Foo&#34;</span><span class="op" id="8502277">:</span>&nbsp;<span class="op" id="8502279">{</span><span class="string" id="8502280">&#34;bar&#34;</span><span class="op" id="8502285">}</span><span class="op" id="8502286">}</span><span class="op" id="8502287">,</span>&nbsp;<span class="string" id="8502289">&#34;&#34;</span><span class="op" id="8502291">}</span><span class="op" id="8502292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502296">}</span><span class="op" id="8502297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502300">}</span><span class="op" id="8502301">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8502305">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502331">name</span><span class="op" id="8502335">:</span>&nbsp;<span class="string" id="8502337">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="8502355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502359">sep</span><span class="op" id="8502362">:</span>&nbsp;&nbsp;<span class="string" id="8502365">&#34;abc&#34;</span><span class="op" id="8502370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502374">in</span><span class="op" id="8502376">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8502380">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="8502441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502445">want</span><span class="op" id="8502449">:</span>&nbsp;<span class="op" id="8502451">[</span><span class="op" id="8502452">]</span><span class="ident" id="8502453">headerBody</span><span class="op" id="8502463">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502468">{</span><span class="ident" id="8502469">textproto</span><span class="op" id="8502478">.</span><span class="ident" id="8502479">MIMEHeader</span><span class="op" id="8502489">{</span><span class="string" id="8502490">&#34;Foo&#34;</span><span class="op" id="8502495">:</span>&nbsp;<span class="op" id="8502497">{</span><span class="string" id="8502498">&#34;bar&#34;</span><span class="op" id="8502503">}</span><span class="op" id="8502504">}</span><span class="op" id="8502505">,</span>&nbsp;<span class="string" id="8502507">&#34;&#34;</span><span class="op" id="8502509">}</span><span class="op" id="8502510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502515">{</span><span class="ident" id="8502516">textproto</span><span class="op" id="8502525">.</span><span class="ident" id="8502526">MIMEHeader</span><span class="op" id="8502536">{</span><span class="string" id="8502537">&#34;Foo2&#34;</span><span class="op" id="8502543">:</span>&nbsp;<span class="op" id="8502545">{</span><span class="string" id="8502546">&#34;bar2&#34;</span><span class="op" id="8502552">}</span><span class="op" id="8502553">}</span><span class="op" id="8502554">,</span>&nbsp;<span class="string" id="8502556">&#34;&#34;</span><span class="op" id="8502558">}</span><span class="op" id="8502559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502563">}</span><span class="op" id="8502564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502567">}</span><span class="op" id="8502568">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8502572">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502634">name</span><span class="op" id="8502638">:</span>&nbsp;<span class="string" id="8502640">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="8502668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502672">sep</span><span class="op" id="8502675">:</span>&nbsp;&nbsp;<span class="string" id="8502678">&#34;abc&#34;</span><span class="op" id="8502683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502687">in</span><span class="op" id="8502689">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8502693">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="8502731">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502735">want</span><span class="op" id="8502739">:</span>&nbsp;<span class="op" id="8502741">[</span><span class="op" id="8502742">]</span><span class="ident" id="8502743">headerBody</span><span class="op" id="8502753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502758">{</span><span class="ident" id="8502759">textproto</span><span class="op" id="8502768">.</span><span class="ident" id="8502769">MIMEHeader</span><span class="op" id="8502779">{</span><span class="string" id="8502780">&#34;Foo&#34;</span><span class="op" id="8502785">:</span>&nbsp;<span class="op" id="8502787">{</span><span class="string" id="8502788">&#34;bar&#34;</span><span class="op" id="8502793">}</span><span class="op" id="8502794">}</span><span class="op" id="8502795">,</span>&nbsp;<span class="string" id="8502797">&#34;&#34;</span><span class="op" id="8502799">}</span><span class="op" id="8502800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502804">}</span><span class="op" id="8502805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502808">}</span><span class="op" id="8502809">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8502813">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8502873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502877">name</span><span class="op" id="8502881">:</span>&nbsp;<span class="string" id="8502883">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="8502911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502915">sep</span><span class="op" id="8502918">:</span>&nbsp;&nbsp;<span class="string" id="8502921">&#34;abc&#34;</span><span class="op" id="8502926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502930">in</span><span class="op" id="8502932">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8502936">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="8502973">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8502977">want</span><span class="op" id="8502981">:</span>&nbsp;<span class="op" id="8502983">[</span><span class="op" id="8502984">]</span><span class="ident" id="8502985">headerBody</span><span class="op" id="8502995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503000">{</span><span class="ident" id="8503001">textproto</span><span class="op" id="8503010">.</span><span class="ident" id="8503011">MIMEHeader</span><span class="op" id="8503021">{</span><span class="string" id="8503022">&#34;Foo&#34;</span><span class="op" id="8503027">:</span>&nbsp;<span class="op" id="8503029">{</span><span class="string" id="8503030">&#34;bar&#34;</span><span class="op" id="8503035">}</span><span class="op" id="8503036">}</span><span class="op" id="8503037">,</span>&nbsp;<span class="string" id="8503039">&#34;&#34;</span><span class="op" id="8503041">}</span><span class="op" id="8503042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503046">}</span><span class="op" id="8503047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503050">}</span><span class="op" id="8503051">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8503055">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503108">name</span><span class="op" id="8503112">:</span>&nbsp;<span class="string" id="8503114">&#34;no&nbsp;parts&#34;</span><span class="op" id="8503124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503128">sep</span><span class="op" id="8503131">:</span>&nbsp;&nbsp;<span class="string" id="8503134">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="8503174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503178">in</span><span class="op" id="8503180">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8503184">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="8503232">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503236">want</span><span class="op" id="8503240">:</span>&nbsp;<span class="op" id="8503242">[</span><span class="op" id="8503243">]</span><span class="ident" id="8503244">headerBody</span><span class="op" id="8503254">{</span><span class="op" id="8503255">}</span><span class="op" id="8503256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503259">}</span><span class="op" id="8503260">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8503264">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503345">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503349">name</span><span class="op" id="8503353">:</span>&nbsp;<span class="string" id="8503355">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="8503379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503383">sep</span><span class="op" id="8503386">:</span>&nbsp;&nbsp;<span class="string" id="8503389">&#34;sep&#34;</span><span class="op" id="8503394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503398">in</span><span class="op" id="8503400">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8503404">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="8503451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503455">want</span><span class="op" id="8503459">:</span>&nbsp;<span class="op" id="8503461">[</span><span class="op" id="8503462">]</span><span class="ident" id="8503463">headerBody</span><span class="op" id="8503473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503478">{</span><span class="ident" id="8503479">textproto</span><span class="op" id="8503488">.</span><span class="ident" id="8503489">MIMEHeader</span><span class="op" id="8503499">{</span><span class="string" id="8503500">&#34;Foo&#34;</span><span class="op" id="8503505">:</span>&nbsp;<span class="op" id="8503507">{</span><span class="string" id="8503508">&#34;bar&#34;</span><span class="op" id="8503513">}</span><span class="op" id="8503514">}</span><span class="op" id="8503515">,</span>&nbsp;<span class="string" id="8503517">&#34;--sepFAKE&#34;</span><span class="op" id="8503528">}</span><span class="op" id="8503529">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503533">}</span><span class="op" id="8503534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503537">}</span><span class="op" id="8503538">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8503542">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503603">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503607">name</span><span class="op" id="8503611">:</span>&nbsp;<span class="string" id="8503613">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="8503639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503643">sep</span><span class="op" id="8503646">:</span>&nbsp;&nbsp;<span class="string" id="8503649">&#34;sep&#34;</span><span class="op" id="8503654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503658">in</span><span class="op" id="8503660">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8503664">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="8503707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503711">want</span><span class="op" id="8503715">:</span>&nbsp;<span class="op" id="8503717">[</span><span class="op" id="8503718">]</span><span class="ident" id="8503719">headerBody</span><span class="op" id="8503729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503734">{</span><span class="ident" id="8503735">textproto</span><span class="op" id="8503744">.</span><span class="ident" id="8503745">MIMEHeader</span><span class="op" id="8503755">{</span><span class="string" id="8503756">&#34;Foo&#34;</span><span class="op" id="8503761">:</span>&nbsp;<span class="op" id="8503763">{</span><span class="string" id="8503764">&#34;bar&#34;</span><span class="op" id="8503769">}</span><span class="op" id="8503770">}</span><span class="op" id="8503771">,</span>&nbsp;<span class="string" id="8503773">&#34;text&#34;</span><span class="op" id="8503779">}</span><span class="op" id="8503780">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503784">}</span><span class="op" id="8503785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503788">}</span><span class="op" id="8503789">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8503793">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8503824">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503828">name</span><span class="op" id="8503832">:</span>&nbsp;<span class="string" id="8503834">&#34;leading&nbsp;line&#34;</span><span class="op" id="8503848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503852">sep</span><span class="op" id="8503855">:</span>&nbsp;&nbsp;<span class="string" id="8503858">&#34;MyBoundary&#34;</span><span class="op" id="8503870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8503874">in</span><span class="op" id="8503876">:</span>&nbsp;<span class="ident" id="8503878">strings</span><span class="op" id="8503885">.</span><span class="ident" id="8503886">Replace</span><span class="op" id="8503893">(</span><span class="string" id="8503894">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="8503987">,</span>&nbsp;<span class="string" id="8503989">&#34;\n&#34;</span><span class="op" id="8503993">,</span>&nbsp;<span class="string" id="8503995">&#34;\r\n&#34;</span><span class="op" id="8504001">,</span>&nbsp;<span class="op" id="8504003">-</span><span class="num" id="8504004">1</span><span class="op" id="8504005">)</span><span class="op" id="8504006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504010">want</span><span class="op" id="8504014">:</span>&nbsp;<span class="op" id="8504016">[</span><span class="op" id="8504017">]</span><span class="ident" id="8504018">headerBody</span><span class="op" id="8504028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504033">{</span><span class="ident" id="8504034">textproto</span><span class="op" id="8504043">.</span><span class="ident" id="8504044">MIMEHeader</span><span class="op" id="8504054">{</span><span class="string" id="8504055">&#34;Foo&#34;</span><span class="op" id="8504060">:</span>&nbsp;<span class="op" id="8504062">{</span><span class="string" id="8504063">&#34;bar&#34;</span><span class="op" id="8504068">}</span><span class="op" id="8504069">}</span><span class="op" id="8504070">,</span>&nbsp;<span class="string" id="8504072">&#34;&#34;</span><span class="op" id="8504074">}</span><span class="op" id="8504075">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504079">}</span><span class="op" id="8504080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504083">}</span><span class="op" id="8504084">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504088">roundTripParseTest</span><span class="op" id="8504106">(</span><span class="op" id="8504107">)</span><span class="op" id="8504108">,</span><br>
<span class="lineno"></span><span class="op" id="8504110">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="8504113">func</span>&nbsp;<span class="ident" id="8504118">TestParse</span><span class="op" id="8504127">(</span><span class="ident" id="8504128">t</span>&nbsp;<span class="op" id="8504130">*</span><span class="ident" id="8504131">testing</span><span class="op" id="8504138">.</span><span class="ident" id="8504139">T</span><span class="op" id="8504140">)</span>&nbsp;<span class="op" id="8504142">{</span><br>
<span class="lineno"></span><span class="ident" id="8504144">Cases</span><span class="op" id="8504149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504152">for</span>&nbsp;<span class="ident" id="8504156">_</span><span class="op" id="8504157">,</span>&nbsp;<span class="ident" id="8504159">tt</span>&nbsp;<span class="op" id="8504162">:=</span>&nbsp;<span class="keyword" id="8504165">range</span>&nbsp;<span class="ident" id="8504171">parseTests</span>&nbsp;<span class="op" id="8504182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504186">r</span>&nbsp;<span class="op" id="8504188">:=</span>&nbsp;<span class="ident" id="8504191">NewReader</span><span class="op" id="8504200">(</span><span class="ident" id="8504201">strings</span><span class="op" id="8504208">.</span><span class="ident" id="8504209">NewReader</span><span class="op" id="8504218">(</span><span class="ident" id="8504219">tt</span><span class="op" id="8504221">.</span><span class="ident" id="8504222">in</span><span class="op" id="8504224">)</span><span class="op" id="8504225">,</span>&nbsp;<span class="ident" id="8504227">tt</span><span class="op" id="8504229">.</span><span class="ident" id="8504230">sep</span><span class="op" id="8504233">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504237">got</span>&nbsp;<span class="op" id="8504241">:=</span>&nbsp;<span class="op" id="8504244">[</span><span class="op" id="8504245">]</span><span class="ident" id="8504246">headerBody</span><span class="op" id="8504256">{</span><span class="op" id="8504257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504261">for</span>&nbsp;<span class="op" id="8504265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504270">p</span><span class="op" id="8504271">,</span>&nbsp;<span class="ident" id="8504273">err</span>&nbsp;<span class="op" id="8504277">:=</span>&nbsp;<span class="ident" id="8504280">r</span><span class="op" id="8504281">.</span><span class="ident" id="8504282">NextPart</span><span class="op" id="8504290">(</span><span class="op" id="8504291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504296">if</span>&nbsp;<span class="ident" id="8504299">err</span>&nbsp;<span class="op" id="8504303">==</span>&nbsp;<span class="ident" id="8504306">io</span><span class="op" id="8504308">.</span><span class="ident" id="8504309">EOF</span>&nbsp;<span class="op" id="8504313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504319">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504333">if</span>&nbsp;<span class="ident" id="8504336">err</span>&nbsp;<span class="op" id="8504340">!=</span>&nbsp;<span class="builtintype" id="8504343">nil</span>&nbsp;<span class="op" id="8504347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504353">t</span><span class="op" id="8504354">.</span><span class="ident" id="8504355">Errorf</span><span class="op" id="8504361">(</span><span class="string" id="8504362">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="8504388">,</span>&nbsp;<span class="ident" id="8504390">tt</span><span class="op" id="8504392">.</span><span class="ident" id="8504393">name</span><span class="op" id="8504397">,</span>&nbsp;<span class="ident" id="8504399">err</span><span class="op" id="8504402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504408">continue</span>&nbsp;<span class="ident" id="8504417">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504426">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504431">pbody</span><span class="op" id="8504436">,</span>&nbsp;<span class="ident" id="8504438">err</span>&nbsp;<span class="op" id="8504442">:=</span>&nbsp;<span class="ident" id="8504445">ioutil</span><span class="op" id="8504451">.</span><span class="ident" id="8504452">ReadAll</span><span class="op" id="8504459">(</span><span class="ident" id="8504460">p</span><span class="op" id="8504461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504466">if</span>&nbsp;<span class="ident" id="8504469">err</span>&nbsp;<span class="op" id="8504473">!=</span>&nbsp;<span class="builtintype" id="8504476">nil</span>&nbsp;<span class="op" id="8504480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504486">t</span><span class="op" id="8504487">.</span><span class="ident" id="8504488">Errorf</span><span class="op" id="8504494">(</span><span class="string" id="8504495">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8504531">,</span>&nbsp;<span class="ident" id="8504533">tt</span><span class="op" id="8504535">.</span><span class="ident" id="8504536">name</span><span class="op" id="8504540">,</span>&nbsp;<span class="ident" id="8504542">err</span><span class="op" id="8504545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504551">continue</span>&nbsp;<span class="ident" id="8504560">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504569">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504574">got</span>&nbsp;<span class="op" id="8504578">=</span>&nbsp;<span class="builtinfunc" id="8504580">append</span><span class="op" id="8504586">(</span><span class="ident" id="8504587">got</span><span class="op" id="8504590">,</span>&nbsp;<span class="ident" id="8504592">headerBody</span><span class="op" id="8504602">{</span><span class="ident" id="8504603">p</span><span class="op" id="8504604">.</span><span class="ident" id="8504605">Header</span><span class="op" id="8504611">,</span>&nbsp;<span class="builtintype" id="8504613">string</span><span class="op" id="8504619">(</span><span class="ident" id="8504620">pbody</span><span class="op" id="8504625">)</span><span class="op" id="8504626">}</span><span class="op" id="8504627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504635">if</span>&nbsp;<span class="op" id="8504638">!</span><span class="ident" id="8504639">reflect</span><span class="op" id="8504646">.</span><span class="ident" id="8504647">DeepEqual</span><span class="op" id="8504656">(</span><span class="ident" id="8504657">tt</span><span class="op" id="8504659">.</span><span class="ident" id="8504660">want</span><span class="op" id="8504664">,</span>&nbsp;<span class="ident" id="8504666">got</span><span class="op" id="8504669">)</span>&nbsp;<span class="op" id="8504671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504676">t</span><span class="op" id="8504677">.</span><span class="ident" id="8504678">Errorf</span><span class="op" id="8504684">(</span><span class="string" id="8504685">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8504715">,</span>&nbsp;<span class="ident" id="8504717">tt</span><span class="op" id="8504719">.</span><span class="ident" id="8504720">name</span><span class="op" id="8504724">,</span>&nbsp;<span class="ident" id="8504726">got</span><span class="op" id="8504729">,</span>&nbsp;<span class="ident" id="8504731">tt</span><span class="op" id="8504733">.</span><span class="ident" id="8504734">want</span><span class="op" id="8504738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504743">if</span>&nbsp;<span class="builtinfunc" id="8504746">len</span><span class="op" id="8504749">(</span><span class="ident" id="8504750">tt</span><span class="op" id="8504752">.</span><span class="ident" id="8504753">want</span><span class="op" id="8504757">)</span>&nbsp;<span class="op" id="8504759">!=</span>&nbsp;<span class="builtinfunc" id="8504762">len</span><span class="op" id="8504765">(</span><span class="ident" id="8504766">got</span><span class="op" id="8504769">)</span>&nbsp;<span class="op" id="8504771">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504777">t</span><span class="op" id="8504778">.</span><span class="ident" id="8504779">Errorf</span><span class="op" id="8504785">(</span><span class="string" id="8504786">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8504818">,</span>&nbsp;<span class="ident" id="8504820">tt</span><span class="op" id="8504822">.</span><span class="ident" id="8504823">name</span><span class="op" id="8504827">,</span>&nbsp;<span class="builtinfunc" id="8504829">len</span><span class="op" id="8504832">(</span><span class="ident" id="8504833">got</span><span class="op" id="8504836">)</span><span class="op" id="8504837">,</span>&nbsp;<span class="builtinfunc" id="8504839">len</span><span class="op" id="8504842">(</span><span class="ident" id="8504843">tt</span><span class="op" id="8504845">.</span><span class="ident" id="8504846">want</span><span class="op" id="8504850">)</span><span class="op" id="8504851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8504856">}</span>&nbsp;<span class="keyword" id="8504858">else</span>&nbsp;<span class="keyword" id="8504863">if</span>&nbsp;<span class="builtinfunc" id="8504866">len</span><span class="op" id="8504869">(</span><span class="ident" id="8504870">got</span><span class="op" id="8504873">)</span>&nbsp;<span class="op" id="8504875">&gt;</span>&nbsp;<span class="num" id="8504877">1</span>&nbsp;<span class="op" id="8504879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504885">for</span>&nbsp;<span class="ident" id="8504889">pi</span><span class="op" id="8504891">,</span>&nbsp;<span class="ident" id="8504893">wantPart</span>&nbsp;<span class="op" id="8504902">:=</span>&nbsp;<span class="keyword" id="8504905">range</span>&nbsp;<span class="ident" id="8504911">tt</span><span class="op" id="8504913">.</span><span class="ident" id="8504914">want</span>&nbsp;<span class="op" id="8504919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8504926">if</span>&nbsp;<span class="op" id="8504929">!</span><span class="ident" id="8504930">reflect</span><span class="op" id="8504937">.</span><span class="ident" id="8504938">DeepEqual</span><span class="op" id="8504947">(</span><span class="ident" id="8504948">wantPart</span><span class="op" id="8504956">,</span>&nbsp;<span class="ident" id="8504958">got</span><span class="op" id="8504961">[</span><span class="ident" id="8504962">pi</span><span class="op" id="8504964">]</span><span class="op" id="8504965">)</span>&nbsp;<span class="op" id="8504967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8504975">t</span><span class="op" id="8504976">.</span><span class="ident" id="8504977">Errorf</span><span class="op" id="8504983">(</span><span class="string" id="8504984">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8505023">,</span>&nbsp;<span class="ident" id="8505025">tt</span><span class="op" id="8505027">.</span><span class="ident" id="8505028">name</span><span class="op" id="8505032">,</span>&nbsp;<span class="ident" id="8505034">pi</span><span class="op" id="8505036">,</span>&nbsp;<span class="ident" id="8505038">got</span><span class="op" id="8505041">[</span><span class="ident" id="8505042">pi</span><span class="op" id="8505044">]</span><span class="op" id="8505045">,</span>&nbsp;<span class="ident" id="8505047">wantPart</span><span class="op" id="8505055">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505080">}</span><br>
<span class="lineno">605</span><span class="op" id="8505082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8505085">func</span>&nbsp;<span class="ident" id="8505090">roundTripParseTest</span><span class="op" id="8505108">(</span><span class="op" id="8505109">)</span>&nbsp;<span class="ident" id="8505111">parseTest</span>&nbsp;<span class="op" id="8505121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505124">t</span>&nbsp;<span class="op" id="8505126">:=</span>&nbsp;<span class="ident" id="8505129">parseTest</span><span class="op" id="8505138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505142">name</span><span class="op" id="8505146">:</span>&nbsp;<span class="string" id="8505148">&#34;round&nbsp;trip&#34;</span><span class="op" id="8505160">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505164">want</span><span class="op" id="8505168">:</span>&nbsp;<span class="op" id="8505170">[</span><span class="op" id="8505171">]</span><span class="ident" id="8505172">headerBody</span><span class="op" id="8505182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505187">formData</span><span class="op" id="8505195">(</span><span class="string" id="8505196">&#34;empty&#34;</span><span class="op" id="8505203">,</span>&nbsp;<span class="string" id="8505205">&#34;&#34;</span><span class="op" id="8505207">)</span><span class="op" id="8505208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505213">formData</span><span class="op" id="8505221">(</span><span class="string" id="8505222">&#34;lf&#34;</span><span class="op" id="8505226">,</span>&nbsp;<span class="string" id="8505228">&#34;\n&#34;</span><span class="op" id="8505232">)</span><span class="op" id="8505233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505238">formData</span><span class="op" id="8505246">(</span><span class="string" id="8505247">&#34;cr&#34;</span><span class="op" id="8505251">,</span>&nbsp;<span class="string" id="8505253">&#34;\r&#34;</span><span class="op" id="8505257">)</span><span class="op" id="8505258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505263">formData</span><span class="op" id="8505271">(</span><span class="string" id="8505272">&#34;crlf&#34;</span><span class="op" id="8505278">,</span>&nbsp;<span class="string" id="8505280">&#34;\r\n&#34;</span><span class="op" id="8505286">)</span><span class="op" id="8505287">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505292">formData</span><span class="op" id="8505300">(</span><span class="string" id="8505301">&#34;foo&#34;</span><span class="op" id="8505306">,</span>&nbsp;<span class="string" id="8505308">&#34;bar&#34;</span><span class="op" id="8505313">)</span><span class="op" id="8505314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505318">}</span><span class="op" id="8505319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8505325">var</span>&nbsp;<span class="ident" id="8505329">buf</span>&nbsp;<span class="ident" id="8505333">bytes</span><span class="op" id="8505338">.</span><span class="ident" id="8505339">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505347">w</span>&nbsp;<span class="op" id="8505349">:=</span>&nbsp;<span class="ident" id="8505352">NewWriter</span><span class="op" id="8505361">(</span><span class="op" id="8505362">&amp;</span><span class="ident" id="8505363">buf</span><span class="op" id="8505366">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8505369">for</span>&nbsp;<span class="ident" id="8505373">_</span><span class="op" id="8505374">,</span>&nbsp;<span class="ident" id="8505376">p</span>&nbsp;<span class="op" id="8505378">:=</span>&nbsp;<span class="keyword" id="8505381">range</span>&nbsp;<span class="ident" id="8505387">t</span><span class="op" id="8505388">.</span><span class="ident" id="8505389">want</span>&nbsp;<span class="op" id="8505394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505398">pw</span><span class="op" id="8505400">,</span>&nbsp;<span class="ident" id="8505402">err</span>&nbsp;<span class="op" id="8505406">:=</span>&nbsp;<span class="ident" id="8505409">w</span><span class="op" id="8505410">.</span><span class="ident" id="8505411">CreatePart</span><span class="op" id="8505421">(</span><span class="ident" id="8505422">p</span><span class="op" id="8505423">.</span><span class="ident" id="8505424">header</span><span class="op" id="8505430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8505434">if</span>&nbsp;<span class="ident" id="8505437">err</span>&nbsp;<span class="op" id="8505441">!=</span>&nbsp;<span class="builtintype" id="8505444">nil</span>&nbsp;<span class="op" id="8505448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8505453">panic</span><span class="op" id="8505458">(</span><span class="ident" id="8505459">err</span><span class="op" id="8505462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505466">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505470">_</span><span class="op" id="8505471">,</span>&nbsp;<span class="ident" id="8505473">err</span>&nbsp;<span class="op" id="8505477">=</span>&nbsp;<span class="ident" id="8505479">pw</span><span class="op" id="8505481">.</span><span class="ident" id="8505482">Write</span><span class="op" id="8505487">(</span><span class="op" id="8505488">[</span><span class="op" id="8505489">]</span><span class="builtintype" id="8505490">byte</span><span class="op" id="8505494">(</span><span class="ident" id="8505495">p</span><span class="op" id="8505496">.</span><span class="ident" id="8505497">body</span><span class="op" id="8505501">)</span><span class="op" id="8505502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8505506">if</span>&nbsp;<span class="ident" id="8505509">err</span>&nbsp;<span class="op" id="8505513">!=</span>&nbsp;<span class="builtintype" id="8505516">nil</span>&nbsp;<span class="op" id="8505520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8505525">panic</span><span class="op" id="8505530">(</span><span class="ident" id="8505531">err</span><span class="op" id="8505534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8505541">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505544">w</span><span class="op" id="8505545">.</span><span class="ident" id="8505546">Close</span><span class="op" id="8505551">(</span><span class="op" id="8505552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505555">t</span><span class="op" id="8505556">.</span><span class="ident" id="8505557">in</span>&nbsp;<span class="op" id="8505560">=</span>&nbsp;<span class="ident" id="8505562">buf</span><span class="op" id="8505565">.</span><span class="ident" id="8505566">String</span><span class="op" id="8505572">(</span><span class="op" id="8505573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505576">t</span><span class="op" id="8505577">.</span><span class="ident" id="8505578">sep</span>&nbsp;<span class="op" id="8505582">=</span>&nbsp;<span class="ident" id="8505584">w</span><span class="op" id="8505585">.</span><span class="ident" id="8505586">Boundary</span><span class="op" id="8505594">(</span><span class="op" id="8505595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8505598">return</span>&nbsp;<span class="ident" id="8505605">t</span><br>
<span class="lineno"></span><span class="op" id="8505607">}</span>
</div>
</body>
</html>
