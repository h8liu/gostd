<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8123249">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8123304">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8123358">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8123409">package</span>&nbsp;<span class="ident" id="8123417">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8123430">import</span>&nbsp;<span class="op" id="8123437">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123440">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123449">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123462">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123472">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123480">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123491">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8123501">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8123504">type</span>&nbsp;<span class="ident" id="8123509">testCase</span>&nbsp;<span class="keyword" id="8123518">struct</span>&nbsp;<span class="op" id="8123525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8123528">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8123537">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8123546">//&nbsp;name&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8123568">source</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8123577">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8123586">//&nbsp;source&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8123606">patterns</span>&nbsp;<span class="op" id="8123615">[</span><span class="op" id="8123616">]</span><span class="builtintype" id="8123617">string</span>&nbsp;<span class="comment" id="8123624">//&nbsp;patterns&nbsp;to&nbsp;lookup</span><br>
<span class="lineno">20</span><span class="op" id="8123646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8123649">var</span>&nbsp;<span class="ident" id="8123653">testCases</span>&nbsp;<span class="op" id="8123663">=</span>&nbsp;<span class="op" id="8123665">[</span><span class="op" id="8123666">]</span><span class="ident" id="8123667">testCase</span><span class="op" id="8123675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8123678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123682">&#34;empty&nbsp;string&#34;</span><span class="op" id="8123696">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123700">&#34;&#34;</span><span class="op" id="8123702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8123706">[</span><span class="op" id="8123707">]</span><span class="builtintype" id="8123708">string</span><span class="op" id="8123714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123719">&#34;&#34;</span><span class="op" id="8123721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123726">&#34;foo&#34;</span><span class="op" id="8123731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123736">&#34;(foo)&#34;</span><span class="op" id="8123743">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123748">&#34;.*&#34;</span><span class="op" id="8123752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123757">&#34;a*&#34;</span><span class="op" id="8123761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8123765">}</span><span class="op" id="8123766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8123769">}</span><span class="op" id="8123770">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8123774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123778">&#34;all&nbsp;a&#39;s&#34;</span><span class="op" id="8123787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123791">&#34;aaaaaaaaaa&#34;</span><span class="op" id="8123803">,</span>&nbsp;<span class="comment" id="8123805">//&nbsp;10&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8123817">[</span><span class="op" id="8123818">]</span><span class="builtintype" id="8123819">string</span><span class="op" id="8123825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123830">&#34;&#34;</span><span class="op" id="8123832">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123837">&#34;a&#34;</span><span class="op" id="8123840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123845">&#34;aa&#34;</span><span class="op" id="8123849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123854">&#34;aaa&#34;</span><span class="op" id="8123859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123864">&#34;aaaa&#34;</span><span class="op" id="8123870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123875">&#34;aaaaa&#34;</span><span class="op" id="8123882">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123887">&#34;aaaaaa&#34;</span><span class="op" id="8123895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123900">&#34;aaaaaaa&#34;</span><span class="op" id="8123909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123914">&#34;aaaaaaaa&#34;</span><span class="op" id="8123924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123929">&#34;aaaaaaaaa&#34;</span><span class="op" id="8123940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123945">&#34;aaaaaaaaaa&#34;</span><span class="op" id="8123957">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123962">&#34;aaaaaaaaaaa&#34;</span><span class="op" id="8123975">,</span>&nbsp;<span class="comment" id="8123977">//&nbsp;11&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123990">&#34;.&#34;</span><span class="op" id="8123993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123998">&#34;.*&#34;</span><span class="op" id="8124002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124007">&#34;a+&#34;</span><span class="op" id="8124011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124016">&#34;aa+&#34;</span><span class="op" id="8124021">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124026">&#34;aaaa[b]?&#34;</span><span class="op" id="8124036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124041">&#34;aaa*&#34;</span><span class="op" id="8124047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124051">}</span><span class="op" id="8124052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124055">}</span><span class="op" id="8124056">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124064">&#34;abc&#34;</span><span class="op" id="8124069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124073">&#34;abc&#34;</span><span class="op" id="8124078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124082">[</span><span class="op" id="8124083">]</span><span class="builtintype" id="8124084">string</span><span class="op" id="8124090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124095">&#34;a&#34;</span><span class="op" id="8124098">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124103">&#34;b&#34;</span><span class="op" id="8124106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124111">&#34;c&#34;</span><span class="op" id="8124114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124119">&#34;ab&#34;</span><span class="op" id="8124123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124128">&#34;bc&#34;</span><span class="op" id="8124132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124137">&#34;abc&#34;</span><span class="op" id="8124142">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124147">&#34;a.c&#34;</span><span class="op" id="8124152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124157">&#34;a(b|c)&#34;</span><span class="op" id="8124165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124170">&#34;abc?&#34;</span><span class="op" id="8124176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124180">}</span><span class="op" id="8124181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124184">}</span><span class="op" id="8124185">,</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124193">&#34;barbara*3&#34;</span><span class="op" id="8124204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124208">&#34;barbarabarbarabarbara&#34;</span><span class="op" id="8124231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124235">[</span><span class="op" id="8124236">]</span><span class="builtintype" id="8124237">string</span><span class="op" id="8124243">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124248">&#34;a&#34;</span><span class="op" id="8124251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124256">&#34;bar&#34;</span><span class="op" id="8124261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124266">&#34;rab&#34;</span><span class="op" id="8124271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124276">&#34;arab&#34;</span><span class="op" id="8124282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124287">&#34;barbar&#34;</span><span class="op" id="8124295">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124300">&#34;bara?bar&#34;</span><span class="op" id="8124310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124314">}</span><span class="op" id="8124315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124318">}</span><span class="op" id="8124319">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124323">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124327">&#34;typing&nbsp;drill&#34;</span><span class="op" id="8124341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124345">&#34;Now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="8124416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124420">[</span><span class="op" id="8124421">]</span><span class="builtintype" id="8124422">string</span><span class="op" id="8124428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124433">&#34;Now&#34;</span><span class="op" id="8124438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124443">&#34;the&nbsp;time&#34;</span><span class="op" id="8124453">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124458">&#34;to&nbsp;come&nbsp;the&nbsp;aid&#34;</span><span class="op" id="8124475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124480">&#34;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&#34;</span><span class="op" id="8124538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124543">&#34;to&nbsp;(come|the)?&#34;</span><span class="op" id="8124559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124563">}</span><span class="op" id="8124564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124567">}</span><span class="op" id="8124568">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124576">&#34;godoc&nbsp;simulation&#34;</span><span class="op" id="8124594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8124598">&#34;package&nbsp;main\n\nimport(\n&nbsp;&nbsp;&nbsp;&nbsp;\&#34;rand\&#34;\n&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="8124643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124647">[</span><span class="op" id="8124648">]</span><span class="builtintype" id="8124649">string</span><span class="op" id="8124655">{</span><span class="op" id="8124656">}</span><span class="op" id="8124657">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124660">}</span><span class="op" id="8124661">,</span><br>
<span class="lineno"></span><span class="op" id="8124663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8124666">//&nbsp;find&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;source;&nbsp;report&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences</span><br>
<span class="lineno"></span><span class="keyword" id="8124735">func</span>&nbsp;<span class="ident" id="8124740">find</span><span class="op" id="8124744">(</span><span class="ident" id="8124745">src</span><span class="op" id="8124748">,</span>&nbsp;<span class="ident" id="8124750">s</span>&nbsp;<span class="builtintype" id="8124752">string</span><span class="op" id="8124758">,</span>&nbsp;<span class="ident" id="8124760">n</span>&nbsp;<span class="builtintype" id="8124762">int</span><span class="op" id="8124765">)</span>&nbsp;<span class="op" id="8124767">[</span><span class="op" id="8124768">]</span><span class="builtintype" id="8124769">int</span>&nbsp;<span class="op" id="8124773">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124776">var</span>&nbsp;<span class="ident" id="8124780">res</span>&nbsp;<span class="op" id="8124784">[</span><span class="op" id="8124785">]</span><span class="builtintype" id="8124786">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124791">if</span>&nbsp;<span class="ident" id="8124794">s</span>&nbsp;<span class="op" id="8124796">!=</span>&nbsp;<span class="string" id="8124799">&#34;&#34;</span>&nbsp;<span class="op" id="8124802">&amp;&amp;</span>&nbsp;<span class="ident" id="8124805">n</span>&nbsp;<span class="op" id="8124807">!=</span>&nbsp;<span class="num" id="8124810">0</span>&nbsp;<span class="op" id="8124812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8124816">//&nbsp;find&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124860">for</span>&nbsp;<span class="ident" id="8124864">i</span>&nbsp;<span class="op" id="8124866">:=</span>&nbsp;<span class="op" id="8124869">-</span><span class="num" id="8124870">1</span><span class="op" id="8124871">;</span>&nbsp;<span class="ident" id="8124873">n</span>&nbsp;<span class="op" id="8124875">&lt;</span>&nbsp;<span class="num" id="8124877">0</span>&nbsp;<span class="op" id="8124879">||</span>&nbsp;<span class="builtinfunc" id="8124882">len</span><span class="op" id="8124885">(</span><span class="ident" id="8124886">res</span><span class="op" id="8124889">)</span>&nbsp;<span class="op" id="8124891">&lt;</span>&nbsp;<span class="ident" id="8124893">n</span><span class="op" id="8124894">;</span>&nbsp;<span class="op" id="8124896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124901">j</span>&nbsp;<span class="op" id="8124903">:=</span>&nbsp;<span class="ident" id="8124906">strings</span><span class="op" id="8124913">.</span><span class="ident" id="8124914">Index</span><span class="op" id="8124919">(</span><span class="ident" id="8124920">src</span><span class="op" id="8124923">[</span><span class="ident" id="8124924">i</span><span class="op" id="8124925">+</span><span class="num" id="8124926">1</span><span class="op" id="8124927">:</span><span class="op" id="8124928">]</span><span class="op" id="8124929">,</span>&nbsp;<span class="ident" id="8124931">s</span><span class="op" id="8124932">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124937">if</span>&nbsp;<span class="ident" id="8124940">j</span>&nbsp;<span class="op" id="8124942">&lt;</span>&nbsp;<span class="num" id="8124944">0</span>&nbsp;<span class="op" id="8124946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124952">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124966">i</span>&nbsp;<span class="op" id="8124968">+=</span>&nbsp;<span class="ident" id="8124971">j</span>&nbsp;<span class="op" id="8124973">+</span>&nbsp;<span class="num" id="8124975">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124980">res</span>&nbsp;<span class="op" id="8124984">=</span>&nbsp;<span class="builtinfunc" id="8124986">append</span><span class="op" id="8124992">(</span><span class="ident" id="8124993">res</span><span class="op" id="8124996">,</span>&nbsp;<span class="ident" id="8124998">i</span><span class="op" id="8124999">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125009">return</span>&nbsp;<span class="ident" id="8125016">res</span><br>
<span class="lineno"></span><span class="op" id="8125020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="8125023">func</span>&nbsp;<span class="ident" id="8125028">testLookup</span><span class="op" id="8125038">(</span><span class="ident" id="8125039">t</span>&nbsp;<span class="op" id="8125041">*</span><span class="ident" id="8125042">testing</span><span class="op" id="8125049">.</span><span class="ident" id="8125050">T</span><span class="op" id="8125051">,</span>&nbsp;<span class="ident" id="8125053">tc</span>&nbsp;<span class="op" id="8125056">*</span><span class="ident" id="8125057">testCase</span><span class="op" id="8125065">,</span>&nbsp;<span class="ident" id="8125067">x</span>&nbsp;<span class="op" id="8125069">*</span><span class="ident" id="8125070">Index</span><span class="op" id="8125075">,</span>&nbsp;<span class="ident" id="8125077">s</span>&nbsp;<span class="builtintype" id="8125079">string</span><span class="op" id="8125085">,</span>&nbsp;<span class="ident" id="8125087">n</span>&nbsp;<span class="builtintype" id="8125089">int</span><span class="op" id="8125092">)</span>&nbsp;<span class="op" id="8125094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125097">res</span>&nbsp;<span class="op" id="8125101">:=</span>&nbsp;<span class="ident" id="8125104">x</span><span class="op" id="8125105">.</span><span class="ident" id="8125106">Lookup</span><span class="op" id="8125112">(</span><span class="op" id="8125113">[</span><span class="op" id="8125114">]</span><span class="builtintype" id="8125115">byte</span><span class="op" id="8125119">(</span><span class="ident" id="8125120">s</span><span class="op" id="8125121">)</span><span class="op" id="8125122">,</span>&nbsp;<span class="ident" id="8125124">n</span><span class="op" id="8125125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125128">exp</span>&nbsp;<span class="op" id="8125132">:=</span>&nbsp;<span class="ident" id="8125135">find</span><span class="op" id="8125139">(</span><span class="ident" id="8125140">tc</span><span class="op" id="8125142">.</span><span class="ident" id="8125143">source</span><span class="op" id="8125149">,</span>&nbsp;<span class="ident" id="8125151">s</span><span class="op" id="8125152">,</span>&nbsp;<span class="ident" id="8125154">n</span><span class="op" id="8125155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125159">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125192">if</span>&nbsp;<span class="builtinfunc" id="8125195">len</span><span class="op" id="8125198">(</span><span class="ident" id="8125199">res</span><span class="op" id="8125202">)</span>&nbsp;<span class="op" id="8125204">!=</span>&nbsp;<span class="builtinfunc" id="8125207">len</span><span class="op" id="8125210">(</span><span class="ident" id="8125211">exp</span><span class="op" id="8125214">)</span>&nbsp;<span class="op" id="8125216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125220">t</span><span class="op" id="8125221">.</span><span class="ident" id="8125222">Errorf</span><span class="op" id="8125228">(</span><span class="string" id="8125229">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8125287">,</span>&nbsp;<span class="ident" id="8125289">tc</span><span class="op" id="8125291">.</span><span class="ident" id="8125292">name</span><span class="op" id="8125296">,</span>&nbsp;<span class="ident" id="8125298">s</span><span class="op" id="8125299">,</span>&nbsp;<span class="ident" id="8125301">n</span><span class="op" id="8125302">,</span>&nbsp;<span class="builtinfunc" id="8125304">len</span><span class="op" id="8125307">(</span><span class="ident" id="8125308">exp</span><span class="op" id="8125311">)</span><span class="op" id="8125312">,</span>&nbsp;<span class="builtinfunc" id="8125314">len</span><span class="op" id="8125317">(</span><span class="ident" id="8125318">res</span><span class="op" id="8125321">)</span><span class="op" id="8125322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125329">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125405">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;find&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125481">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;find)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125557">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125622">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;duplicates</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125704">sort</span><span class="op" id="8125708">.</span><span class="ident" id="8125709">Ints</span><span class="op" id="8125713">(</span><span class="ident" id="8125714">res</span><span class="op" id="8125717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125720">for</span>&nbsp;<span class="ident" id="8125724">i</span><span class="op" id="8125725">,</span>&nbsp;<span class="ident" id="8125727">r</span>&nbsp;<span class="op" id="8125729">:=</span>&nbsp;<span class="keyword" id="8125732">range</span>&nbsp;<span class="ident" id="8125738">res</span>&nbsp;<span class="op" id="8125742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125746">if</span>&nbsp;<span class="ident" id="8125749">r</span>&nbsp;<span class="op" id="8125751">&lt;</span>&nbsp;<span class="num" id="8125753">0</span>&nbsp;<span class="op" id="8125755">||</span>&nbsp;<span class="builtinfunc" id="8125758">len</span><span class="op" id="8125761">(</span><span class="ident" id="8125762">tc</span><span class="op" id="8125764">.</span><span class="ident" id="8125765">source</span><span class="op" id="8125771">)</span>&nbsp;<span class="op" id="8125773">&lt;=</span>&nbsp;<span class="ident" id="8125776">r</span>&nbsp;<span class="op" id="8125778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125783">t</span><span class="op" id="8125784">.</span><span class="ident" id="8125785">Errorf</span><span class="op" id="8125791">(</span><span class="string" id="8125792">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&nbsp;[0,&nbsp;%d[&#34;</span><span class="op" id="8125863">,</span>&nbsp;<span class="ident" id="8125865">tc</span><span class="op" id="8125867">.</span><span class="ident" id="8125868">name</span><span class="op" id="8125872">,</span>&nbsp;<span class="ident" id="8125874">s</span><span class="op" id="8125875">,</span>&nbsp;<span class="ident" id="8125877">i</span><span class="op" id="8125878">,</span>&nbsp;<span class="ident" id="8125880">n</span><span class="op" id="8125881">,</span>&nbsp;<span class="ident" id="8125883">r</span><span class="op" id="8125884">,</span>&nbsp;<span class="builtinfunc" id="8125886">len</span><span class="op" id="8125889">(</span><span class="ident" id="8125890">tc</span><span class="op" id="8125892">.</span><span class="ident" id="8125893">source</span><span class="op" id="8125899">)</span><span class="op" id="8125900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125904">}</span>&nbsp;<span class="keyword" id="8125906">else</span>&nbsp;<span class="keyword" id="8125911">if</span>&nbsp;<span class="op" id="8125914">!</span><span class="ident" id="8125915">strings</span><span class="op" id="8125922">.</span><span class="ident" id="8125923">HasPrefix</span><span class="op" id="8125932">(</span><span class="ident" id="8125933">tc</span><span class="op" id="8125935">.</span><span class="ident" id="8125936">source</span><span class="op" id="8125942">[</span><span class="ident" id="8125943">r</span><span class="op" id="8125944">:</span><span class="op" id="8125945">]</span><span class="op" id="8125946">,</span>&nbsp;<span class="ident" id="8125948">s</span><span class="op" id="8125949">)</span>&nbsp;<span class="op" id="8125951">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125956">t</span><span class="op" id="8125957">.</span><span class="ident" id="8125958">Errorf</span><span class="op" id="8125964">(</span><span class="string" id="8125965">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="8126027">,</span>&nbsp;<span class="ident" id="8126029">tc</span><span class="op" id="8126031">.</span><span class="ident" id="8126032">name</span><span class="op" id="8126036">,</span>&nbsp;<span class="ident" id="8126038">s</span><span class="op" id="8126039">,</span>&nbsp;<span class="ident" id="8126041">i</span><span class="op" id="8126042">,</span>&nbsp;<span class="ident" id="8126044">n</span><span class="op" id="8126045">,</span>&nbsp;<span class="ident" id="8126047">r</span><span class="op" id="8126048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126056">if</span>&nbsp;<span class="ident" id="8126059">i</span>&nbsp;<span class="op" id="8126061">&gt;</span>&nbsp;<span class="num" id="8126063">0</span>&nbsp;<span class="op" id="8126065">&amp;&amp;</span>&nbsp;<span class="ident" id="8126068">res</span><span class="op" id="8126071">[</span><span class="ident" id="8126072">i</span><span class="op" id="8126073">-</span><span class="num" id="8126074">1</span><span class="op" id="8126075">]</span>&nbsp;<span class="op" id="8126077">==</span>&nbsp;<span class="ident" id="8126080">r</span>&nbsp;<span class="op" id="8126082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126087">t</span><span class="op" id="8126088">.</span><span class="ident" id="8126089">Errorf</span><span class="op" id="8126095">(</span><span class="string" id="8126096">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;found&nbsp;duplicate&nbsp;index&nbsp;%d&#34;</span><span class="op" id="8126162">,</span>&nbsp;<span class="ident" id="8126164">tc</span><span class="op" id="8126166">.</span><span class="ident" id="8126167">name</span><span class="op" id="8126171">,</span>&nbsp;<span class="ident" id="8126173">s</span><span class="op" id="8126174">,</span>&nbsp;<span class="ident" id="8126176">i</span><span class="op" id="8126177">,</span>&nbsp;<span class="ident" id="8126179">n</span><span class="op" id="8126180">,</span>&nbsp;<span class="ident" id="8126182">r</span><span class="op" id="8126183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126187">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126194">if</span>&nbsp;<span class="ident" id="8126197">n</span>&nbsp;<span class="op" id="8126199">&lt;</span>&nbsp;<span class="num" id="8126201">0</span>&nbsp;<span class="op" id="8126203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8126207">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126268">for</span>&nbsp;<span class="ident" id="8126272">i</span><span class="op" id="8126273">,</span>&nbsp;<span class="ident" id="8126275">r</span>&nbsp;<span class="op" id="8126277">:=</span>&nbsp;<span class="keyword" id="8126280">range</span>&nbsp;<span class="ident" id="8126286">res</span>&nbsp;<span class="op" id="8126290">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126295">e</span>&nbsp;<span class="op" id="8126297">:=</span>&nbsp;<span class="ident" id="8126300">exp</span><span class="op" id="8126303">[</span><span class="ident" id="8126304">i</span><span class="op" id="8126305">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126310">if</span>&nbsp;<span class="ident" id="8126313">r</span>&nbsp;<span class="op" id="8126315">!=</span>&nbsp;<span class="ident" id="8126318">e</span>&nbsp;<span class="op" id="8126320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126326">t</span><span class="op" id="8126327">.</span><span class="ident" id="8126328">Errorf</span><span class="op" id="8126334">(</span><span class="string" id="8126335">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;index&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8126393">,</span>&nbsp;<span class="ident" id="8126395">tc</span><span class="op" id="8126397">.</span><span class="ident" id="8126398">name</span><span class="op" id="8126402">,</span>&nbsp;<span class="ident" id="8126404">s</span><span class="op" id="8126405">,</span>&nbsp;<span class="ident" id="8126407">i</span><span class="op" id="8126408">,</span>&nbsp;<span class="ident" id="8126410">e</span><span class="op" id="8126411">,</span>&nbsp;<span class="ident" id="8126413">r</span><span class="op" id="8126414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126423">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126426">}</span><br>
<span class="lineno"></span><span class="op" id="8126428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8126431">func</span>&nbsp;<span class="ident" id="8126436">testFindAllIndex</span><span class="op" id="8126452">(</span><span class="ident" id="8126453">t</span>&nbsp;<span class="op" id="8126455">*</span><span class="ident" id="8126456">testing</span><span class="op" id="8126463">.</span><span class="ident" id="8126464">T</span><span class="op" id="8126465">,</span>&nbsp;<span class="ident" id="8126467">tc</span>&nbsp;<span class="op" id="8126470">*</span><span class="ident" id="8126471">testCase</span><span class="op" id="8126479">,</span>&nbsp;<span class="ident" id="8126481">x</span>&nbsp;<span class="op" id="8126483">*</span><span class="ident" id="8126484">Index</span><span class="op" id="8126489">,</span>&nbsp;<span class="ident" id="8126491">rx</span>&nbsp;<span class="op" id="8126494">*</span><span class="ident" id="8126495">regexp</span><span class="op" id="8126501">.</span><span class="ident" id="8126502">Regexp</span><span class="op" id="8126508">,</span>&nbsp;<span class="ident" id="8126510">n</span>&nbsp;<span class="builtintype" id="8126512">int</span><span class="op" id="8126515">)</span>&nbsp;<span class="op" id="8126517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126520">res</span>&nbsp;<span class="op" id="8126524">:=</span>&nbsp;<span class="ident" id="8126527">x</span><span class="op" id="8126528">.</span><span class="ident" id="8126529">FindAllIndex</span><span class="op" id="8126541">(</span><span class="ident" id="8126542">rx</span><span class="op" id="8126544">,</span>&nbsp;<span class="ident" id="8126546">n</span><span class="op" id="8126547">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126550">exp</span>&nbsp;<span class="op" id="8126554">:=</span>&nbsp;<span class="ident" id="8126557">rx</span><span class="op" id="8126559">.</span><span class="ident" id="8126560">FindAllStringIndex</span><span class="op" id="8126578">(</span><span class="ident" id="8126579">tc</span><span class="op" id="8126581">.</span><span class="ident" id="8126582">source</span><span class="op" id="8126588">,</span>&nbsp;<span class="ident" id="8126590">n</span><span class="op" id="8126591">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8126595">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126628">if</span>&nbsp;<span class="builtinfunc" id="8126631">len</span><span class="op" id="8126634">(</span><span class="ident" id="8126635">res</span><span class="op" id="8126638">)</span>&nbsp;<span class="op" id="8126640">!=</span>&nbsp;<span class="builtinfunc" id="8126643">len</span><span class="op" id="8126646">(</span><span class="ident" id="8126647">exp</span><span class="op" id="8126650">)</span>&nbsp;<span class="op" id="8126652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126656">t</span><span class="op" id="8126657">.</span><span class="ident" id="8126658">Errorf</span><span class="op" id="8126664">(</span><span class="string" id="8126665">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8126729">,</span>&nbsp;<span class="ident" id="8126731">tc</span><span class="op" id="8126733">.</span><span class="ident" id="8126734">name</span><span class="op" id="8126738">,</span>&nbsp;<span class="ident" id="8126740">rx</span><span class="op" id="8126742">,</span>&nbsp;<span class="ident" id="8126744">n</span><span class="op" id="8126745">,</span>&nbsp;<span class="builtinfunc" id="8126747">len</span><span class="op" id="8126750">(</span><span class="ident" id="8126751">exp</span><span class="op" id="8126754">)</span><span class="op" id="8126755">,</span>&nbsp;<span class="builtinfunc" id="8126757">len</span><span class="op" id="8126760">(</span><span class="ident" id="8126761">res</span><span class="op" id="8126764">)</span><span class="op" id="8126765">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8126772">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8126848">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;regexp&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8126926">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;regexp)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8127004">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8127069">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127148">for</span>&nbsp;<span class="ident" id="8127152">i</span><span class="op" id="8127153">,</span>&nbsp;<span class="ident" id="8127155">r</span>&nbsp;<span class="op" id="8127157">:=</span>&nbsp;<span class="keyword" id="8127160">range</span>&nbsp;<span class="ident" id="8127166">res</span>&nbsp;<span class="op" id="8127170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127174">if</span>&nbsp;<span class="ident" id="8127177">r</span><span class="op" id="8127178">[</span><span class="num" id="8127179">0</span><span class="op" id="8127180">]</span>&nbsp;<span class="op" id="8127182">&lt;</span>&nbsp;<span class="num" id="8127184">0</span>&nbsp;<span class="op" id="8127186">||</span>&nbsp;<span class="ident" id="8127189">r</span><span class="op" id="8127190">[</span><span class="num" id="8127191">0</span><span class="op" id="8127192">]</span>&nbsp;<span class="op" id="8127194">&gt;</span>&nbsp;<span class="ident" id="8127196">r</span><span class="op" id="8127197">[</span><span class="num" id="8127198">1</span><span class="op" id="8127199">]</span>&nbsp;<span class="op" id="8127201">||</span>&nbsp;<span class="builtinfunc" id="8127204">len</span><span class="op" id="8127207">(</span><span class="ident" id="8127208">tc</span><span class="op" id="8127210">.</span><span class="ident" id="8127211">source</span><span class="op" id="8127217">)</span>&nbsp;<span class="op" id="8127219">&lt;</span>&nbsp;<span class="ident" id="8127221">r</span><span class="op" id="8127222">[</span><span class="num" id="8127223">1</span><span class="op" id="8127224">]</span>&nbsp;<span class="op" id="8127226">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127231">t</span><span class="op" id="8127232">.</span><span class="ident" id="8127233">Errorf</span><span class="op" id="8127239">(</span><span class="string" id="8127240">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;==&nbsp;%d):&nbsp;illegal&nbsp;match&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="8127311">,</span>&nbsp;<span class="ident" id="8127313">tc</span><span class="op" id="8127315">.</span><span class="ident" id="8127316">name</span><span class="op" id="8127320">,</span>&nbsp;<span class="ident" id="8127322">rx</span><span class="op" id="8127324">,</span>&nbsp;<span class="ident" id="8127326">i</span><span class="op" id="8127327">,</span>&nbsp;<span class="ident" id="8127329">n</span><span class="op" id="8127330">,</span>&nbsp;<span class="ident" id="8127332">r</span><span class="op" id="8127333">[</span><span class="num" id="8127334">0</span><span class="op" id="8127335">]</span><span class="op" id="8127336">,</span>&nbsp;<span class="ident" id="8127338">r</span><span class="op" id="8127339">[</span><span class="num" id="8127340">1</span><span class="op" id="8127341">]</span><span class="op" id="8127342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127346">}</span>&nbsp;<span class="keyword" id="8127348">else</span>&nbsp;<span class="keyword" id="8127353">if</span>&nbsp;<span class="op" id="8127356">!</span><span class="ident" id="8127357">rx</span><span class="op" id="8127359">.</span><span class="ident" id="8127360">MatchString</span><span class="op" id="8127371">(</span><span class="ident" id="8127372">tc</span><span class="op" id="8127374">.</span><span class="ident" id="8127375">source</span><span class="op" id="8127381">[</span><span class="ident" id="8127382">r</span><span class="op" id="8127383">[</span><span class="num" id="8127384">0</span><span class="op" id="8127385">]</span><span class="op" id="8127386">:</span><span class="ident" id="8127387">r</span><span class="op" id="8127388">[</span><span class="num" id="8127389">1</span><span class="op" id="8127390">]</span><span class="op" id="8127391">]</span><span class="op" id="8127392">)</span>&nbsp;<span class="op" id="8127394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127399">t</span><span class="op" id="8127400">.</span><span class="ident" id="8127401">Errorf</span><span class="op" id="8127407">(</span><span class="string" id="8127408">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;[%d,&nbsp;%d]&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="8127476">,</span>&nbsp;<span class="ident" id="8127478">tc</span><span class="op" id="8127480">.</span><span class="ident" id="8127481">name</span><span class="op" id="8127485">,</span>&nbsp;<span class="ident" id="8127487">rx</span><span class="op" id="8127489">,</span>&nbsp;<span class="ident" id="8127491">i</span><span class="op" id="8127492">,</span>&nbsp;<span class="ident" id="8127494">n</span><span class="op" id="8127495">,</span>&nbsp;<span class="ident" id="8127497">r</span><span class="op" id="8127498">[</span><span class="num" id="8127499">0</span><span class="op" id="8127500">]</span><span class="op" id="8127501">,</span>&nbsp;<span class="ident" id="8127503">r</span><span class="op" id="8127504">[</span><span class="num" id="8127505">1</span><span class="op" id="8127506">]</span><span class="op" id="8127507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127514">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127518">if</span>&nbsp;<span class="ident" id="8127521">n</span>&nbsp;<span class="op" id="8127523">&lt;</span>&nbsp;<span class="num" id="8127525">0</span>&nbsp;<span class="op" id="8127527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8127531">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127592">for</span>&nbsp;<span class="ident" id="8127596">i</span><span class="op" id="8127597">,</span>&nbsp;<span class="ident" id="8127599">r</span>&nbsp;<span class="op" id="8127601">:=</span>&nbsp;<span class="keyword" id="8127604">range</span>&nbsp;<span class="ident" id="8127610">res</span>&nbsp;<span class="op" id="8127614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127619">e</span>&nbsp;<span class="op" id="8127621">:=</span>&nbsp;<span class="ident" id="8127624">exp</span><span class="op" id="8127627">[</span><span class="ident" id="8127628">i</span><span class="op" id="8127629">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127634">if</span>&nbsp;<span class="ident" id="8127637">r</span><span class="op" id="8127638">[</span><span class="num" id="8127639">0</span><span class="op" id="8127640">]</span>&nbsp;<span class="op" id="8127642">!=</span>&nbsp;<span class="ident" id="8127645">e</span><span class="op" id="8127646">[</span><span class="num" id="8127647">0</span><span class="op" id="8127648">]</span>&nbsp;<span class="op" id="8127650">||</span>&nbsp;<span class="ident" id="8127653">r</span><span class="op" id="8127654">[</span><span class="num" id="8127655">1</span><span class="op" id="8127656">]</span>&nbsp;<span class="op" id="8127658">!=</span>&nbsp;<span class="ident" id="8127661">e</span><span class="op" id="8127662">[</span><span class="num" id="8127663">1</span><span class="op" id="8127664">]</span>&nbsp;<span class="op" id="8127666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127672">t</span><span class="op" id="8127673">.</span><span class="ident" id="8127674">Errorf</span><span class="op" id="8127680">(</span><span class="string" id="8127681">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;match&nbsp;[%d,&nbsp;%d];&nbsp;got&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="8127757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127764">tc</span><span class="op" id="8127766">.</span><span class="ident" id="8127767">name</span><span class="op" id="8127771">,</span>&nbsp;<span class="ident" id="8127773">rx</span><span class="op" id="8127775">,</span>&nbsp;<span class="ident" id="8127777">i</span><span class="op" id="8127778">,</span>&nbsp;<span class="ident" id="8127780">e</span><span class="op" id="8127781">[</span><span class="num" id="8127782">0</span><span class="op" id="8127783">]</span><span class="op" id="8127784">,</span>&nbsp;<span class="ident" id="8127786">e</span><span class="op" id="8127787">[</span><span class="num" id="8127788">1</span><span class="op" id="8127789">]</span><span class="op" id="8127790">,</span>&nbsp;<span class="ident" id="8127792">r</span><span class="op" id="8127793">[</span><span class="num" id="8127794">0</span><span class="op" id="8127795">]</span><span class="op" id="8127796">,</span>&nbsp;<span class="ident" id="8127798">r</span><span class="op" id="8127799">[</span><span class="num" id="8127800">1</span><span class="op" id="8127801">]</span><span class="op" id="8127802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127811">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127814">}</span><br>
<span class="lineno"></span><span class="op" id="8127816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8127819">func</span>&nbsp;<span class="ident" id="8127824">testLookups</span><span class="op" id="8127835">(</span><span class="ident" id="8127836">t</span>&nbsp;<span class="op" id="8127838">*</span><span class="ident" id="8127839">testing</span><span class="op" id="8127846">.</span><span class="ident" id="8127847">T</span><span class="op" id="8127848">,</span>&nbsp;<span class="ident" id="8127850">tc</span>&nbsp;<span class="op" id="8127853">*</span><span class="ident" id="8127854">testCase</span><span class="op" id="8127862">,</span>&nbsp;<span class="ident" id="8127864">x</span>&nbsp;<span class="op" id="8127866">*</span><span class="ident" id="8127867">Index</span><span class="op" id="8127872">,</span>&nbsp;<span class="ident" id="8127874">n</span>&nbsp;<span class="builtintype" id="8127876">int</span><span class="op" id="8127879">)</span>&nbsp;<span class="op" id="8127881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127884">for</span>&nbsp;<span class="ident" id="8127888">_</span><span class="op" id="8127889">,</span>&nbsp;<span class="ident" id="8127891">pat</span>&nbsp;<span class="op" id="8127895">:=</span>&nbsp;<span class="keyword" id="8127898">range</span>&nbsp;<span class="ident" id="8127904">tc</span><span class="op" id="8127906">.</span><span class="ident" id="8127907">patterns</span>&nbsp;<span class="op" id="8127916">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127920">testLookup</span><span class="op" id="8127930">(</span><span class="ident" id="8127931">t</span><span class="op" id="8127932">,</span>&nbsp;<span class="ident" id="8127934">tc</span><span class="op" id="8127936">,</span>&nbsp;<span class="ident" id="8127938">x</span><span class="op" id="8127939">,</span>&nbsp;<span class="ident" id="8127941">pat</span><span class="op" id="8127944">,</span>&nbsp;<span class="ident" id="8127946">n</span><span class="op" id="8127947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127951">if</span>&nbsp;<span class="ident" id="8127954">rx</span><span class="op" id="8127956">,</span>&nbsp;<span class="ident" id="8127958">err</span>&nbsp;<span class="op" id="8127962">:=</span>&nbsp;<span class="ident" id="8127965">regexp</span><span class="op" id="8127971">.</span><span class="ident" id="8127972">Compile</span><span class="op" id="8127979">(</span><span class="ident" id="8127980">pat</span><span class="op" id="8127983">)</span><span class="op" id="8127984">;</span>&nbsp;<span class="ident" id="8127986">err</span>&nbsp;<span class="op" id="8127990">==</span>&nbsp;<span class="ident" id="8127993">nil</span>&nbsp;<span class="op" id="8127997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128002">testFindAllIndex</span><span class="op" id="8128018">(</span><span class="ident" id="8128019">t</span><span class="op" id="8128020">,</span>&nbsp;<span class="ident" id="8128022">tc</span><span class="op" id="8128024">,</span>&nbsp;<span class="ident" id="8128026">x</span><span class="op" id="8128027">,</span>&nbsp;<span class="ident" id="8128029">rx</span><span class="op" id="8128031">,</span>&nbsp;<span class="ident" id="8128033">n</span><span class="op" id="8128034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128041">}</span><br>
<span class="lineno">205</span><span class="op" id="8128043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8128046">//&nbsp;index&nbsp;is&nbsp;used&nbsp;to&nbsp;hide&nbsp;the&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="keyword" id="8128090">type</span>&nbsp;<span class="ident" id="8128095">index</span>&nbsp;<span class="ident" id="8128101">Index</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="8128108">func</span>&nbsp;<span class="op" id="8128113">(</span><span class="ident" id="8128114">x</span>&nbsp;<span class="op" id="8128116">*</span><span class="ident" id="8128117">index</span><span class="op" id="8128122">)</span>&nbsp;<span class="ident" id="8128124">Len</span><span class="op" id="8128127">(</span><span class="op" id="8128128">)</span>&nbsp;<span class="builtintype" id="8128130">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128144">{</span>&nbsp;<span class="keyword" id="8128146">return</span>&nbsp;<span class="builtinfunc" id="8128153">len</span><span class="op" id="8128156">(</span><span class="ident" id="8128157">x</span><span class="op" id="8128158">.</span><span class="ident" id="8128159">sa</span><span class="op" id="8128161">)</span>&nbsp;<span class="op" id="8128163">}</span><br>
<span class="lineno"></span><span class="keyword" id="8128165">func</span>&nbsp;<span class="op" id="8128170">(</span><span class="ident" id="8128171">x</span>&nbsp;<span class="op" id="8128173">*</span><span class="ident" id="8128174">index</span><span class="op" id="8128179">)</span>&nbsp;<span class="ident" id="8128181">Less</span><span class="op" id="8128185">(</span><span class="ident" id="8128186">i</span><span class="op" id="8128187">,</span>&nbsp;<span class="ident" id="8128189">j</span>&nbsp;<span class="builtintype" id="8128191">int</span><span class="op" id="8128194">)</span>&nbsp;<span class="builtintype" id="8128196">bool</span>&nbsp;<span class="op" id="8128201">{</span>&nbsp;<span class="keyword" id="8128203">return</span>&nbsp;<span class="ident" id="8128210">bytes</span><span class="op" id="8128215">.</span><span class="ident" id="8128216">Compare</span><span class="op" id="8128223">(</span><span class="ident" id="8128224">x</span><span class="op" id="8128225">.</span><span class="ident" id="8128226">at</span><span class="op" id="8128228">(</span><span class="ident" id="8128229">i</span><span class="op" id="8128230">)</span><span class="op" id="8128231">,</span>&nbsp;<span class="ident" id="8128233">x</span><span class="op" id="8128234">.</span><span class="ident" id="8128235">at</span><span class="op" id="8128237">(</span><span class="ident" id="8128238">j</span><span class="op" id="8128239">)</span><span class="op" id="8128240">)</span>&nbsp;<span class="op" id="8128242">&lt;</span>&nbsp;<span class="num" id="8128244">0</span>&nbsp;<span class="op" id="8128246">}</span><br>
<span class="lineno"></span><span class="keyword" id="8128248">func</span>&nbsp;<span class="op" id="8128253">(</span><span class="ident" id="8128254">x</span>&nbsp;<span class="op" id="8128256">*</span><span class="ident" id="8128257">index</span><span class="op" id="8128262">)</span>&nbsp;<span class="ident" id="8128264">Swap</span><span class="op" id="8128268">(</span><span class="ident" id="8128269">i</span><span class="op" id="8128270">,</span>&nbsp;<span class="ident" id="8128272">j</span>&nbsp;<span class="builtintype" id="8128274">int</span><span class="op" id="8128277">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128284">{</span>&nbsp;<span class="ident" id="8128286">x</span><span class="op" id="8128287">.</span><span class="ident" id="8128288">sa</span><span class="op" id="8128290">[</span><span class="ident" id="8128291">i</span><span class="op" id="8128292">]</span><span class="op" id="8128293">,</span>&nbsp;<span class="ident" id="8128295">x</span><span class="op" id="8128296">.</span><span class="ident" id="8128297">sa</span><span class="op" id="8128299">[</span><span class="ident" id="8128300">j</span><span class="op" id="8128301">]</span>&nbsp;<span class="op" id="8128303">=</span>&nbsp;<span class="ident" id="8128305">x</span><span class="op" id="8128306">.</span><span class="ident" id="8128307">sa</span><span class="op" id="8128309">[</span><span class="ident" id="8128310">j</span><span class="op" id="8128311">]</span><span class="op" id="8128312">,</span>&nbsp;<span class="ident" id="8128314">x</span><span class="op" id="8128315">.</span><span class="ident" id="8128316">sa</span><span class="op" id="8128318">[</span><span class="ident" id="8128319">i</span><span class="op" id="8128320">]</span>&nbsp;<span class="op" id="8128322">}</span><br>
<span class="lineno"></span><span class="keyword" id="8128324">func</span>&nbsp;<span class="op" id="8128329">(</span><span class="ident" id="8128330">a</span>&nbsp;<span class="op" id="8128332">*</span><span class="ident" id="8128333">index</span><span class="op" id="8128338">)</span>&nbsp;<span class="ident" id="8128340">at</span><span class="op" id="8128342">(</span><span class="ident" id="8128343">i</span>&nbsp;<span class="builtintype" id="8128345">int</span><span class="op" id="8128348">)</span>&nbsp;<span class="op" id="8128350">[</span><span class="op" id="8128351">]</span><span class="builtintype" id="8128352">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8128360">{</span>&nbsp;<span class="keyword" id="8128362">return</span>&nbsp;<span class="ident" id="8128369">a</span><span class="op" id="8128370">.</span><span class="ident" id="8128371">data</span><span class="op" id="8128375">[</span><span class="ident" id="8128376">a</span><span class="op" id="8128377">.</span><span class="ident" id="8128378">sa</span><span class="op" id="8128380">[</span><span class="ident" id="8128381">i</span><span class="op" id="8128382">]</span><span class="op" id="8128383">:</span><span class="op" id="8128384">]</span>&nbsp;<span class="op" id="8128386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8128389">func</span>&nbsp;<span class="ident" id="8128394">testConstruction</span><span class="op" id="8128410">(</span><span class="ident" id="8128411">t</span>&nbsp;<span class="op" id="8128413">*</span><span class="ident" id="8128414">testing</span><span class="op" id="8128421">.</span><span class="ident" id="8128422">T</span><span class="op" id="8128423">,</span>&nbsp;<span class="ident" id="8128425">tc</span>&nbsp;<span class="op" id="8128428">*</span><span class="ident" id="8128429">testCase</span><span class="op" id="8128437">,</span>&nbsp;<span class="ident" id="8128439">x</span>&nbsp;<span class="op" id="8128441">*</span><span class="ident" id="8128442">Index</span><span class="op" id="8128447">)</span>&nbsp;<span class="op" id="8128449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128452">if</span>&nbsp;<span class="op" id="8128455">!</span><span class="ident" id="8128456">sort</span><span class="op" id="8128460">.</span><span class="ident" id="8128461">IsSorted</span><span class="op" id="8128469">(</span><span class="op" id="8128470">(</span><span class="op" id="8128471">*</span><span class="ident" id="8128472">index</span><span class="op" id="8128477">)</span><span class="op" id="8128478">(</span><span class="ident" id="8128479">x</span><span class="op" id="8128480">)</span><span class="op" id="8128481">)</span>&nbsp;<span class="op" id="8128483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128487">t</span><span class="op" id="8128488">.</span><span class="ident" id="8128489">Errorf</span><span class="op" id="8128495">(</span><span class="string" id="8128496">&#34;failed&nbsp;testConstruction&nbsp;%s&#34;</span><span class="op" id="8128524">,</span>&nbsp;<span class="ident" id="8128526">tc</span><span class="op" id="8128528">.</span><span class="ident" id="8128529">name</span><span class="op" id="8128533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128536">}</span><br>
<span class="lineno"></span><span class="op" id="8128538">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8128541">func</span>&nbsp;<span class="ident" id="8128546">equal</span><span class="op" id="8128551">(</span><span class="ident" id="8128552">x</span><span class="op" id="8128553">,</span>&nbsp;<span class="ident" id="8128555">y</span>&nbsp;<span class="op" id="8128557">*</span><span class="ident" id="8128558">Index</span><span class="op" id="8128563">)</span>&nbsp;<span class="builtintype" id="8128565">bool</span>&nbsp;<span class="op" id="8128570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128573">if</span>&nbsp;<span class="op" id="8128576">!</span><span class="ident" id="8128577">bytes</span><span class="op" id="8128582">.</span><span class="ident" id="8128583">Equal</span><span class="op" id="8128588">(</span><span class="ident" id="8128589">x</span><span class="op" id="8128590">.</span><span class="ident" id="8128591">data</span><span class="op" id="8128595">,</span>&nbsp;<span class="ident" id="8128597">y</span><span class="op" id="8128598">.</span><span class="ident" id="8128599">data</span><span class="op" id="8128603">)</span>&nbsp;<span class="op" id="8128605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128609">return</span>&nbsp;<span class="ident" id="8128616">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128623">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128626">for</span>&nbsp;<span class="ident" id="8128630">i</span><span class="op" id="8128631">,</span>&nbsp;<span class="ident" id="8128633">j</span>&nbsp;<span class="op" id="8128635">:=</span>&nbsp;<span class="keyword" id="8128638">range</span>&nbsp;<span class="ident" id="8128644">x</span><span class="op" id="8128645">.</span><span class="ident" id="8128646">sa</span>&nbsp;<span class="op" id="8128649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128653">if</span>&nbsp;<span class="ident" id="8128656">j</span>&nbsp;<span class="op" id="8128658">!=</span>&nbsp;<span class="ident" id="8128661">y</span><span class="op" id="8128662">.</span><span class="ident" id="8128663">sa</span><span class="op" id="8128665">[</span><span class="ident" id="8128666">i</span><span class="op" id="8128667">]</span>&nbsp;<span class="op" id="8128669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128674">return</span>&nbsp;<span class="ident" id="8128681">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128692">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128695">return</span>&nbsp;<span class="ident" id="8128702">true</span><br>
<span class="lineno"></span><span class="op" id="8128707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8128710">//&nbsp;returns&nbsp;the&nbsp;serialized&nbsp;index&nbsp;size</span><br>
<span class="lineno"></span><span class="keyword" id="8128747">func</span>&nbsp;<span class="ident" id="8128752">testSaveRestore</span><span class="op" id="8128767">(</span><span class="ident" id="8128768">t</span>&nbsp;<span class="op" id="8128770">*</span><span class="ident" id="8128771">testing</span><span class="op" id="8128778">.</span><span class="ident" id="8128779">T</span><span class="op" id="8128780">,</span>&nbsp;<span class="ident" id="8128782">tc</span>&nbsp;<span class="op" id="8128785">*</span><span class="ident" id="8128786">testCase</span><span class="op" id="8128794">,</span>&nbsp;<span class="ident" id="8128796">x</span>&nbsp;<span class="op" id="8128798">*</span><span class="ident" id="8128799">Index</span><span class="op" id="8128804">)</span>&nbsp;<span class="builtintype" id="8128806">int</span>&nbsp;<span class="op" id="8128810">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128813">var</span>&nbsp;<span class="ident" id="8128817">buf</span>&nbsp;<span class="ident" id="8128821">bytes</span><span class="op" id="8128826">.</span><span class="ident" id="8128827">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128835">if</span>&nbsp;<span class="ident" id="8128838">err</span>&nbsp;<span class="op" id="8128842">:=</span>&nbsp;<span class="ident" id="8128845">x</span><span class="op" id="8128846">.</span><span class="ident" id="8128847">Write</span><span class="op" id="8128852">(</span><span class="op" id="8128853">&amp;</span><span class="ident" id="8128854">buf</span><span class="op" id="8128857">)</span><span class="op" id="8128858">;</span>&nbsp;<span class="ident" id="8128860">err</span>&nbsp;<span class="op" id="8128864">!=</span>&nbsp;<span class="ident" id="8128867">nil</span>&nbsp;<span class="op" id="8128871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128875">t</span><span class="op" id="8128876">.</span><span class="ident" id="8128877">Errorf</span><span class="op" id="8128883">(</span><span class="string" id="8128884">&#34;failed&nbsp;writing&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="8128914">,</span>&nbsp;<span class="ident" id="8128916">tc</span><span class="op" id="8128918">.</span><span class="ident" id="8128919">name</span><span class="op" id="8128923">,</span>&nbsp;<span class="ident" id="8128925">err</span><span class="op" id="8128928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128934">size</span>&nbsp;<span class="op" id="8128939">:=</span>&nbsp;<span class="ident" id="8128942">buf</span><span class="op" id="8128945">.</span><span class="ident" id="8128946">Len</span><span class="op" id="8128949">(</span><span class="op" id="8128950">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128953">var</span>&nbsp;<span class="ident" id="8128957">y</span>&nbsp;<span class="ident" id="8128959">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128966">if</span>&nbsp;<span class="ident" id="8128969">err</span>&nbsp;<span class="op" id="8128973">:=</span>&nbsp;<span class="ident" id="8128976">y</span><span class="op" id="8128977">.</span><span class="ident" id="8128978">Read</span><span class="op" id="8128982">(</span><span class="op" id="8128983">&amp;</span><span class="ident" id="8128984">buf</span><span class="op" id="8128987">)</span><span class="op" id="8128988">;</span>&nbsp;<span class="ident" id="8128990">err</span>&nbsp;<span class="op" id="8128994">!=</span>&nbsp;<span class="ident" id="8128997">nil</span>&nbsp;<span class="op" id="8129001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129005">t</span><span class="op" id="8129006">.</span><span class="ident" id="8129007">Errorf</span><span class="op" id="8129013">(</span><span class="string" id="8129014">&#34;failed&nbsp;reading&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="8129044">,</span>&nbsp;<span class="ident" id="8129046">tc</span><span class="op" id="8129048">.</span><span class="ident" id="8129049">name</span><span class="op" id="8129053">,</span>&nbsp;<span class="ident" id="8129055">err</span><span class="op" id="8129058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129064">if</span>&nbsp;<span class="op" id="8129067">!</span><span class="ident" id="8129068">equal</span><span class="op" id="8129073">(</span><span class="ident" id="8129074">x</span><span class="op" id="8129075">,</span>&nbsp;<span class="op" id="8129077">&amp;</span><span class="ident" id="8129078">y</span><span class="op" id="8129079">)</span>&nbsp;<span class="op" id="8129081">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129085">t</span><span class="op" id="8129086">.</span><span class="ident" id="8129087">Errorf</span><span class="op" id="8129093">(</span><span class="string" id="8129094">&#34;restored&nbsp;index&nbsp;doesn&#39;t&nbsp;match&nbsp;saved&nbsp;index&nbsp;%s&#34;</span><span class="op" id="8129139">,</span>&nbsp;<span class="ident" id="8129141">tc</span><span class="op" id="8129143">.</span><span class="ident" id="8129144">name</span><span class="op" id="8129148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129154">return</span>&nbsp;<span class="ident" id="8129161">size</span><br>
<span class="lineno"></span><span class="op" id="8129166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="8129169">func</span>&nbsp;<span class="ident" id="8129174">TestIndex</span><span class="op" id="8129183">(</span><span class="ident" id="8129184">t</span>&nbsp;<span class="op" id="8129186">*</span><span class="ident" id="8129187">testing</span><span class="op" id="8129194">.</span><span class="ident" id="8129195">T</span><span class="op" id="8129196">)</span>&nbsp;<span class="op" id="8129198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129201">for</span>&nbsp;<span class="ident" id="8129205">_</span><span class="op" id="8129206">,</span>&nbsp;<span class="ident" id="8129208">tc</span>&nbsp;<span class="op" id="8129211">:=</span>&nbsp;<span class="keyword" id="8129214">range</span>&nbsp;<span class="ident" id="8129220">testCases</span>&nbsp;<span class="op" id="8129230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129234">x</span>&nbsp;<span class="op" id="8129236">:=</span>&nbsp;<span class="ident" id="8129239">New</span><span class="op" id="8129242">(</span><span class="op" id="8129243">[</span><span class="op" id="8129244">]</span><span class="builtintype" id="8129245">byte</span><span class="op" id="8129249">(</span><span class="ident" id="8129250">tc</span><span class="op" id="8129252">.</span><span class="ident" id="8129253">source</span><span class="op" id="8129259">)</span><span class="op" id="8129260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129264">testConstruction</span><span class="op" id="8129280">(</span><span class="ident" id="8129281">t</span><span class="op" id="8129282">,</span>&nbsp;<span class="op" id="8129284">&amp;</span><span class="ident" id="8129285">tc</span><span class="op" id="8129287">,</span>&nbsp;<span class="ident" id="8129289">x</span><span class="op" id="8129290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129294">testSaveRestore</span><span class="op" id="8129309">(</span><span class="ident" id="8129310">t</span><span class="op" id="8129311">,</span>&nbsp;<span class="op" id="8129313">&amp;</span><span class="ident" id="8129314">tc</span><span class="op" id="8129316">,</span>&nbsp;<span class="ident" id="8129318">x</span><span class="op" id="8129319">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129323">testLookups</span><span class="op" id="8129334">(</span><span class="ident" id="8129335">t</span><span class="op" id="8129336">,</span>&nbsp;<span class="op" id="8129338">&amp;</span><span class="ident" id="8129339">tc</span><span class="op" id="8129341">,</span>&nbsp;<span class="ident" id="8129343">x</span><span class="op" id="8129344">,</span>&nbsp;<span class="num" id="8129346">0</span><span class="op" id="8129347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129351">testLookups</span><span class="op" id="8129362">(</span><span class="ident" id="8129363">t</span><span class="op" id="8129364">,</span>&nbsp;<span class="op" id="8129366">&amp;</span><span class="ident" id="8129367">tc</span><span class="op" id="8129369">,</span>&nbsp;<span class="ident" id="8129371">x</span><span class="op" id="8129372">,</span>&nbsp;<span class="num" id="8129374">1</span><span class="op" id="8129375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129379">testLookups</span><span class="op" id="8129390">(</span><span class="ident" id="8129391">t</span><span class="op" id="8129392">,</span>&nbsp;<span class="op" id="8129394">&amp;</span><span class="ident" id="8129395">tc</span><span class="op" id="8129397">,</span>&nbsp;<span class="ident" id="8129399">x</span><span class="op" id="8129400">,</span>&nbsp;<span class="num" id="8129402">10</span><span class="op" id="8129404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129408">testLookups</span><span class="op" id="8129419">(</span><span class="ident" id="8129420">t</span><span class="op" id="8129421">,</span>&nbsp;<span class="op" id="8129423">&amp;</span><span class="ident" id="8129424">tc</span><span class="op" id="8129426">,</span>&nbsp;<span class="ident" id="8129428">x</span><span class="op" id="8129429">,</span>&nbsp;<span class="num" id="8129431">2e9</span><span class="op" id="8129434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129438">testLookups</span><span class="op" id="8129449">(</span><span class="ident" id="8129450">t</span><span class="op" id="8129451">,</span>&nbsp;<span class="op" id="8129453">&amp;</span><span class="ident" id="8129454">tc</span><span class="op" id="8129456">,</span>&nbsp;<span class="ident" id="8129458">x</span><span class="op" id="8129459">,</span>&nbsp;<span class="op" id="8129461">-</span><span class="num" id="8129462">1</span><span class="op" id="8129463">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129466">}</span><br>
<span class="lineno"></span><span class="op" id="8129468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8129471">//&nbsp;Of&nbsp;all&nbsp;possible&nbsp;inputs,&nbsp;the&nbsp;random&nbsp;bytes&nbsp;have&nbsp;the&nbsp;least&nbsp;amount&nbsp;of&nbsp;substring</span><br>
<span class="lineno"></span><span class="comment" id="8129550">//&nbsp;repetition,&nbsp;and&nbsp;the&nbsp;repeated&nbsp;bytes&nbsp;have&nbsp;the&nbsp;most.&nbsp;For&nbsp;most&nbsp;algorithms,</span><br>
<span class="lineno">265</span><span class="comment" id="8129624">//&nbsp;the&nbsp;running&nbsp;time&nbsp;of&nbsp;every&nbsp;input&nbsp;will&nbsp;be&nbsp;between&nbsp;these&nbsp;two.</span><br>
<span class="lineno"></span><span class="keyword" id="8129686">func</span>&nbsp;<span class="ident" id="8129691">benchmarkNew</span><span class="op" id="8129703">(</span><span class="ident" id="8129704">b</span>&nbsp;<span class="op" id="8129706">*</span><span class="ident" id="8129707">testing</span><span class="op" id="8129714">.</span><span class="ident" id="8129715">B</span><span class="op" id="8129716">,</span>&nbsp;<span class="ident" id="8129718">random</span>&nbsp;<span class="builtintype" id="8129725">bool</span><span class="op" id="8129729">)</span>&nbsp;<span class="op" id="8129731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129734">b</span><span class="op" id="8129735">.</span><span class="ident" id="8129736">StopTimer</span><span class="op" id="8129745">(</span><span class="op" id="8129746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129749">data</span>&nbsp;<span class="op" id="8129754">:=</span>&nbsp;<span class="builtinfunc" id="8129757">make</span><span class="op" id="8129761">(</span><span class="op" id="8129762">[</span><span class="op" id="8129763">]</span><span class="builtintype" id="8129764">byte</span><span class="op" id="8129768">,</span>&nbsp;<span class="num" id="8129770">1e6</span><span class="op" id="8129773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129776">if</span>&nbsp;<span class="ident" id="8129779">random</span>&nbsp;<span class="op" id="8129786">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129790">for</span>&nbsp;<span class="ident" id="8129794">i</span>&nbsp;<span class="op" id="8129796">:=</span>&nbsp;<span class="keyword" id="8129799">range</span>&nbsp;<span class="ident" id="8129805">data</span>&nbsp;<span class="op" id="8129810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129815">data</span><span class="op" id="8129819">[</span><span class="ident" id="8129820">i</span><span class="op" id="8129821">]</span>&nbsp;<span class="op" id="8129823">=</span>&nbsp;<span class="builtintype" id="8129825">byte</span><span class="op" id="8129829">(</span><span class="ident" id="8129830">rand</span><span class="op" id="8129834">.</span><span class="ident" id="8129835">Intn</span><span class="op" id="8129839">(</span><span class="num" id="8129840">256</span><span class="op" id="8129843">)</span><span class="op" id="8129844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129854">b</span><span class="op" id="8129855">.</span><span class="ident" id="8129856">StartTimer</span><span class="op" id="8129866">(</span><span class="op" id="8129867">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129870">for</span>&nbsp;<span class="ident" id="8129874">i</span>&nbsp;<span class="op" id="8129876">:=</span>&nbsp;<span class="num" id="8129879">0</span><span class="op" id="8129880">;</span>&nbsp;<span class="ident" id="8129882">i</span>&nbsp;<span class="op" id="8129884">&lt;</span>&nbsp;<span class="ident" id="8129886">b</span><span class="op" id="8129887">.</span><span class="ident" id="8129888">N</span><span class="op" id="8129889">;</span>&nbsp;<span class="ident" id="8129891">i</span><span class="op" id="8129892">++</span>&nbsp;<span class="op" id="8129895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129899">New</span><span class="op" id="8129902">(</span><span class="ident" id="8129903">data</span><span class="op" id="8129907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129910">}</span><br>
<span class="lineno"></span><span class="op" id="8129912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8129915">func</span>&nbsp;<span class="ident" id="8129920">BenchmarkNewIndexRandom</span><span class="op" id="8129943">(</span><span class="ident" id="8129944">b</span>&nbsp;<span class="op" id="8129946">*</span><span class="ident" id="8129947">testing</span><span class="op" id="8129954">.</span><span class="ident" id="8129955">B</span><span class="op" id="8129956">)</span>&nbsp;<span class="op" id="8129958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129961">benchmarkNew</span><span class="op" id="8129973">(</span><span class="ident" id="8129974">b</span><span class="op" id="8129975">,</span>&nbsp;<span class="ident" id="8129977">true</span><span class="op" id="8129981">)</span><br>
<span class="lineno"></span><span class="op" id="8129983">}</span><br>
<span class="lineno"></span><span class="keyword" id="8129985">func</span>&nbsp;<span class="ident" id="8129990">BenchmarkNewIndexRepeat</span><span class="op" id="8130013">(</span><span class="ident" id="8130014">b</span>&nbsp;<span class="op" id="8130016">*</span><span class="ident" id="8130017">testing</span><span class="op" id="8130024">.</span><span class="ident" id="8130025">B</span><span class="op" id="8130026">)</span>&nbsp;<span class="op" id="8130028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130031">benchmarkNew</span><span class="op" id="8130043">(</span><span class="ident" id="8130044">b</span><span class="op" id="8130045">,</span>&nbsp;<span class="ident" id="8130047">false</span><span class="op" id="8130052">)</span><br>
<span class="lineno">285</span><span class="op" id="8130054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8130057">func</span>&nbsp;<span class="ident" id="8130062">BenchmarkSaveRestore</span><span class="op" id="8130082">(</span><span class="ident" id="8130083">b</span>&nbsp;<span class="op" id="8130085">*</span><span class="ident" id="8130086">testing</span><span class="op" id="8130093">.</span><span class="ident" id="8130094">B</span><span class="op" id="8130095">)</span>&nbsp;<span class="op" id="8130097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130100">b</span><span class="op" id="8130101">.</span><span class="ident" id="8130102">StopTimer</span><span class="op" id="8130111">(</span><span class="op" id="8130112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130115">r</span>&nbsp;<span class="op" id="8130117">:=</span>&nbsp;<span class="ident" id="8130120">rand</span><span class="op" id="8130124">.</span><span class="ident" id="8130125">New</span><span class="op" id="8130128">(</span><span class="ident" id="8130129">rand</span><span class="op" id="8130133">.</span><span class="ident" id="8130134">NewSource</span><span class="op" id="8130143">(</span><span class="num" id="8130144">0x5a77a1</span><span class="op" id="8130152">)</span><span class="op" id="8130153">)</span>&nbsp;<span class="comment" id="8130155">//&nbsp;guarantee&nbsp;always&nbsp;same&nbsp;sequence</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130190">data</span>&nbsp;<span class="op" id="8130195">:=</span>&nbsp;<span class="builtinfunc" id="8130198">make</span><span class="op" id="8130202">(</span><span class="op" id="8130203">[</span><span class="op" id="8130204">]</span><span class="builtintype" id="8130205">byte</span><span class="op" id="8130209">,</span>&nbsp;<span class="num" id="8130211">1</span><span class="op" id="8130212">&lt;&lt;</span><span class="num" id="8130214">20</span><span class="op" id="8130216">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8130230">//&nbsp;1MB&nbsp;of&nbsp;data&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130255">for</span>&nbsp;<span class="ident" id="8130259">i</span>&nbsp;<span class="op" id="8130261">:=</span>&nbsp;<span class="keyword" id="8130264">range</span>&nbsp;<span class="ident" id="8130270">data</span>&nbsp;<span class="op" id="8130275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130279">data</span><span class="op" id="8130283">[</span><span class="ident" id="8130284">i</span><span class="op" id="8130285">]</span>&nbsp;<span class="op" id="8130287">=</span>&nbsp;<span class="builtintype" id="8130289">byte</span><span class="op" id="8130293">(</span><span class="ident" id="8130294">r</span><span class="op" id="8130295">.</span><span class="ident" id="8130296">Intn</span><span class="op" id="8130300">(</span><span class="num" id="8130301">256</span><span class="op" id="8130304">)</span><span class="op" id="8130305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130311">x</span>&nbsp;<span class="op" id="8130313">:=</span>&nbsp;<span class="ident" id="8130316">New</span><span class="op" id="8130319">(</span><span class="ident" id="8130320">data</span><span class="op" id="8130324">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130327">size</span>&nbsp;<span class="op" id="8130332">:=</span>&nbsp;<span class="ident" id="8130335">testSaveRestore</span><span class="op" id="8130350">(</span><span class="ident" id="8130351">nil</span><span class="op" id="8130354">,</span>&nbsp;<span class="ident" id="8130356">nil</span><span class="op" id="8130359">,</span>&nbsp;<span class="ident" id="8130361">x</span><span class="op" id="8130362">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8130370">//&nbsp;verify&nbsp;correctness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130393">buf</span>&nbsp;<span class="op" id="8130397">:=</span>&nbsp;<span class="ident" id="8130400">bytes</span><span class="op" id="8130405">.</span><span class="ident" id="8130406">NewBuffer</span><span class="op" id="8130415">(</span><span class="builtinfunc" id="8130416">make</span><span class="op" id="8130420">(</span><span class="op" id="8130421">[</span><span class="op" id="8130422">]</span><span class="builtintype" id="8130423">byte</span><span class="op" id="8130427">,</span>&nbsp;<span class="ident" id="8130429">size</span><span class="op" id="8130433">)</span><span class="op" id="8130434">)</span>&nbsp;<span class="comment" id="8130436">//&nbsp;avoid&nbsp;growing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130454">b</span><span class="op" id="8130455">.</span><span class="ident" id="8130456">SetBytes</span><span class="op" id="8130464">(</span><span class="ident" id="8130465">int64</span><span class="op" id="8130470">(</span><span class="ident" id="8130471">size</span><span class="op" id="8130475">)</span><span class="op" id="8130476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130479">b</span><span class="op" id="8130480">.</span><span class="ident" id="8130481">StartTimer</span><span class="op" id="8130491">(</span><span class="op" id="8130492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130495">for</span>&nbsp;<span class="ident" id="8130499">i</span>&nbsp;<span class="op" id="8130501">:=</span>&nbsp;<span class="num" id="8130504">0</span><span class="op" id="8130505">;</span>&nbsp;<span class="ident" id="8130507">i</span>&nbsp;<span class="op" id="8130509">&lt;</span>&nbsp;<span class="ident" id="8130511">b</span><span class="op" id="8130512">.</span><span class="ident" id="8130513">N</span><span class="op" id="8130514">;</span>&nbsp;<span class="ident" id="8130516">i</span><span class="op" id="8130517">++</span>&nbsp;<span class="op" id="8130520">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130524">x</span><span class="op" id="8130525">.</span><span class="ident" id="8130526">Write</span><span class="op" id="8130531">(</span><span class="ident" id="8130532">buf</span><span class="op" id="8130535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130539">var</span>&nbsp;<span class="ident" id="8130543">y</span>&nbsp;<span class="ident" id="8130545">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130553">y</span><span class="op" id="8130554">.</span><span class="ident" id="8130555">Read</span><span class="op" id="8130559">(</span><span class="ident" id="8130560">buf</span><span class="op" id="8130563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130566">}</span><br>
<span class="lineno"></span><span class="op" id="8130568">}</span>
</div>
</body>
</html>
