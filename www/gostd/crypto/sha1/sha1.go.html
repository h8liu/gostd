<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/sha1</h2>
<ul>
<li><a href="/gostd/crypto/sha1/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1.go.html" class="current">sha1.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1_test.go.html">sha1_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block.go.html">sha1block.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block_decl.go.html">sha1block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4491145">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4491200">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4491254">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4491305">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="4491380">package</span>&nbsp;<span class="ident" id="4491388">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4491394">import</span>&nbsp;<span class="op" id="4491401">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4491404">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4491414">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4491421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4491424">func</span>&nbsp;<span class="ident" id="4491429">init</span><span class="op" id="4491433">(</span><span class="op" id="4491434">)</span>&nbsp;<span class="op" id="4491436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491439">crypto</span><span class="op" id="4491445">.</span><span class="ident" id="4491446">RegisterHash</span><span class="op" id="4491458">(</span><span class="ident" id="4491459">crypto</span><span class="op" id="4491465">.</span><span class="ident" id="4491466">SHA1</span><span class="op" id="4491470">,</span>&nbsp;<span class="ident" id="4491472">New</span><span class="op" id="4491475">)</span><br>
<span class="lineno">15</span><span class="op" id="4491477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4491480">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4491521">const</span>&nbsp;<span class="ident" id="4491527">Size</span>&nbsp;<span class="op" id="4491532">=</span>&nbsp;<span class="num" id="4491534">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4491538">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4491573">const</span>&nbsp;<span class="ident" id="4491579">BlockSize</span>&nbsp;<span class="op" id="4491589">=</span>&nbsp;<span class="num" id="4491591">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4491595">const</span>&nbsp;<span class="op" id="4491601">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491604">chunk</span>&nbsp;<span class="op" id="4491610">=</span>&nbsp;<span class="num" id="4491612">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491616">init0</span>&nbsp;<span class="op" id="4491622">=</span>&nbsp;<span class="num" id="4491624">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491636">init1</span>&nbsp;<span class="op" id="4491642">=</span>&nbsp;<span class="num" id="4491644">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491656">init2</span>&nbsp;<span class="op" id="4491662">=</span>&nbsp;<span class="num" id="4491664">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491676">init3</span>&nbsp;<span class="op" id="4491682">=</span>&nbsp;<span class="num" id="4491684">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491696">init4</span>&nbsp;<span class="op" id="4491702">=</span>&nbsp;<span class="num" id="4491704">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="4491715">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4491718">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4491777">type</span>&nbsp;<span class="ident" id="4491782">digest</span>&nbsp;<span class="keyword" id="4491789">struct</span>&nbsp;<span class="op" id="4491796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491799">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4491803">[</span><span class="num" id="4491804">5</span><span class="op" id="4491805">]</span><span class="builtintype" id="4491806">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491814">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4491818">[</span><span class="ident" id="4491819">chunk</span><span class="op" id="4491824">]</span><span class="builtintype" id="4491825">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491831">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4491835">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4491840">len</span>&nbsp;<span class="ident" id="4491844">uint64</span><br>
<span class="lineno"></span><span class="op" id="4491851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4491854">func</span>&nbsp;<span class="op" id="4491859">(</span><span class="ident" id="4491860">d</span>&nbsp;<span class="op" id="4491862">*</span><span class="ident" id="4491863">digest</span><span class="op" id="4491869">)</span>&nbsp;<span class="ident" id="4491871">Reset</span><span class="op" id="4491876">(</span><span class="op" id="4491877">)</span>&nbsp;<span class="op" id="4491879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491882">d</span><span class="op" id="4491883">.</span><span class="ident" id="4491884">h</span><span class="op" id="4491885">[</span><span class="num" id="4491886">0</span><span class="op" id="4491887">]</span>&nbsp;<span class="op" id="4491889">=</span>&nbsp;<span class="ident" id="4491891">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491898">d</span><span class="op" id="4491899">.</span><span class="ident" id="4491900">h</span><span class="op" id="4491901">[</span><span class="num" id="4491902">1</span><span class="op" id="4491903">]</span>&nbsp;<span class="op" id="4491905">=</span>&nbsp;<span class="ident" id="4491907">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491914">d</span><span class="op" id="4491915">.</span><span class="ident" id="4491916">h</span><span class="op" id="4491917">[</span><span class="num" id="4491918">2</span><span class="op" id="4491919">]</span>&nbsp;<span class="op" id="4491921">=</span>&nbsp;<span class="ident" id="4491923">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491930">d</span><span class="op" id="4491931">.</span><span class="ident" id="4491932">h</span><span class="op" id="4491933">[</span><span class="num" id="4491934">3</span><span class="op" id="4491935">]</span>&nbsp;<span class="op" id="4491937">=</span>&nbsp;<span class="ident" id="4491939">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491946">d</span><span class="op" id="4491947">.</span><span class="ident" id="4491948">h</span><span class="op" id="4491949">[</span><span class="num" id="4491950">4</span><span class="op" id="4491951">]</span>&nbsp;<span class="op" id="4491953">=</span>&nbsp;<span class="ident" id="4491955">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491962">d</span><span class="op" id="4491963">.</span><span class="ident" id="4491964">nx</span>&nbsp;<span class="op" id="4491967">=</span>&nbsp;<span class="num" id="4491969">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491972">d</span><span class="op" id="4491973">.</span><span class="builtinfunc" id="4491974">len</span>&nbsp;<span class="op" id="4491978">=</span>&nbsp;<span class="num" id="4491980">0</span><br>
<span class="lineno"></span><span class="op" id="4491982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4491985">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4492045">func</span>&nbsp;<span class="ident" id="4492050">New</span><span class="op" id="4492053">(</span><span class="op" id="4492054">)</span>&nbsp;<span class="ident" id="4492056">hash</span><span class="op" id="4492060">.</span><span class="ident" id="4492061">Hash</span>&nbsp;<span class="op" id="4492066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492069">d</span>&nbsp;<span class="op" id="4492071">:=</span>&nbsp;<span class="builtinfunc" id="4492074">new</span><span class="op" id="4492077">(</span><span class="ident" id="4492078">digest</span><span class="op" id="4492084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492087">d</span><span class="op" id="4492088">.</span><span class="ident" id="4492089">Reset</span><span class="op" id="4492094">(</span><span class="op" id="4492095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492098">return</span>&nbsp;<span class="ident" id="4492105">d</span><br>
<span class="lineno">55</span><span class="op" id="4492107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4492110">func</span>&nbsp;<span class="op" id="4492115">(</span><span class="ident" id="4492116">d</span>&nbsp;<span class="op" id="4492118">*</span><span class="ident" id="4492119">digest</span><span class="op" id="4492125">)</span>&nbsp;<span class="ident" id="4492127">Size</span><span class="op" id="4492131">(</span><span class="op" id="4492132">)</span>&nbsp;<span class="builtintype" id="4492134">int</span>&nbsp;<span class="op" id="4492138">{</span>&nbsp;<span class="keyword" id="4492140">return</span>&nbsp;<span class="ident" id="4492147">Size</span>&nbsp;<span class="op" id="4492152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4492155">func</span>&nbsp;<span class="op" id="4492160">(</span><span class="ident" id="4492161">d</span>&nbsp;<span class="op" id="4492163">*</span><span class="ident" id="4492164">digest</span><span class="op" id="4492170">)</span>&nbsp;<span class="ident" id="4492172">BlockSize</span><span class="op" id="4492181">(</span><span class="op" id="4492182">)</span>&nbsp;<span class="builtintype" id="4492184">int</span>&nbsp;<span class="op" id="4492188">{</span>&nbsp;<span class="keyword" id="4492190">return</span>&nbsp;<span class="ident" id="4492197">BlockSize</span>&nbsp;<span class="op" id="4492207">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4492210">func</span>&nbsp;<span class="op" id="4492215">(</span><span class="ident" id="4492216">d</span>&nbsp;<span class="op" id="4492218">*</span><span class="ident" id="4492219">digest</span><span class="op" id="4492225">)</span>&nbsp;<span class="ident" id="4492227">Write</span><span class="op" id="4492232">(</span><span class="ident" id="4492233">p</span>&nbsp;<span class="op" id="4492235">[</span><span class="op" id="4492236">]</span><span class="builtintype" id="4492237">byte</span><span class="op" id="4492241">)</span>&nbsp;<span class="op" id="4492243">(</span><span class="ident" id="4492244">nn</span>&nbsp;<span class="builtintype" id="4492247">int</span><span class="op" id="4492250">,</span>&nbsp;<span class="ident" id="4492252">err</span>&nbsp;<span class="builtintype" id="4492256">error</span><span class="op" id="4492261">)</span>&nbsp;<span class="op" id="4492263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492266">nn</span>&nbsp;<span class="op" id="4492269">=</span>&nbsp;<span class="builtinfunc" id="4492271">len</span><span class="op" id="4492274">(</span><span class="ident" id="4492275">p</span><span class="op" id="4492276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492279">d</span><span class="op" id="4492280">.</span><span class="builtinfunc" id="4492281">len</span>&nbsp;<span class="op" id="4492285">+=</span>&nbsp;<span class="ident" id="4492288">uint64</span><span class="op" id="4492294">(</span><span class="ident" id="4492295">nn</span><span class="op" id="4492297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492300">if</span>&nbsp;<span class="ident" id="4492303">d</span><span class="op" id="4492304">.</span><span class="ident" id="4492305">nx</span>&nbsp;<span class="op" id="4492308">&gt;</span>&nbsp;<span class="num" id="4492310">0</span>&nbsp;<span class="op" id="4492312">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492316">n</span>&nbsp;<span class="op" id="4492318">:=</span>&nbsp;<span class="builtinfunc" id="4492321">copy</span><span class="op" id="4492325">(</span><span class="ident" id="4492326">d</span><span class="op" id="4492327">.</span><span class="ident" id="4492328">x</span><span class="op" id="4492329">[</span><span class="ident" id="4492330">d</span><span class="op" id="4492331">.</span><span class="ident" id="4492332">nx</span><span class="op" id="4492334">:</span><span class="op" id="4492335">]</span><span class="op" id="4492336">,</span>&nbsp;<span class="ident" id="4492338">p</span><span class="op" id="4492339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492343">d</span><span class="op" id="4492344">.</span><span class="ident" id="4492345">nx</span>&nbsp;<span class="op" id="4492348">+=</span>&nbsp;<span class="ident" id="4492351">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492355">if</span>&nbsp;<span class="ident" id="4492358">d</span><span class="op" id="4492359">.</span><span class="ident" id="4492360">nx</span>&nbsp;<span class="op" id="4492363">==</span>&nbsp;<span class="ident" id="4492366">chunk</span>&nbsp;<span class="op" id="4492372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492377">block</span><span class="op" id="4492382">(</span><span class="ident" id="4492383">d</span><span class="op" id="4492384">,</span>&nbsp;<span class="ident" id="4492386">d</span><span class="op" id="4492387">.</span><span class="ident" id="4492388">x</span><span class="op" id="4492389">[</span><span class="op" id="4492390">:</span><span class="op" id="4492391">]</span><span class="op" id="4492392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492397">d</span><span class="op" id="4492398">.</span><span class="ident" id="4492399">nx</span>&nbsp;<span class="op" id="4492402">=</span>&nbsp;<span class="num" id="4492404">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492412">p</span>&nbsp;<span class="op" id="4492414">=</span>&nbsp;<span class="ident" id="4492416">p</span><span class="op" id="4492417">[</span><span class="ident" id="4492418">n</span><span class="op" id="4492419">:</span><span class="op" id="4492420">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492426">if</span>&nbsp;<span class="builtinfunc" id="4492429">len</span><span class="op" id="4492432">(</span><span class="ident" id="4492433">p</span><span class="op" id="4492434">)</span>&nbsp;<span class="op" id="4492436">&gt;=</span>&nbsp;<span class="ident" id="4492439">chunk</span>&nbsp;<span class="op" id="4492445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492449">n</span>&nbsp;<span class="op" id="4492451">:=</span>&nbsp;<span class="builtinfunc" id="4492454">len</span><span class="op" id="4492457">(</span><span class="ident" id="4492458">p</span><span class="op" id="4492459">)</span>&nbsp;<span class="op" id="4492461">&amp;^</span>&nbsp;<span class="op" id="4492464">(</span><span class="ident" id="4492465">chunk</span>&nbsp;<span class="op" id="4492471">-</span>&nbsp;<span class="num" id="4492473">1</span><span class="op" id="4492474">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492478">block</span><span class="op" id="4492483">(</span><span class="ident" id="4492484">d</span><span class="op" id="4492485">,</span>&nbsp;<span class="ident" id="4492487">p</span><span class="op" id="4492488">[</span><span class="op" id="4492489">:</span><span class="ident" id="4492490">n</span><span class="op" id="4492491">]</span><span class="op" id="4492492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492496">p</span>&nbsp;<span class="op" id="4492498">=</span>&nbsp;<span class="ident" id="4492500">p</span><span class="op" id="4492501">[</span><span class="ident" id="4492502">n</span><span class="op" id="4492503">:</span><span class="op" id="4492504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492510">if</span>&nbsp;<span class="builtinfunc" id="4492513">len</span><span class="op" id="4492516">(</span><span class="ident" id="4492517">p</span><span class="op" id="4492518">)</span>&nbsp;<span class="op" id="4492520">&gt;</span>&nbsp;<span class="num" id="4492522">0</span>&nbsp;<span class="op" id="4492524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492528">d</span><span class="op" id="4492529">.</span><span class="ident" id="4492530">nx</span>&nbsp;<span class="op" id="4492533">=</span>&nbsp;<span class="builtinfunc" id="4492535">copy</span><span class="op" id="4492539">(</span><span class="ident" id="4492540">d</span><span class="op" id="4492541">.</span><span class="ident" id="4492542">x</span><span class="op" id="4492543">[</span><span class="op" id="4492544">:</span><span class="op" id="4492545">]</span><span class="op" id="4492546">,</span>&nbsp;<span class="ident" id="4492548">p</span><span class="op" id="4492549">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492555">return</span><br>
<span class="lineno"></span><span class="op" id="4492562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4492565">func</span>&nbsp;<span class="op" id="4492570">(</span><span class="ident" id="4492571">d0</span>&nbsp;<span class="op" id="4492574">*</span><span class="ident" id="4492575">digest</span><span class="op" id="4492581">)</span>&nbsp;<span class="ident" id="4492583">Sum</span><span class="op" id="4492586">(</span><span class="ident" id="4492587">in</span>&nbsp;<span class="op" id="4492590">[</span><span class="op" id="4492591">]</span><span class="builtintype" id="4492592">byte</span><span class="op" id="4492596">)</span>&nbsp;<span class="op" id="4492598">[</span><span class="op" id="4492599">]</span><span class="builtintype" id="4492600">byte</span>&nbsp;<span class="op" id="4492605">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492608">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492675">d</span>&nbsp;<span class="op" id="4492677">:=</span>&nbsp;<span class="op" id="4492680">*</span><span class="ident" id="4492681">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492685">hash</span>&nbsp;<span class="op" id="4492690">:=</span>&nbsp;<span class="ident" id="4492693">d</span><span class="op" id="4492694">.</span><span class="ident" id="4492695">checkSum</span><span class="op" id="4492703">(</span><span class="op" id="4492704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492707">return</span>&nbsp;<span class="builtinfunc" id="4492714">append</span><span class="op" id="4492720">(</span><span class="ident" id="4492721">in</span><span class="op" id="4492723">,</span>&nbsp;<span class="ident" id="4492725">hash</span><span class="op" id="4492729">[</span><span class="op" id="4492730">:</span><span class="op" id="4492731">]</span><span class="op" id="4492732">...</span><span class="op" id="4492735">)</span><br>
<span class="lineno"></span><span class="op" id="4492737">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4492740">func</span>&nbsp;<span class="op" id="4492745">(</span><span class="ident" id="4492746">d</span>&nbsp;<span class="op" id="4492748">*</span><span class="ident" id="4492749">digest</span><span class="op" id="4492755">)</span>&nbsp;<span class="ident" id="4492757">checkSum</span><span class="op" id="4492765">(</span><span class="op" id="4492766">)</span>&nbsp;<span class="op" id="4492768">[</span><span class="ident" id="4492769">Size</span><span class="op" id="4492773">]</span><span class="builtintype" id="4492774">byte</span>&nbsp;<span class="op" id="4492779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4492782">len</span>&nbsp;<span class="op" id="4492786">:=</span>&nbsp;<span class="ident" id="4492789">d</span><span class="op" id="4492790">.</span><span class="builtinfunc" id="4492791">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492796">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492856">var</span>&nbsp;<span class="ident" id="4492860">tmp</span>&nbsp;<span class="op" id="4492864">[</span><span class="num" id="4492865">64</span><span class="op" id="4492867">]</span><span class="builtintype" id="4492868">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492874">tmp</span><span class="op" id="4492877">[</span><span class="num" id="4492878">0</span><span class="op" id="4492879">]</span>&nbsp;<span class="op" id="4492881">=</span>&nbsp;<span class="num" id="4492883">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492889">if</span>&nbsp;<span class="builtinfunc" id="4492892">len</span><span class="op" id="4492895">%</span><span class="num" id="4492896">64</span>&nbsp;<span class="op" id="4492899">&lt;</span>&nbsp;<span class="num" id="4492901">56</span>&nbsp;<span class="op" id="4492904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492908">d</span><span class="op" id="4492909">.</span><span class="ident" id="4492910">Write</span><span class="op" id="4492915">(</span><span class="ident" id="4492916">tmp</span><span class="op" id="4492919">[</span><span class="num" id="4492920">0</span>&nbsp;<span class="op" id="4492922">:</span>&nbsp;<span class="num" id="4492924">56</span><span class="op" id="4492926">-</span><span class="builtinfunc" id="4492927">len</span><span class="op" id="4492930">%</span><span class="num" id="4492931">64</span><span class="op" id="4492933">]</span><span class="op" id="4492934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492937">}</span>&nbsp;<span class="keyword" id="4492939">else</span>&nbsp;<span class="op" id="4492944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492948">d</span><span class="op" id="4492949">.</span><span class="ident" id="4492950">Write</span><span class="op" id="4492955">(</span><span class="ident" id="4492956">tmp</span><span class="op" id="4492959">[</span><span class="num" id="4492960">0</span>&nbsp;<span class="op" id="4492962">:</span>&nbsp;<span class="num" id="4492964">64</span><span class="op" id="4492966">+</span><span class="num" id="4492967">56</span><span class="op" id="4492969">-</span><span class="builtinfunc" id="4492970">len</span><span class="op" id="4492973">%</span><span class="num" id="4492974">64</span><span class="op" id="4492976">]</span><span class="op" id="4492977">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492984">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4493004">len</span>&nbsp;<span class="op" id="4493008">&lt;&lt;=</span>&nbsp;<span class="num" id="4493012">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493015">for</span>&nbsp;<span class="ident" id="4493019">i</span>&nbsp;<span class="op" id="4493021">:=</span>&nbsp;<span class="builtintype" id="4493024">uint</span><span class="op" id="4493028">(</span><span class="num" id="4493029">0</span><span class="op" id="4493030">)</span><span class="op" id="4493031">;</span>&nbsp;<span class="ident" id="4493033">i</span>&nbsp;<span class="op" id="4493035">&lt;</span>&nbsp;<span class="num" id="4493037">8</span><span class="op" id="4493038">;</span>&nbsp;<span class="ident" id="4493040">i</span><span class="op" id="4493041">++</span>&nbsp;<span class="op" id="4493044">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493048">tmp</span><span class="op" id="4493051">[</span><span class="ident" id="4493052">i</span><span class="op" id="4493053">]</span>&nbsp;<span class="op" id="4493055">=</span>&nbsp;<span class="builtintype" id="4493057">byte</span><span class="op" id="4493061">(</span><span class="builtinfunc" id="4493062">len</span>&nbsp;<span class="op" id="4493066">&gt;&gt;</span>&nbsp;<span class="op" id="4493069">(</span><span class="num" id="4493070">56</span>&nbsp;<span class="op" id="4493073">-</span>&nbsp;<span class="num" id="4493075">8</span><span class="op" id="4493076">*</span><span class="ident" id="4493077">i</span><span class="op" id="4493078">)</span><span class="op" id="4493079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493085">d</span><span class="op" id="4493086">.</span><span class="ident" id="4493087">Write</span><span class="op" id="4493092">(</span><span class="ident" id="4493093">tmp</span><span class="op" id="4493096">[</span><span class="num" id="4493097">0</span><span class="op" id="4493098">:</span><span class="num" id="4493099">8</span><span class="op" id="4493100">]</span><span class="op" id="4493101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493105">if</span>&nbsp;<span class="ident" id="4493108">d</span><span class="op" id="4493109">.</span><span class="ident" id="4493110">nx</span>&nbsp;<span class="op" id="4493113">!=</span>&nbsp;<span class="num" id="4493116">0</span>&nbsp;<span class="op" id="4493118">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4493122">panic</span><span class="op" id="4493127">(</span><span class="string" id="4493128">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4493139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493146">var</span>&nbsp;<span class="ident" id="4493150">digest</span>&nbsp;<span class="op" id="4493157">[</span><span class="ident" id="4493158">Size</span><span class="op" id="4493162">]</span><span class="builtintype" id="4493163">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493169">for</span>&nbsp;<span class="ident" id="4493173">i</span><span class="op" id="4493174">,</span>&nbsp;<span class="ident" id="4493176">s</span>&nbsp;<span class="op" id="4493178">:=</span>&nbsp;<span class="keyword" id="4493181">range</span>&nbsp;<span class="ident" id="4493187">d</span><span class="op" id="4493188">.</span><span class="ident" id="4493189">h</span>&nbsp;<span class="op" id="4493191">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493195">digest</span><span class="op" id="4493201">[</span><span class="ident" id="4493202">i</span><span class="op" id="4493203">*</span><span class="num" id="4493204">4</span><span class="op" id="4493205">]</span>&nbsp;<span class="op" id="4493207">=</span>&nbsp;<span class="builtintype" id="4493209">byte</span><span class="op" id="4493213">(</span><span class="ident" id="4493214">s</span>&nbsp;<span class="op" id="4493216">&gt;&gt;</span>&nbsp;<span class="num" id="4493219">24</span><span class="op" id="4493221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493225">digest</span><span class="op" id="4493231">[</span><span class="ident" id="4493232">i</span><span class="op" id="4493233">*</span><span class="num" id="4493234">4</span><span class="op" id="4493235">+</span><span class="num" id="4493236">1</span><span class="op" id="4493237">]</span>&nbsp;<span class="op" id="4493239">=</span>&nbsp;<span class="builtintype" id="4493241">byte</span><span class="op" id="4493245">(</span><span class="ident" id="4493246">s</span>&nbsp;<span class="op" id="4493248">&gt;&gt;</span>&nbsp;<span class="num" id="4493251">16</span><span class="op" id="4493253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493257">digest</span><span class="op" id="4493263">[</span><span class="ident" id="4493264">i</span><span class="op" id="4493265">*</span><span class="num" id="4493266">4</span><span class="op" id="4493267">+</span><span class="num" id="4493268">2</span><span class="op" id="4493269">]</span>&nbsp;<span class="op" id="4493271">=</span>&nbsp;<span class="builtintype" id="4493273">byte</span><span class="op" id="4493277">(</span><span class="ident" id="4493278">s</span>&nbsp;<span class="op" id="4493280">&gt;&gt;</span>&nbsp;<span class="num" id="4493283">8</span><span class="op" id="4493284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493288">digest</span><span class="op" id="4493294">[</span><span class="ident" id="4493295">i</span><span class="op" id="4493296">*</span><span class="num" id="4493297">4</span><span class="op" id="4493298">+</span><span class="num" id="4493299">3</span><span class="op" id="4493300">]</span>&nbsp;<span class="op" id="4493302">=</span>&nbsp;<span class="builtintype" id="4493304">byte</span><span class="op" id="4493308">(</span><span class="ident" id="4493309">s</span><span class="op" id="4493310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493313">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493317">return</span>&nbsp;<span class="ident" id="4493324">digest</span><br>
<span class="lineno"></span><span class="op" id="4493331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4493334">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="4493380">func</span>&nbsp;<span class="ident" id="4493385">Sum</span><span class="op" id="4493388">(</span><span class="ident" id="4493389">data</span>&nbsp;<span class="op" id="4493394">[</span><span class="op" id="4493395">]</span><span class="builtintype" id="4493396">byte</span><span class="op" id="4493400">)</span>&nbsp;<span class="op" id="4493402">[</span><span class="ident" id="4493403">Size</span><span class="op" id="4493407">]</span><span class="builtintype" id="4493408">byte</span>&nbsp;<span class="op" id="4493413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493416">var</span>&nbsp;<span class="ident" id="4493420">d</span>&nbsp;<span class="ident" id="4493422">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493430">d</span><span class="op" id="4493431">.</span><span class="ident" id="4493432">Reset</span><span class="op" id="4493437">(</span><span class="op" id="4493438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493441">d</span><span class="op" id="4493442">.</span><span class="ident" id="4493443">Write</span><span class="op" id="4493448">(</span><span class="ident" id="4493449">data</span><span class="op" id="4493453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493456">return</span>&nbsp;<span class="ident" id="4493463">d</span><span class="op" id="4493464">.</span><span class="ident" id="4493465">checkSum</span><span class="op" id="4493473">(</span><span class="op" id="4493474">)</span><br>
<span class="lineno">130</span><span class="op" id="4493476">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
