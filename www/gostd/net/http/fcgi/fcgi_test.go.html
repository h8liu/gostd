<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html" class="current">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8203805">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8203860">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8203914">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8203965">package</span>&nbsp;<span class="ident" id="8203973">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8203979">import</span>&nbsp;<span class="op" id="8203986">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8203989">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8203998">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8204008">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8204014">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8204024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8204027">var</span>&nbsp;<span class="ident" id="8204031">sizeTests</span>&nbsp;<span class="op" id="8204041">=</span>&nbsp;<span class="op" id="8204043">[</span><span class="op" id="8204044">]</span><span class="keyword" id="8204045">struct</span>&nbsp;<span class="op" id="8204052">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204055">size</span>&nbsp;&nbsp;<span class="builtintype" id="8204061">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204069">bytes</span>&nbsp;<span class="op" id="8204075">[</span><span class="op" id="8204076">]</span><span class="builtintype" id="8204077">byte</span><br>
<span class="lineno"></span><span class="op" id="8204082">}</span><span class="op" id="8204083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204086">{</span><span class="num" id="8204087">0</span><span class="op" id="8204088">,</span>&nbsp;<span class="op" id="8204090">[</span><span class="op" id="8204091">]</span><span class="builtintype" id="8204092">byte</span><span class="op" id="8204096">{</span><span class="num" id="8204097">0x00</span><span class="op" id="8204101">}</span><span class="op" id="8204102">}</span><span class="op" id="8204103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204106">{</span><span class="num" id="8204107">127</span><span class="op" id="8204110">,</span>&nbsp;<span class="op" id="8204112">[</span><span class="op" id="8204113">]</span><span class="builtintype" id="8204114">byte</span><span class="op" id="8204118">{</span><span class="num" id="8204119">0x7F</span><span class="op" id="8204123">}</span><span class="op" id="8204124">}</span><span class="op" id="8204125">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204128">{</span><span class="num" id="8204129">128</span><span class="op" id="8204132">,</span>&nbsp;<span class="op" id="8204134">[</span><span class="op" id="8204135">]</span><span class="builtintype" id="8204136">byte</span><span class="op" id="8204140">{</span><span class="num" id="8204141">0x80</span><span class="op" id="8204145">,</span>&nbsp;<span class="num" id="8204147">0x00</span><span class="op" id="8204151">,</span>&nbsp;<span class="num" id="8204153">0x00</span><span class="op" id="8204157">,</span>&nbsp;<span class="num" id="8204159">0x80</span><span class="op" id="8204163">}</span><span class="op" id="8204164">}</span><span class="op" id="8204165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204168">{</span><span class="num" id="8204169">1000</span><span class="op" id="8204173">,</span>&nbsp;<span class="op" id="8204175">[</span><span class="op" id="8204176">]</span><span class="builtintype" id="8204177">byte</span><span class="op" id="8204181">{</span><span class="num" id="8204182">0x80</span><span class="op" id="8204186">,</span>&nbsp;<span class="num" id="8204188">0x00</span><span class="op" id="8204192">,</span>&nbsp;<span class="num" id="8204194">0x03</span><span class="op" id="8204198">,</span>&nbsp;<span class="num" id="8204200">0xE8</span><span class="op" id="8204204">}</span><span class="op" id="8204205">}</span><span class="op" id="8204206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204209">{</span><span class="num" id="8204210">33554431</span><span class="op" id="8204218">,</span>&nbsp;<span class="op" id="8204220">[</span><span class="op" id="8204221">]</span><span class="builtintype" id="8204222">byte</span><span class="op" id="8204226">{</span><span class="num" id="8204227">0x81</span><span class="op" id="8204231">,</span>&nbsp;<span class="num" id="8204233">0xFF</span><span class="op" id="8204237">,</span>&nbsp;<span class="num" id="8204239">0xFF</span><span class="op" id="8204243">,</span>&nbsp;<span class="num" id="8204245">0xFF</span><span class="op" id="8204249">}</span><span class="op" id="8204250">}</span><span class="op" id="8204251">,</span><br>
<span class="lineno"></span><span class="op" id="8204253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8204256">func</span>&nbsp;<span class="ident" id="8204261">TestSize</span><span class="op" id="8204269">(</span><span class="ident" id="8204270">t</span>&nbsp;<span class="op" id="8204272">*</span><span class="ident" id="8204273">testing</span><span class="op" id="8204280">.</span><span class="ident" id="8204281">T</span><span class="op" id="8204282">)</span>&nbsp;<span class="op" id="8204284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204287">b</span>&nbsp;<span class="op" id="8204289">:=</span>&nbsp;<span class="builtinfunc" id="8204292">make</span><span class="op" id="8204296">(</span><span class="op" id="8204297">[</span><span class="op" id="8204298">]</span><span class="builtintype" id="8204299">byte</span><span class="op" id="8204303">,</span>&nbsp;<span class="num" id="8204305">4</span><span class="op" id="8204306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8204309">for</span>&nbsp;<span class="ident" id="8204313">i</span><span class="op" id="8204314">,</span>&nbsp;<span class="ident" id="8204316">test</span>&nbsp;<span class="op" id="8204321">:=</span>&nbsp;<span class="keyword" id="8204324">range</span>&nbsp;<span class="ident" id="8204330">sizeTests</span>&nbsp;<span class="op" id="8204340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204344">n</span>&nbsp;<span class="op" id="8204346">:=</span>&nbsp;<span class="ident" id="8204349">encodeSize</span><span class="op" id="8204359">(</span><span class="ident" id="8204360">b</span><span class="op" id="8204361">,</span>&nbsp;<span class="ident" id="8204363">test</span><span class="op" id="8204367">.</span><span class="ident" id="8204368">size</span><span class="op" id="8204372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8204376">if</span>&nbsp;<span class="op" id="8204379">!</span><span class="ident" id="8204380">bytes</span><span class="op" id="8204385">.</span><span class="ident" id="8204386">Equal</span><span class="op" id="8204391">(</span><span class="ident" id="8204392">b</span><span class="op" id="8204393">[</span><span class="op" id="8204394">:</span><span class="ident" id="8204395">n</span><span class="op" id="8204396">]</span><span class="op" id="8204397">,</span>&nbsp;<span class="ident" id="8204399">test</span><span class="op" id="8204403">.</span><span class="ident" id="8204404">bytes</span><span class="op" id="8204409">)</span>&nbsp;<span class="op" id="8204411">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204416">t</span><span class="op" id="8204417">.</span><span class="ident" id="8204418">Errorf</span><span class="op" id="8204424">(</span><span class="string" id="8204425">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="8204453">,</span>&nbsp;<span class="ident" id="8204455">i</span><span class="op" id="8204456">,</span>&nbsp;<span class="ident" id="8204458">test</span><span class="op" id="8204462">.</span><span class="ident" id="8204463">bytes</span><span class="op" id="8204468">,</span>&nbsp;<span class="ident" id="8204470">b</span><span class="op" id="8204471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204479">size</span><span class="op" id="8204483">,</span>&nbsp;<span class="ident" id="8204485">n</span>&nbsp;<span class="op" id="8204487">:=</span>&nbsp;<span class="ident" id="8204490">readSize</span><span class="op" id="8204498">(</span><span class="ident" id="8204499">test</span><span class="op" id="8204503">.</span><span class="ident" id="8204504">bytes</span><span class="op" id="8204509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8204513">if</span>&nbsp;<span class="ident" id="8204516">size</span>&nbsp;<span class="op" id="8204521">!=</span>&nbsp;<span class="ident" id="8204524">test</span><span class="op" id="8204528">.</span><span class="ident" id="8204529">size</span>&nbsp;<span class="op" id="8204534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204539">t</span><span class="op" id="8204540">.</span><span class="ident" id="8204541">Errorf</span><span class="op" id="8204547">(</span><span class="string" id="8204548">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8204573">,</span>&nbsp;<span class="ident" id="8204575">i</span><span class="op" id="8204576">,</span>&nbsp;<span class="ident" id="8204578">test</span><span class="op" id="8204582">.</span><span class="ident" id="8204583">size</span><span class="op" id="8204587">,</span>&nbsp;<span class="ident" id="8204589">size</span><span class="op" id="8204593">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8204601">if</span>&nbsp;<span class="builtinfunc" id="8204604">len</span><span class="op" id="8204607">(</span><span class="ident" id="8204608">test</span><span class="op" id="8204612">.</span><span class="ident" id="8204613">bytes</span><span class="op" id="8204618">)</span>&nbsp;<span class="op" id="8204620">!=</span>&nbsp;<span class="ident" id="8204623">n</span>&nbsp;<span class="op" id="8204625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204630">t</span><span class="op" id="8204631">.</span><span class="ident" id="8204632">Errorf</span><span class="op" id="8204638">(</span><span class="string" id="8204639">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="8204673">,</span>&nbsp;<span class="ident" id="8204675">i</span><span class="op" id="8204676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204683">}</span><br>
<span class="lineno">40</span><span class="op" id="8204685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8204688">var</span>&nbsp;<span class="ident" id="8204692">streamTests</span>&nbsp;<span class="op" id="8204704">=</span>&nbsp;<span class="op" id="8204706">[</span><span class="op" id="8204707">]</span><span class="keyword" id="8204708">struct</span>&nbsp;<span class="op" id="8204715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204718">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8204726">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204734">recType</span>&nbsp;<span class="ident" id="8204742">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204751">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8204759">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204767">content</span>&nbsp;<span class="op" id="8204775">[</span><span class="op" id="8204776">]</span><span class="builtintype" id="8204777">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8204783">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204791">[</span><span class="op" id="8204792">]</span><span class="builtintype" id="8204793">byte</span><br>
<span class="lineno"></span><span class="op" id="8204798">}</span><span class="op" id="8204799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204802">{</span><span class="string" id="8204803">&#34;single&nbsp;record&#34;</span><span class="op" id="8204818">,</span>&nbsp;<span class="ident" id="8204820">typeStdout</span><span class="op" id="8204830">,</span>&nbsp;<span class="num" id="8204832">1</span><span class="op" id="8204833">,</span>&nbsp;<span class="builtintype" id="8204835">nil</span><span class="op" id="8204838">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204842">[</span><span class="op" id="8204843">]</span><span class="builtintype" id="8204844">byte</span><span class="op" id="8204848">{</span><span class="num" id="8204849">1</span><span class="op" id="8204850">,</span>&nbsp;<span class="builtintype" id="8204852">byte</span><span class="op" id="8204856">(</span><span class="ident" id="8204857">typeStdout</span><span class="op" id="8204867">)</span><span class="op" id="8204868">,</span>&nbsp;<span class="num" id="8204870">0</span><span class="op" id="8204871">,</span>&nbsp;<span class="num" id="8204873">1</span><span class="op" id="8204874">,</span>&nbsp;<span class="num" id="8204876">0</span><span class="op" id="8204877">,</span>&nbsp;<span class="num" id="8204879">0</span><span class="op" id="8204880">,</span>&nbsp;<span class="num" id="8204882">0</span><span class="op" id="8204883">,</span>&nbsp;<span class="num" id="8204885">0</span><span class="op" id="8204886">}</span><span class="op" id="8204887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204890">}</span><span class="op" id="8204891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8204894">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204947">{</span><span class="string" id="8204948">&#34;two&nbsp;records&#34;</span><span class="op" id="8204961">,</span>&nbsp;<span class="ident" id="8204963">typeStdin</span><span class="op" id="8204972">,</span>&nbsp;<span class="num" id="8204974">300</span><span class="op" id="8204977">,</span>&nbsp;<span class="builtinfunc" id="8204979">make</span><span class="op" id="8204983">(</span><span class="op" id="8204984">[</span><span class="op" id="8204985">]</span><span class="builtintype" id="8204986">byte</span><span class="op" id="8204990">,</span>&nbsp;<span class="num" id="8204992">66000</span><span class="op" id="8204997">)</span><span class="op" id="8204998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8205002">bytes</span><span class="op" id="8205007">.</span><span class="ident" id="8205008">Join</span><span class="op" id="8205012">(</span><span class="op" id="8205013">[</span><span class="op" id="8205014">]</span><span class="op" id="8205015">[</span><span class="op" id="8205016">]</span><span class="builtintype" id="8205017">byte</span><span class="op" id="8205021">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8205026">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205060">{</span><span class="num" id="8205061">1</span><span class="op" id="8205062">,</span>&nbsp;<span class="builtintype" id="8205064">byte</span><span class="op" id="8205068">(</span><span class="ident" id="8205069">typeStdin</span><span class="op" id="8205078">)</span><span class="op" id="8205079">,</span>&nbsp;<span class="num" id="8205081">0x01</span><span class="op" id="8205085">,</span>&nbsp;<span class="num" id="8205087">0x2C</span><span class="op" id="8205091">,</span>&nbsp;<span class="num" id="8205093">0xFF</span><span class="op" id="8205097">,</span>&nbsp;<span class="num" id="8205099">0xFF</span><span class="op" id="8205103">,</span>&nbsp;<span class="num" id="8205105">1</span><span class="op" id="8205106">,</span>&nbsp;<span class="num" id="8205108">0</span><span class="op" id="8205109">}</span><span class="op" id="8205110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8205115">make</span><span class="op" id="8205119">(</span><span class="op" id="8205120">[</span><span class="op" id="8205121">]</span><span class="builtintype" id="8205122">byte</span><span class="op" id="8205126">,</span>&nbsp;<span class="num" id="8205128">65536</span><span class="op" id="8205133">)</span><span class="op" id="8205134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8205139">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205167">{</span><span class="num" id="8205168">1</span><span class="op" id="8205169">,</span>&nbsp;<span class="builtintype" id="8205171">byte</span><span class="op" id="8205175">(</span><span class="ident" id="8205176">typeStdin</span><span class="op" id="8205185">)</span><span class="op" id="8205186">,</span>&nbsp;<span class="num" id="8205188">0x01</span><span class="op" id="8205192">,</span>&nbsp;<span class="num" id="8205194">0x2C</span><span class="op" id="8205198">,</span>&nbsp;<span class="num" id="8205200">0x01</span><span class="op" id="8205204">,</span>&nbsp;<span class="num" id="8205206">0xD1</span><span class="op" id="8205210">,</span>&nbsp;<span class="num" id="8205212">7</span><span class="op" id="8205213">,</span>&nbsp;<span class="num" id="8205215">0</span><span class="op" id="8205216">}</span><span class="op" id="8205217">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8205222">make</span><span class="op" id="8205226">(</span><span class="op" id="8205227">[</span><span class="op" id="8205228">]</span><span class="builtintype" id="8205229">byte</span><span class="op" id="8205233">,</span>&nbsp;<span class="num" id="8205235">472</span><span class="op" id="8205238">)</span><span class="op" id="8205239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8205244">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205278">{</span><span class="num" id="8205279">1</span><span class="op" id="8205280">,</span>&nbsp;<span class="builtintype" id="8205282">byte</span><span class="op" id="8205286">(</span><span class="ident" id="8205287">typeStdin</span><span class="op" id="8205296">)</span><span class="op" id="8205297">,</span>&nbsp;<span class="num" id="8205299">0x01</span><span class="op" id="8205303">,</span>&nbsp;<span class="num" id="8205305">0x2C</span><span class="op" id="8205309">,</span>&nbsp;<span class="num" id="8205311">0</span><span class="op" id="8205312">,</span>&nbsp;<span class="num" id="8205314">0</span><span class="op" id="8205315">,</span>&nbsp;<span class="num" id="8205317">0</span><span class="op" id="8205318">,</span>&nbsp;<span class="num" id="8205320">0</span><span class="op" id="8205321">}</span><span class="op" id="8205322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205326">}</span><span class="op" id="8205327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8205332">nil</span><span class="op" id="8205335">)</span><span class="op" id="8205336">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205339">}</span><span class="op" id="8205340">,</span><br>
<span class="lineno"></span><span class="op" id="8205342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8205345">type</span>&nbsp;<span class="ident" id="8205350">nilCloser</span>&nbsp;<span class="keyword" id="8205360">struct</span>&nbsp;<span class="op" id="8205367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8205370">io</span><span class="op" id="8205372">.</span><span class="ident" id="8205373">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="8205384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8205387">func</span>&nbsp;<span class="op" id="8205392">(</span><span class="ident" id="8205393">c</span>&nbsp;<span class="op" id="8205395">*</span><span class="ident" id="8205396">nilCloser</span><span class="op" id="8205405">)</span>&nbsp;<span class="ident" id="8205407">Close</span><span class="op" id="8205412">(</span><span class="op" id="8205413">)</span>&nbsp;<span class="builtintype" id="8205415">error</span>&nbsp;<span class="op" id="8205421">{</span>&nbsp;<span class="keyword" id="8205423">return</span>&nbsp;<span class="builtintype" id="8205430">nil</span>&nbsp;<span class="op" id="8205434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8205437">func</span>&nbsp;<span class="ident" id="8205442">TestStreams</span><span class="op" id="8205453">(</span><span class="ident" id="8205454">t</span>&nbsp;<span class="op" id="8205456">*</span><span class="ident" id="8205457">testing</span><span class="op" id="8205464">.</span><span class="ident" id="8205465">T</span><span class="op" id="8205466">)</span>&nbsp;<span class="op" id="8205468">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205471">var</span>&nbsp;<span class="ident" id="8205475">rec</span>&nbsp;<span class="ident" id="8205479">record</span><br>
<span class="lineno"></span><span class="ident" id="8205486">outer</span><span class="op" id="8205491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205494">for</span>&nbsp;<span class="ident" id="8205498">_</span><span class="op" id="8205499">,</span>&nbsp;<span class="ident" id="8205501">test</span>&nbsp;<span class="op" id="8205506">:=</span>&nbsp;<span class="keyword" id="8205509">range</span>&nbsp;<span class="ident" id="8205515">streamTests</span>&nbsp;<span class="op" id="8205527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8205531">buf</span>&nbsp;<span class="op" id="8205535">:=</span>&nbsp;<span class="ident" id="8205538">bytes</span><span class="op" id="8205543">.</span><span class="ident" id="8205544">NewBuffer</span><span class="op" id="8205553">(</span><span class="ident" id="8205554">test</span><span class="op" id="8205558">.</span><span class="ident" id="8205559">raw</span><span class="op" id="8205562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205566">var</span>&nbsp;<span class="ident" id="8205570">content</span>&nbsp;<span class="op" id="8205578">[</span><span class="op" id="8205579">]</span><span class="builtintype" id="8205580">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205587">for</span>&nbsp;<span class="ident" id="8205591">buf</span><span class="op" id="8205594">.</span><span class="ident" id="8205595">Len</span><span class="op" id="8205598">(</span><span class="op" id="8205599">)</span>&nbsp;<span class="op" id="8205601">&gt;</span>&nbsp;<span class="num" id="8205603">0</span>&nbsp;<span class="op" id="8205605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205610">if</span>&nbsp;<span class="ident" id="8205613">err</span>&nbsp;<span class="op" id="8205617">:=</span>&nbsp;<span class="ident" id="8205620">rec</span><span class="op" id="8205623">.</span><span class="ident" id="8205624">read</span><span class="op" id="8205628">(</span><span class="ident" id="8205629">buf</span><span class="op" id="8205632">)</span><span class="op" id="8205633">;</span>&nbsp;<span class="ident" id="8205635">err</span>&nbsp;<span class="op" id="8205639">!=</span>&nbsp;<span class="builtintype" id="8205642">nil</span>&nbsp;<span class="op" id="8205646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8205652">t</span><span class="op" id="8205653">.</span><span class="ident" id="8205654">Errorf</span><span class="op" id="8205660">(</span><span class="string" id="8205661">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8205691">,</span>&nbsp;<span class="ident" id="8205693">test</span><span class="op" id="8205697">.</span><span class="ident" id="8205698">desc</span><span class="op" id="8205702">,</span>&nbsp;<span class="ident" id="8205704">err</span><span class="op" id="8205707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205713">continue</span>&nbsp;<span class="ident" id="8205722">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205731">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8205736">content</span>&nbsp;<span class="op" id="8205744">=</span>&nbsp;<span class="builtinfunc" id="8205746">append</span><span class="op" id="8205752">(</span><span class="ident" id="8205753">content</span><span class="op" id="8205760">,</span>&nbsp;<span class="ident" id="8205762">rec</span><span class="op" id="8205765">.</span><span class="ident" id="8205766">content</span><span class="op" id="8205773">(</span><span class="op" id="8205774">)</span><span class="op" id="8205775">...</span><span class="op" id="8205778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205786">if</span>&nbsp;<span class="ident" id="8205789">rec</span><span class="op" id="8205792">.</span><span class="ident" id="8205793">h</span><span class="op" id="8205794">.</span><span class="ident" id="8205795">Type</span>&nbsp;<span class="op" id="8205800">!=</span>&nbsp;<span class="ident" id="8205803">test</span><span class="op" id="8205807">.</span><span class="ident" id="8205808">recType</span>&nbsp;<span class="op" id="8205816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8205821">t</span><span class="op" id="8205822">.</span><span class="ident" id="8205823">Errorf</span><span class="op" id="8205829">(</span><span class="string" id="8205830">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8205859">,</span>&nbsp;<span class="ident" id="8205861">test</span><span class="op" id="8205865">.</span><span class="ident" id="8205866">desc</span><span class="op" id="8205870">,</span>&nbsp;<span class="ident" id="8205872">rec</span><span class="op" id="8205875">.</span><span class="ident" id="8205876">h</span><span class="op" id="8205877">.</span><span class="ident" id="8205878">Type</span><span class="op" id="8205882">,</span>&nbsp;<span class="ident" id="8205884">test</span><span class="op" id="8205888">.</span><span class="ident" id="8205889">recType</span><span class="op" id="8205896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205901">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8205916">if</span>&nbsp;<span class="ident" id="8205919">rec</span><span class="op" id="8205922">.</span><span class="ident" id="8205923">h</span><span class="op" id="8205924">.</span><span class="ident" id="8205925">Id</span>&nbsp;<span class="op" id="8205928">!=</span>&nbsp;<span class="ident" id="8205931">test</span><span class="op" id="8205935">.</span><span class="ident" id="8205936">reqId</span>&nbsp;<span class="op" id="8205942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8205947">t</span><span class="op" id="8205948">.</span><span class="ident" id="8205949">Errorf</span><span class="op" id="8205955">(</span><span class="string" id="8205956">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8205991">,</span>&nbsp;<span class="ident" id="8205993">test</span><span class="op" id="8205997">.</span><span class="ident" id="8205998">desc</span><span class="op" id="8206002">,</span>&nbsp;<span class="ident" id="8206004">rec</span><span class="op" id="8206007">.</span><span class="ident" id="8206008">h</span><span class="op" id="8206009">.</span><span class="ident" id="8206010">Id</span><span class="op" id="8206012">,</span>&nbsp;<span class="ident" id="8206014">test</span><span class="op" id="8206018">.</span><span class="ident" id="8206019">reqId</span><span class="op" id="8206024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206029">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8206040">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206044">if</span>&nbsp;<span class="op" id="8206047">!</span><span class="ident" id="8206048">bytes</span><span class="op" id="8206053">.</span><span class="ident" id="8206054">Equal</span><span class="op" id="8206059">(</span><span class="ident" id="8206060">content</span><span class="op" id="8206067">,</span>&nbsp;<span class="ident" id="8206069">test</span><span class="op" id="8206073">.</span><span class="ident" id="8206074">content</span><span class="op" id="8206081">)</span>&nbsp;<span class="op" id="8206083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206088">t</span><span class="op" id="8206089">.</span><span class="ident" id="8206090">Errorf</span><span class="op" id="8206096">(</span><span class="string" id="8206097">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8206121">,</span>&nbsp;<span class="ident" id="8206123">test</span><span class="op" id="8206127">.</span><span class="ident" id="8206128">desc</span><span class="op" id="8206132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206137">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8206148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206152">buf</span><span class="op" id="8206155">.</span><span class="ident" id="8206156">Reset</span><span class="op" id="8206161">(</span><span class="op" id="8206162">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206166">c</span>&nbsp;<span class="op" id="8206168">:=</span>&nbsp;<span class="ident" id="8206171">newConn</span><span class="op" id="8206178">(</span><span class="op" id="8206179">&amp;</span><span class="ident" id="8206180">nilCloser</span><span class="op" id="8206189">{</span><span class="ident" id="8206190">buf</span><span class="op" id="8206193">}</span><span class="op" id="8206194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206198">w</span>&nbsp;<span class="op" id="8206200">:=</span>&nbsp;<span class="ident" id="8206203">newWriter</span><span class="op" id="8206212">(</span><span class="ident" id="8206213">c</span><span class="op" id="8206214">,</span>&nbsp;<span class="ident" id="8206216">test</span><span class="op" id="8206220">.</span><span class="ident" id="8206221">recType</span><span class="op" id="8206228">,</span>&nbsp;<span class="ident" id="8206230">test</span><span class="op" id="8206234">.</span><span class="ident" id="8206235">reqId</span><span class="op" id="8206240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206244">if</span>&nbsp;<span class="ident" id="8206247">_</span><span class="op" id="8206248">,</span>&nbsp;<span class="ident" id="8206250">err</span>&nbsp;<span class="op" id="8206254">:=</span>&nbsp;<span class="ident" id="8206257">w</span><span class="op" id="8206258">.</span><span class="ident" id="8206259">Write</span><span class="op" id="8206264">(</span><span class="ident" id="8206265">test</span><span class="op" id="8206269">.</span><span class="ident" id="8206270">content</span><span class="op" id="8206277">)</span><span class="op" id="8206278">;</span>&nbsp;<span class="ident" id="8206280">err</span>&nbsp;<span class="op" id="8206284">!=</span>&nbsp;<span class="builtintype" id="8206287">nil</span>&nbsp;<span class="op" id="8206291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206296">t</span><span class="op" id="8206297">.</span><span class="ident" id="8206298">Errorf</span><span class="op" id="8206304">(</span><span class="string" id="8206305">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8206335">,</span>&nbsp;<span class="ident" id="8206337">test</span><span class="op" id="8206341">.</span><span class="ident" id="8206342">desc</span><span class="op" id="8206346">,</span>&nbsp;<span class="ident" id="8206348">err</span><span class="op" id="8206351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206356">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8206367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206371">if</span>&nbsp;<span class="ident" id="8206374">err</span>&nbsp;<span class="op" id="8206378">:=</span>&nbsp;<span class="ident" id="8206381">w</span><span class="op" id="8206382">.</span><span class="ident" id="8206383">Close</span><span class="op" id="8206388">(</span><span class="op" id="8206389">)</span><span class="op" id="8206390">;</span>&nbsp;<span class="ident" id="8206392">err</span>&nbsp;<span class="op" id="8206396">!=</span>&nbsp;<span class="builtintype" id="8206399">nil</span>&nbsp;<span class="op" id="8206403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206408">t</span><span class="op" id="8206409">.</span><span class="ident" id="8206410">Errorf</span><span class="op" id="8206416">(</span><span class="string" id="8206417">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="8206447">,</span>&nbsp;<span class="ident" id="8206449">test</span><span class="op" id="8206453">.</span><span class="ident" id="8206454">desc</span><span class="op" id="8206458">,</span>&nbsp;<span class="ident" id="8206460">err</span><span class="op" id="8206463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206468">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8206479">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206483">if</span>&nbsp;<span class="op" id="8206486">!</span><span class="ident" id="8206487">bytes</span><span class="op" id="8206492">.</span><span class="ident" id="8206493">Equal</span><span class="op" id="8206498">(</span><span class="ident" id="8206499">buf</span><span class="op" id="8206502">.</span><span class="ident" id="8206503">Bytes</span><span class="op" id="8206508">(</span><span class="op" id="8206509">)</span><span class="op" id="8206510">,</span>&nbsp;<span class="ident" id="8206512">test</span><span class="op" id="8206516">.</span><span class="ident" id="8206517">raw</span><span class="op" id="8206520">)</span>&nbsp;<span class="op" id="8206522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206527">t</span><span class="op" id="8206528">.</span><span class="ident" id="8206529">Errorf</span><span class="op" id="8206535">(</span><span class="string" id="8206536">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8206561">,</span>&nbsp;<span class="ident" id="8206563">test</span><span class="op" id="8206567">.</span><span class="ident" id="8206568">desc</span><span class="op" id="8206572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8206576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8206579">}</span><br>
<span class="lineno"></span><span class="op" id="8206581">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8206584">type</span>&nbsp;<span class="ident" id="8206589">writeOnlyConn</span>&nbsp;<span class="keyword" id="8206603">struct</span>&nbsp;<span class="op" id="8206610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206613">buf</span>&nbsp;<span class="op" id="8206617">[</span><span class="op" id="8206618">]</span><span class="builtintype" id="8206619">byte</span><br>
<span class="lineno"></span><span class="op" id="8206624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8206627">func</span>&nbsp;<span class="op" id="8206632">(</span><span class="ident" id="8206633">c</span>&nbsp;<span class="op" id="8206635">*</span><span class="ident" id="8206636">writeOnlyConn</span><span class="op" id="8206649">)</span>&nbsp;<span class="ident" id="8206651">Write</span><span class="op" id="8206656">(</span><span class="ident" id="8206657">p</span>&nbsp;<span class="op" id="8206659">[</span><span class="op" id="8206660">]</span><span class="builtintype" id="8206661">byte</span><span class="op" id="8206665">)</span>&nbsp;<span class="op" id="8206667">(</span><span class="builtintype" id="8206668">int</span><span class="op" id="8206671">,</span>&nbsp;<span class="builtintype" id="8206673">error</span><span class="op" id="8206678">)</span>&nbsp;<span class="op" id="8206680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206683">c</span><span class="op" id="8206684">.</span><span class="ident" id="8206685">buf</span>&nbsp;<span class="op" id="8206689">=</span>&nbsp;<span class="builtinfunc" id="8206691">append</span><span class="op" id="8206697">(</span><span class="ident" id="8206698">c</span><span class="op" id="8206699">.</span><span class="ident" id="8206700">buf</span><span class="op" id="8206703">,</span>&nbsp;<span class="ident" id="8206705">p</span><span class="op" id="8206706">...</span><span class="op" id="8206709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206712">return</span>&nbsp;<span class="builtinfunc" id="8206719">len</span><span class="op" id="8206722">(</span><span class="ident" id="8206723">p</span><span class="op" id="8206724">)</span><span class="op" id="8206725">,</span>&nbsp;<span class="builtintype" id="8206727">nil</span><br>
<span class="lineno"></span><span class="op" id="8206731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="8206734">func</span>&nbsp;<span class="op" id="8206739">(</span><span class="ident" id="8206740">c</span>&nbsp;<span class="op" id="8206742">*</span><span class="ident" id="8206743">writeOnlyConn</span><span class="op" id="8206756">)</span>&nbsp;<span class="ident" id="8206758">Read</span><span class="op" id="8206762">(</span><span class="ident" id="8206763">p</span>&nbsp;<span class="op" id="8206765">[</span><span class="op" id="8206766">]</span><span class="builtintype" id="8206767">byte</span><span class="op" id="8206771">)</span>&nbsp;<span class="op" id="8206773">(</span><span class="builtintype" id="8206774">int</span><span class="op" id="8206777">,</span>&nbsp;<span class="builtintype" id="8206779">error</span><span class="op" id="8206784">)</span>&nbsp;<span class="op" id="8206786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206789">return</span>&nbsp;<span class="num" id="8206796">0</span><span class="op" id="8206797">,</span>&nbsp;<span class="ident" id="8206799">errors</span><span class="op" id="8206805">.</span><span class="ident" id="8206806">New</span><span class="op" id="8206809">(</span><span class="string" id="8206810">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="8206830">)</span><br>
<span class="lineno"></span><span class="op" id="8206832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8206835">func</span>&nbsp;<span class="op" id="8206840">(</span><span class="ident" id="8206841">c</span>&nbsp;<span class="op" id="8206843">*</span><span class="ident" id="8206844">writeOnlyConn</span><span class="op" id="8206857">)</span>&nbsp;<span class="ident" id="8206859">Close</span><span class="op" id="8206864">(</span><span class="op" id="8206865">)</span>&nbsp;<span class="builtintype" id="8206867">error</span>&nbsp;<span class="op" id="8206873">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206876">return</span>&nbsp;<span class="builtintype" id="8206883">nil</span><br>
<span class="lineno"></span><span class="op" id="8206887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8206890">func</span>&nbsp;<span class="ident" id="8206895">TestGetValues</span><span class="op" id="8206908">(</span><span class="ident" id="8206909">t</span>&nbsp;<span class="op" id="8206911">*</span><span class="ident" id="8206912">testing</span><span class="op" id="8206919">.</span><span class="ident" id="8206920">T</span><span class="op" id="8206921">)</span>&nbsp;<span class="op" id="8206923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8206926">var</span>&nbsp;<span class="ident" id="8206930">rec</span>&nbsp;<span class="ident" id="8206934">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206942">rec</span><span class="op" id="8206945">.</span><span class="ident" id="8206946">h</span><span class="op" id="8206947">.</span><span class="ident" id="8206948">Type</span>&nbsp;<span class="op" id="8206953">=</span>&nbsp;<span class="ident" id="8206955">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206971">wc</span>&nbsp;<span class="op" id="8206974">:=</span>&nbsp;<span class="builtinfunc" id="8206977">new</span><span class="op" id="8206980">(</span><span class="ident" id="8206981">writeOnlyConn</span><span class="op" id="8206994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8206997">c</span>&nbsp;<span class="op" id="8206999">:=</span>&nbsp;<span class="ident" id="8207002">newChild</span><span class="op" id="8207010">(</span><span class="ident" id="8207011">wc</span><span class="op" id="8207013">,</span>&nbsp;<span class="builtintype" id="8207015">nil</span><span class="op" id="8207018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8207021">err</span>&nbsp;<span class="op" id="8207025">:=</span>&nbsp;<span class="ident" id="8207028">c</span><span class="op" id="8207029">.</span><span class="ident" id="8207030">handleRecord</span><span class="op" id="8207042">(</span><span class="op" id="8207043">&amp;</span><span class="ident" id="8207044">rec</span><span class="op" id="8207047">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8207050">if</span>&nbsp;<span class="ident" id="8207053">err</span>&nbsp;<span class="op" id="8207057">!=</span>&nbsp;<span class="builtintype" id="8207060">nil</span>&nbsp;<span class="op" id="8207064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8207068">t</span><span class="op" id="8207069">.</span><span class="ident" id="8207070">Fatalf</span><span class="op" id="8207076">(</span><span class="string" id="8207077">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="8207095">,</span>&nbsp;<span class="ident" id="8207097">err</span><span class="op" id="8207100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8207107">const</span>&nbsp;<span class="ident" id="8207113">want</span>&nbsp;<span class="op" id="8207118">=</span>&nbsp;<span class="string" id="8207120">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="8207153">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207157">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="8207184">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207188">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8207246">if</span>&nbsp;<span class="ident" id="8207249">got</span>&nbsp;<span class="op" id="8207253">:=</span>&nbsp;<span class="builtintype" id="8207256">string</span><span class="op" id="8207262">(</span><span class="ident" id="8207263">wc</span><span class="op" id="8207265">.</span><span class="ident" id="8207266">buf</span><span class="op" id="8207269">)</span><span class="op" id="8207270">;</span>&nbsp;<span class="ident" id="8207272">got</span>&nbsp;<span class="op" id="8207276">!=</span>&nbsp;<span class="ident" id="8207279">want</span>&nbsp;<span class="op" id="8207284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8207288">t</span><span class="op" id="8207289">.</span><span class="ident" id="8207290">Errorf</span><span class="op" id="8207296">(</span><span class="string" id="8207297">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8207319">,</span>&nbsp;<span class="ident" id="8207321">got</span><span class="op" id="8207324">,</span>&nbsp;<span class="ident" id="8207326">want</span><span class="op" id="8207330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207333">}</span><br>
<span class="lineno">150</span><span class="op" id="8207335">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
